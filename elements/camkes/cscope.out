cscope 15 /thesis/camkes-rumprun/projects/camkes/apps/click_scratch/elements/camkes               0000052622
	@camkes_classifier.cc

21 
	~<şick/cÚfig.h
>

22 
	~"ÿmkes_şassif›r.hh
"

23 
	~<şick/glue.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/cÚå¬£.hh
>

26 
	~<şick/¡¿ccum.hh
>

27 #ià!
HAVE_INDIFFERENT_ALIGNMENT


28 
	~<şick/rou‹r.hh
>

30 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

31 
	~<io¡»am
>

32 
	~<şick/ÿmkes_cÚfig.hh
>

33 
CLICK_DECLS


35 
	gCamkes_CÏssif›r
::
	$Camkes_CÏssif›r
()

37 
	}
}

39 
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m


40 
Camkes_CÏssif›r
::
	$em±y_´og¿m
(
E¼ÜHªdËr
 *
”rh
) const

43 
c
, 
o
;

44 ià(
Alignm’tInfo
::
	`qu”y
(
this
, 0, 
c
, 
o
) && c >= 4){

46 
o
 = (4 - (o % 4)) % 4;

48 #ià!
HAVE_INDIFFERENT_ALIGNMENT


49 ià(
”rh
) {

50 
”rh
->
	`w¬nšg
("alignment unknown, but machine is sensitiveo‡lignment");

51 *&
x
 = 
	`rou‹r
()->
	`fÜû_©chm’t
("Camkes_Classifier‡lignment warning");

52 ià(!
x
) {

53 
x
 = (*è
this
;

54 
”rh
->
	`mes§ge
("(%s must beold how its input…ackets‡re‡ligned in memory.\n"

57 "oà%<Alignm’tInfo(% 4 0)%>.)", 
	`şass_Çme
(), 
	`Çme
().
	`c_¡r
());

61 (è
”rh
;

63 
o
 = 0;

65  
CÏssifiÿtiÚ
::
WÜdwi£
::
	`Prog¿m
(
o
);

66 
	}
}

69 
	$upd©e_v®ue_mask
(
c
, 
shiá
, &
v®ue
, &
mask
)

71 
v
 = 0, 
m
 = 0xF;

72 ià(
c
 == '?')

73 
v
 = 
m
 = 0;

74 ià(
c
 >= '0' && c <= '9')

75 
v
 = 
c
 - '0';

76 ià(
c
 >= 'A' && c <= 'F')

77 
v
 = 
c
 - 'A' + 10;

78 ià(
c
 >= 'a' && c <= 'f')

79 
v
 = 
c
 - 'a' + 10;

80 
v®ue
 |ğ(
v
 << 
shiá
);

81 
mask
 |ğ(
m
 << 
shiá
);

82 
	}
}

85 
	gCamkes_CÏssif›r
::
·r£_´og¿m
(
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 &
´og
,

86 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

88 
	gVeùÜ
<> 
	gŒ“
 = 
´og
.
š™_subŒ“
();

89 
	g´og
.
¡¬t_subŒ“
(
Œ“
);

91 
	g¦Ù
 = 0; slÙ < 
	gcÚf
.
size
(); slot++) {

92 
	gi
 = 0;

93 
	gËn
 = 
cÚf
[
¦Ù
].
Ëngth
();

94 cÚ¡ *
	gs
 = 
cÚf
[
¦Ù
].
d©a
();

95 
boŞ
 
	gem±y
 = 
Œue
;

97 
	g´og
.
¡¬t_subŒ“
(
Œ“
);

99 ià(
	gs
[0] =ğ'-' && 
Ën
 == 1)

101 
i
 = 1;

103 
	gi
 < 
	gËn
) {

105 
	gi
 < 
	gËn
 && 
is¥aû
((è
s
[
i
]))

106 
	gi
++;

107 ià(
	gi
 >ğ
Ën
)

111 
boŞ
 
	gÃg©ed
 = 
çl£
;

112 ià(
	gs
[
i
] == '!') {

113 
Ãg©ed
 = 
Œue
;

114 
	gi
++;

115 
	gi
 < 
	gËn
 && 
is¥aû
((è
s
[
i
]))

116 
	gi
++;

119 ià(
	gi
 >ğ
Ën
 || !
isdig™
((è
s
[
i
])) {

120 
”rh
->
”rÜ
("·‰”À%d:ƒx³ùed‡ dig™", 
¦Ù
);

125 
	goff£t
 = 0;

126 
	gi
 < 
	gËn
 && 
isdig™
((è
s
[
i
])) {

127 
	goff£t
 *= 10;

128 
	goff£t
 +ğ
s
[
i
] - '0';

129 
	gi
++;

132 ià(
	gi
 >ğ
Ën
 || 
s
[
i
] != '/') {

133 
”rh
->
”rÜ
("·‰”À%d:ƒx³ùed %</%>", 
¦Ù
);

136 
	gi
++;

139 
	gv®ue_pos
 = 
i
;

140 
	gi
 < 
	gËn
 && (
isxdig™
((è
s
[
i
]è|| 
	gs
[i] == '?'))

141 
i
++;

142 
	gv®ue_’d
 = 
i
;

145 
	gmask_pos
 = -1;

146 
	gmask_’d
 = -1;

147 ià(
	gi
 < 
	gËn
 && 
	gs
[
i
] == '%') {

148 
i
++;

149 
	gmask_pos
 = 
i
;

150 
	gi
 < 
	gËn
 && (
isxdig™
((è
s
[
i
]è|| 
	gs
[i] == '?'))

151 
i
++;

152 
	gmask_’d
 = 
i
;

156 ià(
	gv®ue_’d
 - 
	gv®ue_pos
 < 2) {

157 
	g”rh
->
”rÜ
("·‰”À%d: v®uha Ës thª 2 hex dig™s", 
¦Ù
);

158 
	gv®ue_’d
 = 
v®ue_pos
;

159 
	gmask_’d
 = 
mask_pos
;

161 ià((
	gv®ue_’d
 - 
	gv®ue_pos
) % 2 != 0) {

162 
”rh
->
”rÜ
("·‰”À%d: v®uha odd‚umb” oàhex dig™s", 
¦Ù
);

163 
	gv®ue_’d
--;

164 
	gmask_’d
--;

166 ià(
	gmask_pos
 >ğ0 && (
mask_’d
 - 
mask_pos
è!ğ(
v®ue_’d
 - 
v®ue_pos
)) {

167 
boŞ
 
too_mªy
 = (
mask_’d
 - 
mask_pos
è> (
v®ue_’d
 - 
v®ue_pos
);

168 
	g”rh
->
”rÜ
("·‰”À%d: mask ha toØ% hex dig™s", 
¦Ù
,

169 (
too_mªy
 ? "many" : "few"));

170 ià(
	gtoo_mªy
)

171 
	gmask_’d
 = 
mask_pos
 + 
v®ue_’d
 - 
v®ue_pos
;

173 
	gv®ue_’d
 = 
v®ue_pos
 + 
mask_’d
 - 
mask_pos
;

177 
	g´og
.
¡¬t_subŒ“
(
Œ“
);

179 
boŞ
 
	gfœ¡
 = 
Œue
;

180 
	goff£t
 +ğ
´og
.
®ign_off£t
();

181 
	gv®ue_pos
 < 
	gv®ue_’d
) {

182 
	gv
 = 0, 
	gm
 = 0;

183 
upd©e_v®ue_mask
(
s
[
v®ue_pos
], 4, 
v
, 
m
);

184 
upd©e_v®ue_mask
(
s
[
v®ue_pos
+1], 0, 
v
, 
m
);

185 
	gv®ue_pos
 += 2;

186 ià(
	gmask_pos
 >= 0) {

187 
mv
 = 0, 
	gmm
 = 0;

188 
upd©e_v®ue_mask
(
s
[
mask_pos
], 4, 
mv
, 
mm
);

189 
upd©e_v®ue_mask
(
s
[
mask_pos
+1], 0, 
mv
, 
mm
);

190 
	gmask_pos
 += 2;

191 
	gm
 = 
m
 & 
mv
 & 
mm
;

193 ià(
	gfœ¡
 || 
	goff£t
 % 4 == 0) {

194 
´og
.
add_š¢
(
Œ“
, (
off£t
 / 4) * 4, 0, 0);

195 
	gfœ¡
 = 
em±y
 = 
çl£
;

197 
	g´og
.
back
().
	gmask
.
	gc
[
off£t
 % 4] = 
m
;

198 
	g´og
.
back
().
	gv®ue
.
	gc
[
off£t
 % 4] = 
v
 & 
m
;

199 
	goff£t
++;

203 
	g´og
.
fšish_subŒ“
(
Œ“
, 
CÏssifiÿtiÚ
::
c_ªd
);

205 ià(
	gÃg©ed
)

206 
	g´og
.
Ãg©e_subŒ“
(
Œ“
);

210 ià(
	gem±y
)

211 
	g´og
.
add_š¢
(
Œ“
, 0, 0, 0);

213 
	g´og
.
fšish_subŒ“
(
Œ“
, 
CÏssifiÿtiÚ
::
c_ªd
,

214 -
¦Ù
, 
CÏssifiÿtiÚ
::
j_çu»
);

217 
	g´og
.
fšish_subŒ“
(
Œ“
, 
CÏssifiÿtiÚ
::
c_Ü
, CÏssifiÿtiÚ::
j_Ãv”
, Classification::j_never);

220 
	g´og
.
İtimize
(0, 0, 
CÏssifiÿtiÚ
::
off£t_max
);

225 
	gCamkes_CÏssif›r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

227 ià(
	gcÚf
.
size
(è!ğ
nouuts
())

228  
”rh
->
”rÜ
("Ãed %d‡rgum’ts, oÃ…” ouuˆpÜt", 
nouuts
());

230 
	gCÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 
´og
 = 
em±y_´og¿m
(
”rh
);

231 
·r£_´og¿m
(
´og
, 
cÚf
, 
”rh
);

232 ià(!
	g”rh
->
Ã¼Üs
()) {

233 
	g´og
.
w¬n_unu£d_ouuts
(
nouuts
(), 
”rh
);

234 
	g_´og
 = 
´og
;

240 
SŒšg


241 
	gCamkes_CÏssif›r
::
	$´og¿m_¡ršg
(
EËm’t
 *
–em’t
, *)

243 
Camkes_CÏssif›r
 *
c
 = 
¡©ic_ÿ¡
<Camkes_CÏssif›¸*>(
–em’t
);

244  
c
->
_´og
.
	`uÅ¬£
();

245 
	}
}

248 
	gCamkes_CÏssif›r
::
	$add_hªdËrs
()

250 
	`add_»ad_hªdËr
("´og¿m", 
Camkes_CÏssif›r
::
´og¿m_¡ršg
, 0, 
HªdËr
::
CALM
);

251 
	}
}

254 
	gCamkes_CÏssif›r
::
	$push
(, 
Pack‘
 *
p
)

256 
pÜt
 = 
_´og
.
	`m©ch
(
p
);

257 ià(
pÜt
 != 1){

258 
	`checked_ouut_push
(
pÜt
, 
p
);

260 
Pack‘
* 
d¡
 = 
»š‹½»t_ÿ¡
<Pack‘*>(&(
_ÿmkes_buf
->
cÚ‹Á
));

261 ((vŞ©
mes§ge_t
*)
_ÿmkes_buf
)->
»ady
);

262 
Camkes_cÚfig
::
	`·ck‘_£rŸlize
(
d¡
,
p
);

263 
_ÿmkes_buf
->
»ady
 = 1;

264 
p
->
	`kl
();

266 
	}
}

269 
	gCamkes_CÏssif›r
::
	$Camkes_CÏssif›r
(
mes§ge_t
 * 
_ÿmkes_buf
){

270 
this
->
_ÿmkes_buf
 = _camkes_buf;

271 
	}
}

273 
CLICK_ENDDECLS


274 
	$ELEMENT_REQUIRES
(
Alignm’tInfo
 
CÏssifiÿtiÚ
)

275 
	$EXPORT_ELEMENT
(
Camkes_CÏssif›r
)

276 
	`ELEMENT_MT_SAFE
(
Camkes_CÏssif›r
)

	@camkes_classifier.hh

1 #iâdeà
CLICK_CLASSIFIER_HH


2 
	#CLICK_CLASSIFIER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"../¡ªd¬d/şassifiÿtiÚ.hh
"

5 
	~<pÜ‰y³.h
>

6 
CLICK_DECLS


76 şas 
	cCamkes_CÏssif›r
 : 
public
 
EËm’t
 {…ublic:

78 
	$Camkes_CÏssif›r
(è
CLICK_COLD
;

79 
	`Camkes_CÏssif›r
(
mes§ge_t
* );

80 cÚ¡ *
	$şass_Çme
() const {  "Camkes_Classifier"; }

81 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

82 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

84 cÚ¡ *
	$æags
(ècÚ¡ {  "A"; 
	}
}

85 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

87 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

88 
	$add_hªdËrs
(è
CLICK_COLD
;

90 
	`push
(
pÜt
, 
Pack‘
 *);

92 
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 
	$em±y_´og¿m
(
E¼ÜHªdËr
 *
”rh
) const;

93 
	`·r£_´og¿m
(
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 &
´og
,

94 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
);

96 
´Ùeùed
:

98 
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 
_´og
;

100 
SŒšg
 
	`´og¿m_¡ršg
(
EËm’t
 *, *);

102 
´iv©e
:

103 
mes§ge_t
* 
_ÿmkes_buf
;

104 
	}
};

106 
	gCLICK_ENDDECLS


	@camkes_icmperror.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şickÃt/icmp.h
>

21 
	~<şickÃt/.h
>

22 
	~"ÿmkes_icm³¼Ü.hh
"

23 
	~<şick/add»ss.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/glue.hh
>

27 
	~<şick/·ck‘_ªno.hh
>

28 
	~<şick/Çmešfo.hh
>

29 
	~<io¡»am
>

30 
	~<şick/ÿmkes_cÚfig.hh
>

31 
CLICK_DECLS


33 
	gCamkes_ICMPE¼Ü
::
	$Camkes_ICMPE¼Ü
()

34 : 
	`_ty³
(-1), 
	`_code
(-1)

36 
	}
}

38 
	gCamkes_ICMPE¼Ü
::
	$Camkes_ICMPE¼Ü
(
mes§ge_t
 * 
m
)

39 : 
	`_ty³
(-1), 
	`_code
(-1),
	$_ÿmkes_buf
(
m
)

41 
	}
}

43 
	gCamkes_ICMPE¼Ü
::~
	$Camkes_ICMPE¼Ü
()

45 
	}
}

47 
boŞ


48 
Camkes_ICMPE¼Ü
::
	$is_”rÜ_ty³
(
ty³
)

50  
ty³
 =ğ
ICMP_UNREACH
 ||y³ =ğ
ICMP_SOURCEQUENCH


51 || 
ty³
 =ğ
ICMP_REDIRECT
 ||y³ =ğ
ICMP_TIMXCEED


52 || 
ty³
 =ğ
ICMP_PARAMPROB
;

53 
	}
}

56 
	gCamkes_ICMPE¼Ü
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

58 
SŒšg
 
	gcode_¡r
 = "0";

59 
	gmtu
 = 576, 
	gpmtu
 = 0;

60 
IPAdd»ss
 
	g¤c_
;

61 
	gty³
, 
	gcode
;

62 
	gVeùÜ
<
	gIPAdd»ss
> 
	gbad_addrs
;

63 
boŞ
 
	gu£_fix_ªno
 = 
Œue
;

67 ià(
Args
(
cÚf
, 
this
, 
”rh
)

68 .
»ad_mp
("SRC", 
¤c_
)

69 .
»ad_mp
("TYPE", 
NamedIÁArg
(
NameInfo
::
T_ICMP_TYPE
), 
ty³
)

70 .
»ad_p
("CODE", 
WÜdArg
(), 
code_¡r
)

71 .
»ad_p
("BADADDRS", 
bad_addrs
)

72 .
»ad
("MTU", 
mtu
)

73 .
»ad
("PMTU", 
pmtu
)

74 .
»ad
("SET_FIX_ANNO", 
u£_fix_ªno
)

75 .
com¶‘e
() < 0)

79 ià(
	gty³
 < 0 ||ype > 255)

80  
	g”rh
->
”rÜ
("ICMPype must be between 0‡nd 255");

81 ià(!
is_”rÜ_ty³
(
ty³
))

82  
	g”rh
->
”rÜ
("ICMPy³ %d i nÙ‡À”rÜy³", 
ty³
);

83 ià(!
	gNameInfo
::
qu”y_št
(
NameInfo
::
T_ICMP_CODE
 + 
ty³
, 
this
, 
code_¡r
, &
code
)

84 || 
	gcode
 < 0 || code > 255)

85  
	g”rh
->
”rÜ
("argument 2akes ICMP code (integer between 0‡nd 255)");

87 
	g_¤c_
 = 
¤c_
;

88 
	g_ty³
 = 
ty³
;

89 
	g_code
 = 
code
;

90 
	g_bad_addrs
.
sw­
(
bad_addrs
);

91 
	g_mtu
 = 
mtu
;

92 
	g_pmtu
 = 
pmtu
;

93 
	g_u£_fix_ªno
 = 
u£_fix_ªno
;

100 
boŞ


101 
	gCamkes_ICMPE¼Ü
::
	$uniÿ¡
(
š_addr
 
¯
) const

103 
ušt32_t
 
a
 = 
¯
.
s_addr
;

104 
ušt32_t
 
ha
 = 
	`Áohl
(
a
);

107 if(
ha
 == 0xffffffff)

111 if((
ha
 & 0xf0000000u) == 0xe0000000u)

115 ià(
	`fšd
(
_bad_addrs
.
	`begš
(), _bad_addrs.
	`’d
(), 
	`IPAdd»ss
(
a
)) < _bad_addrs.end())

119 
	}
}

125 
boŞ


126 
	gCamkes_ICMPE¼Ü
::
	$v®id_sourû
(
š_addr
 
¯
) const

128 
a
 = 
¯
.
s_addr
;

129 
ha
 = 
	`Áohl
(
a
);

130 
Ãt
 = (
ha
 >> 24) & 0xff;

133 if(
	`uniÿ¡
(
¯
) == 0)

137 if(
Ãt
 == 0)

141 if(
Ãt
 == 127)

145 if((
Ãt
 & 0xf0) == 0xf0)

149 
	}
}

154 cÚ¡ 
ušt8_t
 *

155 
	gCamkes_ICMPE¼Ü
::
	$v®id_sourû_rou‹
(cÚ¡ 
şick_
 *
h
)

157 cÚ¡ 
ušt8_t
 *
ß
 = (cÚ¡ ušt8_ˆ*)
h
;

158 
hËn
 = 
h
->
_hl
 << 2;

160 
oi
 = (
şick_
); o˜< 
hËn
; ) {

162 
ty³
 = 
ß
[
oi
];

163 ià(
ty³
 =ğ
IPOPT_NOP
) {

164 
oi
++;

166 } ià(
ty³
 =ğ
IPOPT_EOL
)

170 
xËn
 = 
ß
[
oi
 + 1];

171 ià(
xËn
 < 2 || 
oi
 + xËÀ> 
hËn
)

173 ià((
ty³
 =ğ
IPOPT_LSRR
 ||y³ =ğ
IPOPT_SSRR
)

174 && 
ß
[
oi
 + 2] >= 4 && oa[oi + 2] % 4 == 0

175 && 
ß
[
oi
 + 2] <ğ
xËn
 + 1)

176  
ß
 + 
oi
;

178 
oi
 +ğ
xËn
;

182 
	}
}

184 
Pack‘
 *

185 
	gCamkes_ICMPE¼Ü
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

187 
Wr™abËPack‘
 *
q
 = 0;

188 cÚ¡ 
şick_
 *
p
 = 
p
->
	`_h—d”
();

189 cÚ¡ 
ušt8_t
 *
sourû_rou‹
;

190 
şick_
 *
n
;

191 
şick_icmp
 *
iı
;

192 
hËn
, 
xËn
;

193 
id
 = 1;

195 ià(!
p
->
	`has_ÃtwÜk_h—d”
())

196 
out
;

198 
hËn
 = 
p
->
_hl
 << 2;

203 if(
p
->
_p
 =ğ
IP_PROTO_ICMP
) {

204 cÚ¡ 
şick_icmp
 *
icmph
 = 
p
->
	`icmp_h—d”
();

205 if(
hËn
 + 4 > 
p
->
	`Ëngth
(è|| 
	`is_”rÜ_ty³
(
icmph
->
icmp_ty³
))

206 
out
;

210 if(!
	`uniÿ¡
(
p
->
_d¡
))

211 
out
;

214 ià(
p
->
	`·ck‘_ty³_ªno
(è=ğ
Pack‘
::
BROADCAST
 ||…->·ck‘_ty³_ªno(è=ğPack‘::
MULTICAST
)

215 
out
;

218 if(!
	`v®id_sourû
(
p
->
_¤c
))

219 
out
;

222 if(!
	`IP_FIRSTFRAG
(
p
))

223 
out
;

225 
sourû_rou‹
 = 
	`v®id_sourû_rou‹
(
p
);

226 ià(
sourû_rou‹
) {

228 ià(
_ty³
 =ğ
ICMP_REDIRECT
)

229 
out
;

233 ià(
_ty³
 =ğ
ICMP_PARAMPROB
 && 
_code
 =ğ
ICMP_PARAMPROB_ERRATPTR


234 && 
sourû_rou‹
 <ğ((cÚ¡ 
ušt8_t
 *)
p
 + 
	`ICMP_PARAMPROB_ANNO
(
p
))

235 && ((cÚ¡ 
ušt8_t
 *)
p
 + 
	`ICMP_PARAMPROB_ANNO
(
p
)è< (
sourû_rou‹
 + source_route[1]))

236 
sourû_rou‹
 = 0;

240 
q
 = 
Pack‘
::
	`make
(
_mtu
);

241 ià(!
q
)

242 
out
;

245 
n
 = 
»š‹½»t_ÿ¡
<
şick_
 *>(
q
->
	`d©a
());

246 
n
->
_v
 = 4;

247 
n
->
_tos
 = 0;

248 
n
->
_id
 = 
	`htÚs
(
id
);

249 ++
id
;

250 
n
->
_off
 = 0;

251 
n
->
_‰l
 = 200;

252 
n
->
_p
 = 
IP_PROTO_ICMP
;

253 
n
->
_sum
 = 0;

254 
n
->
_¤c
 = 
_¤c_
.
	`š_addr
();

255 
n
->
_d¡
 = 
p
->
_¤c
;

258 ià(
sourû_rou‹
) {

259 
ušt8_t
 *
o
 = (ušt8_ˆ*è(
n
 + 1);

260 
Ş’
 = 
sourû_rou‹
[2] - 1;

261 
o
[0] = 
sourû_rou‹
[0];

262 
o
[1] = 
Ş’
;

263 
o
[2] = 4;

264 
o
[
Ş’
] = 
IPOPT_EOL
;

265 
o
 += 3;

266 cÚ¡ 
ušt8_t
 *
oo
 = 
sourû_rou‹
 + sourû_rou‹[2] - 5; oØ>ğsourû_rou‹ + 3; oØ-ğ4, 
o
 += 4)

267 
	`memıy
(
o
, 
oo
, 4);

268 
n
->
_hl
 = ((
şick_
è+ 
Ş’
 + 3) >> 2;

270 
n
->
_hl
 = (
şick_
) >> 2;

271 
q
->
	`£t__h—d”
(
n
,‚->
_hl
 << 2);

274 
iı
 = 
q
->
	`icmp_h—d”
();

275 
iı
->
icmp_ty³
 = 
_ty³
;

276 
iı
->
icmp_code
 = 
_code
;

277 
iı
->
icmp_cksum
 = 0;

278 
iı
->
·ddšg
 = 0;

281 ià(
_ty³
 =ğ
ICMP_PARAMPROB
 && 
_code
 =ğ
ICMP_PARAMPROB_ERRATPTR
)

283 ((
şick_icmp_·¿m´ob
 *è
iı
)->
icmp_poš‹r
 = 
	`ICMP_PARAMPROB_ANNO
(
p
);

284 ià(
_ty³
 =ğ
ICMP_REDIRECT
)

285 ((
şick_icmp_»dœeù
 *è
iı
)->
icmp_g©eway
 = 
p
->
	`d¡__ªno
();

286 ià(
_ty³
 =ğ
ICMP_UNREACH
 && 
_code
 =ğ
ICMP_UNREACH_NEEDFRAG
)

287 ((
şick_icmp_Ãedäag
 *è
iı
)->
icmp_Ãxtmtu
 = 
	`htÚs
(
_pmtu
);

290 
xËn
 = 
q
->
	`’d_d©a
(è- (
ušt8_t
 *)(
iı
 + 1);

291 ià(()
xËn
 > 
p
->
	`ÃtwÜk_Ëngth
()) {

292 
q
->
	`ke
(
xËn
 - 
p
->
	`ÃtwÜk_Ëngth
());

293 
xËn
 = 
p
->
	`ÃtwÜk_Ëngth
();

295 
	`memıy
((
ušt8_t
 *)(
iı
 + 1), 
p
->
	`ÃtwÜk_h—d”
(), 
xËn
);

296 
iı
->
icmp_cksum
 = 
	`şick_š_cksum
((*)iı, (
şick_icmp
è+ 
xËn
);

299 
n
->
_Ën
 = 
	`htÚs
(
q
->
	`ÃtwÜk_Ëngth
());

300 
n
->
_sum
 = 
	`şick_š_cksum
((*ê,‚->
_hl
 << 2);

303 
q
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(
n
->
_d¡
));

304 ià(
_u£_fix_ªno
)

305 
	`SET_FIX_IP_SRC_ANNO
(
q
, 1);

306 
q
->
	`time¡amp_ªno
().
	`assign_now
();

308 
out
:

309 
p
->
	`kl
();

310 (
q
);

311 
	}
}

314 
	gCamkes_ICMPE¼Ü
::
	$add_hªdËrs
()

316 
	`add_d©a_hªdËrs
("¤c", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_¤c_
);

317 
	`add_d©a_hªdËrs
("mtu", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_mtu
);

318 
	`add_d©a_hªdËrs
("pmtu", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_pmtu
);

319 
	}
}

322 
	gCamkes_ICMPE¼Ü
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

324 
p
 = 
	`sim¶e_aùiÚ
(p);

326 ià(
p
 !ğ
NULL
){

327 
Pack‘
* 
d¡
 = 
»š‹½»t_ÿ¡
<Pack‘*>(&(
_ÿmkes_buf
->
cÚ‹Á
));

328 ((vŞ©
mes§ge_t
*)
_ÿmkes_buf
)->
»ady
);

330 
Camkes_cÚfig
::
	`·ck‘_£rŸlize
(
d¡
,
p
);

331 
_ÿmkes_buf
->
»ady
 = 1;

332 
p
->
	`kl
();

334 
	}
}

337 
CLICK_ENDDECLS


338 
	$EXPORT_ELEMENT
(
Camkes_ICMPE¼Ü
)

339 
	`ELEMENT_MT_SAFE
(
Camkes_ICMPE¼Ü
)

	@camkes_icmperror.hh

1 #iâdeà
CLICK_ICMPERROR_HH


2 
	#CLICK_ICMPERROR_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<pÜ‰y³.h
>

5 
CLICK_DECLS


106 şas 
	cCamkes_ICMPE¼Ü
 : 
public
 
EËm’t
 {…ublic:

108 
	$Camkes_ICMPE¼Ü
(è
CLICK_COLD
;

109 ~
	$Camkes_ICMPE¼Ü
(è
CLICK_COLD
;

110 
	`Camkes_ICMPE¼Ü
(
mes§ge_t
* 
m
);

112 cÚ¡ *
	$şass_Çme
() const {  "ICMPError"; }

113 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

115 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

116 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

117 
	$add_hªdËrs
(è
CLICK_COLD
;

118 
	`push
(
pÜt
, 
Pack‘
 *
p
);

121 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

123 
´iv©e
:

125 
mes§ge_t
 * 
_ÿmkes_buf
;

126 
IPAdd»ss
 
_¤c_
;

127 
_ty³
;

128 
_code
;

129 
VeùÜ
<
IPAdd»ss
> 
_bad_addrs
;

130 
_mtu
;

131 
_pmtu
;

132 
boŞ
 
_u£_fix_ªno
;

134 
boŞ
 
	`is_”rÜ_ty³
();

135 
boŞ
 
	$uniÿ¡
(
š_addr
) const;

136 
boŞ
 
	$v®id_sourû
(
š_addr
) const;

137 cÚ¡ 
ušt8_t
 *
	`v®id_sourû_rou‹
(cÚ¡ 
şick_
 *

);

139 
	}
};

141 
	gCLICK_ENDDECLS


	@camkes_iproutetable.cc

21 
	~<şick/cÚfig.h
>

22 
	~<şick/add»ss.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/glue.hh
>

26 
	~<şick/¡¿ccum.hh
>

27 
	~<şick/rou‹r.hh
>

28 
	~"ÿmkes_rou‹bË.hh
"

29 
	~<io¡»am
>

30 
CLICK_DECLS


35 
boŞ


36 
	$ı__rou‹
(
SŒšg
 
s
, 
IPRou‹
 *
r_¡Üe
, 
boŞ
 
»move_rou‹
, 
EËm’t
 *
cÚ‹xt
)

38 
IPRou‹
 
r
;

40 ià(!
	`IPP»fixArg
(
Œue
).
	`·r£
(
	`ı_shiá_¥aûvec
(
s
), 
r
.
addr
,„.
mask
, 
cÚ‹xt
))

41  
çl£
;

42 
r
.
addr
 &ğr.
mask
;

44 
SŒšg
 
wÜd
 = 
	`ı_shiá_¥aûvec
(
s
);

46 ià(
wÜd
 == "-"){

48 } ià(
	`IPAdd»ssArg
().
	`·r£
(
wÜd
, 
r
.
gw
, 
cÚ‹xt
)){

51 
two_wÜds
;

54 
wÜd
 = 
	`ı_shiá_¥aûvec
(
s
);

55 
two_wÜds
:

57 ià(
	`IÁArg
().
	`·r£
(
wÜd
, 
r
.
pÜt
è|| (!wÜd && 
»move_rou‹
)){

58 ià(!
	`ı_shiá_¥aûvec
(
s
)) {

59 *
r_¡Üe
 = 
r
;

60  
Œue
;

63  
çl£
;

64 
	}
}

66 
	gSŒšgAccum
&

67 
	gIPRou‹
::
	$uÅ¬£
(
SŒšgAccum
& 
§
, 
boŞ
 
bs
) const

69 
l
 = 
§
.
	`Ëngth
();

70 
b
 = (
bs
 ? '\t' : ' ');

71 
§
 << 
addr
.
	`uÅ¬£_w™h_mask
(
mask
è<< 
b
;

72 ià(
§
.
	`Ëngth
(è< 
l
 + 17 && 
bs
)

73 
§
 << '\t';

74 
l
 = 
§
.
	`Ëngth
();

75 ià(
gw
)

76 
§
 << 
gw
 << 
b
;

78 
§
 << '-' << 
b
;

79 ià(
§
.
	`Ëngth
(è< 
l
 + 9 && 
bs
)

80 
§
 << '\t';

81 ià(!
	`»®
())

82 
§
 << "-1";

84 
§
 << 
pÜt
;

85  
§
;

86 
	}
}

88 
SŒšg


89 
	gIPRou‹
::
	$uÅ¬£
() const

91 
SŒšgAccum
 
§
;

92 
§
 << *
this
;

93  
§
.
	`ke_¡ršg
();

94 
	}
}

98 
	gCamkes_IPRou‹TabË
::
	$ÿ¡
(cÚ¡ *
Çme
)

100 ià(
	`¡rcmp
(
Çme
, "Camkes_IPRouteTable") == 0)

101  (*)
this
;

103  
EËm’t
::
	`ÿ¡
(
Çme
);

104 
	}
}

107 
	gCamkes_IPRou‹TabË
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

109 
	gr
 = 0, 
	gr1
, 
	g“xi¡
 = 0;

110 
IPRou‹
 
	grou‹
;

111 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

113 
	g»t
 = 
ı__rou‹
(
cÚf
[
i
], &
rou‹
, 
çl£
, 
this
);

115 ià(!
	g»t
) {

116 
	g”rh
->
”rÜ
("¬gum’ˆ%d should b%<ADDR/MASK [GATEWAY] OUTPUT%>", 
i
+1);

117 
	gr
 = -
EINVAL
;

118 } ià(
	grou‹
.
	gpÜt
 < 0 ||„ou‹.pÜˆ>ğ
nouuts
()) {

119 
”rh
->
”rÜ
("¬gum’ˆ%d bad OUTPUT", 
i
+1);

120 
	gr
 = -
EINVAL
;

122 ià((
	gr1
 = 
add_rou‹
(
rou‹
, 
çl£
, 0, 
”rh
)) < 0) {

123 ià(
	gr1
 =ğ-
EEXIST
)

124 ++
“xi¡
;

126 
	gr
 = 
r1
;

130 ià(
	g“xi¡
)

131 
	g”rh
->
w¬nšg
("%d % »¶aûd by†©” v”siÚs", 
“xi¡
,ƒexist > 1 ? "routes" : "route");

132  
	gr
;

136 
	gCamkes_IPRou‹TabË
::
	$add_rou‹
(cÚ¡ 
IPRou‹
&, 
boŞ
, IPRou‹*, 
E¼ÜHªdËr
 *
”rh
)

139  
”rh
->
	`”rÜ
("cannot‡dd„outesohis„outingable");

140 
	}
}

143 
	gCamkes_IPRou‹TabË
::
	$»move_rou‹
(cÚ¡ 
IPRou‹
&, IPRou‹*, 
E¼ÜHªdËr
 *
”rh
)

146  
”rh
->
	`”rÜ
("cannot delete„outes fromhis„outingable");

147 
	}
}

150 
	gCamkes_IPRou‹TabË
::
	$lookup_rou‹
(
IPAdd»ss
, IPAddress&) const

153 
	}
}

155 
SŒšg


156 
	gCamkes_IPRou‹TabË
::
	$dump_rou‹s
()

158  
	`SŒšg
();

159 
	}
}

163 
	gCamkes_IPRou‹TabË
::
	$push
(, 
Pack‘
 *
p
)

165 
IPAdd»ss
 
gw
;

166 
pÜt
 = 
	`lookup_rou‹
(
p
->
	`d¡__ªno
(), 
gw
);

167 ià(
pÜt
 >= 0) {

168 
	`as£¹
(
pÜt
 < 
	`nouuts
());

169 ià(
gw
)

170 
p
->
	`£t_d¡__ªno
(
gw
);

171 
	`ouut
(
pÜt
).
	`push
(
p
);

173 
com¶ašed
 = 0;

174 ià(++
com¶ašed
 <= 5)

175 
	`şick_ch©‹r
("Camkes_IPRou‹TabË:‚Ørou‹ fÜ %s", 
p
->
	`d¡__ªno
().
	`uÅ¬£
().
	`c_¡r
());

176 
p
->
	`kl
();

178 
	}
}

182 
	gCamkes_IPRou‹TabË
::
run_commªd
(
commªd
, cÚ¡ 
SŒšg
 &
¡r
, 
VeùÜ
<
IPRou‹
>* 
Şd_rou‹s
, 
E¼ÜHªdËr
 *
”rh
)

184 
IPRou‹
 
	grou‹
, 
	gŞd_rou‹
;

185 ià(!
ı__rou‹
(
¡r
, &
rou‹
, 
commªd
 =ğ
CMD_REMOVE
, 
this
))

186  
	g”rh
->
”rÜ
("ex³ùed %<ADDR/MASK [GATEWAY%s%>", (
commªd
 =ğ
CMD_REMOVE
 ? " OUTPUT]" : "] OUTPUT"));

187 ià(
	grou‹
.
	gpÜt
 < (
	gcommªd
 =ğ
CMD_REMOVE
 ? -1 : 0)

188 || 
rou‹
.
pÜt
 >ğ
nouuts
())

189  
”rh
->
”rÜ
("bad OUTPUT");

191 
	gr
, 
	gbefÜe
 = 
”rh
->
Ã¼Üs
();

192 ià(
	gcommªd
 =ğ
CMD_ADD
)

193 
r
 = 
add_rou‹
(
rou‹
, 
çl£
, &
Şd_rou‹
, 
”rh
);

194 ià(
	gcommªd
 =ğ
CMD_SET
)

195 
r
 = 
add_rou‹
(
rou‹
, 
Œue
, &
Şd_rou‹
, 
”rh
);

197 
	gr
 = 
»move_rou‹
(
rou‹
, &
Şd_rou‹
, 
”rh
);

200 ià(
	gr
 >ğ0 && 
Şd_rou‹s
) {

201 ià(
Şd_rou‹
.
pÜt
 < 0) {

202 
Şd_rou‹
 = 
rou‹
;

203 
	gŞd_rou‹
.
	gexŒa
 = 
CMD_ADD
;

205 
	gŞd_rou‹
.
	gexŒa
 = 
commªd
;

206 
	gŞd_rou‹s
->
push_back
(
Şd_rou‹
);

210 ià(
	gr
 =ğ-
EEXIST
 && 
”rh
->
Ã¼Üs
(è=ğ
befÜe
)

211 
”rh
->
”rÜ
("cÚæiù w™hƒxi¡šg„ou‹ %<%s%>", 
Şd_rou‹
.
uÅ¬£
().
c_¡r
());

212 ià(
	gr
 =ğ-
ENOENT
 && 
”rh
->
Ã¼Üs
(è=ğ
befÜe
)

213 
”rh
->
”rÜ
("rou‹ %<%s%>‚Ù found", 
rou‹
.
uÅ¬£
().
c_¡r
());

214 ià(
	gr
 =ğ-
ENOMEM
 && 
”rh
->
Ã¼Üs
(è=ğ
befÜe
)

215 
”rh
->
”rÜ
("nØmemÜyØ¡Ürou‹ %<%s%>", 
rou‹
.
uÅ¬£
().
c_¡r
());

216  
	gr
;

221 
	gCamkes_IPRou‹TabË
::
	$add_rou‹_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

223 
Camkes_IPRou‹TabË
 *
bË
 = 
¡©ic_ÿ¡
<Camkes_IPRou‹TabË *>(
e
);

224  
bË
->
	`run_commªd
((
thunk
 ? 
CMD_SET
 : 
CMD_ADD
), 
cÚf
, 0, 
”rh
);

225 
	}
}

228 
	gCamkes_IPRou‹TabË
::
	$»move_rou‹_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

230 
Camkes_IPRou‹TabË
 *
bË
 = 
¡©ic_ÿ¡
<Camkes_IPRou‹TabË *>(
e
);

231  
bË
->
	`run_commªd
(
CMD_REMOVE
, 
cÚf
, 0, 
”rh
);

232 
	}
}

235 
	gCamkes_IPRou‹TabË
::
	$ù¾_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf_š
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

237 
Camkes_IPRou‹TabË
 *
bË
 = 
¡©ic_ÿ¡
<Camkes_IPRou‹TabË *>(
e
);

238 
SŒšg
 
cÚf
 = 
	`ı_uncomm’t
(
cÚf_š
);

239 cÚ¡ * 
s
 = 
cÚf
.
	`begš
(), *
’d
 = cÚf.
	`’d
();

241 
VeùÜ
<
IPRou‹
> 
Şd_rou‹s
;

242 
r
 = 0;

244 
s
 < 
’d
) {

245 cÚ¡ * 
Æ
 = 
	`fšd
(
s
, 
’d
, '\n');

246 
SŒšg
 
lše
 = 
cÚf
.
	`sub¡ršg
(
s
, 
Æ
);

248 
SŒšg
 
fœ¡_wÜd
 = 
	`ı_shiá_¥aûvec
(
lše
);

249 
commªd
;

250 ià(
fœ¡_wÜd
 == "add")

251 
commªd
 = 
CMD_ADD
;

252 ià(
fœ¡_wÜd
 == "remove")

253 
commªd
 = 
CMD_REMOVE
;

254 ià(
fœ¡_wÜd
 == "set")

255 
commªd
 = 
CMD_SET
;

256 ià(!
fœ¡_wÜd
)

259 
r
 = 
”rh
->
	`”rÜ
("bad commªd %<%#s%>", 
fœ¡_wÜd
.
	`c_¡r
());

260 
rŞlback
;

263 ià((
r
 = 
bË
->
	`run_commªd
(
commªd
, 
lše
, &
Şd_rou‹s
, 
”rh
)) < 0)

264 
rŞlback
;

266 
s
 = 
Æ
 + 1;

270 
rŞlback
:

271 
Şd_rou‹s
.
	`size
()) {

272 cÚ¡ 
IPRou‹
& 
¹
 = 
Şd_rou‹s
.
	`back
();

273 ià(
¹
.
exŒa
 =ğ
CMD_REMOVE
)

274 
bË
->
	`add_rou‹
(
¹
, 
çl£
, 0, 
”rh
);

275 ià(
¹
.
exŒa
 =ğ
CMD_ADD
)

276 
bË
->
	`»move_rou‹
(
¹
, 0, 
”rh
);

278 
bË
->
	`add_rou‹
(
¹
, 
Œue
, 0, 
”rh
);

279 
Şd_rou‹s
.
	`pİ_back
();

281  
r
;

282 
	}
}

284 
SŒšg


285 
	gCamkes_IPRou‹TabË
::
	$bË_hªdËr
(
EËm’t
 *
e
, *)

287 
Camkes_IPRou‹TabË
 *
r
 = 
¡©ic_ÿ¡
<Camkes_IPRou‹TabË*>(
e
);

288  
r
->
	`dump_rou‹s
();

289 
	}
}

292 
	gCamkes_IPRou‹TabË
::
	$lookup_hªdËr
(, 
SŒšg
& 
s
, 
EËm’t
* 
e
, cÚ¡ 
HªdËr
*, 
E¼ÜHªdËr
* 
”rh
)

294 
Camkes_IPRou‹TabË
 *
bË
 = 
¡©ic_ÿ¡
<Camkes_IPRou‹TabË*>(
e
);

295 
IPAdd»ss
 
a
;

296 ià(
	`IPAdd»ssArg
().
	`·r£
(
s
, 
a
, 
bË
)) {

297 
IPAdd»ss
 
gw
;

298 
pÜt
 = 
bË
->
	`lookup_rou‹
(
a
, 
gw
);

299 ià(
gw
)

300 
s
 = 
	`SŒšg
(
pÜt
è+ " " + 
gw
.
	`uÅ¬£
();

302 
s
 = 
	`SŒšg
(
pÜt
);

305  
”rh
->
	`”rÜ
("expected IP‡ddress");

306 
	}
}

309 
	gCamkes_IPRou‹TabË
::
	$add_hªdËrs
()

311 
	`add_wr™e_hªdËr
("add", 
add_rou‹_hªdËr
, 0);

312 
	`add_wr™e_hªdËr
("£t", 
add_rou‹_hªdËr
, 1);

313 
	`add_wr™e_hªdËr
("»move", 
»move_rou‹_hªdËr
);

314 
	`add_wr™e_hªdËr
("ù¾", 
ù¾_hªdËr
);

315 
	`add_»ad_hªdËr
("bË", 
bË_hªdËr
, 0, 
HªdËr
::
f_ex³nsive
);

316 
	`£t_hªdËr
("lookup", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
lookup_hªdËr
);

317 
	}
}

319 
CLICK_ENDDECLS


320 
ELEMENT_PROVIDES
(
Camkes_IPRou‹TabË
)

	@camkes_iproutetable.hh

2 #iâdeà
CLICK_IPROUTETABLE_HH


3 
	#CLICK_IPROUTETABLE_HH


	)

4 
	~<şick/glue.hh
>

5 
	~<şick/–em’t.hh
>

6 
	~"pÜ‰y³.h
"

7 
CLICK_DECLS


164 
	sIPRou‹
 {

165 
IPAdd»ss
 
	maddr
;

166 
IPAdd»ss
 
	mmask
;

167 
IPAdd»ss
 
	mgw
;

168 
št32_t
 
	mpÜt
;

169 
št32_t
 
	mexŒa
;

172 
IPRou‹
(è: 
pÜt
(-1) { }

173 
IPRou‹
(
IPAdd»ss
 
a
, IPAdd»s 
m
, IPAdd»s 
g
, 
p
)

174 : 
addr
(
a
), 
mask
(
m
), 
gw
(
g
), 
pÜt
(
p
) { }

176 
šlše
 
boŞ
 
»®
(ècÚ¡ {  
	mpÜt
 > (
	mšt32_t
) -0x80000000; }

177 
šlše
 
kl
(è{ 
	maddr
 = 0; 
	mmask
 = 0xFFFFFFFFU; 
	mpÜt
 = -0x80000000; }

178 
šlše
 
boŞ
 
cÚšs
(
IPAdd»ss
 
a
) const;

179 
šlše
 
boŞ
 
cÚšs
(cÚ¡ 
IPRou‹
& 
r
) const;

180 
šlše
 
boŞ
 
mask_as_¥ecific
(
IPAdd»ss
 
m
) const;

181 
šlše
 
boŞ
 
mask_as_¥ecific
(cÚ¡ 
IPRou‹
& 
r
) const;

182 
šlše
 
boŞ
 
m©ch
(cÚ¡ 
IPRou‹
& 
r
) const;

183 
´efix_Ën
(ècÚ¡ {  
	mmask
.
mask_to_´efix_Ën
(); }

185 
	mSŒšgAccum
 &
uÅ¬£
(
SŒšgAccum
&, 
boŞ
 
bs
) const;

186 
SŒšg
 
uÅ¬£
() const;

187 
SŒšg
 
uÅ¬£_addr
(ècÚ¡ {  
	maddr
.
uÅ¬£_w™h_mask
(
mask
); }

190 şas 
	cCamkes_IPRou‹TabË
 : 
public
 
EËm’t
 {…ublic:

192 * 
ÿ¡
(const *);

193 
cÚfigu»
(
VeùÜ
<
SŒšg
>&, 
E¼ÜHªdËr
*è
	mCLICK_COLD
;

194 
	$add_hªdËrs
(è
CLICK_COLD
;

196 
	`Camkes_IPROu‹TabË
() = ;

198 
vœtu®
 
	`add_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, 
boŞ
 
®low_»¶aû
, IPRou‹* 
»¶aûd_rou‹
, 
E¼ÜHªdËr
* 
”rh
);

199 
vœtu®
 
	`»move_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, IPRou‹* 
»moved_rou‹
, 
E¼ÜHªdËr
* 
”rh
);

200 
vœtu®
 
	$lookup_rou‹
(
IPAdd»ss
 
addr
, IPAdd»ss& 
gw
) const = 0;

201 
vœtu®
 
SŒšg
 
	`dump_rou‹s
();

203 
	`push
(
pÜt
, 
Pack‘
* 
p
);

205 
	`add_rou‹_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

206 
	`»move_rou‹_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

207 
	`ù¾_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

208 
	`lookup_hªdËr
(
İ”©iÚ
, 
SŒšg
&, 
EËm’t
*, cÚ¡ 
HªdËr
*, 
E¼ÜHªdËr
*);

209 
SŒšg
 
	`bË_hªdËr
(
EËm’t
*, *);

211 
´iv©e
:

213 ’um { 
CMD_ADD
, 
CMD_SET
, 
CMD_REMOVE
 };

214 
	`run_commªd
(
commªd
, cÚ¡ 
SŒšg
 &, 
VeùÜ
<
IPRou‹
>* 
Şd_rou‹s
, 
E¼ÜHªdËr
*);

216 
	}
};

218 
šlše
 
	gSŒšgAccum
&

219 
	gİ”©Ü
<<(
	gSŒšgAccum
& 
	g§
, cÚ¡ 
	gIPRou‹
& 
	grou‹
)

221  
	grou‹
.
uÅ¬£
(
§
, 
çl£
);

224 
šlše
 
boŞ


225 
	gIPRou‹
::
	$cÚšs
(
IPAdd»ss
 
a
) const

227  
a
.
	`m©ches_´efix
(
addr
, 
mask
);

228 
	}
}

230 
šlše
 
boŞ


231 
	gIPRou‹
::
	$cÚšs
(cÚ¡ 
IPRou‹
& 
r
) const

233  
r
.
addr
.
	`m©ches_´efix
×ddr, 
mask
è&&„.mask.
	`mask_as_¥ecific
(mask);

234 
	}
}

236 
šlše
 
boŞ


237 
	gIPRou‹
::
	$mask_as_¥ecific
(
IPAdd»ss
 
m
) const

239  
mask
.
	`mask_as_¥ecific
(
m
);

240 
	}
}

242 
šlše
 
boŞ


243 
	gIPRou‹
::
	$mask_as_¥ecific
(cÚ¡ 
IPRou‹
& 
r
) const

245  
mask
.
	`mask_as_¥ecific
(
r
.mask);

246 
	}
}

248 
šlše
 
boŞ


249 
	gIPRou‹
::
	$m©ch
(cÚ¡ 
IPRou‹
& 
r
) const

251  
addr
 =ğ
r
.add¸&& 
mask
 ==„.mask

252 && (
pÜt
 < 0 || (
gw
 =ğ
r
.gw &&…ort ==„.port));

253 
	}
}

255 
	gCLICK_ENDDECLS


	@camkes_lineariplookup.cc

21 
	~<şick/cÚfig.h
>

22 
	~"ÿmkes_lš—rlookup.hh
"

23 
	~<şick/add»ss.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/ÿmkes_cÚfig.hh
>

27 
CLICK_DECLS


29 
	gCamkes_Lš—rIPLookup
::
	$Camkes_Lš—rIPLookup
()

30 : 
	`_z”o_rou‹
(-1)

32 
	}
}

34 
Camkes_Lš—rIPLookup
::~
	$Camkes_Lš—rIPLookup
()

36 
	}
}

38 
Camkes_Lš—rIPLookup
::
	$Camkes_Lš—rIPLookup
(
mes§ge_t
 ** 
_ÿmkes_buf
){

39 
this
->
_ÿmkes_buf
 = _camkes_buf;

40 
	}
}

43 
	gCamkes_Lš—rIPLookup
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

45 
_Ï¡_addr
 = 
	`IPAdd»ss
();

46 #ifdeà
IP_RT_CACHE2


47 
_Ï¡_addr2
 = 
_Ï¡_addr
;

50 
	}
}

52 
boŞ


53 
	gCamkes_Lš—rIPLookup
::
	$check
() const

55 
boŞ
 
ok
 = 
Œue
;

59 
i
 = 0; i < 
_t
.
	`size
(); i++) {

60 ià(!
_t
[
i
].
	`»®
())

62 
j
 = 
i
 + 1; j < 
_t
[i].
exŒa
 && j < _t.
	`size
(); j++)

63 ià(
_t
[
i
].
	`cÚšs
(_t[
j
]è&& _t[j].
	`»®
()) {

64 
	`şick_ch©‹r
("%s: bad‚exˆpoš‹rs:„ou‹ %s, %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_t
[
i
].
	`uÅ¬£_addr
().c_¡r(), _t[
j
].unparse_addr().c_str());

65 
ok
 = 
çl£
;

69 
j
 = 
_t
[
i
].
exŒa
;

70 ià(
j
 < 
_t
.
	`size
())

71 ià(!
_t
[
i
].
	`cÚšs
(_t[
j
]è&& _t[j].
	`»®
()) {

72 
	`şick_ch©‹r
("%s: bad‚exˆpoš‹rs':„ou‹ %s, %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_t
[
i
].
	`uÅ¬£_addr
().c_¡r(), _t[
j
].unparse_addr().c_str());

73 
ok
 = 
çl£
;

79 
i
 = 0; i < 
_t
.
	`size
(); i++)

80 
j
 = 
i
 + 1; j < 
_t
.
	`size
(); j++)

81 ià(
_t
[
i
].
addr
 =ğ_t[
j
].add¸&& _t[i].
mask
 =ğ_t[j].mask && _t[i].
	`»®
() && _t[j].real()) {

82 
	`şick_ch©‹r
("%s: du¶iÿ‹„ou‹ fÜ %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_t
[
i
].
	`uÅ¬£_addr
().c_str());

83 
ok
 = 
çl£
;

87 ià(
_Ï¡_addr
 && 
	`lookup_’Œy
(_Ï¡_addrè!ğ
_Ï¡_’Œy
) {

88 
	`şick_ch©‹r
("%s: bad cach’Œy fÜ %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_Ï¡_addr
.
	`uÅ¬£
().c_str());

89 
ok
 = 
çl£
;

91 #ifdeà
IP_RT_CACHE2


92 ià(
_Ï¡_addr2
 && 
	`lookup_’Œy
(_Ï¡_addr2è!ğ
_Ï¡_’Œy2
) {

93 
	`şick_ch©‹r
("%s: bad cach’Œy fÜ %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_Ï¡_addr2
.
	`uÅ¬£
().c_str());

94 
ok
 = 
çl£
;

98  
ok
;

99 
	}
}

102 
	gCamkes_Lš—rIPLookup
::
	$add_rou‹
(cÚ¡ 
IPRou‹
 &
r
, 
boŞ
 
®low_»¶aû
, IPRou‹* 
»¶aûd
, 
E¼ÜHªdËr
 *)

105 
found
 = 
_t
.
	`size
();

106 
i
 = 0; i < 
_t
.
	`size
(); i++)

107 ià(!
_t
[
i
].
	`»®
()) {

109 ià(
found
 =ğ
_t
.
	`size
())

110 
found
 = 
i
;

111 } ià(
_t
[
i
].
addr
 =ğ
r
.add¸&& _t[i].
mask
 ==„.mask) {

112 ià(
»¶aûd
)

113 *
»¶aûd
 = 
_t
[
i
];

114 ià(!
®low_»¶aû
)

115  -
EEXIST
;

116 
_t
[
i
].
gw
 = 
r
.gw;

117 
_t
[
i
].
pÜt
 = 
r
.port;

119 
	`check
();

125 ià(
found
 =ğ
_t
.
	`size
())

126 
_t
.
	`push_back
(
r
);

128 
_t
[
found
] = 
r
;

131 
_t
[
found
].
exŒa
 = 0x7FFFFFFF;

132 
i
 = 
found
 - 1; i >= 0; i--){

133 ià(
_t
[
i
].
	`cÚšs
(
r
è&& _t[i].
exŒa
 > 
found
){

134 
_t
[
i
].
exŒa
 = 
found
;

137 
i
 = 
found
 + 1; i < 
_t
.
	`size
(); i++)

138 ià(
r
.
	`cÚšs
(
_t
[
i
]è&& _t[i].
	`»®
()) {

139 
_t
[
found
].
exŒa
 = 
i
;

146 ià(!
r
.
addr
 &&„.
mask
.
	`addr
() == 0xFFFFFFFFU)

147 
_z”o_rou‹
 = 
found
;

150 
_Ï¡_addr
 = 
	`IPAdd»ss
();

151 #ifdeà
IP_RT_CACHE2


152 
_Ï¡_addr2
 = 
	`IPAdd»ss
();

155 
	`check
();

157 
	}
}

160 
	gCamkes_Lš—rIPLookup
::
	$»move_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, IPRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
 *
”rh
)

162 
i
 = 0; i < 
_t
.
	`size
(); i++)

163 ià(
rou‹
.
	`m©ch
(
_t
[
i
])) {

164 ià(
Şd_rou‹
)

165 *
Şd_rou‹
 = 
_t
[
i
];

166 
_t
[
i
].
	`kl
();

169 ià(
i
 =ğ
_z”o_rou‹
)

170 
_z”o_rou‹
 = -1;

171 ià(
i
 < 
_z”o_rou‹
) {

172 
IPRou‹
 
	`z”o
(
_t
[
_z”o_rou‹
]);

173 
_t
[
_z”o_rou‹
].
	`kl
();

174 
r
 = 
	`add_rou‹
(
z”o
, 
çl£
, 0, 
”rh
);

175 
	`as£¹
(
r
 >= 0);

176 (è
r
;

180 
_Ï¡_addr
 = 
	`IPAdd»ss
();

181 #ifdeà
IP_RT_CACHE2


182 
_Ï¡_addr2
 = 
	`IPAdd»ss
();

184 
	`check
();

187  -
ENOENT
;

188 
	}
}

191 
	gCamkes_Lš—rIPLookup
::
	$lookup_’Œy
(
IPAdd»ss
 
a
) const

193 
i
 = 0; i < 
_t
.
	`size
(); i++)

194 ià(
_t
[
i
].
	`cÚšs
(
a
)) {

195 
found
 = 
i
;

196 
j
 = 
_t
[
i
].
exŒa
; j < _t.
	`size
(); j++)

197 ià(
_t
[
j
].
	`cÚšs
(
a
è&& _t[j].
	`mask_as_¥ecific
(_t[
found
].
mask
))

198 
found
 = 
j
;

199  
found
;

202 
	}
}

205 
	gCamkes_Lš—rIPLookup
::
	$lookup_rou‹
(
IPAdd»ss
 
a
, IPAdd»s &
gw
) const

207 
ei
 = 
	`lookup_’Œy
(
a
);

208 ià(
ei
 >= 0) {

209 
gw
 = 
_t
[
ei
].gw;

210  
_t
[
ei
].
pÜt
;

213 
	}
}

215 
SŒšg


216 
	gCamkes_Lš—rIPLookup
::
	$dump_rou‹s
()

218 
SŒšgAccum
 
§
;

219 
i
 = 0; i < 
_t
.
	`size
(); i++)

220 ià(
_t
[
i
].
	`»®
())

221 
_t
[
i
].
	`uÅ¬£
(
§
, 
Œue
) << '\n';

222  
§
.
	`ke_¡ršg
();

223 
	}
}

226 
	gCamkes_Lš—rIPLookup
::
	$push
(, 
Pack‘
 *
p
)

228 
	#EXCHANGE
(
a
,
b
,
t
è{ =‡;‡ = b; b =; }

	)

229 
IPAdd»ss
 
a
 = 
p
->
	`d¡__ªno
();

230 
ei
 = -1;

232 
št32_t
 
addr
 = 
a
.
	`addr
();

233 * 
ÿddr
 = (*è&
addr
;

235 ià(
a
 &&‡ =ğ
_Ï¡_addr
)

236 
ei
 = 
_Ï¡_’Œy
;

237 #ifdeà
IP_RT_CACHE2


238 ià(
a
 &&‡ =ğ
_Ï¡_addr2
)

239 
ei
 = 
_Ï¡_’Œy2
;

241 ià((
ei
 = 
	`lookup_’Œy
(
a
)) >= 0) {

242 #ifdeà
IP_RT_CACHE2


243 
_Ï¡_addr2
 = 
_Ï¡_addr
;

244 
_Ï¡_’Œy2
 = 
_Ï¡_’Œy
;

247 
_Ï¡_addr
 = 
a
;

248 
_Ï¡_’Œy
 = 
ei
;

251 
com¶ašed
 = 0;

252 ià(++
com¶ašed
 <= 5)

253 
	`şick_ch©‹r
("Camkes_Lš—rIPLookup:‚Ørou‹ fÜ %s", 
a
.
	`uÅ¬£
().
	`c_¡r
());

254 
p
->
	`kl
();

258 cÚ¡ 
IPRou‹
 &
e
 = 
_t
[
ei
];

259 ià(
e
.
gw
)

260 
p
->
	`£t_d¡__ªno
(
e
.
gw
);

261 ià(
e
.
pÜt
 != 0){

263 
Pack‘
* 
d¡
 = 
»š‹½»t_ÿ¡
<Pack‘*>(&(
_ÿmkes_buf
[
e
.
pÜt
]->
cÚ‹Á
));

264 ((vŞ©
mes§ge_t
*)
_ÿmkes_buf
)->
»ady
);

265 
Camkes_cÚfig
::
	`·ck‘_£rŸlize
(
d¡
,
p
);

266 
p
->
	`kl
();

267 
_ÿmkes_buf
[
e
.
pÜt
]->
»ady
 = 1;

270 
	`ouut
(
e
.
pÜt
).
	`push
(
p
);

272 
	}
}

274 
CLICK_ENDDECLS


275 
	$ELEMENT_REQUIRES
(
Camkes_IPRou‹TabË
)

276 
	`EXPORT_ELEMENT
(
Camkes_Lš—rIPLookup
)

	@camkes_lineariplookup.hh

2 #iâdeà
CLICK_LINEARIPLOOKUP_HH


3 
	#CLICK_LINEARIPLOOKUP_HH


	)

4 
	~"..//rou‹bË.hh
"

5 
	~"pÜ‰y³.h
"

6 
	gCLICK_DECLS


81 
	#IP_RT_CACHE2
 1

	)

83 şas 
	cCamkes_Lš—rIPLookup
 : 
public
 
IPRou‹TabË
 {…ublic:

85 
	$Camkes_Lš—rIPLookup
(è
CLICK_COLD
;

86 
	`Camkes_Lš—rIPLookup
(
mes§ge_t
 **);

87 ~
	$Camkes_Lš—rIPLookup
(è
CLICK_COLD
;

89 
mes§ge_t
 ** 
_ÿmkes_buf
;

91 cÚ¡ *
	$şass_Çme
() const {  "Camkes_LinearIPLookup"; }

92 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

93 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

95 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

97 
	`push
(
pÜt
, 
Pack‘
 *
p
);

99 
	`add_rou‹
(cÚ¡ 
IPRou‹
&, 
boŞ
, IPRou‹*, 
E¼ÜHªdËr
 *);

100 
	`»move_rou‹
(cÚ¡ 
IPRou‹
&, IPRou‹*, 
E¼ÜHªdËr
 *);

101 
	$lookup_rou‹
(
IPAdd»ss
, IPAddress&) const;

102 
SŒšg
 
	`dump_rou‹s
();

104 
boŞ
 
	$check
() const;

106 
´Ùeùed
:

108 
VeùÜ
<
IPRou‹
> 
_t
;

109 
_z”o_rou‹
;

111 
IPAdd»ss
 
_Ï¡_addr
;

112 
_Ï¡_’Œy
;

114 #ifdeà
IP_RT_CACHE2


115 
IPAdd»ss
 
_Ï¡_addr2
;

116 
_Ï¡_’Œy2
;

119 
	$lookup_’Œy
(
IPAdd»ss
) const;

121 
	}
};

123 
	gCLICK_ENDDECLS


	@camkes_lookupiproute.cc

21 
	~<şick/cÚfig.h
>

22 
	~"ÿmkes_lookuprou‹.hh
"

23 
	~<şick/add»ss.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/rou‹r.hh
>

27 
	~<io¡»am
>

28 
CLICK_DECLS


30 
	gCamkes_SticIPLookup
::
	$Camkes_SticIPLookup
(
mes§ge_t
** 
_ÿmkes_buf
):
	$Camkes_Lš—rIPLookup
(
_ÿmkes_buf
){
	}
};

32 
	gCamkes_SticIPLookup
::
	$Camkes_SticIPLookup
()

34 
	}
}

36 
Camkes_SticIPLookup
::~
	$Camkes_SticIPLookup
()

38 
	}
}

41 
Camkes_SticIPLookup
::
	$add_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, 
boŞ
 
£t
, IPRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
 *
”rh
)

44 #ià!
UNDER_CAMKES


45 ià(
	`rou‹r
()->
	`š™Ÿlized
())

46  
”rh
->
	`”rÜ
("can't‡dd„outes dynamically");

49  
Camkes_Lš—rIPLookup
::
	`add_rou‹
(
rou‹
, 
£t
, 
Şd_rou‹
, 
”rh
);

50 
	}
}

53 
	gCamkes_SticIPLookup
::
	$»move_rou‹
(cÚ¡ 
IPRou‹
& 
r
, IPRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
 *
”rh
)

55 ià(
	`rou‹r
()->
	`š™Ÿlized
())

56  
”rh
->
	`”rÜ
("can't„emove„outes dynamically");

58  
Camkes_Lš—rIPLookup
::
	`»move_rou‹
(
r
, 
Şd_rou‹
, 
”rh
);

59 
	}
}

62 
	gCamkes_SticIPLookup
::
	$add_hªdËrs
()

64 
	`add_»ad_hªdËr
("bË", 
bË_hªdËr
);

65 
	`£t_hªdËr
("lookup", 
HªdËr
::
OP_READ
 | HªdËr::
READ_PARAM
, 
lookup_hªdËr
);

66 
	}
}

68 
CLICK_ENDDECLS


69 
	$ELEMENT_REQUIRES
(
Camkes_Lš—rIPLookup
)

70 
	`EXPORT_ELEMENT
(
Camkes_SticIPLookup
)

	@camkes_lookupiproute.hh

2 #iâdeà
CLICK_STATICIPLOOKUP_HH


3 
	#CLICK_STATICIPLOOKUP_HH


	)

4 
	~"ÿmkes_lš—rlookup.hh
"

5 
	~"pÜ‰y³.h
"

6 
CLICK_DECLS


38 şas 
	cCamkes_SticIPLookup
 : 
public
 
Camkes_Lš—rIPLookup
 {…ublic:

40 
	$Camkes_SticIPLookup
(è
CLICK_COLD
;

41 ~
	$Camkes_SticIPLookup
(è
CLICK_COLD
;

43 
	`Camkes_SticIPLookup
(
mes§ge_t
** 
_ÿmkes_buf
);

45 cÚ¡ *
	$şass_Çme
() const {  "Camkes_StaticIPLookup"; }

46 
	$add_hªdËrs
(è
CLICK_COLD
;

48 
	`add_rou‹
(cÚ¡ 
IPRou‹
&, 
boŞ
, IPRou‹*, 
E¼ÜHªdËr
 *);

49 
	`»move_rou‹
(cÚ¡ 
IPRou‹
&, IPRou‹*, 
E¼ÜHªdËr
 *);

51 
	}
};

53 
	gCLICK_ENDDECLS


	@camkes_paint.cc

19 
	~<şick/cÚfig.h
>

20 
	~"ÿmkes_·št.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
	~<io¡»am
>

26 
	~<c¡ršg
>

27 
	~"pÜ‰y³.h
"

28 
	~<şickÃt/.h
>

29 
	~<şick/ÿmkes_cÚfig.hh
>

30 
CLICK_DECLS


32 
	gCamkes_Pašt
::
	$Camkes_Pašt
(){
	}
}

34 
Camkes_Pašt
::
	$Camkes_Pašt
(
mes§ge_t
* 
ÿmkes_buf
):
	$_ÿmkes_buf
(
ÿmkes_buf
){
	}
}

38 
Camkes_Pašt
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40 
	gªno
 = 
PAINT_ANNO_OFFSET
;

41 ià(
Args
(
cÚf
, 
this
, 
”rh
)

42 .
»ad_mp
("COLOR", 
_cŞÜ
)

43 .
»ad_p
("ANNO", 
AÂoArg
(1), 
ªno
).
com¶‘e
() < 0)

45 
	g_ªno
 = 
ªno
;

49 
	gCamkes_Pašt
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

51 
p
 = 
	`sim¶e_aùiÚ
(p);

54 ià(
p
){

56 
Pack‘
* 
d¡
 = 
»š‹½»t_ÿ¡
<Pack‘*>(&(
_ÿmkes_buf
->
cÚ‹Á
));

57 ((vŞ©
mes§ge_t
*)
_ÿmkes_buf
)->
»ady
);

58 
Camkes_cÚfig
::
	`·ck‘_£rŸlize
(
d¡
,
p
);

59 
_ÿmkes_buf
->
»ady
 = 1;

60 
p
->
	`kl
();

63 
	}
}

66 
Pack‘
 *

67 
	gCamkes_Pašt
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

69 
p
->
	`£t_ªno_u8
(
_ªno
, 
_cŞÜ
);

70  
p
;

71 
	}
}

74 
	gCamkes_Pašt
::
	$add_hªdËrs
()

76 
	`add_d©a_hªdËrs
("cŞÜ", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_cŞÜ
);

77 
	}
}

79 
CLICK_ENDDECLS


80 
	$EXPORT_ELEMENT
(
Pašt
)

81 
	`ELEMENT_MT_SAFE
(
Pašt
)

	@camkes_paint.hh

1 #iâdeà
CLICK_PAINT_HH


2 
	#CLICK_PAINT_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<pÜ‰y³.h
>

5 
CLICK_DECLS


29 şas 
	cCamkes_Pašt
 : 
public
 
EËm’t
 {…ublic:

31 
	$Camkes_Pašt
(è
CLICK_COLD
;

32 
mes§ge_t
 *
_ÿmkes_buf
;

33 cÚ¡ *
	$şass_Çme
() const {  "Camkes Paint"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

35 
Camkes_Pašt
(
mes§ge_t
* 
ÿmkes_buf
);

36 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

37 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

38 
	$add_hªdËrs
(è
CLICK_COLD
;

40 
	`push
(
pÜt
, 
Pack‘
 *
p
);

41 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

43 
´iv©e
:

45 
ušt8_t
 
_ªno
;

46 
ušt8_t
 
_cŞÜ
;

48 
	}
};

50 
	gCLICK_ENDDECLS


	@camkes_strip.cc

19 
	~<şick/cÚfig.h
>

20 
	~"ÿmkes_¡r.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<io¡»am
>

25 
	~<şickÃt/.h
>

26 
CLICK_DECLS


28 
	gCamkes_SŒ
::
	$Camkes_SŒ
()

30 
	}
}

33 
Camkes_SŒ
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

35  
Args
(
cÚf
, 
this
, 
”rh
)

36 .
»ad_mp
("LENGTH", 
_nby‹s
)

37 .
»ad_mp
("CAMKES_BUF",(&)
_ÿmkes_buf
)

38 .
»ad_mp
("EVENT_FUNC",(&)
_ev_em™
)

39 .
com¶‘e
();

42 
	gCamkes_SŒ
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

44 
p
 = 
	`sim¶e_aùiÚ
(p);

46 ià(
p
){

48 
	`memıy
(
_ÿmkes_buf
->
cÚ‹Á
,
p
->
	`d©a
(),p->
	`Ëngth
());

49 
_ÿmkes_buf
->
Ën
 = 
p
->
	`Ëngth
();

50 
_ÿmkes_buf
->
»ady
 = 1;

51 
	`_ev_em™
();

54 
	}
}

56 
Pack‘
 *

57 
	gCamkes_SŒ
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

59 
p
->
	`puÎ
(
_nby‹s
);

60  
p
;

61 
	}
}

63 
CLICK_ENDDECLS


64 
	$EXPORT_ELEMENT
(
SŒ
)

65 
	`ELEMENT_MT_SAFE
(
SŒ
)

	@camkes_strip.hh

2 #iâdeà
CLICK_STRIP_HH


3 
	#CLICK_STRIP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<pÜ‰y³.h
>

6 
CLICK_DECLS


22 şas 
	cCamkes_SŒ
 : 
public
 
EËm’t
 {…ublic:

24 
	$Camkes_SŒ
(è
CLICK_COLD
;

26 
mes§ge_t
 *
_ÿmkes_buf
;

27 
ev’tfunc_t
 
_ev_em™
;

28 cÚ¡ *
	$şass_Çme
() const {  "Camkes Strip"; }

29 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

31 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

32 
push
(, 
Pack‘
*);

33 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

35 
	g´iv©e
:

37 
_nby‹s
;

41 
	gCLICK_ENDDECLS


	@camkes_tee.cc

18 
	~<şick/cÚfig.h
>

19 
	~"ÿmkes_‹e.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/ÿmkes_cÚfig.hh
>

23 
CLICK_DECLS


25 
	gCamkes_T“
::
	$Camkes_T“
()

27 
	}
}

29 
Camkes_T“
::
	$Camkes_T“
(
mes§ge_t
 ** 
_ÿmkes_buf
){

30 
this
->
_ÿmkes_buf
 = _camkes_buf;

31 
	}
}

34 
	gCamkes_T“
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
	gn
 = 
nouuts
();

37 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("N", 
n
).
com¶‘e
() < 0)

39 ià(
	gn
 !ğ(è
nouuts
())

40  
”rh
->
”rÜ
("%d ouut im¶› %d‡rms", 
nouuts
(),‚outputs());

45 
	gCamkes_T“
::
	$push
(, 
Pack‘
 *
p
)

47 
n
 = 
	`nouuts
();

48 
i
 = 0; i < 
n
 - 1; i++){

50 
Pack‘
* 
d¡
 = 
»š‹½»t_ÿ¡
<Pack‘*>(&(
_ÿmkes_buf
[
i
]->
cÚ‹Á
));

51 ((vŞ©
mes§ge_t
*)
_ÿmkes_buf
)->
»ady
);

52 
Camkes_cÚfig
::
	`·ck‘_£rŸlize
(
d¡
,
p
);

53 
_ÿmkes_buf
[
i
]->
»ady
 = 1;

55 
p
->
	`kl
();

56 
	}
}

62 
	gPuÎCamkes_T“
::
	$PuÎCamkes_T“
()

64 
	}
}

67 
PuÎCamkes_T“
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

69 
	gn
 = 
nouuts
();

70 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("N", 
n
).
com¶‘e
() < 0)

72 ià(
	gn
 !ğ(è
nouuts
())

73  
”rh
->
”rÜ
("%d ouut im¶› %d‡rms", 
nouuts
(),‚outputs());

77 
Pack‘
 *

78 
	gPuÎCamkes_T“
::
	$puÎ
()

80 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

81 ià(
p
) {

82 
n
 = 
	`nouuts
();

83 
i
 = 1; i < 
n
; i++)

84 ià(
Pack‘
 *
q
 = 
p
->
	`şÚe
())

85 
	`ouut
(
i
).
	`push
(
q
);

87  
p
;

88 
	}
}

90 
CLICK_ENDDECLS


91 
	$EXPORT_ELEMENT
(
Camkes_T“
 
PuÎT“
)

92 
	$ELEMENT_MT_SAFE
(
Camkes_T“
)

93 
	`ELEMENT_MT_SAFE
(
PuÎCamkes_T“
)

	@camkes_tee.hh

1 #iâdeà
CLICK_TEE_HH


2 
	#CLICK_TEE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<pÜ‰y³.h
>

5 
CLICK_DECLS


26 şas 
	cCamkes_T“
 : 
public
 
EËm’t
 {

28 
public
:

30 
	$Camkes_T“
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "Camkes_Tee"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-"; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

35 
Camkes_T“
(
mes§ge_t
 ** 
_ÿmkes_buf
);

36 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

38 
push
(, 
Pack‘
 *);

39 
	g´iv©e
:

40 
mes§ge_t
 ** 
_ÿmkes_buf
;

43 şas 
	cPuÎCamkes_T“
 : 
public
 
EËm’t
 {

45 
public
:

47 
	$PuÎCamkes_T“
(è
CLICK_COLD
;

49 cÚ¡ *
	$şass_Çme
() const {  "PullCamkes_Tee"; }

50 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-"; 
	}
}

51 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "l/lh"; 
	}
}

53 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

55 
Pack‘
 *
puÎ
();

59 
	gCLICK_ENDDECLS


	@../ip/iproutetable.hh

2 #iâdeà
CLICK_IPROUTETABLE_HH


3 
	#CLICK_IPROUTETABLE_HH


	)

4 
	~<şick/glue.hh
>

5 
	~<şick/–em’t.hh
>

6 
CLICK_DECLS


163 
	sIPRou‹
 {

164 
IPAdd»ss
 
	maddr
;

165 
IPAdd»ss
 
	mmask
;

166 
IPAdd»ss
 
	mgw
;

167 
št32_t
 
	mpÜt
;

168 
št32_t
 
	mexŒa
;

170 
IPRou‹
(è: 
pÜt
(-1) { }

171 
IPRou‹
(
IPAdd»ss
 
a
, IPAdd»s 
m
, IPAdd»s 
g
, 
p
)

172 : 
addr
(
a
), 
mask
(
m
), 
gw
(
g
), 
pÜt
(
p
) { }

174 
šlše
 
boŞ
 
»®
(ècÚ¡ {  
	mpÜt
 > (
	mšt32_t
) -0x80000000; }

175 
šlše
 
kl
(è{ 
	maddr
 = 0; 
	mmask
 = 0xFFFFFFFFU; 
	mpÜt
 = -0x80000000; }

176 
šlše
 
boŞ
 
cÚšs
(
IPAdd»ss
 
a
) const;

177 
šlše
 
boŞ
 
cÚšs
(cÚ¡ 
IPRou‹
& 
r
) const;

178 
šlše
 
boŞ
 
mask_as_¥ecific
(
IPAdd»ss
 
m
) const;

179 
šlše
 
boŞ
 
mask_as_¥ecific
(cÚ¡ 
IPRou‹
& 
r
) const;

180 
šlše
 
boŞ
 
m©ch
(cÚ¡ 
IPRou‹
& 
r
) const;

181 
´efix_Ën
(ècÚ¡ {  
	mmask
.
mask_to_´efix_Ën
(); }

183 
	mSŒšgAccum
 &
uÅ¬£
(
SŒšgAccum
&, 
boŞ
 
bs
) const;

184 
SŒšg
 
uÅ¬£
() const;

185 
SŒšg
 
uÅ¬£_addr
(ècÚ¡ {  
	maddr
.
uÅ¬£_w™h_mask
(
mask
); }

188 şas 
	cIPRou‹TabË
 : 
public
 
EËm’t
 {…ublic:

190 * 
ÿ¡
(const *);

191 
cÚfigu»
(
VeùÜ
<
SŒšg
>&, 
E¼ÜHªdËr
*è
	mCLICK_COLD
;

192 
	$add_hªdËrs
(è
CLICK_COLD
;

194 
vœtu®
 
	`add_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, 
boŞ
 
®low_»¶aû
, IPRou‹* 
»¶aûd_rou‹
, 
E¼ÜHªdËr
* 
”rh
);

195 
vœtu®
 
	`»move_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, IPRou‹* 
»moved_rou‹
, 
E¼ÜHªdËr
* 
”rh
);

196 
vœtu®
 
	$lookup_rou‹
(
IPAdd»ss
 
addr
, IPAdd»ss& 
gw
) const = 0;

197 
vœtu®
 
SŒšg
 
	`dump_rou‹s
();

199 
	`push
(
pÜt
, 
Pack‘
* 
p
);

201 
	`add_rou‹_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

202 
	`»move_rou‹_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

203 
	`ù¾_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

204 
	`lookup_hªdËr
(
İ”©iÚ
, 
SŒšg
&, 
EËm’t
*, cÚ¡ 
HªdËr
*, 
E¼ÜHªdËr
*);

205 
SŒšg
 
	`bË_hªdËr
(
EËm’t
*, *);

207 
´iv©e
:

209 ’um { 
CMD_ADD
, 
CMD_SET
, 
CMD_REMOVE
 };

210 
	`run_commªd
(
commªd
, cÚ¡ 
SŒšg
 &, 
VeùÜ
<
IPRou‹
>* 
Şd_rou‹s
, 
E¼ÜHªdËr
*);

212 
	}
};

214 
šlše
 
	gSŒšgAccum
&

215 
	gİ”©Ü
<<(
	gSŒšgAccum
& 
	g§
, cÚ¡ 
	gIPRou‹
& 
	grou‹
)

217  
	grou‹
.
uÅ¬£
(
§
, 
çl£
);

220 
šlše
 
boŞ


221 
	gIPRou‹
::
	$cÚšs
(
IPAdd»ss
 
a
) const

223  
a
.
	`m©ches_´efix
(
addr
, 
mask
);

224 
	}
}

226 
šlše
 
boŞ


227 
	gIPRou‹
::
	$cÚšs
(cÚ¡ 
IPRou‹
& 
r
) const

229  
r
.
addr
.
	`m©ches_´efix
×ddr, 
mask
è&&„.mask.
	`mask_as_¥ecific
(mask);

230 
	}
}

232 
šlše
 
boŞ


233 
	gIPRou‹
::
	$mask_as_¥ecific
(
IPAdd»ss
 
m
) const

235  
mask
.
	`mask_as_¥ecific
(
m
);

236 
	}
}

238 
šlše
 
boŞ


239 
	gIPRou‹
::
	$mask_as_¥ecific
(cÚ¡ 
IPRou‹
& 
r
) const

241  
mask
.
	`mask_as_¥ecific
(
r
.mask);

242 
	}
}

244 
šlše
 
boŞ


245 
	gIPRou‹
::
	$m©ch
(cÚ¡ 
IPRou‹
& 
r
) const

247  
addr
 =ğ
r
.add¸&& 
mask
 ==„.mask

248 && (
pÜt
 < 0 || (
gw
 =ğ
r
.gw &&…ort ==„.port));

249 
	}
}

251 
	gCLICK_ENDDECLS


	@../standard/classification.hh

1 #iâdeà
CLICK_CLASSIFICATION_HH


2 
	#CLICK_CLASSIFICATION_HH
 1

	)

3 
	#CLICK_CLASSIFICATION_WORDWISE_DOMINATOR_FASTPRED
 1

	)

4 
	~<şick/·ck‘.hh
>

5 
	~<şick/veùÜ.hh
>

6 
CLICK_DECLS


7 
şass
 
	gE¼ÜHªdËr
;

8 
Çme¥aû
 
	gCÏssifiÿtiÚ
 {

10 
	eJumps
 {

11 
	gj_Ãv”
 = -2147483647,

12 
	gj_çu»
,

13 
	gj_sucûss


16 
	eCombš”
 {

17 
	gc_ªd
,

18 
	gc_Ü
,

19 
	gc_‹º¬y


23 
	goff£t_max
 = 0x7FFFFFFF

26 
Çme¥aû
 
	gWÜdwi£
 {

28 
şass
 
	gDomš©ÜO±imiz”
;

31 
	sIn¢
 {

32 
ušt16_t
 
	goff£t
;

33 
ušt8_t
 
	g·ddšg
;

34 
ušt8_t
 
	gshÜt_ouut
;

36 
	gc
[4];

37 
ušt32_t
 
	gu
;

38 } 
	gmask
;

40 
	gc
[4];

41 
ušt32_t
 
	gu
;

42 } 
	gv®ue
;

43 
št32_t
 
	gj
[2];

46 
	gwidth
 = 4

49 
In¢
(
off£t_
, 
ušt32_t
 
v®ue_
, ušt32_ˆ
mask_
,

50 
št32_t
 
çu»_
 = 
j_çu»
, iÁ32_ˆ
sucûss_
 = 
j_sucûss
,

51 
boŞ
 
shÜt_ouut_
 = 
çl£
)

52 : 
off£t
(
off£t_
), 
·ddšg
(0), 
shÜt_ouut
(
shÜt_ouut_
) {

53 
	gmask
.
	gu
 = 
mask_
;

54 
	gv®ue
.
	gu
 = 
v®ue_
 & 
mask_
;

55 
	gj
[0] = 
çu»_
;

56 
	gj
[1] = 
sucûss_
;

59 
št32_t
 
yes
(ècÚ¡ {  
	gj
[1]; }

60 
št32_t
 
no
(ècÚ¡ {  
	gj
[0]; }

62 
£t_yes
(
d¡
è{ 
	gj
[1] = dst; }

63 
£t_no
(
d¡
è{ 
	gj
[0] = dst; }

65 
»quœed_Ëngth
() const {

66 ià(
	gmask
.
	gu
 == 0)

68 ià(
	gmask
.
	gc
[3])

69  
	goff£t
 + 4;

70 ià(
	gmask
.
	gc
[2])

71  
	goff£t
 + 3;

72 ià(
	gmask
.
	gc
[1])

73  
	goff£t
 + 2;

75  
	goff£t
 + 1;

81 
boŞ
 
im¶›s
(cÚ¡ 
In¢
 &
x
, 
known_Ëngth
) const;

89 
boŞ
 
nÙ_im¶›s
(cÚ¡ 
In¢
 &
x
, 
known_Ëngth
) const;

93 
boŞ
 
im¶›s_nÙ
(cÚ¡ 
In¢
 &
x
, 
known_Ëngth
) const;

98 
boŞ
 
nÙ_im¶›s_nÙ
(cÚ¡ 
In¢
 &
x
, 
known_Ëngth
) const;

105 
boŞ
 
com·tibË
(cÚ¡ 
In¢
 &
x
, boŞ 
cÚsid”_shÜt
) const;

111 
boŞ
 
g’”®izabË_Ü_·œ
(cÚ¡ 
In¢
 &
x
) const;

117 
boŞ
 
æ·bË
() const;

120 
æ
();

124 
In¢
 
off£t_by
(
off£t
) const {

125 
In¢
 
	gi
 = *
this
;

126 
	gk
 = 0; k < 2; ++k)

127 ià(
	gi
.
	gj
[
k
] > 0)

128 
	gi
.
	gj
[
k
] +ğ
off£t
;

129  
	gi
;

132 
SŒšg
 
uÅ¬£
() const;

134 
com·»
(cÚ¡ 
In¢
 &
a
, cÚ¡ In¢ &
b
) {

135  
memcmp
(&
a
, &
b
, 12);

138 
	g´iv©e
:

140 
šlše
 
boŞ
 
im¶›s_shÜt_ok
(boŞ 
dœeùiÚ
, cÚ¡ 
In¢
 &
x
, boŞ 
Ãxt_dœeùiÚ
, 
known_Ëngth
) const {

142 ià(
	gshÜt_ouut
 !ğ
dœeùiÚ
 || 
off£t
 + 4 <ğ(è
known_Ëngth
)

143  
Œue
;

145  
h¬d_im¶›s_shÜt_ok
(
dœeùiÚ
, 
x
, 
Ãxt_dœeùiÚ
, 
known_Ëngth
);

148 
boŞ
 
h¬d_im¶›s_shÜt_ok
(boŞ 
dœeùiÚ
, cÚ¡ 
In¢
 &
x
, boŞ 
Ãxt_dœeùiÚ
, 
known_Ëngth
) const;

152 
	gSŒšgAccum
 &
	gİ”©Ü
<<(SŒšgAccum &
	g§
, cÚ¡ 
	gIn¢
 &
	gš¢
);

155 şas 
	cProg¿m
 { 
	gpublic
:

157 
Prog¿m
(
®ign_off£t
 = 0)

158 : 
_ouut_ev”ythšg
(-
j_Ãv”
), 
_§ã_Ëngth
(() -1),

159 
_®ign_off£t
(
®ign_off£t
) {

162 
®ign_off£t
() const {

163  
	g_®ign_off£t
;

165 
ouut_ev”ythšg
() const {

166  
	g_ouut_ev”ythšg
;

168 
§ã_Ëngth
() const {

169  
	g_§ã_Ëngth
;

172 
nš¢
() const {

173  
	g_š¢
.
size
();

175 cÚ¡ 
	gIn¢
 &
š¢
(
i
) const {

176  
	g_š¢
[
i
];

178 cÚ¡ 
In¢
 *
begš
() const {

179  
	g_š¢
.
begš
();

181 cÚ¡ 
In¢
 *
’d
() const {

182  
	g_š¢
.
’d
();

185 
	gIn¢
 &
back
() {

186  
	g_š¢
.
back
();

189 
add_š¢
(
VeùÜ
<> &
Œ“
, 
off£t
, 
ušt32_t
 
v®ue
, ušt32_ˆ
mask
);

191 
	gVeùÜ
<> 
š™_subŒ“
() const;

192 
¡¬t_subŒ“
(
VeùÜ
<> &
Œ“
) const;

198 
Ãg©e_subŒ“
(
VeùÜ
<> &
Œ“
, 
boŞ
 
æ_shÜt
 = 
çl£
);

199 
šlše
 
fšish_subŒ“
(
VeùÜ
<>& 
Œ“
, 
Combš”
 
İ
) {

200 
fšish_subŒ“
(
Œ“
, 
İ
, 
j_sucûss
, 
j_çu»
);

202 
fšish_subŒ“
(
VeùÜ
<>& 
Œ“
, 
Combš”
 
İ
, 
sucûss
, 
çu»
);

204 
£t_çu»
(
çu»
);

205 
add_Ü_´og¿m
(cÚ¡ 
Prog¿m
& 
Ãxt_´og¿m
);

207 
combše_com·tibË_¡©es
();

208 
»move_unu£d_¡©es
();

209 
uÇligÃd_İtimize
();

210 
couÁ_šb¿nches
(
VeùÜ
<> &
šb¿nches
) const;

211 
bubbË_sÜt_ªd_ex´s
(cÚ¡ *
off£t_m­_begš
, cÚ¡ *
off£t_m­_’d
, 
Ï¡_off£t
);

212 
İtimize
(cÚ¡ *
off£t_m­_begš
, cÚ¡ *
off£t_m­_’d
, 
Ï¡_off£t
);

214 
w¬n_unu£d_ouuts
(
nouuts
, 
E¼ÜHªdËr
 *
”rh
) const;

216 
m©ch
(cÚ¡ 
Pack‘
 *
p
);

218 
SŒšg
 
uÅ¬£
() const;

220 
	g´iv©e
:

222 
VeùÜ
<
In¢
> 
_š¢
;

223 
	g_ouut_ev”ythšg
;

224 
	g_§ã_Ëngth
;

225 
	g_®ign_off£t
;

227 
»dœeù_subŒ“
(
fœ¡
, 
Ãxt
, 
sucûss
, 
çu»
);

229 
Ëngth_checked_m©ch
(cÚ¡ 
Pack‘
 *
p
);

230 
šlše
 
m­_off£t
(
off£t
, cÚ¡ *
begš
, cÚ¡ *
’d
);

231 
h¬d_m­_off£t
(
off£t
, cÚ¡ *
begš
, cÚ¡ *
’d
);

233 
ä›nd
 
şass
 
	gDomš©ÜO±imiz”
;

238 şas 
	cCom´es£dProg¿m
 { 
	gpublic
:

240 
Com´es£dProg¿m
()

241 : 
_ouut_ev”ythšg
(-
j_Ãv”
), 
_§ã_Ëngth
(() -1),

242 
_®ign_off£t
(0) {

245 
®ign_off£t
() const {

246  
	g_®ign_off£t
;

248 
ouut_ev”ythšg
() const {

249  
	g_ouut_ev”ythšg
;

251 
§ã_Ëngth
() const {

252  
	g_§ã_Ëngth
;

255 cÚ¡ 
ušt32_t
 *
begš
() const {

256  
	g_z´og
.
begš
();

258 cÚ¡ 
ušt32_t
 *
’d
() const {

259  
	g_z´og
.
’d
();

262 
compe
(cÚ¡ 
Prog¿m
 &
´og
, 
boŞ
 
³rfÜm_bš¬y_£¬ch
,

263 
mš_bš¬y_£¬ch
);

265 
w¬n_unu£d_ouuts
(
nouuts
, 
E¼ÜHªdËr
 *
”rh
) const;

267 
SŒšg
 
uÅ¬£
() const;

269 
	g´iv©e
:

271 
VeùÜ
<
ušt32_t
> 
_z´og
;

272 
	g_ouut_ev”ythšg
;

273 
	g_§ã_Ëngth
;

274 
	g_®ign_off£t
;

279 şas 
	cDomš©ÜO±imiz”
 { 
	gpublic
:

281 
Domš©ÜO±imiz”
(
Prog¿m
 *
p
);

283 
bºo
(
¡©e
, 
boŞ
 
br
è{  (
	g¡©e
 << 1è+ 
	gbr
; }

284 
¡©’o
(
bºo
è{  
	gbºo
 >> 1; }

285 
boŞ
 
br_yes
(
bºo
è{  
	gbºo
 & 1; }

287 
boŞ
 
br_im¶›s
(
bºo
, 
¡©e
) const {

288 
as£¹
(
¡©e
 > 0);

289 
	gäom_¡©e
 = 
¡©’o
(
bºo
);

290 
	gkl
 = 
_known_Ëngth
[
äom_¡©e
];

291 ià(
br_yes
(
bºo
))

292  
š¢
(
äom_¡©e
).
im¶›s
(š¢(
¡©e
), 
kl
);

294  
š¢
(
äom_¡©e
).
nÙ_im¶›s
(š¢(
¡©e
), 
kl
);

297 
boŞ
 
br_im¶›s_nÙ
(
bºo
, 
¡©e
) const {

298 
as£¹
(
¡©e
 > 0);

299 
	gäom_¡©e
 = 
¡©’o
(
bºo
);

300 
	gkl
 = 
_known_Ëngth
[
äom_¡©e
];

301 ià(
br_yes
(
bºo
))

302  
š¢
(
äom_¡©e
).
im¶›s_nÙ
(š¢(
¡©e
), 
kl
);

304  
š¢
(
äom_¡©e
).
nÙ_im¶›s_nÙ
(š¢(
¡©e
), 
kl
);

307 
run
(
¡©e
);

309 
´št
();

311 
	g´iv©e
:

313 
Prog¿m
 *
_p
;

314 
	gVeùÜ
<> 
	g_known_Ëngth
;

315 
	gVeùÜ
<> 
	g_š¢_id
;

316 
	gVeùÜ
<> 
	g_dom
;

317 
	gVeùÜ
<> 
	g_dom_¡¬t
;

318 
	gVeùÜ
<> 
	g_domli¡_¡¬t
;

319 #ià
CLICK_CLASSIFICATION_WORDWISE_DOMINATOR_FASTPRED


320 
mubË
 
	gVeùÜ
<> 
	g_´ed_fœ¡
;

321 
mubË
 
	gVeùÜ
<> 
	g_´ed_Ãxt
;

322 
mubË
 
	gVeùÜ
<> 
	g_´ed_´ev
;

325 ’um { 
	gMAX_DOMLIST
 = 4 };

327 
	gIn¢
 &
š¢
(
¡©e
) const {

328  
	g_p
->
	g_š¢
[
¡©e
];

330 
nš¢
() const {

331  
	g_p
->
	g_š¢
.
size
();

334 
š‹r£ù_li¡s
(cÚ¡ 
VeùÜ
<> &, cÚ¡ VeùÜ<> &, cÚ¡ VeùÜ<> &, 
pos1
, 
pos2
, Vector<> &);

335 
Ï¡_commÚ_¡©e_š_li¡s
(cÚ¡ 
VeùÜ
<> &, const Vector<> &, const Vector<> &);

336 
fšd_´edeûssÜs
(
¡©e
, 
VeùÜ
<> &) const;

337 
dom_shiá_b¿nch
(
bºo
, 
to_¡©e
, 
dom
, 
dom_’d
, 
VeùÜ
<> *
cŞËùÜ
);

338 
shiá_b¿nch
(
¡©e
, 
boŞ
 
b¿nch
);

339 
ÿlcuÏ‹_dom
(
¡©e
);

341 
šlše
 
£t_b¿nch
(
äom_¡©e
, 
boŞ
 
b¿nch
, 
to_¡©e
) {

342 
	gIn¢
 &
	gš
 = 
š¢
(
äom_¡©e
);

343 #ià
CLICK_CLASSIFICATION_WORDWISE_DOMINATOR_FASTPRED


344 
	gbr
 = 
bºo
(
äom_¡©e
, 
b¿nch
);

345 ià(
	gš
.
	gj
[
b¿nch
] > 0) {

346 ià(
	g_´ed_´ev
[
br
] >= 0)

347 
_´ed_Ãxt
[
_´ed_´ev
[
br
]] = _pred_next[br];

349 
	g_´ed_fœ¡
[
š
.
j
[
b¿nch
]] = 
_´ed_Ãxt
[
br
];

350 ià(
	g_´ed_Ãxt
[
br
] >= 0)

351 
_´ed_´ev
[
_´ed_Ãxt
[
br
]] = _pred_prev[br];

353 ià(
	gto_¡©e
 > 0) {

354 
	g´ev
 = -1, *
	g²ext
 = &
_´ed_fœ¡
[
to_¡©e
];

355 *
	g²ext
 >ğ0 && *
²ext
 < 
br
) {

356 
´ev
 = *
²ext
;

357 
	g²ext
 = &
_´ed_Ãxt
[*
²ext
];

359 
	g_´ed_´ev
[
br
] = 
´ev
;

360 
	g_´ed_Ãxt
[
br
] = *
²ext
;

361 *
	g²ext
 = 
br
;

362 ià(
	g_´ed_Ãxt
[
br
] >= 0)

363 
_´ed_´ev
[
_´ed_Ãxt
[
br
]] = br;

366 
	gš
.
	gj
[
b¿nch
] = 
to_¡©e
;

372 
šlše
 

373 
	gProg¿m
::
m©ch
(cÚ¡ 
Pack‘
 *
p
)

375 ià(
_ouut_ev”ythšg
 >= 0)

376  
_ouut_ev”ythšg
;

377 ià(
	gp
->
Ëngth
(è< 
	g_§ã_Ëngth
)

379  
Ëngth_checked_m©ch
(
p
);

381 cÚ¡ *
	g·ck‘_d©a
 = 
p
->
d©a
(è- 
_®ign_off£t
;

382 
	gpos
 = 0;

383 
In¢
 *
	gex
 = &
_š¢
[0];

386 
ušt32_t
 
	gd©a
 = *((cÚ¡ ušt32_ˆ*)(
·ck‘_d©a
 + 
ex
[
pos
].
off£t
));

387 
	gd©a
 &ğ
ex
[
pos
].
mask
.
u
;

388 
	gpos
 = 
ex
[
pos
].
j
[
d©a
 =ğex[pos].
v®ue
.
u
];

389 } 
	gpos
 > 0);

391  -
	gpos
;

395 
	gCLICK_ENDDECLS


	@
1
.
1
/usr/include
18
370
camkes_classifier.cc
camkes_classifier.hh
camkes_icmperror.cc
camkes_icmperror.hh
camkes_iproutetable.cc
camkes_iproutetable.hh
camkes_lineariplookup.cc
camkes_lineariplookup.hh
camkes_lookupiproute.cc
camkes_lookupiproute.hh
camkes_paint.cc
camkes_paint.hh
camkes_strip.cc
camkes_strip.hh
camkes_tee.cc
camkes_tee.hh
../ip/iproutetable.hh
../standard/classification.hh
