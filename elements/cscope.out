cscope 15 /thesis/camkes-rumprun/projects/camkes/apps/click_scratch/elements               0003601290
	@analysis/adjusttimestamp.cc

18 
	~<şick/cÚfig.h
>

19 
	~"adju¡time¡amp.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/·ck‘_ªno.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gAdju¡Time¡amp
::
	$Adju¡Time¡amp
()

27 
	}
}

29 
Adju¡Time¡amp
::~
	$Adju¡Time¡amp
()

31 
	}
}

34 
Adju¡Time¡amp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
	g_fœ¡
 = 
_®l
 = 
çl£
;

37 
	g_ts
.
ş—r
();

38  
Args
(
cÚf
, 
this
, 
”rh
)

39 .
»ad_p
("TIME", 
Time¡ampArg
(
Œue
), 
_ts
)

40 .
»ad
("FIRST", 
_fœ¡
)

41 .
»ad
("ALL", 
_®l
).
com¶‘e
();

44 
Pack‘
 *

45 
	gAdju¡Time¡amp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

47 
Time¡amp
 *
ts
;

48 ià(!
_fœ¡
)

49 
ts
 = &
p
->
	`time¡amp_ªno
();

51 
ts
 = &
	`FIRST_TIMESTAMP_ANNO
(
p
);

52 ià(*
ts
 || 
_®l
)

53 *
ts
 +ğ
_ts
;

54  
p
;

55 
	}
}

58 
	gAdju¡Time¡amp
::
	$add_hªdËrs
()

60 
	`add_d©a_hªdËrs
("time", 
HªdËr
::
f_»ad
 | HªdËr::
f_wr™e
, &
_ts
, 
Œue
);

61 
	}
}

63 
CLICK_ENDDECLS


64 
EXPORT_ELEMENT
(
Adju¡Time¡amp
)

	@analysis/adjusttimestamp.hh

2 #iâdeà
CLICK_ADJUSTTIMESTAMP_HH


3 
	#CLICK_ADJUSTTIMESTAMP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


43 şas 
	cAdju¡Time¡amp
 : 
public
 
EËm’t
 {…ublic:

45 
	$Adju¡Time¡amp
(è
CLICK_COLD
;

46 ~
	$Adju¡Time¡amp
(è
CLICK_COLD
;

48 cÚ¡ *
	$şass_Çme
() const {  "AdjustTimestamp"; }

49 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

50 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

51 
	$add_hªdËrs
(è
CLICK_COLD
;

53 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

55 
´iv©e
:

57 
boŞ
 
_fœ¡
;

58 
boŞ
 
_®l
;

59 
Time¡amp
 
_ts
;

61 
	}
};

63 
	gCLICK_ENDDECLS


	@analysis/aggcounter.cc

18 
	~<şick/cÚfig.h
>

19 
	~"aggcouÁ”.hh
"

20 
	~<şick/hªdËrÿÎ.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
	~<şick/š‹g”s.hh
>

25 
	~<şick/rou‹r.hh
>

26 
CLICK_DECLS


28 
	gAgg»g©eCouÁ”
::
	$Agg»g©eCouÁ”
()

29 : 
	`_roÙ
(0), 
	`_ä“
(0), 
	`_ÿÎ_Âz_h
(0), 
	$_ÿÎ_couÁ_h
(0)

31 
	}
}

33 
	gAgg»g©eCouÁ”
::~
	$Agg»g©eCouÁ”
()

35 
	}
}

37 
Agg»g©eCouÁ”
::
Node
 *

38 
Agg»g©eCouÁ”
::
	$Ãw_node_block
()

40 
	`as£¹
(!
_ä“
);

41 
block_size
 = 1024;

42 
Node
 *
block
 = 
Ãw
 Node[
block_size
];

43 ià(!
block
)

45 
_blocks
.
	`push_back
(
block
);

46 
i
 = 1; i < 
block_size
 - 1; i++)

47 
block
[
i
].
chd
[0] = &block[i+1];

48 
block
[
block_size
 - 1].
chd
[0] = 0;

49 
_ä“
 = &
block
[1];

50  &
block
[0];

51 
	}
}

54 
	gAgg»g©eCouÁ”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

56 
boŞ
 
	gby‹s
 = 
çl£
;

57 
boŞ
 
	g_by‹s
 = 
çl£
;

58 
boŞ
 
	g·ck‘_couÁ
 = 
Œue
;

59 
boŞ
 
	gexŒa_Ëngth
 = 
Œue
;

60 
ušt32_t
 
	gä“ze_Âz
, 
	g¡İ_Âz
;

61 
ušt64_t
 
	gä“ze_couÁ
, 
	g¡İ_couÁ
;

62 
SŒšg
 
	gÿÎ_Âz
, 
	gÿÎ_couÁ
;

63 
	gä“ze_Âz
 = 
¡İ_Âz
 = 
_ÿÎ_Âz
 = (
ušt32_t
)(-1);

64 
	gä“ze_couÁ
 = 
¡İ_couÁ
 = 
_ÿÎ_couÁ
 = (
ušt64_t
)(-1);

66 ià(
Args
(
cÚf
, 
this
, 
”rh
)

67 .
»ad
("BYTES", 
by‹s
)

68 .
»ad
("IP_BYTES", 
_by‹s
)

69 .
»ad
("MULTIPACKET", 
·ck‘_couÁ
)

70 .
»ad
("EXTRA_LENGTH", 
exŒa_Ëngth
)

71 .
»ad
("AGGREGATE_FREEZE", 
ä“ze_Âz
)

72 .
»ad
("COUNT_FREEZE", 
ä“ze_couÁ
)

73 .
»ad
("AGGREGATE_STOP", 
¡İ_Âz
)

74 .
»ad
("COUNT_STOP", 
¡İ_couÁ
)

75 .
»ad
("AGGREGATE_CALL", 
AnyArg
(), 
ÿÎ_Âz
)

76 .
»ad
("COUNT_CALL", 
AnyArg
(), 
ÿÎ_couÁ
)

77 .
»ad
("BANNER", 
_ouut_bªÃr
).
com¶‘e
() < 0)

80 
	g_by‹s
 = 
by‹s
;

81 
	g__by‹s
 = 
_by‹s
;

82 
	g_u£_·ck‘_couÁ
 = 
·ck‘_couÁ
;

83 
	g_u£_exŒa_Ëngth
 = 
exŒa_Ëngth
;

85 ià((
	gä“ze_Âz
 !ğ(
ušt32_t
)(-1)è+ (
¡İ_Âz
 !ğ(ušt32_t)(-1)è+ ((
boŞ
)
ÿÎ_Âz
) > 1)

86  
”rh
->
”rÜ
("'AGGREGATE_FREEZE', 'AGGREGATE_STOP',‡nd 'AGGREGATE_CALL'‡re mutuallyƒxclusive");

87 ià(
	gä“ze_Âz
 !ğ(
ušt32_t
)(-1)) {

88 
_ÿÎ_Âz
 = 
ä“ze_Âz
;

89 
	g_ÿÎ_Âz_h
 = 
Ãw
 
HªdËrC®l
(
Çme
() + ".freezerue");

90 } ià(
	g¡İ_Âz
 !ğ(
ušt32_t
)(-1)) {

91 
_ÿÎ_Âz
 = 
¡İ_Âz
;

92 
	g_ÿÎ_Âz_h
 = 
Ãw
 
HªdËrC®l
(
Çme
() + ".stop");

93 } ià(
	gÿÎ_Âz
) {

94 ià(!
IÁArg
().
·r£
(
ı_shiá_¥aûvec
(
ÿÎ_Âz
), 
_ÿÎ_Âz
))

95  
	g”rh
->
”rÜ
("AGGREGATE_CALL first word should be unsigned (number of‡ggregates)");

96 
	g_ÿÎ_Âz_h
 = 
Ãw
 
HªdËrC®l
(
ÿÎ_Âz
);

99 ià((
	gä“ze_couÁ
 !ğ(
ušt64_t
)(-1)è+ (
¡İ_couÁ
 !ğ(ušt64_t)(-1)è+ ((
boŞ
)
ÿÎ_couÁ
) > 1)

100  
”rh
->
”rÜ
("'COUNT_FREEZE', 'COUNT_STOP',‡nd 'COUNT_CALL'‡re mutuallyƒxclusive");

101 ià(
	gä“ze_couÁ
 !ğ(
ušt64_t
)(-1)) {

102 
_ÿÎ_couÁ
 = 
ä“ze_couÁ
;

103 
	g_ÿÎ_couÁ_h
 = 
Ãw
 
HªdËrC®l
(
Çme
() + ".freezerue");

104 } ià(
	g¡İ_couÁ
 !ğ(
ušt64_t
)(-1)) {

105 
_ÿÎ_couÁ
 = 
¡İ_couÁ
;

106 
	g_ÿÎ_couÁ_h
 = 
Ãw
 
HªdËrC®l
(
Çme
() + ".stop");

107 } ià(
	gÿÎ_couÁ
) {

108 ià(!
IÁArg
().
·r£
(
ı_shiá_¥aûvec
(
ÿÎ_couÁ
), 
_ÿÎ_couÁ
))

109  
	g”rh
->
”rÜ
("COUNT_CALL first word should be unsigned (count)");

110 
	g_ÿÎ_couÁ_h
 = 
Ãw
 
HªdËrC®l
(
ÿÎ_couÁ
);

117 
	gAgg»g©eCouÁ”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

119 ià(
_ÿÎ_Âz_h
 && _ÿÎ_Âz_h->
	`š™Ÿlize_wr™e
(
this
, 
”rh
) < 0)

121 ià(
_ÿÎ_couÁ_h
 && _ÿÎ_couÁ_h->
	`š™Ÿlize_wr™e
(
this
, 
”rh
) < 0)

124 ià(
	`ş—r
(
”rh
) < 0)

127 
_äoz’
 = 
çl£
;

128 
_aùive
 = 
Œue
;

130 
	}
}

133 
	gAgg»g©eCouÁ”
::
	$ş—nup
(
CËªupSge
)

135 
i
 = 0; i < 
_blocks
.
	`size
(); i++)

136 
d–‘e
[] 
_blocks
[
i
];

137 
_blocks
.
	`ş—r
();

138 
d–‘e
 
_ÿÎ_Âz_h
;

139 
d–‘e
 
_ÿÎ_couÁ_h
;

140 
_ÿÎ_Âz_h
 = 
_ÿÎ_couÁ_h
 = 0;

141 
	}
}

143 
	gAgg»g©eCouÁ”
::
Node
 *

144 
Agg»g©eCouÁ”
::
	$make_³”
(
ušt32_t
 
a
, 
Node
 *
n
, 
boŞ
 
äoz’
)

152 ià(
äoz’
)

155 
Node
 *
down
[2];

156 ià(!(
down
[0] = 
	`Ãw_node
()))

158 ià(!(
down
[1] = 
	`Ãw_node
())) {

159 
	`ä“_node
(
down
[0]);

164 
swiv–
 = 
	`ffs_msb
(
a
 ^ 
n
->
agg»g©e
);

166 
b™v®ue
 = (
a
 >> (32 - 
swiv–
)) & 1;

168 
ušt32_t
 
mask
 = (
swiv–
 == 1 ? 0 : (0xFFFFFFFFU << (33 - swivel)));

170 
down
[
b™v®ue
]->
agg»g©e
 = 
a
;

171 
down
[
b™v®ue
]->
couÁ
 = 0;

172 
down
[
b™v®ue
]->
chd
[0] = down[bitvalue]->child[1] = 0;

174 *
down
[1 - 
b™v®ue
] = *
n
;

176 
n
->
agg»g©e
 = (
down
[0]->agg»g©& 
mask
);

177 ià(
down
[0]->
agg»g©e
 =ğ
n
->aggregate) {

178 
n
->
couÁ
 = 
down
[0]->count;

179 
down
[0]->
couÁ
 = 0;

181 
n
->
couÁ
 = 0;

182 
n
->
chd
[0] = 
down
[0];

183 
n
->
chd
[1] = 
down
[1];

185  (
n
->
agg»g©e
 =ğ
a
 ?‚ : 
down
[
b™v®ue
]);

186 
	}
}

188 
	gAgg»g©eCouÁ”
::
Node
 *

189 
Agg»g©eCouÁ”
::
	$fšd_node
(
ušt32_t
 
a
, 
boŞ
 
äoz’
)

192 
Node
 *
n
 = 
_roÙ
;

193 
n
) {

194 ià(
n
->
agg»g©e
 =ğ
a
)

195  (
n
->
couÁ
 || !
äoz’
 ?‚ : 0);

196 ià(!
n
->
chd
[0])

197 
n
 = 
	`make_³”
(
a
,‚, 
äoz’
);

200 
swiv–
 = 
	`ffs_msb
(
n
->
chd
[0]->
agg»g©e
 ^‚->child[1]->aggregate);

201 ià(
	`ffs_msb
(
a
 ^ 
n
->
agg»g©e
è< 
swiv–
)

202 
n
 = 
	`make_³”
(
a
,‚, 
äoz’
);

203 ià(
a
 & (1 << (32 - 
swiv–
)))

204 
n
 =‚->
chd
[1];

206 
n
 =‚->
chd
[0];

210 ià(!
äoz’
)

211 
	`şick_ch©‹r
("AggregateCounter: out of memory!");

213 
	}
}

215 
šlše
 
boŞ


216 
	gAgg»g©eCouÁ”
::
	$upd©e
(
Pack‘
 *
p
, 
boŞ
 
äoz’
)

218 ià(!
_aùive
)

219  
çl£
;

222 
ušt32_t
 
agg
 = 
	`AGGREGATE_ANNO
(
p
);

223 
Node
 *
n
 = 
	`fšd_node
(
agg
, 
äoz’
);

224 ià(!
n
)

225  
çl£
;

227 
ušt32_t
 
amouÁ
;

228 ià(!
_by‹s
)

229 
amouÁ
 = 1 + (
_u£_·ck‘_couÁ
 ? 
	`EXTRA_PACKETS_ANNO
(
p
) : 0);

231 
amouÁ
 = 
p
->
	`Ëngth
(è+ (
_u£_exŒa_Ëngth
 ? 
	`EXTRA_LENGTH_ANNO
(p) : 0);

232 ià(
__by‹s
 && 
p
->
	`has_ÃtwÜk_h—d”
())

233 
amouÁ
 -ğ
p
->
	`ÃtwÜk_h—d”_off£t
();

237 ià(
amouÁ
 && !
n
->
couÁ
) {

238 ià(
_num_nÚz”o
 >ğ
_ÿÎ_Âz
) {

239 
_ÿÎ_Âz
 = (
ušt32_t
)(-1);

240 
_ÿÎ_Âz_h
->
	`ÿÎ_wr™e
();

242  
	`upd©e
(
p
, 
äoz’
 || 
_äoz’
);

244 
_num_nÚz”o
++;

247 
n
->
couÁ
 +ğ
amouÁ
;

248 
_couÁ
 +ğ
amouÁ
;

249 ià(
_couÁ
 >ğ
_ÿÎ_couÁ
) {

250 
_ÿÎ_couÁ
 = (
ušt64_t
)(-1);

251 
_ÿÎ_couÁ_h
->
	`ÿÎ_wr™e
();

253  
Œue
;

254 
	}
}

257 
	gAgg»g©eCouÁ”
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

259 
pÜt
 = !
	`upd©e
(
p
, 
_äoz’
 || (port == 1));

260 
	`ouut
(
	`nouuts
(è=ğ1 ? 0 : 
pÜt
).
	`push
(
p
);

261 
	}
}

263 
Pack‘
 *

264 
	gAgg»g©eCouÁ”
::
	$puÎ
(
pÜt
)

266 
Pack‘
 *
p
 = 
	`šput
(
	`nšputs
(è=ğ1 ? 0 : 
pÜt
).
	`puÎ
();

267 ià(
p
 && 
_aùive
)

268 
	`upd©e
(
p
, 
_äoz’
 || (
pÜt
 == 1));

269  
p
;

270 
	}
}

276 
	gAgg»g©eCouÁ”
::
	$ş—r_node
(
Node
 *
n
)

278 ià(
n
->
chd
[0]) {

279 
	`ş—r_node
(
n
->
chd
[0]);

280 
	`ş—r_node
(
n
->
chd
[1]);

282 
	`ä“_node
(
n
);

283 
	}
}

286 
	gAgg»g©eCouÁ”
::
	$ş—r
(
E¼ÜHªdËr
 *
”rh
)

288 ià(
_roÙ
)

289 
	`ş—r_node
(
_roÙ
);

291 ià(!(
_roÙ
 = 
	`Ãw_node
())) {

292 ià(
”rh
)

293 
”rh
->
	`”rÜ
("out of memory!");

296 
_roÙ
->
agg»g©e
 = 0;

297 
_roÙ
->
couÁ
 = 0;

298 
_roÙ
->
chd
[0] = _root->child[1] = 0;

299 
_num_nÚz”o
 = 0;

300 
_couÁ
 = 0;

302 
	}
}

306 
	gAgg»g©eCouÁ”
::
	$»agg»g©e_node
(
Node
 *
n
)

308 
Node
 *
l
 = 
n
->
chd
[0], *
r
 =‚->child[1];

309 
ušt32_t
 
couÁ
 = 
n
->count;

310 
	`ä“_node
(
n
);

312 ià((
n
 = 
	`fšd_node
(
couÁ
, 
çl£
))) {

313 ià(!
n
->
couÁ
)

314 
_num_nÚz”o
++;

315 
n
->
couÁ
++;

316 
_couÁ
++;

319 ià(
l
) {

320 
	`»agg»g©e_node
(
l
);

321 
	`»agg»g©e_node
(
r
);

323 
	}
}

326 
	gAgg»g©eCouÁ”
::
	$»agg»g©e_couÁs
()

328 
Node
 *
Şd_roÙ
 = 
_roÙ
;

329 
_roÙ
 = 0;

330 
	`ş—r
();

331 
	`»agg»g©e_node
(
Şd_roÙ
);

332 
	}
}

338 
	$wr™e_b©ch
(
FILE
 *
f
, 
Agg»g©eCouÁ”
::
Wr™eFÜm©
 
fÜm©
,

339 
ušt32_t
 *
bufãr
, 
pos
, 
couÁ
, 
E¼ÜHªdËr
 *)

341 ià(
fÜm©
 =ğ
Agg»g©eCouÁ”
::
WR_BINARY
)

342 
	`ignÜe_»suÉ
(
	`fwr™e
(
bufãr
, (
ušt32_t
), 
pos
, 
f
));

343 ià(
fÜm©
 =ğ
Agg»g©eCouÁ”
::
WR_TEXT_IP
)

344 
i
 = 0; i < 
pos
; i += 2)

345 
	`årštf
(
f
, "%d.%d.%d.%d %u\n", (
bufãr
[
i
] >> 24) & 255, (buffer[i] >> 16) & 255, (buffer[i] >> 8) & 255, buffer[i] & 255, buffer[i+1]);

346 ià(
fÜm©
 =ğ
Agg»g©eCouÁ”
::
WR_TEXT_PDF
)

347 
i
 = 0; i < 
pos
; i += 2)

348 
	`årštf
(
f
, "%u %.12g\n", 
bufãr
[
i
], bufãr[i+1] / 
couÁ
);

349 ià(
fÜm©
 =ğ
Agg»g©eCouÁ”
::
WR_TEXT
)

350 
i
 = 0; i < 
pos
; i += 2)

351 
	`årštf
(
f
, "%u %u\n", 
bufãr
[
i
], buffer[i+1]);

352 
	}
}

355 
	gAgg»g©eCouÁ”
::
	$wr™e_nodes
(
Node
 *
n
, 
FILE
 *
f
, 
Wr™eFÜm©
 
fÜm©
,

356 
ušt32_t
 *
bufãr
, &
pos
, 
Ën
,

357 
E¼ÜHªdËr
 *
”rh
) const

359 ià(
n
->
couÁ
 > 0) {

360 
bufãr
[
pos
++] = 
n
->
agg»g©e
;

361 
bufãr
[
pos
++] = 
n
->
couÁ
;

362 ià(
pos
 =ğ
Ën
) {

363 
	`wr™e_b©ch
(
f
, 
fÜm©
, 
bufãr
, 
pos
, 
_couÁ
, 
”rh
);

364 
pos
 = 0;

368 ià(
n
->
chd
[0])

369 
	`wr™e_nodes
(
n
->
chd
[0], 
f
, 
fÜm©
, 
bufãr
, 
pos
, 
Ën
, 
”rh
);

370 ià(
n
->
chd
[1])

371 
	`wr™e_nodes
(
n
->
chd
[1], 
f
, 
fÜm©
, 
bufãr
, 
pos
, 
Ën
, 
”rh
);

372 
	}
}

375 
	gAgg»g©eCouÁ”
::
	$wr™e_fe
(
SŒšg
 
wh”e
, 
Wr™eFÜm©
 
fÜm©
,

376 
E¼ÜHªdËr
 *
”rh
) const

378 
FILE
 *
f
;

379 ià(
wh”e
 == "-")

380 
f
 = 
¡dout
;

382 
f
 = 
	`fİ’
(
wh”e
.
	`c_¡r
(), (
fÜm©
 =ğ
WR_BINARY
 ? "wb" : "w"));

383 ià(!
f
)

384  
”rh
->
	`”rÜ
("%s: %s", 
wh”e
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

386 
	`årštf
(
f
, "!IPAggregate 1.0\n");

387 
	`ignÜe_»suÉ
(
	`fwr™e
(
_ouut_bªÃr
.
	`d©a
(), 1, _ouut_bªÃr.
	`Ëngth
(), 
f
));

388 ià(
_ouut_bªÃr
.
	`Ëngth
(è&& _ouut_bªÃr.
	`back
() != '\n')

389 
	`åutc
('\n', 
f
);

390 
	`årštf
(
f
, "!num_nÚz”Ø%u\n", 
_num_nÚz”o
);

391 ià(
fÜm©
 =ğ
WR_BINARY
) {

392 #ià
CLICK_BYTE_ORDER
 =ğ
CLICK_BIG_ENDIAN


393 
	`årštf
(
f
, "!packed_be\n");

394 #–ià
CLICK_BYTE_ORDER
 =ğ
CLICK_LITTLE_ENDIAN


395 
	`årštf
(
f
, "!packed_le\n");

397 
fÜm©
 = 
WR_TEXT
;

399 } ià(
fÜm©
 =ğ
WR_TEXT_IP
)

400 
	`årštf
(
f
, "!ip\n");

402 
ušt32_t
 
buf
[1024];

403 
pos
 = 0;

404 
	`wr™e_nodes
(
_roÙ
, 
f
, 
fÜm©
, 
buf
, 
pos
, 1024, 
”rh
);

405 ià(
pos
)

406 
	`wr™e_b©ch
(
f
, 
fÜm©
, 
buf
, 
pos
, 
_couÁ
, 
”rh
);

408 
boŞ
 
had_”r
 = 
	`ã¼Ü
(
f
);

409 ià(
f
 !ğ
¡dout
)

410 
	`fşo£
(
f
);

411 ià(
had_”r
)

412  
”rh
->
	`”rÜ
("%s: f”rÜ", 
wh”e
.
	`c_¡r
());

415 
	}
}

418 
	gAgg»g©eCouÁ”
::
	$wr™e_fe_hªdËr
(cÚ¡ 
SŒšg
 &
d©a
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

420 
Agg»g©eCouÁ”
 *
ac
 = 
¡©ic_ÿ¡
<Agg»g©eCouÁ” *>(
e
);

421 
SŒšg
 
â
;

422 ià(!
	`F’ameArg
().
	`·r£
(
	`ı_uncomm’t
(
d©a
), 
â
))

423  
”rh
->
	`”rÜ
("argument should be filename");

424 
št_thunk
 = (
šŒ_t
)
thunk
;

425  
ac
->
	`wr™e_fe
(
â
, (
Wr™eFÜm©
)
št_thunk
, 
”rh
);

426 
	}
}

429 
	mAC_FROZEN
, 
	mAC_ACTIVE
, 
	mAC_BANNER
, 
	mAC_STOP
, 
	mAC_REAGGREGATE
, 
	mAC_CLEAR
,

430 
	mAC_AGGREGATE_CALL
, 
	mAC_COUNT_CALL
, 
	mAC_NAGG
, 
	mAC_COUNT


433 
SŒšg


434 
	gAgg»g©eCouÁ”
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

436 
Agg»g©eCouÁ”
 *
ac
 = 
¡©ic_ÿ¡
<Agg»g©eCouÁ” *>(
e
);

437 (
šŒ_t
)
thunk
) {

438 
AC_BANNER
:

439  
ac
->
_ouut_bªÃr
;

440 
AC_AGGREGATE_CALL
:

441 ià(
ac
->
_ÿÎ_Âz
 =ğ(
ušt32_t
)(-1))

444  
	`SŒšg
(
ac
->
_ÿÎ_Âz
è+ " " +‡c->
_ÿÎ_Âz_h
->
	`uÅ¬£
();

445 
AC_COUNT_CALL
:

446 ià(
ac
->
_ÿÎ_couÁ
 =ğ(
ušt64_t
)(-1))

449  
	`SŒšg
(
ac
->
_ÿÎ_couÁ
è+ " " +‡c->
_ÿÎ_couÁ_h
->
	`uÅ¬£
();

450 
AC_COUNT
:

451  
	`SŒšg
(
ac
->
_couÁ
);

452 
AC_NAGG
:

453  
	`SŒšg
(
ac
->
_num_nÚz”o
);

457 
	}
}

460 
	gAgg»g©eCouÁ”
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
d©a
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

462 
Agg»g©eCouÁ”
 *
ac
 = 
¡©ic_ÿ¡
<Agg»g©eCouÁ” *>(
e
);

463 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
d©a
);

464 (
šŒ_t
)
thunk
) {

465 
AC_FROZEN
: {

466 
boŞ
 
v®
;

467 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
v®
))

468  
”rh
->
	`”rÜ
("type mismatch");

469 
ac
->
_äoz’
 = 
v®
;

472 
AC_ACTIVE
: {

473 
boŞ
 
v®
;

474 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
v®
))

475  
”rh
->
	`”rÜ
("type mismatch");

476 
ac
->
_aùive
 = 
v®
;

479 
AC_STOP
:

480 
ac
->
_aùive
 = 
çl£
;

481 
ac
->
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

483 
AC_REAGGREGATE
:

484 
ac
->
	`»agg»g©e_couÁs
();

486 
AC_BANNER
:

487 
ac
->
_ouut_bªÃr
 = 
d©a
;

488 ià(
d©a
 && d©a.
	`back
() != '\n')

489 
ac
->
_ouut_bªÃr
 += '\n';

490 ià(
d©a
 && d©a.
	`Ëngth
() == 1)

491 
ac
->
_ouut_bªÃr
 = "";

493 
AC_CLEAR
:

494  
ac
->
	`ş—r
(
”rh
);

495 
AC_AGGREGATE_CALL
: {

496 
ušt32_t
 
Ãw_Âz
 = (uint32_t)(-1);

497 ià(
s
) {

498 ià(!
	`IÁArg
().
	`·r£
(
	`ı_shiá_¥aûvec
(
s
), 
Ãw_Âz
))

499  
”rh
->
	`”rÜ
("argumento 'aggregate_call' should be 'N HANDLER [VALUE]'");

500 ià(
HªdËrC®l
::
	`»£t_wr™e
(
ac
->
_ÿÎ_Âz_h
, 
s
,‡c, 
”rh
) < 0)

503 
ac
->
_ÿÎ_Âz
 = 
Ãw_Âz
;

506 
AC_COUNT_CALL
: {

507 
ušt64_t
 
Ãw_couÁ
 = (uint64_t)(-1);

508 ià(
s
) {

509 ià(!
	`IÁArg
().
	`·r£
(
	`ı_shiá_¥aûvec
(
s
), 
Ãw_couÁ
))

510  
”rh
->
	`”rÜ
("argumento 'count_call' should be 'N HANDLER [VALUE]'");

511 ià(
HªdËrC®l
::
	`»£t_wr™e
(
ac
->
_ÿÎ_couÁ_h
, 
s
,‡c, 
”rh
) < 0)

514 
ac
->
_ÿÎ_couÁ
 = 
Ãw_couÁ
;

518  
”rh
->
	`”rÜ
("internalƒrror");

520 
	}
}

523 
	gAgg»g©eCouÁ”
::
	$add_hªdËrs
()

525 
	`add_wr™e_hªdËr
("wr™e_‹xt_fe", 
wr™e_fe_hªdËr
, 
WR_TEXT
);

526 
	`add_wr™e_hªdËr
("wr™e_ascii_fe", 
wr™e_fe_hªdËr
, 
WR_TEXT
);

527 
	`add_wr™e_hªdËr
("wr™e_fe", 
wr™e_fe_hªdËr
, 
WR_BINARY
);

528 
	`add_wr™e_hªdËr
("wr™e__fe", 
wr™e_fe_hªdËr
, 
WR_TEXT_IP
);

529 
	`add_wr™e_hªdËr
("wr™e_pdf_fe", 
wr™e_fe_hªdËr
, 
WR_TEXT_PDF
);

530 
	`add_d©a_hªdËrs
("ä“ze", 
HªdËr
::
f_»ad
 | HªdËr::
f_checkbox
, &
_äoz’
);

531 
	`add_wr™e_hªdËr
("ä“ze", 
wr™e_hªdËr
, 
AC_FROZEN
);

532 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
f_»ad
 | HªdËr::
f_checkbox
, &
_aùive
);

533 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 
AC_ACTIVE
);

534 
	`add_wr™e_hªdËr
("¡İ", 
wr™e_hªdËr
, 
AC_STOP
, 
HªdËr
::
f_bu‰Ú
);

535 
	`add_wr™e_hªdËr
("»agg»g©e_couÁs", 
wr™e_hªdËr
, 
AC_REAGGREGATE
);

536 
	`add_wr™e_hªdËr
("couÁs_pdf", 
wr™e_hªdËr
, 
AC_REAGGREGATE
);

537 
	`add_»ad_hªdËr
("bªÃr", 
»ad_hªdËr
, 
AC_BANNER
);

538 
	`add_wr™e_hªdËr
("bªÃr", 
wr™e_hªdËr
, 
AC_BANNER
, 
HªdËr
::
f_¿w
);

539 
	`add_wr™e_hªdËr
("ş—r", 
wr™e_hªdËr
, 
AC_CLEAR
);

540 
	`add_»ad_hªdËr
("agg»g©e_ÿÎ", 
»ad_hªdËr
, 
AC_AGGREGATE_CALL
);

541 
	`add_wr™e_hªdËr
("agg»g©e_ÿÎ", 
wr™e_hªdËr
, 
AC_AGGREGATE_CALL
);

542 
	`add_»ad_hªdËr
("couÁ_ÿÎ", 
»ad_hªdËr
, 
AC_COUNT_CALL
);

543 
	`add_wr™e_hªdËr
("couÁ_ÿÎ", 
wr™e_hªdËr
, 
AC_COUNT_CALL
);

544 
	`add_»ad_hªdËr
("couÁ", 
»ad_hªdËr
, 
AC_COUNT
);

545 
	`add_»ad_hªdËr
("Çgg", 
»ad_hªdËr
, 
AC_NAGG
);

546 
	}
}

548 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
št64
)

549 
	$EXPORT_ELEMENT
(
Agg»g©eCouÁ”
)

550 
CLICK_ENDDECLS


	@analysis/aggcounter.hh

1 #iâdeà
CLICK_AGGCOUNTER_HH


2 
	#CLICK_AGGCOUNTER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


5 
şass
 
	gHªdËrC®l
;

192 şas 
	cAgg»g©eCouÁ”
 : 
public
 
EËm’t
 {…ublic:

194 
	$Agg»g©eCouÁ”
(è
CLICK_COLD
;

195 ~
	$Agg»g©eCouÁ”
(è
CLICK_COLD
;

197 cÚ¡ *
	$şass_Çme
() const {  "AggregateCounter"; }

198 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1-2/1-2"; 
	}
}

200 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

201 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

202 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

203 
	$add_hªdËrs
(è
CLICK_COLD
;

205 
šlše
 
boŞ
 
	`upd©e
(
Pack‘
 *, boŞ 
äoz’
 = 
çl£
);

206 
	`push
(, 
Pack‘
 *);

207 
Pack‘
 *
	`puÎ
();

209 
boŞ
 
	$em±y
(ècÚ¡ {  
_num_nÚz”o
 =ğ0; 
	}
}

210 
ş—r
(
E¼ÜHªdËr
 * = 0);

211 
	eWr™eFÜm©
 { 
	gWR_TEXT
 = 0, 
	gWR_BINARY
 = 1, 
	gWR_TEXT_IP
 = 2, 
	gWR_TEXT_PDF
 = 3 };

212 
	$wr™e_fe
(
SŒšg
, 
Wr™eFÜm©
, 
E¼ÜHªdËr
 *) const;

213 
	`»agg»g©e_couÁs
();

215 
´iv©e
:

217 
	sNode
 {

218 
ušt32_t
 
agg»g©e
;

219 
ušt32_t
 
couÁ
;

220 
Node
 *
chd
[2];

221 
	}
};

223 
boŞ
 
	g_by‹s
 : 1;

224 
boŞ
 
	g__by‹s
 : 1;

225 
boŞ
 
	g_u£_·ck‘_couÁ
 : 1;

226 
boŞ
 
	g_u£_exŒa_Ëngth
 : 1;

227 
boŞ
 
	g_äoz’
;

228 
boŞ
 
	g_aùive
;

230 
Node
 *
	g_roÙ
;

231 
Node
 *
	g_ä“
;

232 
	gVeùÜ
<
	gNode
 *> 
	g_blocks
;

233 
ušt32_t
 
	g_num_nÚz”o
;

234 
ušt64_t
 
	g_couÁ
;

236 
ušt32_t
 
	g_ÿÎ_Âz
;

237 
HªdËrC®l
 *
	g_ÿÎ_Âz_h
;

238 
ušt64_t
 
	g_ÿÎ_couÁ
;

239 
HªdËrC®l
 *
	g_ÿÎ_couÁ_h
;

241 
SŒšg
 
	g_ouut_bªÃr
;

243 
Node
 *
Ãw_node
();

244 
Node
 *
Ãw_node_block
();

245 
ä“_node
(
Node
 *);

247 
Node
 *
make_³”
(
ušt32_t
, Nod*, 
boŞ
 
äoz’
);

248 
Node
 *
fšd_node
(
ušt32_t
, 
boŞ
 
äoz’
 = 
çl£
);

249 
»agg»g©e_node
(
Node
 *);

250 
ş—r_node
(
Node
 *);

252 
	$wr™e_nodes
(
Node
 *, 
FILE
 *, 
Wr™eFÜm©
, 
ušt32_t
 *, &, , 
E¼ÜHªdËr
 *) const;

253 
	`wr™e_fe_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

254 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

255 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

257 
	}
};

259 
šlše
 
	gAgg»g©eCouÁ”
::
Node
 *

260 
Agg»g©eCouÁ”
::
	$Ãw_node
()

262 ià(
_ä“
) {

263 
Node
 *
n
 = 
_ä“
;

264 
_ä“
 = 
n
->
chd
[0];

265  
n
;

267  
	`Ãw_node_block
();

268 
	}
}

270 
šlše
 

271 
	gAgg»g©eCouÁ”
::
	$ä“_node
(
Node
 *
n
)

273 
n
->
chd
[0] = 
_ä“
;

274 
_ä“
 = 
n
;

275 
	}
}

277 
	gCLICK_ENDDECLS


	@analysis/aggpktcounter.cc

21 
	~<şick/cÚfig.h
>

22 
	~"aggpktcouÁ”.hh
"

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/·ck‘_ªno.hh
>

26 
	~<şick/rou‹r.hh
>

27 
	~<şick/¡¿ccum.hh
>

28 
	~<uni¡d.h
>

29 
	~<sys/¡©.h
>

30 
	~<sys/ty³s.h
>

31 
	~<sys/wa™.h
>

32 
	~<fú.h
>

33 
CLICK_DECLS


35 
	gAgg»g©ePack‘CouÁ”
::
Flow
::
	$Flow
(
ušt32_t
 
agg»g©e
, 
cŞumns
)

36 : 
	`_agg»g©e
(
agg»g©e
), 
	`_Ãxt
(0), 
	`_couÁs
(
Ãw
 
VeùÜ
<
ušt32_t
>[
cŞumns
])

38 
	}
}

41 
	gAgg»g©ePack‘CouÁ”
::
Flow
::
	$add
(
ušt32_t
 
·ck‘no
, 
cŞumn
)

43 ià(
_couÁs
[
cŞumn
].
	`size
(è<ğ(è
·ck‘no
)

44 
_couÁs
[
cŞumn
].
	`»size
(
·ck‘no
 + 1, 0);

45 
_couÁs
[
cŞumn
].
	`unchecked_©
(
·ck‘no
)++;

46 
	}
}

48 
	gAgg»g©ePack‘CouÁ”
::
·ck‘ùr_t


49 
Agg»g©ePack‘CouÁ”
::
Flow
::
	$cŞumn_couÁ
(
cŞumn
) const

51 
·ck‘ùr_t
 
couÁ
 = 0;

52 cÚ¡ 
ušt32_t
 *
v
 = 
_couÁs
[
cŞumn
].
	`begš
(); v < _couÁs[cŞumn].
	`’d
(); v++)

53 
couÁ
 +ğ*
v
;

54  
couÁ
;

55 
	}
}

58 
	gAgg»g©ePack‘CouÁ”
::
Flow
::
»ûived
(
VeùÜ
<
ušt32_t
> &
v
, cÚ¡ 
Agg»g©ePack‘CouÁ”
 *
­c
) const

60 
	gn
 = 0;

61 
	gpÜt
 = 0;…Üˆ< 
	g­c
->
nouuts
();…ort++)

62 ià(
	g_couÁs
[
pÜt
].
size
(è> 
	gn
)

63 
	gn
 = 
_couÁs
[
pÜt
].
size
();

64 
	g·ck‘no
 = 0;…ack‘nØ< 
	gn
;…acketno++)

65 
	gpÜt
 = 0;…Üˆ< 
	g­c
->
nouuts
();…ort++)

66 ià(
	g·ck‘no
 < 
	g_couÁs
[
pÜt
].
size
(è&& _couÁs[pÜt].
unchecked_©
(
·ck‘no
)) {

67 
	gv
.
push_back
(
·ck‘no
);

73 
	gAgg»g©ePack‘CouÁ”
::
Flow
::
und–iv”ed
(
VeùÜ
<
ušt32_t
> &und–iv”ed, cÚ¡ 
Agg»g©ePack‘CouÁ”
 *
­c
) const

75 
as£¹
(
­c
->
nouuts
() >= 2);

76 
	g·ck‘no
;

77 
	gmš_n
 = (
_couÁs
[0].
size
() < _counts[1].size() ? _counts[0].size() : _counts[1].size());

78 
	g·ck‘no
 = 0;…ack‘nØ< 
	gmš_n
;…acketno++)

79 ià(
	g_couÁs
[0].
unchecked_©
(
·ck‘no
) > _counts[1].unchecked_at(packetno))

80 
	gund–iv”ed
.
push_back
(
·ck‘no
);

81 ; 
	g·ck‘no
 < 
	g_couÁs
[0].
size
();…acketno++)

82 ià(
	g_couÁs
[0].
unchecked_©
(
·ck‘no
))

83 
	gund–iv”ed
.
push_back
(
·ck‘no
);

87 
	gAgg»g©ePack‘CouÁ”
::
	$Agg»g©ePack‘CouÁ”
()

89 
i
 = 0; i < 
NFLOWMAP
; i++)

90 
_æowm­
[
i
] = 0;

91 
	}
}

93 
	gAgg»g©ePack‘CouÁ”
::~
	$Agg»g©ePack‘CouÁ”
()

95 
	}
}

98 
Agg»g©ePack‘CouÁ”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

100 
EËm’t
 *
	ge
 = 0;

101 
SŒšg
 
	gªno
 = SŒšg::
make_¡abË
("PACKET_NUMBER");

103 ià(
Args
(
cÚf
, 
this
, 
”rh
)

104 .
»ad
("NOTIFIER", 
e
)

105 .
»ad
("ANNO", 
WÜdArg
(), 
ªno
)

106 .
com¶‘e
() < 0)

109 ià(
	gªno
 == "NONE")

110 
_ªno
 = -1;

111 ià(!
ı_ªno
(
ªno
, 4, &
_ªno
, 
this
))

112  
	g”rh
->
”rÜ
("bad ANNO");

120 
	gAgg»g©ePack‘CouÁ”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

122 
_tÙ®_æows
 = 
_tÙ®_·ck‘s
 = 0;

127 
	}
}

130 
	gAgg»g©ePack‘CouÁ”
::
	$’d_æow
(
Flow
 *
f
, 
E¼ÜHªdËr
 *)

139 
d–‘e
 
f
;

140 
	}
}

143 
	gAgg»g©ePack‘CouÁ”
::
	$ş—nup
(
CËªupSge
)

145 
E¼ÜHªdËr
 *
”rh
 = E¼ÜHªdËr::
	`deçuÉ_hªdËr
();

146 
i
 = 0; i < 
NFLOWMAP
; i++)

147 
Flow
 *
f
 = 
_æowm­
[
i
]) {

148 
_æowm­
[
i
] = 
f
->
	`Ãxt
();

149 
	`’d_æow
(
f
, 
”rh
);

151 ià(
_tÙ®_·ck‘s
 > 0 && 
_tÙ®_æows
 == 0)

152 
”rh
->
	`lw¬nšg
(
	`deş¬©iÚ
(), "saw‚o…ackets with‡ggregate‡nnotations");

153 
	}
}

155 
	gAgg»g©ePack‘CouÁ”
::
Flow
 *

156 
Agg»g©ePack‘CouÁ”
::
	$fšd_æow
(
ušt32_t
 
agg
)

158 ià(
agg
 == 0)

161 
buck‘
 = (
agg
 & (
NFLOWMAP
 - 1));

162 
Flow
 *
´ev
 = 0, *
f
 = 
_æowm­
[
buck‘
];

163 
f
 && f->
	`agg»g©e
(è!ğ
agg
) {

164 
´ev
 = 
f
;

165 
f
 = f->
	`Ãxt
();

168 ià(
f
)

170 ià((
f
 = 
Ãw
 
	`Flow
(
agg
, 
	`nšputs
()))) {

171 
´ev
 = 
f
;

172 
_tÙ®_æows
++;

176 ià(
´ev
) {

177 
´ev
->
	`£t_Ãxt
(
f
->
	`Ãxt
());

178 
f
->
	`£t_Ãxt
(
_æowm­
[
buck‘
]);

179 
_æowm­
[
buck‘
] = 
f
;

182  
f
;

183 
	}
}

185 
šlše
 

186 
	gAgg»g©ePack‘CouÁ”
::
	$smaùiÚ
(
pÜt
, 
Pack‘
 *
p
)

188 
_tÙ®_·ck‘s
++;

189 ià(
Flow
 *
f
 = 
	`fšd_æow
(
	`AGGREGATE_ANNO
(
p
))) {

190 ià(
_ªno
 >= 0)

191 
f
->
	`add
(
p
->
	`ªno_u32
(
_ªno
), 
pÜt
);

193 
f
->
	`add
(0, 
pÜt
);

195 
	}
}

198 
	gAgg»g©ePack‘CouÁ”
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

200 
	`smaùiÚ
(
pÜt
, 
p
);

201 
	`ouut
(
pÜt
).
	`push
(
p
);

202 
	}
}

204 
Pack‘
 *

205 
	gAgg»g©ePack‘CouÁ”
::
	$puÎ
(
pÜt
)

207 ià(
Pack‘
 *
p
 = 
	`šput
(
pÜt
).
	`puÎ
()) {

208 
	`smaùiÚ
(
pÜt
, 
p
);

209  
p
;

212 
	}
}

246 ’um { 
	mH_CLEAR
, 
	mH_COUNT
 };

248 
SŒšg


249 
	gAgg»g©ePack‘CouÁ”
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

251 
Agg»g©ePack‘CouÁ”
 *
ac
 = 
¡©ic_ÿ¡
<Agg»g©ePack‘CouÁ” *>(
e
);

252 (
šŒ_t
)
thunk
) {

253 
H_COUNT
: {

254 
·ck‘ùr_t
 
couÁ
 = 0;

255 
i
 = 0; i < 
NFLOWMAP
; i++)

256 cÚ¡ 
Flow
 *
f
 = 
ac
->
_æowm­
[
i
]; f; f = f->
	`Ãxt
())

257 
cŞ
 = 0; cŞ < 
ac
->
	`nšputs
(); col++)

258 
couÁ
 +ğ
f
->
	`cŞumn_couÁ
(
cŞ
);

259  
	`SŒšg
(
couÁ
);

264 
	}
}

267 
	gAgg»g©ePack‘CouÁ”
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

269 
Agg»g©ePack‘CouÁ”
 *
td
 = 
¡©ic_ÿ¡
<Agg»g©ePack‘CouÁ” *>(
e
);

270 (
šŒ_t
)
thunk
) {

271 
H_CLEAR
:

272 
i
 = 0; i < 
NFLOWMAP
; i++)

273 
Flow
 *
f
 = 
td
->
_æowm­
[
i
]) {

274 
td
->
_æowm­
[
i
] = 
f
->
	`Ãxt
();

275 
td
->
	`’d_æow
(
f
, 
”rh
);

281 
	}
}

283 
SŒšg


284 
	gAgg»g©ePack‘CouÁ”
::
	$æow_hªdËr
(
ušt32_t
 
agg»g©e
, 
FlowFunc
 
func
)

286 
VeùÜ
<
ušt32_t
> 
v
;

287 ià(
Flow
 *
f
 = 
	`fšd_æow
(
agg»g©e
))

288 (
f
->*
func
)(
v
, 
this
);

289 
SŒšgAccum
 
§
;

290 
i
 = 0; i < 
v
.
	`size
(); i++)

291 
§
 << 
v
[
i
] << '\n';

292  
§
.
	`ke_¡ršg
();

293 
	}
}

296 
	gAgg»g©ePack‘CouÁ”
::
	$thšg_»ad_hªdËr
(, 
SŒšg
& 
s
, 
EËm’t
* 
e
, cÚ¡ 
HªdËr
* 
h
, 
E¼ÜHªdËr
* 
”rh
)

298 
ušt32_t
 
agg»g©e
 = 0;

299 ià(
s
 && !
	`IÁArg
().
	`·r£
(
	`ı_uncomm’t
(s), 
agg»g©e
))

300  
”rh
->
	`”rÜ
("argument should be‡ggregate‚umber");

301 
FlowFunc
 
ff
 = (
h
->
	`»ad_u£r_d©a
(è? &
Flow
::
und–iv”ed
 : &Flow::
»ûived
);

302 
Agg»g©ePack‘CouÁ”
 *
­c
 = 
¡©ic_ÿ¡
<Agg»g©ePack‘CouÁ” *>(
e
);

303 
s
 = 
­c
->
	`æow_hªdËr
(
agg»g©e
, 
ff
);

305 
	}
}

308 
	gAgg»g©ePack‘CouÁ”
::
	$add_hªdËrs
()

310 
	`add_wr™e_hªdËr
("ş—r", 
wr™e_hªdËr
, 
H_CLEAR
);

311 
	`add_»ad_hªdËr
("couÁ", 
»ad_hªdËr
, 
H_COUNT
);

312 
	`£t_hªdËr
("»ûived", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
thšg_»ad_hªdËr
, 0);

313 
	`£t_hªdËr
("und–iv”ed", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
thšg_»ad_hªdËr
, (*) 1);

314 
	}
}

316 
CLICK_ENDDECLS


317 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
št64
)

318 
	`EXPORT_ELEMENT
(
Agg»g©ePack‘CouÁ”
)

	@analysis/aggpktcounter.hh

2 #iâdeà
CLICK_AGGPKTCOUNTER_HH


3 
	#CLICK_AGGPKTCOUNTER_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şick/nÙif›r.hh
>

7 
	~<şick/æowid.hh
>

8 
CLICK_DECLS


90 şas 
	cAgg»g©ePack‘CouÁ”
 : 
public
 
EËm’t
 {…ublic:

92 
	$Agg»g©ePack‘CouÁ”
(è
CLICK_COLD
;

93 ~
	$Agg»g©ePack‘CouÁ”
(è
CLICK_COLD
;

95 cÚ¡ *
	$şass_Çme
() const {  "AggregatePacketCounter"; }

96 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1-/1-"; 
	}
}

97 cÚ¡ *
	$æow_code
(ècÚ¡ {  "#/#"; 
	}
}

99 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

100 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

101 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

102 
	$add_hªdËrs
(è
CLICK_COLD
;

104 
	`push
(, 
Pack‘
 *);

105 
Pack‘
 *
	`puÎ
();

107 
´iv©e
:

109 #ifdeà
HAVE_INT64_TYPES


110 
ušt64_t
 
	t·ck‘ùr_t
;

112 
št64_t
 
	t·ck‘ùr_t
;

115 şas 
	cFlow
 { 
public
:

117 
	`Flow
(
ušt32_t
 
agg»g©e
, 
cŞumns
);

119 
ušt32_t
 
	`agg»g©e
(ècÚ¡ {  
_agg»g©e
; }

120 
Flow
 *
	`Ãxt
(ècÚ¡ {  
_Ãxt
; }

121 
	`£t_Ãxt
(
Flow
 *
Ãxt
è{ 
_Ãxt
 =‚ext; }

123 
·ck‘ùr_t
 
	`cŞumn_couÁ
(
cŞumn
) const;

124 
	`»ûived
(
VeùÜ
<
ušt32_t
> &, cÚ¡ 
Agg»g©ePack‘CouÁ”
 *) const;

125 
	`und–iv”ed
(
VeùÜ
<
ušt32_t
> &, cÚ¡ 
Agg»g©ePack‘CouÁ”
 *) const;

127 
	`add
(
ušt32_t
 
·ck‘no
, 
cŞumn
);

129 
´iv©e
:

131 
ušt32_t
 
_agg»g©e
;

132 
Flow
 *
_Ãxt
;

134 
VeùÜ
<
ušt32_t
> *
_couÁs
;

136 
	}
};

138 ’um { 
	gFLOWMAP_BITS
 = 10, 
	gNFLOWMAP
 = 1 << 
FLOWMAP_BITS
 };

139 
Flow
 *
	g_æowm­
[
NFLOWMAP
];

141 
ušt32_t
 
	g_tÙ®_æows
;

142 
·ck‘ùr_t
 
	g_tÙ®_·ck‘s
;

144 
	g_ªno
;

146 
Flow
 *
fšd_æow
(
ušt32_t
 
agg»g©e
);

147 
’d_æow
(
Flow
 *, 
E¼ÜHªdËr
 *);

148 
šlše
 
smaùiÚ
(, 
Pack‘
 *);

150 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

151 (
	tFlow
::*
	tFlowFunc
)(
	tVeùÜ
<
	tušt32_t
> &, cÚ¡ 
	tAgg»g©ePack‘CouÁ”
 *) const;

152 
SŒšg
 
	`æow_hªdËr
(
ušt32_t
 
agg»g©e
, 
FlowFunc
 
func
);

153 
	$thšg_»ad_hªdËr
(, 
SŒšg
&, 
EËm’t
*, cÚ¡ 
HªdËr
*, 
E¼ÜHªdËr
*è
CLICK_COLD
;

154 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

156 
	}
};

158 
	gCLICK_ENDDECLS


	@analysis/aggregatefilter.cc

19 
	~<şick/cÚfig.h
>

20 
	~"agg»g©ef‹r.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
CLICK_DECLS


26 
	gAgg»g©eF‹r
::
Group
::
	$Group
(
ušt32_t
 
agg»g©e
)

27 : 
	`grou²o
(
agg»g©e
 & 
GROUPMASK
), 
	$Ãxt
(0)

29 
	`mem£t
(
f‹rs
, 0, (filters));

30 
	}
}

32 
	gAgg»g©eF‹r
::
	$Agg»g©eF‹r
()

33 : 
	$_deçuÉ_ouut
(1)

35 
i
 = 0; i < 
NBUCKETS
; i++)

36 
_groups
[
i
] = 0;

37 
	}
}

39 
	gAgg»g©eF‹r
::~
	$Agg»g©eF‹r
()

41 
	}
}

43 
Agg»g©eF‹r
::
Group
 *

44 
Agg»g©eF‹r
::
	$fšd_group
(
ušt32_t
 
agg»g©e
)

46 
buck‘
 = (
agg»g©e
 >> 
GROUPSHIFT
è% 
NBUCKETS
;

47 
Group
 *
g
 = 
_groups
[
buck‘
];

48 
ušt32_t
 
grou²o
 = 
agg»g©e
 & 
GROUPMASK
;

49 
g
 && g->
grou²o
 != groupno)

50 
g
 = g->
Ãxt
;

51 ià(!
g
 && (g = 
Ãw
 
	`Group
(
agg»g©e
))) {

52 
g
->
Ãxt
 = 
_groups
[
buck‘
];

53 
_groups
[
buck‘
] = 
g
;

55  
g
;

56 
	}
}

59 
	gAgg»g©eF‹r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

61 
	g_deçuÉ_ouut
 = 
nouuts
() + 1;

62 
Group
 *
	gg
 = 0;

64 
	g¬gno
 = 0;‡rgnØ< 
	gcÚf
.
size
();‡rgno++) {

65 
	gVeùÜ
<
	gSŒšg
> 
	gwÜds
;

66 
ı_¥aûvec
(
cÚf
[
¬gno
], 
wÜds
);

68 ià(
	gwÜds
.
size
() == 0) {

69 
”rh
->
”rÜ
("em±y…©‹º %d", 
¬gno
);

71 } ià(
	g_deçuÉ_ouut
 <ğ
nouuts
()) {

72 
”rh
->
w¬nšg
("·‰”À%d m©che nØ·ck‘s", 
¬gno
);

76 
	gpÜt
 = 
nouuts
();

77 ià(
	gwÜds
[0] == "allow")

78 
pÜt
 = 0;

79 ià(
IÁArg
().
·r£
(
wÜds
[0], 
pÜt
è&& 
	gpÜt
 >= 0)

81 ià(
	gwÜds
[0] !ğ"drİ" && 
wÜds
[0] != "deny") {

82 
”rh
->
”rÜ
("·‰”À%d:ƒx³ùed‡…Üˆnumb”", 
¬gno
);

86 ià(
	gwÜds
.
size
() == 1)

87 
”rh
->
”rÜ
("·‰”À%d ha nØagg»g©es", 
¬gno
);

88 ià(
	gwÜds
.
size
(è=ğ2 && (
wÜds
[1] == "all" || words[1] == "-"))

89 
_deçuÉ_ouut
 = 
pÜt
;

91 
	gi
 = 1; i < 
	gwÜds
.
size
(); i++) {

92 
ušt32_t
 
	gagg1
 = 0, 
	gagg2
 = 0;

93 cÚ¡ *
	gdash
;

94 ià(
IÁArg
().
·r£
(
wÜds
[
i
], 
agg1
))

95 
	gagg2
 = 
agg1
;

97 
	gdash
 = 
fšd
(
wÜds
[
i
], '-');

98 ià(!
IÁArg
().
·r£
(
wÜds
[
i
].
sub¡ršg
(wÜds[i].
begš
(), 
dash
), 
agg1
)

99 || !
IÁArg
().
·r£
(
wÜds
[
i
].
sub¡ršg
(
dash
 + 1, wÜds[i].
’d
()), 
agg2
)) {

100 
	g”rh
->
”rÜ
("·‰”À%d: bad‡gg»g©numb” %<%#s%>", 
¬gno
, 
wÜds
[
i
].
c_¡r
());

105 
	gagg1
 <ğ
agg2
) {

106 ià(!
g
 || g->
grou²o
 !ğ(
agg1
 & 
GROUPMASK
))

107 
g
 = 
fšd_group
(
agg1
);

108 
	gwhich
 = 
agg1
 & 
INGROUPMASK
;

109 ià(
	gg
->
	gf‹rs
[
which
] && g->f‹rs[which] !ğ
pÜt
 + 1)

110 
”rh
->
w¬nšg
("·‰”À%d:‡gg»g©%u‡Ì—dy f‹»dØouuˆ%d", 
¬gno
, 
agg1
, 
g
->
f‹rs
[
which
] - 1);

112 
	gg
->
	gf‹rs
[
which
] = 
pÜt
 + 1;

113 
	gagg1
++;

118  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

122 
	gAgg»g©eF‹r
::
	$ş—nup
(
CËªupSge
)

124 
i
 = 0; i < 
NBUCKETS
; i++)

125 
_groups
[
i
]) {

126 
Group
 *
g
 = 
_groups
[
i
];

127 
_groups
[
i
] = 
g
->
Ãxt
;

128 
d–‘e
 
g
;

130 
	}
}

133 
	gAgg»g©eF‹r
::
	$push
(, 
Pack‘
 *
p
)

136 
buck‘
 = (
	`AGGREGATE_ANNO
(
p
è>> 
GROUPSHIFT
è% 
NBUCKETS
;

137 
Group
 *
g
 = 
_groups
[
buck‘
], *
´ev
 = 0;

138 
ušt32_t
 
grou²o
 = 
	`AGGREGATE_ANNO
(
p
è& 
GROUPMASK
;

139 
g
 && g->
grou²o
 != groupno) {

140 
´ev
 = 
g
;

141 
g
 = g->
Ãxt
;

143 ià(
´ev
 && 
g
) {

144 
´ev
->
Ãxt
 = 
g
->next;

145 
g
->
Ãxt
 = 
_groups
[
buck‘
];

146 
_groups
[
buck‘
] = 
g
;

150 
ušt32_t
 
–Šo
 = 
	`AGGREGATE_ANNO
(
p
è& 
INGROUPMASK
;

151 
pÜt
 = (
g
 && g->
f‹rs
[
–Šo
] ? g->f‹rs[–Šo] - 1 : 
_deçuÉ_ouut
);

152 
	`checked_ouut_push
(
pÜt
, 
p
);

153 
	}
}

155 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

156 
	$EXPORT_ELEMENT
(
Agg»g©eF‹r
)

157 
CLICK_ENDDECLS


	@analysis/aggregatefilter.hh

1 #iâdeà
CLICK_AGGREGATEFILTER_HH


2 
	#CLICK_AGGREGATEFILTER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


51 şas 
	cAgg»g©eF‹r
 : 
public
 
EËm’t
 {…ublic:

53 
	$Agg»g©eF‹r
(è
CLICK_COLD
;

54 ~
	$Agg»g©eF‹r
(è
CLICK_COLD
;

56 cÚ¡ *
	$şass_Çme
() const {  "AggregateFilter"; }

57 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-254"; 
	}
}

58 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

60 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

61 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

63 
	`push
(, 
Pack‘
 *);

65 ’um { 
GROUPSHIFT
 = 8, 
GROUPMASK
 = 0xFFFFFFFFU << GROUPSHIFT,

66 
NINGROUP
 = 1 << 
GROUPSHIFT
, 
INGROUPMASK
 = NINGROUP - 1,

67 
NBUCKETS
 = 256 
	}
};

69 
	g´iv©e
:

71 
	sGroup
 {

72 
ušt32_t
 
grou²o
;

73 
Group
 *
	gÃxt
;

74 
ušt8_t
 
	gf‹rs
[
NINGROUP
];

75 
Group
(
ušt32_t
);

78 
Group
 *
	g_groups
[
NBUCKETS
];

79 
	g_deçuÉ_ouut
;

81 
Group
 *
fšd_group
(
ušt32_t
);

	@analysis/aggregatefirst.cc

18 
	~<şick/cÚfig.h
>

19 
	~"agg»g©efœ¡.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
CLICK_DECLS


25 
	gAgg»g©eFœ¡
::
	$Agg»g©eFœ¡
()

26 : 
	$_agg_nÙif›r
(0)

28 
	`mem£t
(
_kls
, 0, (_kills));

29 
	`mem£t
(
_couÁs
, 0, (_counts));

30 
	}
}

32 
	gAgg»g©eFœ¡
::~
	$Agg»g©eFœ¡
()

34 
	}
}

37 
Agg»g©eFœ¡
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39 
EËm’t
 *
	ge
 = 0;

41 ià(
Args
(
cÚf
, 
this
, 
”rh
)

42 .
»ad
("NOTIFIER", 
e
)

43 .
com¶‘e
() < 0)

46 ià(
	ge
 && !(
	g_agg_nÙif›r
 = (
Agg»g©eNÙif›r
 *)
e
->
ÿ¡
("AggregateNotifier")))

47  
”rh
->
”rÜ
("% i nÙ‡ÀAgg»g©eNÙif›r", 
e
->
Çme
().
c_¡r
());

53 
	gAgg»g©eFœ¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

55 ià(
_agg_nÙif›r
)

56 
_agg_nÙif›r
->
	`add_li¡’”
(
this
);

58 
	}
}

61 
	gAgg»g©eFœ¡
::
	$ş—nup
(
CËªupSge
)

63 
i
 = 0; i < 
NPLANE
; i++) {

64 ià(
ušt32_t
 **
p
 = 
_kls
[
i
]) {

65 
j
 = 0; j < 
NCOL
; j++)

66 
d–‘e
[] 
p
[
j
];

67 
d–‘e
[] 
p
;

69 
d–‘e
[] 
_couÁs
[
i
];

71 
	}
}

73 
ušt32_t
 *

74 
	gAgg»g©eFœ¡
::
	$ü—‹_row
(
ušt32_t
 
agg
)

76 
¶ª’o
 = (
agg
 >> 
PLANE_SHIFT
è& 
PLANE_MASK
;

77 ià(!
_kls
[
¶ª’o
]) {

78 ià(!(
_kls
[
¶ª’o
] = 
Ãw
 
ušt32_t
 *[
NCOL
]))

80 
	`mem£t
(
_kls
[
¶ª’o
], 0, (
ušt32_t
 *è* 
NCOL
);

81 ià(!
_agg_nÙif›r
)

83 ià(!(
_couÁs
[
¶ª’o
] = 
Ãw
 
ušt32_t
[
NCOL
 + 1])) {

84 
d–‘e
[] 
_kls
[
¶ª’o
];

85 
_kls
[
¶ª’o
] = 0;

88 
	`mem£t
(
_couÁs
[
¶ª’o
], 0, (
ušt32_t
è* (
NCOL
 + 1));

90 
ušt32_t
 **
¶ªe
 = 
_kls
[
¶ª’o
];

92 
cŞno
 = (
agg
 >> 
COL_SHIFT
è& 
COL_MASK
;

93 ià(!
¶ªe
[
cŞno
]) {

94 ià(!(
¶ªe
[
cŞno
] = 
Ãw
 
ušt32_t
[
NROW
]))

96 
	`mem£t
(
¶ªe
[
cŞno
], 0, (
ušt32_t
è* 
NROW
);

99  
¶ªe
[
cŞno
];

100 
	}
}

102 
šlše
 
Pack‘
 *

103 
	gAgg»g©eFœ¡
::
	$smaùiÚ
(
Pack‘
 *
p
)

105 
ušt32_t
 
agg
 = 
	`AGGREGATE_ANNO
(
p
);

107 ià(
ušt32_t
 *
r
 = 
	`row
(
agg
)) {

108 
r
 +ğ(
agg
 & 
ROW_MASK
) >> 5;

109 
ušt32_t
 
mask
 = 1 << (
agg
 & 0x1F);

110 ià(!(*
r
 & 
mask
)) {

111 *
r
 |ğ
mask
;

112  
p
;

116 
	`checked_ouut_push
(1, 
p
);

118 
	}
}

121 
	gAgg»g©eFœ¡
::
	$push
(, 
Pack‘
 *
p
)

123 ià((
p
 = 
	`smaùiÚ
(p)))

124 
	`ouut
(0).
	`push
(
p
);

125 
	}
}

127 
Pack‘
 *

128 
	gAgg»g©eFœ¡
::
	$puÎ
()

130 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

131 ià(
p
)

132 
p
 = 
	`smaùiÚ
(p);

133  
p
;

134 
	}
}

137 
	gAgg»g©eFœ¡
::
	$agg»g©e_nÙify
(
ušt32_t
 
agg
, 
Agg»g©eEv’t
 
ev’t
, cÚ¡ 
Pack‘
 *)

139 
¶ªe
 = (
agg
 >> 
PLANE_SHIFT
è& 
PLANE_MASK
;

140 
cŞ
 = (
agg
 >> 
COL_SHIFT
è& 
COL_MASK
;

141 
ušt32_t
 *
r
 = 
	`row
(
agg
);

142 ià(!
r
)

145 ià(
ev’t
 =ğ
NEW_AGG
) {

146 ià((++
_couÁs
[
¶ªe
][
cŞ
]) == 1)

147 
_couÁs
[
¶ªe
][
NCOL
]++;

148 } ià(
ev’t
 =ğ
DELETE_AGG
) {

149 
r
[(
agg
 & 
ROW_MASK
) >> 5] &= ~(1 << (agg & 0x1F));

150 ià((--
_couÁs
[
¶ªe
][
cŞ
]) == 0) {

152 
d–‘e
[] 
_kls
[
¶ªe
][
cŞ
];

153 
_kls
[
¶ªe
][
cŞ
] = 0;

155 ià((--
_couÁs
[
¶ªe
][
NCOL
]) == 0) {

156 
d–‘e
[] 
_couÁs
[
¶ªe
];

157 
_couÁs
[
¶ªe
] = 0;

158 
d–‘e
[] 
_kls
[
¶ªe
];

159 
_kls
[
¶ªe
] = 0;

163 
	}
}

165 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
Agg»g©eNÙif›r
)

166 
	$EXPORT_ELEMENT
(
Agg»g©eFœ¡
)

167 
CLICK_ENDDECLS


	@analysis/aggregatefirst.hh

1 #iâdeà
CLICK_AGGREGATEFIRST_HH


2 
	#CLICK_AGGREGATEFIRST_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"agg»g©’Ùif›r.hh
"

5 
CLICK_DECLS


46 
şass
 
	gAgg»g©eFœ¡
 : 
public
 
EËm’t
,…ubliø
	gAgg»g©eLi¡’”
 { 
	gpublic
:

48 
Agg»g©eFœ¡
(è
CLICK_COLD
;

49 ~
Agg»g©eFœ¡
(è
	gCLICK_COLD
;

51 cÚ¡ *
şass_Çme
() const {  "AggregateFirst"; }

52 cÚ¡ *
pÜt_couÁ
(ècÚ¡ {  
	gPORTS_1_1X2
; }

53 cÚ¡ *
´oûssšg
(ècÚ¡ {  
	gPROCESSING_A_AH
; }

55 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

56 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

57 
ş—nup
(
CËªupSge
è
	gCLICK_COLD
;

59 
šlše
 
Pack‘
 *
smaùiÚ
(Packet *);

60 
push
(, 
Pack‘
 *);

61 
Pack‘
 *
puÎ
();

63 
agg»g©e_nÙify
(
ušt32_t
, 
Agg»g©eEv’t
, cÚ¡ 
Pack‘
 *);

65 
	g´iv©e
:

67 ’um { 
ROW_BITS
 = 10, 
	gROW_SHIFT
 = 0, 
	gNROW
 = 1<<ROW_BITS, 
	gROW_MASK
 = 
NROW
 - 1,

68 
	gCOL_BITS
 = 16, 
	gCOL_SHIFT
 = 
ROW_BITS
, 
	gNCOL
 = 1<<
COL_BITS
, 
	gCOL_MASK
 = 
NCOL
 - 1,

69 
	gPLANE_BITS
 = 32 - 
ROW_BITS
 - 
COL_BITS
, 
	gPLANE_SHIFT
 = 
COL_SHIFT
 + COL_BITS, 
	gNPLANE
 = 1<<
PLANE_BITS
, 
	gPLANE_MASK
 = 
NPLANE
 - 1 };

71 
ušt32_t
 **
	g_kls
[
NPLANE
];

72 
Agg»g©eNÙif›r
 *
	g_agg_nÙif›r
;

73 
ušt32_t
 *
	g_couÁs
[
NPLANE
];

75 
ušt32_t
 *
ü—‹_row
(ušt32_ˆ
agg
);

76 
šlše
 
ušt32_t
 *
row
(ušt32_ˆ
agg
);

80 
šlše
 
ušt32_t
 *

81 
	gAgg»g©eFœ¡
::
	$row
(
ušt32_t
 
agg
)

83 ià(
ušt32_t
 **
p
 = 
_kls
[(
agg
 >> 
PLANE_SHIFT
è& 
PLANE_MASK
])

84 ià(
ušt32_t
 *
c
 = 
p
[(
agg
 >> 
COL_SHIFT
è& 
COL_MASK
])

85  
c
;

86  
	`ü—‹_row
(
agg
);

87 
	}
}

89 
	gCLICK_ENDDECLS


	@analysis/aggregateip.cc

19 
	~<şick/cÚfig.h
>

20 
	~"agg»g©e.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şickÃt/.h
>

25 
	~<şickÃt/tı.h
>

26 
	~<şickÃt/udp.h
>

27 
	~<şick/·ck‘_ªno.hh
>

28 
CLICK_DECLS


30 
	gAgg»g©eIP
::
	$Agg»g©eIP
()

32 
	}
}

34 
Agg»g©eIP
::~
	$Agg»g©eIP
()

36 
	}
}

39 
Agg»g©eIP
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41 
SŒšg
 
	g¬g
;

42 
	g_šüem’l
 = 
_unshiá__addr
 = 
çl£
;

43 ià(
Args
(
cÚf
, 
this
, 
”rh
)

44 .
»ad_mp
("FIELD", 
AnyArg
(), 
¬g
)

45 .
»ad
("INCREMENTAL", 
_šüem’l
)

46 .
»ad
("UNSHIFT_IP_ADDR", 
_unshiá__addr
)

47 .
com¶‘e
() < 0)

49 cÚ¡ *
	g’d
 = 
IPF›ld
::
·r£
(
¬g
.
begš
(),‡rg.
’d
(), -1, &
_f
, 
”rh
, 
this
);

50 ià(
	g’d
 =ğ
¬g
.
begš
())

52 ià(
	g’d
 !ğ
¬g
.
’d
())

53  
”rh
->
”rÜ
("garbage‡fter field specification");

54 
št32_t
 
	gright
 = 
_f
.
b™_off£t
(è+ _f.
b™_Ëngth
() - 1;

55 ià((
	g_f
.
b™_off£t
(è/ 32è!ğ(
right
 / 32))

56  
”rh
->
”rÜ
("field specification does‚ot fit within‡ single word");

57 ià(
	g_f
.
b™_Ëngth
() > 32)

58  
	g”rh
->
”rÜ
("field†engthoo†arge, max 32");

59 ià(
	g_f
.
b™_Ëngth
(è=ğ32 && 
_šüem’l
)

60  
”rh
->
”rÜ
("'INCREMENTAL' is incompatible with field†ength 32");

61 ià(
	g_f
.
b™_Ëngth
() == 32)

62 
_mask
 = 0xFFFFFFFFU;

64 
	g_mask
 = (1 << 
_f
.
b™_Ëngth
()) - 1;

65 
	g_off£t
 = (
_f
.
b™_off£t
() / 32) * 4;

66 ià(!
	g_unshiá__addr
 || 
	g_f
.
´Ùo
(è!ğ0 || 
_f
.
b™_off£t
() < 12*8 || _f.bit_offset() >= 20*8)

67 
_shiá
 = 31 - 
right
 % 32;

69 
	g_mask
 <<ğ31 - 
right
 % 32;

70 
	g_shiá
 = 0;

75 
Pack‘
 *

76 
	gAgg»g©eIP
::
	$bad_·ck‘
(
Pack‘
 *
p
)

78 ià(
	`nouuts
() == 2)

79 
	`ouut
(1).
	`push
(
p
);

81 
p
->
	`kl
();

83 
	}
}

85 
Pack‘
 *

86 
	gAgg»g©eIP
::
	$hªdË_·ck‘
(
Pack‘
 *
p
)

88 ià(!
p
->
	`has_ÃtwÜk_h—d”
())

89  
	`bad_·ck‘
(
p
);

91 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

92 
off£t
 = 
p
->
	`Ëngth
();

93 
_f
.
	`´Ùo
()) {

95 
off£t
 = 
p
->
	`ÃtwÜk_h—d”_off£t
();

97 
IP_PROTO_TCP_OR_UDP
:

98 ià(
	`IP_FIRSTFRAG
(
h
è&& (h->
_p
 =ğ
IP_PROTO_TCP
 || iph->_°=ğ
IP_PROTO_UDP
))

99 
off£t
 = 
p
->
	`Œª¥Üt_h—d”_off£t
();

101 
IP_PROTO_TRANSP
:

102 ià(
	`IP_FIRSTFRAG
(
h
))

103 
off£t
 = 
p
->
	`Œª¥Üt_h—d”_off£t
();

105 
IP_PROTO_PAYLOAD
:

106 ià(!
	`IP_FIRSTFRAG
(
h
))

108 ià(
h
->
_p
 =ğ
IPPROTO_TCP
 && 
p
->
	`Œª¥Üt_h—d”_off£t
(è+ (
şick_tı
è<ğp->
	`Ëngth
()) {

109 cÚ¡ 
şick_tı
 *
tıh
 = (cÚ¡ click_tı *)
p
->
	`Œª¥Üt_h—d”
();

110 
off£t
 = 
p
->
	`Œª¥Üt_h—d”_off£t
(è+ (
tıh
->
th_off
 << 2);

111 } ià(
h
->
_p
 =ğ
IPPROTO_UDP
)

112 
off£t
 = 
p
->
	`Œª¥Üt_h—d”_off£t
(è+ (
şick_udp
);

115 ià(
	`IP_FIRSTFRAG
(
h
è&& iph->
_p
 =ğ
_f
.
	`´Ùo
())

116 
off£t
 = 
p
->
	`Œª¥Üt_h—d”_off£t
();

119 
off£t
 +ğ
_off£t
;

121 ià(
off£t
 + 4 > ()
p
->
	`Ëngth
())

122  
	`bad_·ck‘
(
p
);

124 
ušt32_t
 
ud©a
 = *((cÚ¡ ušt32_ˆ*)(
p
->
	`d©a
(è+ 
off£t
));

125 
ušt32_t
 
agg
 = (
	`Áohl
(
ud©a
è>> 
_shiá
è& 
_mask
;

127 ià(
_šüem’l
)

128 
	`SET_AGGREGATE_ANNO
(
p
, (
	`AGGREGATE_ANNO
Õè<< 
_f
.
	`b™_Ëngth
()è+ 
agg
);

130 
	`SET_AGGREGATE_ANNO
(
p
, 
agg
);

132  
p
;

133 
	}
}

136 
	gAgg»g©eIP
::
	$push
(, 
Pack‘
 *
p
)

138 ià(
Pack‘
 *
q
 = 
	`hªdË_·ck‘
(
p
))

139 
	`ouut
(0).
	`push
(
q
);

140 
	}
}

142 
Pack‘
 *

143 
	gAgg»g©eIP
::
	$puÎ
()

145 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

146 ià(
p
)

147 
p
 = 
	`hªdË_·ck‘
(p);

148  
p
;

149 
	}
}

151 
SŒšg


152 
	gAgg»g©eIP
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

154 
Agg»g©eIP
 *
a
 = 
¡©ic_ÿ¡
<Agg»g©eIP *>(
e
);

155 (
šŒ_t
)
thunk
) {

157  
NameInfo
::
	`»vqu”y_št
(NameInfo::
T_IP_PROTO
, 
e
, 
a
->
_f
.
	`´Ùo
());

159  
	`SŒšg
(
a
->
_f
.
	`b™_off£t
());

161  
	`SŒšg
(
a
->
_f
.
	`b™_Ëngth
());

163  
a
->
_f
.
	`uÅ¬£
(
e
, 
çl£
);

167 
	}
}

170 
	gAgg»g©eIP
::
	$add_hªdËrs
()

172 
	`add_»ad_hªdËr
("h—d”", 
»ad_hªdËr
, 0);

173 
	`add_»ad_hªdËr
("b™_off£t", 
»ad_hªdËr
, 1);

174 
	`add_»ad_hªdËr
("b™_Ëngth", 
»ad_hªdËr
, 2);

175 
	`add_»ad_hªdËr
("f›ld", 
»ad_hªdËr
, 3);

176 
	}
}

178 
CLICK_ENDDECLS


179 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
IPF›ldInfo
)

180 
	`EXPORT_ELEMENT
(
Agg»g©eIP
)

	@analysis/aggregateip.hh

2 #iâdeà
CLICK_AGGREGATEIP_HH


3 
	#CLICK_AGGREGATEIP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~"–em’ts//f›ldšfo.hh
"

6 
CLICK_DECLS


134 şas 
	cAgg»g©eIP
 : 
public
 
EËm’t
 {…ublic:

136 
	$Agg»g©eIP
(è
CLICK_COLD
;

137 ~
	$Agg»g©eIP
(è
CLICK_COLD
;

139 cÚ¡ *
	$şass_Çme
() const {  "AggregateIP"; }

140 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

141 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

143 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

144 
	$add_hªdËrs
(è
CLICK_COLD
;

146 
	`push
(, 
Pack‘
 *);

147 
Pack‘
 *
	`puÎ
();

149 
´iv©e
:

151 
ušt32_t
 
_off£t
;

152 
ušt32_t
 
_shiá
;

153 
ušt32_t
 
_mask
;

154 
boŞ
 
_šüem’l
;

155 
boŞ
 
_unshiá__addr
;

156 
IPF›ld
 
_f
;

158 
Pack‘
 *
	`hªdË_·ck‘
(Packet *);

159 
Pack‘
 *
	`bad_·ck‘
(Packet *);

161 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

163 
	}
};

165 
	gCLICK_ENDDECLS


	@analysis/aggregateipaddrpair.cc

19 
	~<şick/cÚfig.h
>

20 
	~"agg»g©eadd½aœ.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şickÃt/.h
>

25 
	~<şickÃt/tı.h
>

26 
	~<şickÃt/udp.h
>

27 
	~<şickÃt/icmp.h
>

28 
	~<şick/·ck‘_ªno.hh
>

29 
	~<şick/hªdËrÿÎ.hh
>

30 
	gCLICK_DECLS


32 
	#SEC_OLDER
(
s1
, 
s2
è(()(s1 - s2è< 0)

	)

35 
šlše
 
boŞ


36 
	gİ”©Ü
==(cÚ¡ 
Agg»g©eIPAddrPaœ
::
Ho¡Paœ
 &
a
, cÚ¡ 
	gAgg»g©eIPAddrPaœ
::Ho¡Paœ &
b
)

38  
a
.¨=ğ
b
.a &&‡.b == b.b;

41 
šlše
 
hashcode_t


42 
	gAgg»g©eIPAddrPaœ
::
Ho¡Paœ
::
	$hashcode
() const

44  (
a
 << 12è+ 
b
 + ((a >> 20) & 0x1F);

45 
	}
}

50 
	gAgg»g©eIPAddrPaœ
::
	$Agg»g©eIPAddrPaœ
()

52 
	}
}

54 
Agg»g©eIPAddrPaœ
::~
	$Agg»g©eIPAddrPaœ
()

56 
	}
}

59 
Agg»g©eIPAddrPaœ
::
	$ÿ¡
(cÚ¡ *
n
)

61 ià(
	`¡rcmp
(
n
, "AggregateNotifier") == 0)

62  (
Agg»g©eNÙif›r
 *)
this
;

63 ià(
	`¡rcmp
(
n
, "AggregateIPAddrPair") == 0)

64  (
EËm’t
 *)
this
;

66  
EËm’t
::
	`ÿ¡
(
n
);

67 
	}
}

70 
	gAgg»g©eIPAddrPaœ
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

72 
	g_timeout
 = 0;

73 
	g_gc_š‹rv®
 = 20 * 60;

75 ià(
Args
(
cÚf
, 
this
, 
”rh
)

76 .
»ad
("TIMEOUT", 
SecÚdsArg
(), 
_timeout
)

77 .
»ad
("REAP", 
SecÚdsArg
(), 
_gc_š‹rv®
)

78 .
com¶‘e
() < 0)

85 
	gAgg»g©eIPAddrPaœ
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

87 
_Ãxt
 = 1;

88 
_aùive_£c
 = 
_gc_£c
 = 0;

89 
_time¡amp_w¬nšg
 = 
çl£
;

92 
	}
}

95 
	gAgg»g©eIPAddrPaœ
::
	$»­
()

97 ià(
_gc_£c
) {

98 
ušt32_t
 
timeout
 = 
_aùive_£c
 - 
_timeout
;

100 
VeùÜ
<
ušt32_t
> 
to_ä“
;

101 
M­
::
™”©Ü
 
™”
 = 
_m­
.
	`begš
(); i‹r.
	`live
(); iter++) {

102 
FlowInfo
 *
fšfo
 = &
™”
.
	`v®ue
();

103 ià(
	`SEC_OLDER
(
fšfo
->
Ï¡_time¡amp
.
	`£c
(), 
timeout
)) {

104 
	`nÙify
(
fšfo
->
agg»g©e
, 
Agg»g©eLi¡’”
::
DELETE_AGG
, 0);

105 
to_ä“
.
	`push_back
(
™”
.
	`key
().
a
);

106 
to_ä“
.
	`push_back
(
™”
.
	`key
().
b
);

110 
ušt32_t
 *
u
 = 
to_ä“
.
	`begš
(); u <o_ä“.
	`’d
(); u += 2)

111 
_m­
.
	`”a£
(*(cÚ¡ 
Ho¡Paœ
 *)
u
);

113 
_gc_£c
 = 
_aùive_£c
 + 
_gc_š‹rv®
;

114 
	}
}

118 
Pack‘
 *

119 
	gAgg»g©eIPAddrPaœ
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

121 ià(
p
->
	`has_ÃtwÜk_h—d”
()) {

122 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

123 
Ho¡Paœ
 
	`ho¡s
(
h
->
_¤c
.
s_addr
, iph->
_d¡
.s_addr);

124 
FlowInfo
 *
fšfo
 = &
_m­
[
ho¡s
];

126 ià(
_timeout
 > 0) {

128 ià(!
p
->
	`time¡amp_ªno
()) {

129 ià(!
_time¡amp_w¬nšg
) {

130 
	`şick_ch©‹r
("%p{–em’t}: w¬nšg:…ack‘„eûived w™houˆtime¡amp", 
this
);

131 
_time¡amp_w¬nšg
 = 
Œue
;

133 
p
->
	`time¡amp_ªno
().
	`assign_now
();

136 ià(
fšfo
->
agg»g©e
 && 
	`SEC_OLDER
(fšfo->
Ï¡_time¡amp
.
	`£c
(), 
p
->
	`time¡amp_ªno
().£c(è- 
_timeout
)) {

137 
	`nÙify
(
fšfo
->
agg»g©e
, 
Agg»g©eLi¡’”
::
DELETE_AGG
, 0);

138 
fšfo
->
agg»g©e
 = 0;

142 ià(!
fšfo
->
agg»g©e
) {

143 
fšfo
->
agg»g©e
 = 
_Ãxt
;

144 
fšfo
->
»v”£
 = (
ho¡s
.
a
 !ğ
h
->
_¤c
.
s_addr
);

145 ià(++
_Ãxt
 == 0)

146 ++
_Ãxt
;

147 
	`nÙify
(
fšfo
->
agg»g©e
, 
Agg»g©eLi¡’”
::
NEW_AGG
, 
p
);

150 ià(
_timeout
 > 0) {

151 
fšfo
->
Ï¡_time¡amp
 = 
p
->
	`time¡amp_ªno
();

152 
_aùive_£c
 = 
p
->
	`time¡amp_ªno
().
	`£c
();

153 ià(
_aùive_£c
 > 
_gc_£c
)

154 
	`»­
();

157 
	`SET_AGGREGATE_ANNO
(
p
, 
fšfo
->
agg»g©e
);

158 
·št
 = 
fšfo
->
»v”£
 ^ (
ho¡s
.
a
 !ğ
h
->
_¤c
.
s_addr
);

159 
	`SET_PAINT_ANNO
(
p
, 
·št
);

160  
p
;

163 
	`checked_ouut_push
(1, 
p
);

166 
	}
}

168 ’um { 
	mH_CLEAR
 };

171 
	gAgg»g©eIPAddrPaœ
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *)

173 
Agg»g©eIPAddrPaœ
 *
af
 = 
¡©ic_ÿ¡
<Agg»g©eIPAddrPaœ *>(
e
);

174 (
šŒ_t
)
thunk
) {

175 
H_CLEAR
: {

176 
aùive_£c
 = 
af
->
_aùive_£c
, 
gc_£c
 =‡f->
_gc_£c
;

177 
af
->
_aùive_£c
 =‡f->
_gc_£c
 = 0x7FFFFFFF;

178 
af
->
	`»­
();

179 
af
->
_aùive_£c
 = 
aùive_£c
,‡f->
_gc_£c
 = 
gc_£c
;

185 
	}
}

188 
	gAgg»g©eIPAddrPaœ
::
	$add_hªdËrs
()

190 
	`add_wr™e_hªdËr
("ş—r", 
wr™e_hªdËr
, 
H_CLEAR
);

191 
	}
}

193 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
Agg»g©eNÙif›r
)

194 
	$EXPORT_ELEMENT
(
Agg»g©eIPAddrPaœ
)

195 
CLICK_ENDDECLS


	@analysis/aggregateipaddrpair.hh

2 #iâdeà
CLICK_AGGREGATEIPADDRPAIR_HH


3 
	#CLICK_AGGREGATEIPADDRPAIR_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/hashbË.hh
>

6 
	~"agg»g©’Ùif›r.hh
"

7 
CLICK_DECLS


61 
şass
 
	gAgg»g©eIPAddrPaœ
 : 
public
 
EËm’t
,…ubliø
	gAgg»g©eNÙif›r
 { 
	gpublic
:

63 
Agg»g©eIPAddrPaœ
(è
CLICK_COLD
;

64 ~
Agg»g©eIPAddrPaœ
(è
	gCLICK_COLD
;

66 cÚ¡ *
şass_Çme
() const {  "AggregateIPAddrPair"; }

67 cÚ¡ *
pÜt_couÁ
(ècÚ¡ {  
	gPORTS_1_1X2
; }

68 cÚ¡ *
´oûssšg
(ècÚ¡ {  
	gPROCESSING_A_AH
; }

69 *
ÿ¡
(const *);

71 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

72 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

73 
add_hªdËrs
(è
	gCLICK_COLD
;

75 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

77 
	sHo¡Paœ
 {

78 
ušt32_t
 
	ga
;

79 
ušt32_t
 
	gb
;

80 
Ho¡Paœ
(è: 
a
(0), 
b
(0) { }

81 
Ho¡Paœ
(
ušt32_t
 
¯
, ušt32_ˆ
bb
) {

82 
	g¯
 > 
	gbb
 ? (
	ga
 = 
bb
, 
	gb
 = 
¯
è: (
a
 =‡a, b = bb);

84 
šlše
 
hashcode_t
 
hashcode
() const;

87 
	g´iv©e
:

89 
	sFlowInfo
 {

90 
Time¡amp
 
Ï¡_time¡amp
;

91 
ušt32_t
 
	gagg»g©e
;

92 
boŞ
 
	g»v”£
;

93 
FlowInfo
(è: 
agg»g©e
(0) { }

96 
	gHashTabË
<
	tHo¡Paœ
, 
	tFlowInfo
> 
	tM­
;

97 
M­
 
	g_m­
;

99 
	g_aùive_£c
;

100 
	g_gc_£c
;

102 
ušt32_t
 
	g_timeout
;

103 
ušt32_t
 
	g_gc_š‹rv®
;

104 
boŞ
 
	g_time¡amp_w¬nšg
;

105 
ušt32_t
 
	g_Ãxt
;

107 
»­
();

109 
wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

113 
	gCLICK_ENDDECLS


	@analysis/aggregateipflows.cc

19 
	~<şick/cÚfig.h
>

20 
	~"agg»g©eæows.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şickÃt/.h
>

25 
	~<şickÃt/tı.h
>

26 
	~<şickÃt/udp.h
>

27 
	~<şickÃt/icmp.h
>

28 
	~<şick/·ck‘_ªno.hh
>

29 
	~<şick/hªdËrÿÎ.hh
>

30 
	gCLICK_DECLS


32 
	#SEC_OLDER
(
s1
, 
s2
è(()(s1 - s2è< 0)

	)

36 
šlše
 cÚ¡ 
şick_
 *

37 
	$good__h—d”
(cÚ¡ 
Pack‘
 *
p
)

40 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

41 ià(
h
->
_p
 =ğ
IP_PROTO_ICMP
)

42  
»š‹½»t_ÿ¡
<cÚ¡ 
şick_
 *>(
p
->
	`icmp_h—d”
() + 1);

44  
h
;

45 
	}
}

47 
šlše
 
boŞ


48 
	gİ”©Ü
==(cÚ¡ 
Agg»g©eIPFlows
::
Ho¡Paœ
 &
a
, cÚ¡ 
	gAgg»g©eIPFlows
::Ho¡Paœ &
b
)

50  
a
.¨=ğ
b
.a &&‡.b == b.b;

53 
šlše
 
hashcode_t


54 
	gAgg»g©eIPFlows
::
Ho¡Paœ
::
	$hashcode
() const

56  (
a
 << 12è+ 
b
 + ((a >> 20) & 0x1F);

57 
	}
}

59 
šlše
 
boŞ


60 
	$pÜts_»v”£_Üd”
(
ušt32_t
 
pÜts
)

62  (
št32_t
è((
pÜts
 << 16) -…orts) < 0;

63 
	}
}

65 
šlše
 
ušt32_t


66 
	$æ_pÜts
(
ušt32_t
 
pÜts
)

68  ((
pÜts
 >> 16) & 0xFFFF) | (ports << 16);

69 
	}
}

74 
	gAgg»g©eIPFlows
::
	$Agg»g©eIPFlows
()

75 #ià
CLICK_USERLEVEL


76 : 
	`_Œaûšfo_fe
(0), 
	`_·ck‘_sourû
(0), 
	$_f•os_h
(0)

79 
	}
}

81 
	gAgg»g©eIPFlows
::~
	$Agg»g©eIPFlows
()

83 
	}
}

86 
Agg»g©eIPFlows
::
	$ÿ¡
(cÚ¡ *
n
)

88 ià(
	`¡rcmp
(
n
, "AggregateNotifier") == 0)

89  (
Agg»g©eNÙif›r
 *)
this
;

90 ià(
	`¡rcmp
(
n
, "AggregateIPFlows") == 0)

91  (
EËm’t
 *)
this
;

93  
EËm’t
::
	`ÿ¡
(
n
);

94 
	}
}

97 
	gAgg»g©eIPFlows
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

99 
	g_tı_timeout
 = 24 * 60 * 60;

100 
	g_tı_dÚe_timeout
 = 30;

101 
	g_udp_timeout
 = 60;

102 
	g_äagm’t_timeout
 = 30;

103 
	g_gc_š‹rv®
 = 20 * 60;

104 
	g_äagm’ts
 = 2;

105 
boŞ
 
	ghªdË_icmp_”rÜs
 = 
çl£
;

106 
boŞ
 
	gäagm’ts_·r£d
;

107 
boŞ
 
	gäagm’ts
 = 
Œue
;

109 ià(
Args
(
cÚf
, 
this
, 
”rh
)

110 .
»ad
("TCP_TIMEOUT", 
_tı_timeout
)

111 .
»ad
("TCP_DONE_TIMEOUT", 
_tı_dÚe_timeout
)

112 .
»ad
("UDP_TIMEOUT", 
SecÚdsArg
(), 
_udp_timeout
)

113 .
»ad
("FRAGMENT_TIMEOUT", 
SecÚdsArg
(), 
_äagm’t_timeout
)

114 .
»ad
("REAP", 
SecÚdsArg
(), 
_gc_š‹rv®
)

115 .
»ad
("ICMP", 
hªdË_icmp_”rÜs
)

116 #ià
CLICK_USERLEVEL


117 .
»ad
("TRACEINFO", 
F’ameArg
(), 
_Œaûšfo_f’ame
)

118 .
»ad
("SOURCE", 
EËm’tArg
(), 
_·ck‘_sourû
)

120 .
»ad
("FRAGMENTS", 
äagm’ts
).
»ad_¡©us
(
äagm’ts_·r£d
)

121 .
com¶‘e
() < 0)

124 
	g_sm®Ë¡_timeout
 = (
_tı_timeout
 < 
_tı_dÚe_timeout
 ? _tcp_timeout : _tcp_done_timeout);

125 
	g_sm®Ë¡_timeout
 = (
_sm®Ë¡_timeout
 < 
_udp_timeout
 ? _smallest_timeout : _udp_timeout);

126 
	g_hªdË_icmp_”rÜs
 = 
hªdË_icmp_”rÜs
;

127 ià(
	gäagm’ts_·r£d
)

128 
	g_äagm’ts
 = 
äagm’ts
;

133 
	gAgg»g©eIPFlows
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

135 
_Ãxt
 = 1;

136 
_aùive_£c
 = 
_gc_£c
 = 0;

137 
_time¡amp_w¬nšg
 = 
çl£
;

139 #ià
CLICK_USERLEVEL


140 ià(
_Œaûšfo_f’ame
 == "-")

141 
_Œaûšfo_fe
 = 
¡dout
;

142 ià(
_Œaûšfo_f’ame
 && !(
_Œaûšfo_fe
 = 
	`fİ’
(_Œaûšfo_f’ame.
	`c_¡r
(), "w")))

143  
”rh
->
	`”rÜ
("%s: %s", 
_Œaûšfo_f’ame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

144 ià(
_Œaûšfo_fe
) {

145 
	`årštf
(
_Œaûšfo_fe
, "<?xml version='1.0' standalone='yes'?>\n\
<trace");

147 ià(
_·ck‘_sourû
) {

148 ià(
SŒšg
 
s
 = 
HªdËrC®l
::
	`ÿÎ_»ad
(
_·ck‘_sourû
, "f’ame").
	`Œim_¥aû
())

149 
	`årštf
(
_Œaûšfo_fe
, " fe='%s'", 
s
.
	`c_¡r
());

150 (è
HªdËrC®l
::
	`»£t_»ad
(
_f•os_h
, 
_·ck‘_sourû
, "packet_filepos");

152 
	`årštf
(
_Œaûšfo_fe
, ">\n");

156 ià(
_äagm’ts
 == 2)

157 
_äagm’ts
 = !
	`šput_is_puÎ
(0);

158 ià(
_äagm’ts
 =ğ1 && 
	`šput_is_puÎ
(0))

159  
”rh
->
	`”rÜ
("'FRAGMENTSrue' is incompatible with…ull;„unhisƒlement in‡…ush context");

162 
	}
}

165 
	gAgg»g©eIPFlows
::
	$ş—nup
(
CËªupSge
)

167 
	`ş—n_m­
(
_tı_m­
);

168 
	`ş—n_m­
(
_udp_m­
);

169 #ià
CLICK_USERLEVEL


170 ià(
_Œaûšfo_fe
 && _Œaûšfo_f!ğ
¡dout
) {

171 
	`årštf
(
_Œaûšfo_fe
, "</trace>\n");

172 
	`fşo£
(
_Œaûšfo_fe
);

174 
d–‘e
 
_f•os_h
;

176 
	}
}

178 
šlše
 

179 
	gAgg»g©eIPFlows
::
	$d–‘e_æowšfo
(cÚ¡ 
Ho¡Paœ
 &
hp
, 
FlowInfo
 *
fšfo
, 
boŞ
 
»®ly_d–‘e
)

181 #ià
CLICK_USERLEVEL


182 ià(
_Œaûšfo_fe
) {

183 
StFlowInfo
 *
sšfo
 = 
¡©ic_ÿ¡
<StFlowInfØ*>(
fšfo
);

184 
IPAdd»ss
 
	`¤c
(
sšfo
->
	`»v”£
(è? 
hp
.
b
 : hp.
a
);

185 
¥Üt
 = (
	`Áohl
(
sšfo
->
_pÜts
è>> (sšfo->
	`»v”£
() ? 0 : 16)) & 0xFFFF;

186 
IPAdd»ss
 
	`d¡
(
sšfo
->
	`»v”£
(è? 
hp
.
a
 : hp.
b
);

187 
dpÜt
 = (
	`Áohl
(
sšfo
->
_pÜts
è>> (sšfo->
	`»v”£
() ? 16 : 0)) & 0xFFFF;

188 
Time¡amp
 
du¿tiÚ
 = 
sšfo
->
_Ï¡_time¡amp
 - sšfo->
_fœ¡_time¡amp
;

189 
	`årštf
(
_Œaûšfo_fe
, "<æow‡gg»g©e='%u' src='%s' spÜt='%d' d¡='%s' dpÜt='%d' begš='" 
PRITIMESTAMP
 "' duration='" PRITIMESTAMP "'",

191 
sšfo
->
_agg»g©e
,

192 
¤c
.
	`uÅ¬£
().
	`c_¡r
(), 
¥Üt
, 
d¡
.uÅ¬£().c_¡r(), 
dpÜt
,

193 
sšfo
->
_fœ¡_time¡amp
.
	`£c
(), sšfo->_fœ¡_time¡amp.
	`sub£c
(),

194 
du¿tiÚ
.
	`£c
(), du¿tiÚ.
	`sub£c
());

195 ià(
sšfo
->
_f•os
)

196 
	`årštf
(
_Œaûšfo_fe
, " f•os='%u'", 
sšfo
->
_f•os
);

197 
	`årštf
(
_Œaûšfo_fe
, ">\n\
<stream dir='0'…ackets='%d' /><stream dir='1'…ackets='%d' />\n\
</flow>\n",

200 
sšfo
->
_·ck‘s
[0], sinfo->_packets[1]);

201 ià(
»®ly_d–‘e
)

202 
d–‘e
 
sšfo
;

205 ià(
»®ly_d–‘e
)

206 
d–‘e
 
fšfo
;

207 
	}
}

210 
	gAgg»g©eIPFlows
::
	$ş—n_m­
(
M­
 &
bË
)

213 
M­
::
™”©Ü
 
™”
 = 
bË
.
	`begš
(); i‹r.
	`live
(); iter++) {

214 
Ho¡PaœInfo
 *
hpšfo
 = &
™”
.
	`v®ue
();

215 
Pack‘
 *
p
 = 
hpšfo
->
_äagm’t_h—d
) {

216 
hpšfo
->
_äagm’t_h—d
 = 
p
->
	`Ãxt
();

217 
p
->
	`kl
();

219 
FlowInfo
 *
f
 = 
hpšfo
->
_æows
) {

220 
hpšfo
->
_æows
 = 
f
->
_Ãxt
;

221 
	`d–‘e_æowšfo
(
™”
.
	`key
(), 
f
);

224 
	}
}

226 #ià
CLICK_USERLEVEL


228 
	gAgg»g©eIPFlows
::
	$¡©_Ãw_æow_hook
(cÚ¡ 
Pack‘
 *
p
, 
FlowInfo
 *
fšfo
)

230 
StFlowInfo
 *
sšfo
 = 
¡©ic_ÿ¡
<StFlowInfØ*>(
fšfo
);

231 
sšfo
->
_fœ¡_time¡amp
 = 
p
->
	`time¡amp_ªno
();

232 
sšfo
->
_f•os
 = 0;

233 ià(
_f•os_h
)

234 (è
	`IÁArg
().
	`·r£
(
_f•os_h
->
	`ÿÎ_»ad
().
	`Œim_¥aû
(), 
sšfo
->
_f•os
);

235 
	}
}

238 
šlše
 

239 
	gAgg»g©eIPFlows
::
	$·ck‘_em™_hook
(cÚ¡ 
Pack‘
 *
p
, cÚ¡ 
şick_
 *
h
, 
FlowInfo
 *
fšfo
)

242 
fšfo
->
_Ï¡_time¡amp
 = 
p
->
	`time¡amp_ªno
();

245 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
 && 
	`IP_FIRSTFRAG
(iph)

249 && 
p
->
	`Œª¥Üt_Ëngth
() >= 14

250 && 
	`PAINT_ANNO
(
p
) < 2) {

251 ià(
p
->
	`tı_h—d”
()->
th_æags
 & 
TH_RST
)

252 
fšfo
->
_æow_ov”
 = 3;

253 ià(
p
->
	`tı_h—d”
()->
th_æags
 & 
TH_FIN
)

254 
fšfo
->
_æow_ov”
 |ğ(1 << 
	`PAINT_ANNO
(
p
));

255 ià(
p
->
	`tı_h—d”
()->
th_æags
 & 
TH_SYN
)

256 
fšfo
->
_æow_ov”
 = 0;

259 #ià
CLICK_USERLEVEL


261 ià(
	`¡©s
(è&& 
	`PAINT_ANNO
(
p
) < 2) {

262 
StFlowInfo
 *
sšfo
 = 
¡©ic_ÿ¡
<StFlowInfØ*>(
fšfo
);

263 
sšfo
->
_·ck‘s
[
	`PAINT_ANNO
(
p
)]++;

266 
	}
}

269 
	gAgg»g©eIPFlows
::
	$»­_m­
(
M­
 &
bË
, 
ušt32_t
 
timeout
, ušt32_ˆ
dÚe_timeout
)

271 
timeout
 = 
_aùive_£c
 -imeout;

272 
dÚe_timeout
 = 
_aùive_£c
 - done_timeout;

273 
äag_timeout
 = 
_aùive_£c
 - 
_äagm’t_timeout
;

276 
M­
::
™”©Ü
 
™”
 = 
bË
.
	`begš
(); i‹r.
	`live
(); iter++) {

277 
Ho¡PaœInfo
 *
hpšfo
 = &
™”
.
	`v®ue
();

278 
Pack‘
 *
h—d
;

280 (
h—d
 = 
hpšfo
->
_äagm’t_h—d
)

281 && (
h—d
->
	`time¡amp_ªno
().
	`£c
(è< 
äag_timeout


282 || !
	`IP_ISFRAG
(
	`good__h—d”
(
h—d
))))

283 
	`em™_äagm’t_h—d
(
hpšfo
);

286 ià(
hpšfo
->
_äagm’t_h—d
)

290 
FlowInfo
 **
µ»v
 = &
hpšfo
->
_æows
;

291 
FlowInfo
 *
f
 = *
µ»v
;

292 
f
) {

294 ià(
	`SEC_OLDER
(
f
->
_Ï¡_time¡amp
.
	`£c
(), (f->
_æow_ov”
 =ğ3 ? 
dÚe_timeout
 : 
timeout
))) {

295 
	`nÙify
(
f
->
_agg»g©e
, 
Agg»g©eLi¡’”
::
DELETE_AGG
, 0);

296 *
µ»v
 = 
f
->
_Ãxt
;

297 
	`d–‘e_æowšfo
(
™”
.
	`key
(), 
f
);

299 
µ»v
 = &
f
->
_Ãxt
;

300 
f
 = *
µ»v
;

304 
	}
}

307 
	gAgg»g©eIPFlows
::
	$»­
()

309 ià(
_gc_£c
) {

310 
	`»­_m­
(
_tı_m­
, 
_tı_timeout
, 
_tı_dÚe_timeout
);

311 
	`»­_m­
(
_udp_m­
, 
_udp_timeout
, _udp_timeout);

313 
_gc_£c
 = 
_aùive_£c
 + 
_gc_š‹rv®
;

314 
	}
}

316 cÚ¡ 
şick_
 *

317 
	gAgg»g©eIPFlows
::
	$icmp_’ÿpsuÏ‹d_h—d”
(cÚ¡ 
Pack‘
 *
p
)

319 cÚ¡ 
şick_icmp
 *
icmph
 = 
p
->
	`icmp_h—d”
();

320 ià(
p
->
	`has_Œª¥Üt_h—d”
()

321 && (
icmph
->
icmp_ty³
 =ğ
ICMP_UNREACH


322 || 
icmph
->
icmp_ty³
 =ğ
ICMP_TIMXCEED


323 || 
icmph
->
icmp_ty³
 =ğ
ICMP_PARAMPROB


324 || 
icmph
->
icmp_ty³
 =ğ
ICMP_SOURCEQUENCH


325 || 
icmph
->
icmp_ty³
 =ğ
ICMP_REDIRECT
)) {

326 cÚ¡ 
şick_
 *
embedded_h
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_ *>(
icmph
 + 1);

327 
embedded_hËn
 = 
embedded_h
->
_hl
 << 2;

328 ià(()
p
->
	`Œª¥Üt_Ëngth
(è>ğ(
şick_icmp
è+ 
embedded_hËn


329 && 
embedded_hËn
 >ğ(
şick_
))

330  
embedded_h
;

333 
	}
}

336 
	gAgg»g©eIPFlows
::
	$»Ëvªt_timeout
(cÚ¡ 
FlowInfo
 *
f
, cÚ¡ 
M­
 &
m
) const

338 ià(&
m
 =ğ&
_udp_m­
)

339  
_udp_timeout
;

340 ià(
f
->
_æow_ov”
 == 3)

341  
_tı_dÚe_timeout
;

343  
_tı_timeout
;

344 
	}
}

348 
	gAgg»g©eIPFlows
::
FlowInfo
 *

349 
Agg»g©eIPFlows
::
	$fšd_æow_šfo
(
M­
 &
m
, 
Ho¡PaœInfo
 *
hpšfo
, 
ušt32_t
 
pÜts
, 
boŞ
 
æ³d
, cÚ¡ 
Pack‘
 *
p
)

351 
FlowInfo
 **
µ»v
 = &
hpšfo
->
_æows
;

352 
FlowInfo
 *
fšfo
 = *
µ»v
; fšfo;…´ev = &fšfo->
_Ãxt
, finfo = finfo->_next)

353 ià(
fšfo
->
_pÜts
 =ğ
pÜts
) {

356 
age
 = 
p
->
	`time¡amp_ªno
().
	`£c
(è- 
fšfo
->
_Ï¡_time¡amp
.sec();

359 ià((
age
 > (è
_sm®Ë¡_timeout


360 && 
age
 > 
	`»Ëvªt_timeout
(
fšfo
, 
m
))

361 || (
fšfo
->
_æow_ov”
 == 3

362 && 
p
->
	`_h—d”
()->
_p
 =ğ
IP_PROTO_TCP


363 && (
p
->
	`tı_h—d”
()->
th_æags
 & 
TH_SYN
))) {

365 
	`nÙify
(
fšfo
->
	`agg»g©e
(), 
Agg»g©eLi¡’”
::
DELETE_AGG
, 0);

366 cÚ¡ 
şick_
 *
h
 = 
	`good__h—d”
(
p
);

367 
Ho¡Paœ
 
	`hp
(
h
->
_¤c
.
s_addr
, iph->
_d¡
.s_addr);

368 
	`d–‘e_æowšfo
(
hp
, 
fšfo
, 
çl£
);

371 
fšfo
->
_agg»g©e
 = 
_Ãxt
;

372 
_Ãxt
++;

373 
fšfo
->
_»v”£
 = 
æ³d
;

374 
fšfo
->
_æow_ov”
 = 0;

375 #ià
CLICK_USERLEVEL


376 ià(
	`¡©s
())

377 
	`¡©_Ãw_æow_hook
(
p
, 
fšfo
);

379 
	`nÙify
(
fšfo
->
	`agg»g©e
(), 
Agg»g©eLi¡’”
::
NEW_AGG
, 
p
);

383 *
µ»v
 = 
fšfo
->
_Ãxt
;

384 
fšfo
->
_Ãxt
 = 
hpšfo
->
_æows
;

385 
hpšfo
->
_æows
 = 
fšfo
;

386  
fšfo
;

390 
FlowInfo
 *
fšfo
;

391 #ià
CLICK_USERLEVEL


392 ià(
	`¡©s
()) {

393 
fšfo
 = 
Ãw
 
	`StFlowInfo
(
pÜts
, 
hpšfo
->
_æows
, 
_Ãxt
);

394 
	`¡©_Ãw_æow_hook
(
p
, 
fšfo
);

397 
fšfo
 = 
Ãw
 
	`FlowInfo
(
pÜts
, 
hpšfo
->
_æows
, 
_Ãxt
);

399 
fšfo
->
_»v”£
 = 
æ³d
;

400 
hpšfo
->
_æows
 = 
fšfo
;

401 
_Ãxt
++;

402 
	`nÙify
(
fšfo
->
	`agg»g©e
(), 
Agg»g©eLi¡’”
::
NEW_AGG
, 
p
);

403  
fšfo
;

404 
	}
}

407 
	gAgg»g©eIPFlows
::
	$em™_äagm’t_h—d
(
Ho¡PaœInfo
 *
hpšfo
)

409 
Pack‘
 *
h—d
 = 
hpšfo
->
_äagm’t_h—d
;

410 
hpšfo
->
_äagm’t_h—d
 = 
h—d
->
	`Ãxt
();

412 cÚ¡ 
şick_
 *
h
 = 
	`good__h—d”
(
h—d
);

416 ià(
	`AGGREGATE_ANNO
(
h—d
)) {

417 
Pack‘
 *
p
 = 
hpšfo
->
_äagm’t_h—d
;…;… =…->
	`Ãxt
())

418 ià(
	`good__h—d”
(
p
)->
_id
 =ğ
h
->ip_id) {

419 
	`SET_AGGREGATE_ANNO
(
p
, 
	`AGGREGATE_ANNO
(
h—d
));

420 
	`SET_PAINT_ANNO
(
p
, 
	`PAINT_ANNO
(
h—d
));

423 
Pack‘
 *
p
 = 
hpšfo
->
_äagm’t_h—d
;…;… =…->
	`Ãxt
())

424 ià(
	`good__h—d”
(
p
)->
_id
 =ğ
h
->ip_id

425 && 
	`AGGREGATE_ANNO
(
p
)) {

426 
	`SET_AGGREGATE_ANNO
(
h—d
, 
	`AGGREGATE_ANNO
(
p
));

427 
	`SET_PAINT_ANNO
(
h—d
, 
	`PAINT_ANNO
(
p
));

428 
fšd_æowšfo
;

430 
h—d
->
	`kl
();

434 
fšd_æowšfo
:

436 
FlowInfo
 *
fšfo
, **
µ»v
 = &
hpšfo
->
_æows
;

437 
fšfo
 = *
µ»v
; fšfo;…´ev = &fšfo->
_Ãxt
, finfo = *pprev)

438 ià(
fšfo
->
_agg»g©e
 =ğ
	`AGGREGATE_ANNO
(
h—d
)) {

439 *
µ»v
 = 
fšfo
->
_Ãxt
;

440 
fšfo
->
_Ãxt
 = 
hpšfo
->
_æows
;

441 
hpšfo
->
_æows
 = 
fšfo
;

445 
	`as£¹
(
fšfo
);

446 
	`·ck‘_em™_hook
(
h—d
, 
h
, 
fšfo
);

447 
	`ouut
(0).
	`push
(
h—d
);

448 
	}
}

451 
	gAgg»g©eIPFlows
::
	$hªdË_äagm’t
(
Pack‘
 *
p
, 
Ho¡PaœInfo
 *
hpšfo
)

453 ià(
hpšfo
->
_äagm’t_h—d
)

454 
hpšfo
->
_äagm’t_
->
	`£t_Ãxt
(
p
);

456 
hpšfo
->
_äagm’t_h—d
 = 
p
;

457 
hpšfo
->
_äagm’t_
 = 
p
;

458 
p
->
	`£t_Ãxt
(0);

459 
_aùive_£c
 = 
p
->
	`time¡amp_ªno
().
	`£c
();

462 
äag_timeout
 = 
_aùive_£c
 - 
_äagm’t_timeout
;

463 
Pack‘
 *
h—d
;

464 (
h—d
 = 
hpšfo
->
_äagm’t_h—d
)

465 && (
h—d
->
	`time¡amp_ªno
().
	`£c
(è< 
äag_timeout


466 || !
	`IP_ISFRAG
(
	`good__h—d”
(
h—d
))))

467 
	`em™_äagm’t_h—d
(
hpšfo
);

469  
ACT_NONE
;

470 
	}
}

473 
	gAgg»g©eIPFlows
::
	$hªdË_·ck‘
(
Pack‘
 *
p
)

475 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

476 
·št
 = 0;

479 ià(!
p
->
	`time¡amp_ªno
()) {

480 ià(!
_time¡amp_w¬nšg
) {

481 
	`şick_ch©‹r
("%p{–em’t}: w¬nšg:…ack‘„eûived w™houˆtime¡amp", 
this
);

482 
_time¡amp_w¬nšg
 = 
Œue
;

484 
p
->
	`time¡amp_ªno
().
	`assign_now
();

488 ià(
p
->
	`has_ÃtwÜk_h—d”
(è&& 
h
->
_p
 =ğ
IP_PROTO_ICMP


489 && 
	`IP_FIRSTFRAG
(
h
è&& 
_hªdË_icmp_”rÜs
) {

490 
h
 = 
	`icmp_’ÿpsuÏ‹d_h—d”
(
p
);

491 
·št
 = 2;

495 ià(!
p
->
	`has_ÃtwÜk_h—d”
()

496 || (
h
->
_p
 !ğ
IP_PROTO_TCP
 && iph->_°!ğ
IP_PROTO_UDP
)

497 || (
h
->
_¤c
.
s_addr
 =ğ0 && iph->
_d¡
.s_addr == 0))

498  
ACT_DROP
;

501 
M­
 &
m
 = (
h
->
_p
 =ğ
IP_PROTO_TCP
 ? 
_tı_m­
 : 
_udp_m­
);

502 
Ho¡Paœ
 
	`ho¡s
(
h
->
_¤c
.
s_addr
, iph->
_d¡
.s_addr);

503 ià(
ho¡s
.
a
 !ğ
h
->
_¤c
.
s_addr
)

504 
·št
 ^= 1;

505 
Ho¡PaœInfo
 *
hpšfo
 = &
m
[
ho¡s
];

508 
FlowInfo
 *
fšfo
;

509 ià(
	`IP_FIRSTFRAG
(
h
)) {

510 cÚ¡ 
ušt8_t
 *
udp_±r
 = 
»š‹½»t_ÿ¡
<cÚ¡ ušt8_ˆ*>(
h
è+ (h->
_hl
 << 2);

511 ià(
udp_±r
 + 4 > 
p
->
	`’d_d©a
())

513  
ACT_DROP
;

515 
ušt32_t
 
pÜts
 = *
»š‹½»t_ÿ¡
<cÚ¡ ušt32_ˆ*>(
udp_±r
);

518 ià(
ho¡s
.
a
 =ğho¡s.
b
 && 
	`pÜts_»v”£_Üd”
(
pÜts
))

519 
·št
 ^= 1;

520 ià(
·št
 & 1)

521 
pÜts
 = 
	`æ_pÜts
(ports);

523 
fšfo
 = 
	`fšd_æow_šfo
(
m
, 
hpšfo
, 
pÜts
, 
·št
 & 1, 
p
);

524 ià(!
fšfo
) {

525 
	`şick_ch©‹r
("out of memory!");

526  
ACT_DROP
;

528 ià(
fšfo
->
	`»v”£
())

529 
·št
 ^= 1;

532 
	`SET_AGGREGATE_ANNO
(
p
, 
fšfo
->
	`agg»g©e
());

533 
	`SET_PAINT_ANNO
(
p
, 
·št
);

535 
fšfo
 = 0;

536 
	`SET_AGGREGATE_ANNO
(
p
, 0);

537 
	`SET_PAINT_ANNO
(
p
, 
·št
);

541 ià((
_äagm’ts
 && 
	`IP_ISFRAG
(
h
)è|| 
hpšfo
->
_äagm’t_h—d
)

542  
	`hªdË_äagm’t
(
p
, 
hpšfo
);

543 ià(!
fšfo
)

544  
ACT_DROP
;

547 
_aùive_£c
 = 
p
->
	`time¡amp_ªno
().
	`£c
();

548 
	`·ck‘_em™_hook
(
p
, 
h
, 
fšfo
);

550  
ACT_EMIT
;

551 
	}
}

554 
	gAgg»g©eIPFlows
::
	$push
(, 
Pack‘
 *
p
)

556 
aùiÚ
 = 
	`hªdË_·ck‘
(
p
);

559 ià(
_aùive_£c
 >ğ
_gc_£c
)

560 
	`»­
();

562 ià(
aùiÚ
 =ğ
ACT_EMIT
)

563 
	`ouut
(0).
	`push
(
p
);

564 ià(
aùiÚ
 =ğ
ACT_DROP
)

565 
	`checked_ouut_push
(1, 
p
);

566 
	}
}

568 
Pack‘
 *

569 
	gAgg»g©eIPFlows
::
	$puÎ
()

571 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

572 
aùiÚ
 = (
p
 ? 
	`hªdË_·ck‘
Õè: 
ACT_NONE
);

575 ià(
_aùive_£c
 >ğ
_gc_£c
)

576 
	`»­
();

578 ià(
aùiÚ
 =ğ
ACT_EMIT
)

579  
p
;

580 ià(
aùiÚ
 =ğ
ACT_DROP
)

581 
	`checked_ouut_push
(1, 
p
);

583 
	}
}

585 ’um { 
	mH_CLEAR
 };

588 
	gAgg»g©eIPFlows
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *)

590 
Agg»g©eIPFlows
 *
af
 = 
¡©ic_ÿ¡
<Agg»g©eIPFlow *>(
e
);

591 (
šŒ_t
)
thunk
) {

592 
H_CLEAR
: {

593 
aùive_£c
 = 
af
->
_aùive_£c
, 
gc_£c
 =‡f->
_gc_£c
;

594 
af
->
_aùive_£c
 =‡f->
_gc_£c
 = 0x7FFFFFFF;

595 
af
->
	`»­
();

596 
af
->
_aùive_£c
 = 
aùive_£c
,‡f->
_gc_£c
 = 
gc_£c
;

602 
	}
}

605 
	gAgg»g©eIPFlows
::
	$add_hªdËrs
()

607 
	`add_wr™e_hªdËr
("ş—r", 
wr™e_hªdËr
, 
H_CLEAR
);

608 
	}
}

610 
	$ELEMENT_REQUIRES
(
Agg»g©eNÙif›r
)

611 
	$EXPORT_ELEMENT
(
Agg»g©eIPFlows
)

612 
CLICK_ENDDECLS


	@analysis/aggregateipflows.hh

2 #iâdeà
CLICK_AGGREGATEIPFLOWS_HH


3 
	#CLICK_AGGREGATEIPFLOWS_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/æowid.hh
>

6 
	~<şick/hashbË.hh
>

7 
	~"agg»g©’Ùif›r.hh
"

8 
CLICK_DECLS


9 
şass
 
	gHªdËrC®l
;

146 
şass
 
	gAgg»g©eIPFlows
 : 
public
 
EËm’t
,…ubliø
	gAgg»g©eNÙif›r
 { 
	gpublic
:

148 
Agg»g©eIPFlows
(è
CLICK_COLD
;

149 ~
Agg»g©eIPFlows
(è
	gCLICK_COLD
;

151 cÚ¡ *
şass_Çme
() const {  "AggregateIPFlows"; }

152 *
ÿ¡
(const *);

153 cÚ¡ *
pÜt_couÁ
(ècÚ¡ {  
	gPORTS_1_1X2
; }

154 cÚ¡ *
´oûssšg
(ècÚ¡ {  
	gPROCESSING_A_AH
; }

156 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

157 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

158 
add_hªdËrs
(è
	gCLICK_COLD
;

159 
ş—nup
(
CËªupSge
è
	gCLICK_COLD
;

161 #ià
CLICK_USERLEVEL


162 
boŞ
 
¡©s
(ècÚ¡ {  
	g_Œaûšfo_fe
; }

165 
push
(, 
Pack‘
 *);

166 
Pack‘
 *
puÎ
();

168 
	sHo¡Paœ
 {

169 
ušt32_t
 
	ga
;

170 
ušt32_t
 
	gb
;

171 
Ho¡Paœ
(è: 
a
(0), 
b
(0) { }

172 
Ho¡Paœ
(
ušt32_t
 
¯
, ušt32_ˆ
bb
) {

173 
	g¯
 > 
	gbb
 ? (
	ga
 = 
bb
, 
	gb
 = 
¯
è: (
a
 =‡a, b = bb);

175 
šlše
 
hashcode_t
 
hashcode
() const;

178 
	g´iv©e
:

180 
	sFlowInfo
 {

181 
ušt32_t
 
_pÜts
;

182 
ušt32_t
 
	g_agg»g©e
;

183 
Time¡amp
 
	g_Ï¡_time¡amp
;

184 
	g_æow_ov”
 : 2;

185 
boŞ
 
	g_»v”£
 : 1;

186 
FlowInfo
 *
	g_Ãxt
;

189 
FlowInfo
(
ušt32_t
 
pÜts
, FlowInfØ*
Ãxt
, ušt32_ˆ
agg
è: 
_pÜts
ÕÜts), 
_agg»g©e
×gg), 
_æow_ov”
(0), 
_Ãxt
(next) { }

190 
ušt32_t
 
agg»g©e
(ècÚ¡ {  
	g_agg»g©e
; }

191 
boŞ
 
»v”£
(ècÚ¡ {  
	g_»v”£
; }

194 #ià
CLICK_USERLEVEL


195 
	gStFlowInfo
 : 
public
 
FlowInfo
 {

196 
Time¡amp
 
_fœ¡_time¡amp
;

197 
ušt32_t
 
	g_f•os
;

198 
ušt32_t
 
	g_·ck‘s
[2];

199 
StFlowInfo
(
ušt32_t
 
pÜts
, 
FlowInfo
 *
Ãxt
, ušt32_ˆ
agg
è: FlowInfoÕÜts,‚ext,‡ggè{ 
	g_·ck‘s
[0] = 
_·ck‘s
[1] = 0; }

203 
	sHo¡PaœInfo
 {

204 
FlowInfo
 *
	g_æows
;

205 
Pack‘
 *
	g_äagm’t_h—d
;

206 
Pack‘
 *
	g_äagm’t_
;

207 
Ho¡PaœInfo
(è: 
_æows
(0), 
_äagm’t_h—d
(0), 
_äagm’t_
(0) { }

208 
FlowInfo
 *
fšd_fÜû
(
ušt32_t
 
pÜts
);

211 
	gHashTabË
<
	tHo¡Paœ
, 
	tHo¡PaœInfo
> 
	tM­
;

212 
M­
 
	g_tı_m­
;

213 
M­
 
	g_udp_m­
;

215 
ušt32_t
 
	g_Ãxt
;

216 
	g_aùive_£c
;

217 
	g_gc_£c
;

219 
ušt32_t
 
	g_tı_timeout
;

220 
ušt32_t
 
	g_tı_dÚe_timeout
;

221 
ušt32_t
 
	g_udp_timeout
;

222 
ušt32_t
 
	g_sm®Ë¡_timeout
;

224 
	g_gc_š‹rv®
;

225 
	g_äagm’t_timeout
;

227 
boŞ
 
	g_hªdË_icmp_”rÜs
 : 1;

228 
	g_äagm’ts
 : 2;

229 
boŞ
 
	g_time¡amp_w¬nšg
 : 1;

231 #ià
CLICK_USERLEVEL


232 
FILE
 *
	g_Œaûšfo_fe
;

233 
SŒšg
 
	g_Œaûšfo_f’ame
;

235 
EËm’t
 *
	g_·ck‘_sourû
;

236 
HªdËrC®l
 *
	g_f•os_h
;

239 cÚ¡ 
şick_
 *
icmp_’ÿpsuÏ‹d_h—d”
(cÚ¡ 
Pack‘
 *);

241 
ş—n_m­
(
M­
 &);

242 
»­_m­
(
M­
 &, 
ušt32_t
, uint32_t);

243 
»­
();

245 
šlše
 
»Ëvªt_timeout
(cÚ¡ 
FlowInfo
 *, cÚ¡ 
M­
 &) const;

246 #ià
CLICK_USERLEVEL


247 
¡©_Ãw_æow_hook
(cÚ¡ 
Pack‘
 *, 
FlowInfo
 *);

249 
šlše
 
·ck‘_em™_hook
(cÚ¡ 
Pack‘
 *, cÚ¡ 
şick_
 *, 
FlowInfo
 *);

250 
šlše
 
d–‘e_æowšfo
(cÚ¡ 
Ho¡Paœ
 &, 
FlowInfo
 *, 
boŞ
 
»®ly_d–‘e
 = 
Œue
);

251 
em™_äagm’t_h—d
(
Ho¡PaœInfo
 *
hpšfo
);

252 
FlowInfo
 *
fšd_æow_šfo
(
M­
 &, 
Ho¡PaœInfo
 *, 
ušt32_t
 
pÜts
, 
boŞ
 
æ³d
, cÚ¡ 
Pack‘
 *);

254 
FlowInfo
 *
uncommÚ_ÿ£
(FlowInfØ*
fšfo
, cÚ¡ 
şick_
 *
h
);

256 ’um { 
	gACT_EMIT
, 
	gACT_DROP
, 
	gACT_NONE
 };

257 
hªdË_äagm’t
(
Pack‘
 *, 
Ho¡PaœInfo
 *);

258 
hªdË_·ck‘
(
Pack‘
 *);

260 
wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

264 
	gCLICK_ENDDECLS


	@analysis/aggregatelast.cc

18 
	~<şick/cÚfig.h
>

19 
	~"agg»g©–a¡.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
	~<şick/rou‹r.hh
>

24 
CLICK_DECLS


26 
	gAgg»g©eLa¡
::
	$Agg»g©eLa¡
()

27 : 
	`_agg_nÙif›r
(0), 
	`_ş—r_sk
(
this
), 
	$_Ãeds_ş—r
(0)

29 
	`mem£t
(
_·ck‘s
, 0, (_packets));

30 
	`mem£t
(
_couÁs
, 0, (_counts));

31 
	}
}

33 
	gAgg»g©eLa¡
::~
	$Agg»g©eLa¡
()

35 
	}
}

38 
Agg»g©eLa¡
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40 
EËm’t
 *
	ge
 = 0;

41 
	g_¡İ_aá”_ş—r
 = 
çl£
;

43 ià(
Args
(
cÚf
, 
this
, 
”rh
)

44 .
»ad
("NOTIFIER", 
e
)

45 .
»ad
("STOP_AFTER_CLEAR", 
_¡İ_aá”_ş—r
)

46 .
com¶‘e
() < 0)

49 ià(
	ge
 && !(
	g_agg_nÙif›r
 = (
Agg»g©eNÙif›r
 *)
e
->
ÿ¡
("AggregateNotifier")))

50  
”rh
->
”rÜ
("% i nÙ‡ÀAgg»g©eNÙif›r", 
e
->
Çme
().
c_¡r
());

56 
	gAgg»g©eLa¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

58 ià(
_agg_nÙif›r
)

59 
_agg_nÙif›r
->
	`add_li¡’”
(
this
);

60 
_ş—r_sk
.
	`š™Ÿlize
(
this
, 
çl£
);

62 
	}
}

65 
	gAgg»g©eLa¡
::
	$ş—nup
(
CËªupSge
)

67 
i
 = 0; i < 
NPLANE
; i++) {

68 ià(
Pack‘
 ***
p
 = 
_·ck‘s
[
i
]) {

69 
j
 = 0; j < 
NCOL
; j++)

70 ià(
Pack‘
 **
q
 = 
p
[
j
]) {

71 
k
 = 0; k < 
NROW
; k++)

72 ià(
q
[
k
])

73 
q
[
k
]->
	`kl
();

74 
d–‘e
[] 
q
;

76 
d–‘e
[] 
p
;

78 
d–‘e
[] 
_couÁs
[
i
];

80 
	}
}

82 
Pack‘
 **

83 
	gAgg»g©eLa¡
::
	$ü—‹_row
(
ušt32_t
 
agg
)

85 
¶ª’o
 = (
agg
 >> 
PLANE_SHIFT
è& 
PLANE_MASK
;

86 ià(!
_·ck‘s
[
¶ª’o
]) {

87 ià(!(
_·ck‘s
[
¶ª’o
] = 
Ãw
 
Pack‘
 **[
NCOL
]))

89 
	`mem£t
(
_·ck‘s
[
¶ª’o
], 0, (
Pack‘
 **è* 
NCOL
);

90 ià(!
_agg_nÙif›r
)

92 ià(!(
_couÁs
[
¶ª’o
] = 
Ãw
 
ušt32_t
[
NCOL
 + 1])) {

93 
d–‘e
[] 
_·ck‘s
[
¶ª’o
];

94 
_·ck‘s
[
¶ª’o
] = 0;

97 
	`mem£t
(
_couÁs
[
¶ª’o
], 0, (
ušt32_t
è* (
NCOL
 + 1));

99 
Pack‘
 ***
¶ªe
 = 
_·ck‘s
[
¶ª’o
];

101 
cŞno
 = (
agg
 >> 
COL_SHIFT
è& 
COL_MASK
;

102 ià(!
¶ªe
[
cŞno
]) {

103 ià(!(
¶ªe
[
cŞno
] = 
Ãw
 
Pack‘
 *[
NROW
]))

105 
	`mem£t
(
¶ªe
[
cŞno
], 0, (
Pack‘
 *è* 
NROW
);

108  
¶ªe
[
cŞno
];

109 
	}
}

112 
	gAgg»g©eLa¡
::
	$push
(, 
Pack‘
 *
p
)

115 ià(
_ş—r_sk
.
	`scheduËd
()) {

116 
_ş—r_sk
.
	`unscheduË
();

117 
	`run_sk
(0);

120 
ušt32_t
 
agg
 = 
	`AGGREGATE_ANNO
(
p
);

122 ià(
Pack‘
 **
r
 = 
	`row
(
agg
)) {

123 
	`¡©ic_as£¹
(
ROW_SHIFT
 == 0, "ROW_SHIFT failure.");

124 
r
 +ğ(
agg
 & 
ROW_MASK
);

125 ià(*
r
) {

126 
	`SET_EXTRA_PACKETS_ANNO
(
p
, 
	`EXTRA_PACKETS_ANNO
Õè+ 1 + EXTRA_PACKETS_ANNO(*
r
));

127 
	`SET_EXTRA_LENGTH_ANNO
(
p
, 
	`EXTRA_LENGTH_ANNO
Õè+ (*
r
)->
	`Ëngth
() + EXTRA_LENGTH_ANNO(*r));

128 
	`SET_FIRST_TIMESTAMP_ANNO
(
p
, 
	`FIRST_TIMESTAMP_ANNO
(*
r
));

129 
	`checked_ouut_push
(1, *
r
);

131 
	`SET_FIRST_TIMESTAMP_ANNO
(
p
,…->
	`time¡amp_ªno
());

132 *
r
 = 
p
;

134 
	}
}

137 
	gAgg»g©eLa¡
::
	$agg»g©e_nÙify
(
ušt32_t
 
agg
, 
Agg»g©eEv’t
 
ev’t
, cÚ¡ 
Pack‘
 *)

139 
¶ªe
 = (
agg
 >> 
PLANE_SHIFT
è& 
PLANE_MASK
;

140 
cŞ
 = (
agg
 >> 
COL_SHIFT
è& 
COL_MASK
;

141 
Pack‘
 **
r
 = 
	`row
(
agg
);

142 ià(!
r
)

144 
r
 +ğ(
agg
 & 
ROW_MASK
);

146 ià(
ev’t
 =ğ
NEW_AGG
) {

147 ià((++
_couÁs
[
¶ªe
][
cŞ
]) == 1)

148 
_couÁs
[
¶ªe
][
NCOL
]++;

149 } ià(
ev’t
 =ğ
DELETE_AGG
 && *
r
) {

151 
	`ouut
(0).
	`push
(*
r
);

152 *
r
 = 0;

153 ià((--
_couÁs
[
¶ªe
][
cŞ
]) == 0) {

155 
d–‘e
[] 
_·ck‘s
[
¶ªe
][
cŞ
];

156 
_·ck‘s
[
¶ªe
][
cŞ
] = 0;

158 ià((--
_couÁs
[
¶ªe
][
NCOL
]) == 0) {

159 
d–‘e
[] 
_couÁs
[
¶ªe
];

160 
_couÁs
[
¶ªe
] = 0;

161 
d–‘e
[] 
_·ck‘s
[
¶ªe
];

162 
_·ck‘s
[
¶ªe
] = 0;

166 
	}
}

168 
boŞ


169 
	gAgg»g©eLa¡
::
	$run_sk
(
Task
 *)

171 ià(!
_Ãeds_ş—r
)

172  
çl£
;

173 
_Ãeds_ş—r
 = 0;

176 
i
 = 0; i < 
NPLANE
; i++)

177 ià(
Pack‘
 ***
p
 = 
_·ck‘s
[
i
]) {

178 
j
 = 0; j < 
NCOL
; j++)

179 ià(
Pack‘
 **
q
 = 
p
[
j
]) {

180 
k
 = 0; k < 
NROW
; k++)

181 ià(
Pack‘
 *
r
 = 
q
[
k
])

182 
	`ouut
(0).
	`push
(
r
);

183 
d–‘e
[] 
q
;

185 
d–‘e
[] 
p
;

186 ià(
_agg_nÙif›r
)

187 
d–‘e
[] 
_couÁs
[
i
];

190 
	`mem£t
(
_·ck‘s
, 0, (_packets));

191 
	`mem£t
(
_couÁs
, 0, (_counts));

193 ià(
_¡İ_aá”_ş—r
)

194 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

195  
Œue
;

196 
	}
}

198 ’um { 
	mH_CLEAR
 };

201 
	gAgg»g©eLa¡
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *)

203 
Agg»g©eLa¡
 *
®
 = 
»š‹½»t_ÿ¡
<Agg»g©eLa¡ *>(
e
);

204 
»š‹½»t_ÿ¡
<
šŒ_t
>(
thunk
)) {

205 
H_CLEAR
:

206 
®
->
_Ãeds_ş—r
 = 1;

207 
®
->
_ş—r_sk
.
	`»scheduË
();

211 
	}
}

214 
	gAgg»g©eLa¡
::
	$add_hªdËrs
()

216 
	`add_wr™e_hªdËr
("ş—r", 
wr™e_hªdËr
, 
H_CLEAR
);

217 
	}
}

219 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
Agg»g©eNÙif›r
)

220 
	$EXPORT_ELEMENT
(
Agg»g©eLa¡
)

221 
CLICK_ENDDECLS


	@analysis/aggregatelast.hh

1 #iâdeà
CLICK_AGGREGATELAST_HH


2 
	#CLICK_AGGREGATELAST_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/sk.hh
>

5 
	~"agg»g©’Ùif›r.hh
"

6 
CLICK_DECLS


64 
şass
 
	gAgg»g©eLa¡
 : 
public
 
EËm’t
,…ubliø
	gAgg»g©eLi¡’”
 { 
	gpublic
:

66 
Agg»g©eLa¡
(è
CLICK_COLD
;

67 ~
Agg»g©eLa¡
(è
	gCLICK_COLD
;

69 cÚ¡ *
şass_Çme
() const {  "AggregateLast"; }

70 cÚ¡ *
pÜt_couÁ
(ècÚ¡ {  
	gPORTS_1_1X2
; }

71 cÚ¡ *
´oûssšg
(ècÚ¡ {  
	gPUSH
; }

73 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

74 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

75 
ş—nup
(
CËªupSge
è
	gCLICK_COLD
;

77 
push
(, 
Pack‘
 *);

78 
boŞ
 
run_sk
(
Task
 *);

80 
agg»g©e_nÙify
(
ušt32_t
, 
Agg»g©eEv’t
, cÚ¡ 
Pack‘
 *);

81 
add_hªdËrs
(è
	gCLICK_COLD
;

83 
	g´iv©e
:

85 ’um { 
ROW_BITS
 = 10, 
	gROW_SHIFT
 = 0, 
	gNROW
 = 1<<ROW_BITS, 
	gROW_MASK
 = 
NROW
 - 1,

86 
	gCOL_BITS
 = 16, 
	gCOL_SHIFT
 = 
ROW_BITS
, 
	gNCOL
 = 1<<
COL_BITS
, 
	gCOL_MASK
 = 
NCOL
 - 1,

87 
	gPLANE_BITS
 = 32 - 
ROW_BITS
 - 
COL_BITS
, 
	gPLANE_SHIFT
 = 
COL_SHIFT
 + COL_BITS, 
	gNPLANE
 = 1<<
PLANE_BITS
, 
	gPLANE_MASK
 = 
NPLANE
 - 1 };

89 
Pack‘
 ***
	g_·ck‘s
[
NPLANE
];

90 
Agg»g©eNÙif›r
 *
	g_agg_nÙif›r
;

91 
ušt32_t
 *
	g_couÁs
[
NPLANE
];

93 
Task
 
	g_ş—r_sk
;

94 
ušt32_t
 
	g_Ãeds_ş—r
;

95 
boŞ
 
	g_¡İ_aá”_ş—r
;

97 
Pack‘
 **
ü—‹_row
(
ušt32_t
 
agg
);

98 
šlše
 
Pack‘
 **
row
(
ušt32_t
 
agg
);

99 
wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

103 
šlše
 
Pack‘
 **

104 
	gAgg»g©eLa¡
::
	$row
(
ušt32_t
 
agg
)

106 ià(
Pack‘
 ***
p
 = 
_·ck‘s
[(
agg
 >> 
PLANE_SHIFT
è& 
PLANE_MASK
])

107 ià(
Pack‘
 **
c
 = 
p
[(
agg
 >> 
COL_SHIFT
è& 
COL_MASK
])

108  
c
;

109  
	`ü—‹_row
(
agg
);

110 
	}
}

112 
	gCLICK_ENDDECLS


	@analysis/aggregatelen.cc

3 
	~<şick/cÚfig.h
>

4 
	~"agg»g©–’.hh
"

5 
	~<şick/”rÜ.hh
>

6 
	~<şick/¬gs.hh
>

7 
	~<şickÃt/.h
>

8 
	~<şick/·ck‘_ªno.hh
>

9 
CLICK_DECLS


11 
	gAgg»g©eL’gth
::
	$Agg»g©eL’gth
()

13 
	}
}

15 
Agg»g©eL’gth
::~
	$Agg»g©eL’gth
()

17 
	}
}

20 
Agg»g©eL’gth
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

22 
	g_
 = 
çl£
;

23 ià(
Args
(
cÚf
, 
this
, 
”rh
)

24 .
»ad
("IP", 
_
)

25 .
com¶‘e
() < 0)

30 
Pack‘
 *

31 
	gAgg»g©eL’gth
::
	$bad_·ck‘
(
Pack‘
 *
p
)

33 ià(
	`nouuts
() == 2)

34 
	`ouut
(1).
	`push
(
p
);

36 
p
->
	`kl
();

38 
	}
}

40 
Pack‘
 *

41 
	gAgg»g©eL’gth
::
	$hªdË_·ck‘
(
Pack‘
 *
p
)

43 
off£t
;

44 ià(
_
 && !
p
->
	`has_ÃtwÜk_h—d”
())

45  
	`bad_·ck‘
(
p
);

46 ià(
_
)

47 
off£t
 = 
p
->
	`ÃtwÜk_h—d”_off£t
();

49 
off£t
 = 0;

51 
ušt32_t
 
Ën
 = 
p
->
	`Ëngth
(è- 
off£t
 + 
	`EXTRA_LENGTH_ANNO
(p);

52 
	`SET_AGGREGATE_ANNO
(
p
, 
Ën
);

54  
p
;

55 
	}
}

58 
	gAgg»g©eL’gth
::
	$push
(, 
Pack‘
 *
p
)

60 ià(
Pack‘
 *
q
 = 
	`hªdË_·ck‘
(
p
))

61 
	`ouut
(0).
	`push
(
q
);

62 
	}
}

64 
Pack‘
 *

65 
	gAgg»g©eL’gth
::
	$puÎ
()

67 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

68 ià(
p
)

69 
p
 = 
	`hªdË_·ck‘
(p);

70  
p
;

71 
	}
}

73 
CLICK_ENDDECLS


74 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

75 
	`EXPORT_ELEMENT
(
Agg»g©eL’gth
)

	@analysis/aggregatelen.hh

2 #iâdeà
CLICK_AGGREGATELEN_HH


3 
	#CLICK_AGGREGATELEN_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


43 şas 
	cAgg»g©eL’gth
 : 
public
 
EËm’t
 {…ublic:

45 
	$Agg»g©eL’gth
(è
CLICK_COLD
;

46 ~
	$Agg»g©eL’gth
(è
CLICK_COLD
;

48 cÚ¡ *
	$şass_Çme
() const {  "AggregateLength"; }

49 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

51 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

53 
push
(, 
Pack‘
 *);

54 
Pack‘
 *
puÎ
();

56 
	g´iv©e
:

58 
boŞ
 
_
;

60 
Pack‘
 *
hªdË_·ck‘
(Packet *);

61 
Pack‘
 *
bad_·ck‘
(Packet *);

65 
	gCLICK_ENDDECLS


	@analysis/aggregatenotifier.cc

2 
	~<şick/cÚfig.h
>

3 
	~"agg»g©’Ùif›r.hh
"

4 
CLICK_DECLS


7 
	gAgg»g©eLi¡’”
::
	$agg»g©e_nÙify
(
ušt32_t
, 
Agg»g©eEv’t
, cÚ¡ 
Pack‘
 *)

9 
	}
}

12 
	gAgg»g©eNÙif›r
::
	$add_li¡’”
(
Agg»g©eLi¡’”
 *
l
)

14 
i
 = 0; i < 
_li¡’”s
.
	`size
(); i++)

15 ià(
_li¡’”s
[
i
] =ğ
l
)

17 
_li¡’”s
.
	`push_back
(
l
);

18 
	}
}

21 
	gAgg»g©eNÙif›r
::
	$»move_li¡’”
(
Agg»g©eLi¡’”
 *
l
)

23 
i
 = 0; i < 
_li¡’”s
.
	`size
(); i++)

24 ià(
_li¡’”s
[
i
] =ğ
l
) {

25 
_li¡’”s
[
i
] = _li¡’”s.
	`back
();

26 
_li¡’”s
.
	`pİ_back
();

29 
	}
}

31 
CLICK_ENDDECLS


32 
ELEMENT_PROVIDES
(
Agg»g©eNÙif›r
)

	@analysis/aggregatenotifier.hh

2 #iâdeà
CLICK_AGGREGATENOTIFIER_HH


3 
	#CLICK_AGGREGATENOTIFIER_HH


	)

4 
	~<şick/veùÜ.hh
>

5 
CLICK_DECLS


6 
şass
 
	gPack‘
;

8 şas 
	cAgg»g©eLi¡’”
 { 
	mpublic
:

10 
	$Agg»g©eLi¡’”
() { }

11 
vœtu®
 ~
	$Agg»g©eLi¡’”
(è{ 
	}
}

13 
	eAgg»g©eEv’t
 { 
NEW_AGG
, 
	gDELETE_AGG
 };

14 
vœtu®
 
agg»g©e_nÙify
(
ušt32_t
, 
Agg»g©eEv’t
, cÚ¡ 
Pack‘
 *);

18 şas 
	cAgg»g©eNÙif›r
 { 
	mpublic
:

20 
	$Agg»g©eNÙif›r
() { }

21 ~
	$Agg»g©eNÙif›r
(è{ 
	}
}

23 
add_li¡’”
(
Agg»g©eLi¡’”
 *);

24 
»move_li¡’”
(
Agg»g©eLi¡’”
 *);

26 
	$nÙify
(
ušt32_t
, 
Agg»g©eLi¡’”
::
Agg»g©eEv’t
, cÚ¡ 
Pack‘
 *) const;

28 
´iv©e
:

30 
VeùÜ
<
Agg»g©eLi¡’”
 *> 
_li¡’”s
;

32 
	}
};

34 
šlše
 

35 
	gAgg»g©eNÙif›r
::
	$nÙify
(
ušt32_t
 
agg
, 
Agg»g©eLi¡’”
::
Agg»g©eEv’t
 
e
, cÚ¡ 
Pack‘
 *
p
) const

37 
i
 = 0; i < 
_li¡’”s
.
	`size
(); i++)

38 
_li¡’”s
[
i
]->
	`agg»g©e_nÙify
(
agg
, 
e
, 
p
);

39 
	}
}

41 
	gCLICK_ENDDECLS


	@analysis/aggregatepaint.cc

18 
	~<şick/cÚfig.h
>

19 
	~"agg»g©•ašt.hh
"

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
CLICK_DECLS


25 
	gAgg»g©ePašt
::
	$Agg»g©ePašt
()

27 
	}
}

29 
Agg»g©ePašt
::~
	$Agg»g©ePašt
()

31 
	}
}

34 
Agg»g©ePašt
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
	g_b™s
 = 8;

37 
	g_šüem’l
 = 
çl£
;

38 ià(
Args
(
cÚf
, 
this
, 
”rh
)

39 .
»ad_p
("BITS", 
_b™s
)

40 .
»ad
("INCREMENTAL", 
_šüem’l
)

41 .
com¶‘e
() < 0)

43 ià(
	g_b™s
 <ğ0 || 
_b™s
 > 8)

44  
”rh
->
”rÜ
("bad‚umber of bits");

48 
Pack‘
 *

49 
	gAgg»g©ePašt
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

51 
ušt32_t
 
agg
 = 
	`PAINT_ANNO
(
p
è& ((1 << 
_b™s
) - 1);

53 ià(
_šüem’l
)

54 
	`SET_AGGREGATE_ANNO
(
p
, (
	`AGGREGATE_ANNO
Õè<< 
_b™s
è+ 
agg
);

56 
	`SET_AGGREGATE_ANNO
(
p
, 
agg
);

58  
p
;

59 
	}
}

61 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

62 
	$EXPORT_ELEMENT
(
Agg»g©ePašt
)

63 
CLICK_ENDDECLS


	@analysis/aggregatepaint.hh

2 #iâdeà
CLICK_AGGREGATEPAINT_HH


3 
	#CLICK_AGGREGATEPAINT_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


41 şas 
	cAgg»g©ePašt
 : 
public
 
EËm’t
 {…ublic:

43 
	$Agg»g©ePašt
(è
CLICK_COLD
;

44 ~
	$Agg»g©ePašt
(è
CLICK_COLD
;

46 cÚ¡ *
	$şass_Çme
() const {  "AggregatePaint"; }

47 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

49 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

51 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

53 
	g´iv©e
:

55 
_b™s
;

56 
boŞ
 
	g_šüem’l
;

60 
	gCLICK_ENDDECLS


	@analysis/anonipaddr.cc

19 
	~<şick/cÚfig.h
>

20 
	~"ªÚaddr.hh
"

21 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şickÃt/.h
>

25 
	~<şickÃt/udp.h
>

26 
	~<şickÃt/icmp.h
>

27 
	~<şick/Î½c.h
>

28 
	~<şick/š‹g”s.hh
>

29 #ifdeà
CLICK_USERLEVEL


30 
	~<uni¡d.h
>

31 
	~<time.h
>

33 
CLICK_DECLS


35 
	gAnÚymizeIPAddr
::
	$AnÚymizeIPAddr
()

36 : 
	`_roÙ
(0), 
	$_ä“
(0)

38 
	}
}

40 
	gAnÚymizeIPAddr
::~
	$AnÚymizeIPAddr
()

42 
	}
}

44 
AnÚymizeIPAddr
::
Node
 *

45 
AnÚymizeIPAddr
::
	$Ãw_node_block
()

47 
	`as£¹
(!
_ä“
);

48 
block_size
 = 1024;

49 
Node
 *
block
 = 
Ãw
 Node[
block_size
];

50 ià(!
block
)

52 
_blocks
.
	`push_back
(
block
);

53 
i
 = 1; i < 
block_size
 - 1; i++)

54 
block
[
i
].
chd
[0] = &block[i+1];

55 
block
[
block_size
 - 1].
chd
[0] = 0;

56 
_ä“
 = &
block
[1];

57  &
block
[0];

58 
	}
}

60 
šlše
 
ušt32_t


61 
	$¿nd32
()

63  
	`şick_¿ndom
(0, 0xFFFFFFFFU);

64 
	}
}

67 
	gAnÚymizeIPAddr
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

69 
	g_´e£rve_şass
 = 0;

70 
SŒšg
 
	g´e£rve_8
;

71 
boŞ
 
	g£ed_ignÜed
;

73 ià(
Args
(
cÚf
, 
this
, 
”rh
)

74 .
»ad
("CLASS", 
_´e£rve_şass
)

75 .
»ad
("PRESERVE_8", 
AnyArg
(), 
´e£rve_8
)

76 .
»ad
("SEED", 
£ed_ignÜed
)

77 .
com¶‘e
() < 0)

81 ià(
	g_´e£rve_şass
 == 99)

82 
_´e£rve_şass
 = 32;

83 ià(
	g_´e£rve_şass
 > 32)

84 
	g”rh
->
”rÜ
("CLASS must be between 0‡nd 32");

87 ià(
	g´e£rve_8
) {

88 
	gVeùÜ
<
	gSŒšg
> 
	gwÜds
;

89 
	gwh©
;

90 
ı_¥aûvec
(
´e£rve_8
, 
wÜds
);

91 
	gi
 = 0; i < 
	gwÜds
.
size
(); i++)

92 ià(
IÁArg
().
·r£
(
wÜds
[
i
], 
wh©
è&& 
	gwh©
 >= 0 && what < 256)

93 
_´e£rve_8
.
push_back
(
wh©
);

95  
	g”rh
->
”rÜ
("PRESERVE_8ƒxpects integer between 0‡nd 255");

102 
	gAnÚymizeIPAddr
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

104 ià(!(
_roÙ
 = 
	`Ãw_node
()))

105  
”rh
->
	`”rÜ
("out of memory!");

106 
_roÙ
->
šput
 = 1;

107 
_roÙ
->
ouut
 = 
	`¿nd32
();

108 
_roÙ
->
chd
[0] = _root->child[1] = 0;

109 
boŞ
 
roÙ_touched
 = 
çl£
;

112 ià(
_´e£rve_şass
 > 0) {

113 
	`as£¹
((0xFFFFFFFFU >> 1) == 0x7FFFFFFFU);

114 
ušt32_t
 
şass_mask
 = ~(0xFFFFFFFFU >> 
_´e£rve_şass
);

115 
_roÙ
->
šput
 = 
şass_mask
;

116 
_roÙ
->
ouut
 |ğ
şass_mask
;

117 
roÙ_touched
 = 
Œue
;

121 
i
 = 0; i < 
_´e£rve_8
.
	`size
(); i++) {

122 
ušt32_t
 
addr
 = (
_´e£rve_8
[
i
] << 24);

123 ià(!
roÙ_touched
) {

124 
_roÙ
->
šput
 = 
addr
;

125 
_roÙ
->
ouut
 = (_roÙ->ouuˆ& 0x00FFFFFFè| 
addr
;

126 
roÙ_touched
 = 
Œue
;

127 } ià(
Node
 *
n
 = 
	`fšd_node
(
addr
))

128 
n
->
ouut
 = (n->ouuˆ& 0x00FFFFFFè| 
addr
;

130  
”rh
->
	`”rÜ
("out of memory!");

134 
	`mem£t
(&
_¥ecŸl_nodes
[0], 0, (_special_nodes));

135 
_¥ecŸl_nodes
[0].
šput
 = _¥ecŸl_nodes[0].
ouut
 = 0;

136 
_¥ecŸl_nodes
[1].
šput
 = _¥ecŸl_nodes[1].
ouut
 = 0xFFFFFFFF;

139 
	}
}

142 
	gAnÚymizeIPAddr
::
	$ş—nup
(
CËªupSge
)

144 
i
 = 0; i < 
_blocks
.
	`size
(); i++)

145 
d–‘e
[] 
_blocks
[
i
];

146 
_blocks
.
	`ş—r
();

147 
	}
}

149 
ušt32_t


150 
	gAnÚymizeIPAddr
::
	$make_ouut
(
ušt32_t
 
Şd_ouut
, 
swiv–
) const

153 ià(
swiv–
 == 32)

154  
Şd_ouut
 ^ 1;

157 
ušt32_t
 
known_·¹
 =

158 ((
Şd_ouut
 >> (32 - 
swiv–
)) ^ 1) << (32 - swivel);

160  
known_·¹
 | ((
	`¿nd32
(è& 0x7FFFFFFFè>> 
swiv–
);

162 
	}
}

164 
	gAnÚymizeIPAddr
::
Node
 *

165 
AnÚymizeIPAddr
::
	$make_³”
(
ušt32_t
 
a
, 
Node
 *
n
)

168 ià(
a
 == 0 ||‡ == 0xFFFFFFFFU)

169  &
_¥ecŸl_nodes
[
a
 & 1];

177 
Node
 *
down
[2];

178 ià(!(
down
[0] = 
	`Ãw_node
()))

180 ià(!(
down
[1] = 
	`Ãw_node
())) {

181 
	`ä“_node
(
down
[0]);

186 
swiv–
 = 
	`ffs_msb
(
a
 ^ 
n
->
šput
);

188 
b™v®ue
 = (
a
 >> (32 - 
swiv–
)) & 1;

190 
down
[
b™v®ue
]->
šput
 = 
a
;

191 
down
[
b™v®ue
]->
ouut
 = 
	`make_ouut
(
n
->ouut, 
swiv–
);

192 
down
[
b™v®ue
]->
chd
[0] = down[bitvalue]->child[1] = 0;

194 *
down
[1 - 
b™v®ue
] = *
n
;

196 
n
->
šput
 = 
down
[1]->input;

197 
n
->
ouut
 = 
down
[1]->output;

198 
n
->
chd
[0] = 
down
[0];

199 
n
->
chd
[1] = 
down
[1];

201  
down
[
b™v®ue
];

202 
	}
}

204 
	gAnÚymizeIPAddr
::
Node
 *

205 
AnÚymizeIPAddr
::
	$fšd_node
(
ušt32_t
 
a
)

208 
Node
 *
n
 = 
_roÙ
;

209 
n
) {

210 ià(
n
->
šput
 =ğ
a
)

211  
n
;

212 ià(!
n
->
chd
[0])

213 
n
 = 
	`make_³”
(
a
,‚);

216 
swiv–
 = 
	`ffs_msb
(
n
->
chd
[0]->
šput
 ^‚->child[1]->input);

217 ià(
	`ffs_msb
(
a
 ^ 
n
->
šput
è< 
swiv–
)

218 
n
 = 
	`make_³”
(
a
,‚);

219 ià(
a
 & (1 << (32 - 
swiv–
)))

220 
n
 =‚->
chd
[1];

222 
n
 =‚->
chd
[0];

226 
	`şick_ch©‹r
("AnonymizeIPAddr: out of memory!");

228 
	}
}

230 
šlše
 
ušt32_t


231 
	gAnÚymizeIPAddr
::
	$ªÚymize_addr
(
ušt32_t
 
a
)

233 ià(
Node
 *
n
 = 
	`fšd_node
(
	`Áohl
(
a
)))

234  
	`htÚl
(
n
->
ouut
);

237 
	}
}

240 
	gAnÚymizeIPAddr
::
	$hªdË_icmp
(
Wr™abËPack‘
 *
q
)

242 
şick_icmp
 *
icmph
 = 
q
->
	`icmp_h—d”
();

243 ià(
icmph
->
icmp_ty³
 =ğ
ICMP_UNREACH
 || icmph->icmp_ty³ =ğ
ICMP_TIMXCEED


244 || 
icmph
->
icmp_ty³
 =ğ
ICMP_PARAMPROB


245 || 
icmph
->
icmp_ty³
 =ğ
ICMP_SOURCEQUENCH


246 || 
icmph
->
icmp_ty³
 =ğ
ICMP_REDIRECT
) {

248 
şick_
 *
embedded_h
 = 
»š‹½»t_ÿ¡
<şick_ *>(
icmph
 + 1);

249 
hËn
 = 
embedded_h
->
_hl
 << 2;

250 ià(
q
->
	`Œª¥Üt_Ëngth
(è< ()((
şick_icmp
è+ 
hËn
 + 8)

251 || 
hËn
 < (
şick_
))

254 
ušt32_t
 
¤c
 = 
embedded_h
->
_¤c
.
s_addr
, 
d¡
 =ƒmbedded_h->
_d¡
.s_addr;

258 
ušt32_t
 
icmp_sum
 = (~
icmph
->
icmp_cksum
 & 0xFFFF)

259 + (~
¤c
 & 0xFFFFè+ (~¤ø>> 16è+ (~
d¡
 & 0xFFFF) + (~dst >> 16);

261 
embedded_h
->
_¤c
.
s_addr
 = 
¤c
 = 
	`ªÚymize_addr
(src);

262 
embedded_h
->
_d¡
.
s_addr
 = 
d¡
 = 
	`ªÚymize_addr
(dst);

264 
icmp_sum
 +ğ(
¤c
 & 0xFFFFè+ (¤ø>> 16è+ (
d¡
 & 0xFFFF) + (dst >> 16);

265 
icmp_sum
 = (icmp_sum & 0xFFFF) + (icmp_sum >> 16);

266 
icmph
->
icmp_cksum
 = ~(
icmp_sum
 + (icmp_sum >> 16));

270 
	}
}

272 
Pack‘
 *

273 
	gAnÚymizeIPAddr
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

275 cÚ¡ 
şick_
 *
š_h
 = 
p
->
	`_h—d”
();

276 ià(!
p
->
	`has_ÃtwÜk_h—d”
(è|| 
š_h
->
_v
 != 4) {

277 
	`checked_ouut_push
(1, 
p
);

279 } ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
()) {

280 
şick_
 *
h
 = 
q
->
	`_h—d”
();

281 
ušt32_t
 
¤c
 = 
h
->
_¤c
.
s_addr
, 
d¡
 = iph->
_d¡
.s_addr;

285 
ušt32_t
 
sum
 = (~
h
->
_sum
 & 0xFFFF)

286 + (~
¤c
 & 0xFFFFè+ (~¤ø>> 16è+ (~
d¡
 & 0xFFFF) + (~dst >> 16);

288 
h
->
_¤c
.
s_addr
 = 
¤c
 = 
	`ªÚymize_addr
(src);

289 
h
->
_d¡
.
s_addr
 = 
d¡
 = 
	`ªÚymize_addr
(dst);

291 
sum
 +ğ(
¤c
 & 0xFFFFè+ (¤ø>> 16è+ (
d¡
 & 0xFFFF) + (dst >> 16);

292 
sum
 = (sum & 0xFFFF) + (sum >> 16);

293 
h
->
_sum
 = ~(
sum
 + (sum >> 16));

296 ià(
h
->
_p
 =ğ
IP_PROTO_ICMP
)

297 
	`hªdË_icmp
(
q
);

299  
q
;

302 
	}
}

305 
	gAnÚymizeIPAddr
::
	$Î½c
(
commªd
, *
d©a
)

307 ià(
commªd
 =ğ
CLICK_LLRPC_MAP_IPADDRESS
) {

309 
ušt32_t
 *
v®
 = 
»š‹½»t_ÿ¡
<ušt32_ˆ*>(
d©a
);

310 *
v®
 = 
	`ªÚymize_addr
(*val);

314  
EËm’t
::
	`Î½c
(
commªd
, 
d©a
);

315 
	}
}

317 
CLICK_ENDDECLS


318 
EXPORT_ELEMENT
(
AnÚymizeIPAddr
)

	@analysis/anonipaddr.hh

2 #iâdeà
CLICK_ANONIPADDR_HH


3 
	#CLICK_ANONIPADDR_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


94 şas 
	cAnÚymizeIPAddr
 : 
public
 
EËm’t
 {…ublic:

96 
	$AnÚymizeIPAddr
(è
CLICK_COLD
;

97 ~
	$AnÚymizeIPAddr
(è
CLICK_COLD
;

99 cÚ¡ *
	$şass_Çme
() const {  "AnonymizeIPAddr"; }

100 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

102 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

103 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

104 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

106 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

108 
	`Î½c
(, *);

110 
´iv©e
:

112 
	sNode
 {

113 
ušt32_t
 
šput
;

114 
ušt32_t
 
ouut
;

115 
Node
 *
chd
[2];

116 
	}
};

118 
Node
 *
	g_roÙ
;

119 
Node
 *
	g_ä“
;

120 
	gVeùÜ
<
	gNode
 *> 
	g_blocks
;

121 
Node
 
	g_¥ecŸl_nodes
[2];

123 
	g_´e£rve_şass
;

124 
	gVeùÜ
<
	gušt32_t
> 
	g_´e£rve_8
;

126 
Node
 *
Ãw_node
();

127 
Node
 *
Ãw_node_block
();

128 
ä“_node
(
Node
 *);

130 
ušt32_t
 
	$make_ouut
(
ušt32_t
, ) const;

131 
Node
 *
	`make_³”
(
ušt32_t
, Node *);

132 
Node
 *
	`fšd_node
(
ušt32_t
);

133 
šlše
 
ušt32_t
 
	`ªÚymize_addr
(uint32_t);

135 
	`hªdË_icmp
(
Wr™abËPack‘
 *);

137 
	}
};

139 
šlše
 
	gAnÚymizeIPAddr
::
Node
 *

140 
AnÚymizeIPAddr
::
	$Ãw_node
()

142 ià(
_ä“
) {

143 
Node
 *
n
 = 
_ä“
;

144 
_ä“
 = 
n
->
chd
[0];

145  
n
;

147  
	`Ãw_node_block
();

148 
	}
}

150 
šlše
 

151 
	gAnÚymizeIPAddr
::
	$ä“_node
(
Node
 *
n
)

153 
n
->
chd
[0] = 
_ä“
;

154 
_ä“
 = 
n
;

155 
	}
}

157 
	gCLICK_ENDDECLS


	@analysis/eraseippayload.cc

19 
	~<şick/cÚfig.h
>

20 
	~"”a£·ylßd.hh
"

21 
	~<şickÃt/tı.h
>

22 
	~<şickÃt/udp.h
>

23 
CLICK_DECLS


25 
	gE¿£IPPaylßd
::
	$E¿£IPPaylßd
()

27 
	}
}

29 
E¿£IPPaylßd
::~
	$E¿£IPPaylßd
()

31 
	}
}

33 
Pack‘
 *

34 
E¿£IPPaylßd
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

36 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

37 ià(!
p
)

40 
şick_
 *

 = 
p
->
	`_h—d”
();

41 ià(

->
_p
 =ğ
IP_PROTO_TCP
) {

42 
off
 = 
p
->
	`Œª¥Üt_h—d”_off£t
(è+ (p->
	`tı_h—d”
()->
th_off
 << 2);

43 ià(
off
 < (è
p
->
	`Ëngth
())

44 
	`mem£t
(
p
->
	`d©a
(è+ 
off
, 0,…->
	`Ëngth
() - off);

45 ià(
p
->
	`Œª¥Üt_h—d”_off£t
(è+ 18 <ğ(èp->
	`Ëngth
())

46 
p
->
	`tı_h—d”
()->
th_sum
 = 0;

47 } ià(

->
_p
 =ğ
IP_PROTO_UDP
) {

48 
off
 = 
p
->
	`Œª¥Üt_h—d”_off£t
(è+ (
şick_udp
);

49 ià(
off
 < (è
p
->
	`Ëngth
())

50 
	`mem£t
(
p
->
	`d©a
(è+ 
off
, 0,…->
	`Ëngth
() - off);

51 ià(
p
->
	`Œª¥Üt_h—d”_off£t
(è+ 8 <ğ(èp->
	`Ëngth
())

52 
p
->
	`udp_h—d”
()->
uh_sum
 = 0;

53 } ià(

->
_p
 =ğ
IP_PROTO_ICMP
) {

56 
p
->
	`kl
();

60  
p
;

61 
	}
}

63 
CLICK_ENDDECLS


64 
	$EXPORT_ELEMENT
(
E¿£IPPaylßd
)

65 
	`ELEMENT_MT_SAFE
(
E¿£IPPaylßd
)

	@analysis/eraseippayload.hh

2 #iâdeà
CLICK_ERASEIPPAYLOAD_HH


3 
	#CLICK_ERASEIPPAYLOAD_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/glue.hh
>

6 
	~<şick/©omic.hh
>

7 
	~<şickÃt/.h
>

8 
CLICK_DECLS


26 şas 
	cE¿£IPPaylßd
 : 
public
 
EËm’t
 {…ublic:

28 
	$E¿£IPPaylßd
(è
CLICK_COLD
;

29 ~
	$E¿£IPPaylßd
(è
CLICK_COLD
;

31 cÚ¡ *
	$şass_Çme
() const {  "EraseIPPayload"; }

32 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

34 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

38 
	gCLICK_ENDDECLS


	@analysis/fromcapdump.cc

19 
	~<şick/cÚfig.h
>

21 
	~"äomÿpdump.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/glue.hh
>

27 
	~<şickÃt/.h
>

28 
	~<şickÃt/tı.h
>

29 
	~<şick/·ck‘_ªno.hh
>

30 
	~<şick/u£ruts.hh
>

31 
	~<uni¡d.h
>

32 
	~<sys/ty³s.h
>

33 
	~<sys/¡©.h
>

34 
	~<fú.h
>

35 
CLICK_DECLS


37 
	gFromC­Dump
::
	$FromC­Dump
()

38 : 
	`_æowid
(
	`IPAdd»ss
(
	`htÚl
(0x01000001)), 
	`htÚs
(1), IPAddress(htonl(0x02000002)), htons(2)),

39 
	`_æowid_is_rcv
(
çl£
), 
	`_agg»g©e
(1), 
	`_p2s_m­
(1024, 
NO_SEQNO
),

40 
	$_sk
(
this
)

42 
_p2s_m­
[0] = 0;

43 
_ff
.
	`£t_Ïndm¬k_·‰”n
("%f:%l");

44 
	}
}

46 
	gFromC­Dump
::~
	$FromC­Dump
()

48 
	}
}

51 
FromC­Dump
::
	$ÿ¡
(cÚ¡ *
n
)

53 ià(
	`¡rcmp
(
n
, 
NÙif›r
::
EMPTY_NOTIFIER
è=ğ0 && !
	`ouut_is_push
(0))

54  
¡©ic_ÿ¡
<
NÙif›r
 *>(&
_nÙif›r
);

56  
EËm’t
::
	`ÿ¡
(
n
);

57 
	}
}

60 
	gFromC­Dump
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

62 
boŞ
 
	g¡İ
 = 
çl£
, 
	gaùive
 = 
Œue
, 
	gz”o
 =rue, 
	gchecksum
 = false;

63 
	g_§m¶šg_´ob
 = (1 << 
SAMPLING_SHIFT
);

65 ià(
Args
(
cÚf
, 
this
, 
”rh
)

66 .
»ad_mp
("FILENAME", 
F’ameArg
(), 
_ff
.
f’ame
())

67 .
»ad
("STOP", 
¡İ
)

68 .
»ad
("ACTIVE", 
aùive
)

69 .
»ad
("ZERO", 
z”o
)

70 .
»ad
("CHECKSUM", 
checksum
)

71 .
»ad
("AGGREGATE", 
_agg»g©e
)

72 .
»ad
("SAMPLE", 
FixedPoštArg
(
SAMPLING_SHIFT
), 
_§m¶šg_´ob
)

73 .
com¶‘e
() < 0)

75 ià(
	g_§m¶šg_´ob
 > (1 << 
	gSAMPLING_SHIFT
)) {

76 
	g”rh
->
w¬nšg
("SAMPLE…robability„educedo 1");

77 
	g_§m¶šg_´ob
 = (1 << 
SAMPLING_SHIFT
);

78 } ià(
	g_§m¶šg_´ob
 == 0)

79 
”rh
->
w¬nšg
("SAMPLE…robability is 0;ƒmitting‚o…ackets");

81 
	g_¡İ
 = 
¡İ
;

82 
	g_aùive
 = 
aùive
;

83 
	g_z”o
 = 
z”o
;

84 
	g_checksum
 = 
checksum
;

89 
	gFromC­Dump
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

92 ià(!
	`ouut_is_push
(0))

93 
_nÙif›r
.
	`š™Ÿlize
(
NÙif›r
::
EMPTY_NOTIFIER
, 
	`rou‹r
());

95 ià(
_ff
.
	`š™Ÿlize
(
”rh
) < 0)

98 ià(
	`ouut_is_push
(0))

99 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_aùive
, 
”rh
);

101 
	}
}

104 
	gFromC­Dump
::
	$ş—nup
(
CËªupSge
)

106 
_ff
.
	`ş—nup
();

107 
	}
}

109 
ušt32_t


110 
	gFromC­Dump
::
	$·ckno2£qno
(
ušt32_t
 
p
)

112 
p
 + 1 >ğ(
ušt32_t
è
_p2s_m­
.
	`size
())

113 
_p2s_m­
.
	`»size
(_p2s_m­.
	`size
(è* 2, 
NO_SEQNO
);

114 ià(
_p2s_m­
[
p
] =ğ
NO_SEQNO
) {

115 
ušt32_t
 
p2
 = 
p
;

116 
_p2s_m­
[
p2
 - 1] =ğ
NO_SEQNO
)

117 
p2
--;

118 
·ck‘_Ën
 = (
p2
 > 1 ? 
_p2s_m­
[p2 - 1] - _p2s_map[p2 - 2] : 1460);

119 ; 
p2
 <ğ
p
;…2++)

120 
_p2s_m­
[
p2
] = _p2s_m­[p2 - 1] + 
·ck‘_Ën
;

122  
_p2s_m­
[
p
];

123 
	}
}

125 
ušt32_t


126 
	gFromC­Dump
::
	$·ckno2£qno
(
ušt32_t
 
p
, 
Ën
)

128 
ušt32_t
 
£qno
 = 
	`·ckno2£qno
(
p
);

129 ià(!(
_p2s_m­
[
p
 + 1] =ğ
NO_SEQNO
 || _p2s_m­[°+ 1] =ğ
£qno
 + 
Ën
))

130 
	`şick_ch©‹r
(" % >> %u %u %u", 
_ff
.
	`Ïndm¬k
().
	`c_¡r
(), 
p
+1, 
_p2s_m­
[p+1], 
£qno
 + 
Ën
);

131 
	`as£¹
(
_p2s_m­
[
p
 + 1] =ğ
NO_SEQNO
 || _p2s_m­[°+ 1] =ğ
£qno
 + 
Ën
);

132 
_p2s_m­
[
p
 + 1] = 
£qno
 + 
Ën
;

133  
£qno
;

134 
	}
}

137 
	$£t_checksums
(
Wr™abËPack‘
 *
q
, 
şick_
 *
h
)

139 
	`as£¹
(
h
 =ğ
q
->
	`_h—d”
());

141 
h
->
_sum
 = 0;

142 
h
->
_sum
 = 
	`şick_š_cksum
((
ušt8_t
 *)h, iph->
_hl
 << 2);

144 
şick_tı
 *
tıh
 = 
q
->
	`tı_h—d”
();

145 
tıh
->
th_sum
 = 0;

146 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
tıh
, 
q
->
	`Œª¥Üt_Ëngth
());

147 
tıh
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 
h
, 
q
->
	`Œª¥Üt_Ëngth
());

148 
	}
}

150 
Pack‘
 *

151 
	gFromC­Dump
::
	$»ad_·ck‘
(
E¼ÜHªdËr
 *
”rh
)

154 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(0, (cÚ¡ *)0, (
şick_
è+ (
şick_tı
), 60);

155 ià(!
q
) {

156 
_ff
.
	`”rÜ
(
”rh
, 
	`¡»¼Ü
(
ENOMEM
));

159 ià(
_z”o
)

160 
	`mem£t
(
q
->
	`d©a
(), 0, q->
	`Ëngth
());

161 
q
->
	`£t_ÃtwÜk_h—d”
(q->
	`d©a
(), (
şick_
));

162 
şick_
 *
h
 = 
q
->
	`_h—d”
();

163 
h
->
_v
 = 4;

164 
h
->
_hl
 = (
şick_
) >> 2;

165 
h
->
_p
 = 
IP_PROTO_TCP
;

166 
h
->
_off
 = 0;

167 
şick_tı
 *
tıh
 = 
q
->
	`tı_h—d”
();

168 
tıh
->
th_wš
 = 
	`htÚs
(65535);

170 
SŒšg
 
lše
;

174 ià(
_ff
.
	`»ad_lše
(
lše
, 
”rh
, 
Œue
) <= 0) {

175 
q
->
	`kl
();

179 cÚ¡ *
d©a
 = 
lše
.
	`begš
();

180 cÚ¡ *
’d
 = 
lše
.
	`’d
();

181 
ušt32_t
 
u1
, 
u2
;

183 ià(
d©a
 + 3 >ğ
’d
 || data[0] == '!' || data[0] == '#'

184 || !
	`is¥aû
((è
d©a
[3]))

187 ià((
d©a
[0] != 'D' || data[1] != 'A' || data[2] != 'T')

188 && (
d©a
[0] != 'A' || data[1] != 'C' || data[2] != 'K')

189 && (
d©a
[0] != 'S' || data[1] != 'Y' || data[2] != 'N')) {

191 ià((
d©a
[0] == 'R' && data[1] == 'C' && data[2] == 'V')

192 || (
d©a
[0] == 'S' && data[1] == 'N' && data[2] == 'D')) {

193 ià(
_æowid_is_rcv
 !ğ(
d©a
[0] == 'R')) {

194 
_æowid_is_rcv
 = !_flowid_is_rcv;

195 
_æowid
 = _æowid.
	`»v”£
();

201 
·ck‘_ty³
 = 
d©a
[0];

202 
tıh
->
th_æags
 = (
d©a
[0] =ğ'S' ? 
TH_SYN
 : 0);

203 
d©a
 = 
	`ı_sk_¥aû
(d©¨+ 4, 
’d
);

206 ià(
d©a
[0] != '<' && data[0] != '>')

208 
	`SET_PAINT_ANNO
(
q
, (
d©a
[0] =ğ'>'è=ğ
_æowid_is_rcv
);

209 
d©a
 = 
	`ı_sk_¥aû
(d©¨+ 1, 
’d
);

212 cÚ¡ *
Ãxt
 = 
	`ı_š‹g”
(
d©a
, 
’d
, 10, &
u1
);

213 ià(
Ãxt
 =ğ
d©a
)

215 
d©a
 = 
Ãxt
;

216 
u2
 = 0;

217 ià(
d©a
 + 1 < 
’d
 && *data == '.') {

218 
dig™
 = 0;

219 
d©a
++; 
dig™
 < 6 && d©¨< 
’d
 && 
	`isdig™
(() *data); digit++, data++)

220 
u2
 = (u2 * 10è+ *
d©a
 - '0';

221 ; 
dig™
 < 6; digit++)

222 
u2
 = (u2 * 10);

223 ; 
d©a
 < 
’d
 && 
	`isdig™
(() *data); data++)

226 
q
->
	`£t_time¡amp_ªno
(
	`Time¡amp
(
u1
, 
u2
));

227 
d©a
 = 
	`ı_sk_¥aû
(d©a, 
’d
);

230 
ušt32_t
 
uniqno
, 
£qno
, 
_Ën
, 
·ylßd_Ën
;

231 
d©a
 = 
	`ı_š‹g”
(d©a, 
’d
, 10, &
uniqno
);

232 
d©a
 = 
	`ı_š‹g”
(
	`ı_sk_¥aû
(d©a, 
’d
),ƒnd, 10, &
£qno
);

233 
d©a
 = 
	`ı_š‹g”
(
	`ı_sk_¥aû
(d©a, 
’d
),ƒnd, 10, &
_Ën
);

234 
d©a
 = 
	`ı_sk_¥aû
(d©a, 
’d
);

235 
Ãxt
 = 
	`ı_š‹g”
(
d©a
, 
’d
, 10, &
·ylßd_Ën
);

236 ià(
d©a
 =ğ
Ãxt
)

240 
·r£_ªnÙ©iÚs
:

241 
d©a
 = 
	`ı_sk_¥aû
(
Ãxt
, 
’d
);

242 ià(
d©a
 + 6 < 
’d
 && data[0] == 'D' && data[1] == 'S'

243 && 
d©a
[2] == 'A' && data[3] == 'C' && data[4] == 'K'

244 && 
d©a
[5] == ':'

245 && (
Ãxt
 = 
	`ı_š‹g”
(
d©a
 + 6, 
’d
, 10, &
u1
))) {

246 
q
 = q->
	`put
(12);

247 
ušt8_t
 *
İt
 = 
q
->
	`Œª¥Üt_h—d”
(è+ (
şick_tı
);

248 *
İt
++ = 
TCPOPT_NOP
;

249 *
İt
++ = 
TCPOPT_NOP
;

250 *
İt
++ = 
TCPOPT_SACK
;

251 *
İt
++ = 10;

252 *(
»š‹½»t_ÿ¡
<
ušt32_t
 *>(
İt
)èğ
	`htÚl
(
	`·ckno2£qno
(
u1
));

253 *(
»š‹½»t_ÿ¡
<
ušt32_t
 *>(
İt
 + 4)èğ
	`htÚl
(
	`·ckno2£qno
(
u1
 + 1));

254 
·r£_ªnÙ©iÚs
;

256 } ià(
d©a
 + 2 < 
’d
 && data[0] == 'F' && data[1] == 'I'

257 && 
d©a
[2] == 'N') {

258 
tıh
->
th_æags
 |ğ
TH_FIN
;

259 
Ãxt
 = 
d©a
 + 3;

260 
·r£_ªnÙ©iÚs
;

262 } ià(
d©a
 + 1 < 
’d
 && data[0] == 'F' && data[1] == 'R') {

263 
Ãxt
 = 
d©a
 + 2;

264 
·r£_ªnÙ©iÚs
;

266 } ià(
d©a
 + 2 < 
’d
 && data[0] == 'R' && data[1] == 'T'

267 && 
d©a
[2] == 'O') {

268 
Ãxt
 = 
d©a
 + 3;

269 
·r£_ªnÙ©iÚs
;

271 } ià(
d©a
 + 4 < 
’d
 && data[0] == 'S' && data[1] == 'A'

272 && 
d©a
[2] == 'C' && data[3] == 'K' && data[4] == ':') {

273 
q
 = q->
	`put
(40);

274 
ušt8_t
 *
İt
 = 
q
->
	`Œª¥Üt_h—d”
(è+ (
şick_tı
);

275 *
İt
++ = 
TCPOPT_NOP
;

276 *
İt
++ = 
TCPOPT_NOP
;

277 *
İt
++ = 
TCPOPT_SACK
;

278 
İt
++;

280 
d©a
 += 4;

281 
d©a
 < 
’d
 && *data == ':') {

282 
Ãxt
 = 
	`ı_š‹g”
(
d©a
 + 1, 
’d
, 10, &
u1
);

283 ià(
Ãxt
 !ğ
d©a
 + 1 &&‚exˆ+ 1 < 
’d
 &&‚ext[0] == '-'

284 && 
	`isdig™
((è
Ãxt
[1])) {

285 
d©a
 = 
	`ı_š‹g”
(
Ãxt
 + 1, 
’d
, 10, &
u2
);

286 *(
»š‹½»t_ÿ¡
<
ušt32_t
 *>(
İt
)èğ
	`htÚl
(
	`·ckno2£qno
(
u1
));

287 *(
»š‹½»t_ÿ¡
<
ušt32_t
 *>(
İt
 + 4)èğ
	`htÚl
(
	`·ckno2£qno
(
u2
 + 1));

288 
İt
 += 8;

292 
q
->
	`Œª¥Üt_h—d”
()[(
şick_tı
è+ 3] = 
İt
 - (q->transport_header() + (click_tcp) + 2);

293 
q
->
	`ke
(q->
	`’d_d©a
(è- 
İt
);

294 
Ãxt
 = 
d©a
;

295 
·r£_ªnÙ©iÚs
;

297 } ià(
d©a
 + 7 < 
’d
 && data[0] == 'S' && data[1] == 'A'

298 && 
d©a
[2] == 'C' && data[3] == 'K' && data[4] == '_'

299 && 
d©a
[5] == 'N' && data[6] == 'E' && data[7] == 'W') {

300 
Ãxt
 = 
d©a
 + 8;

301 
·r£_ªnÙ©iÚs
;

303 } ià(
d©a
 + 9 < 
’d
 && data[0] == 'S' && data[1] == 'A'

304 && 
d©a
[2] == 'C' && data[3] == 'K' && data[4] == '_'

305 && 
d©a
[5] == 'R' && data[6] == 'E' && data[7] == 'X'

306 && 
d©a
[8] == 'M' && data[9] == 'T') {

307 
Ãxt
 = 
d©a
 + 10;

308 
·r£_ªnÙ©iÚs
;

310 } ià(
d©a
 + 2 < 
’d
 && data[0] == 'T' && data[1] == 'I'

311 && 
d©a
[2] == 'M') {

312 
Ãxt
 = 
d©a
 + 3;

313 
·r£_ªnÙ©iÚs
;

316 ià(
·ck‘_ty³
 == 'D') {

317 
tıh
->
th_£q
 = 
	`htÚl
(
	`·ckno2£qno
(
£qno
, 
·ylßd_Ën
 + (tıh->
th_æags
 & 
TH_SYN
 ? 1 : 0è+ (tıh->th_æag & 
TH_FIN
 ? 1 : 0)));

318 
tıh
->
th_ack
 = 
	`htÚl
(1);

319 
tıh
->
th_æags
 |ğ
TH_ACK
;

320 } ià(
·ck‘_ty³
 == 'A') {

321 
tıh
->
th_£q
 = 
	`htÚl
(1);

322 
tıh
->
th_ack
 = 
	`htÚl
(
	`·ckno2£qno
(
£qno
 + 1));

323 
tıh
->
th_æags
 |ğ
TH_ACK
;

325 
tıh
->
th_£q
 = 
	`htÚl
(0);

326 ià(
_æowid_is_rcv
 !ğ(
	`PAINT_ANNO
(
q
) != 0)) {

327 
tıh
->
th_ack
 = 
	`htÚl
(1);

328 
tıh
->
th_æags
 |ğ
TH_ACK
;

330 
tıh
->
th_ack
 = 
	`htÚl
(0);

331 (è
	`·ckno2£qno
(
£qno
, 
·ylßd_Ën
 + (
tıh
->
th_æags
 & 
TH_SYN
 ? 1 : 0è+ (tıh->th_æag & 
TH_FIN
 ? 1 : 0));

333 
	`SET_PACKET_NUMBER_ANNO
(
q
, 
uniqno
);

334 
	`SET_SEQUENCE_NUMBER_ANNO
(
q
, 
£qno
);

336 
tıh
->
th_off
 = (
q
->
	`’d_d©a
(è- q->
	`Œª¥Üt_h—d”
()) >> 2;

339 
h
->
_Ën
 = 
	`Áohs
(
q
->
	`Ëngth
(è+ 
·ylßd_Ën
);

340 
	`SET_EXTRA_LENGTH_ANNO
(
q
, 
·ylßd_Ën
);

343 
IPFlowID
 
æowid
 = (
	`PAINT_ANNO
(
q
è& 1 ? 
_æowid
.
	`»v”£
() : _flowid);

344 
h
->
_¤c
 = 
æowid
.
	`§ddr
();

345 
h
->
_d¡
 = 
æowid
.
	`daddr
();

346 
tıh
->
th_¥Üt
 = 
æowid
.
	`¥Üt
();

347 
tıh
->
th_dpÜt
 = 
æowid
.
	`dpÜt
();

348 
	`SET_AGGREGATE_ANNO
(
q
, 
_agg»g©e
);

351 ià(
_checksum
)

352 
	`£t_checksums
(
q
, 
h
);

354  
q
;

357 ià(
q
)

358 
q
->
	`kl
();

360 
	}
}

362 
boŞ


363 
	gFromC­Dump
::
	$run_sk
(
Task
 *)

365 ià(!
_aùive
)

366  
çl£
;

367 
Pack‘
 *
p
;

370 
p
 = 
	`»ad_·ck‘
(0);

371 ià(!
p
) {

372 ià(
_¡İ
)

373 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

374  
çl£
;

377 ià(
_§m¶šg_´ob
 >ğ(1 << 
SAMPLING_SHIFT
)

378 || (
	`şick_¿ndom
(è& ((1 << 
SAMPLING_SHIFT
è- 1)è< 
_§m¶šg_´ob
)

380 ià(
p
)

381 
p
->
	`kl
();

384 ià(
p
)

385 
	`ouut
(0).
	`push
(
p
);

386 
_sk
.
	`ç¡_»scheduË
();

387  
Œue
;

388 
	}
}

390 
Pack‘
 *

391 
	gFromC­Dump
::
	$puÎ
()

393 ià(!
_aùive
)

395 
Pack‘
 *
p
;

398 
p
 = 
	`»ad_·ck‘
(0);

399 ià(!
p
) {

400 ià(
_¡İ
)

401 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

402 
_nÙif›r
.
	`¦“p
();

406 ià(
_§m¶šg_´ob
 >ğ(1 << 
SAMPLING_SHIFT
)

407 || (
	`şick_¿ndom
(è& ((1 << 
SAMPLING_SHIFT
è- 1)è< 
_§m¶šg_´ob
)

409 ià(
p
)

410 
p
->
	`kl
();

413 
_nÙif›r
.
	`wake
();

414  
p
;

415 
	}
}

418 ’um { 
	mH_SAMPLING_PROB
, 
	mH_ACTIVE
, 
	mH_ENCAP
, 
	mH_STOP
 };

420 
SŒšg


421 
	gFromC­Dump
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

423 
FromC­Dump
 *
fd
 = 
¡©ic_ÿ¡
<FromC­Dum°*>(
e
);

424 (
šŒ_t
)
thunk
) {

425 
H_SAMPLING_PROB
:

426  
	`ı_uÅ¬£_»®2
(
fd
->
_§m¶šg_´ob
, 
SAMPLING_SHIFT
);

427 
H_ENCAP
:

432 
	}
}

435 
	gFromC­Dump
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s_š
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

437 
FromC­Dump
 *
fd
 = 
¡©ic_ÿ¡
<FromC­Dum°*>(
e
);

438 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
s_š
);

439 (
šŒ_t
)
thunk
) {

440 
H_ACTIVE
: {

441 
boŞ
 
aùive
;

442 ià(
	`BoŞArg
().
	`·r£
(
s
, 
aùive
)) {

443 
fd
->
_aùive
 = 
aùive
;

444 ià(
fd
->
	`ouut_is_push
(0è&& 
aùive
 && !fd->
_sk
.
	`scheduËd
())

445 
fd
->
_sk
.
	`»scheduË
();

446 ià(!
fd
->
	`ouut_is_push
(0))

447 
fd
->
_nÙif›r
.
	`£t_aùive
(
aùive
, 
Œue
);

450  
”rh
->
	`”rÜ
("type mismatch");

452 
H_STOP
:

453 
fd
->
_aùive
 = 
çl£
;

454 
fd
->
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

457  -
EINVAL
;

459 
	}
}

462 
	gFromC­Dump
::
	$add_hªdËrs
()

464 
	`add_»ad_hªdËr
("§m¶šg_´ob", 
»ad_hªdËr
, 
H_SAMPLING_PROB
);

465 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
f_»ad
 | HªdËr::
f_checkbox
, &
_aùive
);

466 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 
H_ACTIVE
);

467 
	`add_»ad_hªdËr
("’ÿp", 
»ad_hªdËr
, 
H_ENCAP
);

468 
	`add_wr™e_hªdËr
("¡İ", 
wr™e_hªdËr
, 
H_STOP
);

469 
_ff
.
	`add_hªdËrs
(
this
);

470 ià(
	`ouut_is_push
(0))

471 
	`add_sk_hªdËrs
(&
_sk
);

472 
	}
}

474 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

475 
	$EXPORT_ELEMENT
(
FromC­Dump
)

476 
CLICK_ENDDECLS


	@analysis/fromcapdump.hh

2 #iâdeà
CLICK_FROMCAPDUMP_HH


3 
	#CLICK_FROMCAPDUMP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şick/nÙif›r.hh
>

7 
	~<şick/æowid.hh
>

8 
	~<şick/äomfe.hh
>

9 
CLICK_DECLS


144 şas 
	cFromC­Dump
 : 
public
 
EËm’t
 {…ublic:

146 
	$FromC­Dump
(è
CLICK_COLD
;

147 ~
	$FromC­Dump
(è
CLICK_COLD
;

149 cÚ¡ *
	$şass_Çme
() const {  "FromCapDump"; }

150 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

151 *
ÿ¡
(const *);

153 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

154 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

155 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

156 
	$add_hªdËrs
(è
CLICK_COLD
;

158 
boŞ
 
	`run_sk
(
Task
 *);

159 
Pack‘
 *
	`puÎ
();

161 
´iv©e
:

163 ’um { 
SAMPLING_SHIFT
 = 28 
	}
};

164 ’um { 
	gNO_SEQNO
 = 0xFFFFFFFFU };

166 
FromFe
 
	g_ff
;

168 
ušt32_t
 
	g_§m¶šg_´ob
;

169 
IPFlowID
 
	g_æowid
;

170 
boŞ
 
	g_æowid_is_rcv
;

171 
ušt32_t
 
	g_agg»g©e
;

173 
	gVeùÜ
<
	gušt32_t
> 
	g_p2s_m­
;

175 
boŞ
 
	g_¡İ
 : 1;

176 
boŞ
 
	g_z”o
 : 1;

177 
boŞ
 
	g_checksum
 : 1;

178 
boŞ
 
	g_aùive
;

180 
Task
 
	g_sk
;

181 
AùiveNÙif›r
 
	g_nÙif›r
;

183 
ušt32_t
 
·ckno2£qno
(ušt32_ˆ
·ckno
);

184 
ušt32_t
 
·ckno2£qno
(ušt32_ˆ
·ckno
, 
Ën
);

186 
Pack‘
 *
»ad_·ck‘
(
E¼ÜHªdËr
 *);

188 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

189 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

191 
	}
};

193 
	gCLICK_ENDDECLS


	@analysis/fromdagdump.cc

19 
	~<şick/cÚfig.h
>

20 
	~"äomdagdump.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/glue.hh
>

26 
	~<şick/hªdËrÿÎ.hh
>

27 
	~<şick/·ck‘_ªno.hh
>

28 
	~<şickÃt/rfc1483.h
>

29 
	~<şick/u£ruts.hh
>

30 
	~"–em’ts/u£¾ev–/çk•ÿp.hh
"

31 
	~<uni¡d.h
>

32 
	~<sys/ty³s.h
>

33 
	~<sys/¡©.h
>

34 
	~<fú.h
>

35 #ifdeà
ALLOW_MMAP


36 
	~<sys/mmª.h
>

38 
	gCLICK_DECLS


40 
	#SWAPLONG
(
y
) \

41 ((((
y
)&0xff)<<24è| (((y)&0xff00)<<8è| (((y)&0xff0000)>>8è| (((y)>>24)&0xff))

	)

42 
	#SWAPSHORT
(
y
) \

43 Ğ(((
y
)&0xff)<<8è| ((
u_shÜt
)((y)&0xff00)>>8è)

	)

45 
	gFromDAGDump
::
	$FromDAGDump
()

46 : 
	`_·ck‘
(0), 
	`_’d_h
(0), 
	$_sk
(
this
)

48 
	`¡©ic_as£¹
((
DAGC–l
è=ğ64 && DAGC–l::
CELL_SIZE
 == 64, "DAGCell must beƒxactly 64 bytes†ong.");

49 
	}
}

51 
	gFromDAGDump
::~
	$FromDAGDump
()

53 
d–‘e
 
_’d_h
;

54 
	}
}

57 
	gFromDAGDump
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

59 
boŞ
 
	gtimšg
 = 
çl£
, 
	g¡İ
 = f®£, 
	gaùive
 = 
Œue
, 
	gfÜû_
 = false;

60 
Time¡amp
 
	gfœ¡_time
, 
	gfœ¡_time_off
, 
	gÏ¡_time
, 
	gÏ¡_time_off
, 
	gš‹rv®
;

61 
HªdËrC®l
 
	g’d_h
;

62 
SŒšg
 
	g’ÿp
;

63 
	g_§m¶šg_´ob
 = (1 << 
SAMPLING_SHIFT
);

65 ià(
	g_ff
.
cÚfigu»_keywÜds
(
cÚf
, 
this
, 
”rh
) < 0)

67 ià(
Args
(
cÚf
, 
this
, 
”rh
)

68 .
»ad_mp
("FILENAME", 
F’ameArg
(), 
_ff
.
f’ame
())

69 .
»ad
("STOP", 
¡İ
)

70 .
»ad
("ACTIVE", 
aùive
)

71 .
»ad
("FORCE_IP", 
fÜû_
)

72 .
»ad
("START", 
fœ¡_time
)

73 .
»ad
("START_AFTER", 
fœ¡_time_off
)

74 .
»ad
("END", 
Ï¡_time
)

75 .
»ad
("END_AFTER", 
Ï¡_time_off
)

76 .
»ad
("INTERVAL", 
š‹rv®
)

77 .
»ad
("END_CALL", 
HªdËrC®lArg
(
HªdËrC®l
::
wr™abË
), 
’d_h
)

78 .
»ad
("SAMPLE", 
FixedPoštArg
(
SAMPLING_SHIFT
), 
_§m¶šg_´ob
)

79 .
»ad
("TIMING", 
timšg
)

80 .
»ad
("ENCAP", 
WÜdArg
(), 
’ÿp
)

81 .
com¶‘e
() < 0)

85 ià(
	g_§m¶šg_´ob
 > (1 << 
	gSAMPLING_SHIFT
)) {

86 
	g”rh
->
w¬nšg
("SAMPLE…robability„educedo 1");

87 
	g_§m¶šg_´ob
 = (1 << 
SAMPLING_SHIFT
);

88 } ià(
	g_§m¶šg_´ob
 == 0)

89 
”rh
->
w¬nšg
("SAMPLE…robability is 0;ƒmitting‚o…ackets");

92 
	g_have_fœ¡_time
 = 
_have_Ï¡_time
 = 
Œue
;

93 
	g_fœ¡_time_»Ïtive
 = 
_Ï¡_time_»Ïtive
 = 
_Ï¡_time_š‹rv®
 = 
çl£
;

95 ià((
	gboŞ
è
	gfœ¡_time
 + (boŞè
	gfœ¡_time_off
 > 1)

96  
	g”rh
->
”rÜ
("'START'‡nd 'START_AFTER'‡re mutuallyƒxclusive");

97 ià((
	gboŞ
è
	gfœ¡_time
)

98 
	g_fœ¡_time
 = 
fœ¡_time
;

99 ià((
	gboŞ
è
	gfœ¡_time_off
)

100 
	g_fœ¡_time
 = 
fœ¡_time_off
, 
	g_fœ¡_time_»Ïtive
 = 
Œue
;

102 
	g_have_fœ¡_time
 = 
çl£
, 
	g_fœ¡_time_»Ïtive
 = 
Œue
;

104 ià((
	gboŞ
è
	gÏ¡_time
 + (boŞè
	gÏ¡_time_off
 + (boŞè
	gš‹rv®
 > 1)

105  
	g”rh
->
”rÜ
("END, END_AFTER,‡nd INTERVAL‡re mutuallyƒxclusive");

106 ià((
	gboŞ
è
	gÏ¡_time
)

107 
	g_Ï¡_time
 = 
Ï¡_time
;

108 ià((
	gboŞ
è
	gÏ¡_time_off
)

109 
	g_Ï¡_time
 = 
Ï¡_time_off
, 
	g_Ï¡_time_»Ïtive
 = 
Œue
;

110 ià((
	gboŞ
è
	gš‹rv®
)

111 
	g_Ï¡_time
 = 
š‹rv®
, 
	g_Ï¡_time_š‹rv®
 = 
Œue
;

113 
	g_have_Ï¡_time
 = 
çl£
;

115 ià(
	g¡İ
 && 
	g’d_h
)

116  
	g”rh
->
”rÜ
("END_CALL‡nd STOP‡re mutuallyƒxclusive");

117 ià(
	g’d_h
)

118 
	g_’d_h
 = 
Ãw
 
HªdËrC®l
(
’d_h
);

119 ià(
	g¡İ
)

120 
	g_’d_h
 = 
Ãw
 
HªdËrC®l
(
Çme
() + ".stop");

121 ià(
	g_have_Ï¡_time
)

122 
	g_’d_h
 = 
Ãw
 
HªdËrC®l
(
Çme
() + ".active false");

125 ià(!
	g’ÿp
)

126 
	g_ba£_lškty³
 = 
FAKE_DLT_NONE
;

127 ià((
	g_ba£_lškty³
 = 
çke_pÿp_·r£_dÉ
(
’ÿp
)) < 0

128 || (
_ba£_lškty³
 !ğ
FAKE_DLT_SUNATM


129 && 
_ba£_lškty³
 !ğ
FAKE_DLT_C_HDLC


130 && 
_ba£_lškty³
 !ğ
FAKE_DLT_EN10MB


131 && 
_ba£_lškty³
 !ğ
FAKE_DLT_ATM_RFC1483


132 && 
_ba£_lškty³
 !ğ
FAKE_DLT_PPP


133 && 
_ba£_lškty³
 !ğ
FAKE_DLT_PPP_HDLC


134 && 
_ba£_lškty³
 !ğ
FAKE_DLT_RAW
))

135  
”rh
->
”rÜ
("badƒncapsulationype");

138 
	g_have_ªy_times
 = 
çl£
;

139 
	g_timšg
 = 
timšg
;

140 
	g_fÜû_
 = 
fÜû_
;

141 
	g_lškty³
 = 
FAKE_DLT_NONE
;

142 
	g_aùive
 = 
aùive
;

147 
	gFromDAGDump
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

149 ià(
_ff
.
	`š™Ÿlize
(
”rh
) < 0)

153 ià(
_fÜû_
 && 
_timšg
)

154  
”rh
->
	`”rÜ
("FORCE_IP‡nd TIMING options‡re incompatible");

157 ià(
_’d_h
 && _’d_h->
	`š™Ÿlize_wr™e
(
this
, 
”rh
) < 0)

161 ià(
	`»ad_·ck‘
(
”rh
))

162 
_time_off£t
 = 
Time¡amp
::
	`now
(è- 
_·ck‘
->
	`time¡amp_ªno
();

164 ià(
	`ouut_is_push
(0))

165 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_aùive
, 
”rh
);

167 
	}
}

170 
	gFromDAGDump
::
	$ş—nup
(
CËªupSge
)

172 
_ff
.
	`ş—nup
();

173 ià(
_·ck‘
)

174 
_·ck‘
->
	`kl
();

175 
_·ck‘
 = 0;

176 
	}
}

179 
	gFromDAGDump
::
	$£t_aùive
(
boŞ
 
aùive
)

181 ià(
_aùive
 !ğ
aùive
) {

182 
_aùive
 = 
aùive
;

183 ià(
aùive
 && 
	`ouut_is_push
(0è&& !
_sk
.
	`scheduËd
())

184 
_sk
.
	`»scheduË
();

186 
	}
}

188 
šlše
 
ušt64_t


189 
	$sw­q
(
ušt64_t
 
q
)

191 #ià
CLICK_BYTE_ORDER
 =ğ
CLICK_BIG_ENDIAN


192  ((
q
 & 0xff00000000000000LL) >> 56)

193 | ((
q
 & 0x00ff000000000000LL) >> 40)

194 | ((
q
 & 0x0000ff0000000000LL) >> 24)

195 | ((
q
 & 0x000000ff00000000LL) >> 8)

196 | ((
q
 & 0x00000000ff000000LL) << 8)

197 | ((
q
 & 0x0000000000ff0000LL) << 24)

198 | ((
q
 & 0x000000000000ff00LL) << 40)

199 | ((
q
 & 0x00000000000000ffLL) << 56);

200 #–ià
CLICK_BYTE_ORDER
 =ğ
CLICK_LITTLE_ENDIAN


201  
q
;

205 
	}
}

208 
	gFromDAGDump
::
	$¡amp_to_time
(
ušt64_t
 
¡amp
, 
Time¡amp
 &
tv
) const

210 
ušt32_t
 
£c
 = (ušt32_tè(
¡amp
 >> 32);

212 
¡amp
 = (stamp & 0xFFFFFFFFULL) * 1000000000;

213 
¡amp
 += (stamp & 0x80000000ULL) << 1;

214 
ušt32_t
 
n£c
 = (ušt32_tè(
¡amp
 >> 32);

215 ià(
n£c
 >= 1000000000) {

216 
n£c
 -= 1000000000;

217 
£c
 += 1;

219 
tv
 = 
Time¡amp
::
	`make_n£c
(
£c
, 
n£c
);

220 
	}
}

223 
	gFromDAGDump
::
	$´•¬e_times
(cÚ¡ 
Time¡amp
 &
tv
)

225 ià(
_fœ¡_time_»Ïtive
)

226 
_fœ¡_time
 +ğ
tv
;

227 ià(
_Ï¡_time_»Ïtive
)

228 
_Ï¡_time
 +ğ
tv
;

229 ià(
_Ï¡_time_š‹rv®
)

230 
_Ï¡_time
 +ğ
_fœ¡_time
;

231 
_have_ªy_times
 = 
Œue
;

232 
	}
}

234 
boŞ


235 
	gFromDAGDump
::
	$»ad_·ck‘
(
E¼ÜHªdËr
 *
”rh
)

237 cÚ¡ 
DAGC–l
 *
ûÎ
;

238 
DAGC–l
 
¡©ic_ûÎ
;

239 
Time¡amp
 
tv
;

240 
Pack‘
 *
p
;

241 
boŞ
 
mÜe
 = 
Œue
;

242 
_·ck‘
 = 0;

244 
»Œy
:

246 ià(!
mÜe
)

247  
çl£
;

250 
ûÎ
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
DAGC–l
 *>(
_ff
.
	`g‘_®igÃd
(DAGC–l::
HEADER_SIZE
, &
¡©ic_ûÎ
, 
”rh
));

251 ià(!
ûÎ
)

252  
çl£
;

255 
check_times
:

256 
	`¡amp_to_time
(
	`sw­q
(
ûÎ
->
time¡amp
), 
tv
);

257 ià(!
_have_ªy_times
)

258 
	`´•¬e_times
(
tv
);

259 ià(
_have_fœ¡_time
) {

260 ià(
tv
 < 
_fœ¡_time
)

261 
»Œy
;

263 
_have_fœ¡_time
 = 
çl£
;

265 ià(
_have_Ï¡_time
 && 
tv
 >ğ
_Ï¡_time
) {

266 
_have_Ï¡_time
 = 
çl£
;

267 (è
_’d_h
->
	`ÿÎ_wr™e
(
”rh
);

268 ià(!
_aùive
)

269 
mÜe
 = 
çl£
;

271 
check_times
;

275 ià(
_§m¶šg_´ob
 < (1 << 
SAMPLING_SHIFT
)

276 && (
	`şick_¿ndom
(è& ((1<<
SAMPLING_SHIFT
)-1)è>ğ
_§m¶šg_´ob
)

277 
»Œy
;

280 
ušt32_t
 
wœe_Ëngth
 = 0;

281 ià(
ûÎ
->
ty³
 =ğ
DAGC–l
::
TYPE_LEGACY
 || 
_ba£_lškty³
 >= 0) {

282 
u£_ba£_lškty³
:

283 
_lškty³
 = 
_ba£_lškty³
;

284 
_ba£_lškty³
) {

286 
ûÎ
:

287 
FAKE_DLT_ATM_RFC1483
:

288 
FAKE_DLT_PPP
:

289 
FAKE_DLT_PPP_HDLC
:

290 
p
 = 
_ff
.
	`g‘_·ck‘
(
DAGC–l
::
CELL_SIZE
 - DAGC–l::
HEADER_SIZE
, 
tv
.
	`£c
(),v.
	`sub£c
(), 
”rh
);

293 
FAKE_DLT_C_HDLC
:

294 
wœe_Ëngth
 = 
	`htÚs
(*(
»š‹½»t_ÿ¡
<cÚ¡ 
ušt16_t
*>(
ûÎ
) + 5));

295 
ûÎ
;

297 
FAKE_DLT_NONE
:

298 
_lškty³
 = 
FAKE_DLT_ATM_RFC1483
;

299 
ûÎ
;

301 
FAKE_DLT_SUNATM
:

302 
p
 = 
_ff
.
	`g‘_·ck‘_äom_d©a
(
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
*>(
ûÎ
è+ 12, 4, 
DAGC–l
::
CELL_SIZE
 - 12, 
tv
.
	`£c
(),v.
	`sub£c
(), 
”rh
);

305 
FAKE_DLT_EN10MB
:

306 
wœe_Ëngth
 = 
	`htÚs
(*(
»š‹½»t_ÿ¡
<cÚ¡ 
ušt16_t
*>(
ûÎ
) + 4));

307 
p
 = 
_ff
.
	`g‘_·ck‘_äom_d©a
(
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
*>(
ûÎ
è+ 10, 6, 
DAGC–l
::
CELL_SIZE
 - 10, 
tv
.
	`£c
(),v.
	`sub£c
(), 
”rh
);

311 
p
 = 
_ff
.
	`g‘_·ck‘_äom_d©a
(
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
*>(
ûÎ
è+ 8, 8, 
DAGC–l
::
CELL_SIZE
 - 8, 
tv
.
	`£c
(),v.
	`sub£c
(), 
”rh
);

316 
»ad_Ëngth
 = 
	`htÚs
(
ûÎ
->
¾’
);

317 
wœe_Ëngth
 = 
	`htÚs
(
ûÎ
->
wËn
);

318 
ûÎ
->
ty³
) {

319 
DAGC–l
::
TYPE_ATM
:

320 
DAGC–l
::
TYPE_AAL5
:

321 
_lškty³
 = 
FAKE_DLT_SUNATM
;

323 
DAGC–l
::
TYPE_ETH
:

324 
_ff
.
	`shiá_pos
(2);

325 
»ad_Ëngth
 -= 2;

326 
wœe_Ëngth
 -= 4;

327 
_lškty³
 = 
FAKE_DLT_EN10MB
;

329 
DAGC–l
::
TYPE_HDLC_POS
:

330 
_lškty³
 = 
FAKE_DLT_C_HDLC
;

333 ià(
_ba£_lškty³
 =ğ
FAKE_DLT_NONE
)

334 
_ba£_lškty³
 = 
FAKE_DLT_ATM_RFC1483
;

335 ià(
”rh
) {

336 
”rh
->
	`w¬nšg
("odd DAG c–Èty³ %d,‡ssumšg old-¡yË ATMƒnÿpsuÏtiÚ", 
ûÎ
->
ty³
);

337 
”rh
->
	`mes§ge
("(To‡voidhis warning, specify‡nƒxplicit ENCAP.)");

339 
	`şick_ch©‹r
("%p{–em’t}: DAG c–Èw™h oddy³ %d,‡ssumšg old-¡yË\À ATMƒnÿpsuÏtiÚ fÜ„e¡ oàdump. Pack‘ may havb“À»ad incÜ»ùly!\À (TØavoidhi w¬nšg, s³cify‡Àex¶ic™ ENCAP.)", 
this
, 
ûÎ
->
ty³
);

340 
u£_ba£_lškty³
;

342 ià(
»ad_Ëngth
 < 
DAGC–l
::
HEADER_SIZE
)

343  
çl£
;

344 
p
 = 
_ff
.
	`g‘_·ck‘
(
»ad_Ëngth
 - 
DAGC–l
::
HEADER_SIZE
, 
tv
.
	`£c
(),v.
	`sub£c
(), 
”rh
);

348 ià(!
p
)

349  
çl£
;

350 ià(
wœe_Ëngth
)

351 
	`SET_EXTRA_LENGTH_ANNO
(
p
, 
wœe_Ëngth
 -…->
	`Ëngth
());

353 ià(
_fÜû_
 && !
	`çke_pÿp_fÜû_
(
p
, 
_lškty³
)) {

354 
	`checked_ouut_push
(1, 
p
);

355 
»Œy
;

358 
_·ck‘
 = 
p
;

359  
mÜe
;

360 
	}
}

362 
boŞ


363 
	gFromDAGDump
::
	$run_sk
(
Task
 *)

365 ià(!
_aùive
)

366  
çl£
;

368 
boŞ
 
mÜe
;

369 ià(
_·ck‘
 || 
	`»ad_·ck‘
(0)) {

370 ià(
_timšg


371 && 
_·ck‘
->
	`time¡amp_ªno
(è> 
Time¡amp
::
	`now
(è- 
_time_off£t
) {

372 
_sk
.
	`ç¡_»scheduË
();

373  
çl£
;

375 
	`ouut
(0).
	`push
(
_·ck‘
);

376 
mÜe
 = 
	`»ad_·ck‘
(0);

378 
mÜe
 = 
çl£
;

380 ià(
mÜe
)

381 
_sk
.
	`ç¡_»scheduË
();

382 ià(
_’d_h
)

383 
_’d_h
->
	`ÿÎ_wr™e
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

384  
Œue
;

385 
	}
}

387 
Pack‘
 *

388 
	gFromDAGDump
::
	$puÎ
()

390 ià(!
_aùive
)

393 
boŞ
 
mÜe
;

394 
Pack‘
 *
p
;

395 ià(
_·ck‘
 || 
	`»ad_·ck‘
(0)) {

396 ià(
_timšg


397 && 
_·ck‘
->
	`time¡amp_ªno
(è> 
Time¡amp
::
	`now
(è- 
_time_off£t
)

399 
p
 = 
_·ck‘
;

400 
mÜe
 = 
	`»ad_·ck‘
(0);

402 
p
 = 0;

403 
mÜe
 = 
çl£
;

406 ià(!
mÜe
 && 
_’d_h
)

407 
_’d_h
->
	`ÿÎ_wr™e
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

408  
p
;

409 
	}
}

412 
	mH_SAMPLING_PROB
, 
	mH_ACTIVE
, 
	mH_ENCAP
, 
	mH_STOP
, 
	mH_EXTEND_INTERVAL


415 
SŒšg


416 
	gFromDAGDump
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

418 
FromDAGDump
 *
fd
 = 
¡©ic_ÿ¡
<FromDAGDum°*>(
e
);

419 (
šŒ_t
)
thunk
) {

420 
H_SAMPLING_PROB
:

421  
	`ı_uÅ¬£_»®2
(
fd
->
_§m¶šg_´ob
, 
SAMPLING_SHIFT
);

422 
H_ENCAP
:

423  
	`SŒšg
(
	`çke_pÿp_uÅ¬£_dÉ
(
fd
->
_lškty³
));

427 
	}
}

430 
	gFromDAGDump
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s_š
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

432 
FromDAGDump
 *
fd
 = 
¡©ic_ÿ¡
<FromDAGDum°*>(
e
);

433 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
s_š
);

434 (
šŒ_t
)
thunk
) {

435 
H_ACTIVE
: {

436 
boŞ
 
aùive
;

437 ià(
	`BoŞArg
().
	`·r£
(
s
, 
aùive
)) {

438 
fd
->
	`£t_aùive
(
aùive
);

441  
”rh
->
	`”rÜ
("type mismatch");

443 
H_STOP
:

444 
fd
->
	`£t_aùive
(
çl£
);

445 
fd
->
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

447 
H_EXTEND_INTERVAL
: {

448 
Time¡amp
 
tv
;

449 ià(
	`ı_time
(
s
, &
tv
)) {

450 
fd
->
_Ï¡_time
 +ğ
tv
;

451 ià(
fd
->
_’d_h
)

452 
fd
->
_have_Ï¡_time
 = 
Œue
, fd->
	`£t_aùive
(true);

455  
”rh
->
	`”rÜ
("'extend_interval'akes‡ime interval");

458  -
EINVAL
;

460 
	}
}

463 
	gFromDAGDump
::
	$add_hªdËrs
()

465 
	`add_»ad_hªdËr
("§m¶šg_´ob", 
»ad_hªdËr
, 
H_SAMPLING_PROB
);

466 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
f_»ad
 | HªdËr::
f_checkbox
, &
_aùive
);

467 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 
H_ACTIVE
);

468 
	`add_»ad_hªdËr
("’ÿp", 
»ad_hªdËr
, 
H_ENCAP
);

469 
	`add_wr™e_hªdËr
("¡İ", 
wr™e_hªdËr
, 
H_STOP
);

470 
	`add_wr™e_hªdËr
("ex‹nd_š‹rv®", 
wr™e_hªdËr
, 
H_EXTEND_INTERVAL
);

471 
_ff
.
	`add_hªdËrs
(
this
);

472 ià(
	`ouut_is_push
(0))

473 
	`add_sk_hªdËrs
(&
_sk
);

474 
	}
}

476 
CLICK_ENDDECLS


477 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
št64
 
FakePÿp
)

478 
	`EXPORT_ELEMENT
(
FromDAGDump
)

	@analysis/fromdagdump.hh

2 #iâdeà
CLICK_FROMDAGDUMP_HH


3 
	#CLICK_FROMDAGDUMP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şick/äomfe.hh
>

7 
CLICK_DECLS


8 
şass
 
	gHªdËrC®l
;

159 şas 
	cFromDAGDump
 : 
public
 
EËm’t
 {…ublic:

161 
	$FromDAGDump
(è
CLICK_COLD
;

162 ~
	$FromDAGDump
(è
CLICK_COLD
;

164 cÚ¡ *
	$şass_Çme
() const {  "FromDAGDump"; }

165 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "0/1-2"; 
	}
}

166 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

168 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

169 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

170 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

171 
	$add_hªdËrs
(è
CLICK_COLD
;

173 
boŞ
 
	`run_sk
(
Task
 *);

174 
Pack‘
 *
	`puÎ
();

176 
	`£t_aùive
(
boŞ
);

178 
´iv©e
:

180 
	sDAGPosC–l
 {

181 
ušt32_t
 
hdlc
;

182 
ušt8_t
 
·ylßd
[44];

183 
	}
};

184 
	sDAGEth”ÃtC–l
 {

185 
ušt8_t
 
	goff£t
;

186 
ušt8_t
 
	g·ddšg
;

187 
ušt8_t
 
	g‘h”_dho¡
[6];

188 
ušt8_t
 
	g‘h”_sho¡
[6];

189 
ušt16_t
 
	g‘h”_ty³
;

190 
ušt8_t
 
	g·ylßd
[32];

192 
	sDAGATMC–l
 {

193 
ušt32_t
 
	gh—d”
;

194 
ušt8_t
 
	g·ylßd
[44];

196 
	sDAGAAL5C–l
 {

197 
ušt32_t
 
	gh—d”
;

198 
ušt8_t
 
	g·ylßd
[44];

200 
	sDAGC–l
 {

201 
ušt64_t
 
	gtime¡amp
;

202 
ušt8_t
 
	gty³
;

203 
ušt8_t
 
	gæags
;

204 
ušt16_t
 
	g¾’
;

205 
ušt16_t
 
	glùr
;

206 
ušt16_t
 
	gwËn
;

208 
DAGPosC–l
 
	gpos
;

209 
DAGEth”ÃtC–l
 
	g‘h”
;

210 
DAGATMC–l
 
	g©m
;

211 
DAGAAL5C–l
 
	g¯l5
;

212 } 
	gu
;

213 ’um { 
	gHEADER_SIZE
 = 16, 
	gCELL_SIZE
 = 64 };

214 ’um { 
	gTYPE_LEGACY
 = 0, 
	gTYPE_HDLC_POS
 = 1, 
	gTYPE_ETH
 = 2, 
	gTYPE_ATM
 = 3,

215 
	gTYPE_AAL5
 = 4, 
	gTYPE_MAX
 = 
TYPE_AAL5
 };

218 cÚ¡ 
ušt32_t
 
	gBUFFER_SIZE
 = 32768;

219 cÚ¡ 
	gSAMPLING_SHIFT
 = 28;

220 cÚ¡ 
	gdagty³2lškty³
[];

222 
FromFe
 
	g_ff
;

224 
Pack‘
 *
	g_·ck‘
;

226 
boŞ
 
	g_timšg
 : 1;

227 
boŞ
 
	g_fÜû_
 : 1;

228 
boŞ
 
	g_have_fœ¡_time
 : 1;

229 
boŞ
 
	g_have_Ï¡_time
 : 1;

230 
boŞ
 
	g_have_ªy_times
 : 1;

231 
boŞ
 
	g_fœ¡_time_»Ïtive
 : 1;

232 
boŞ
 
	g_Ï¡_time_»Ïtive
 : 1;

233 
boŞ
 
	g_Ï¡_time_š‹rv®
 : 1;

234 
boŞ
 
	g_aùive
;

235 
	g_§m¶šg_´ob
;

236 
	g_lškty³
;

237 
	g_ba£_lškty³
;

239 
Time¡amp
 
	g_fœ¡_time
;

240 
Time¡amp
 
	g_Ï¡_time
;

241 
HªdËrC®l
 *
	g_’d_h
;

243 
Task
 
	g_sk
;

245 
Time¡amp
 
	g_time_off£t
;

247 
boŞ
 
»ad_·ck‘
(
E¼ÜHªdËr
 *);

249 
	$¡amp_to_time
(
ušt64_t
, 
Time¡amp
 &) const;

250 
	`´•¬e_times
(cÚ¡ 
Time¡amp
 &);

252 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

253 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

255 
	}
};

257 
	gCLICK_ENDDECLS


	@analysis/fromflandump.cc

19 
	~<şick/cÚfig.h
>

20 
	~"äomæªdump.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/glue.hh
>

26 
	~<şick/hªdËrÿÎ.hh
>

27 
	~<şick/·ck‘_ªno.hh
>

28 
	~<şickÃt/rfc1483.h
>

29 
	~<şick/u£ruts.hh
>

30 
	~"–em’ts/u£¾ev–/çk•ÿp.hh
"

31 
	~<uni¡d.h
>

32 
	~<sys/ty³s.h
>

33 
	~<sys/¡©.h
>

34 
	~<fú.h
>

35 #ifdeà
ALLOW_MMAP


36 
	~<sys/mmª.h
>

39 
	#SWAPLONG
(
y
) \

40 ((((
y
)&0xff)<<24è| (((y)&0xff00)<<8è| (((y)&0xff0000)>>8è| (((y)>>24)&0xff))

	)

41 
	#SWAPSHORT
(
y
) \

42 Ğ(((
y
)&0xff)<<8è| ((
u_shÜt
)((y)&0xff00)>>8è)

	)

44 
	gFromFÏnDump
::
	$FromFÏnDump
()

45 : 
	$_sk
(
this
)

47 
i
 = 0; i < 
FF_LAST
; i++)

48 
_ff
[
i
] = 0;

49 
	}
}

51 
	gFromFÏnDump
::~
	$FromFÏnDump
()

53 
	}
}

56 
FromFÏnDump
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

58 
boŞ
 
	g¡İ
 = 
çl£
, 
	gaùive
 = 
Œue
;

59 
boŞ
 
	ghave_·ck‘s
, 
	g·ck‘s
, 
	ghave_æows
, 
	gæows
;

61 ià(
Args
(
cÚf
, 
this
, 
”rh
)

62 .
»ad_mp
("FILENAME", 
F’ameArg
(), 
_dœÇme
)

63 .
»ad
("STOP", 
¡İ
)

64 .
»ad
("ACTIVE", 
aùive
)

65 .
»ad
("PACKETS", 
have_·ck‘s
, 
·ck‘s
)

66 .
»ad
("FLOWS", 
have_æows
, 
æows
)

67 .
com¶‘e
() < 0)

71 ià(
	ghave_·ck‘s
 && 
	ghave_æows
 && 
	g·ck‘s
 =ğ
æows
)

72  
”rh
->
”rÜ
("can't specify both PACKETS‡nd FLOWS");

73 ià(
	ghave_·ck‘s
)

74 
	gæows
 = !
·ck‘s
;

75 ià(!
	ghave_·ck‘s
 && !
	ghave_æows
)

76 
	gæows
 = 
Œue
;

77 
	g_æows
 = 
æows
;

80 
	g_¡İ
 = 
¡İ
;

81 
	g_aùive
 = 
aùive
;

86 
	gFromFÏnDump
::
FÏnFe
::
	$FÏnFe
()

87 : 
	`_fd
(-1), 
	`_bufãr
(0), 
	`_off£t
(0), 
	`_Ën
(0), 
	`_pe
(0), 
	$_my_bufãr
(
Œue
)

89 
	}
}

92 
	gFromFÏnDump
::
FÏnFe
::~
	$FÏnFe
()

94 ià(
_pe
)

95 
	`pşo£
(
_pe
);

96 ià(
_fd
 >= 0)

97 
	`şo£
(
_fd
);

98 ià(
_my_bufãr
)

99 
d–‘e
[] 
_bufãr
;

100 
	}
}

103 
	gFromFÏnDump
::
FÏnFe
::
	$İ’
(cÚ¡ 
SŒšg
 &
ba£Çme
, cÚ¡ SŒšg &
f’ame
, 
»cÜd_size
, 
E¼ÜHªdËr
 *
”rh
)

105 
	`as£¹
(!
_pe
 && 
_fd
 < 0);

106 
_»cÜd_size
 = 
»cÜd_size
;

108 
SŒšg
 
·th
 = 
ba£Çme
;

109 ià(
ba£Çme
.
	`back
() != '/')

110 
·th
 += "/";

111 
·th
 +ğ
f’ame
;

114 ià(
	`acûss
(
·th
.
	`c_¡r
(), 
R_OK
) >= 0) {

115 
_fd
 = 
	`İ’
(
·th
.
	`c_¡r
(), 
O_RDONLY
);

116 ià(
_fd
 < 0)

117  
”rh
->
	`”rÜ
("%s: %s", 
·th
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

118 } ià(
	`acûss
((
·th
 + ".gz").
	`c_¡r
(), 
R_OK
) >= 0) {

119 
buf
[3] = "\037\213";

120 
_pe
 = 
	`İ’_uncom´ess_pe
(
·th
 + ".gz", (*)
buf
, 2, 
”rh
);

121  (
_fd
 = (
_pe
 ? 
	`f’o
(_pipe) : -1));

122 } ià(
	`acûss
((
·th
 + ".bz2").
	`c_¡r
(), 
R_OK
) >= 0) {

123 
buf
[3] = "BZh";

124 
_pe
 = 
	`İ’_uncom´ess_pe
(
·th
 + ".bz2", (*)
buf
, 3, 
”rh
);

125  (
_fd
 = (
_pe
 ? 
	`f’o
(_pipe) : -1));

127  
”rh
->
	`”rÜ
("%s:‚Øsuch fe", 
·th
.
	`c_¡r
());

128 
	}
}

131 
	gFromFÏnDump
::
FÏnFe
::
	$»ad_mÜe
(
off_t
 
¡¬t_off
)

133 ià(
_off£t
 + 
_Ën
 !ğ
¡¬t_off
)

134 ià(
	`l£ek
(
_fd
, 
¡¬t_off
, 
SEEK_SET
è=ğ(
off_t
)-1) {

135 
_off£t
 = 
_Ën
 = 0;

141 ià(!
_bufãr
 && !(_bufã¸ğ
Ãw
 
ušt8_t
[
BUFFER_SIZE
]))

142  -
ENOMEM
;

144 
_off£t
 +ğ
_Ën
;

145 
_Ën
 = 0;

147 
_Ën
 < 
BUFFER_SIZE
) {

148 
ssize_t
 
gÙ
 = 
	`»ad
(
_fd
, 
_bufãr
 + 
_Ën
, 
BUFFER_SIZE
 - _len);

149 ià(
gÙ
 > 0)

150 
_Ën
 +ğ
gÙ
;

151 ià(
gÙ
 == 0)

153 ià(
gÙ
 < 0 && 
”ºo
 !ğ
EINTR
 &&ƒ¼nØ!ğ
EAGAIN
)

158 
	}
}

161 
	gFromFÏnDump
::
	$”rÜ_h–³r
(
E¼ÜHªdËr
 *
”rh
, cÚ¡ *
x
)

163 ià(
”rh
)

164 
”rh
->
	`”rÜ
("%s: %s", 
_dœÇme
.
	`c_¡r
(), 
x
);

166 
	`şick_ch©‹r
("%s: %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
x
);

168 
	}
}

171 
	gFromFÏnDump
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

174 ià(
_f’ame
 == "-") {

175 
_fd
 = 
STDIN_FILENO
;

176 
_f’ame
 = "<stdin>";

178 
_fd
 = 
	`İ’
(
_f’ame
.
	`c_¡r
(), 
O_RDONLY
);

179 ià(
_fd
 < 0)

180  
”rh
->
	`”rÜ
("%s: %s", 
_f’ame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

182 
»Œy_fe
:

183 #ifdeà
ALLOW_MMAP


184 
_mm­_un™
 = 0;

186 
_fe_off£t
 = 0;

187 
»suÉ
 = 
	`»ad_bufãr
(
”rh
);

188 ià(
»suÉ
 < 0)

190 ià(
»suÉ
 == 0)

191  
”rh
->
	`”rÜ
("%s:ƒm±y fe", 
_f’ame
.
	`c_¡r
());

194 ià(
_fd
 =ğ
STDIN_FILENO
 || 
_pe
)

196 ià(
	`com´es£d_d©a
(
_bufãr
, 
_Ën
)

197 && (
_Ën
 < 
DAGC–l
::
PAYLOAD_OFFSET
 + 
RFC1483_SNAP_EXPECTED_LEN


198 || 
	`memcmp
(
_bufãr
 + 
DAGC–l
::
PAYLOAD_OFFSET
, 
RFC1483_SNAP_EXPECTED
, 
RFC1483_SNAP_EXPECTED_LEN
) != 0)) {

199 
	`şo£
(
_fd
);

200 
_fd
 = -1;

201 ià(!(
_pe
 = 
	`İ’_uncom´ess_pe
(
_f’ame
, 
_bufãr
, 
_Ën
, 
”rh
)))

203 
_fd
 = 
	`f’o
(
_pe
);

204 
»Œy_fe
;

208 ià(
_fÜû_
) {

209 ià(!
	`çke_pÿp_dÉ_fÜû_abË
(
_lškty³
))

210  
”rh
->
	`”rÜ
("%s: unknowÀlškty³ %d; cª'ˆfÜû IP…ack‘s", 
_f’ame
.
	`c_¡r
(), 
_lškty³
);

211 ià(
_timšg
)

212  
”rh
->
	`”rÜ
("FORCE_IP‡nd TIMING options‡re incompatible");

216 ià(
_Ï¡_time_h
 && _Ï¡_time_h->
	`š™Ÿlize_wr™e
(
this
, 
”rh
) < 0)

220 
_pos
 = 0;

221 ià(
	`»ad_·ck‘
(
”rh
))

222 
_time_off£t
 = 
Time¡amp
::
	`now
(è- 
_·ck‘
->
	`time¡amp_ªno
();

224 ià(
	`ouut_is_push
(0))

225 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_aùive
, 
”rh
);

227 
	}
}

230 
	gFromFÏnDump
::
	$ş—nup
(
CËªupSge
)

232 
i
 = 0; i < 
FF_LAST
; i++)

233 
d–‘e
 
_ff
[
i
];

234 
	}
}

237 
	gFromFÏnDump
::
	$£t_aùive
(
boŞ
 
aùive
)

239 ià(
_aùive
 !ğ
aùive
) {

240 
_aùive
 = 
aùive
;

241 ià(
aùive
 && 
	`ouut_is_push
(0è&& !
_sk
.
	`scheduËd
())

242 
_sk
.
	`»scheduË
();

244 
	}
}

247 
Pack‘
 *

248 
	gFromFÏnDump
::
	$»ad_æow_·ck‘
()

250 ià(
_»cÜd
 >ğ
_Ï¡_»cÜd
) {

251 
	`as£¹
(
_»cÜd
 =ğ
_Ï¡_»cÜd
);

252 
_Ï¡_»cÜd
 = 0;

253 
i
 = 
FF_FIRST_FLOW
; i < 
FF_LAST_FLOW
; i++)

254 ià(
_ff
[
i
]) {

255 
_ff
[
i
]->
	`»ad_mÜe
(
_»cÜd
);

256 ià(
_Ï¡_»cÜd
 =ğ0 || 
_ff
[
i
]->
	`Ï¡_»cÜd
() < _last_record)

257 
_Ï¡_»cÜd
 = 
_ff
[
i
]->
	`Ï¡_»cÜd
();

259 ià(
_»cÜd
 >ğ
_Ï¡_»cÜd
)

263 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(0, (
şick_
è+ (
şick_tı
));

264 ià(!
q
) {

265 
	`”rÜ_h–³r
("out of memory!");

269 
q
->
	`£t_ÃtwÜk_h—d”
(q->
	`d©a
(), (
şick_
));

270 
şick_
 *
h
 = 
q
->
	`_h—d”
();

271 
h
->
_v
 = 4;

272 
h
->
_hl
 = ((
şick_
) >> 2);

273 ià(
_ff
[
FF_SADDR
])

274 
h
->
_¤c
.
s_addr
 = 
_ff
[
FF_SADDR
]->
	`»ad_ušt32
(
_»cÜd
);

275 ià(
_ff
[
FF_DADDR
])

276 
h
->
_d¡
.
s_addr
 = 
_ff
[
FF_DADDR
]->
	`»ad_ušt32
(
_»cÜd
);

278 
şick_tı
 *
tıh
 = 
q
->
	`tı_h—d”
();

279 ià(
_ff
[
FF_SPORT
])

280 
tıh
->
th_¥Üt
 = 
_ff
[
FF_SPORT
]->
	`»ad_ušt16
(
_»cÜd
);

281 ià(
_ff
[
FF_DPORT
])

282 
tıh
->
th_dpÜt
 = 
_ff
[
FF_DPORT
]->
	`»ad_ušt16
(
_»cÜd
);

284 
	}
}

286 
boŞ


287 
	gFromFÏnDump
::
	$»ad_·ck‘
(
E¼ÜHªdËr
 *
”rh
)

289 cÚ¡ 
DAGC–l
 *
ûÎ
;

290 
DAGC–l
 
¡©ic_ûÎ
;

291 
timev®
 
tv
;

292 
Pack‘
 *
p
;

293 
boŞ
 
mÜe
 = 
Œue
;

294 
_·ck‘
 = 0;

296 
»Œy
:

298 ià(!
mÜe
)

299  
çl£
;

302 ià(
_pos
 + (
DAGC–l
è<ğ
_Ën
) {

303 
ûÎ
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
DAGC–l
 *>(
_bufãr
 + 
_pos
);

304 
_pos
 +ğ(
DAGC–l
);

306 
ûÎ
 = &
¡©ic_ûÎ
;

307 ià(
	`»ad_što
(&
¡©ic_ûÎ
, (
DAGC–l
), 
”rh
) < ()(DAGCell))

308  
çl£
;

312 
check_times
:

313 
	`¡amp_to_timev®
(
	`sw­q
(
ûÎ
->
time¡amp
), 
tv
);

314 ià(!
_have_ªy_times
)

315 
	`´•¬e_times
(
tv
);

316 ià(
_have_fœ¡_time
) {

317 ià(
	`tim”cmp
(&
tv
, &
_fœ¡_time
, <))

318 
»Œy
;

320 
_have_fœ¡_time
 = 
çl£
;

322 ià(
_have_Ï¡_time
 && !
	`tim”cmp
(&
tv
, &
_Ï¡_time
, <)) {

323 
_have_Ï¡_time
 = 
çl£
;

324 (è
_Ï¡_time_h
->
	`ÿÎ_wr™e
(
this
, 
”rh
);

325 ià(!
_aùive
)

326 
mÜe
 = 
çl£
;

328 
check_times
;

332 ià(
_§m¶šg_´ob
 < (1 << 
SAMPLING_SHIFT
)

333 && (
	`şick_¿ndom
(è& ((1<<
SAMPLING_SHIFT
)-1)è>ğ
_§m¶šg_´ob
)

334 
»Œy
;

337 ià(
ûÎ
 !ğ&
¡©ic_ûÎ
) {

338 
p
 = 
_d©a_·ck‘
->
	`şÚe
();

339 ià(!
p
) {

340 
	`”rÜ_h–³r
(
”rh
, "out of memory!");

341  
çl£
;

343 
p
->
	`shršk_·ck‘
(
_pos
 - (
DAGC–l
è+ DAGC–l::
PAYLOAD_OFFSET
, (DAGCell) - DAGCell::PAYLOAD_OFFSET);

344 
p
->
	`£t_time¡amp_ªno
(
tv
);

347 
Wr™abËPack‘
 *
wp
 = 
Pack‘
::
	`make
(0, 0, (
DAGC–l
è- DAGC–l::
PAYLOAD_OFFSET
, 0);

348 ià(!
wp
) {

349 
	`”rÜ_h–³r
(
”rh
, "out of memory!");

350  
çl£
;

352 
	`memıy
(
wp
->
	`d©a
(), &
ûÎ
->
·ylßd
, (cell->payload));

353 
wp
->
	`£t_time¡amp_ªno
(
tv
);

355 
p
 = 
wp
;

358 ià(
_fÜû_
 && !
	`çke_pÿp_fÜû_
(
p
, 
_lškty³
)) {

359 
	`checked_ouut_push
(1, 
p
);

360 
»Œy
;

363 
_·ck‘
 = 
p
;

364  
mÜe
;

365 
	}
}

367 
boŞ


368 
	gFromFÏnDump
::
	$run_sk
(
Task
 *)

370 ià(!
_aùive
)

373 
boŞ
 
mÜe
;

374 ià(
_·ck‘
 || 
	`»ad_·ck‘
(0)) {

375 ià(
_timšg


376 && 
_·ck‘
->
	`time¡amp_ªno
(è+ 
_time_off£t
 >ğ
Time¡amp
::
	`now
()) {

377 
_sk
.
	`ç¡_»scheduË
();

380 
	`ouut
(0).
	`push
(
_·ck‘
);

381 
mÜe
 = 
	`»ad_·ck‘
(0);

383 
mÜe
 = 
çl£
;

385 ià(
mÜe
)

386 
_sk
.
	`ç¡_»scheduË
();

387 ià(
_¡İ
)

388 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

389 
	}
}

391 
Pack‘
 *

392 
	gFromFÏnDump
::
	$puÎ
()

394 ià(!
_aùive
)

397 
boŞ
 
mÜe
;

398 
Pack‘
 *
p
;

399 ià(
_·ck‘
 || 
	`»ad_·ck‘
(0)) {

400 ià(
_timšg


401 && 
_·ck‘
->
	`time¡amp_ªno
(è+ 
_time_off£t
 >ğ
Time¡amp
::
	`now
())

403 
p
 = 
_·ck‘
;

404 
mÜe
 = 
	`»ad_·ck‘
(0);

406 
p
 = 0;

407 
mÜe
 = 
çl£
;

410 ià(!
mÜe
 && 
_¡İ
)

411 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

412  
p
;

413 
	}
}

416 
	mACTIVE_THUNK
, 
	mSTOP_THUNK
, 
	mFILESIZE_THUNK
, 
	mFILEPOS_THUNK


419 
SŒšg


420 
	gFromFÏnDump
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

422 
FromFÏnDump
 *
fd
 = 
¡©ic_ÿ¡
<FromFÏnDum°*>(
e
);

423 (
šŒ_t
)
thunk
) {

424 
ACTIVE_THUNK
:

425  
BoŞArg
::
	`uÅ¬£
(
fd
->
_aùive
);

426 
FILESIZE_THUNK
: {

427 
¡©
 
s
;

428 ià(
fd
->
_fd
 >ğ0 && 
	`f¡©
(fd->_fd, &
s
è>ğ0 && 
	`S_ISREG
(s.
¡_mode
))

429  
	`SŒšg
(
s
.
¡_size
);

433 
FILEPOS_THUNK
:

434  
	`SŒšg
(
fd
->
_fe_off£t
 + fd->
_pos
);

438 
	}
}

441 
	gFromFÏnDump
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s_š
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

443 
FromFÏnDump
 *
fd
 = 
¡©ic_ÿ¡
<FromFÏnDum°*>(
e
);

444 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
s_š
);

445 (
šŒ_t
)
thunk
) {

446 
ACTIVE_THUNK
: {

447 
boŞ
 
aùive
;

448 ià(
	`BoŞArg
().
	`·r£
(
s
, 
aùive
)) {

449 
fd
->
	`£t_aùive
(
aùive
);

452  
”rh
->
	`”rÜ
("type mismatch");

454 
STOP_THUNK
:

455 
fd
->
	`£t_aùive
(
çl£
);

456 
fd
->
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

459  -
EINVAL
;

461 
	}
}

464 
	gFromFÏnDump
::
	$add_hªdËrs
()

466 
	`add_»ad_hªdËr
("aùive", 
»ad_hªdËr
, 
ACTIVE_THUNK
, 
HªdËr
::
f_checkbox
);

467 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 
ACTIVE_THUNK
);

468 
	`add_wr™e_hªdËr
("¡İ", 
wr™e_hªdËr
, 
STOP_THUNK
, 
HªdËr
::
f_bu‰Ú
);

469 
	`add_»ad_hªdËr
("fesize", 
»ad_hªdËr
, 
FILESIZE_THUNK
);

470 
	`add_»ad_hªdËr
("f•os", 
»ad_hªdËr
, 
FILEPOS_THUNK
);

471 ià(
	`ouut_is_push
(0))

472 
	`add_sk_hªdËrs
(&
_sk
);

473 
	}
}

475 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
št64
 
çl£
)

476 
	`EXPORT_ELEMENT
(
FromFÏnDump
)

	@analysis/fromflandump.hh

2 #iâdeà
CLICK_FROMFLANDUMP_HH


3 
	#CLICK_FROMFLANDUMP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
şass
 
	gHªdËrC®l
;

141 şas 
	cFromFÏnDump
 : 
public
 
EËm’t
 {…ublic:

143 
	$FromFÏnDump
(è
CLICK_COLD
;

144 ~
	$FromFÏnDump
(è
CLICK_COLD
;

146 cÚ¡ *
	$şass_Çme
() const {  "FromFlanDump"; }

147 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

149 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

150 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

151 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

152 
	$add_hªdËrs
(è
CLICK_COLD
;

154 
boŞ
 
	`run_sk
(
Task
 *);

155 
Pack‘
 *
	`puÎ
();

157 
	`£t_aùive
(
boŞ
);

159 
´iv©e
:

161 cÚ¡ 
ušt32_t
 
BUFFER_SIZE
 = 32768;

162 cÚ¡ 
SAMPLING_SHIFT
 = 28;

164 şas 
	cFÏnFe
 { 
public
:

165 
	`FÏnFe
();

166 ~
	`FÏnFe
();

167 
	`İ’
(cÚ¡ 
SŒšg
 &
ba£Çme
, cÚ¡ SŒšg &
f’ame
, 
»cÜd_size
, 
E¼ÜHªdËr
 *);

168 
	`»ad_mÜe
(
off_t
);

169 
off_t
 
	`Ï¡_»cÜd
() const;

170 
ušt16_t
 
	`»ad_ušt16
(
off_t
) const;

171 
ušt32_t
 
	`»ad_ušt32
(
off_t
) const;

172 
´iv©e
:

173 
_fd
;

174 cÚ¡ 
ušt8_t
 *
_bufãr
;

175 
off_t
 
_off£t
;

176 
ušt32_t
 
_Ën
;

177 
FILE
 *
_pe
;

178 
boŞ
 
_my_bufãr
;

179 
_»cÜd_size
;

180 ’um { 
BUFFER_SIZE
 = 65536 };

181 
	}
};

183 ’um { 
	gFF_FLID
 = 0, 
	gFF_TIME
, 
	gFF_SIZE
, 
	gFF_FLAGS
,

184 
	gFF_SADDR
, 
	gFF_DADDR
, 
	gFF_DPORT
, 
	gFF_CT_PKT
, 
	gFF_CT_BYTES
, 
	gFF_BEG
,

185 
	gFF_FIRST_PKT
 = 
FF_FLID
, 
	gFF_LAST_PKT
 = 
FF_FLAGS
 + 1,

186 
	gFF_FIRST_FLOW
 = 
FF_SADDR
, 
	gFF_LAST_FLOW
 = 
FF_BEG
 + 1,

187 
	gFF_LAST
 = 
FF_LAST_FLOW
 };

188 
FÏnFe
 *
	g_ff
[
FF_LAST
];

190 
off_t
 
	g_»cÜd
;

191 
off_t
 
	g_Ï¡_»cÜd
;

193 
boŞ
 
	g_æows
 : 1;

194 
boŞ
 
	g_¡İ
 : 1;

195 
boŞ
 
	g_aùive
;

197 
Task
 
	g_sk
;

199 
SŒšg
 
	g_dœÇme
;

201 
”rÜ_h–³r
(
E¼ÜHªdËr
 *, const *);

202 
»ad_bufãr
(
E¼ÜHªdËr
 *);

203 
»ad_što
(*, 
ušt32_t
, 
E¼ÜHªdËr
 *);

204 
boŞ
 
»ad_·ck‘
(
E¼ÜHªdËr
 *);

206 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

207 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

209 
	}
};

211 
šlše
 
off_t


212 
	gFromFÏnDump
::
FÏnFe
::
	$Ï¡_»cÜd
() const

214  (
_off£t
 + 
_Ën
è/ 
_»cÜd_size
;

215 
	}
}

217 
šlše
 
ušt16_t


218 
	gFromFÏnDump
::
FÏnFe
::
	$»ad_ušt16
(
off_t
 
o
) const

220  *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt16_t
 *>(
_bufãr
 + 
o
<<1 - 
_off£t
);

221 
	}
}

223 
šlše
 
ušt32_t


224 
	gFromFÏnDump
::
FÏnFe
::
	$»ad_ušt32
(
off_t
 
o
) const

226  *
»š‹½»t_ÿ¡
<cÚ¡ 
ušt16_t
 *>(
_bufãr
 + 
o
<<2 - 
_off£t
);

227 
	}
}

	@analysis/fromipsumdump.cc

20 
	~<şick/cÚfig.h
>

22 
	~"äomsumdump.hh
"

23 
	~<şick/¬gs.hh
>

24 
	~<şick/rou‹r.hh
>

25 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

26 
	~<şick/”rÜ.hh
>

27 
	~<şick/glue.hh
>

28 
	~<şick/¡¿ccum.hh
>

29 
	~<şickÃt/.h
>

30 
	~<şickÃt/udp.h
>

31 
	~<şickÃt/tı.h
>

32 
	~<şickÃt/icmp.h
>

33 
	~<şick/·ck‘_ªno.hh
>

34 
	~<şick/Çmešfo.hh
>

35 
	~<şick/u£ruts.hh
>

36 
	~<uni¡d.h
>

37 
	~<sys/ty³s.h
>

38 
	~<sys/¡©.h
>

39 
	~<fú.h
>

40 
	gCLICK_DECLS


42 #ifdeà
i386


43 
	#GET4
(
p
è
	`Áohl
(*
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(Õ)))

	)

44 
	#GET2
(
p
è
	`Áohs
(*
»š‹½»t_ÿ¡
<cÚ¡ 
ušt16_t
 *>(Õ)))

	)

46 
	#GET4
(
p
è((Õ)[0]<<24è| (Õ)[1]<<16è| (Õ)[2]<<8è| (p)[3])

	)

47 
	#GET2
(
p
è((Õ)[0]<<8è| (p)[1])

	)

49 
	#GET1
(
p
è(Õ)[0])

	)

51 
	gFromIPSumm¬yDump
::
	$FromIPSumm¬yDump
()

52 : 
	`_wÜk_·ck‘
(0), 
	`_sk
(
this
), 
	$_tim”
(
this
)

54 
_ff
.
	`£t_Ïndm¬k_·‰”n
("%f:%l");

55 
	}
}

57 
	gFromIPSumm¬yDump
::~
	$FromIPSumm¬yDump
()

59 
	}
}

62 
FromIPSumm¬yDump
::
	$ÿ¡
(cÚ¡ *
n
)

64 ià(
	`¡rcmp
(
n
, 
NÙif›r
::
EMPTY_NOTIFIER
è=ğ0 && !
	`ouut_is_push
(0))

65  
¡©ic_ÿ¡
<
NÙif›r
 *>(&
_nÙif›r
);

67  
EËm’t
::
	`ÿ¡
(
n
);

68 
	}
}

71 
	gFromIPSumm¬yDump
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

73 
boŞ
 
	g¡İ
 = 
çl£
, 
	gaùive
 = 
Œue
, 
	gz”o
 =rue, 
	gchecksum
 = f®£, 
	gmuÉack‘
 = f®£, 
	gtimšg
 = f®£, 
	g®low_nÚexi¡’t
 = false;

74 
ušt8_t
 
	gdeçuÉ_´Ùo
 = 
IP_PROTO_TCP
;

75 
	g_§m¶šg_´ob
 = (1 << 
SAMPLING_SHIFT
);

76 
SŒšg
 
	gdeçuÉ_cÚ‹Ás
, 
	gdeçuÉ_æowid
, 
	gd©a
;

78 ià(
Args
(
cÚf
, 
this
, 
”rh
)

79 .
»ad_p
("FILENAME", 
F’ameArg
(), 
_ff
.
f’ame
())

80 .
»ad
("STOP", 
¡İ
)

81 .
»ad
("ACTIVE", 
aùive
)

82 .
»ad
("ZERO", 
z”o
)

83 .
»ad
("TIMING", 
timšg
)

84 .
»ad
("CHECKSUM", 
checksum
)

85 .
»ad
("SAMPLE", 
FixedPoštArg
(
SAMPLING_SHIFT
), 
_§m¶šg_´ob
)

86 .
»ad
("PROTO", 
deçuÉ_´Ùo
)

87 .
»ad
("MULTIPACKET", 
muÉack‘
)

88 .
»ad
("DEFAULT_CONTENTS", 
AnyArg
(), 
deçuÉ_cÚ‹Ás
)

89 .
»ad
("DEFAULT_FIELDS", 
AnyArg
(), 
deçuÉ_cÚ‹Ás
)

90 .
»ad
("DEFAULT_FLOWID", 
AnyArg
(), 
deçuÉ_æowid
)

91 .
»ad
("CONTENTS", 
AnyArg
(), 
deçuÉ_cÚ‹Ás
)

92 .
»ad
("FIELDS", 
AnyArg
(), 
deçuÉ_cÚ‹Ás
)

93 .
»ad
("FLOWID", 
AnyArg
(), 
deçuÉ_æowid
)

94 .
»ad
("ALLOW_NONEXISTENT", 
®low_nÚexi¡’t
)

95 .
»ad
("DATA", 
d©a
)

96 .
com¶‘e
() < 0)

98 ià(
	g_§m¶šg_´ob
 > (1 << 
	gSAMPLING_SHIFT
)) {

99 
	g”rh
->
w¬nšg
("SAMPLE…robability„educedo 1");

100 
	g_§m¶šg_´ob
 = (1 << 
SAMPLING_SHIFT
);

101 } ià(
	g_§m¶šg_´ob
 == 0)

102 
”rh
->
w¬nšg
("SAMPLE…robability is 0;ƒmitting‚o…ackets");

104 
	g_deçuÉ_´Ùo
 = 
deçuÉ_´Ùo
;

105 
	g_¡İ
 = 
¡İ
;

106 
	g_aùive
 = 
aùive
;

107 
	g_z”o
 = 
z”o
;

108 
	g_checksum
 = 
checksum
;

109 
	g_timšg
 = 
timšg
;

110 
	g_®low_nÚexi¡’t
 = 
®low_nÚexi¡’t
;

111 
	g_have_timšg
 = 
çl£
;

112 
	g_muÉack‘
 = 
muÉack‘
;

113 
	g_have_æowid
 = 
_have_agg»g©e
 = 
_bš¬y
 = 
çl£
;

114 ià(
	gdeçuÉ_cÚ‹Ás
)

115 
bªg_d©a
(
deçuÉ_cÚ‹Ás
, 
”rh
);

116 ià(
	gdeçuÉ_æowid
)

117 
bªg_æowid
(
deçuÉ_æowid
, 
”rh
);

118 ià(
	gd©a
 && 
	g_ff
.
f’ame
())

119  
	g”rh
->
”rÜ
("FILENAME‡nd DATA conflict");

120 ià(
	gd©a
 && 
	g_ff
.
£t_d©a
(
d©a
, 
”rh
) < 0)

122 ià(!
	g_ff
.
f’ame
())

123  
	g”rh
->
”rÜ
("FILENAME:„equired‡rgument missing");

128 
	gFromIPSumm¬yDump
::
	$»ad_bš¬y
(
SŒšg
 &
»suÉ
, 
E¼ÜHªdËr
 *
”rh
)

130 
	`as£¹
(
_bš¬y
);

132 
ušt8_t
 
»cÜd_¡Üage
[4];

133 cÚ¡ 
ušt8_t
 *
»cÜd
 = 
_ff
.
	`g‘_uÇligÃd
(4, 
»cÜd_¡Üage
, 
”rh
);

134 ià(!
»cÜd
)

136 
»cÜd_Ëngth
 = 
	`GET4
(
»cÜd
) & 0x7FFFFFFFU;

137 ià(
»cÜd_Ëngth
 < 4)

138  
_ff
.
	`”rÜ
(
”rh
, "binary„ecordoo short");

139 
boŞ
 
‹xtu®
 = (
»cÜd
[0] & 0x80 ? 
Œue
 : 
çl£
);

140 
»suÉ
 = 
_ff
.
	`g‘_¡ršg
(
»cÜd_Ëngth
 - 4, 
”rh
);

141 ià(!
»suÉ
)

143 ià(
‹xtu®
) {

144 cÚ¡ *
s
 = 
»suÉ
.
	`begš
(), *
e
 =„esuÉ.
	`’d
();

145 
e
 > 
s
 &&ƒ[-1] == 0)

146 
e
--;

147 ià(
e
 !ğ
»suÉ
.
	`’d
())

148 
»suÉ
 =„esuÉ.
	`sub¡ršg
(
s
, 
e
);

150 
_ff
.
	`£t_lš’o
(_ff.
	`lš’o
() + 1);

151  (
‹xtu®
 ? 2 : 1);

152 
	}
}

155 
	gFromIPSumm¬yDump
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

158 ià(!
	`ouut_is_push
(0))

159 
_nÙif›r
.
	`š™Ÿlize
(
NÙif›r
::
EMPTY_NOTIFIER
, 
	`rou‹r
());

160 
_tim”
.
	`š™Ÿlize
(
this
);

161 
_fÜm©_com¶ašt
 = 
çl£
;

162 ià(
	`ouut_is_push
(0))

163 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_aùive
, 
”rh
);

165 
e
 = 
_ff
.
	`š™Ÿlize
(
”rh
, 
_®low_nÚexi¡’t
);

166 ià(
e
 =ğ-
ENOENT
 && 
_®low_nÚexi¡’t
)

168 ià(
e
 < 0)

169  
e
;

171 
_mšÜ_v”siÚ
 = 
IPSumm¬yDump
::
MINOR_VERSION
;

172 
SŒšg
 
lše
;

173 ià(
_ff
.
	`³ek_lše
(
lše
, 
”rh
, 
Œue
) < 0)

175 ià(
lše
.
	`sub¡ršg
(0, 14) == "!IPSummaryDump") {

176 
majÜ_v”siÚ
;

177 ià(
	`ssÿnf
(
lše
.
	`c_¡r
(è+ 14, " %d.%d", &
majÜ_v”siÚ
, &
_mšÜ_v”siÚ
) == 2) {

178 ià(
majÜ_v”siÚ
 !ğ
IPSumm¬yDump
::
MAJOR_VERSION
 || 
_mšÜ_v”siÚ
 > IPSumm¬yDump::
MINOR_VERSION
) {

179 
_ff
.
	`w¬nšg
(
”rh
, "uÃx³ùed IPSumm¬yDum°v”siÚ %d.%d", 
majÜ_v”siÚ
, 
_mšÜ_v”siÚ
);

180 
_mšÜ_v”siÚ
 = 
IPSumm¬yDump
::
MINOR_VERSION
;

183 (è
_ff
.
	`»ad_lše
(
lše
, 
”rh
, 
Œue
);

186 ià(!
lše
.
	`sub¡ršg
(0, 8).
	`equ®s
("!creator", 8)

187 && !
lše
.
	`sub¡ršg
(0, 5).
	`equ®s
("!data", 5)

188 && !
lše
.
	`sub¡ršg
(0, 9).
	`equ®s
("!contents", 9)

189 && !
lše
.
	`sub¡ršg
(0, 6).
	`equ®s
("!proto", 6)

190 && !
lše
.
	`sub¡ršg
(0, 7).
	`equ®s
("!flowid", 7)) {

191 ià(!
_f›lds
.
	`size
() )

192 
_ff
.
	`w¬nšg
(
”rh
, "missing banner†ine; ishis‡n IP summary dump?");

197 
	}
}

200 
	gFromIPSumm¬yDump
::
	$ş—nup
(
CËªupSge
)

202 
_ff
.
	`ş—nup
();

203 ià(
_wÜk_·ck‘
)

204 
_wÜk_·ck‘
->
	`kl
();

205 
_wÜk_·ck‘
 = 0;

206 
	}
}

209 
	gFromIPSumm¬yDump
::
	$sÜt_f›lds_com·»
(cÚ¡ *
­
, cÚ¡ *
bp
,

210 *
u£r_d©a
)

212 
a
 = *
»š‹½»t_ÿ¡
<cÚ¡ *>(
­
);

213 
b
 = *
»š‹½»t_ÿ¡
<cÚ¡ *>(
bp
);

214 
FromIPSumm¬yDump
 *
f
 = 
»š‹½»t_ÿ¡
<FromIPSumm¬yDum°*>(
u£r_d©a
);

215 cÚ¡ 
IPSumm¬yDump
::
F›ldR—d”
 *
ç
 = 
f
->
_f›lds
[
a
];

216 cÚ¡ 
IPSumm¬yDump
::
F›ldR—d”
 *
fb
 = 
f
->
_f›lds
[
b
];

217 ià(
ç
->
Üd”
 < 
fb
->order)

219 ià(
ç
->
Üd”
 > 
fb
->order)

221  (
a
 < 
b
 ? -1 : (a == b ? 0 : 1));

222 
	}
}

225 
	gFromIPSumm¬yDump
::
	$bªg_d©a
(cÚ¡ 
SŒšg
 &
lše
, 
E¼ÜHªdËr
 *
”rh
)

227 
VeùÜ
<
SŒšg
> 
wÜds
;

228 
	`ı_¥aûvec
(
lše
, 
wÜds
);

230 
_f›lds
.
	`ş—r
();

231 
_f›ld_Üd”
.
	`ş—r
();

232 
i
 = 0; i < 
wÜds
.
	`size
(); i++) {

233 
SŒšg
 
wÜd
 = 
	`ı_unquÙe
(
wÜds
[
i
]);

234 ià(
i
 =ğ0 && (
wÜd
 == "!data" || word == "!contents"))

236 cÚ¡ 
IPSumm¬yDump
::
F›ldR—d”
 *
f
 = IPSumm¬yDump::F›ldR—d”::
	`fšd
(
wÜd
);

237 ià(!
f
) {

238 
_ff
.
	`w¬nšg
(
”rh
, "unknowÀcÚ‹Áy³ '%s'", 
wÜd
.
	`c_¡r
());

239 
f
 = &
IPSumm¬yDump
::
nuÎ_»ad”
;

240 } ià(!
f
->
šjeù
) {

241 
_ff
.
	`w¬nšg
(
”rh
, "cÚ‹Áy³ '%s' ignÜed oÀšput", 
wÜd
.
	`c_¡r
());

242 
f
 = &
IPSumm¬yDump
::
nuÎ_»ad”
;

244 
_f›lds
.
	`push_back
(
f
);

245 
_f›ld_Üd”
.
	`push_back
(
_f›lds
.
	`size
() - 1);

248 ià(
_f›lds
.
	`size
() == 0)

249 
_ff
.
	`”rÜ
(
”rh
, "no contents specified");

251 
	`şick_qsÜt
(
_f›ld_Üd”
.
	`begš
(), 
_f›lds
.
	`size
(), (),

252 
sÜt_f›lds_com·»
, 
this
);

253 
	}
}

256 
	gFromIPSumm¬yDump
::
	$bªg_´Ùo
(cÚ¡ 
SŒšg
 &
lše
, cÚ¡ *
ty³
,

257 
E¼ÜHªdËr
 *
”rh
)

259 
VeùÜ
<
SŒšg
> 
wÜds
;

260 
	`ı_¥aûvec
(
lše
, 
wÜds
);

261 
št32_t
 
´Ùo
;

263 ià(
wÜds
.
	`size
() != 2)

264 
_ff
.
	`”rÜ
(
”rh
, "bad %s", 
ty³
);

265 ià(
NameInfo
::
	`qu”y_št
(NameInfo::
T_IP_PROTO
, 
this
, 
wÜds
[1], &
´Ùo
)

266 && 
´Ùo
 < 256)

267 
_deçuÉ_´Ùo
 = 
´Ùo
;

268 ià(
wÜds
[1] == "T")

269 
_deçuÉ_´Ùo
 = 
IP_PROTO_TCP
;

270 ià(
wÜds
[1] == "U")

271 
_deçuÉ_´Ùo
 = 
IP_PROTO_UDP
;

272 ià(
wÜds
[1] == "I")

273 
_deçuÉ_´Ùo
 = 
IP_PROTO_ICMP
;

275 
_ff
.
	`”rÜ
(
”rh
, "bad…rÙocŞ iÀ%s", 
ty³
);

276 
	}
}

279 
	gFromIPSumm¬yDump
::
	$bªg_æowid
(cÚ¡ 
SŒšg
 &
lše
, 
E¼ÜHªdËr
 *
”rh
)

281 
VeùÜ
<
SŒšg
> 
wÜds
;

282 
	`ı_¥aûvec
(
lše
, 
wÜds
);

284 
IPAdd»ss
 
¤c
, 
d¡
;

285 
ušt32_t
 
¥Üt
 = 0, 
dpÜt
 = 0;

286 ià(
wÜds
.
	`size
() < 5

287 || (!
	`IPAdd»ssArg
().
	`·r£
(
wÜds
[1], 
¤c
) && words[1] != "-")

288 || (!
	`IÁArg
().
	`·r£
(
wÜds
[2], 
¥Üt
) && words[2] != "-")

289 || (!
	`IPAdd»ssArg
().
	`·r£
(
wÜds
[3], 
d¡
) && words[3] != "-")

290 || (!
	`IÁArg
().
	`·r£
(
wÜds
[4], 
dpÜt
) && words[4] != "-")

291 || 
¥Üt
 > 65535 || 
dpÜt
 > 65535) {

292 
_ff
.
	`”rÜ
(
”rh
, "bad !flowid specification");

293 
_have_æowid
 = 
çl£
;

295 ià(
wÜds
.
	`size
() >= 6)

296 
	`bªg_´Ùo
(
SŒšg
::
	`make_¡abË
("! ", 2è+ 
wÜds
[5], "!æowid", 
”rh
);

297 
_giv’_æowid
 = 
	`IPFlowID
(
¤c
, 
	`htÚs
(
¥Üt
), 
d¡
, htÚs(
dpÜt
));

298 
_have_æowid
 = 
Œue
;

300 
	}
}

303 
	gFromIPSumm¬yDump
::
	$bªg_agg»g©e
(cÚ¡ 
SŒšg
 &
lše
, 
E¼ÜHªdËr
 *
”rh
)

305 
VeùÜ
<
SŒšg
> 
wÜds
;

306 
	`ı_¥aûvec
(
lše
, 
wÜds
);

308 ià(
wÜds
.
	`size
() != 2

309 || !
	`IÁArg
().
	`·r£
(
wÜds
[1], 
_agg»g©e
)) {

310 
_ff
.
	`”rÜ
(
”rh
, "bad !aggregate specification");

311 
_have_agg»g©e
 = 
çl£
;

313 
_have_agg»g©e
 = 
Œue
;

314 
	}
}

317 
	gFromIPSumm¬yDump
::
	$bªg_bš¬y
(cÚ¡ 
SŒšg
 &
lše
, 
E¼ÜHªdËr
 *
”rh
)

319 
VeùÜ
<
SŒšg
> 
wÜds
;

320 
	`ı_¥aûvec
(
lše
, 
wÜds
);

321 ià(
wÜds
.
	`size
() != 1)

322 
_ff
.
	`”rÜ
(
”rh
, "bad !binary specification");

323 
_bš¬y
 = 
Œue
;

324 
_ff
.
	`£t_Ïndm¬k_·‰”n
("%f:record %l");

325 
_ff
.
	`£t_lš’o
(1);

326 
	}
}

329 
	$£t_checksums
(
Wr™abËPack‘
 *
q
, 
şick_
 *
h
)

331 
	`as£¹
(
h
 =ğ
q
->
	`_h—d”
());

333 
h
->
_sum
 = 0;

334 
h
->
_sum
 = 
	`şick_š_cksum
((
ušt8_t
 *)h, iph->
_hl
 << 2);

336 ià(
	`IP_ISFRAG
(
h
))

338 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
) {

339 
şick_tı
 *
tıh
 = 
q
->
	`tı_h—d”
();

340 
tıh
->
th_sum
 = 0;

341 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
tıh
, 
q
->
	`Œª¥Üt_Ëngth
());

342 
tıh
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 
h
, 
q
->
	`Œª¥Üt_Ëngth
());

343 } ià(
h
->
_p
 =ğ
IP_PROTO_UDP
) {

344 
şick_udp
 *
udph
 = 
q
->
	`udp_h—d”
();

345 
udph
->
uh_sum
 = 0;

346 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
udph
, 
q
->
	`Œª¥Üt_Ëngth
());

347 
udph
->
uh_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 
h
, 
q
->
	`Œª¥Üt_Ëngth
());

348 } ià(
h
->
_p
 =ğ
IP_PROTO_ICMP
) {

349 
şick_icmp
 *
icmph
 = 
q
->
	`icmp_h—d”
();

350 
icmph
->
icmp_cksum
 = 0;

351 
icmph
->
icmp_cksum
 = 
	`şick_š_cksum
((cÚ¡ 
ušt8_t
 *èicmph, 
q
->
	`Œª¥Üt_Ëngth
());

353 
	}
}

355 
Pack‘
 *

356 
	gFromIPSumm¬yDump
::
	$»ad_·ck‘
(
E¼ÜHªdËr
 *
”rh
)

359 
boŞ
 
bš¬y
;

360 
SŒšg
 
lše
;

361 cÚ¡ *
d©a
;

362 cÚ¡ *
’d
;

365 ià((
bš¬y
 = 
_bš¬y
)) {

366 
»suÉ
 = 
	`»ad_bš¬y
(
lše
, 
”rh
);

367 ià(
»suÉ
 <= 0)

368 
eof
;

370 
bš¬y
 = (
»suÉ
 == 1);

371 } ià(
_ff
.
	`»ad_lše
(
lše
, 
”rh
, 
Œue
) <= 0) {

372 
eof
:

373 
_ff
.
	`ş—nup
();

377 
d©a
 = 
lše
.
	`begš
();

378 
’d
 = 
lše
.
	`’d
();

380 ià(
d©a
 =ğ
’d
)

382 ià(
bš¬y
 || (
d©a
[0] != '!' && data[0] != '#'))

387 ià(
d©a
[0] == '!') {

388 ià(
d©a
 + 6 <ğ
’d
 && 
	`memcmp
(d©a, "!d©a", 5è=ğ0 && 
	`is¥aû
(() data[5]))

389 
	`bªg_d©a
(
lše
, 
”rh
);

390 ià(
d©a
 + 8 <ğ
’d
 && 
	`memcmp
(d©a, "!æowid", 7è=ğ0 && 
	`is¥aû
(() data[7]))

391 
	`bªg_æowid
(
lše
, 
”rh
);

392 ià(
d©a
 + 7 <ğ
’d
 && 
	`memcmp
(d©a, "!´Ùo", 6è=ğ0 && 
	`is¥aû
(() data[6]))

393 
	`bªg_´Ùo
(
lše
, "!´Ùo", 
”rh
);

394 ià(
d©a
 + 11 <ğ
’d
 && 
	`memcmp
(d©a, "!agg»g©e", 10è=ğ0 && 
	`is¥aû
(() data[10]))

395 
	`bªg_agg»g©e
(
lše
, 
”rh
);

396 ià(
d©a
 + 8 <ğ
’d
 && 
	`memcmp
(d©a, "!bš¬y", 7è=ğ0 && 
	`is¥aû
(() data[7]))

397 
	`bªg_bš¬y
(
lše
, 
”rh
);

398 ià(
d©a
 + 10 <ğ
’d
 && 
	`memcmp
(d©a, "!cÚ‹Ás", 9è=ğ0 && 
	`is¥aû
(() data[9]))

399 
	`bªg_d©a
(
lše
, 
”rh
);

404 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(16, (const *) 0, 0, 1000);

405 ià(!
q
) {

406 
_ff
.
	`”rÜ
(
”rh
, 
	`¡»¼Ü
(
ENOMEM
));

409 ià(
_z”o
)

410 
	`mem£t
(
q
->
	`bufãr
(), 0, q->
	`bufãr_Ëngth
());

413 
SŒšgAccum
 
§
;

414 
IPSumm¬yDump
::
Pack‘Odesc
 
	`d
(
this
, 
q
, 
_deçuÉ_´Ùo
, (
_have_æowid
 ? &
_æowid
 : 0), 
_mšÜ_v”siÚ
);

415 
nf›lds
 = 0;

418 ià(
_bš¬y
) {

419 
VeùÜ
<cÚ¡ *> 
¬gs
;

420 
nby‹s
;

421 cÚ¡ 
IPSumm¬yDump
::
F›ldR—d”
 * cÚ¡ *
å
 = 
_f›lds
.
	`begš
(); f°!ğ_f›lds.
	`’d
(); ++fp) {

422 ià(!(*
å
)->
šb
)

423 
bad_f›ld
;

424 (*
å
)->
ty³
) {

425 
IPSumm¬yDump
::
B_0
:

426 
nby‹s
 = 0;

427 
gÙ_nby‹s
;

428 
IPSumm¬yDump
::
B_1
:

429 
nby‹s
 = 1;

430 
gÙ_nby‹s
;

431 
IPSumm¬yDump
::
B_2
:

432 
nby‹s
 = 2;

433 
gÙ_nby‹s
;

434 
IPSumm¬yDump
::
B_4
:

435 
IPSumm¬yDump
::
B_4NET
:

436 
nby‹s
 = 4;

437 
gÙ_nby‹s
;

438 
IPSumm¬yDump
::
B_6PTR
:

439 
nby‹s
 = 6;

440 
gÙ_nby‹s
;

441 
IPSumm¬yDump
::
B_8
:

442 
nby‹s
 = 8;

443 
gÙ_nby‹s
;

444 
IPSumm¬yDump
::
B_16
:

445 
nby‹s
 = 16;

446 
gÙ_nby‹s
;

447 
gÙ_nby‹s
:

448 ià(
d©a
 + 
nby‹s
 <ğ
’d
) {

449 
¬gs
.
	`push_back
((cÚ¡ *è
d©a
);

450 
d©a
 +ğ
nby‹s
;

452 
bad_f›ld
;

454 
IPSumm¬yDump
::
B_SPECIAL
:

455 
¬gs
.
	`push_back
((cÚ¡ *è
d©a
);

456 
d©a
 = (cÚ¡ *è(*
å
)->
	`šb
(
d
, (cÚ¡ 
ušt8_t
 *èd©a, (cÚ¡ ušt8_ˆ*è
’d
, *fp);

458 
bad_f›ld
:

460 
¬gs
.
	`push_back
(0);

461 
d©a
 = 
’d
;

466 *
f
 = 
_f›ld_Üd”
.
	`begš
();

467 
f
 !ğ
_f›ld_Üd”
.
	`’d
(è&& 
d
.
p
;

468 ++
f
) {

469 cÚ¡ 
IPSumm¬yDump
::
F›ldR—d”
 *
f
 = 
_f›lds
[*
f
];

470 ià(!
¬gs
[*
f
] || !
f
->
šjeù
)

472 
d
.
	`ş—r_v®ues
();

473 ià(
f
->
	`šb
(
d
, 
¬gs
[*
f
], (cÚ¡ 
ušt8_t
 *è
’d
, f)) {

474 
f
->
	`šjeù
(
d
, f);

475 
nf›lds
++;

480 
VeùÜ
<
SŒšg
> 
¬gs
;

481 
¬gs
.
	`size
(è< 
_f›lds
.size()) {

482 cÚ¡ *
Üigš®_d©a
 = 
d©a
;

483 
d©a
 < 
’d
)

484 ià(
	`is¥aû
((è*
d©a
))

486 ià(*
d©a
 == '\"')

487 
d©a
 = 
	`ı_sk_doubË_quÙe
(d©a, 
’d
);

489 ++
d©a
;

490 
¬gs
.
	`push_back
(
lše
.
	`sub¡ršg
(
Üigš®_d©a
, 
d©a
));

491 
d©a
 < 
’d
 && 
	`is¥aû
(() *data))

492 ++
d©a
;

495 *
f
 = 
_f›ld_Üd”
.
	`begš
();

496 
f
 !ğ
_f›ld_Üd”
.
	`’d
(è&& 
d
.
p
;

497 ++
f
) {

498 cÚ¡ 
IPSumm¬yDump
::
F›ldR—d”
 *
f
 = 
_f›lds
[*
f
];

499 ià(!
¬gs
[*
f
] ||‡rgs[*f].
	`equ®s
("-", 1è|| !
f
->
šjeù
)

501 
d
.
	`ş—r_v®ues
();

502 ià(
f
->
	`ša
(
d
, 
¬gs
[*
f
], f)) {

503 
f
->
	`šjeù
(
d
, f);

504 
nf›lds
++;

509 ià(!
nf›lds
) {

510 ià(!
_fÜm©_com¶ašt
) {

512 ià(
bš¬y
 || !
	`ı_is_¥aû
(
lše
)) {

513 ià(
_f›lds
.
	`size
() == 0)

514 
_ff
.
	`”rÜ
(
”rh
, "no '!data'…rovided");

516 
_ff
.
	`”rÜ
(
”rh
, "packet…arseƒrror");

517 
_fÜm©_com¶ašt
 = 
Œue
;

520 ià(
d
.
p
)

521 
d
.
p
->
	`kl
();

522 
d
.
p
 = 0;

526 ià(
d
.
p
 && d.
deçuÉ__æowid
)

527 (è
d
.
	`make_
(0);

530 ià(
d
.
p
 && d.
is_
 && d.p->
	`_h—d”
())

531 (è
d
.
	`make_Œª¥
();

533 ià(
d
.
p
 && d.
is_
 && d.p->
	`_h—d”
()) {

535 
ušt32_t
 
_Ën
;

536 ià(!
d
.
p
->
	`_h—d”
()->
_Ën
) {

537 
_Ën
 = 
d
.
wªt_Ën
;

538 ià(
_Ën
 >ğ(
ušt32_t
è
d
.
p
->
	`ÃtwÜk_h—d”_off£t
())

539 
_Ën
 -ğ
d
.
p
->
	`ÃtwÜk_h—d”_off£t
();

540 ià(
_Ën
 > 0xFFFF)

541 
_Ën
 = 0xFFFF;

542 ià(
_Ën
 == 0)

543 
_Ën
 = 
d
.
p
->
	`ÃtwÜk_Ëngth
();

544 
d
.
p
->
	`_h—d”
()->
_Ën
 = 
	`htÚs
(ip_len);

546 
_Ën
 = 
	`Áohs
(
d
.
p
->
	`_h—d”
()->ip_len);

549 ià(
d
.
p
->
	`_h—d”
()->
_p
 =ğ
IP_PROTO_UDP


550 && 
	`IP_FIRSTFRAG
(
d
.
p
->
	`_h—d”
())

551 && !
d
.
p
->
	`udp_h—d”
()->
uh_uËn
) {

552 
Ën
 = 
_Ën
 - 
d
.
p
->
	`ÃtwÜk_h—d”_Ëngth
();

553 
d
.
p
->
	`udp_h—d”
()->
uh_uËn
 = 
	`htÚs
(
Ën
);

557 
d
.
p
->
	`£t_d¡__ªno
(d.p->
	`_h—d”
()->
_d¡
);

560 ià(
_checksum
) {

561 
ušt32_t
 
xËn
 = 0;

562 ià(
_Ën
 > (
ušt32_t
è
d
.
p
->
	`ÃtwÜk_Ëngth
())

563 
xËn
 = 
_Ën
 - 
d
.
p
->
	`ÃtwÜk_Ëngth
();

564 ià(!
xËn
 || (
d
.
p
 = d.p->
	`put
(xlen))) {

565 ià(
xËn
 && 
_z”o
)

566 
	`mem£t
(
d
.
p
->
	`’d_d©a
(è- 
xËn
, 0, xlen);

567 
	`£t_checksums
(
d
.
p
, d.p->
	`_h—d”
());

573 ià(
d
.
p
 && d.
wªt_Ën
 > d.p->
	`Ëngth
())

574 
	`SET_EXTRA_LENGTH_ANNO
(
d
.
p
, d.
wªt_Ën
 - d.p->
	`Ëngth
());

576  
d
.
p
;

577 
	}
}

579 
šlše
 
Pack‘
 *

580 
	$£t_·ck‘_Ëngths
(
Pack‘
 *
p
, 
ušt32_t
 
exŒa_Ëngth
)

582 
ušt32_t
 
Ëngth
 = 
p
->
	`Ëngth
(è+ 
exŒa_Ëngth
;

583 ià(
	`htÚs
(
Ëngth
è!ğ
p
->
	`_h—d”
()->
_Ën
) {

584 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
()) {

585 
şick_
 *

 = 
q
->
	`_h—d”
();

586 

->
_Ën
 = 
	`htÚs
(
Ëngth
);

587 ià(

->
_p
 =ğ
IP_PROTO_UDP
)

588 
q
->
	`udp_h—d”
()->
uh_uËn
 = 
	`htÚs
(
Ëngth
 - (

->
_hl
 << 2));

589  
q
;

593  
p
;

594 
	}
}

596 
Pack‘
 *

597 
	gFromIPSumm¬yDump
::
	$hªdË_muÉack‘
(
Pack‘
 *
p
)

599 
	`as£¹
(!
_wÜk_·ck‘
 || _wÜk_·ck‘ =ğ
p
);

601 ià(!
p
 || !
	`EXTRA_PACKETS_ANNO
(p)) {

602 
_wÜk_·ck‘
 = 0;

603  
p
;

606 
ušt32_t
 
couÁ
 = 1 + 
	`EXTRA_PACKETS_ANNO
(
p
);

609 ià(!
_wÜk_·ck‘
) {

610 
	`as£¹
(
couÁ
 > 1);

612 
_muÉack‘_Ëngth
 = (
p
->
	`Ëngth
(è+ 
	`EXTRA_LENGTH_ANNO
Õ)è/ 
couÁ
;

614 ià(
_muÉack‘_Ëngth
 < 
p
->
	`Ëngth
()) {

615 
_muÉack‘_Ëngth
 = 
p
->
	`Ëngth
();

616 
	`SET_EXTRA_LENGTH_ANNO
(
p
, 
_muÉack‘_Ëngth
 * (
couÁ
 - 1));

619 
_muÉack‘_’d_time¡amp
 = 
p
->
	`time¡amp_ªno
();

620 ià(
	`FIRST_TIMESTAMP_ANNO
(
p
)) {

621 
_muÉack‘_time¡amp_d–
 = (
p
->
	`time¡amp_ªno
(è- 
	`FIRST_TIMESTAMP_ANNO
Õ)è/ (
couÁ
 - 1);

622 
p
->
	`time¡amp_ªno
(èğ
	`FIRST_TIMESTAMP_ANNO
(p);

624 
_muÉack‘_time¡amp_d–
 = 
	`Time¡amp
();

626 
_wÜk_·ck‘
 = 
	`£t_·ck‘_Ëngths
(
p
, 
_muÉack‘_Ëngth
 -…->
	`Ëngth
());

627 ià(!
_wÜk_·ck‘
)

632 ià((
p
 =…->
	`şÚe
())) {

633 
	`SET_EXTRA_PACKETS_ANNO
(
p
, 0);

634 
	`SET_EXTRA_LENGTH_ANNO
(
p
, 
_muÉack‘_Ëngth
 -…->
	`Ëngth
());

638 
	`SET_EXTRA_PACKETS_ANNO
(
_wÜk_·ck‘
, 
couÁ
 - 2);

639 
	`SET_EXTRA_LENGTH_ANNO
(
_wÜk_·ck‘
, 
	`EXTRA_LENGTH_ANNO
(_wÜk_·ck‘è- 
_muÉack‘_Ëngth
);

640 ià(
couÁ
 == 2) {

641 
_wÜk_·ck‘
->
	`time¡amp_ªno
(èğ
_muÉack‘_’d_time¡amp
;

642 
_wÜk_·ck‘
 = 
	`£t_·ck‘_Ëngths
(_wÜk_·ck‘, 
	`EXTRA_LENGTH_ANNO
(_work_packet));

644 
_wÜk_·ck‘
->
	`time¡amp_ªno
(è+ğ
_muÉack‘_time¡amp_d–
;

646  
p
;

647 
	}
}

650 
	gFromIPSumm¬yDump
::
	$run_tim”
(
Tim”
 *)

652 ià(
_aùive
) {

653 ià(
	`ouut_is_puÎ
(0))

654 
_nÙif›r
.
	`wake
();

656 
_sk
.
	`»scheduË
();

658 
	}
}

660 
boŞ


661 
	gFromIPSumm¬yDump
::
	$check_timšg
(
Pack‘
 *
p
)

663 
	`as£¹
(!
_wÜk_·ck‘
 || _wÜk_·ck‘ =ğ
p
);

664 
Time¡amp
 
now_s
 = Time¡amp::
	`now_¡—dy
();

665 ià(!
_have_timšg
) {

666 
_timšg_off£t
 = 
now_s
 - 
p
->
	`time¡amp_ªno
();

667 
_have_timšg
 = 
Œue
;

669 
Time¡amp
 
t
 = 
p
->
	`time¡amp_ªno
(è+ 
_timšg_off£t
;

670 ià(
now_s
 < 
t
) {

671 
t
 -ğ
Tim”
::
	`adju¡m’t
();

672 ià(
now_s
 < 
t
) {

673 
_tim”
.
	`scheduË_©_¡—dy
(
t
);

674 ià(
	`ouut_is_puÎ
(0))

675 
_nÙif›r
.
	`¦“p
();

677 ià(
	`ouut_is_push
(0))

678 
_sk
.
	`ç¡_»scheduË
();

680 
_wÜk_·ck‘
 = 
p
;

681  
çl£
;

683 
_wÜk_·ck‘
 = 0;

684  
Œue
;

685 
	}
}

687 
boŞ


688 
	gFromIPSumm¬yDump
::
	$run_sk
(
Task
 *)

690 ià(!
_aùive
)

691  
çl£
;

692 
Pack‘
 *
p
;

695 
p
 = (
_wÜk_·ck‘
 ? _wÜk_·ck‘ : 
	`»ad_·ck‘
(0));

696 ià(!
p
 && !
_ff
.
	`š™Ÿlized
()) {

697 ià(
_¡İ
)

698 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

699  
çl£
;

700 } ià(!
p
)

702 ià(
p
 && 
_timšg
 && !
	`check_timšg
(p))

703  
çl£
;

704 ià(
_muÉack‘
)

705 
p
 = 
	`hªdË_muÉack‘
(p);

707 ià(
_§m¶šg_´ob
 >ğ(1 << 
SAMPLING_SHIFT
)

708 || (
	`şick_¿ndom
(è& ((1 << 
SAMPLING_SHIFT
è- 1)è< 
_§m¶šg_´ob
)

710 ià(
p
)

711 
p
->
	`kl
();

714 ià(
p
)

715 
	`ouut
(0).
	`push
(
p
);

716 
_sk
.
	`ç¡_»scheduË
();

717  
Œue
;

718 
	}
}

720 
Pack‘
 *

721 
	gFromIPSumm¬yDump
::
	$puÎ
()

723 ià(!
_aùive
)

725 
Pack‘
 *
p
;

728 
p
 = (
_wÜk_·ck‘
 ? _wÜk_·ck‘ : 
	`»ad_·ck‘
(0));

729 ià(!
p
 && !
_ff
.
	`š™Ÿlized
()) {

730 ià(
_¡İ
)

731 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

732 
_nÙif›r
.
	`¦“p
();

735 ià(
p
 && 
_timšg
 && !
	`check_timšg
(p))

737 ià(
_muÉack‘
)

738 
p
 = 
	`hªdË_muÉack‘
(p);

740 ià(
_§m¶šg_´ob
 >ğ(1 << 
SAMPLING_SHIFT
)

741 || (
	`şick_¿ndom
(è& ((1 << 
SAMPLING_SHIFT
è- 1)è< 
_§m¶šg_´ob
)

743 ià(
p
)

744 
p
->
	`kl
();

747 
_nÙif›r
.
	`wake
();

748  
p
;

749 
	}
}

752 ’um { 
	mH_SAMPLING_PROB
, 
	mH_ACTIVE
, 
	mH_ENCAP
, 
	mH_STOP
 };

754 
SŒšg


755 
	gFromIPSumm¬yDump
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

757 
FromIPSumm¬yDump
 *
fd
 = 
¡©ic_ÿ¡
<FromIPSumm¬yDum°*>(
e
);

758 (
šŒ_t
)
thunk
) {

759 
H_SAMPLING_PROB
:

760  
	`ı_uÅ¬£_»®2
(
fd
->
_§m¶šg_´ob
, 
SAMPLING_SHIFT
);

761 
H_ACTIVE
:

762  
BoŞArg
::
	`uÅ¬£
(
fd
->
_aùive
);

763 
H_ENCAP
:

768 
	}
}

771 
	gFromIPSumm¬yDump
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s_š
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

773 
FromIPSumm¬yDump
 *
fd
 = 
¡©ic_ÿ¡
<FromIPSumm¬yDum°*>(
e
);

774 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
s_š
);

775 (
šŒ_t
)
thunk
) {

776 
H_ACTIVE
: {

777 
boŞ
 
aùive
;

778 ià(
	`BoŞArg
().
	`·r£
(
s
, 
aùive
)) {

779 
fd
->
_aùive
 = 
aùive
;

780 ià(
fd
->
	`ouut_is_push
(0è&& 
aùive
 && !fd->
_sk
.
	`scheduËd
())

781 
fd
->
_sk
.
	`»scheduË
();

782 ià(!
fd
->
	`ouut_is_push
(0))

783 
fd
->
_nÙif›r
.
	`£t_aùive
(
aùive
, 
Œue
);

786  
”rh
->
	`”rÜ
("type mismatch");

788 
H_STOP
:

789 
fd
->
_aùive
 = 
çl£
;

790 
fd
->
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

793  -
EINVAL
;

795 
	}
}

798 
	gFromIPSumm¬yDump
::
	$add_hªdËrs
()

800 
	`add_»ad_hªdËr
("§m¶šg_´ob", 
»ad_hªdËr
, 
H_SAMPLING_PROB
);

801 
	`add_»ad_hªdËr
("aùive", 
»ad_hªdËr
, 
H_ACTIVE
, 
HªdËr
::
f_checkbox
);

802 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 
H_ACTIVE
);

803 
	`add_»ad_hªdËr
("’ÿp", 
»ad_hªdËr
, 
H_ENCAP
);

804 
	`add_wr™e_hªdËr
("¡İ", 
wr™e_hªdËr
, 
H_STOP
, 
HªdËr
::
f_bu‰Ú
);

805 
_ff
.
	`add_hªdËrs
(
this
);

806 ià(
	`ouut_is_push
(0))

807 
	`add_sk_hªdËrs
(&
_sk
);

808 
	}
}

810 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
IPSumm¬yDumpInfo
)

811 
	$EXPORT_ELEMENT
(
FromIPSumm¬yDump
)

812 
CLICK_ENDDECLS


	@analysis/fromipsumdump.hh

2 #iâdeà
CLICK_FROMIPSUMDUMP_HH


3 
	#CLICK_FROMIPSUMDUMP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şick/tim”.hh
>

7 
	~<şick/nÙif›r.hh
>

8 
	~<şick/æowid.hh
>

9 
	~<şick/äomfe.hh
>

10 
	~"sumdumpšfo.hh
"

11 
CLICK_DECLS


158 
şass
 
	gFromIPSumm¬yDump
 : 
public
 
EËm’t
,…ubliø
	gIPSumm¬yDumpInfo
 { 
	gpublic
:

160 
FromIPSumm¬yDump
(è
CLICK_COLD
;

161 ~
FromIPSumm¬yDump
(è
	gCLICK_COLD
;

163 cÚ¡ *
şass_Çme
() const {  "FromIPSummaryDump"; }

164 cÚ¡ *
pÜt_couÁ
(ècÚ¡ {  
	gPORTS_0_1
; }

165 *
ÿ¡
(const *);

167 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

168 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

169 
ş—nup
(
CËªupSge
è
	gCLICK_COLD
;

170 
add_hªdËrs
(è
	gCLICK_COLD
;

172 
boŞ
 
run_sk
(
Task
 *);

173 
Pack‘
 *
puÎ
();

174 
run_tim”
(
Tim”
 *
tim”
);

176 
	g´iv©e
:

178 ’um { 
SAMPLING_SHIFT
 = 28 };

180 
FromFe
 
	g_ff
;

182 
	gVeùÜ
<cÚ¡ 
	gIPSumm¬yDump
::
F›ldR—d”
 *> 
_f›lds
;

183 
	gVeùÜ
<> 
	g_f›ld_Üd”
;

184 
ušt16_t
 
	g_deçuÉ_´Ùo
;

185 
ušt32_t
 
	g_§m¶šg_´ob
;

186 
IPFlowID
 
	g_æowid
;

187 
ušt32_t
 
	g_agg»g©e
;

189 
boŞ
 
	g_¡İ
 : 1;

190 
boŞ
 
	g_fÜm©_com¶ašt
 : 1;

191 
boŞ
 
	g_z”o
 : 1;

192 
boŞ
 
	g_checksum
 : 1;

193 
boŞ
 
	g_aùive
 : 1;

194 
boŞ
 
	g_muÉack‘
 : 1;

195 
boŞ
 
	g_have_æowid
 : 1;

196 
boŞ
 
	g_have_agg»g©e
 : 1;

197 
boŞ
 
	g_bš¬y
 : 1;

198 
boŞ
 
	g_timšg
 : 1;

199 
boŞ
 
	g_have_timšg
 : 1;

200 
boŞ
 
	g_®low_nÚexi¡’t
 : 1;

201 
Pack‘
 *
	g_wÜk_·ck‘
;

202 
ušt32_t
 
	g_muÉack‘_Ëngth
;

203 
Time¡amp
 
	g_muÉack‘_time¡amp_d–
;

204 
Time¡amp
 
	g_muÉack‘_’d_time¡amp
;

205 
Time¡amp
 
	g_timšg_off£t
;

207 
Task
 
	g_sk
;

208 
AùiveNÙif›r
 
	g_nÙif›r
;

209 
Tim”
 
	g_tim”
;

211 
	g_mšÜ_v”siÚ
;

212 
IPFlowID
 
	g_giv’_æowid
;

214 
»ad_bš¬y
(
SŒšg
 &, 
E¼ÜHªdËr
 *);

216 
sÜt_f›lds_com·»
(const *, const *, *);

217 
bªg_d©a
(cÚ¡ 
SŒšg
 &, 
E¼ÜHªdËr
 *);

218 
bªg_´Ùo
(cÚ¡ 
SŒšg
 &
lše
, cÚ¡ *
ty³
, 
E¼ÜHªdËr
 *
”rh
);

219 
bªg_æowid
(cÚ¡ 
SŒšg
 &, 
E¼ÜHªdËr
 *);

220 
bªg_agg»g©e
(cÚ¡ 
SŒšg
 &, 
E¼ÜHªdËr
 *);

221 
bªg_bš¬y
(cÚ¡ 
SŒšg
 &, 
E¼ÜHªdËr
 *);

222 
check_deçuÉs
();

223 
boŞ
 
check_timšg
(
Pack‘
 *
p
);

224 
Pack‘
 *
»ad_·ck‘
(
E¼ÜHªdËr
 *);

225 
Pack‘
 *
hªdË_muÉack‘
(Packet *);

227 
SŒšg
 
»ad_hªdËr
(
EËm’t
 *, *è
	gCLICK_COLD
;

228 
wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

232 
	gCLICK_ENDDECLS


	@analysis/fromnetflowsumdump.cc

19 
	~<şick/cÚfig.h
>

21 
	~"äomÃtæowsumdump.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/glue.hh
>

27 
	~<şick/·ck‘_ªno.hh
>

28 
	~<şickÃt/.h
>

29 
	~<şickÃt/udp.h
>

30 
	~<şickÃt/tı.h
>

31 
	~<şick/u£ruts.hh
>

32 
	~<uni¡d.h
>

33 
	~<sys/ty³s.h
>

34 
	~<sys/¡©.h
>

35 
	~<fú.h
>

36 
CLICK_DECLS


38 
	gFromN‘FlowSumm¬yDump
::
	$FromN‘FlowSumm¬yDump
()

39 : 
	`_·ck‘
(0), 
	`_wÜk_·ck‘
(0), 
	`_tim”
(
this
), 
	$_sk
(
this
)

41 
_ff
.
	`£t_Ïndm¬k_·‰”n
("%f:%l");

42 
	}
}

44 
	gFromN‘FlowSumm¬yDump
::~
	$FromN‘FlowSumm¬yDump
()

46 
	}
}

49 
FromN‘FlowSumm¬yDump
::
	$ÿ¡
(cÚ¡ *
n
)

51 ià(
	`¡rcmp
(
n
, 
NÙif›r
::
EMPTY_NOTIFIER
è=ğ0 && !
	`ouut_is_push
(0))

52  
¡©ic_ÿ¡
<
NÙif›r
 *>(&
_nÙif›r
);

54  
EËm’t
::
	`ÿ¡
(
n
);

55 
	}
}

58 
	gFromN‘FlowSumm¬yDump
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

60 
boŞ
 
	g¡İ
 = 
çl£
;

61 
	g_aùive
 = 
_z”o
 = 
Œue
;

62 
	g_muÉack‘
 = 
_timšg
 = 
çl£
;

63 
SŒšg
 
	glšk
 = "input";

65 ià(
Args
(
cÚf
, 
this
, 
”rh
)

66 .
»ad_mp
("FILENAME", 
F’ameArg
(), 
_ff
.
f’ame
())

67 .
»ad
("STOP", 
¡İ
)

68 .
»ad
("ACTIVE", 
_aùive
)

69 .
»ad
("ZERO", 
_z”o
)

70 .
»ad
("MULTIPACKET", 
_muÉack‘
)

71 .
»ad
("LINK", 
WÜdArg
(), 
lšk
)

72 .
»ad
("TIMING", 
_timšg
)

73 .
com¶‘e
() < 0)

76 
	g_¡İ
 = 
¡İ
;

77 
	glšk
 = 
lšk
.
low”
();

78 ià(
	glšk
 == "input")

79 
_lšk
 = 0;

80 ià(
	glšk
 == "output")

81 
_lšk
 = 1;

82 ià(
	glšk
 == "both")

83 
_lšk
 = 2;

85  
	g”rh
->
”rÜ
("'LINK' should be 'input', 'output', or 'both'");

90 
	gFromN‘FlowSumm¬yDump
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

92 ià(!
	`ouut_is_push
(0))

93 
_nÙif›r
.
	`š™Ÿlize
(
NÙif›r
::
EMPTY_NOTIFIER
, 
	`rou‹r
());

95 ià(
_ff
.
	`š™Ÿlize
(
”rh
) < 0)

98 
SŒšg
 
lše
;

99 ià(
_ff
.
	`³ek_lše
(
lše
, 
”rh
, 
Œue
) < 0)

102 
_fÜm©_com¶ašt
 = 
çl£
;

103 ià(
	`ouut_is_push
(0))

104 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_aùive
, 
”rh
);

105 
_tim”
.
	`š™Ÿlize
(
this
);

106 
_have_timšg
 = 
çl£
;

108 
	}
}

111 
	gFromN‘FlowSumm¬yDump
::
	$ş—nup
(
CËªupSge
)

113 
_ff
.
	`ş—nup
();

114 ià(
_·ck‘
)

115 
_·ck‘
->
	`kl
();

116 ià(
_wÜk_·ck‘
)

117 
_wÜk_·ck‘
->
	`kl
();

118 
_·ck‘
 = 
_wÜk_·ck‘
 = 0;

119 
	}
}

121 
Pack‘
 *

122 
	gFromN‘FlowSumm¬yDump
::
	$»ad_·ck‘
(
E¼ÜHªdËr
 *
”rh
)

124 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((cÚ¡ *)0, (
şick_
è+ (
şick_tı
));

125 ià(!
q
) {

126 
_ff
.
	`”rÜ
(
”rh
, 
	`¡»¼Ü
(
ENOMEM
));

129 ià(
_z”o
)

130 
	`mem£t
(
q
->
	`d©a
(), 0, q->
	`Ëngth
());

131 
q
->
	`£t__h—d”
((
şick_
 *)q->
	`d©a
(), (click_ip));

132 
şick_
 *
h
 = 
q
->
	`_h—d”
();

133 
h
->
_v
 = 4;

134 
h
->
_hl
 = (
şick_
) >> 2;

135 
h
->
_off
 = 0;

137 
SŒšg
 
lše
;

138 
SŒšg
 
wÜds
[15];

139 
ušt32_t
 
j
;

143 ià(
_ff
.
	`»ad_lše
(
lše
, 
”rh
, 
Œue
) <= 0) {

144 
q
->
	`kl
();

148 cÚ¡ *
d©a
 = 
lše
.
	`d©a
();

149 
Ën
 = 
lše
.
	`Ëngth
();

151 ià(
Ën
 =ğ0 || 
d©a
[0] == '!' || data[0] == '#')

154 
pos
 = 0, 
dpos
 = 0;

155 
dpos
 < 
Ën
 && 
pos
 < 15) {

156 
¡¬t
 = 
dpos
;

157 
dpos
 < 
Ën
 && 
d©a
[dpos] != '|')

158 
dpos
++;

159 
wÜds
[
pos
++] = 
lše
.
	`sub¡ršg
(
¡¬t
, 
dpos
 - start);

160 
dpos
++;

162 ià(
pos
 < 15)

179 
ok
 = 0;

182 ià(
	`IÁArg
().
	`·r£
(
wÜds
[7], 
j
))

183 
	`SET_FIRST_TIMESTAMP_ANNO
(
q
, 
	`Time¡amp
(
j
, 0)), 
ok
++;

184 ià(
	`IÁArg
().
	`·r£
(
wÜds
[8], 
j
)) {

185 ià(
j
)

186 
q
->
	`time¡amp_ªno
().
	`assign
(
j
, 0);

188 
q
->
	`time¡amp_ªno
(èğ
	`FIRST_TIMESTAMP_ANNO
(q);

189 
ok
++;

191 ià(
	`IÁArg
().
	`·r£
(
wÜds
[5], 
j
))

192 
	`SET_EXTRA_PACKETS_ANNO
(
q
, 
j
 - 1), 
ok
++;

193 
ušt32_t
 
by‹_couÁ
 = 0;

194 ià(
	`IÁArg
().
	`·r£
(
wÜds
[6], 
by‹_couÁ
))

195 
ok
++;

196 
ušt32_t
 
šput
 = 0, 
ouut
 = 0;

197 ià((
_lšk
 =ğ1 || 
	`IÁArg
().
	`·r£
(
wÜds
[3], 
šput
))

198 && (
_lšk
 =ğ0 || 
	`IÁArg
().
	`·r£
(
wÜds
[4], 
ouut
))) {

199 
ok
++;

200 
ušt32_t
 
m
 = (
_lšk
 == 2 ? 15 : 255);

201 
šput
 = (špuˆ< 
m
 ? iÅuˆ: mè<< (
_lšk
 == 2 ? 4 : 0);

202 
ouut
 = (ouuˆ< 
m
 ? output : m);

203 
	`SET_PAINT_ANNO
(
q
, 
šput
 | 
ouut
);

207 
ok
 +ğ
	`IPAdd»ssArg
().
	`·r£
(
wÜds
[0], 
h
->
_¤c
);

208 
ok
 +ğ
	`IPAdd»ssArg
().
	`·r£
(
wÜds
[1], 
h
->
_d¡
);

209 ià(
	`IÁArg
().
	`·r£
(
wÜds
[13], 
j
) && j <= 0xFF)

210 
h
->
_p
 = 
j
, 
ok
++;

211 ià(
	`IÁArg
().
	`·r£
(
wÜds
[14], 
j
) && j <= 0xFF)

212 
h
->
_tos
 = 
j
, 
ok
++;

215 ià(
	`IÁArg
().
	`·r£
(
wÜds
[9], 
j
) && j <= 0xFFFF)

216 
q
->
	`udp_h—d”
()->
uh_¥Üt
 = 
	`htÚs
(
j
), 
ok
++;

217 ià(
	`IÁArg
().
	`·r£
(
wÜds
[10], 
j
) && j <= 0xFFFF)

218 
q
->
	`udp_h—d”
()->
uh_dpÜt
 = 
	`htÚs
(
j
), 
ok
++;

219 ià(
	`IÁArg
().
	`·r£
(
wÜds
[12], 
j
) && j <= 0xFF)

220 
q
->
	`tı_h—d”
()->
th_æags
 = 
j
, 
ok
++;

222 ià(
ok
 < 10)

226 
_Ën
 = (
by‹_couÁ
 <= 65535 ? byte_count : 65535);

227 
h
->
_Ën
 = 
	`htÚs
(ip_len);

228 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
) {

229 
q
->
	`tı_h—d”
()->
th_off
 = (
şick_tı
) >> 2;

230 
q
->
	`tı_h—d”
()->
th_æags2
 = 0;

231 } ià(
h
->
_p
 =ğ
IP_PROTO_UDP
) {

232 
q
->
	`udp_h—d”
()->
uh_uËn
 = 
	`htÚs
(
_Ën
 - (
şick_
));

233 
q
->
	`ke
((
şick_tı
è- (
şick_udp
));

235 
q
->
	`ke
((
şick_tı
));

236 
	`SET_EXTRA_LENGTH_ANNO
(
q
, 
by‹_couÁ
 - q->
	`Ëngth
());

237  
q
;

241 ià(!
_fÜm©_com¶ašt
) {

242 
_ff
.
	`”rÜ
(
”rh
, "bad format");

243 
_fÜm©_com¶ašt
 = 
Œue
;

245 ià(
q
)

246 
q
->
	`kl
();

248 
	}
}

250 
šlše
 
Pack‘
 *

251 
	$£t_·ck‘_Ëngths
(
Pack‘
 *
p
, 
ušt32_t
 
exŒa_Ëngth
)

253 
ušt32_t
 
Ëngth
 = 
p
->
	`Ëngth
(è+ 
exŒa_Ëngth
;

254 ià(
	`htÚs
(
Ëngth
è!ğ
p
->
	`_h—d”
()->
_Ën
) {

255 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
()) {

256 
şick_
 *

 = 
q
->
	`_h—d”
();

257 

->
_Ën
 = 
	`htÚs
(
Ëngth
);

258 ià(

->
_p
 =ğ
IP_PROTO_UDP
)

259 
q
->
	`udp_h—d”
()->
uh_uËn
 = 
	`htÚs
(
Ëngth
 - (

->
_hl
 << 2));

260  
q
;

264  
p
;

265 
	}
}

267 
Pack‘
 *

268 
	gFromN‘FlowSumm¬yDump
::
	$hªdË_muÉack‘
(
Pack‘
 *
p
)

270 
	`as£¹
(!
_wÜk_·ck‘
 || _wÜk_·ck‘ =ğ
p
);

272 ià(!
p
 || !
	`EXTRA_PACKETS_ANNO
(p)) {

273 
_wÜk_·ck‘
 = 0;

274  
p
;

277 
ušt32_t
 
couÁ
 = 1 + 
	`EXTRA_PACKETS_ANNO
(
p
);

280 ià(!
_wÜk_·ck‘
) {

281 
	`as£¹
(
couÁ
 > 1);

283 
_muÉack‘_Ëngth
 = (
p
->
	`Ëngth
(è+ 
	`EXTRA_LENGTH_ANNO
Õ)è/ 
couÁ
;

285 ià(
_muÉack‘_Ëngth
 < 
p
->
	`Ëngth
()) {

286 
_muÉack‘_Ëngth
 = 
p
->
	`Ëngth
();

287 
	`SET_EXTRA_LENGTH_ANNO
(
p
, 
_muÉack‘_Ëngth
 * (
couÁ
 - 1));

290 
_muÉack‘_’d_time¡amp
 = 
p
->
	`time¡amp_ªno
();

291 ià(
	`FIRST_TIMESTAMP_ANNO
(
p
)) {

292 
_muÉack‘_time¡amp_d–
 = (
p
->
	`time¡amp_ªno
(è- 
	`FIRST_TIMESTAMP_ANNO
Õ)è/ (
couÁ
 - 1);

293 
p
->
	`time¡amp_ªno
(èğ
	`FIRST_TIMESTAMP_ANNO
(p);

295 
_muÉack‘_time¡amp_d–
 = 
	`Time¡amp
();

297 
_wÜk_·ck‘
 = 
	`£t_·ck‘_Ëngths
(
p
, 
_muÉack‘_Ëngth
 -…->
	`Ëngth
());

298 ià(!
_wÜk_·ck‘
)

303 ià((
p
 =…->
	`şÚe
())) {

304 
	`SET_EXTRA_PACKETS_ANNO
(
p
, 0);

305 
	`SET_EXTRA_LENGTH_ANNO
(
p
, 
_muÉack‘_Ëngth
 -…->
	`Ëngth
());

309 
	`SET_EXTRA_PACKETS_ANNO
(
_wÜk_·ck‘
, 
couÁ
 - 2);

310 
	`SET_EXTRA_LENGTH_ANNO
(
_wÜk_·ck‘
, 
	`EXTRA_LENGTH_ANNO
(_wÜk_·ck‘è- 
_muÉack‘_Ëngth
);

311 ià(
couÁ
 == 2) {

312 
_wÜk_·ck‘
->
	`time¡amp_ªno
(èğ
_muÉack‘_’d_time¡amp
;

313 
_wÜk_·ck‘
 = 
	`£t_·ck‘_Ëngths
(_wÜk_·ck‘, 
	`EXTRA_LENGTH_ANNO
(_work_packet));

315 
_wÜk_·ck‘
->
	`time¡amp_ªno
(è+ğ
_muÉack‘_time¡amp_d–
;

317  
p
;

318 
	}
}

320 
Pack‘
 *

321 
	gFromN‘FlowSumm¬yDump
::
	$Ãxt_·ck‘
()

323 ià(!
_·ck‘
) {

324 
»Œy
:

325 
_·ck‘
 = (
_wÜk_·ck‘
 ? _wÜk_·ck‘ : 
	`»ad_·ck‘
(0));

326 ià(
_·ck‘
 && 
_muÉack‘
) {

327 ià(!(
_·ck‘
 = 
	`hªdË_muÉack‘
(_packet)))

328 
»Œy
;

331  
_·ck‘
;

332 
	}
}

335 
	gFromN‘FlowSumm¬yDump
::
	$run_tim”
(
Tim”
 *)

337 ià(
_aùive
) {

338 ià(
	`ouut_is_push
(0))

339 
_sk
.
	`»scheduË
();

341 
_nÙif›r
.
	`wake
();

343 
	}
}

345 
boŞ


346 
	gFromN‘FlowSumm¬yDump
::
	$check_timšg
(
Pack‘
 *
p
)

348 
Time¡amp
 
now_s
 = Time¡amp::
	`now_¡—dy
();

349 ià(!
_have_timšg
) {

350 
_timšg_off£t
 = 
now_s
 - 
p
->
	`time¡amp_ªno
();

351 
_have_timšg
 = 
Œue
;

353 
Time¡amp
 
t
 = 
p
->
	`time¡amp_ªno
(è+ 
_timšg_off£t
;

354 ià(
now_s
 < 
t
) {

355 
t
 -ğ
Tim”
::
	`adju¡m’t
();

356 ià(
now_s
 < 
t
) {

357 
_tim”
.
	`scheduË_©_¡—dy
(
t
);

358 ià(
	`ouut_is_puÎ
(0))

359 
_nÙif›r
.
	`¦“p
();

361 ià(
	`ouut_is_push
(0))

362 
_sk
.
	`ç¡_»scheduË
();

364  
çl£
;

366  
Œue
;

367 
	}
}

369 
boŞ


370 
	gFromN‘FlowSumm¬yDump
::
	$run_sk
(
Task
 *)

372 ià(!
_aùive
)

373  
çl£
;

375 
Pack‘
 *
p
 = 
	`Ãxt_·ck‘
();

376 ià(!
p
) {

377 ià(
_¡İ
)

378 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

379  
çl£
;

380 } ià(
_timšg
 && !
	`check_timšg
(
p
))

381  
çl£
;

382 
_·ck‘
 = 0;

383 
	`ouut
(0).
	`push
(
p
);

384 
_sk
.
	`ç¡_»scheduË
();

385  
Œue
;

386 
	}
}

388 
Pack‘
 *

389 
	gFromN‘FlowSumm¬yDump
::
	$puÎ
()

391 ià(!
_aùive
) {

392 
_nÙif›r
.
	`¦“p
();

396 
Pack‘
 *
p
 = 
	`Ãxt_·ck‘
();

397 ià(!
p
 && 
_¡İ
)

398 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

399 ià(
p
 && 
_timšg
 && !
	`check_timšg
(p))

401 
_nÙif›r
.
	`£t_aùive
(
p
 !ğ0, 
Œue
);

402 
_·ck‘
 = 0;

403  
p
;

404 
	}
}

407 ’um { 
	mH_ACTIVE
, 
	mH_ENCAP
 };

409 
SŒšg


410 
	gFromN‘FlowSumm¬yDump
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

412 
FromN‘FlowSumm¬yDump
 *
fd
 = 
¡©ic_ÿ¡
<FromN‘FlowSumm¬yDum°*>(
e
);

413 (
šŒ_t
)
thunk
) {

414 
H_ACTIVE
:

415  
BoŞArg
::
	`uÅ¬£
(
fd
->
_aùive
);

416 
H_ENCAP
:

421 
	}
}

424 
	gFromN‘FlowSumm¬yDump
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s_š
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

426 
FromN‘FlowSumm¬yDump
 *
fd
 = 
¡©ic_ÿ¡
<FromN‘FlowSumm¬yDum°*>(
e
);

427 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
s_š
);

428 (
šŒ_t
)
thunk
) {

429 
H_ACTIVE
: {

430 
boŞ
 
aùive
;

431 ià(
	`BoŞArg
().
	`·r£
(
s
, 
aùive
)) {

432 
fd
->
_aùive
 = 
aùive
;

433 ià(
fd
->
	`ouut_is_push
(0)) {

434 ià(
aùive
 && !
fd
->
_sk
.
	`scheduËd
())

435 
fd
->
_sk
.
	`»scheduË
();

437 
fd
->
_nÙif›r
.
	`£t_aùive
(
aùive
, 
Œue
);

440  
”rh
->
	`”rÜ
("type mismatch");

443  -
EINVAL
;

445 
	}
}

448 
	gFromN‘FlowSumm¬yDump
::
	$add_hªdËrs
()

450 
	`add_»ad_hªdËr
("aùive", 
»ad_hªdËr
, 
H_ACTIVE
, 
HªdËr
::
f_checkbox
);

451 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 
H_ACTIVE
);

452 
	`add_»ad_hªdËr
("’ÿp", 
»ad_hªdËr
, 
H_ENCAP
);

453 
_ff
.
	`add_hªdËrs
(
this
);

454 ià(
	`ouut_is_push
(0))

455 
	`add_sk_hªdËrs
(&
_sk
);

456 
	}
}

458 
CLICK_ENDDECLS


459 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

460 
	`EXPORT_ELEMENT
(
FromN‘FlowSumm¬yDump
)

	@analysis/fromnetflowsumdump.hh

2 #iâdeà
CLICK_FROMNETFLOWSUMDUMP_HH


3 
	#CLICK_FROMNETFLOWSUMDUMP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şick/tim”.hh
>

7 
	~<şick/nÙif›r.hh
>

8 
	~<şick/äomfe.hh
>

9 
CLICK_DECLS


131 şas 
	cFromN‘FlowSumm¬yDump
 : 
public
 
EËm’t
 {…ublic:

133 
	$FromN‘FlowSumm¬yDump
(è
CLICK_COLD
;

134 ~
	$FromN‘FlowSumm¬yDump
(è
CLICK_COLD
;

136 cÚ¡ *
	$şass_Çme
() const {  "FromNetFlowSummaryDump"; }

137 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

138 *
ÿ¡
(const *);

140 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

141 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

142 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

143 
	$add_hªdËrs
(è
CLICK_COLD
;

145 
	`run_tim”
(
Tim”
 *);

146 
boŞ
 
	`run_sk
(
Task
 *);

147 
Pack‘
 *
	`puÎ
();

149 
´iv©e
:

151 
FromFe
 
_ff
;

153 
VeùÜ
<> 
_cÚ‹Ás
;

155 
boŞ
 
_¡İ
 : 1;

156 
boŞ
 
_fÜm©_com¶ašt
 : 1;

157 
boŞ
 
_timšg
;

158 
boŞ
 
_have_timšg
;

159 
boŞ
 
_z”o
;

160 
boŞ
 
_aùive
;

161 
boŞ
 
_muÉack‘
;

162 
ušt8_t
 
_lšk
;

163 
Pack‘
 *
_·ck‘
;

164 
Pack‘
 *
_wÜk_·ck‘
;

165 
ušt32_t
 
_muÉack‘_Ëngth
;

166 
Time¡amp
 
_muÉack‘_time¡amp_d–
;

167 
Time¡amp
 
_muÉack‘_’d_time¡amp
;

169 
Tim”
 
_tim”
;

170 
Task
 
_sk
;

171 
AùiveNÙif›r
 
_nÙif›r
;

173 
Time¡amp
 
_timšg_off£t
;

175 
Pack‘
 *
	`»ad_·ck‘
(
E¼ÜHªdËr
 *);

176 
Pack‘
 *
	`hªdË_muÉack‘
(Packet *);

177 
Pack‘
 *
	`Ãxt_·ck‘
();

178 
boŞ
 
	`check_timšg
(
Pack‘
 *
p
);

180 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

181 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

183 
	}
};

185 
	gCLICK_ENDDECLS


	@analysis/fromnlanrdump.cc

19 
	~<şick/cÚfig.h
>

20 
	~"äomÆªrdump.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/glue.hh
>

27 
	~<şick/hªdËrÿÎ.hh
>

28 
	~<şickÃt/rfc1483.h
>

29 
	~<şick/u£ruts.hh
>

30 
	~"–em’ts/u£¾ev–/çk•ÿp.hh
"

31 
	~<uni¡d.h
>

32 
	~<sys/ty³s.h
>

33 
	~<sys/¡©.h
>

34 
	~<fú.h
>

35 #ifdeà
ALLOW_MMAP


36 
	~<sys/mmª.h
>

38 
	gCLICK_DECLS


40 
	#SWAPLONG
(
y
) \

41 ((((
y
)&0xff)<<24è| (((y)&0xff00)<<8è| (((y)&0xff0000)>>8è| (((y)>>24)&0xff))

	)

42 
	#SWAPSHORT
(
y
) \

43 Ğ(((
y
)&0xff)<<8è| ((
u_shÜt
)((y)&0xff00)>>8è)

	)

45 
	gFromNLANRDump
::
	$FromNLANRDump
()

46 : 
	`_·ck‘
(0), 
	`_’d_h
(0), 
	$_sk
(
this
)

48 
	}
}

50 
	gFromNLANRDump
::~
	$FromNLANRDump
()

52 
d–‘e
 
_’d_h
;

53 
	}
}

56 
	gFromNLANRDump
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

58 
boŞ
 
	gtimšg
 = 
çl£
, 
	g¡İ
 = f®£, 
	gaùive
 = 
Œue
;

59 
SŒšg
 
	gfÜm©
 = "guess";

60 
Time¡amp
 
	gfœ¡_time
, 
	gfœ¡_time_off
, 
	gÏ¡_time
, 
	gÏ¡_time_off
, 
	gš‹rv®
;

61 
HªdËrC®l
 
	g’d_h
;

62 
	g_§m¶šg_´ob
 = (1 << 
SAMPLING_SHIFT
);

63 
	g_·ck‘_f•os
 = 0;

64 
boŞ
 
	gfÜû_
 = 
Œue
;

66 ià(
	g_ff
.
cÚfigu»_keywÜds
(
cÚf
, 
this
, 
”rh
) < 0)

68 ià(
Args
(
cÚf
, 
this
, 
”rh
)

69 .
»ad_mp
("FILENAME", 
F’ameArg
(), 
_ff
.
f’ame
())

70 .
»ad
("FORMAT", 
WÜdArg
(), 
fÜm©
)

71 .
»ad
("STOP", 
¡İ
)

72 .
»ad
("ACTIVE", 
aùive
)

73 .
»ad
("FORCE_IP", 
fÜû_
)

74 .
»ad
("START", 
fœ¡_time
)

75 .
»ad
("START_AFTER", 
fœ¡_time_off
)

76 .
»ad
("END", 
Ï¡_time
)

77 .
»ad
("END_AFTER", 
Ï¡_time_off
)

78 .
»ad
("INTERVAL", 
š‹rv®
)

79 .
»ad
("END_CALL", 
HªdËrC®lArg
(
HªdËrC®l
::
wr™abË
), 
’d_h
)

80 .
»ad
("FILEPOS", 
_·ck‘_f•os
)

81 .
»ad
("SAMPLE", 
FixedPoštArg
(
SAMPLING_SHIFT
), 
_§m¶šg_´ob
)

82 .
»ad
("TIMING", 
timšg
)

83 .
com¶‘e
() < 0)

87 ià(
	g_§m¶šg_´ob
 > (1 << 
	gSAMPLING_SHIFT
)) {

88 
	g”rh
->
w¬nšg
("SAMPLE…robability„educedo 1");

89 
	g_§m¶šg_´ob
 = (1 << 
SAMPLING_SHIFT
);

90 } ià(
	g_§m¶šg_´ob
 == 0)

91 
”rh
->
w¬nšg
("SAMPLE…robability is 0;ƒmitting‚o…ackets");

94 
	g_have_fœ¡_time
 = 
_have_Ï¡_time
 = 
Œue
;

95 
	g_fœ¡_time_»Ïtive
 = 
_Ï¡_time_»Ïtive
 = 
_Ï¡_time_š‹rv®
 = 
çl£
;

97 ià((
	gboŞ
è
	gfœ¡_time
 + (boŞè
	gfœ¡_time_off
 > 1)

98  
	g”rh
->
”rÜ
("START‡nd START_AFTER‡re mutuallyƒxclusive");

99 ià(
	gfœ¡_time
)

100 
	g_fœ¡_time
 = 
fœ¡_time
;

101 ià(
	gfœ¡_time_off
)

102 
	g_fœ¡_time
 = 
fœ¡_time_off
, 
	g_fœ¡_time_»Ïtive
 = 
Œue
;

104 
	g_have_fœ¡_time
 = 
çl£
, 
	g_fœ¡_time_»Ïtive
 = 
Œue
;

106 ià((
	gboŞ
è
	gÏ¡_time
 + (boŞè
	gÏ¡_time_off
 + (boŞè
	gš‹rv®
 > 1)

107  
	g”rh
->
”rÜ
("END, END_AFTER,‡nd INTERVAL‡re mutuallyƒxclusive");

108 ià(
	gÏ¡_time
)

109 
	g_Ï¡_time
 = 
Ï¡_time
;

110 ià(
	gÏ¡_time_off
)

111 
	g_Ï¡_time
 = 
Ï¡_time_off
, 
	g_Ï¡_time_»Ïtive
 = 
Œue
;

112 ià(
	gš‹rv®
)

113 
	g_Ï¡_time
 = 
š‹rv®
, 
	g_Ï¡_time_š‹rv®
 = 
Œue
;

115 
	g_have_Ï¡_time
 = 
çl£
;

117 ià(
	g¡İ
 && 
	g’d_h
)

118  
	g”rh
->
”rÜ
("END_CALL‡nd STOP‡re mutuallyƒxclusive");

119 ià(
	g’d_h
)

120 
	g_’d_h
 = 
Ãw
 
HªdËrC®l
(
’d_h
);

121 ià(
	g¡İ
)

122 
	g_’d_h
 = 
Ãw
 
HªdËrC®l
(
Çme
() + ".stop");

123 ià(
	g_have_Ï¡_time
)

124 
	g_’d_h
 = 
Ãw
 
HªdËrC®l
(
Çme
() + ".active false");

127 
	gfÜm©
 = 
fÜm©
.
low”
();

128 ià(
	gfÜm©
 == "fr")

129 
_fÜm©
 = 
C_FR
;

130 ià(
	gfÜm©
 == "fr+")

131 
_fÜm©
 = 
C_FRPLUS
;

132 ià(
	gfÜm©
 == "tsh")

133 
_fÜm©
 = 
C_TSH
;

134 ià(
	gfÜm©
 == "guess") {

135 
fÜm©
 = 
_ff
.
f’ame
().
low”
();

136 ià(
	gfÜm©
.
sub¡ršg
(-3).
low”
() == ".gz")

137 
fÜm©
 = fÜm©.
sub¡ršg
(0, fÜm©.
Ëngth
() - 3);

138 ià(
	gfÜm©
.
sub¡ršg
(-2).
low”
() == ".z")

139 
fÜm©
 = fÜm©.
sub¡ršg
(0, fÜm©.
Ëngth
() - 2);

140 ià(
	gfÜm©
.
sub¡ršg
(-4).
low”
() == ".bz2")

141 
fÜm©
 = fÜm©.
sub¡ršg
(0, fÜm©.
Ëngth
() - 4);

142 ià(
	gfÜm©
.
sub¡ršg
(-3).
low”
() == ".fr")

143 
_fÜm©
 = 
C_FR
;

144 ià(
	gfÜm©
.
sub¡ršg
(-3).
low”
() == ".fr+")

145 
_fÜm©
 = 
C_FRPLUS
;

146 ià(
	gfÜm©
.
sub¡ršg
(-4).
low”
() == ".tsh")

147 
_fÜm©
 = 
C_TSH
;

149 
	g”rh
->
w¬nšg
("cannot guess file format from filename,‡ssuming 'tsh'");

150 
	g_fÜm©
 = 
C_TSH
;

153  
	g”rh
->
”rÜ
("bad FORMAT");

154 
	g_fÜm©
) {

155 
	gC_FR
: 
_ûÎ_size
 = 
FRC–l
::
SIZE
; ;

156 
	gC_FRPLUS
: 
_ûÎ_size
 = 
FRPlusC–l
::
SIZE
; ;

157 
	gC_TSH
: 
_ûÎ_size
 = 
TSHC–l
::
SIZE
; ;

161 
	g_have_ªy_times
 = 
çl£
;

162 
	g_timšg
 = 
timšg
;

163 
	g_aùive
 = 
aùive
;

168 
	gFromNLANRDump
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

171 ià(
_’d_h
 && _’d_h->
	`š™Ÿlize_wr™e
(
this
, 
”rh
) < 0)

173 ià(
	`ouut_is_push
(0))

174 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_aùive
, 
”rh
);

177 ià(
_ff
.
	`š™Ÿlize
(
”rh
) < 0)

181 ià(
	`»ad_·ck‘
(
”rh
))

182 
_time_off£t
 = 
Time¡amp
::
	`now
(è- 
_·ck‘
->
	`time¡amp_ªno
();

185 ià(
_·ck‘_f•os
 != 0) {

186 
»suÉ
 = 
_ff
.
	`£ek
(
_·ck‘_f•os
, 
”rh
);

187 
_·ck‘_f•os
 = 0;

188  
»suÉ
;

191 
	}
}

194 
	gFromNLANRDump
::
	$ş—nup
(
CËªupSge
)

196 
_ff
.
	`ş—nup
();

197 ià(
_·ck‘
)

198 
_·ck‘
->
	`kl
();

199 
_·ck‘
 = 0;

200 
	}
}

203 
	gFromNLANRDump
::
	$£t_aùive
(
boŞ
 
aùive
)

205 ià(
_aùive
 !ğ
aùive
) {

206 
_aùive
 = 
aùive
;

207 ià(
aùive
 && 
	`ouut_is_push
(0è&& !
_sk
.
	`scheduËd
())

208 
_sk
.
	`»scheduË
();

210 
	}
}

213 
	gFromNLANRDump
::
	$´•¬e_times
(cÚ¡ 
Time¡amp
 &
tv
)

215 ià(
_fœ¡_time_»Ïtive
)

216 
_fœ¡_time
 +ğ
tv
;

217 ià(
_Ï¡_time_»Ïtive
)

218 
_Ï¡_time
 +ğ
tv
;

219 ià(
_Ï¡_time_š‹rv®
)

220 
_Ï¡_time
 +ğ
_fœ¡_time
;

221 
_have_ªy_times
 = 
Œue
;

222 
	}
}

224 
boŞ


225 
	gFromNLANRDump
::
	$»ad_·ck‘
(
E¼ÜHªdËr
 *
”rh
)

227 cÚ¡ 
TSHC–l
 *
ûÎ
;

228 
TSHC–l
 
¡©ic_ûÎ
;

229 
Time¡amp
 
tv
;

230 
Pack‘
 *
p
;

231 
boŞ
 
mÜe
 = 
Œue
;

232 
_·ck‘
 = 0;

234 
»Œy
:

236 ià(!
mÜe
)

237  
çl£
;

240 
_·ck‘_f•os
 = 
_ff
.
	`fe_pos
();

243 
ûÎ
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
TSHC–l
 *>(
_ff
.
	`g‘_®igÃd
(
_ûÎ_size
, &
¡©ic_ûÎ
, 
”rh
));

244 ià(!
ûÎ
)

245  
çl£
;

248 
check_times
:

249 
ušt32_t
 
u£c
 = 
	`Áohl
(
ûÎ
->
time¡amp_u£c
);

250 ià(
_fÜm©
 =ğ
C_TSH
)

251 
tv
 = 
Time¡amp
::
	`make_u£c
(
	`Áohl
(
ûÎ
->
time¡amp_£c
), 
u£c
 & 0xFFFFFF);

252 ià(
_fÜm©
 =ğ
C_FRPLUS
 || _fÜm© =ğ
C_FR
)

253 
tv
 = 
Time¡amp
::
	`make_u£c
(
	`Áohl
(
ûÎ
->
time¡amp_£c
), 
u£c
);

254 ià(!
_have_ªy_times
)

255 
	`´•¬e_times
(
tv
);

256 ià(
_have_fœ¡_time
) {

257 ià(
tv
 < 
_fœ¡_time
)

258 
»Œy
;

260 
_have_fœ¡_time
 = 
çl£
;

262 ià(
_have_Ï¡_time
 && 
tv
 >ğ
_Ï¡_time
) {

263 
_have_Ï¡_time
 = 
çl£
;

264 (è
_’d_h
->
	`ÿÎ_wr™e
(
”rh
);

265 ià(!
_aùive
)

266 
mÜe
 = 
çl£
;

268 
check_times
;

272 ià(
_§m¶šg_´ob
 < (1 << 
SAMPLING_SHIFT
)

273 && (
	`şick_¿ndom
(è& ((1<<
SAMPLING_SHIFT
)-1)è>ğ
_§m¶šg_´ob
)

274 
»Œy
;

277 ià(
_fÜm©
 !ğ
C_FR
)

278 
p
 = 
_ff
.
	`g‘_·ck‘_äom_d©a
(&
ûÎ
->
h
, 
_ûÎ_size
 - 8, _ûÎ_siz- 8, 
tv
.
	`£c
(),v.
	`sub£c
(), 
”rh
);

280 
p
 = 0;

281 ià(!
p
)

282  
çl£
;

284 
	`çke_pÿp_fÜû_
(
p
, 
FAKE_DLT_RAW
);

285 ià(
p
->
	`ÃtwÜk_h—d”_Ëngth
(è!ğ(
şick_
)) {

286 
	`checked_ouut_push
(1, 
p
);

287 
»Œy
;

290 ià(
_fÜm©
 =ğ
C_TSH
)

291 
	`SET_PAINT_ANNO
(
p
, 
u£c
 >> 24);

292 
_·ck‘
 = 
p
;

293  
mÜe
;

294 
	}
}

296 
boŞ


297 
	gFromNLANRDump
::
	$run_sk
(
Task
 *)

299 ià(!
_aùive
)

300  
çl£
;

302 
boŞ
 
mÜe
;

303 ià(
_·ck‘
 || 
	`»ad_·ck‘
(0)) {

304 ià(
_timšg


305 && 
_·ck‘
->
	`time¡amp_ªno
(è> 
Time¡amp
::
	`now
(è- 
_time_off£t
) {

306 
_sk
.
	`ç¡_»scheduË
();

307  
çl£
;

309 
	`ouut
(0).
	`push
(
_·ck‘
);

310 
mÜe
 = 
	`»ad_·ck‘
(0);

312 
mÜe
 = 
çl£
;

314 ià(
mÜe
)

315 
_sk
.
	`ç¡_»scheduË
();

316 ià(
_’d_h
)

317 
_’d_h
->
	`ÿÎ_wr™e
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

318  
Œue
;

319 
	}
}

321 
Pack‘
 *

322 
	gFromNLANRDump
::
	$puÎ
()

324 ià(!
_aùive
)

327 
boŞ
 
mÜe
;

328 
Pack‘
 *
p
;

329 ià(
_·ck‘
 || 
	`»ad_·ck‘
(0)) {

330 ià(
_timšg


331 && 
_·ck‘
->
	`time¡amp_ªno
(è> 
Time¡amp
::
	`now
(è- 
_time_off£t
)

333 
p
 = 
_·ck‘
;

334 
mÜe
 = 
	`»ad_·ck‘
(0);

336 
p
 = 0;

337 
mÜe
 = 
çl£
;

340 ià(!
mÜe
 && 
_’d_h
)

341 
_’d_h
->
	`ÿÎ_wr™e
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

342  
p
;

343 
	}
}

346 
	mH_SAMPLING_PROB
, 
	mH_ACTIVE
, 
	mH_ENCAP
, 
	mH_STOP
, 
	mH_PACKET_FILEPOS
,

347 
	mH_EXTEND_INTERVAL


350 
SŒšg


351 
	gFromNLANRDump
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

353 
FromNLANRDump
 *
fd
 = 
¡©ic_ÿ¡
<FromNLANRDum°*>(
e
);

354 (
šŒ_t
)
thunk
) {

355 
H_SAMPLING_PROB
:

356  
	`ı_uÅ¬£_»®2
(
fd
->
_§m¶šg_´ob
, 
SAMPLING_SHIFT
);

357 
H_ACTIVE
:

358  
BoŞArg
::
	`uÅ¬£
(
fd
->
_aùive
);

359 
H_ENCAP
:

361 
H_PACKET_FILEPOS
:

362  
	`SŒšg
(
fd
->
_·ck‘_f•os
);

366 
	}
}

369 
	gFromNLANRDump
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s_š
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

371 
FromNLANRDump
 *
fd
 = 
¡©ic_ÿ¡
<FromNLANRDum°*>(
e
);

372 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
s_š
);

373 (
šŒ_t
)
thunk
) {

374 
H_ACTIVE
: {

375 
boŞ
 
aùive
;

376 ià(
	`BoŞArg
().
	`·r£
(
s
, 
aùive
)) {

377 
fd
->
	`£t_aùive
(
aùive
);

380  
”rh
->
	`”rÜ
("type mismatch");

382 
H_STOP
:

383 
fd
->
	`£t_aùive
(
çl£
);

384 
fd
->
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

386 
H_EXTEND_INTERVAL
: {

387 
Time¡amp
 
tv
;

388 ià(
	`ı_time
(
s
, &
tv
)) {

389 
fd
->
_Ï¡_time
 +ğ
tv
;

390 ià(
fd
->
_’d_h
)

391 
fd
->
_have_Ï¡_time
 = 
Œue
, fd->
	`£t_aùive
(true);

394  
”rh
->
	`”rÜ
("'extend_interval'akes‡ime interval");

397  -
EINVAL
;

399 
	}
}

402 
	gFromNLANRDump
::
	$add_hªdËrs
()

404 
	`add_»ad_hªdËr
("§m¶šg_´ob", 
»ad_hªdËr
, 
H_SAMPLING_PROB
);

405 
	`add_»ad_hªdËr
("aùive", 
»ad_hªdËr
, 
H_ACTIVE
, 
HªdËr
::
f_checkbox
);

406 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 
H_ACTIVE
);

407 
	`add_»ad_hªdËr
("’ÿp", 
»ad_hªdËr
, 
H_ENCAP
);

408 
	`add_wr™e_hªdËr
("¡İ", 
wr™e_hªdËr
, 
H_STOP
, 
HªdËr
::
f_bu‰Ú
);

409 
	`add_»ad_hªdËr
("·ck‘_f•os", 
»ad_hªdËr
, 
H_PACKET_FILEPOS
);

410 
	`add_wr™e_hªdËr
("ex‹nd_š‹rv®", 
wr™e_hªdËr
, 
H_EXTEND_INTERVAL
);

411 
_ff
.
	`add_hªdËrs
(
this
);

412 ià(
	`ouut_is_push
(0))

413 
	`add_sk_hªdËrs
(&
_sk
);

414 
	}
}

416 
CLICK_ENDDECLS


417 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
št64
 
FakePÿp
)

418 
	`EXPORT_ELEMENT
(
FromNLANRDump
)

	@analysis/fromnlanrdump.hh

2 #iâdeà
CLICK_FROMNLANRDUMP_HH


3 
	#CLICK_FROMNLANRDUMP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şickÃt/tı.h
>

7 
	~<şick/äomfe.hh
>

8 
CLICK_DECLS


9 
şass
 
	gHªdËrC®l
;

166 şas 
	cFromNLANRDump
 : 
public
 
EËm’t
 {…ublic:

168 
	$FromNLANRDump
(è
CLICK_COLD
;

169 ~
	$FromNLANRDump
(è
CLICK_COLD
;

171 cÚ¡ *
	$şass_Çme
() const {  "FromNLANRDump"; }

172 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "0/1-2"; 
	}
}

173 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

175 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

176 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

177 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

178 
	$add_hªdËrs
(è
CLICK_COLD
;

180 
boŞ
 
	`run_sk
(
Task
 *);

181 
Pack‘
 *
	`puÎ
();

183 
	`£t_aùive
(
boŞ
);

185 
´iv©e
:

187 ’um { 
C_FR
, 
C_FRPLUS
, 
C_TSH
 
	}
};

189 
	sFRC–l
 {

190 
ušt32_t
 
	gtime¡amp_£c
;

191 
ušt32_t
 
	gtime¡amp_u£c
;

192 
ušt32_t
 
	g_¤c
;

193 
ušt32_t
 
	g_d¡
;

194 
ušt16_t
 
	g_Ën
;

195 
ušt8_t
 
	g_p
;

196 
ušt8_t
 
	gth_æags
;

197 
ušt16_t
 
	g¥Üt
;

198 
ušt16_t
 
	gdpÜt
;

199 ’um { 
	gSIZE
 = 24 };

202 
	sFRPlusC–l
 {

203 
ušt32_t
 
	gtime¡amp_£c
;

204 
ušt32_t
 
	gtime¡amp_u£c
;

205 
şick_
 
	gh
;

206 
şick_tı
 
	gtıh
;

207 ’um { 
	gSIZE
 = 44 };

210 
	sTSHC–l
 {

211 
ušt32_t
 
	gtime¡amp_£c
;

212 
ušt32_t
 
	gtime¡amp_u£c
;

213 
şick_
 
	gh
;

214 
şick_tı
 
	gtıh
;

215 ’um { 
	gSIZE
 = 44 };

218 cÚ¡ 
ušt32_t
 
	gBUFFER_SIZE
 = 32768;

219 cÚ¡ 
	gSAMPLING_SHIFT
 = 28;

221 
FromFe
 
	g_ff
;

223 
Pack‘
 *
	g_·ck‘
;

225 
boŞ
 
	g_timšg
 : 1;

226 
boŞ
 
	g_have_fœ¡_time
 : 1;

227 
boŞ
 
	g_have_Ï¡_time
 : 1;

228 
boŞ
 
	g_have_ªy_times
 : 1;

229 
boŞ
 
	g_fœ¡_time_»Ïtive
 : 1;

230 
boŞ
 
	g_Ï¡_time_»Ïtive
 : 1;

231 
boŞ
 
	g_Ï¡_time_š‹rv®
 : 1;

232 
boŞ
 
	g_aùive
;

233 
	g_§m¶šg_´ob
;

234 
	g_fÜm©
;

235 
	g_ûÎ_size
;

237 
Time¡amp
 
	g_fœ¡_time
;

238 
Time¡amp
 
	g_Ï¡_time
;

239 
HªdËrC®l
 *
	g_’d_h
;

241 
Task
 
	g_sk
;

243 
Time¡amp
 
	g_time_off£t
;

244 
off_t
 
	g_·ck‘_f•os
;

246 
boŞ
 
»ad_·ck‘
(
E¼ÜHªdËr
 *);

248 
´•¬e_times
(cÚ¡ 
Time¡amp
 &);

250 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

251 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

253 
	}
};

255 
	gCLICK_ENDDECLS


	@analysis/fromtcpdump.cc

19 
	~<şick/cÚfig.h
>

21 
	~"äomtıdump.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/glue.hh
>

27 
	~<şick/¡¿ccum.hh
>

28 
	~<şickÃt/.h
>

29 
	~<şickÃt/udp.h
>

30 
	~<şick/·ck‘_ªno.hh
>

31 
	~<şick/u£ruts.hh
>

32 
	~<uni¡d.h
>

33 
	~<sys/ty³s.h
>

34 
	~<sys/¡©.h
>

35 
	~<fú.h
>

36 
CLICK_DECLS


38 
	gFromTıdump
::
	$FromTıdump
()

39 : 
	$_sk
(
this
)

41 
_ff
.
	`£t_Ïndm¬k_·‰”n
("%f:%l");

42 
	}
}

44 
	gFromTıdump
::~
	$FromTıdump
()

46 
	}
}

49 
FromTıdump
::
	$ÿ¡
(cÚ¡ *
n
)

51 ià(
	`¡rcmp
(
n
, 
NÙif›r
::
EMPTY_NOTIFIER
è=ğ0 && !
	`ouut_is_push
(0))

52  
¡©ic_ÿ¡
<
NÙif›r
 *>(&
_nÙif›r
);

54  
EËm’t
::
	`ÿ¡
(
n
);

55 
	}
}

58 
	gFromTıdump
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

60 
boŞ
 
	g¡İ
 = 
çl£
, 
	gaùive
 = 
Œue
, 
	gz”o
 =rue, 
	gchecksum
 = false;

61 
	g_§m¶šg_´ob
 = (1 << 
SAMPLING_SHIFT
);

62 
	g_absŞu‹_£q
 = -1;

64 ià(
Args
(
cÚf
, 
this
, 
”rh
)

65 .
»ad_mp
("FILENAME", 
F’ameArg
(), 
_ff
.
f’ame
())

66 .
»ad
("STOP", 
¡İ
)

67 .
»ad
("ACTIVE", 
aùive
)

68 .
»ad
("ZERO", 
z”o
)

69 .
»ad
("CHECKSUM", 
checksum
)

70 .
»ad
("SAMPLE", 
FixedPoštArg
(
SAMPLING_SHIFT
), 
_§m¶šg_´ob
)

71 .
com¶‘e
() < 0)

73 ià(
	g_§m¶šg_´ob
 > (1 << 
	gSAMPLING_SHIFT
)) {

74 
	g”rh
->
w¬nšg
("SAMPLE…robability„educedo 1");

75 
	g_§m¶šg_´ob
 = (1 << 
SAMPLING_SHIFT
);

76 } ià(
	g_§m¶šg_´ob
 == 0)

77 
”rh
->
w¬nšg
("SAMPLE…robability is 0;ƒmitting‚o…ackets");

79 
	g_¡İ
 = 
¡İ
;

80 
	g_aùive
 = 
aùive
;

81 
	g_z”o
 = 
z”o
;

82 
	g_checksum
 = 
checksum
;

83 
	g_d—d
 = 
çl£
;

88 
	gFromTıdump
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

91 ià(!
	`ouut_is_push
(0))

92 
_nÙif›r
.
	`š™Ÿlize
(
NÙif›r
::
EMPTY_NOTIFIER
, 
	`rou‹r
());

94 ià(
_ff
.
	`š™Ÿlize
(
”rh
) < 0)

98 
SŒšg
 
lše
;

99 ià(
_ff
.
	`³ek_lše
(
lše
, 
”rh
, 
Œue
) < 0)

101 ià(!
lše
 || !
	`isdig™
(()†ine[0]))

102 
”rh
->
	`lw¬nšg
(
_ff
.
	`´št_f’ame
(), "first†ine suspicious; ishis‡cpdump output file?");

104 
_fÜm©_com¶ašt
 = 
çl£
;

105 ià(
	`ouut_is_push
(0))

106 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_aùive
, 
”rh
);

108 
	}
}

111 
	gFromTıdump
::
	$ş—nup
(
CËªupSge
)

113 
_ff
.
	`ş—nup
();

114 
	}
}

117 
	$­³nd_Ãt_ušt32_t
(
SŒšgAccum
 &
§
, 
ušt32_t
 
u
)

119 
§
 << ()(
u
 >> 24) << ()(u >> 16) << ()(u >> 8) << ()u;

120 
	}
}

123 
	$£t_checksums
(
Wr™abËPack‘
 *
q
, 
şick_
 *
h
)

125 
	`as£¹
(
h
 =ğ
q
->
	`_h—d”
());

127 
h
->
_sum
 = 0;

128 
h
->
_sum
 = 
	`şick_š_cksum
((
ušt8_t
 *)h, iph->
_hl
 << 2);

130 ià(
	`IP_ISFRAG
(
h
))

132 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
) {

133 
şick_tı
 *
tıh
 = 
q
->
	`tı_h—d”
();

134 
tıh
->
th_sum
 = 0;

135 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
tıh
, 
q
->
	`Œª¥Üt_Ëngth
());

136 
tıh
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 
h
, 
q
->
	`Œª¥Üt_Ëngth
());

137 } ià(
h
->
_p
 =ğ
IP_PROTO_UDP
) {

138 
şick_udp
 *
udph
 = 
q
->
	`udp_h—d”
();

139 
udph
->
uh_sum
 = 0;

140 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
udph
, 
q
->
	`Œª¥Üt_Ëngth
());

141 
udph
->
uh_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 
h
, 
q
->
	`Œª¥Üt_Ëngth
());

143 
	}
}

146 
	gFromTıdump
::
	$»ad_tı_lše
(
Wr™abËPack‘
 *&
q
, cÚ¡ *
s
, cÚ¡ *
’d
, *
d©a_Ën
)

148 
şick_tı
 *
tıh
 = 
q
->
	`tı_h—d”
();

151 ià(
s
 < 
’d
 && *s == '.')

152 
tıh
->
th_æags
 = 
TH_ACK
, 
s
++;

154 
tıh
->
th_æags
 = 0;

155 
s
 < 
’d
 && 
IPSumm¬yDump
::
tı_æag_m­pšg
[(
ušt8_t
) *s]) {

156 
tıh
->
th_æags
 |ğ(1 << (
IPSumm¬yDump
::
tı_æag_m­pšg
[ (
ušt8_t
è*
s
 ] - 1));

157 
s
++;

160 ià(
s
 >ğ
’d
 || *s != ' ')

161  
s
;

164 cÚ¡ *
s2
;

165 ià(
s
 + 9 <ğ
’d
 && 
	`memcmp
( + 1, "[bad hdr", 8è=ğ0 && (
s2
 = 
	`fšd
(s + 9,ƒnd, ']')) + 1 <ƒnd && s2[1] == ' ')

166 
s
 = 
s2
 + 1;

167 ià(
s
 + 14 <ğ
’d
 && 
	`memcmp
(s + 1, "[tcp sum ok] ", 13) == 0)

168 
s
 += 14;

169 ià(
s
 + 9 <ğ
’d
 && 
	`memcmp
( + 1, "[badı", 8è=ğ0 && (
s2
 = 
	`fšd
(s + 9,ƒnd, ']')) + 1 <ƒnd && s2[1] == ' ')

170 
s
 = 
s2
 + 2;

172 
s
++;

175 
ušt32_t
 
£q
 = 0, 
’d_£q
 = 0, 
ack_£q
 = 0;

176 ià(
s
 < 
’d
 && s[0] != 'a') {

177 cÚ¡ *
e£q
 = 
	`ı_š‹g”
(
s
, 
’d
, 0, &
£q
);

178 ià(
e£q
 =ğ
s
 ||ƒ£q >ğ
’d
 || *eseq != ':')

179  
s
;

180 cÚ¡ *
“nd_£q
 = 
	`ı_š‹g”
(
e£q
 + 1, 
’d
, 0, &
’d_£q
);

181 ià(
“nd_£q
 =ğ
e£q
 + 1 ||ƒ’d_£q >ğ
’d
 || *eend_seq != '(')

182  
s
;

184 
s
 = 
“nd_£q
 + 1; s < 
’d
 && 
	`isdig™
(() *s); s++)

186 ià(
s
 >ğ
’d
 || *s != ')')

187  
s
;

188 ià(
s
 + 1 >ğ
’d
 || s[1] != ' ')

189  
s
 + 1;

191 
s
 += 2;

193 *
d©a_Ën
 = 
’d_£q
 - 
£q
;

196 ià(
s
 + 4 < 
’d
 && s[0] =ğ'a' && s[1] =ğ'c' && s[2] =ğ'k' && s[3] =ğ' ' && 
	`isdig™
(() s[4])) {

197 
tıh
->
th_æags
 |ğ
TH_ACK
;

198 
s
 = 
	`ı_š‹g”
( + 4, 
’d
, 0, &
ack_£q
);

199 ià(
s
 < 
’d
 && *s == ' ')

200 
s
++;

204 
FlowRecÜd
 *
»cÜd
 = 0;

205 
boŞ
 
»v
 = 
çl£
;

206 ià(
tıh
->
th_æags
 & 
TH_ACK
) {

208 cÚ¡ 
şick_
 *
h
 = 
q
->
	`_h—d”
();

209 
»v
 = (
tıh
->
th_¥Üt
 <ıh->
th_dpÜt


210 || (
tıh
->
th_¥Üt
 =ğtıh->
th_dpÜt
 && 
h
->
_¤c
.
s_addr
 < iph->
_d¡
.s_addr));

211 ià(
»v
)

212 
»cÜd
 = &
_tı_m­
[
	`IPFlowID
(
h
->
_¤c
, 
tıh
->
th_¥Üt
, iph->
_d¡
,ıh->
th_dpÜt
)];

214 
»cÜd
 = &
_tı_m­
[
	`IPFlowID
(
h
->
_d¡
, 
tıh
->
th_dpÜt
, iph->
_¤c
,ıh->
th_¥Üt
)];

216 ià((!
»cÜd
->
š™_£q
[0] && !»cÜd->š™_£q[1]è|| (
tıh
->
th_æags
 & 
TH_SYN
)) {

217 
»cÜd
->
š™_£q
[
»v
] = 
£q
;

218 
»cÜd
->
š™_£q
[!
»v
] = 
ack_£q
 - 1;

220 ià(
_absŞu‹_£q
 < 0)

221 
_absŞu‹_£q
 = (
	`SEQ_GEQ
(
ack_£q
, 
»cÜd
->
š™_£q
[!
»v
]) &&‡ck_seq > 8000);

222 ià(
£q
 =ğ0 && 
’d_£q
 == 0)

223 
£q
 = 
’d_£q
 = 
»cÜd
->
Ï¡_£q
[
»v
];

224 ià(!
_absŞu‹_£q
) {

225 
£q
 +ğ
»cÜd
->
š™_£q
[
»v
];

226 
’d_£q
 +ğ
»cÜd
->
š™_£q
[
»v
];

228 ià(!
_absŞu‹_£q
)

229 
ack_£q
 +ğ
»cÜd
->
š™_£q
[!
»v
];

232 
»cÜd
->
Ï¡_£q
[
»v
] = 
’d_£q
 + (
tıh
->
th_æags
 & 
TH_SYN
 ? 1 : 0è+ (tıh->th_æag & 
TH_FIN
 ? 1 : 0);

233 ià(!
»cÜd
->
Ï¡_£q
[!
»v
])

234 
»cÜd
->
Ï¡_£q
[!
»v
] = 
ack_£q
;

236 
tıh
->
th_£q
 = 
	`htÚl
(
£q
);

237 
tıh
->
th_ack
 = 
	`htÚl
(
ack_£q
);

240 
ušt32_t
 
u
;

241 ià(
s
 + 4 < 
’d
 && s[0] =ğ'w' && s[1] =ğ'i' && s[2] =ğ'n' && s[3] =ğ' ' && 
	`isdig™
(() s[4])) {

242 
s
 = 
	`ı_š‹g”
( + 4, 
’d
, 0, &
u
);

243 
tıh
->
th_wš
 = 
	`htÚs
(
u
);

244 ià(
s
 < 
’d
 && *s == ' ')

245 
s
++;

249 ià(
s
 + 4 < 
’d
 && s[0] =ğ'u' && s[1] =ğ'r' && s[2] =ğ'g' && s[3] =ğ' ' && 
	`isdig™
(() s[4])) {

250 
s
 = 
	`ı_š‹g”
( + 4, 
’d
, 0, &
u
);

251 
tıh
->
th_u½
 = 
	`htÚs
(
u
);

252 ià(
s
 < 
’d
 && *s != ' ')

253 
s
++;

257 
SŒšgAccum
 
İt
;

258 ià(
s
 < 
’d
 && s[0] == '<') {

259 
s
++; s < 
’d
 && *s != '>'; ) {

260 
İ’1
 = 
İt
.
	`Ëngth
();

261 ià(
s
 + 3 <ğ
’d
 && s[0] == 'n' && s[1] == 'o' && s[2] == 'p') {

262 
İt
 << ()
TCPOPT_NOP
;

263 
s
 += 3;

264 } ià(
s
 + 3 <ğ
’d
 && s[0] == 'e' && s[1] == 'o' && s[2] == 'l') {

265 
İt
 << ()
TCPOPT_EOL
;

266 
s
 += 3;

267 } ià(
s
 + 4 < 
’d
 && s[0] =ğ'm' && s[1] =ğ's' && s[2] =ğ's' && s[3] =ğ' ' && 
	`isdig™
(() s[4])) {

268 
s
 = 
	`ı_š‹g”
( + 4, 
’d
, 0, &
u
);

269 
İt
 << ()
TCPOPT_MAXSEG
 << ()
TCPOLEN_MAXSEG
 << ()((
u
 >> 8) & 255) << ()(u & 255);

270 } ià(
s
 + 7 < 
’d
 && 
	`memcmp
(s, "wsÿË ", 7è=ğ0 && 
	`isdig™
(() s[7])) {

271 
s
 = 
	`ı_š‹g”
( + 7, 
’d
, 0, &
u
);

272 
İt
 << ()
TCPOPT_WSCALE
 << ()
TCPOLEN_WSCALE
 << ()
u
;

273 } ià(
s
 + 6 <ğ
’d
 && 
	`memcmp
(s, "sackOK", 6) == 0) {

274 
İt
 << ()
TCPOPT_SACK_PERMITTED
 << ()
TCPOLEN_SACK_PERMITTED
;

275 
s
 += 6;

276 } ià(
s
 + 10 < 
’d
 && 
	`memcmp
(s, "time¡am°", 10è=ğ0 && 
	`isdig™
(() s[10])) {

277 
s
 = 
	`ı_š‹g”
( + 10, 
’d
, 0, &
u
);

278 ià(
s
 + 1 < 
’d
 && * =ğ' ' && 
	`isdig™
(() s[1])) {

279 
ušt32_t
 
u2
;

280 
s
 = 
	`ı_š‹g”
( + 1, 
’d
, 0, &
u2
);

281 
İt
 << ()
TCPOPT_TIMESTAMP
 << ()
TCPOLEN_TIMESTAMP
;

282 
	`­³nd_Ãt_ušt32_t
(
İt
, 
u
);

283 
	`­³nd_Ãt_ušt32_t
(
İt
, 
u2
);

285 } ià(
s
 + 10 < 
’d
 && 
	`memcmp
(s, "§ck sack ", 10è=ğ0 && 
	`isdig™
(() s[10])) {

286 
ušt32_t
 
n§ck
, 
u2
;

287 
s
 = 
	`ı_š‹g”
( + 10, 
’d
, 0, &
n§ck
);

288 
İt
 << ()
TCPOPT_SACK
 << ()(
n§ck
 * 8 + 2);

289 
s
 < 
’d
 && *s == ' ')

290 
s
++;

291 
s
 + 1 < 
’d
 && * =ğ'{' && 
	`isdig™
(() s[1])) {

292 
s
 = 
	`ı_š‹g”
( + 1, 
’d
, 0, &
u
);

293 ià(
s
 + 1 < 
’d
 && * =ğ':' && 
	`isdig™
(() s[1])) {

294 
s
 = 
	`ı_š‹g”
( + 1, 
’d
, 0, &
u2
);

295 ià(
s
 < 
’d
 && *s == '}') {

296 
s
++;

297 ià(
»cÜd
 && !
_absŞu‹_£q
) {

298 
u
 +ğ
»cÜd
->
š™_£q
[!
»v
];

299 
u2
 +ğ
»cÜd
->
š™_£q
[!
»v
];

301 
	`­³nd_Ãt_ušt32_t
(
İt
, 
u
);

302 
	`­³nd_Ãt_ušt32_t
(
İt
, 
u2
);

306 
s
 < 
’d
 && *s == ' ')

307 
s
++;

309 ià(
s
 < 
’d
 && *s == ',')

310 
s
++;

311 ià(
s
 < 
’d
 && *s != '>') {

312 
İt
.
	`£t_Ëngth
(
İ’1
);

313 
s
 < 
’d
 && *s != ',' && *s != '>')

314 
s
++;

317 ià(
s
 < 
’d
 && *s == '>')

318 
s
++;

319 
İt
.
	`Ëngth
() % 4 != 0)

320 
İt
 << ()
TCPOPT_EOL
;

321 
q
 = q->
	`put
(
İt
.
	`Ëngth
());

322 
	`memıy
(
q
->
	`Œª¥Üt_h—d”
(è+ (
şick_tı
), 
İt
.
	`d©a
(), o±.
	`Ëngth
());

323 
q
->
	`tı_h—d”
()->
th_off
 = ((
şick_tı
è+ 
İt
.
	`Ëngth
()) >> 2;

325 
tıh
->
th_off
 = (
şick_tı
) >> 2;

327  
s
;

328 
	}
}

331 
	gFromTıdump
::
	$»ad_udp_lše
(
Wr™abËPack‘
 *&, cÚ¡ *
s
, cÚ¡ *
’d
, *
d©a_Ën
)

334 cÚ¡ *
s2
;

335 ià(
s
 + 9 <ğ
’d
 && 
	`memcmp
( + 1, "[bad hdr", 8è=ğ0 && (
s2
 = 
	`fšd
(s + 9,ƒnd, ']')) + 1 <ƒnd && s2[1] == ' ')

336 
s
 = 
s2
 + 1;

337 ià(
s
 + 14 <ğ
’d
 && 
	`memcmp
(s + 1, "[udp sum ok] ", 13) == 0)

338 
s
 += 14;

339 ià(
s
 + 9 <ğ
’d
 && 
	`memcmp
( + 1, "[bad udp", 8è=ğ0 && (
s2
 = 
	`fšd
(s + 9,ƒnd, ']')) + 1 <ƒnd && s2[1] == ' ')

340 
s
 = 
s2
 + 2;

343 ià(
s
 + 4 < 
’d
 && s[0] =ğ'u' && s[1] =ğ'd' && s[2] =ğ'p' && s[3] =ğ' ' && 
	`isdig™
(() s[4])) {

344 
ušt32_t
 
dl
;

345 
s
 = 
	`ı_š‹g”
( + 4, 
’d
, 0, &
dl
);

346 *
d©a_Ën
 = 
dl
;

349  
s
;

350 
	}
}

352 
Pack‘
 *

353 
	gFromTıdump
::
	$»ad_·ck‘
(
E¼ÜHªdËr
 *
”rh
)

355 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(0, (cÚ¡ *)0, (
şick_
è+ (
şick_tı
), 20);

356 ià(!
q
) {

357 
_ff
.
	`”rÜ
(
”rh
, "out of memory!");

358 
_d—d
 = 
Œue
;

361 ià(
_z”o
)

362 
	`mem£t
(
q
->
	`d©a
(), 0, q->
	`Ëngth
());

363 
q
->
	`£t__h—d”
((
şick_
 *)q->
	`d©a
(), (click_ip));

364 
şick_
 *
h
 = 
q
->
	`_h—d”
();

365 
h
->
_v
 = 4;

366 
h
->
_hl
 = (
şick_
) >> 2;

367 
h
->
_off
 = 0;

368 
h
->
_tos
 = 0;

369 
h
->
_‰l
 = 2;

370 
şick_udp
 *
udph
 = 
q
->
	`udp_h—d”
();

372 
SŒšg
 
lše
;

373 
SŒšgAccum
 
·ylßd
;

374 
SŒšg
 
_İt
;

375 
SŒšg
 
tı_İt
;

379 ià(
_ff
.
	`»ad_lše
(
lše
, 
”rh
, 
Œue
) <= 0) {

380 
q
->
	`kl
();

381 
_d—d
 = 
Œue
;

385 cÚ¡ *
s
 = 
lše
.
	`d©a
();

386 cÚ¡ *
’d
 = 
lše
.
	`’d
();

387 ià(
s
 >ğ
’d
 || s[0] == '#')

389 ià(!
	`isdig™
((è
s
[0]))

393 cÚ¡ *
s2
 = 
	`fšd
(
s
, 
’d
, ' ');

394 ià(!
	`ı_time
(
lše
.
	`sub¡ršg
(
s
, 
s2
), &
q
->
	`time¡amp_ªno
()))

396 
s
 = 
s2
 + 1;

399 
h
->
_p
 = 0;

400 cÚ¡ *
cŞÚ
 = 
	`fšd
(
s
, 
’d
, ':');

401 
cŞÚ
++; cŞÚ < 
’d
 && *colon == ' '; colon++)

403 ià(
cŞÚ
 < 
’d
) {

404 ià(*
cŞÚ
 == 'i')

405 
h
->
_p
 = 
IP_PROTO_ICMP
;

406 ià(*
cŞÚ
 =ğ'u' || (*cŞÚ =ğ'[' && cŞÚ + 1 < 
’d
 && colon[1] == 'u'))

407 
h
->
_p
 = 
IP_PROTO_UDP
;

408 ià(*
cŞÚ
 == '.' || (*colon >= 'A' && *colon <= 'Z'))

409 
h
->
_p
 = 
IP_PROTO_TCP
;

413 
s2
 = 
	`fšd
(
s
, 
’d
, ' ');

414 ià(
s2
 =ğ
s
 || s2 + 2 >ğ
’d
 || s2[1] != '>' || s2[2] != ' ')

416 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
 || iph->_°=ğ
IP_PROTO_UDP
) {

417 cÚ¡ *
sm
 = 
s2
 - 1;

418 
sm
 > 
s
 && *sm != '.' && *sm != ':')

419 
sm
--;

420 ià(!
	`IPAdd»ssArg
().
	`·r£
(
lše
.
	`sub¡ršg
(
s
, 
sm
), 
h
->
_¤c
)

421 || !
	`IPPÜtArg
(
h
->
_p
).
	`·r£
(
lše
.
	`sub¡ršg
(
sm
 + 1, 
s2
), 
udph
->
uh_¥Üt
))

424 
udph
->
uh_¥Üt
 = 
	`htÚs
(udph->uh_sport);

425 } ià(!
	`IPAdd»ssArg
().
	`·r£
(
lše
.
	`sub¡ršg
(
s
, 
s2
), 
h
->
_¤c
))

427 
s
 = 
s2
 + 3;

430 
s2
 = 
	`fšd
(
s
, 
’d
, ':');

431 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
 || iph->_°=ğ
IP_PROTO_UDP
) {

432 cÚ¡ *
sm
 = 
s2
 - 1;

433 
sm
 > 
s
 && *sm != '.' && *sm != ':')

434 
sm
--;

435 ià(!
	`IPAdd»ssArg
().
	`·r£
(
lše
.
	`sub¡ršg
(
s
, 
sm
), 
h
->
_d¡
)

436 || !
	`IPPÜtArg
(
h
->
_p
).
	`·r£
(
lše
.
	`sub¡ršg
(
sm
 + 1, 
s2
), 
udph
->
uh_dpÜt
))

439 
udph
->
uh_dpÜt
 = 
	`htÚs
(udph->uh_dport);

440 } ià(!
	`IPAdd»ssArg
().
	`·r£
(
lše
.
	`sub¡ršg
(
s
, 
s2
), 
h
->
_d¡
))

444 
d©a_Ën
 = -1;

445 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
 && 
	`IP_FIRSTFRAG
(iph)) {

446 
s
 = 
	`»ad_tı_lše
(
q
, 
cŞÚ
, 
’d
, &
d©a_Ën
);

447 
h
 = 
q
->
	`_h—d”
();

448 } ià(
h
->
_p
 =ğ
IP_PROTO_UDP
 && 
	`IP_FIRSTFRAG
(iph)) {

449 
s
 = 
	`»ad_udp_lše
(
q
, 
cŞÚ
, 
’d
, &
d©a_Ën
);

450 
q
->
	`ke
((
şick_tı
è- (
şick_udp
));

452 
q
->
	`ke
((
şick_tı
));

453 
s
 = 
cŞÚ
;

458 
s2
 = 
’d
 - 1;

459 
s2
 > 
s
) {

460 
s2
 > 
s
 && 
	`is¥aû
(() *s2))

461 
s2
--;

462 ià(
s2
 <ğ
s
 || (*s2 != ')' && *s2 != ']'))

464 
İ’”
 = (*
s2
 == ')' ? '(' : '[');

465 cÚ¡ *
İ’
 = 
s2
 - 1;

466 
İ’
 >ğ
s
 && *İ’ !ğ
İ’”
)

467 
İ’
--;

468 cÚ¡ *
şo£
 = 
s2
;

469 
s2
 = 
İ’
 - 1;

470 
ušt32_t
 
u
;

472 ià(
İ’
 >ğ
s
 && o³À< 
şo£
) {

473 cÚ¡ *
™em
 = 
İ’
 + 1;

474 
™em
 < 
şo£
) {

475 ià(
şo£
 - 
™em
 >ğ7 && 
	`memcmp
(item, "tos 0x", 6) == 0) {

476 
™em
 = 
	`ı_š‹g”
(™em + 6, 
şo£
, 16, &
u
);

477 
h
->
_tos
 = 
u
;

478 } ià(
şo£
 - 
™em
 >ğ6 && 
	`memcmp
(item, "ECT(", 4) == 0 && (item[4] == '0' || item[4] == '1') && item[5] == ')') {

479 
h
->
_tos
 = (h->_to & ~
IP_ECNMASK
è| (
™em
[4] =ğ'0' ? 
IP_ECN_ECT1
 : 
IP_ECN_ECT2
);

480 
™em
 += 6;

481 } ià(
şo£
 - 
™em
 >= 2 && item[0] == 'C' && item[1] == 'E') {

482 
h
->
_tos
 = (h->_to & ~
IP_ECNMASK
è| 
IP_ECN_CE
;

483 
™em
 += 2;

484 } ià(
şo£
 - 
™em
 >= 2 && item[0] == 'D' && item[1] == 'F') {

485 
h
->
_off
 |ğ
	`htÚs
(
IP_DF
);

486 
™em
 += 2;

487 } ià(
şo£
 - 
™em
 >ğ10 && 
	`memcmp
(™em, "äag ", 5è=ğ0 && 
	`isdig™
(() item[5])) {

488 
™em
 = 
	`ı_š‹g”
(™em + 5, 
şo£
, 0, &
u
);

489 
h
->
_id
 = 
	`htÚs
(
u
);

490 ià(
™em
 > 
şo£
 - 2 || *™em !ğ':' || !
	`isdig™
(() item[1]))

492 
™em
 = 
	`ı_š‹g”
(™em + 1, 
şo£
, 0, &
u
);

493 
d©a_Ën
 = 
u
;

494 ià(
™em
 > 
şo£
 - 2 || *™em !ğ'@' || !
	`isdig™
(() item[1]))

496 
™em
 = 
	`ı_š‹g”
(™em + 1, 
şo£
, 0, &
u
);

497 
h
->
_off
 = (h->_ofà& 
	`htÚs
(~
IP_OFFMASK
)è| htÚs(
u
);

498 ià(
™em
 < 
şo£
 && *item == '+')

499 
h
->
_off
 |ğ
	`htÚs
(
IP_MF
), 
™em
++;

500 } ià(
şo£
 - 
™em
 >ğ5 && 
	`memcmp
(™em, "‰È", 4è=ğ0 && 
	`isdig™
(() item[4])) {

501 
™em
 = 
	`ı_š‹g”
(™em + 4, 
şo£
, 0, &
u
);

502 
h
->
_‰l
 = 
u
;

503 } ià(
şo£
 - 
™em
 >ğ4 && 
	`memcmp
(™em, "id ", 3è=ğ0 && 
	`isdig™
(() item[3])) {

504 
™em
 = 
	`ı_š‹g”
(™em + 3, 
şo£
, 0, &
u
);

505 
h
->
_id
 = 
	`htÚs
(
u
);

506 } ià(
şo£
 - 
™em
 >ğ5 && 
	`memcmp
(™em, "ËÀ", 4è=ğ0 && 
	`isdig™
(() item[4])) {

507 
™em
 = 
	`ı_š‹g”
(™em + 4, 
şo£
, 0, &
u
);

508 ià(
d©a_Ën
 < 0 || 
u
 =ğ
q
->
	`Ëngth
() + data_len)

509 
d©a_Ën
 = 
u
 - 
q
->
	`Ëngth
();

510 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
) {

512 
d–
 = 
u
 - (
q
->
	`Ëngth
(è+ 
d©a_Ën
);

513 
q
->
	`chªge_h—droom_ªd_Ëngth
(q->
	`h—droom
(), 
u
 - 
d©a_Ën
);

514 
q
->
	`tı_h—d”
()->
th_off
 = (q->
	`Œª¥Üt_Ëngth
() >> 2);

515 ià(
d–
 > 0)

516 
q
->
	`’d_d©a
()[-
d–
] = 
TCPOPT_EOL
;

520 
™em
 < 
şo£
 && (*™em =ğ',' || 
	`is¥aû
(() *item)))

521 
™em
++;

527 ià(
d©a_Ën
 < 0)

528 
d©a_Ën
 = 0;

529 
h
->
_Ën
 = 
	`Áohs
(
q
->
	`Ëngth
(è+ 
d©a_Ën
);

530 
	`SET_EXTRA_LENGTH_ANNO
(
q
, 
d©a_Ën
);

533 ià(
h
->
_p
 =ğ
IP_PROTO_UDP
 && 
	`IP_FIRSTFRAG
(iph))

534 
q
->
	`udp_h—d”
()->
uh_uËn
 = 
	`htÚs
(
	`Áohs
(
h
->
_Ën
è- (h->
_hl
 << 2));

537 ià(
_checksum
)

538 
	`£t_checksums
(
q
, 
h
);

540  
q
;

544 ià(!
_fÜm©_com¶ašt
) {

546 cÚ¡ *
s
 = 
lše
.
	`begš
();

547 
s
 < 
lše
.
	`’d
() && (*s == ' ' || *s == '\t' || *s == '\n' || *s == '\r'))

548 
s
++;

549 ià(
s
 !ğ
lše
.
	`’d
()) {

550 
_ff
.
	`”rÜ
(
”rh
, "packet…arseƒrror");

551 
_fÜm©_com¶ašt
 = 
Œue
;

554 ià(
q
)

555 
q
->
	`kl
();

557 
	}
}

559 
boŞ


560 
	gFromTıdump
::
	$run_sk
(
Task
 *)

562 ià(!
_aùive
)

563  
çl£
;

564 
Pack‘
 *
p
;

567 
p
 = 
	`»ad_·ck‘
(0);

568 ià(
_d—d
) {

569 ià(
_¡İ
)

570 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

571  
çl£
;

574 ià(
_§m¶šg_´ob
 >ğ(1 << 
SAMPLING_SHIFT
)

575 || (
	`şick_¿ndom
(è& ((1 << 
SAMPLING_SHIFT
è- 1)è< 
_§m¶šg_´ob
)

577 ià(
p
)

578 
p
->
	`kl
();

581 ià(
p
)

582 
	`ouut
(0).
	`push
(
p
);

583 
_sk
.
	`ç¡_»scheduË
();

584  
Œue
;

585 
	}
}

587 
Pack‘
 *

588 
	gFromTıdump
::
	$puÎ
()

590 ià(!
_aùive
)

592 
Pack‘
 *
p
;

595 
p
 = 
	`»ad_·ck‘
(0);

596 ià(
_d—d
) {

597 ià(
_¡İ
)

598 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

599 
_nÙif›r
.
	`¦“p
();

603 ià(
_§m¶šg_´ob
 >ğ(1 << 
SAMPLING_SHIFT
)

604 || (
	`şick_¿ndom
(è& ((1 << 
SAMPLING_SHIFT
è- 1)è< 
_§m¶šg_´ob
)

606 ià(
p
)

607 
p
->
	`kl
();

610 
_nÙif›r
.
	`wake
();

611  
p
;

612 
	}
}

615 ’um { 
	mH_SAMPLING_PROB
, 
	mH_ACTIVE
, 
	mH_ENCAP
, 
	mH_STOP
 };

617 
SŒšg


618 
	gFromTıdump
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

620 
FromTıdump
 *
fd
 = 
¡©ic_ÿ¡
<FromTıdum°*>(
e
);

621 (
šŒ_t
)
thunk
) {

622 
H_SAMPLING_PROB
:

623  
	`ı_uÅ¬£_»®2
(
fd
->
_§m¶šg_´ob
, 
SAMPLING_SHIFT
);

624 
H_ACTIVE
:

625  
BoŞArg
::
	`uÅ¬£
(
fd
->
_aùive
);

626 
H_ENCAP
:

631 
	}
}

634 
	gFromTıdump
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s_š
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

636 
FromTıdump
 *
fd
 = 
¡©ic_ÿ¡
<FromTıdum°*>(
e
);

637 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
s_š
);

638 (
šŒ_t
)
thunk
) {

639 
H_ACTIVE
: {

640 
boŞ
 
aùive
;

641 ià(
	`BoŞArg
().
	`·r£
(
s
, 
aùive
)) {

642 
fd
->
_aùive
 = 
aùive
;

643 ià(
fd
->
	`ouut_is_push
(0è&& 
aùive
 && !fd->
_sk
.
	`scheduËd
())

644 
fd
->
_sk
.
	`»scheduË
();

645 ià(!
fd
->
	`ouut_is_push
(0))

646 
fd
->
_nÙif›r
.
	`£t_aùive
(
aùive
, 
Œue
);

649  
”rh
->
	`”rÜ
("syntaxƒrror");

651 
H_STOP
:

652 
fd
->
_aùive
 = 
çl£
;

653 
fd
->
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

656  -
EINVAL
;

658 
	}
}

661 
	gFromTıdump
::
	$add_hªdËrs
()

663 
	`add_»ad_hªdËr
("§m¶šg_´ob", 
»ad_hªdËr
, 
H_SAMPLING_PROB
);

664 
	`add_»ad_hªdËr
("aùive", 
»ad_hªdËr
, 
H_ACTIVE
, 
HªdËr
::
f_checkbox
);

665 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 
H_ACTIVE
);

666 
	`add_»ad_hªdËr
("’ÿp", 
»ad_hªdËr
, 
H_ENCAP
);

667 
	`add_wr™e_hªdËr
("¡İ", 
wr™e_hªdËr
, 
H_STOP
, 
HªdËr
::
f_bu‰Ú
);

668 
_ff
.
	`add_hªdËrs
(
this
);

669 ià(
	`ouut_is_push
(0))

670 
	`add_sk_hªdËrs
(&
_sk
);

671 
	}
}

673 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
IPSumm¬yDump
)

674 
	$EXPORT_ELEMENT
(
FromTıdump
)

675 
CLICK_ENDDECLS


	@analysis/fromtcpdump.hh

2 #iâdeà
CLICK_FROMTCPDUMP_HH


3 
	#CLICK_FROMTCPDUMP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şick/nÙif›r.hh
>

7 
	~<şick/æowid.hh
>

8 
	~<şick/hashbË.hh
>

9 
	~<şickÃt/tı.h
>

10 
	~<şick/äomfe.hh
>

11 
	~"sumdumpšfo.hh
"

12 
CLICK_DECLS


115 şas 
	cFromTıdump
 : 
public
 
EËm’t
 {…ublic:

117 
	$FromTıdump
(è
CLICK_COLD
;

118 ~
	$FromTıdump
(è
CLICK_COLD
;

120 cÚ¡ *
	$şass_Çme
() const {  "FromTcpdump"; }

121 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

122 *
ÿ¡
(const *);

124 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

125 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

126 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

127 
	$add_hªdËrs
(è
CLICK_COLD
;

129 
boŞ
 
	`run_sk
(
Task
 *);

130 
Pack‘
 *
	`puÎ
();

132 
´iv©e
:

134 ’um { 
SAMPLING_SHIFT
 = 28 
	}
};

136 
FromFe
 
	g_ff
;

138 
ušt32_t
 
	g_§m¶šg_´ob
;

140 
boŞ
 
	g_¡İ
 : 1;

141 
boŞ
 
	g_fÜm©_com¶ašt
 : 1;

142 
boŞ
 
	g_z”o
 : 1;

143 
boŞ
 
	g_checksum
 : 1;

144 
boŞ
 
	g_aùive
 : 1;

145 
boŞ
 
	g_d—d
 : 1;

147 
	sFlowRecÜd
 {

148 
tı_£q_t
 
	gš™_£q
[2];

149 
tı_£q_t
 
	gÏ¡_£q
[2];

150 
šlše
 
FlowRecÜd
(è{ 
	gš™_£q
[0] = 
š™_£q
[1] = 0; }

152 
	gHashTabË
<
	gIPFlowID
, 
	gFlowRecÜd
> 
	g_tı_m­
;

153 
	g_absŞu‹_£q
;

155 
Task
 
	g_sk
;

156 
AùiveNÙif›r
 
	g_nÙif›r
;

158 
Pack‘
 *
»ad_·ck‘
(
E¼ÜHªdËr
 *);

159 cÚ¡ *
»ad_tı_lše
(
Wr™abËPack‘
 *&, cÚ¡ *
begš
, cÚ¡ *
’d
, *
d©a_Ën
);

160 cÚ¡ *
»ad_udp_lše
(
Wr™abËPack‘
 *&, cÚ¡ *
begš
, cÚ¡ *
’d
, *
d©a_Ën
);

162 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

163 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

165 
	}
};

167 
	gCLICK_ENDDECLS


	@analysis/ipsumdump_anno.cc

20 
	~<şick/cÚfig.h
>

22 
	~"sumdump_ªno.hh
"

23 
	~<şick/·ck‘.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/·ck‘_ªno.hh
>

26 
CLICK_DECLS


28 ’um { 
	mT_TIMESTAMP
, 
	mT_TIMESTAMP_SEC
, 
	mT_TIMESTAMP_USEC
, 
	mT_TIMESTAMP_USEC1
,

29 
	mT_FIRST_TIMESTAMP
, 
	mT_COUNT
, 
	mT_LINK
, 
	mT_DIRECTION
, 
	mT_AGGREGATE
,

30 
	mT_WIRE_LEN
 };

32 
Çme¥aû
 
	gIPSumm¬yDump
 {

34 
boŞ
 
ªno_exŒaù
(
Pack‘Desc
& 
d
, cÚ¡ 
F›ldWr™”
 *
f
)

36 cÚ¡ 
Pack‘
 *
	gp
 = 
d
.
p
;

37 
	gf
->
	gu£r_d©a
) {

38 
	gT_TIMESTAMP
:

39 
d
.
u32
[0] = 
p
->
time¡amp_ªno
().
£c
();

40 
	gd
.
	gu32
[1] = 
p
->
time¡amp_ªno
().
n£c
();

41  
	gŒue
;

42 
	gT_TIMESTAMP_SEC
:

43 
d
.
v
 = 
p
->
time¡amp_ªno
().
£c
();

44  
	gŒue
;

45 
	gT_TIMESTAMP_USEC
:

46 
d
.
v
 = 
p
->
time¡amp_ªno
().
u£c
();

47  
	gŒue
;

48 
	gT_TIMESTAMP_USEC1
: {

49 #ià
HAVE_INT64_TYPES


50 
ušt64_t
 
v3
 = ((ušt64_t)
p
->
time¡amp_ªno
().
£c
(è* 1000000è+…->time¡amp_ªno().
u£c
();

51 
	gd
.
	gu32
[1] = 
v3
;

52 
	gd
.
	gu32
[0] = 
v3
 >> 32;

53  
	gŒue
;

56 
	gd
.
	gu32
[1] = (
p
->
time¡amp_ªno
().
£c
(è* 1000000è+…->time¡amp_ªno().
u£c
();

57 
	gd
.
	gu32
[0] = 0;

58  
	gŒue
;

61 
	gT_FIRST_TIMESTAMP
:

62 
d
.
u32
[0] = 
CONST_FIRST_TIMESTAMP_ANNO
(
p
).
£c
();

63 
	gd
.
	gu32
[1] = 
CONST_FIRST_TIMESTAMP_ANNO
(
p
).
n£c
();

64  
	gŒue
;

65 
	gT_COUNT
:

66 
d
.
v
 = 1 + 
EXTRA_PACKETS_ANNO
(
p
);

67  
	gŒue
;

68 
	gT_LINK
:

69 
T_DIRECTION
:

70 
d
.
v
 = 
PAINT_ANNO
(
p
);

71  
	gŒue
;

72 
	gT_AGGREGATE
:

73 
d
.
v
 = 
AGGREGATE_ANNO
(
p
);

74  
	gŒue
;

75 
	gT_WIRE_LEN
:

76 
d
.
v
 = 
p
->
Ëngth
();

77  
	gŒue
;

79  
çl£
;

83 
ªno_šjeù
(
Pack‘Odesc
& 
d
, cÚ¡ 
F›ldR—d”
 *
f
)

85 
Wr™abËPack‘
 *
	gp
 = 
d
.
p
;

86 
	gf
->
	gu£r_d©a
) {

87 
	gT_TIMESTAMP
:

88 
p
->
£t_time¡amp_ªno
(
Time¡amp
::
make_n£c
(
d
.
u32
[0], d.u32[1]));

90 
	gT_TIMESTAMP_SEC
:

91 
p
->
time¡amp_ªno
().
£t_£c
(
d
.
v
);

93 
	gT_TIMESTAMP_USEC
:

94 
p
->
time¡amp_ªno
().
£t_sub£c
(
Time¡amp
::
u£c_to_sub£c
(
d
.
v
));

96 
	gT_TIMESTAMP_USEC1
: {

97 #ià
HAVE_INT64_TYPES


98 
ušt64_t
 
v3
 = ((ušt64_tè
d
.
u32
[1] << 32) | d.u32[0];

99 
	gp
->
£t_time¡amp_ªno
(
Time¡amp
::
make_u£c
(
v3
 / 1000000, v3 % 1000000));

103 
	gp
->
£t_time¡amp_ªno
(
Time¡amp
::
make_u£c
(
d
.
u32
[0] / 1000000, d.u32[0] % 1000000));

107 
	gT_FIRST_TIMESTAMP
:

108 
SET_FIRST_TIMESTAMP_ANNO
(
p
, 
Time¡amp
::
make_n£c
(
d
.
u32
[0], d.u32[1]));

110 
	gT_COUNT
:

111 
SET_EXTRA_PACKETS_ANNO
(
p
, 
d
.
v
 ? d.v - 1 : 0);

113 
	gT_LINK
:

114 
T_DIRECTION
:

115 
SET_PAINT_ANNO
(
p
, 
d
.
v
);

117 
	gT_AGGREGATE
:

118 
SET_AGGREGATE_ANNO
(
p
, 
d
.
v
);

120 
	gT_WIRE_LEN
:

121 
d
.
wªt_Ën
 = d.
v
;

126 
ªno_ou
(cÚ¡ 
Pack‘Desc
& 
d
, cÚ¡ 
F›ldWr™”
 *
f
)

128 
	gf
->
	gu£r_d©a
) {

129 
	gT_TIMESTAMP
:

130 
T_FIRST_TIMESTAMP
:

131 *
d
.
§
 << 
Time¡amp
::
make_n£c
(d.
u32
[0], d.u32[1]);

133 
	gT_DIRECTION
:

134 ià(
d
.
v
 == 0)

135 *
d
.
§
 << '>';

136 ià(
	gd
.
	gv
 == 1)

137 *
d
.
§
 << '<';

139 *
	gd
.
	g§
 << d.
	gv
;

144 
boŞ
 
ªno_ša
(
Pack‘Odesc
& 
d
, cÚ¡ 
SŒšg
 &
s
, cÚ¡ 
F›ldR—d”
 *
f
)

146 
	gf
->
	gu£r_d©a
) {

147 
	gT_TIMESTAMP
:

148 
T_FIRST_TIMESTAMP
: {

149 
Time¡amp
 
ts
;

150 ià(
ı_time
(
s
, &
ts
)) {

151 
	gd
.
	gu32
[0] = 
ts
.
£c
();

152 
	gd
.
	gu32
[1] = 
ts
.
n£c
();

153  
	gŒue
;

157 
	gT_LINK
:

158 
T_DIRECTION
:

159 ià(
s
.
equ®s
(">", 1)) {

160 
	gd
.
	gv
 = 0;

161  
	gŒue
;

162 } ià(
	gs
.
equ®s
("<", 1)) {

163 
	gd
.
	gv
 = 1;

164  
	gŒue
;

166  
IÁArg
().
·r£
(
s
, 
d
.
v
);

168  
	gçl£
;

171 #ifdeà
i386


172 
	#PUT4
(
p
, 
d
è*
»š‹½»t_ÿ¡
<
ušt32_t
 *>(Õ)èğ
	`htÚl
((d))

	)

173 
	#GET4
(
p
è
	`Áohl
(*
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(Õ)))

	)

175 
	#PUT4
(
p
, 
d
èdØ{ (p)[0] = (d)>>24; (p)[1] = (d)>>16; (p)[2] = (d)>>8; (p)[3] = (d); } 0)

	)

176 
	#GET4
(
p
è(Õ)[0]<<24 | (p)[1]<<16 | (p)[2]<<8 | (p)[3])

	)

179 
utime¡amp_outb
(cÚ¡ 
Pack‘Desc
& 
d
, 
boŞ
, cÚ¡ 
F›ldWr™”
 *)

181 * 
	gc
 = 
d
.
§
->
ex‹nd
(8);

182 
PUT4
(
c
, 
d
.
u32
[0]);

183 
PUT4
(
c
 + 4, 
d
.
u32
[1] / 1000);

186 cÚ¡ 
ušt8_t
 *
utime¡amp_šb
(
Pack‘Odesc
& 
d
, cÚ¡ ušt8_t* 
s
, cÚ¡ ušt8_ˆ*
’ds
, cÚ¡ 
F›ldR—d”
 *)

188 ià(
	gs
 + 7 >ğ
’ds
)

189  
’ds
;

190 
	gd
.
	gu32
[0] = 
GET4
(
s
);

191 
	gd
.
	gu32
[1] = 
GET4
(
s
 + 4) * 1000;

192  
	gs
 + 8;

195 cÚ¡ 
	gIPSumm¬yDump
::
F›ldWr™”
 
ªno_wr™”s
[] = {

196 { "time¡amp", 
B_8
, 
T_TIMESTAMP
,

197 0, 
ªno_exŒaù
, 
ªno_ou
, 
utime¡amp_outb
 },

198 { "Áime¡amp", 
B_8
, 
T_TIMESTAMP
,

199 0, 
ªno_exŒaù
, 
ªno_ou
, 
outb
 },

200 { "ts_£c", 
B_4
, 
T_TIMESTAMP_SEC
,

201 0, 
ªno_exŒaù
, 
num_ou
, 
outb
 },

202 { "ts_u£c", 
B_4
, 
T_TIMESTAMP_USEC
,

203 0, 
ªno_exŒaù
, 
num_ou
, 
outb
 },

204 { "ts_u£c1", 
B_8
, 
T_TIMESTAMP_USEC1
,

205 0, 
ªno_exŒaù
, 
num_ou
, 
outb
 },

206 { "fœ¡_time¡amp", 
B_8
, 
T_FIRST_TIMESTAMP
,

207 0, 
ªno_exŒaù
, 
ªno_ou
, 
utime¡amp_outb
 },

208 { "fœ¡_Áime¡amp", 
B_8
, 
T_FIRST_TIMESTAMP
,

209 0, 
ªno_exŒaù
, 
ªno_ou
, 
outb
 },

210 { "couÁ", 
B_4
, 
T_COUNT
,

211 0, 
ªno_exŒaù
, 
num_ou
, 
outb
 },

212 { "lšk", 
B_1
, 
T_LINK
,

213 0, 
ªno_exŒaù
, 
num_ou
, 
outb
 },

214 { "·št", 
B_1
, 
T_LINK
,

215 0, 
ªno_exŒaù
, 
num_ou
, 
outb
 },

216 { "dœeùiÚ", 
B_1
, 
T_DIRECTION
,

217 0, 
ªno_exŒaù
, 
ªno_ou
, 
outb
 },

218 { "agg»g©e", 
B_4
, 
T_AGGREGATE
,

219 0, 
ªno_exŒaù
, 
num_ou
, 
outb
 },

220 { "wœe_Ën", 
B_4
, 
T_WIRE_LEN
,

221 0, 
ªno_exŒaù
, 
num_ou
, 
outb
 }

224 cÚ¡ 
	gIPSumm¬yDump
::
F›ldR—d”
 
ªno_»ad”s
[] = {

225 { "time¡amp", 
B_8
, 
T_TIMESTAMP
, 
Üd”_ªno
,

226 
ªno_ša
, 
utime¡amp_šb
, 
ªno_šjeù
 },

227 { "Áime¡amp", 
B_8
, 
T_TIMESTAMP
, 
Üd”_ªno
,

228 
ªno_ša
, 
šb
, 
ªno_šjeù
 },

229 { "ts_£c", 
B_4
, 
T_TIMESTAMP_SEC
, 
Üd”_ªno
,

230 
num_ša
, 
šb
, 
ªno_šjeù
 },

231 { "ts_u£c", 
B_4
, 
T_TIMESTAMP_USEC
, 
Üd”_ªno
,

232 
num_ša
, 
šb
, 
ªno_šjeù
 },

233 { "ts_u£c1", 
B_8
, 
T_TIMESTAMP_USEC1
, 
Üd”_ªno
,

234 
num_ša
, 
šb
, 
ªno_šjeù
 },

235 { "fœ¡_time¡amp", 
B_8
, 
T_FIRST_TIMESTAMP
, 
Üd”_ªno
,

236 
ªno_ša
, 
utime¡amp_šb
, 
ªno_šjeù
 },

237 { "fœ¡_Áime¡amp", 
B_8
, 
T_FIRST_TIMESTAMP
, 
Üd”_ªno
,

238 
ªno_ša
, 
šb
, 
ªno_šjeù
 },

239 { "couÁ", 
B_4
, 
T_COUNT
, 
Üd”_ªno
,

240 
num_ša
, 
šb
, 
ªno_šjeù
 },

241 { "lšk", 
B_1
, 
T_LINK
, 
Üd”_ªno
,

242 
ªno_ša
, 
šb
, 
ªno_šjeù
 },

243 { "·št", 
B_1
, 
T_LINK
, 
Üd”_ªno
,

244 
ªno_ša
, 
šb
, 
ªno_šjeù
 },

245 { "dœeùiÚ", 
B_1
, 
T_DIRECTION
, 
Üd”_ªno
,

246 
ªno_ša
, 
šb
, 
ªno_šjeù
 },

247 { "agg»g©e", 
B_4
, 
T_AGGREGATE
, 
Üd”_ªno
,

248 
num_ša
, 
šb
, 
ªno_šjeù
 },

249 { "wœe_Ën", 
B_4
, 
T_WIRE_LEN
, 
Üd”_ªno
,

250 
num_ša
, 
šb
, 
ªno_šjeù
 }

253 cÚ¡ 
	gIPSumm¬yDump
::
F›ldSynÚym
 
ªno_synÚyms
[] = {

269 
	gIPSumm¬yDump_AÂo
::
	$¡©ic_š™Ÿlize
()

271 
usšg
 
Çme¥aû
 
IPSumm¬yDump
;

272 
size_t
 
i
 = 0; i < (
ªno_wr™”s
) / (anno_writers[0]); ++i)

273 
F›ldWr™”
::
	`add
(&
ªno_wr™”s
[
i
]);

274 
size_t
 
i
 = 0; i < (
ªno_»ad”s
) / (anno_readers[0]); ++i)

275 
F›ldR—d”
::
	`add
(&
ªno_»ad”s
[
i
]);

276 
size_t
 
i
 = 0; i < (
ªno_synÚyms
) / (anno_synonyms[0]); ++i)

277 
F›ldSynÚym
::
	`add
(&
ªno_synÚyms
[
i
]);

278 
	}
}

280 
	gIPSumm¬yDump_AÂo
::
	$¡©ic_ş—nup
()

282 
usšg
 
Çme¥aû
 
IPSumm¬yDump
;

283 
size_t
 
i
 = 0; i < (
ªno_wr™”s
) / (anno_writers[0]); ++i)

284 
F›ldWr™”
::
	`»move
(&
ªno_wr™”s
[
i
]);

285 
size_t
 
i
 = 0; i < (
ªno_»ad”s
) / (anno_readers[0]); ++i)

286 
F›ldR—d”
::
	`»move
(&
ªno_»ad”s
[
i
]);

287 
size_t
 
i
 = 0; i < (
ªno_synÚyms
) / (anno_synonyms[0]); ++i)

288 
F›ldSynÚym
::
	`»move
(&
ªno_synÚyms
[
i
]);

289 
	}
}

291 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
IPSumm¬yDump
)

292 
	$ELEMENT_PROVIDES
(
IPSumm¬yDump_AÂo
)

293 
CLICK_ENDDECLS


	@analysis/ipsumdump_anno.hh

1 #iâdeà
CLICK_IPSUMDUMP_ANNO_HH


2 
	#CLICK_IPSUMDUMP_ANNO_HH


	)

3 
	~"sumdumpšfo.hh
"

4 
CLICK_DECLS


6 şas 
	cIPSumm¬yDump_AÂo
 { 
	mpublic
:

7 
¡©ic_š™Ÿlize
();

8 
¡©ic_ş—nup
();

11 
	gCLICK_ENDDECLS


	@analysis/ipsumdump_icmp.cc

21 
	~<şick/cÚfig.h
>

23 
	~"sumdump_icmp.hh
"

24 
	~<şick/·ck‘.hh
>

25 
	~<şick/Çmešfo.hh
>

26 
	~<şickÃt/.h
>

27 
	~<şickÃt/icmp.h
>

28 
	~<şick/cÚå¬£.hh
>

29 
CLICK_DECLS


31 
Çme¥aû
 
	gIPSumm¬yDump
 {

33 ’um { 
	gT_ICMP_TYPE
, 
	gT_ICMP_TYPE_NAME
, 
	gT_ICMP_CODE
, 
	gT_ICMP_CODE_NAME
,

34 
	gT_ICMP_FLOWID
, 
	gT_ICMP_SEQ
, 
	gT_ICMP_NEXTMTU
 };

37 
	gICMP_TYPE_HAVE_FLOW
 = ((1U << 
ICMP_ECHO
è| (1U << 
ICMP_ECHOREPLY
)

38 | (1U << 
ICMP_IREQ
è| (1U << 
ICMP_IREQREPLY
)

39 | (1U << 
ICMP_TSTAMP
è| (1U << 
ICMP_TSTAMPREPLY
))

42 
boŞ
 
icmp_exŒaù
(
Pack‘Desc
& 
d
, cÚ¡ 
F›ldWr™”
 *
f
)

44 
	gŒª¥Üt_Ëngth
 = 
d
.
Œª¥Üt_Ëngth
();

45 
	gf
->
	gu£r_d©a
) {

47 
	#CHECK
(
l
èdØ{ ià(!
d
.
icmph
 || 
Œª¥Üt_Ëngth
 < (l)è 
	`f›ld_missšg
(d, 
IP_PROTO_ICMP
, (l)); } 0)

	)

49 
	gT_ICMP_TYPE
:

50 
T_ICMP_TYPE_NAME
:

51 
CHECK
(1);

52 
	gd
.
	gv
 = 
d
.
icmph
->
icmp_ty³
;

53  
	gŒue
;

55 
	gT_ICMP_CODE
:

56 
T_ICMP_CODE_NAME
:

57 
CHECK
(2);

58 
	gd
.
	gv
 = 
d
.
icmph
->
icmp_code
;

59  
	gŒue
;

61 
	gT_ICMP_FLOWID
:

62 
CHECK
(1);

63 ià(
	gd
.
	gicmph
->
	gicmp_ty³
 >= 32

64 || (
ICMP_TYPE_HAVE_FLOW
 & (1 << 
d
.
icmph
->
icmp_ty³
)) == 0)

65  
çl£
;

66 
CHECK
(6);

67 
	gd
.
	gv
 = 
Áohs
(
»š‹½»t_ÿ¡
<cÚ¡ 
şick_icmp_£qu’ûd
 *>(
d
.
icmph
)->
icmp_id’tif›r
);

68  
	gŒue
;

70 
	gT_ICMP_SEQ
:

71 
CHECK
(1);

72 ià(
	gd
.
	gicmph
->
	gicmp_ty³
 >= 32

73 || (
ICMP_TYPE_HAVE_FLOW
 & (1 << 
d
.
icmph
->
icmp_ty³
)) == 0)

74  
çl£
;

75 
CHECK
(8);

76 
	gd
.
	gv
 = 
Áohs
(
»š‹½»t_ÿ¡
<cÚ¡ 
şick_icmp_£qu’ûd
 *>(
d
.
icmph
)->
icmp_£qu’û
);

77  
	gŒue
;

79 
	gT_ICMP_NEXTMTU
:

80 
CHECK
(2);

81 ià(
	gd
.
	gicmph
->
	gicmp_ty³
 !ğ
ICMP_UNREACH


82 || 
d
.
icmph
->
icmp_code
 !ğ
ICMP_UNREACH_NEEDFRAG
)

83  
çl£
;

84 
CHECK
(8);

85 
	gd
.
	gv
 = 
Áohs
(
»š‹½»t_ÿ¡
<cÚ¡ 
şick_icmp_Ãedäag
 *>(
d
.
icmph
)->
icmp_Ãxtmtu
);

86  
	gŒue
;

88 #undeà
CHECK


91  
çl£
;

95 
icmp_šjeù
(
Pack‘Odesc
& 
d
, cÚ¡ 
F›ldR—d”
 *
f
)

97 ià(!
	gd
.
make_
(
IP_PROTO_ICMP
è|| !d.
make_Œª¥
())

99 ià(
	gd
.
	gp
->
Œª¥Üt_Ëngth
(è< (è(
	gşick_icmp
)

100 && !(
	gd
.
	gp
 = 
d
.
p
->
put
((
şick_icmp
è- d.p->
Œª¥Üt_Ëngth
())))

103 
şick_icmp
 *
	gicmph
 = 
d
.
p
->
icmp_h—d”
();

104 
	gf
->
	gu£r_d©a
) {

105 
	gT_ICMP_TYPE
:

106 
T_ICMP_TYPE_NAME
: {

107 
icmph
->
icmp_ty³
 = 
d
.
v
;

108 
	gd
.
	ghave_icmp_ty³
 = 
Œue
;

109 
	gËn
 = 
şick_icmp_hl
(
d
.
v
);

110 ià(
	gd
.
	gp
->
Œª¥Üt_Ëngth
(è< 
	gËn


111 && !(
	gd
.
	gp
 = 
d
.
p
->
put
(
Ën
 - d.p->
Œª¥Üt_Ëngth
())))

115 
	gT_ICMP_CODE
:

116 
T_ICMP_CODE_NAME
:

117 
icmph
->
icmp_code
 = 
d
.
v
;

118 
	gd
.
	ghave_icmp_code
 = 
Œue
;

120 
	gT_ICMP_FLOWID
:

121 ià(!
d
.
have_icmp_ty³


122 || (
icmph
->
icmp_ty³
 < 32

123 && (
ICMP_TYPE_HAVE_FLOW
 & (1 << 
icmph
->
icmp_ty³
)))) {

124 ià(
d
.
p
->
Œª¥Üt_Ëngth
(è< (è(
şick_icmp_£qu’ûd
)) {

125 ià(!(
d
.
p
 = d.p->
put
((
şick_icmp_£qu’ûd
è- d.p->
Œª¥Üt_Ëngth
())))

127 
	gicmph
 = 
d
.
p
->
icmp_h—d”
();

129 
	g»š‹½»t_ÿ¡
<
	gşick_icmp_£qu’ûd
 *>(
	gicmph
)->
	gicmp_id’tif›r
 = 
htÚs
(
d
.
v
);

132 
	gT_ICMP_SEQ
:

133 ià(!
d
.
have_icmp_ty³


134 || (
icmph
->
icmp_ty³
 < 32

135 && (
ICMP_TYPE_HAVE_FLOW
 & (1 << 
icmph
->
icmp_ty³
)))) {

136 ià(
d
.
p
->
Œª¥Üt_Ëngth
(è< (è(
şick_icmp_£qu’ûd
)) {

137 ià(!(
d
.
p
 = d.p->
put
((
şick_icmp_£qu’ûd
è- d.p->
Œª¥Üt_Ëngth
())))

139 
	gicmph
 = 
d
.
p
->
icmp_h—d”
();

141 
	g»š‹½»t_ÿ¡
<
	gşick_icmp_£qu’ûd
 *>(
	gicmph
)->
	gicmp_£qu’û
 = 
htÚs
(
d
.
v
);

144 
	gT_ICMP_NEXTMTU
:

145 ià((!
d
.
have_icmp_ty³
 || 
icmph
->
icmp_ty³
 =ğ
ICMP_UNREACH
)

146 && (!
d
.
have_icmp_code
 || 
icmph
->
icmp_code
 =ğ
ICMP_UNREACH_NEEDFRAG
)) {

147 ià(
d
.
p
->
Œª¥Üt_Ëngth
(è< (è(
şick_icmp_Ãedäag
)) {

148 ià(!(
d
.
p
 = d.p->
put
((
şick_icmp_Ãedäag
è- d.p->
Œª¥Üt_Ëngth
())))

150 
	gicmph
 = 
d
.
p
->
icmp_h—d”
();

152 
	g»š‹½»t_ÿ¡
<
	gşick_icmp_Ãedäag
 *>(
	gicmph
)->
	gicmp_Ãxtmtu
 = 
htÚs
(
d
.
v
);

158 
icmp_ou
(cÚ¡ 
Pack‘Desc
 &
d
, cÚ¡ 
F›ldWr™”
 *
f
)

160 
	gf
->
	gu£r_d©a
) {

161 
	gT_ICMP_TYPE_NAME
:

162 ià(
SŒšg
 
s
 = 
NameInfo
::
»vqu”y_št
(NameInfo::
T_ICMP_TYPE
, 
d
.
e
, d.
v
))

163 *
	gd
.
	g§
 << 
	gs
;

165 *
	gd
.
	g§
 << d.
	gv
;

167 
	gT_ICMP_CODE_NAME
:

168 ià(
SŒšg
 
s
 = 
NameInfo
::
»vqu”y_št
(NameInfo::
T_ICMP_CODE
 + 
d
.
icmph
->
icmp_ty³
, d.
e
, d.
v
))

169 *
	gd
.
	g§
 << 
	gs
;

171 *
	gd
.
	g§
 << d.
	gv
;

176 
boŞ
 
icmp_ša
(
Pack‘Odesc
 &
d
, cÚ¡ 
SŒšg
 &
¡r
, cÚ¡ 
F›ldR—d”
 *
f
)

178 
	gf
->
	gu£r_d©a
) {

179 
	gT_ICMP_TYPE
:

180 
T_ICMP_TYPE_NAME
:

181 ià(
NameInfo
::
qu”y_št
(NameInfo::
T_ICMP_TYPE
, 
d
.
e
, 
¡r
, &d.
v
)

182 && 
	gd
.
	gv
 < 256)

183  
	gŒue
;

185 
	gT_ICMP_CODE
:

186 
T_ICMP_CODE_NAME
:

187 ià(
d
.
have_icmp_ty³
) {

188 ià(
NameInfo
::
qu”y_št
(NameInfo::
T_ICMP_CODE
 + 
d
.
p
->
icmp_h—d”
()->
icmp_ty³
, d.
e
, 
¡r
, &d.
v
)

189 && 
	gd
.
	gv
 < 256)

190  
	gŒue
;

192 ià(
IÁArg
().
·r£
(
¡r
, 
d
.
v
è&& 
	gd
.
	gv
 < 256)

193  
	gŒue
;

197  
	gçl£
;

200 cÚ¡ 
F›ldWr™”
 
	gicmp_wr™”s
[] = {

201 { "icmp_ty³", 
B_1
, 
T_ICMP_TYPE
,

202 
_´•¬e
, 
icmp_exŒaù
, 
num_ou
, 
outb
 },

203 { "icmp_code", 
B_1
, 
T_ICMP_CODE
,

204 
_´•¬e
, 
icmp_exŒaù
, 
num_ou
, 
outb
 },

205 { "icmp_ty³_Çme", 
B_1
, 
T_ICMP_TYPE_NAME
,

206 
_´•¬e
, 
icmp_exŒaù
, 
icmp_ou
, 
outb
 },

207 { "icmp_code_Çme", 
B_1
, 
T_ICMP_CODE_NAME
,

208 
_´•¬e
, 
icmp_exŒaù
, 
icmp_ou
, 
outb
 },

209 { "icmp_æowid", 
B_2
, 
T_ICMP_FLOWID
,

210 
_´•¬e
, 
icmp_exŒaù
, 
num_ou
, 
outb
 },

211 { "icmp_£q", 
B_2
, 
T_ICMP_SEQ
,

212 
_´•¬e
, 
icmp_exŒaù
, 
num_ou
, 
outb
 },

213 { "icmp_Ãxtmtu", 
B_2
, 
T_ICMP_NEXTMTU
,

214 
_´•¬e
, 
icmp_exŒaù
, 
num_ou
, 
outb
 }

217 cÚ¡ 
F›ldR—d”
 
	gicmp_»ad”s
[] = {

218 { "icmp_ty³", 
B_1
, 
T_ICMP_TYPE
, 
Üd”_Œª¥
,

219 
icmp_ša
, 
šb
, 
icmp_šjeù
 },

220 { "icmp_code", 
B_1
, 
T_ICMP_CODE
, 
Üd”_Œª¥
 + 1,

221 
icmp_ša
, 
šb
, 
icmp_šjeù
 },

222 { "icmp_ty³_Çme", 
B_1
, 
T_ICMP_TYPE_NAME
, 
Üd”_Œª¥
,

223 
icmp_ša
, 
šb
, 
icmp_šjeù
 },

224 { "icmp_code_Çme", 
B_1
, 
T_ICMP_CODE_NAME
, 
Üd”_Œª¥
 + 1,

225 
icmp_ša
, 
šb
, 
icmp_šjeù
 },

226 { "icmp_æowid", 
B_2
, 
T_ICMP_FLOWID
, 
Üd”_Œª¥
 + 2,

227 
num_ša
, 
šb
, 
icmp_šjeù
 },

228 { "icmp_£q", 
B_2
, 
T_ICMP_SEQ
, 
Üd”_Œª¥
 + 2,

229 
num_ša
, 
šb
, 
icmp_šjeù
 },

230 { "icmp_Ãxtmtu", 
B_2
, 
T_ICMP_NEXTMTU
, 
Üd”_Œª¥
 + 2,

231 
num_ša
, 
šb
, 
icmp_šjeù
 }

236 
	gIPSumm¬yDump_ICMP
::
	$¡©ic_š™Ÿlize
()

238 
usšg
 
Çme¥aû
 
IPSumm¬yDump
;

239 
size_t
 
i
 = 0; i < (
icmp_wr™”s
) / (icmp_writers[0]); ++i)

240 
F›ldWr™”
::
	`add
(&
icmp_wr™”s
[
i
]);

241 
size_t
 
i
 = 0; i < (
icmp_»ad”s
) / (icmp_readers[0]); ++i)

242 
F›ldR—d”
::
	`add
(&
icmp_»ad”s
[
i
]);

243 
	}
}

245 
	gIPSumm¬yDump_ICMP
::
	$¡©ic_ş—nup
()

247 
usšg
 
Çme¥aû
 
IPSumm¬yDump
;

248 
size_t
 
i
 = 0; i < (
icmp_wr™”s
) / (icmp_writers[0]); ++i)

249 
F›ldWr™”
::
	`»move
(&
icmp_wr™”s
[
i
]);

250 
size_t
 
i
 = 0; i < (
icmp_»ad”s
) / (icmp_readers[0]); ++i)

251 
F›ldR—d”
::
	`»move
(&
icmp_»ad”s
[
i
]);

252 
	}
}

254 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
IPSumm¬yDump
)

255 
	$ELEMENT_PROVIDES
(
IPSumm¬yDump_ICMP
)

256 
CLICK_ENDDECLS


	@analysis/ipsumdump_icmp.hh

1 #iâdeà
CLICK_IPSUMDUMP_ICMP_HH


2 
	#CLICK_IPSUMDUMP_ICMP_HH


	)

3 
	~"sumdumpšfo.hh
"

4 
CLICK_DECLS


6 şas 
	cIPSumm¬yDump_ICMP
 { 
	mpublic
:

7 
¡©ic_š™Ÿlize
();

8 
¡©ic_ş—nup
();

11 
	gCLICK_ENDDECLS


	@analysis/ipsumdump_ip.cc

20 
	~<şick/cÚfig.h
>

22 
	~"sumdump_.hh
"

23 
	~<şick/·ck‘.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
	~<şick/md5.h
>

26 
	~<şickÃt/.h
>

27 
	~<şickÃt/tı.h
>

28 
	~<şickÃt/udp.h
>

29 
	~<şick/¬gs.hh
>

30 
	~<şick/æowid.hh
>

31 
CLICK_DECLS


33 ’um { 
	mT_IP_SRC
, 
	mT_IP_DST
, 
	mT_IP_TOS
, 
	mT_IP_TTL
, 
	mT_IP_FRAG
, 
	mT_IP_FRAGOFF
,

34 
	mT_IP_ID
, 
	mT_IP_SUM
, 
	mT_IP_PROTO
, 
	mT_IP_OPT
, 
	mT_IP_LEN
, 
	mT_IP_CAPTURE_LEN
,

35 
	mT_SPORT
, 
	mT_DPORT
, 
	mT_IP_HL
, 
	mT_IP_DSCP
, 
	mT_IP_ECN
 };

37 
Çme¥aû
 
	gIPSumm¬yDump
 {

39 
boŞ
 
_exŒaù
(
Pack‘Desc
& 
d
, cÚ¡ 
F›ldWr™”
 *
f
)

41 
ušt32_t
 
	gÃtwÜk_Ëngth
 = 
d
.
ÃtwÜk_Ëngth
();

42 
	gf
->
	gu£r_d©a
) {

45 
	#CHECK
(
l
èdØ{ ià(!
d
.
h
 || 
ÃtwÜk_Ëngth
 < (l)è 
	`f›ld_missšg
(d, 
MISSING_IP
, (l)); } 0)

	)

46 
	gT_IP_SRC
:

47 
CHECK
(16);

48 
	gd
.
	gv
 = 
d
.
h
->
_¤c
.
s_addr
;

49  
	gŒue
;

50 
	gT_IP_DST
:

51 
CHECK
(20);

52 
	gd
.
	gv
 = 
d
.
h
->
_d¡
.
s_addr
;

53  
	gŒue
;

54 
	gT_IP_TOS
:

55 
CHECK
(2);

56 
	gd
.
	gv
 = 
d
.
h
->
_tos
;

57  
	gŒue
;

58 
	gT_IP_DSCP
:

59 
CHECK
(2);

60 
	gd
.
	gv
 = 
d
.
h
->
_tos
 >> 2;

61  
	gŒue
;

62 
	gT_IP_ECN
:

63 
CHECK
(2);

64 
	gd
.
	gv
 = 
d
.
h
->
_tos
 & 
IP_ECNMASK
;

65  
	gŒue
;

66 
	gT_IP_TTL
:

67 
CHECK
(9);

68 
	gd
.
	gv
 = 
d
.
h
->
_‰l
;

69  
	gŒue
;

70 
	gT_IP_FRAG
:

71 
CHECK
(8);

72 ià(
IP_ISFRAG
(
d
.
h
))

73 
	gd
.
	gv
 = (
IP_FIRSTFRAG
(
d
.
h
) ? 'F' : 'f');

75 
	gd
.
	gv
 = (
d
.
h
->
_off
 & 
htÚs
(
IP_DF
) ? '!' : '.');

76  
	gŒue
;

77 
	gT_IP_FRAGOFF
:

78 
CHECK
(8);

79 
	gd
.
	gv
 = 
Áohs
(
d
.
h
->
_off
);

80  
	gŒue
;

81 
	gT_IP_ID
:

82 
CHECK
(6);

83 
	gd
.
	gv
 = 
Áohs
(
d
.
h
->
_id
);

84  
	gŒue
;

85 
	gT_IP_SUM
:

86 
CHECK
(12);

87 
	gd
.
	gv
 = 
Áohs
(
d
.
h
->
_sum
);

88  
	gŒue
;

89 
	gT_IP_PROTO
:

90 
CHECK
(10);

91 
	gd
.
	gv
 = 
d
.
h
->
_p
;

92  
	gŒue
;

93 
	gT_IP_OPT
:

94 ià(!
d
.
h
 || (d.h->
_hl
 > 5 && 
ÃtwÜk_Ëngth
 < (
ušt32_t
)(d.iph->ip_hl << 2)))

95  
f›ld_missšg
(
d
, 
MISSING_IP
, (d.
h
 ? d.h->
_hl
 << 2 : 20));

96 ià(
	gd
.
	gh
->
	g_hl
 <= 5)

97 
d
.
v±r
[0] = d.vptr[1] = 0;

99 
	gd
.
	gv±r
[0] = (cÚ¡ 
ušt8_t
 *è(
d
.
h
 + 1);

100 
	gd
.
	gv±r
[1] = 
d
.
v±r
[0] + (d.
h
->
_hl
 << 2è- (
şick_
);

102  
	gŒue
;

103 
	gT_IP_LEN
:

104 ià(
d
.
h
)

105 
d
.
v
 = 
Áohs
(d.
h
->
_Ën
);

107 
	gd
.
	gv
 = 
d
.
Ëngth
();

108 ià(
	gd
.
	gfÜû_exŒa_Ëngth
)

109 
	gd
.
	gv
 +ğ
EXTRA_LENGTH_ANNO
(
d
.
p
);

110  
	gŒue
;

111 
	gT_IP_HL
:

112 
CHECK
(1);

113 
	gd
.
	gv
 = 
d
.
h
->
_hl
 << 2;

114  
	gŒue
;

115 
	gT_IP_CAPTURE_LEN
: {

116 
ušt32_t
 
®low_Ën
 = (
d
.
h
 ? 
ÃtwÜk_Ëngth
 : d.
Ëngth
());

117 
ušt32_t
 
	gËn
 = (
d
.
h
 ? 
Áohs
(d.h->
_Ën
è: 
®low_Ën
);

118 
	gd
.
	gv
 = (
Ën
 < 
®low_Ën
 ?†en :‡llow_len);

119  
	gŒue
;

121 #undeà
CHECK


124  
çl£
;

128 
šlše
 
boŞ
 
_´Ùo_has_udp_pÜts
(
_p
)

130  
	g_p
 =ğ
IP_PROTO_TCP
 || 
_p
 =ğ
IP_PROTO_UDP


131 || 
_p
 =ğ
IP_PROTO_DCCP
 || ip_°=ğ
IP_PROTO_UDPLITE
;

134 
_šjeù
(
Pack‘Odesc
& 
d
, cÚ¡ 
F›ldR—d”
 *
f
)

136 ià(!
	gd
.
make_
(0))

139 
şick_
 *
	gh
 = 
d
.
p
->
_h—d”
();

140 
	gf
->
	gu£r_d©a
) {

142 
	gT_IP_SRC
:

143 
h
->
_¤c
.
s_addr
 = 
d
.
v
;

145 
	gT_IP_DST
:

146 
h
->
_d¡
.
s_addr
 = 
d
.
v
;

148 
	gT_IP_TOS
:

149 
h
->
_tos
 = 
d
.
v
;

151 
	gT_IP_DSCP
:

152 
h
->
_tos
 = (h->_to & 
IP_ECNMASK
è| ((
d
.
v
 << 2è& 
IP_DSCPMASK
);

154 
	gT_IP_ECN
:

155 
h
->
_tos
 = (h->_to & 
IP_DSCPMASK
è| (
d
.
v
 & 
IP_ECNMASK
);

157 
	gT_IP_TTL
:

158 
h
->
_‰l
 = 
d
.
v
;

160 
	gT_IP_FRAG
:

161 
T_IP_FRAGOFF
:

162 
h
->
_off
 = 
htÚs
(
d
.
v
);

164 
	gT_IP_ID
:

165 
h
->
_id
 = 
htÚs
(
d
.
v
);

167 
	gT_IP_SUM
:

168 
h
->
_sum
 = 
htÚs
(
d
.
v
);

170 
	gT_IP_PROTO
:

171 
h
->
_p
 = 
d
.
v
;

173 
	gT_IP_OPT
: {

174 
d
.
have__hl
 = 
Œue
;

175 ià(!
	gd
.
	gv±r
[0])

177 
	gŞ’
 = 
d
.
v±r
[1] - d.vptr[0];

178 
	g_hl
 = ((
şick_
è+ 
Ş’
 + 3) & ~3;

179 ià(
	gd
.
	gp
->
ÃtwÜk_Ëngth
(è< 
	g_hl
) {

180 ià(!(
	gd
.
	gp
 = 
d
.
p
->
put
(
_hl
 - d.p->
ÃtwÜk_Ëngth
())))

182 
	gh
 = 
d
.
p
->
_h—d”
();

184 ià(
	g_hl
 > (è(
	gh
->ip_hl << 2)) {

185 
	gd
.
	gp
->
£t__h—d”
(
h
, 
_hl
);

186 
	gh
->
	g_hl
 = 
_hl
 >> 2;

188 
memıy
(
d
.
p
->
ÃtwÜk_h—d”
(è+ (
şick_
), d.
v±r
[0], 
Ş’
);

189 
mem£t
(
d
.
p
->
ÃtwÜk_h—d”
(è+ (
şick_
è+ 
Ş’
,

190 
IPOPT_EOL
, 
_hl
 - 
Ş’
);

193 
	gT_IP_HL
:

194 
d
.
have__hl
 = 
Œue
;

195 
	gd
.
	gv
 = (
d
.
v
 + 3) & ~3;

196 ià((è
	gd
.
	gv
 > (è(
	gh
->
	g_hl
 << 2)) {

197 
	gmÜe
 = 
d
.
v
 - (
h
->
_hl
 << 2);

198 ià(!(
	gd
.
	gp
 = 
d
.
p
->
put
(
mÜe
)))

200 
	gh
 = 
d
.
p
->
_h—d”
();

201 
	gd
.
	gp
->
£t__h—d”
(
h
, 
d
.
v
);

202 
mem£t
(
d
.
p
->
Œª¥Üt_h—d”
(è- 
mÜe
, 
IPOPT_EOL
, more);

204 
	gh
->
	g_hl
 = 
d
.
v
 >> 2;

206 
	gT_IP_LEN
:

207 
d
.
wªt_Ën
 = d.
p
->
ÃtwÜk_h—d”_off£t
(è+ d.
v
;

209 
	gT_IP_CAPTURE_LEN
:

215 
_ou
(cÚ¡ 
Pack‘Desc
& 
d
, cÚ¡ 
F›ldWr™”
 *
f
)

217 
	gf
->
	gu£r_d©a
) {

218 
	gT_IP_SRC
:

219 
T_IP_DST
:

220 *
d
.
§
 << 
IPAdd»ss
(d.
v
);

222 
	gT_IP_FRAG
:

223 *
d
.
§
 << (èd.
v
;

225 
	gT_IP_FRAGOFF
:

226 *
d
.
§
 << ((d.
v
 & 
IP_OFFMASK
) << 3);

227 ià(
	gd
.
	gv
 & 
	gIP_MF
)

228 *
	gd
.
	g§
 << '+';

229 ià(
	gd
.
	gv
 & 
	gIP_DF
)

230 *
	gd
.
	g§
 << '!';

232 
	gT_IP_PROTO
:

233 
d
.
v
) {

234 
IP_PROTO_TCP
: *
d
.
§
 << 'T'; ;

235 
	gIP_PROTO_UDP
: *
d
.
§
 << 'U'; ;

236 
	gIP_PROTO_ICMP
: *
d
.
§
 << 'I'; ;

237 : *
d
.
§
 << d.
v
; ;

240 
	gT_IP_ECN
:

241 
d
.
v
) {

242 
IP_ECN_NOT_ECT
: *
d
.
§
 << "no"; ;

243 
	gIP_ECN_ECT1
: *
d
.
§
 << "ect1"; ;

244 
	gIP_ECN_ECT2
: *
d
.
§
 << "ect2"; ;

245 
	gIP_ECN_CE
: *
d
.
§
 << "ce"; ;

248 
	gT_IP_OPT
:

249 ià(!
d
.
v±r
[0])

250 *
d
.
§
 << '.';

252 
uÅ¬£__İt
(*
d
.
§
, d.
v±r
[0], d.v±r[1] - d.v±r[0], 
DO_IPOPT_ALL_NOPAD
);

257 
boŞ
 
_ša
(
Pack‘Odesc
& 
d
, cÚ¡ 
SŒšg
 &
s
, cÚ¡ 
F›ldR—d”
 *
f
)

259 
	gf
->
	gu£r_d©a
) {

260 
	gT_IP_SRC
:

261 
T_IP_DST
: {

262 
IPAdd»ss
 
a
;

263 ià(
IPAdd»ssArg
().
·r£
(
s
, 
a
, 
d
.
e
)) {

264 
	gd
.
	gv
 = 
a
.
addr
();

265  
	gŒue
;

269 
	gT_IP_FRAG
:

270 
T_IP_FRAGOFF
: {

271 ià(
s
.
Ëngth
() == 1) {

272 ià(
s
[0] == '.') {

273 
d
.
v
 = 0;

274  
	gŒue
;

275 } ià(
	gs
[0] == '!') {

276 
d
.
v
 = 
IP_DF
;

277  
	gŒue
;

278 } ià(
	gs
[0] == 'F') {

279 
d
.
v
 = 
IP_MF
;

280  
	gŒue
;

281 } ià(
	gs
[0] == 'f') {

282 
d
.
v
 = 100;

283  
	gŒue
;

286 
	gd
.
	gv
 = 0;

287 cÚ¡ *
	gÃw_’d
 = 
ı_š‹g”
(
s
.
begš
(), s.
’d
(), 0, &
d
.
v
);

288 ià(
	gd
.
	gmšÜ_v”siÚ
 > 0)

289 
	gd
.
	gv
 >>= 3;

290 ; 
	gÃw_’d
 !ğ
s
.
’d
(); ++new_end)

291 ià(*
	gÃw_’d
 == '!')

292 
d
.
v
 |ğ
IP_DF
;

293 ià(*
	gÃw_’d
 == '+')

294 
d
.
v
 |ğ
IP_MF
;

297 ià(
	gÃw_’d
 =ğ
s
.
’d
(è&& s.
Ëngth
())

298  
Œue
;

301 
	gT_IP_PROTO
:

302 ià(
s
.
equ®s
("T", 1)) {

303 
	gd
.
	gv
 = 
IP_PROTO_TCP
;

304  
	gŒue
;

305 } ià(
	gs
.
equ®s
("U", 1)) {

306 
	gd
.
	gv
 = 
IP_PROTO_UDP
;

307  
	gŒue
;

308 } ià(
	gs
.
equ®s
("I", 1)) {

309 
	gd
.
	gv
 = 
IP_PROTO_ICMP
;

310  
	gŒue
;

311 } ià(
IÁArg
().
·r£
(
s
, 
d
.
v
è&& 
	gd
.
	gv
 < 256)

312  
	gŒue
;

314 
	gT_IP_ECN
:

315 ià(
s
.
Ëngth
() == 1 && s[0] >= '0' && s[0] <= '3') {

316 
d
.
v
 = 
s
[0] - '0';

317  
	gŒue
;

318 } ià(
	gs
.
equ®s
("no", 2) || s.equals("-", 1)) {

319 
	gd
.
	gv
 = 
IP_ECN_NOT_ECT
;

320  
	gŒue
;

321 } ià(
	gs
.
equ®s
("ect1", 4) || s.equals("ECT(1)", 6)) {

322 
	gd
.
	gv
 = 
IP_ECN_ECT1
;

323  
	gŒue
;

324 } ià(
	gs
.
equ®s
("ect2", 4) || s.equals("ECT(0)", 6)) {

325 
	gd
.
	gv
 = 
IP_ECN_ECT2
;

326  
	gŒue
;

327 } ià(
	gs
.
equ®s
("ce", 2) || s.equals("CE", 2)) {

328 
	gd
.
	gv
 = 
IP_ECN_CE
;

329  
	gŒue
;

333 
	gT_IP_OPT
:

334 ià(!
d
.
v±r
[0])

335 *
d
.
§
 << '.';

337 
uÅ¬£__İt
(*
d
.
§
, d.
v±r
[0], d.v±r[1] - d.v±r[0], 
DO_IPOPT_ALL_NOPAD
);

341  
	gçl£
;

344 
_outb
(cÚ¡ 
Pack‘Desc
& 
d
, 
boŞ
 
ok
, cÚ¡ 
F›ldWr™”
 *
f
)

346 ià(
	gf
->
	gu£r_d©a
 =ğ
T_IP_OPT
) {

347 ià(!
ok
 || !
d
.
v±r
[0])

348 *
d
.
§
 << '\0';

350 
uÅ¬£__İt_bš¬y
(*
d
.
§
, d.
v±r
[0], d.v±r[1] - d.v±r[0], 
DO_IPOPT_ALL
);

354 cÚ¡ 
ušt8_t
* 
_šb
(
Pack‘Odesc
& 
d
, cÚ¡ ušt8_ˆ*
s
, cÚ¡ ušt8_ˆ*
’ds
, cÚ¡ 
F›ldR—d”
 *
f
)

356 ià(
	gf
->
	gu£r_d©a
 =ğ
T_IP_OPT
 && 
s
 + s[0] + 1 <ğ
’ds
) {

357 
d
.
v±r
[0] = 
s
 + 1;

358 
	gd
.
	gv±r
[1] = 
d
.
v±r
[0] + 
s
[0];

359  
	gs
 + s[0] + 1;

361  
	g’ds
;

365 
boŞ
 
Œª¥Üt_exŒaù
(
Pack‘Desc
& 
d
, cÚ¡ 
F›ldWr™”
 *
f
)

367 cÚ¡ 
Pack‘
 *
	gp
 = 
d
.
p
;

368 
	gf
->
	gu£r_d©a
) {

370 
	gT_SPORT
:

371 
T_DPORT
: {

372 
boŞ
 
dpÜt
 = (
f
->
u£r_d©a
 =ğ
T_DPORT
);

373 ià(
	gd
.
	gh


374 && 
	gd
.
ÃtwÜk_Ëngth
(è> (
	gušt32_t
è(d.
	gh
->
	g_hl
 << 2)

375 && 
IP_FIRSTFRAG
(
d
.
h
)

376 && 
_´Ùo_has_udp_pÜts
(
d
.
h
->
_p
)

377 && 
	gd
.
Œª¥Üt_Ëngth
(è>ğ(
dpÜt
 ? 4 : 2)) {

378 cÚ¡ 
şick_udp
 *
udph
 = 
p
->
udp_h—d”
();

379 
	gd
.
	gv
 = 
Áohs
(
dpÜt
 ? 
udph
->
uh_dpÜt
 : udph->
uh_¥Üt
);

380  
	gŒue
;

382  
f›ld_missšg
(
d
, 
IP_PROTO_TCP_OR_UDP
, 
dpÜt
 ? 4 : 2);

385  
	gçl£
;

388 
Œª¥Üt_šjeù
(
Pack‘Odesc
& 
d
, cÚ¡ 
F›ldR—d”
 *
f
)

390 ià(!
	gd
.
make_
(0è|| !d.
make_Œª¥
())

392 
şick_
 *
	gh
 = 
d
.
p
->
_h—d”
();

393 ià(
	gh
->
	g_p
 && !
_´Ùo_has_udp_pÜts
(
h
->
_p
))

396 
	gf
->
	gu£r_d©a
) {

398 
	gT_SPORT
:

399 
d
.
p
->
udp_h—d”
()->
uh_¥Üt
 = 
htÚs
(d.
v
);

401 
	gT_DPORT
:

402 
d
.
p
->
udp_h—d”
()->
uh_dpÜt
 = 
htÚs
(d.
v
);

408 
	#U
 
DO_IPOPT_UNKNOWN


	)

409 
	g_İt_mask_m­pšg
[] = {

410 
DO_IPOPT_PADDING
, DO_IPOPT_PADDING,

411 
U
, U, U, U, U,

412 
DO_IPOPT_ROUTE
,

413 
U
, U, U, U, U, U, U, U, U, U, U, U, U,

414 
U
, U, U, U, U, U, U, U, U, U,

415 
U
, U, U, U, U, U, U, U, U, U,

416 
U
, U, U, U, U, U, U, U, U, U,

417 
U
, U, U, U, U, U, U, U, U, U,

418 
U
, U, U, U, U, U, U,

419 
DO_IPOPT_TS
, 
U
, U,

420 
U
, U, U, U, U, U, U, U, U, U,

421 
U
, U, U, U, U, U, U, U, U, U,

422 
U
, U, U, U, U, U, U, U, U, U,

423 
U
, U, U, U, U, U, U, U, U, U,

424 
U
, U, U, U, U, U, U, U, U, U,

425 
U
, U, U, U, U, U, U, U, U,

426 
DO_IPOPT_UNKNOWN
, 
DO_IPOPT_ROUTE
,

427 
U
, U, U, U,

428 
DO_IPOPT_UNKNOWN
, 
DO_IPOPT_ROUTE
,

429 
U
, U, U,

430 
U
, U, U, U, U, U, U,

431 
DO_IPOPT_UNKNOWN


433 #undeà
U


435 
uÅ¬£__İt
(
SŒšgAccum
& 
§
, cÚ¡ 
ušt8_t
* 
İt
, 
İt_Ën
, 
mask
)

437 
	gš™Ÿl_§_Ën
 = 
§
.
Ëngth
();

438 cÚ¡ 
ušt8_t
 *
	g’d_İt
 = 
İt
 + 
İt_Ën
;

439 cÚ¡ *
	g£p
 = "";

441 
	gİt
 < 
	g’d_İt
)

442 *
	gİt
) {

443 
	gIPOPT_EOL
:

444 ià(
mask
 & 
DO_IPOPT_PADDING
)

445 
§
 << 
£p
 << "eol";

446 
	gdÚe
;

447 
	gIPOPT_NOP
:

448 ià(
mask
 & 
DO_IPOPT_PADDING
) {

449 
§
 << 
£p
 << "nop";

450 
	g£p
 = ";";

452 
	gİt
++;

454 
	gIPOPT_RR
:

455 ià(
İt
 + o±[1] > 
’d_İt
 || opt[1] < 3 || opt[2] < 4)

456 
bad_İt
;

457 ià(!(
	gmask
 & 
	gDO_IPOPT_ROUTE
))

458 
	gunknown
;

459 
	g§
 << 
	g£p
 << "rr";

460 
	g´št_rou‹
;

461 
	gIPOPT_LSRR
:

462 ià(
İt
 + o±[1] > 
’d_İt
 || opt[1] < 3 || opt[2] < 4)

463 
bad_İt
;

464 ià(!(
	gmask
 & 
	gDO_IPOPT_ROUTE
))

465 
	gunknown
;

466 
	g§
 << 
	g£p
 << "lsrr";

467 
	g´št_rou‹
;

468 
	gIPOPT_SSRR
:

469 ià(
İt
 + o±[1] > 
’d_İt
 || opt[1] < 3 || opt[2] < 4)

470 
bad_İt
;

471 ià(!(
	gmask
 & 
	gDO_IPOPT_ROUTE
))

472 
	gunknown
;

473 
	g§
 << 
	g£p
 << "ssrr";

474 
	g´št_rou‹
;

475 
	g´št_rou‹
: {

476 cÚ¡ 
ušt8_t
 *
o
 = 
İt
 + 3, *
	gŞ
 = o± + o±[1], *
	gİ
 = opt + opt[2] - 1;

477 
	g£p
 = "";

478 
	g§
 << '{';

479 ; 
	go
 + 4 <ğ
Ş
; o += 4) {

480 ià(
o
 =ğ
İ
) {

481 ià(
İt
[0] =ğ
IPOPT_RR
)

483 
	g£p
 = "^";

485 
	g§
 << 
	g£p
 << ()
	go
[0] << '.' << ()o[1] << '.' << ()o[2] << '.' << ()o[3];

486 
	g£p
 = ",";

488 ià(
	go
 =ğ
Ş
 && 
o
 =ğ
İ
 && 
İt
[0] !ğ
IPOPT_RR
)

489 
§
 << '^';

490 
	g§
 << '}';

491 ià(
	go
 + 4 <ğ
Ş
 && 
o
 =ğ
İ
 && 
İt
[0] =ğ
IPOPT_RR
)

492 
§
 << '+' << (
Ş
 - 
o
) / 4;

493 
	gİt
 = 
Ş
;

494 
	g£p
 = ";";

497 
	gIPOPT_TS
: {

498 ià(
İt
 + o±[1] > 
’d_İt
 || opt[1] < 4 || opt[2] < 5)

499 
bad_İt
;

500 cÚ¡ 
ušt8_t
 *
	go
 = 
İt
 + 4, *
	gŞ
 = o± + o±[1], *
	gİ
 = opt + opt[2] - 1;

501 
	gæag
 = 
İt
[3] & 0xF;

502 
	gsize
 = (
æag
 >= 1 && flag <= 3 ? 8 : 4);

503 
	g§
 << 
	g£p
 << "ts";

504 ià(
	gæag
 == 1)

505 
§
 << ".ip";

506 ià(
	gæag
 == 3)

507 
§
 << ".preip";

508 ià(
	gæag
 != 0)

509 
§
 << "." << 
æag
;

510 
	g§
 << '{';

511 
	g£p
 = "";

512 ; 
	go
 + 
	gsize
 <ğ
Ş
; o += 4) {

513 ià(
o
 =ğ
İ
) {

514 ià(
æag
 != 3)

516 
	g£p
 = "^";

518 ià(
	gæag
 != 0) {

519 
§
 << 
£p
 << ()
o
[0] << '.' << ()o[1] << '.' << ()o[2] << '.' << ()o[3] << '=';

520 
	go
 += 4;

522 
	g§
 << 
	g£p
;

523 ià(
	gæag
 =ğ3 && 
o
 > 
İ
)

524 
§
.
pİ_back
();

526 
ušt32_t
 
	gv
 = (
o
[0] << 24) | (o[1] << 16) | (o[2] << 8) | o[3];

527 ià(
	gv
 & 0x80000000U)

528 
	g§
 << '!';

529 
	g§
 << (
	gv
 & 0x7FFFFFFFU);

531 
	g£p
 = ",";

533 ià(
	go
 =ğ
Ş
 && 
o
 =ğ
İ
)

534 
§
 << '^';

535 
	g§
 << '}';

536 ià(
	go
 + 
	gsize
 <ğ
Ş
 && 
o
 =ğ
İ
)

537 
§
 << '+' << (
Ş
 - 
o
è/ 
size
;

538 ià(
	gİt
[3] & 0xF0)

539 
	g§
 << '+' << '+' << (
	gİt
[3] >> 4);

540 
	gİt
 = 
Ş
;

541 
	g£p
 = ";";

545 ià(
İt
 + o±[1] > 
’d_İt
 || opt[1] < 2)

546 
bad_İt
;

547 ià(!(
	gmask
 & 
	gDO_IPOPT_UNKNOWN
))

548 
	gunknown
;

549 
	g§
 << 
	g£p
 << ()(
	gİt
[0]);

550 cÚ¡ 
ušt8_t
 *
	g’d_this_İt
 = 
İt
 + opt[1];

551 
	gİt_£p
 = '=';

552 
	gİt
 +ğ2; o± < 
	g’d_this_İt
; opt++) {

553 
	g§
 << 
	gİt_£p
 << ()(*
	gİt
);

554 
	gİt_£p
 = ':';

556 
	g£p
 = ";";

559 
	gunknown
:

560 
İt
 += (opt[1] >= 2 ? opt[1] : 128);

564 
	gdÚe
:

565 ià(
§
.
Ëngth
(è=ğ
š™Ÿl_§_Ën
)

566 
§
 << '.';

569 
	gbad_İt
:

570 
§
.
£t_Ëngth
(
š™Ÿl_§_Ën
);

571 
	g§
 << '?';

574 
uÅ¬£__İt
(
SŒšgAccum
& 
§
, cÚ¡ 
şick_
* 
h
, 
mask
)

576 
uÅ¬£__İt
(
§
, 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
 *>(
h
 + 1), (h->
_hl
 << 2è- (
şick_
), 
mask
);

579 
uÅ¬£__İt_bš¬y
(
SŒšgAccum
& 
§
, cÚ¡ 
ušt8_t
 *
İt
, 
İt_Ën
, 
mask
)

581 ià(
	gmask
 =ğ()
DO_IPOPT_ALL
) {

583 
§
.
­³nd
(()
İt_Ën
);

584 
	g§
.
­³nd
(
İt
, 
İt_Ën
);

587 cÚ¡ 
ušt8_t
 *
	g’d_İt
 = 
İt
 + 
İt_Ën
;

588 
	gš™Ÿl_§_Ën
 = 
§
.
Ëngth
();

589 
	g§
.
­³nd
('\0');

591 
	gİt
 < 
	g’d_İt
) {

593 ià(*
	gİt
 =ğ
IPOPT_EOL
) {

594 ià(
mask
 & 
DO_IPOPT_PADDING
)

595 
§
.
­³nd
(
İt
, 1);

596 
	gdÚe
;

597 } ià(*
	gİt
 =ğ
IPOPT_NOP
) {

598 ià(
mask
 & 
DO_IPOPT_PADDING
)

599 
§
.
­³nd
(
İt
, 1);

600 
	gİt
++;

605 ià(
	gİt
[1] < 2 || o± + o±[1] > 
	g’d_İt
)

608 
	gthis_cÚ‹Á
 = (*
İt
 > 
IPOPT_RA
 ? ()
DO_IPOPT_UNKNOWN
 : 
_İt_mask_m­pšg
[*opt]);

609 ià(
	gmask
 & 
	gthis_cÚ‹Á
)

610 
	g§
.
­³nd
(
İt
, opt[1]);

611 
	gİt
 +ğ
İt
[1];

614 
	gdÚe
:

615 
§
[
š™Ÿl_§_Ën
] = sa.
Ëngth
() - initial_sa_len - 1;

618 
uÅ¬£__İt_bš¬y
(
SŒšgAccum
& 
§
, cÚ¡ 
şick_
 *
h
, 
mask
)

620 
uÅ¬£__İt_bš¬y
(
§
, 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
 *>(
h
 + 1), (h->
_hl
 << 2è- (
şick_
), 
mask
);

623 
­³nd_Ãt_ušt32_t
(
SŒšgAccum
 &
§
, 
ušt32_t
 
u
)

625 
	g§
 << ()(
	gu
 >> 24) << ()(u >> 16) << ()(u >> 8) << ()u;

628 
boŞ
 
_İt_ša
(
Pack‘Odesc
 &
d
, cÚ¡ 
SŒšg
 &
¡r
, cÚ¡ 
F›ldR—d”
 *)

630 ià(!
	g¡r
 || sŒ.
equ®s
(".", 1))

631  
	gŒue
;

632 ià(
	g¡r
.
equ®s
("-", 1))

633  
	gçl£
;

634 cÚ¡ 
ušt8_t
 *
	gs
 = 
»š‹½»t_ÿ¡
<cÚ¡ ušt8_ˆ*>(
¡r
.
begš
());

635 cÚ¡ 
ušt8_t
 *
	g’d
 = 
»š‹½»t_ÿ¡
<cÚ¡ ušt8_ˆ*>(
¡r
.
’d
());

636 
	gcÚ‹Ás
 = 
DO_IPOPT_ALL
;

637 
	gd
.
	g§
.
ş—r
();

640 cÚ¡ *
	gt
;

641 
ušt32_t
 
	gu1
;

643 ià(
	gs
 + 3 < 
	g’d
 && 
memcmp
(
s
, "rr{", 3) == 0

644 && (
cÚ‹Ás
 & 
DO_IPOPT_ROUTE
)) {

646 
d
.
§
 << ()
IPOPT_RR
;

647 
	gs
 += 3;

648 
	g·r£_rou‹
:

649 
§_pos
 = 
d
.
§
.
Ëngth
() - 1;

650 
	gpoš‹r
 = -1;

651 
	gd
.
	g§
 << '\0' << '\0';

654 ià(
	gs
 < 
	g’d
 && * =ğ'^' && 
poš‹r
 < 0)

655 
poš‹r
 = 
d
.
§
.
Ëngth
(è- 
§_pos
 + 1, 
	gs
++;

656 ià(
	gs
 >ğ
’d
 || !
isdig™
(*
s
))

658 
	gi
 = 0; i < 4; i++) {

659 
	gu1
 = 256;

660 
	gs
 = 
ı_š‹g”
(
s
, 
’d
, 10, &
u1
è+ (
	gi
 < 3);

661 ià(
	gu1
 > 255 || (
	gi
 < 3 && (
	gs
 > 
	g’d
 || s[-1] != '.')))

662 
bad_İt
;

663 
	gd
.
	g§
 << ()
	gu1
;

665 ià(
	gs
 < 
	g’d
 && *s == ',')

666 
s
++;

668 ià(
	gs
 >ğ
’d
 || *
s
 != '}')

669 
bad_İt
;

670 
	gd
.
	g§
[
§_pos
 + 2] = (
poš‹r
 >ğ0 ?…oš‹¸: 
d
.
§
.
Ëngth
() - sa_pos + 1);

671 ià(
	gs
 + 2 < 
	g’d
 && s[1] =ğ'+' && 
isdig™
(
s
[2])) {

672 
s
 = 
ı_š‹g”
( + 2, 
’d
, 10, &
u1
);

673 ià(
	gu1
 < 64)

674 
	gd
.
	g§
.
­³nd_fl
('\0', 
u1
 * 4);

676 
	gs
++;

677 ià(
	gd
.
	g§
.
Ëngth
(è- 
	g§_pos
 > 255)

678 
	gbad_İt
;

679 
	gd
.
	g§
[
§_pos
 + 1] = 
d
.
§
.
Ëngth
() - sa_pos;

681 } ià(
	gs
 + 5 < 
	g’d
 && 
memcmp
(
s
, "ssrr{", 5) == 0

682 && (
cÚ‹Ás
 & 
DO_IPOPT_ROUTE
)) {

684 
d
.
§
 << ()
IPOPT_SSRR
;

685 
	gs
 += 5;

686 
	g·r£_rou‹
;

688 } ià(
	gs
 + 5 < 
	g’d
 && 
memcmp
(
s
, "lsrr{", 5) == 0

689 && (
cÚ‹Ás
 & 
DO_IPOPT_ROUTE
)) {

691 
d
.
§
 << ()
IPOPT_LSRR
;

692 
	gs
 += 5;

693 
	g·r£_rou‹
;

695 } ià(
	gs
 + 3 < 
	g’d


696 && (
memcmp
(
s
, "ts{", 3) == 0 || memcmp(s, "ts.", 3) == 0)

697 && (
cÚ‹Ás
 & 
DO_IPOPT_TS
)) {

699 
§_pos
 = 
d
.
§
.
Ëngth
();

700 
	gd
.
	g§
 << ()
	gIPOPT_TS
 << ()0 << ()0 << ()0;

701 
ušt32_t
 
	gtİ_b™
;

702 
	gæag
 = -1;

703 ià(
	gs
[2] == '.') {

704 ià(
s
 + 6 < 
’d
 && 
memcmp
(s + 3, "ip{", 3) == 0)

705 
æag
 = 1, 
	gs
 += 6;

706 ià(
	gs
 + 9 < 
	g’d
 && 
memcmp
(
s
 + 3, "preip{", 6) == 0)

707 
æag
 = 3, 
	gs
 += 9;

708 ià(
isdig™
(
s
[3])

709 && (
	gt
 = 
ı_š‹g”
(
s
 + 3, 
’d
, 0, (
ušt32_t
 *)&
æag
))

710 && 
	gæag
 <ğ15 && 
t
 < 
’d
 && *t == '{')

711 
s
 = 
t
 + 1;

713 
	gbad_İt
;

715 
	gs
 += 3;

716 
	gpoš‹r
 = -1;

720 ià(
	gs
 < 
	g’d
 && * =ğ'^' && 
poš‹r
 < 0)

721 
poš‹r
 = 
d
.
§
.
Ëngth
(è- 
§_pos
 + 1, 
	gs
++;

722 ià(
	gs
 >ğ
’d
 || (!
isdig™
(*
s
) && *s != '!'))

724 cÚ¡ *
	g’Œy
 = 
s
;

726 
	g»Œy_’Œy
:

727 ià(
æag
 == 1 || flag == 3 || flag == -2) {

729 
i
 = 0; 
	gi
 < 4; i++) {

730 
	gu1
 = 256;

731 
	gs
 = 
ı_š‹g”
(
s
, 
’d
, 10, &
u1
è+ (
	gi
 < 3);

732 ià(
	gu1
 > 255 || (
	gi
 < 3 && (
	gs
 > 
	g’d
 || s[-1] != '.')))

733 
bad_İt
;

734 
	gd
.
	g§
 << ()
	gu1
;

737 ià(
	gpoš‹r
 >ğ0 && 
æag
 == -2)

738 
æag
 = 3;

741 ià(
	gs
 + 1 < 
	g’d
 && *s == '=') {

742 ià(
isdig™
(
s
[1]) || s[1] == '!')

743 
s
++;

744 ià(
	gs
[1] =ğ'?' && 
poš‹r
 >= 0) {

745 
d
.
§
 << ()0 << ()0 << ()0 << ()0;

746 
	gs
 += 2;

747 
	gdÚe_’Œy
;

749 
	gbad_İt
;

750 } ià(
	gpoš‹r
 >= 0) {

751 
d
.
§
 << ()0 << ()0 << ()0 << ()0;

752 
	gdÚe_’Œy
;

754 
	gbad_İt
;

758 
as£¹
(
s
 < 
’d
);

759 
	gtİ_b™
 = 0;

760 ià(*
	gs
 == '!')

761 
tİ_b™
 = 0x80000000U, 
	gs
++;

762 ià(
	gs
 >ğ
’d
 || !
isdig™
(*
s
))

763 
bad_İt
;

764 
	gs
 = 
ı_š‹g”
(
s
, 
’d
, 0, &
u1
);

765 ià(
	gs
 < 
	g’d
 && * =ğ'.' && 
æag
 == -1) {

766 
æag
 = -2;

767 
	gs
 = 
’Œy
;

768 
	g»Œy_’Œy
;

769 } ià(
	gæag
 == -1)

770 
æag
 = 0;

771 
	gu1
 |ğ
tİ_b™
;

772 
­³nd_Ãt_ušt32_t
(
d
.
§
, 
u1
);

773 
	gdÚe_’Œy
:

775 ià(
s
 < 
’d
 && *s == ',')

776 
s
++;

780 ià(
	gs
 < 
	g’d
 && *s++ != '}')

781 
bad_İt
;

782 ià(
	gæag
 == -2)

783 
æag
 = 1;

784 
	gd
.
	g§
[
§_pos
 + 2] = (
poš‹r
 >ğ0 ?…oš‹¸: 
d
.
§
.
Ëngth
() - sa_pos + 1);

785 ià(
	gs
 + 1 < 
	g’d
 && * =ğ'+' && 
isdig™
(
s
[1])

786 && (
s
 = 
ı_š‹g”
( + 1, 
’d
, 0, &
u1
))

787 && 
	gu1
 < 64)

788 
	gd
.
	g§
.
­³nd_fl
('\0', 
u1
 * (
æag
 == 1 || flag == 3 ? 8 : 4));

789 
	gov”æow
 = 0;

790 ià(
	gs
 + 2 < 
	g’d
 && * =ğ'+' && 
s
[1] =ğ'+' && 
isdig™
(s[2])

791 && (
s
 = 
ı_š‹g”
( + 2, 
’d
, 0, &
u1
))

792 && 
	gu1
 < 16)

793 
	gov”æow
 = 
u1
;

794 
	gd
.
	g§
[
§_pos
 + 3] = (
ov”æow
 << 4è| 
æag
;

795 ià(
	gd
.
	g§
.
Ëngth
(è- 
	g§_pos
 > 255)

796 
	gbad_İt
;

797 
	gd
.
	g§
[
§_pos
 + 1] = 
d
.
§
.
Ëngth
() - sa_pos;

799 } ià(
	gs
 < 
	g’d
 && 
isdig™
(*
s
è&& (
	gcÚ‹Ás
 & 
	gDO_IPOPT_UNKNOWN
)) {

801 
	gs
 = 
ı_š‹g”
(
s
, 
’d
, 0, &
u1
);

802 ià(
	gu1
 >= 256)

803 
bad_İt
;

804 
	gd
.
	g§
 << ()
	gu1
;

805 ià(
	gs
 + 1 < 
	g’d
 && * =ğ'=' && 
isdig™
(
s
[1])) {

806 
pos0
 = 
d
.
§
.
Ëngth
();

807 
	gd
.
	g§
 << ()0;

809 
	gs
 = 
ı_š‹g”
(
s
 + 1, 
’d
, 0, &
u1
);

810 ià(
	gu1
 >= 256)

811 
bad_İt
;

812 
	gd
.
	g§
 << ()
	gu1
;

813 } 
	gs
 + 1 < 
	g’d
 && * =ğ':' && 
isdig™
(
s
[1]));

814 ià(
	gd
.
	g§
.
Ëngth
(è> 
	gpos0
 + 254)

815 
	gbad_İt
;

816 
	gd
.
	g§
[
pos0
] = ()(
d
.
§
.
Ëngth
() -…os0 + 1);

818 } ià(
	gs
 + 3 <ğ
’d
 && 
memcmp
(
s
, "nop", 3) == 0

819 && (
cÚ‹Ás
 & 
DO_IPOPT_PADDING
)) {

820 
d
.
§
 << ()
IPOPT_NOP
;

821 
	gs
 += 3;

822 } ià(
	gs
 + 3 <ğ
’d
 && 
memcmp
(
s
, "eol", 3) == 0

823 && (
cÚ‹Ás
 & 
DO_IPOPT_PADDING
)

824 && (
s
 + 3 =ğ
’d
 || s[3] != ',')) {

825 
d
.
§
 << ()
IPOPT_EOL
;

826 
	gs
 += 3;

828 
	gbad_İt
;

830 ià(
	gs
 >ğ
’d
) {

832 
d
.
§
.
Ëngth
(è> 40 && d.§[0] =ğ
IPOPT_NOP
) {

833 
memmove
(&
d
.
§
[0], &d.§[1], d.§.
Ëngth
() - 1);

834 
	gd
.
	g§
.
pİ_back
();

837 ià(
	gd
.
	g§
.
Ëngth
() > 40)

838 
	gbad_İt
;

840 
	gd
.
	gv±r
[0] = 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
 *>(
d
.
§
.
begš
());

841 
	gd
.
	gv±r
[1] = 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
 *>(
d
.
§
.
’d
());

842  
	gŒue
;

843 } ià(*
	gs
 !ğ',' && *
s
 != ';')

844 
bad_İt
;

846 
	gs
++;

849 
	gbad_İt
:

850  
çl£
;

853 cÚ¡ 
F›ldWr™”
 
	g_wr™”s
[] = {

854 { "_¤c", 
B_4NET
, 
T_IP_SRC
,

855 
_´•¬e
, 
_exŒaù
, 
_ou
, 
outb
 },

856 { "_d¡", 
B_4NET
, 
T_IP_DST
,

857 
_´•¬e
, 
_exŒaù
, 
_ou
, 
outb
 },

858 { "_tos", 
B_1
, 
T_IP_TOS
,

859 
_´•¬e
, 
_exŒaù
, 
num_ou
, 
outb
 },

860 { "_dsı", 
B_1
, 
T_IP_DSCP
,

861 
_´•¬e
, 
_exŒaù
, 
num_ou
, 
outb
 },

862 { "_eú", 
B_1
, 
T_IP_ECN
,

863 
_´•¬e
, 
_exŒaù
, 
_ou
, 
outb
 },

864 { "_‰l", 
B_1
, 
T_IP_TTL
,

865 
_´•¬e
, 
_exŒaù
, 
num_ou
, 
outb
 },

866 { "_äag", 
B_1
, 
T_IP_FRAG
,

867 
_´•¬e
, 
_exŒaù
, 
_ou
, 
outb
 },

868 { "_äagoff", 
B_2
, 
T_IP_FRAGOFF
,

869 
_´•¬e
, 
_exŒaù
, 
_ou
, 
outb
 },

870 { "_id", 
B_2
, 
T_IP_ID
,

871 
_´•¬e
, 
_exŒaù
, 
num_ou
, 
outb
 },

872 { "_sum", 
B_2
, 
T_IP_SUM
,

873 
_´•¬e
, 
_exŒaù
, 
num_ou
, 
outb
 },

874 { "_´Ùo", 
B_1
, 
T_IP_PROTO
,

875 
_´•¬e
, 
_exŒaù
, 
_ou
, 
outb
 },

876 { "_hl", 
B_1
, 
T_IP_HL
,

877 
_´•¬e
, 
_exŒaù
, 
num_ou
, 
outb
 },

878 { "_Ën", 
B_4
, 
T_IP_LEN
,

879 
_´•¬e
, 
_exŒaù
, 
num_ou
, 
outb
 },

880 { "_ÿ±u»_Ën", 
B_4
, 
T_IP_CAPTURE_LEN
,

881 
_´•¬e
, 
_exŒaù
, 
num_ou
, 
outb
 },

882 { "_İt", 
B_SPECIAL
, 
T_IP_OPT
,

883 
_´•¬e
, 
_exŒaù
, 
_ou
, 
_outb
 },

884 { "¥Üt", 
B_2
, 
T_SPORT
,

885 
_´•¬e
, 
Œª¥Üt_exŒaù
, 
num_ou
, 
outb
 },

886 { "dpÜt", 
B_2
, 
T_DPORT
,

887 
_´•¬e
, 
Œª¥Üt_exŒaù
, 
num_ou
, 
outb
 }

890 cÚ¡ 
F›ldR—d”
 
	g_»ad”s
[] = {

891 { "_¤c", 
B_4NET
, 
T_IP_SRC
, 
Üd”_Ãt
,

892 
_ša
, 
šb
, 
_šjeù
 },

893 { "_d¡", 
B_4NET
, 
T_IP_DST
, 
Üd”_Ãt
,

894 
_ša
, 
šb
, 
_šjeù
 },

895 { "_tos", 
B_1
, 
T_IP_TOS
, 
Üd”_Ãt
,

896 
num_ša
, 
šb
, 
_šjeù
 },

897 { "_dsı", 
B_1
, 
T_IP_DSCP
, 
Üd”_Ãt
,

898 
num_ša
, 
šb
, 
_šjeù
 },

899 { "_eú", 
B_1
, 
T_IP_ECN
, 
Üd”_Ãt
,

900 
_ša
, 
šb
, 
_šjeù
 },

901 { "_‰l", 
B_1
, 
T_IP_TTL
, 
Üd”_Ãt
,

902 
num_ša
, 
šb
, 
_šjeù
 },

903 { "_äag", 
B_1
, 
T_IP_FRAG
, 
Üd”_Ãt
 - 2,

904 
_ša
, 
šb
, 
_šjeù
 },

905 { "_äagoff", 
B_2
, 
T_IP_FRAGOFF
, 
Üd”_Ãt
 - 1,

906 
_ša
, 
šb
, 
_šjeù
 },

907 { "_id", 
B_2
, 
T_IP_ID
, 
Üd”_Ãt
,

908 
num_ša
, 
šb
, 
_šjeù
 },

909 { "_sum", 
B_2
, 
T_IP_SUM
, 
Üd”_Ãt
 + 2,

910 
num_ša
, 
šb
, 
_šjeù
 },

911 { "_´Ùo", 
B_1
, 
T_IP_PROTO
, 
Üd”_Ãt
,

912 
_ša
, 
šb
, 
_šjeù
 },

913 { "_hl", 
B_1
, 
T_IP_HL
, 
Üd”_Ãt
 - 1,

914 
num_ša
, 
šb
, 
_šjeù
 },

915 { "_Ën", 
B_4
, 
T_IP_LEN
, 
Üd”_Ãt
 + 1,

916 
num_ša
, 
šb
, 
_šjeù
 },

917 { "_ÿ±u»_Ën", 
B_4
, 
T_IP_CAPTURE_LEN
, 
Üd”_·ylßd
 + 2,

918 
num_ša
, 
šb
, 
_šjeù
 },

919 { "_İt", 
B_SPECIAL
, 
T_IP_OPT
, 
Üd”_Ãt
,

920 
_İt_ša
, 
_šb
, 
_šjeù
 },

921 { "¥Üt", 
B_2
, 
T_SPORT
, 
Üd”_Œª¥
,

922 
num_ša
, 
šb
, 
Œª¥Üt_šjeù
 },

923 { "dpÜt", 
B_2
, 
T_DPORT
, 
Üd”_Œª¥
,

924 
num_ša
, 
šb
, 
Œª¥Üt_šjeù
 }

927 cÚ¡ 
F›ldSynÚym
 
	g_synÚyms
[] = {

934 
	gIPSumm¬yDump_IP
::
	$¡©ic_š™Ÿlize
()

936 
usšg
 
Çme¥aû
 
IPSumm¬yDump
;

937 
size_t
 
i
 = 0; i < (
_wr™”s
) / (ip_writers[0]); ++i)

938 
F›ldWr™”
::
	`add
(&
_wr™”s
[
i
]);

939 
size_t
 
i
 = 0; i < (
_»ad”s
) / (ip_readers[0]); ++i)

940 
F›ldR—d”
::
	`add
(&
_»ad”s
[
i
]);

941 
size_t
 
i
 = 0; i < (
_synÚyms
) / (ip_synonyms[0]); ++i)

942 
F›ldSynÚym
::
	`add
(&
_synÚyms
[
i
]);

943 
	}
}

945 
	gIPSumm¬yDump_IP
::
	$¡©ic_ş—nup
()

947 
usšg
 
Çme¥aû
 
IPSumm¬yDump
;

948 
size_t
 
i
 = 0; i < (
_wr™”s
) / (ip_writers[0]); ++i)

949 
F›ldWr™”
::
	`»move
(&
_wr™”s
[
i
]);

950 
size_t
 
i
 = 0; i < (
_»ad”s
) / (ip_readers[0]); ++i)

951 
F›ldR—d”
::
	`»move
(&
_»ad”s
[
i
]);

952 
size_t
 
i
 = 0; i < (
_synÚyms
) / (ip_synonyms[0]); ++i)

953 
F›ldSynÚym
::
	`»move
(&
_synÚyms
[
i
]);

954 
	}
}

956 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
IPSumm¬yDump
)

957 
	$ELEMENT_PROVIDES
(
IPSumm¬yDump_IP
)

958 
CLICK_ENDDECLS


	@analysis/ipsumdump_ip.hh

1 #iâdeà
CLICK_IPSUMDUMP_IP_HH


2 
	#CLICK_IPSUMDUMP_IP_HH


	)

3 
	~"sumdumpšfo.hh
"

4 
CLICK_DECLS


6 şas 
	cIPSumm¬yDump_IP
 { 
	mpublic
:

7 
¡©ic_š™Ÿlize
();

8 
¡©ic_ş—nup
();

11 
	gCLICK_ENDDECLS


	@analysis/ipsumdump_link.cc

19 
	~<şick/cÚfig.h
>

21 
	~"sumdump_lšk.hh
"

22 
	~<şick/·ck‘.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
	~<şickÃt/‘h”.h
>

25 
	~<şick/¬gs.hh
>

26 
	~<şick/‘h”add»ss.hh
>

27 
CLICK_DECLS


29 ’um { 
	mT_ETH_SRC
, 
	mT_ETH_DST
, 
	mT_ETH_TYPE
 };

31 
Çme¥aû
 
	gIPSumm¬yDump
 {

33 
boŞ
 
lšk_exŒaù
(
Pack‘Desc
& 
d
, cÚ¡ 
F›ldWr™”
 *
f
)

35 cÚ¡ *
	gmac
;

36 ià(!
	gd
.
	gp
->
has_mac_h—d”
()) {

37 ià(!
	gd
.
	gp
->
has_ÃtwÜk_h—d”
(è|| d.p->
d©a
(è< d.p->
ÃtwÜk_h—d”
())

38 
	gmac
 = 
d
.
p
->
d©a
();

40 
	gmac
 = 0;

42 
	gmac
 = 
d
.
p
->
mac_h—d”
();

44 cÚ¡ *
	gÃtwÜk
;

45 ià(!
	gd
.
	gp
->
has_ÃtwÜk_h—d”
())

46 
	gÃtwÜk
 = 
d
.
p
->
’d_d©a
();

48 
	gÃtwÜk
 = 
d
.
p
->
ÃtwÜk_h—d”
();

50 
	gf
->
	gu£r_d©a
) {

53 
	#CHECK
(èdØ{ ià(!
mac
 || maø+ 14 !ğ
ÃtwÜk
è 
	`f›ld_missšg
(
d
, 
MISSING_ETHERNET
, 0); } 0)

	)

54 
	gT_ETH_SRC
:

55 
CHECK
();

56 
	gd
.
	gv±r
[0] = 
mac
 + 6;

57  
	gŒue
;

58 
	gT_ETH_DST
:

59 
CHECK
();

60 
	gd
.
	gv±r
[0] = 
mac
;

61  
	gŒue
;

62 
	gT_ETH_TYPE
:

63 
CHECK
();

64 
	gd
.
	gv
 = (
mac
[12]<<8) + mac[13];

65  
	gŒue
;

66 #undeà
CHECK


69  
çl£
;

73 
lšk_šjeù
(
Pack‘Odesc
& 
d
, cÚ¡ 
F›ldR—d”
 *
f
)

75 ià(!
	gd
.
	gp
->
mac_h—d”
()) {

76 ià(!(
	gd
.
	gp
 = 
d
.
p
->
push_mac_h—d”
(14)))

78 
	gd
.
	gp
->
‘h”_h—d”
()->
	g‘h”_ty³
 = 
htÚs
(
ETHERTYPE_IP
);

80 
	gf
->
	gu£r_d©a
) {

81 
	gT_ETH_SRC
:

82 
memıy
(
d
.
p
->
‘h”_h—d”
()->
‘h”_sho¡
, d.
u8
, 6);

84 
	gT_ETH_DST
:

85 
memıy
(
d
.
p
->
‘h”_h—d”
()->
‘h”_dho¡
, d.
u8
, 6);

87 
	gT_ETH_TYPE
:

88 
d
.
p
->
‘h”_h—d”
()->
‘h”_ty³
 = 
htÚs
(d.
v
);

89 ià(
	gd
.
	gv
 !ğ
ETHERTYPE_IP
 && 
d
.
v
 !ğ
ETHERTYPE_IP6
)

90 
d
.
is_
 = 
çl£
;

95 
lšk_ou
(cÚ¡ 
Pack‘Desc
& 
d
, cÚ¡ 
F›ldWr™”
 *
f
)

97 
	gf
->
	gu£r_d©a
) {

98 
	gT_ETH_SRC
:

99 
T_ETH_DST
:

100 *
d
.
§
 << 
Eth”Add»ss
(d.
v±r
[0]);

102 
	gT_ETH_TYPE
:

103 
d
.
§
->
¢´štf
(4, "%04X", d.
v
);

108 
boŞ
 
lšk_ša
(
Pack‘Odesc
& 
d
, cÚ¡ 
SŒšg
 &
¡r
, cÚ¡ 
F›ldR—d”
 *
f
)

110 
	gf
->
	gu£r_d©a
) {

111 
	gT_ETH_SRC
:

112 
T_ETH_DST
:

113  
Eth”Add»ssArg
().
·r£
(
¡r
, 
d
.
u8
, d.
e
);

114 
	gT_ETH_TYPE
:

115  
IÁArg
(16).
·r£
(
¡r
, 
d
.
v
è&& 
	gd
.
	gv
 < 65536;

117  
çl£
;

121 cÚ¡ 
F›ldWr™”
 
	glšk_wr™”s
[] = {

122 { "‘h_¤c", 
B_6PTR
, 
T_ETH_SRC
,

123 0, 
lšk_exŒaù
, 
lšk_ou
, 
outb
 },

124 { "‘h_d¡", 
B_6PTR
, 
T_ETH_DST
,

125 0, 
lšk_exŒaù
, 
lšk_ou
, 
outb
 },

126 { "‘h_ty³", 
B_2
, 
T_ETH_TYPE
,

127 0, 
lšk_exŒaù
, 
lšk_ou
, 
outb
 }

130 cÚ¡ 
F›ldR—d”
 
	glšk_»ad”s
[] = {

131 { "‘h_¤c", 
B_6PTR
, 
T_ETH_SRC
, 
Üd”_lšk
,

132 
lšk_ša
, 
šb
, 
lšk_šjeù
 },

133 { "‘h_d¡", 
B_6PTR
, 
T_ETH_DST
, 
Üd”_lšk
,

134 
lšk_ša
, 
šb
, 
lšk_šjeù
 },

135 { "‘h_ty³", 
B_2
, 
T_ETH_TYPE
, 
Üd”_lšk
,

136 
lšk_ša
, 
šb
, 
lšk_šjeù
 }

139 cÚ¡ 
F›ldSynÚym
 
	glšk_synÚyms
[] = {

147 
	gIPSumm¬yDump_Lšk
::
	$¡©ic_š™Ÿlize
()

149 
usšg
 
Çme¥aû
 
IPSumm¬yDump
;

150 
size_t
 
i
 = 0; i < (
lšk_wr™”s
) / (link_writers[0]); ++i)

151 
F›ldWr™”
::
	`add
(&
lšk_wr™”s
[
i
]);

152 
size_t
 
i
 = 0; i < (
lšk_»ad”s
) / (link_readers[0]); ++i)

153 
F›ldR—d”
::
	`add
(&
lšk_»ad”s
[
i
]);

154 
size_t
 
i
 = 0; i < (
lšk_synÚyms
) / (link_synonyms[0]); ++i)

155 
F›ldSynÚym
::
	`add
(&
lšk_synÚyms
[
i
]);

156 
	}
}

158 
	gIPSumm¬yDump_Lšk
::
	$¡©ic_ş—nup
()

160 
usšg
 
Çme¥aû
 
IPSumm¬yDump
;

161 
size_t
 
i
 = 0; i < (
lšk_wr™”s
) / (link_writers[0]); ++i)

162 
F›ldWr™”
::
	`»move
(&
lšk_wr™”s
[
i
]);

163 
size_t
 
i
 = 0; i < (
lšk_»ad”s
) / (link_readers[0]); ++i)

164 
F›ldR—d”
::
	`»move
(&
lšk_»ad”s
[
i
]);

165 
size_t
 
i
 = 0; i < (
lšk_synÚyms
) / (link_synonyms[0]); ++i)

166 
F›ldSynÚym
::
	`»move
(&
lšk_synÚyms
[
i
]);

167 
	}
}

169 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
IPSumm¬yDump
)

170 
	$ELEMENT_PROVIDES
(
IPSumm¬yDump_Lšk
)

171 
CLICK_ENDDECLS


	@analysis/ipsumdump_link.hh

1 #iâdeà
CLICK_IPSUMDUMP_LINK_HH


2 
	#CLICK_IPSUMDUMP_LINK_HH


	)

3 
	~"sumdumpšfo.hh
"

4 
CLICK_DECLS


6 şas 
	cIPSumm¬yDump_Lšk
 { 
	mpublic
:

7 
¡©ic_š™Ÿlize
();

8 
¡©ic_ş—nup
();

11 
	gCLICK_ENDDECLS


	@analysis/ipsumdump_payload.cc

20 
	~<şick/cÚfig.h
>

22 
	~"sumdump_·ylßd.hh
"

23 
	~<şick/·ck‘.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
	~<şick/md5.h
>

26 
	~<şickÃt/.h
>

27 
	~<şickÃt/tı.h
>

28 
	~<şickÃt/udp.h
>

29 
	~<şick/cÚå¬£.hh
>

30 
	~<şick/æowid.hh
>

31 
CLICK_DECLS


33 
Çme¥aû
 
	gIPSumm¬yDump
 {

35 ’um { 
	gT_PAYLOAD_LEN
, 
	gT_PAYLOAD
, 
	gT_PAYLOAD_MD5
, 
	gT_PAYLOAD_MD5_HEX
 };

37 
·ylßd_šfo
(cÚ¡ 
Pack‘
 *
p
, cÚ¡ 
şick_
 *
h
, 
·d
,

38 
št32_t
 &
off
, 
ušt32_t
 &
Ën
)

42 ià(
	gh
) {

43 
	gËn
 = 
Áohs
(
h
->
_Ën
);

44 
	goff
 = 
p
->
Œª¥Üt_h—d”_off£t
();

45 ià(
IP_FIRSTFRAG
(
h
))

46 
	gh
->
	g_p
) {

47 
	gIP_PROTO_TCP
:

48 ià(
p
->
Œª¥Üt_Ëngth
(è- 
·d
 >= 13

49 && (è(
p
->
tı_h—d”
()->
th_off
 << 2è>ğ(
şick_tı
))

50 
off
 +ğ
p
->
tı_h—d”
()->
th_off
 << 2;

52 
	goff
 +ğ(
şick_tı
);

54 
	gIP_PROTO_UDP
:

55 
IP_PROTO_UDPLITE
:

56 
off
 +ğ(
şick_udp
);

59 
	gËn
 -ğ
off
 - 
p
->
ÃtwÜk_h—d”_off£t
();

61 
	goff
 = 0;

62 
	gËn
 = 
p
->
Ëngth
(è- 
·d
;

66 
boŞ
 
·ylßd_exŒaù
(
Pack‘Desc
 &
d
, cÚ¡ 
F›ldWr™”
 *
f
)

68 
·ylßd_šfo
(
d
.
p
, d.
h
, d.
·d
, d.
i32
[1], d.
v
);

69 ià(
	gf
->
	gu£r_d©a
 =ğ
T_PAYLOAD_LEN
) {

70 ià(!
d
.
h
 || d.
fÜû_exŒa_Ëngth
)

71 
d
.
v
 +ğ
EXTRA_LENGTH_ANNO
(d.
p
);

72  
	gŒue
;

74  
	gd
.
	gv
 =ğ0 || (è
d
.
i32
[1] < d.
p
->
Ëngth
();

77 
accouÁ_·ylßd_Ën
(
Pack‘Odesc
 &
d
, 
št32_t
 &
off
, 
ušt32_t
 
¶’
)

79 ià(!
	gd
.
	gis_
 || (d.
	gp
->
_h—d”
()->
	g_Ën
 =ğ0 && 
d
.
wªt_Ën
 == 0))

80 
d
.
wªt_Ën
 = 
off
 + 
¶’
;

82 
şick_
 *
	gh
 = 
d
.
p
->
_h—d”
();

83 
şick_tı
 *
	gtıh
;

84 
ušt32_t
 
	g_Ën
 = (
h
->
_Ën
 ? 
Áohs
(h->_Ënè: 
d
.
wªt_Ën
)

85 + 
d
.
p
->
ÃtwÜk_h—d”_off£t
();

86 
	gd–
 = 
_Ën
 - (
off
 + 
¶’
);

88 ià(
	gd–
 > 0 && 
IP_FIRSTFRAG
(
h
è&& 
	gh
->
	g_p
 =ğ
IP_PROTO_TCP


89 && !
d
.
have_tı_hl
 && (
tıh
 = d.
p
->
tı_h—d”
())

90 && 
tıh
->
th_off
 =ğ((
şick_tı
) >> 2)) {

91 
th_d–
 = 
d–
 - (delta & 3);

92 ià(
	gth_d–
 + (
	gşick_tı
) > (15 << 2))

93 
	gth_d–
 = (15 << 2è- (
şick_tı
);

94 ià(!(
	gd
.
	gp
 = 
d
.
p
->
put
(
th_d–
)))

96 
	gh
 = 
d
.
p
->
_h—d”
();

97 *
	gtx
 = 
d
.
p
->
Œª¥Üt_h—d”
(è+ (
şick_tı
);

98 
memmove
(
tx
 + 
th_d–
,x, 
d
.
p
->
’d_d©a
() - (tx +h_delta));

99 
mem£t
(
tx
, 
TCPOPT_EOL
, 
th_d–
);

100 
	gd
.
	gp
->
tı_h—d”
()->
	gth_off
 = ((
şick_tı
è+ 
th_d–
) >> 2;

101 
	gd–
 -ğ
th_d–
;

104 ià(
	gd–
 > 0 && !
	gd
.
	ghave__hl
 && 
	gh
->
	g_hl
 =ğ((
şick_
) >> 2)) {

105 
_d–
 = 
d–
 - (delta & 3);

106 ià(
	g_d–
 + (
	gşick_
) > (15 << 2))

107 
	g_d–
 = (15 << 2è- (
şick_
);

108 ià(!(
	gd
.
	gp
 = 
d
.
p
->
put
(
_d–
)))

110 
	gh
 = 
d
.
p
->
_h—d”
();

111 *
	gnx
 = 
d
.
p
->
ÃtwÜk_h—d”
(è+ (
şick_
);

112 
memmove
(
nx
 + 
_d–
,‚x, 
d
.
p
->
’d_d©a
() - (nx + ip_delta));

113 
mem£t
(
nx
, 
IPOPT_EOL
, 
_d–
);

114 
	gh
->
	g_hl
 = ((
şick_
è+ 
_d–
) >> 2;

115 
	gd
.
	gp
->
£t__h—d”
(
h
, (
şick_
è+ 
_d–
);

120 
·ylßd_šjeù
(
Pack‘Odesc
 &
d
, cÚ¡ 
F›ldR—d”
 *
f
)

122 ià(
	gd
.
make_
(0))

123 
	gd
.
make_Œª¥
();

124 ià(!
	gd
.
	gp
)

127 
št32_t
 
	goff
;

128 
ušt32_t
 
	gËn
;

129 
·ylßd_šfo
(
d
.
p
, d.
is_
 ? d.p->
_h—d”
(è: 0, 0, 
off
, 
Ën
);

130 
	gf
->
	gu£r_d©a
) {

131 
	gT_PAYLOAD
: {

132 ià(!
d
.
v±r
[0] || d.vptr[0] == d.vptr[1])

134 
ušt32_t
 
	g¶’
 = 
d
.
v±r
[1] - d.vptr[0];

135 
accouÁ_·ylßd_Ën
(
d
, 
off
, 
¶’
);

136 ià(!
	gd
.
	gp
 || (d.p->
Ëngth
(è- 
	goff
 < 
	g¶’


137 && !(
	gd
.
	gp
 = 
d
.
p
->
put
(
¶’
 - (d.p->
Ëngth
(è- 
off
)))))

139 
memıy
(
d
.
p
->
d©a
(è+ 
off
, d.
v±r
[0], 
¶’
);

142 
	gT_PAYLOAD_LEN
:

143 
accouÁ_·ylßd_Ën
(
d
, 
off
, d.
v
);

148 
·ylßd_ou
(cÚ¡ 
Pack‘Desc
& 
d
, cÚ¡ 
F›ldWr™”
 *
f
)

150 
št32_t
 
	goff
 = 
d
.
i32
[1];

151 
ušt32_t
 
	gËn
 = 
d
.
v
;

152 ià(
	goff
 + 
	gËn
 > 
	gd
.
Ëngth
())

153 
	gËn
 = 
d
.
Ëngth
(è- 
off
;

154 ià(
	gf
->
	gu£r_d©a
 =ğ
T_PAYLOAD
) {

155 
SŒšg
 
s
 = SŒšg::
make_¡abË
((cÚ¡ *)(
d
.
p
->
d©a
(è+ 
off
), 
Ën
);

156 *
	gd
.
	g§
 << 
ı_quÙe
(
s
);

158 
md5_¡©e_t
 
	gpms
;

159 
md5_š™
(&
pms
);

160 
md5_­³nd
(&
pms
, (cÚ¡ 
md5_by‹_t
 *è(
d
.
p
->
d©a
(è+ 
off
), 
Ën
);

162 ià(
	gf
->
	gu£r_d©a
 =ğ
T_PAYLOAD_MD5_HEX
) {

163 ià(*
buf
 = 
d
.
§
->
ex‹nd
(
MD5_DIGEST_SIZE
 * 2)) {

164 
md5_fšish
(&
pms
, (
md5_by‹_t
 *è
buf
);

165 cÚ¡ 
	gdig™s
[] = "0123456789abcdef";

166 
	gi
 = 
MD5_DIGEST_SIZE
 - 1; i >= 0; --i) {

167 
	gb
 = (è
buf
[
i
];

168 
	gbuf
[2*
i
 + 1] = 
dig™s
[
b
 & 15];

169 
	gbuf
[2*
i
] = 
dig™s
[
b
 >> 4];

173 ià(*
	gbuf
 = 
d
.
§
->
ex‹nd
(
MD5_TEXT_DIGEST_SIZE
))

174 
md5_fšish_‹xt
(&
pms
, 
buf
, 1);

177 
md5_ä“
(&
pms
);

181 
boŞ
 
·ylßd_ša
(
Pack‘Odesc
& 
d
, cÚ¡ 
SŒšg
 &
¡r
, cÚ¡ 
F›ldR—d”
 *
f
)

183 
	gf
->
	gu£r_d©a
) {

184 
	gT_PAYLOAD
: {

185 
SŒšg
 
s
;

186 ià(
ı_¡ršg
(
¡r
, &
s
)) {

187 
	gd
.
	g§
.
ş—r
();

188 
	gd
.
	g§
 << 
	gs
;

189 
	gd
.
	gv±r
[0] = (cÚ¡ 
ušt8_t
 *è
d
.
§
.
begš
();

190 
	gd
.
	gv±r
[1] = (cÚ¡ 
ušt8_t
 *è
d
.
§
.
’d
();

191  
	gŒue
;

196  
	gçl£
;

199 
·ylßd_outb
(cÚ¡ 
Pack‘Desc
& 
d
, 
boŞ
, cÚ¡ 
F›ldWr™”
*)

201 
št32_t
 
	goff
 = 
d
.
i32
[1];

202 
ušt32_t
 
	gËn
 = 
d
.
v
;

203 ià(
	goff
 + 
	gËn
 > (
	gušt32_t
è
	gd
.
Ëngth
())

204 
	gËn
 = 
d
.
Ëngth
(è- 
off
;

205 
md5_¡©e_t
 
	gpms
;

206 
md5_š™
(&
pms
);

207 
md5_­³nd
(&
pms
, (cÚ¡ 
md5_by‹_t
 *è(
d
.
p
->
d©a
(è+ 
off
), 
Ën
);

208 ià(*
	gbuf
 = 
d
.
§
->
ex‹nd
(
MD5_DIGEST_SIZE
))

209 
md5_fšish
(&
pms
, (
md5_by‹_t
 *è
buf
);

210 
md5_ä“
(&
pms
);

213 cÚ¡ 
F›ldWr™”
 
	g·ylßd_wr™”s
[] = {

214 { "·ylßd_Ën", 
B_4
, 
T_PAYLOAD_LEN
,

215 
_´•¬e
, 
·ylßd_exŒaù
, 
num_ou
, 
outb
 },

216 { "·ylßd", 
B_NOTALLOWED
, 
T_PAYLOAD
,

217 
_´•¬e
, 
·ylßd_exŒaù
, 
·ylßd_ou
, 0 },

218 { "·ylßd_md5", 
B_16
, 
T_PAYLOAD_MD5
,

219 
_´•¬e
, 
·ylßd_exŒaù
, 
·ylßd_ou
, 
·ylßd_outb
 },

220 { "·ylßd_md5_hex", 
B_16
, 
T_PAYLOAD_MD5_HEX
,

221 
_´•¬e
, 
·ylßd_exŒaù
, 
·ylßd_ou
, 
·ylßd_outb
 }

224 cÚ¡ 
F›ldR—d”
 
	g·ylßd_»ad”s
[] = {

225 { "·ylßd_Ën", 
B_4
, 
T_PAYLOAD_LEN
, 
Üd”_·ylßd
 + 1,

226 
num_ša
, 
šb
, 
·ylßd_šjeù
 },

227 { "·ylßd", 
B_NOTALLOWED
, 
T_PAYLOAD
, 
Üd”_·ylßd
,

228 
·ylßd_ša
, 0, 
·ylßd_šjeù
 }

231 cÚ¡ 
F›ldSynÚym
 
	g·ylßd_synÚyms
[] = {

237 
	gIPSumm¬yDump_Paylßd
::
	$¡©ic_š™Ÿlize
()

239 
usšg
 
Çme¥aû
 
IPSumm¬yDump
;

240 
size_t
 
i
 = 0; i < (
·ylßd_wr™”s
) / (payload_writers[0]); ++i)

241 
F›ldWr™”
::
	`add
(&
·ylßd_wr™”s
[
i
]);

242 
size_t
 
i
 = 0; i < (
·ylßd_»ad”s
) / (payload_readers[0]); ++i)

243 
F›ldR—d”
::
	`add
(&
·ylßd_»ad”s
[
i
]);

244 
size_t
 
i
 = 0; i < (
·ylßd_synÚyms
) / (payload_synonyms[0]); ++i)

245 
F›ldSynÚym
::
	`add
(&
·ylßd_synÚyms
[
i
]);

246 
	}
}

248 
	gIPSumm¬yDump_Paylßd
::
	$¡©ic_ş—nup
()

250 
usšg
 
Çme¥aû
 
IPSumm¬yDump
;

251 
size_t
 
i
 = 0; i < (
·ylßd_wr™”s
) / (payload_writers[0]); ++i)

252 
F›ldWr™”
::
	`»move
(&
·ylßd_wr™”s
[
i
]);

253 
size_t
 
i
 = 0; i < (
·ylßd_»ad”s
) / (payload_readers[0]); ++i)

254 
F›ldR—d”
::
	`»move
(&
·ylßd_»ad”s
[
i
]);

255 
size_t
 
i
 = 0; i < (
·ylßd_synÚyms
) / (payload_synonyms[0]); ++i)

256 
F›ldSynÚym
::
	`»move
(&
·ylßd_synÚyms
[
i
]);

257 
	}
}

259 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
IPSumm¬yDump
)

260 
	$ELEMENT_PROVIDES
(
IPSumm¬yDump_Paylßd
)

261 
CLICK_ENDDECLS


	@analysis/ipsumdump_payload.hh

1 #iâdeà
CLICK_IPSUMDUMP_PAYLOAD_HH


2 
	#CLICK_IPSUMDUMP_PAYLOAD_HH


	)

3 
	~"sumdumpšfo.hh
"

4 
CLICK_DECLS


6 şas 
	cIPSumm¬yDump_Paylßd
 { 
	mpublic
:

7 
¡©ic_š™Ÿlize
();

8 
¡©ic_ş—nup
();

11 
	gCLICK_ENDDECLS


	@analysis/ipsumdump_tcp.cc

21 
	~<şick/cÚfig.h
>

23 
	~"sumdump_tı.hh
"

24 
	~<şick/·ck‘.hh
>

25 
	~<şick/Çmešfo.hh
>

26 
	~<şickÃt/.h
>

27 
	~<şickÃt/tı.h
>

28 
	~<şickÃt/udp.h
>

29 
	~<şickÃt/icmp.h
>

30 
	~<şick/cÚå¬£.hh
>

31 
CLICK_DECLS


33 
Çme¥aû
 
	gIPSumm¬yDump
 {

35 ’um { 
	gT_TCP_SEQ
, 
	gT_TCP_ACK
, 
	gT_TCP_FLAGS
, 
	gT_TCP_WINDOW
, 
	gT_TCP_URP
, 
	gT_TCP_OPT
,

36 
	gT_TCP_NTOPT
, 
	gT_TCP_SACK
, 
	gT_TCP_OFF
 };

38 
boŞ
 
tı_exŒaù
(
Pack‘Desc
& 
d
, cÚ¡ 
F›ldWr™”
 *
f
)

40 
	gŒª¥Üt_Ëngth
 = 
d
.
Œª¥Üt_Ëngth
();

41 
	gf
->
	gu£r_d©a
) {

43 
	#CHECK
(
l
èdØ{ ià(!
d
.
tıh
 || 
Œª¥Üt_Ëngth
 < (l)è 
	`f›ld_missšg
(d, 
IP_PROTO_TCP
, (l)); } 0)

	)

45 
	gT_TCP_SEQ
:

46 
CHECK
(8);

47 
	gd
.
	gv
 = 
Áohl
(
d
.
tıh
->
th_£q
);

48  
	gŒue
;

49 
	gT_TCP_ACK
:

50 
CHECK
(12);

51 
	gd
.
	gv
 = 
Áohl
(
d
.
tıh
->
th_ack
);

52  
	gŒue
;

53 
	gT_TCP_FLAGS
:

54 
CHECK
(14);

55 
	gd
.
	gv
 = 
d
.
tıh
->
th_æags
 | (d.tıh->
th_æags2
 << 8);

56  
	gŒue
;

57 
	gT_TCP_OFF
:

58 
CHECK
(13);

59 
	gd
.
	gv
 = 
d
.
tıh
->
th_off
 << 2;

60  
	gŒue
;

61 
	gT_TCP_WINDOW
:

62 
CHECK
(16);

63 
	gd
.
	gv
 = 
Áohs
(
d
.
tıh
->
th_wš
);

64  
	gŒue
;

65 
	gT_TCP_URP
:

66 
CHECK
(20);

67 
	gd
.
	gv
 = 
Áohs
(
d
.
tıh
->
th_u½
);

68  
	gŒue
;

69 
	gT_TCP_OPT
:

71 ià(!
d
.
tıh
 || 
Œª¥Üt_Ëngth
 < 13 || (d.tıh->
th_off
 > 5 &&ransport_length < ()(d.tcph->th_off << 2)))

72 
no_tı_İt
;

73 ià(
	gd
.
	gtıh
->
	gth_off
 <= 5)

74 
d
.
v±r
[0] = d.vptr[1] = 0;

76 
	gd
.
	gv±r
[0] = (cÚ¡ 
ušt8_t
 *è(
d
.
tıh
 + 1);

77 
	gd
.
	gv±r
[1] = 
d
.
v±r
[0] + (d.
tıh
->
th_off
 << 2è- (
şick_tı
);

79  
	gŒue
;

80 
	gT_TCP_NTOPT
:

81 
T_TCP_SACK
:

83 ià(!
d
.
tıh
 || 
Œª¥Üt_Ëngth
 < 13)

84 
no_tı_İt
;

85 ià(
	gd
.
	gtıh
->
	gth_off
 <= 5

86 || (
d
.
tıh
->
th_off
 =ğ8 && 
Œª¥Üt_Ëngth
 >= 24

87 && *(
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(
d
.
tıh
 + 1)è=ğ
htÚl
(0x0101080A)))

88 
d
.
v±r
[0] = d.vptr[1] = 0;

89 ià(
	gŒª¥Üt_Ëngth
 < ()(
	gd
.
	gtıh
->
	gth_off
 << 2))

90 
	gno_tı_İt
;

92 
	gd
.
	gv±r
[0] = (cÚ¡ 
ušt8_t
 *è(
d
.
tıh
 + 1);

93 
	gd
.
	gv±r
[1] = 
d
.
v±r
[0] + (d.
tıh
->
th_off
 << 2è- (
şick_tı
);

95  
	gŒue
;

97 #undeà
CHECK


100  
çl£
;

101 
	gno_tı_İt
:

102  
f›ld_missšg
(
d
, 
IP_PROTO_TCP
, 
Œª¥Üt_Ëngth
 + 1);

106 
tı_šjeù
(
Pack‘Odesc
& 
d
, cÚ¡ 
F›ldR—d”
 *
f
)

108 ià(!
	gd
.
make_
(
IP_PROTO_TCP
è|| !d.
make_Œª¥
())

111 
şick_tı
 *
	gtıh
 = 
d
.
p
->
tı_h—d”
();

112 
	gf
->
	gu£r_d©a
) {

113 
	gT_TCP_SEQ
:

114 
tıh
->
th_£q
 = 
htÚl
(
d
.
v
);

116 
	gT_TCP_ACK
:

117 
tıh
->
th_ack
 = 
htÚl
(
d
.
v
);

119 
	gT_TCP_FLAGS
:

120 
tıh
->
th_æags
 = 
d
.
v
;

121 
	gtıh
->
	gth_æags2
 = 
d
.
v
 >> 8;

123 
	gT_TCP_OFF
:

124 
d
.
v
 = (d.v + 3) & ~3;

125 ià((è
	gd
.
	gv
 > (è(
	gtıh
->
	gth_off
 << 2)) {

126 
	gmÜe
 = 
d
.
v
 - (
tıh
->
th_off
 << 2);

127 ià(!(
	gd
.
	gp
 = 
d
.
p
->
put
(
mÜe
)))

129 
	gtıh
 = 
d
.
p
->
tı_h—d”
();

130 
mem£t
(
d
.
p
->
Œª¥Üt_h—d”
(è+ d.
v
 - 
mÜe
, 
TCPOPT_EOL
, more);

132 
	gtıh
->
	gth_off
 = 
d
.
v
 >> 2;

134 
	gT_TCP_WINDOW
:

135 
tıh
->
th_wš
 = 
htÚs
(
d
.
v
);

137 
	gT_TCP_URP
:

138 
tıh
->
th_u½
 = 
htÚs
(
d
.
v
);

140 
	gT_TCP_OPT
:

141 
T_TCP_NTOPT
:

142 
T_TCP_SACK
: {

143 
d
.
have_tı_hl
 = 
Œue
;

144 ià(!
	gd
.
	gv±r
[0] || d.v±r[0] =ğ
d
.
v±r
[1])

146 
	gŞ’
 = 
d
.
v±r
[1] - d.vptr[0];

147 
	gth_off
 = ((
şick_tı
è+ 
Ş’
 + 3) & ~3;

148 ià(
	gd
.
	gp
->
Œª¥Üt_Ëngth
(è< 
	gth_off
) {

149 ià(!(
	gd
.
	gp
 = 
d
.
p
->
put
(
th_off
 - d.p->
Œª¥Üt_Ëngth
())))

151 
	gtıh
 = 
d
.
p
->
tı_h—d”
();

153 ià(
	gth_off
 > (è(
	gtıh
->th_off << 2))

154 
	gtıh
->
	gth_off
 = 
th_off
 >> 2;

155 
memıy
(
d
.
p
->
Œª¥Üt_h—d”
(è+ (
şick_tı
), d.
v±r
[0], 
Ş’
);

156 
mem£t
(
d
.
p
->
Œª¥Üt_h—d”
(è+ (
şick_tı
è+ 
Ş’
,

157 
TCPOPT_EOL
, 
th_off
 - 
Ş’
);

163 
tı_ou
(cÚ¡ 
Pack‘Desc
& 
d
, cÚ¡ 
F›ldWr™”
 *
f
)

165 
	gf
->
	gu£r_d©a
) {

166 
	gT_TCP_FLAGS
:

167 ià(
d
.
v
 =ğ(
TH_ACK
 | 
TH_PUSH
))

168 *
d
.
§
 << 'P' << 'A';

169 ià(
	gd
.
	gv
 =ğ
TH_ACK
)

170 *
d
.
§
 << 'A';

171 ià(
	gd
.
	gv
 == 0)

172 *
d
.
§
 << '.';

174 
	gæag
 = 0; flag < 9; flag++)

175 ià(
	gd
.
	gv
 & (1 << 
	gæag
))

176 *
	gd
.
	g§
 << 
	gtı_æags_wÜd
[
æag
];

178 
	gT_TCP_OPT
:

179 ià(!
d
.
v±r
[0] || d.vptr[0] == d.vptr[1])

180 *
d
.
§
 << '.';

182 
uÅ¬£_tı_İt
(*
d
.
§
, d.
v±r
[0], d.v±r[1] - d.v±r[0], 
DO_TCPOPT_ALL_NOPAD
);

184 
	gT_TCP_NTOPT
:

185 ià(!
d
.
v±r
[0] || d.vptr[0] == d.vptr[1])

186 *
d
.
§
 << '.';

188 
uÅ¬£_tı_İt
(*
d
.
§
, d.
v±r
[0], d.v±r[1] - d.v±r[0], 
DO_TCPOPT_NTALL
);

190 
	gT_TCP_SACK
:

191 ià(!
d
.
v±r
[0] || d.vptr[0] == d.vptr[1])

192 *
d
.
§
 << '.';

194 
uÅ¬£_tı_İt
(*
d
.
§
, d.
v±r
[0], d.v±r[1] - d.v±r[0], 
DO_TCPOPT_SACK
);

199 
boŞ
 
tı_ša
(
Pack‘Odesc
& 
d
, cÚ¡ 
SŒšg
 &
¡r
, cÚ¡ 
F›ldR—d”
 *
f
)

201 
	gf
->
	gu£r_d©a
) {

202 
	gT_TCP_FLAGS
:

203 ià(
¡r
.
equ®s
(".", 1))

204 
	gd
.
	gv
 = 0;

205 ià(!
	g¡r
)

206  
	gçl£
;

207 ià(
isdig™
((è
¡r
[0]))

208  
IÁArg
().
·r£
(
¡r
, 
d
.
v
è&& 
	gd
.
	gv
 < 0x1000;

210 
	gd
.
	gv
 = 0;

211 cÚ¡ *
	gs
 = 
¡r
.
begš
(); s !ğ¡r.
’d
(); s++)

212 ià(
ušt8_t
 
	gfm
 = 
IPSumm¬yDump
::
tı_æag_m­pšg
[(è*
s
])

213 
d
.
v
 |ğ1 << (
fm
 - 1);

215  
	gçl£
;

217  
	gŒue
;

219  
çl£
;

223 
tı_outb
(cÚ¡ 
Pack‘Desc
& 
d
, 
boŞ
 
ok
, cÚ¡ 
F›ldWr™”
 *
f
)

225 
	gf
->
	gu£r_d©a
) {

226 
	gT_TCP_OPT
:

227 ià(!
ok
 || !
d
.
v±r
[0] || d.vptr[0] == d.vptr[1])

228 *
d
.
§
 << '\0';

230 
uÅ¬£_tı_İt_bš¬y
(*
d
.
§
, d.
v±r
[0], d.v±r[1] - d.v±r[0], 
DO_TCPOPT_ALL
);

232 
	gT_TCP_NTOPT
:

233 ià(!
ok
 || !
d
.
v±r
[0] || d.vptr[0] == d.vptr[1])

234 *
d
.
§
 << '\0';

236 
uÅ¬£_tı_İt_bš¬y
(*
d
.
§
, d.
v±r
[0], d.v±r[1] - d.v±r[0], 
DO_TCPOPT_NTALL
);

238 
	gT_TCP_SACK
:

239 ià(!
ok
 || !
d
.
v±r
[0] || d.vptr[0] == d.vptr[1])

240 *
d
.
§
 << '\0';

242 
uÅ¬£_tı_İt_bš¬y
(*
d
.
§
, d.
v±r
[0], d.v±r[1] - d.v±r[0], 
DO_TCPOPT_SACK
);

247 cÚ¡ 
ušt8_t
* 
tı_šb
(
Pack‘Odesc
& 
d
, cÚ¡ ušt8_t* 
s
, cÚ¡ ušt8_t* 
’ds
, cÚ¡ 
F›ldR—d”
 *
f
)

249 
	gf
->
	gu£r_d©a
) {

250 
	gT_TCP_OPT
:

251 
T_TCP_NTOPT
:

252 
T_TCP_SACK
:

253 ià(
s
 + s[0] + 1 <ğ
’ds
) {

254 
d
.
v±r
[0] = 
s
 + 1;

255 
	gd
.
	gv±r
[1] = 
d
.
v±r
[0] + 
s
[0];

256  
	gs
 + s[0] + 1;

260  
	g’ds
;

264 
	gtı_İt_mask_m­pšg
[] = {

265 
DO_TCPOPT_PADDING
, DO_TCPOPT_PADDING,

266 
DO_TCPOPT_MSS
, 
DO_TCPOPT_WSCALE
,

267 
DO_TCPOPT_SACK
, DO_TCPOPT_SACK,

268 
DO_TCPOPT_UNKNOWN
, DO_TCPOPT_UNKNOWN,

269 
DO_TCPOPT_TIMESTAMP


272 
uÅ¬£_tı_İt
(
SŒšgAccum
& 
§
, cÚ¡ 
ušt8_t
* 
İt
, 
İt_Ën
, 
mask
)

274 
	gš™Ÿl_§_Ën
 = 
§
.
Ëngth
();

275 cÚ¡ 
ušt8_t
 *
	g’d_İt
 = 
İt
 + 
İt_Ën
;

276 cÚ¡ *
	g£p
 = "";

278 
	gİt
 < 
	g’d_İt
)

279 *
	gİt
) {

280 
	gTCPOPT_EOL
:

281 ià(
mask
 & 
DO_TCPOPT_PADDING
)

282 
§
 << 
£p
 << "eol";

283 
	gdÚe
;

284 
	gTCPOPT_NOP
:

285 ià(
mask
 & 
DO_TCPOPT_PADDING
) {

286 
§
 << 
£p
 << "nop";

287 
	g£p
 = ";";

289 
	gİt
++;

291 
	gTCPOPT_MAXSEG
:

292 ià(
İt
 + o±[1] > 
’d_İt
 || o±[1] !ğ
TCPOLEN_MAXSEG
)

293 
bad_İt
;

294 ià(!(
	gmask
 & 
	gDO_TCPOPT_MSS
))

295 
	gunknown
;

296 
	g§
 << 
	g£p
 << "mss" << ((
	gİt
[2] << 8) | opt[3]);

297 
	gİt
 +ğ
TCPOLEN_MAXSEG
;

298 
	g£p
 = ";";

300 
	gTCPOPT_WSCALE
:

301 ià(
İt
 + o±[1] > 
’d_İt
 || o±[1] !ğ
TCPOLEN_WSCALE
)

302 
bad_İt
;

303 ià(!(
	gmask
 & 
	gDO_TCPOPT_WSCALE
))

304 
	gunknown
;

305 
	g§
 << 
	g£p
 << "wsÿË" << ()(
	gİt
[2]);

306 
	gİt
 +ğ
TCPOLEN_WSCALE
;

307 
	g£p
 = ";";

309 
	gTCPOPT_SACK_PERMITTED
:

310 ià(
İt
 + o±[1] > 
’d_İt
 || o±[1] !ğ
TCPOLEN_SACK_PERMITTED
)

311 
bad_İt
;

312 ià(!(
	gmask
 & 
	gDO_TCPOPT_SACK
))

313 
	gunknown
;

314 
	g§
 << 
	g£p
 << "sackok";

315 
	gİt
 +ğ
TCPOLEN_SACK_PERMITTED
;

316 
	g£p
 = ";";

318 
	gTCPOPT_SACK
: {

319 ià(
İt
 + o±[1] > 
’d_İt
 || (opt[1] % 8 != 2))

320 
bad_İt
;

321 ià(!(
	gmask
 & 
	gDO_TCPOPT_SACK
))

322 
	gunknown
;

323 cÚ¡ 
ušt8_t
 *
	g’d_§ck
 = 
İt
 + opt[1];

324 
	gİt
 +ğ2; o± < 
	g’d_§ck
; opt += 8) {

325 
ušt32_t
 
buf
[2];

326 
memıy
(&
buf
[0], 
İt
, 8);

327 
	g§
 << 
	g£p
 << "§ck" << 
Áohl
(
buf
[0]) << '-' <<‚tohl(buf[1]);

328 
	g£p
 = ";";

332 
	gTCPOPT_TIMESTAMP
: {

333 ià(
İt
 + o±[1] > 
’d_İt
 || o±[1] !ğ
TCPOLEN_TIMESTAMP
)

334 
bad_İt
;

335 ià(!(
	gmask
 & 
	gDO_TCPOPT_TIMESTAMP
))

336 
	gunknown
;

337 
ušt32_t
 
	gbuf
[2];

338 
memıy
(&
buf
[0], 
İt
 + 2, 8);

339 
	g§
 << 
	g£p
 << "ts" << 
Áohl
(
buf
[0]) << ':' <<‚tohl(buf[1]);

340 
	gİt
 +ğ
TCPOLEN_TIMESTAMP
;

341 
	g£p
 = ";";

345 ià(
İt
 + o±[1] > 
’d_İt
 || opt[1] < 2)

346 
bad_İt
;

347 ià(!(
	gmask
 & 
	gDO_TCPOPT_UNKNOWN
))

348 
	gunknown
;

349 
	g§
 << 
	g£p
 << ()(
	gİt
[0]);

350 cÚ¡ 
ušt8_t
 *
	g’d_this_İt
 = 
İt
 + opt[1];

351 
	gİt_£p
 = '=';

352 
	gİt
 +ğ2; o± < 
	g’d_this_İt
; opt++) {

353 
	g§
 << 
	gİt_£p
 << ()(*
	gİt
);

354 
	gİt_£p
 = ':';

356 
	g£p
 = ";";

359 
	gunknown
:

360 
İt
 += (opt[1] >= 2 ? opt[1] : 128);

364 
	gdÚe
:

365 ià(
§
.
Ëngth
(è=ğ
š™Ÿl_§_Ën
)

366 
§
 << '.';

369 
	gbad_İt
:

370 
§
.
£t_Ëngth
(
š™Ÿl_§_Ën
);

371 
	g§
 << '?';

374 
uÅ¬£_tı_İt
(
SŒšgAccum
& 
§
, cÚ¡ 
şick_tı
* 
tıh
, 
mask
)

376 
uÅ¬£_tı_İt
(
§
, 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
 *>(
tıh
 + 1), (tıh->
th_off
 << 2è- (
şick_tı
), 
mask
);

379 
uÅ¬£_tı_İt_bš¬y
(
SŒšgAccum
& 
§
, cÚ¡ 
ušt8_t
* 
İt
, 
İt_Ën
, 
mask
)

381 ià(
	gmask
 =ğ()
DO_TCPOPT_ALL
) {

383 
§
.
­³nd
(()
İt_Ën
);

384 
	g§
.
­³nd
(
İt
, 
İt_Ën
);

387 cÚ¡ 
ušt8_t
 *
	g’d_İt
 = 
İt
 + 
İt_Ën
;

388 
	gš™Ÿl_§_Ën
 = 
§
.
Ëngth
();

389 
	g§
.
­³nd
('\0');

391 
	gİt
 < 
	g’d_İt
) {

393 ià(*
	gİt
 =ğ
TCPOPT_EOL
) {

394 ià(
mask
 & 
DO_TCPOPT_PADDING
)

395 
§
.
­³nd
(
İt
, 1);

396 
	gdÚe
;

397 } ià(*
	gİt
 =ğ
TCPOPT_NOP
) {

398 ià(
mask
 & 
DO_TCPOPT_PADDING
)

399 
§
.
­³nd
(
İt
, 1);

400 
	gİt
++;

405 ià(
	gİt
[1] < 2 || o± + o±[1] > 
	g’d_İt
)

408 
	gthis_cÚ‹Á
 = (*
İt
 > 
TCPOPT_TIMESTAMP
 ? ()
DO_TCPOPT_UNKNOWN
 : 
tı_İt_mask_m­pšg
[*opt]);

409 ià(
	gmask
 & 
	gthis_cÚ‹Á
)

410 
	g§
.
­³nd
(
İt
, opt[1]);

411 
	gİt
 +ğ
İt
[1];

414 
	gdÚe
:

415 
§
[
š™Ÿl_§_Ën
] = sa.
Ëngth
() - initial_sa_len - 1;

418 
uÅ¬£_tı_İt_bš¬y
(
SŒšgAccum
& 
§
, cÚ¡ 
şick_tı
 *
tıh
, 
mask
)

420 
uÅ¬£_tı_İt_bš¬y
(
§
, 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
 *>(
tıh
 + 1), (tıh->
th_off
 << 2è- (
şick_tı
), 
mask
);

423 
­³nd_Ãt_ušt32_t
(
SŒšgAccum
 &
§
, 
ušt32_t
 
u
)

425 
	g§
 << ()(
	gu
 >> 24) << ()(u >> 16) << ()(u >> 8) << ()u;

428 
boŞ
 
tı_İt_ša
(
Pack‘Odesc
 &
d
, cÚ¡ 
SŒšg
 &
¡r
, cÚ¡ 
F›ldR—d”
 *
f
)

430 ià(!
	g¡r
 || sŒ.
equ®s
(".", 1))

431  
	gŒue
;

432 ià(
	g¡r
.
equ®s
("-", 1))

433  
	gçl£
;

434 cÚ¡ 
ušt8_t
 *
	gs
 = 
»š‹½»t_ÿ¡
<cÚ¡ ušt8_ˆ*>(
¡r
.
begš
());

435 cÚ¡ 
ušt8_t
 *
	g’d
 = 
»š‹½»t_ÿ¡
<cÚ¡ ušt8_ˆ*>(
¡r
.
’d
());

436 
	gcÚ‹Ás
 = 
DO_TCPOPT_ALL
;

437 ià(
	gf
->
	gu£r_d©a
 =ğ
T_TCP_SACK
)

438 
cÚ‹Ás
 = 
DO_TCPOPT_SACK
;

439 ià(
	gf
->
	gu£r_d©a
 =ğ
T_TCP_NTOPT
)

440 
cÚ‹Ás
 = 
DO_TCPOPT_NTALL
;

441 
	gd
.
	g§
.
ş—r
();

444 
ušt32_t
 
	gu1
, 
	gu2
;

446 ià(
	gs
 + 3 < 
	g’d
 && 
memcmp
(
s
, "mss", 3) == 0

447 && (
cÚ‹Ás
 & 
DO_TCPOPT_MSS
)) {

448 
u1
 = 0x10000U;

449 
	gs
 = 
ı_š‹g”
(
s
 + 3, 
’d
, 0, &
u1
);

450 ià(
	gu1
 <= 0xFFFFU)

451 
d
.
§
 << ()
TCPOPT_MAXSEG
 << ()
TCPOLEN_MAXSEG
 << ()(
u1
 >> 8) << ()u1;

453 
	gbad_İt
;

454 } ià(
	gs
 + 6 < 
	g’d
 && 
memcmp
(
s
, "wscale", 6) == 0

455 && (
cÚ‹Ás
 & 
DO_TCPOPT_WSCALE
)) {

456 
u1
 = 256;

457 
	gs
 = 
ı_š‹g”
(
s
 + 6, 
’d
, 0, &
u1
);

458 ià(
	gu1
 <= 255)

459 
d
.
§
 << ()
TCPOPT_WSCALE
 << ()
TCPOLEN_WSCALE
 << ()
u1
;

461 
	gbad_İt
;

462 } ià(
	gs
 + 6 <ğ
’d
 && 
memcmp
(
s
, "sackok", 6) == 0

463 && (
cÚ‹Ás
 & 
DO_TCPOPT_SACK
)) {

464 
d
.
§
 << ()
TCPOPT_SACK_PERMITTED
 << ()
TCPOLEN_SACK_PERMITTED
;

465 
	gs
 += 6;

466 } ià(
	gs
 + 4 < 
	g’d
 && 
memcmp
(
s
, "sack", 4) == 0

467 && (
cÚ‹Ás
 & 
DO_TCPOPT_SACK
)) {

469 
§_pos
 = 
d
.
§
.
Ëngth
();

470 
	gd
.
	g§
 << ()
	gTCPOPT_SACK
 << ()0;

471 
	gs
 += 4;

473 cÚ¡ *
	gt
 = 
ı_š‹g”
(
s
, 
’d
, 0, &
u1
);

474 ià(
	gt
 >ğ
’d
 || (*
t
 != ':' && *t != '-'))

475 
bad_İt
;

476 
	gt
 = 
ı_š‹g”
(
t
 + 1, 
’d
, 0, &
u2
);

477 
­³nd_Ãt_ušt32_t
(
d
.
§
, 
u1
);

478 
­³nd_Ãt_ušt32_t
(
d
.
§
, 
u2
);

479 ià(
	gt
 < 
	gs
 + 3)

480 
	gbad_İt
;

481 
	gs
 = 
t
;

482 ià(
	gs
 + 5 >ğ
’d
 || 
memcmp
(
s
, ",sack", 5) != 0)

484 
	gs
 += 5;

486 
	gd
.
	g§
[
§_pos
 + 1] = ()(
d
.
§
.
Ëngth
() - sa_pos);

487 } ià(
	gs
 + 2 < 
	g’d
 && 
memcmp
(
s
, "ts", 2) == 0

488 && (
cÚ‹Ás
 & 
DO_TCPOPT_TIMESTAMP
)) {

489 cÚ¡ *
t
 = 
ı_š‹g”
(
s
 + 2, 
’d
, 0, &
u1
);

490 ià(
	gt
 >ğ
’d
 || *
t
 != ':')

491 
bad_İt
;

492 
	gt
 = 
ı_š‹g”
(
t
 + 1, 
’d
, 0, &
u2
);

493 ià(
	gd
.
	g§
.
Ëngth
() == 0)

494 
d
.
§
 << ()
TCPOPT_NOP
 << ()TCPOPT_NOP;

495 
	gd
.
	g§
 << ()
	gTCPOPT_TIMESTAMP
 << ()
	gTCPOLEN_TIMESTAMP
;

496 
­³nd_Ãt_ušt32_t
(
d
.
§
, 
u1
);

497 
­³nd_Ãt_ušt32_t
(
d
.
§
, 
u2
);

498 ià(
	gt
 < 
	gs
 + 5)

499 
	gbad_İt
;

500 
	gs
 = 
t
;

501 } ià(
	gs
 < 
	g’d
 && 
isdig™
(*
s
)

502 && (
	gcÚ‹Ás
 & 
	gDO_TCPOPT_UNKNOWN
)) {

503 
	gs
 = 
ı_š‹g”
(
s
, 
’d
, 0, &
u1
);

504 ià(
	gu1
 >= 256)

505 
bad_İt
;

506 
	gd
.
	g§
 << ()
	gu1
;

507 ià(
	gs
 + 1 < 
	g’d
 && * =ğ'=' && 
isdig™
(
s
[1])) {

508 
pos0
 = 
d
.
§
.
Ëngth
();

509 
	gd
.
	g§
 << ()0;

511 
	gs
 = 
ı_š‹g”
(
s
 + 1, 
’d
, 0, &
u1
);

512 ià(
	gu1
 >= 256)

513 
bad_İt
;

514 
	gd
.
	g§
 << ()
	gu1
;

515 } 
	gs
 + 1 < 
	g’d
 && * =ğ':' && 
isdig™
(
s
[1]));

516 ià(
	gd
.
	g§
.
Ëngth
(è> 
	gpos0
 + 254)

517 
	gbad_İt
;

518 
	gd
.
	g§
[
pos0
] = ()(
d
.
§
.
Ëngth
() -…os0 + 1);

520 } ià(
	gs
 + 3 <ğ
’d
 && 
memcmp
(
s
, "nop", 3) == 0

521 && (
cÚ‹Ás
 & 
DO_TCPOPT_PADDING
)) {

522 
d
.
§
 << ()
TCPOPT_NOP
;

523 
	gs
 += 3;

524 } ià(
	gs
 + 3 <ğ
’d
 && 
¡ºcmp
((cÚ¡ *è
s
, "eol", 3) == 0

525 && (
cÚ‹Ás
 & 
DO_TCPOPT_PADDING
)

526 && (
s
 + 3 =ğ
’d
 || s[3] != ',')) {

527 
d
.
§
 << ()
TCPOPT_EOL
;

528 
	gs
 += 3;

530 
	gbad_İt
;

532 ià(
	gs
 >ğ
’d
 || 
is¥aû
(*
s
)) {

534 
d
.
§
.
Ëngth
(è> 40 && d.§[0] =ğ
TCPOPT_NOP
) {

535 
memmove
(&
d
.
§
[0], &d.§[1], d.§.
Ëngth
() - 1);

536 
	gd
.
	g§
.
pİ_back
();

539 ià(
	gd
.
	g§
.
Ëngth
() > 40)

540 
	gbad_İt
;

542 
	gd
.
	gv±r
[0] = 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
 *>(
d
.
§
.
begš
());

543 
	gd
.
	gv±r
[1] = 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
 *>(
d
.
§
.
’d
());

544  
	gŒue
;

545 } ià(*
	gs
 !ğ',' && *
s
 != ';')

546 
bad_İt
;

548 
	gs
++;

551 
	gbad_İt
:

552  
çl£
;

555 cÚ¡ 
F›ldWr™”
 
	gtı_wr™”s
[] = {

556 { "tı_£q", 
B_4
, 
T_TCP_SEQ
,

557 
_´•¬e
, 
tı_exŒaù
, 
num_ou
, 
outb
 },

558 { "tı_ack", 
B_4
, 
T_TCP_ACK
,

559 
_´•¬e
, 
tı_exŒaù
, 
num_ou
, 
outb
 },

560 { "tı_off", 
B_1
, 
T_TCP_OFF
,

561 
_´•¬e
, 
tı_exŒaù
, 
num_ou
, 
outb
 },

562 { "tı_æags", 
B_1
, 
T_TCP_FLAGS
,

563 
_´•¬e
, 
tı_exŒaù
, 
tı_ou
, 
outb
 },

564 { "tı_wšdow", 
B_2
, 
T_TCP_WINDOW
,

565 
_´•¬e
, 
tı_exŒaù
, 
num_ou
, 
outb
 },

566 { "tı_u½", 
B_2
, 
T_TCP_URP
,

567 
_´•¬e
, 
tı_exŒaù
, 
num_ou
, 
outb
 },

568 { "tı_İt", 
B_SPECIAL
, 
T_TCP_OPT
,

569 
_´•¬e
, 
tı_exŒaù
, 
tı_ou
, 
tı_outb
 },

570 { "tı_Áİt", 
B_SPECIAL
, 
T_TCP_NTOPT
,

571 
_´•¬e
, 
tı_exŒaù
, 
tı_ou
, 
tı_outb
 },

572 { "tı_§ck", 
B_SPECIAL
, 
T_TCP_SACK
,

573 
_´•¬e
, 
tı_exŒaù
, 
tı_ou
, 
tı_outb
 }

576 cÚ¡ 
F›ldR—d”
 
	gtı_»ad”s
[] = {

577 { "tı_£q", 
B_4
, 
T_TCP_SEQ
, 
Üd”_Œª¥
,

578 
num_ša
, 
šb
, 
tı_šjeù
 },

579 { "tı_ack", 
B_4
, 
T_TCP_ACK
, 
Üd”_Œª¥
,

580 
num_ša
, 
šb
, 
tı_šjeù
 },

581 { "tı_off", 
B_1
, 
T_TCP_OFF
, 
Üd”_Œª¥
 - 1,

582 
num_ša
, 
šb
, 
tı_šjeù
 },

583 { "tı_æags", 
B_1
, 
T_TCP_FLAGS
, 
Üd”_Œª¥
,

584 
tı_ša
, 
šb
, 
tı_šjeù
 },

585 { "tı_wšdow", 
B_2
, 
T_TCP_WINDOW
, 
Üd”_Œª¥
,

586 
num_ša
, 
šb
, 
tı_šjeù
 },

587 { "tı_u½", 
B_2
, 
T_TCP_URP
, 
Üd”_Œª¥
,

588 
num_ša
, 
šb
, 
tı_šjeù
 },

589 { "tı_İt", 
B_SPECIAL
, 
T_TCP_OPT
, 
Üd”_Œª¥
 + 3,

590 
tı_İt_ša
, 
tı_šb
, 
tı_šjeù
 },

591 { "tı_Áİt", 
B_SPECIAL
, 
T_TCP_NTOPT
, 
Üd”_Œª¥
 + 2,

592 
tı_İt_ša
, 
tı_šb
, 
tı_šjeù
 },

593 { "tı_§ck", 
B_SPECIAL
, 
T_TCP_SACK
, 
Üd”_Œª¥
 + 1,

594 
tı_İt_ša
, 
tı_šb
, 
tı_šjeù
 }

597 cÚ¡ 
F›ldSynÚym
 
	gtı_synÚyms
[] = {

605 
	gIPSumm¬yDump_TCP
::
	$¡©ic_š™Ÿlize
()

607 
usšg
 
Çme¥aû
 
IPSumm¬yDump
;

608 
size_t
 
i
 = 0; i < (
tı_wr™”s
) / (tcp_writers[0]); ++i)

609 
F›ldWr™”
::
	`add
(&
tı_wr™”s
[
i
]);

610 
size_t
 
i
 = 0; i < (
tı_»ad”s
) / (tcp_readers[0]); ++i)

611 
F›ldR—d”
::
	`add
(&
tı_»ad”s
[
i
]);

612 
size_t
 
i
 = 0; i < (
tı_synÚyms
) / (tcp_synonyms[0]); ++i)

613 
F›ldSynÚym
::
	`add
(&
tı_synÚyms
[
i
]);

614 
	}
}

616 
	gIPSumm¬yDump_TCP
::
	$¡©ic_ş—nup
()

618 
usšg
 
Çme¥aû
 
IPSumm¬yDump
;

619 
size_t
 
i
 = 0; i < (
tı_wr™”s
) / (tcp_writers[0]); ++i)

620 
F›ldWr™”
::
	`»move
(&
tı_wr™”s
[
i
]);

621 
size_t
 
i
 = 0; i < (
tı_»ad”s
) / (tcp_readers[0]); ++i)

622 
F›ldR—d”
::
	`»move
(&
tı_»ad”s
[
i
]);

623 
size_t
 
i
 = 0; i < (
tı_synÚyms
) / (tcp_synonyms[0]); ++i)

624 
F›ldSynÚym
::
	`»move
(&
tı_synÚyms
[
i
]);

625 
	}
}

627 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
IPSumm¬yDump
)

628 
	$ELEMENT_PROVIDES
(
IPSumm¬yDump_TCP
)

629 
CLICK_ENDDECLS


	@analysis/ipsumdump_tcp.hh

1 #iâdeà
CLICK_IPSUMDUMP_TCP_HH


2 
	#CLICK_IPSUMDUMP_TCP_HH


	)

3 
	~"sumdumpšfo.hh
"

4 
CLICK_DECLS


6 şas 
	cIPSumm¬yDump_TCP
 { 
	mpublic
:

7 
¡©ic_š™Ÿlize
();

8 
¡©ic_ş—nup
();

11 
	gCLICK_ENDDECLS


	@analysis/ipsumdump_udp.cc

21 
	~<şick/cÚfig.h
>

23 
	~"sumdump_udp.hh
"

24 
	~<şick/·ck‘.hh
>

25 
	~<şick/Çmešfo.hh
>

26 
	~<şickÃt/.h
>

27 
	~<şickÃt/tı.h
>

28 
	~<şickÃt/udp.h
>

29 
	~<şickÃt/icmp.h
>

30 
	~<şick/cÚå¬£.hh
>

31 
CLICK_DECLS


33 
Çme¥aû
 
	gIPSumm¬yDump
 {

35 ’um { 
	gT_UDP_LEN
 };

37 
boŞ
 
udp_exŒaù
(
Pack‘Desc
& 
d
, cÚ¡ 
F›ldWr™”
 *
f
)

39 
	gŒª¥Üt_Ëngth
 = 
d
.
Œª¥Üt_Ëngth
();

40 
	gf
->
	gu£r_d©a
) {

42 
	#CHECK
(
l
èdØ{ ià(!
d
.
udph
 || 
Œª¥Üt_Ëngth
 < (l)è 
	`f›ld_missšg
(d, 
IP_PROTO_UDP
, (l)); } 0)

	)

44 
	gT_UDP_LEN
:

45 
CHECK
(6);

46 
	gd
.
	gv
 = 
Áohs
(
d
.
udph
->
uh_uËn
);

47  
	gŒue
;

49 #undeà
CHECK


52  
çl£
;

56 
udp_šjeù
(
Pack‘Odesc
& 
d
, cÚ¡ 
F›ldR—d”
 *
f
)

58 ià(!
	gd
.
make_
(0è|| !d.
make_Œª¥
())

60 
	g_p
 = 
d
.
p
->
_h—d”
()->
_p
;

61 ià(
	g_p
 && ip_°!ğ
IP_PROTO_UDP
 && 
_p
 !ğ
IP_PROTO_UDPLITE
)

63 ià(
	gd
.
	gp
->
Œª¥Üt_Ëngth
(è< (è(
	gşick_udp
)

64 && !(
	gd
.
	gp
 = 
d
.
p
->
put
((
şick_udp
è- d.p->
Œª¥Üt_Ëngth
())))

67 
	gf
->
	gu£r_d©a
) {

68 
	gT_UDP_LEN
:

69 
d
.
p
->
udp_h—d”
()->
uh_uËn
 = 
htÚs
(d.
v
);

74 cÚ¡ 
F›ldWr™”
 
	gudp_wr™”s
[] = {

75 { "udp_Ën", 
B_4
, 
T_UDP_LEN
,

76 
_´•¬e
, 
udp_exŒaù
, 
num_ou
, 
outb
 }

79 cÚ¡ 
F›ldR—d”
 
	gudp_»ad”s
[] = {

80 { "udp_Ën", 
B_4
, 
T_UDP_LEN
, 
Üd”_Œª¥
,

81 
num_ša
, 
šb
, 
udp_šjeù
 }

86 
	gIPSumm¬yDump_UDP
::
	$¡©ic_š™Ÿlize
()

88 
usšg
 
Çme¥aû
 
IPSumm¬yDump
;

89 
size_t
 
i
 = 0; i < (
udp_wr™”s
) / (udp_writers[0]); ++i)

90 
F›ldWr™”
::
	`add
(&
udp_wr™”s
[
i
]);

91 
size_t
 
i
 = 0; i < (
udp_»ad”s
) / (udp_readers[0]); ++i)

92 
F›ldR—d”
::
	`add
(&
udp_»ad”s
[
i
]);

93 
	}
}

95 
	gIPSumm¬yDump_UDP
::
	$¡©ic_ş—nup
()

97 
usšg
 
Çme¥aû
 
IPSumm¬yDump
;

98 
size_t
 
i
 = 0; i < (
udp_wr™”s
) / (udp_writers[0]); ++i)

99 
F›ldWr™”
::
	`»move
(&
udp_wr™”s
[
i
]);

100 
size_t
 
i
 = 0; i < (
udp_»ad”s
) / (udp_readers[0]); ++i)

101 
F›ldR—d”
::
	`»move
(&
udp_»ad”s
[
i
]);

102 
	}
}

104 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
IPSumm¬yDump
)

105 
	$ELEMENT_PROVIDES
(
IPSumm¬yDump_UDP
)

106 
CLICK_ENDDECLS


	@analysis/ipsumdump_udp.hh

1 #iâdeà
CLICK_IPSUMDUMP_UDP_HH


2 
	#CLICK_IPSUMDUMP_UDP_HH


	)

3 
	~"sumdumpšfo.hh
"

4 
CLICK_DECLS


6 şas 
	cIPSumm¬yDump_UDP
 { 
	mpublic
:

7 
¡©ic_š™Ÿlize
();

8 
¡©ic_ş—nup
();

11 
	gCLICK_ENDDECLS


	@analysis/ipsumdumpinfo.cc

21 
	~<şick/cÚfig.h
>

22 
	~"sumdumpšfo.hh
"

23 
	~<şick/·ck‘.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
	~<şick/¬gs.hh
>

26 
	~<şick/æowid.hh
>

27 
	~<şickÃt/.h
>

28 
	~<şickÃt/tı.h
>

29 
	~<şickÃt/udp.h
>

30 
	~<şickÃt/icmp.h
>

31 
CLICK_DECLS


33 
	gVeùÜ
<cÚ¡ *> *
	gwr™”s
;

34 
	gVeùÜ
<cÚ¡ *> *
	g»ad”s
;

35 
	gVeùÜ
<cÚ¡ *> *
	gsynÚyms
;

37 
f›ld_add
(
VeùÜ
<cÚ¡ *> *&
vec
, cÚ¡ *
v®ue
)

39 ià(!
	gvec
)

40 
	gvec
 = 
Ãw
 
VeùÜ
<const *>;

41 
	gvec
->
push_back
(
v®ue
);

44 
f›ld_»move
(
VeùÜ
<cÚ¡ *> *&
vec
, cÚ¡ *
v®ue
)

46 ià(
	gvec
) {

47 cÚ¡ **
	gx
 = 
fšd
(
vec
->
begš
(), vec->
’d
(), 
v®ue
);

48 ià(
	gx
 !ğ
vec
->
’d
())

49 
vec
->
”a£
(
x
);

53 cÚ¡ *
f›ld_fšd
(
VeùÜ
<cÚ¡ *> *&
vec
, cÚ¡ 
SŒšg
 &
Çme
)

55 ià(
	gvec
)

56 cÚ¡ **
	gx
 = 
vec
->
begš
(); x !ğvec->
’d
(); ++x) {

57 cÚ¡ 
	gIPSumm¬yDump
::
F›ldSynÚym
 *
fs
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
IPSumm¬yDump
::F›ldSynÚym *>(*
x
);

58 ià(
	gÇme
 =ğ
fs
->
Çme
)

59  *
x
;

64 
	gIPSumm¬yDumpInfo
::
	$¡©ic_ş—nup
()

66 
d–‘e
 
wr™”s
;

67 
d–‘e
 
»ad”s
;

68 
d–‘e
 
synÚyms
;

69 
wr™”s
 = 
»ad”s
 = 
synÚyms
 = 0;

70 
	}
}

77 
Çme¥aû
 
	gIPSumm¬yDump
 {

79 
	gF›ldWr™”
::
add
(cÚ¡ 
F›ldWr™”
 *
w
)

81 
f›ld_add
(
wr™”s
, 
w
);

84 
	gF›ldWr™”
::
»move
(cÚ¡ 
F›ldWr™”
 *
w
)

86 
f›ld_»move
(
wr™”s
, 
w
);

89 
	gF›ldR—d”
::
add
(cÚ¡ 
F›ldR—d”
 *
r
)

91 
f›ld_add
(
»ad”s
, 
r
);

94 
	gF›ldR—d”
::
»move
(cÚ¡ 
F›ldR—d”
 *
r
)

96 
f›ld_»move
(
»ad”s
, 
r
);

99 
	gF›ldSynÚym
::
add
(cÚ¡ 
F›ldSynÚym
 *
s
)

101 
f›ld_add
(
synÚyms
, 
s
);

104 
	gF›ldSynÚym
::
»move
(cÚ¡ 
F›ldSynÚym
 *
s
)

106 
f›ld_»move
(
synÚyms
, 
s
);

110 
SŒšg
 
upd©e_Çme
(cÚ¡ SŒšg &
Çme
)

113 cÚ¡ *
	gs
 = 
fšd
(
Çme
, ' ');

114 ià(
	gs
 !ğ
Çme
.
’d
())

115  
Çme
.
sub¡ršg
Òame.
begš
(), 
s
) + "_"

116 + 
	gÇme
.
sub¡ršg
(
s
 + 1, 
Çme
.
’d
());

119 ià(
fšd
(
Çme
, '_'è=ğÇme.
’d
())

120  "_" + 
Çme
;

123  
SŒšg
();

126 
boŞ
 
nÚe_exŒaù
(
Pack‘Desc
 &, cÚ¡ 
F›ldWr™”
 *)

128  
	gçl£
;

131 cÚ¡ 
F›ldR—d”
 
	gnuÎ_»ad”
 = {

132 "nÚe", 
B_0
, 0, 
Üd”_ªno
,

133 
num_ša
, 
šb
, 0

136 cÚ¡ 
F›ldWr™”
 
	gnuÎ_wr™”
 = {

137 "nÚe", 
B_0
, 0,

138 0, 
nÚe_exŒaù
, 
num_ou
, 
outb


141 cÚ¡ 
F›ldR—d”
 *
	gF›ldR—d”
::
fšd
(cÚ¡ 
SŒšg
 &
Çme
)

143 ià(cÚ¡ *
x
 = 
f›ld_fšd
(
synÚyms
, 
Çme
)) {

144 cÚ¡ 
F›ldSynÚym
 *
	gs
 = 
»š‹½»t_ÿ¡
<cÚ¡ F›ldSynÚym *>(
x
);

145  
fšd
(
s
->
synÚym
);

147 ià(cÚ¡ *
	gx
 = 
f›ld_fšd
(
»ad”s
, 
Çme
))

148  
	g»š‹½»t_ÿ¡
<cÚ¡ 
	gF›ldR—d”
 *>(
	gx
);

149 ià(
SŒšg
 
	gÃw_Çme
 = 
upd©e_Çme
(
Çme
))

150  
fšd
(
Ãw_Çme
);

154 cÚ¡ 
F›ldWr™”
 *
	gF›ldWr™”
::
fšd
(cÚ¡ 
SŒšg
 &
Çme
)

156 ià(cÚ¡ *
x
 = 
f›ld_fšd
(
synÚyms
, 
Çme
)) {

157 cÚ¡ 
F›ldSynÚym
 *
	gs
 = 
»š‹½»t_ÿ¡
<cÚ¡ F›ldSynÚym *>(
x
);

158  
fšd
(
s
->
synÚym
);

160 ià(cÚ¡ *
	gx
 = 
f›ld_fšd
(
wr™”s
, 
Çme
))

161  
	g»š‹½»t_ÿ¡
<cÚ¡ 
	gF›ldWr™”
 *>(
	gx
);

162 ià(
SŒšg
 
	gÃw_Çme
 = 
upd©e_Çme
(
Çme
))

163  
fšd
(
Ãw_Çme
);

167 cÚ¡ *
f›ld_missšg_´Ùo_Çme
(
´Ùo
)

169 
	g´Ùo
) {

170 
	gIP_PROTO_TCP
:

172 
	gIP_PROTO_UDP
:

174 
	gIP_PROTO_ICMP
:

176 
	gIP_PROTO_TCP_OR_UDP
:

183 
boŞ
 
h¬d_f›ld_missšg
(cÚ¡ 
Pack‘Desc
 &
d
, 
´Ùo
, 
l
)

185 ià(
	gd
.
	gbad_§
 && !*d.bad_sa) {

186 ià(
	g´Ùo
 =ğ
MISSING_ETHERNET
)

187 *
d
.
bad_§
 << "!bad Ethernet header\n";

188 ià(!
	gd
.
	gh
)

189 *
	gd
.
	gbad_§
 << "!bad‚o IP header\n";

190 ià(
	g´Ùo
 =ğ
MISSING_IP
)

191 *
d
.
bad_§
 << "!badruncated IP header capture\n";

192 ià(
	gd
.
ÃtwÜk_Ëngth
(è> (è
off£tof
(
şick_
, 
_p
)

193 && ((
	g´Ùo
 > 
	gMISSING_IP
 &&…roto < 256

194 && 
	gd
.
	gh
->
	g_p
 !ğ
´Ùo
)

195 || (
´Ùo
 =ğ
IP_PROTO_TCP_OR_UDP


196 && 
d
.
h
->
_p
 !ğ
IP_PROTO_TCP


197 && 
d
.
h
->
_p
 !ğ
IP_PROTO_UDP
)))

199  
çl£
;

200 ià(!
IP_FIRSTFRAG
(
d
.
h
))

201 *
	gd
.
	gbad_§
 << "!bad f¿gm’‹d " << 
f›ld_missšg_´Ùo_Çme
(
´Ùo
) << " header\n";

202 ià((è(
	gd
.
Œª¥Üt_Ëngth
(è+ 
EXTRA_LENGTH_ANNO
(
d
.
p
)è>ğ
l
)

203 *
d
.
bad_§
 << "!badrunÿ‹d " << 
f›ld_missšg_´Ùo_Çme
(
´Ùo
) << " header capture\n";

205 *
	gd
.
	gbad_§
 << "!badrunÿ‹d " << 
f›ld_missšg_´Ùo_Çme
(
´Ùo
) << " header\n";

207  
	gçl£
;

210 #ifdeà
i386


211 
	#PUT4NET
(
p
, 
d
è*
»š‹½»t_ÿ¡
<
ušt32_t
 *>(Õ)èğ(d)

	)

212 
	#PUT4
(
p
, 
d
è*
»š‹½»t_ÿ¡
<
ušt32_t
 *>(Õ)èğ
	`htÚl
((d))

	)

213 
	#PUT2
(
p
, 
d
è*
»š‹½»t_ÿ¡
<
ušt16_t
 *>(Õ)èğ
	`htÚs
((d))

	)

214 
	#GET4NET
(
p
è*
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(Õ))

	)

215 
	#GET4
(
p
è
	`Áohl
(*
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(Õ)))

	)

216 
	#GET2
(
p
è
	`Áohs
(*
»š‹½»t_ÿ¡
<cÚ¡ 
ušt16_t
 *>(Õ)))

	)

218 
	#PUT4NET
(
p
, 
d
èdØ{ 
ušt32_t
 
d__
 = 
	`Áohl
((d)); (p)[0] = d__>>24; (p)[1] = d__>>16; (p)[2] = d__>>8; (p)[3] = d__; } 0)

	)

219 
	#PUT4
(
p
, 
d
èdØ{ (p)[0] = (d)>>24; (p)[1] = (d)>>16; (p)[2] = (d)>>8; (p)[3] = (d); } 0)

	)

220 
	#PUT2
(
p
, 
d
èdØ{ (p)[0] = (d)>>8; (p)[1] = (d); } 0)

	)

221 
	#GET4NET
(
p
è
	`htÚl
(Õ)[0]<<24 | (p)[1]<<16 | (p)[2]<<8 | (p)[3])

	)

222 
	#GET4
(
p
è(Õ)[0]<<24 | (p)[1]<<16 | (p)[2]<<8 | (p)[3])

	)

223 
	#GET2
(
p
è(Õ)[0]<<8 | (p)[1])

	)

225 
	#PUT1
(
p
, 
d
è(Õ)[0] = (d))

	)

227 
num_ou
(cÚ¡ 
Pack‘Desc
& 
d
, cÚ¡ 
F›ldWr™”
 *
f
)

229 ià(
	gf
->
	gty³
 =ğ
B_8
) {

230 #ià
HAVE_INT64_TYPES


231 
ušt64_t
 
v
 = ((ušt64_tè
d
.
u32
[1] << 32) | d.u32[0];

232 *
	gd
.
	g§
 << 
	gv
;

235 *
	gd
.
	g§
 << d.
	gu32
[0];

238 *
	gd
.
	g§
 << d.
	gv
;

241 
boŞ
 
num_ša
(
Pack‘Odesc
& 
d
, cÚ¡ 
SŒšg
 &
s
, cÚ¡ 
F›ldR—d”
 *
f
)

243 #ià
HAVE_INT64_TYPES


244 ià(
	gf
->
	gty³
 =ğ
B_8
) {

245 
ušt64_t
 
v
;

246 ià(!
IÁArg
().
·r£
(
s
, 
v
))

247  
	gçl£
;

248 
	gd
.
	gu32
[0] = 
v
;

249 
	gd
.
	gu32
[1] = 
v
 >> 32;

250  
	gŒue
;

255 ià(!
IÁArg
().
·r£
(
s
, 
d
.
v
))

256  
	gçl£
;

257 ià((
	gf
->
	gty³
 =ğ
B_1
 && 
d
.
v
 > 255è|| (
f
->
ty³
 =ğ
B_2
 && d.v > 65535))

258  
çl£
;

259  
	gŒue
;

262 
outb
(cÚ¡ 
Pack‘Desc
& 
d
, 
boŞ
, cÚ¡ 
F›ldWr™”
 *
f
)

264 
	gf
->
	gty³
) {

265 
	gB_0
:

267 
	gB_1
: {

268 * 
c
 = 
d
.
§
->
ex‹nd
(1);

269 
PUT1
(
c
, 
d
.
v
);

272 
	gB_2
: {

273 * 
c
 = 
d
.
§
->
ex‹nd
(2);

274 
PUT2
(
c
, 
d
.
v
);

277 
	gB_4
: {

278 * 
c
 = 
d
.
§
->
ex‹nd
(4);

279 
PUT4
(
c
, 
d
.
v
);

282 
	gB_6PTR
: {

283 * 
c
 = 
d
.
§
->
ex‹nd
(6);

284 
memıy
(
c
, 
d
.
v±r
[0], 6);

287 
	gB_8
: {

288 * 
c
 = 
d
.
§
->
ex‹nd
(8);

289 
PUT4
(
c
, 
d
.
u32
[1]);

290 
PUT4
(
c
 + 4, 
d
.
u32
[0]);

293 
	gB_4NET
: {

294 * 
c
 = 
d
.
§
->
ex‹nd
(4);

295 
PUT4NET
(
c
, 
d
.
v
);

301 cÚ¡ 
ušt8_t
 *
šb
(
Pack‘Odesc
& 
d
, cÚ¡ ušt8_ˆ*
s
, cÚ¡ ušt8_ˆ*
’d
, cÚ¡ 
F›ldR—d”
 *
f
)

303 
	gd
.
	gv
 = 0;

304 
	gf
->
	gty³
) {

305 
	gB_0
:

306  
s
;

307 
	gB_1
:

308 ià(
s
 >ğ
’d
)

309 
bad
;

310 
	gd
.
	gv
 = 
s
[0];

311  
	gs
 + 1;

312 
	gB_2
:

313 ià(
s
 + 1 >ğ
’d
)

314 
bad
;

315 
	gd
.
	gv
 = 
GET2
(
s
);

316  
	gs
 + 2;

317 
	gB_4
:

318 ià(
s
 + 3 >ğ
’d
)

319 
bad
;

320 
	gd
.
	gv
 = 
GET4
(
s
);

321  
	gs
 + 4;

322 
	gB_6PTR
:

323 ià(
s
 + 5 >ğ
’d
)

324 
bad
;

325 
memıy
(
d
.
u8
, 
s
, 6);

326  
	gs
 + 6;

327 
	gB_8
:

328 ià(
s
 + 7 >ğ
’d
)

329 
bad
;

330 
	gd
.
	gu32
[1] = 
GET4
(
s
);

331 
	gd
.
	gu32
[0] = 
GET4
(
s
 + 4);

332  
	gs
 + 8;

333 
	gB_4NET
:

334 ià(
s
 + 3 >ğ
’d
)

335 
bad
;

336 
	gd
.
	gv
 = 
GET4NET
(
s
);

337  
	gs
 + 4;

338 
	gbad
:

340 
d
.
ş—r_v®ues
();

341  
	g’d
;

347 
_´•¬e
(
Pack‘Desc
 &
d
, cÚ¡ 
F›ldWr™”
 *)

349 
Pack‘
 *
	gp
 = 
cÚ¡_ÿ¡
<Pack‘ *>(
d
.
p
);

350 
	gd
.
	gh
 = (
p
->
has_ÃtwÜk_h—d”
(è?…->
_h—d”
() : 0);

351 
	gd
.
	gtıh
 = (
p
->
has_Œª¥Üt_h—d”
(è?…->
tı_h—d”
() : 0);

352 
	gd
.
	gudph
 = (
p
->
has_Œª¥Üt_h—d”
(è?…->
udp_h—d”
() : 0);

353 
	gd
.
	gicmph
 = (
p
->
has_Œª¥Üt_h—d”
(è?…->
icmp_h—d”
() : 0);

355 
	#BAD
(
msg
, 
hdr
èdØ{ ià(
d
.
bad_§
 && !*d.bad_§è*d.bad_§ << "!bad " << msg << '\n'; hd¸ğ0; } 0)

	)

356 
	#BAD2
(
msg
, 
v®
, 
hdr
èdØ{ ià(
d
.
bad_§
 && !*d.bad_§è*d.bad_§ << "!bad " << msg << v® << '\n'; hd¸ğ0; } 0)

	)

358 ià(!
	gd
.
	gh
)

360 ià(
	gp
->
ÃtwÜk_Ëngth
(è< (è
off£tof
(
şick_
, 
_id
))

361 
BAD
("Œunÿ‹d IP h—d”", 
d
.
h
);

362 ià(
	gd
.
	gh
->
	g_v
 != 4)

363 
BAD2
("IP v”siÚ ", 
d
.
h
->
_v
, d.iph);

364 ià(
	gd
.
	gh
->
	g_hl
 < ((
	gşick_
) >> 2))

365 
BAD2
("IP h—d”†’gth ", 
d
.
h
->
_hl
, d.iph);

366 ià(
Áohs
(
d
.
h
->
_Ën
è< (
	gd
.
	gh
->
	g_hl
 << 2))

367 
BAD2
("IP†’gth ", 
Áohs
(
d
.
h
->
_Ën
), d.iph);

370 
	g_Ën
 = 
Áohs
(
d
.
h
->
_Ën
);

371 ià(
	gp
->
ÃtwÜk_Ëngth
(è> 
	g_Ën
) {

372 
SET_EXTRA_LENGTH_ANNO
(
p
, 
EXTRA_LENGTH_ANNO
Õè+…->
ÃtwÜk_Ëngth
(è- 
_Ën
);

373 
	gd
.
	g·d
 = 
p
->
ÃtwÜk_Ëngth
(è- 
_Ën
;

374 } ià(
	gd
.
	gÿ»ful_Œunc
 && 
	gp
->
ÃtwÜk_Ëngth
(è+ 
EXTRA_LENGTH_ANNO
(
p
è< (
	gušt32_t
è
	g_Ën
) {

376 
	gsü©ch
;

377 
BAD2
("Œunÿ‹d IP missšg ", (
Áohs
(
d
.
h
->
_Ën
è- 
p
->
ÃtwÜk_Ëngth
(è- 
EXTRA_LENGTH_ANNO
Õ)), 
sü©ch
);

378 (è
	gsü©ch
;

383 ià(!
	gd
.
	gh
 || !d.
	gtıh


384 || 
	gd
.
ÃtwÜk_Ëngth
(è<ğ(
ušt32_t
)(
d
.
h
->
_hl
 << 2)

385 || 
d
.
h
->
_p
 !ğ
IP_PROTO_TCP


386 || !
IP_FIRSTFRAG
(
d
.
h
))

387 
d
.
tıh
 = 0;

388 ià(
	gd
.
Œª¥Üt_Ëngth
() > 12

389 && 
	gd
.
	gtıh
->
	gth_off
 < ((
	gşick_tı
) >> 2))

390 
BAD2
("TCP h—d”†’gth ", 
d
.
tıh
->
th_off
, d.tcph);

393 ià(!
	gd
.
	gh
 || !d.
	gudph


394 || 
	gd
.
ÃtwÜk_Ëngth
(è<ğ(
ušt32_t
)(
d
.
h
->
_hl
 << 2)

395 || 
d
.
h
->
_p
 !ğ
IP_PROTO_UDP


396 || !
IP_FIRSTFRAG
(
d
.
h
))

397 
d
.
udph
 = 0;

400 ià(!
	gd
.
	gh
 || !d.
	gicmph


401 || 
	gd
.
ÃtwÜk_Ëngth
(è<ğ(
ušt32_t
)(
d
.
h
->
_hl
 << 2)

402 || 
d
.
h
->
_p
 !ğ
IP_PROTO_ICMP


403 || !
IP_FIRSTFRAG
(
d
.
h
))

404 
d
.
icmph
 = 0;

405 #undeà
BAD


406 #undeà
BAD2


409 ià(
	gd
.
	gh
 && 
EXTRA_LENGTH_ANNO
(
p
) > 0) {

410 
ušt32_t
 
	gfuÎ_Ën
 = 
d
.
ÃtwÜk_Ëngth
(è+ 
EXTRA_LENGTH_ANNO
(
p
);

411 ià(
	gd
.
	gh
->
	g_Ën
 !ğ0xFFFF || 
fuÎ_Ën
 <= 0xFFFF)

412 
SET_EXTRA_LENGTH_ANNO
(
p
, 0);

414 
SET_EXTRA_LENGTH_ANNO
(
p
, 
fuÎ_Ën
 - 0xFFFF);

419 
boŞ
 
	gPack‘Odesc
::
h¬d_make_
()

421 ià(!
is_
)

422  
çl£
;

423 ià(!
	gp
->
has_ÃtwÜk_h—d”
())

424 
	gp
->
£t_ÃtwÜk_h—d”
(
p
->
d©a
(), 0);

425 ià(
	gp
->
ÃtwÜk_Ëngth
(è< (è(
	gşick_
)) {

426 ià(!(
	gp
 = 
p
->
put
((
şick_
è-…->
ÃtwÜk_Ëngth
())))

427  
çl£
;

428 
	gp
->
£t_ÃtwÜk_h—d”
(
p
->
ÃtwÜk_h—d”
(), (
şick_
));

429 
şick_
 *
	gh
 = 
p
->
_h—d”
();

430 
	gh
->
	g_v
 = 4;

431 
	gh
->
	g_hl
 = (
şick_
) >> 2;

432 
	gh
->
	g_p
 = 
deçuÉ__p
;

433 
	gh
->
	g_Ën
 = 0;

434 
	gh
->
	g_off
 = 0;

435 
	gh
->
	g_‰l
 = 100;

436 ià(
	gdeçuÉ__æowid
) {

437 
	gh
->
	g_¤c
.
	gs_addr
 = 
deçuÉ__æowid
->
§ddr
().
addr
();

438 
	gh
->
	g_d¡
.
	gs_addr
 = 
deçuÉ__æowid
->
daddr
().
addr
();

441  
	gŒue
;

444 
boŞ
 
	gPack‘Odesc
::
h¬d_make_Œª¥
()

446 
şick_
 *
h
 = 
p
->
_h—d”
();

447 ià(
IP_FIRSTFRAG
(
h
)) {

448 
	gËn
;

449 
	gh
->
	g_p
) {

450 
	gIP_PROTO_TCP
:

451 
Ën
 = (
şick_tı
);

453 
	gIP_PROTO_UDP
:

454 
IP_PROTO_UDPLITE
:

455 
Ën
 = (
şick_udp
);

457 
	gIP_PROTO_DCCP
:

458 
Ën
 = 12;

460 
	gIP_PROTO_ICMP
:

461 
Ën
 = (
şick_icmp
);

464  
Œue
;

466 ià(
	gwªt_Ën
 > 0

467 && 
	gwªt_Ën
 < (
	gušt32_t
è
	gp
->
Œª¥Üt_h—d”_off£t
(è+ 
	gËn
)

468 
	gËn
 = 
wªt_Ën
 - 
p
->
Œª¥Üt_h—d”_off£t
();

470 ià(
	gp
->
Œª¥Üt_Ëngth
(è< 
	gËn
) {

471 
	gxËn
 = (
Ën
 < 4 ? 4 :†en);

472 ià(!(
	gp
 = 
p
->
put
(
xËn
 -…->
Œª¥Üt_Ëngth
())))

473  
çl£
;

474 ià(
	gp
->
_h—d”
()->
	g_p
 =ğ
IP_PROTO_TCP
 && 
Ën
 >= 13)

475 
p
->
tı_h—d”
()->
th_off
 = (
şick_tı
) >> 2;

476 ià(
	gdeçuÉ__æowid
) {

477 
şick_udp
 *
	gudph
 = 
p
->
udp_h—d”
();

478 
	gudph
->
	guh_¥Üt
 = 
deçuÉ__æowid
->
¥Üt
();

479 
	gudph
->
	guh_dpÜt
 = 
deçuÉ__æowid
->
dpÜt
();

481 ià(
	gxËn
 > 
	gËn
)

482 
	gp
->
ke
(
xËn
 - 
Ën
);

486  
	gŒue
;

490 cÚ¡ 
	gtı_æags_wÜd
[] = "FSRPAUECN";

492 cÚ¡ 
ušt8_t
 
	gtı_æag_m­pšg
[256] = {

513 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

514 
	$ELEMENT_PROVIDES
(
IPSumm¬yDumpInfo
)

515 
	$ELEMENT_PROVIDES
(
IPSumm¬yDump
)

516 
CLICK_ENDDECLS


	@analysis/ipsumdumpinfo.hh

2 #iâdeà
CLICK_IPSUMDUMPINFO_HH


3 
	#CLICK_IPSUMDUMPINFO_HH


	)

4 
	~<şick/¡ršg.hh
>

5 
	~<şick/¡¿ccum.hh
>

6 
	~<şick/·ck‘.hh
>

7 
CLICK_DECLS


8 
şass
 
	gEËm’t
;

9 
şass
 
	gIPFlowID
;

11 
Çme¥aû
 
	gIPSumm¬yDump
 {

13 ’um { 
	gMAJOR_VERSION
 = 1, 
	gMINOR_VERSION
 = 3 };

21 
	sPack‘Desc
 {

22 cÚ¡ 
Pack‘
 *
	gp
;

23 cÚ¡ 
şick_
 *
	gh
;

24 cÚ¡ 
şick_udp
 *
	gudph
;

25 cÚ¡ 
şick_tı
 *
	gtıh
;

26 cÚ¡ 
şick_icmp
 *
	gicmph
;

27 
	g·d
;

30 
ušt32_t
 
	gv
;

31 
ušt32_t
 
	gu32
[2];

32 
št32_t
 
	gi32
[2];

33 
ušt8_t
 
	gu8
[8];

34 cÚ¡ 
ušt8_t
 *
	gv±r
[2];

37 
SŒšgAccum
* 
	g§
;

38 
SŒšgAccum
* 
	gbad_§
;

39 
boŞ
 
	gÿ»ful_Œunc
;

40 
boŞ
 
	gfÜû_exŒa_Ëngth
;

41 cÚ¡ 
EËm’t
 *
	ge
;

43 
šlše
 
Pack‘Desc
(cÚ¡ 
EËm’t
 *
e
, 
Pack‘
 *
p
, 
SŒšgAccum
* 
§
, SŒšgAccum* 
bad_§
, 
boŞ
 
ÿ»ful_Œunc
, boŞ 
fÜû_exŒa_Ëngth
);

44 
ş—r_v®ues
(è{ 
	gv±r
[0] = 
v±r
[1] = 0; }

50 cÚ¡ *
’d_d©a
() const {

51  
	gp
->
’d_d©a
(è- 
	g·d
;

53 
ušt32_t
 
Ëngth
() const {

54  
	gp
->
Ëngth
(è- 
	g·d
;

56 
ušt32_t
 
ÃtwÜk_Ëngth
() const {

57  
	gp
->
ÃtwÜk_Ëngth
(è- 
	g·d
;

59 
ušt32_t
 
Œª¥Üt_Ëngth
() const {

60  
	gp
->
Œª¥Üt_Ëngth
(è- 
	g·d
;

64 
	sPack‘Odesc
 {

65 
Wr™abËPack‘
* 
	gp
;

66 
boŞ
 
	gis_
;

67 
boŞ
 
	ghave_icmp_ty³
 : 1;

68 
boŞ
 
	ghave_icmp_code
 : 1;

69 
boŞ
 
	ghave__hl
 : 1;

70 
boŞ
 
	ghave_tı_hl
 : 1;

73 
ušt32_t
 
	gv
;

74 
ušt32_t
 
	gu32
[2];

75 
ušt8_t
 
	gu8
[8];

76 cÚ¡ 
ušt8_t
 *
	gv±r
[2];

79 
SŒšgAccum
 
	g§
;

80 cÚ¡ 
EËm’t
 *
	ge
;

81 
	gdeçuÉ__p
;

82 cÚ¡ 
IPFlowID
 *
	gdeçuÉ__æowid
;

83 
	gmšÜ_v”siÚ
;

84 
ušt32_t
 
	gwªt_Ën
;

86 
šlše
 
Pack‘Odesc
(cÚ¡ 
EËm’t
 *
e
, 
Wr™abËPack‘
 *
p
, 
deçuÉ__p
, cÚ¡ 
IPFlowID
 *
deçuÉ__æowid
, 
mšÜ_v”siÚ
);

87 
ş—r_v®ues
(è{ 
	gv±r
[0] = 
v±r
[1] = 0; }

88 
boŞ
 
make_
(
_p
);

89 
boŞ
 
make_Œª¥
();

90 
	g´iv©e
:

91 
boŞ
 
h¬d_make_
();

92 
boŞ
 
h¬d_make_Œª¥
();

97 
	gB_0
 = 0,

98 
	gB_1
 = 1,

99 
	gB_2
 = 2,

100 
	gB_4
 = 4,

101 
	gB_6PTR
 = 6,

102 
	gB_8
 = 8,

103 
	gB_16
 = 16,

104 
	gB_4NET
 = 4 + 256,

105 
	gB_SPECIAL
 = 4 + 512,

106 
	gB_NOTALLOWED
 = -1

109 
	sF›ldWr™”
 {

110 cÚ¡ *
	gÇme
;

111 
	gty³
;

112 
	gu£r_d©a
;

113 (*
	g´•¬e
)(
	gPack‘Desc
 &, cÚ¡ 
	gF›ldWr™”
 *);

114 
boŞ
 (*
exŒaù
)(
	gPack‘Desc
 &, cÚ¡ 
	gF›ldWr™”
 *);

115 (*
	gou
)(cÚ¡ 
	gPack‘Desc
 &, cÚ¡ 
	gF›ldWr™”
 *);

116 (*
	goutb
)(cÚ¡ 
	gPack‘Desc
 &, 
boŞ
 
	gok
, cÚ¡ 
	gF›ldWr™”
 *);

118 
add
(cÚ¡ 
F›ldWr™”
 *);

119 
»move
(cÚ¡ 
F›ldWr™”
 *);

120 cÚ¡ 
F›ldWr™”
 *
fšd
(cÚ¡ 
SŒšg
 &
Çme
);

122 
bš¬y_size
(
ty³
) {

123 ià(
	gty³
 < 0)

126  
	gty³
 & 256;

128 
šlše
 
bš¬y_size
() const {

129  
bš¬y_size
(
ty³
);

133 
	sF›ldR—d”
 {

134 cÚ¡ *
	gÇme
;

135 
	gty³
;

136 
	gu£r_d©a
;

137 
	gÜd”
;

138 
boŞ
 (*
ša
)(
	gPack‘Odesc
 &, cÚ¡ 
	gSŒšg
 &, cÚ¡ 
	gF›ldR—d”
 *);

139 cÚ¡ 
	gušt8_t
 *(*
	gšb
)(
	gPack‘Odesc
 &, const uint8_t *, const uint8_t *,

140 cÚ¡ 
	gF›ldR—d”
 *);

141 (*
	gšjeù
)(
	gPack‘Odesc
 &, cÚ¡ 
	gF›ldR—d”
 *);

143 
add
(cÚ¡ 
F›ldR—d”
 *);

144 
»move
(cÚ¡ 
F›ldR—d”
 *);

145 cÚ¡ 
F›ldR—d”
 *
fšd
(cÚ¡ 
SŒšg
 &
Çme
);

147 
šlše
 
bš¬y_size
() const {

148  
	gF›ldWr™”
::
bš¬y_size
(
ty³
);

152 
	sF›ldSynÚym
 {

153 cÚ¡ *
	gÇme
;

154 cÚ¡ *
	gsynÚym
;

155 
add
(cÚ¡ 
F›ldSynÚym
 *);

156 
»move
(cÚ¡ 
F›ldSynÚym
 *);

159 cÚ¡ 
F›ldR—d”
 
nuÎ_»ad”
;

160 cÚ¡ 
F›ldWr™”
 
nuÎ_wr™”
;

163 
	gÜd”_ªno
 = 100,

164 
	gÜd”_lšk
 = 200,

165 
	gÜd”_Ãt
 = 300,

166 
	gÜd”_Œª¥
 = 400,

167 
	gÜd”_·ylßd
 = 500,

168 
	gÜd”_off£t
 = 50

171 
num_ou
(cÚ¡ 
Pack‘Desc
&, cÚ¡ 
F›ldWr™”
 *);

172 
outb
(cÚ¡ 
Pack‘Desc
&, 
boŞ
 
ok
, cÚ¡ 
F›ldWr™”
 *);

174 
boŞ
 
num_ša
(
Pack‘Odesc
&, cÚ¡ 
SŒšg
 &, cÚ¡ 
F›ldR—d”
 *);

175 cÚ¡ 
ušt8_t
 *
šb
(
Pack‘Odesc
&, cÚ¡ ušt8_t*, cÚ¡ ušt8_t*, cÚ¡ 
F›ldR—d”
 *);

177 ’um { 
	gMISSING_IP
 = 0,

178 
	gMISSING_ETHERNET
 = 260 };

179 
šlše
 
boŞ
 
f›ld_missšg
(cÚ¡ 
Pack‘Desc
 &
d
, 
´Ùo
, 
l
);

180 
boŞ
 
h¬d_f›ld_missšg
(cÚ¡ 
Pack‘Desc
 &
d
, 
´Ùo
, 
l
);

183 
_´•¬e
(
Pack‘Desc
 &, cÚ¡ 
F›ldWr™”
 *);

185 ’um { 
	gDO_IPOPT_PADDING
 = 1,

186 
	gDO_IPOPT_ROUTE
 = 2,

187 
	gDO_IPOPT_TS
 = 4,

188 
	gDO_IPOPT_UNKNOWN
 = 32,

189 
	gDO_IPOPT_ALL
 = 0xFFFFFFFFU,

190 
	gDO_IPOPT_ALL_NOPAD
 = 0xFFFFFFFEU };

191 
uÅ¬£__İt
(
SŒšgAccum
&, cÚ¡ 
ušt8_t
*, 
Ş’
, 
mask
);

192 
uÅ¬£__İt
(
SŒšgAccum
&, cÚ¡ 
şick_
*, 
mask
);

193 
uÅ¬£__İt_bš¬y
(
SŒšgAccum
&, cÚ¡ 
ušt8_t
*, 
Ş’
, 
mask
);

194 
uÅ¬£__İt_bš¬y
(
SŒšgAccum
&, cÚ¡ 
şick_
*, 
mask
);

196 cÚ¡ 
tı_æags_wÜd
[];

197 cÚ¡ 
ušt8_t
 
tı_æag_m­pšg
[256];

199 ’um { 
	gDO_TCPOPT_PADDING
 = 1,

200 
	gDO_TCPOPT_MSS
 = 2,

201 
	gDO_TCPOPT_WSCALE
 = 4,

202 
	gDO_TCPOPT_SACK
 = 8,

203 
	gDO_TCPOPT_TIMESTAMP
 = 16,

204 
	gDO_TCPOPT_UNKNOWN
 = 32,

205 
	gDO_TCPOPT_ALL
 = 0xFFFFFFFFU,

206 
	gDO_TCPOPT_ALL_NOPAD
 = 0xFFFFFFFEU,

207 
	gDO_TCPOPT_NTALL
 = 0xFFFFFFEEU };

208 
uÅ¬£_tı_İt
(
SŒšgAccum
&, cÚ¡ 
ušt8_t
*, 
Ş’
, 
mask
);

209 
uÅ¬£_tı_İt
(
SŒšgAccum
&, cÚ¡ 
şick_tı
*, 
mask
);

210 
uÅ¬£_tı_İt_bš¬y
(
SŒšgAccum
&, cÚ¡ 
ušt8_t
*, 
Ş’
, 
mask
);

211 
uÅ¬£_tı_İt_bš¬y
(
SŒšgAccum
&, cÚ¡ 
şick_tı
*, 
mask
);

213 
šlše
 
	gPack‘Desc
::
Pack‘Desc
(cÚ¡ 
EËm’t
 *
e_
, 
Pack‘
* 
p_
, 
SŒšgAccum
* 
§_
, SŒšgAccum* 
bad_§_
, 
boŞ
 
ÿ»ful_Œunc_
, boŞ 
fÜû_exŒa_Ëngth_
)

214 : 
p
(
p_
), 
h
(0), 
udph
(0), 
tıh
(0), 
·d
(0), 
§
(
§_
), 
bad_§
(
bad_§_
),

215 
ÿ»ful_Œunc
(
ÿ»ful_Œunc_
), 
fÜû_exŒa_Ëngth
(
fÜû_exŒa_Ëngth_
),

216 
e
(
e_
)

220 
šlše
 
	gPack‘Odesc
::
Pack‘Odesc
(cÚ¡ 
EËm’t
 *
e_
, 
Wr™abËPack‘
* 
p_
, 
deçuÉ__p_
, cÚ¡ 
IPFlowID
 *
deçuÉ__æowid_
, 
mšÜ_v”siÚ_
)

221 : 
p
(
p_
), 
is_
(
Œue
), 
have_icmp_ty³
(
çl£
), 
have_icmp_code
(false),

222 
have__hl
(
çl£
), 
have_tı_hl
(false),

223 
e
(
e_
), 
deçuÉ__p
(
deçuÉ__p_
), 
deçuÉ__æowid
(
deçuÉ__æowid_
),

224 
mšÜ_v”siÚ
(
mšÜ_v”siÚ_
), 
wªt_Ën
(0)

228 
šlše
 
boŞ
 
	gPack‘Odesc
::
make_
(
_p
)

230 ià((!
is_
 || !
p
->
has_ÃtwÜk_h—d”
()

231 || 
p
->
ÃtwÜk_Ëngth
(è< (è(
şick_
))

232 && !
h¬d_make_
())

233  
çl£
;

234  !
	g_p
 || !
	gp
->
_h—d”
()->_°||…->_h—d”()->_°=ğ
_p
;

237 
šlše
 
boŞ
 
	gPack‘Odesc
::
make_Œª¥
()

240 
as£¹
(
is_
 && 
p
->
ÃtwÜk_h—d”
());

241 ià(!
IP_FIRSTFRAG
(
p
->
_h—d”
()))

242  
	gçl£
;

243 ià(
	gp
->
Œª¥Üt_Ëngth
() < 8)

244  
h¬d_make_Œª¥
();

246  
	gŒue
;

249 
šlše
 
boŞ
 
f›ld_missšg
(cÚ¡ 
Pack‘Desc
 &
d
, 
´Ùo
, 
l
)

251  (
	gd
.
	gbad_§
 ? 
h¬d_f›ld_missšg
(
d
, 
´Ùo
, 
l
è: 
çl£
);

256 şas 
	cIPSumm¬yDumpInfo
 { 
	mpublic
:

257 
¡©ic_ş—nup
();

260 
	gCLICK_ENDDECLS


	@analysis/settimestampdelta.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/”rÜ.hh
>

21 
	~"£‰ime¡ampd–.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
CLICK_DECLS


27 
	gS‘Time¡ampD–
::
	$S‘Time¡ampD–
()

29 
	}
}

31 
S‘Time¡ampD–
::~
	$S‘Time¡ampD–
()

33 
	}
}

36 
S‘Time¡ampD–
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

38 
SŒšg
 
	gtyp
 = "RANGE";

39 ià(
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad
("TYPE", 
WÜdArg
(), 
typ
)

41 .
com¶‘e
() < 0)

43 ià(
	gtyp
 == "RANGE")

44 
_ty³
 = 0;

45 ià(
	gtyp
 == "NOW")

46 
_ty³
 = 1;

47 ià(
	gtyp
 == "FIRST")

48 
_ty³
 = 2;

50  
	g”rh
->
”rÜ
("bad TYPE");

54 
Pack‘
 *

55 
	gS‘Time¡ampD–
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

57 
Time¡amp
& 
tv
 = 
p
->
	`time¡amp_ªno
();

58 ià(
tv
)

59 
_ty³
) {

61 ià(!
_fœ¡
)

62 
_fœ¡
 = 
tv
;

63 
tv
 -ğ
_fœ¡
;

66 
tv
 = 
Time¡amp
::
	`now
() -v;

69 
tv
 -ğ
	`FIRST_TIMESTAMP_ANNO
(
p
);

72  
p
;

73 
	}
}

75 
SŒšg


76 
	gS‘Time¡ampD–
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

78 
S‘Time¡ampD–
 *
td
 = 
¡©ic_ÿ¡
<S‘Time¡ampD– *>(
e
);

79 
SŒšgAccum
 
§
;

80 (
šŒ_t
)
thunk
) {

82 
SŒšgAccum
 
§
;

83 
§
 << 
td
->
_fœ¡
 << '\n';

84  
§
.
	`ke_¡ršg
();

89 
	}
}

92 
	gS‘Time¡ampD–
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

94 
S‘Time¡ampD–
 *
td
 = 
¡©ic_ÿ¡
<S‘Time¡ampD– *>(
e
);

95 
td
->
_fœ¡
 = 
	`Time¡amp
();

97 
	}
}

100 
	gS‘Time¡ampD–
::
	$add_hªdËrs
()

102 
	`add_»ad_hªdËr
("fœ¡", 
»ad_hªdËr
);

103 
	`add_wr™e_hªdËr
("»£t", 
wr™e_hªdËr
, 0, 
HªdËr
::
f_bu‰Ú
);

104 
	}
}

106 
CLICK_ENDDECLS


107 
EXPORT_ELEMENT
(
S‘Time¡ampD–
)

	@analysis/settimestampdelta.hh

2 #iâdeà
CLICK_SETTIMESTAMPDELTA_HH


3 
	#CLICK_SETTIMESTAMPDELTA_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


47 şas 
	cS‘Time¡ampD–
 : 
public
 
EËm’t
 {…ublic:

49 
	$S‘Time¡ampD–
(è
CLICK_COLD
;

50 ~
	$S‘Time¡ampD–
(è
CLICK_COLD
;

52 cÚ¡ *
	$şass_Çme
() const {  "SetTimestampDelta"; }

53 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

55 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

56 
	$add_hªdËrs
(è
CLICK_COLD
;

58 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

60 
´iv©e
:

62 
_ty³
;

63 
Time¡amp
 
_fœ¡
;

65 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

66 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
*è
CLICK_COLD
;

68 
	}
};

70 
	gCLICK_ENDDECLS


	@analysis/storetimestamp.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/”rÜ.hh
>

21 
	~"¡Ü‘ime¡amp.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
CLICK_DECLS


26 
	gStÜeTime¡amp
::
	$StÜeTime¡amp
()

28 
	}
}

30 
StÜeTime¡amp
::~
	$StÜeTime¡amp
()

32 
	}
}

35 
StÜeTime¡amp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 
	g_off£t
 = -1;

38 
boŞ
 
	g
 = 
çl£
;

39 ià(
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad_p
("OFFSET", 
_off£t
)

41 .
»ad
("TAIL", 

)

42 .
com¶‘e
() < 0)

44 ià(
	g_off£t
 >ğ0 ? 

 : !tail)

45  
”rh
->
”rÜ
("supplyƒxactly one of 'OFFSET'‡nd 'TAIL'");

49 
Pack‘
 *

50 
	gStÜeTime¡amp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

52 
off£t
 = (
_off£t
 < 0 ? (è
p
->
	`Ëngth
() : _offset);

53 
d–
 = 
off£t
 + 8 - 
p
->
	`Ëngth
();

54 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`put
(
d–
 < 0 ? 0 : delta)) {

55 
	`memıy
(
q
->
	`d©a
(è+ 
off£t
, &q->
	`time¡amp_ªno
(), 8);

56  
q
;

59 
	}
}

61 
CLICK_ENDDECLS


62 
EXPORT_ELEMENT
(
StÜeTime¡amp
)

	@analysis/storetimestamp.hh

2 #iâdeà
CLICK_STORETIMESTAMP_HH


3 
	#CLICK_STORETIMESTAMP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


41 şas 
	cStÜeTime¡amp
 : 
public
 
EËm’t
 {…ublic:

43 
	$StÜeTime¡amp
(è
CLICK_COLD
;

44 ~
	$StÜeTime¡amp
(è
CLICK_COLD
;

46 cÚ¡ *
	$şass_Çme
() const {  "StoreTimestamp"; }

47 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

48 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

50 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

52 
	g´iv©e
:

54 
_off£t
;

58 
	gCLICK_ENDDECLS


	@analysis/storeudptimeseqrecord.cc

16 
	~<şick/cÚfig.h
>

17 
	~"¡Üeud±ime£q»cÜd.hh
"

18 
	~<şick/glue.hh
>

19 
	~<şickÃt/.h
>

20 
	~<şickÃt/6.h
>

21 
	~<şickÃt/udp.h
>

22 
	~<şickÃt/tı.h
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

28 
CLICK_DECLS


34 
	gStÜeUDPTimeSeqRecÜd
::
	$StÜeUDPTimeSeqRecÜd
()

36 
_couÁ
 = 0;

37 
_d–
 = 0;

38 
_off£t
 = 0;

39 
	}
}

43 
	gStÜeUDPTimeSeqRecÜd
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

45 ià(
Args
(
cÚf
, 
this
, 
”rh
)

46 .
»ad_mp
("OFFSET", 
_off£t
)

47 .
»ad
("DELTA", 
_d–
)

48 .
com¶‘e
() < 0)

56 
Pack‘
* 
	gStÜeUDPTimeSeqRecÜd
::
	$sim¶e_aùiÚ
(
Pack‘
 *
·ck‘
)

58 
Wr™abËPack‘
 *
p
 = 
·ck‘
->
	`uniqueify
();

59 
Time¡amp
 
Šow
;

60 
şick_udp
 *
udph
 = 0;

61 
PD©a
 *
pD©a
;

62 
ušt32_t
 
csum
 = 0;

63 
ušt32_t
 
off£t
 = 
_off£t
;

67 ià(!
p
)

70 
	`şick_ch©‹r
("Non-Writable Packet!");

73 ià(
p
->
	`Ëngth
(è< 
off£t
 + (
ušt32_t
) * 2)

75 
p
->
	`kl
();

80 
u_ch¬
 
v”siÚ
 = 
p
->
	`d©a
()[
off£t
] >> 4;

81 ià(
v”siÚ
 == 0x04)

83 cÚ¡ 
şick_
 *

 = 
»š‹½»t_ÿ¡
<cÚ¡ click_ *>(
p
->
	`d©a
(è+ 
off£t
);

84 
off£t
 +ğ

->
_hl
 << 2;

86 ià(
v”siÚ
 == 0x06)

89 cÚ¡ 
şick_6
 *
6
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_6 *>(
p
->
	`d©a
(è+ 
off£t
);

90 ià(
6
->
6_nxt
 == 0x11)

91 
off£t
 +ğ(
şick_6
);

94 
p
->
	`kl
();

100 
	`şick_ch©‹r
("Unknown IP version!");

101 
p
->
	`kl
();

105 ià(
p
->
	`Ëngth
(è< 
off£t
 + (
şick_udp
è+ (
PD©a
))

108 
p
->
	`kl
();

112 
udph
 = (
şick_udp
*)(
p
->
	`d©a
(è+ 
off£t
);

113 
pD©a
 = (
PD©a
*)((*)
udph
 + (
şick_udp
));

114 
csum
 = 
udph
->
uh_sum
;

118 
_couÁ
++;

119 ià(
_d–
)

121 
Time¡amp
 
	`ts1
(
	`Áohl
(
pD©a
->
d©a
[0]), Time¡amp::
	`n£c_to_sub£c
(ntohl(pData->data[1])));

122 
Time¡amp
 
diff
 = Time¡amp::
	`now
(è- 
ts1
;

125 
pD©a
->
d©a
[2] = 
	`htÚl
(
diff
.
	`£c
());

126 
pD©a
->
d©a
[3] = 
	`htÚl
(
diff
.
	`n£c
());

127 
csum
 +ğ
	`şick_š_cksum
((cÚ¡ *)(
pD©a
->
d©a
 + 2), 2 * (
ušt32_t
));

131 
Šow
 = 
Time¡amp
::
	`now
();

134 
csum
 -ğ
	`şick_š_cksum
((cÚ¡ *)
pD©a
, (
PD©a
));

135 
pD©a
->
£q_num
 = 
	`htÚl
(
_couÁ
);

136 
pD©a
->
d©a
[0] = 
	`htÚl
(
Šow
.
	`£c
());

137 
pD©a
->
d©a
[1] = 
	`htÚl
(
Šow
.
	`n£c
());

138 
pD©a
->
d©a
[2] = 0;

139 
pD©a
->
d©a
[3] = 0;

140 
csum
 +ğ
	`şick_š_cksum
((cÚ¡ *)
pD©a
, (
PD©a
));

143 
csum
 = (0xFFFF & csum) + ((0xFFFF0000 & csum) >> 16);

144 
csum
 = (csum != 0xFFFF) ? csum : 0;

148 
udph
->
uh_sum
 = (
ušt16_t
)
csum
;

150  
p
;

151 
	}
}

154 
	gStÜeUDPTimeSeqRecÜd
::
	$»£t_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

156 
StÜeUDPTimeSeqRecÜd
 *
t
 = (StÜeUDPTimeSeqRecÜd *è
e
;

158 
t
->
_couÁ
 = 0;

160 
	}
}

162 
	gStÜeUDPTimeSeqRecÜd
::
	$add_hªdËrs
()

164 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
f_»ad
, &
_couÁ
);

165 
	`add_wr™e_hªdËr
("»£t", 
»£t_hªdËr
);

166 
	}
}

168 
CLICK_ENDDECLS


169 
EXPORT_ELEMENT
(
StÜeUDPTimeSeqRecÜd
)

	@analysis/storeudptimeseqrecord.hh

16 #iâdeà
CLICK_STOREUDPTIMESEQRECORD_HH


17 
	#CLICK_STOREUDPTIMESEQRECORD_HH


	)

18 
	~<şick/–em’t.hh
>

20 
CLICK_DECLS


78 şas 
	cStÜeUDPTimeSeqRecÜd
 : 
public
 
EËm’t


80 
public
:

81 
	$StÜeUDPTimeSeqRecÜd
(è
CLICK_COLD
;

83 cÚ¡ *
	$şass_Çme
() const {  "StoreUDPTimeSeqRecord"; }

84 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

86 
	$add_hªdËrs
(è
CLICK_COLD
;

87 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

89 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

94 
	sPD©a


96 
ušt32_t
 
£q_num
;

97 
ušt32_t
 
d©a
[4];

98 
	}
};

100 
	g´iv©e
:

101 
_couÁ
;

102 
boŞ
 
	g_d–
;

103 
ušt32_t
 
	g_off£t
;

105 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

106 
	`»£t_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

107 
	}
};

109 
	gCLICK_ENDDECLS


	@analysis/timefilter.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/”rÜ.hh
>

21 
	~"timef‹r.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/hªdËrÿÎ.hh
>

25 
	~<şick/v¬ŸbË’v.hh
>

26 
CLICK_DECLS


28 
	gTimeF‹r
::
	$TimeF‹r
()

29 : 
	$_Ï¡_h
(0)

31 
	}
}

33 
TimeF‹r
::~
	$TimeF‹r
()

35 
d–‘e
 
_Ï¡_h
;

36 
	}
}

39 
	gTimeF‹r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41 
Time¡amp
 
	gfœ¡
, 
	gÏ¡
, 
	gfœ¡_š™
, 
	gÏ¡_š™
, 
	gfœ¡_d–
, 
	gÏ¡_d–
, 
	gš‹rv®
;

42 
HªdËrC®l
 
	gÏ¡_h
;

43 
boŞ
 
	g¡İ
 = 
çl£
;

45 ià(
Args
(
cÚf
, 
this
, 
”rh
)

46 .
»ad_p
("START", 
fœ¡
)

47 .
»ad_p
("END", 
Ï¡
)

48 .
»ad
("START_DELAY", 
fœ¡_š™
)

49 .
»ad
("END_DELAY", 
Ï¡_š™
)

50 .
»ad
("START_AFTER", 
fœ¡_d–
)

51 .
»ad
("END_AFTER", 
Ï¡_d–
)

52 .
»ad
("INTERVAL", 
š‹rv®
)

53 .
»ad
("STOP", 
¡İ
)

54 .
»ad
("END_CALL", 
HªdËrC®lArg
(
HªdËrC®l
::
wr™abË
), 
Ï¡_h
)

55 .
com¶‘e
() < 0)

58 
	g_fœ¡_»Ïtive
 = 
_fœ¡_š™_»Ïtive
 = 
_Ï¡_»Ïtive
 = 
_Ï¡_š™_»Ïtive
 = 
_Ï¡_š‹rv®
 = 
çl£
;

60 ià((
	gboŞ
è
	gfœ¡
 + (boŞè
	gfœ¡_d–
 + (boŞè
	gfœ¡_š™
 > 1)

61  
	g”rh
->
”rÜ
("START, START_AFTER,‡nd START_AFTER_INIT‡re mutuallyƒxclusive");

62 ià(
	gfœ¡
)

63 
	g_fœ¡
 = 
fœ¡
;

64 ià(
	gfœ¡_š™
)

65 
	g_fœ¡
 = 
fœ¡_š™
, 
	g_fœ¡_š™_»Ïtive
 = 
Œue
;

67 
	g_fœ¡
 = 
fœ¡_d–
, 
	g_fœ¡_»Ïtive
 = 
Œue
;

69 ià((
	gboŞ
è
	gÏ¡
 + (boŞè
	gÏ¡_d–
 + (boŞè
	gÏ¡_š™
 + (boŞè
	gš‹rv®
 > 1)

70  
	g”rh
->
”rÜ
("END, END_AFTER, END_AFTER_INIT,‡nd INTERVAL‡re mutuallyƒxclusive");

71 ià(
	gÏ¡
)

72 
	g_Ï¡
 = 
Ï¡
;

73 ià(
	gÏ¡_d–
)

74 
	g_Ï¡
 = 
Ï¡_d–
, 
	g_Ï¡_»Ïtive
 = 
Œue
;

75 ià(
	gÏ¡_š™
)

76 
	g_Ï¡
 = 
Ï¡_š™
, 
	g_Ï¡_š™_»Ïtive
 = 
Œue
;

77 ià(
	gš‹rv®
)

78 
	g_Ï¡
 = 
š‹rv®
, 
	g_Ï¡_š‹rv®
 = 
Œue
;

80 
	g_Ï¡
.
£t_£c
(
Time¡amp
::
max_£cÚds
);

82 ià(
	gÏ¡_h
 && 
	g¡İ
)

83  
	g”rh
->
”rÜ
("END_CALL‡nd STOP‡re mutuallyƒxclusive");

84 ià(
	gÏ¡_h
)

85 
	g_Ï¡_h
 = 
Ãw
 
HªdËrC®l
(
Ï¡_h
);

86 ià(
	g¡İ
)

87 
	g_Ï¡_h
 = 
Ãw
 
HªdËrC®l
("stoprue");

89 
	g_»ady
 = 
çl£
;

94 
	gTimeF‹r
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

96 ià(
_Ï¡_h
 && _Ï¡_h->
	`š™Ÿlize_wr™e
(
this
, 
”rh
) < 0)

98 ià(
_fœ¡_š™_»Ïtive
 || 
_Ï¡_š™_»Ïtive
) {

99 
Time¡amp
 
now
 = Time¡amp::
	`now
();

100 ià(
_fœ¡_š™_»Ïtive
)

101 
_fœ¡
 +ğ
now
;

102 ià(
_Ï¡_š™_»Ïtive
)

103 
_Ï¡
 +ğ
now
;

105 
_Ï¡_h_»ady
 = (
_Ï¡_h
 != 0);

107 
	}
}

110 
	gTimeF‹r
::
	$fœ¡_·ck‘
(cÚ¡ 
Time¡amp
& 
tv
)

112 ià(
_fœ¡_»Ïtive
)

113 
_fœ¡
 +ğ
tv
;

114 ià(
_Ï¡_»Ïtive
)

115 
_Ï¡
 +ğ
tv
;

116 ià(
_Ï¡_š‹rv®
)

117 
_Ï¡
 +ğ
_fœ¡
;

118 
_»ady
 = 
Œue
;

119 
	}
}

121 
Pack‘
 *

122 
	gTimeF‹r
::
	$kl
(
Pack‘
 *
p
)

124 
	`checked_ouut_push
(1, 
p
);

126 
	}
}

128 
Pack‘
 *

129 
	gTimeF‹r
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

131 cÚ¡ 
Time¡amp
& 
tv
 = 
p
->
	`time¡amp_ªno
();

132 ià(
	`uÆik–y
(!
_»ady
))

133 
	`fœ¡_·ck‘
(
tv
);

134 ià(
	`uÆik–y
(
tv
 < 
_fœ¡
))

135  
	`kl
(
p
);

137 ià(!
	`lik–y
(
tv
 < 
_Ï¡
è&& 
_Ï¡_h
 && 
_Ï¡_h_»ady
) {

138 
V¬ŸbËEnvœÚm’t
 
	`scİe
(0);

139 
scİe
.
	`defše
(
SŒšg
::
	`make_¡abË
("t", 1), 
tv
.
	`uÅ¬£
(), 
Œue
);

140 
Time¡amp
 
´ev_Ï¡
;

142 
´ev_Ï¡
 = 
_Ï¡
;

143 
_Ï¡_h_»ady
 = 
çl£
;

144 (è
_Ï¡_h
->
	`ÿÎ_wr™e
(
scİe
);

145 } !(
tv
 < 
_Ï¡
è&& 
_Ï¡_h
 && 
_Ï¡_h_»ady


146 && 
_Ï¡
 > 
´ev_Ï¡
);

148 ià(!
	`lik–y
(
tv
 < 
_Ï¡
))

149  
	`kl
(
p
);

151  
p
;

153 
	}
}

156 
SŒšg


157 
	gTimeF‹r
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *)

159 
TimeF‹r
 *
tf
 = 
¡©ic_ÿ¡
<TimeF‹¸*>(
e
);

160  (
tf
->
_Ï¡
 -f->
_fœ¡
).
	`uÅ¬£
();

161 
	}
}

164 
	gTimeF‹r
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

166 
Time¡amp
 
t
;

167 ià(!
	`ı_time
(
s
, &
t
))

168  
”rh
->
	`”rÜ
("expectedime");

169 
TimeF‹r
 *
tf
 = 
¡©ic_ÿ¡
<TimeF‹¸*>(
e
);

170 (
šŒ_t
)
thunk
) {

171 
h_¡¬t
:

172 ià(!
tf
->
_»ady
)

173 
tf
->
	`fœ¡_·ck‘
(
t
);

174 
tf
->
_fœ¡
 = 
t
;

176 
h_’d
:

177 
tf
->
_Ï¡
 = 
t
;

178 
tf
->
_Ï¡_»Ïtive
 =f->
_Ï¡_š™_»Ïtive
 =f->
_Ï¡_š‹rv®
 = 
çl£
;

179 
tf
->
_Ï¡_h_»ady
 = 
Œue
;

181 
h_š‹rv®
:

182 
tf
->
_Ï¡
 =f->
_fœ¡
 + 
t
;

183 
tf
->
_Ï¡_h_»ady
 = 
Œue
;

185 
h_ex‹nd_š‹rv®
:

186 
tf
->
_Ï¡
 +ğ
t
;

187 
tf
->
_Ï¡_h_»ady
 = 
Œue
;

191 
	}
}

194 
	gTimeF‹r
::
	$add_hªdËrs
()

196 
	`add_d©a_hªdËrs
("¡¬t", 
HªdËr
::
f_»ad
, &
_fœ¡
);

197 
	`add_d©a_hªdËrs
("’d", 
HªdËr
::
f_»ad
, &
_Ï¡
);

198 
	`add_wr™e_hªdËr
("¡¬t", 
wr™e_hªdËr
, 
h_¡¬t
);

199 
	`add_wr™e_hªdËr
("’d", 
wr™e_hªdËr
, 
h_’d
);

200 
	`add_»ad_hªdËr
("š‹rv®", 
»ad_hªdËr
, 
h_š‹rv®
);

201 
	`add_wr™e_hªdËr
("’d", 
wr™e_hªdËr
, 
h_š‹rv®
);

202 
	`add_wr™e_hªdËr
("ex‹nd_š‹rv®", 
wr™e_hªdËr
, 
h_ex‹nd_š‹rv®
);

203 
	}
}

205 
CLICK_ENDDECLS


206 
EXPORT_ELEMENT
(
TimeF‹r
)

	@analysis/timefilter.hh

2 #iâdeà
CLICK_TIMEFILTER_HH


3 
	#CLICK_TIMEFILTER_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


6 
şass
 
	gHªdËrC®l
;

101 şas 
	cTimeF‹r
 : 
public
 
EËm’t
 {…ublic:

103 
	$TimeF‹r
(è
CLICK_COLD
;

104 ~
	$TimeF‹r
(è
CLICK_COLD
;

106 cÚ¡ *
	$şass_Çme
() const {  "TimeFilter"; }

107 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

108 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

110 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

111 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

112 
	$add_hªdËrs
(è
CLICK_COLD
;

114 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

116 
´iv©e
:

118 
Time¡amp
 
_fœ¡
;

119 
Time¡amp
 
_Ï¡
;

121 
boŞ
 
_»ady
 : 1;

122 
boŞ
 
_fœ¡_»Ïtive
 : 1;

123 
boŞ
 
_fœ¡_š™_»Ïtive
 : 1;

124 
boŞ
 
_Ï¡_»Ïtive
 : 1;

125 
boŞ
 
_Ï¡_š™_»Ïtive
 : 1;

126 
boŞ
 
_Ï¡_š‹rv®
 : 1;

127 
boŞ
 
_Ï¡_h_»ady
 : 1;

128 
HªdËrC®l
 *
_Ï¡_h
;

130 
	`fœ¡_·ck‘
(cÚ¡ 
Time¡amp
 &);

131 
Pack‘
 *
	`kl
(Packet *);

134 
h_¡¬t
, 
h_’d
, 
h_š‹rv®
, 
h_ex‹nd_š‹rv®


135 
	}
};

136 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

137 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

139 
	}
};

141 
	gCLICK_ENDDECLS


	@analysis/timerange.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/”rÜ.hh
>

21 
	~"tim”ªge.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
CLICK_DECLS


26 
	gTimeRªge
::
	$TimeRªge
()

28 
	}
}

30 
TimeRªge
::~
	$TimeRªge
()

32 
	}
}

35 
TimeRªge
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 
	g_sim¶e
 = 
çl£
;

38 ià(
Args
(
cÚf
, 
this
, 
”rh
)

39 .
»ad
("SIMPLE", 
_sim¶e
)

40 .
com¶‘e
() < 0)

45 
Pack‘
 *

46 
	gTimeRªge
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

48 cÚ¡ 
Time¡amp
& 
tv
 = 
p
->
	`time¡amp_ªno
();

49 ià(!
_fœ¡
)

50 
_fœ¡
 = 
_Ï¡
 = 
tv
;

51 ià(
_sim¶e
)

52 
_Ï¡
 = 
tv
;

53 ià(
_Ï¡
 < 
tv
)

54 
_Ï¡
 = 
tv
;

55 ià(
tv
 < 
_fœ¡
)

56 
_fœ¡
 = 
tv
;

57  
p
;

58 
	}
}

60 
SŒšg


61 
	gTimeRªge
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

63 
TimeRªge
 *
Œ
 = 
¡©ic_ÿ¡
<TimeRªg*>(
e
);

64 
SŒšgAccum
 
§
;

65 (
šŒ_t
)
thunk
) {

66 
h_¿nge
:

67 
§
 << 
Œ
->
_fœ¡
 << ' ' <<r->
_Ï¡
;

69 
h_š‹rv®
:

70 
§
 << (
Œ
->
_Ï¡
 -r->
_fœ¡
);

73  
§
.
	`ke_¡ršg
();

74 
	}
}

77 
	gTimeRªge
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

79 
TimeRªge
 *
Œ
 = 
¡©ic_ÿ¡
<TimeRªg*>(
e
);

80 
Œ
->
_fœ¡
 =r->
_Ï¡
 = 
	`Time¡amp
();

82 
	}
}

85 
	gTimeRªge
::
	$add_hªdËrs
()

87 
	`add_d©a_hªdËrs
("fœ¡", 
HªdËr
::
f_»ad
, &
_fœ¡
);

88 
	`add_d©a_hªdËrs
("Ï¡", 
HªdËr
::
f_»ad
, &
_Ï¡
);

89 
	`add_»ad_hªdËr
("¿nge", 
»ad_hªdËr
, 
h_¿nge
);

90 
	`add_»ad_hªdËr
("š‹rv®", 
»ad_hªdËr
, 
h_š‹rv®
);

91 
	`add_wr™e_hªdËr
("»£t", 
wr™e_hªdËr
, 
h_»£t
, 
HªdËr
::
f_bu‰Ú
);

92 
	}
}

94 
CLICK_ENDDECLS


95 
EXPORT_ELEMENT
(
TimeRªge
)

	@analysis/timerange.hh

2 #iâdeà
CLICK_TIMERANGE_HH


3 
	#CLICK_TIMERANGE_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


57 şas 
	cTimeRªge
 : 
public
 
EËm’t
 {…ublic:

59 
	$TimeRªge
(è
CLICK_COLD
;

60 ~
	$TimeRªge
(è
CLICK_COLD
;

62 cÚ¡ *
	$şass_Çme
() const {  "TimeRange"; }

63 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

65 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

66 
	$add_hªdËrs
(è
CLICK_COLD
;

68 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

70 
´iv©e
:

72 
Time¡amp
 
_fœ¡
;

73 
Time¡amp
 
_Ï¡
;

75 
boŞ
 
_sim¶e
;

78 
h_¿nge
, 
h_š‹rv®
, 
h_»£t


79 
	}
};

80 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

81 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
*è
CLICK_COLD
;

83 
	}
};

85 
	gCLICK_ENDDECLS


	@analysis/timesortedsched.cc

20 
	~<şick/cÚfig.h
>

21 
	~<şick/”rÜ.hh
>

22 
	~"timesÜ‹dsched.hh
"

23 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/rou‹r.hh
>

26 
	~<şick/h—p.hh
>

27 
CLICK_DECLS


29 
	gTimeSÜ‹dSched
::
	$TimeSÜ‹dSched
()

30 : 
	`_pkt
(0), 
	`_Åkt
(0), 
	`_šput
(0), 
	`_Ä—dy
(0),

31 
	`_nÙif›r
(
NÙif›r
::
SEARCH_CONTINUE_WAKE
), 
	`_bufãr
(1),

32 
	$_w–l_Üd”ed
(
Œue
)

34 
	}
}

36 
	gTimeSÜ‹dSched
::~
	$TimeSÜ‹dSched
()

38 
	}
}

41 
TimeSÜ‹dSched
::
	$ÿ¡
(cÚ¡ *
n
)

43 ià(
	`¡rcmp
(
n
, 
NÙif›r
::
EMPTY_NOTIFIER
) == 0)

44  &
_nÙif›r
;

46  
EËm’t
::
	`ÿ¡
(
n
);

47 
	}
}

50 
	gTimeSÜ‹dSched
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

52 
	g_nÙif›r
.
š™Ÿlize
(
NÙif›r
::
EMPTY_NOTIFIER
, 
rou‹r
());

53 
	g_¡İ
 = 
çl£
;

54 ià(
Args
(
cÚf
, 
this
, 
”rh
)

55 .
»ad
("STOP", 
_¡İ
)

56 .
»ad
("BUFFER", 
_bufãr
)

57 .
com¶‘e
() < 0)

59 ià(
	g_bufãr
 <= 0)

60  
”rh
->
”rÜ
("BUFFER must be‡t†east 1");

65 
	gTimeSÜ‹dSched
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

67 
_pkt
 = 
Ãw
 
·ck‘_s
[
	`nšputs
(è* 
_bufãr
];

68 
_šput
 = 
Ãw
 
šput_s
[
	`nšputs
()];

69 ià(!
_pkt
 || !
_šput
)

70  
”rh
->
	`”rÜ
("out of memory!");

71 
i
 = 0; i < 
	`nšputs
(); i++) {

72 
_šput
[
i
].
sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, i, &
_nÙif›r
);

73 
_šput
[
i
].
¥aû
 = 
_bufãr
;

74 
_šput
[
i
].
»ady
 = i;

76 
_Ä—dy
 = 
	`nšputs
();

78 
	}
}

81 
	gTimeSÜ‹dSched
::
	$ş—nup
(
CËªupSge
)

83 
i
 = 0; i < 
_Åkt
; ++i)

84 
_pkt
[
i
].
p
->
	`kl
();

85 
d–‘e
[] 
_pkt
;

86 
d–‘e
[] 
_šput
;

87 
	}
}

89 
Pack‘
*

90 
	gTimeSÜ‹dSched
::
	$puÎ
()

92 
boŞ
 
sigÇls_Ú
 = 
çl£
;

94 
½os
 = 
_Ä—dy
 - 1;„pos >= 0; --rpos) {

95 
i
 = 
_šput
[
½os
].
»ady
;

96 
šput_s
 &
is
 = 
_šput
[
i
];

97 ià(
is
.
sigÇl
) {

98 
sigÇls_Ú
 = 
Œue
;

99 (
_pkt
[
_Åkt
].
p
 = 
	`šput
(
i
).
	`puÎ
())) {

100 
_pkt
[
_Åkt
].
šput
 = 
i
;

101 ++
_Åkt
;

102 
	`push_h—p
(
_pkt
, _pkˆ+ 
_Åkt
, 
	`h—p_Ëss
());

103 --
is
.
¥aû
;

104 ià(!
is
.
¥aû
) {

105 
_šput
[
½os
].
»ady
 = _šput[
_Ä—dy
 - 1].ready;

106 --
_Ä—dy
;

114 
_nÙif›r
.
	`£t_aùive
(
_Åkt
 > 0 || 
sigÇls_Ú
);

115 ià(
_Åkt
 > 0) {

116 
Pack‘
 *
p
 = 
_pkt
[0].p;

117 ià(
p
->
	`time¡amp_ªno
()) {

118 ià(
_Ï¡_emissiÚ
 && 
p
->
	`time¡amp_ªno
() < _last_emission)

119 
_w–l_Üd”ed
 = 
çl£
;

120 
_Ï¡_emissiÚ
 = 
p
->
	`time¡amp_ªno
();

122 
šput_s
 &
is
 = 
_šput
[
_pkt
[0].
šput
];

123 ++
is
.
¥aû
;

124 ià(
is
.
¥aû
 == 1) {

125 
_šput
[
_Ä—dy
].
»ady
 = 
_pkt
[0].
šput
;

126 ++
_Ä—dy
;

128 
	`pİ_h—p
(
_pkt
, _pkˆ+ 
_Åkt
, 
	`h—p_Ëss
());

129 --
_Åkt
;

130  
p
;

132 ià(
_¡İ
 && !
sigÇls_Ú
)

133 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

136 
	}
}

139 
	gTimeSÜ‹dSched
::
	$add_hªdËrs
()

141 
	`add_d©a_hªdËrs
("w–l_Üd”ed", 
HªdËr
::
f_»ad
 | HªdËr::
f_checkbox
, &
_w–l_Üd”ed
);

142 
	}
}

144 
CLICK_ENDDECLS


145 
EXPORT_ELEMENT
(
TimeSÜ‹dSched
)

	@analysis/timesortedsched.hh

2 #iâdeà
CLICK_TIMESORTEDSCHED_HH


3 
	#CLICK_TIMESORTEDSCHED_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/nÙif›r.hh
>

6 
CLICK_DECLS


80 şas 
	cTimeSÜ‹dSched
 : 
public
 
EËm’t
 {…ublic:

82 
	$TimeSÜ‹dSched
(è
CLICK_COLD
;

83 ~
	$TimeSÜ‹dSched
(è
CLICK_COLD
;

85 cÚ¡ *
	$şass_Çme
() const {  "TimeSortedSched"; }

86 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/1"; 
	}
}

87 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

88 cÚ¡ *
	$æags
(ècÚ¡ {  "S0"; 
	}
}

89 *
ÿ¡
(const *);

91 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

92 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

93 
	$ş—nup
(
CËªupSge
 
¡age
è
CLICK_COLD
;

94 
	$add_hªdËrs
(è
CLICK_COLD
;

96 
Pack‘
 *
	`puÎ
();

98 
´iv©e
:

100 
	s·ck‘_s
 {

101 
Pack‘
 *
p
;

102 
šput
;

103 
	}
};

104 
	sh—p_Ëss
 {

105 
šlše
 
boŞ
 
İ”©Ü
()(
	g·ck‘_s
 &
	ga
,…ack‘_ &
	gb
) {

106  
	ga
.
	gp
->
time¡amp_ªno
(è< 
	gb
.p->timestamp_anno();

109 
	sšput_s
 {

110 
NÙif›rSigÇl
 
	gsigÇl
;

111 
	g¥aû
;

112 
	g»ady
;

115 
·ck‘_s
 *
	g_pkt
;

116 
	g_Åkt
;

118 
šput_s
 *
	g_šput
;

119 
	g_Ä—dy
;

121 
NÙif›r
 
	g_nÙif›r
;

122 
	g_bufãr
;

123 
Time¡amp
 
	g_Ï¡_emissiÚ
;

124 
boŞ
 
	g_¡İ
;

125 
boŞ
 
	g_w–l_Üd”ed
;

129 
	gCLICK_ENDDECLS


	@analysis/timestampaccum.cc

19 
	~<şick/cÚfig.h
>

20 
	~"time¡am·ccum.hh
"

21 
	~<şick/glue.hh
>

22 
CLICK_DECLS


24 
	gTime¡ampAccum
::
	$Time¡ampAccum
()

26 
	}
}

28 
Time¡ampAccum
::~
	$Time¡ampAccum
()

30 
	}
}

33 
Time¡ampAccum
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

35 
_u£c_accum
 = 0;

36 
_couÁ
 = 0;

38 
	}
}

40 
šlše
 
Pack‘
 *

41 
	gTime¡ampAccum
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

43 
_u£c_accum
 +ğ(
Time¡amp
::
	`now
(è- 
p
->
	`time¡amp_ªno
()).
	`doubËv®
();

44 
_couÁ
++;

45  
p
;

46 
	}
}

48 
SŒšg


49 
	gTime¡ampAccum
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

51 
Time¡ampAccum
 *

 = 
¡©ic_ÿ¡
<Time¡ampAccum *>(
e
);

52 
which
 = 
»š‹½»t_ÿ¡
<
šŒ_t
>(
thunk
);

53 
which
) {

55  
	`SŒšg
(

->
_couÁ
);

57  
	`SŒšg
(

->
_u£c_accum
);

59  
	`SŒšg
(

->
_u£c_accum
 /a->
_couÁ
);

61  
	`SŒšg
();

63 
	}
}

66 
	gTime¡ampAccum
::
	$»£t_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

68 
Time¡ampAccum
 *

 = 
¡©ic_ÿ¡
<Time¡ampAccum *>(
e
);

69 

->
_u£c_accum
 = 0;

70 

->
_couÁ
 = 0;

72 
	}
}

75 
	gTime¡ampAccum
::
	$add_hªdËrs
()

77 
	`add_»ad_hªdËr
("couÁ", 
»ad_hªdËr
, 0);

78 
	`add_»ad_hªdËr
("time", 
»ad_hªdËr
, 1);

79 
	`add_»ad_hªdËr
("av”age_time", 
»ad_hªdËr
, 2);

80 
	`add_wr™e_hªdËr
("»£t_couÁs", 
»£t_hªdËr
, 0, 
HªdËr
::
f_bu‰Ú
);

81 
	}
}

83 
CLICK_ENDDECLS


84 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
št64
)

85 
	`EXPORT_ELEMENT
(
Time¡ampAccum
)

	@analysis/timestampaccum.hh

2 #iâdeà
CLICK_TIMESTAMPACCUM_HH


3 
	#CLICK_TIMESTAMPACCUM_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


35 şas 
	cTime¡ampAccum
 : 
public
 
EËm’t
 {…ublic:

37 
	$Time¡ampAccum
(è
CLICK_COLD
;

38 ~
	$Time¡ampAccum
(è
CLICK_COLD
;

40 cÚ¡ *
	$şass_Çme
() const {  "TimestampAccum"; }

41 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

43 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

44 
	$add_hªdËrs
(è
CLICK_COLD
;

46 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

48 
´iv©e
:

50 
_u£c_accum
;

51 
ušt64_t
 
_couÁ
;

53 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

54 
	`»£t_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

56 
	}
};

58 
	gCLICK_ENDDECLS


	@analysis/toipflowdumps.cc

19 
	~<şick/cÚfig.h
>

20 
	~"toæowdumps.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
	~<şick/rou‹r.hh
>

25 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

26 
	~<şickÃt/udp.h
>

27 
	~<şickÃt/icmp.h
>

28 
	~<uni¡d.h
>

29 
	~<sys/¡©.h
>

30 
	~<sys/ty³s.h
>

31 
	~<sys/wa™.h
>

32 
	~<fú.h
>

33 
	~"–em’ts/ª®ysis/sumdumpšfo.hh
"

34 
	gCLICK_DECLS


36 #ifdeà
i386


37 
	#PUT4
(
p
, 
d
è*
»š‹½»t_ÿ¡
<
ušt32_t
 *>(Õ)èğ
	`htÚl
((d))

	)

39 
	#PUT4
(
p
, 
d
èdØ{ (p)[0] = (d)>>24; (p)[1] = (d)>>16; (p)[2] = (d)>>8; (p)[3] = (d); } 0)

	)

41 
	#PUT1
(
p
, 
d
è(Õ)[0] = (d))

	)

43 
	gToIPFlowDumps
::
Flow
::
	$Flow
(cÚ¡ 
Pack‘
 *
p
, cÚ¡ 
SŒšg
 &
f’ame
,

44 
boŞ
 
absŞu‹_time
, boŞ 
absŞu‹_£q
, boŞ 
bš¬y
,

45 
boŞ
 
_id
, 
tı_İt
, boŞ 
tı_wšdow
)

46 : 
	`_Ãxt
(0),

47 
	`_æowid
(
p
), 
	`__p
Õ->
	`_h—d”
()->
_p
),

48 
	`_agg»g©e
(
	`AGGREGATE_ANNO
(
p
)), 
	`_·ck‘_couÁ
(0), 
	`_nÙe_couÁ
(0),

49 
	`_f’ame
(
f’ame
), 
	`_ouu‰ed
(
çl£
), 
	`_bš¬y
(
bš¬y
),

50 
	`_tı_İt
(
tı_İt
), 
	`_Åkt
(0), 
	$_ÂÙe
(0)

53 ià(
__p
 =ğ
IP_PROTO_ICMP
) {

54 cÚ¡ 
şick_icmp
 *
icmph
 = 
p
->
	`icmp_h—d”
();

56 cÚ¡ 
şick_
 *
embedded_h
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_ *>(
icmph
 + 1);

57 
_æowid
 = 
	`IPFlowID
(
embedded_h
);

58 
__p
 = 
embedded_h
->
_p
;

61 ià(
	`PAINT_ANNO
(
p
) & 1)

62 
_æowid
 = _æowid.
	`»v”£
();

64 
_have_fœ¡_£q
[0] = _have_fœ¡_£q[1] = 
absŞu‹_£q
;

65 
_fœ¡_£q
[0] = _first_seq[1] = 0;

67 ià(
absŞu‹_time
)

68 
_fœ¡_time¡amp
 = 
	`Time¡amp
();

70 
_fœ¡_time¡amp
 = 
p
->
	`time¡amp_ªno
(è- 
Time¡amp
::
	`•sÚ
();

72 ià(
_id
)

73 
__ids
 = 
Ãw
 
ušt16_t
[
NPKT
];

75 
__ids
 = 0;

77 ià(
tı_wšdow
 && 
__p
 =ğ
IP_PROTO_TCP
)

78 
_tı_wšdows
 = 
Ãw
 
ušt16_t
[
NPKT
];

80 
_tı_wšdows
 = 0;

83 
	`as£¹
(
_agg»g©e
 && (
__p
 =ğ
IP_PROTO_TCP
 || __°=ğ
IP_PROTO_UDP
));

84 
	}
}

86 
	gToIPFlowDumps
::
Flow
::~
	$Flow
()

88 
d–‘e
[] 
__ids
;

89 
d–‘e
[] 
_tı_wšdows
;

90 
	}
}

93 
	gToIPFlowDumps
::
Flow
::
	$ü—‹_dœeùÜ›s
(cÚ¡ 
SŒšg
 &
n
, 
E¼ÜHªdËr
 *
”rh
)

95 
¦ash
 = 
n
.
	`fšd_right
('/');

96 ià(
¦ash
 <= 0)

98 
SŒšg
 
compÚ’t
 = 
n
.
	`sub¡ršg
(0, 
¦ash
);

99 ià(
	`acûss
(
compÚ’t
.
	`c_¡r
(), 
F_OK
) >= 0)

101 ià(
	`ü—‹_dœeùÜ›s
(
compÚ’t
, 
”rh
) < 0)

103 ià(
	`mkdœ
(
compÚ’t
.
	`c_¡r
(), 0777) < 0)

104  
”rh
->
	`”rÜ
("makšg dœeùÜy %s: %s", 
compÚ’t
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

107 
	}
}

110 
	gToIPFlowDumps
::
Flow
::
	$ouut_bš¬y
(
SŒšgAccum
 &
§
)

113 
ušt32_t
 
u
[8];

114 
ušt16_t
 
us
[16];

115 
c
[32];

116 } 
buf
;

117 
pi
 = 0, 
ni
 = 0;

118 cÚ¡ 
ušt16_t
 *
İt
 = 
»š‹½»t_ÿ¡
<cÚ¡ ušt16_ˆ*>(
_İt_šfo
.
	`d©a
());

119 cÚ¡ 
ušt16_t
 *
’d_İt
 = 
İt
 + (
_İt_šfo
.
	`Ëngth
() / 2);

121 
pi
 < 
_Åkt
 || 
ni
 < 
_ÂÙe
)

122 ià(
ni
 >ğ
_ÂÙe
 || 
_nÙe
[ni].
befÜe_pkt
 > 
pi
) {

123 
pos
;

125 
buf
.
u
[1] = 
	`Áohl
(
_pkt
[
pi
].
time¡amp
.
	`£c
());

126 #ià
TIMESTAMP_NANOSEC


127 
buf
.
u
[2] = 
	`Áohl
(
_pkt
[
pi
].
time¡amp
.
	`n£c
());

129 
buf
.
u
[2] = 
	`Áohl
(
_pkt
[
pi
].
time¡amp
.
	`u£c
());

131 ià(
__p
 =ğ
IP_PROTO_TCP
) {

132 
buf
.
u
[3] = 
	`Áohl
(
_pkt
[
pi
].
th_£q
);

133 
buf
.
u
[4] = 
	`Áohl
(
_pkt
[
pi
].
·ylßd_Ën
);

134 
buf
.
u
[5] = 
	`Áohl
(
_pkt
[
pi
].
th_ack
);

135 
pos
 = 24;

137 
buf
.
u
[3] = 
	`Áohl
(
_pkt
[
pi
].
·ylßd_Ën
);

138 
pos
 = 16;

141 ià(
__ids
)

142 
buf
.
us
[
pos
>>1] = 
__ids
[
pi
],…os += 2;

143 ià(
_tı_wšdows
)

144 
buf
.
us
[
pos
>>1] = 
_tı_wšdows
[
pi
],…os += 2;

145 ià(
__p
 =ğ
IP_PROTO_TCP
)

146 
buf
.
c
[
pos
++] = 
_pkt
[
pi
].
th_æags
;

147 
buf
.
c
[
pos
++] = 
_pkt
[
pi
].
dœeùiÚ
;

149 
buf
.
u
[0] = 
	`Áohl
(
pos
);

150 
§
.
	`­³nd
(&
buf
.
c
[0], 
pos
);

153 ià(
İt
 < 
’d_İt
 && o±[0] =ğ
pi
) {

154 
Üigš®_pos
 = 
§
.
	`Ëngth
(è- 
pos
;

155 
IPSumm¬yDump
::
	`uÅ¬£_tı_İt_bš¬y
(
§
, 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
 *>(
İt
 + 2), o±[1], 
_tı_İt
);

156 
	`PUT4
(
§
.
	`d©a
(è+ 
Üigš®_pos
, sa.
	`Ëngth
() - original_pos);

157 
İt
 += 2 + (opt[1] / 2);

160 
pi
++;

162 
Ën
 = (
ni
 =ğ
_ÂÙe
 - 1 ? (
ušt32_t
è
_nÙe_‹xt
.
	`Ëngth
(è: 
_nÙe
[ni+1].
pos
) - _note[ni].pos;

163 
»cÜd_Ën
 = (4 + 
Ën
 + 2);

164 
buf
.
u
[0] = 
	`Áohl
(
»cÜd_Ën
 | 0x80000000U);

165 
buf
.
c
[4] = '#';

166 
§
.
	`­³nd
(&
buf
.
c
[0], 5);

167 
§
.
	`­³nd
(
_nÙe_‹xt
.
	`d©a
(è+ 
_nÙe
[
ni
].
pos
, 
Ën
);

168 
§
.
	`­³nd
("\n", 1);

169 
ni
++;

171 
	}
}

174 
	gToIPFlowDumps
::
Flow
::
	$ouut
(
E¼ÜHªdËr
 *
”rh
)

176 
SŒšgAccum
 
§
;

178 
fd
;

179 ià(
_f’ame
 == "-")

180 
fd
 = 
STDOUT_FILENO
;

181 ià(
_ouu‰ed
)

182 
fd
 = 
	`İ’
(
_f’ame
.
	`c_¡r
(), 
O_WRONLY
 | 
O_APPEND
);

183 ià(
	`ü—‹_dœeùÜ›s
(
_f’ame
, 
”rh
) < 0)

186 
fd
 = 
	`İ’
(
_f’ame
.
	`c_¡r
(), 
O_WRONLY
 | 
O_CREAT
 | 
O_TRUNC
, 0666);

187 ià(
fd
 < 0)

188  
”rh
->
	`”rÜ
("%s: %s", 
_f’ame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

191 
§
.
	`ş—r
();

192 
§
.
	`»£rve
(
_Åkt
 * (
_bš¬y
 ? 28 : 40è+ 
_nÙe_‹xt
.
	`Ëngth
(è+ 
_ÂÙe
 * 8 + 
_İt_šfo
.length() + 16);

194 ià(!
_ouu‰ed
) {

195 
§
 << "!IPSummaryDump 1.3\n!flowid "

196 << 
_æowid
.
	`§ddr
(è<< ' ' << 
	`Áohs
(_æowid.
	`¥Üt
()) << ' '

197 << 
_æowid
.
	`daddr
(è<< ' ' << 
	`Áohs
(_æowid.
	`dpÜt
()) << ' '

198 << (
__p
 =ğ
IP_PROTO_TCP
 ? 'T' : 'U')

199 << "\n!agg»g©" << 
_agg»g©e
 << '\n';

201 #ià
TIMESTAMP_NANOSEC


202 
§
 << "!data‚timestamp";

204 
§
 << "!dataimestamp";

206 ià(
_bš¬y
) {

207 ià(
__p
 =ğ
IP_PROTO_TCP
)

208 
§
 << "cp_seq…ayload_lencp_ack";

210 
§
 << "…ayload_len";

211 ià(
__ids
)

212 
§
 << " ip_id";

213 ià(
_tı_wšdows
)

214 
§
 << "cp_window";

215 ià(
__p
 =ğ
IP_PROTO_TCP
)

216 
§
 << "cp_flags";

217 
§
 << " direction";

218 ià(
__p
 =ğ
IP_PROTO_TCP
) {

219 ià(
_tı_İt
 & 
IPSumm¬yDump
::
DO_TCPOPT_TIMESTAMP
)

220 
§
 << "cp_opt";

222 
§
 << "cp_ntopt";

225 
§
 << " direction";

226 ià(
__ids
)

227 
§
 << " ip_id";

228 ià(
__p
 =ğ
IP_PROTO_TCP
) {

229 
§
 << "cp_flagscp_seq…ayload_lencp_ack";

230 ià(
_tı_İt
 & 
IPSumm¬yDump
::
DO_TCPOPT_TIMESTAMP
)

231 
§
 << "cp_opt";

233 
§
 << "cp_ntopt";

235 
§
 << "…ayload_len";

237 
§
 << '\n';

239 ià(
_have_fœ¡_£q
[0] && 
_fœ¡_£q
[0] && 
__p
 =ğ
IP_PROTO_TCP
)

240 
§
 << "!fœ¡£q > " << 
_fœ¡_£q
[0] << '\n';

241 ià(
_have_fœ¡_£q
[1] && 
_fœ¡_£q
[1] && 
__p
 =ğ
IP_PROTO_TCP
)

242 
§
 << "!fœ¡£q < " << 
_fœ¡_£q
[1] << '\n';

243 ià(
_fœ¡_time¡amp
)

244 
§
 << "!fœ¡tim" << 
_fœ¡_time¡amp
 << '\n';

245 ià(
_bš¬y
)

246 
§
 << "!binary\n";

249 ià(
_bš¬y
)

250 
	`ouut_bš¬y
(
§
);

252 
pi
 = 0, 
ni
 = 0;

253 cÚ¡ 
ušt16_t
 *
İt
 = 
»š‹½»t_ÿ¡
<cÚ¡ ušt16_ˆ*>(
_İt_šfo
.
	`d©a
());

254 cÚ¡ 
ušt16_t
 *
’d_İt
 = 
İt
 + (
_İt_šfo
.
	`Ëngth
() / 2);

256 
pi
 < 
_Åkt
 || 
ni
 < 
_ÂÙe
)

257 ià(
ni
 >ğ
_ÂÙe
 || 
_nÙe
[ni].
befÜe_pkt
 > 
pi
) {

258 
dœeùiÚ
 = 
_pkt
[
pi
].direction;

259 
§
 << 
_pkt
[
pi
].
time¡amp
 << ' '

260 << (
dœeùiÚ
 == 0 ? '>' : '<') << ' ';

262 ià(
__ids
)

263 
§
 << 
__ids
[
pi
] << ' ';

265 ià(
__p
 =ğ
IP_PROTO_TCP
) {

266 
æags
 = 
_pkt
[
pi
].
th_æags
;

267 ià(
æags
 =ğ
TH_ACK
)

268 
§
 << 'A';

269 ià(
æags
 =ğ(
TH_ACK
 | 
TH_PUSH
))

270 
§
 << 'P' << 'A';

271 ià(
æags
 == 0)

272 
§
 << '.';

274 
æag
 = 0; flag < 7; flag++)

275 ià(
æags
 & (1 << 
æag
))

276 
§
 << 
IPSumm¬yDump
::
tı_æags_wÜd
[
æag
];

278 
§
 << ' ' << 
_pkt
[
pi
].
th_£q


279 << ' ' << 
_pkt
[
pi
].
·ylßd_Ën


280 << ' ' << 
_pkt
[
pi
].
th_ack
;

282 ià(
_tı_wšdows
)

283 
§
 << ' ' << 
	`Áohs
(
_tı_wšdows
[
pi
]);

285 ià(
İt
 < 
’d_İt
 && o±[0] =ğ
pi
) {

286 
§
 << ' ';

287 
IPSumm¬yDump
::
	`uÅ¬£_tı_İt
(
§
, 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
 *>(
İt
 + 2), o±[1], 
_tı_İt
);

288 
İt
 += 2 + (opt[1] / 2);

291 
§
 << '\n';

293 
§
 << 
_pkt
[
pi
].
·ylßd_Ën
 << '\n';

295 
pi
++;

297 
Ën
 = (
ni
 =ğ
_ÂÙe
 - 1 ? (
ušt32_t
è
_nÙe_‹xt
.
	`Ëngth
(è: 
_nÙe
[ni+1].
pos
) - _note[ni].pos;

298 
§
 << '#';

299 
§
.
	`­³nd
(
_nÙe_‹xt
.
	`d©a
(è+ 
_nÙe
[
ni
].
pos
, 
Ën
);

300 
§
 << '\n';

301 
ni
++;

305 
_Åkt
 = 0;

306 
_İt_šfo
.
	`ş—r
();

308 
_nÙe_‹xt
.
	`ş—r
();

309 
_ÂÙe
 = 0;

312 
pos
 = 0;

313 
pos
 < 
§
.
	`Ëngth
()) {

314 
wr™‹n
 = 
	`wr™e
(
fd
, 
§
.
	`d©a
(è+ 
pos
, sa.
	`Ëngth
() -…os);

315 ià(
wr™‹n
 < 0 && 
”ºo
 !ğ
EINTR
) {

316 
”rh
->
	`”rÜ
("%s: %s", 
_f’ame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

319 
pos
 +ğ
wr™‹n
;

322 ià(
fd
 !ğ
STDOUT_FILENO
)

323 
	`şo£
(
fd
);

324 
_ouu‰ed
 = 
Œue
;

326 
	}
}

328 
šlše
 

329 
	gToIPFlowDumps
::
Flow
::
	$uÆšk
(
E¼ÜHªdËr
 *
”rh
)

331 ià(
_ouu‰ed
 && ::
	`uÆšk
(
_f’ame
.
	`c_¡r
()) < 0)

332 
”rh
->
	`”rÜ
("%s: %s", 
_f’ame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

333 
	}
}

336 
	gToIPFlowDumps
::
Flow
::
	$¡Üe_İt
(cÚ¡ 
şick_tı
 *
tıh
, 
dœeùiÚ
)

338 cÚ¡ 
ušt8_t
 *
İt
 = 
»š‹½»t_ÿ¡
<cÚ¡ ušt8_ˆ*>(
tıh
 + 1);

339 cÚ¡ 
ušt8_t
 *
’d_İt
 = 
İt
 + ((
tıh
->
th_off
 << 2è- (
şick_tı
));

340 
boŞ
 
ªy
 = 
çl£
;

341 
Üigš®_Ën
 = 
_İt_šfo
.
	`Ëngth
();

342 *
d©a
;

344 
İt
 < 
’d_İt
)

345 *
İt
) {

346 
TCPOPT_EOL
:

347 
dÚe
;

348 
TCPOPT_NOP
:

349 
İt
++;

351 
TCPOPT_MAXSEG
:

352 ià(
İt
[1] !ğ
TCPOLEN_MAXSEG
 || o± + o±[1] > 
’d_İt
)

353 
bad_İt
;

355 
good_İt
;

356 
TCPOPT_WSCALE
:

357 ià(
İt
[1] !ğ
TCPOLEN_WSCALE
 || o± + o±[1] > 
’d_İt
)

358 
bad_İt
;

360 
good_İt
;

361 
TCPOPT_SACK_PERMITTED
:

362 ià(
İt
[1] !ğ
TCPOLEN_SACK_PERMITTED
 || o± + o±[1] > 
’d_İt
)

363 
bad_İt
;

365 
good_İt
;

366 
TCPOPT_TIMESTAMP
:

367 ià(
İt
[1] !ğ
TCPOLEN_TIMESTAMP
 || o± + o±[1] > 
’d_İt
)

368 
bad_İt
;

369 ià(
_tı_İt
 & 
IPSumm¬yDump
::
DO_TCPOPT_TIMESTAMP
)

370 
good_İt
;

372 
ignÜe_İt
;

373 
good_İt
:

374 ià(!
ªy
 && (
d©a
 = 
_İt_šfo
.
	`ex‹nd
(4)))

375 *(
»š‹½»t_ÿ¡
<
ušt16_t
 *>(
d©a
)èğ
_Åkt
;

376 ià((
d©a
 = 
_İt_šfo
.
	`ex‹nd
(
İt
[1])))

377 
	`memıy
(
d©a
, 
İt
, opt[1]);

378 
İt
 += opt[1];

379 
ªy
 = 
Œue
;

381 
TCPOPT_SACK
:

382 ià(
İt
[1] % 8 !ğ2 || o± + o±[1] > 
’d_İt
)

383 
bad_İt
;

384 ià(!
ªy
 && (
d©a
 = 
_İt_šfo
.
	`ex‹nd
(4)))

385 *(
»š‹½»t_ÿ¡
<
ušt16_t
 *>(
d©a
)èğ
_Åkt
;

386 ià((
d©a
 = 
_İt_šfo
.
	`ex‹nd
(
İt
[1]))) {

388 
	`memıy
(
d©a
, 
İt
, 2);

389 cÚ¡ 
ušt8_t
 *
’d_§ck_İt
 = 
İt
 + opt[1];

390 
İt
 +ğ2, 
d©a
 +ğ2; o± < 
’d_§ck_İt
; opt += 8, data += 8) {

391 
ušt32_t
 
buf
[2];

392 
	`memıy
(
buf
, 
İt
, 8);

393 ià(!
_have_fœ¡_£q
[!
dœeùiÚ
]) {

394 
_fœ¡_£q
[!
dœeùiÚ
] = 
	`Áohl
(
buf
[0]);

395 
_have_fœ¡_£q
[!
dœeùiÚ
] = 
Œue
;

397 
buf
[0] = 
	`htÚl
(
	`Áohl
(buf[0]è- 
_fœ¡_£q
[!
dœeùiÚ
]);

398 
buf
[1] = 
	`htÚl
(
	`Áohl
(buf[1]è- 
_fœ¡_£q
[!
dœeùiÚ
]);

399 
	`memıy
(
d©a
, 
buf
, 8);

402 
İt
 += opt[1];

403 
ªy
 = 
Œue
;

406 ià(
İt
[1] =ğ0 || o± + o±[1] > 
’d_İt
)

407 
bad_İt
;

409 
ignÜe_İt
;

410 
ignÜe_İt
:

411 
İt
 += opt[1];

415 
dÚe
:

416 ià(
ªy
) {

417 ià(
_İt_šfo
.
	`Ëngth
() & 1)

418 
_İt_šfo
.
	`­³nd
('\0');

419 *(
»š‹½»t_ÿ¡
<
ušt16_t
 *>(
_İt_šfo
.
	`d©a
(è+ 
Üigš®_Ën
è+ 1èğ_İt_šfo.
	`Ëngth
() - original_len - 4;

423 
bad_İt
:

424 
_İt_šfo
.
	`£t_Ëngth
(
Üigš®_Ën
);

425 
	}
}

428 
	gToIPFlowDumps
::
Flow
::
	$add_pkt
(cÚ¡ 
Pack‘
 *
p
, 
E¼ÜHªdËr
 *
”rh
)

431 ià(
	`PAINT_ANNO
(
p
) >= 2) {

432 
	`as£¹
(
p
->
	`_h—d”
()->
_p
 =ğ
IP_PROTO_ICMP
);

433 
SŒšgAccum
 
§
;

434 
§
 << 
p
->
	`time¡amp_ªno
(è<< ' ' << (
	`PAINT_ANNO
(p) & 1 ? '>' : '<') << " ICMP_error";

436 
_nÙe_couÁ
--;

437 ià(
_·ck‘_couÁ
 < 0xFFFFFFFFU)

438 
_·ck‘_couÁ
++;

439  
	`add_nÙe
(
§
.
	`ke_¡ršg
(), 
”rh
);

442 ià(
_Åkt
 >ğ
NPKT
 && 
	`ouut
(
”rh
) < 0)

445 
dœeùiÚ
 = (
	`PAINT_ANNO
(
p
) & 1);

446 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

447 
	`as£¹
(
h
->
_p
 =ğ
__p
);

449 
_pkt
[
_Åkt
].
time¡amp
 = 
p
->
	`time¡amp_ªno
(è- 
_fœ¡_time¡amp
;

450 
_pkt
[
_Åkt
].
dœeùiÚ
 = direction;

452 ià(
__ids
)

453 
__ids
[
_Åkt
] = 
h
->
_id
;

455 ià(
__p
 =ğ
IP_PROTO_TCP
) {

456 cÚ¡ 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

458 
tı_£q_t
 
s
 = 
	`Áohl
(
tıh
->
th_£q
);

459 ià(!
_have_fœ¡_£q
[
dœeùiÚ
]) {

460 
_fœ¡_£q
[
dœeùiÚ
] = 
s
;

461 
_have_fœ¡_£q
[
dœeùiÚ
] = 
Œue
;

463 
tı_£q_t
 
a
 = 
	`Áohl
(
tıh
->
th_ack
);

464 ià(!(
tıh
->
th_æags
 & 
TH_ACK
))

465 
a
 = 
_fœ¡_£q
[!
dœeùiÚ
];

466 ià(!
_have_fœ¡_£q
[!
dœeùiÚ
]) {

467 
_fœ¡_£q
[!
dœeùiÚ
] = 
a
;

468 
_have_fœ¡_£q
[!
dœeùiÚ
] = 
Œue
;

471 
_pkt
[
_Åkt
].
th_£q
 = 
s
 - 
_fœ¡_£q
[
dœeùiÚ
];

472 
_pkt
[
_Åkt
].
th_ack
 = 
a
 - 
_fœ¡_£q
[!
dœeùiÚ
];

473 
_pkt
[
_Åkt
].
th_æags
 = 
tıh
->th_flags;

474 
_pkt
[
_Åkt
].
·ylßd_Ën
 = 
	`Áohs
(
h
->
_Ën
è- (h->
_hl
 << 2è- (
tıh
->
th_off
 << 2);

476 ià(
_tı_İt


477 && 
tıh
->
th_off
 > ((
şick_tı
) >> 2)

478 && (
tıh
->
th_off
 != 8

479 || *(
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(
tıh
 + 1)è!ğ
	`htÚl
(0x0101080A)

480 || (
_tı_İt
 & 
IPSumm¬yDump
::
DO_TCPOPT_TIMESTAMP
)))

481 
	`¡Üe_İt
(
tıh
, 
dœeùiÚ
);

483 ià(
_tı_wšdows
)

484 
_tı_wšdows
[
_Åkt
] = 
tıh
->
th_wš
;

487 
_pkt
[
_Åkt
].
·ylßd_Ën
 = 
	`Áohs
(
h
->
_Ën
è- (
şick_udp
);

489 
_Åkt
++;

490 ià(
_·ck‘_couÁ
 < 0xFFFFFFFFU)

491 
_·ck‘_couÁ
++;

494 
	}
}

497 
	gToIPFlowDumps
::
Flow
::
	$add_nÙe
(cÚ¡ 
SŒšg
 &
s
, 
E¼ÜHªdËr
 *
”rh
)

499 ià(
_ÂÙe
 >ğ
NNOTE
 && 
	`ouut
(
”rh
) < 0)

502 
_nÙe
[
_ÂÙe
].
befÜe_pkt
 = 
_Åkt
;

503 
_nÙe
[
_ÂÙe
].
pos
 = 
_nÙe_‹xt
.
	`Ëngth
();

504 
_nÙe_‹xt
 << 
s
;

506 
_ÂÙe
++;

507 
_nÙe_couÁ
++;

510 
	}
}

513 
	gToIPFlowDumps
::
	$ToIPFlowDumps
()

514 : 
	`_Âßgg
(0), 
	`_Çgg
(0), 
	`_agg_nÙif›r
(0), 
	`_sk
(
this
),

515 
	`_gc_tim”
(
gc_hook
, 
this
), 
	`_com´ess_chd
(-1)

517 
i
 = 0; i < 
NFLOWMAP
; i++)

518 
_æowm­
[
i
] = 0;

519 
	}
}

521 
	gToIPFlowDumps
::~
	$ToIPFlowDumps
()

523 
	}
}

525 
SŒšg


526 
ToIPFlowDumps
::
	$ouut_·‰”n
() const

528  (
_gz
 ? 
_f’ame_·‰”n
 + ".gz" : _filename_pattern);

529 
	}
}

532 
	gToIPFlowDumps
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

534 
EËm’t
 *
	ge
 = 0;

535 
boŞ
 
	gabsŞu‹_time
 = 
çl£
, 
	gabsŞu‹_£q
 = f®£, 
	gbš¬y
 = f®£, 
	g®l_tı_İt
 = f®£, 
	gtı_İt
 = f®£, 
	gtı_wšdow
 = f®£, 
	g_id
 = f®£, 
	ggz
 = false;

536 
	g_mšcouÁ
 = 0;

538 ià(
Args
(
cÚf
, 
this
, 
”rh
)

539 .
»ad_p
("FILEPATTERN", 
F’ameArg
(), 
_f’ame_·‰”n
)

540 .
»ad
("OUTPUT_PATTERN", 
F’ameArg
(), 
_f’ame_·‰”n
)

541 .
»ad
("NOTIFIER", 
e
)

542 .
»ad
("ABSOLUTE_TIME", 
absŞu‹_time
)

543 .
»ad
("ABSOLUTE_SEQ", 
absŞu‹_£q
)

544 .
»ad
("BINARY", 
bš¬y
)

545 .
»ad
("ALL_TCP_OPT", 
®l_tı_İt
)

546 .
»ad
("TCP_OPT", 
tı_İt
)

547 .
»ad
("TCP_WINDOW", 
tı_wšdow
)

548 .
»ad
("GZIP", 
gz
)

549 .
»ad
("IP_ID", 
_id
)

550 .
»ad
("MINCOUNT", 
_mšcouÁ
)

551 .
com¶‘e
() < 0)

554 ià(!
	g_f’ame_·‰”n
)

555 
	g_f’ame_·‰”n
 = "-";

556 ià(
fšd
(
_f’ame_·‰”n
, '%'è=ğ_f’ame_·‰”n.
’d
())

557 
”rh
->
w¬nšg
("OUTPUT_PATTERN has‚o %%ƒscapes, so output files will get overwritten");

559 ià(
	ge
 && !(
	g_agg_nÙif›r
 = (
Agg»g©eNÙif›r
 *)
e
->
ÿ¡
("AggregateNotifier")))

560  
”rh
->
”rÜ
("% i nÙ‡ÀAgg»g©eNÙif›r", 
e
->
Çme
().
c_¡r
());

562 
	g_absŞu‹_time
 = 
absŞu‹_time
;

563 
	g_absŞu‹_£q
 = 
absŞu‹_£q
;

564 
	g_bš¬y
 = 
bš¬y
;

565 ià(
	g®l_tı_İt
)

566 
	g_tı_İt
 = 
IPSumm¬yDump
::
DO_TCPOPT_ALL_NOPAD
;

567 ià(
	gtı_İt
)

568 
	g_tı_İt
 = 
IPSumm¬yDump
::
DO_TCPOPT_MSS
 | IPSumm¬yDump::
DO_TCPOPT_WSCALE
 | IPSumm¬yDump::
DO_TCPOPT_SACK
;

570 
	g_tı_İt
 = 0;

571 
	g_tı_wšdow
 = 
tı_wšdow
;

572 
	g__id
 = 
_id
;

573 
	g_gz
 = 
gz
;

578 "C" **
’vœÚ
;

581 
	gToIPFlowDumps
::
	$add_com´es§bË
(cÚ¡ 
SŒšg
 &
f’ame
, 
E¼ÜHªdËr
 *
”rh
)

583 
boŞ
 
nowa™
 = 
f’ame
.
	`Ëngth
();

584 
¬g_¥aû
 = -1;

587 ià(
f’ame
)

588 
_com´es§bËs
.
	`push_back
(
f’ame
);

589 ià(
_com´es§bËs
.
	`size
(è< 10 && 
nowa™
)

593 ià(
_com´ess_chd
 >= 0) {

594 
¡©us
;

595 
»tv®
 = 
	`wa™pid
(
_com´ess_chd
, &
¡©us
, (
nowa™
 ? 
WNOHANG
 : 0));

596 ià(
»tv®
 == 0)

598 ià(
»tv®
 < 0)

599  
”rh
->
	`Ë¼Ü
(
	`deş¬©iÚ
(), "com´essÜ: wa™pid: %s;\nÿnûÎšg com´essiÚ", 
	`¡»¼Ü
(
”ºo
));

601 
_com´ess_chd
 = -1;

602 ià(
	`WIFSIGNALED
(
¡©us
))

603  
”rh
->
	`Ë¼Ü
(
	`deş¬©iÚ
(), "com´essÜƒx™ed w™h sigÇÈ%d;\nÿnûÎšg com´essiÚ", 
	`WTERMSIG
(
¡©us
));

604 ià(!
	`WIFEXITED
(
¡©us
è|| 
	`WEXITSTATUS
(status))

605  
”rh
->
	`Ë¼Ü
(
	`deş¬©iÚ
(), "compressor did‚otƒxit‚ormally;\ncancelling compression");

608 ià(
_com´es§bËs
.
	`size
() == 0)

612 ià(
¬g_¥aû
 < 0) {

613 #ifdeà
_SC_ARG_MAX


614 
¬g_¥aû
 = 
	`syscÚf
(
_SC_ARG_MAX
);

615 #–ià
	`defšed
(
ARG_MAX
)

616 
¬g_¥aû
 = 
ARG_MAX
;

618 
¬g_¥aû
 = 1024;

620 **
•Œ
 = 
’vœÚ
; *eptr;ƒptr++)

621 
¬g_¥aû
 -ğ
	`¡¾’
(*
•Œ
) + 1;

622 
¬g_¥aû
 = (arg_space < 64 ? 1024 :‡rg_space - 32);

626 
VeùÜ
<cÚ¡ *> 
¬gs
;

627 
¬gs
.
	`push_back
("gzip");

628 
¬gs
.
	`push_back
("-f");

629 
n
 = 0, 
my_¬g_¥aû
 = 
¬g_¥aû
;

630 
i
 = 
_com´es§bËs
.
	`size
(è- 1; i >ğ0; i--, 
n
++) {

631 ià(
_com´es§bËs
[
i
][0] == '-')

632 
_com´es§bËs
[
i
] = "./" + _compressables[i];

633 
my_¬g_¥aû
 -ğ
_com´es§bËs
[
i
].
	`Ëngth
() + 1;

634 ià(
my_¬g_¥aû
 < 0)

636 
¬gs
.
	`push_back
(
_com´es§bËs
[
i
].
	`c_¡r
());

638 
¬gs
.
	`push_back
((const *) 0);

640 ià((
_com´ess_chd
 = 
	`fÜk
()) == 0) {

641 ià(
	`execvp
("gz", (* cÚ¡ *è&
¬gs
[0]) < 0) {

642 
”rh
->
	`Ë¼Ü
(
	`deş¬©iÚ
(), "gz faed: %s", 
	`¡»¼Ü
(
”ºo
));

643 
	`abÜt
();

645 } ià(
_com´ess_chd
 < 0)

646 
”rh
->
	`Ë¼Ü
(
	`deş¬©iÚ
(), "fÜk faed: %s;\nÿnûÎšg com´essiÚ", 
	`¡»¼Ü
(
”ºo
));

649 
_com´es§bËs
.
	`»size
(_com´es§bËs.
	`size
(è- 
n
);

652 ià(
n
 == 0)

653  
”rh
->
	`Ë¼Ü
(
	`deş¬©iÚ
(), "compressor failed:‡rgument†istoo†ong; cancelling compression");

656 
	}
}

659 
	gToIPFlowDumps
::
	$’d_æow
(
Flow
 *
f
, 
E¼ÜHªdËr
 *
”rh
)

661 ià(
f
->
	`Åack‘s
(è>ğ
_mšcouÁ
) {

662 
f
->
	`ouut
(
”rh
);

663 ià(
_gz
 && 
f
->
	`f’ame
() != "-")

664 ià(
	`add_com´es§bË
(
f
->
	`f’ame
(), 
”rh
) < 0)

665 
_gz
 = 
çl£
;

667 
f
->
	`uÆšk
(
”rh
);

668 
d–‘e
 
f
;

669 
_næows
--;

670 
	}
}

673 
	gToIPFlowDumps
::
	$ş—nup
(
CËªupSge
)

675 
E¼ÜHªdËr
 *
”rh
 = E¼ÜHªdËr::
	`deçuÉ_hªdËr
();

676 
i
 = 0; i < 
NFLOWMAP
; i++)

677 
Flow
 *
f
 = 
_æowm­
[
i
]) {

678 
_æowm­
[
i
] = 
f
->
	`Ãxt
();

679 
	`’d_æow
(
f
, 
”rh
);

681 ià(
_Âßgg
 > 0 && 
_Çgg
 == 0)

682 
”rh
->
	`lw¬nšg
(
	`deş¬©iÚ
(), "saw‚o…ackets with‡ggregate‡nnotations");

683 (
_com´ess_chd
 >ğ0 || 
_com´es§bËs
.
	`size
())

684 && 
	`add_com´es§bË
("", 
”rh
) >= 0)

686 
	}
}

689 
	gToIPFlowDumps
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

691 ià(
	`šput_is_puÎ
(0è&& 
	`nouuts
() == 0) {

692 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

693 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

695 ià(
_agg_nÙif›r
)

696 
_agg_nÙif›r
->
	`add_li¡’”
(
this
);

697 
_gc_tim”
.
	`š™Ÿlize
(
this
);

699 
	}
}

701 
SŒšg


702 
	gToIPFlowDumps
::
	$ex·nd_f’ame
(cÚ¡ 
Pack‘
 *
pkt
, 
E¼ÜHªdËr
 *
”rh
) const

704 cÚ¡ *
d©a
 = 
_f’ame_·‰”n
.
	`d©a
();

705 
Ën
 = 
_f’ame_·‰”n
.
	`Ëngth
();

706 
SŒšgAccum
 
§
;

708 
p
 = 0;… < 
Ën
;…++)

709 ià(
d©a
[
p
] == '%') {

710 
p
++;

711 
boŞ
 
z”o_·d
 = 
çl£
;

712 
f›ld_width
 = -1;

713 
´ecisiÚ
 = -1;

714 ià(
p
 < 
Ën
 && 
d©a
[p] == '0')

715 
z”o_·d
 = 
Œue
, 
p
++;

716 ià(
p
 < 
Ën
 && 
	`isdig™
((è
d©a
[p])) {

717 
f›ld_width
 = 
d©a
[
p
] - '0';

718 
p
++;… < 
Ën
 && 
	`isdig™
((è
d©a
[p]);…++)

719 
f›ld_width
 = (f›ld_width * 10è+ 
d©a
[
p
] - '0';

721 ià(
p
 < 
Ën
 && 
d©a
[p] == '.') {

722 
´ecisiÚ
 = 0;

723 
p
++;… < 
Ën
 && 
	`isdig™
((è
d©a
[p]);…++)

724 
´ecisiÚ
 = (´ecisiÚ * 10è+ 
d©a
[
p
] - '0';

727 
SŒšgAccum
 
sub§
;

728 ià(
p
 >ğ
Ën
)

729 
”rh
->
	`”rÜ
("bad filename…attern");

730 ià(
d©a
[
p
] == 'n' || data[p] == 'x' || data[p] == 'X') {

731 
fÜm©
[3] = "%d";

732 ià(
d©a
[
p
] != 'n')

733 
fÜm©
[1] = 
d©a
[
p
];

734 
ušt32_t
 
v®ue
 = 
	`AGGREGATE_ANNO
(
pkt
);

735 ià(
´ecisiÚ
 >= 0 &&…recision <= 3)

736 
v®ue
 = (v®u>> ((3 - 
´ecisiÚ
) * 8)) & 255;

737 ià(
´ecisiÚ
 >= 4 &&…recision <= 5)

738 
v®ue
 = (v®u>> ((5 - 
´ecisiÚ
) * 16)) & 65535;

739 
sub§
.
	`¢´štf
(20, 
fÜm©
, 
v®ue
);

740 } ià(
d©a
[
p
] =ğ's' && (
´ecisiÚ
 < 0 ||…recision > 3))

741 
sub§
 << 
	`IPAdd»ss
(
pkt
->
	`_h—d”
()->
_¤c
);

742 ià(
d©a
[
p
] == 's')

743 
sub§
 << ((
	`Áohl
(
pkt
->
	`_h—d”
()->
_¤c
.
s_addr
è>> ((3 - 
´ecisiÚ
) * 8)) & 255);

744 ià(
d©a
[
p
] =ğ'd' && (
´ecisiÚ
 < 0 ||…recision > 3))

745 
sub§
 << 
	`IPAdd»ss
(
pkt
->
	`_h—d”
()->
_d¡
);

746 ià(
d©a
[
p
] == 'd')

747 
sub§
 << ((
	`Áohl
(
pkt
->
	`_h—d”
()->
_d¡
.
s_addr
è>> ((3 - 
´ecisiÚ
) * 8)) & 255);

748 ià(
d©a
[
p
] == 'S')

749 
sub§
 << 
	`Áohs
(
pkt
->
	`tı_h—d”
()->
th_¥Üt
);

750 ià(
d©a
[
p
] == 'D')

751 
sub§
 << 
	`Áohs
(
pkt
->
	`tı_h—d”
()->
th_dpÜt
);

752 ià(
d©a
[
p
] == 'p')

753 
sub§
 << (
pkt
->
	`_h—d”
()->
_p
 =ğ
IP_PROTO_TCP
 ? 'T' : 'U');

754 ià(
d©a
[
p
] == '%')

755 
sub§
 << '%';

757 
”rh
->
	`”rÜ
("bad f’am·‰”À`%%%c'", 
d©a
[
p
]);

759 ià(
f›ld_width
 >ğ0 && 
sub§
.
	`Ëngth
() < field_width)

760 
l
 = 
f›ld_width
 - 
sub§
.
	`Ëngth
();† > 0;†--)

761 
§
 << (
z”o_·d
 ? '0' : '_');

762 
§
 << 
sub§
;

764 
§
 << 
_f’ame_·‰”n
[
p
];

766  
§
.
	`ke_¡ršg
();

767 
	}
}

769 
	gToIPFlowDumps
::
Flow
 *

770 
ToIPFlowDumps
::
	$fšd_agg»g©e
(
ušt32_t
 
agg
, cÚ¡ 
Pack‘
 *
p
)

772 ià(
agg
 == 0)

775 
buck‘
 = (
agg
 & (
NFLOWMAP
 - 1));

776 
Flow
 *
´ev
 = 0, *
f
 = 
_æowm­
[
buck‘
];

777 
f
 && f->
	`agg»g©e
(è!ğ
agg
) {

778 
´ev
 = 
f
;

779 
f
 = f->
	`Ãxt
();

782 ià(
f
)

784 ià(
p
 && (
f
 = 
Ãw
 
	`Flow
Õ, 
	`ex·nd_f’ame
Õ, 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
()), 
_absŞu‹_time
, 
_absŞu‹_£q
, 
_bš¬y
, 
__id
, 
_tı_İt
, 
_tı_wšdow
))) {

785 
´ev
 = 
f
;

786 
_næows
++;

790 ià(
´ev
) {

791 
´ev
->
	`£t_Ãxt
(
f
->
	`Ãxt
());

792 
f
->
	`£t_Ãxt
(
_æowm­
[
buck‘
]);

793 
_æowm­
[
buck‘
] = 
f
;

796  
f
;

797 
	}
}

799 
šlše
 

800 
	gToIPFlowDumps
::
	$smaùiÚ
(
Pack‘
 *
p
)

802 ià(
Flow
 *
f
 = 
	`fšd_agg»g©e
(
	`AGGREGATE_ANNO
(
p
),…)) {

803 
_Çgg
++;

804 
f
->
	`add_pkt
(
p
, 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

806 
_Âßgg
++;

807 
	}
}

810 
	gToIPFlowDumps
::
	$push
(, 
Pack‘
 *
p
)

812 
	`smaùiÚ
(
p
);

813 
	`checked_ouut_push
(0, 
p
);

814 
	}
}

816 
Pack‘
 *

817 
	gToIPFlowDumps
::
	$puÎ
()

819 ià(
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
()) {

820 
	`smaùiÚ
(
p
);

821  
p
;

824 
	}
}

826 
boŞ


827 
	gToIPFlowDumps
::
	$run_sk
(
Task
 *)

829 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

830 ià(
p
) {

831 
	`smaùiÚ
(
p
);

832 
p
->
	`kl
();

833 } ià(!
_sigÇl
)

834  
çl£
;

835 
_sk
.
	`ç¡_»scheduË
();

836  
p
 != 0;

837 
	}
}

840 
	gToIPFlowDumps
::
	$add_nÙe
(
ušt32_t
 
agg
, cÚ¡ 
SŒšg
 &
s
, 
E¼ÜHªdËr
 *
”rh
)

842 ià(
Flow
 *
f
 = 
	`fšd_agg»g©e
(
agg
, 0))

843 
f
->
	`add_nÙe
(
s
, (
”rh
 ?ƒ¼h : 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
()));

844 ià(
”rh
)

845 
”rh
->
	`w¬nšg
("aggregate‚ot found");

846 
	}
}

849 
	gToIPFlowDumps
::
	$agg»g©e_nÙify
(
ušt32_t
 
agg
, 
Agg»g©eEv’t
 
ev’t
, cÚ¡ 
Pack‘
 *)

851 ià(
ev’t
 =ğ
DELETE_AGG
 && 
	`fšd_agg»g©e
(
agg
, 0)) {

852 
_gc_aggs
.
	`push_back
(
agg
);

853 
_gc_aggs
.
	`push_back
(
	`şick_jiff›s
());

854 ià(!
_gc_tim”
.
	`scheduËd
())

855 
_gc_tim”
.
	`scheduË_aá”_m£c
(250);

857 
	}
}

860 
	gToIPFlowDumps
::
	$gc_hook
(
Tim”
 *
t
, *
thunk
)

862 
ToIPFlowDumps
 *
td
 = 
¡©ic_ÿ¡
<ToIPFlowDump *>(
thunk
);

863 
ušt32_t
 
lim™_jiff
 = 
	`şick_jiff›s
(è- (
CLICK_HZ
 / 4);

864 
i
;

865 
i
 = 0; i < 
td
->
_gc_aggs
.
	`size
(è&& 
	`SEQ_LEQ
Ñd->_gc_aggs[i+1], 
lim™_jiff
); i += 2)

866 ià(
Flow
 *
f
 = 
td
->
	`fšd_agg»g©e
Ñd->
_gc_aggs
[
i
], 0)) {

867 
buck‘
 = (
f
->
	`agg»g©e
(è& (
NFLOWMAP
 - 1));

868 
	`as£¹
(
td
->
_æowm­
[
buck‘
] =ğ
f
);

869 
td
->
_æowm­
[
buck‘
] = 
f
->
	`Ãxt
();

870 
td
->
	`’d_æow
(
f
, 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

872 ià(
i
 < 
td
->
_gc_aggs
.
	`size
()) {

873 
td
->
_gc_aggs
.
	`”a£
Ñd->_gc_aggs.
	`begš
(),d->_gc_aggs.begš(è+ 
i
);

874 
t
->
	`scheduË_aá”_m£c
(250);

876 
	}
}

878 ’um { 
	mH_CLEAR
 };

881 
	gToIPFlowDumps
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

883 
ToIPFlowDumps
 *
td
 = 
¡©ic_ÿ¡
<ToIPFlowDump *>(
e
);

884 (
šŒ_t
)
thunk
) {

885 
H_CLEAR
:

886 
i
 = 0; i < 
NFLOWMAP
; i++)

887 
Flow
 *
f
 = 
td
->
_æowm­
[
i
]) {

888 
td
->
_æowm­
[
i
] = 
f
->
	`Ãxt
();

889 
td
->
	`’d_æow
(
f
, 
”rh
);

895 
	}
}

898 
	gToIPFlowDumps
::
	$add_hªdËrs
()

900 
	`add_wr™e_hªdËr
("ş—r", 
wr™e_hªdËr
, 
H_CLEAR
);

901 
	}
}

903 
CLICK_ENDDECLS


904 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
Agg»g©eNÙif›r
 
IPSumm¬yDump_TCP
)

905 
	`EXPORT_ELEMENT
(
ToIPFlowDumps
)

	@analysis/toipflowdumps.hh

2 #iâdeà
CLICK_TOIPFLOWDUMPS_HH


3 
	#CLICK_TOIPFLOWDUMPS_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/æowid.hh
>

6 
	~<şick/¡¿ccum.hh
>

7 
	~<şick/sk.hh
>

8 
	~<şick/tim”.hh
>

9 
	~<şick/nÙif›r.hh
>

10 
	~<şickÃt/tı.h
>

11 
	~"agg»g©’Ùif›r.hh
"

12 
CLICK_DECLS


145 
şass
 
	gToIPFlowDumps
 : 
public
 
EËm’t
,…ubliø
	gAgg»g©eLi¡’”
 { 
	gpublic
:

147 
ToIPFlowDumps
(è
CLICK_COLD
;

148 ~
ToIPFlowDumps
(è
	gCLICK_COLD
;

150 cÚ¡ *
şass_Çme
() const {  "ToIPFlowDumps"; }

151 cÚ¡ *
pÜt_couÁ
() const {  "1/0-1"; }

153 ’um { 
	gCONFIGURE_PHASE
 = 
CONFIGURE_PHASE_DEFAULT
 };

154 
cÚfigu»_pha£
(ècÚ¡ {  
	gCONFIGURE_PHASE
; }

155 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

156 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

157 
ş—nup
(
CËªupSge
è
	gCLICK_COLD
;

158 
add_hªdËrs
(è
	gCLICK_COLD
;

160 
push
(, 
Pack‘
 *);

161 
Pack‘
 *
puÎ
();

162 
boŞ
 
run_sk
(
Task
 *);

164 
agg»g©e_nÙify
(
ušt32_t
, 
Agg»g©eEv’t
, cÚ¡ 
Pack‘
 *);

166 
boŞ
 
absŞu‹_time
(ècÚ¡ {  
	g_absŞu‹_time
; }

167 
boŞ
 
absŞu‹_£q
(ècÚ¡ {  
	g_absŞu‹_£q
; }

168 
SŒšg
 
ouut_·‰”n
() const;

169 
vœtu®
 
add_nÙe
(
ušt32_t
, cÚ¡ 
SŒšg
 &, 
E¼ÜHªdËr
 * = 0);

171 
	sPkt
 {

172 
Time¡amp
 
	gtime¡amp
;

173 
tı_£q_t
 
	gth_£q
;

174 
tı_£q_t
 
	gth_ack
;

175 
ušt8_t
 
	gdœeùiÚ
;

176 
ušt8_t
 
	gth_æags
;

177 
ušt16_t
 
	g·ylßd_Ën
;

179 
	sNÙe
 {

180 
	gbefÜe_pkt
;

181 
ušt32_t
 
	gpos
;

184 
	g´iv©e
:

186 şas 
	cFlow
 { 
public
:

188 
Flow
(cÚ¡ 
Pack‘
 *, cÚ¡ 
SŒšg
 &, 
boŞ
 
absŞu‹_time
, boŞ 
absŞu‹_£q
, boŞ 
bš¬y
, boŞ 
_id
, 
tı_İt
, boŞ 
tı_wšdow
);

189 ~
Flow
();

191 
ušt32_t
 
agg»g©e
(ècÚ¡ {  
	g_agg»g©e
; }

192 
ušt32_t
 
Åack‘s
(ècÚ¡ {  
	g_·ck‘_couÁ
; }

193 
SŒšg
 
f’ame
(ècÚ¡ {  
	g_f’ame
; }

194 
Flow
 *
Ãxt
(ècÚ¡ {  
	g_Ãxt
; }

195 
£t_Ãxt
(
Flow
 *
f
è{ 
	g_Ãxt
 = f; }

197 
add_pkt
(cÚ¡ 
Pack‘
 *, 
E¼ÜHªdËr
 *);

198 
add_nÙe
(cÚ¡ 
SŒšg
 &, 
E¼ÜHªdËr
 *);

200 
ouut
(
E¼ÜHªdËr
 *);

201 
com´ess
(
E¼ÜHªdËr
 *);

202 
šlše
 
uÆšk
(
E¼ÜHªdËr
 *);

204 
	g´iv©e
:

206 ’um { 
NPKT
 = 128, 
	gNNOTE
 = 32 };

208 
Flow
 *
	g_Ãxt
;

209 
IPFlowID
 
	g_æowid
;

210 
	g__p
;

211 
ušt32_t
 
	g_agg»g©e
;

212 
ušt32_t
 
	g_·ck‘_couÁ
;

213 
ušt32_t
 
	g_nÙe_couÁ
;

214 
SŒšg
 
	g_f’ame
;

215 
boŞ
 
	g_ouu‰ed
 : 1;

216 
boŞ
 
	g_bš¬y
 : 1;

217 
	g_tı_İt
;

218 
	g_Åkt
;

219 
	g_ÂÙe
;

220 
Time¡amp
 
	g_fœ¡_time¡amp
;

221 
boŞ
 
	g_have_fœ¡_£q
[2];

222 
tı_£q_t
 
	g_fœ¡_£q
[2];

223 
Pkt
 
	g_pkt
[
NPKT
];

224 
NÙe
 
	g_nÙe
[
NNOTE
];

225 
SŒšgAccum
 
	g_nÙe_‹xt
;

226 
SŒšgAccum
 
	g_İt_šfo
;

227 
ušt16_t
 *
	g__ids
;

228 
ušt16_t
 *
	g_tı_wšdows
;

230 
ü—‹_dœeùÜ›s
(cÚ¡ 
SŒšg
 &, 
E¼ÜHªdËr
 *);

231 
ouut_bš¬y
(
SŒšgAccum
 &);

232 
¡Üe_İt
(cÚ¡ 
şick_tı
 *, 
dœeùiÚ
);

236 ’um { 
	gFLOWMAP_BITS
 = 10, 
	gNFLOWMAP
 = 1 << 
FLOWMAP_BITS
 };

237 
Flow
 *
	g_æowm­
[
NFLOWMAP
];

238 
	g_næows
;

240 
SŒšg
 
	g_f’ame_·‰”n
;

241 
SŒšg
 
	g_ouut_bªÃr
;

243 
ušt32_t
 
	g_Âßgg
;

244 
ušt32_t
 
	g_Çgg
;

245 
Agg»g©eNÙif›r
 *
	g_agg_nÙif›r
;

247 
boŞ
 
	g_absŞu‹_time
 : 1;

248 
boŞ
 
	g_absŞu‹_£q
 : 1;

249 
boŞ
 
	g_bš¬y
 : 1;

250 
boŞ
 
	g_gz
 : 1;

251 
boŞ
 
	g__id
 : 1;

252 
boŞ
 
	g_tı_wšdow
 : 1;

253 
	g_tı_İt
;

255 
ušt32_t
 
	g_mšcouÁ
;

257 
Task
 
	g_sk
;

258 
NÙif›rSigÇl
 
	g_sigÇl
;

260 
Tim”
 
	g_gc_tim”
;

261 
	gVeùÜ
<
	gušt32_t
> 
	g_gc_aggs
;

263 
	gVeùÜ
<
	gSŒšg
> 
	g_com´es§bËs
;

264 
	g_com´ess_chd
;

266 
SŒšg
 
	$ex·nd_f’ame
(cÚ¡ 
Pack‘
 *, 
E¼ÜHªdËr
 *) const;

267 
Flow
 *
	`fšd_agg»g©e
(
ušt32_t
, cÚ¡ 
Pack‘
 * = 0);

268 
	`’d_æow
(
Flow
 *, 
E¼ÜHªdËr
 *);

269 
	`add_com´es§bË
(cÚ¡ 
SŒšg
 &, 
E¼ÜHªdËr
 *);

270 
šlše
 
	`smaùiÚ
(
Pack‘
 *);

271 
	`gc_hook
(
Tim”
 *, *);

272 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
*è
CLICK_COLD
;

274 
	}
};

276 
	gCLICK_ENDDECLS


	@analysis/toipsumdump.cc

20 
	~<şick/cÚfig.h
>

21 
	~"tosumdump.hh
"

22 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/·ck‘_ªno.hh
>

26 
	~<şickÃt/.h
>

27 
	~<şickÃt/udp.h
>

28 
	~<şickÃt/tı.h
>

29 
	~<uni¡d.h
>

30 
	~<time.h
>

31 
CLICK_DECLS


33 
	gToIPSumm¬yDump
::
	$ToIPSumm¬yDump
()

34 : 
	`_f
(0), 
	$_sk
(
this
)

36 
	}
}

38 
	gToIPSumm¬yDump
::~
	$ToIPSumm¬yDump
()

40 
	}
}

43 
ToIPSumm¬yDump
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

45 
SŒšg
 
	g§ve
 = "timestamp ip_src";

46 
boŞ
 
	gv”bo£
 = 
çl£
;

47 
boŞ
 
	gbad_·ck‘s
 = 
çl£
;

48 
boŞ
 
	gÿ»ful_Œunc
 = 
Œue
;

49 
boŞ
 
	gmuÉack‘
 = 
çl£
;

50 
boŞ
 
	gbš¬y
 = 
çl£
;

51 
boŞ
 
	gh—d”
 = 
Œue
;

52 
boŞ
 
	gexŒa_Ëngth
 = 
Œue
;

54 ià(
Args
(
cÚf
, 
this
, 
”rh
)

55 .
»ad_mp
("FILENAME", 
F’ameArg
(), 
_f’ame
)

56 .
»ad
("FIELDS", 
AnyArg
(), 
§ve
)

57 .
»ad
("CONTENTS", 
AnyArg
(), 
§ve
)

58 .
»ad
("DATA", 
Args
::
d•»ÿ‹d
, 
AnyArg
(), 
§ve
)

59 .
»ad
("VERBOSE", 
v”bo£
)

60 .
»ad
("HEADER", 
h—d”
)

61 .
»ad
("BANNER", 
_bªÃr
)

62 .
»ad
("MULTIPACKET", 
muÉack‘
)

63 .
»ad
("BAD_PACKETS", 
bad_·ck‘s
)

64 .
»ad
("CAREFUL_TRUNC", 
ÿ»ful_Œunc
)

65 .
»ad
("EXTRA_LENGTH", 
exŒa_Ëngth
)

66 .
»ad
("BINARY", 
bš¬y
)

67 .
com¶‘e
() < 0)

70 
	gVeùÜ
<
	gSŒšg
> 
	gv
;

71 
ı_¥aûvec
(
§ve
, 
v
);

72 
	g_bš¬y_size
 = 4;

73 
	gi
 = 0; i < 
	gv
.
size
(); i++) {

74 
SŒšg
 
	gwÜd
 = 
ı_unquÙe
(
v
[
i
]);

75 cÚ¡ 
	gIPSumm¬yDump
::
F›ldWr™”
 *
f
 = 
IPSumm¬yDump
::F›ldWr™”::
fšd
(
wÜd
);

76 ià(!
	gf
) {

77 
	g”rh
->
”rÜ
("unknowÀcÚ‹Áy³ '%s'", 
wÜd
.
c_¡r
());

82 
	g_f›lds
.
push_back
(
f
);

85 
	gj
 = 0; j < 
	g_´•¬e_f›lds
.
size
(); j++)

86 ià(
	g_´•¬e_f›lds
[
j
]->
	g´•¬e
 =ğ
f
->
´•¬e
)

87 
found_´•¬e
;

88 ià(
	gf
->
	g´•¬e
)

89 
	g_´•¬e_f›lds
.
push_back
(
f
);

92 
	gfound_´•¬e
:

93 
s
 = 
f
->
bš¬y_size
();

94 ià((
	gs
 < 0 || !
	gf
->
	goutb
è&& 
	gbš¬y
)

95 
	g”rh
->
”rÜ
("ÿÂÙ u£ f›ld % w™h BINARY", 
wÜd
.
c_¡r
());

96 
	g_bš¬y_size
 +ğ
s
;

99 ià(
¡rcmp
(
f
->
Çme
, "count") == 0)

100 
_muÉack‘
 = 
çl£
;

102 ià(
	g_f›lds
.
size
() == 0)

103 
”rh
->
”rÜ
("no contents specified");

105 
	g_v”bo£
 = 
v”bo£
;

106 
	g_bad_·ck‘s
 = 
bad_·ck‘s
;

107 
	g_ÿ»ful_Œunc
 = 
ÿ»ful_Œunc
;

108 
	g_muÉack‘
 = 
muÉack‘
;

109 
	g_bš¬y
 = 
bš¬y
;

110 
	g_h—d”
 = 
h—d”
;

111 
	g_exŒa_Ëngth
 = 
exŒa_Ëngth
;

113  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

117 
	gToIPSumm¬yDump
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

119 
	`as£¹
(!
_f
);

120 ià(
_f’ame
 != "-") {

121 
_f
 = 
	`fİ’
(
_f’ame
.
	`c_¡r
(), "wb");

122 ià(!
_f
)

123  
”rh
->
	`”rÜ
("%s: %s", 
_f’ame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

125 
_f
 = 
¡dout
;

126 
_f’ame
 = "<stdout>";

129 ià(
	`šput_is_puÎ
(0)) {

130 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

131 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

133 
_aùive
 = 
Œue
;

134 
_ouut_couÁ
 = 0;

137 
SŒšgAccum
 
§
;

138 
§
 << "!IPSumm¬yDum°" << 
IPSumm¬yDump
::
MAJOR_VERSION
 << '.' << IPSumm¬yDump::
MINOR_VERSION
 << '\n';

140 ià(
_bªÃr
)

141 
§
 << "!ü—tÜ " << 
	`ı_quÙe
(
_bªÃr
) << '\n';

144 ià(
_v”bo£
) {

145 
buf
[
BUFSIZ
];

146 
buf
[
BUFSIZ
 - 1] = '\0';

147 ià(
	`g‘ho¡Çme
(
buf
, 
BUFSIZ
 - 1) >= 0)

148 
§
 << "!ho¡ " << 
buf
 << '\n';

150 
time_t
 
wh’
 = 
	`time
(0);

151 cÚ¡ *
cwh’
 = 
	`ùime
(&
wh’
);

152 
Time¡amp
 
now
 = Time¡amp::
	`now
();

153 ià(
now
)

154 
§
 << "!ruÁim" << 
now
 << " (" << 
	`SŒšg
(
cwh’
, 
	`¡¾’
(cwhen) - 1) << ")\n";

158 
§
 << "!data ";

159 
i
 = 0; i < 
_f›lds
.
	`size
(); i++)

160 
§
 << (
i
 ? " " : "")

161 << (
	`¡rcmp
(
_f›lds
[
i
]->
Çme
, "Áime¡amp"è=ğ0 && !
_bš¬y
 ? "timestamp" : _fields[i]->name);

162 
§
 << '\n';

165 ià(
_bš¬y
)

166 
§
 << "!binary\n";

169 ià(
_h—d”
)

170 
	`ignÜe_»suÉ
(
	`fwr™e
(
§
.
	`d©a
(), 1, sa.
	`Ëngth
(), 
_f
));

173 
	}
}

176 
	gToIPSumm¬yDump
::
	$ş—nup
(
CËªupSge
)

178 ià(
_f
 && _à!ğ
¡dout
)

179 
	`fşo£
(
_f
);

180 
_f
 = 0;

181 
	}
}

183 
boŞ


184 
	gToIPSumm¬yDump
::
	$summ¬y
(
Pack‘
* 
p
, 
SŒšgAccum
& 
§
, SŒšgAccum* 
bad_§
) const

186 
IPSumm¬yDump
::
Pack‘Desc
 
	`d
(
this
, 
p
, &
§
, 
bad_§
, 
_ÿ»ful_Œunc
, 
_exŒa_Ëngth
);

188 
i
 = 0; i < 
_´•¬e_f›lds
.
	`size
(); i++)

189 
_´•¬e_f›lds
[
i
]->
	`´•¬e
(
d
, _prepare_fields[i]);

191 ià(
_bš¬y
) {

192 
§
.
	`ex‹nd
(4);

193 
i
 = 0; i < 
_f›lds
.
	`size
(); i++) {

194 
d
.
	`ş—r_v®ues
();

195 
boŞ
 
ok
 = 
_f›lds
[
i
]->
	`exŒaù
(
d
, _fields[i]);

196 
_f›lds
[
i
]->
	`outb
(
d
, 
ok
, _fields[i]);

198 *(
»š‹½»t_ÿ¡
<
ušt32_t
*>(
§
.
	`d©a
())èğ
	`htÚl
(§.
	`Ëngth
());

200 
i
 = 0; i < 
_f›lds
.
	`size
(); i++) {

201 ià(
i
)

202 
§
 << ' ';

203 
d
.
	`ş—r_v®ues
();

204 ià(
_f›lds
[
i
]->
	`exŒaù
(
d
, _f›lds[i]è&& _f›lds[i]->
ou
)

205 
_f›lds
[
i
]->
	`ou
(
d
, _fields[i]);

207 
§
 << '-';

209 
§
 << '\n';

212  
Œue
;

213 
	}
}

216 
	gToIPSumm¬yDump
::
	$wr™e_·ck‘
(
Pack‘
* 
p
, 
muÉack‘
)

218 ià(
muÉack‘
 > 0 && 
	`EXTRA_PACKETS_ANNO
(
p
) > 0) {

219 
ušt32_t
 
couÁ
 = 1 + 
	`EXTRA_PACKETS_ANNO
(
p
);

220 
ušt32_t
 
tÙ®_Ën
 = 
p
->
	`Ëngth
(), 
Ën
 =…->length();

221 ià(
_exŒa_Ëngth
)

222 
tÙ®_Ën
 +ğ
	`EXTRA_LENGTH_ANNO
(
p
);

223 ià(
tÙ®_Ën
 < 
couÁ
 * 
Ën
)

224 
tÙ®_Ën
 = 
couÁ
 * 
Ën
;

227 
Time¡amp
 
’d_time¡amp
 = 
p
->
	`time¡amp_ªno
();

228 
Time¡amp
 
time¡amp_d–
;

229 ià(
	`FIRST_TIMESTAMP_ANNO
(
p
)) {

230 
time¡amp_d–
 = (
’d_time¡amp
 - 
	`FIRST_TIMESTAMP_ANNO
(
p
)è/ (
couÁ
 - 1);

231 
p
->
	`£t_time¡amp_ªno
(
	`FIRST_TIMESTAMP_ANNO
(p));

233 
time¡amp_d–
 = 
	`Time¡amp
();

235 
	`SET_EXTRA_PACKETS_ANNO
(
p
, 0);

236 
ušt32_t
 
i
 = 
couÁ
; i > 0; i--) {

237 
ušt32_t
 
l
 = 
tÙ®_Ën
 / 
i
;

238 
	`SET_EXTRA_LENGTH_ANNO
(
p
, 
l
 - 
Ën
);

239 
tÙ®_Ën
 -ğ
l
;

240 
	`wr™e_·ck‘
(
p
, -1);

241 ià(
i
 == 1)

242 
p
->
	`time¡amp_ªno
(èğ
’d_time¡amp
;

244 
p
->
	`time¡amp_ªno
(è+ğ
time¡amp_d–
;

248 
_§
.
	`ş—r
();

249 
_bad_§
.
	`ş—r
();

251 
	`summ¬y
(
p
, 
_§
, (
_bad_·ck‘s
 ? &
_bad_§
 : 0));

253 ià(
_bad_·ck‘s
 && 
_bad_§
)

254 
	`wr™e_lše
(
_bad_§
.
	`ke_¡ršg
());

255 
	`ignÜe_»suÉ
(
	`fwr™e
(
_§
.
	`d©a
(), 1, _§.
	`Ëngth
(), 
_f
));

257 
_ouut_couÁ
++;

259 
	}
}

262 
	gToIPSumm¬yDump
::
	$push
(, 
Pack‘
 *
p
)

264 ià(
_aùive
)

265 
	`wr™e_·ck‘
(
p
, 
_muÉack‘
);

266 
	`checked_ouut_push
(0, 
p
);

267 
	}
}

269 
boŞ


270 
	gToIPSumm¬yDump
::
	$run_sk
(
Task
 *)

272 ià(!
_aùive
)

273  
çl£
;

274 ià(
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
()) {

275 
	`wr™e_·ck‘
(
p
, 
_muÉack‘
);

276 
	`checked_ouut_push
(0, 
p
);

277 
_sk
.
	`ç¡_»scheduË
();

278  
Œue
;

279 } ià(
_sigÇl
) {

280 
_sk
.
	`ç¡_»scheduË
();

281  
çl£
;

283  
çl£
;

284 
	}
}

287 
	gToIPSumm¬yDump
::
	$wr™e_lše
(cÚ¡ 
SŒšg
& 
s
)

289 ià(
s
.
	`Ëngth
()) {

290 
	`as£¹
(
s
.
	`back
() == '\n');

291 ià(
_bš¬y
) {

292 
ušt32_t
 
m¬k”
 = 
	`htÚl
(
s
.
	`Ëngth
() | 0x80000000U);

293 
	`ignÜe_»suÉ
(
	`fwr™e
(&
m¬k”
, 4, 1, 
_f
));

295 
	`ignÜe_»suÉ
(
	`fwr™e
(
s
.
	`d©a
(), 1, s.
	`Ëngth
(), 
_f
));

297 
	}
}

300 
	gToIPSumm¬yDump
::
	$add_nÙe
(cÚ¡ 
SŒšg
 &
s
)

302 ià(
s
.
	`Ëngth
()) {

303 
exŒa
 = 1 + (
s
.
	`back
() == '\n' ? 0 : 1);

304 ià(
_bš¬y
) {

305 
ušt32_t
 
m¬k”
 = 
	`htÚl
((
s
.
	`Ëngth
(è+ 
exŒa
) | 0x80000000U);

306 
	`ignÜe_»suÉ
(
	`fwr™e
(&
m¬k”
, 4, 1, 
_f
));

308 
	`åutc
('#', 
_f
);

309 
	`ignÜe_»suÉ
(
	`fwr™e
(
s
.
	`d©a
(), 1, s.
	`Ëngth
(), 
_f
));

310 ià(
exŒa
 > 1)

311 
	`åutc
('\n', 
_f
);

313 
	}
}

316 
	gToIPSumm¬yDump
::
	$æush_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

318 
ToIPSumm¬yDump
 *
tod
 = (ToIPSumm¬yDum°*è
e
;

319 ià(
tod
->
_f
)

320 
	`fæush
(
tod
->
_f
);

322 
	}
}

325 
	gToIPSumm¬yDump
::
	$add_hªdËrs
()

327 ià(
	`šput_is_puÎ
(0))

328 
	`add_sk_hªdËrs
(&
_sk
);

329 
	`add_wr™e_hªdËr
("æush", 
æush_hªdËr
);

330 
	}
}

332 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
IPSumm¬yDump
 
IPSumm¬yDump_AÂo
 
IPSumm¬yDump_IP
 
IPSumm¬yDump_TCP
 
IPSumm¬yDump_UDP
 
IPSumm¬yDump_ICMP
 
IPSumm¬yDump_Paylßd
 
IPSumm¬yDump_Lšk
)

333 
	$EXPORT_ELEMENT
(
ToIPSumm¬yDump
)

334 
CLICK_ENDDECLS


	@analysis/toipsumdump.hh

2 #iâdeà
CLICK_TOIPSUMDUMP_HH


3 
	#CLICK_TOIPSUMDUMP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şick/¡¿ccum.hh
>

7 
	~<şick/nÙif›r.hh
>

8 
	~"sumdumpšfo.hh
"

9 
CLICK_DECLS


349 
şass
 
	gToIPSumm¬yDump
 : 
public
 
EËm’t
,…ubliø
	gIPSumm¬yDumpInfo
 { 
	gpublic
:

351 
ToIPSumm¬yDump
(è
CLICK_COLD
;

352 ~
ToIPSumm¬yDump
(è
	gCLICK_COLD
;

354 cÚ¡ *
şass_Çme
() const {  "ToIPSummaryDump"; }

355 cÚ¡ *
pÜt_couÁ
() const {  "1/0-1"; }

356 cÚ¡ *
´oûssšg
() const {  "a/h"; }

357 cÚ¡ *
æags
() const {  "S2"; }

359 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

360 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

361 
ş—nup
(
CËªupSge
è
	gCLICK_COLD
;

362 
add_hªdËrs
(è
	gCLICK_COLD
;

364 
push
(, 
Pack‘
 *);

365 
boŞ
 
run_sk
(
Task
 *);

367 
SŒšg
 
f’ame
(ècÚ¡ {  
	g_f’ame
; }

368 
ušt32_t
 
ouut_couÁ
(ècÚ¡ {  
	g_ouut_couÁ
; }

369 
add_nÙe
(cÚ¡ 
SŒšg
 &);

370 
wr™e_lše
(cÚ¡ 
SŒšg
 &);

372 
	g´iv©e
:

374 
SŒšg
 
_f’ame
;

375 
FILE
 *
	g_f
;

376 
	gVeùÜ
<cÚ¡ 
	gIPSumm¬yDump
::
F›ldWr™”
 *> 
_f›lds
;

377 
	gVeùÜ
<cÚ¡ 
	gIPSumm¬yDump
::
F›ldWr™”
 *> 
_´•¬e_f›lds
;

378 
boŞ
 
	g_v”bo£
 : 1;

379 
boŞ
 
	g_bad_·ck‘s
 : 1;

380 
boŞ
 
	g_ÿ»ful_Œunc
 : 1;

381 
boŞ
 
	g_muÉack‘
 : 1;

382 
boŞ
 
	g_aùive
 : 1;

383 
boŞ
 
	g_bš¬y
 : 1;

384 
boŞ
 
	g_h—d”
 : 1;

385 
boŞ
 
	g_exŒa_Ëngth
 : 1;

386 
št32_t
 
	g_bš¬y_size
;

387 
ušt32_t
 
	g_ouut_couÁ
;

388 
Task
 
	g_sk
;

389 
NÙif›rSigÇl
 
	g_sigÇl
;

391 
SŒšgAccum
 
	g_§
;

392 
SŒšgAccum
 
	g_bad_§
;

394 
SŒšg
 
	g_bªÃr
;

396 
boŞ
 
summ¬y
(
Pack‘
* 
p
, 
SŒšgAccum
& 
§
, SŒšgAccum* 
bad_§
) const;

397 
wr™e_·ck‘
(
Pack‘
* 
p
, 
muÉack‘
);

398 
æush_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

402 
	gCLICK_ENDDECLS


	@app/ftpportmapper.cc

19 
	~<şick/cÚfig.h
>

20 
	~"áµÜtm­³r.hh
"

21 
	~<şickÃt/.h
>

22 
	~<şickÃt/tı.h
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/rou‹rvis™Ü.hh
>

25 
	~<şick/¬gs.hh
>

26 
	~<şick/”rÜ.hh
>

27 
CLICK_DECLS


29 
	gFTPPÜtM­³r
::
	$FTPPÜtM­³r
()

31 
	}
}

33 
FTPPÜtM­³r
::~
	$FTPPÜtM­³r
()

35 
	}
}

38 
FTPPÜtM­³r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40 
TCPRewr™”
 *
	gÃw_cÚŒŞ_»wr™”
;

41 
IPRewr™”Ba£
 *
	gÃw_d©a_»wr™”
;

42 
	gÃw_d©a_»wr™”_šput
;

44 ià(
Args
(
cÚf
, 
this
, 
”rh
)

45 .
»ad_mp
("CONTROL_REWRITER", 
EËm’tCa¡Arg
("TCPRewr™”"), 
Ãw_cÚŒŞ_»wr™”
)

46 .
»ad_mp
("DATA_REWRITER", 
EËm’tCa¡Arg
("IPRewr™”Ba£"), 
Ãw_d©a_»wr™”
)

47 .
»ad_mp
("DATA_REWRITER_INPUT", 
Ãw_d©a_»wr™”_šput
)

48 .
com¶‘e
() < 0)

51 ià(
	gÃw_d©a_»wr™”_šput
 < 0

52 || 
	gÃw_d©a_»wr™”_šput
 >ğ
Ãw_d©a_»wr™”
->
nšputs
())

53  
”rh
->
”rÜ
("DATA_REWRITER_INPUT out of„ange");

54 
	g_cÚŒŞ_»wr™”
 = 
Ãw_cÚŒŞ_»wr™”
;

55 
	g_d©a_»wr™”
 = 
Ãw_d©a_»wr™”
;

56 
	g_d©a_»wr™”_šput
 = 
Ãw_d©a_»wr™”_šput
;

61 
	gFTPPÜtM­³r
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

64 
EËm’tCa¡T¿ck”
 
	`f‹r
(
	`rou‹r
(), "TCPRewriter");

65 
	`rou‹r
()->
	`vis™_down¡»am
(
this
, 0, &
f‹r
);

66 ià(!
f‹r
.
	`cÚšs
(
_cÚŒŞ_»wr™”
))

67 
”rh
->
	`w¬nšg
("cÚŒŞ…ack‘„ewr™” %<%s%> i nÙ down¡»am", 
_cÚŒŞ_»wr™”
->
	`deş¬©iÚ
().
	`c_¡r
());

69 
	}
}

71 
Pack‘
 *

72 
	gFTPPÜtM­³r
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

74 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

75 
	`as£¹
(
h
->
_p
 =ğ
IP_PROTO_TCP
);

76 cÚ¡ 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

77 
d©a_off£t
 = 
p
->
	`Œª¥Üt_h—d”_off£t
(è+ (
tıh
->
th_off
<<2);

78 cÚ¡ *
d©a
 = 
p
->
	`d©a
(è+ 
d©a_off£t
;

79 
Ën
 = 
p
->
	`Ëngth
(è- 
d©a_off£t
;

81 ià(
Ën
 < 5

82 || (
d©a
[0] != 'P' && data[0] != 'p')

83 || (
d©a
[1] != 'O' && data[1] != 'o')

84 || (
d©a
[2] != 'R' && data[2] != 'r')

85 || (
d©a
[3] != 'T' && data[3] != 't')

86 || 
d©a
[4] != ' ')

87  
p
;

89 
IPFlowID
 
	`cÚŒŞ_æow
(
p
);

90 
IPRewr™”EÁry
 *
p_m­pšg
 = 
_cÚŒŞ_»wr™”
->
	`g‘_’Œy
(
IP_PROTO_TCP
, 
cÚŒŞ_æow
, -1);

91 ià(!
p_m­pšg
)

92  
p
;

95 
pos
 = 5;

96 
pos
 < 
Ën
 && 
d©a
[pos] == ' ')

97 
pos
++;

98 
pÜt_¬g_off£t
 = 
pos
;

101 
nums
[6];

102 
nums
[0] =‚ums[1] =‚ums[2] =‚ums[3] =‚ums[4] =‚ums[5] = 0;

103 
which_num
 = 0;

105 
pos
 < 
Ën
 && 
which_num
 < 6) {

106 ià(
d©a
[
pos
] >= '0' && data[pos] <= '9')

107 
nums
[
which_num
] = (nums[which_num] * 10è+ 
d©a
[
pos
] - '0';

108 ià(
d©a
[
pos
] == ',')

109 
which_num
++;

112 
pos
++;

116 ià(
which_num
 !ğ5 || 
pos
 >ğ
Ën
 || (
d©a
[pos] != '\r' && data[pos] != '\n'))

117  
p
;

118 
i
 = 0; i < 6; i++)

119 ià(
nums
[
i
] >= 256)

120  
p
;

123 
IPAdd»ss
 
	`¤c_d©a_addr
(
	`htÚl
((
nums
[0]<<24) | (nums[1]<<16) | (nums[2]<<8) |‚ums[3]));

124 
¤c_d©a_pÜt
 = 
	`htÚs
((
nums
[4]<<8) |‚ums[5]);

127 
d¡_d©a_pÜt
 = 
	`htÚs
(
	`Áohs
(
tıh
->
th_dpÜt
) - 1);

128 
IPFlowID
 
	`æow
(
¤c_d©a_addr
, 
¤c_d©a_pÜt
,

129 
	`IPAdd»ss
(
h
->
_d¡
), 
d¡_d©a_pÜt
);

132 
IPRewr™”EÁry
 *
fÜw¬d
 = 
_d©a_»wr™”
->
	`g‘_’Œy
(
IP_PROTO_TCP
, 
æow
, 
_d©a_»wr™”_šput
);

133 ià(!
fÜw¬d
)

134  
p
;

137 
IPFlowID
 
Ãw_æow
 = 
fÜw¬d
->
	`»wr™‹n_æowid
();

138 
Ãw_§ddr
 = 
	`Áohl
(
Ãw_æow
.
	`§ddr
().
	`addr
());

139 
Ãw_¥Üt
 = 
	`Áohs
(
Ãw_æow
.
	`¥Üt
());

140 
buf
[30];

141 
buæ’
;

142 
buæ’
 = 
	`¥rštf
(
buf
, "%d,%d,%d,%d,%d,%d", (
Ãw_§ddr
>>24)&255, (new_saddr>>16)&255,

143 (
Ãw_§ddr
>>8)&255,‚ew_§ddr&255, (
Ãw_¥Üt
>>8)&255,‚ew_sport&255);

146 
Wr™abËPack‘
 *
wp
;

147 
pÜt_¬g_Ën
 = 
pos
 - 
pÜt_¬g_off£t
;

148 ià(
pÜt_¬g_Ën
 < 
buæ’
) {

149 
wp
 = 
p
->
	`put
(
buæ’
 - 
pÜt_¬g_Ën
);

151 
wp
 = 
p
->
	`uniqueify
();

152 
wp
->
	`ke
(
pÜt_¬g_Ën
 - 
buæ’
);

154 
	`memmove
(
wp
->
	`d©a
(è+ 
d©a_off£t
 + 
pÜt_¬g_off£t
 + 
buæ’
,

155 
wp
->
	`d©a
(è+ 
d©a_off£t
 + 
pÜt_¬g_off£t
 + 
pÜt_¬g_Ën
,

156 
Ën
 - 
pos
);

157 
	`memıy
(
wp
->
	`d©a
(è+ 
d©a_off£t
 + 
pÜt_¬g_off£t
,

158 
buf
,

159 
buæ’
);

163 
şick_
 *
wp_h
 = 
wp
->
	`_h—d”
();

164 
Şd__hw
 = ((*)
wp_h
)[1];

165 
wp_h
->
_Ën
 = 
	`htÚs
(
wp
->
	`Ëngth
(è- wp->
	`_h—d”_off£t
());

166 
Ãw__hw
 = ((*)
wp_h
)[1];

167 
_sum
 =

168 (~
wp_h
->
_sum
 & 0xFFFFè+ (~
Şd__hw
 & 0xFFFFè+ 
Ãw__hw
;

169 
_sum
 >> 16)

170 
_sum
 = (ip_sum & 0xFFFF) + (ip_sum >> 16);

171 
wp_h
->
_sum
 = ~ip_sum;

175 
şick_tı
 *
wp_tıh
 = 
wp
->
	`tı_h—d”
();

178 
tı_£q_t
 
š‹»¡šg_£qno
 = 
	`Áohl
(
wp_tıh
->
th_£q
è+ 
Ën
;

179 
TCPRewr™”
::
TCPFlow
 *
p_æow
 = 
¡©ic_ÿ¡
<TCPRewr™”::TCPFlow *>(
p_m­pšg
->
	`æow
());

180 
p_æow
->
	`upd©e_£qno_d–
(
p_m­pšg
->
	`dœeùiÚ
(), 
š‹»¡šg_£qno
,

181 
buæ’
 - 
pÜt_¬g_Ën
);

184 
fÜw¬d
->
	`æow
()->
	`£t_»¶y_ªno
(
p_æow
->
	`»¶y_ªno
());

186 
wp_tıh
->
th_sum
 = 0;

187 
wp_tı_Ën
 = 
wp
->
	`Ëngth
(è- wp->
	`Œª¥Üt_h—d”_off£t
();

188 
csum
 = 
	`şick_š_cksum
((*)
wp_tıh
, 
wp_tı_Ën
);

189 
wp_tıh
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 
wp_h
, 
wp_tı_Ën
);

191  
wp
;

192 
	}
}

194 
CLICK_ENDDECLS


195 
	$ELEMENT_REQUIRES
(
TCPRewr™”
)

196 
	`EXPORT_ELEMENT
(
FTPPÜtM­³r
)

	@app/ftpportmapper.hh

1 #iâdeà
CLICK_FTPPORTMAPPER_HH


2 
	#CLICK_FTPPORTMAPPER_HH


	)

3 
	~"–em’ts/tıudp/tı»wr™”.hh
"

4 
CLICK_DECLS


86 şas 
	cFTPPÜtM­³r
 : 
public
 
EËm’t
 {…ublic:

88 
	$FTPPÜtM­³r
(è
CLICK_COLD
;

89 ~
	$FTPPÜtM­³r
(è
CLICK_COLD
;

91 cÚ¡ *
	$şass_Çme
() const {  "FTPPortMapper"; }

92 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

94 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

95 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

96 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

98 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

100 
´iv©e
:

102 
TCPRewr™”
 *
_cÚŒŞ_»wr™”
;

103 
IPRewr™”Ba£
 *
_d©a_»wr™”
;

104 
_d©a_»wr™”_šput
;

106 
	}
};

108 
	gCLICK_ENDDECLS


	@aqm/adaptivered.cc

20 
	~<şick/cÚfig.h
>

21 
	~"ad­tiv”ed.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
CLICK_DECLS


26 
	gAd­tiveRED
::
	$Ad­tiveRED
()

27 : 
	$_tim”
(
this
)

29 
	}
}

31 
Ad­tiveRED
::~
	$Ad­tiveRED
()

33 
	}
}

36 
Ad­tiveRED
::
	$ÿ¡
(cÚ¡ *
n
)

38 ià(
	`¡rcmp
(
n
, "RED") == 0 || strcmp(n, "AdaptiveRED") == 0)

39  (
EËm’t
 *)
this
;

41  
RED
::
	`ÿ¡
(
n
);

42 
	}
}

45 
	gAd­tiveRED
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

47 
	grg‘_q
, 
	gmax_p
, 
	g¡ab™y
 = 4;

48 
SŒšg
 
	gqueues_¡ršg
 = String();

49 ià(
Args
(
cÚf
, 
this
, 
”rh
)

50 .
»ad_mp
("TARGET", 
rg‘_q
)

51 .
»ad_mp
("MAX_P", 
FixedPoštArg
(16), 
max_p
)

52 .
»ad
("QUEUES", 
AnyArg
(), 
queues_¡ršg
)

53 .
»ad
("STABILITY", 
¡ab™y
)

54 .
com¶‘e
() < 0)

56 ià(
	grg‘_q
 < 10)

57 
	grg‘_q
 = 10;

58 
	gmš_th»sh
 = 
rg‘_q
 / 2;

59 
	gmax_th»sh
 = 
rg‘_q
 + 
mš_th»sh
;

60  
fšish_cÚfigu»
(
mš_th»sh
, 
max_th»sh
, 
Œue
, 
max_p
, 
¡ab™y
, 
queues_¡ršg
, 
”rh
);

64 
	gAd­tiveRED
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

66 ià(
RED
::
	`š™Ÿlize
(
”rh
) < 0)

69 
_tim”
.
	`š™Ÿlize
(
this
);

70 
_tim”
.
	`scheduË_aá”_m£c
(
ADAPTIVE_INTERVAL
);

72 
	}
}

75 
	gAd­tiveRED
::
	$run_tim”
(
Tim”
 *)

77 
ušt32_t
 
avg
;

78 ià(
_size
.
	`¡ab™y_shiá
() == 0)

79 
avg
 = 
	`queue_size
();

81 
avg
 = 
_size
.
	`unsÿËd_av”age
();

83 
ušt32_t
 
·¹
 = (
_max_th»sh
 - 
_mš_th»sh
) / 2;

84 ià(
avg
 < 
_mš_th»sh
 + 
·¹
 && 
_max_p
 > 
ONE_HUNDREDTH
) {

85 
_max_p
 = (_max_°* 
NINE_TENTHS
) >> 16;

86 } ià(
avg
 > 
_max_th»sh
 - 
·¹
 && 
_max_p
 < 0x8000) {

87 
ušt32_t
 
®pha
 = 
ONE_HUNDREDTH
;

88 ià(
®pha
 > 
_max_p
/4)

89 
®pha
 = 
_max_p
/4;

90 
_max_p
 = _max_°+ 
®pha
;

92 
	`£t_C1_ªd_C2
();

93 
_tim”
.
	`»scheduË_aá”_m£c
(
ADAPTIVE_INTERVAL
);

94 
	}
}

96 
CLICK_ENDDECLS


97 
	$ELEMENT_REQUIRES
(
RED
)

98 
	`EXPORT_ELEMENT
(
Ad­tiveRED
)

	@aqm/adaptivered.hh

2 #iâdeà
CLICK_ADAPTIVERED_HH


3 
	#CLICK_ADAPTIVERED_HH


	)

4 
	~"»d.hh
"

5 
	~<şick/tim”.hh
>

6 
CLICK_DECLS


29 şas 
	cAd­tiveRED
 : 
public
 
RED
 {…ublic:

31 
	$Ad­tiveRED
(è
CLICK_COLD
;

32 ~
	$Ad­tiveRED
(è
CLICK_COLD
;

34 cÚ¡ *
	$şass_Çme
() const {  "AdaptiveRED"; }

35 *
	`ÿ¡
(const *);

37 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

38 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

40 
	`run_tim”
(
Tim”
 *);

42 
´Ùeùed
:

44 
Tim”
 
_tim”
;

46 cÚ¡ 
ADAPTIVE_INTERVAL
 = 500;

47 cÚ¡ 
ušt32_t
 
ONE_HUNDREDTH
 = 655;

48 cÚ¡ 
ušt32_t
 
NINE_TENTHS
 = 58982;

50 
	}
};

52 
	gCLICK_ENDDECLS


	@aqm/codel.cc

8 
	~<şick/cÚfig.h
>

9 
	~"cod–.hh
"

10 
	~<şick/¡ªd¬d/¡Üage.hh
>

11 
	~<şick/rou‹rvis™Ü.hh
>

12 
	~<şick/”rÜ.hh
>

13 
	~<şick/rou‹r.hh
>

14 
	~<şick/¬gs.hh
>

15 
	~<şick/¡¿ccum.hh
>

16 
	~<şick/š‹g”s.hh
>

17 
	~<şick/·ck‘_ªno.hh
>

18 
	gCLICK_DECLS


20 
	#CODEL_DEBUG
 0

	)

22 
	gCoD–
::
	$CoD–
()

24 
	}
}

26 
CoD–
::~
	$CoD–
()

28 
	}
}

31 
CoD–
::
	$fšish_cÚfigu»
(cÚ¡ 
SŒšg
 &
queues_¡ršg
, 
E¼ÜHªdËr
 *
”rh
)

34 ià(
queues_¡ršg
 && !
_queue_–em’ts
.
	`size
()) {

35 
VeùÜ
<
SŒšg
> 
eids
;

36 
	`ı_¥aûvec
(
queues_¡ršg
, 
eids
);

37 
_queue_–em’ts
.
	`ş—r
();

38 
i
 = 0; i < 
eids
.
	`size
(); i++)

39 ià(
EËm’t
 *
e
 = 
	`rou‹r
()->
	`fšd
(
eids
[
i
], 
this
, 
”rh
))

40 
_queue_–em’ts
.
	`push_back
(
e
);

41 ià(
eids
.
	`size
(è!ğ
_queue_–em’ts
.size())

46 
	}
}

49 
	gCoD–
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

52 
	g_cod–_rg‘_ts
 = 
Time¡amp
::
make_m£c
(0, 5);

53 
	g_cod–_š‹rv®_ts
 = 
Time¡amp
::
make_m£c
(0, 100);

55 
SŒšg
 
	gqueues_¡ršg
 = String();

56 ià(
Args
(
cÚf
, 
this
, 
”rh
)

57 .
»ad_p
("TARGET", 
_cod–_rg‘_ts
)

58 .
»ad_p
("INTERVAL", 
_cod–_š‹rv®_ts
)

59 .
»ad
("QUEUES", 
AnyArg
(), 
queues_¡ršg
)

60 .
com¶‘e
() < 0)

63  
fšish_cÚfigu»
(
queues_¡ršg
, 
”rh
);

67 
	gCoD–
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

70 
_queues
.
	`ş—r
();

71 
_queue1
 = 0;

73 ià(
_queue_–em’ts
.
	`em±y
()) {

74 
EËm’tCa¡T¿ck”
 
	`f‹r
(
	`rou‹r
(), "Storage");

75 
ok
 = 
	`rou‹r
()->
	`vis™_up¡»am
(
this
, 0, &
f‹r
);

76 ià(
ok
 < 0)

77  
”rh
->
	`”rÜ
("flow-based„outer context failure");

78 
_queue_–em’ts
 = 
f‹r
.
	`–em’ts
();

81 ià(
_queue_–em’ts
.
	`em±y
())

82  
”rh
->
	`”rÜ
("no‚earby Queues");

83 
i
 = 0; i < 
_queue_–em’ts
.
	`size
(); i++)

84 ià(
StÜage
 *
s
 = (StÜag*)
_queue_–em’ts
[
i
]->
	`ÿ¡
("Storage"))

85 
_queues
.
	`push_back
(
s
);

87 
”rh
->
	`”rÜ
("%<%s%> i nÙ‡ StÜag–em’t", 
_queue_–em’ts
[
i
]->
	`Çme
().
	`c_¡r
());

88 ià(
_queues
.
	`size
(è!ğ
_queue_–em’ts
.size())

90 ià(
_queues
.
	`size
() == 1)

91 
_queue1
 = 
_queues
[0];

93 
_tÙ®_drİs
 = 0;

94 
_¡©e_drİs
 = 0;

95 
_drİpšg
 = 
çl£
;

97 
_fœ¡_above_time
 = 
	`Time¡amp
();

98 
_drİ_Ãxt
 = 
	`Time¡amp
();

101 
	}
}

104 
	gCoD–
::
	$queue_size
() const

106 ià(
_queue1
)

107  
_queue1
->
	`size
();

109 
s
 = 0;

110 
i
 = 0; i < 
_queues
.
	`size
(); i++)

111 
s
 +ğ
_queues
[
i
]->
	`size
();

112  
s
;

114 
	}
}

116 
šlše
 

117 
	gCoD–
::
	$hªdË_drİ
(
Pack‘
 *
p
)

119 ià(
	`nouuts
() == 1)

120 
p
->
	`kl
();

121 
_tÙ®_drİs
++;

122 
	}
}

125 
Pack‘
 *

126 
	gCoD–
::
	$puÎ
()

128  
	`d–eg©e_cod–
();

129 
	}
}

132 
Pack‘
 *

133 
	gCoD–
::
	$dequeue_ªd_Œack_sojouº_time
(
Time¡amp
 
now
, 
boŞ
 &
»tV®
)

135 
_ok_to_drİ
 = 0;

136 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

138 ià(
p
 =ğ
NULL
) {

140 
_fœ¡_above_time
.
	`assign
(0, 0);

141 
»tV®
 = 
çl£
;

142  
NULL
;

143 } ià(!
	`FIRST_TIMESTAMP_ANNO
(
p
).
	`£c
()) {

145 
»tV®
 = 
çl£
;

146  
p
;

148 
Time¡amp
 
sojouº_time
 = 
now
 - 
	`FIRST_TIMESTAMP_ANNO
(
p
);

150 #ià
CODEL_DEBUG


151 
	`şick_ch©‹r
("[%d] [%s] sojouº_time: % pkt_ts: % rg‘: %s", 
	`EXTRA_PACKETS_ANNO
(
p
), 
now
.
	`uÅ¬£
().
	`c_¡r
(), 
sojouº_time
.uÅ¬£().c_¡r(), 
	`FIRST_TIMESTAMP_ANNO
Õ).uÅ¬£().c_¡r(), 
_cod–_rg‘_ts
.unparse().c_str());

154 ià(
sojouº_time
 < 
_cod–_rg‘_ts
) {

156 
_fœ¡_above_time
.
	`assign
(0, 0);

159 ià(
_fœ¡_above_time
 =ğ
Time¡amp
::
	`make_m£c
(0, 0)) {

161 
_fœ¡_above_time
 = 
now
 + 
_cod–_š‹rv®_ts
;

162 } ià(
now
 >ğ
_fœ¡_above_time
) {

164 
_ok_to_drİ
 = 1;

168 
»tV®
 = 
Œue
;

169  
p
;

170 
	}
}

173 
Pack‘
*

174 
	gCoD–
::
	$d–eg©e_cod–
()

176 
Pack‘
 *
p
 = 
NULL
;

177 
boŞ
 
»t_v®
 = 
çl£
;

178 
Time¡amp
 
now
 = Time¡amp::
	`now
();

180 
p
 = 
	`dequeue_ªd_Œack_sojouº_time
(
now
, 
»t_v®
);

187 ià(!
»t_v®
) {

188 
_drİpšg
 = 
çl£
;

189  
p
;

193 ià(
_drİpšg
) {

195 ià(!
_ok_to_drİ
) {

196 
_drİpšg
 = 
çl£
;

197 } ià(
now
 >ğ
_drİ_Ãxt
) {

199 (
now
 >ğ
_drİ_Ãxt
è&& 
_drİpšg
) {

200 
	`as£¹
(
now
 >ğ
_drİ_Ãxt
);

201 
	`hªdË_drİ
(
p
);

202 #ià
CODEL_DEBUG


203 
	`şick_ch©‹r
("tÙ®_drİs: %d,‚ow: %s, drİ_Ãxt: %s\n", 
_tÙ®_drİs
, 
now
.
	`uÅ¬£
().
	`c_¡r
(), 
_drİ_Ãxt
.unparse().c_str());

205 ++
_¡©e_drİs
;

206 
p
 = 
	`dequeue_ªd_Œack_sojouº_time
(
now
, 
»t_v®
);

208 ià(!
_ok_to_drİ
) {

209 
_drİpšg
 = 
çl£
;

211 
_drİ_Ãxt
 = 
	`cÚŒŞ_Ïw
(_drop_next);

215 } ià(
_ok_to_drİ
 && ((
now
 - 
_drİ_Ãxt
 < 
_cod–_š‹rv®_ts
è|| (now - 
_fœ¡_above_time
 >= _codel_interval_ts))) {

222 
	`hªdË_drİ
(
p
);

223 
p
 = 
	`dequeue_ªd_Œack_sojouº_time
(
now
, 
»t_v®
);

224 
_drİpšg
 = 
Œue
;

226 ià(
now
 - 
_drİ_Ãxt
 < 
_cod–_š‹rv®_ts
) {

227 
_¡©e_drİs
 = (_state_drops > 2) ? (_state_drops - 2) : 1;

229 
_¡©e_drİs
 = 1;

231 
_drİ_Ãxt
 = 
	`cÚŒŞ_Ïw
(
now
);

233  
p
;

234 
	}
}

237 
Time¡amp


238 
	gCoD–
::
	$cÚŒŞ_Ïw
(
Time¡amp
 
t
)

240 
ušt32_t
 
sÿË_çùÜ
 = 1 << 4;

241 
ušt32_t
 
sÿË_çùÜ_squ¬ed
 = 
sÿË_çùÜ
 * scale_factor;

242 
ušt32_t
 
sÿËd_cod–_š‹rv®
 = 
_cod–_š‹rv®_ts
.
	`m£cv®
(è* 
sÿË_çùÜ
;

243 
ušt32_t
 
sÿËd_¡©e_drİs
 = 
_¡©e_drİs
 * 
sÿË_çùÜ_squ¬ed
;

245 
ušt32_t
 
v®_şick_ns
 = 
	`št_divide
(
sÿËd_cod–_š‹rv®
 * 
Time¡amp
::
n£c_³r_m£c
, 
	`št_sq¹
(
sÿËd_¡©e_drİs
));

247 
ušt32_t
 
v®_şick_£c
;

248 
ušt32_t
 
»m_ns
 = 
	`št_»mašd”
(
v®_şick_ns
, 
Time¡amp
::
n£c_³r_£c
, 
v®_şick_£c
);

250 
Time¡amp
 
v®_şick_ts
 = Time¡amp::
	`make_n£c
(
v®_şick_£c
, 
»m_ns
);

251  (
t
 + 
v®_şick_ts
);

252 
	}
}

256 
SŒšg


257 
	gCoD–
::
	$»ad_hªdËr
(
EËm’t
 *
f
, *
v·¿m
)

259 
CoD–
 *
cod–
 = (CoD– *)
f
;

260 
SŒšgAccum
 
§
;

261 (
šŒ_t
)
v·¿m
) {

263 
§
 << 
cod–
->
	`queue_size
() << " current queue\n"

264 << 
cod–
->
	`drİs
() << " drops\n";

265  
§
.
	`ke_¡ršg
();

268 
i
 = 0; i < 
cod–
->
_queue_–em’ts
.
	`size
(); i++)

269 
§
 << 
cod–
->
_queue_–em’ts
[
i
]->
	`Çme
() << "\n";

270  
§
.
	`ke_¡ršg
();

273 
§
 << 
cod–
->
_cod–_rg‘_ts
.
	`uÅ¬£
().
	`c_¡r
(è<< "s, " << cod–->
_cod–_š‹rv®_ts
.unparse().c_str() << " s, ";

274  
§
.
	`ke_¡ršg
();

276 
	}
}

279 
	gCoD–
::
	$add_hªdËrs
()

281 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_tÙ®_drİs
);

282 
	`add_»ad_hªdËr
("cod–_š‹rv®", 
»ad_keywÜd_hªdËr
, "1 INTERVAL");

283 
	`add_wr™e_hªdËr
("cod–_š‹rv®", 
»cÚfigu»_keywÜd_hªdËr
, "1 INTERVAL");

284 
	`add_»ad_hªdËr
("cod–_rg‘", 
»ad_keywÜd_hªdËr
, "0 TARGET");

285 
	`add_wr™e_hªdËr
("cod–_rg‘", 
»cÚfigu»_keywÜd_hªdËr
, "0 TARGET");

286 
	`add_»ad_hªdËr
("¡©s", 
»ad_hªdËr
, 2);

287 
	`add_»ad_hªdËr
("queues", 
»ad_hªdËr
, 3);

288 
	`add_»ad_hªdËr
("cÚfig", 
»ad_hªdËr
, 4);

289 
	}
}

291 
CLICK_ENDDECLS


292 
	$ELEMENT_REQUIRES
(
št64
)

293 
	`EXPORT_ELEMENT
(
CoD–
)

	@aqm/codel.hh

1 #iâdeà
CLICK_CODEL_HH


2 
	#CLICK_CODEL_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/ewma.hh
>

5 
	~<şick/time¡amp.hh
>

6 
CLICK_DECLS


7 
şass
 
	gStÜage
;

88 şas 
	cCoD–
 : 
public
 
EËm’t
 {…ublic:

90 
	$CoD–
(è
CLICK_COLD
;

91 ~
	$CoD–
(è
CLICK_COLD
;

93 cÚ¡ *
	$şass_Çme
() const {  "CoDel"; }

94 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

95 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

98 
	$queue_size
() const;

99 
	$drİs
(ècÚ¡ {  
_tÙ®_drİs
; 
	}
}

101 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

102 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

103 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

104 
	$add_hªdËrs
(è
CLICK_COLD
;

106 
	`hªdË_drİ
(
Pack‘
 *);

107 
Pack‘
 *
	`puÎ
(
pÜt
);

109 
´Ùeùed
:

111 
StÜage
 *
_queue1
;

112 
VeùÜ
<
StÜage
 *> 
_queues
;

114 
_tÙ®_drİs
;

115 
_¡©e_drİs
;

116 
Time¡amp
 
_fœ¡_above_time
, 
_drİ_Ãxt
;

117 
boŞ
 
_drİpšg
;

118 
boŞ
 
_ok_to_drİ
;

120 
Time¡amp
 
_cod–_š‹rv®_ts
, 
_cod–_rg‘_ts
;

121 
VeùÜ
<
EËm’t
 *> 
_queue_–em’ts
;

123 
Pack‘
 * 
	`d–eg©e_cod–
();

124 
Time¡amp
 
	`cÚŒŞ_Ïw
(Timestamp);

125 
Pack‘
 * 
	`dequeue_ªd_Œack_sojouº_time
(
Time¡amp
, 
boŞ
 &);

126 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

127 
	`fšish_cÚfigu»
(cÚ¡ 
SŒšg
 &
queues
, 
E¼ÜHªdËr
 *
”rh
);

128 
	}
};

130 
	gCLICK_ENDDECLS


	@aqm/pi.cc

20 
	~<şick/cÚfig.h
>

21 
	~"pi.hh
"

22 
	~<şick/¡ªd¬d/¡Üage.hh
>

23 
	~<şick/rou‹rvis™Ü.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/rou‹r.hh
>

26 
	~<şick/¬gs.hh
>

27 
	~<şick/¡¿ccum.hh
>

28 
	gCLICK_DECLS


30 
	#PI_DEBUG
 0

	)

32 
	gPI
::
	$PI
()

33 : 
	$_tim”
(
this
)

35 
	}
}

37 
PI
::~
	$PI
()

39 
	}
}

42 
PI
::
	$check_·¿ms
(
w
, 
a
, 
b
, 
rg‘_q
,

43 
¡ab™y
, 
E¼ÜHªdËr
 *
”rh
) const

45 
max_®low_th»sh
 = 0xFFFF;

46 ià(
rg‘_q
 > 
max_®low_th»sh
)

47  
”rh
->
	`”rÜ
("`rg‘_q'oØÏrg(max %d)", 
max_®low_th»sh
);

48 ià(
w
 < 0)

49  
”rh
->
	`”rÜ
("w must be…ositive");

50 ià(
a
 < 0)

51  
”rh
->
	`”rÜ
("a must be…ositive");

52 ià(
b
 < 0)

53  
”rh
->
	`”rÜ
("b must be…ositive");

54 ià(
¡ab™y
 > 16 || stability < 1)

55  
”rh
->
	`”rÜ
("STABILITY…arameter must be between 1‡nd 16");

57 
	}
}

60 
	gPI
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

62 
	ga
, 
	gb
, 
	gw
;

63 
	grg‘_q
;

64 
	g¡ab™y
 = 4;

66 
SŒšg
 
	gqueues_¡ršg
 = String();

67 ià(
Args
(
cÚf
, 
this
, 
”rh
)

68 .
»ad_mp
("W", 
w
)

69 .
»ad_mp
("A", 
a
)

70 .
»ad_mp
("B", 
b
)

71 .
»ad_mp
("TARGET", 
rg‘_q
)

72 .
»ad_p
("QUEUES", 
AnyArg
(), 
queues_¡ršg
)

73 .
»ad
("QREF", 
rg‘_q
)

74 .
»ad
("STABILITY", 
¡ab™y
)

75 .
com¶‘e
() < 0)

78 ià(
check_·¿ms
(
w
, 
a
, 
b
, 
rg‘_q
, 
¡ab™y
, 
”rh
) < 0)

82 ià(
	gqueues_¡ršg
) {

83 
	gVeùÜ
<
	gSŒšg
> 
	geids
;

84 
ı_¥aûvec
(
queues_¡ršg
, 
eids
);

85 
	g_queue_–em’ts
.
ş—r
();

86 
	gi
 = 0; i < 
	geids
.
size
(); i++)

87 ià(
EËm’t
 *
	ge
 = 
rou‹r
()->
fšd
(
eids
[
i
], 
this
, 
”rh
))

88 
	g_queue_–em’ts
.
push_back
(
e
);

89 ià(
	geids
.
size
(è!ğ
_queue_–em’ts
.size())

94 
	g_a
 = 
a
;

95 
	g_b
 = 
b
;

96 
	g_w
 = 
w
;

97 
	g_rg‘_q
 = 
rg‘_q
;

98 
	g_size
.
£t_¡ab™y_shiá
(
¡ab™y
);

103 
	gPI
::
live_»cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

105 
	ga
, 
	gb
, 
	gw
;

106 
	grg‘_q
;

107 
	g¡ab™y
 = 4;

109 
SŒšg
 
	gqueues_¡ršg
 = String();

110 ià(
Args
(
cÚf
, 
this
, 
”rh
)

111 .
»ad_mp
("W", 
w
)

112 .
»ad_mp
("A", 
a
)

113 .
»ad_mp
("B", 
b
)

114 .
»ad_mp
("TARGET", 
rg‘_q
)

115 .
»ad_p
("QUEUES", 
AnyArg
(), 
queues_¡ršg
)

116 .
»ad
("QREF", 
rg‘_q
)

117 .
»ad
("STABILITY", 
¡ab™y
)

118 .
com¶‘e
() < 0)

121 ià(
check_·¿ms
(
w
, 
a
, 
b
, 
rg‘_q
, 
¡ab™y
, 
”rh
) < 0)

124 ià(
	gqueues_¡ršg
)

125 
	g”rh
->
w¬nšg
("QUEUES‡rgument ignored");

128 
	g_a
 = 
a
;

129 
	g_b
 = 
b
;

130 
	g_w
 = 
w
;

131 
	g_rg‘_q
 = 
rg‘_q
;

132 
	g_size
.
£t_¡ab™y_shiá
(
¡ab™y
);

137 
	gPI
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

140 
_queues
.
	`ş—r
();

141 
_queue1
 = 0;

143 ià(!
_queue_–em’ts
.
	`size
()) {

144 
EËm’tCa¡T¿ck”
 
	`f‹r
(
	`rou‹r
(), "Storage");

146 
ok
;

147 ià(
	`ouut_is_push
(0))

148 
ok
 = 
	`rou‹r
()->
	`vis™_down¡»am
(
this
, 0, &
f‹r
);

150 
ok
 = 
	`rou‹r
()->
	`vis™_up¡»am
(
this
, 0, &
f‹r
);

151 ià(
ok
 < 0)

152  
”rh
->
	`”rÜ
("flow-based„outer context failure");

153 
_queue_–em’ts
 = 
f‹r
.
	`–em’ts
();

156 ià(
_queue_–em’ts
.
	`size
() == 0)

157  
”rh
->
	`”rÜ
("no Queues downstream");

158 
i
 = 0; i < 
_queue_–em’ts
.
	`size
(); i++)

159 ià(
StÜage
 *
s
 = (StÜag*)
_queue_–em’ts
[
i
]->
	`ÿ¡
("Storage"))

160 
_queues
.
	`push_back
(
s
);

162 
”rh
->
	`”rÜ
("`%s' i nÙ‡ StÜag–em’t", 
_queue_–em’ts
[
i
]->
	`Çme
().
	`c_¡r
());

163 ià(
_queues
.
	`size
(è!ğ
_queue_–em’ts
.size())

165 ià(
_queues
.
	`size
() == 1)

166 
_queue1
 = 
_queues
[0];

168 
_size
.
	`ş—r
();

169 
_Şd_q
 = 0;

170 
_p
 = 0;

171 
_drİs
 = 0;

172 
_Ï¡_jiff›s
 = 0;

174 
_tim”
.
	`š™Ÿlize
(
this
);

175 
_tim”
.
	`scheduË_aá”_m£c
(
_w
*1000);

178 
	}
}

180 
	gPI
::
	$ş—nup
(
CËªupSge
)

182 
_tim”
.
	`ş—nup
();

183 
	}
}

186 
	gPI
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *)

188 
PI
 *
r
 = (PI *)
e
->
	`ÿ¡
("PI");

189 ià(!
r
) ;

190 
_size
 = 
r
->_size;

191 
	}
}

194 
	gPI
::
	$queue_size
() const

196 ià(
_queue1
)

197  
_queue1
->
	`size
();

199 
s
 = 0;

200 
i
 = 0; i < 
_queues
.
	`size
(); i++)

201 
s
 +ğ
_queues
[
i
]->
	`size
();

202  
s
;

204 
	}
}

207 
	gPI
::
	$run_tim”
(
Tim”
 *)

209 
_p
 = 
_a
*(
	`queue_size
(è- 
_rg‘_q
è- 
_b
*(
_Şd_q
 - _target_q) + _p;

210 
_tim”
.
	`»scheduË_aá”_m£c
(
_w
*1000);

211 
	}
}

213 
boŞ


214 
	gPI
::
	$should_drİ
()

216 
_¿ndom_v®ue
 = 
	`şick_¿ndom
();

217 ià(
_¿ndom_v®ue
 > 
_p
*
MAX_RAND
) {

218  
Œue
;

220  
çl£
;

221 
	}
}

223 
šlše
 

224 
	gPI
::
	$hªdË_drİ
(
Pack‘
 *
p
)

226 ià(
	`nouuts
() == 1)

227 
p
->
	`kl
();

229 
	`ouut
(1).
	`push
(
p
);

230 
_drİs
++;

231 
	}
}

234 
	gPI
::
	$push
(, 
Pack‘
 *
p
)

236 ià(
	`should_drİ
())

237 
	`hªdË_drİ
(
p
);

239 
	`ouut
(0).
	`push
(
p
);

240 
	}
}

242 
Pack‘
 *

243 
	gPI
::
	$puÎ
()

245 
Œue
) {

246 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

247 ià(!
p
)

249 ià(!
	`should_drİ
())

250  
p
;

251 
	`hªdË_drİ
(
p
);

253 
	}
}

258 
SŒšg


259 
	$pi_»ad_drİs
(
EËm’t
 *
f
, *)

261 
PI
 *
r
 = (PI *)
f
;

262  
	`SŒšg
(
r
->
	`drİs
());

263 
	}
}

265 
SŒšg


266 
	gPI
::
	$»ad_·¿m‘”
(
EËm’t
 *
f
, *
v·¿m
)

268 
PI
 *
pi
 = (PI *)
f
;

269 
SŒšgAccum
 
§
;

270 ()
v·¿m
) {

272  
	`SŒšg
(
pi
->
_rg‘_q
);

274 
§
 << 
»d
->
	`queue_size
() << " current queue\n"

275 << 
»d
->
_size
.
	`uÅ¬£
() << "‡vg queue\n"

276 << 
»d
->
	`drİs
() << " drops\n"

277 #ià
CLICK_STATS
 >= 1

278 << 
»d
->
	`ouut
(0).
	`Åack‘s
() << "…ackets\n"

281  
§
.
	`ke_¡ršg
();

283 
i
 = 0; i < 
»d
->
_queue_–em’ts
.
	`size
(); i++)

284 
§
 << 
»d
->
_queue_–em’ts
[
i
]->
	`Çme
() + "\n";

285  
§
.
	`ke_¡ršg
();

287 
§
 << 
_a
 << ", " << 
_b
 << ", " << 
_w
 << ", " << 
_rg‘_q


289 
i
 = 0; i < 
_queue_–em’ts
.
	`size
(); i++)

290 
§
 << ' ' << 
_queue_–em’ts
[
i
]->
	`Çme
();

291 
§
 << ", STABILITY " << 
_size
.
	`¡ab™y_shiá
();

292  
§
.
	`ke_¡ršg
();

294 
	}
}

297 
	gPI
::
	$add_hªdËrs
()

299 
	`add_»ad_hªdËr
("drİs", 
pi_»ad_drİs
);

300 
	`£t_hªdËr
("w", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, 
cÚfigu¿tiÚ_keywÜd_hªdËr
, "W", (*è(
ušŒ_t
) 1);

301 
	`£t_hªdËr
("a", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, 
cÚfigu¿tiÚ_keywÜd_hªdËr
, "A", (*è(
ušŒ_t
) 2);

302 
	`£t_hªdËr
("b", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, 
cÚfigu¿tiÚ_keywÜd_hªdËr
, "B", (*è(
ušŒ_t
) 3);

303 
	`add_»ad_hªdËr
("avg_queue_size", 
»ad_·¿m‘”
, 3);

304 
	`add_»ad_hªdËr
("¡©s", 
»ad_·¿m‘”
, 4);

305 
	`add_»ad_hªdËr
("queues", 
»ad_·¿m‘”
, 5);

306 
	`add_»ad_hªdËr
("cÚfig", 
»ad_·¿m‘”
, 6);

307 
	`£t_hªdËr_æags
("cÚfig", 0, 
HªdËr
::
CALM
);

308 
	}
}

310 
CLICK_ENDDECLS


311 
	$ELEMENT_REQUIRES
(
št64
 
çl£
)

312 
	`EXPORT_ELEMENT
(
PI
)

	@aqm/pi.hh

2 #iâdeà
CLICK_PI_HH


3 
	#CLICK_PI_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/ewma.hh
>

6 
	~<şick/tim”.hh
>

7 
CLICK_DECLS


8 
şass
 
	gStÜage
;

10 şas 
	cPI
 : 
public
 
EËm’t
 {…ublic:

13 ’um { 
QUEUE_SCALE
 = 10 };

14 
	gDœeùEWMAX
<
	tSb™yEWMAXP¬am‘”s
<
	tQUEUE_SCALE
, 
	tušt64_t
, 
	tšt64_t
> > 
	tewma_ty³
;

16 
	$PI
(è
CLICK_COLD
;

17 ~
	$PI
(è
CLICK_COLD
;

19 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "PI"; 
	}
}

20 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

21 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

23 
	$queue_size
() const;

24 cÚ¡ 
ewma_ty³
 &
	$av”age_queue_size
(ècÚ¡ {  
_size
; 
	}
}

25 
	$drİs
(ècÚ¡ {  
_drİs
; 
	}
}

27 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

28 
	$check_·¿ms
(, , , , , 
E¼ÜHªdËr
 *) const ;

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

30 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

31 
	`ke_¡©e
(
EËm’t
 *, 
E¼ÜHªdËr
 *);

32 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

33 
live_»cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *);

34 
	$add_hªdËrs
(è
CLICK_COLD
;

36 
boŞ
 
	`should_drİ
();

37 
	`hªdË_drİ
(
Pack‘
 *);

38 
	`push
(
pÜt
, 
Pack‘
 *);

39 
Pack‘
 *
	`puÎ
(
pÜt
);

40 
	`run_tim”
(
Tim”
 *);

42 
´Ùeùed
:

44 
Tim”
 
_tim”
;

45 
StÜage
 *
_queue1
;

46 
VeùÜ
<
StÜage
 *> 
_queues
;

48 
ewma_ty³
 
_size
;

50 
_¿ndom_v®ue
;

51 
_Ï¡_jiff›s
;

53 
_drİs
;

55 
_a
, 
_b
, 
_w
, 
_p
;

56 
_rg‘_q
, 
_Şd_q
;

58 
VeùÜ
<
EËm’t
 *> 
_queue_–em’ts
;

60 
SŒšg
 
	`»ad_·¿m‘”
(
EËm’t
 *, *);

62 cÚ¡ 
MAX_RAND
=2147483647;

64 
	}
};

66 
	gCLICK_ENDDECLS


	@aqm/red.cc

21 
	~<şick/cÚfig.h
>

22 
	~"»d.hh
"

23 
	~<şick/¡ªd¬d/¡Üage.hh
>

24 
	~<şick/rou‹rvis™Ü.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/rou‹r.hh
>

27 
	~<şick/¬gs.hh
>

28 
	~<şick/¡¿ccum.hh
>

29 
	gCLICK_DECLS


31 
	#RED_DEBUG
 0

	)

33 
	gRED
::
	$RED
()

35 
	}
}

37 
RED
::~
	$RED
()

39 
	}
}

42 
RED
::
	$£t_C1_ªd_C2
()

44 ià(
_mš_th»sh
 >ğ
_max_th»sh
) {

45 
_C1
 = 0;

46 
_C2
 = 1;

48 
_C1
 = 
_max_p
 / (
_max_th»sh
 - 
_mš_th»sh
);

51 
_C2
 = (
_max_p
 * 
_mš_th»sh
è/ (
_max_th»sh
 - _min_thresh);

54 
_G1
 = (0x10000 - 
_max_p
è/ 
_max_th»sh
;

55 
_G2
 = 0x10000 - 2*
_max_p
;

56 
	}
}

59 
	gRED
::
	$check_·¿ms
(
mš_th»sh
, 
max_th»sh
,

60 
max_p
, 
¡ab™y
, 
E¼ÜHªdËr
 *
”rh
) const

62 
max_®low_th»sh
 = 0xFFFF;

63 ià(
max_th»sh
 > 
max_®low_th»sh
)

64  
”rh
->
	`”rÜ
("MAX_THRESH mu¡ b<ğ%d", 
max_®low_th»sh
);

65 ià(
mš_th»sh
 > 
max_th»sh
)

66  
”rh
->
	`”rÜ
("MIN_THRESH must be <= MAX_THRESH");

67 ià(
max_p
 > 0x10000)

68  
”rh
->
	`”rÜ
("MAX_P must be between 0‡nd 1");

69 ià(
¡ab™y
 > 16)

70  
”rh
->
	`”rÜ
("STABILITY must be between 0‡nd 16");

72 
	}
}

75 
	gRED
::
	$fšish_cÚfigu»
(
mš_th»sh
, 
max_th»sh
, 
boŞ
 
g’e
,

76 
max_p
, 
¡ab™y
,

77 cÚ¡ 
SŒšg
 &
queues_¡ršg
, 
E¼ÜHªdËr
 *
”rh
)

79 ià(
	`check_·¿ms
(
mš_th»sh
, 
max_th»sh
, 
max_p
, 
¡ab™y
, 
”rh
) < 0)

83 ià(
queues_¡ršg
 && !
_queue_–em’ts
.
	`size
()) {

84 
VeùÜ
<
SŒšg
> 
eids
;

85 
	`ı_¥aûvec
(
queues_¡ršg
, 
eids
);

86 
_queue_–em’ts
.
	`ş—r
();

87 
i
 = 0; i < 
eids
.
	`size
(); i++)

88 ià(
EËm’t
 *
e
 = 
	`rou‹r
()->
	`fšd
(
eids
[
i
], 
this
, 
”rh
))

89 
_queue_–em’ts
.
	`push_back
(
e
);

90 ià(
eids
.
	`size
(è!ğ
_queue_–em’ts
.size())

95 
_mš_th»sh
 = 
mš_th»sh
;

96 
_max_th»sh
 = 
max_th»sh
;

97 
_kl_th»sh
 = 
g’e
 && 
max_p
 !ğ0x10000 ? 
max_th»sh
 * 2 : max_thresh;

98 
_max_p
 = 
max_p
;

99 
_size
.
	`£t_¡ab™y_shiá
(
¡ab™y
);

100 
_g’e
 = 
g’e
;

101 
	`£t_C1_ªd_C2
();

103 
	}
}

106 
	gRED
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

108 
	gmš_th»sh
, 
	gmax_th»sh
, 
	gmax_p
, 
	g¡ab™y
 = 4;

109 
SŒšg
 
	gqueues_¡ršg
 = String();

110 
boŞ
 
	gg’e
 = 
Œue
;

111 ià(
Args
(
cÚf
, 
this
, 
”rh
)

112 .
»ad_mp
("MIN_THRESH", 
mš_th»sh
)

113 .
»ad_mp
("MAX_THRESH", 
max_th»sh
)

114 .
»ad_mp
("MAX_P", 
FixedPoštArg
(16), 
max_p
)

115 .
»ad
("QUEUES", 
AnyArg
(), 
queues_¡ršg
)

116 .
»ad
("STABILITY", 
¡ab™y
)

117 .
»ad
("GENTLE", 
g’e
)

118 .
com¶‘e
() < 0)

120  
fšish_cÚfigu»
(
mš_th»sh
, 
max_th»sh
, 
g’e
, 
max_p
,

121 
¡ab™y
, 
queues_¡ršg
, 
”rh
);

125 
	gRED
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

128 
_queues
.
	`ş—r
();

129 
_queue1
 = 0;

131 ià(
_queue_–em’ts
.
	`em±y
()) {

132 
EËm’tCa¡T¿ck”
 
	`f‹r
(
	`rou‹r
(), "Storage");

133 
ok
;

134 ià(
	`ouut_is_push
(0))

135 
ok
 = 
	`rou‹r
()->
	`vis™_down¡»am
(
this
, 0, &
f‹r
);

137 
ok
 = 
	`rou‹r
()->
	`vis™_up¡»am
(
this
, 0, &
f‹r
);

138 ià(
ok
 < 0)

139  
”rh
->
	`”rÜ
("flow-based„outer context failure");

140 
_queue_–em’ts
 = 
f‹r
.
	`–em’ts
();

143 ià(
_queue_–em’ts
.
	`em±y
())

144  
”rh
->
	`”rÜ
("no‚earby Queues");

145 
i
 = 0; i < 
_queue_–em’ts
.
	`size
(); i++)

146 ià(
StÜage
 *
s
 = (StÜag*)
_queue_–em’ts
[
i
]->
	`ÿ¡
("Storage"))

147 
_queues
.
	`push_back
(
s
);

149 
”rh
->
	`”rÜ
("%<%s%> i nÙ‡ StÜag–em’t", 
_queue_–em’ts
[
i
]->
	`Çme
().
	`c_¡r
());

150 ià(
_queues
.
	`size
(è!ğ
_queue_–em’ts
.size())

152 ià(
_queues
.
	`size
() == 1)

153 
_queue1
 = 
_queues
[0];

155 
_size
.
	`ş—r
();

156 
_drİs
 = 0;

157 
_couÁ
 = -1;

158 
_Ï¡_jiff›s
 = 0;

160 
	}
}

163 
	gRED
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *)

165 ià(
RED
 *
r
 = (RED *)
e
->
	`ÿ¡
("RED"))

166 
_size
 = 
r
->_size;

167 
	}
}

170 
	gRED
::
	$queue_size
() const

172 ià(
_queue1
)

173  
_queue1
->
	`size
();

175 
s
 = 0;

176 
i
 = 0; i < 
_queues
.
	`size
(); i++)

177 
s
 +ğ
_queues
[
i
]->
	`size
();

178  
s
;

180 
	}
}

182 
boŞ


183 
	gRED
::
	$should_drİ
()

188 
s
 = 
	`queue_size
();

189 
avg
;

191 ià(
_size
.
	`¡ab™y_shiá
() == 0)

192 
avg
 = 
s
;

193 ià(
s
) {

194 
_size
.
	`upd©e
(
s
);

195 
_Ï¡_jiff›s
 = 0;

196 
avg
 = 
_size
.
	`unsÿËd_av”age
();

199 #ià
CLICK_HZ
 < 50

200 
şick_jiff›s_t
 
j
 = 
	`şick_jiff›s
();

202 
şick_jiff›s_t
 
j
 = 
	`şick_jiff›s
(è/ (
CLICK_HZ
 / 50);

204 
_size
.
	`upd©e_n
(0, 
_Ï¡_jiff›s
 ? 
j
 - _last_jiffies : 1);

205 
_Ï¡_jiff›s
 = 
j
;

206 
avg
 = 
_size
.
	`unsÿËd_av”age
();

209 ià(
avg
 <ğ
_mš_th»sh
) {

210 
_couÁ
 = -1;

211 #ià
RED_DEBUG


212 
	`şick_ch©‹r
("%s:‚Ødrİ", 
	`deş¬©iÚ
().
	`c_¡r
());

214  
çl£
;

215 } ià(
avg
 > 
_kl_th»sh
) {

216 
_couÁ
 = -1;

217 #ià
RED_DEBUG


218 
	`şick_ch©‹r
("%s: drİ, ov” max_th»sh", 
	`deş¬©iÚ
().
	`c_¡r
());

220  
Œue
;

224 
p_b
;

225 ià(
avg
 <ğ
_max_th»sh
)

226 
p_b
 = ((
_C1
 * 
_size
.
	`sÿËd_av”age
()è>> 
QUEUE_SCALE
è- 
_C2
;

228 
p_b
 = ((
_G1
 * 
_size
.
	`sÿËd_av”age
()è>> 
QUEUE_SCALE
è- 
_G2
;

230 
_couÁ
++;

232 ià(
_couÁ
 > 0 && 
p_b
 > 0 && _couÁ > 
_¿ndom_v®ue
 /…_b) {

233 #ià
RED_DEBUG


234 
	`şick_ch©‹r
("%s: drİ,„ªdom drİ (%d, %d, %d, %d)", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_couÁ
, 
p_b
, 
_¿ndom_v®ue
, _random_value/p_b);

236 
_couÁ
 = 0;

237 
_¿ndom_v®ue
 = (
	`şick_¿ndom
() >> 5) & 0xFFFF;

238  
Œue
;

242 ià(
_couÁ
 == 0)

243 
_¿ndom_v®ue
 = (
	`şick_¿ndom
() >> 5) & 0xFFFF;

245 #ià
RED_DEBUG


246 
	`şick_ch©‹r
("%s:‚Ødrİ", 
	`deş¬©iÚ
().
	`c_¡r
());

248  
çl£
;

249 
	}
}

251 
šlše
 

252 
	gRED
::
	$hªdË_drİ
(
Pack‘
 *
p
)

254 ià(
	`nouuts
() == 1)

255 
p
->
	`kl
();

257 
	`ouut
(1).
	`push
(
p
);

258 
_drİs
++;

259 
	}
}

262 
	gRED
::
	$push
(, 
Pack‘
 *
p
)

264 ià(
	`should_drİ
())

265 
	`hªdË_drİ
(
p
);

267 
	`ouut
(0).
	`push
(
p
);

268 
	}
}

270 
Pack‘
 *

271 
	gRED
::
	$puÎ
()

273 
Œue
) {

274 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

275 ià(!
p
)

277 ià(!
	`should_drİ
())

278  
p
;

279 
	`hªdË_drİ
(
p
);

281 
	}
}

286 
SŒšg


287 
	gRED
::
	$»ad_hªdËr
(
EËm’t
 *
f
, *
v·¿m
)

289 
RED
 *
»d
 = (RED *)
f
;

290 
SŒšgAccum
 
§
;

291 (
šŒ_t
)
v·¿m
) {

293  
»d
->
_size
.
	`uÅ¬£
();

295 
§
 << 
»d
->
	`queue_size
() << " current queue\n"

296 << 
»d
->
_size
.
	`uÅ¬£
() << "‡vg queue\n"

297 << 
»d
->
	`drİs
() << " drops\n"

298 #ià
CLICK_STATS
 >= 1

299 << 
»d
->
	`ouut
(0).
	`Åack‘s
() << "…ackets\n"

302  
§
.
	`ke_¡ršg
();

304 
i
 = 0; i < 
»d
->
_queue_–em’ts
.
	`size
(); i++)

305 
§
 << 
»d
->
_queue_–em’ts
[
i
]->
	`Çme
() << "\n";

306  
§
.
	`ke_¡ršg
();

308 
§
 << 
»d
->
_mš_th»sh
 << ", " <<„ed->
_max_th»sh
 << ", "

309 << 
	`ı_uÅ¬£_»®2
(
»d
->
_max_p
, 16) << ", QUEUES";

310 
i
 = 0; i < 
»d
->
_queue_–em’ts
.
	`size
(); i++)

311 
§
 << ' ' << 
»d
->
_queue_–em’ts
[
i
]->
	`Çme
();

312 
§
 << ", STABILITY " << 
»d
->
_size
.
	`¡ab™y_shiá
();

313 ià(!
»d
->
_g’e
)

314 
§
 << ", GENTLE false";

315  
§
.
	`ke_¡ršg
();

317 
	}
}

320 
	gRED
::
	$add_hªdËrs
()

322 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

323 
	`add_»ad_hªdËr
("mš_th»sh", 
»ad_keywÜd_hªdËr
, "0 MIN_THRESH");

324 
	`add_wr™e_hªdËr
("mš_th»sh", 
»cÚfigu»_keywÜd_hªdËr
, "0 MIN_THRESH");

325 
	`add_»ad_hªdËr
("max_th»sh", 
»ad_keywÜd_hªdËr
, "1 MAX_THRESH");

326 
	`add_wr™e_hªdËr
("max_th»sh", 
»cÚfigu»_keywÜd_hªdËr
, "1 MAX_THRESH");

327 
	`add_»ad_hªdËr
("max_p", 
»ad_keywÜd_hªdËr
, "2 MAX_P");

328 
	`add_wr™e_hªdËr
("max_p", 
»cÚfigu»_keywÜd_hªdËr
, "2 MAX_P");

329 
	`add_»ad_hªdËr
("avg_queue_size", 
»ad_hªdËr
, 3);

330 
	`add_»ad_hªdËr
("¡©s", 
»ad_hªdËr
, 4);

331 
	`add_»ad_hªdËr
("queues", 
»ad_hªdËr
, 5);

332 
	`add_»ad_hªdËr
("cÚfig", 
»ad_hªdËr
, 6);

333 
	`£t_hªdËr_æags
("cÚfig", 0, 
HªdËr
::
CALM
);

334 
	}
}

336 
CLICK_ENDDECLS


337 
	$ELEMENT_REQUIRES
(
št64
)

338 
	`EXPORT_ELEMENT
(
RED
)

	@aqm/red.hh

2 #iâdeà
CLICK_RED_HH


3 
	#CLICK_RED_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/ewma.hh
>

6 
CLICK_DECLS


7 
şass
 
	gStÜage
;

132 şas 
	cRED
 : 
public
 
EËm’t
 {…ublic:

135 ’um { 
QUEUE_SCALE
 = 10 };

137 
	gDœeùEWMAX
<
	tSb™yEWMAXP¬am‘”s
<
	tQUEUE_SCALE
, 
	tušt64_t
, 
	tšt64_t
> > 
	tewma_ty³
;

139 
	$RED
(è
CLICK_COLD
;

140 ~
	$RED
(è
CLICK_COLD
;

142 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "RED"; 
	}
}

143 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

144 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

146 
	$queue_size
() const;

147 cÚ¡ 
ewma_ty³
 &
	$av”age_queue_size
(ècÚ¡ {  
_size
; 
	}
}

148 
	$drİs
(ècÚ¡ {  
_drİs
; 
	}
}

150 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

151 
	$check_·¿ms
(
mš_th»sh
, 
max_th»sh
,

152 
max_p
, 
¡ab™y
, 
E¼ÜHªdËr
 *
”rh
) const;

153 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

154 
	`ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *
”rh
);

155 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

156 
	$add_hªdËrs
(è
CLICK_COLD
;

158 
boŞ
 
	`should_drİ
();

159 
	`hªdË_drİ
(
Pack‘
 *);

160 
	`push
(
pÜt
, 
Pack‘
 *);

161 
Pack‘
 *
	`puÎ
(
pÜt
);

163 
´Ùeùed
:

165 
StÜage
 *
_queue1
;

166 
VeùÜ
<
StÜage
 *> 
_queues
;

168 
_mš_th»sh
;

169 
_max_th»sh
;

170 
_kl_th»sh
;

171 
_max_p
;

173 
ewma_ty³
 
_size
;

175 
_C1
;

176 
_C2
;

177 
_G1
;

178 
_G2
;

179 
_couÁ
;

180 
_¿ndom_v®ue
;

181 
şick_jiff›s_t
 
_Ï¡_jiff›s
;

183 
_drİs
;

184 
VeùÜ
<
EËm’t
 *> 
_queue_–em’ts
;

185 
boŞ
 
_g’e
;

187 
	`£t_C1_ªd_C2
();

189 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

191 
	`fšish_cÚfigu»
(
mš_th»sh
, 
max_th»sh
, 
boŞ
 
g’e
,

192 
max_p
, 
¡ab™y
,

193 cÚ¡ 
SŒšg
 &
queues
, 
E¼ÜHªdËr
 *
”rh
);

195 
	}
};

197 
	gCLICK_ENDDECLS


	@ethernet/arpfaker.cc

18 
	~<şick/cÚfig.h
>

19 
	~"¬pçk”.hh
"

20 
	~"¬´e¥Úd”.hh
"

21 
	~<şickÃt/‘h”.h
>

22 
	~<şick/‘h”add»ss.hh
>

23 
	~<şick/add»ss.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/glue.hh
>

27 
CLICK_DECLS


29 
	gARPFak”
::
	$ARPFak”
()

30 : 
	$_tim”
(
this
)

32 
	}
}

34 
ARPFak”
::~
	$ARPFak”
()

36 
	}
}

39 
ARPFak”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41  
Args
(
cÚf
, 
this
, 
”rh
)

42 .
»ad_mp
("DSTIP", 
_1
)

43 .
»ad_mp
("DSTETH", 
_‘h1
)

44 .
»ad_mp
("SRCIP", 
_2
)

45 .
»ad_mp
("SRCETH", 
_‘h2
)

46 .
com¶‘e
();

50 
	gARPFak”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

52 
_tim”
.
	`š™Ÿlize
(
this
);

53 
_tim”
.
	`scheduË_aá”_m£c
(1 * 1000);

55 
	}
}

58 
	gARPFak”
::
	$run_tim”
(
Tim”
 *)

60 ià(
Pack‘
 *
p
 = 
ARPRe¥Úd”
::
	`make_»¥Ú£
(
_‘h1
.
	`d©a
(), 
_1
.data(),

61 
_‘h2
.
	`d©a
(), 
_2
.data()))

62 
	`ouut
(0).
	`push
(
p
);

63 
_tim”
.
	`scheduË_aá”_m£c
(10 * 1000);

64 
	}
}

66 
CLICK_ENDDECLS


67 
	$ELEMENT_REQUIRES
(
ARPRe¥Úd”
)

68 
	`EXPORT_ELEMENT
(
ARPFak”
)

	@ethernet/arpfaker.hh

1 #iâdeà
CLICK_ARPFAKER_HH


2 
	#CLICK_ARPFAKER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tim”.hh
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<şick/add»ss.hh
>

7 
CLICK_DECLS


34 şas 
	cARPFak”
 : 
public
 
EËm’t
 {

36 
public
:

38 
	$ARPFak”
(è
CLICK_COLD
;

39 ~
	$ARPFak”
(è
CLICK_COLD
;

41 cÚ¡ *
	$şass_Çme
() const {  "ARPFaker"; }

42 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

43 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

45 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

46 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

48 
	`run_tim”
(
Tim”
 *);

50 
´iv©e
:

52 
IPAdd»ss
 
_1
;

53 
Eth”Add»ss
 
_‘h1
;

54 
IPAdd»ss
 
_2
;

55 
Eth”Add»ss
 
_‘h2
;

57 
Tim”
 
_tim”
;

59 
	}
};

61 
	gCLICK_ENDDECLS


	@ethernet/arpprint.cc

21 
	~<şick/cÚfig.h
>

22 
	~"¬µršt.hh
"

23 
	~<şick/glue.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/¡¿ccum.hh
>

27 
	~<şick/·ck‘_ªno.hh
>

28 
	~<şick/rou‹r.hh
>

29 
	~<şick/Çmešfo.hh
>

31 
	~<şick/‘h”add»ss.hh
>

32 
	~<şickÃt/‘h”.h
>

34 #ià
CLICK_USERLEVEL


35 
	~<¡dio.h
>

38 
CLICK_DECLS


54 
	gARPPršt
::
	$ARPPršt
()

55 : 
	`_Ïb–
(), 
	`_´št_time¡amp
(
Œue
), 
	`_´št_‘h”
(
çl£
), 
	$_aùive
(
Œue
)

57 #ià
CLICK_USERLEVEL


58 
_outfe
 = 0;

60 
	}
}

62 
	gARPPršt
::~
	$ARPPršt
()

64 
	}
}

67 
ARPPršt
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

69 
SŒšg
 
	gchªÃl
;

71 ià(
Args
(
cÚf
, 
this
, 
”rh
)

72 .
»ad_p
("LABEL", 
_Ïb–
)

73 .
»ad
("TIMESTAMP", 
_´št_time¡amp
)

74 .
»ad
("ETHER", 
_´št_‘h”
)

75 .
»ad
("ACTIVE", 
_aùive
)

76 #ià
CLICK_USERLEVEL


77 .
»ad
("OUTFILE", 
F’ameArg
(), 
_outf’ame
)

79 .
com¶‘e
() < 0)

82 
	g_”rh
 = 
rou‹r
()->
ch©‹r_chªÃl
(
chªÃl
);

87 
	gARPPršt
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

89 #ià
CLICK_USERLEVEL


90 ià(
_outf’ame
) {

91 
_outfe
 = 
	`fİ’
(
_outf’ame
.
	`c_¡r
(), "wb");

92 ià(!
_outfe
)

93  
”rh
->
	`”rÜ
("%s: %s", 
_outf’ame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

96 (è
”rh
;

99 
	}
}

102 
	gARPPršt
::
	$ş—nup
(
CËªupSge
)

104 #ià
CLICK_USERLEVEL


105 ià(
_outfe
)

106 
	`fşo£
(
_outfe
);

107 
_outfe
 = 0;

109 
	}
}

112 
Pack‘
 *

113 
	gARPPršt
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

115 ià(!
_aùive
 || !
p
->
	`has_ÃtwÜk_h—d”
())

116  
p
;

118 
SŒšgAccum
 
§
;

119 ià(
_Ïb–
)

120 
§
 << 
_Ïb–
 << ": ";

121 ià(
_´št_time¡amp
)

122 
§
 << 
p
->
	`time¡amp_ªno
() << ": ";

124 ià(
_´št_‘h”
) {

125 cÚ¡ *
x
 = 
p
->
	`mac_h—d”
();

126 ià(!
x
)

127 
x
 = 
p
->
	`d©a
();

128 ià(
x
 + 14 <ğ
p
->
	`ÃtwÜk_h—d”
(è&& x + 14 <ğp->
	`’d_d©a
()) {

129 cÚ¡ 
şick_‘h”
 *
‘hh
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_‘h” *>(
x
);

130 
§
 << 
	`Eth”Add»ss
(
‘hh
->
‘h”_sho¡
) << " > "

131 << 
	`Eth”Add»ss
(
‘hh
->
‘h”_dho¡
) << ": ";

135 ià(
p
->
	`ÃtwÜk_Ëngth
(è< (è(
şick_¬p
))

136 
§
 << "Œunÿ‹d-¬°(" << 
p
->
	`ÃtwÜk_Ëngth
() << ")";

138 cÚ¡ 
şick_‘h”_¬p
 *
­
 = (cÚ¡ click_‘h”_¬°*è
p
->
	`ÃtwÜk_h—d”
();

139 
ušt16_t
 
hrd
 = 
	`Áohs
(
­
->
—_hdr
.
¬_hrd
);

140 
ušt16_t
 
´o
 = 
	`Áohs
(
­
->
—_hdr
.
¬_´o
);

141 
ušt8_t
 
hÊ
 = 
­
->
—_hdr
.
¬_hÊ
;

142 
ušt8_t
 
¶n
 = 
­
->
—_hdr
.
¬_¶n
;

143 
ušt16_t
 
İ
 = 
	`Áohs
(
­
->
—_hdr
.
¬_İ
);

145 ià((
´o
 !ğ
ETHERTYPE_IP
 &&…rØ!ğ
ETHERTYPE_TRAIL
) ||

146 
¶n
 !ğ4 || 
hÊ
 == 0) {

147 
§
 << "¬p-#" << 
İ
 << " fÜ…rÙØ#" << 
´o
 << " (" << 
¶n
 << ") "

148 << "h¬dw¬#" << 
hrd
 << " (" << 
hÊ
 << ")";

149  
p
;

151 cÚ¡ *
sha
 = (cÚ¡ *)
­
->
¬p_sha
;

152 cÚ¡ *
¥a
 = (cÚ¡ *)
­
->
¬p_¥a
;

153 cÚ¡ *
tha
 = (cÚ¡ *)
­
->
¬p_tha
;

154 cÚ¡ *
a
 = (cÚ¡ *)
­
->
¬p_a
;

156 ià(
´o
 =ğ
ETHERTYPE_TRAIL
)

157 
§
 << "trailer-";

159 
İ
) {

160 
ARPOP_REQUEST
:

162 cÚ¡ 
ez”o
[6] = {0,0,0,0,0,0};

163 
§
 << "¬°who-ha " << 
	`IPAdd»ss
(
a
);

164 iàĞ
	`memcmp
 (
ez”o
, 
tha
, 
hÊ
) != 0 )

165 
§
 << " (" << 
	`Eth”Add»ss
(
tha
) << ")";

166 
§
 << "–È" << 
	`IPAdd»ss
(
¥a
);

170 
ARPOP_REPLY
:

171 
§
 << "¬°»¶y " << 
	`IPAdd»ss
(
¥a
);

172 
§
 << " is-© " << 
	`Eth”Add»ss
(
sha
);

175 
ARPOP_REVREQUEST
:

176 
§
 << "¿½ who-i " << 
	`Eth”Add»ss
(
tha
) << "ell " <<

177 
	`Eth”Add»ss
(
sha
);

180 
ARPOP_REVREPLY
:

181 
§
 << "¿½„•ly " << 
	`Eth”Add»ss
(
tha
è<< "‡ˆ" << 
	`IPAdd»ss
(
a
);

184 
ARPOP_INVREQUEST
:

185 
§
 << "šv¬°who-i " << 
	`Eth”Add»ss
(
tha
) << "ell " <<

186 
	`Eth”Add»ss
(
sha
);

189 
ARPOP_INVREPLY
:

190 
§
 << "šv¬°»¶y " << 
	`Eth”Add»ss
(
tha
) << "‡t " <<

191 
	`IPAdd»ss
(
a
);

195 
§
 << "¬p-#" << 
İ
;

198 ià(
hrd
 !ğ
ARPHRD_ETHER
)

199 
§
 << "h¬dw¬#" << 
hrd
;

202 #ià
CLICK_USERLEVEL


203 ià(
_outfe
) {

204 
§
 << '\n';

205 
	`ignÜe_»suÉ
(
	`fwr™e
(
§
.
	`d©a
(), 1, sa.
	`Ëngth
(), 
_outfe
));

208 
_”rh
->
	`mes§ge
("%s", 
§
.
	`c_¡r
());

210  
p
;

211 
	}
}

215 
	gARPPršt
::
	$add_hªdËrs
()

217 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_aùive
);

218 
	}
}

220 
CLICK_ENDDECLS


221 
EXPORT_ELEMENT
(
ARPPršt
)

	@ethernet/arpprint.hh

1 #iâdeà
CLICK_ARPPRINT_HH


2 
	#CLICK_ARPPRINT_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


53 şas 
	cARPPršt
 : 
public
 
EËm’t
 {…ublic:

55 
	$ARPPršt
(è
CLICK_COLD
;

56 ~
	$ARPPršt
(è
CLICK_COLD
;

58 cÚ¡ *
	$şass_Çme
() const {  "ARPPrint"; }

59 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

61 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

62 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

63 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

64 
	$add_hªdËrs
(è
CLICK_COLD
;

66 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

68 
´iv©e
:

70 
SŒšg
 
_Ïb–
;

71 
boŞ
 
_´št_time¡amp
;

72 
boŞ
 
_´št_‘h”
;

73 
boŞ
 
_aùive
;

75 #ià
CLICK_USERLEVEL


76 
SŒšg
 
_outf’ame
;

77 
FILE
 *
_outfe
;

79 
E¼ÜHªdËr
 *
_”rh
;

81 
	}
};

83 
	gCLICK_ENDDECLS


	@ethernet/arpquerier.cc

20 
	~<şick/cÚfig.h
>

21 
	~"¬pqu”›r.hh
"

22 
	~<şickÃt/‘h”.h
>

23 
	~<şick/‘h”add»ss.hh
>

24 
	~<şick/add»ss.hh
>

25 
	~<şick/¬gs.hh
>

26 
	~<şick/b™veùÜ.hh
>

27 
	~<şick/¡¿ccum.hh
>

28 
	~<şick/rou‹r.hh
>

29 
	~<şick/”rÜ.hh
>

30 
	~<şick/glue.hh
>

31 
	~<şick/·ck‘_ªno.hh
>

32 
CLICK_DECLS


34 
	gARPQu”›r
::
	$ARPQu”›r
()

35 : 
	`_¬±
(0), 
	`_my_¬±
(
çl£
), 
	$_z”o_w¬Ãd
(
çl£
)

37 
	}
}

39 
	gARPQu”›r
::~
	$ARPQu”›r
()

41 
	}
}

44 
ARPQu”›r
::
	$ÿ¡
(cÚ¡ *
Çme
)

46 ià(
	`¡rcmp
(
Çme
, "ARPTable") == 0)

47  
_¬±
;

48 ià(
	`¡rcmp
(
Çme
, "ARPQuerier") == 0)

49  
this
;

51  
EËm’t
::
	`ÿ¡
(
Çme
);

52 
	}
}

55 
	gARPQu”›r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

57 
ušt32_t
 
	gÿ·c™y
, 
	g’Œy_ÿ·c™y
, 
	g’Œy_·ck‘_ÿ·c™y
, 
	gÿ·c™y_¦im_çùÜ
;

58 
Time¡amp
 
	gtimeout
, 
pŞl_timeout
(60);

59 
boŞ
 
	ghave_ÿ·c™y
, 
	ghave_’Œy_ÿ·c™y
, 
	ghave_’Œy_·ck‘_ÿ·c™y
, 
	ghave_ÿ·c™y_¦im_çùÜ
, 
	ghave_timeout
, 
	ghave_brßdÿ¡
,

60 
	gbrßdÿ¡_pŞl
 = 
çl£
;

61 
	g_¬±
 = 0;

62 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

63 .
»ad
("CAPACITY", 
ÿ·c™y
).
»ad_¡©us
(
have_ÿ·c™y
)

64 .
»ad
("ENTRY_CAPACITY", 
’Œy_ÿ·c™y
).
»ad_¡©us
(
have_’Œy_ÿ·c™y
)

65 .
»ad
("ENTRY_PACKET_CAPACITY", 
’Œy_·ck‘_ÿ·c™y
).
»ad_¡©us
(
have_’Œy_·ck‘_ÿ·c™y
)

66 .
»ad
("CAPACITY_SLIM_FACTOR", 
ÿ·c™y_¦im_çùÜ
).
»ad_¡©us
(
have_ÿ·c™y_¦im_çùÜ
)

67 .
»ad
("TIMEOUT", 
timeout
).
»ad_¡©us
(
have_timeout
)

68 .
»ad
("BROADCAST", 
_my_bÿ¡_
).
»ad_¡©us
(
have_brßdÿ¡
)

69 .
»ad
("TABLE", 
EËm’tCa¡Arg
("ARPTabË"), 
_¬±
)

70 .
»ad
("POLL_TIMEOUT", 
pŞl_timeout
)

71 .
»ad
("BROADCAST_POLL", 
brßdÿ¡_pŞl
)

72 .
cÚsume
() < 0)

75 ià(!
	g_¬±
) {

76 
	gVeùÜ
<
	gSŒšg
> 
	gsubcÚf
;

77 ià(
	ghave_ÿ·c™y
)

78 
	gsubcÚf
.
push_back
("CAPACITY " + 
SŒšg
(
ÿ·c™y
));

79 ià(
	ghave_’Œy_ÿ·c™y
)

80 
	gsubcÚf
.
push_back
("ENTRY_CAPACITY " + 
SŒšg
(
’Œy_ÿ·c™y
));

81 ià(
	ghave_’Œy_·ck‘_ÿ·c™y
)

82 
	gsubcÚf
.
push_back
("ENTRY_PACKET_CAPACITY " + 
SŒšg
(
’Œy_·ck‘_ÿ·c™y
));

83 ià(
	ghave_ÿ·c™y_¦im_çùÜ
)

84 
	gsubcÚf
.
push_back
("CAPACITY_SLIM_FACTOR " + 
SŒšg
(
ÿ·c™y_¦im_çùÜ
));

85 ià(
	ghave_timeout
)

86 
	gsubcÚf
.
push_back
("TIMEOUT " + 
timeout
.
uÅ¬£
());

87 
	g_¬±
 = 
Ãw
 
ARPTabË
;

88 
	g_¬±
->
©ch_rou‹r
(
rou‹r
(), -1);

89 
	g_¬±
->
cÚfigu»
(
subcÚf
, 
”rh
);

90 
	g_my_¬±
 = 
Œue
;

93 
IPAdd»ss
 
	gmy_mask
;

94 ià(
	gcÚf
.
size
() == 1)

95 
cÚf
.
push_back
(conf[0]);

96 ià(
Args
(
cÚf
, 
this
, 
”rh
)

97 .
»ad_mp
("IP", 
IPP»fixArg
(
Œue
), 
_my_
, 
my_mask
)

98 .
»ad_mp
("ETH", 
_my_’
)

99 .
com¶‘e
() < 0)

102 ià(!
	ghave_brßdÿ¡
) {

103 
	g_my_bÿ¡_
 = 
_my_
 | ~
my_mask
;

104 ià(
	g_my_bÿ¡_
 =ğ
_my_
)

105 
_my_bÿ¡_
 = 0xFFFFFFFFU;

108 
	g_brßdÿ¡_pŞl
 = 
brßdÿ¡_pŞl
;

109 ià((
	gušt32_t
è
	gpŞl_timeout
.
£c
(è>ğ(
ušt32_t
è0xFFFFFFFFU / 
CLICK_HZ
)

110 
_pŞl_timeout_j
 = 0;

112 
	g_pŞl_timeout_j
 = 
pŞl_timeout
.
jiff›s
();

118 
	gARPQu”›r
::
live_»cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

120 
ušt32_t
 
	gÿ·c™y
, 
	g’Œy_ÿ·c™y
, 
	g’Œy_·ck‘_ÿ·c™y
, 
	gÿ·c™y_¦im_çùÜ
;

121 
Time¡amp
 
	gtimeout
, 
pŞl_timeout
(Time¡amp::
make_jiff›s
((
şick_jiff›s_t
è
_pŞl_timeout_j
));

122 
boŞ
 
	ghave_ÿ·c™y
, 
	ghave_’Œy_ÿ·c™y
, 
	ghave_’Œy_·ck‘_ÿ·c™y
, 
	ghave_ÿ·c™y_¦im_çùÜ
, 
	ghave_timeout
, 
	ghave_brßdÿ¡
,

123 
brßdÿ¡_pŞl
(
_brßdÿ¡_pŞl
);

124 
IPAdd»ss
 
	gmy_bÿ¡_
;

126 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

127 .
»ad
("CAPACITY", 
ÿ·c™y
).
»ad_¡©us
(
have_ÿ·c™y
)

128 .
»ad
("ENTRY_CAPACITY", 
’Œy_ÿ·c™y
).
»ad_¡©us
(
have_’Œy_ÿ·c™y
)

129 .
»ad
("ENTRY_PACKET_CAPACITY", 
’Œy_·ck‘_ÿ·c™y
).
»ad_¡©us
(
have_’Œy_·ck‘_ÿ·c™y
)

130 .
»ad
("CAPACITY_SLIM_FACTOR", 
ÿ·c™y_¦im_çùÜ
).
»ad_¡©us
(
have_ÿ·c™y_¦im_çùÜ
)

131 .
»ad
("TIMEOUT", 
timeout
).
»ad_¡©us
(
have_timeout
)

132 .
»ad
("BROADCAST", 
my_bÿ¡_
).
»ad_¡©us
(
have_brßdÿ¡
)

133 .
»ad_w™h
("TABLE", 
AnyArg
())

134 .
»ad
("POLL_TIMEOUT", 
pŞl_timeout
)

135 .
»ad
("BROADCAST_POLL", 
brßdÿ¡_pŞl
)

136 .
cÚsume
() < 0)

139 
IPAdd»ss
 
	gmy_
, 
	gmy_mask
;

140 
Eth”Add»ss
 
	gmy_’
;

141 ià(
	gcÚf
.
size
() == 1)

142 
cÚf
.
push_back
(conf[0]);

143 ià(
Args
(
cÚf
, 
this
, 
”rh
)

144 .
»ad_mp
("IP", 
IPP»fixArg
(
Œue
), 
my_
, 
my_mask
)

145 .
»ad_mp
("ETH", 
my_’
)

146 .
com¶‘e
() < 0)

148 ià(!
	ghave_brßdÿ¡
) {

149 
	gmy_bÿ¡_
 = 
my_
 | ~
my_mask
;

150 ià(
	gmy_bÿ¡_
 =ğ
my_
)

151 
my_bÿ¡_
 = 0xFFFFFFFFU;

153 ià(
	ghave_ÿ·c™y_¦im_çùÜ
 && !
	gÿ·c™y_¦im_çùÜ
)

154  
	g”rh
->
”rÜ
("CAPACITY_SLIM_FACTOR cannot be zero");

156 ià((
	gmy_
 !ğ
_my_
 || 
my_’
 !ğ
_my_’
è&& 
_my_¬±
)

157 
_¬±
->
ş—r
();

159 
	g_my_
 = 
my_
;

160 
	g_my_’
 = 
my_’
;

161 
	g_my_bÿ¡_
 = 
my_bÿ¡_
;

162 ià(
	g_my_¬±
 && 
	ghave_ÿ·c™y
)

163 
	g_¬±
->
£t_ÿ·c™y
(
ÿ·c™y
);

164 ià(
	g_my_¬±
 && 
	ghave_’Œy_ÿ·c™y
)

165 
	g_¬±
->
£t_’Œy_ÿ·c™y
(
’Œy_ÿ·c™y
);

166 ià(
	g_my_¬±
 && 
	ghave_’Œy_·ck‘_ÿ·c™y
)

167 
	g_¬±
->
£t_’Œy_·ck‘_ÿ·c™y
(
’Œy_·ck‘_ÿ·c™y
);

168 ià(
	g_my_¬±
 && 
	ghave_ÿ·c™y_¦im_çùÜ
)

169 
	g_¬±
->
£t_ÿ·c™y_¦im_çùÜ
(
ÿ·c™y_¦im_çùÜ
);

170 ià(
	g_my_¬±
 && 
	ghave_timeout
)

171 
	g_¬±
->
£t_timeout
(
timeout
);

173 
	g_brßdÿ¡_pŞl
 = 
brßdÿ¡_pŞl
;

174 ià((
	gušt32_t
è
	gpŞl_timeout
.
£c
(è>ğ(
ušt32_t
è0xFFFFFFFFU / 
CLICK_HZ
)

175 
_pŞl_timeout_j
 = 0;

177 
	g_pŞl_timeout_j
 = 
pŞl_timeout
.
jiff›s
();

183 
	gARPQu”›r
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

185 
_¬p_qu”›s
 = 0;

186 
_drİs
 = 0;

187 
_¬p_»¥Ú£s
 = 0;

189 
	}
}

192 
	gARPQu”›r
::
	$ş—nup
(
CËªupSge
 
¡age
)

194 ià(
_my_¬±
) {

195 
_¬±
->
	`ş—nup
(
¡age
);

196 
d–‘e
 
_¬±
;

198 
	}
}

201 
	gARPQu”›r
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *
”rh
)

203 
ARPQu”›r
 *
¬pq
 = (ARPQu”›¸*è
e
->
	`ÿ¡
("ARPQuerier");

204 ià(!
¬pq
 || 
_my_
 !ğ¬pq->_my_ || 
_my_’
 !=‡rpq->_my_en

205 || 
_my_bÿ¡_
 !ğ
¬pq
->_my_bcast_ip)

208 ià(
_my_¬±
 && 
¬pq
->_my_arpt)

209 
_¬±
->
	`ke_¡©e
(
¬pq
->_¬±, 
”rh
);

210 
_¬p_qu”›s
 = 
¬pq
->_arp_queries;

211 
_drİs
 = 
¬pq
->_drops;

212 
_¬p_»¥Ú£s
 = 
¬pq
->_arp_responses;

213 
	}
}

216 
	gARPQu”›r
::
	$£nd_qu”y_fÜ
(cÚ¡ 
Pack‘
 *
p
, 
boŞ
 
‘h”_dho¡_v®id
)

220 
	`¡©ic_as£¹
(
Pack‘
::
deçuÉ_h—droom
 >ğ(
şick_‘h”
), "Packet::default_headroom must be‡t†east 14.");

221 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(Pack‘::
deçuÉ_h—droom
 - (
şick_‘h”
),

222 
NULL
, (
şick_‘h”
è+ (
şick_‘h”_¬p
), 0);

223 ià(!
q
) {

224 
	`şick_ch©‹r
("in‡rp querier: cannot make…acket!");

228 
şick_‘h”
 *
e
 = (şick_‘h” *è
q
->
	`d©a
();

229 
q
->
	`£t_‘h”_h—d”
(
e
);

230 ià(
‘h”_dho¡_v®id
 && 
	`lik–y
(!
_brßdÿ¡_pŞl
))

231 
	`memıy
(
e
->
‘h”_dho¡
, 
p
->
	`‘h”_h—d”
()->ether_dhost, 6);

233 
	`mem£t
(
e
->
‘h”_dho¡
, 0xff, 6);

234 
	`memıy
(
e
->
‘h”_sho¡
, 
_my_’
.
	`d©a
(), 6);

235 
e
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_ARP
);

237 
şick_‘h”_¬p
 *
—
 = (şick_‘h”_¬°*è(
e
 + 1);

238 
—
->
—_hdr
.
¬_hrd
 = 
	`htÚs
(
ARPHRD_ETHER
);

239 
—
->
—_hdr
.
¬_´o
 = 
	`htÚs
(
ETHERTYPE_IP
);

240 
—
->
—_hdr
.
¬_hÊ
 = 6;

241 
—
->
—_hdr
.
¬_¶n
 = 4;

242 
—
->
—_hdr
.
¬_İ
 = 
	`htÚs
(
ARPOP_REQUEST
);

243 
	`memıy
(
—
->
¬p_sha
, 
_my_’
.
	`d©a
(), 6);

244 
	`memıy
(
—
->
¬p_¥a
, 
_my_
.
	`d©a
(), 4);

245 
	`mem£t
(
—
->
¬p_tha
, 0, 6);

246 
IPAdd»ss
 
wªt_
 = 
p
->
	`d¡__ªno
();

247 
	`memıy
(
—
->
¬p_a
, 
wªt_
.
	`d©a
(), 4);

249 
q
->
	`£t_time¡amp_ªno
(
p
->
	`time¡amp_ªno
());

250 
	`SET_VLAN_TCI_ANNO
(
q
, 
	`VLAN_TCI_ANNO
(
p
));

252 
_¬p_qu”›s
++;

253 
	`ouut
(
	`nouuts
(è- 1).
	`push
(
q
);

254 
	}
}

264 
	gARPQu”›r
::
	$hªdË_
(
Pack‘
 *
p
, 
boŞ
 
»¥Ú£
)

267 ià(!
_my_
) {

268 
p
->
	`kl
();

269 ++
_drİs
;

274 
Wr™abËPack‘
 *
q
;

275 ià(
»¥Ú£
) {

276 
	`as£¹
(!
p
->
	`sh¬ed
());

277 
q
 = 
p
->
	`uniqueify
();

278 } ià(!(
q
 = 
p
->
	`push_mac_h—d”
((
şick_‘h”
)))) {

279 ++
_drİs
;

282 
q
->
	`‘h”_h—d”
()->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_IP
);

284 
IPAdd»ss
 
d¡_
 = 
q
->
	`d¡__ªno
();

285 
Eth”Add»ss
 *
d¡_‘h
 = 
»š‹½»t_ÿ¡
<Eth”Add»s *>(
q
->
	`‘h”_h—d”
()->
‘h”_dho¡
);

286 
r
;

289 
»Œy_»ad_lock
:

290 
r
 = 
_¬±
->
	`lookup
(
d¡_
, 
d¡_‘h
, 
_pŞl_timeout_j
);

291 ià(
r
 >= 0) {

292 
	`as£¹
(!
d¡_‘h
->
	`is_brßdÿ¡
());

293 ià(
r
 > 0)

294 
	`£nd_qu”y_fÜ
(
q
, 
Œue
);

296 } ià(
d¡_
.
	`addr
(è=ğ0xFFFFFFFFU || d¡_ =ğ
_my_bÿ¡_
) {

297 
	`mem£t
(
d¡_‘h
, 0xff, 6);

299 } ià(
d¡_
.
	`is_muÉiÿ¡
()) {

300 
ušt8_t
 *
d¡_addr
 = 
q
->
	`‘h”_h—d”
()->
‘h”_dho¡
;

301 
d¡_addr
[0] = 0x01;

302 
d¡_addr
[1] = 0x00;

303 
d¡_addr
[2] = 0x5E;

304 
ušt32_t
 
addr
 = 
	`Áohl
(
d¡_
.
	`addr
());

305 
d¡_addr
[3] = (
addr
 >> 16) & 0x7F;

306 
d¡_addr
[4] = 
addr
 >> 8;

307 
d¡_addr
[5] = 
addr
;

311 ià(!
d¡_
) {

312 ià(!
_z”o_w¬Ãd
) {

313 
	`şick_ch©‹r
("%s: would qu”y fÜ 0.0.0.0; missšg de¡ IP‡dd¸ªnÙ©iÚ?", 
	`deş¬©iÚ
().
	`c_¡r
());

314 
_z”o_w¬Ãd
 = 
Œue
;

316 ++
_drİs
;

317 
q
->
	`kl
();

319 
r
 = 
_¬±
->
	`­³nd_qu”y
(
d¡_
, 
q
);

320 ià(
r
 =ğ-
EAGAIN
)

321 
»Œy_»ad_lock
;

322 ià(
r
 < 0)

323 
q
->
	`kl
();

324 ià(
r
 > 0)

325 
	`£nd_qu”y_fÜ
(
q
, 
çl£
);

334 
	`memıy
(&
q
->
	`‘h”_h—d”
()->
‘h”_sho¡
, 
_my_’
.
	`d©a
(), 6);

335 
	`ouut
(0).
	`push
(
q
);

336 
	}
}

344 
	gARPQu”›r
::
	$hªdË_»¥Ú£
(
Pack‘
 *
p
)

346 ià(
p
->
	`Ëngth
(è< (
şick_‘h”
è+ (
şick_‘h”_¬p
))

349 ++
_¬p_»¥Ú£s
;

351 
şick_‘h”
 *
‘hh
 = (şick_‘h” *è
p
->
	`d©a
();

352 
şick_‘h”_¬p
 *
¬ph
 = (şick_‘h”_¬°*è(
‘hh
 + 1);

353 
IPAdd»ss
 
a
 = 
	`IPAdd»ss
(
¬ph
->
¬p_¥a
);

354 
Eth”Add»ss
 
’a
 = 
	`Eth”Add»ss
(
¬ph
->
¬p_sha
);

355 ià(
	`Áohs
(
‘hh
->
‘h”_ty³
è=ğ
ETHERTYPE_ARP


356 && 
	`Áohs
(
¬ph
->
—_hdr
.
¬_hrd
è=ğ
ARPHRD_ETHER


357 && 
	`Áohs
(
¬ph
->
—_hdr
.
¬_´o
è=ğ
ETHERTYPE_IP


358 && 
	`Áohs
(
¬ph
->
—_hdr
.
¬_İ
è=ğ
ARPOP_REPLY


359 && !
’a
.
	`is_group
()) {

360 
Pack‘
 *
ÿched_·ck‘
;

361 
_¬±
->
	`š£¹
(
a
, 
’a
, &
ÿched_·ck‘
);

364 
ÿched_·ck‘
) {

365 
Pack‘
 *
Ãxt
 = 
ÿched_·ck‘
->
	`Ãxt
();

366 
	`hªdË_
(
ÿched_·ck‘
, 
Œue
);

367 
ÿched_·ck‘
 = 
Ãxt
;

370 
	}
}

373 
	gARPQu”›r
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

375 ià(
pÜt
 == 0)

376 
	`hªdË_
(
p
, 
çl£
);

378 
	`hªdË_»¥Ú£
(
p
);

379 
p
->
	`kl
();

381 
	}
}

383 
SŒšg


384 
	gARPQu”›r
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

386 
ARPQu”›r
 *
q
 = (ARPQu”›¸*)
e
;

387 
»š‹½»t_ÿ¡
<
ušŒ_t
>(
thunk
)) {

388 
h_bË
:

389  
q
->
_¬±
->
	`»ad_hªdËr
(q->_¬±, (*è(
ušŒ_t
è
ARPTabË
::
h_bË
);

390 
h_¡©s
:

392 
	`SŒšg
(
q
->
_drİs
.
	`v®ue
(è+ q->
_¬±
->
	`drİs
()) + "…ackets killed\n" +

393 
	`SŒšg
(
q
->
_¬p_qu”›s
.
	`v®ue
()) + " ARP queries sent\n";

394 
h_couÁ
:

395  
	`SŒšg
(
q
->
_¬±
->
	`couÁ
());

396 
h_Ëngth
:

397  
	`SŒšg
(
q
->
_¬±
->
	`Ëngth
());

399  
	`SŒšg
();

401 
	}
}

404 
	gARPQu”›r
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

406 
ARPQu”›r
 *
q
 = (ARPQu”›¸*è
e
;

407 
»š‹½»t_ÿ¡
<
ušŒ_t
>(
thunk
)) {

408 
h_š£¹
:

409  
q
->
_¬±
->
	`wr™e_hªdËr
(
¡r
, q->_¬±, (*è(
ušŒ_t
è
ARPTabË
::
h_š£¹
, 
”rh
);

410 
h_d–‘e
:

411  
q
->
_¬±
->
	`wr™e_hªdËr
(
¡r
, q->_¬±, (*è(
ušŒ_t
è
ARPTabË
::
h_d–‘e
, 
”rh
);

412 
h_ş—r
:

413 
q
->
_¬p_qu”›s
 = q->
_drİs
 = q->
_¬p_»¥Ú£s
 = 0;

414 
q
->
_¬±
->
	`ş—r
();

419 
	}
}

422 
	gARPQu”›r
::
	$add_hªdËrs
()

424 
	`add_»ad_hªdËr
("bË", 
»ad_hªdËr
, 
h_bË
);

425 
	`add_»ad_hªdËr
("¡©s", 
»ad_hªdËr
, 
h_¡©s
);

426 
	`add_»ad_hªdËr
("couÁ", 
»ad_hªdËr
, 
h_couÁ
);

427 
	`add_»ad_hªdËr
("Ëngth", 
»ad_hªdËr
, 
h_Ëngth
);

428 
	`add_d©a_hªdËrs
("qu”›s", 
HªdËr
::
OP_READ
, &
_¬p_qu”›s
);

429 
	`add_d©a_hªdËrs
("»¥Ú£s", 
HªdËr
::
OP_READ
, &
_¬p_»¥Ú£s
);

430 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

431 
	`add_d©a_hªdËrs
("brßdÿ¡", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_my_bÿ¡_
);

432 
	`add_d©a_hªdËrs
("addr", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_my_
);

433 
	`add_wr™e_hªdËr
("š£¹", 
wr™e_hªdËr
, 
h_š£¹
);

434 
	`add_wr™e_hªdËr
("d–‘e", 
wr™e_hªdËr
, 
h_d–‘e
);

435 
	`add_wr™e_hªdËr
("ş—r", 
wr™e_hªdËr
, 
h_ş—r
);

436 
	}
}

438 
CLICK_ENDDECLS


439 
	$EXPORT_ELEMENT
(
ARPQu”›r
)

440 
	$ELEMENT_REQUIRES
(
ARPTabË
)

441 
	`ELEMENT_MT_SAFE
(
ARPQu”›r
)

	@ethernet/arpquerier.hh

1 #iâdeà
CLICK_ARPQUERIER_HH


2 
	#CLICK_ARPQUERIER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/add»ss.hh
>

6 
	~<şick/sync.hh
>

7 
	~<şick/tim”.hh
>

8 
	~"¬±abË.hh
"

9 
CLICK_DECLS


173 şas 
	cARPQu”›r
 : 
public
 
EËm’t
 {…ublic:

175 
	$ARPQu”›r
(è
CLICK_COLD
;

176 ~
	$ARPQu”›r
(è
CLICK_COLD
;

178 cÚ¡ *
	$şass_Çme
() const {  "ARPQuerier"; }

179 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/1-2"; 
	}
}

180 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

181 cÚ¡ *
	$æow_code
(ècÚ¡ {  "xy/x"; 
	}
}

183 cÚ¡ *
	$æags
(ècÚ¡ {  "L2"; 
	}
}

184 *
ÿ¡
(cÚ¡ *
Çme
);

186 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

187 
live_»cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *);

188 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

189 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

190 
	$add_hªdËrs
(è
CLICK_COLD
;

191 
	$ş—nup
(
CËªupSge
 
¡age
è
CLICK_COLD
;

192 
	`ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *
”rh
);

194 
	`push
(
pÜt
, 
Pack‘
 *
p
);

196 
´iv©e
:

198 
ARPTabË
 *
_¬±
;

199 
Eth”Add»ss
 
_my_’
;

200 
IPAdd»ss
 
_my_
;

201 
IPAdd»ss
 
_my_bÿ¡_
;

202 
ušt32_t
 
_pŞl_timeout_j
;

203 
_brßdÿ¡_pŞl
;

206 
©omic_ušt32_t
 
_¬p_qu”›s
;

207 
©omic_ušt32_t
 
_drİs
;

208 
©omic_ušt32_t
 
_¬p_»¥Ú£s
;

209 
©omic_ušt32_t
 
_brßdÿ¡s
;

210 
boŞ
 
_my_¬±
;

211 
boŞ
 
_z”o_w¬Ãd
;

213 
	`£nd_qu”y_fÜ
(cÚ¡ 
Pack‘
 *
p
, 
boŞ
 
‘h”_dho¡_v®id
);

215 
	`hªdË_
(
Pack‘
 *
p
, 
boŞ
 
»¥Ú£
);

216 
	`hªdË_»¥Ú£
(
Pack‘
 *
p
);

218 
	`expœe_hook
(
Tim”
 *, *);

219 
SŒšg
 
	`»ad_bË
(
EËm’t
 *, *);

220 
SŒšg
 
	`»ad_bË_xml
(
EËm’t
 *, *);

221 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

222 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

224 ’um { 
h_bË
, 
h_bË_xml
, 
h_¡©s
, 
h_š£¹
, 
h_d–‘e
, 
h_ş—r
,

225 
h_couÁ
, 
h_Ëngth
 
	}
};

229 
	gCLICK_ENDDECLS


	@ethernet/arpresponder.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¬´e¥Úd”.hh
"

21 
	~<şickÃt/‘h”.h
>

22 
	~<şick/‘h”add»ss.hh
>

23 
	~<şick/add»ss.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/glue.hh
>

27 
	~<şick/¡¿ccum.hh
>

28 
	~<şick/·ck‘_ªno.hh
>

29 
CLICK_DECLS


31 
	gARPRe¥Úd”
::
	$ARPRe¥Úd”
()

33 
	}
}

35 
ARPRe¥Úd”
::~
	$ARPRe¥Úd”
()

37 
	}
}

40 
ARPRe¥Úd”
::
add
(
VeùÜ
<
EÁry
> &
v
, cÚ¡ 
SŒšg
 &
¬g
, 
E¼ÜHªdËr
 *
”rh
) const

42 
	gŞd_vsize
 = 
v
.
size
();

43 
	gVeùÜ
<
	gSŒšg
> 
	gwÜds
;

44 
ı_¥aûvec
(
¬g
, 
wÜds
);

46 
	gVeùÜ
<
	gEÁry
> 
	g’Œ›s
;

47 
Eth”Add»ss
 
	g’a
;

48 
boŞ
 
	ghave_’a
 = 
çl£
;

50 
	gi
 = 0; i < 
	gwÜds
.
size
(); ++i) {

51 
IPAdd»ss
 
	gaddr
, 
	gmask
;

52 ià(
IPP»fixArg
(
Œue
).
·r£
(
wÜds
[
i
], 
addr
, 
mask
, 
this
)) {

53 
	gv
.
push_back
(
EÁry
());

54 
	gv
.
back
().
	gd¡
 = 
addr
 & 
mask
;

55 
	gv
.
back
().
	gmask
 = 
mask
;

56 } ià(
Eth”Add»ssArg
().
·r£
(
wÜds
[
i
], 
’a
, 
this
)) {

57 ià(
	ghave_’a
) {

58 
	gv
.
»size
(
Şd_vsize
);

59  
	g”rh
->
”rÜ
("morehan one ETH");

61 
	ghave_’a
 = 
Œue
;

63 
	gv
.
»size
(
Şd_vsize
);

64  
	g”rh
->
”rÜ
("expected IP/MASK ETH");

69 
	gi
 = 0; !
	ghave_’a
 && i < 
	gwÜds
.
size
(); ++i)

70 ià(
Eth”Add»ssArg
().
·r£
(
wÜds
[
i
], 
’a
, 
this
))

71 
	ghave_’a
 = 
Œue
;

73 ià(
	gv
.
size
(è=ğ
Şd_vsize
)

74  
”rh
->
”rÜ
("missing IP/MASK");

75 ià(!
	ghave_’a
) {

76 
	gv
.
»size
(
Şd_vsize
);

77  
	g”rh
->
”rÜ
("missing ETH");

79 
	gi
 = 
Şd_vsize
; i < 
	gv
.
size
(); ++i)

80 
	gv
[
i
].
	g’a
 = 
’a
;

85 
	gARPRe¥Úd”
::
	$’Œy_com·»
(cÚ¡ *
­
, cÚ¡ *
bp
, *
u£r_d©a
)

87 
a
 = *
»š‹½»t_ÿ¡
<cÚ¡ *>(
­
),

88 
b
 = *
»š‹½»t_ÿ¡
<cÚ¡ *>(
bp
);

89 cÚ¡ 
EÁry
 *
’Œ›s
 = 
»š‹½»t_ÿ¡
<EÁry *>(
u£r_d©a
);

90 cÚ¡ 
EÁry
 &
—
 = 
’Œ›s
[
a
], &
eb
 =ƒÁr›s[
b
];

92 ià(
—
.
d¡
 =ğ
eb
.d¡ &&ƒa.
mask
 ==ƒb.mask)

93  
b
 - 
a
;

94 ià((
—
.
d¡
 & 
eb
.
mask
) ==ƒb.dst)

96 ià((
eb
.
d¡
 & 
—
.
mask
) ==ƒa.dst)

99  
a
 - 
b
;

100 
	}
}

103 
	gARPRe¥Úd”
::
nÜm®ize
(
VeùÜ
<
EÁry
> &
v
, 
boŞ
 
w¬n
, 
E¼ÜHªdËr
 *
”rh
)

105 
	gVeùÜ
<> 
	g³rmu‹
;

106 
	gi
 = 0; i < 
	gv
.
size
(); ++i)

107 
	g³rmu‹
.
push_back
(
i
);

108 
şick_qsÜt
(
³rmu‹
.
begš
(),…”mu‹.
size
(), (), 
’Œy_com·»
, 
v
.begin());

110 
	gVeùÜ
<
	gEÁry
> 
	gnv
;

111 
	gi
 = 0; i < 
	g³rmu‹
.
size
(); ++i) {

112 cÚ¡ 
	gEÁry
 &
	ge
 = 
v
[
³rmu‹
[
i
]];

113 ià(
	gnv
.
em±y
(è||‚v.
back
().
	gd¡
 !ğ
e
.
d¡
 || 
nv
.back().
mask
 !=ƒ.mask)

114 
nv
.
push_back
(
e
);

115 ià(
	gw¬n
)

116 
	g”rh
->
w¬nšg
("muÉËƒÁr› fÜ %s", 
e
.
d¡
.
uÅ¬£_w™h_mask
Ó.
mask
).
c_¡r
());

118 
	gnv
.
sw­
(
v
);

122 
	gARPRe¥Úd”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

124 
	gVeùÜ
<
	gEÁry
> 
	gv
;

125 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

126 
P»fixE¼ÜHªdËr
 
³¼h
(
”rh
, "¬gum’ˆ" + 
SŒšg
(
i
) + ": ");

127 
add
(
v
, 
cÚf
[
i
], &
³¼h
);

129 ià(!
	g”rh
->
Ã¼Üs
()) {

130 
nÜm®ize
(
v
, 
Œue
, 
”rh
);

131 
	g_v
.
sw­
(
v
);

137 
Pack‘
 *

138 
	gARPRe¥Úd”
::
	$make_»¥Ú£
(cÚ¡ 
ušt8_t
 
rg‘_‘h
[6],

139 cÚ¡ 
ušt8_t
 
rg‘_
[4],

140 cÚ¡ 
ušt8_t
 
¤c_‘h
[6],

141 cÚ¡ 
ušt8_t
 
¤c_
[4],

142 cÚ¡ 
Pack‘
 *
p
 )

144 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((
şick_‘h”
è+ (
şick_‘h”_¬p
));

145 ià(
q
 == 0) {

146 
	`şick_ch©‹r
("in‡rp„esponder: cannot make…acket!");

152 ià(
p
) {

153 
q
->
	`£t_deviû_ªno
(
p
->
	`deviû_ªno
());

154 
	`SET_VLAN_TCI_ANNO
(
q
, 
	`VLAN_TCI_ANNO
(
p
));

157 
şick_‘h”
 *
e
 = (şick_‘h” *è
q
->
	`d©a
();

158 
q
->
	`£t_‘h”_h—d”
(
e
);

159 
	`memıy
(
e
->
‘h”_dho¡
, 
rg‘_‘h
, 6);

160 
	`memıy
(
e
->
‘h”_sho¡
, 
¤c_‘h
, 6);

161 
e
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_ARP
);

163 
şick_‘h”_¬p
 *
—
 = (şick_‘h”_¬°*è(
e
 + 1);

164 
—
->
—_hdr
.
¬_hrd
 = 
	`htÚs
(
ARPHRD_ETHER
);

165 
—
->
—_hdr
.
¬_´o
 = 
	`htÚs
(
ETHERTYPE_IP
);

166 
—
->
—_hdr
.
¬_hÊ
 = 6;

167 
—
->
—_hdr
.
¬_¶n
 = 4;

168 
—
->
—_hdr
.
¬_İ
 = 
	`htÚs
(
ARPOP_REPLY
);

169 
	`memıy
(
—
->
¬p_sha
, 
¤c_‘h
, 6);

170 
	`memıy
(
—
->
¬p_¥a
, 
¤c_
, 4);

171 
	`memıy
(
—
->
¬p_tha
, 
rg‘_‘h
, 6);

172 
	`memıy
(
—
->
¬p_a
, 
rg‘_
, 4);

174  
q
;

175 
	}
}

177 
Pack‘
 *

178 
	gARPRe¥Úd”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

180 cÚ¡ 
şick_‘h”
 *
e
 = (cÚ¡ click_‘h” *è
p
->
	`d©a
();

181 cÚ¡ 
şick_‘h”_¬p
 *
—
 = (cÚ¡ click_‘h”_¬°*è(
e
 + 1);

182 
Pack‘
 *
q
 = 0;

183 ià(
p
->
	`Ëngth
(è>ğ(*
e
è+ (
şick_‘h”_¬p
)

184 && 
e
->
‘h”_ty³
 =ğ
	`htÚs
(
ETHERTYPE_ARP
)

185 && 
—
->
—_hdr
.
¬_hrd
 =ğ
	`htÚs
(
ARPHRD_ETHER
)

186 && 
—
->
—_hdr
.
¬_´o
 =ğ
	`htÚs
(
ETHERTYPE_IP
)

187 && 
—
->
—_hdr
.
¬_İ
 =ğ
	`htÚs
(
ARPOP_REQUEST
)) {

188 
IPAdd»ss
 
	`a
((cÚ¡ *è
—
->
¬p_a
);

189 ià(cÚ¡ 
Eth”Add»ss
 *
’a
 = 
	`lookup
(
a
))

190 
q
 = 
	`make_»¥Ú£
(
—
->
¬p_sha
,ƒa->
¬p_¥a
, 
’a
->
	`d©a
(),ƒa->
¬p_a
, 
p
);

192 ià(
q
)

193 
p
->
	`kl
();

195 
	`checked_ouut_push
(1, 
p
);

196  
q
;

197 
	}
}

199 
SŒšg


200 
	gARPRe¥Úd”
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *)

202 
ARPRe¥Úd”
 *
¬
 = 
¡©ic_ÿ¡
<ARPRe¥Úd” *>(
e
);

203 
SŒšgAccum
 
§
;

204 
i
 = 0; i < 
¬
->
_v
.
	`size
(); i++)

205 
§
 << 
¬
->
_v
[
i
].
d¡
.
	`uÅ¬£_w™h_mask
×r->_v[i].
mask
è<< ' ' <<‡r->_v[i].
’a
 << '\n';

206  
§
.
	`ke_¡ršg
();

207 
	}
}

210 
	gARPRe¥Úd”
::
	$lookup_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, cÚ¡ 
HªdËr
 *, 
E¼ÜHªdËr
 *
”rh
)

212 
ARPRe¥Úd”
 *
¬
 = 
¡©ic_ÿ¡
<ARPRe¥Úd” *>(
e
);

213 
IPAdd»ss
 
a
;

214 ià(
	`IPAdd»ssArg
().
	`·r£
(
¡r
, 
a
, 
¬
)) {

215 ià(cÚ¡ 
Eth”Add»ss
 *
’a
 = 
¬
->
	`lookup
(
a
))

216 
¡r
 = 
’a
->
	`uÅ¬£
();

218 
¡r
 = 
	`SŒšg
();

221  
”rh
->
	`”rÜ
("expected IP‡ddress");

222 
	}
}

225 
	gARPRe¥Úd”
::
	$add_hªdËr
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

227 
ARPRe¥Úd”
 *
¬
 = 
¡©ic_ÿ¡
<ARPRe¥Úd” *>(
e
);

228 
VeùÜ
<
EÁry
> 
	`v
(
¬
->
_v
);

229 ià(
¬
->
	`add
(
v
, 
s
, 
”rh
) >= 0) {

230 
	`nÜm®ize
(
v
, 
çl£
, 0);

231 
¬
->
_v
.
	`sw­
(
v
);

235 
	}
}

238 
	gARPRe¥Úd”
::
	$»move_hªdËr
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

240 
ARPRe¥Úd”
 *
¬
 = 
¡©ic_ÿ¡
<ARPRe¥Úd” *>(
e
);

241 
IPAdd»ss
 
addr
, 
mask
;

242 ià(!
	`IPP»fixArg
(
Œue
).
	`·r£
(
s
, 
addr
, 
mask
, 
¬
))

243  
”rh
->
	`”rÜ
("expected IP/MASK");

244 
addr
 &ğ
mask
;

245 
VeùÜ
<
EÁry
>::
™”©Ü
 
™
 = 
¬
->
_v
.
	`begš
(); iˆ!ğ¬->_v.
	`’d
(); ++it)

246 ià(
™
->
d¡
 =ğ
addr
 && it->
mask
 == mask) {

247 
¬
->
_v
.
	`”a£
(
™
);

250  
”rh
->
	`”rÜ
("% nÙ found", 
addr
.
	`uÅ¬£_w™h_mask
(
mask
).
	`c_¡r
());

251 
	}
}

255 
	gARPRe¥Úd”
::
	$add_hªdËrs
()

257 
	`add_»ad_hªdËr
("bË", 
»ad_hªdËr
, 0);

258 
	`£t_hªdËr
("lookup", 
HªdËr
::
OP_READ
 | HªdËr::
READ_PARAM
, 
lookup_hªdËr
);

259 
	`add_wr™e_hªdËr
("add", 
add_hªdËr
, 0);

260 
	`add_wr™e_hªdËr
("»move", 
»move_hªdËr
, 0);

261 
	}
}

263 
	$EXPORT_ELEMENT
(
ARPRe¥Úd”
)

264 
CLICK_ENDDECLS


	@ethernet/arpresponder.hh

1 #iâdeà
CLICK_ARPRESPONDER_HH


2 
	#CLICK_ARPRESPONDER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/add»ss.hh
>

6 
	~<şick/veùÜ.hh
>

7 
CLICK_DECLS


77 şas 
	cARPRe¥Úd”
 : 
public
 
EËm’t
 {…ublic:

79 
	$ARPRe¥Úd”
(è
CLICK_COLD
;

80 ~
	$ARPRe¥Úd”
(è
CLICK_COLD
;

82 cÚ¡ *
	$şass_Çme
() const {  "ARPResponder"; }

83 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

84 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

86 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

87 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

88 
	$add_hªdËrs
(è
CLICK_COLD
;

90 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

92 
Pack‘
 *
	`make_»¥Ú£
(cÚ¡ 
ušt8_t
 
rg‘_‘h
[6],

93 cÚ¡ 
ušt8_t
 
rg‘_
[4],

94 cÚ¡ 
ušt8_t
 
¤c_‘h
[6],

95 cÚ¡ 
ušt8_t
 
¤c_
[4],

96 cÚ¡ 
Pack‘
 *
p
 = 0);

98 cÚ¡ 
Eth”Add»ss
 *
	$lookup
(
IPAdd»ss
 
addr
) const {

99 
VeùÜ
<
EÁry
>::
cÚ¡_™”©Ü
 
’d
 = 
_v
.
	`’d
();

100 
VeùÜ
<
EÁry
>::
cÚ¡_™”©Ü
 
™
 = 
_v
.
	`begš
(); iˆ!ğ
’d
; ++it)

101 ià((
addr
 & 
™
->
mask
è=ğ™->
d¡
)

102  &
™
->
’a
;

104 
	}
}

106 
boŞ
 
	$lookup
(
IPAdd»ss
 
addr
, 
Eth”Add»ss
 &
»suÉ
) const {

107 ià(cÚ¡ 
Eth”Add»ss
 *
x
 = 
	`lookup
(
addr
)) {

108 
»suÉ
 = *
x
;

109  
Œue
;

111  
çl£
;

112 
	}
}

114 
	g´iv©e
:

116 
	sEÁry
 {

117 
IPAdd»ss
 
d¡
;

118 
IPAdd»ss
 
	gmask
;

119 
Eth”Add»ss
 
	g’a
;

121 
	gVeùÜ
<
	gEÁry
> 
	g_v
;

123 
’Œy_com·»
(cÚ¡ *
a
, cÚ¡ *
b
, *
u£r_d©a
);

124 
add
(
VeùÜ
<
EÁry
> &
v
, cÚ¡ 
SŒšg
 &
¬g
, 
E¼ÜHªdËr
 *
”rh
) const;

125 
nÜm®ize
(
VeùÜ
<
EÁry
> &
v
, 
boŞ
 
w¬n
, 
E¼ÜHªdËr
 *
”rh
);

127 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

128 
	`lookup_hªdËr
(
İ
, 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
);

129 
	`add_hªdËr
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
);

130 
	`»move_hªdËr
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
);

132 
	}
};

134 
	gCLICK_ENDDECLS


	@ethernet/arptable.cc

20 
	~<şick/cÚfig.h
>

21 
	~"¬pqu”›r.hh
"

22 
	~<şickÃt/‘h”.h
>

23 
	~<şick/‘h”add»ss.hh
>

24 
	~<şick/add»ss.hh
>

25 
	~<şick/¬gs.hh
>

26 
	~<şick/b™veùÜ.hh
>

27 
	~<şick/¡¿ccum.hh
>

28 
	~<şick/rou‹r.hh
>

29 
	~<şick/”rÜ.hh
>

30 
	~<şick/glue.hh
>

31 
CLICK_DECLS


33 
	gARPTabË
::
	$ARPTabË
()

34 : 
	`_’Œy_ÿ·c™y
(0), 
	`_·ck‘_ÿ·c™y
(2048), 
	`_’Œy_·ck‘_ÿ·c™y
(0), 
	`_ÿ·c™y_¦im_çùÜ
(2), 
	$_expœe_tim”
(
this
)

36 
_’Œy_couÁ
 = 
_·ck‘_couÁ
 = 
_drİs
 = 0;

37 
	}
}

39 
	gARPTabË
::~
	$ARPTabË
()

41 
	}
}

44 
ARPTabË
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

46 
Time¡amp
 
timeout
(300);

47 ià(
Args
(
cÚf
, 
this
, 
”rh
)

48 .
»ad
("CAPACITY", 
_·ck‘_ÿ·c™y
)

49 .
»ad
("ENTRY_CAPACITY", 
_’Œy_ÿ·c™y
)

50 .
»ad
("ENTRY_PACKET_CAPACITY", 
_’Œy_·ck‘_ÿ·c™y
)

51 .
»ad
("CAPACITY_SLIM_FACTOR", 
_ÿ·c™y_¦im_çùÜ
)

52 .
»ad
("TIMEOUT", 
timeout
)

53 .
com¶‘e
() < 0)

55 ià(
	g_ÿ·c™y_¦im_çùÜ
 == 0)

56  
”rh
->
”rÜ
("CAPACITY_SLIM_FACTOR cannot be zero");

57 
£t_timeout
(
timeout
);

58 ià(
	g_timeout_j
) {

59 
	g_expœe_tim”
.
š™Ÿlize
(
this
);

60 
	g_expœe_tim”
.
scheduË_aá”_£c
(
_timeout_j
 / 
CLICK_HZ
);

66 
	gARPTabË
::
	$ş—nup
(
CËªupSge
)

68 
	`ş—r
();

69 
	}
}

72 
	gARPTabË
::
	$ş—r
()

75 
TabË
::
™”©Ü
 
™
 = 
_bË
.
	`begš
(); it; ) {

76 
ARPEÁry
 *
«
 = 
_bË
.
	`”a£
(
™
);

77 
Pack‘
 *
p
 = 
«
->
_h—d
) {

78 
«
->
_h—d
 = 
p
->
	`Ãxt
();

79 
p
->
	`kl
();

80 ++
_drİs
;

82 
_®loc
.
	`d—Îoÿ‹
(
«
);

84 
_’Œy_couÁ
 = 
_·ck‘_couÁ
 = 0;

85 
_age
.
	`__ş—r
();

86 
	}
}

89 
	gARPTabË
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *
”rh
)

91 
ARPTabË
 *
¬±
 = (ARPTabË *)
e
->
	`ÿ¡
("ARPTable");

92 ià(!
¬±
)

94 ià(
_bË
.
	`size
() > 0) {

95 
”rh
->
	`”rÜ
("lateake_state");

99 
_bË
.
	`sw­
(
¬±
->_table);

100 
_age
.
	`sw­
(
¬±
->_age);

101 
_’Œy_couÁ
 = 
¬±
->_entry_count;

102 
_·ck‘_couÁ
 = 
¬±
->_packet_count;

103 
_drİs
 = 
¬±
->_drops;

104 
_®loc
.
	`sw­
(
¬±
->_alloc);

106 
¬±
->
_’Œy_couÁ
 = 0;

107 
¬±
->
_·ck‘_couÁ
 = 0;

108 
	}
}

111 
	gARPTabË
::
	$¦im
(
şick_jiff›s_t
 
now
)

113 
ARPEÁry
 *
«
;

116 (
«
 = 
_age
.
	`äÚt
())

117 && (
«
->
	`expœed
(
now
, 
_timeout_j
)

118 || (
_’Œy_ÿ·c™y
 && 
_’Œy_couÁ
 > _entry_capacity))) {

119 
_bË
.
	`”a£
(
«
->
_
);

120 
_age
.
	`pİ_äÚt
();

122 
Pack‘
 *
p
 = 
«
->
_h—d
) {

123 
«
->
_h—d
 = 
p
->
	`Ãxt
();

124 
p
->
	`kl
();

125 --
_·ck‘_couÁ
;

126 ++
_drİs
;

129 
_®loc
.
	`d—Îoÿ‹
(
«
);

130 --
_’Œy_couÁ
;

134 ià(
_·ck‘_ÿ·c™y
 && 
_·ck‘_couÁ
 > _packet_capacity) {

135 
ušt32_t
 
¦im_ÿ·c™y
 = 
_·ck‘_ÿ·c™y
 - _·ck‘_ÿ·c™y / 
_ÿ·c™y_¦im_çùÜ
;

136 ià(
¦im_ÿ·c™y
 == 0)

137 
¦im_ÿ·c™y
 = 1;

138 
_·ck‘_couÁ
 > 
¦im_ÿ·c™y
) {

139 
«
->
_h—d
 && 
_·ck‘_couÁ
 > 
¦im_ÿ·c™y
) {

140 
Pack‘
 *
p
 = 
«
->
_h—d
;

141 ià(!(
«
->
_h—d
 = 
p
->
	`Ãxt
()))

142 
«
->
_
 = 0;

143 
p
->
	`kl
();

144 --
_·ck‘_couÁ
;

145 --
«
->
_’Œy_·ck‘_couÁ
;

146 ++
_drİs
;

148 
«
 =‡e->
_age_lšk
.
	`Ãxt
();

151 
	}
}

154 
	gARPTabË
::
	$run_tim”
(
Tim”
 *
tim”
)

158 
_lock
.
	`acquœe_wr™e
();

159 
	`¦im
(
	`şick_jiff›s
());

160 
_lock
.
	`»Ëa£_wr™e
();

161 ià(
_timeout_j
)

162 
tim”
->
	`scheduË_aá”_£c
(
_timeout_j
 / 
CLICK_HZ
 + 1);

163 
	}
}

165 
	gARPTabË
::
ARPEÁry
 *

166 
ARPTabË
::
	$’su»
(
IPAdd»ss
 

, 
şick_jiff›s_t
 
now
)

168 
_lock
.
	`acquœe_wr™e
();

169 
TabË
::
™”©Ü
 
™
 = 
_bË
.
	`fšd
(

);

170 ià(!
™
) {

171 *
x
 = 
_®loc
.
	`®loÿ‹
();

172 ià(!
x
) {

173 
_lock
.
	`»Ëa£_wr™e
();

177 ++
_’Œy_couÁ
;

178 ià(
_’Œy_ÿ·c™y
 && 
_’Œy_couÁ
 > _entry_capacity)

179 
	`¦im
(
now
);

181 
ARPEÁry
 *
«
 = 
	`Ãw
(
x
è
	`ARPEÁry
(

);

182 
«
->
_live_©_j
 = 
now
;

183 
«
->
_pŞËd_©_j
 =‡e->
_live_©_j
 - 
CLICK_HZ
;

184 
_bË
.
	`£t
(
™
, 
«
);

186 
_age
.
	`push_back
(
«
);

188  
™
.
	`g‘
();

189 
	}
}

192 
	gARPTabË
::
	$š£¹
(
IPAdd»ss
 

, cÚ¡ 
Eth”Add»ss
 &
‘h
, 
Pack‘
 **
h—d
)

194 
şick_jiff›s_t
 
now
 = 
	`şick_jiff›s
();

195 
ARPEÁry
 *
«
 = 
	`’su»
(

, 
now
);

196 ià(!
«
)

197  -
ENOMEM
;

199 
«
->
_‘h
 = 
‘h
;

200 
«
->
_known
 = !
‘h
.
	`is_brßdÿ¡
();

202 
«
->
_live_©_j
 = 
now
;

203 
«
->
_num_pŞls_sšû_»¶y
 = 0;

204 
«
->
_pŞËd_©_j
 =‡e->
_live_©_j
 - 
CLICK_HZ
;

206 ià(
«
->
_age_lšk
.
	`Ãxt
()) {

207 
_age
.
	`”a£
(
«
);

208 
_age
.
	`push_back
(
«
);

211 ià(
h—d
) {

212 *
h—d
 = 
«
->
_h—d
;

213 
«
->
_h—d
 =‡e->
_
 = 0;

214 
_·ck‘_couÁ
 -ğ
«
->
_’Œy_·ck‘_couÁ
;

215 
«
->
_’Œy_·ck‘_couÁ
 = 0;

218 
_bË
.
	`b®ªû
();

219 
_lock
.
	`»Ëa£_wr™e
();

221 
	}
}

224 
	gARPTabË
::
	$­³nd_qu”y
(
IPAdd»ss
 

, 
Pack‘
 *
p
)

226 
şick_jiff›s_t
 
now
 = 
	`şick_jiff›s
();

227 
ARPEÁry
 *
«
 = 
	`’su»
(

, 
now
);

228 ià(!
«
)

229  -
ENOMEM
;

231 ià(
«
->
	`known
(
now
, 
_timeout_j
)) {

232 
_lock
.
	`»Ëa£_wr™e
();

233  -
EAGAIN
;

240 ià(
_timeout_j
) {

241 
şick_jiff›s_t
 
live_©_j_mš
 = 
now
 - 
_timeout_j
;

242 ià(
	`şick_jiff›s_Ëss
(
«
->
_live_©_j
, 
live_©_j_mš
)) {

243 
«
->
_live_©_j
 = 
live_©_j_mš
;

246 
ARPEÁry
 *
«_Ãxt
 = 
«
->
_age_lšk
.
	`Ãxt
(), *
Ãxt
 =‡e_next;

247 
Ãxt
 && 
	`şick_jiff›s_Ëss
Òext->
_live_©_j
, 
«
->_live_at_j))

248 
Ãxt
 =‚ext->
_age_lšk
.
	`Ãxt
();

249 ià(
«_Ãxt
 !ğ
Ãxt
) {

250 
_age
.
	`”a£
(
«
);

251 
_age
.
	`š£¹
(
Ãxt
 , 
«
);

256 ià(
_’Œy_·ck‘_ÿ·c™y
 && 
«
->
_’Œy_·ck‘_couÁ
 >= _entry_packet_capacity) {

257 
_drİs
++;

258 
_lock
.
	`»Ëa£_wr™e
();

259  -
ENOMEM
;

262 ++
_·ck‘_couÁ
;

263 ià(
_·ck‘_ÿ·c™y
 && 
_·ck‘_couÁ
 > _packet_capacity)

264 
	`¦im
(
now
);

266 ià(
«
->
_
)

267 
«
->
_
->
	`£t_Ãxt
(
p
);

269 
«
->
_h—d
 = 
p
;

270 
«
->
_
 = 
p
;

271 
p
->
	`£t_Ãxt
(0);

272 ++
«
->
_’Œy_·ck‘_couÁ
;

274 
r
;

275 ià(
«
->
	`®low_pŞl
(
now
)) {

276 
«
->
	`m¬k_pŞl
(
now
);

277 
r
 = 1;

279 
r
 = 0;

281 
_bË
.
	`b®ªû
();

282 
_lock
.
	`»Ëa£_wr™e
();

283  
r
;

284 
	}
}

286 
IPAdd»ss


287 
	gARPTabË
::
	$»v”£_lookup
(cÚ¡ 
Eth”Add»ss
 &
‘h
)

289 
_lock
.
	`acquœe_»ad
();

291 
IPAdd»ss
 

;

292 
TabË
::
™”©Ü
 
™
 = 
_bË
.
	`begš
(); it; ++it)

293 ià(
™
->
_‘h
 =ğ
‘h
) {

294 

 = 
™
->
_
;

298 
_lock
.
	`»Ëa£_»ad
();

299  

;

300 
	}
}

302 
SŒšg


303 
	gARPTabË
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
)

305 
ARPTabË
 *
¬±
 = (ARPTabË *è
e
;

306 
SŒšgAccum
 
§
;

307 
şick_jiff›s_t
 
now
 = 
	`şick_jiff›s
();

308 
»š‹½»t_ÿ¡
<
ušŒ_t
>(
u£r_d©a
)) {

309 
h_bË
:

310 
ARPEÁry
 *
«
 = 
¬±
->
_age
.
	`äÚt
();‡e;‡ğ«->
_age_lšk
.
	`Ãxt
()) {

311 
ok
 = 
«
->
	`known
(
now
, 
¬±
->
_timeout_j
);

312 
§
 << 
«
->
_
 << ' ' << 
ok
 << ' ' <<‡e->
_‘h
 << ' '

313 << 
Time¡amp
::
	`make_jiff›s
(
now
 - 
«
->
_live_©_j
) << '\n';

317  
§
.
	`ke_¡ršg
();

318 
	}
}

321 
	gARPTabË
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
u£r_d©a
, 
E¼ÜHªdËr
 *
”rh
)

323 
ARPTabË
 *
¬±
 = (ARPTabË *è
e
;

324 
»š‹½»t_ÿ¡
<
ušŒ_t
>(
u£r_d©a
)) {

325 
h_š£¹
: {

326 
IPAdd»ss
 

;

327 
Eth”Add»ss
 
‘h
;

328 ià(
	`Args
(
¬±
, 
”rh
).
	`push_back_wÜds
(
¡r
)

329 .
	`»ad_mp
("IP", 

)

330 .
	`»ad_mp
("ETH", 
‘h
)

331 .
	`com¶‘e
() < 0)

333 
¬±
->
	`š£¹
(

, 
‘h
);

336 
h_d–‘e
: {

337 
IPAdd»ss
 

;

338 ià(
	`Args
(
¬±
, 
”rh
).
	`push_back_wÜds
(
¡r
)

339 .
	`»ad_mp
("IP", 

)

340 .
	`com¶‘e
() < 0)

342 
¬±
->
	`š£¹
(

, 
Eth”Add»ss
::
	`make_brßdÿ¡
());

345 
h_ş—r
:

346 
¬±
->
	`ş—r
();

351 
	}
}

354 
	gARPTabË
::
	$add_hªdËrs
()

356 
	`add_»ad_hªdËr
("bË", 
»ad_hªdËr
, 
h_bË
);

357 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

358 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
OP_READ
, &
_’Œy_couÁ
);

359 
	`add_d©a_hªdËrs
("Ëngth", 
HªdËr
::
OP_READ
, &
_·ck‘_couÁ
);

360 
	`add_wr™e_hªdËr
("š£¹", 
wr™e_hªdËr
, 
h_š£¹
);

361 
	`add_wr™e_hªdËr
("d–‘e", 
wr™e_hªdËr
, 
h_d–‘e
);

362 
	`add_wr™e_hªdËr
("ş—r", 
wr™e_hªdËr
, 
h_ş—r
);

363 
	}
}

365 
CLICK_ENDDECLS


366 
	$EXPORT_ELEMENT
(
ARPTabË
)

367 
	`ELEMENT_MT_SAFE
(
ARPTabË
)

	@ethernet/arptable.hh

1 #iâdeà
CLICK_ARPTABLE_HH


2 
	#CLICK_ARPTABLE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/hashcÚš”.hh
>

6 
	~<şick/hash®loÿtÜ.hh
>

7 
	~<şick/sync.hh
>

8 
	~<şick/tim”.hh
>

9 
	~<şick/li¡.hh
>

10 
CLICK_DECLS


96 şas 
	cARPTabË
 : 
public
 
EËm’t
 {…ublic:

98 
	$ARPTabË
(è
CLICK_COLD
;

99 ~
	$ARPTabË
(è
CLICK_COLD
;

101 cÚ¡ *
	$şass_Çme
() const {  "ARPTable"; }

103 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

104 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

105 
ke_¡©e
(
EËm’t
 *, 
E¼ÜHªdËr
 *);

106 
	$add_hªdËrs
(è
CLICK_COLD
;

107 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

109 
	`lookup
(
IPAdd»ss
 

, 
Eth”Add»ss
 *
‘h
, 
ušt32_t
 
pŞl_timeout_j
);

110 
Eth”Add»ss
 
	`lookup
(
IPAdd»ss
 

);

111 
IPAdd»ss
 
	`»v”£_lookup
(cÚ¡ 
Eth”Add»ss
 &
‘h
);

112 
	`š£¹
(
IPAdd»ss
 

, cÚ¡ 
Eth”Add»ss
 &
’
, 
Pack‘
 **
h—d
 = 0);

113 
	`­³nd_qu”y
(
IPAdd»ss
 

, 
Pack‘
 *
p
);

114 
	`ş—r
();

116 
ušt32_t
 
	$ÿ·c™y
() const {

117  
_·ck‘_ÿ·c™y
;

118 
	}
}

119 
	$£t_ÿ·c™y
(
ušt32_t
 
ÿ·c™y
) {

120 
_·ck‘_ÿ·c™y
 = 
ÿ·c™y
;

121 
	}
}

122 
ušt32_t
 
	$’Œy_ÿ·c™y
() const {

123  
_’Œy_ÿ·c™y
;

124 
	}
}

125 
	$£t_’Œy_ÿ·c™y
(
ušt32_t
 
’Œy_ÿ·c™y
) {

126 
_’Œy_ÿ·c™y
 = 
’Œy_ÿ·c™y
;

127 
	}
}

128 
ušt32_t
 
	$’Œy_·ck‘_ÿ·c™y
() const {

129  
_’Œy_·ck‘_ÿ·c™y
;

130 
	}
}

131 
	$£t_’Œy_·ck‘_ÿ·c™y
(
ušt32_t
 
’Œy_·ck‘_ÿ·c™y
) {

132 
_’Œy_·ck‘_ÿ·c™y
 = 
’Œy_·ck‘_ÿ·c™y
;

133 
	}
}

134 
ušt32_t
 
	$ÿ·c™y_¦im_çùÜ
() const {

135  
_ÿ·c™y_¦im_çùÜ
;

136 
	}
}

137 
	$£t_ÿ·c™y_¦im_çùÜ
(
ušt32_t
 
ÿ·c™y_¦im_çùÜ
) {

138 
	`as£¹
(
ÿ·c™y_¦im_çùÜ
 != 0);

139 
_ÿ·c™y_¦im_çùÜ
 = 
ÿ·c™y_¦im_çùÜ
;

140 
	}
}

141 
Time¡amp
 
	$timeout
() const {

142  
Time¡amp
::
	`make_jiff›s
((
şick_jiff›s_t
è
_timeout_j
);

143 
	}
}

144 
	$£t_timeout
(cÚ¡ 
Time¡amp
 &
timeout
) {

145 ià((
ušt32_t
è
timeout
.
	`£c
(è>ğ(ušt32_tè0xFFFFFFFFU / 
CLICK_HZ
)

146 
_timeout_j
 = 0;

148 
_timeout_j
 = 
timeout
.
	`jiff›s
();

149 
	}
}

151 
ušt32_t
 
	$drİs
() const {

152  
_drİs
;

153 
	}
}

154 
ušt32_t
 
	$couÁ
() const {

155  
_’Œy_couÁ
;

156 
	}
}

157 
ušt32_t
 
	$Ëngth
() const {

158  
_·ck‘_couÁ
;

159 
	}
}

161 
run_tim”
(
Tim”
 *);

164 
	gh_bË
, 
	gh_š£¹
, 
	gh_d–‘e
, 
	gh_ş—r


166 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
è
CLICK_COLD
;

167 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
u£r_d©a
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

169 
	sARPEÁry
 {

170 
IPAdd»ss
 
_
;

171 
ARPEÁry
 *
_hashÃxt
;

172 
Eth”Add»ss
 
_‘h
;

173 
boŞ
 
_known
;

174 
ušt8_t
 
_num_pŞls_sšû_»¶y
;

175 
şick_jiff›s_t
 
_live_©_j
;

176 
şick_jiff›s_t
 
_pŞËd_©_j
;

177 
Pack‘
 *
_h—d
;

178 
Pack‘
 *
_
;

179 
ušt32_t
 
_’Œy_·ck‘_couÁ
;

180 
Li¡_memb”
<
ARPEÁry
> 
_age_lšk
;

181 
IPAdd»ss
 
	tkey_ty³
;

182 
IPAdd»ss
 
	tkey_cÚ¡_»ã»nû
;

183 
	`ARPEÁry
(
IPAdd»ss
 

)

184 : 
	`_
(

), 
	`_hashÃxt
(), 
	`_‘h
(
Eth”Add»ss
::
	`make_brßdÿ¡
()),

185 
	`_known
(
çl£
), 
	`_num_pŞls_sšû_»¶y
(0), 
	`_h—d
(), 
	`_
(), 
	`_’Œy_·ck‘_couÁ
(0) {

187 
key_cÚ¡_»ã»nû
 
	`hashkey
() const {

188  
_
;

190 
boŞ
 
	`expœed
(
şick_jiff›s_t
 
now
, 
ušt32_t
 
timeout_j
) const {

191  
	`şick_jiff›s_Ëss
(
_live_©_j
 + 
timeout_j
, 
now
)

192 && 
timeout_j
;

194 
boŞ
 
	`known
(
şick_jiff›s_t
 
now
, 
ušt32_t
 
timeout_j
) const {

195  
_known
 && !
	`expœed
(
now
, 
timeout_j
);

197 
boŞ
 
	`®low_pŞl
(
şick_jiff›s_t
 
now
) const {

198 
şick_jiff›s_t
 
th»sh_j
 = 
_pŞËd_©_j


199 + (
_num_pŞls_sšû_»¶y
 >ğ10 ? 
CLICK_HZ
 * 2 : CLICK_HZ / 10);

200  !
	`şick_jiff›s_Ëss
(
now
, 
th»sh_j
);

202 
	`m¬k_pŞl
(
şick_jiff›s_t
 
now
) {

203 
_pŞËd_©_j
 = 
now
;

204 ià(
_num_pŞls_sšû_»¶y
 < 255)

205 ++
_num_pŞls_sšû_»¶y
;

207 
	}
};

209 
	g´iv©e
:

211 
R—dWr™eLock
 
_lock
;

213 
	gHashCÚš”
<
	tARPEÁry
> 
	tTabË
;

214 
TabË
 
	g_bË
;

215 
	gLi¡
<
	tARPEÁry
, &ARPEÁry::
	t_age_lšk
> 
	tAgeLi¡
;

216 
AgeLi¡
 
	g_age
;

217 
©omic_ušt32_t
 
	g_’Œy_couÁ
;

218 
©omic_ušt32_t
 
	g_·ck‘_couÁ
;

219 
ušt32_t
 
	g_’Œy_ÿ·c™y
;

220 
ušt32_t
 
	g_·ck‘_ÿ·c™y
;

221 
ušt32_t
 
	g_’Œy_·ck‘_ÿ·c™y
;

222 
ušt32_t
 
	g_ÿ·c™y_¦im_çùÜ
;

223 
ušt32_t
 
	g_timeout_j
;

224 
©omic_ušt32_t
 
	g_drİs
;

225 
	gSizedHashAÎoÿtÜ
<(
	gARPEÁry
)> 
	g_®loc
;

226 
Tim”
 
	g_expœe_tim”
;

228 
ARPEÁry
 *
’su»
(
IPAdd»ss
 

, 
şick_jiff›s_t
 
now
);

229 
¦im
(
şick_jiff›s_t
 
now
);

233 
šlše
 

234 
	gARPTabË
::
	$lookup
(
IPAdd»ss
 

, 
Eth”Add»ss
 *
‘h
, 
ušt32_t
 
pŞl_timeout_j
)

236 
_lock
.
	`acquœe_»ad
();

237 
r
 = -1;

238 ià(
TabË
::
™”©Ü
 
™
 = 
_bË
.
	`fšd
(

)) {

239 
şick_jiff›s_t
 
now
 = 
	`şick_jiff›s
();

240 ià(
™
->
	`known
(
now
, 
_timeout_j
)) {

241 *
‘h
 = 
™
->
_‘h
;

242 ià(
pŞl_timeout_j


243 && !
	`şick_jiff›s_Ëss
(
now
, 
™
->
_live_©_j
 + 
pŞl_timeout_j
)

244 && 
™
->
	`®low_pŞl
(
now
)) {

245 
™
->
	`m¬k_pŞl
(
now
);

246 
r
 = 1;

248 
r
 = 0;

251 
_lock
.
	`»Ëa£_»ad
();

252  
r
;

253 
	}
}

255 
šlše
 
Eth”Add»ss


256 
	gARPTabË
::
	$lookup
(
IPAdd»ss
 

)

258 
Eth”Add»ss
 
‘h
;

259 ià(
	`lookup
(

, &
‘h
, 0) >= 0)

260  
‘h
;

262  
Eth”Add»ss
::
	`make_brßdÿ¡
();

263 
	}
}

265 
	gCLICK_ENDDECLS


	@ethernet/checkarpheader.cc

20 
	~<şick/cÚfig.h
>

21 
	~"check¬ph—d”.hh
"

22 
	~<şickÃt/‘h”.h
>

23 
	~<şick/glue.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/”rÜ.hh
>

27 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

28 
CLICK_DECLS


31 cÚ¡ * cÚ¡ 
	gCheckARPH—d”
::
»asÚ_‹xts
[
NREASONS
] = {

36 
	gCheckARPH—d”
::
	$CheckARPH—d”
()

37 : 
	$_»asÚ_drİs
(0)

39 
_drİs
 = 0;

40 
	}
}

42 
	gCheckARPH—d”
::~
	$CheckARPH—d”
()

44 
d–‘e
[] 
_»asÚ_drİs
;

45 
	}
}

48 
	gCheckARPH—d”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

50 
	g_off£t
 = 0;

51 
boŞ
 
	gv”bo£
 = 
çl£
;

52 
boŞ
 
	gd‘as
 = 
çl£
;

54 ià(
Args
(
cÚf
, 
this
, 
”rh
)

55 .
»ad_p
("OFFSET", 
_off£t
)

56 .
»ad
("VERBOSE", 
v”bo£
)

57 .
»ad
("DETAILS", 
d‘as
)

58 .
com¶‘e
() < 0)

61 
	g_v”bo£
 = 
v”bo£
;

62 ià(
	gd‘as
)

63 
	g_»asÚ_drİs
 = 
Ãw
 
©omic_ušt32_t
[
NREASONS
];

68 
Pack‘
 *

69 
	gCheckARPH—d”
::
	$drİ
(
R—sÚ
 
»asÚ
, 
Pack‘
 *
p
)

71 ià(
_drİs
 =ğ0 || 
_v”bo£
)

72 
	`şick_ch©‹r
("ARP h—d” check faed: %s", 
»asÚ_‹xts
[
»asÚ
]);

73 
_drİs
++;

75 ià(
_»asÚ_drİs
)

76 
_»asÚ_drİs
[
»asÚ
]++;

78 
	`checked_ouut_push
(1, 
p
);

80 
	}
}

82 
Pack‘
 *

83 
	gCheckARPH—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

85 cÚ¡ 
şick_¬p
 *
­
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_¬°*>(
p
->
	`d©a
(è+ 
_off£t
);

86 
¶’
 = 
p
->
	`Ëngth
(è- 
_off£t
;

87 
hËn
;

90 ià((è
¶’
 < (è(
şick_¬p
))

91  
	`drİ
(
MINISCULE_PACKET
, 
p
);

93 
hËn
 = (è(
şick_¬p
è+ 2*
­
->
¬_hÊ
 + 2*­->
¬_¶n
;

94 ià((è
¶’
 < (è
hËn
)

95  
	`drİ
(
BAD_LENGTH
, 
p
);

96 ià(
­
->
¬_hrd
 =ğ
	`htÚs
(
ARPHRD_ETHER
è&&‡p->
¬_hÊ
 != 6)

97  
	`drİ
(
BAD_HRD
, 
p
);

98 ià((
­
->
¬_´o
 =ğ
	`htÚs
(
ETHERTYPE_IP
è&&‡p->
¬_¶n
 != 4)

99 || (
­
->
¬_´o
 =ğ
	`htÚs
(
ETHERTYPE_IP6
è&&‡p->
¬_¶n
 != 16))

100  
	`drİ
(
BAD_PRO
, 
p
);

102 
p
->
	`£t_ÃtwÜk_h—d”
((cÚ¡ *è
­
, 
hËn
);

103  
p
;

104 
	}
}

106 
SŒšg


107 
	gCheckARPH—d”
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *)

109 
CheckARPH—d”
 *
c
 = 
»š‹½»t_ÿ¡
<CheckARPH—d” *>(
e
);

110 
SŒšgAccum
 
§
;

111 
i
 = 0; i < 
NREASONS
; i++)

112 
§
 << 
c
->
_»asÚ_drİs
[
i
] << '\t' << 
»asÚ_‹xts
[i] << '\n';

113  
§
.
	`ke_¡ršg
();

114 
	}
}

117 
	gCheckARPH—d”
::
	$add_hªdËrs
()

119 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

120 ià(
_»asÚ_drİs
)

121 
	`add_»ad_hªdËr
("drİ_d‘as", 
»ad_hªdËr
, 1);

122 
	}
}

124 
CLICK_ENDDECLS


125 
EXPORT_ELEMENT
(
CheckARPH—d”
)

	@ethernet/checkarpheader.hh

1 #iâdeà
CLICK_CHECKARPHEADER_HH


2 
	#CLICK_CHECKARPHEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/©omic.hh
>

5 
CLICK_DECLS


65 şas 
	cCheckARPH—d”
 : 
public
 
EËm’t
 {…ublic:

67 
	$CheckARPH—d”
(è
CLICK_COLD
;

68 ~
	$CheckARPH—d”
(è
CLICK_COLD
;

70 cÚ¡ *
	$şass_Çme
() const {  "CheckARPHeader"; }

71 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

72 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

74 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

75 
	$add_hªdËrs
(è
CLICK_COLD
;

77 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

79 
´iv©e
:

81 
_off£t
;

83 
boŞ
 
_v”bo£
 : 1;

85 
©omic_ušt32_t
 
_drİs
;

86 
©omic_ušt32_t
 *
_»asÚ_drİs
;

88 
	eR—sÚ
 {

89 
MINISCULE_PACKET
,

90 
BAD_LENGTH
,

91 
BAD_HRD
,

92 
BAD_PRO
,

93 
NREASONS


94 
	}
};

95 cÚ¡ * cÚ¡ 
	g»asÚ_‹xts
[
NREASONS
];

97 
Pack‘
 *
drİ
(
R—sÚ
, Packet *);

98 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

100 
	}
};

102 
	gCLICK_ENDDECLS


	@ethernet/ensureether.cc

18 
	~<şick/cÚfig.h
>

19 
	~"’su»‘h”.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
CLICK_DECLS


26 
	gEnsu»Eth”
::
	$Ensu»Eth”
()

28 
	}
}

30 
Ensu»Eth”
::~
	$Ensu»Eth”
()

32 
	}
}

35 
Ensu»Eth”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 
	g‘ht
 = 0x0800;

38 
mem£t
(&
_‘hh
.
‘h”_sho¡
, 1, 6);

39 
mem£t
(&
_‘hh
.
‘h”_dho¡
, 2, 6);

40 ià(
Args
(
cÚf
, 
this
, 
”rh
)

41 .
»ad_p
("ETHERTYPE", 
‘ht
)

42 .
»ad_p
("SRC", 
Eth”Add»ssArg
(), 
_‘hh
.
‘h”_sho¡
)

43 .
»ad_p
("DST", 
Eth”Add»ssArg
(), 
_‘hh
.
‘h”_dho¡
)

44 .
com¶‘e
() < 0)

46 ià(
	g‘ht
 > 0xFFFF)

47  
	g”rh
->
”rÜ
("argument 1 (Ethernetƒncapsulationype) must be <= 0xFFFF");

48 
	g_‘hh
.
	g‘h”_ty³
 = 
htÚs
(
‘ht
);

52 
Pack‘
 *

53 
	gEnsu»Eth”
::
	$smaùiÚ
(
Pack‘
 *
p
)

55 ià(!
p
->
	`has_ÃtwÜk_h—d”
(è||…->
	`_h—d”_off£t
() < 0)

56  
p
;

58 ià(
p
->
	`_h—d”_off£t
() == 14) {

60 cÚ¡ 
şick_‘h”
 *
‘hh
 = (cÚ¡ click_‘h” *)
p
->
	`d©a
();

61 ià(
‘hh
->
‘h”_ty³
 =ğ
	`htÚs
(
ETHERTYPE_IP
)

62 || 
‘hh
->
‘h”_ty³
 =ğ
	`htÚs
(
ETHERTYPE_IP6
))

63  
p
;

64 } ià(
p
->
	`_h—d”_off£t
(è=ğ0 &&…->
	`h—droom
() >= 14) {

66 cÚ¡ 
şick_‘h”
 *
‘hh
 = (cÚ¡ click_‘h” *)(
p
->
	`d©a
() - 14);

67 ià(
‘hh
->
‘h”_ty³
 =ğ
	`htÚs
(
ETHERTYPE_IP
)

68 || 
‘hh
->
‘h”_ty³
 =ğ
	`htÚs
(
ETHERTYPE_IP6
))

69  
p
->
	`nÚunique_push
(14);

73 
p
->
	`puÎ
Õ->
	`_h—d”_off£t
());

74 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`push
(14)) {

75 
	`memıy
(
q
->
	`d©a
(), &
_‘hh
, 14);

76  
q
;

79 
	}
}

82 
	gEnsu»Eth”
::
	$push
(, 
Pack‘
 *
p
)

84 ià(
Pack‘
 *
q
 = 
	`smaùiÚ
(
p
))

85 
	`ouut
(0).
	`push
(
q
);

86 
	}
}

88 
Pack‘
 *

89 
	gEnsu»Eth”
::
	$puÎ
()

91 ià(
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
())

92  
	`smaùiÚ
(
p
);

95 
	}
}

97 
CLICK_ENDDECLS


98 
EXPORT_ELEMENT
(
Ensu»Eth”
)

	@ethernet/ensureether.hh

1 #iâdeà
CLICK_ENSUREETHER_HH


2 
	#CLICK_ENSUREETHER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


37 şas 
	cEnsu»Eth”
 : 
public
 
EËm’t
 {…ublic:

39 
	$Ensu»Eth”
(è
CLICK_COLD
;

40 ~
	$Ensu»Eth”
(è
CLICK_COLD
;

42 cÚ¡ *
	$şass_Çme
() const {  "EnsureEther"; }

43 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

45 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

47 
Pack‘
 *
smaùiÚ
(Packet *);

48 
push
(, 
Pack‘
 *);

49 
Pack‘
 *
puÎ
();

51 
	g´iv©e
:

53 
şick_‘h”
 
_‘hh
;

57 
	gCLICK_ENDDECLS


	@ethernet/etherencap.cc

17 
	~<şick/cÚfig.h
>

18 
	~"‘h”’ÿp.hh
"

19 
	~<şick/‘h”add»ss.hh
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
CLICK_DECLS


25 
	gEth”Enÿp
::
	$Eth”Enÿp
()

27 
	}
}

29 
Eth”Enÿp
::~
	$Eth”Enÿp
()

31 
	}
}

34 
Eth”Enÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
ušt16_t
 
	g‘h”_ty³
;

37 
şick_‘h”
 
	g‘hh
;

38 ià(
Args
(
cÚf
, 
this
, 
”rh
)

39 .
»ad_mp
("ETHERTYPE", 
‘h”_ty³
)

40 .
»ad_mp
("SRC", 
Eth”Add»ssArg
(), 
‘hh
.
‘h”_sho¡
)

41 .
»ad_mp
("DST", 
Eth”Add»ssArg
(), 
‘hh
.
‘h”_dho¡
)

42 .
com¶‘e
() < 0)

44 
	g‘hh
.
	g‘h”_ty³
 = 
htÚs
(
‘h”_ty³
);

45 
	g_‘hh
 = 
‘hh
;

49 
Pack‘
 *

50 
	gEth”Enÿp
::
	$smaùiÚ
(
Pack‘
 *
p
)

52 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`push_mac_h—d”
(14)) {

53 
	`memıy
(
q
->
	`d©a
(), &
_‘hh
, 14);

54  
q
;

57 
	}
}

60 
	gEth”Enÿp
::
	$push
(, 
Pack‘
 *
p
)

62 ià(
Pack‘
 *
q
 = 
	`smaùiÚ
(
p
))

63 
	`ouut
(0).
	`push
(
q
);

64 
	}
}

66 
Pack‘
 *

67 
	gEth”Enÿp
::
	$puÎ
()

69 ià(
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
())

70  
	`smaùiÚ
(
p
);

73 
	}
}

76 
	gEth”Enÿp
::
	$add_hªdËrs
()

78 
	`add_d©a_hªdËrs
("¤c", 
HªdËr
::
h_»ad
, 
»š‹½»t_ÿ¡
<
Eth”Add»ss
 *>(&
_‘hh
.
‘h”_sho¡
));

79 
	`add_wr™e_hªdËr
("¤c", 
»cÚfigu»_keywÜd_hªdËr
, "1 SRC");

80 
	`add_d©a_hªdËrs
("d¡", 
HªdËr
::
h_»ad
, 
»š‹½»t_ÿ¡
<
Eth”Add»ss
 *>(&
_‘hh
.
‘h”_dho¡
));

81 
	`add_wr™e_hªdËr
("d¡", 
»cÚfigu»_keywÜd_hªdËr
, "2 DST");

82 
	`add_Ãt_Üd”_d©a_hªdËrs
("‘h”ty³", 
HªdËr
::
h_»ad
, &
_‘hh
.
‘h”_ty³
);

83 
	`add_wr™e_hªdËr
("‘h”ty³", 
»cÚfigu»_keywÜd_hªdËr
, "0 ETHERTYPE");

84 
	`add_Ãt_Üd”_d©a_hªdËrs
("‘ht", 
HªdËr
::
h_»ad
 | HªdËr::
h_d•»ÿ‹d
, &
_‘hh
.
‘h”_ty³
);

85 
	`add_wr™e_hªdËr
("‘ht", 
»cÚfigu»_keywÜd_hªdËr
, "0 ETHERTYPE");

86 
	}
}

88 
CLICK_ENDDECLS


89 
EXPORT_ELEMENT
(
Eth”Enÿp
)

	@ethernet/etherencap.hh

1 #iâdeà
CLICK_ETHERENCAP_HH


2 
	#CLICK_ETHERENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


49 şas 
	cEth”Enÿp
 : 
public
 
EËm’t
 {…ublic:

51 
	$Eth”Enÿp
(è
CLICK_COLD
;

52 ~
	$Eth”Enÿp
(è
CLICK_COLD
;

54 cÚ¡ *
	$şass_Çme
() const {  "EtherEncap"; }

55 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

57 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

58 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

59 
	$add_hªdËrs
(è
CLICK_COLD
;

61 
Pack‘
 *
	`smaùiÚ
(Packet *);

62 
	`push
(, 
Pack‘
 *);

63 
Pack‘
 *
	`puÎ
();

65 
´iv©e
:

67 
şick_‘h”
 
_‘hh
;

69 
	}
};

71 
	gCLICK_ENDDECLS


	@ethernet/ethermirror.cc

18 
	~<şick/cÚfig.h
>

19 
	~"‘h”mœrÜ.hh
"

20 
	~<şickÃt/‘h”.h
>

21 
CLICK_DECLS


23 
	gEth”MœrÜ
::
	$Eth”MœrÜ
()

25 
	}
}

27 
Eth”MœrÜ
::~
	$Eth”MœrÜ
()

29 
	}
}

31 
Pack‘
 *

32 
Eth”MœrÜ
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

34 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
()) {

35 
şick_‘h”
 *
‘hh
 = 
»š‹½»t_ÿ¡
<şick_‘h” *>(
q
->
	`d©a
());

36 
ušt8_t
 
tm·
[6];

37 
	`memıy
(
tm·
, 
‘hh
->
‘h”_dho¡
, 6);

38 
	`memıy
(
‘hh
->
‘h”_dho¡
,ƒthh->
‘h”_sho¡
, 6);

39 
	`memıy
(
‘hh
->
‘h”_sho¡
, 
tm·
, 6);

40  
q
;

43 
	}
}

45 
CLICK_ENDDECLS


46 
EXPORT_ELEMENT
(
Eth”MœrÜ
)

	@ethernet/ethermirror.hh

1 #iâdeà
CLICK_ETHERMIRROR_HH


2 
	#CLICK_ETHERMIRROR_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


17 şas 
	cEth”MœrÜ
 : 
public
 
EËm’t
 {…ublic:

19 
	$Eth”MœrÜ
(è
CLICK_COLD
;

20 ~
	$Eth”MœrÜ
(è
CLICK_COLD
;

22 cÚ¡ *
	$şass_Çme
() const {  "EtherMirror"; }

23 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

25 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

29 
	gCLICK_ENDDECLS


	@ethernet/etherpausesource.cc

18 
	~<şick/cÚfig.h
>

19 
	~"‘h”·u£sourû.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/‘h”add»ss.hh
>

22 
	~<şickÃt/‘h”.h
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/glue.hh
>

25 
CLICK_DECLS


27 cÚ¡ 
	gdeçuÉ_de¡š©iÚ
[6] = {

31 
	gEth”Pau£Sourû
::
	$Eth”Pau£Sourû
()

32 : 
	`_·ck‘
(0), 
	$_tim”
(
this
)

34 
	}
}

36 
	gEth”Pau£Sourû
::~
	$Eth”Pau£Sourû
()

38 
	}
}

41 
Eth”Pau£Sourû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

43 
Eth”Add»ss
 
	g¤c
, 
d¡
(
deçuÉ_de¡š©iÚ
);

44 
ušt16_t
 
	g·u£time
;

45 
	g_lim™
 = -1;

46 
	g_aùive
 = 
Œue
;

47 
	g_š‹rv®
 = 1000;

48 ià(
Args
(
cÚf
, 
this
, 
”rh
)

49 .
»ad_mp
("SRC", 
¤c
)

50 .
»ad_mp
("PAUSETIME", 
·u£time
)

51 .
»ad
("DST", 
d¡
)

52 .
»ad
("LIMIT", 
_lim™
)

53 .
»ad
("ACTIVE", 
_aùive
)

54 .
»ad
("INTERVAL", 
SecÚdsArg
(3), 
_š‹rv®
)

55 .
com¶‘e
() < 0)

59 
Wr™abËPack‘
 *
	gq
;

60 ià(!(
	gq
 = 
Pack‘
::
make
(64)))

61  
”rh
->
”rÜ
("ouˆoàmemÜy!"), -
	gENOMEM
;

63 
	gq
->
£t_mac_h—d”
(
q
->
d©a
(), (
şick_‘h”
));

64 
şick_‘h”
 *
	g‘hh
 = 
q
->
‘h”_h—d”
();

65 
memıy
(
‘hh
->
‘h”_dho¡
, &
d¡
, 6);

66 
memıy
(
‘hh
->
‘h”_sho¡
, &
¤c
, 6);

67 
	g‘hh
->
	g‘h”_ty³
 = 
htÚs
(
ETHERTYPE_MACCONTROL
);

69 
şick_‘h”_macùl
 *
	gemch
 = (şick_‘h”_macùÈ*è
q
->
ÃtwÜk_h—d”
();

70 
	gemch
->
	g‘h”_macùl_İcode
 = 
htÚs
(
ETHER_MACCTL_OP_PAUSE
);

71 
	gemch
->
	g‘h”_macùl_·¿m
 = 
htÚs
(
·u£time
);

72 
mem£t
(
emch
->
‘h”_macùl_»£rved
, 0, (emch->ether_macctl_reserved));

74 
	g_·ck‘
 = 
q
;

79 
	gEth”Pau£Sourû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

81 
_couÁ
 = 0;

82 
_tim”
.
	`š™Ÿlize
(
this
);

83 ià(
_lim™
 !ğ0 && 
_aùive
 && 
	`ouut_is_push
(0))

84 
_tim”
.
	`scheduË_aá”_m£c
(
_š‹rv®
);

86 
	}
}

89 
	gEth”Pau£Sourû
::
	$ş—nup
(
CËªupSge
)

91 ià(
_·ck‘
) {

92 
_·ck‘
->
	`kl
();

93 
_·ck‘
 = 0;

95 
	}
}

98 
	gEth”Pau£Sourû
::
	$run_tim”
(
Tim”
 *)

100 ià(
Pack‘
 *
p
 = 
_·ck‘
->
	`şÚe
()) {

101 ++
_couÁ
;

102 
	`ouut
(0).
	`push
(
p
);

104 ià(
_lim™
 < 0 || 
_couÁ
 < _limit)

105 
_tim”
.
	`»scheduË_aá”_m£c
(
_š‹rv®
);

106 
	}
}

108 
Pack‘
 *

109 
	gEth”Pau£Sourû
::
	$puÎ
()

111 ià(!
_aùive
 || (
_lim™
 >ğ0 && 
_couÁ
 >= _limit))

113 ià(
Pack‘
 *
p
 = 
_·ck‘
->
	`şÚe
()) {

114 ++
_couÁ
;

115  
p
;

118 
	}
}

120 
SŒšg


121 
	gEth”Pau£Sourû
::
	$»ad”
(
EËm’t
 *
e
, *
u£r_d©a
)

123 
Eth”Pau£Sourû
 *
•s
 = 
¡©ic_ÿ¡
<Eth”Pau£Sourû *>(
e
);

124 (
šŒ_t
è
u£r_d©a
) {

125 
h_¤c
:

126  
	`Eth”Add»ss
(
•s
->
_·ck‘
->
	`‘h”_h—d”
()->
‘h”_sho¡
).
	`uÅ¬£
();

127 
h_d¡
:

128  
	`Eth”Add»ss
(
•s
->
_·ck‘
->
	`‘h”_h—d”
()->
‘h”_dho¡
).
	`uÅ¬£
();

129 
h_·u£time
: {

130 cÚ¡ 
şick_‘h”_macùl
 *
emc
 = (cÚ¡ click_‘h”_macùÈ*è
•s
->
_·ck‘
->
	`ÃtwÜk_h—d”
();

131  
	`SŒšg
(
	`Áohs
(
emc
->
‘h”_macùl_·¿m
));

134  
	`SŒšg
();

136 
	}
}

139 
	gEth”Pau£Sourû
::
	$»wr™e_·ck‘
(cÚ¡ *
d©a
, 
ušt32_t
 
off£t
, ušt32_ˆ
size
, 
E¼ÜHªdËr
 *
”rh
)

141 ià(
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(64)) {

142 
	`memıy
(
q
->
	`d©a
(), 
_·ck‘
->data(), 64);

143 
	`memıy
(
q
->
	`d©a
(è+ 
off£t
, 
d©a
, 
size
);

144 
q
->
	`£t_mac_h—d”
(q->
	`d©a
(), (
şick_‘h”
));

145 
_·ck‘
->
	`kl
();

146 
_·ck‘
 = 
q
;

149  
”rh
->
	`”rÜ
("ouˆoàmemÜy!"), -
ENOMEM
;

150 
	}
}

153 
	gEth”Pau£Sourû
::
	$check_awake
()

155 ià(
	`ouut_is_push
(0è&& !
_tim”
.
	`scheduËd
(è&& 
_aùive
)

156 
_tim”
.
	`scheduË_now
();

157 
	}
}

160 
	gEth”Pau£Sourû
::
	$wr™”
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
u£r_d©a
, 
E¼ÜHªdËr
 *
”rh
)

162 
Eth”Pau£Sourû
 *
•s
 = 
¡©ic_ÿ¡
<Eth”Pau£Sourû *>(
e
);

163 (
šŒ_t
è
u£r_d©a
) {

164 
h_¤c
:

165 
h_d¡
: {

166 
Eth”Add»ss
 
a
;

167 ià(!
	`Eth”Add»ssArg
().
	`·r£
(
¡r
, 
a
, 
e
))

168  
”rh
->
	`”rÜ
("type mismatch");

169  
•s
->
	`»wr™e_·ck‘
(&
a
, ((
šŒ_t
è
u£r_d©a
 =ğ
h_¤c
 ? 
	`off£tof
(
şick_‘h”
, 
‘h”_sho¡
è: off£tof(şick_‘h”, 
‘h”_dho¡
)), 6, 
”rh
);

171 
h_·u£time
: {

172 
ušt32_t
 
x
;

173 ià(!
	`IÁArg
().
	`·r£
(
¡r
, 
x
) || x > 0xFFFF)

174  
”rh
->
	`”rÜ
("type mismatch");

175 
ušt16_t
 
·¿m
 = 
	`htÚs
((ušt16_tè
x
);

176  
•s
->
	`»wr™e_·ck‘
(&
·¿m
, (
şick_‘h”
è+ 
	`off£tof
(
şick_‘h”_macùl
, 
‘h”_macùl_·¿m
), 2, 
”rh
);

178 
h_lim™
:

179 ià(!
	`IÁArg
().
	`·r£
(
¡r
, 
•s
->
_lim™
))

180  
”rh
->
	`”rÜ
("type mismatch");

181 
•s
->
	`check_awake
();

183 
h_aùive
:

184 ià(!
	`BoŞArg
().
	`·r£
(
¡r
, 
•s
->
_aùive
))

185  
”rh
->
	`”rÜ
("type mismatch");

186 
•s
->
	`check_awake
();

188 
h_»£t_couÁs
:

189 
•s
->
_couÁ
 = 0;

190 
•s
->
	`check_awake
();

195 
	}
}

198 
	gEth”Pau£Sourû
::
	$add_hªdËrs
()

200 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
OP_READ
, &
_couÁ
);

201 
	`add_d©a_hªdËrs
("lim™", 
HªdËr
::
OP_READ
, &
_lim™
);

202 
	`add_wr™e_hªdËr
("lim™", 
wr™”
, 
h_lim™
);

203 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
OP_READ
 | HªdËr::
CHECKBOX
, &
_aùive
);

204 
	`add_wr™e_hªdËr
("aùive", 
wr™”
, 
h_aùive
);

205 
	`add_»ad_hªdËr
("¤c", 
»ad”
, 
h_¤c
);

206 
	`add_wr™e_hªdËr
("¤c", 
wr™”
, 
h_¤c
);

207 
	`add_»ad_hªdËr
("d¡", 
»ad”
, 
h_d¡
);

208 
	`add_wr™e_hªdËr
("d¡", 
wr™”
, 
h_d¡
);

209 
	`add_»ad_hªdËr
("·u£time", 
»ad”
, 
h_·u£time
);

210 
	`add_wr™e_hªdËr
("·u£time", 
wr™”
, 
h_·u£time
);

211 
	`add_wr™e_hªdËr
("»£t_couÁs", 
wr™”
, 
h_»£t_couÁs
);

212 
	}
}

214 
CLICK_ENDDECLS


215 
EXPORT_ELEMENT
(
Eth”Pau£Sourû
)

	@ethernet/etherpausesource.hh

1 #iâdeà
CLICK_ETHERPAUSESOURCE_HH


2 
	#CLICK_ETHERPAUSESOURCE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tim”.hh
>

5 
CLICK_DECLS


72 şas 
	cEth”Pau£Sourû
 : 
public
 
EËm’t
 {…ublic:

74 cÚ¡ 
NO_LIMIT
 = 0xFFFFFFFFU;

76 
	$Eth”Pau£Sourû
(è
CLICK_COLD
;

77 ~
	$Eth”Pau£Sourû
(è
CLICK_COLD
;

79 cÚ¡ *
	$şass_Çme
() const {  "EtherPauseSource"; }

80 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

82 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

83 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

84 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

85 
	$add_hªdËrs
(è
CLICK_COLD
;

87 
	`run_tim”
(
Tim”
 *);

88 
Pack‘
 *
	`puÎ
();

90 
´iv©e
:

92 
_couÁ
;

93 
_lim™
;

94 
boŞ
 
_aùive
;

95 
ušt32_t
 
_š‹rv®
;

96 
Pack‘
 *
_·ck‘
;

97 
Tim”
 
_tim”
;

99 ’um { 
h_lim™
, 
h_aùive
, 
h_¤c
, 
h_d¡
, 
h_·u£time
, 
h_»£t_couÁs
 
	}
};

100 
»wr™e_·ck‘
(cÚ¡ *
d©a
, 
ušt32_t
 
off£t
, ušt32_ˆ
size
, 
E¼ÜHªdËr
 *
”rh
);

101 
check_awake
();

102 
SŒšg
 
»ad”
(
EËm’t
 *
e
, *
u£r_d©a
);

103 
wr™”
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
u£r_d©a
, 
E¼ÜHªdËr
 *
”rh
);

107 
	gCLICK_ENDDECLS


	@ethernet/etherrewrite.cc

18 
	~<şick/cÚfig.h
>

19 
	~"‘h”»wr™e.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
CLICK_DECLS


26 
	gEth”Rewr™e
::
	$Eth”Rewr™e
()

28 
	}
}

30 
Eth”Rewr™e
::~
	$Eth”Rewr™e
()

32 
	}
}

35 
Eth”Rewr™e
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 ià(
Args
(
cÚf
, 
this
, 
”rh
)

38 .
»ad_mp
("SRC", 
Eth”Add»ssArg
(), 
_‘hh
.
‘h”_sho¡
)

39 .
»ad_mp
("DST", 
Eth”Add»ssArg
(), 
_‘hh
.
‘h”_dho¡
)

40 .
com¶‘e
() < 0)

45 
šlše
 
Pack‘
 *

46 
	gEth”Rewr™e
::
	$smaùiÚ
(
Pack‘
 *
p
)

48 
Wr™abËPack‘
* 
q
 = 
p
->
	`uniqueify
();

49 ià(
q
) {

50 
	`memıy
(
q
->
	`mac_h—d”
(), &
_‘hh
, 12);

52  
q
;

53 
	}
}

56 
	gEth”Rewr™e
::
	$push
(, 
Pack‘
 *
p
)

58 ià(
Pack‘
 *
q
 = 
	`smaùiÚ
(
p
))

59 
	`ouut
(0).
	`push
(
q
);

60 
	}
}

62 
Pack‘
 *

63 
	gEth”Rewr™e
::
	$puÎ
()

65 ià(
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
())

66  
	`smaùiÚ
(
p
);

69 
	}
}

72 
	gEth”Rewr™e
::
	$add_hªdËrs
()

74 
	`add_d©a_hªdËrs
("¤c", 
HªdËr
::
h_»ad
, 
»š‹½»t_ÿ¡
<
Eth”Add»ss
 *>(&
_‘hh
.
‘h”_sho¡
));

75 
	`add_wr™e_hªdËr
("¤c", 
»cÚfigu»_keywÜd_hªdËr
, "1 SRC");

76 
	`add_d©a_hªdËrs
("d¡", 
HªdËr
::
h_»ad
, 
»š‹½»t_ÿ¡
<
Eth”Add»ss
 *>(&
_‘hh
.
‘h”_dho¡
));

77 
	`add_wr™e_hªdËr
("d¡", 
»cÚfigu»_keywÜd_hªdËr
, "2 DST");

78 
	}
}

80 
CLICK_ENDDECLS


81 
EXPORT_ELEMENT
(
Eth”Rewr™e
)

	@ethernet/etherrewrite.hh

1 #iâdeà
CLICK_ETHERREWRITE_HH


2 
	#CLICK_ETHERREWRITE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


47 şas 
	cEth”Rewr™e
 : 
public
 
EËm’t
 {…ublic:

49 
	$Eth”Rewr™e
(è
CLICK_COLD
;

50 ~
	$Eth”Rewr™e
(è
CLICK_COLD
;

52 cÚ¡ *
	$şass_Çme
() const {  "EtherRewrite"; }

53 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

55 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

56 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

57 
	$add_hªdËrs
(è
CLICK_COLD
;

59 
šlše
 
Pack‘
 *
	`smaùiÚ
(Packet *);

61 
Pack‘
 *
	`puÎ
();

63 
	`push
(, 
Pack‘
 *);

65 
´iv©e
:

67 
şick_‘h”
 
_‘hh
;

69 
	}
};

71 
	gCLICK_ENDDECLS


	@ethernet/ethervlanencap.cc

18 
	~<şick/cÚfig.h
>

19 
	~"‘h”vÏÃnÿp.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
CLICK_DECLS


27 
	gEth”VLANEnÿp
::
	$Eth”VLANEnÿp
()

29 
	}
}

31 
Eth”VLANEnÿp
::~
	$Eth”VLANEnÿp
()

33 
	}
}

36 
Eth”VLANEnÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

38 
şick_‘h”_vÏn
 
	g‘hh
;

39 
ušt16_t
 
	g‘h”_vÏn_’ÿp_´Ùo
;

40 
SŒšg
 
	gtci_wÜd
;

41 
	gtci
 = -1, 
	gid
 = 0, 
	gpı
 = 0, 
	gÇtive_vÏn
 = 0;

42 
	g‘hh
.
	g‘h”_vÏn_´Ùo
 = 
htÚs
(
ETHERTYPE_8021Q
);

43 ià(
Args
(
cÚf
, 
this
, 
”rh
)

44 .
»ad_mp
("ETHERTYPE", 
‘h”_vÏn_’ÿp_´Ùo
)

45 .
»ad_mp
("SRC", 
Eth”Add»ssArg
(), 
‘hh
.
‘h”_sho¡
)

46 .
»ad_mp
("DST", 
Eth”Add»ssArg
(), 
‘hh
.
‘h”_dho¡
)

47 .
»ad_p
("VLAN_TCI", 
WÜdArg
(), 
tci_wÜd
)

48 .
»ad_p
("VLAN_PCP", 
BoundedIÁArg
(0, 7), 
pı
)

49 .
»ad
("VLAN_ID", 
BoundedIÁArg
(0, 0xFFF), 
id
)

50 .
»ad
("NATIVE_VLAN", 
BoundedIÁArg
(-1, 0xFFF), 
Çtive_vÏn
)

51 .
com¶‘e
() < 0)

53 ià(
	gtci_wÜd
 && !tci_wÜd.
equ®s
("ANNO", 4)

54 && 
Args
(
this
, 
”rh
).
push_back
(
tci_wÜd
)

55 .
»ad_p
("VLAN_TCI", 
BoundedIÁArg
(0, 0xFFFF), 
tci
)

56 .
com¶‘e
() < 0)

58 
	g‘hh
.
	g‘h”_vÏn_tci
 = 
htÚs
((
tci
 >ğ0 ?c˜: 
id
è| (
pı
 << 13));

59 
	g‘hh
.
	g‘h”_vÏn_’ÿp_´Ùo
 = 
htÚs
(
‘h”_vÏn_’ÿp_´Ùo
);

60 
	g_‘hh
 = 
‘hh
;

61 
	g_u£_ªno
 = 
tci_wÜd
.
equ®s
("ANNO", 4);

62 
	g_Çtive_vÏn
 = (
Çtive_vÏn
 >ğ0 ? 
htÚs
(native_vlan) : -1);

66 
Pack‘
 *

67 
	gEth”VLANEnÿp
::
	$smaùiÚ
(
Pack‘
 *
p
)

69 ià(
_u£_ªno
)

70 
_‘hh
.
‘h”_vÏn_tci
 = 
	`VLAN_TCI_ANNO
(
p
);

71 ià((
_‘hh
.
‘h”_vÏn_tci
 & 
	`htÚs
(0x0FFF)è=ğ
_Çtive_vÏn
) {

72 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`push_mac_h—d”
((
şick_‘h”
))) {

73 
	`memıy
(
q
->
	`d©a
(), &
_‘hh
, 12);

74 
q
->
	`‘h”_h—d”
()->
‘h”_ty³
 = 
_‘hh
.
‘h”_vÏn_’ÿp_´Ùo
;

75  
q
;

79 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`push_mac_h—d”
((
şick_‘h”_vÏn
))) {

80 
	`memıy
(
q
->
	`d©a
(), &
_‘hh
, (
şick_‘h”_vÏn
));

81  
q
;

84 
	}
}

87 
	gEth”VLANEnÿp
::
	$push
(, 
Pack‘
 *
p
)

89 ià(
Pack‘
 *
q
 = 
	`smaùiÚ
(
p
))

90 
	`ouut
(0).
	`push
(
q
);

91 
	}
}

93 
Pack‘
 *

94 
	gEth”VLANEnÿp
::
	$puÎ
()

96 ià(
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
())

97  
	`smaùiÚ
(
p
);

100 
	}
}

102 
SŒšg


103 
	gEth”VLANEnÿp
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
)

105 
Eth”VLANEnÿp
 *
eve
 = 
¡©ic_ÿ¡
<Eth”VLANEnÿ°*>(
e
);

106 
»š‹½»t_ÿ¡
<
ušŒ_t
>(
u£r_d©a
)) {

107 
h_cÚfig
: {

108 
SŒšgAccum
 
§
;

109 
§
 << 
	`Eth”Add»ss
(
eve
->
_‘hh
.
‘h”_sho¡
) << ", "

110 << 
	`Eth”Add»ss
(
eve
->
_‘hh
.
‘h”_dho¡
) << ", "

111 << 
	`Áohs
(
eve
->
_‘hh
.
‘h”_vÏn_’ÿp_´Ùo
);

112 ià(
eve
->
_u£_ªno
)

113 
§
 << ", ANNO";

115 
§
 << ", VLAN_ID " << (
	`Áohs
(
eve
->
_‘hh
.
‘h”_vÏn_tci
) & 0xFFF)

116 << ", VLAN_PCP " << ((
	`Áohs
(
eve
->
_‘hh
.
‘h”_vÏn_tci
) >> 13) & 7);

117 ià(
eve
->
_Çtive_vÏn
 != 0)

118 
§
 << ", NATIVE_VLAN " << 
	`Áohs
(
eve
->
_Çtive_vÏn
);

119  
§
.
	`ke_¡ršg
();

121 
h_vÏn_tci
:

122 ià(
eve
->
_u£_ªno
)

123  
SŒšg
::
	`make_¡abË
("ANNO", 4);

125  
	`SŒšg
(
	`Áohs
(
eve
->
_‘hh
.
‘h”_vÏn_tci
));

127  
	`SŒšg
();

128 
	}
}

131 
	gEth”VLANEnÿp
::
	$add_hªdËrs
()

133 
	`add_»ad_hªdËr
("cÚfig", 
»ad_hªdËr
, 
h_cÚfig
);

134 
	`add_d©a_hªdËrs
("¤c", 
HªdËr
::
h_»ad
 | HªdËr::
h_wr™e
, 
»š‹½»t_ÿ¡
<
Eth”Add»ss
 *>(&
_‘hh
.
‘h”_sho¡
));

135 
	`add_d©a_hªdËrs
("d¡", 
HªdËr
::
h_»ad
 | HªdËr::
h_wr™e
, 
»š‹½»t_ÿ¡
<
Eth”Add»ss
 *>(&
_‘hh
.
‘h”_dho¡
));

136 
	`add_Ãt_Üd”_d©a_hªdËrs
("‘h”ty³", 
HªdËr
::
h_»ad
 | HªdËr::
h_wr™e
, &
_‘hh
.
‘h”_vÏn_’ÿp_´Ùo
);

137 
	`add_»ad_hªdËr
("vÏn_tci", 
»ad_hªdËr
, 
h_vÏn_tci
);

138 
	`add_wr™e_hªdËr
("vÏn_tci", 
»cÚfigu»_keywÜd_hªdËr
, "3 VLAN_TCI");

139 
	`add_»ad_hªdËr
("vÏn_id", 
»ad_keywÜd_hªdËr
, "VLAN_ID");

140 
	`add_wr™e_hªdËr
("vÏn_id", 
»cÚfigu»_keywÜd_hªdËr
, "VLAN_ID");

141 
	`add_»ad_hªdËr
("vÏn_pı", 
»ad_keywÜd_hªdËr
, "VLAN_PCP");

142 
	`add_wr™e_hªdËr
("vÏn_pı", 
»cÚfigu»_keywÜd_hªdËr
, "VLAN_PCP");

143 
	`add_»ad_hªdËr
("Çtive_vÏn", 
»ad_keywÜd_hªdËr
, "NATIVE_VLAN");

144 
	`add_wr™e_hªdËr
("Çtive_vÏn", 
»cÚfigu»_keywÜd_hªdËr
, "NATIVE_VLAN");

145 
	}
}

147 
CLICK_ENDDECLS


148 
EXPORT_ELEMENT
(
Eth”VLANEnÿp
 Eth”VLANEnÿp-
Eth”VÏnEnÿp
)

	@ethernet/ethervlanencap.hh

1 #iâdeà
CLICK_ETHERVLANENCAP_HH


2 
	#CLICK_ETHERVLANENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


90 şas 
	cEth”VLANEnÿp
 : 
public
 
EËm’t
 {…ublic:

92 
	$Eth”VLANEnÿp
(è
CLICK_COLD
;

93 ~
	$Eth”VLANEnÿp
(è
CLICK_COLD
;

95 cÚ¡ *
	$şass_Çme
() const {  "EtherVLANEncap"; }

96 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

98 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

99 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

100 
	$add_hªdËrs
(è
CLICK_COLD
;

102 
Pack‘
 *
	`smaùiÚ
(Pack‘ *
p
);

103 
	`push
(
pÜt
, 
Pack‘
 *
p
);

104 
Pack‘
 *
	`puÎ
(
pÜt
);

106 
´iv©e
:

108 
şick_‘h”_vÏn
 
_‘hh
;

109 
boŞ
 
_u£_ªno
;

110 
_Çtive_vÏn
;

112 ’um { 
h_cÚfig
, 
h_vÏn_tci
 
	}
};

113 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
è
CLICK_COLD
;

114 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
u£r_d©a
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

116 
	}
};

118 
	gCLICK_ENDDECLS


	@ethernet/getetheraddress.cc

19 
	~<şick/cÚfig.h
>

20 
	~"g‘‘h”add»ss.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
CLICK_DECLS


27 
	gG‘Eth”Add»ss
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

29 
	gªno
;

30 
SŒšg
 
	goff
;

31 ià(
Args
(
cÚf
, 
this
, 
”rh
)

32 .
»ad_mp
("ANNO", 
AÂoArg
(6), 
ªno
)

33 .
»ad_mp
("OFFSET", 
WÜdArg
(), 
off
)

34 .
com¶‘e
() < 0)

37 
ušt32_t
 
	goff£t
 = 0;

38 ià(
	goff
.
low”
() == "src")

39 
off£t
 = 6;

40 ià(
	goff
.
low”
() == "dst")

41 
off£t
 = 0;

42 ià(!
IÁArg
().
·r£
(
off
, 
off£t
è|| 
	goff£t
 + 6 < 6)

43  
	g”rh
->
”rÜ
("type mismatch: bad OFFSET");

45 
	g_ªno
 = 
ªno
;

46 
	g_off£t
 = 
off£t
;

50 
Pack‘
 *

51 
	gG‘Eth”Add»ss
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

53 ià(
_off£t
 + 6 <ğ
p
->
	`Ëngth
()) {

54 
	`memıy
(
p
->
	`ªno_u8
(è+ 
_ªno
,…->
	`d©a
(è+ 
_off£t
, 6);

55  
p
;

57 
	`checked_ouut_push
(1, 
p
);

60 
	}
}

62 
CLICK_ENDDECLS


63 
	$EXPORT_ELEMENT
(
G‘Eth”Add»ss
)

64 
	`ELEMENT_MT_SAFE
(
G‘Eth”Add»ss
)

	@ethernet/getetheraddress.hh

1 #iâdeà
CLICK_GETETHERADDRESS_HH


2 
	#CLICK_GETETHERADDRESS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


29 şas 
	cG‘Eth”Add»ss
 : 
public
 
EËm’t
 {

31 
public
:

33 cÚ¡ *
	$şass_Çme
() const {  "GetEtherAddress"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

35 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

37 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

38 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

40 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

42 
	g´iv©e
:

43 
ušt32_t
 
_off£t
;

44 
	g_ªno
;

48 
	gCLICK_ENDDECLS


	@ethernet/hostetherfilter.cc

18 
	~<şick/cÚfig.h
>

19 
	~"ho¡‘h”f‹r.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/‘h”add»ss.hh
>

24 
	~<şickÃt/‘h”.h
>

25 
CLICK_DECLS


27 
	gHo¡Eth”F‹r
::
	$Ho¡Eth”F‹r
()

29 
	}
}

31 
Ho¡Eth”F‹r
::~
	$Ho¡Eth”F‹r
()

33 
	}
}

36 
Ho¡Eth”F‹r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

38 
boŞ
 
	gdrİ_own
 = 
çl£
, 
	gdrİ_Ùh”
 = 
Œue
;

39 
ušt32_t
 
	goff£t
 = 0;

40 ià(
Args
(
cÚf
, 
this
, 
”rh
)

41 .
»ad_mp
("ETHER", 
_addr
)

42 .
»ad_p
("DROP_OWN", 
drİ_own
)

43 .
»ad_p
("DROP_OTHER", 
drİ_Ùh”
)

44 .
»ad
("OFFSET", 
off£t
)

45 .
com¶‘e
() < 0)

47 
	g_off£t
 = 
off£t
;

48 
	g_drİ_own
 = 
drİ_own
;

49 
	g_drİ_Ùh”
 = 
drİ_Ùh”
;

53 
Pack‘
 *

54 
	gHo¡Eth”F‹r
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

56 cÚ¡ 
şick_‘h”
 *
e
 = (cÚ¡ click_‘h” *è(
p
->
	`d©a
(è+ 
_off£t
);

57 cÚ¡ *
daddr
 = (cÚ¡ *)
e
->
‘h”_dho¡
;

59 ià(
_drİ_own
 && 
	`memcmp
(
e
->
‘h”_sho¡
, 
_addr
.
	`d©a
(), 6) == 0) {

60 
	`checked_ouut_push
(1, 
p
);

61 
p
 = 0;

62 } ià(
	`memcmp
(
e
->
‘h”_dho¡
, 
_addr
.
	`d©a
(), 6) == 0) {

63 
p
->
	`£t_·ck‘_ty³_ªno
(
Pack‘
::
HOST
);

64 } ià(
daddr
[0] == 0xFFFF && daddr[1] == 0xFFFF && daddr[2] == 0xFFFF) {

65 
p
->
	`£t_·ck‘_ty³_ªno
(
Pack‘
::
BROADCAST
);

66 } ià(
e
->
‘h”_dho¡
[0] & 0x01) {

67 
p
->
	`£t_·ck‘_ty³_ªno
(
Pack‘
::
MULTICAST
);

69 
p
->
	`£t_·ck‘_ty³_ªno
(
Pack‘
::
OTHERHOST
);

70 ià(
_drİ_Ùh”
) {

71 
	`checked_ouut_push
(1, 
p
);

72 
p
 = 0;

75  
p
;

76 
	}
}

79 
	gHo¡Eth”F‹r
::
	$add_hªdËrs
()

81 
	`add_d©a_hªdËrs
("‘h”", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_addr
);

82 
	}
}

84 
CLICK_ENDDECLS


85 
EXPORT_ELEMENT
(
Ho¡Eth”F‹r
)

	@ethernet/hostetherfilter.hh

1 #iâdeà
CLICK_HOSTETHERFILTER_HH


2 
	#CLICK_HOSTETHERFILTER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
CLICK_DECLS


50 şas 
	cHo¡Eth”F‹r
 : 
public
 
EËm’t
 {…ublic:

52 
	$Ho¡Eth”F‹r
(è
CLICK_COLD
;

53 ~
	$Ho¡Eth”F‹r
(è
CLICK_COLD
;

55 cÚ¡ *
	$şass_Çme
() const {  "HostEtherFilter"; }

56 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

57 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

59 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

60 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

62 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

63 
	$add_hªdËrs
(è
CLICK_COLD
;

65 
´iv©e
:

67 
boŞ
 
_drİ_own
 : 1;

68 
boŞ
 
_drİ_Ùh”
 : 1;

69 
_off£t
;

70 
Eth”Add»ss
 
_addr
;

72 
	}
};

74 
	gCLICK_ENDDECLS


	@ethernet/ip6ndadvertiser.cc

19 
	~<şick/cÚfig.h
>

20 
	~"6ndadv”ti£r.hh
"

21 
	~<şickÃt/‘h”.h
>

22 
	~<şickÃt/6.h
>

23 
	~<şick/‘h”add»ss.hh
>

24 
	~<şick/6add»ss.hh
>

25 
	~<şick/¬gs.hh
>

26 
	~<şick/”rÜ.hh
>

27 
	~<şick/glue.hh
>

28 
CLICK_DECLS


30 
	gIP6NDAdv”ti£r
::
	$IP6NDAdv”ti£r
()

32 
	}
}

34 
IP6NDAdv”ti£r
::~
	$IP6NDAdv”ti£r
()

36 
	}
}

39 
IP6NDAdv”ti£r
::
	$add_m­
(cÚ¡ 
IP6Add»ss
 &
a
, cÚ¡ IP6Add»s &
mask
, cÚ¡ 
Eth”Add»ss
 &
’a
)

41 
EÁry
 
e
;

42 
e
.
d¡
 = 
a
;

43 
e
.
mask
 = mask;

44 
e
.
’a
 =ƒna;

45 
_v
.
	`push_back
(
e
);

46 
	}
}

49 
	gIP6NDAdv”ti£r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

51 
	g_v
.
ş—r
();

53 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

54 
IP6Add»ss
 
	ga
, 
	gmask
;

55 
Eth”Add»ss
 
	g’a
;

56 
boŞ
 
	ghave_’a
 = 
çl£
;

57 
	gfœ¡
 = 
_v
.
size
();

59 
	gVeùÜ
<
	gSŒšg
> 
	gwÜds
;

60 
ı_¥aûvec
(
cÚf
[
i
], 
wÜds
);

62 
	gj
 = 0; j < 
	gwÜds
.
size
(); j++)

63 ià(
ı_6_´efix
(
wÜds
[
j
], (*)&
a
, (*)&
mask
, 
Œue
, 
this
))

64 
add_m­
(
a
, 
mask
, 
Eth”Add»ss
());

65 ià(
ı_6_add»ss
(
wÜds
[
j
], &
a
, 
this
))

66 
add_m­
(
a
, 
IP6Add»ss
("ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff"), 
Eth”Add»ss
());

67 ià(
Eth”Add»ssArg
().
·r£
(
wÜds
[
j
], 
’a
, 
this
)) {

68 ià(
	ghave_’a
)

69 
	g”rh
->
”rÜ
("¬gum’ˆ%d ha mÜthª oÃ Eth”Ãˆadd»ss", 
i
);

70 
	ghave_’a
 = 
Œue
;

72 
	g”rh
->
”rÜ
("¬gum’ˆ%d should b`IP6/MASK ETHADDR'", 
i
);

73 
	gj
 = 
wÜds
.
size
();

76 ià(
	gfœ¡
 =ğ
_v
.
size
())

77 
”rh
->
”rÜ
("¬gum’ˆ%d had‚ØIP6‡dd»s ªd masks", 
i
);

78 
	gj
 = 
fœ¡
; j < 
	g_v
.
size
(); j++)

79 
	g_v
[
j
].
	g’a
 = 
’a
;

82  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

86 
Pack‘
 *

87 
	gIP6NDAdv”ti£r
::
	$make_»¥Ú£
(
u_ch¬
 
dha
[6],

88 
u_ch¬
 
sha
[6],

89 
u_ch¬
 
d·
[16],

90 
u_ch¬
 
¥a
[16],

91 
u_ch¬
 
a
[16],

92 
u_ch¬
 
tha
[6])

95 
şick_‘h”
 *
e
;

96 
şick_6
 *
6
;

97 
şick_nd_adv
 *
—
;

98 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((*
e
è+ (*
6
)+ (*
—
));

99 ià(
q
 == 0) {

100 
	`şick_ch©‹r
("in NDadv: cannot make…acket!");

101 
	`as£¹
(0);

103 
	`mem£t
(
q
->
	`d©a
(), '\0', q->
	`Ëngth
());

104 
e
 = (
şick_‘h”
 *è
q
->
	`d©a
();

105 
6
=(
şick_6
 *è(
e
+1);

106 
—
 = (
şick_nd_adv
 *è(
6
 + 1);

109 
	`memıy
(
e
->
‘h”_dho¡
, 
dha
, 6);

110 
	`memıy
(
e
->
‘h”_sho¡
, 
sha
, 6);

111 
e
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_IP6
);

114 
6
->
6_æow
 = 0;

115 
6
->
6_v
 = 6;

116 
6
->
6_¶’
 = 
	`htÚs
((
şick_nd_adv
));

117 
6
->
6_nxt
=0x3a;

118 
6
->
6_hlim
=0xff;

119 
6
->
6_¤c
 = 
	`IP6Add»ss
(
¥a
);

120 
6
->
6_d¡
 = 
	`IP6Add»ss
(
d·
);

124 
—
->
ty³
 = 0x88;

125 
—
->
code
 =0;

128 
—
->
æags
 = 0xC0;

133 
i
=0; i<3; i++) {

134 
—
->
»£rved
[
i
] = 0;

137 
	`memıy
(
—
->
nd_a
, 
a
, 16);

138 
—
->
İtiÚ_ty³
 = 0x2;

139 
—
->
İtiÚ_Ëngth
 = 0x1;

140 
	`memıy
(
—
->
nd_tha
, 
tha
, 6);

141 
—
->
checksum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6
->
6_¤c
, &6->
6_d¡
, ip6->
6_¶’
, ip6->
6_nxt
, 0, (*)ea, ip6->ip6_plen));

143  
q
;

144 
	}
}

146 
Pack‘
 *

147 
	gIP6NDAdv”ti£r
::
	$make_»¥Ú£2
(
u_ch¬
 
dha
[6],

148 
u_ch¬
 
sha
[6],

149 
u_ch¬
 
d·
[16],

150 
u_ch¬
 
¥a
[16],

151 
u_ch¬
 
a
[16])

154 
şick_‘h”
 *
e
;

155 
şick_6
 *
6
;

156 
şick_nd_adv2
 *
—
;

157 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((*
e
è+ (*
6
)+ (*
—
));

158 ià(
q
 == 0) {

159 
	`şick_ch©‹r
("in IP6NDAdvertiser: cannot make…acket!");

160 
	`as£¹
(0);

162 
	`mem£t
(
q
->
	`d©a
(), '\0', q->
	`Ëngth
());

163 
e
 = (
şick_‘h”
 *è
q
->
	`d©a
();

164 
6
=(
şick_6
 *è(
e
+1);

165 
—
 = (
şick_nd_adv2
 *è(
6
 + 1);

168 
	`memıy
(
e
->
‘h”_dho¡
, 
dha
, 6);

169 
	`memıy
(
e
->
‘h”_sho¡
, 
sha
, 6);

170 
e
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_IP6
);

173 
6
->
6_æow
 = 0;

174 
6
->
6_v
 = 6;

175 
6
->
6_¶’
=
	`htÚs
((
şick_nd_adv2
));

176 
6
->
6_nxt
=0x3a;

177 
6
->
6_hlim
=0xff;

178 
6
->
6_¤c
 = 
	`IP6Add»ss
(
¥a
);

179 
6
->
6_d¡
 = 
	`IP6Add»ss
(
d·
);

183 
—
->
ty³
 = 0x88;

184 
—
->
code
 =0;

187 
—
->
æags
 = 0xC0;

192 
i
=0; i<3; i++) {

193 
—
->
»£rved
[
i
] = 0;

196 
	`memıy
(
—
->
nd_a
, 
a
, 16);

198 
—
->
checksum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6
->
6_¤c
, &6->
6_d¡
, ip6->
6_¶’
, ip6->
6_nxt
, 0, (*)(6+1), htÚs((
şick_nd_adv2
))));

200  
q
;

201 
	}
}

204 
boŞ


205 
	gIP6NDAdv”ti£r
::
	$lookup
(cÚ¡ 
IP6Add»ss
 &
a
, 
Eth”Add»ss
 &
’a
) const

207 
be¡
 = -1;

208 
i
 = 0; i < 
_v
.
	`size
(); i++)

209 ià(
a
.
	`m©ches_´efix
(
_v
[
i
].
d¡
, _v[i].
mask
)) {

210 ià(
be¡
 < 0 || 
_v
[
i
].
mask
.
	`mask_as_¥ecific
(_v[best].mask))

211 
be¡
 = 
i
;

214 ià(
be¡
 < 0)

215  
çl£
;

217 
’a
 = 
_v
[
be¡
].ena;

218  
Œue
;

220 
	}
}

222 
Pack‘
 *

223 
	gIP6NDAdv”ti£r
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

225 
şick_‘h”
 *
e
 = (şick_‘h” *è
p
->
	`d©a
();

226 
şick_6
 *
6
 = (şick_6 *è(
e
 + 1);

227 
şick_nd_sŞ
 *
—
=(şick_nd_sŞ *è(
6
 + 1);

228 
a
[16];

229 
¥a
[16];

230 
d·
[16];

231 
	`memıy
(&
a
, 
—
->
nd_a
, 16);

232 
	`memıy
(&
d·
, 
	`IP6Add»ss
(
6
->
6_¤c
).
	`d©a
(), 16);

233 
IP6Add»ss
 
a
 = 
	`IP6Add»ss
(
a
);

236 
csum2
 = 
	`š6_ç¡_cksum
(&
6
->
6_¤c
, &6->
6_d¡
, ip6->
6_¶’
, ip6->
6_nxt
, 
—
->
checksum
, (*)(6+1), 
	`htÚs
((
şick_nd_sŞ
)));

238 
Pack‘
 *
q
 = 0;

240 ià(
p
->
	`Ëngth
(è>ğ(*
e
è+ (
şick_6
è+ (
şick_nd_sŞ
) &&

241 
	`Áohs
(
e
->
‘h”_ty³
è=ğ
ETHERTYPE_IP6
 &&

242 
6
->
6_hlim
 ==0xff &&

243 
—
->
ty³
 =ğ
ND_SOL
 &&

244 
—
->
code
 == 0 &&

245 
csum2
 =ğ
	`Áohs
(
—
->
checksum
))

247 
Eth”Add»ss
 
’a
;

248 
ho¡_‘h”
[6];

249 if(
	`lookup
(
a
, 
’a
))

251 
	`memıy
(&
¥a
, 
a
.
	`d©a
(), 16);

252 
	`memıy
(&
ho¡_‘h”
, 
’a
.
	`d©a
(),6);

256 
q
 = 
	`make_»¥Ú£
(
e
->
‘h”_sho¡
, 
ho¡_‘h”
, 
d·
, 
¥a
, 
a
, host_ether);

263 
š6_addr
 
ša
;

264 
	`memıy
(&
ša
, &
—
->
nd_a
, 16);

267 
p
->
	`kl
();

268 (
q
);

269 
	}
}

271 
	$ELEMENT_REQUIRES
(
6
)

272 
	$EXPORT_ELEMENT
(
IP6NDAdv”ti£r
)

273 
CLICK_ENDDECLS


	@ethernet/ip6ndadvertiser.hh

1 #iâdeà
CLICK_IP6NDADVERTISER_HH


2 
	#CLICK_IP6NDADVERTISER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/6add»ss.hh
>

6 
	~<şick/veùÜ.hh
>

7 
CLICK_DECLS


39 şas 
	cIP6NDAdv”ti£r
 : 
public
 
EËm’t
 {…ublic:

41 
IP6NDAdv”ti£r
();

42 ~
IP6NDAdv”ti£r
();

44 cÚ¡ *
	$şass_Çme
() const {  "IP6NDAdvertiser"; }

45 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

46 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

48 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

52 
Pack‘
 *
make_»¥Ú£
(
dha
[6], 
sha
[6],

53 
d·
[16], 
¥a
[16],

54 
a
[16], 
tha
[6]);

59 
Pack‘
 *
make_»¥Ú£2
(
dha
[6], 
sha
[6],

60 
d·
[16], 
¥a
[16],

61 
a
[16]);

63 
boŞ
 
	$lookup
(cÚ¡ 
IP6Add»ss
 &, 
Eth”Add»ss
 &) const;

65 
´iv©e
:

67 
	sEÁry
 {

68 
IP6Add»ss
 
d¡
;

69 
IP6Add»ss
 
mask
;

70 
Eth”Add»ss
 
’a
;

71 
	}
};

72 
	gVeùÜ
<
	gEÁry
> 
	g_v
;

74 
add_m­
(cÚ¡ 
IP6Add»ss
 &
d¡
, cÚ¡ IP6Add»s &
mask
, cÚ¡ 
Eth”Add»ss
 &);

78 
	gCLICK_ENDDECLS


	@ethernet/ip6ndsolicitor.cc

18 
	~<şick/cÚfig.h
>

19 
	~"6ndsŞic™Ü.hh
"

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/‘h”add»ss.hh
>

22 
	~<şick/6add»ss.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/b™veùÜ.hh
>

26 
	~<şick/”rÜ.hh
>

27 
	~<şick/glue.hh
>

28 
CLICK_DECLS


30 
	gIP6NDSŞic™Ü
::
	$IP6NDSŞic™Ü
()

31 : 
	$_expœe_tim”
(
expœe_hook
, 
this
)

36 
i
 = 0; i < 
NMAP
; i++)

37 
_m­
[
i
] = 0;

38 
	}
}

40 
	gIP6NDSŞic™Ü
::~
	$IP6NDSŞic™Ü
()

42 
	}
}

45 
IP6NDSŞic™Ü
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

47  
Args
(
cÚf
, 
this
, 
”rh
)

48 .
»ad_mp
("IP", 
_my_6
)

49 .
»ad_mp
("ETH", 
_my_’
)

50 .
com¶‘e
();

54 
	gIP6NDSŞic™Ü
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

56 
_expœe_tim”
.
	`š™Ÿlize
(
this
);

57 
_expœe_tim”
.
	`scheduË_aá”_m£c
(
EXPIRE_TIMEOUT_MS
);

58 
_¬p_qu”›s
 = 0;

59 
_pkts_kËd
 = 0;

61 
	}
}

64 
	gIP6NDSŞic™Ü
::
	$ş—nup
(
CËªupSge
)

66 
i
 = 0; i < 
NMAP
; i++) {

67 
NDEÁry
 *
t
 = 
_m­
[
i
];; ) {

68 
NDEÁry
 *
n
 = 
t
->
Ãxt
;

69 ià(
t
->
p
)

70 
t
->
p
->
	`kl
();

71 
d–‘e
 
t
;

72 
t
 = 
n
;

74 
_m­
[
i
] = 0;

76 
	}
}

79 
	gIP6NDSŞic™Ü
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *)

81 
IP6NDSŞic™Ü
 *
¬pq
 = (IP6NDSŞic™Ü *)
e
->
	`ÿ¡
("IP6NDSolicitor");

82 ià(!
¬pq
 || 
_my_6
 !ğ¬pq->_my_6 || 
_my_’
 !=‡rpq->_my_en)

85 
NDEÁry
 *
§ve
[
NMAP
];

86 
	`memıy
(
§ve
, 
_m­
, (
NDEÁry
 *è* 
NMAP
);

87 
	`memıy
(
_m­
, 
¬pq
->_m­, (
NDEÁry
 *è* 
NMAP
);

88 
	`memıy
(
¬pq
->
_m­
, 
§ve
, (
NDEÁry
 *è* 
NMAP
);

89 
	}
}

92 
	gIP6NDSŞic™Ü
::
	$expœe_hook
(
Tim”
 *, *
thunk
)

94 
IP6NDSŞic™Ü
 *
¬pq
 = (IP6NDSŞic™Ü *)
thunk
;

95 
şick_jiff›s_t
 
jiff
 = 
	`şick_jiff›s
();

96 
i
 = 0; i < 
NMAP
; i++) {

97 
NDEÁry
 *
´ev
 = 0;

99 
NDEÁry
 *
e
 = (
´ev
 ?…»v->
Ãxt
 : 
¬pq
->
_m­
[
i
]);

100 ià(!
e
)

102 ià(
e
->
ok
) {

103 
g­
 = 
jiff
 - 
e
->
Ï¡_»¥Ú£_jiff›s
;

104 ià(
g­
 > 120*
CLICK_HZ
) {

106 ià(
´ev
è´ev->
Ãxt
 = 
e
->next;

107 
¬pq
->
_m­
[
i
] = 
e
->
Ãxt
;

108 ià(
e
->
p
)

109 
e
->
p
->
	`kl
();

110 
d–‘e
 
e
;

112 } ià(
g­
 > 60*
CLICK_HZ
)

113 
e
->
pŞlšg
 = 1;

115 
´ev
 = 
e
;

118 
¬pq
->
_expœe_tim”
.
	`scheduË_aá”_m£c
(
EXPIRE_TIMEOUT_MS
);

119 
	}
}

122 
	gIP6NDSŞic™Ü
::
	$£nd_qu”y_fÜ
(cÚ¡ 
u_ch¬
 
wªt_6
[16])

124 
şick_‘h”
 *
e
;

125 
şick_6
 *
6
;

126 
şick_nd_sŞ
 *
—
;

127 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((*
e
è+ (*
6
è+ (*
—
));

128 ià(
q
 == 0) {

129 
	`şick_ch©‹r
("in‚dsol: cannot make…acket!");

130 
	`as£¹
(0);

133 
	`mem£t
(
q
->
	`d©a
(), '\0', q->
	`Ëngth
());

134 
e
 = (
şick_‘h”
 *è
q
->
	`d©a
();

135 
6
=(
şick_6
 *)(
e
+1);

136 
—
 = (
şick_nd_sŞ
 *è(
6
 + 1);

143 
e
->
‘h”_dho¡
[0] = 0x33;

144 
e
->
‘h”_dho¡
[1] = 0x33;

145 
e
->
‘h”_dho¡
[2] = 0xff;

146 
e
->
‘h”_dho¡
[3] = 
wªt_6
[13];

147 
e
->
‘h”_dho¡
[4] = 
wªt_6
[14];

148 
e
->
‘h”_dho¡
[5] = 
wªt_6
[15];

149 
	`memıy
(
e
->
‘h”_sho¡
, 
_my_’
.
	`d©a
(), 6);

150 
e
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_IP6
);

153 
6
->
6_æow
 = 0;

154 
6
->
6_v
 = 6;

155 
6
->
6_¶’
=
	`htÚs
((
şick_nd_sŞ
));

156 
6
->
6_nxt
=0x3a;

157 
6
->
6_hlim
=0xff;

158 
6
->
6_¤c
 = 
_my_6
;

159 
d¡2
[16];

160 
d¡2
[0]=0xff;

161 
d¡2
[1]=0x02;

162 
i
=2; i<11; i++) {

163 
d¡2
[
i
]=0;

165 
d¡2
[11]=1;

166 
d¡2
[12]=0xff;

167 
d¡2
[13]=
wªt_6
[13];

168 
d¡2
[14]=
wªt_6
[14];

169 
d¡2
[15]=
wªt_6
[15];

170 
6
->
6_d¡
 = 
	`IP6Add»ss
(
d¡2
);

173 
—
->
ty³
 = 0x87;

174 
—
->
code
 =0;

175 
—
->
»£rved
 = 
	`htÚl
(0);

176 
	`memıy
(
—
->
nd_a
, 
wªt_6
, 16);

177 
—
->
İtiÚ_ty³
 = 0x1;

178 
—
->
İtiÚ_Ëngth
 = 0x1;

179 
	`memıy
(
—
->
nd_sha
, 
_my_’
.
	`d©a
(), 6);

181 
—
->
checksum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6
->
6_¤c
, &6->
6_d¡
, ip6->
6_¶’
, ip6->
6_nxt
, 0, (*)(6+1), htÚs((
şick_nd_sŞ
))));

183 
_¬p_qu”›s
++;

184 
	`ouut
(
	`nouuts
()-1).
	`push
(
q
);

185 
	}
}

195 
	gIP6NDSŞic™Ü
::
	$hªdË_6
(
Pack‘
 *
p
)

197 
IP6Add»ss
 
a
 = 
	`DST_IP6_ANNO
(
p
);

198 
buck‘
 = (
a
.
	`d©a
()[0] + i·.d©a()[15]è% 
NMAP
;

199 
NDEÁry
 *
«
 = 
_m­
[
buck‘
];

200 
«
 &&‡e->
6
 !ğ
a
)

201 
«
 =‡e->
Ãxt
;

203 ià(
«
) {

204 ià(
«
->
pŞlšg
) {

205 
	`£nd_qu”y_fÜ
(
«
->
6
.
	`d©a
());

206 
«
->
pŞlšg
 = 0;

209 ià(
«
->
ok
) {

210 
Pack‘
 *
q
 = 
p
->
	`push
((
şick_‘h”
));

211 
şick_‘h”
 *
e
 = (şick_‘h” *)
q
->
	`d©a
();

212 
	`memıy
(
e
->
‘h”_sho¡
, 
_my_’
.
	`d©a
(), 6);

213 
	`memıy
(
e
->
‘h”_dho¡
, 
«
->
’
.
	`d©a
(), 6);

214 
e
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_IP6
);

215 
	`ouut
(0).
	`push
(
q
);

217 ià(
«
->
p
) {

218 
«
->
p
->
	`kl
();

219 
_pkts_kËd
++;

221 
«
->
p
 =…;

222 
	`£nd_qu”y_fÜ
(
	`DST_IP6_ANNO
(
p
).
	`d©a
());

226 
NDEÁry
 *
«
 = 
Ãw
 NDEntry;

227 
«
->
6
 = 
a
;

228 
«
->
ok
 =‡e->
pŞlšg
 = 0;

229 
«
->
p
 =…;

230 
«
->
Ãxt
 = 
_m­
[
buck‘
];

231 
_m­
[
buck‘
] = 
«
;

233 
	`£nd_qu”y_fÜ
(
	`DST_IP6_ANNO
(
p
).
	`d©a
());

235 
	}
}

243 
	gIP6NDSŞic™Ü
::
	$hªdË_»¥Ú£
(
Pack‘
 *
p
)

245 ià(
p
->
	`Ëngth
(è< (
şick_‘h”
è+ (
şick_6
è+ (
şick_nd_sŞ
))

248 
şick_‘h”
 *
‘hh
 = (şick_‘h” *è
p
->
	`d©a
();

249 
şick_6
 *
6h
 = (şick_6 *)(
‘hh
+1);

250 
şick_nd_adv
 * 
—h
 = (şick_nd_adv*)(
6h
+1);

252 
IP6Add»ss
 
a
 = 
	`IP6Add»ss
(
—h
->
nd_a
);

253 
Eth”Add»ss
 
’a
 = 
	`Eth”Add»ss
(
—h
->
nd_tha
);

254 ià(
	`Áohs
(
‘hh
->
‘h”_ty³
è=ğ
ETHERTYPE_IP6


255 && 
—h
->
ty³
 =ğ
ND_ADV
) {

257 
buck‘
 = (
a
.
	`d©a
()[0] + i·.d©a()[15]è% 
NMAP
;

258 
NDEÁry
 *
«
 = 
_m­
[
buck‘
];

259 
«
 &&‡e->
6
 !ğ
a
)

260 
«
 =‡e->
Ãxt
;

261 ià(!
«
)

264 ià(
«
->
ok
 &&‡e->
’
 !ğ
’a
)

265 
	`şick_ch©‹r
("IP6NDSolicitor overwriting‡nƒntry");

266 
«
->
’
 = 
’a
;

267 
«
->
ok
 = 1;

268 
«
->
pŞlšg
 = 0;

269 
«
->
Ï¡_»¥Ú£_jiff›s
 = 
	`şick_jiff›s
();

270 
Pack‘
 *
ÿched_·ck‘
 = 
«
->
p
;

271 
«
->
p
 = 0;

273 ià(
ÿched_·ck‘
){

274 
	`hªdË_6
(
ÿched_·ck‘
);}

276 
	}
}

279 
	gIP6NDSŞic™Ü
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

281 ià(
pÜt
 == 0){

282 
	`hªdË_6
(
p
); }

284 
	`hªdË_»¥Ú£
(
p
);

285 
p
->
	`kl
();

287 
	}
}

289 
SŒšg


290 
	gIP6NDSŞic™Ü
::
	$»ad_bË
(
EËm’t
 *
e
, *)

292 
IP6NDSŞic™Ü
 *
q
 = (IP6NDSŞic™Ü *)
e
;

293 
SŒšgAccum
 
§
;

294 
i
 = 0; i < 
NMAP
; i++)

295 
NDEÁry
 *
e
 = 
q
->
_m­
[
i
];ƒ;ƒ =ƒ->
Ãxt
)

296 
§
 << 
e
->
6
 << ' ' << (e->
ok
 ? 1 : 0è<< ' ' <<ƒ->
’
 << '\n';

297  
§
.
	`ke_¡ršg
();

298 
	}
}

300 
SŒšg


301 
	$IP6NDSŞic™Ü_»ad_¡©s
(
EËm’t
 *
e
, *)

303 
IP6NDSŞic™Ü
 *
q
 = (IP6NDSŞic™Ü *)
e
;

305 
	`SŒšg
(
q
->
_pkts_kËd
) + "…ackets killed\n" +

306 
	`SŒšg
(
q
->
_¬p_qu”›s
) + " ND Solicitation Message sent\n";

307 
	}
}

310 
	gIP6NDSŞic™Ü
::
	$add_hªdËrs
()

312 
	`add_»ad_hªdËr
("bË", 
»ad_bË
, 0);

313 
	`add_»ad_hªdËr
("¡©s", 
IP6NDSŞic™Ü_»ad_¡©s
, 0);

314 
	}
}

316 
CLICK_ENDDECLS


317 
	$ELEMENT_REQUIRES
(
6
)

318 
	`EXPORT_ELEMENT
(
IP6NDSŞic™Ü
)

	@ethernet/ip6ndsolicitor.hh

1 #iâdeà
CLICK_IP6NDSOLICITOR_HH


2 
	#CLICK_IP6NDSOLICITOR_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/6add»ss.hh
>

6 
	~<şick/tim”.hh
>

7 
CLICK_DECLS


50 şas 
	cIP6NDSŞic™Ü
 : 
public
 
EËm’t
 {

51 
public
:

53 
IP6NDSŞic™Ü
();

54 ~
IP6NDSŞic™Ü
();

56 cÚ¡ *
	$şass_Çme
() const {  "IP6NDSolicitor"; }

57 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/1-2"; 
	}
}

58 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

59 cÚ¡ *
	$æow_code
(ècÚ¡ {  "xy/x"; 
	}
}

61 
	$add_hªdËrs
(è
CLICK_COLD
;

63 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

64 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

65 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

66 
	`ke_¡©e
(
EËm’t
 *, 
E¼ÜHªdËr
 *);

68 
	`push
(
pÜt
, 
Pack‘
 *);

70 
Pack‘
 *
	`make_qu”y
(
a
[16],

71 
sha
[6], 
¥a
[16]);

73 
	`š£¹
(
IP6Add»ss
, 
Eth”Add»ss
);

75 
	sNDEÁry
 {

76 
IP6Add»ss
 
6
;

77 
Eth”Add»ss
 
’
;

78 
şick_jiff›s_t
 
Ï¡_»¥Ú£_jiff›s
;

79 
ok
: 1;

80 
pŞlšg
: 1;

81 
Pack‘
 *
p
;

82 
NDEÁry
 *
Ãxt
;

83 
	}
};

86 
	g_¬p_qu”›s
;

87 
	g_pkts_kËd
;

89 
	g´iv©e
:

91 ’um { 
NMAP
 = 256 };

92 
NDEÁry
 *
	g_m­
[
NMAP
];

93 
Eth”Add»ss
 
	g_my_’
;

94 
IP6Add»ss
 
	g_my_6
;

95 
Tim”
 
	g_expœe_tim”
;

97 
£nd_qu”y_fÜ
(cÚ¡ 
u_ch¬
 
wªt_6
[16]);

99 
hªdË_6
(
Pack‘
 *);

100 
hªdË_»¥Ú£
(
Pack‘
 *);

102 ’um { 
	gEXPIRE_TIMEOUT_MS
 = 15 * 1000 };

103 
expœe_hook
(
Tim”
 *, *);

104 
SŒšg
 
»ad_bË
(
EËm’t
 *, *);

108 
	gCLICK_ENDDECLS


	@ethernet/setetheraddress.cc

19 
	~<şick/cÚfig.h
>

20 
	~"£‹th”add»ss.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
CLICK_DECLS


27 
	gS‘Eth”Add»ss
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

29  
Args
(
cÚf
, 
this
, 
”rh
)

30 .
»ad_mp
("ADDR", 
_addr
)

31 .
»ad_mp
("ANNO", 
AÂoArg
(6), 
_ªno
)

32 .
com¶‘e
();

35 
Pack‘
 *

36 
	gS‘Eth”Add»ss
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

38 
ušt8_t
 *
ªno_p
 = 
p
->
	`ªno_u8
(è+ 
_ªno
;

39 
	`memıy
(
ªno_p
, 
_addr
.
	`d©a
(), 6);

40  
p
;

41 
	}
}

44 
	gS‘Eth”Add»ss
::
	$add_hªdËrs
()

46 
	`add_d©a_hªdËrs
("addr", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_addr
);

47 
	}
}

49 
CLICK_ENDDECLS


50 
	$EXPORT_ELEMENT
(
S‘Eth”Add»ss
)

51 
	`ELEMENT_MT_SAFE
(
S‘Eth”Add»ss
)

	@ethernet/setetheraddress.hh

1 #iâdeà
CLICK_SETETHERADDRESS_HH


2 
	#CLICK_SETETHERADDRESS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
CLICK_DECLS


19 şas 
	cS‘Eth”Add»ss
 : 
public
 
EËm’t
 {

20 
public
:

22 cÚ¡ *
	$şass_Çme
() const {  "SetEtherAddress"; }

23 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

24 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

26 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

27 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

28 
	$add_hªdËrs
(è
CLICK_COLD
;

30 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

32 
´iv©e
:

33 
Eth”Add»ss
 
_addr
;

34 
_ªno
;

35 
	}
};

37 
	gCLICK_ENDDECLS


	@ethernet/setvlananno.cc

17 
	~<şick/cÚfig.h
>

18 
	~"£tvÏÇÂo.hh
"

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/·ck‘_ªno.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
CLICK_DECLS


25 
	gS‘VLANAÂo
::
	$S‘VLANAÂo
()

27 
	}
}

29 
S‘VLANAÂo
::~
	$S‘VLANAÂo
()

31 
	}
}

34 
S‘VLANAÂo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
	gtci
 = -1, 
	gid
 = 0, 
	gpı
 = 0;

37 ià(
Args
(
cÚf
, 
this
, 
”rh
)

38 .
»ad_p
("VLAN_TCI", 
BoundedIÁArg
(0, 0xFFFF), 
tci
)

39 .
»ad_p
("VLAN_PCP", 
BoundedIÁArg
(0, 7), 
pı
)

40 .
»ad
("VLAN_ID", 
BoundedIÁArg
(0, 0xFFF), 
id
)

41 .
com¶‘e
() < 0)

43 
	g_vÏn_tci
 = 
htÚs
((
tci
 >ğ0 ?c˜: 
id
è| (
pı
 << 13));

47 
Pack‘
 *

48 
	gS‘VLANAÂo
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

50 
	`SET_VLAN_TCI_ANNO
(
p
, 
_vÏn_tci
);

51  
p
;

52 
	}
}

54 
SŒšg


55 
	gS‘VLANAÂo
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
)

57 
S‘VLANAÂo
 *
sva
 = 
¡©ic_ÿ¡
<S‘VLANAÂØ*>(
e
);

58 
»š‹½»t_ÿ¡
<
ušŒ_t
>(
u£r_d©a
)) {

59 
h_cÚfig
: {

60 
SŒšgAccum
 
§
;

61 
§
 << "VLAN_ID " << (
	`Áohs
(
sva
->
_vÏn_tci
) & 0xFFF)

62 << ", VLAN_PCP " << ((
	`Áohs
(
sva
->
_vÏn_tci
) >> 13) & 7);

63  
§
.
	`ke_¡ršg
();

65 
h_vÏn_tci
:

66  
	`SŒšg
(
	`Áohs
(
sva
->
_vÏn_tci
));

68  
	`SŒšg
();

69 
	}
}

72 
	gS‘VLANAÂo
::
	$add_hªdËrs
()

74 
	`add_»ad_hªdËr
("cÚfig", 
»ad_hªdËr
, 
h_cÚfig
);

75 
	`add_»ad_hªdËr
("vÏn_tci", 
»ad_hªdËr
, 
h_vÏn_tci
);

76 
	`add_wr™e_hªdËr
("vÏn_tci", 
»cÚfigu»_keywÜd_hªdËr
, "VLAN_TCI");

77 
	`add_»ad_hªdËr
("vÏn_id", 
»ad_keywÜd_hªdËr
, "VLAN_ID");

78 
	`add_wr™e_hªdËr
("vÏn_id", 
»cÚfigu»_keywÜd_hªdËr
, "VLAN_ID");

79 
	`add_»ad_hªdËr
("vÏn_pı", 
»ad_keywÜd_hªdËr
, "VLAN_PCP");

80 
	`add_wr™e_hªdËr
("vÏn_pı", 
»cÚfigu»_keywÜd_hªdËr
, "VLAN_PCP");

81 
	}
}

83 
CLICK_ENDDECLS


84 
EXPORT_ELEMENT
(
S‘VLANAÂo
 S‘VLANAÂo-
S‘VÏnAÂo
)

	@ethernet/setvlananno.hh

1 #iâdeà
CLICK_SETVLANANNO_HH


2 
	#CLICK_SETVLANANNO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


37 şas 
	cS‘VLANAÂo
 : 
public
 
EËm’t
 {…ublic:

39 
	$S‘VLANAÂo
(è
CLICK_COLD
;

40 ~
	$S‘VLANAÂo
(è
CLICK_COLD
;

42 cÚ¡ *
	$şass_Çme
() const {  "SetVLANAnno"; }

43 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

45 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

46 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

47 
	$add_hªdËrs
(è
CLICK_COLD
;

49 
Pack‘
 *
	`sim¶e_aùiÚ
(Pack‘ *
p
);

51 
´iv©e
:

53 
ušt16_t
 
_vÏn_tci
;

55 ’um { 
h_cÚfig
, 
h_vÏn_tci
 
	}
};

56 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
è
CLICK_COLD
;

58 
	}
};

60 
	gCLICK_ENDDECLS


	@ethernet/storeetheraddress.cc

18 
	~<şick/cÚfig.h
>

19 
	~"¡Ü“th”add»ss.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
CLICK_DECLS


25 
	gStÜeEth”Add»ss
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

27 
SŒšg
 
	goff
;

28 
boŞ
 
	gadd»ss_¥ecif›d
, 
	gªno_¥ecif›d
;

29 
	gªno
;

30 ià(
Args
(
cÚf
, 
this
, 
”rh
)

31 .
»ad_p
("ADDR", 
_add»ss
).
»ad_¡©us
(
add»ss_¥ecif›d
)

32 .
»ad_mp
("OFFSET", 
WÜdArg
(), 
off
)

33 .
»ad
("ANNO", 
AÂoArg
(6), 
ªno
).
»ad_¡©us
(
ªno_¥ecif›d
)

34 .
com¶‘e
() < 0)

37 ià(!(
	gadd»ss_¥ecif›d
 ^ 
	gªno_¥ecif›d
))

38  
	g”rh
->
”rÜ
("must specifyƒxactly one of ADDR/ANNO");

40 
ušt32_t
 
	goff£t
 = 0;

41 ià(
	goff
.
low”
() == "src")

42 
off£t
 = 6;

43 ià(
	goff
.
low”
() == "dst")

44 
off£t
 = 0;

45 ià(!
IÁArg
().
·r£
(
off
, 
off£t
è|| 
	goff£t
 + 6 < 6)

46  
	g”rh
->
”rÜ
("type mismatch: bad OFFSET");

48 
	g_off£t
 = 
off£t
;

49 
	g_u£_ªno
 = 
ªno_¥ecif›d
;

50 
	g_ªno
 = 
ªno
;

54 
Pack‘
 *

55 
	gStÜeEth”Add»ss
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

57 ià(
_off£t
 + 6 <ğ
p
->
	`Ëngth
()) {

58 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
()) {

59 cÚ¡ 
ušt8_t
 *
addr
 = 
_u£_ªno
 ? 
q
->
	`ªno_u8
(è+ 
_ªno
 : 
_add»ss
.
	`d©a
();

60 
	`memıy
(
q
->
	`d©a
(è+ 
_off£t
, 
addr
, 6);

61  
q
;

65 
	`checked_ouut_push
(1, 
p
);

68 
	}
}

71 
	gStÜeEth”Add»ss
::
	$add_hªdËrs
()

73 
	`add_d©a_hªdËrs
("addr", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_add»ss
);

74 
	}
}

76 
CLICK_ENDDECLS


77 
	$EXPORT_ELEMENT
(
StÜeEth”Add»ss
)

78 
	`ELEMENT_MT_SAFE
(
StÜeEth”Add»ss
)

	@ethernet/storeetheraddress.hh

1 #iâdeà
CLICK_STOREETHERADDRESS_HH


2 
	#CLICK_STOREETHERADDRESS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
CLICK_DECLS


34 şas 
	cStÜeEth”Add»ss
 : 
public
 
EËm’t
 {…ublic:

36 cÚ¡ *
	$şass_Çme
() const {  "StoreEtherAddress"; }

37 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

38 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

40 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

41 
	$add_hªdËrs
(è
CLICK_COLD
;

43 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

45 
´iv©e
:

47 
ušt32_t
 
_off£t
;

48 
boŞ
 
_u£_ªno
;

49 
ušt8_t
 
_ªno
;

50 
Eth”Add»ss
 
_add»ss
;

52 
	}
};

54 
	gCLICK_ENDDECLS


	@ethernet/stripethervlanheader.cc

17 
	~<şick/cÚfig.h
>

18 
	~"¡r‘h”vÏnh—d”.hh
"

19 
	~<şick/‘h”add»ss.hh
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
CLICK_DECLS


25 
	gSŒEth”VLANH—d”
::
	$SŒEth”VLANH—d”
()

27 
	}
}

29 
SŒEth”VLANH—d”
::~
	$SŒEth”VLANH—d”
()

31 
	}
}

34 
SŒEth”VLANH—d”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
	gÇtive_vÏn
 = 0;

37 ià(
Args
(
cÚf
, 
this
, 
”rh
)

38 .
»ad_p
("NATIVE_VLAN", 
Çtive_vÏn
)

39 .
com¶‘e
() < 0)

41 ià(
	gÇtive_vÏn
 > 0xFFF)

42  
	g”rh
->
”rÜ
("bad NATIVE_VLAN");

43 
	g_Çtive_vÏn
 = 
Çtive_vÏn
 >ğ0 ? 
htÚs
(native_vlan) : -1;

47 
Pack‘
 *

48 
	gSŒEth”VLANH—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

50 cÚ¡ 
şick_‘h”_vÏn
 *
‘hh
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_‘h”_vÏÀ*>(
p
->
	`d©a
());

51 ià(
‘hh
->
‘h”_vÏn_´Ùo
 =ğ
	`htÚs
(
ETHERTYPE_8021Q
)) {

52 
	`SET_VLAN_TCI_ANNO
(
p
, 
‘hh
->
‘h”_vÏn_tci
);

53 
p
->
	`puÎ
((
şick_‘h”_vÏn
));

54 } ià(
_Çtive_vÏn
 >= 0) {

55 
	`SET_VLAN_TCI_ANNO
(
p
, 
_Çtive_vÏn
);

56 
p
->
	`puÎ
((
şick_‘h”
));

58 
	`checked_ouut_push
(1, 
p
);

59 
p
 = 0;

61  
p
;

62 
	}
}

64 
CLICK_ENDDECLS


65 
EXPORT_ELEMENT
(
SŒEth”VLANH—d”
 SŒEth”VLANH—d”-
SŒEth”VÏnH—d”
)

	@ethernet/stripethervlanheader.hh

1 #iâdeà
CLICK_STRIPETHERVLANHEADER_HH


2 
	#CLICK_STRIPETHERVLANHEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


33 şas 
	cSŒEth”VLANH—d”
 : 
public
 
EËm’t
 {…ublic:

35 
	$SŒEth”VLANH—d”
(è
CLICK_COLD
;

36 ~
	$SŒEth”VLANH—d”
(è
CLICK_COLD
;

38 cÚ¡ *
	$şass_Çme
() const {  "StripEtherVLANHeader"; }

39 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

40 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

42 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

43 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

45 
Pack‘
 *
sim¶e_aùiÚ
(Pack‘ *
p
);

47 
	g´iv©e
:

49 
_Çtive_vÏn
;

53 
	gCLICK_ENDDECLS


	@ethernet/vlandecap.cc

17 
	~<şick/cÚfig.h
>

18 
	~<şick/¬gs.hh
>

19 
	~<şick/”rÜ.hh
>

20 
	~<şick/glue.hh
>

21 
	~<şickÃt/‘h”.h
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
	~"vÏndeÿp.hh
"

24 
CLICK_DECLS


26 
	gVLANDeÿp
::
	$VLANDeÿp
()

28 
	}
}

30 
VLANDeÿp
::~
	$VLANDeÿp
()

32 
	}
}

35 
VLANDeÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 
	g_ªno
 = 
Œue
;

38 
	g_‘h”ty³
 = 
ETHERTYPE_8021Q
;

39 ià(
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad_p
("ANNO", 
_ªno
)

41 .
»ad
("ETHERTYPE", 
_‘h”ty³
)

42 .
com¶‘e
() < 0)

44 
	g_‘h”ty³
 = 
htÚs
(
_‘h”ty³
);

48 
Pack‘
 *

49 
	gVLANDeÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

51 
	`as£¹
(!
p
->
	`mac_h—d”
(è||…->mac_h—d”(è=ğp->
	`d©a
());

52 
ušt16_t
 
tci
 = 0;

53 cÚ¡ 
şick_‘h”_vÏn
 *
vÏn
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_‘h”_vÏÀ*>(
p
->
	`d©a
());

54 ià(
vÏn
->
‘h”_vÏn_´Ùo
 =ğ
_‘h”ty³
) {

55 
tci
 = 
vÏn
->
‘h”_vÏn_tci
;

56 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
()) {

57 
	`memmove
(
q
->
	`d©a
() + 4, q->data(), 12);

58 
q
->
	`puÎ
(4);

59 
p
 = 
q
;

63 
p
->
	`£t_mac_h—d”
Õ->
	`d©a
(), (
şick_‘h”
));

64 ià(
_ªno
)

65 
	`SET_VLAN_TCI_ANNO
(
p
, 
tci
);

66  
p
;

67 
	}
}

69 
CLICK_ENDDECLS


70 
EXPORT_ELEMENT
(
VLANDeÿp
)

	@ethernet/vlandecap.hh

1 #iâdeà
CLICK_VLANDECAP_HH


2 
	#CLICK_VLANDECAP_HH


	)

3 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


40 şas 
	cVLANDeÿp
 : 
public
 
EËm’t
 {…ublic:

42 
	$VLANDeÿp
(è
CLICK_COLD
;

43 ~
	$VLANDeÿp
(è
CLICK_COLD
;

45 cÚ¡ *
	$şass_Çme
() const {  "VLANDecap"; }

46 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

48 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

49 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

51 
	g´iv©e
:

53 
boŞ
 
_ªno
;

54 
ušt16_t
 
	g_‘h”ty³
;

58 
	gCLICK_ENDDECLS


	@ethernet/vlanencap.cc

17 
	~<şick/cÚfig.h
>

18 
	~<şick/¬gs.hh
>

19 
	~<şick/”rÜ.hh
>

20 
	~<şick/glue.hh
>

21 
	~<şick/·ck‘_ªno.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şickÃt/‘h”.h
>

24 
	~"vÏÃnÿp.hh
"

25 
CLICK_DECLS


27 
	gVLANEnÿp
::
	$VLANEnÿp
()

29 
	}
}

31 
VLANEnÿp
::~
	$VLANEnÿp
()

33 
	}
}

36 
VLANEnÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

38 
SŒšg
 
	gtci_wÜd
;

39 
	g_‘h”ty³
 = 
ETHERTYPE_8021Q
;

40 
	gtci
 = -1, 
	gid
 = 0, 
	gpı
 = 0, 
	gÇtive_vÏn
 = 0;

41 ià(
Args
(
cÚf
, 
this
, 
”rh
)

42 .
»ad_p
("VLAN_TCI", 
WÜdArg
(), 
tci_wÜd
)

43 .
»ad_p
("VLAN_PCP", 
BoundedIÁArg
(0, 7), 
pı
)

44 .
»ad
("VLAN_ID", 
BoundedIÁArg
(0, 0xFFF), 
id
)

45 .
»ad
("NATIVE_VLAN", 
BoundedIÁArg
(-1, 0xFFF), 
Çtive_vÏn
)

46 .
»ad
("ETHERTYPE", 
_‘h”ty³
)

47 .
com¶‘e
() < 0)

49 ià(
	gtci_wÜd
 && !tci_wÜd.
equ®s
("ANNO", 4)

50 && 
Args
(
this
, 
”rh
).
push_back
(
tci_wÜd
)

51 .
»ad_p
("VLAN_TCI", 
BoundedIÁArg
(0, 0xFFFF), 
tci
)

52 .
com¶‘e
() < 0)

54 
	g_vÏn_tci
 = 
htÚs
((
tci
 >ğ0 ?c˜: 
id
è| (
pı
 << 13));

55 
	g_u£_ªno
 = 
tci_wÜd
.
equ®s
("ANNO", 4);

56 
	g_Çtive_vÏn
 = (
Çtive_vÏn
 >ğ0 ? 
htÚs
(native_vlan) : -1);

57 
	g_‘h”ty³
 = 
htÚs
(
_‘h”ty³
);

61 
Pack‘
 *

62 
	gVLANEnÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

64 
	`as£¹
(!
p
->
	`mac_h—d”
(è||…->mac_h—d”(è=ğp->
	`d©a
());

65 
ušt16_t
 
tci
 = 
_vÏn_tci
;

66 ià(
_u£_ªno
)

67 
tci
 = 
	`VLAN_TCI_ANNO
(
p
);

68 ià((
tci
 & 
	`htÚs
(0xFFF)è=ğ
_Çtive_vÏn
) {

69 
p
->
	`£t_mac_h—d”
Õ->
	`d©a
(), (
şick_‘h”
));

70  
p
;

71 } ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`push
(4)) {

72 
	`memmove
(
q
->
	`d©a
(), q->data() + 4, 12);

73 
şick_‘h”_vÏn
 *
vÏn
 = 
»š‹½»t_ÿ¡
<şick_‘h”_vÏÀ*>(
q
->
	`d©a
());

74 
vÏn
->
‘h”_vÏn_´Ùo
 = 
_‘h”ty³
;

75 
vÏn
->
‘h”_vÏn_tci
 = 
tci
;

76 
q
->
	`£t_mac_h—d”
(q->
	`d©a
(), (
vÏn
));

77  
q
;

80 
	}
}

82 
SŒšg


83 
	gVLANEnÿp
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
)

85 
VLANEnÿp
 *
ve
 = 
¡©ic_ÿ¡
<VLANEnÿ°*>(
e
);

86 
»š‹½»t_ÿ¡
<
ušŒ_t
>(
u£r_d©a
)) {

87 
h_cÚfig
: {

88 
SŒšgAccum
 
§
;

89 ià(
ve
->
_u£_ªno
)

90 
§
 << "ANNO";

92 
§
 << "VLAN_ID " << (
	`Áohs
(
ve
->
_vÏn_tci
) & 0xFFF)

93 << ", VLAN_PCP " << ((
	`Áohs
(
ve
->
_vÏn_tci
) >> 13) & 7);

94 ià(
ve
->
_Çtive_vÏn
 != 0)

95 
§
 << ", NATIVE_VLAN " << 
	`Áohs
(
ve
->
_Çtive_vÏn
);

96  
§
.
	`ke_¡ršg
();

98 
h_vÏn_tci
:

99 ià(
ve
->
_u£_ªno
)

100  
SŒšg
::
	`make_¡abË
("ANNO", 4);

102  
	`SŒšg
(
	`Áohs
(
ve
->
_vÏn_tci
));

104  
	`SŒšg
();

105 
	}
}

108 
	gVLANEnÿp
::
	$add_hªdËrs
()

110 
	`add_»ad_hªdËr
("cÚfig", 
»ad_hªdËr
, 
h_cÚfig
);

111 
	`add_»ad_hªdËr
("vÏn_tci", 
»ad_hªdËr
, 
h_vÏn_tci
);

112 
	`add_wr™e_hªdËr
("vÏn_tci", 
»cÚfigu»_keywÜd_hªdËr
, "0 VLAN_TCI");

113 
	`add_»ad_hªdËr
("vÏn_id", 
»ad_keywÜd_hªdËr
, "VLAN_ID");

114 
	`add_wr™e_hªdËr
("vÏn_id", 
»cÚfigu»_keywÜd_hªdËr
, "VLAN_ID");

115 
	`add_»ad_hªdËr
("vÏn_pı", 
»ad_keywÜd_hªdËr
, "VLAN_PCP");

116 
	`add_wr™e_hªdËr
("vÏn_pı", 
»cÚfigu»_keywÜd_hªdËr
, "VLAN_PCP");

117 
	`add_»ad_hªdËr
("Çtive_vÏn", 
»ad_keywÜd_hªdËr
, "NATIVE_VLAN");

118 
	`add_wr™e_hªdËr
("Çtive_vÏn", 
»cÚfigu»_keywÜd_hªdËr
, "NATIVE_VLAN");

119 
	`add_»ad_hªdËr
("‘h”ty³", 
»ad_keywÜd_hªdËr
, "ETHERTYPE");

120 
	`add_wr™e_hªdËr
("‘h”ty³", 
»cÚfigu»_keywÜd_hªdËr
, "ETHERTYPE");

121 
	}
}

123 
CLICK_ENDDECLS


124 
EXPORT_ELEMENT
(
VLANEnÿp
)

	@ethernet/vlanencap.hh

1 #iâdeà
CLICK_VLANENCAP_HH


2 
	#CLICK_VLANENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


58 şas 
	cVLANEnÿp
 : 
public
 
EËm’t
 {…ublic:

60 
	$VLANEnÿp
(è
CLICK_COLD
;

61 ~
	$VLANEnÿp
(è
CLICK_COLD
;

63 cÚ¡ *
	$şass_Çme
() const {  "VLANEncap"; }

64 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

65 
	$add_hªdËrs
(è
CLICK_COLD
;

67 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

69 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

71 
´iv©e
:

73 
ušt16_t
 
_vÏn_tci
;

74 
boŞ
 
_u£_ªno
;

75 
_Çtive_vÏn
;

76 
ušt16_t
 
_‘h”ty³
;

78 ’um { 
h_cÚfig
, 
h_vÏn_tci
 
	}
};

79 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
è
CLICK_COLD
;

81 
	}
};

83 
	gCLICK_ENDDECLS


	@etherswitch/bridgemessage.cc

18 
	~<şick/cÚfig.h
>

19 
	~"bridgemes§ge.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/cÚå¬£.hh
>

22 
CLICK_DECLS


24 
SŒšg


25 
	gBridgeMes§ge
::
	$s
(
SŒšg
 
g
) const {

27 
	`¡©ic_as£¹
((
BridgeMes§ge
::
wœe
) == 60, "BridgeMessages must be 60 bytes onhe wire.");

29 * 
buf
 = 
Ãw
 [256];

30 
SŒšg
 
s
;

32 
	`¥rštf
(
buf
, "%s %16s:%04x: %2s %x -> %16s m/h/d: %x/%x/%x",

33 
g
.
	`c_¡r
(),

34 
SŒšg
::
	`make_num”ic
(
¡©ic_ÿ¡
<SŒšg::
ušt_Ïrge_t
>(
_bridge_id
), 16, 
çl£
).
	`c_¡r
(),

35 
_pÜt_id
,

36 
_tc
 ? "TC" : "tc",

37 
_co¡
, 
SŒšg
::
	`make_num”ic
(
¡©ic_ÿ¡
<SŒšg::
ušt_Ïrge_t
>(
_roÙ
), 16, 
çl£
).
	`c_¡r
(),

38 
_max_age
, 
_h–lo_time
, 
_fÜw¬d_d–ay
);

39 
s
 = 
buf
;

40 
d–‘e
 [] 
buf
;

41  
s
;

42 
	}
}

45 
	#COMPARE
(
a
,
b
,
c
èià(×è!ğ(b)è (×è< (b)è? (cè: -(c);

	)

48 
	gBridgeMes§ge
::
	$com·»
(cÚ¡ 
BridgeMes§ge
* 
Ùh”
) const {

49 
	`COMPARE
(
_roÙ
, 
Ùh”
->_root, 4);

50 
	`COMPARE
(
_co¡
, 
Ùh”
->_cost, 3);

51 
	`COMPARE
(
_bridge_id
, 
Ùh”
->_bridge_id, 2);

52 
	`COMPARE
(
_pÜt_id
, 
Ùh”
->_port_id, 1);

54 
	}
}

58 
	gBridgeMes§ge
::
	$com·»
(cÚ¡ 
BridgeMes§ge
::
wœe
* 
Ùh”
) const {

59 
	`COMPARE
(
_roÙ
, 
	`Áohq
(
Ùh”
->
roÙ
), 4);

60 
	`COMPARE
(
_co¡
, 
	`Áohl
(
Ùh”
->
co¡
), 3);

61 
	`COMPARE
(
_bridge_id
, 
	`Áohq
(
Ùh”
->
bridge_id
), 2);

62 
	`COMPARE
(
_pÜt_id
, 
	`Áohs
(
Ùh”
->
pÜt_id
), 1);

64 
	}
}

67 
	gBridgeMes§ge
::
	$com·»
(cÚ¡ 
BridgeMes§ge
* 
Ùh”
,

68 
ušt64_t
 
_bridge_id
, 
ušt16_t
 
_pÜt_id
) const {

69 
	`COMPARE
(
_roÙ
, 
Ùh”
->_root, 4);

70 
	`COMPARE
(
_co¡
, 
Ùh”
->_cost, 3);

71 
	`COMPARE
(
_bridge_id
, 
Ùh”
->_bridge_id, 2);

72 
	`COMPARE
(
_pÜt_id
, 
Ùh”
->_port_id, 1);

74 
	}
}

77 
	gBridgeMes§ge
::
	$»£t
(
ušt64_t
 
bridge_id
) {

78 
_roÙ
 = 
_bridge_id
 = 
bridge_id
;

79 
_co¡
 = 0;

80 
_time¡amp
 = 
Time¡amp
::
	`make_£c
(Time¡amp::
max_£cÚds
);

81 
_tc
 = 
çl£
;

82 
_max_age
 = 20;

83 
_h–lo_time
 = 2;

84 
_fÜw¬d_d–ay
 = 15;

85 
	}
}

89 
boŞ
 
	gBridgeMes§ge
::
	$expœe
(cÚ¡ 
Time¡amp
& 
cutoff
) {

90 ià(
_time¡amp
 > 
cutoff
)

91  
çl£
;

92 
	`expœe
();

93  
Œue
;

94 
	}
}

98 
	gBridgeMes§ge
::
	$expœe
() {

99 
_roÙ
 = 
_bridge_id
 = ~(
ušt64_t
)0;

100 
_co¡
 = ~(
ušt16_t
)0;

101 
_time¡amp
 = 
Time¡amp
::
	`make_£c
(Time¡amp::
max_£cÚds
);

102 
_tc
 = 
çl£
;

103 
	}
}

106 
	gBridgeMes§ge
::
	$äom_wœe
(cÚ¡ 
BridgeMes§ge
::
wœe
* 
msg
) {

107 
_roÙ
 = 
	`Áohq
(
msg
->
roÙ
);

108 
_co¡
 = 
	`Áohl
(
msg
->
co¡
);

109 
_bridge_id
 = 
	`Áohq
(
msg
->
bridge_id
);

110 
_pÜt_id
 = 
	`Áohs
(
msg
->
pÜt_id
);

112 
_time¡amp
 = 
Time¡amp
::
	`now
();

115 
Ï‹Ãss
 = (
	`Áohs
(
msg
->
mes§ge_age
) * 1000000)/256;

116 
_time¡amp
 -ğ
Time¡amp
::
	`make_u£c
(
Ï‹Ãss
);

117 
_tc
 = 
msg
->
tc
;

120 
_max_age
 = 
	`Áohs
(
msg
->
max_age
) / 256;

121 
_h–lo_time
 = 
	`Áohs
(
msg
->
h–lo_time
) / 256;

122 
_fÜw¬d_d–ay
 = 
	`Áohs
(
msg
->
fÜw¬d_d–ay
) / 256;

123 
	}
}

126 
	gBridgeMes§ge
::
	$to_wœe
(
BridgeMes§ge
::
wœe
* 
msg
) const {

127 
	`´•_msg
(
msg
);

128 
msg
->
Ëngth
 = 
	`htÚs
(38);

129 
msg
->
ty³
 = 0;

130 
msg
->
tÿ
 = 0;

131 
msg
->
»£rved
 = 0;

132 
msg
->
tc
 = 
_tc
;

133 
msg
->
roÙ
 = 
	`htÚq
(
_roÙ
);

134 
msg
->
co¡
 = 
	`htÚl
(
_co¡
);

136 
msg
->
bridge_id
 = 
	`htÚq
(
_bridge_id
);

137 
msg
->
pÜt_id
 = 
	`htÚs
(
_pÜt_id
);

139 ià(
_time¡amp
.
	`£c
(è=ğ
Time¡amp
::
max_£cÚds
) {

140 
msg
->
mes§ge_age
 = 
	`htÚs
(0);

142 
Time¡amp
 
t
 = Time¡amp::
	`now
(è- 
_time¡amp
;

143 
msg
->
mes§ge_age
 = 
	`htÚs
((
t
.
	`u£c
() * 256)/1000000);

144 
msg
->
mes§ge_age
 +ğ
	`htÚs
(
t
.
	`£c
() * 256);

148 
msg
->
max_age
 = 
	`htÚs
(256 * 
_max_age
);

149 
msg
->
h–lo_time
 = 
	`htÚs
(256 * 
_h–lo_time
);

150 
msg
->
fÜw¬d_d–ay
 = 
	`htÚs
(256 * 
_fÜw¬d_d–ay
);

151 
	}
}

154 
SŒšg


155 
	gBridgeMes§ge
::
wœe
::
	$s
(
SŒšg
 
g
) const {

156 * 
buf
 = 
Ãw
 [256];

157 
SŒšg
 
s
;

165 ià(
ty³
 == 128)

166 
	`¥rštf
(
buf
, "% TCM", 
g
.
	`c_¡r
());

168 
	`¥rštf
(
buf
, "%s %3s %16s:%04hx: %3s %2s %08x -> %16s "

170 
g
.
	`c_¡r
(),

171 
ty³
 ? "???" : "CFG",

172 
SŒšg
::
	`make_num”ic
(
¡©ic_ÿ¡
<SŒšg::
ušt_Ïrge_t
>(
	`Áohq
(
bridge_id
)), 16, 
çl£
).
	`c_¡r
(),

173 
	`Áohs
(
pÜt_id
),

174 
tÿ
 ? "TCA":"tÿ", 
tc
 ? "TC" : "tc",

175 
	`Áohl
(
co¡
), 
SŒšg
::
	`make_num”ic
(
¡©ic_ÿ¡
<SŒšg::
ušt_Ïrge_t
>(
	`Áohq
(
roÙ
)), 16, 
çl£
).
	`c_¡r
(),

176 
	`Áohs
(
mes§ge_age
),‚tohs(
max_age
),

177 
	`Áohs
(
h–lo_time
),‚tohs(
fÜw¬d_d–ay
));

178 
s
 = 
buf
;

179 
d–‘e
 [] 
buf
;

180  
s
;

181 
	}
}

183 
	gBridgeMes§ge
::
	$´•_msg
(
BridgeMes§ge
::
wœe
* 
msg
) {

184 
	`mem£t
(
msg
, 0, (*msg));

185 
	`memıy
(
msg
->
d¡
, 
_®l_bridges
, 6);

186 
msg
->
§p
 = 0x4242;

187 
msg
->
ùl
 = 3;

188 
msg
->
´ÙocŞ
 = 0;

189 
msg
->
v”siÚ
 = 0;

190 
	}
}

192 
	gBridgeMes§ge
::
	$fl_tcm
(
BridgeMes§ge
::
wœe
* 
msg
) {

193 
	`´•_msg
(
msg
);

194 
msg
->
Ëngth
 = 
	`htÚs
(7);

195 
msg
->
ty³
 = 128;

196 
	}
}

198 
ušt8_t
 
	gBridgeMes§ge
::
_®l_bridges
[6] = {

202 
CLICK_ENDDECLS


203 
	$ELEMENT_REQUIRES
(
št64
)

204 
	`ELEMENT_PROVIDES
(
Eth”Sw™chBridgeMes§ge
)

	@etherswitch/bridgemessage.hh

1 #iâdeà
CLICK_BRIDGEMESSAGE_HH


2 
	#CLICK_BRIDGEMESSAGE_HH


	)

3 
	~<şick/glue.hh
>

4 
	~<şick/¡ršg.hh
>

5 
	~<şick/š‹g”s.hh
>

6 
	~<şick/time¡amp.hh
>

7 
CLICK_DECLS


9 şas 
	cBridgeMes§ge
 {

10 
	mpublic
:

11 
wœe
;

13 
	$BridgeMes§ge
(è{ 
	`expœe
 (); }

14 
	$BridgeMes§ge
(cÚ¡ 
wœe
* 
msg
è{ 
	`äom_wœe
(msg); 
	}
}

17 
»£t
(
ušt64_t
 
bridge_id
);

18 
äom_wœe
(cÚ¡ 
wœe
* 
msg
);

19 
	$to_wœe
(
wœe
* 
msg
) const;

20 
	`fl_tcm
(
wœe
* 
msg
);

23 
boŞ
 
	`expœe
(cÚ¡ 
Time¡amp
& 
cutoff
);

24 
	`expœe
();

33 
	$com·»
(cÚ¡ 
BridgeMes§ge
* 
Ùh”
) const;

34 
	$com·»
(cÚ¡ 
wœe
* 
Ùh”
) const;

35 
	$com·»
(cÚ¡ 
BridgeMes§ge
* 
Ùh”
,

36 
ušt64_t
 
_bridge_id
, 
ušt16_t
 
_pÜt_id
) const;

38 
SŒšg
 
	`s
(SŒšg 
g
 = "") const;

40 
	`CLICK_PACKED_STRUCTURE
(

41 
	swœe
 {,

42 
public
:

43 
ušt8_t
 
d¡
[6];

44 
ušt8_t
 
¤c
[6];

46 
ušt16_t
 
Ëngth
;

47 
ušt16_t
 
§p
;

48 
ušt8_t
 
ùl
;

50 
ušt16_t
 
´ÙocŞ
;

51 
ušt8_t
 
v”siÚ
;

52 
ušt8_t
 
ty³
;

53 
tc
:1;

54 
»£rved
:6;

55 
tÿ
:1;

56 
ušt64_t
 
roÙ
;

57 
ušt32_t
 
co¡
;

58 
ušt64_t
 
bridge_id
;

59 
ušt16_t
 
pÜt_id
;

60 
ušt16_t
 
mes§ge_age
;

61 
ušt16_t
 
max_age
;

62 
ušt16_t
 
h–lo_time
;

63 
ušt16_t
 
fÜw¬d_d–ay
;

65 
ušt8_t
 
·ddšg
[8];

67 
SŒšg
 
	`s
(SŒšg 
g
 = "") const;

68 
	}
});

71 
ušt32_t
 
	g_max_age
;

72 
ušt32_t
 
	g_h–lo_time
;

73 
ušt32_t
 
	g_fÜw¬d_d–ay
;

75 
	g´iv©e
:

76 
ušt64_t
 
_roÙ
;

77 
ušt64_t
 
	g_bridge_id
;

78 
	gpublic
: 
ušt32_t
 
_co¡
; 
	g´iv©e
:

79 
ušt16_t
 
_pÜt_id
;

81 
boŞ
 
	g_tc
;

83 
Time¡amp
 
	g_time¡amp
;

86 
´•_msg
(
wœe
* 
msg
);

87 
ušt8_t
 
	g_®l_bridges
[6];

90 
	gCLICK_ENDDECLS


	@etherswitch/debugbridge.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/glue.hh
>

20 
	~<şick/¬gs.hh
>

21 
	~"debugbridge.hh
"

22 
	~"bridgemes§ge.hh
"

23 
CLICK_DECLS


25 
	gDebugBridge
::
	$DebugBridge
()

27 
	}
}

29 
DebugBridge
::~
	$DebugBridge
()

31 
	}
}

34 
DebugBridge
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("LABEL", 
_Ïb–
).
com¶‘e
();

39 
Pack‘
 *

40 
	gDebugBridge
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

42 cÚ¡ 
BridgeMes§ge
::
wœe
 *
msg
 =

43 
»š‹½»t_ÿ¡
<cÚ¡ 
BridgeMes§ge
::
wœe
 *>(
p
->
	`d©a
());

44 
	`şick_ch©‹r
("%s",
msg
->
	`s
(
_Ïb–
).
	`c_¡r
());

45  
p
;

46 
	}
}

48 
CLICK_ENDDECLS


49 
	$EXPORT_ELEMENT
(
DebugBridge
)

50 
	`ELEMENT_REQUIRES
(
Eth”Sw™chBridgeMes§ge
)

	@etherswitch/debugbridge.hh

1 #iâdeà
CLICK_DEBUGBRIDGE_HH


2 
	#CLICK_DEBUGBRIDGE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/¡ršg.hh
>

5 
CLICK_DECLS


7 şas 
	cDebugBridge
 : 
public
 
EËm’t
 {

9 
SŒšg
 
_Ïb–
;

11 
	mpublic
:

13 
	$DebugBridge
(è
CLICK_COLD
;

14 ~
	$DebugBridge
(è
CLICK_COLD
;

16 cÚ¡ *
	$şass_Çme
() const {  "DebugBridge"; }

17 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

19 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

21 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

24 
	gCLICK_ENDDECLS


	@etherswitch/etherswitch.cc

18 
	~<şick/cÚfig.h
>

19 
	~"‘h”sw™ch.hh
"

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/‘h”add»ss.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/”rÜ.hh
>

26 
CLICK_DECLS


28 
	gEth”Sw™ch
::
	$Eth”Sw™ch
()

29 : 
	`_bË
(
	`AddrInfo
(-1, 
	`Time¡amp
())), 
	$_timeout
(300)

31 
	}
}

33 
	gEth”Sw™ch
::~
	$Eth”Sw™ch
()

35 
_bË
.
	`ş—r
();

36 
	}
}

39 
	gEth”Sw™ch
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41  
Args
(
cÚf
, 
this
, 
”rh
)

42 .
»ad
("TIMEOUT", 
SecÚdsArg
(), 
_timeout
)

43 .
com¶‘e
();

47 
	gEth”Sw™ch
::
	$brßdÿ¡
(
sourû
, 
Pack‘
 *
p
)

49 
n
 = 
	`nouuts
();

50 
	`as£¹
((è
sourû
 < (è
n
);

51 
£Á
 = 0;

52 
i
 = 
n
 - 1; i >=0 ; i--)

53 ià(
i
 !ğ
sourû
) {

54 
Pack‘
 *
µ
 = (
£Á
 < 
n
 - 2 ? 
p
->
	`şÚe
() :…);

55 
	`ouut
(
i
).
	`push
(
µ
);

56 
£Á
++;

58 
	`as£¹
(
£Á
 =ğ
n
 - 1);

59 
	}
}

62 
	gEth”Sw™ch
::
	$push
(
sourû
, 
Pack‘
 *
p
)

64 
şick_‘h”
* 
e
 = (şick_‘h”*è
p
->
	`d©a
();

65 
ouÜt
 = -1;

68 ià(
_timeout
 != 0) {

69 
_bË
.
	`£t
(
	`Eth”Add»ss
(
e
->
‘h”_sho¡
), 
	`AddrInfo
(
sourû
, 
p
->
	`time¡amp_ªno
()));

73 
Eth”Add»ss
 
	`d¡
(
e
->
‘h”_dho¡
);

74 ià(!
d¡
.
	`is_group
()) {

75 ià(
TabË
::
™”©Ü
 
d¡_šfo
 = 
_bË
.
	`fšd
(
d¡
)) {

76 ià(
p
->
	`time¡amp_ªno
(è< 
d¡_šfo
.
	`v®ue
().
¡amp
 + 
	`Time¡amp
(
_timeout
, 0))

77 
ouÜt
 = 
d¡_šfo
.
	`v®ue
().
pÜt
;

79 
_bË
.
	`”a£
(
d¡_šfo
);

84 ià(
ouÜt
 < 0)

85 
	`brßdÿ¡
(
sourû
, 
p
);

86 ià(
ouÜt
 =ğ
sourû
)

87 
p
->
	`kl
();

89 
	`ouut
(
ouÜt
).
	`push
(
p
);

90 
	}
}

92 
SŒšg


93 
	gEth”Sw™ch
::
	$»ad”
(
EËm’t
* 
f
, *
thunk
)

95 
Eth”Sw™ch
* 
sw
 = (Eth”Sw™ch*)
f
;

96 (
šŒ_t
è
thunk
) {

98 
SŒšgAccum
 
§
;

99 
TabË
::
™”©Ü
 
™”
 = 
sw
->
_bË
.
	`begš
(); i‹r.
	`live
(); iter++)

100 
§
 << 
™”
.
	`key
(è<< ' ' << i‹r.
	`v®ue
().
pÜt
 << '\n';

101  
§
.
	`ke_¡ršg
();

104  
	`SŒšg
(
sw
->
_timeout
);

106  
	`SŒšg
();

108 
	}
}

111 
	gEth”Sw™ch
::
	$wr™”
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

113 
Eth”Sw™ch
 *
sw
 = (Eth”Sw™ch *è
e
;

114 ià(!
	`SecÚdsArg
().
	`·r£_§tu¿tšg
(
s
, 
sw
->
_timeout
))

115  
”rh
->
	`”rÜ
("expectedimeout (integer)");

117 
	}
}

120 
	gEth”Sw™ch
::
	$add_hªdËrs
()

122 
	`add_»ad_hªdËr
("bË", 
»ad”
, 0);

123 
	`add_»ad_hªdËr
("timeout", 
»ad”
, 1);

124 
	`add_wr™e_hªdËr
("timeout", 
wr™”
, 0);

125 
	}
}

127 
	$EXPORT_ELEMENT
(
Eth”Sw™ch
)

128 
CLICK_ENDDECLS


	@etherswitch/etherswitch.hh

1 #iâdeà
CLICK_ETHERSWITCH_HH


2 
	#CLICK_ETHERSWITCH_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/hashbË.hh
>

6 
CLICK_DECLS


62 şas 
	cEth”Sw™ch
 : 
public
 
EËm’t
 {…ublic:

64 
	$Eth”Sw™ch
(è
CLICK_COLD
;

65 ~
	$Eth”Sw™ch
(è
CLICK_COLD
;

67 cÚ¡ *
	$şass_Çme
() const {  "EtherSwitch"; }

68 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2-/="; 
	}
}

69 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

70 cÚ¡ *
	$æow_code
(ècÚ¡ {  "#/[^#]"; 
	}
}

72 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

73 
	$add_hªdËrs
(è
CLICK_COLD
;

75 
	`push
(
pÜt
, 
Pack‘
* 
p
);

77 
	sAddrInfo
 {

78 
pÜt
;

79 
Time¡amp
 
¡amp
;

80 
šlše
 
	`AddrInfo
(
p
, cÚ¡ 
Time¡amp
 &
t
);

81 
	}
};

83 
	g´iv©e
:

85 
HashTabË
<
	tEth”Add»ss
, 
	tAddrInfo
> 
	tTabË
;

86 
TabË
 
	g_bË
;

87 
ušt32_t
 
	g_timeout
;

89 
brßdÿ¡
(
sourû
, 
Pack‘
*);

91 
SŒšg
 
»ad”
(
EËm’t
 *, *);

92 
wr™”
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

93 
ä›nd
 
şass
 
	gLi¡’Eth”Sw™ch
;

97 
šlše


98 
	gEth”Sw™ch
::
AddrInfo
::
	$AddrInfo
(
p
, cÚ¡ 
Time¡amp
& 
s
)

99 : 
	`pÜt
(
p
), 
	$¡amp
(
s
)

101 
	}
}

103 
	gCLICK_ENDDECLS


	@etherswitch/listenetherswitch.cc

20 
	~<şick/cÚfig.h
>

21 
	~"li¡’‘h”sw™ch.hh
"

22 
	~<şickÃt/‘h”.h
>

23 
	~<şick/‘h”add»ss.hh
>

24 
	~<şick/glue.hh
>

25 
CLICK_DECLS


27 
	gLi¡’Eth”Sw™ch
::
	$Li¡’Eth”Sw™ch
()

29 
	}
}

31 
Li¡’Eth”Sw™ch
::~
	$Li¡’Eth”Sw™ch
()

33 
	}
}

36 
Li¡’Eth”Sw™ch
::
	$push
(
sourû
, 
Pack‘
 *
p
)

38 cÚ¡ 
şick_‘h”
* 
e
 = (cÚ¡ click_‘h”*è
p
->
	`d©a
();

39 
ouÜt
 = -1;

42 ià(
_timeout
 != 0) {

43 
_bË
.
	`£t
(
	`Eth”Add»ss
(
e
->
‘h”_sho¡
), 
	`AddrInfo
(
sourû
, 
p
->
	`time¡amp_ªno
()));

47 
Eth”Add»ss
 
	`d¡
(
e
->
‘h”_dho¡
);

48 ià(!
d¡
.
	`is_group
()) {

49 ià(
TabË
::
™”©Ü
 
d¡_šfo
 = 
_bË
.
	`fšd
(
d¡
)) {

50 ià(
p
->
	`time¡amp_ªno
(è< 
d¡_šfo
.
	`v®ue
().
¡amp
 + 
	`Time¡amp
(
_timeout
, 0))

51 
ouÜt
 = 
d¡_šfo
.
	`v®ue
().
pÜt
;

53 
_bË
.
	`”a£
(
d¡_šfo
);

58 ià(
ouÜt
 < 0)

59 
	`brßdÿ¡
(
sourû
, 
p
);

60 ià(
ouÜt
 =ğ
sourû
)

61 
	`ouut
(
	`nouuts
(è- 1).
	`push
(
p
);

63 
	`ouut
(
	`nouuts
(è- 1).
	`push
(
p
->
	`şÚe
());

64 
	`ouut
(
ouÜt
).
	`push
(
p
);

66 
	}
}

68 
	$ELEMENT_REQUIRES
(
Eth”Sw™ch
)

69 
	$EXPORT_ELEMENT
(
Li¡’Eth”Sw™ch
)

70 
CLICK_ENDDECLS


	@etherswitch/listenetherswitch.hh

1 #iâdeà
CLICK_LISTENETHERSWITCH_HH


2 
	#CLICK_LISTENETHERSWITCH_HH


	)

3 
	~"‘h”sw™ch.hh
"

4 
CLICK_DECLS


28 şas 
	cLi¡’Eth”Sw™ch
 : 
public
 
Eth”Sw™ch
 {…ublic:

30 
	$Li¡’Eth”Sw™ch
(è
CLICK_COLD
;

31 ~
	$Li¡’Eth”Sw™ch
(è
CLICK_COLD
;

33 cÚ¡ *
	$şass_Çme
() const {  "ListenEtherSwitch"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/=+"; 
	}
}

36 
push
(
pÜt
, 
Pack‘
* 
p
);

40 
	gCLICK_ENDDECLS


	@etherswitch/spantree.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¥ªŒ“.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/‘h”add»ss.hh
>

23 
	~"–em’ts/¡ªd¬d/suµ»ssÜ.hh
"

24 
	~<şick/”rÜ.hh
>

25 
CLICK_DECLS


27 
	gEth”S·nT»e
::
	$Eth”S·nT»e
()

28 : 
	`_šput_sup
(0), 
	`_ouut_sup
(0), 
	`_tİŞogy_chªge
(0),

29 
	`_bridge_´iÜ™y
(0xdead),

30 
	`_lÚg_ÿche_timeout
(5*60),

31 
	$_h–lo_tim”
(
h–lo_hook
, 
this
)

33 
	}
}

35 
	gEth”S·nT»e
::~
	$Eth”S·nT»e
()

37 
	}
}

40 
Eth”S·nT»e
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

42 
	g_pÜt
.
»size
(
nouuts
());

44 ià(
Args
(
cÚf
, 
this
, 
”rh
)

45 .
»ad_mp
("ADDR", 
Eth”Add»ssArg
(), 
_addr
)

46 .
»ad_mp
("INPUT_SUPPRESSOR", 
EËm’tCa¡Arg
("Suµ»ssÜ"), 
_šput_sup
)

47 .
»ad_mp
("OUTPUT_SUPPRESSOR", 
EËm’tCa¡Arg
("Suµ»ssÜ"), 
_ouut_sup
)

48 .
»ad_mp
("SWITCH", 
EËm’tCa¡Arg
("Eth”Sw™ch"), 
_sw™ch
)

49 .
com¶‘e
() < 0)

52 
memıy
(&
_bridge_id
, 
_addr
, 6);

57 
	gEth”S·nT»e
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

59 
i
 = 0; i < 
_pÜt
.
	`size
(); i++) {

60 
	`£t_¡©e
(
i
, 
FORWARD
);

62 
_be¡
.
	`»£t
(((
ušt64_t
)
_bridge_´iÜ™y
 << 48è| 
_bridge_id
);

63 
_h–lo_tim”
.
	`š™Ÿlize
(
this
);

64 
_h–lo_tim”
.
	`scheduË_aá”_m£c
(
_be¡
.
_h–lo_time
 * 1000);

66 
	}
}

68 
SŒšg


69 
	gEth”S·nT»e
::
	$»ad_msgs
(
EËm’t
* 
f
, *) {

70 
Eth”S·nT»e
* 
sw
 = (Eth”S·nT»e*)
f
;

71 
SŒšg
 
s
;

72 
i
 = 0; i < 
sw
->
_pÜt
.
	`size
(); i++) {

73 
s
 +ğ
sw
->
_pÜt
[
i
].
msg
.
	`s
() + "\n";

75 
s
 +ğ
sw
->
_be¡
.
	`s
() + "\n";

76  
s
;

77 
	}
}

80 
	gEth”S·nT»e
::
	$add_hªdËrs
()

82 
	`add_»ad_hªdËr
("msgs", 
»ad_msgs
, 0);

83 
	}
}

86 
	gEth”S·nT»e
::
	$³riodic
() {

88 
Time¡amp
 
cutoff
 = Time¡amp::
	`now
(è- 
	`Time¡amp
(
_be¡
.
_fÜw¬d_d–ay
);

90 
i
 = 0; i < 
_pÜt
.
	`size
(); i++) {

91 ià(
_pÜt
[
i
].
¡©e
 =ğ
LISTEN
 || _pÜt[i].¡©=ğ
LEARN
)

92 ià(
_pÜt
[
i
].
sšû
 < 
cutoff
) {

93 
	`£t_¡©e
(
i
, 
FORWARD
);

97 
	`expœe
();

98 
	`fšd_Œ“
();

99 
	}
}

101 
boŞ


102 
	gEth”S·nT»e
::
	$expœe
() {

103 
Time¡amp
 
t
 = Time¡amp::
	`now
(è- 
	`Time¡amp
(
_be¡
.
_max_age
);

105 
boŞ
 
expœed
 = 
çl£
;

106 
i
 = 0; i < 
_pÜt
.
	`size
(); i++) {

107 ià(
_pÜt
[
i
].
msg
.
	`expœe
(
t
)) {

108 
expœed
 = 
Œue
;

109 
	`şick_ch©‹r
("Expœšg mes§gÚ…Üˆ%d", 
i
);

112  
expœed
;

113 
	}
}

117 
	gEth”S·nT»e
::
	$fšd_Œ“
() {

120 
roÙ_pÜt
 = -1;

121 
ušt64_t
 
my_id
 = ((ušt64_t)
_bridge_´iÜ™y
 << 48è| 
_bridge_id
;

122 
_be¡
.
	`»£t
(
my_id
);

123 
i
 = 0; i < 
_pÜt
.
	`size
(); i++) {

125 
_pÜt
[
i
].
msg
.
_co¡
++;

126 ià(
_be¡
.
	`com·»
(&
_pÜt
[
i
].
msg
) < 0) {

127 
_be¡
 = 
_pÜt
[
i
].
msg
;

128 
roÙ_pÜt
 = 
i
;

130 
_pÜt
[
i
].
msg
.
_co¡
--;

135 
i
 = 0; i < 
_pÜt
.
	`size
(); i++) {

138 ià(
i
 =ğ
roÙ_pÜt
) {

139 ià(
_pÜt
[
i
].
¡©e
 =ğ
BLOCK
)

140 
	`£t_¡©e
(
i
, 
FORWARD
);

147 
cmp
 = 
_be¡
.
	`com·»
(&
_pÜt
[
i
].
msg
, 
my_id
, i);

148 ià(
cmp
 < 0)

149 
	`£t_¡©e
(
i
, 
BLOCK
);

150 ià(
_pÜt
[
i
].
¡©e
 =ğ
BLOCK
)

151 
	`£t_¡©e
(
i
, 
FORWARD
);

153 
	}
}

156 
boŞ


157 
	gEth”S·nT»e
::
	$£t_¡©e
(
i
, 
PÜtS‹
 
¡©e
)

159 
	`as£¹
(
¡©e
 !ğ
LISTEN
);

160 
	`as£¹
(
¡©e
 !ğ
LEARN
);

162 ià(
_pÜt
[
i
].
¡©e
 == state)

163  
çl£
;

165 ià(
¡©e
 =ğ
FORWARD
) {

166 ià(
_pÜt
[
i
].
¡©e
 =ğ
BLOCK
) {

167 
	`şick_ch©‹r
("S‘tšg s’d_tc_msg: BLOCK -> FORWARD oÀ%d", 
i
);

168 
_£nd_tc_msg
 = 
Œue
;

171 
¡©e
 = (
PÜtS‹
)(
_pÜt
[
i
].state+1);

175 
	`şick_ch©‹r
("S‘tšg s’d_tc_msg: FORWARD -> BLOCK oÀ%d", 
i
);

176 
_£nd_tc_msg
 = 
Œue
;

179 
	`şick_ch©‹r
("Chªgšg…Üˆ%d from %dØ%d", 
i
, 
_pÜt
[i].
¡©e
, state);

181 
_pÜt
[
i
].
¡©e
 = state;

182 
_pÜt
[
i
].
sšû
 = 
Time¡amp
::
	`now
();

185 
¡©e
) {

186 
BLOCK
:

187 
LISTEN
:

188 
_šput_sup
->
	`suµ»ss
(
i
);

189 
_ouut_sup
->
	`suµ»ss
(
i
);

191 
LEARN
:

192 
_šput_sup
->
	`®low
(
i
);

193 
_ouut_sup
->
	`suµ»ss
(
i
);

195 
FORWARD
:

196 
_šput_sup
->
	`®low
(
i
);

197 
_ouut_sup
->
	`®low
(
i
);

201  
Œue
;

202 
	}
}

206 
	gEth”S·nT»e
::
	$push
(
sourû
, 
Pack‘
* 
p
) {

207 cÚ¡ 
BridgeMes§ge
::
wœe
* 
msg
 =

208 
»š‹½»t_ÿ¡
<cÚ¡ 
BridgeMes§ge
::
wœe
*>(
p
->
	`d©a
());

212 
cmp
 = 
_pÜt
[
sourû
].
msg
.
	`com·»
(msg);

214 ià(
cmp
 <= 0) {

215 
_pÜt
[
sourû
].
msg
.
	`äom_wœe
(msg);

216 
_£nd_tc_msg
 &ğ!
msg
->
tÿ
;

219 
	`fšd_Œ“
();

221 
p
->
	`kl
();

222 
	}
}

225 
	gEth”S·nT»e
::
	$h–lo_hook
(
Tim”
 *, *
thunk
)

227 
Eth”S·nT»e
 *
e
 = (Eth”S·nT»*)
thunk
;

228 
e
->
	`³riodic
();

229 
i
 = 0; i < 
e
->
	`nouuts
(); i++) {

230 
Pack‘
* 
p
 = 
e
->
	`g’”©e_·ck‘
(
i
);

231 ià(
p
è
e
->
	`ouut
(
i
).
	`push
(p);

233 
e
->
_h–lo_tim”
.
	`scheduË_aá”_m£c
Ó->
_be¡
.
_h–lo_time
 * 1000);

234 
	}
}

236 
Pack‘
*

237 
	gEth”S·nT»e
::
	$g’”©e_·ck‘
(
ouut
)

242 
cmp
 = 
_be¡
.
	`com·»
(&
_pÜt
[
ouut
].
msg
);

244 ià(
cmp
 < 0) {

253 ià(
cmp
 =ğ0 && !
_£nd_tc_msg
) {

258 
Wr™abËPack‘
* 
p
 = 
Pack‘
::
	`make
((
BridgeMes§ge
::
wœe
));

259 
BridgeMes§ge
::
wœe
* 
msg
 = 
»š‹½»t_ÿ¡
<BridgeMes§ge::wœe*>(
p
->
	`d©a
());

261 ià(
cmp
 == 0) {

263 
BridgeMes§ge
::
	`fl_tcm
(
msg
);

266 
_be¡
.
	`to_wœe
(
msg
);

267 
msg
->
bridge_id
 = 
	`htÚq
(((
ušt64_t
)
_bridge_´iÜ™y
 << 48è| 
_bridge_id
);

268 
msg
->
pÜt_id
 = 
	`htÚs
(
ouut
);

269 ià(
_tİŞogy_chªge
) {

270 
Time¡amp
 
cutoff
 = Time¡amp::
	`now
(è- 
	`Time¡amp
(
_be¡
.
_fÜw¬d_d–ay
 + _be¡.
_max_age
);

271 ià(*
_tİŞogy_chªge
 < 
cutoff
) {

272 
d–‘e
 
_tİŞogy_chªge
;

273 
_tİŞogy_chªge
 = 0;

275 
msg
->
tc
 = 1;

278 ià(
_pÜt
[
ouut
].
Ãeds_tÿ
) {

279 
_pÜt
[
ouut
].
Ãeds_tÿ
 = 
çl£
;

280 
msg
->
tÿ
 = 1;

283 
	`memıy
(
msg
->
¤c
, 
_addr
, 6);

284  
p
;

285 
	}
}

287 
CLICK_ENDDECLS


288 
	$EXPORT_ELEMENT
(
Eth”S·nT»e
)

289 
	`ELEMENT_REQUIRES
(
Suµ»ssÜ
 
Eth”Sw™chBridgeMes§ge
)

	@etherswitch/spantree.hh

1 #iâdeà
CLICK_SPANTREE_HH


2 
	#CLICK_SPANTREE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"bridgemes§ge.hh
"

5 
	~<şick/tim”.hh
>

6 
CLICK_DECLS


7 
şass
 
	gSuµ»ssÜ
;

8 
şass
 
	gEth”Sw™ch
;

57 şas 
	cEth”S·nT»e
 : 
public
 
EËm’t
 {

59 
public
:

60 
	$Eth”S·nT»e
(è
CLICK_COLD
;

61 ~
	$Eth”S·nT»e
(è
CLICK_COLD
;

63 cÚ¡ *
	$şass_Çme
() const {  "EtherSpanTree"; }

64 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/="; 
	}
}

65 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

67 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

68 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

70 
SŒšg
 
	`»ad_msgs
(
EËm’t
* 
f
, *);

71 
	$add_hªdËrs
(è
CLICK_COLD
;

74 
	`³riodic
();

76 
boŞ
 
	`expœe
();

77 
	`fšd_be¡
();

78 
	`fšd_Œ“
();

80 
	`push
(
pÜt
, 
Pack‘
* 
p
);

81 
Pack‘
* 
	`g’”©e_·ck‘
(
ouut
);

83 
´iv©e
:

84 
Suµ»ssÜ
* 
_šput_sup
;

85 
Suµ»ssÜ
* 
_ouut_sup
;

86 
Eth”Sw™ch
* 
_sw™ch
;

87 
Time¡amp
* 
_tİŞogy_chªge
;

88 
boŞ
 
_£nd_tc_msg
;

90 
ušt64_t
 
_bridge_id
;

92 
ušt16_t
 
_bridge_´iÜ™y
;

93 
ušt16_t
 
_lÚg_ÿche_timeout
;

95 
ušt8_t
 
_addr
[6];

97 
BridgeMes§ge
 
_be¡
;

101 
	ePÜtS‹
 {
BLOCK
, 
LISTEN
, 
LEARN
, 
FORWARD
};

102 
	sPÜtInfo
 {

103 
PÜtS‹
 
	g¡©e
;

104 
Time¡amp
 
	gsšû
;

105 
boŞ
 
	gÃeds_tÿ
;

106 
BridgeMes§ge
 
	gmsg
;

107 
PÜtInfo
(è{ 
	g¡©e
 = 
BLOCK
; 
	gÃeds_tÿ
 = 
çl£
; }

110 
boŞ
 
£t_¡©e
(
i
, 
PÜtS‹
 
¡©e
);

112 
	gVeùÜ
<
	gPÜtInfo
> 
	g_pÜt
;

114 
Tim”
 
	g_h–lo_tim”
;

115 
h–lo_hook
(
Tim”
 *, *);

119 
	gCLICK_ENDDECLS


	@grid/ackresponder.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/glue.hh
>

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/·ck‘.hh
>

23 
	~"ack»¥Úd”.hh
"

24 
CLICK_DECLS


26 
	gACKRe¥Úd”
::
	$ACKRe¥Úd”
()

28 
	}
}

30 
ACKRe¥Úd”
::~
	$ACKRe¥Úd”
()

32 
	}
}

34 
Pack‘
 *

35 
ACKRe¥Úd”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

37 
şick_‘h”
 *
e
 = (şick_‘h” *è
p
->
	`d©a
();

38 
Eth”Add»ss
 
	`de¡
(
e
->
‘h”_dho¡
);

39 ià(
de¡
 =ğ
_‘h
) {

40 
Wr™abËPack‘
 *
xp
 = 
Pack‘
::
	`make
((
şick_‘h”
) + 2);

41 
xp
->
	`puÎ
(2);

42 
şick_‘h”
 *
‘h
 = (şick_‘h” *è
xp
->
	`d©a
();

43 
‘h
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_GRID_ACK
);

44 
	`memıy
(
‘h
->
‘h”_sho¡
, 
e
->
‘h”_dho¡
, 6);

45 
	`memıy
(
‘h
->
‘h”_dho¡
, 
e
->
‘h”_sho¡
, 6);

46 
	`ouut
(1).
	`push
(
xp
);

48  
p
;

49 
	}
}

52 
	gACKRe¥Úd”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

54  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("ETH", 
_‘h
).
com¶‘e
();

57 
CLICK_ENDDECLS


58 
EXPORT_ELEMENT
(
ACKRe¥Úd”
)

	@grid/ackresponder.hh

1 #iâdeà
CLICK_ACKRESPONDER_HH


2 
	#CLICK_ACKRESPONDER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	gCLICK_DECLS


23 
	#ETHERTYPE_GRID_ACK
 0x7fç

	)

25 şas 
	cACKRe¥Úd”
 : 
public
 
EËm’t
 {

26 
public
:

27 
	$ACKRe¥Úd”
(è
CLICK_COLD
;

28 ~
	$ACKRe¥Úd”
(è
CLICK_COLD
;

30 cÚ¡ *
	$şass_Çme
() const {  "ACKResponder"; }

31 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/2"; 
	}
}

32 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

33 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/xy"; 
	}
}

35 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

37 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

39 
	g´iv©e
:

40 
Eth”Add»ss
 
_‘h
;

43 
	gCLICK_ENDDECLS


	@grid/ackresponder2.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/glue.hh
>

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/·ck‘.hh
>

23 
	~"ack»¥Úd”2.hh
"

24 
CLICK_DECLS


26 
	gACKRe¥Úd”2
::
	$ACKRe¥Úd”2
()

28 
	}
}

30 
ACKRe¥Úd”2
::~
	$ACKRe¥Úd”2
()

32 
	}
}

34 
Pack‘
 *

35 
ACKRe¥Úd”2
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

37 
IPAdd»ss
 
	`¤c
(
p
->
	`d©a
());

38 
IPAdd»ss
 
	`d¡
(
p
->
	`d©a
() + 4);

40 ià(
d¡
 =ğ
_
) {

41 
Wr™abËPack‘
 *
xp
 = 
Pack‘
::
	`make
(8);

42 
	`memıy
(
xp
->
	`d©a
(), 
_
.data(), 4);

43 
	`memıy
(
xp
->
	`d©a
(è+ 4, 
¤c
.data(), 4);

44 
	`ouut
(1).
	`push
(
xp
);

46 
p
->
	`puÎ
(8);

47  
p
;

48 
	}
}

51 
	gACKRe¥Úd”2
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

53  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("IP", 
_
).
com¶‘e
();

56 
CLICK_ENDDECLS


57 
EXPORT_ELEMENT
(
ACKRe¥Úd”2
)

	@grid/ackresponder2.hh

1 #iâdeà
CLICK_ACKRESPONDER2_HH


2 
	#CLICK_ACKRESPONDER2_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/add»ss.hh
>

5 
CLICK_DECLS


28 şas 
	cACKRe¥Úd”2
 : 
public
 
EËm’t
 {

29 
public
:

30 
ACKRe¥Úd”2
();

31 ~
ACKRe¥Úd”2
();

33 cÚ¡ *
	$şass_Çme
() const {  "ACKResponder2"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/2"; 
	}
}

35 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

36 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/xy"; 
	}
}

38 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

40 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

42 
	g´iv©e
:

43 
IPAdd»ss
 
_
;

46 
	gCLICK_ENDDECLS


	@grid/ackretrysender.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/glue.hh
>

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/·ck‘.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~"ack»Œy£nd”.hh
"

27 
	~"ack»¥Úd”.hh
"

28 
CLICK_DECLS


30 
	gACKR‘ryS’d”
::
	$ACKR‘ryS’d”
()

31 : 
	`_timeout
(0), 
	`_max_Œ›s
(0),

32 
	`_num_Œ›s
(0), 
	`_hi¡Üy_Ëngth
(500),

33 
	`_wa™šg_·ck‘
(0), 
	`_v”bo£
(
Œue
),

34 
	`_tim”
(
this
), 
	$_sk
(
this
)

36 
	}
}

38 
	gACKR‘ryS’d”
::~
	$ACKR‘ryS’d”
()

40 
	}
}

43 
ACKR‘ryS’d”
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

45 
	`as£¹
(
pÜt
 == 1);

46 
	`check
();

48 ià(!
_wa™šg_·ck‘
) {

50 ià(
_v”bo£
)

51 
	`şick_ch©‹r
("ACKR‘ryS’d” %s: gÙ uÃx³ùed ACK", 
	`Çme
().
	`c_¡r
());

52 
p
->
	`kl
();

56 
şick_‘h”
 *
e_ack
 = (şick_‘h” *è
p
->
	`d©a
();

57 ià(
	`Áohs
(
e_ack
->
‘h”_ty³
è!ğ
ETHERTYPE_GRID_ACK
) {

58 
	`şick_ch©‹r
("ACKR‘ryS’d” %d: gÙ‚Ú-ACK…ack‘ oÀ£cÚd iÅut", 
	`Çme
().
	`c_¡r
());

59 
p
->
	`kl
();

64 
şick_‘h”
 *
e_wa™šg
 = (şick_‘h” *è
_wa™šg_·ck‘
->
	`d©a
();

65 ià(
	`memcmp
(
e_ack
->
‘h”_sho¡
, 
e_wa™šg
->
‘h”_dho¡
, 6) ||

66 
	`memcmp
(
e_ack
->
‘h”_dho¡
, 
e_wa™šg
->
‘h”_sho¡
, 6)) {

68 ià(
_v”bo£
)

69 
	`şick_ch©‹r
("ACKR‘ryS’d” %s: gÙ ACK fÜ wrÚg…ack‘", 
	`Çme
().
	`c_¡r
());

70 
p
->
	`kl
();

75 
_hi¡Üy
.
	`push_back
(
	`tx_»suÉ_t
(
_wa™šg_·ck‘
->
	`time¡amp_ªno
(),

76 
_num_Œ›s
, 
Œue
));

77 
_hi¡Üy
.
	`size
(è> (è
_hi¡Üy_Ëngth
)

78 
_hi¡Üy
.
	`pİ_äÚt
();

79 
_wa™šg_·ck‘
->
	`kl
();

80 
_wa™šg_·ck‘
 = 0;

81 
_num_Œ›s
 = 0;

82 
_tim”
.
	`unscheduË
();

83 
p
->
	`kl
();

85 
	`check
();

86 
	}
}

88 
boŞ


89 
	gACKR‘ryS’d”
::
	$run_sk
(
Task
 *)

91 
	`check
();

93 
_sk
.
	`ç¡_»scheduË
();

95 ià(
_wa™šg_·ck‘
)

96  
Œue
;

98 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

99 ià(!
p
)

100  
Œue
;

102 ià(
_max_Œ›s
 > 1) {

103 
_wa™šg_·ck‘
 = 
p
->
	`şÚe
();

104 
_num_Œ›s
 = 1;

105 
_tim”
.
	`scheduË_aá”_m£c
(
_timeout
);

108 
	`check
();

110 
	`ouut
(0).
	`push
(
p
);

111  
Œue
;

112 
	}
}

115 
	gACKR‘ryS’d”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

117 
	g_max_Œ›s
 = 16;

118 
	g_timeout
 = 10;

119 
	g_v”bo£
 = 
Œue
;

120 
	g_hi¡Üy_Ëngth
 = 500;

121 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

122 .
»ad
("MAX_TRIES", 
_max_Œ›s
)

123 .
»ad
("TIMEOUT", 
_timeout
)

124 .
»ad
("VERBOSE", 
_v”bo£
)

125 .
»ad
("HISTORY_LEN", 
_hi¡Üy_Ëngth
)

126 .
com¶‘e
();

128 ià(
	g»s
 < 0)

129  
	g»s
;

131 ià(
	g_timeout
 == 0)

132  
”rh
->
”rÜ
("TIMEOUT must be > 0");

133 ià(
	g_max_Œ›s
 == 0)

134  
”rh
->
”rÜ
("MAX_TRIES must be > 0");

140 
	gACKR‘ryS’d”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

142 
_tim”
.
	`š™Ÿlize
(
this
);

143 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

145 
	`check
();

147 
	}
}

150 
	gACKR‘ryS’d”
::
	$run_tim”
(
Tim”
 *)

152 
	`as£¹
(
_wa™šg_·ck‘
 && !
_tim”
.
	`scheduËd
());

154 
Pack‘
 *
p
 = 
_wa™šg_·ck‘
;

156 ià(
_num_Œ›s
 >ğ
_max_Œ›s
) {

157 
_hi¡Üy
.
	`push_back
(
	`tx_»suÉ_t
(
p
->
	`time¡amp_ªno
(), 
_num_Œ›s
, 
çl£
));

158 
_hi¡Üy
.
	`size
(è> (è
_hi¡Üy_Ëngth
)

159 
_hi¡Üy
.
	`pİ_äÚt
();

160 
_wa™šg_·ck‘
->
	`kl
();

161 
_wa™šg_·ck‘
 = 
p
 = 0;

162 
_num_Œ›s
 = 0;

165 
_tim”
.
	`scheduË_aá”_m£c
(
_timeout
);

166 
_wa™šg_·ck‘
 = 
p
->
	`şÚe
();

167 
_num_Œ›s
++;

170 
	`check
();

172 ià(
p
)

173 
	`ouut
(0).
	`push
(
p
);

174 
	}
}

177 
	gACKR‘ryS’d”
::
	$check
()

183 
	`as£¹
(
_wa™šg_·ck‘
 ? 
_tim”
.
	`scheduËd
() : !_timer.scheduled());

186 
	`as£¹
(
_num_Œ›s
 <ğ
_max_Œ›s
);

189 
	`as£¹
(
_wa™šg_·ck‘
 ? 
_num_Œ›s
 >= 1 : _num_tries == 0);

190 
	}
}

193 
	gACKR‘ryS’d”
::
	$add_hªdËrs
()

195 
	`add_»ad_hªdËr
("hi¡Üy", 
´št_hi¡Üy
, 0);

196 
	`add_»ad_hªdËr
("summ¬y", 
´št_summ¬y
, 0);

197 
	`add_wr™e_hªdËr
("ş—r", 
ş—r_hi¡Üy
, 0);

198 
	}
}

200 
SŒšg


201 
	gACKR‘ryS’d”
::
	$´št_hi¡Üy
(
EËm’t
 *
e
, *)

203 
ACKR‘ryS’d”
 *
a
 = (ACKR‘ryS’d” *è
e
;

204 
SŒšgAccum
 
s
;

205 
ACKR‘ryS’d”
::
Hi¡Q
::
cÚ¡_™”©Ü
 
i
 = 
a
->
_hi¡Üy
.
	`begš
();

206 
i
 !ğ
a
->
_hi¡Üy
.
	`’d
(); i++)

207 
s
 << 
i
->
pkt_time
 << "\t" << i->
num_tx
 << "\t"

208 << (
i
->
sucûss
 ? "succ" : "fail") << "\n";

209  
s
.
	`ke_¡ršg
();

210 
	}
}

212 
SŒšg


213 
	gACKR‘ryS’d”
::
	$´št_summ¬y
(
EËm’t
 *
e
, *)

215 
ACKR‘ryS’d”
 *
a
 = (ACKR‘ryS’d” *è
e
;

216 
num_succ
 = 0;

217 
num_ç
 = 0;

218 
sum_tx
 = 0;

219 
max_tx
 = 0;

220 
mš_tx
 = 0;

221 
n
 = 
a
->
_hi¡Üy
.
	`size
();

223 
ACKR‘ryS’d”
::
Hi¡Q
::
cÚ¡_™”©Ü
 
i
 = 
a
->
_hi¡Üy
.
	`begš
();

224 
i
 !ğ
a
->
_hi¡Üy
.
	`’d
(); i++) {

225 ià(
sum_tx
 == 0)

226 
max_tx
 = 
mš_tx
 = 
i
->
num_tx
;

228 
max_tx
 = max_tx > 
i
->
num_tx
 ? max_tx : i->num_tx;

229 
mš_tx
 = mš_tx < 
i
->
num_tx
 ? min_tx : i->num_tx;

231 ià(
i
->
sucûss
)

232 
num_succ
++;

234 
num_ç
++;

235 
sum_tx
 +ğ
i
->
num_tx
;

238 
txc
 = 0;

239 ià(
n
 > 0)

240 
txc
 = (1000 * 
sum_tx
è/ 
n
;

242 
SŒšgAccum
 
s
;

243 
s
 << "·ck‘s: " << 
n
 << "\n"

244 << "sucûss: " << 
num_succ
 << "\n"

245 << "ç: " << 
num_ç
 << "\n"

246 << "mš_txc: " << 
mš_tx
 << "\n"

247 << "max_txc: " << 
max_tx
 << "\n"

248 << "avg_txc: " << 
	`ı_uÅ¬£_»®10
(
txc
, 3) << "\n";

249  
s
.
	`ke_¡ršg
();

250 
	}
}

253 
	gACKR‘ryS’d”
::
	$ş—r_hi¡Üy
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

255 
ACKR‘ryS’d”
 *
a
 = (ACKR‘ryS’d” *è
e
;

256 
a
->
_hi¡Üy
.
	`ş—r
();

258 
	}
}

260 
CLICK_ENDDECLS


261 
EXPORT_ELEMENT
(
ACKR‘ryS’d”
)

	@grid/ackretrysender.hh

1 #iâdeà
CLICK_ACKRETRYSENDER_HH


2 
	#CLICK_ACKRETRYSENDER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/·ck‘.hh
>

6 
	~<şick/sk.hh
>

7 
	~<şick/tim”.hh
>

8 
	~<şick/deque.hh
>

9 
CLICK_DECLS


66 şas 
	cACKR‘ryS’d”
 : 
public
 
EËm’t
 {

67 
public
:

68 
	$ACKR‘ryS’d”
(è
CLICK_COLD
;

69 ~
	$ACKR‘ryS’d”
(è
CLICK_COLD
;

71 cÚ¡ *
	$şass_Çme
() const {  "ACKRetrySender"; }

72 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/-"; 
	}
}

73 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "Ï/hh"; 
	}
}

74 cÚ¡ *
	$æow_code
(ècÚ¡ {  "xy/xx"; 
	}
}

76 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

77 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

79 
boŞ
 
	`run_sk
(
Task
 *);

80 
	`run_tim”
(
Tim”
 *);

81 
	`push
(, 
Pack‘
 *);

83 
	$add_hªdËrs
(è
CLICK_COLD
;

85 
´iv©e
:

86 
_timeout
;

87 
_max_Œ›s
;

88 
_num_Œ›s
;

89 
_hi¡Üy_Ëngth
;

91 
	stx_»suÉ_t
 {

92 
	`tx_»suÉ_t
(cÚ¡ 
Time¡amp
 &
t
, 
n
, 
boŞ
 
s
)

93 : 
	`pkt_time
(
t
), 
	`num_tx
(
n
), 
	`sucûss
(
s
) { }

94 
Time¡amp
 
pkt_time
;

95 
num_tx
;

96 
boŞ
 
sucûss
;

97 
	}
};

99 
	gDeque
<
	ttx_»suÉ_t
> 
	tHi¡Q
;

100 
Hi¡Q
 
	g_hi¡Üy
;

102 
Pack‘
 *
	g_wa™šg_·ck‘
;

103 
boŞ
 
	g_v”bo£
;

105 
Tim”
 
	g_tim”
;

106 
Task
 
	g_sk
;

108 
check
();

110 
SŒšg
 
´št_hi¡Üy
(
EËm’t
 *
e
, *);

111 
SŒšg
 
´št_summ¬y
(
EËm’t
 *
e
, *);

112 
ş—r_hi¡Üy
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

115 
	gCLICK_ENDDECLS


	@grid/ackretrysender2.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/glue.hh
>

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/·ck‘.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~"ack»Œy£nd”2.hh
"

27 
CLICK_DECLS


29 
	gACKR‘ryS’d”2
::
	$ACKR‘ryS’d”2
()

30 : 
	`_timeout
(0), 
	`_max_Œ›s
(0),

31 
	`_num_Œ›s
(0), 
	`_hi¡Üy_Ëngth
(500), 
	`_wa™šg_·ck‘
(0),

32 
	`_v”bo£
 (
Œue
), 
	`_tim”
(
this
), 
	`_sk
(this),

33 
	`sum_tx
(0), 
	`num_pkts
(0), 
	`num_ç
(0),

34 
	`max_txc
(0), 
	$mš_txc
(0)

36 
	}
}

38 
	gACKR‘ryS’d”2
::~
	$ACKR‘ryS’d”2
()

40 
	}
}

43 
ACKR‘ryS’d”2
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

45 
	`as£¹
(
pÜt
 == 1);

46 
	`check
();

48 ià(!
_wa™šg_·ck‘
) {

50 ià(
_v”bo£
)

51 
	`şick_ch©‹r
("ACKR‘ryS’d”2 %s: gÙ uÃx³ùed ACK", 
	`Çme
().
	`c_¡r
());

52 
p
->
	`kl
();

58 
IPAdd»ss
 
	`d¡
(
p
->
	`d©a
() + 4);

59 ià(
d¡
 !ğ
_
) {

61 ià(
_v”bo£
)

62 
	`şick_ch©‹r
("ACKR‘ryS’d”2 %s: gÙ ACK fÜ wrÚg…ack‘", 
	`Çme
().
	`c_¡r
());

63 
p
->
	`kl
();

68 
	`add_¡©
(
_wa™šg_·ck‘
->
	`time¡amp_ªno
(), 
_num_Œ›s
, 
Œue
);

69 
_wa™šg_·ck‘
->
	`kl
();

70 
_wa™šg_·ck‘
 = 0;

71 
_num_Œ›s
 = 0;

72 
_tim”
.
	`unscheduË
();

73 
p
->
	`kl
();

75 
	`check
();

76 
	}
}

78 
boŞ


79 
	gACKR‘ryS’d”2
::
	$run_sk
(
Task
 *)

81 
	`check
();

83 
_sk
.
	`ç¡_»scheduË
();

85 ià(
_wa™šg_·ck‘
)

86  
Œue
;

88 
Pack‘
 *
p_š
 = 
	`šput
(0).
	`puÎ
();

89 ià(!
p_š
)

90  
Œue
;

92 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`push
(8);

93 ià(!
p
)

94  
Œue
;

96 
	`memıy
(
p
->
	`d©a
(), 
_
.data(), 4);

97 
	`memıy
(
p
->
	`d©a
(è+ 4,…->
	`d¡__ªno
().data(), 4);

99 ià(
_max_Œ›s
 > 1) {

100 
_wa™šg_·ck‘
 = 
p
->
	`şÚe
();

101 
_num_Œ›s
 = 1;

102 
_tim”
.
	`scheduË_aá”_m£c
(
_timeout
);

105 
	`check
();

107 
	`ouut
(0).
	`push
(
p
);

108  
Œue
;

109 
	}
}

112 
	gACKR‘ryS’d”2
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

114 
	g_max_Œ›s
 = 16;

115 
	g_timeout
 = 10;

116 
	g_v”bo£
 = 
Œue
;

117 
	g_hi¡Üy_Ëngth
 = 500;

118 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

119 .
»ad
("IP", 
_
)

120 .
»ad
("MAX_TRIES", 
_max_Œ›s
)

121 .
»ad
("TIMEOUT", 
_timeout
)

122 .
»ad
("VERBOSE", 
_v”bo£
)

123 .
»ad
("HISTORY_LEN", 
_hi¡Üy_Ëngth
)

124 .
com¶‘e
();

126 ià(
	g»s
 < 0)

127  
	g»s
;

129 ià(
	g_timeout
 == 0)

130  
”rh
->
”rÜ
("TIMEOUT must be > 0");

131 ià(
	g_max_Œ›s
 == 0)

132  
”rh
->
”rÜ
("MAX_TRIES must be > 0");

133 ià(!
	g_
)

134  
	g”rh
->
”rÜ
("IP must be specified");

140 
	gACKR‘ryS’d”2
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

142 
_tim”
.
	`š™Ÿlize
(
this
);

143 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

145 
	`check
();

147 
	}
}

150 
	gACKR‘ryS’d”2
::
	$run_tim”
(
Tim”
 *)

152 
	`as£¹
(
_wa™šg_·ck‘
 && !
_tim”
.
	`scheduËd
());

154 
Pack‘
 *
p
 = 
_wa™šg_·ck‘
;

156 ià(
_num_Œ›s
 >ğ
_max_Œ›s
) {

157 
	`add_¡©
(
p
->
	`time¡amp_ªno
(), 
_num_Œ›s
, 
çl£
);

158 
_wa™šg_·ck‘
->
	`kl
();

159 
_wa™šg_·ck‘
 = 
p
 = 0;

160 
_num_Œ›s
 = 0;

163 
_tim”
.
	`scheduË_aá”_m£c
(
_timeout
);

164 
_wa™šg_·ck‘
 = 
p
->
	`şÚe
();

165 
_num_Œ›s
++;

168 
	`check
();

170 ià(
p
)

171 
	`ouut
(0).
	`push
(
p
);

172 
	}
}

175 
	gACKR‘ryS’d”2
::
	$check
()

181 
	`as£¹
(
_wa™šg_·ck‘
 ? 
_tim”
.
	`scheduËd
() : !_timer.scheduled());

184 
	`as£¹
(
_num_Œ›s
 <ğ
_max_Œ›s
);

187 
	`as£¹
(
_wa™šg_·ck‘
 ? 
_num_Œ›s
 >= 1 : _num_tries == 0);

188 
	}
}

191 
	gACKR‘ryS’d”2
::
	$add_hªdËrs
()

193 
	`add_»ad_hªdËr
("hi¡Üy", 
´št_hi¡Üy
, 0);

194 
	`add_»ad_hªdËr
("summ¬y", 
´št_summ¬y
, 0);

195 
	`add_wr™e_hªdËr
("ş—r", 
ş—r_hi¡Üy
, 0);

196 
	}
}

198 
SŒšg


199 
	gACKR‘ryS’d”2
::
	$´št_hi¡Üy
(
EËm’t
 *
e
, *)

201 
ACKR‘ryS’d”2
 *
a
 = (ACKR‘ryS’d”2 *è
e
;

202 
SŒšgAccum
 
s
;

203 
ACKR‘ryS’d”2
::
Hi¡Q
::
cÚ¡_™”©Ü
 
i
 = 
a
->
_hi¡Üy
.
	`begš
();

204 
i
 !ğ
a
->
_hi¡Üy
.
	`’d
(); i++)

205 
s
 << 
i
->
pkt_time
 << "\t" << i->
num_tx
 << "\t"

206 << (
i
->
sucûss
 ? "succ" : "fail") << "\n";

207  
s
.
	`ke_¡ršg
();

208 
	}
}

210 
SŒšg


211 
	gACKR‘ryS’d”2
::
	$´št_summ¬y
(
EËm’t
 *
e
, *)

213 
ACKR‘ryS’d”2
 *
a
 = (ACKR‘ryS’d”2 *è
e
;

215 
txc
 = 0;

216 ià(
a
->
num_pkts
 > 0)

217 
txc
 = (1000 * 
a
->
sum_tx
è/‡->
num_pkts
;

219 
SŒšgAccum
 
s
;

220 
s
 << "·ck‘s: " << 
a
->
num_pkts
 << "\n"

221 << "sucûss: " << 
a
->
num_pkts
 -‡->
num_ç
 << "\n"

222 << "ç: " << 
a
->
num_ç
 << "\n"

223 << "mš_txc: " << 
a
->
mš_txc
 << "\n"

224 << "max_txc: " << 
a
->
max_txc
 << "\n"

225 << "avg_txc: " << 
	`ı_uÅ¬£_»®10
(
txc
, 3) << "\n";

226  
s
.
	`ke_¡ršg
();

227 
	}
}

230 
	gACKR‘ryS’d”2
::
	$ş—r_hi¡Üy
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

232 
ACKR‘ryS’d”2
 *
a
 = (ACKR‘ryS’d”2 *è
e
;

233 
a
->
_hi¡Üy
.
	`ş—r
();

235 
	}
}

238 
	gACKR‘ryS’d”2
::
	$»£t_¡©s
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

240 
ACKR‘ryS’d”2
 *
a
 = (ACKR‘ryS’d”2 *è
e
;

241 
a
->
sum_tx
 = 0;

242 
a
->
num_pkts
 = 0;

243 
a
->
num_ç
 = 0;

244 
a
->
max_txc
 = 0;

245 
a
->
mš_txc
 = 0;

247 
	}
}

250 
	gACKR‘ryS’d”2
::
	$add_¡©
(cÚ¡ 
Time¡amp
 &
t
, 
num_tx
, 
boŞ
 
succ
)

252 
_hi¡Üy
.
	`push_back
(
	`tx_»suÉ_t
(
t
, 
num_tx
, 
succ
));

253 
_hi¡Üy
.
	`size
(è> (è
_hi¡Üy_Ëngth
)

254 
_hi¡Üy
.
	`pİ_äÚt
();

256 ià(
num_pkts
 == 0)

257 
max_txc
 = 
mš_txc
 = 
num_tx
;

259 
max_txc
 = (max_txø< 
num_tx
) ?‚um_tx : max_txc;

260 
mš_txc
 = (mš_txø> 
num_tx
) ?‚um_tx : min_txc;

263 
num_pkts
++;

264 
sum_tx
 +ğ
num_tx
;

265 ià(!
succ
)

266 
num_ç
++;

267 
	}
}

269 
CLICK_ENDDECLS


270 
EXPORT_ELEMENT
(
ACKR‘ryS’d”2
)

	@grid/ackretrysender2.hh

1 #iâdeà
CLICK_ACKRETRYSENDER2_HH


2 
	#CLICK_ACKRETRYSENDER2_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/·ck‘.hh
>

6 
	~<şick/sk.hh
>

7 
	~<şick/tim”.hh
>

8 
	~<şick/add»ss.hh
>

9 
	~<şick/deque.hh
>

10 
CLICK_DECLS


96 şas 
	cACKR‘ryS’d”2
 : 
public
 
EËm’t
 {

97 
public
:

98 
ACKR‘ryS’d”2
();

99 ~
ACKR‘ryS’d”2
();

101 cÚ¡ *
	$şass_Çme
() const {  "ACKRetrySender2"; }

102 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/-"; 
	}
}

103 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "Ï/hh"; 
	}
}

104 cÚ¡ *
	$æow_code
(ècÚ¡ {  "xy/xx"; 
	}
}

106 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

107 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

109 
boŞ
 
	`run_sk
(
Task
 *);

110 
	`run_tim”
(
Tim”
 *);

111 
	`push
(, 
Pack‘
 *);

113 
	$add_hªdËrs
(è
CLICK_COLD
;

115 
´iv©e
:

116 
_timeout
;

117 
_max_Œ›s
;

118 
_num_Œ›s
;

119 
_hi¡Üy_Ëngth
;

121 
	stx_»suÉ_t
 {

122 
	`tx_»suÉ_t
(cÚ¡ 
Time¡amp
 &
t
, 
n
, 
boŞ
 
s
)

123 : 
	`pkt_time
(
t
), 
	`num_tx
(
n
), 
	`sucûss
(
s
) { }

124 
Time¡amp
 
pkt_time
;

125 
num_tx
;

126 
boŞ
 
sucûss
;

127 
	}
};

129 
	gDeque
<
	ttx_»suÉ_t
> 
	tHi¡Q
;

130 
Hi¡Q
 
	g_hi¡Üy
;

132 
IPAdd»ss
 
	g_
;

134 
Pack‘
 *
	g_wa™šg_·ck‘
;

135 
boŞ
 
	g_v”bo£
;

137 
Tim”
 
	g_tim”
;

138 
Task
 
	g_sk
;

140 
	gsum_tx
;

141 
	gnum_pkts
;

142 
	gnum_ç
;

143 
	gmax_txc
, 
	gmš_txc
;

145 
check
();

147 
add_¡©
(cÚ¡ 
Time¡amp
 &
t
, 
num_tx
, 
boŞ
 
succ
);

149 
SŒšg
 
´št_hi¡Üy
(
EËm’t
 *
e
, *);

150 
SŒšg
 
´št_summ¬y
(
EËm’t
 *
e
, *);

151 
ş—r_hi¡Üy
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

152 
»£t_¡©s
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

155 
	gCLICK_ENDDECLS


	@grid/airoinfo.cc

18 
	~<şick/cÚfig.h
>

19 
	~<¡ddef.h
>

20 
	~"aœošfo.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şickÃt/‘h”.h
>

25 
	~<şick/glue.hh
>

26 
	~<şick/‘h”add»ss.hh
>

27 
	~"grid.hh
"

28 
	~<m©h.h
>

29 
	~<sys/ioùl.h
>

30 
	~<uni¡d.h
>

32 
	#ANLLFAIL


	)

33 
	#ANCACHE


	)

35 #ifdeà
__O³nBSD__


36 
	#FUCKED


	)

37 #ifdeà
FUCKED


38 
	~"/u¤/¤c/sys/dev/ic/ªv¬.h
"

40 
	~<dev/ic/ªv¬.h
>

44 #ifdeà
__lšux__


45 
	~<lšux/wœ–ess.h
>

46 #ifdeà
IW_MAX_SPY


47 #undeà
IW_MAX_SPY


48 
	#IW_MAX_SPY
 40

	)

55 
CLICK_DECLS


57 
	gAœoInfo
::
	$AœoInfo
()

58 : 
	`_fd
(-1)

60 
	}
}

62 
AœoInfo
::~
	$AœoInfo
()

64 ià(
_fd
 > -1)

65 
	`şo£
(
_fd
);

66 
	}
}

69 
	gAœoInfo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

71  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("DEVNAME", 
_iâame
).
com¶‘e
();

75 
	gAœoInfo
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

77 
	`mem£t
(&
_iä
, 0, (_ifr));

78 
	`¡ºıy
(
_iä
.
iä_Çme
, 
_iâame
.
	`c_¡r
(), (_ifr.ifr_name));

79 
_iä
.
iä_Çme
[(_ifr.ifr_name) - 1] = 0;

80 #ifdeà
__lšux__


81 
	`mem£t
(&
_iä2
, 0, (_ifr2));

82 
	`¡ºıy
(
_iä2
.
iä_Çme
, 
_iâame
.
	`c_¡r
(), (_ifr2.ifr_name));

83 
_iä2
.
iä_Çme
[(_ifr2.ifr_name) - 1] = 0;

86 
_fd
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

87 ià(
_fd
 < 0)

88  
”rh
->
	`”rÜ
("UÇbËØİ’ sock‘Ø% deviû", 
_iä
.
iä_Çme
);

91 
	}
}

94 #ifdeà
__O³nBSD__


95 
boŞ


96 
	gAœoInfo
::
	$g‘_sigÇl_šfo
(cÚ¡ 
Eth”Add»ss
 &
e
, &
dbm
, &
qu®™y
)

98 
ª_»q
 
¬eq
;

99 
	`mem£t
(&
¬eq
, 0, (areq));

101 
¬eq
.
ª_Ën
 = 
AN_MAX_DATALEN
;

102 
¬eq
.
ª_ty³
 = 
AN_RID_READ_CACHE
;

109 
_iä
.
iä_d©a
 = (*è&
¬eq
;

110 
»s
 = 
	`ioùl
(
_fd
, 
SIOCGAIRONET
, &
_iä
);

111 ià(
»s
 == -1) {

112 
	`şick_ch©‹r
("AiroInfo: ioctl(SIOCGAIRONET)ƒrror when„eading signal cache: %s\n",

113 
	`¡»¼Ü
(
”ºo
));

114  
çl£
;

117 *
num_’Œ›s
 = (*è&
¬eq
.
ª_v®
;

118 *
p
 = (*è&
¬eq
.
ª_v®
;

119 
p
 += ();

120 
ª_sigÿche
 *
’Œ›s
 = (ª_sigÿch*è
p
;

121 
i
 = 0; i < *
num_’Œ›s
; i++) {

122 ià(
e
 =ğ
	`Eth”Add»ss
((*è
’Œ›s
[
i
].
mac¤c
)) {

123 
dbm
 = 
’Œ›s
[
i
].
sigÇl
;

124 
qu®™y
 = 
’Œ›s
[
i
].quality;

125  
Œue
;

129  
çl£
;

130 
	}
}

132 
boŞ


133 
	gAœoInfo
::
	$g‘_tx_¡©s
(cÚ¡ 
Eth”Add»ss
 &
e
, &
num_sucûssful
, &
num_çed
)

135 
ª_»q
 
¬eq
;

136 
	`mem£t
(&
¬eq
, 0, (areq));

138 
¬eq
.
ª_Ën
 = 
AN_MAX_DATALEN
;

139 
¬eq
.
ª_ty³
 = 
AN_RID_READ_LLFAIL
;

141 
_iä
.
iä_d©a
 = (*è&
¬eq
;

142 
»s
 = 
	`ioùl
(
_fd
, 
SIOCGAIRONET
, &
_iä
);

143 ià(
»s
 == -1) {

144 
	`şick_ch©‹r
("AiroInfo: ioctl(SIOCGAIRONET)ƒrror when„eadingx stats cache: %s\n",

145 
	`¡»¼Ü
(
”ºo
));

146  
çl£
;

149 *
num_’Œ›s
 = (*è&
¬eq
.
ª_v®
;

150 *
p
 = (*è&
¬eq
.
ª_v®
;

151 
p
 += ();

152 
ª_Îçÿche
 *
’Œ›s
 = (ª_Îçÿch*è
p
;

153 
i
 = 0; i < *
num_’Œ›s
; i++) {

154 ià(
e
 =ğ
	`Eth”Add»ss
((*è
’Œ›s
[
i
].
macd¡
)) {

155 
num_çed
 = 
’Œ›s
[
i
].
num_ç
;

156 
num_sucûssful
 = 
’Œ›s
[
i
].
num_sucûed
;

157  
Œue
;

160  
çl£
;

161 
	}
}

163 
boŞ


164 
	gAœoInfo
::
	$g‘_noi£
(&
max_ov”_£c
, &
avg_ov”_mšu‹
, &
max_ov”_mšu‹
)

166 
ª_»q
 
¬eq
;

167 
	`mem£t
(&
¬eq
, 0, (areq));

169 
¬eq
.
ª_Ën
 = 
AN_MAX_DATALEN
;

170 
¬eq
.
ª_ty³
 = 
AN_RID_STATUS
;

172 
_iä
.
iä_d©a
 = (*è&
¬eq
;

173 
»s
 = 
	`ioùl
(
_fd
, 
SIOCGAIRONET
, &
_iä
);

174 ià(
»s
 == -1) {

175 
	`şick_ch©‹r
("AiroInfo: ioctl(SIOCGAIRONET)ƒrror when„eading‚oise from status struct: %s\n",

176 
	`¡»¼Ü
(
”ºo
));

177  
çl£
;

188 
u_št8_t
 *
ba£
 = (u_št8_ˆ*è
_iä
.
iä_d©a
;

189 
u_št8_t
 *
u8
 = 
ba£
 + 0x7B;

190 
max_ov”_£c
 = *
u8
;

192 
u8
 = 
ba£
 + 0x7D;

193 
avg_ov”_mšu‹
 = *
u8
;

195 
u8
 = 
ba£
 + 0x7F;

196 
max_ov”_mšu‹
 = *
u8
;

198  
Œue
;

199 
	}
}

202 #ifdeà
__lšux__


203 
boŞ


204 
	gAœoInfo
::
	$g‘_sigÇl_šfo
(cÚ¡ 
Eth”Add»ss
 &
e
, &
dbm
, &
qu®™y
)

206 
buf
[((
iw_qu®™y
è+ (
sockaddr
)è* 
IW_MAX_SPY
];

208 
_iä
.
u
.
d©a
.
poš‹r
 = 
buf
;

209 
_iä
.
u
.
d©a
.
Ëngth
 = 0;

210 
_iä
.
u
.
d©a
.
æags
 = 0;

211 
»s
 = 
	`ioùl
(
_fd
, 
SIOCGIWSPY
, &
_iä
);

212 ià(
»s
 == -1) {

213 
	`şick_ch©‹r
("AiroInfo: ioctl(SIOCGIWSPY)ƒrror when„eading signal info: %s\n",

214 
	`¡»¼Ü
(
”ºo
));

215  
çl£
;

218 
n
 = 
_iä
.
u
.
d©a
.
Ëngth
;

220 
i
 = 0; i < 
n
; i++) {

221 
sockaddr
 *
§
 = (sockadd¸*è(
buf
 + 
i
 * (sockaddr));

222 ià(
e
 =ğ
	`Eth”Add»ss
((*è&
§
->
§_d©a
)) {

223 
iw_qu®™y
 *
q
 = (iw_qu®™y *è(
buf
 + 
n
*(
sockaddr
è+ 
i
*(iw_quality));

224 
dbm
 = ((è
q
->
Ëv–
) - 256;

225 
qu®™y
 = 
q
->
qu®
;

226  
Œue
;

230  
çl£
;

231 
	}
}

233 
boŞ


234 
	gAœoInfo
::
	$g‘_tx_¡©s
(cÚ¡ 
Eth”Add»ss
 &, &, &)

236  
çl£
;

237 
	}
}

240 
	#AIROIOCTL
 
SIOCDEVPRIVATE


	)

241 
	#AIROGSTAT
 8

	)

243 
	saœÚ‘_ioùl_t
 {

244 
	mcommªd
;

245 
	mËn
;

246 *
	md©a
;

250 
boŞ


251 
	gAœoInfo
::
	$g‘_noi£
(&
max_ov”_£c
, &
avg_ov”_mšu‹
, &
max_ov”_mšu‹
)

253 
u_št8_t
 
buf
[0x80];

254 
	`mem£t
(
buf
, 69, (buf));

256 
aœÚ‘_ioùl_t
 
aœo_cmd
;

257 
aœo_cmd
.
commªd
 = 
AIROGSTAT
;

258 
aœo_cmd
.
d©a
 = 
buf
;

259 
aœo_cmd
.
Ën
 = (
buf
);

260 
_iä2
.
iä_d©a
 = (*è&
aœo_cmd
;

262 
»s
 = 
	`ioùl
(
_fd
, 
AIROIOCTL
, &
_iä2
);

263 ià(
»s
 == -1) {

264 
	`şick_ch©‹r
("AiroInfo: ioctl(AIROIOCTL)ƒrror when„eading‚oise info: %s\n",

265 
	`¡»¼Ü
(
”ºo
));

266  
çl£
;

269 
max_ov”_£c
 = -
buf
[0x7B];

270 
avg_ov”_mšu‹
 = -
buf
[0x7D];

271 
max_ov”_mšu‹
 = -
buf
[0x7F];

273  
Œue
;

274 
	}
}

278 #ià!
defšed
(
__lšux__
è&& !defšed(
__O³nBSD__
)

279 
boŞ


280 
	gAœoInfo
::
	$g‘_sigÇl_šfo
(cÚ¡ 
Eth”Add»ss
 &, &, &)

282  
çl£
;

283 
	}
}

285 
boŞ


286 
	gAœoInfo
::
	$g‘_tx_¡©s
(cÚ¡ 
Eth”Add»ss
 &, &, &)

288  
çl£
;

289 
	}
}

291 
boŞ


292 
	gAœoInfo
::
	$g‘_noi£
(&, &, &)

294  
çl£
;

295 
	}
}

304 
	gAœoInfo
::
	$ş—r_tx_¡©s
()

306 #ifdeà
__O³nBSD__


307 
ª_»q
 
¬eq
;

308 
	`mem£t
(&
¬eq
, 0, (areq));

309 
¬eq
.
ª_Ën
 = 0;

310 
¬eq
.
ª_ty³
 = 
AN_RID_ZERO_LLFAIL
;

312 
_iä
.
iä_d©a
 = (*è&
¬eq
;

313 
»s
 = 
	`ioùl
(
_fd
, 
SIOCGAIRONET
, &
_iä
);

314 ià(
»s
 == -1) {

315 
	`şick_ch©‹r
("AiroInfo: ioctl(SIOCGAIRONET)ƒrror when„esettingx stats cache: %s\n",

316 
	`¡»¼Ü
(
”ºo
));

319 
	}
}

321 
CLICK_ENDDECLS


322 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

323 
	`EXPORT_ELEMENT
(
AœoInfo
)

	@grid/airoinfo.hh

1 #iâdeà
CLICK_AIROINFO_HH


2 
	#CLICK_AIROINFO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 #ifdeà
__lšux__


6 
	~<lšux/ty³s.h
>

7 
	~<lšux/if.h
>

8 
	~<lšux/wœ–ess.h
>

12 #iâdeà
CLICK_NET_IF_H


13 
	#CLICK_NET_IF_H


	)

14 
	~<Ãt/if.h
>

17 
CLICK_DECLS


37 şas 
	cAœoInfo
 : 
public
 
EËm’t
 {

39 
public
:

41 
	$AœoInfo
(è
CLICK_COLD
;

42 ~
	$AœoInfo
(è
CLICK_COLD
;

44 cÚ¡ *
	$şass_Çme
() const {  "AiroInfo"; }

45 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_0
; 
	}
}

47 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

48 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

53 
boŞ
 
	`g‘_sigÇl_šfo
(cÚ¡ 
Eth”Add»ss
 &
e
, &
dbm
, &
qu®™y
);

58 
boŞ
 
	`g‘_tx_¡©s
(cÚ¡ 
Eth”Add»ss
 &
e
, &
num_sucûssful
, &
num_çed
);

62 
boŞ
 
	`g‘_noi£
(&
max_ov”_£c
, &
avg_ov”_mšu‹
, &
max_ov”_mšu‹
);

65 
	`ş—r_tx_¡©s
();

67 
´iv©e
:

69 
_fd
;

70 
SŒšg
 
_iâame
;

72 #ifdeà
__lšux__


73 
iw»q
 
_iä
;

74 
iäeq
 
_iä2
;

76 
iäeq
 
_iä
;

79 
	}
};

81 
	gCLICK_ENDDECLS


	@grid/amoeba.cc

10 
	~<şick/cÚfig.h
>

11 
	~"amÛba.hh
"

13 
	~<m©h.h
>

14 
	~<¡dio.h
>

15 
	~<¡dlib.h
>

16 
	~<as£¹.h
>

17 
CLICK_DECLS


19 
	gAmÛba
::
	$AmÛba
(
dim’siÚs
)

21 
_dim’siÚs
 = 
dim’siÚs
;

22 
	}
}

24 
	gAmÛba
::~
	$AmÛba
()

26 
	}
}

28 
	#TINY
 1.0e-10

	)

29 
	#NMAX
 5000

	)

30 
	#GET_PSUM
 \

31 
j
=1;j<=
ndim
;j++) {\

32 
sum
=0.0,
i
=1;i<=
m±s
;i++èsum +ğ
p
[i][
j
];\

33 
psum
[
j
]=
sum
;}

	)

34 
	#SWAP
(
a
,
b
è{
sw­
=×);×)=(b);(b)=sw­;}

	)

37 
	gAmÛba
::
	$amÛba1
(**
p
, 
y
[], 
áŞ
, *
nfunk
)

39 
ndim
 = 
	`dim’siÚs
();

40 
i
,
ihi
,
o
,
šhi
,
j
,
m±s
=
ndim
+1;

41 
¹Ş
,
sum
,
sw­
,
y§ve
,
yŒy
,*
psum
;

43 
psum
=
	`veùÜ
(1,
ndim
);

44 *
nfunk
=0;

45 
GET_PSUM
;

47 
o
=1;

48 
ihi
 = 
y
[1]>y[2] ? (
šhi
=2,1) : (inhi=1,2);

49 
i
=1;i<=
m±s
;i++) {

50 ià(
y
[
i
] <ğy[
o
])

51 
o
=
i
;

52 ià(
y
[
i
] > y[
ihi
]) {

53 
šhi
=
ihi
;

54 
ihi
=
i
;

55 } ià(
y
[
i
] > y[
šhi
] && i !ğ
ihi
)

56 
šhi
=
i
;

58 
¹Ş
=2.0*
	`çbs
(
y
[
ihi
]-y[
o
])/(çbs(y[ihi])+çbs(y[o])+
TINY
);

60 ià(
¹Ş
 < 
áŞ
) {

61 
	`SWAP
(
y
[1],y[
o
]);

62 
i
=1;i<=
ndim
;i++){

63 
	`SWAP
(
p
[1][
i
],p[
o
][i]);

68 ià(*
nfunk
 >ğ
NMAX
)

69 
	`Ä”rÜ
("NMAXƒxceeded");

70 *
nfunk
 += 2;

72 
yŒy
=
	`amÙry
(
p
,
y
,
psum
,
ihi
,-1.0);

73 ià(
yŒy
 <ğ
y
[
o
])

74 
yŒy
=
	`amÙry
(
p
,
y
,
psum
,
ihi
,2.0);

75 ià(
yŒy
 >ğ
y
[
šhi
]) {

76 
y§ve
=
y
[
ihi
];

77 
yŒy
=
	`amÙry
(
p
,
y
,
psum
,
ihi
,0.5);

78 ià(
yŒy
 >ğ
y§ve
) {

79 
i
=1;i<=
m±s
;i++) {

80 ià(
i
 !ğ
o
) {

81 
j
=1;j<=
ndim
;j++)

82 
p
[
i
][
j
]=
psum
[j]=0.5*Õ[i][j]+p[
o
][j]);

83 
y
[
i
]=
	`â
(
psum
 + 1);

86 *
nfunk
 +ğ
ndim
;

87 
GET_PSUM
;

90 --(*
nfunk
);

93 
	`ä“_veùÜ
(
psum
,1,
ndim
);

94 
	}
}

97 
	gAmÛba
::
	$amÙry
(**
p
, 
y
[], 
psum
[],

98 
ihi
, 
çc
)

100 
ndim
 = 
	`dim’siÚs
();

101 
j
;

102 
çc1
,
çc2
,
yŒy
,*
±ry
;

103 
±ry
=
	`veùÜ
(1,
ndim
);

104 
çc1
=(1.0-
çc
)/
ndim
;

105 
çc2
=
çc1
-
çc
;

106 
j
=1;j<=
ndim
;j++)

107 
±ry
[
j
]=
psum
[j]*
çc1
-
p
[
ihi
][j]*
çc2
;

108 
yŒy
 = 
	`â
(
±ry
 + 1);

109 ià(
yŒy
 < 
y
[
ihi
]) {

110 
y
[
ihi
]=
yŒy
;

111 
j
=1;j<=
ndim
;j++) {

112 
psum
[
j
] +ğ
±ry
[j]-
p
[
ihi
][j];

113 
p
[
ihi
][
j
]=
±ry
[j];

116 
	`ä“_veùÜ
(
±ry
,1,
ndim
);

117  
yŒy
;

118 
	}
}

121 
	gAmÛba
::
	$Ä”rÜ
(cÚ¡ *
”rÜ_‹xt
)

123 
	`årštf
(
¡d”r
, "Oİ %s\n", 
”rÜ_‹xt
);

124 
	`ex™
(1);

125 
	}
}

128 
	gAmÛba
::
	$veùÜ
(
Æ
, 
nh
)

130 *
v
;

132 
v
 = (*è
	`m®loc
((
nh
-
Æ
+1)*());

133  
v
 - 
Æ
;

134 
	}
}

137 
	gAmÛba
::
	$ä“_veùÜ
(*
v
, 
Æ
, )

139 
	`ä“
((*è(
v
 + 
Æ
));

140 
	}
}

143 
	gAmÛba
::
	$mšimize
(
»s
[])

145 
ámp
[150];

146 *
p
[10];

147 
y
[10];

148 
áŞ
;

149 
nfunk
 = 0;

150 
i
;

152 
	`as£¹
(
	`dim’siÚs
() < 9);

154 
p
[0] = 0;

155 
i
 = 1; i <ğ
	`dim’siÚs
()+1; i++)

156 
p
[
i
] = 
ámp
 + i*(
	`dim’siÚs
()+1);

158 
i
 = 1; i <ğ
	`dim’siÚs
()+1; i++){

159 
j
;

160 
j
 = 1; j <ğ
	`dim’siÚs
(); j++){

161 
p
[
i
][
j
] = 0.0;

166 
i
 = 2; i <ğ
	`dim’siÚs
()+1; i++){

167 
p
[
i
][i-1] = 1 + i*0.01;

171 
i
 = 1; i <ğ
	`dim’siÚs
()+1; i++)

172 
y
[
i
] = 
	`â
(
p
[i] + 1);

174 
áŞ
 = 0.00001;

176 
	`amÛba1
(
p
, 
y
, 
áŞ
, &
nfunk
);

178 
i
 = 1; i <ğ
	`dim’siÚs
(); i++)

179 
»s
[
i
-1] = 
p
[1][i];

180 
	}
}

182 şas 
	cAmÛbaTe¡
 : 
public
 
AmÛba
 {

183 
public
:

184 
AmÛbaTe¡
();

185 
vœtu®
 
â
(
a
[]);

186 
do™
();

189 
	gAmÛbaTe¡
::
	$AmÛbaTe¡
(è: 
	$AmÛba
(2)

191 
	}
}

193 
	sxxx
 {

194 
x
;

195 
	my
;

196 
	md
;

198 
xxx
 
	gda
[] = {

205 
	gAmÛbaTe¡
::
	$â
(
a
[])

207 
x
 = 
a
[0];

208 
y
 = 
a
[1];

209 
d
 = 0;

210 
i
;

212 
	`´štf
("xfunc(%f,%fè", 
x
, 
y
);

214 
i
 = 0; i < ()((
da
) / (da[0])); i++){

215 
dx
 = 
x
 - 
da
[
i
].x;

216 
dy
 = 
y
 - 
da
[
i
].y;

217 
dd
 = 
da
[
i
].
d
 - 
	`sq¹
(
dx
*dx + 
dy
*dy);

218 
dd
 = dd * dd;

219 
d
 +ğ
dd
;

220 
	`´štf
("%à", 
dd
);

223 
	`´štf
("ğ%f\n", 
d
);

225 (
d
);

226 
	}
}

229 
	gAmÛbaTe¡
::
	$do™
()

231 
±
[2];

233 
	`mšimize
(
±
);

235 
	`´štf
("%à%f\n", 
±
[0],…t[1]);

237 if(
±
[0] > 999.999 &&…t[0] < 1000.001 &&

238 
±
[1] > 1000.999 &&…t[1] < 1001.001){

239 
	`´štf
("AmoebaTest ok\n");

241 
	`´štf
("AmoebaTest failed\n");

243 
	}
}

246 
	$maš
()

248 
AmÛbaTe¡
 
©
;

249 
©
.
	`do™
();

250 
	}
}

253 
CLICK_ENDDECLS


254 
	$ELEMENT_PROVIDES
(
AmÛba
)

255 
	`ELEMENT_REQUIRES
(
u£¾ev–
)

	@grid/amoeba.hh

1 #iâdeà
CLICK_amÛba_hh


2 
	#CLICK_amÛba_hh


	)

3 
CLICK_DECLS


17 şas 
	cAmÛba
 {

18 
	mpublic
:

19 
AmÛba
(
dim’siÚs
);

20 
	mvœtu®
 ~
AmÛba
();

22 
vœtu®
 
â
(
a
[]) = 0;

24 
mšimize
(
±
[]);

26 
	$dim’siÚs
(è{ (
_dim’siÚs
); }

28 
´iv©e
:

29 
_dim’siÚs
;

31 *
	`veùÜ
(
Æ
, 
nh
);

32 
	`ä“_veùÜ
(*, , );

33 
	`Ä”rÜ
(const *);

34 
	`amÛba1
(**
p
, 
y
[], 
áŞ
, *
nfunk
);

35 
	`amÙry
(**
p
, 
y
[], 
psum
[],

36 
ihi
, 
çc
);

37 
	}
};

39 
	gCLICK_ENDDECLS


	@grid/bottleneckmetric.cc

16 
	~<şick/cÚfig.h
>

17 
	~<şick/¬gs.hh
>

18 
	~<şick/”rÜ.hh
>

19 
	~"–em’ts/grid/bÙ’eckm‘ric.hh
"

20 
	~"–em’ts/grid/lšk¡©.hh
"

21 
CLICK_DECLS


23 
	gBÙ’eckM‘ric
::
	$BÙ’eckM‘ric
()

24 : 
	$_ls
(0)

26 
	}
}

28 
BÙ’eckM‘ric
::~
	$BÙ’eckM‘ric
()

30 
	}
}

33 
BÙ’eckM‘ric
::
	$ÿ¡
(cÚ¡ *
n
)

35 ià(
	`¡rcmp
(
n
, "BottleneckMetric") == 0)

36  (
BÙ’eckM‘ric
 *è
this
;

37 ià(
	`¡rcmp
(
n
, "GridGenericMetric") == 0)

38  (
GridG’”icM‘ric
 *è
this
;

41 
	}
}

44 
	gBÙ’eckM‘ric
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

46 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

47 .
»ad_mp
("LINKSTAT", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_ls
))

48 .
com¶‘e
();

49 ià(
	g»s
 < 0)

50  
	g»s
;

51 ià(
	g_ls
 == 0)

52 
”rh
->
”rÜ
("no LinkStatƒlement specified");

53 ià(
	g_ls
->
ÿ¡
("LinkStat") == 0)

54  
”rh
->
”rÜ
("LinkStat‡rgument is wrongƒlementype (should be LinkStat)");

59 
boŞ


60 
	gBÙ’eckM‘ric
::
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &
m1
, cÚ¡ m‘ric_ˆ&
m2
) const

62 ià(
m1
.
	`good
(è&& 
m2
.good())

63  
m1
.
	`v®
(è> 
m2
.val();

64 ià(
m2
.
	`good
())

65  
çl£
;

67  
Œue
;

68 
	}
}

70 
	gGridG’”icM‘ric
::
m‘ric_t


71 
BÙ’eckM‘ric
::
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &
e
, 
boŞ
 
d©a_£nd”
) const

73 
u
;

74 
Time¡amp
 
t
;

75 
boŞ
 
»s
;

76 
r
;

78 ià(
d©a_£nd”
)

79 
»s
 = 
_ls
->
	`g‘_fÜw¬d_¿‹
(
e
, &
r
, &
u
, &
t
);

81 
»s
 = 
_ls
->
	`g‘_»v”£_¿‹
(
e
, &
r
, &
u
);

83 ià(!
»s
 || 
r
 == 0)

84  
_bad_m‘ric
;

86  
	`m‘ric_t
(
r
);

87 
	}
}

89 
	gGridG’”icM‘ric
::
m‘ric_t


90 
BÙ’eckM‘ric
::
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

92 ià(!
r
.
	`good
(è|| !
l
.good())

93  
_bad_m‘ric
;

95 ià(
r
.
	`v®
() > 100)

96 
	`şick_ch©‹r
("BottleneckMetric %s:‡ppend_metric WARNING: metric %u%% delivery„atio isoo†arge for„oute metric",

97 
	`Çme
().
	`c_¡r
(), 
r
.
	`v®
());

98 ià(
l
.
	`v®
() > 100)

99 
	`şick_ch©‹r
("BottleneckMetric %s:‡ppend_metric WARNING: metric %u%% delivery„atio isoo†arge for†ink metric",

100 
	`Çme
().
	`c_¡r
(), 
r
.
	`v®
());

103 ià(
r
.
	`v®
(è< 
l
.val())

104  
r
;

106  
l
;

107 
	}
}

110 
	$ELEMENT_PROVIDES
(
GridG’”icM‘ric
)

111 
	$EXPORT_ELEMENT
(
BÙ’eckM‘ric
)

113 
CLICK_ENDDECLS


	@grid/bottleneckmetric.hh

1 #iâdeà
BNECKMETRIC_HH


2 
	#BNECKMETRIC_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"gridg’”icm‘ric.hh
"

5 
CLICK_DECLS


27 
şass
 
	gLškSt
;

29 şas 
	cBÙ’eckM‘ric
 : 
public
 
GridG’”icM‘ric
 {

31 
public
:

33 
	$BÙ’eckM‘ric
(è
CLICK_COLD
;

34 ~
	$BÙ’eckM‘ric
(è
CLICK_COLD
;

36 cÚ¡ *
	$şass_Çme
() const {  "BottleneckMetric"; }

37 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_0
; 
	}
}

38 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

40 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

41 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
çl£
; 
	}
}

43 *
ÿ¡
(const *);

46 
boŞ
 
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

47 
m‘ric_t
 
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &, 
boŞ
) const;

48 
m‘ric_t
 
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

49 
m‘ric_t
 
	$´•’d_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

50 {  
	`­³nd_m‘ric
(
r
, 
l
); 
	}
}

52 
	$sÿË_to_ch¬
(cÚ¡ 
m‘ric_t
 &
m
ècÚ¡ {  (èm.
	`v®
(); 
	}
}

53 
m‘ric_t
 
	$unsÿË_äom_ch¬
(
c
ècÚ¡ {  
	`m‘ric_t
(c); 
	}
}

55 
	g´iv©e
:

56 
LškSt
 *
_ls
;

59 
	gCLICK_ENDDECLS


	@grid/checkgridheader.cc

20 
	~<şick/cÚfig.h
>

21 
	~<şick/¬gs.hh
>

22 
	~"checkgridh—d”.hh
"

23 
	~<şick/glue.hh
>

24 
	~"grid.hh
"

25 
	~<şickÃt/‘h”.h
>

26 
	~<şickÃt/.h
>

27 
CLICK_DECLS


29 
	gCheckGridH—d”
::
	$CheckGridH—d”
()

30 : 
	$_drİs
(0)

32 
	}
}

34 
CheckGridH—d”
::~
	$CheckGridH—d”
()

36 
	}
}

39 
CheckGridH—d”
::
	$drİ_™
(
Pack‘
 *
p
)

41 ià(
_drİs
 == 0)

42 
	`şick_ch©‹r
("CheckGridH—d” %s: Grid checksum faed", 
	`Çme
().
	`c_¡r
());

43 
_drİs
++;

45 ià(
	`nouuts
() == 2)

46 
	`ouut
(1).
	`push
(
p
);

48 
p
->
	`kl
();

49 
	}
}

51 
Pack‘
 *

52 
	gCheckGridH—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

54 
grid_hdr
 *
gh
 = (grid_hd¸*è(
p
->
	`d©a
(è+ (
şick_‘h”
));

56 if(
p
->
	`Ëngth
(è< (
şick_‘h”
è+ (
grid_hdr
)) {

58 
	`şick_ch©‹r
("%s:…ack‘runÿ‹d", 
	`Çme
().
	`c_¡r
());

60 
bad
;

63 
hËn
, 
’
;

64 
hËn
 = 
gh
->
hdr_Ën
;

65 
’
 = 
	`Áohs
(
gh
->
tÙ®_Ën
);

72 ià(
	`Áohl
(
gh
->
v”siÚ
è!ğ
grid_hdr
::
GRID_VERSION
) {

73 
	`şick_ch©‹r
 ("%s: unknowÀgrid v”siÚ %x", 
	`Çme
().
	`c_¡r
(), 
	`Áohl
(
gh
->
v”siÚ
));

74 
p
->
	`kl
();

78 ià(
’
 + (
şick_‘h”
è> 
p
->
	`Ëngth
()) {

82 
	`şick_ch©‹r
("%s: bad…ack‘ size, wª‹d %d, oÆy gÙ %d", 
	`Çme
().
	`c_¡r
(),

83 
’
 + (
şick_‘h”
), 
p
->
	`Ëngth
());

85 
bad
;

88 ià(
	`şick_š_cksum
((*è
gh
, 
’
) != 0) {

90 
	`şick_ch©‹r
("%s: bad Grid checksum", 
	`Çme
().
	`c_¡r
());

91 
	`şick_ch©‹r
("%s:†ength: %d, cksum: 0x%.4x",

92 
	`Çme
().
	`c_¡r
(), 
p
->
	`Ëngth
(), (è
	`Áohs
(
gh
->
cksum
));

94 
bad
;

96 (
p
);

98 
bad
:

99 
	`drİ_™
(
p
);

101 
	}
}

103 
SŒšg


104 
	$CheckGridH—d”_»ad_drİs
(
EËm’t
 *
xf
, *)

106 
CheckGridH—d”
 *
f
 = (CheckGridH—d” *)
xf
;

107  
	`SŒšg
(
f
->
	`drİs
()) + "\n";

108 
	}
}

111 
	gCheckGridH—d”
::
	$add_hªdËrs
()

113 
	`add_»ad_hªdËr
("drİs", 
CheckGridH—d”_»ad_drİs
, 0);

114 
	}
}

116 
CLICK_ENDDECLS


117 
EXPORT_ELEMENT
(
CheckGridH—d”
)

	@grid/checkgridheader.hh

1 #iâdeà
CHECKGRIDHEADER_HH


2 
	#CHECKGRIDHEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


21 şas 
	cCheckGridH—d”
 : 
public
 
EËm’t
 {

23 
_drİs
;

25 
	mpublic
:

27 
	$CheckGridH—d”
(è
CLICK_COLD
;

28 ~
	$CheckGridH—d”
(è
CLICK_COLD
;

30 cÚ¡ *
	$şass_Çme
() const {  "CheckGridHeader"; }

31 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-2"; 
	}
}

32 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

34 
	$drİs
(ècÚ¡ {  
_drİs
; 
	}
}

36 
	$add_hªdËrs
(è
CLICK_COLD
;

38 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

39 
	`drİ_™
(
Pack‘
 *);

41 
	}
};

43 
	gCLICK_ENDDECLS


	@grid/delivery_rate_table.hh

6 #iâdeà
LOSS_RATE_TABLE


7 
	#LOSS_RATE_TABLE


	)

9 cÚ¡ 
	gbË_sz1
 = 148;

10 cÚ¡ 
	gbË_sz2
 = 300;

12 cÚ¡ 
	gbË_max_¿‹
 = 100;

13 cÚ¡ 
	gbË_num_¿‹s
 = 21;

14 cÚ¡ 
	gbË_¿‹_¡•
 = 5;

16 cÚ¡ 
	gbË_max_size
 = 1600;

17 cÚ¡ 
	gbË_num_sizes
 = 161;

18 cÚ¡ 
	gbË_size_¡•
 = 10;

21 cÚ¡ 
	gd–iv”y_¿‹_bË
[][21][161] = {

949 
šlše
 

950 
	$lookup_d–iv”y_¿‹
(
r1
, 
r2
, 
sz
)

952 
	`as£¹
((
d–iv”y_¿‹_bË
è=ğ()*
bË_num_¿‹s
*bË_num_¿‹s*
bË_num_sizes
);

953 ià(
r1
 > 
bË_max_¿‹
 || 
r2
 >abË_max_¿‹ || 
sz
 > 
bË_max_size
)

956 
i1
 = 
r1
 / 
bË_¿‹_¡•
;

957 ià((
r1
 % 
bË_¿‹_¡•
) > (table_rate_step / 2))

958 
i1
++;

959 
	`as£¹
(
i1
 < 
bË_num_¿‹s
);

961 
i2
 = 
r2
 / 
bË_¿‹_¡•
;

962 ià((
r2
 % 
bË_¿‹_¡•
) > (table_rate_step / 2))

963 
i2
++;

964 
	`as£¹
(
i2
 < 
bË_num_¿‹s
);

966 
i3
 = 
sz
 / 
bË_size_¡•
;

967 ià((
sz
 % 
bË_size_¡•
) > (table_size_step / 2))

968 
i3
++;

969 
	`as£¹
(
i3
 < 
bË_num_sizes
);

971  
d–iv”y_¿‹_bË
[
i1
][
i2
][
i3
];

972 
	}
}

	@grid/dsdvroutetable.cc

18 
	~<şick/cÚfig.h
>

19 
	~<¡ddef.h
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şickÃt/‘h”.h
>

23 
	~<şickÃt/.h
>

24 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

25 
	~<şick/rou‹r.hh
>

26 
	~<şick/–em’t.hh
>

27 
	~<şick/glue.hh
>

28 
	~<şick/¡¿ccum.hh
>

29 
	~<şick/·ck‘_ªno.hh
>

30 
	~<–em’ts/grid/dsdvrou‹bË.hh
>

31 
	~<–em’ts/grid/lšk¡©.hh
>

32 
	~<–em’ts/grid/gridg©ewayšfo.hh
>

33 
	~<–em’ts/grid/timeuts.hh
>

37 
	gCLICK_DECLS


39 
	#DBG
 0

	)

40 
	#DBG2
 0

	)

41 
	#DBG3
 0

	)

43 
	#FULL_DUMP_ON_TRIG_UPDATE
 0

	)

45 
	#GRID_MAX
(
a
, 
b
è(×è> (bè? (aè: (b))

	)

46 
	#GRID_MIN
(
a
, 
b
è(×è< (bè? (aè: (b))

	)

48 
	#dsdv_as£¹
(
e
è(Óè? (è0 : 
	`dsdv_as£¹_
(
__FILE__
, 
__LINE__
, #e))

	)

50 
boŞ


51 
	gDSDVRou‹TabË
::
	$g‘_Úe_’Œy
(cÚ¡ 
IPAdd»ss
 &
de¡_
, 
Rou‹EÁry
 &
’Œy
)

53 
RTEÁry
 
r
;

54 
boŞ
 
»s
 = 
	`lookup_rou‹
(
de¡_
, 
r
);

55 ià(
»s
)

56 
’Œy
 = 
r
;

57  
»s
;

58 
	}
}

60 
boŞ


61 
	gDSDVRou‹TabË
::
	$lookup_rou‹
(cÚ¡ 
IPAdd»ss
 &
de¡_
, 
RTEÁry
 &
’Œy
)

63 #ià
ENABLE_PAUSE


64 ià(
_·u£d
) {

65 
RTEÁry
 *
r
 =
_¢­shÙ_¹es
.
	`fšdp
(
de¡_
);

66 ià(
r
 == 0)

67  
çl£
;

68 #ià
USE_OLD_SEQ


69 ià(
	`u£_Şd_rou‹
(
de¡_
, 
_¢­shÙ_jiff›s
))

70 
r
 = 
_¢­shÙ_Şd_¹es
.
	`fšdp
(
de¡_
);

72 
’Œy
 = *
r
;

73  
Œue
;

77 
RTEÁry
 *
r
 = 
_¹es
.
	`fšdp
(
de¡_
);

78 ià(
r
 == 0)

79  
çl£
;

80 #ià
USE_OLD_SEQ


81 ià(
	`u£_Şd_rou‹
(
de¡_
, 
	`dsdv_jiff›s
()))

82 
r
 = 
_Şd_¹es
.
	`fšdp
(
de¡_
);

84 
’Œy
 = *
r
;

85  
Œue
;

86 
	}
}

89 
	gDSDVRou‹TabË
::
g‘_®l_’Œ›s
(
VeùÜ
<
Rou‹EÁry
> &
vec
)

91 #ià
ENABLE_PAUSE


92 ià(
_·u£d
) {

93 
RTI‹r
 
™”
 = 
_¢­shÙ_¹es
.
begš
(); 
	g™”
.
live
(); iter++) {

94 cÚ¡ 
	gRTEÁry
 &
	g¹e
 = 
™”
.
v®ue
();

95 #ià
USE_OLD_SEQ


96 ià(
u£_Şd_rou‹
(
¹e
.
de¡_
, 
_¢­shÙ_jiff›s
))

97 
	gvec
.
push_back
(
_¢­shÙ_Şd_¹es
[
¹e
.
de¡_
]);

99 
	gvec
.
push_back
(
¹e
);

101 
	gvec
.
push_back
(
¹e
);

108 #ià
USE_OLD_SEQ


109 
	gjiff
 = 
dsdv_jiff›s
();

111 
RTI‹r
 
	g™”
 = 
_¹es
.
begš
(); i‹r.
live
(); iter++) {

112 cÚ¡ 
	gRTEÁry
 &
	g¹e
 = 
™”
.
v®ue
();

113 #ià
USE_OLD_SEQ


114 ià(
u£_Şd_rou‹
(
¹e
.
de¡_
, 
jiff
))

115 
	gvec
.
push_back
(
_Şd_¹es
[
¹e
.
de¡_
]);

117 
	gvec
.
push_back
(
¹e
);

119 
	gvec
.
push_back
(
¹e
);

125 
	gDSDVRou‹TabË
::
	$g‘_numb”_dœeù_ÃigbÜs
()

127 
VeùÜ
<
Rou‹EÁry
> 
v
;

130 
	`g‘_®l_’Œ›s
(
v
);

134 
num_nbrs
 = 0;

135 
i
 = 0; i < 
v
.
	`size
(); i++)

136 ià(
v
[
i
].
	`num_hİs
(è=ğ1 && v[i].
	`good
())

137 
num_nbrs
++;

138  
num_nbrs
;

139 
	}
}

142 #ià
USE_OLD_SEQ


143 
boŞ


144 
	gDSDVRou‹TabË
::
	$u£_Şd_rou‹
(cÚ¡ 
IPAdd»ss
 &
d¡
, 
jiff
)

146 ià(!
_u£_Şd_rou‹
)

147  
çl£
;

149 
RTEÁry
 *
»®
 = 
_¹es
.
	`fšdp
(
d¡
);

150 
RTEÁry
 *
Şd
 = 
_Şd_¹es
.
	`fšdp
(
d¡
);

151 #ià
ENABLE_PAUSE


152 ià(
_·u£d
) {

153 
»®
 = 
_¢­shÙ_¹es
.
	`fšdp
(
d¡
);

154 
Şd
 = 
_¢­shÙ_Şd_¹es
.
	`fšdp
(
d¡
);

157 #ià
USE_GOOD_NEW_ROUTES


159 ià(
_u£_good_Ãw_rou‹
 && 
»®
 && 
Şd
 && 
	`m‘ric_´eã¿bË
(*real, *old))

160  
çl£
;

163 (
»®
 &&„—l->
	`good
() &&

164 
Şd
 && old->
	`good
() &&

165 
»®
->
adv”ti£_ok_jiff›s
 > 
jiff
);

166 
	}
}

169 
	gDSDVRou‹TabË
::
	$DSDVRou‹TabË
() :

170 #ià
SEQ_METRIC


171 
	`_u£_£q_m‘ric
(
çl£
),

173 
	`_gw_šfo
(0), 
	`_m‘ric
(0), 
	`_log
(0),

174 
	`_£q_no
(0), 
	`_mtu
(2000), 
	`_bÿ¡_couÁ
(0),

175 
	`_max_hİs
(3), 
	`_®pha
(88), 
	`_w¡0
(6000),

176 
	`_Ï¡_³riodic_upd©e
(0),

177 
	`_Ï¡_Œigg”ed_upd©e
(0),

178 
	`_ignÜe_šv®id_rou‹s
(
çl£
),

179 
	`_h–lo_tim”
(
¡©ic_h–lo_hook
, 
this
),

180 
	`_log_dump_tim”
(
¡©ic_log_dump_hook
, 
this
),

181 
	$_v”bo£
(
Œue
)

183 
	}
}

185 
	gDSDVRou‹TabË
::~
	$DSDVRou‹TabË
()

188 
TMI‹r
 
i
 = 
_expœe_tim”s
.
	`begš
(); i.
	`live
(); i++) {

189 ià(
i
.
	`v®ue
()->
	`scheduËd
())

190 
i
.
	`v®ue
()->
	`unscheduË
();

191 
d–‘e
 
i
.
	`v®ue
();

193 
TMI‹r
 
i
 = 
_Œigg”_tim”s
.
	`begš
(); i.
	`live
(); i++) {

194 ià(
i
.
	`v®ue
()->
	`scheduËd
())

195 
i
.
	`v®ue
()->
	`unscheduË
();

196 
d–‘e
 
i
.
	`v®ue
();

198 
HMI‹r
 
i
 = 
_expœe_hooks
.
	`begš
(); i.
	`live
(); i++)

199 
d–‘e
 
i
.
	`v®ue
();

200 
HMI‹r
 
i
 = 
_Œigg”_hooks
.
	`begš
(); i.
	`live
(); i++)

201 
d–‘e
 
i
.
	`v®ue
();

202 
	}
}

205 
	gDSDVRou‹TabË
::
	$ÿ¡
(cÚ¡ *
n
)

207 ià(
	`¡rcmp
(
n
, "DSDVRouteTable") == 0)

208  (
DSDVRou‹TabË
 *è
this
;

209 ià(
	`¡rcmp
(
n
, "GridGenericRouteTable") == 0)

210  (
GridG’”icRou‹TabË
 *è
this
;

213 
	}
}

216 
	gDSDVRou‹TabË
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

218 
SŒšg
 
	glogfe
;

219 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

220 .
»ad_mp
("TIMEOUT", 
_timeout
)

221 .
»ad_mp
("PERIOD", 
_³riod
)

222 .
»ad_mp
("JITTER", 
_j™‹r
)

223 .
»ad_mp
("MIN_TRIGGER_PERIOD", 
_mš_Œigg”ed_upd©e_³riod
)

224 .
»ad_mp
("ETH", 
_‘h
)

225 .
»ad_mp
("IP", 
_
)

226 .
»ad
("VERBOSE", 
_v”bo£
)

227 .
»ad
("GW", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_gw_šfo
))

228 .
»ad
("MAX_HOPS", 
_max_hİs
)

229 .
»ad
("METRIC", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_m‘ric
))

230 .
»ad
("LOG", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_log
))

231 .
»ad
("WST0", 
_w¡0
)

232 .
»ad
("ALPHA", 
_®pha
)

233 .
»ad
("SEQ0", 
_£q_no
)

234 .
»ad
("MTU", 
_mtu
)

235 .
»ad
("IGNORE_INVALID_ROUTES", 
_ignÜe_šv®id_rou‹s
)

236 #ià
SEQ_METRIC


237 .
»ad
("USE_SEQ_METRIC", 
_u£_£q_m‘ric
)

239 .
com¶‘e
();

241 ià(
	g»s
 < 0)

242  
	g»s
;

244 ià(
	g_£q_no
 & 1)

245  
	g”rh
->
”rÜ
("initial sequence‚umber must beƒven");

247 ià(
	g_timeout
 == 0)

248  
”rh
->
”rÜ
("timeout interval must be greaterhan 0");

249 ià(
	g_³riod
 == 0)

250  
”rh
->
”rÜ
("period must be greaterhan 0");

252 ià(
	g_j™‹r
 > 
	g_³riod
)

253  
	g”rh
->
”rÜ
("jitter is biggerhan…eriod");

254 ià(
	g_max_hİs
 == 0)

255  
”rh
->
”rÜ
("max hops must be greaterhan 0");

256 ià(
	g_®pha
 > 100)

257  
	g”rh
->
”rÜ
("alpha must be between 0‡nd 100 inclusive");

259 ià(
	g_mtu
 < (
	gşick_‘h”
è+ (
	ggrid_hdr
è+ (
	ggrid_h–lo
))

260  
	g”rh
->
”rÜ
("mtu isoo smallo send‡„oute‡ds");

262 ià(
	g_log
 && _log->
ÿ¡
("GridGenericLogger") == 0)

263  
”rh
->
”rÜ
("LOGƒlement is‚ot‡ GridGenericLogger");

264 ià(
	g_gw_šfo
 && _gw_šfo->
ÿ¡
("GridGatewayInfo") == 0)

265  
”rh
->
”rÜ
("GWƒlement is‚ot‡ GridGatewayInfo");

266 ià(
	g_m‘ric
 && _m‘ric->
ÿ¡
("GridGenericMetric") == 0)

267  
”rh
->
”rÜ
("METRICƒlement is‚ot‡ GridGenericMetric");

269 ià(
	g_gw_šfo
 =ğ0 && 
_v”bo£
)

270 
”rh
->
w¬nšg
("No GridGatewayInfoƒlement specified, will defaulto‚ot‡dvertising‡s gateway");

271 ià(
	g_m‘ric
 =ğ0 && 
_v”bo£
)

272 
”rh
->
w¬nšg
("No metricƒlements specified, will defaulto minimum hop-count");

274 #ià
SEQ_METRIC


275 ià(
	g_m‘ric
 && 
	g_u£_£q_m‘ric
)

276 
	g”rh
->
w¬nšg
("USE_SEQ_METRIC has been specified,he specified METRICƒlement will be ignored");

279  
	g»s
;

283 
	gDSDVRou‹TabË
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

285 
_h–lo_tim”
.
	`š™Ÿlize
(
this
);

286 
_h–lo_tim”
.
	`scheduË_aá”_m£c
(
_³riod
);

287 
_log_dump_tim”
.
	`š™Ÿlize
(
this
);

288 
_log_dump_tim”
.
	`scheduË_aá”_m£c
(
_log_dump_³riod
);

290 
	`check_šv¬ŸÁs
();

291 #ià
ENABLE_PAUSE


292 
_·u£d
 = 
çl£
;

294 #ià
USE_OLD_SEQ


295 
_u£_Şd_rou‹
 = 
çl£
;

296 #ià
USE_GOOD_NEW_ROUTES


297 
_u£_good_Ãw_rou‹
 = 
çl£
;

300 #ià
ENABLE_SEEN


301 
_u£_£’
 = 
çl£
;

304 
	}
}

306 
boŞ


307 
	gDSDVRou‹TabË
::
	$cu¼’t_g©eway
(
Rou‹EÁry
 &
gw
)

309 
RTEÁry
 
be¡
;

310 
boŞ
 
found_g©eway
 = 
çl£
;

311 
VeùÜ
<
IPAdd»ss
> 
gw_addrs
;

312 
RTI‹r
 
i
 = 
_¹es
.
	`begš
();

313 #ià
ENABLE_PAUSE


314 ià(
_·u£d
)

315 
i
 = 
_¢­shÙ_¹es
.
	`begš
();

317  ; 
i
.
	`live
(); i++) {

318 ià(
i
.
	`v®ue
().
is_g©eway
)

319 
gw_addrs
.
	`push_back
(
i
.
	`v®ue
().
de¡_
);

322 
VeùÜ
<
IPAdd»ss
>::
cÚ¡_™”©Ü
 
i
 = 
gw_addrs
.
	`begš
(); i !ğgw_addrs.
	`’d
(); i++) {

323 
RTEÁry
 
r
;

324 
boŞ
 
»s
 = 
	`lookup_rou‹
(*
i
, 
r
);

325 
	`dsdv_as£¹
(
»s
);

326 ià(
r
.
is_g©eway
 &&„.
	`good
(è&& (!
found_g©eway
 || 
	`m‘ric_´eã¿bË
Ô, 
be¡
))) {

327 
be¡
 = 
r
;

328 
found_g©eway
 = 
Œue
;

331 ià(
found_g©eway
) {

332 
gw
 = 
be¡
;

334  
found_g©eway
;

335 
	}
}

338 
	gDSDVRou‹TabË
::
	$š£¹_rou‹
(cÚ¡ 
RTEÁry
 &
r
, cÚ¡ 
GridG’”icLogg”
::
»asÚ_t
 
why
)

340 
	`check_šv¬ŸÁs
();

341 
r
.
	`check
();

343 
	`dsdv_as£¹
(!
_ignÜe_šv®id_rou‹s
 || 
r
.
m‘ric
.
	`good
());

345 
RTEÁry
 *
Şd_r
 = 
_¹es
.
	`fšdp
(
r
.
de¡_
);

350 
Tim”
 **
Şd
 = 
_expœe_tim”s
.
	`fšdp
(
r
.
de¡_
);

351 
HookPaœ
 **
Şdhp
 = 
_expœe_hooks
.
	`fšdp
(
r
.
de¡_
);

352 ià(
Şd_r
 && old_r->
	`good
())

353 
	`dsdv_as£¹
(
Şd
 && *Şd && (*Şd)->
	`scheduËd
(è&& 
Şdhp
 && *oldhp);

355 
	`dsdv_as£¹
(
Şd
 == 0);

356 
	`dsdv_as£¹
(
Şdhp
 == 0);

360 ià(
Şd
) {

361 (*
Şd
)->
	`unscheduË
();

362 
d–‘e
 *
Şd
;

363 
d–‘e
 *
Şdhp
;

364 
_expœe_tim”s
.
	`»move
(
r
.
de¡_
);

365 
_expœe_hooks
.
	`»move
(
r
.
de¡_
);

372 ià(
r
.
	`good
()) {

373 
HookPaœ
 *
hp
 = 
Ãw
 
	`HookPaœ
(
this
, 
r
.
de¡_
);

374 
Tim”
 *
t
 = 
Ãw
 
	`Tim”
(
¡©ic_expœe_hook
, (*è
hp
);

375 
t
->
	`š™Ÿlize
(
this
);

376 
t
->
	`scheduË_aá”_m£c
(
	`GRID_MIN
(
r
.
‰l
, 
_timeout
));

378 
_expœe_tim”s
.
	`š£¹
(
r
.
de¡_
, 
t
);

379 
_expœe_hooks
.
	`š£¹
(
r
.
de¡_
, 
hp
);

382 #ià
USE_OLD_SEQ


384 ià(
Şd_r
 && old_r->
	`£q_no
(è< 
r
.seq_no())

385 
_Şd_¹es
.
	`š£¹
(
r
.
de¡_
, *
Şd_r
);

388 
_¹es
.
	`š£¹
(
r
.
de¡_
,„);

395 ià(
_log
)

396 
_log
->
	`log_added_rou‹
(
why
, 
	`make_g’”ic_¹e
(
r
), (èr.
w¡
);

397 
	`check_šv¬ŸÁs
();

398 
	}
}

401 
	gDSDVRou‹TabË
::
	$expœe_hook
(cÚ¡ 
IPAdd»ss
 &

)

403 
	`check_šv¬ŸÁs
(&

);

407 
RTEÁry
 *
r
 = 
_¹es
.
	`fšdp
(

);

408 
	`dsdv_as£¹
(
r
 != 0);

411 
	`dsdv_as£¹
(
r
->
	`good
(è&& (r->
	`£q_no
() & 1) == 0);

415 
Tim”
 **
Şd
 = 
_expœe_tim”s
.
	`fšdp
(

);

416 
HookPaœ
 **
Şdhp
 = 
_expœe_hooks
.
	`fšdp
(

);

417 
	`dsdv_as£¹
(
Şd
 && *Şd && !(*Şd)->
	`scheduËd
(è&& 
Şdhp
 && *oldhp);

419 ià(
_log
) {

420 
_log
->
	`log_¡¬t_expœe_hªdËr
(
Time¡amp
::
	`now
());

421 
_log
->
	`log_expœed_rou‹
(
GridG’”icLogg”
::
TIMEOUT
, 

);

430 
VeùÜ
<
IPAdd»ss
> 
expœed_de¡s
;

431 
expœed_de¡s
.
	`push_back
(

);

439 ià(
r
->
	`num_hİs
() == 1) {

440 
	`dsdv_as£¹
(
r
->
Ãxt_hİ_
 =ğr->
de¡_
);

441 
RTI‹r
 
i
 = 
_¹es
.
	`begš
(); i.
	`live
(); i++) {

442 
RTEÁry
 
r
 = 
i
.
	`v®ue
();

443 ià(
r
.
de¡_
 =ğ

)

446 ià(
r
.
	`good
() &&

447 
r
.
Ãxt_hİ_
 =ğ

) {

448 
expœed_de¡s
.
	`push_back
(
r
.
de¡_
);

449 ià(
_log
)

450 
_log
->
	`log_expœed_rou‹
(
GridG’”icLogg”
::
NEXT_HOP_EXPIRED
, 
r
.
de¡_
);

455 
jiff
 = 
	`dsdv_jiff›s
();

457 
i
 = 0; i < 
expœed_de¡s
.
	`size
(); i++) {

458 
RTEÁry
 *
r
 = 
_¹es
.
	`fšdp
(
expœed_de¡s
[
i
]);

459 
	`dsdv_as£¹
(
r
);

464 
Tim”
 **
exp_tim”
 = 
_expœe_tim”s
.
	`fšdp
(
r
->
de¡_
);

465 
	`dsdv_as£¹
(
exp_tim”
 && *exp_timer);

466 
HookPaœ
 **
hp
 = 
_expœe_hooks
.
	`fšdp
(
r
->
de¡_
);

467 
	`dsdv_as£¹
(
hp
 && *hp);

471 
	`dsdv_as£¹
(
r
->
de¡_
 !ğ

 ? (*
exp_tim”
)->
	`scheduËd
(è: 
Œue
);

474 ià((*
exp_tim”
)->
	`scheduËd
())

475 (*
exp_tim”
)->
	`unscheduË
();

476 
d–‘e
 *
exp_tim”
;

477 
d–‘e
 *
hp
;

478 
_expœe_tim”s
.
	`»move
(
r
->
de¡_
);

479 
_expœe_hooks
.
	`»move
(
r
->
de¡_
);

482 
r
->
	`šv®id©e
(
jiff
);

483 #ià
USE_OLD_SEQ


484 
RTEÁry
 *
Şd_r
 = 
_Şd_¹es
.
	`fšdp
(
r
->
de¡_
);

485 ià(
Şd_r
 && old_r->
	`good
())

486 
Şd_r
->
	`šv®id©e
(
jiff
);

488 
r
->
‰l
 = 
grid_h–lo
::
MAX_TTL_DEFAULT
;

491 
r
->
adv”ti£_ok_jiff›s
 = 
jiff
;

492 
r
->
Ãed_£q_ad
 = 
Œue
;

493 
r
->
Ãed_m‘ric_ad
 = 
Œue
;

494 
	`scheduË_Œigg”ed_upd©e
(
r
->
de¡_
, 
jiff
);

497 ià(
_log
)

498 
_log
->
	`log_’d_expœe_hªdËr
();

500 
	`check_šv¬ŸÁs
();

501 
	}
}

504 
	gDSDVRou‹TabË
::
	$scheduË_Œigg”ed_upd©e
(cÚ¡ 
IPAdd»ss
 &

, 
wh’
)

506 
	`check_šv¬ŸÁs
();

509 
Tim”
 **
Şd
 = 
_Œigg”_tim”s
.
	`fšdp
(

);

510 
HookPaœ
 **
Şdhp
 = 
_Œigg”_hooks
.
	`fšdp
(

);

511 ià(
Şd
) {

512 
	`dsdv_as£¹
(*
Şd
 && (*Şd)->
	`scheduËd
(è&& 
Şdhp
 && *oldhp);

513 (*
Şd
)->
	`unscheduË
();

514 
d–‘e
 *
Şd
;

515 
d–‘e
 *
Şdhp
;

519 
HookPaœ
 *
hp
 = 
Ãw
 
	`HookPaœ
(
this
, 

);

520 
Tim”
 *
t
 = 
Ãw
 
	`Tim”
(
¡©ic_Œigg”_hook
, (*è
hp
);

521 
t
->
	`š™Ÿlize
(
this
);

522 
jiff
 = 
	`dsdv_jiff›s
();

523 
t
->
	`scheduË_aá”_m£c
(
	`jiff_to_m£c
(
jiff
 > 
wh’
 ? 0 : when - jiff));

524 
_Œigg”_tim”s
.
	`š£¹
(

, 
t
);

525 
_Œigg”_hooks
.
	`š£¹
(

, 
hp
);

527 
	`check_šv¬ŸÁs
();

528 
	}
}

531 
	gDSDVRou‹TabË
::
	$Œigg”_hook
(cÚ¡ 
IPAdd»ss
 &

)

533 
	`check_šv¬ŸÁs
(&

);

537 
Tim”
 **
Şd
 = 
_Œigg”_tim”s
.
	`fšdp
(

);

538 
HookPaœ
 **
Şdhp
 = 
_Œigg”_hooks
.
	`fšdp
(

);

539 
	`dsdv_as£¹
(
Şd
 && *Şd && !(*Şd)->
	`scheduËd
(è&& 
Şdhp
 && *oldhp);

541 
jiff
 = 
	`dsdv_jiff›s
();

542 
Ãxt_Œigg”_jiff
 = 
_Ï¡_Œigg”ed_upd©e
 + 
	`m£c_to_jiff
(
_mš_Œigg”ed_upd©e_³riod
);

544 #ià
DBG


545 
	`şick_ch©‹r
("%s: XXXrigg”_hoook(%s)\n", 
	`Çme
().
	`c_¡r
(), 

.
	`uÅ¬£
().c_str());

548 ià(
jiff
 >ğ
Ãxt_Œigg”_jiff
) {

550 
d–‘e
 *
Şd
;

551 
d–‘e
 *
Şdhp
;

552 
_Œigg”_tim”s
.
	`»move
(

);

553 
_Œigg”_hooks
.
	`»move
(

);

555 
	`£nd_Œigg”ed_upd©e
(

);

556 #ià
DBG


557 
	`şick_ch©‹r
("%s: XXX s’ˆŒigg”ed upd©e\n", 
	`Çme
().
	`c_¡r
());

561 #ià
DBG


562 
	`şick_ch©‹r
("%s: XXXoØ—¾yØ£ndrigg”ed upd©(jiff=%d,‚ext_Œigg”_jiff=%d, _mš_Œigg”ed_upd©e_³riod=%d)\n", 
	`Çme
().
	`c_¡r
(), 
jiff
, 
Ãxt_Œigg”_jiff
, 
_mš_Œigg”ed_upd©e_³riod
);

566 
VeùÜ
<
IPAdd»ss
> 
»move_li¡
;

567 
TMI‹r
 
i
 = 
_Œigg”_tim”s
.
	`begš
(); i.
	`live
(); i++) {

568 ià(
i
.
	`key
(è=ğ

)

572 
Tim”
 *
Şd2
 = 
i
.
	`v®ue
();

573 
	`dsdv_as£¹
(
Şd2
 && old2->
	`scheduËd
());

575 
HookPaœ
 **
Şdhp
 = 
_Œigg”_hooks
.
	`fšdp
(
i
.
	`key
());

576 
	`dsdv_as£¹
(
Şdhp
 && *oldhp);

578 
RTEÁry
 *
r
 = 
_¹es
.
	`fšdp
(
i
.
	`key
());

579 ià(
r
->
adv”ti£_ok_jiff›s
 < 
Ãxt_Œigg”_jiff
) {

580 
d–‘e
 
Şd2
;

581 
d–‘e
 *
Şdhp
;

582 
»move_li¡
.
	`push_back
(
i
.
	`key
());

586 
i
 = 0; i < 
»move_li¡
.
	`size
(); i++) {

587 
_Œigg”_tim”s
.
	`»move
(
»move_li¡
[
i
]);

588 
_Œigg”_hooks
.
	`»move
(
»move_li¡
[
i
]);

594 (*
Şd
)->
	`scheduË_aá”_m£c
(
	`jiff_to_m£c
(
Ãxt_Œigg”_jiff
 - 
jiff
));

597 
	`check_šv¬ŸÁs
();

598 
	}
}

602 
	gDSDVRou‹TabË
::
	$š™_m‘ric
(
RTEÁry
 &
r
)

604 
	`dsdv_as£¹
(
r
.
	`num_hİs
() == 1);

606 #ià
SEQ_METRIC


607 ià(
_u£_£q_m‘ric
) {

608 
r
.
m‘ric
 = 
	`m‘ric_t
Ô.
	`num_hİs
());

609 
Deque
<> *
q
 = 
_£q_hi¡Üy
.
	`fšdp
(
r
.
de¡_
);

610 ià(!
q
 || q->
	`size
(è< 
MAX_BCAST_HISTORY
)

611 
r
.
m‘ric
 = 
_bad_m‘ric
;

613 
	`dsdv_as£¹
(
q
->
	`size
(è=ğ
MAX_BCAST_HISTORY
);

614 
num_missšg
 = 
q
->
	`back
(è- (q->
	`äÚt
(è+ 
MAX_BCAST_HISTORY
 - 1);

615 ià(
num_missšg
 > 
MAX_BCAST_HISTORY
 - 
OLD_BCASTS_NEEDED
)

616 
r
.
m‘ric
 = 
_bad_m‘ric
;

622 ià(
_m‘ric
)

623 
r
.
m‘ric
 = 
_m‘ric
->
	`g‘_lšk_m‘ric
Ô.
de¡_‘h
, 
Œue
);

625 
r
.
m‘ric
 = 
_bad_m‘ric
;

626 
	}
}

629 
	gDSDVRou‹TabË
::
	$upd©e_w¡
(
RTEÁry
 *
Şd_r
, RTEÁry &
Ãw_r
, 
jiff
)

631 ià(
Şd_r
) {

632 
Şd_r
->
	`check
();

633 
	`dsdv_as£¹
(
Şd_r
->
Ï¡_upd©ed_jiff›s
 <ğ
Ãw_r
.last_updated_jiffies);

636 ià(
Şd_r
 == 0) {

637 
Ãw_r
.
w¡
 = 
_w¡0
;

638 
Ãw_r
.
Ï¡_£q_jiff›s
 = 
jiff
;

639 
Ãw_r
.
	`check
();

641 ià(
Şd_r
->
	`£q_no
(è=ğ
Ãw_r
.seq_no()) {

642 
Ãw_r
.
w¡
 = 
Şd_r
->wst;

643 
Ãw_r
.
Ï¡_£q_jiff›s
 = 
Şd_r
->last_seq_jiffies;

644 
Ãw_r
.
	`check
();

646 ià(
Şd_r
->
	`£q_no
(è< 
Ãw_r
.seq_no()) {

647 
	`dsdv_as£¹
(
Şd_r
->
Ï¡_upd©ed_jiff›s
 >ğŞd_r->
Ï¡_£q_jiff›s
);

648 
Ãw_r
.
w¡
 = 
_®pha
 * 
Şd_r
->wst +

649 (100 - 
_®pha
è* 
	`jiff_to_m£c
(
Şd_r
->
Ï¡_upd©ed_jiff›s
 - old_r->
Ï¡_£q_jiff›s
);

650 
Ãw_r
.
w¡
 /= 100;

651 
Ãw_r
.
Ï¡_£q_jiff›s
 = 
jiff
;

652 
Ãw_r
.
	`check
();

655 
	`dsdv_as£¹
(
Şd_r
->
	`£q_no
(è> 
Ãw_r
.seq_no());

667 
	}
}

670 
	gDSDVRou‹TabË
::
	$upd©e_m‘ric
(
RTEÁry
 &
r
)

672 
	`dsdv_as£¹
(
r
.
	`num_hİs
() > 1);

674 
RTEÁry
 *
Ãxt_hİ
 = 
_¹es
.
	`fšdp
(
r
.
Ãxt_hİ_
);

675 ià(!
Ãxt_hİ
) {

676 
	`şick_ch©‹r
("DSDVRouteTable %s: ERROR updating metric for %s;‚o information for‚ext hop %s; invalidating metric",

677 
	`Çme
().
	`c_¡r
(), 
r
.
de¡_
.
	`uÅ¬£
().c_¡r(),„.
Ãxt_hİ_
.unparse().c_str());

678 
r
.
m‘ric
 = 
_bad_m‘ric
;

682 #ià
ENABLE_SEEN


683 ià(
_u£_£’
 && 
Ãxt_hİ
->
m‘ric
.
	`v®
(è=ğ
_m‘ric_£’
) {

684 
r
.
m‘ric
 = 
	`m‘ric_t
(
_m‘ric_£’
, 
çl£
);

689 #ià
SEQ_METRIC


690 ià(
_u£_£q_m‘ric
) {

691 
r
.
m‘ric
 = 
	`m‘ric_t
Ô.m‘ric.
	`v®
(è+ 
Ãxt_hİ
->metric.val());

696 ià(
_m‘ric
)

697 
r
.
m‘ric
 = 
_m‘ric
->
	`´•’d_m‘ric
Ô.m‘ric, 
Ãxt_hİ
->metric);

699 
r
.
m‘ric
 = 
_bad_m‘ric
;

700 
	}
}

702 
boŞ


703 
	gDSDVRou‹TabË
::
	$m‘ric_´eã¿bË
(cÚ¡ 
RTEÁry
 &
r1
, cÚ¡ RTEÁry &
r2
)

706 #ià
DBG2


707 
	`şick_ch©‹r
("%s: XXX m‘ric_´eã¿bË v®id? 1:%  2:%  1 < 2? %s", 
	`Çme
().
	`c_¡r
(),

708 (
r1
.
m‘ric
.
	`good
(è? "yes" : "no"), (
r2
.metric.good() ? "yes" : "no"),

709 (
	`m‘ric_v®_É
(
r1
.
m‘ric
.
	`v®
(), 
r2
.metric.val()) ? "yes" : "no"));

710 
	`şick_ch©‹r
("\Œ1.m‘ric=%u,„2.m‘ric=%u", 
r1
.
m‘ric
.
	`v®
(), 
r2
.metric.val());

714 ià(
r1
.
m‘ric
.
	`good
(è&& !
r2
.metric.good())

715  
Œue
;

716 ià(!
r1
.
m‘ric
.
	`good
(è&& 
r2
.metric.good())

717  
çl£
;

722 ià(!
r1
.
m‘ric
.
	`good
(è&& !
r2
.metric.good())

723  
r1
.
	`num_hİs
(è< 
r2
.num_hops();

725 
	`dsdv_as£¹
(
r1
.
m‘ric
.
	`good
(è&& 
r2
.metric.good());

726  
	`m‘ric_v®_É
(
r1
.
m‘ric
, 
r2
.metric);

727 
	}
}

729 
boŞ


730 
	gDSDVRou‹TabË
::
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &
m1
, cÚ¡ m‘ric_ˆ&
m2
)

732 
	`as£¹
(
m1
.
	`good
(è&& 
m2
.good());

735 #ià
SEQ_METRIC


736 ià(
_u£_£q_m‘ric
)

737  
m1
.
	`v®
(è< 
m2
.val();

740 ià(
_m‘ric
)

741  
_m‘ric
->
	`m‘ric_v®_É
(
m1
, 
m2
);

743  
çl£
;

744 
	}
}

746 
boŞ


747 
	gDSDVRou‹TabË
::
	$m‘rics_difãr
(cÚ¡ 
m‘ric_t
 &
m1
, cÚ¡ m‘ric_ˆ&
m2
)

749 ià(!
m1
.
	`good
(è&& !
m2
.good()è 
çl£
;

750 ià(
m1
.
	`good
(è&& !
m2
.good()è 
Œue
;

751 ià(!
m1
.
	`good
(è&& 
m2
.good()è 
Œue
;

753 
	`dsdv_as£¹
(
m1
.
	`good
(è&& 
m2
.good());

754  
	`m‘ric_v®_É
(
m1
, 
m2
) || metric_val_lt(m2, m1);

755 
	}
}

758 
	gDSDVRou‹TabË
::
	$£nd_fuÎ_upd©e
()

760 
	`check_šv¬ŸÁs
();

761 #ià
DBG


762 
	`şick_ch©‹r
("%s: XXX s’dšg fuÎ upd©e\n", 
	`Çme
().
	`c_¡r
());

764 
jiff
 = 
	`dsdv_jiff›s
();

765 
VeùÜ
<
RTEÁry
> 
rou‹s
;

767 
RTI‹r
 
i
 = 
_¹es
.
	`begš
(); i.
	`live
(); i++) {

768 cÚ¡ 
RTEÁry
 &
r
 = 
i
.
	`v®ue
();

769 ià(
r
.
adv”ti£_ok_jiff›s
 <ğ
jiff
)

770 
rou‹s
.
	`push_back
(
r
);

771 #ià
DBG


773 
	`şick_ch©‹r
("%s: XXXƒxşudšg %s\n", 
	`Çme
().
	`c_¡r
(), 
r
.
de¡_
.
	`uÅ¬£
().c_str());

778 
VeùÜ
<
RTEÁry
> 
ad_rou‹s
;

779 
i
 = 0; i < 
rou‹s
.
	`size
(è&& i < 
	`max_¹es_³r_ad
(); i++) {

780 ià(
ad_rou‹s
.
	`size
(è=ğ
	`max_¹es_³r_ad
()) {

781 
	`bud_ªd_tx_ad
(
ad_rou‹s
);

782 
ad_rou‹s
.
	`ş—r
();

783 #ià
DBG


784 
	`şick_ch©‹r
("%s:oo many„outes; sending out…artial full dump (%d)\n",

785 
	`Çme
().
	`c_¡r
(), 
i
);

789 
ad_rou‹s
.
	`push_back
(
rou‹s
[
i
]);

791 
RTEÁry
 *
r
 = 
_¹es
.
	`fšdp
(
rou‹s
[
i
].
de¡_
);

792 
	`dsdv_as£¹
(
r
);

793 
r
->
Ãed_£q_ad
 = 
çl£
;

794 
r
->
Ãed_m‘ric_ad
 = 
çl£
;

795 
r
->
Ï¡_adv_m‘ric
 =„->
m‘ric
;

797 
	`bud_ªd_tx_ad
(
ad_rou‹s
);

805 
_£q_no
 += 2;

806 
_Ï¡_³riodic_upd©e
 = 
jiff
;

807 
_Ï¡_Œigg”ed_upd©e
 = 
jiff
;

809 
	`check_šv¬ŸÁs
();

810 
	}
}

813 
	gDSDVRou‹TabË
::
	$£nd_Œigg”ed_upd©e
(cÚ¡ 
IPAdd»ss
 &

)

815 
	`check_šv¬ŸÁs
();

821 
RTEÁry
 *
r
 = 
_¹es
.
	`fšdp
(

);

822 
	`dsdv_as£¹
(
r
);

824 
jiff
 = 
	`dsdv_jiff›s
();

826 
VeùÜ
<
RTEÁry
> 
Œigg”ed_rou‹s
;

827 
RTI‹r
 
i
 = 
_¹es
.
	`begš
(); i.
	`live
(); i++) {

828 cÚ¡ 
RTEÁry
 &
r
 = 
i
.
	`v®ue
();

830 ià((
r
.
Ãed_£q_ad
 ||„.
Ãed_m‘ric_ad
) &&

831 
r
.
adv”ti£_ok_jiff›s
 <ğ
jiff
)

832 
Œigg”ed_rou‹s
.
	`push_back
(
r
);

834 #ià
FULL_DUMP_ON_TRIG_UPDATE


837 ià(3*
Œigg”ed_rou‹s
.
	`size
(è> 
_¹es
.size() &&riggered_routes.size() > 3) {

838 
	`£nd_fuÎ_upd©e
();

842 ià(
Œigg”ed_rou‹s
.
	`size
() == 0)

846 
VeùÜ
<
RTEÁry
> 
ad_rou‹s
;

847 
i
 = 0; i < 
Œigg”ed_rou‹s
.
	`size
(); i++) {

848 ià(
ad_rou‹s
.
	`size
(è=ğ
	`max_¹es_³r_ad
()) {

849 
	`bud_ªd_tx_ad
(
ad_rou‹s
);

850 
ad_rou‹s
.
	`ş—r
();

851 #ià
DBG


852 
	`şick_ch©‹r
("%s:oo many„outes; sending out…artialriggered update (%d)\n",

853 
	`Çme
().
	`c_¡r
(), 
i
);

857 
ad_rou‹s
.
	`push_back
(
Œigg”ed_rou‹s
[
i
]);

859 
RTEÁry
 *
r
 = 
_¹es
.
	`fšdp
(
Œigg”ed_rou‹s
[
i
].
de¡_
);

860 
	`dsdv_as£¹
(
r
);

861 
r
->
Ãed_£q_ad
 = 
çl£
;

862 
r
->
Ï¡_adv_m‘ric
 =„->
m‘ric
;

864 
	`bud_ªd_tx_ad
(
ad_rou‹s
);

866 
_Ï¡_Œigg”ed_upd©e
 = 
jiff
;

868 
	`check_šv¬ŸÁs
();

869 
	}
}

871 
boŞ


872 
	gDSDVRou‹TabË
::
	$hªdË_upd©e
(
RTEÁry
 
Ãw_r
, cÚ¡ 
boŞ
 
was_£nd”
, cÚ¡ 
jiff
)

874 
	`check_šv¬ŸÁs
();

875 
Ãw_r
.
	`check
();

877 
	`dsdv_as£¹
(
was_£nd”
 ? 
Ãw_r
.
	`num_hİs
() == 1 :‚ew_r.num_hops() != 1);

879 ià(
Ãw_r
.
	`good
(è&&‚ew_r.
	`num_hİs
(è>
_max_hİs
)

880  
çl£
;

882 ià(
was_£nd”
)

883 
	`š™_m‘ric
(
Ãw_r
);

884 ià(
Ãw_r
.
	`good
())

885 
	`upd©e_m‘ric
(
Ãw_r
);

887 ià(
_ignÜe_šv®id_rou‹s
 && !
Ãw_r
.
m‘ric
.
	`good
())

888  
çl£
;

891 
RTEÁry
 *
Şd_r
 = 
_¹es
.
	`fšdp
(
Ãw_r
.
de¡_
);

892 
	`upd©e_w¡
(
Şd_r
, 
Ãw_r
, 
jiff
);

904 ià(
Ãw_r
.
	`good
(è&& (!
Şd_r
 || old_r->good()))

905 
Ãw_r
.
adv”ti£_ok_jiff›s
 =‚ew_r.
Ï¡_£q_jiff›s
 + 
	`m£c_to_jiff
((è(2 *‚ew_r.
w¡
));

907 
Ãw_r
.
adv”ti£_ok_jiff›s
 = 
jiff
;

909 #ià
DBG


910 
	`şick_ch©‹r
("%s: XXX dest=%s‡dvertise_ok_jiffies=%u wst=%u jiff=%d\n",

911 
	`Çme
().
	`c_¡r
(), 
Ãw_r
.
de¡_
.
	`uÅ¬£
().c_str(),

912 
Ãw_r
.
adv”ti£_ok_jiff›s
,‚ew_r.
w¡
, 
jiff
);

915 ià(!
Şd_r
) {

917 ià(
Ãw_r
.
	`good
()) {

918 
Ãw_r
.
Ãed_m‘ric_ad
 = 
Œue
;

919 
	`scheduË_Œigg”ed_upd©e
(
Ãw_r
.
de¡_
,‚ew_r.
adv”ti£_ok_jiff›s
);

920 #ià
DBG


921 
	`şick_ch©‹r
("%s: XXX scheduËd b¿nd-Ãw„ou‹Ø% tØbadv”ti£d iÀ%d jiff› äom‚ow\n", 
	`Çme
().
	`c_¡r
(),

922 
Ãw_r
.
de¡_
.
	`uÅ¬£
().
	`c_¡r
(),‚ew_r.
adv”ti£_ok_jiff›s
 - 
jiff
);

925 
	`š£¹_rou‹
(
Ãw_r
, 
was_£nd”
 ? 
GridG’”icLogg”
::
NEW_DEST_SENDER
 : GridG’”icLogg”::
NEW_DEST
);

927 ià(
Şd_r
->
	`£q_no
(è=ğ
Ãw_r
.seq_no()) {

929 
	`dsdv_as£¹
(
Ãw_r
.
	`good
(è? 
Şd_r
->good(è: old_r->
	`brok’
());

930 #ià
DBG2


931 
	`şick_ch©‹r
("%s: XXX checking for better„outeo %s from %s with same seqno %u",

932 
	`Çme
().
	`c_¡r
(), 
Ãw_r
.
de¡_
.
	`uÅ¬£
().c_¡r(),‚ew_r.
Ãxt_hİ_
.
	`s
().c_¡r(),‚ew_r.
	`£q_no
());

933 
	`şick_ch©‹r
("%s: XXX good=% …»ã¿bË=%s", 
	`Çme
().
	`c_¡r
(), 
Ãw_r
.
	`good
() ? "yes" : "no",

934 
	`m‘ric_´eã¿bË
(
Ãw_r
, *
Şd_r
) ? "yes" : "no");

936 ià(
Ãw_r
.
	`good
(è&& 
	`m‘ric_´eã¿bË
Òew_r, *
Şd_r
)) {

937 ià(
	`m‘rics_difãr
(
Ãw_r
.
m‘ric
,‚ew_r.
Ï¡_adv_m‘ric
)) {

938 
Ãw_r
.
Ãed_m‘ric_ad
 = 
Œue
;

939 
	`scheduË_Œigg”ed_upd©e
(
Ãw_r
.
de¡_
,‚ew_r.
adv”ti£_ok_jiff›s
);

941 
	`š£¹_rou‹
(
Ãw_r
, 
was_£nd”
 ? 
GridG’”icLogg”
::
BETTER_RTE_SENDER
 : GridG’”icLogg”::
BETTER_RTE
);

944 ià(
Şd_r
->
	`£q_no
(è< 
Ãw_r
.seq_no()) {

946 
Ãw_r
.
Ãed_£q_ad
 = 
Œue
;

947 
	`scheduË_Œigg”ed_upd©e
(
Ãw_r
.
de¡_
,‚ew_r.
adv”ti£_ok_jiff›s
);

948 ià(
	`m‘rics_difãr
(
Ãw_r
.
m‘ric
,‚ew_r.
Ï¡_adv_m‘ric
))

949 
Ãw_r
.
Ãed_m‘ric_ad
 = 
Œue
;

950 
	`š£¹_rou‹
(
Ãw_r
, 
was_£nd”
 ? 
GridG’”icLogg”
::
NEWER_SEQ_SENDER
 : GridG’”icLogg”::
NEWER_SEQ
);

953 
	`dsdv_as£¹
(
Şd_r
->
	`£q_no
(è> 
Ãw_r
.seq_no());

954 ià(
Ãw_r
.
	`brok’
(è&& 
Şd_r
->
	`good
()) {

956 
Şd_r
->
adv”ti£_ok_jiff›s
 = 
jiff
;

957 
Şd_r
->
Ãed_m‘ric_ad
 = 
Œue
;

958 
	`scheduË_Œigg”ed_upd©e
(
Şd_r
->
de¡_
, 
jiff
);

959 
	`check_šv¬ŸÁs
();

960  
çl£
;

962 ià(
Ãw_r
.
	`good
(è&& 
Şd_r
->
	`brok’
()) {

965 
	`dsdv_as£¹
(
jiff
 >ğ
Şd_r
->
Ï¡_expœed_jiff›s
);

966 
age
 = 
	`jiff_to_m£c
(
jiff
 - 
Şd_r
->
Ï¡_expœed_jiff›s
);

967 ià(
age
 > 2 * 
grid_h–lo
::
MAX_TTL_DEFAULT
 || 
was_£nd”
) {

972 
Ãw_r
.
Ãed_£q_ad
 = 
Œue
;

973 
Ãw_r
.
Ãed_m‘ric_ad
 = 
Œue
;

974 
Ãw_r
.
Ï¡_£q_jiff›s
 = 
jiff
;

975 
	`dsdv_as£¹
(
Ãw_r
.
Ï¡_upd©ed_jiff›s
 =ğÃw_r.
Ï¡_£q_jiff›s
);

976 
	`scheduË_Œigg”ed_upd©e
(
Ãw_r
.
de¡_
,‚ew_r.
adv”ti£_ok_jiff›s
);

977 
	`š£¹_rou‹
(
Ãw_r
, 
was_£nd”
 ? 
GridG’”icLogg”
::
REBOOT_SEQ_SENDER
 : GridG’”icLogg”::
REBOOT_SEQ
);

981 
	`check_šv¬ŸÁs
();

982  
Œue
;

983 
	}
}

985 
Pack‘
 *

986 
	gDSDVRou‹TabË
::
	$sim¶e_aùiÚ
(
Pack‘
 *
·ck‘
)

988 
	`check_šv¬ŸÁs
();

990 
	`dsdv_as£¹
(
·ck‘
);

991 
jiff
 = 
	`dsdv_jiff›s
();

998 
şick_‘h”
 *
eh
 = (şick_‘h” *è
·ck‘
->
	`d©a
();

999 ià(
	`Áohs
(
eh
->
‘h”_ty³
è!ğ
ETHERTYPE_GRID
) {

1000 
	`şick_ch©‹r
("DSDVRou‹TabË %s: gÙ‚Ú-Grid…ack‘y³", 
	`Çme
().
	`c_¡r
());

1001 
·ck‘
->
	`kl
();

1004 
grid_hdr
 *
gh
 = (grid_hd¸*è(
eh
 + 1);

1006 ià(
gh
->
ty³
 !ğ
grid_hdr
::
GRID_LR_HELLO
) {

1007 
	`şick_ch©‹r
("DSDVRou‹TabË %s:„eûived unknowÀGrid…ack‘; ignÜšg it", 
	`Çme
().
	`c_¡r
());

1008 
·ck‘
->
	`kl
();

1012 
IPAdd»ss
 
	`addr
((*è&
gh
->
tx_
);

1013 
Eth”Add»ss
 
	`‘haddr
((*è
eh
->
‘h”_sho¡
);

1015 ià(
‘haddr
 =ğ
_‘h
) {

1016 
	`şick_ch©‹r
("DSDVRou‹TabË %s:„eûived owÀGrid…ack‘; ignÜšg it", 
	`Çme
().
	`c_¡r
());

1017 
·ck‘
->
	`kl
();

1021 
grid_h–lo
 *
hlo
 = (grid_h–lØ*è(
gh
 + 1);

1023 ià(
_log
)

1024 
_log
->
	`log_¡¬t_»cv_adv”ti£m’t
(
	`Áohl
(
hlo
->
£q_no
), 
addr
, 
Time¡amp
::
	`now
());

1028 
’Œy_sz
 = 
hlo
->
nbr_’Œy_sz
;

1029 *
’Œy_±r
 = (*è(
hlo
 + 1);

1030 
max_’Œ›s
 = (
	`Áohs
(
gh
->
tÙ®_Ën
è- (*ghè- (*
hlo
)è/ 
’Œy_sz
;

1031 
num_’Œ›s
 = 
hlo
->
num_nbrs
;

1032 ià(
num_’Œ›s
 > 
max_’Œ›s
) {

1033 
	`şick_ch©‹r
("DSDVRouteTable %s:„oute‡d from %s contains fewer„outeshan claimed; want %u, have‚o morehan %u",

1034 
	`Çme
().
	`c_¡r
(), 
addr
.
	`uÅ¬£
().c_¡r(), 
num_’Œ›s
, 
max_’Œ›s
);

1035 
num_’Œ›s
 = 
max_’Œ›s
;

1039 
RTEÁry
 *
r
 = 
_¹es
.
	`fšdp
(
addr
);

1040 ià(!
r
)

1041 
	`şick_ch©‹r
("DSDVRouteTable %s:‚ew 1-hop‚br %s -- %s",

1042 
	`Çme
().
	`c_¡r
(), 
addr
.
	`uÅ¬£
().c_¡r(), 
‘haddr
.unparse().c_str());

1043 ià(
r
->
de¡_‘h
 &&„->de¡_‘h !ğ
‘haddr
)

1044 
	`şick_ch©‹r
("DSDVRouteTable %s:ƒthernet‡ddress of %s changed from %so %s",

1045 
	`Çme
().
	`c_¡r
(), 
addr
.
	`uÅ¬£
().c_¡r(), 
r
->
de¡_‘h
.uÅ¬£().c_¡r(), 
‘haddr
.unparse().c_str());

1047 #ià
SEQ_METRIC


1049 
Deque
<> *
q
 = 
_£q_hi¡Üy
.
	`fšdp
(
addr
);

1050 ià(!
q
) {

1051 
_£q_hi¡Üy
.
	`š£¹
(
addr
, 
Deque
<>());

1052 
q
 = 
_£q_hi¡Üy
.
	`fšdp
(
addr
);

1054 
bÿ¡_num
 = 
	`Áohl
(
grid_hdr
::
	`g‘_·d_by‹s
(*
gh
));

1055 
q
->
	`push_back
(
bÿ¡_num
);

1056 
q
->
	`size
(è> 
MAX_BCAST_HISTORY
)

1057 
q
->
	`pİ_äÚt
();

1060 
RTEÁry
 
	`Ãw_r
(
addr
, 
‘haddr
, 
gh
, 
hlo
, 
	`PAINT_ANNO
(
·ck‘
), 
jiff
);

1061 
boŞ
 
š£¹ed_Ãw_r
;

1063 #ià
ENABLE_SEEN


1064 
boŞ
 
£nd”_§w_us
 = 
çl£
;

1065 cÚ¡ *
c
 = 
’Œy_±r
;

1066 
i
 = 0; i < 
num_’Œ›s
; i++, 
c
 +ğ
’Œy_sz
) {

1067 cÚ¡ 
grid_nbr_’Œy
 *
e
 = (cÚ¡ grid_nbr_’Œy *è
c
;

1068 ià(
e
->

 =ğ
_
.
	`addr
(è&&ƒ->
num_hİs
 == 1) {

1069 
£nd”_§w_us
 = 
Œue
;

1073 
Ãw_r
.
Ï¡_£’_jiff›s
 = 
£nd”_§w_us
 ? 
jiff
 : 0;

1075 
RTEÁry
 *
Şd
 = 
_¹es
.
	`fšdp
(
Ãw_r
.
de¡_
);

1080 ià(
Şd
)

1081 
	`şick_ch©‹r
("XXX %s %s snd_saw %s old metric %u old†ast seen %u\n",

1082 
	`Çme
().
	`c_¡r
(), 
addr
.
	`uÅ¬£
().c_¡r(), 
£nd”_§w_us
 ? "y" : "n", 
Şd
->
m‘ric
.
v®
, old->
Ï¡_£’_jiff›s
);

1084 
	`şick_ch©‹r
("XXX %s %s snd_saw %s\n",

1085 
	`Çme
().
	`c_¡r
(), 
addr
.
	`uÅ¬£
().c_¡r(), 
£nd”_§w_us
 ? "y" : "n");

1087 ià(
_u£_£’
 && !
£nd”_§w_us
 &&

1088 (!
Şd
 || old->
m‘ric
.
	`v®
(è=ğ
_m‘ric_£’
 || (
jiff
 - old->
Ï¡_£’_jiff›s
è> 3*
	`m£c_to_jiff
(
_³riod
))) {

1089 
Ãw_r
.
m‘ric
 = 
	`m‘ric_t
(
_m‘ric_£’
, 
çl£
);

1090 
Ãw_r
.
adv”ti£_ok_jiff›s
 = 
jiff
;

1091 
Ãw_r
.
Ãed_m‘ric_ad
 = 
Œue
;

1092 
	`scheduË_Œigg”ed_upd©e
(
Ãw_r
.
de¡_
, 
jiff
);

1093 
	`š£¹_rou‹
(
Ãw_r
, 
GridG’”icLogg”
::
NEW_DEST_SENDER
);

1094 
š£¹ed_Ãw_r
 = 
Œue
;

1095 
aá”_£nd”_upd©e
;

1100 
š£¹ed_Ãw_r
 = 
	`hªdË_upd©e
(
Ãw_r
, 
Œue
, 
jiff
);

1102 #ià
ENABLE_SEEN


1103 
aá”_£nd”_upd©e
:

1107 ià(
š£¹ed_Ãw_r
) {

1108 
r
 = 
_¹es
.
	`fšdp
(
addr
);

1109 
	`dsdv_as£¹
(
r
);

1110 
r
->
de¡_‘h
 = 
‘haddr
;

1114 
boŞ
 
Ãed_fuÎ_upd©e
 = 
çl£
;

1115 
i
 = 0; i < 
num_’Œ›s
; i++, 
’Œy_±r
 +ğ
’Œy_sz
) {

1117 
grid_nbr_’Œy
 *
cu¼
 = (grid_nbr_’Œy *è
’Œy_±r
;

1118 
RTEÁry
 
	`rou‹
(
addr
, 
‘haddr
, 
cu¼
, 
	`PAINT_ANNO
(
·ck‘
), 
jiff
);

1120 ià(
rou‹
.
‰l
 == 0)

1122 ià(
rou‹
.
de¡_
 =ğ
_
) {

1123 ià(
rou‹
.
	`brok’
())

1124 
Ãed_fuÎ_upd©e
 = 
Œue
;

1127 ià(
cu¼
->
Ãxt_hİ_
 =ğ(è
_
)

1130 
	`hªdË_upd©e
(
rou‹
, 
çl£
, 
jiff
);

1133 ià(
_log
)

1134 
_log
->
	`log_’d_»cv_adv”ti£m’t
();

1136 ià(
Ãed_fuÎ_upd©e
)

1137 
	`£nd_fuÎ_upd©e
();

1139 
·ck‘
->
	`kl
();

1140 
	`check_šv¬ŸÁs
();

1142 
	}
}

1144 
SŒšg


1145 
	gDSDVRou‹TabË
::
	$jiff_diff_¡ršg
(
j1
, 
j2
) {

1146 
boŞ
 
Ãg
;

1147 
d
 = 
	`jiff_diff_as_m£c
(
j1
, 
j2
, 
Ãg
);

1148 
SŒšg
 
	`»t
(
d
);

1149 ià(
Ãg
)

1150 
»t
 = "-" +„et;

1151  
»t
;

1152 
	}
}

1155 
	gDSDVRou‹TabË
::
	$jiff_diff_as_m£c
(
j1
, 
j2
, 
boŞ
 &
Ãg
)

1157 
Ãg
 = 
j2
 > 
j1
;

1158  
	`jiff_to_m£c
(
Ãg
 ? 
j2
 - 
j1
 : j1 - j2);

1159 
	}
}

1161 
SŒšg


1162 
	gDSDVRou‹TabË
::
	$´št_¹es_v
(
EËm’t
 *
e
, *)

1164 
DSDVRou‹TabË
 *
n
 = (DSDVRou‹TabË *è
e
;

1166 
jiff
 = 
	`dsdv_jiff›s
();

1168 
SŒšg
 
s
;

1169 
RTI‹r
 
i
 = 
n
->
_¹es
.
	`begš
(); i.
	`live
(); i++) {

1170 #ià
USE_OLD_SEQ


1171 
RTEÁry
 
f
 = 
i
.
	`v®ue
();

1172 ià(
n
->
	`u£_Şd_rou‹
(
f
.
de¡_
, 
jiff
))

1173 
f
 = 
n
->
_Şd_¹es
[f.
de¡_
];

1175 cÚ¡ 
RTEÁry
 &
f
 = 
i
.
	`v®ue
();

1177 
s
 +ğ
f
.
de¡_
.
	`uÅ¬£
()

1178 + "‚ext=" + 
f
.
Ãxt_hİ_
.
	`uÅ¬£
()

1179 + " hİs=" + 
	`SŒšg
((è
f
.
	`num_hİs
())

1180 + " gw=" + (
f
.
is_g©eway
 ? "y" : "n")

1181 + "†oc=" + 
f
.
de¡_loc
.
	`s
()

1182 + "ƒ¼=" + (
f
.
loc_good
 ? "" : "-"è+ 
	`SŒšg
(f.
loc_”r
)

1183 + " seq=" + 
	`SŒšg
(
f
.
	`£q_no
())

1184 + " m‘ric_v®id=" + (
f
.
m‘ric
.
	`good
() ? "yes" : "no")

1185 + " m‘ric=" + 
	`SŒšg
(
f
.
m‘ric
.
	`v®
())

1186 + "=" + 
	`SŒšg
(
f
.
‰l
)

1187 + " w¡=" + 
	`SŒšg
((è
f
.
w¡
)

1188 + "‚“d_£q_ad=" + (
f
.
Ãed_£q_ad
 ? "yes" : "no")

1189 + "‚“d_m‘ric_ad=" + (
f
.
Ãed_m‘ric_ad
 ? "yes" : "no")

1190 + "†a¡_expœed=" + 
	`jiff_diff_¡ršg
(
f
.
Ï¡_expœed_jiff›s
, 
jiff
)

1191 + "†a¡_upd©ed=" + 
	`jiff_diff_¡ršg
(
f
.
Ï¡_upd©ed_jiff›s
, 
jiff
)

1192 + "†a¡_£q=" + 
	`jiff_diff_¡ršg
(
f
.
Ï¡_£q_jiff›s
, 
jiff
)

1193 + "‡dv”ti£_ok=" + 
	`jiff_diff_¡ršg
(
f
.
adv”ti£_ok_jiff›s
, 
jiff
);

1194 #ià
ENABLE_SEEN


1195 
s
 +ğ"†a¡_£’=" + 
	`jiff_diff_¡ršg
(
f
.
Ï¡_£’_jiff›s
, 
jiff
);

1198 
s
 += "\n";

1201  
s
;

1202 
	}
}

1204 
SŒšg


1205 
	gDSDVRou‹TabË
::
	$´št_¹es
(
EËm’t
 *
e
, *)

1207 
DSDVRou‹TabË
 *
n
 = (DSDVRou‹TabË *è
e
;

1209 
SŒšg
 
s
;

1210 
RTI‹r
 
i
 = 
n
->
_¹es
.
	`begš
(); i.
	`live
(); i++) {

1211 #ià
USE_OLD_SEQ


1212 
jiff
 = 
	`dsdv_jiff›s
();

1213 
RTEÁry
 
f
 = 
i
.
	`v®ue
();

1214 ià(
n
->
	`u£_Şd_rou‹
(
f
.
de¡_
, 
jiff
))

1215 
f
 = 
n
->
_Şd_¹es
[f.
de¡_
];

1217 cÚ¡ 
RTEÁry
 &
f
 = 
i
.
	`v®ue
();

1219 
s
 +ğ
f
.
de¡_
.
	`uÅ¬£
()

1220 + "‚ext=" + 
f
.
Ãxt_hİ_
.
	`uÅ¬£
()

1221 + " hİs=" + 
	`SŒšg
((è
f
.
	`num_hİs
())

1222 + " gw=" + (
f
.
is_g©eway
 ? "y" : "n")

1223 + " m‘ric=" + 
	`SŒšg
(
f
.
m‘ric
.
	`v®
())

1224 + " seq=" + 
	`SŒšg
(
f
.
	`£q_no
())

1228  
s
;

1229 
	}
}

1231 
SŒšg


1232 
	gDSDVRou‹TabË
::
	$´št_nbrs_v
(
EËm’t
 *
e
, *)

1234 
DSDVRou‹TabË
 *
n
 = (DSDVRou‹TabË *è
e
;

1236 
SŒšg
 
s
;

1237 
RTI‹r
 
i
 = 
n
->
_¹es
.
	`begš
(); i.
	`live
(); i++) {

1239 ià(!
i
.
	`v®ue
().
de¡_‘h
)

1241 
s
 +ğ
i
.
	`key
().
	`uÅ¬£
();

1242 
s
 +ğ"ƒth=" + 
i
.
	`v®ue
().
de¡_‘h
.
	`uÅ¬£
();

1243 
buf
[300];

1244 
	`¢´štf
(
buf
, 300, " metric_valid=%s metric=%d if=%d",

1245 
i
.
	`v®ue
().
m‘ric
.
	`good
() ? "yes" : "no",

1246 
i
.
	`v®ue
().
m‘ric
.
	`v®
(), (èi.v®ue().
Ãxt_hİ_š‹rçû
);

1247 
s
 +ğ
buf
;

1248 
s
 += "\n";

1251  
s
;

1252 
	}
}

1254 
SŒšg


1255 
	gDSDVRou‹TabË
::
	$´št_nbrs
(
EËm’t
 *
e
, *)

1257 
DSDVRou‹TabË
 *
n
 = (DSDVRou‹TabË *è
e
;

1259 
SŒšg
 
s
;

1260 
RTI‹r
 
i
 = 
n
->
_¹es
.
	`begš
(); i.
	`live
(); i++) {

1262 ià(!
i
.
	`v®ue
().
de¡_‘h
)

1264 
s
 +ğ
i
.
	`key
().
	`uÅ¬£
();

1265 
s
 +ğ"ƒth=" + 
i
.
	`v®ue
().
de¡_‘h
.
	`uÅ¬£
();

1266 
s
 +ğ" if=" + 
	`SŒšg
((è
i
.
	`v®ue
().
Ãxt_hİ_š‹rçû
);

1267 
s
 += "\n";

1270  
s
;

1271 
	}
}

1273 
SŒšg


1274 
	gDSDVRou‹TabË
::
	$´št_
(
EËm’t
 *
e
, *)

1276 
DSDVRou‹TabË
 *
n
 = (DSDVRou‹TabË *è
e
;

1277  
n
->
_
.
	`uÅ¬£
();

1278 
	}
}

1280 
SŒšg


1281 
	gDSDVRou‹TabË
::
	$´št_‘h
(
EËm’t
 *
e
, *)

1283 
DSDVRou‹TabË
 *
n
 = (DSDVRou‹TabË *è
e
;

1284  
n
->
_‘h
.
	`uÅ¬£
();

1285 
	}
}

1287 
SŒšg


1288 
	gDSDVRou‹TabË
::
	$´št_£qno
(
EËm’t
 *
e
, *)

1290 
DSDVRou‹TabË
 *
¹
 = (DSDVRou‹TabË *è
e
;

1291  
	`SŒšg
(
¹
->
_£q_no
) + "\n";

1292 
	}
}

1295 
	gDSDVRou‹TabË
::
	$wr™e_£qno
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–
,

1296 *, 
E¼ÜHªdËr
 *
”rh
)

1298 
DSDVRou‹TabË
 *
¹
 = (DSDVRou‹TabË *è
–
;

1299 
u
;

1300 ià(!
	`IÁArg
().
	`·r£
(
¬g
, 
u
))

1301  
”rh
->
	`”rÜ
("sequence‚umber must be unsigned");

1302 ià(
u
 & 1)

1303  
”rh
->
	`”rÜ
("sequence‚umber must beƒven");

1304 
¹
->
_£q_no
 = 
u
;

1306 
	}
}

1308 #ià
ENABLE_PAUSE


1309 
SŒšg


1310 
	gDSDVRou‹TabË
::
	$´št_·u£d
(
EËm’t
 *
e
, *)

1312 
DSDVRou‹TabË
 *
¹
 = (DSDVRou‹TabË *è
e
;

1313  (
¹
->
_·u£d
 ? "true\n" : "false\n");

1314 
	}
}

1317 
	gDSDVRou‹TabË
::
	$wr™e_·u£d
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–
,

1318 *, 
E¼ÜHªdËr
 *
”rh
)

1320 
DSDVRou‹TabË
 *
¹
 = (DSDVRou‹TabË *è
–
;

1321 
boŞ
 
was_·u£d
 = 
¹
->
_·u£d
;

1322 ià(!
	`BoŞArg
().
	`·r£
(
¬g
, 
¹
->
_·u£d
))

1323  
”rh
->
	`”rÜ
("type mismatch");

1325 
	`şick_ch©‹r
("DSDVRouteTable %s: %s",

1326 
¹
->
	`Çme
().
	`c_¡r
(),„t->
_·u£d
 ? "pausing…acket„outes (_paused =rue)" :

1329 ià(!
was_·u£d
 && 
¹
->
_·u£d
) {

1332 
¹
->
_¢­shÙ_jiff›s
 = 
	`dsdv_jiff›s
();

1333 
¹
->
_¢­shÙ_¹es
.
	`ş—r
();

1334 
RTI‹r
 
i
 = 
¹
->
_¹es
.
	`begš
(); i.
	`live
(); i++)

1335 
¹
->
_¢­shÙ_¹es
.
	`š£¹
(
i
.
	`key
(), i.
	`v®ue
());

1336 #ià
USE_OLD_SEQ


1337 
¹
->
_¢­shÙ_Şd_¹es
.
	`ş—r
();

1338 
RTI‹r
 
i
 = 
¹
->
_Şd_¹es
.
	`begš
(); i.
	`live
(); i++)

1339 
¹
->
_¢­shÙ_Şd_¹es
.
	`š£¹
(
i
.
	`key
(), i.
	`v®ue
());

1343 
	}
}

1346 
SŒšg


1347 
	gDSDVRou‹TabË
::
	$´št_u£_Şd_rou‹
(
EËm’t
 *
e
, *)

1349 
DSDVRou‹TabË
 *
¹
 = (DSDVRou‹TabË *è
e
;

1351 
	#pb
(
x
è((xè? "Œue" : "çl£")

	)

1353 
SŒšgAccum
 
§
;

1354 #ià
USE_OLD_SEQ


1355 
§
 << "u£ old„ou‹s: " << 
	`pb
(
¹
->
_u£_Şd_rou‹
)

1356 << (
¹
->
_u£_Şd_rou‹
 ? " (don't use until‡dvertised)" : " (use‚ew sequence‚umbers immediately)") << "\n";

1358 #ià
USE_GOOD_NEW_ROUTES


1359 
§
 << "u£ good‚ew„ou‹s: " << 
	`pb
(
¹
->
_u£_good_Ãw_rou‹
)

1360 << (
¹
->
_u£_good_Ãw_rou‹
 ? " (use good‚ew„outes immediately)" : " (waito use good‚ew„outes)") << "\n";

1362 #ià
ENABLE_SEEN


1363 
§
 << "u£ s“n: " << 
	`pb
(
¹
->
_u£_£’
)

1364 << (
¹
->
_u£_£’
 ? " (check for `seen' handshake)" : " (ignore‡symmetry)") << "\n";

1366  
§
.
	`ke_¡ršg
();

1367 #undeà
pb


1368 
	}
}

1371 
	gDSDVRou‹TabË
::
	$wr™e_u£_Şd_rou‹
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–
,

1372 *, 
E¼ÜHªdËr
 *
”rh
)

1374 
DSDVRou‹TabË
 *
¹
 = (DSDVRou‹TabË *è
–
;

1375 
u
;

1376 ià(!
	`IÁArg
().
	`·r£
(
¬g
, 
u
))

1377  
”rh
->
	`”rÜ
("`use_old_route' must be‡n unsigned integer");

1379 
boŞ
 
u£_good
 = 
çl£
;

1380 
boŞ
 
u£_Şd
 = 
çl£
;

1381 
boŞ
 
u£_£’
 = 
çl£
;

1383 ià(
u
 & 1)

1384 
u£_Şd
 = 
Œue
;

1385 ià(
u
 & 2)

1386 
u£_Şd
 = 
u£_good
 = 
Œue
;

1387 ià(
u
 & 4)

1388 
u£_£’
 = 
Œue
;

1389 #ià
USE_OLD_SEQ


1390 
¹
->
_u£_Şd_rou‹
 = 
u£_Şd
;

1391 
	`şick_ch©‹r
("DSDVRouteTable %s: setting _use_old_routeo %s",

1392 
¹
->
	`Çme
().
	`c_¡r
(),„t->
_u£_Şd_rou‹
 ? "true" : "false");

1394 #ià
USE_GOOD_NEW_ROUTES


1395 
¹
->
_u£_good_Ãw_rou‹
 = 
u£_good
;

1396 
	`şick_ch©‹r
("DSDVRouteTable %s: setting _use_good_new_routeo %s",

1397 
¹
->
	`Çme
().
	`c_¡r
(),„t->
_u£_good_Ãw_rou‹
 ? "true" : "false");

1399 #ià
ENABLE_SEEN


1400 
¹
->
_u£_£’
 = 
u£_£’
;

1401 
	`şick_ch©‹r
("DSDVRouteTable %s: setting _use_seeno %s",

1402 
¹
->
	`Çme
().
	`c_¡r
(),„t->
_u£_£’
 ? "true" : "false");

1405 
	}
}

1407 
SŒšg


1408 
	gDSDVRou‹TabË
::
	$´št_dump
(
EËm’t
 *
e
, *)

1410 
DSDVRou‹TabË
 *
¹
 = (DSDVRou‹TabË *è
e
;

1411 
SŒšgAccum
 
§
;

1412 
RTI‹r
 
i
 = 
¹
->
_¹es
.
	`begš
(); i.
	`live
(); i++) {

1413 
§
 << 
i
.
	`v®ue
().
	`dump
() << "\n";

1416  
§
.
	`ke_¡ršg
();

1417 
	}
}

1420 
	gDSDVRou‹TabË
::
	$add_hªdËrs
()

1422 
	`add_»ad_hªdËr
("nbrs_v", 
´št_nbrs_v
, 0);

1423 
	`add_»ad_hªdËr
("nbrs", 
´št_nbrs
, 0);

1424 
	`add_»ad_hªdËr
("¹es_v", 
´št_¹es_v
, 0);

1425 
	`add_»ad_hªdËr
("¹es", 
´št_¹es
, 0);

1426 
	`add_»ad_hªdËr
("", 
´št_
, 0);

1427 
	`add_»ad_hªdËr
("‘h", 
´št_‘h
, 0);

1428 
	`add_»ad_hªdËr
("£qno", 
´št_£qno
, 0);

1429 
	`add_wr™e_hªdËr
("£qno", 
wr™e_£qno
, 0);

1430 #ià
ENABLE_PAUSE


1431 
	`add_»ad_hªdËr
("·u£d", 
´št_·u£d
, 0, 
HªdËr
::
CHECKBOX
);

1432 
	`add_wr™e_hªdËr
("·u£d", 
wr™e_·u£d
, 0);

1434 
	`add_»ad_hªdËr
("u£_Şd_rou‹", 
´št_u£_Şd_rou‹
, 0);

1435 
	`add_wr™e_hªdËr
("u£_Şd_rou‹", 
wr™e_u£_Şd_rou‹
, 0);

1436 
	`add_»ad_hªdËr
("dump", 
´št_dump
, 0);

1437 
	}
}

1440 
	gDSDVRou‹TabË
::
	$h–lo_hook
()

1442 
m£cs_to_Ãxt_ad
 = 
_³riod
;

1444 
jiff
 = 
	`dsdv_jiff›s
();

1445 
	`dsdv_as£¹
(
jiff
 >ğ
_Ï¡_³riodic_upd©e
);

1446 
m£c_sšû_Ï¡
 = 
	`jiff_to_m£c
(
jiff
 - 
_Ï¡_³riodic_upd©e
);

1447 ià(
m£c_sšû_Ï¡
 < 2 * 
_³riod
 / 3) {

1452 
jiff_³riod
 = 
	`m£c_to_jiff
(
_³riod
);

1453 
m£cs_to_Ãxt_ad
 = 
	`jiff_to_m£c
(
_Ï¡_³riodic_upd©e
 + 
jiff_³riod
 - 
jiff
);

1456 
	`£nd_fuÎ_upd©e
();

1457 
_Ï¡_³riodic_upd©e
 = 
jiff
;

1458 
_Ï¡_Œigg”ed_upd©e
 = 
jiff
;

1462 
ušt32_t
 
r2
 = 
	`şick_¿ndom
();

1463 
ušt32_t
 
r
 = (
r2
 >> 1);

1464 
j™‹r
 = (è(
r
 % (
_j™‹r
 + 1));

1465 ià(
r2
 & 1) {

1466 ià(
j™‹r
 <ğ
m£cs_to_Ãxt_ad
)

1467 
m£cs_to_Ãxt_ad
 -ğ
j™‹r
;

1470 
m£cs_to_Ãxt_ad
 +ğ
j™‹r
;

1472 
_h–lo_tim”
.
	`scheduË_aá”_m£c
(
m£cs_to_Ãxt_ad
);

1473 
	}
}

1477 
	gDSDVRou‹TabË
::
bud_ªd_tx_ad
(
VeùÜ
<
RTEÁry
> &
¹es_to_£nd
)

1486 
num_¹es
 = 
¹es_to_£nd
.
size
();

1487 
dsdv_as£¹
(
num_¹es
 <ğ
max_¹es_³r_ad
());

1489 
	ghdr_sz
 = (
şick_‘h”
è+ (
grid_hdr
è+ (
grid_h–lo
);

1490 
	gpsz
 = 
hdr_sz
 + (
grid_nbr_’Œy
è* 
num_¹es
;

1491 
dsdv_as£¹
(
psz
 <ğ
_mtu
);

1494 
Wr™abËPack‘
 *
	gp
 = 
Pack‘
::
make
(
psz
 + 2);

1495 ià(
	gp
 == 0) {

1496 
şick_ch©‹r
("DSDVRou‹TabË %s: cªnÙ mak·ck‘!", 
Çme
().
c_¡r
());

1497 
dsdv_as£¹
(0);

1499 
ASSERT_4ALIGNED
(
p
->
d©a
());

1500 
	gp
->
puÎ
(2);

1501 
mem£t
(
p
->
d©a
(), 0,…->
Ëngth
());

1504 
	gp
->
£t_time¡amp_ªno
(
Time¡amp
::
now
());

1507 
şick_‘h”
 *
	geh
 = (şick_‘h” *è
p
->
d©a
();

1508 
mem£t
(
eh
->
‘h”_dho¡
, 0xff, 6);

1509 
	geh
->
	g‘h”_ty³
 = 
htÚs
(
ETHERTYPE_GRID
);

1510 
memıy
(
eh
->
‘h”_sho¡
, 
_‘h
.
d©a
(), 6);

1513 
grid_hdr
 *
	ggh
 = (grid_hd¸*è(
eh
 + 1);

1514 
ASSERT_4ALIGNED
(
gh
);

1515 
	ggh
->
	ghdr_Ën
 = (
grid_hdr
);

1516 
	ggh
->
	gtÙ®_Ën
 = 
htÚs
(
psz
 - (
şick_‘h”
));

1517 
	ggh
->
	gty³
 = 
grid_hdr
::
GRID_LR_HELLO
;

1518 
	ggh
->
	g
 = 
gh
->
tx_
 = 
_
;

1519 
grid_h–lo
 *
	ghlo
 = (grid_h–lØ*è(
gh
 + 1);

1520 
dsdv_as£¹
(
num_¹es
 <= 255);

1521 
	ghlo
->
	gnum_nbrs
 = (è
num_¹es
;

1522 
	ghlo
->
	gnbr_’Œy_sz
 = (
grid_nbr_’Œy
);

1523 
	ghlo
->
	g£q_no
 = 
htÚl
(
_£q_no
);

1525 
	ghlo
->
	gis_g©eway
 = 
_gw_šfo
 ? _gw_šfo->
is_g©eway
(è: 
çl£
;

1527 ià(
	g_log
)

1528 
	g_log
->
log_£Á_adv”ti£m’t
(
_£q_no
, 
p
->
time¡amp_ªno
());

1530 
	g_bÿ¡_couÁ
++;

1531 
	ggrid_hdr
::
£t_·d_by‹s
(*
gh
, 
htÚl
(
_bÿ¡_couÁ
));

1533 
	ghlo
->
	g‰l
 = 
htÚl
(
grid_h–lo
::
MAX_TTL_DEFAULT
);

1535 
grid_nbr_’Œy
 *
	gcu¼
 = (grid_nbr_’Œy *è(
hlo
 + 1);

1537 
	gi
 = 0; i < 
	gnum_¹es
; i++, 
	gcu¼
++)

1538 
	g¹es_to_£nd
[
i
].
fl_š
(
cu¼
);

1540 
ouut
(0).
push
(
p
);

1545 
	gDSDVRou‹TabË
::
RTEÁry
::
	$fl_š
(
grid_nbr_’Œy
 *
nb
) const

1547 
	`check
();

1548 
nb
->

 = 
de¡_
;

1549 
nb
->
Ãxt_hİ_
 =‚ext_hop_ip;

1550 
nb
->
num_hİs
 = 
	`num_hİs
();

1551 
nb
->
loc
 = 
de¡_loc
;

1552 
nb
->
loc_”r
 = 
	`htÚs
(loc_err);

1553 
nb
->
loc_good
 =†oc_good;

1554 
nb
->
£q_no
 = 
	`htÚl
(
	`£q_no
());

1555 
nb
->
m‘ric
 = 
	`htÚl
(m‘ric.
	`v®
());

1556 
nb
->
m‘ric_v®id
 = 
m‘ric
.
	`good
();

1557 
nb
->
is_g©eway
 = is_gateway;

1559 
jiff
 = 
	`dsdv_jiff›s
();

1560 
‰l_deüem’t
 = 
	`jiff_to_m£c
(
	`good
(è? 
jiff
 - 
Ï¡_upd©ed_jiff›s
 : jifà- 
Ï¡_expœed_jiff›s
);

1561 
nb
->
‰l
 = 
	`htÚl
(
	`deü_‰l
Ñ, 
	`GRID_MAX
(
‰l_deüem’t
, (è
grid_h–lo
::
MIN_TTL_DECREMENT
)));

1564 #iâdeà
SMALL_GRID_HEADERS


1565 
nb
->
lšk_qu®
 = 0;

1566 
nb
->
lšk_sig
 = 0;

1567 
nb
->
m—su»m’t_time
.
tv_£c
 =‚b->m—su»m’t_time.
tv_u£c
 = 0;

1569 
	}
}

1572 
	gDSDVRou‹TabË
::
	$log_dump_hook
(
boŞ
 
»scheduË
)

1574 ià(
_log
) {

1575 
VeùÜ
<
Rou‹EÁry
> 
vec
;

1576 
	`g‘_®l_’Œ›s
(
vec
);

1577 
_log
->
	`log_rou‹_dump
(
vec
, 
Time¡amp
::
	`now
());

1579 ià(
»scheduË
)

1580 
_log_dump_tim”
.
	`scheduË_aá”_m£c
(
_log_dump_³riod
);

1581 
	}
}

1583 
SŒšg


1584 
	gDSDVRou‹TabË
::
RTEÁry
::
	$dump
() const

1586 
	`check
();

1588 
jiff
 = 
	`dsdv_jiff›s
();

1590 
SŒšgAccum
 
§
;

1591 
§
 << " cu¼ jiff›s: " << 
jiff
 << "\n"

1592 << " de¡_: " << 
de¡_
.
	`uÅ¬£
() << "\n"

1593 << " de¡_‘h: " << 
de¡_‘h
.
	`uÅ¬£
() << "\n"

1594 << "‚ext_hİ_: " << 
Ãxt_hİ_
.
	`uÅ¬£
() << "\n"

1595 << "‚ext_hİ_‘h: " << 
Ãxt_hİ_‘h
.
	`uÅ¬£
() << "\n"

1596 << "Ãxt_hİ_içû: " << 
Ãxt_hİ_š‹rçû
 << "\n"

1597 << " seq_no: " << 
	`£q_no
() << "\n"

1598 << "‚um_hİs: " << (è
	`num_hİs
() << "\n"

1599 << "†a¡_upd©ed: " << 
	`jiff_diff_¡ršg
(
Ï¡_upd©ed_jiff›s
, 
jiff
) << "\n"

1600 << "†a¡_expœed: " << 
	`jiff_diff_¡ršg
(
Ï¡_expœed_jiff›s
, 
jiff
) << "\n"

1601 << "†a¡_£q: " << 
	`jiff_diff_¡ršg
(
Ï¡_£q_jiff›s
, 
jiff
) << "\n"

1602 << "‡dv”ti£_ok: " << 
	`jiff_diff_¡ršg
(
adv”ti£_ok_jiff›s
, 
jiff
) << "\n"

1603 << " m‘ric: " << 
m‘ric
.
	`v®
() << "\n"

1604 << "Ãed_m‘ric_ad: " << 
Ãed_m‘ric_ad
 << "\n"

1605 << "‚“d_£q_ad: " << 
Ãed_£q_ad
 << "\n"

1606 << " w¡: " << (è
w¡
 << "\n";

1607  
§
.
	`ke_¡ršg
();

1608 
	}
}

1611 
	gDSDVRou‹TabË
::
	$check_šv¬ŸÁs
(cÚ¡ 
IPAdd»ss
 *
ignÜe
) const

1613 
RTI‹r
 
i
 = 
_¹es
.
	`begš
(); i.
	`live
(); i++) {

1614 cÚ¡ 
RTEÁry
 &
r
 = 
i
.
	`v®ue
();

1616 
r
.
	`check
();

1618 
	`dsdv_as£¹
(!
_ignÜe_šv®id_rou‹s
 || 
r
.
m‘ric
.
	`good
());

1620 ià(
ignÜe
 && *ignÜ=ğ
i
.
	`key
())

1624 
Tim”
 **
t
 = 
_expœe_tim”s
.
	`fšdp
(
r
.
de¡_
);

1625 
HookPaœ
 **
hp
 = 
_expœe_hooks
.
	`fšdp
(
r
.
de¡_
);

1627 ià(
r
.
	`good
()) {

1628 
	`dsdv_as£¹
(
t
);

1629 
	`dsdv_as£¹
(*
t
);

1630 
	`dsdv_as£¹
((*
t
)->
	`scheduËd
());

1631 
	`dsdv_as£¹
(
hp
);

1632 
	`dsdv_as£¹
(*
hp
);

1633 
	`dsdv_as£¹
((*
hp
)->
obj
 =ğ
this
);

1634 
	`dsdv_as£¹
((*
hp
)->

 =ğ(è
r
.
de¡_
);

1637 
	`dsdv_as£¹
(!
t
);

1638 
	`dsdv_as£¹
(!
hp
);

1642 
t
 = 
_Œigg”_tim”s
.
	`fšdp
(
r
.
de¡_
);

1643 
hp
 = 
_Œigg”_hooks
.
	`fšdp
(
r
.
de¡_
);

1644 ià(
t
) {

1645 
	`dsdv_as£¹
(*
t
);

1646 
	`dsdv_as£¹
((*
t
)->
	`scheduËd
());

1647 
	`dsdv_as£¹
(
hp
);

1648 
	`dsdv_as£¹
(*
hp
);

1649 
	`dsdv_as£¹
((*
hp
)->
obj
 =ğ
this
);

1650 
	`dsdv_as£¹
((*
hp
)->

 =ğ(è
r
.
de¡_
);

1654 
	`dsdv_as£¹
(!
hp
);

1657 
	}
}

1660 
	gDSDVRou‹TabË
::
	$dsdv_as£¹_
(cÚ¡ *
fe
, 
lše
, cÚ¡ *
ex´
) const

1662 
	`şick_ch©‹r
("DSDVRouteTable %s‡ssertion \"%s\" failed: file %s,†ine %d",

1663 
	`Çme
().
	`c_¡r
(), 
ex´
, 
fe
, 
lše
);

1664 
	`şick_ch©‹r
("Routingable state:");

1665 
RTI‹r
 
i
 = 
_¹es
.
	`begš
(); i.
	`live
(); i++) {

1666 
	`şick_ch©‹r
("%s\n", 
i
.
	`v®ue
().
	`dump
().
	`c_¡r
());

1668 #ifdeà
CLICK_USERLEVEL


1669 
	`abÜt
();

1671 
	`şick_ch©‹r
("Continuingƒxecution‡nyway, hold ono your hats!\n");

1673 
	}
}

1675 
	$ELEMENT_PROVIDES
(
GridG’”icRou‹TabË
)

1676 
	$EXPORT_ELEMENT
(
DSDVRou‹TabË
)

1677 
CLICK_ENDDECLS


	@grid/dsdvroutetable.hh

1 #iâdeà
CLICK_DSDVROUTETABLE_HH


2 
	#CLICK_DSDVROUTETABLE_HH


	)

3 
	~<şick/bighashm­.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/add»ss.hh
>

6 
	~<şickÃt/‘h”.h
>

7 
	~<–em’ts/grid/grid.hh
>

8 
	~<–em’ts/grid/gridg’”iüt.hh
>

9 
	~<şick/tim”.hh
>

10 
	~<–em’ts/grid/gridg’”işogg”.hh
>

11 
	~<şick/deque.hh
>

12 
	~<–em’ts/grid/gridg’”icm‘ric.hh
>

13 
	gCLICK_DECLS


168 
	#ENABLE_PAUSE
 1

	)

172 
	#USE_OLD_SEQ
 1

	)

177 
	#USE_GOOD_NEW_ROUTES
 1

	)

182 
	#SEQ_METRIC
 1

	)

183 
	#MAX_BCAST_HISTORY
 3

	)

184 
	#OLD_BCASTS_NEEDED
 2

	)

188 
	#ENABLE_SEEN
 1

	)

190 
şass
 
	gGridG©ewayInfo
;

193 şas 
	cDSDVRou‹TabË
 : 
public
 
GridG’”icRou‹TabË
 {

195 
public
:

197 
boŞ
 
cu¼’t_g©eway
(
Rou‹EÁry
 &
’Œy
);

198 
boŞ
 
g‘_Úe_’Œy
(cÚ¡ 
IPAdd»ss
 &
de¡_
, 
Rou‹EÁry
 &
’Œy
);

199 
g‘_®l_’Œ›s
(
VeùÜ
<
Rou‹EÁry
> &
vec
);

200 
g‘_numb”_dœeù_ÃigbÜs
();

202 
	$DSDVRou‹TabË
(è
CLICK_COLD
;

203 ~
	$DSDVRou‹TabË
(è
CLICK_COLD
;

205 cÚ¡ *
	$şass_Çme
() const {  "DSDVRouteTable"; }

206 *
	`ÿ¡
(const *);

207 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

208 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "h/h"; 
	}
}

209 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

211 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

212 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

214 
vœtu®
 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
çl£
; 
	}
}

216 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

218 
	$add_hªdËrs
(è
CLICK_COLD
;

220 
´iv©e
:

222 #ià
SEQ_METRIC


223 
boŞ
 
_u£_£q_m‘ric
;

224 
HashM­
<
IPAdd»ss
, 
Deque
<> > 
_£q_hi¡Üy
;

227 
GridG’”icM‘ric
::
	tm‘ric_t
 metric_t;

232 şas 
	cRTEÁry
 : 
public
 
Rou‹EÁry
 {

233 
´iv©e
:

234 
boŞ
 
_š™
;

236 
public
:

237 
şass
 
Eth”Add»ss
 
de¡_‘h
;

239 
boŞ
 
is_g©eway
;

241 
‰l
;

242 
Ï¡_upd©ed_jiff›s
;

246 
m‘ric_t
 
m‘ric
;

249 
w¡
;

250 
m‘ric_t
 
Ï¡_adv_m‘ric
;

251 
Ï¡_£q_jiff›s
;

252 
adv”ti£_ok_jiff›s
;

253 
boŞ
 
Ãed_£q_ad
;

254 
boŞ
 
Ãed_m‘ric_ad
;

255 
Ï¡_expœed_jiff›s
;

257 #ià
ENABLE_SEEN


258 
Ï¡_£’_jiff›s
;

261 
boŞ
 
	`brok’
(ècÚ¡ { 
	`check
();  
	`num_hİs
() == 0; }

262 
boŞ
 
	`good
(ècÚ¡ { 
	`check
();  
	`num_hİs
() != 0; }

264 
SŒšg
 
	`dump
() const;

265 
	`check
() const {

266 
	`as£¹
(
_š™
);

267 
	`as£¹
((
	`num_hİs
(è> 0è!ğ(
	`£q_no
() & 1));

268 
	`as£¹
((
	`num_hİs
(è!ğ1è|| (
de¡_
 =ğ
Ãxt_hİ_
 && 
de¡_‘h
 =ğ
Ãxt_hİ_‘h
));

270 
	`as£¹
(
Ï¡_£q_jiff›s
 ? 
Ï¡_upd©ed_jiff›s
 >ğÏ¡_£q_jiff› : 
Œue
);

273 
	`šv®id©e
(
jiff
) {

274 
	`check
();

275 
	`as£¹
(
	`num_hİs
() > 0);

276 
_num_hİs
 = 0;

277 
_£q_no
++;

278 
Ï¡_expœed_jiff›s
 = 
jiff
;

279 
	`check
();

282 
	`RTEÁry
() :

283 
	`_š™
(
çl£
), 
	`is_g©eway
(çl£), 
	`‰l
(0), 
	`Ï¡_upd©ed_jiff›s
(0), 
	`w¡
(0),

284 
	`Ï¡_£q_jiff›s
(0), 
	`adv”ti£_ok_jiff›s
(0), 
	`Ãed_£q_ad
(
çl£
),

285 
	`Ãed_m‘ric_ad
(
çl£
), 
	`Ï¡_expœed_jiff›s
(0)

289 
	`RTEÁry
(
IPAdd»ss
 

, 
Eth”Add»ss
 
‘h
, 
grid_hdr
 *
gh
, 
grid_h–lo
 *
hlo
,

290 
š‹rçû
, 
jiff
) :

291 
	`Rou‹EÁry
(

, 
gh
->
loc_good
, gh->
loc_”r
, gh->
loc
, 
‘h
, ip, 
š‹rçû
, 
hlo
->
£q_no
, 1),

292 
	`_š™
(
Œue
), 
	`de¡_‘h
(
‘h
), 
	`is_g©eway
(
hlo
->
is_g©eway
), 
	`‰l
(hlo->
‰l
), 
	`Ï¡_upd©ed_jiff›s
(
jiff
),

293 
	`w¡
(0), 
	`Ï¡_£q_jiff›s
(
jiff
), 
	`adv”ti£_ok_jiff›s
(0), 
	`Ãed_£q_ad
(
çl£
),

294 
	`Ãed_m‘ric_ad
(
çl£
), 
	`Ï¡_expœed_jiff›s
(0)

296 
loc_”r
 = 
	`Áohs
(loc_err);

297 
_£q_no
 = 
	`Áohl
(_seq_no);

298 
‰l
 = 
	`Áohl
(ttl);

299 
	`check
();

303 
	`RTEÁry
(
IPAdd»ss
 

, 
Eth”Add»ss
 
‘h
, 
grid_nbr_’Œy
 *
nbr
,

304 
š‹rçû
, 
jiff
) :

305 
	`Rou‹EÁry
(
nbr
->

,‚br->
loc_good
,‚br->
loc_”r
,‚br->
loc
,

306 
‘h
, 

, 
š‹rçû
,

307 
nbr
->
£q_no
,‚br->
num_hİs
 > 0 ?‚br->num_hops + 1 : 0),

308 
	`_š™
(
Œue
), 
	`is_g©eway
(
nbr
->
is_g©eway
), 
	`‰l
Òbr->
‰l
), 
	`Ï¡_upd©ed_jiff›s
(
jiff
),

309 
	`w¡
(0), 
	`Ï¡_£q_jiff›s
(0),

310 
	`adv”ti£_ok_jiff›s
(0), 
	`Ãed_£q_ad
(
çl£
), 
	`Ãed_m‘ric_ad
(false),

311 
	`Ï¡_expœed_jiff›s
(
nbr
->
num_hİs
 > 0 ? 0 : 
jiff
)

313 
loc_”r
 = 
	`Áohs
(loc_err);

314 
_£q_no
 = 
	`Áohl
(_seq_no);

315 
‰l
 = 
	`Áohl
(ttl);

316 
m‘ric
 = 
	`m‘ric_t
(
	`htÚl
(
nbr
->m‘ric),‚br->
m‘ric_v®id
);

317 
	`check
();

321 
	`fl_š
(
grid_nbr_’Œy
 *
nb
) const;

323 
	}
};

325 
ä›nd
 
şass
 
	gRTEÁry
;

327 
	gHashM­
<
	tIPAdd»ss
, 
	tRTEÁry
> 
	tRTabË
;

328 
	gRTabË
::
	tcÚ¡_™”©Ü
 
	tRTI‹r
;

344 
RTabË
 
	g_¹es
;

346 #ià
USE_OLD_SEQ


347 
RTabË
 
	g_Şd_¹es
;

348 
boŞ
 
u£_Şd_rou‹
(cÚ¡ 
IPAdd»ss
 &
d¡
, 
jiff
);

352 
boŞ
 
hªdË_upd©e
(
RTEÁry
, cÚ¡ boŞ 
was_£nd”
, cÚ¡ 
jiff
);

354 
š£¹_rou‹
(cÚ¡ 
RTEÁry
 &, cÚ¡ 
GridG’”icLogg”
::
»asÚ_t
 
why
);

355 
scheduË_Œigg”ed_upd©e
(cÚ¡ 
IPAdd»ss
 &

, 
wh’
);

356 
boŞ
 
lookup_rou‹
(cÚ¡ 
IPAdd»ss
 &
de¡_
, 
RTEÁry
 &
’Œy
);

359 
	gHashM­
<
	tIPAdd»ss
, 
	tTim”
 *> 
	tTM­
;

360 
	gTM­
::
	t™”©Ü
 
	tTMI‹r
;

362 
	sHookPaœ
 {

363 
DSDVRou‹TabË
 *
	gobj
;

364 
	g
;

365 
HookPaœ
(
DSDVRou‹TabË
 *
o
, 
_
è: 
obj
(o), 

(_ip) { }

366 
	g´iv©e
:

367 
HookPaœ
() { }

370 
	gHashM­
<
	tIPAdd»ss
, 
	tHookPaœ
 *> 
	tHM­
;

371 
	gHM­
::
	t™”©Ü
 
	tHMI‹r
;

377 
TM­
 
	g_expœe_tim”s
;

378 
HM­
 
	g_expœe_hooks
;

392 
TM­
 
	g_Œigg”_tim”s
;

393 
HM­
 
	g_Œigg”_hooks
;

396 
	$check_šv¬ŸÁs
(cÚ¡ 
IPAdd»ss
 *
ignÜe
 = 0) const;

399 
_timeout
;

402 
_³riod
;

403 
_j™‹r
;

404 
_mš_Œigg”ed_upd©e_³riod
;

406 
GridG©ewayInfo
 *
_gw_šfo
;

407 
GridG’”icM‘ric
 *
_m‘ric
;

410 
GridG’”icLogg”
 *
_log
;

411 cÚ¡ 
_log_dump_³riod
 = 5 * 1000;

414 
IPAdd»ss
 
_
;

415 
Eth”Add»ss
 
_‘h
;

417 
_£q_no
;

418 
_mtu
;

419 
_bÿ¡_couÁ
;

422 
_max_hİs
;

425 
_®pha
;

426 
_w¡0
;

429 
_Ï¡_³riodic_upd©e
;

430 
_Ï¡_Œigg”ed_upd©e
;

433 
boŞ
 
_ignÜe_šv®id_rou‹s
;

435 
Tim”
 
_h–lo_tim”
;

436 
	$¡©ic_h–lo_hook
(
Tim”
 *, *
e
è{ ((
DSDVRou‹TabË
 *èe)->
	`h–lo_hook
(); 
	}
}

437 
h–lo_hook
();

439 
Tim”
 
	g_log_dump_tim”
;

440 
	$¡©ic_log_dump_hook
(
Tim”
 *, *
e
è{ ((
DSDVRou‹TabË
 *èe)->
	`log_dump_hook
(
Œue
); 
	}
}

441 
log_dump_hook
(
boŞ
 
»scheduË
);

444 
	$¡©ic_expœe_hook
(
Tim”
 *, *
v
)

445 { ((
HookPaœ
 *è
v
)->
obj
->
	`expœe_hook
(((HookPaœ *èv)->

); 
	}
}

447 
expœe_hook
(cÚ¡ 
IPAdd»ss
 &);

449 
	$¡©ic_Œigg”_hook
(
Tim”
 *, *
v
)

450 { ((
HookPaœ
 *è
v
)->
obj
->
	`Œigg”_hook
(((HookPaœ *èv)->

); 
	}
}

452 
Œigg”_hook
(cÚ¡ 
IPAdd»ss
 &);

454 
£nd_fuÎ_upd©e
();

455 
£nd_Œigg”ed_upd©e
(cÚ¡ 
IPAdd»ss
 &);

458 
bud_ªd_tx_ad
(
VeùÜ
<
RTEÁry
> &);

459 
	$max_¹es_³r_ad
() const {

460 
hdr_sz
 = (
şick_‘h”
è+ (
grid_hdr
è+ (
grid_h–lo
);

461  ((
_mtu
 - 
hdr_sz
è/ (
grid_nbr_’Œy
));

462 
	}
}

464 
	gpublic
:

465 
	$deü_‰l
(
‰l
, 
deü
)

466 {  (
‰l
 > 
deü
 ? - deü : 0); 
	}
}

468 
	$jiff_to_m£c
(
j
)

469 {  (
j
 * 1000è/ 
CLICK_HZ
; 
	}
}

471 
	$m£c_to_jiff
(
m
)

472 {  (
CLICK_HZ
 * 
m
è/ 1000; 
	}
}

474 
	g´iv©e
:

475 
Rou‹EÁry
 
	$make_g’”ic_¹e
(cÚ¡ 
RTEÁry
 &
¹e
è{ „‹; 
	}
}

478 
upd©e_m‘ric
(
RTEÁry
 &);

481 
š™_m‘ric
(
RTEÁry
 &);

484 
upd©e_w¡
(
RTEÁry
 *
Şd_r
, RTEÁry &
Ãw_r
, cÚ¡ 
jiff
);

490 
boŞ
 
m‘ric_´eã¿bË
(cÚ¡ 
RTEÁry
 &, const RTEntry &);

493 
boŞ
 
m‘rics_difãr
(cÚ¡ 
m‘ric_t
 &, const metric_t &);

497 
boŞ
 
m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &, const metric_t &);

499 
SŒšg
 
´št_¹es
(
EËm’t
 *
e
, *);

500 
SŒšg
 
´št_¹es_v
(
EËm’t
 *
e
, *);

501 
SŒšg
 
´št_nbrs
(
EËm’t
 *
e
, *);

502 
SŒšg
 
´št_nbrs_v
(
EËm’t
 *
e
, *);

503 
SŒšg
 
´št_
(
EËm’t
 *
e
, *);

504 
SŒšg
 
´št_‘h
(
EËm’t
 *
e
, *);

506 
jiff_diff_as_m£c
(
j1
, 
j2
, 
boŞ
 &
Ãg
);

507 
SŒšg
 
jiff_diff_¡ršg
(
j1
, 
j2
);

509 
SŒšg
 
´št_£qno
(
EËm’t
 *
e
, *);

510 
wr™e_£qno
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

512 
SŒšg
 
´št_·u£d
(
EËm’t
 *
e
, *);

513 
wr™e_·u£d
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

515 
SŒšg
 
´št_dump
(
EËm’t
 *
e
, *);

517 cÚ¡ 
m‘ric_t
 
	g_bad_m‘ric
;

519 #ià
ENABLE_PAUSE


520 
boŞ
 
	g_·u£d
;

521 
	g_¢­shÙ_jiff›s
;

522 
RTabË
 
	g_¢­shÙ_¹es
;

523 #ià
USE_OLD_SEQ


524 
RTabË
 
	g_¢­shÙ_Şd_¹es
;

528 #ià
USE_OLD_SEQ


529 
boŞ
 
	g_u£_Şd_rou‹
;

530 
SŒšg
 
´št_u£_Şd_rou‹
(
EËm’t
 *
e
, *);

531 
wr™e_u£_Şd_rou‹
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

532 #ià
USE_GOOD_NEW_ROUTES


533 
boŞ
 
	g_u£_good_Ãw_rou‹
;

537 #ià
ENABLE_SEEN


538 
boŞ
 
	g_u£_£’
;

539 cÚ¡ 
	g_m‘ric_£’
 = 999999;

543 
boŞ
 
	g_v”bo£
;

545 
	$dsdv_as£¹_
(const *, , const *) const;

547 
	}
};

549 
šlše
 

550 
	$dsdv_jiff›s
()

552 
Ï¡_şick_jiff›s
 = 0;

553 
j
 = 
	`şick_jiff›s
();

554 
	`as£¹
(
j
 >ğ
Ï¡_şick_jiff›s
);

555 
Ï¡_şick_jiff›s
 = 
j
;

556  
j
;

557 
	}
}

559 
	gCLICK_ENDDECLS


	@grid/dsr.hh

1 #iâdeà
CLICK_DSR_H


2 
	#CLICK_DSR_H


	)

6 
CLICK_DECLS


8 
	sşick_d¤
 {

9 
	md¤_Ãxt_h—d”
;

10 
	md¤_»£rved
;

11 
u_št16_t
 
	md¤_Ën
;

14 
	sşick_d¤_İtiÚ
 {

15 
	md¤_ty³
;

16 
	md¤_Ën
;

19 
	sDSRHİ
 {

20 
š_addr
 
	m_
;

21 
	m_m‘ric
;

23 
	#DSR_INVALID_HOP_METRIC
 0xFF

	)

24 
	#DSR_INVALID_ROUTE_METRIC
 9999

	)

26 
DSRHİ
(
IPAdd»ss
 
i
è: 
_
(i), 
_m‘ric
(
DSR_INVALID_HOP_METRIC
) {}

27 
DSRHİ
(
IPAdd»ss
 
i
, 
c
è: 
_
(i), 
_m‘ric
(c) {}

28 
IPAdd»ss
 

(ècÚ¡ {  IPAdd»ss(
_
); }

31 
	gVeùÜ
<
	tDSRHİ
> 
	tDSRRou‹
;

33 
	sşick_d¤_¼eq
 {

34 
	md¤_ty³
;

35 
	md¤_Ën
;

36 
u_št16_t
 
	md¤_id
;

38 
š_addr
 
	mrg‘
;

39 
DSRHİ
 
	maddr
[];

41 
num_addrs
() const {

42 ià((
	md¤_Ën
 - 6è% (
	mDSRHİ
è!ğ0è
şick_ch©‹r
("click_dsr_rreq::length() -- warning: odd†ength (%d %d)\n",

43 
d¤_Ën
, (
DSRHİ
));

44  ((
	md¤_Ën
 - 6)/(
	mDSRHİ
));

46 
Ëngth
(ècÚ¡ {  (
	md¤_Ën
 + 2); }

47 *
Ãxt_İtiÚ
(ècÚ¡ {  ((*)
	mthis
 + 
Ëngth
()); }

50 
	sşick_d¤_¼•
 {

51 
	md¤_ty³
;

52 
	md¤_Ën
;

53 
	md¤_æags
;

55 
	md¤_·d
;

58 
DSRHİ
 
	maddr
[];

60 
num_addrs
() const {

61 ià((
	md¤_Ën
 - 1è% (
	mDSRHİ
è!ğ0è
şick_ch©‹r
("click_dsr_rrep::length() -- warning: odd†ength\n");

62  ((
	md¤_Ën
 - 1)/(
	mDSRHİ
));

64 
Ëngth
(ècÚ¡ {  (
	md¤_Ën
 + 3); }

65 *
Ãxt_İtiÚ
(ècÚ¡ {  ((*)
	mthis
 + 
Ëngth
()); }

68 
	sşick_d¤_»¼
 {

69 
	md¤_ty³
;

70 
	md¤_Ën
;

71 
	md¤_”rÜ
;

74 
	#DSR_RERR_TYPE_NODE_UNREACHABLE
 1

	)

76 
	md¤_æags
;

78 
š_addr
 
	md¤_”r_¤c
;

79 
š_addr
 
	md¤_”r_d¡
;

82 
Ëngth
() const {

85  (
	md¤_Ën
 + 2);

87 *
Ãxt_İtiÚ
(ècÚ¡ {  ((*)
	mthis
 + 
Ëngth
()); }

95 
	sşick_d¤_sourû
 {

96 
	md¤_ty³
;

97 
	md¤_Ën
;

99 
	md¤_§lvage
;

100 
	md¤_£g¦eá
;

102 
DSRHİ
 
	maddr
[];

104 
num_addrs
() const {

105 ià((
	md¤_Ën
 - 2è% (
	mDSRHİ
è!ğ0è
şick_ch©‹r
("click_dsr_source::length() -- warning: odd†ength\n");

106  ((
	md¤_Ën
 - 2è/ (
	mDSRHİ
));

108 
Ëngth
(ècÚ¡ {  (
	md¤_Ën
 + 2); }

109 *
Ãxt_İtiÚ
(ècÚ¡ {  ((*)
	mthis
 + 
Ëngth
()); }

124 
	#DSR_TYPE_RREP
 1

	)

125 
	#DSR_TYPE_RREQ
 2

	)

126 
	#DSR_TYPE_RERR
 3

	)

127 
	#DSR_TYPE_SOURCE_ROUTE
 96

	)

132 
	#IP_PROTO_DSR
 200

	)

134 
	#DSR_SALVAGE_LIMIT
 4

	)

136 
	#DSR_LAST_HOP_IP_ANNO
(
p
è(Õ)->
	`ªno_u32
(
Pack‘
::
u£r_ªno_off£t
 + 4))

	)

137 
	#SET_DSR_LAST_HOP_IP_ANNO
(
p
, 
v
è(Õ)->
	`£t_ªno_u32
(
Pack‘
::
u£r_ªno_off£t
 + 4, (v)))

	)

139 
	#DSR_LAST_HOP_ETH_ANNO1
(
p
è(Õ)->
	`ªno_u16
(
Pack‘
::
u£r_ªno_off£t
 + 18))

	)

140 
	#SET_DSR_LAST_HOP_ETH_ANNO1
(
p
, 
v
è(Õ)->
	`£t_ªno_u16
(
Pack‘
::
u£r_ªno_off£t
 + 18, (v)))

	)

142 
	#DSR_LAST_HOP_ETH_ANNO2
(
p
è(Õ)->
	`ªno_u16
(
Pack‘
::
u£r_ªno_off£t
 + 22))

	)

143 
	#SET_DSR_LAST_HOP_ETH_ANNO2
(
p
, 
v
è(Õ)->
	`£t_ªno_u16
(
Pack‘
::
u£r_ªno_off£t
 + 22, (v)))

	)

145 
	#DSR_LAST_HOP_ETH_ANNO3
(
p
è(Õ)->
	`ªno_u16
(
Pack‘
::
u£r_ªno_off£t
 + 26))

	)

146 
	#SET_DSR_LAST_HOP_ETH_ANNO3
(
p
, 
v
è(Õ)->
	`£t_ªno_u16
(
Pack‘
::
u£r_ªno_off£t
 + 26, (v)))

	)

148 
	gCLICK_ENDDECLS


	@grid/dsrarptable.cc

20 
	~<şick/cÚfig.h
>

21 
	~<şick/·ckage.hh
>

22 
	~<şickÃt/‘h”.h
>

23 
	~<şick/glue.hh
>

24 
	~<şick/‘h”add»ss.hh
>

25 
	~<şick/add»ss.hh
>

26 
	~<şick/¬gs.hh
>

27 
	~<şick/b™veùÜ.hh
>

28 
	~<şick/”rÜ.hh
>

29 
	~<şickÃt/.h
>

30 
	~<şick/rou‹r.hh
>

31 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

33 
	~"d¤¬±abË.hh
"

34 
	~"d¤.hh
"

36 
	gCLICK_DECLS


37 
	#DEBUG_CHATTER
 ià(
_debug
è
şick_ch©‹r


	)

39 
	gDSRA½TabË
::
	$DSRA½TabË
()

40 : 
	$_debug
(
çl£
)

42 
	}
}

44 
DSRA½TabË
::~
	$DSRA½TabË
()

46 
	}
}

49 
DSRA½TabË
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

51 
	g‘ht
 = 0x0800;

52 ià(
Args
(
cÚf
, 
this
, 
”rh
)

53 .
»ad_mp
("IP", 
_me
)

54 .
»ad_mp
("ETH", 
_me_‘h”
)

55 .
»ad
("ETHERTYPE", 
‘ht
)

56 .
»ad
("DEBUG", 
_debug
)

57 .
com¶‘e
() < 0)

60 
	g_‘ht
 = 
‘ht
;

66 
	gDSRA½TabË
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

69 
	}
}

71 
Pack‘
 *

72 
	gDSRA½TabË
::
	$puÎ
(
pÜt
)

74 
	`as£¹
(
pÜt
 == 0 ||…ort == 1);

77  
	`lookup_¬p
(
	`šput
(
pÜt
).
	`puÎ
());

78 
	}
}

81 
	gDSRA½TabË
::
	$push
(
pÜt
, 
Pack‘
 *
p_š
)

83 
	`as£¹
(
pÜt
 <= 2);

85 ià(
pÜt
 == 0 ||…ort == 1) {

87 
Pack‘
* 
p_out
 = 
	`lookup_¬p
(
p_š
);

88 ià(
p_out
) {

89 
	`ouut
(
pÜt
).
	`push
(
p_out
);

98 cÚ¡ 
şick_
 *
h
 = (cÚ¡ click_*)(
p_š
->
	`d©a
(è+ (
şick_‘h”
));

100 ià(
h
->
_p
 !ğ
IP_PROTO_DSR
) {

101 
	`DEBUG_CHATTER
 ("DSRArpTable::push:‚on-DSR…acket…assinghrough DSRArpTable\n");

102 
	`ouut
(2).
	`push
(
p_š
);

106 cÚ¡ 
şick_‘h”
 *
‘h
 = (cÚ¡ click_‘h” *)
p_š
->
	`d©a
();

107 
Eth”Add»ss
 
mac
 = 
	`Eth”Add»ss
(
‘h
->
‘h”_sho¡
);

108 
IPAdd»ss
 

 = 
	`Ï¡_hİ_
(
p_š
);

110 
Eth”Add»ss
 
e
 = 
	`lookup_
(

);

111 ià(!
e
) {

112 
	`DEBUG_CHATTER
("DSRArpTable::push:‡dding ARPableƒntry for IP: %s; MAC: %s",

113 

.
	`uÅ¬£
().
	`c_¡r
(), 
mac
.unparse().c_str());

114 
	`add_’Œy
(

, 
mac
);

115 } ià(
e
 !ğ
mac
) {

116 
	`şick_ch©‹r
("DSRArpTable::push:ƒxistingƒntry for %s has different MAC! %s,‚ot %s",

117 

.
	`uÅ¬£
().
	`c_¡r
(), 
e
.uÅ¬£().c_¡r(), 
mac
.unparse().c_str());

118 
	`d–‘e_’Œy
(

);

119 
	`add_’Œy
(

, 
mac
);

122 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

123 
	`SET_DSR_LAST_HOP_IP_ANNO
(
p
, 

.
	`addr
());

125 cÚ¡ 
ušt16_t
 *
d
 = 
e
.
	`sd©a
();

126 
	`SET_DSR_LAST_HOP_ETH_ANNO1
(
p
, 
d
[0]);

127 
	`SET_DSR_LAST_HOP_ETH_ANNO2
(
p
, 
d
[1]);

128 
	`SET_DSR_LAST_HOP_ETH_ANNO3
(
p
, 
d
[2]);

130 
	`ouut
(2).
	`push
(
p
);

131 
	}
}

138 
IPAdd»ss


139 
	gDSRA½TabË
::
	$Ï¡_hİ_
(
Pack‘
 *
p
)

141 cÚ¡ 
şick_
 *

 = (cÚ¡ click_ *)(
p
->
	`d©a
(è+ (
şick_‘h”
));

143 
şick_d¤
 *
d¤
 = (şick_d¤ *)((*)

 + (
şick_
));

144 cÚ¡ 
d¤_Ën
 = 
	`Áohs
(
d¤
->dsr_len);

146 
şick_d¤_İtiÚ
 *
d¤_İtiÚ
 = (şick_d¤_İtiÚ *)((*)
d¤
 +

147 (
şick_d¤
));

152 ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_RREQ
) {

154 cÚ¡ 
şick_d¤_¼eq
 *
d¤_¼eq
 = (şick_d¤_¼eq *)
d¤_İtiÚ
;

155 cÚ¡ 
num_addr
 = 
d¤_¼eq
->
	`num_addrs
();

157 ià(
num_addr
 == 0) {

158 
IPAdd»ss
 
	`¤c_addr
(

->
_¤c
.
s_addr
);

159  (
¤c_addr
);

161 
IPAdd»ss
 
Ï¡_hİ
 = 
d¤_¼eq
->
addr
[
num_addr
-1].
	`
();

162 
	`DEBUG_CHATTER
 ("saw‡„oute„equest being forwarded by %s\n",

163 
Ï¡_hİ
.
	`uÅ¬£
().
	`c_¡r
());

164  (
Ï¡_hİ
);

167 } ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_RREP
) {

175 cÚ¡ 
şick_d¤_¼•
 *
d¤_¼•
 = (şick_d¤_¼• *)
d¤_İtiÚ
;

179 ià(
d¤_¼•
->
	`Ëngth
(è=ğ
d¤_Ën
) {

181 
IPAdd»ss
 
	`¤c_addr
(

->
_¤c
.
s_addr
);

182  (
¤c_addr
);

184 
d¤_İtiÚ
 = (
şick_d¤_İtiÚ
 *)(
d¤_¼•
->
	`Ãxt_İtiÚ
());

186 ià(
d¤_İtiÚ
->
d¤_ty³
 !ğ
DSR_TYPE_SOURCE_ROUTE
) {

187 
	`DEBUG_CHATTER
(" * DSRArpTable::last_hop: source„oute option did‚ot follow„oute„eply option (%x)\n",

188 
d¤_İtiÚ
->
d¤_ty³
);

190 
IPAdd»ss
 
z”os
;

191  
z”os
;

195 } ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_RERR
) {

204 cÚ¡ 
şick_d¤_»¼
 *
d¤_»¼
 = (şick_d¤_»¼ *)
d¤_İtiÚ
;

206 ià(
d¤_»¼
->
	`Ëngth
(è=ğ
d¤_Ën
) {

208 
IPAdd»ss
 
	`¤c_addr
(

->
_¤c
.
s_addr
);

209  (
¤c_addr
);

211 
d¤_İtiÚ
 = (
şick_d¤_İtiÚ
 *)(
d¤_»¼
->
	`Ãxt_İtiÚ
());

213 ià(
d¤_İtiÚ
->
d¤_ty³
 !ğ
DSR_TYPE_SOURCE_ROUTE
) {

214 
	`DEBUG_CHATTER
(" * DSRArpTable::last_hop: source„oute option did‚ot follow„outeƒrror option (%x)\n",

215 
d¤_İtiÚ
->
d¤_ty³
);

217 
IPAdd»ss
 
z”os
;

218  
z”os
;

223 ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_SOURCE_ROUTE
) {

227 
şick_d¤_sourû
 *
d¤_sourû
 = (şick_d¤_sourû *)(
d¤_İtiÚ
);

228 
	`as£¹
(
d¤_sourû
->
d¤_ty³
 =ğ
DSR_TYPE_SOURCE_ROUTE
);

230 
£gm’ts
 = 
d¤_sourû
->
d¤_£g¦eá
;

231 
sourû_hİs
 = 
d¤_sourû
->
	`num_addrs
();

233 
	`as£¹
(
£gm’ts
 <ğ
sourû_hİs
);

235 
šdex
 = 
sourû_hİs
 - 
£gm’ts
;

237 ià(
šdex
 == 0) {

238 
IPAdd»ss
 
	`¤c
(

->
_¤c
.
s_addr
);

239  
¤c
;

241  
d¤_sourû
->
addr
[
šdex
-1].
	`
();

245 
	`as£¹
(0);

246  
	`IPAdd»ss
();

247 
	}
}

250 
	gDSRA½TabË
::
	$add_’Œy
(
IPAdd»ss
 

, 
Eth”Add»ss
 
‘h
)

252 
Eth”Add»ss
 *
e
 =
__m­
.
	`fšdp
(

);

253 
	`as£¹
(!
e
);

254 
__m­
.
	`š£¹
(

, 
‘h
);

255 
	}
}

258 
	gDSRA½TabË
::
	$d–‘e_’Œy
(
IPAdd»ss
 

)

260 
Eth”Add»ss
 *
e
 =
__m­
.
	`fšdp
(

);

261 
	`as£¹
(
e
);

262 
__m­
.
	`»move
(

);

263 
	}
}

265 
Eth”Add»ss


266 
	gDSRA½TabË
::
	$lookup_
(
IPAdd»ss
 

)

268 
IPAdd»ss
 
	`bÿ¡_
("255.255.255.255");

270 ià(

 =ğ
bÿ¡_
) {

271 
Eth”Add»ss
 
	`bÿ¡_‘h
((*)("\xff\xff\xff\xff\xff\xff"));

272  
bÿ¡_‘h
;

275  (
__m­
.
	`fšd
(

));

276 
	}
}

279 
Pack‘
*

280 
	gDSRA½TabË
::
	$lookup_¬p
(
Pack‘
 *
p_š
)

282 ià(!
p_š
)

283  
NULL
;

285 
Wr™abËPack‘
 *
q
 = 
p_š
->
	`push
((
şick_‘h”
));

286 ià(!
q
) {

287 
	`şick_ch©‹r
("DSRArpTable::lookup_arp: could‚ot…ush space forƒthernet header\n");

288  
NULL
;

291 
şick_‘h”
 *
‘h”
 = (şick_‘h” *)(
q
->
	`d©a
());

293 
IPAdd»ss
 
	`d¡_addr
(
q
->
	`d¡__ªno
());

294 
Eth”Add»ss
 
d¡_‘h”
 = 
	`lookup_
(
d¡_addr
);

296 ià(! 
d¡_‘h”
) {

297 
	`şick_ch©‹r
 ("DSRArpTable::lookup_arp: missing ARPableƒntry! src: %s/%s dst: %s/%s\n",

298 
_me
.
	`uÅ¬£
().
	`c_¡r
(), 
_me_‘h”
.unparse().c_str(),

299 
d¡_addr
.
	`uÅ¬£
().
	`c_¡r
(), 
d¡_‘h”
.unparse().c_str());

300 
q
->
	`kl
();

301  
NULL
;

304 
	`memıy
(&
‘h”
->
‘h”_sho¡
, &
_me_‘h”
, 6);

305 
	`memıy
(&
‘h”
->
‘h”_dho¡
, 
d¡_‘h”
.
	`d©a
(), 6);

306 
‘h”
->
‘h”_ty³
 = 
	`htÚs
(
_‘ht
);

308  
q
;

309 
	}
}

311 
	$EXPORT_ELEMENT
(
DSRA½TabË
)

312 
CLICK_ENDDECLS


	@grid/dsrarptable.hh

1 #iâdeà
DSRARPTABLE_HH


2 
	#DSRARPTABLE_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~"d¤rou‹bË.hh
"

7 
	~<şick/bighashm­.hh
>

8 
CLICK_DECLS


74 şas 
	cDSRA½TabË
 : 
public
 
EËm’t


77 
public
:

79 
	$DSRA½TabË
(è
CLICK_COLD
;

80 ~
	$DSRA½TabË
(è
CLICK_COLD
;

82 cÚ¡ *
	$şass_Çme
() const {  "DSRArpTable"; }

83 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "3/3"; 
	}
}

84 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "¯h/¯h"; 
	}
}

85 cÚ¡ *
	$æow_code
(ècÚ¡ {  "#/#"; 
	}
}

87 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

88 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

90 
Pack‘
 *
	`puÎ
();

91 
	`push
(, 
Pack‘
 *);

93 
´iv©e
:

95 
_‘ht
;

97 
IPAdd»ss
 
_me
;

98 
Eth”Add»ss
 
_me_‘h”
;

100 
HashM­
<
	tIPAdd»ss
, 
	tEth”Add»ss
> 
	tIPM­
;

101 
IPM­
 
__m­
;

103 
IPAdd»ss
 
	`Ï¡_hİ_
(
Pack‘
 *);

105 
	`add_’Œy
(
IPAdd»ss
, 
Eth”Add»ss
);

106 
	`d–‘e_’Œy
(
IPAdd»ss
);

107 
Eth”Add»ss
 
	`lookup_
(
IPAdd»ss
);

108 
boŞ
 
_debug
;

109 
Pack‘
* 
	`lookup_¬p
(Packet *);

110 
	}
};

111 
	gCLICK_ENDDECLS


	@grid/dsrroutetable.cc

20 
	~<şick/cÚfig.h
>

21 
	~<şick/·ckage.hh
>

22 
	~<şickÃt/‘h”.h
>

23 
	~<şick/‘h”add»ss.hh
>

24 
	~<şick/add»ss.hh
>

25 
	~<şick/¬gs.hh
>

26 
	~<şick/b™veùÜ.hh
>

27 
	~<şick/”rÜ.hh
>

28 
	~<şick/glue.hh
>

29 
	~<şickÃt/.h
>

30 
	~<şick/rou‹r.hh
>

31 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

32 
	~"d¤rou‹bË.hh
"

33 
	~"d¤.hh
"

34 
	~"gridg’”icm‘ric.hh
"

36 
	gCLICK_DECLS


38 
	#DEBUG_CHATTER
(
¬g
, ...èdØ{ ià(
_debug
è
	`şick_ch©‹r
×rg, ## 
__VA_ARGS__
); } 0)

	)

41 
	gDSRRou‹TabË
::
	$DSRRou‹TabË
()

42 : 
	`_¼eq_expœe_tim”
(
¡©ic_¼eq_expœe_hook
, 
this
),

43 
	`_¼eq_issue_tim”
(
¡©ic_¼eq_issue_hook
, 
this
),

44 
	`_£ndbufãr_tim”
(
¡©ic_£ndbufãr_tim”_hook
, 
this
),

45 
	`_£ndbufãr_check_rou‹s
(
çl£
),

46 
	`_bÏckli¡_tim”
(
¡©ic_bÏckli¡_tim”_hook
, 
this
),

47 
	`_outq
(0), 
	`_m‘ric
(0), 
	`_u£_bÏckli¡
(
Œue
),

48 
	$_debug
(
çl£
)

50 
me
 = 
Ãw
 
IPAdd»ss
;

52 
_¼eq_id
 = 
Time¡amp
::
	`now
().
	`£c
() & 0xffff;

61 
	}
}

63 
	gDSRRou‹TabË
::~
	$DSRRou‹TabË
()

65 
	`æush_£ndbufãr
();

66 
	`unš™Ÿlize
();

68 
FWReqI‹r
 
i
 = 
_fÜw¬ded_¼eq_m­
.
	`begš
(); i.
	`live
(); i++) {

69 
FÜw¬dedReqV®
 &
äv
 = 
i
.
	`v®ue
();

70 ià(
äv
.
p
èäv.p->
	`kl
();

71 
äv
.
p
 = 
NULL
;

74 
d–‘e
 
me
;

75 
	}
}

78 
	gDSRRou‹TabË
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

81 ià(
Args
(
cÚf
, 
this
, 
”rh
)

82 .
»ad_mp
("IP", *
me
)

83 .
»ad_mp
("LINKTABLE", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_lšk_bË
))

84 .
»ad
("OUTQUEUE", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_outq
))

85 .
»ad
("METRIC", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_m‘ric
))

86 .
»ad
("USE_BLACKLIST", 
_u£_bÏckli¡
)

87 .
»ad
("DEBUG", 
_debug
)

88 .
com¶‘e
()<0)

91 ià(
	g_outq
 && _outq->
ÿ¡
("SimpleQueue") == 0)

92  
”rh
->
”rÜ
("OUTQUEUEƒlement is‚ot‡ SimpleQueue");

94 ià(
	g_m‘ric
 && _m‘ric->
ÿ¡
("GridGenericMetric") == 0)

95  
”rh
->
”rÜ
("METRICƒlement is‚ot‡ GridGenericMetric");

101 
	gDSRRou‹TabË
::
	$æush_£ndbufãr
()

103 
SBM­I‹r
 
i
=
_£ndbufãr_m­
.
	`begš
(); i.
	`live
(); i++) {

104 
S’dBufãr
 &
sb
 = 
i
.
	`v®ue
();

105 
j
 = 0; j < 
sb
.
	`size
(); j++) {

106 
sb
[
j
].
	`check
();

107 
sb
[
j
].
_p
->
	`kl
();

109 
sb
 = 
	`S’dBufãr
();

111 
	}
}

114 
	gDSRRou‹TabË
::
	$check
()

116 
	`as£¹
(
me
);

119 
	`as£¹
(
_lšk_bË
);

122 
BÏckli¡I‹r
 
i
 = 
_bÏckli¡
.
	`begš
(); i.
	`live
(); i++)

123 
i
.
	`v®ue
().
	`check
();

126 
SBM­I‹r
 
i
=
_£ndbufãr_m­
.
	`begš
(); i.
	`live
(); i++) {

127 
S’dBufãr
 &
sb
 = 
i
.
	`v®ue
();

128 
j
 = 0; j < 
sb
.
	`size
(); j++) {

129 
sb
[
j
].
	`check
();

134 
FWReqI‹r
 
i
 = 
_fÜw¬ded_¼eq_m­
.
	`begš
(); i.
	`live
(); i++)

135 
i
.
	`v®ue
().
	`check
();

138 
In™ReqI‹r
 
i
 = 
_š™Ÿ‹d_¼eq_m­
.
	`begš
(); i.
	`live
(); i++)

139 
i
.
	`v®ue
().
	`check
();

142 
	`as£¹
(
_¼eq_expœe_tim”
.
	`scheduËd
());

145 
	`as£¹
(
_¼eq_issue_tim”
.
	`scheduËd
());

148 
	`as£¹
(
_£ndbufãr_tim”
.
	`scheduËd
());

151 
	`as£¹
(
_bÏckli¡_tim”
.
	`scheduËd
());

152 
	}
}

155 
	gDSRRou‹TabË
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

158 
_¼eq_expœe_tim”
.
	`š™Ÿlize
(
this
);

159 
_¼eq_expœe_tim”
.
	`scheduË_aá”_m£c
(
DSR_RREQ_EXPIRE_TIMER_INTERVAL
);

162 
_£ndbufãr_tim”
.
	`š™Ÿlize
(
this
);

163 
_£ndbufãr_tim”
.
	`scheduË_aá”_m£c
(
DSR_SENDBUFFER_TIMER_INTERVAL
);

166 
_¼eq_issue_tim”
.
	`š™Ÿlize
(
this
);

167 
_¼eq_issue_tim”
.
	`scheduË_aá”_m£c
(
DSR_RREQ_ISSUE_TIMER_INTERVAL
);

169 
_bÏckli¡_tim”
.
	`š™Ÿlize
(
this
);

170 
_bÏckli¡_tim”
.
	`scheduË_aá”_m£c
(
DSR_BLACKLIST_TIMER_INTERVAL
);

173 
	}
}

176 
	gDSRRou‹TabË
::
	$unš™Ÿlize
()

178 
_¼eq_expœe_tim”
.
	`unscheduË
();

179 
_¼eq_issue_tim”
.
	`unscheduË
();

180 
_£ndbufãr_tim”
.
	`unscheduË
();

181 
_bÏckli¡_tim”
.
	`unscheduË
();

182 
	}
}

188 
	gDSRRou‹TabË
::
	$¡©ic_¼eq_expœe_hook
(
Tim”
 *, *
v
)

190 
DSRRou‹TabË
 *
r
 = (DSRRou‹TabË *)
v
;

191 
r
->
	`¼eq_expœe_hook
();

192 
	}
}

194 
	gDSRRou‹TabË
::
	$¼eq_expœe_hook
()

211 
Time¡amp
 
cu¼_time
 = Time¡amp::
	`now
();

215 
VeùÜ
<
FÜw¬dedReqKey
> 
»move_li¡
;

216 
FWReqI‹r
 
i
 = 
_fÜw¬ded_¼eq_m­
.
	`begš
(); i.
	`live
(); i++) {

218 
FÜw¬dedReqV®
 &
v®
 = 
i
.
	`v®ue
();

220 ià(
v®
.
p
 !ğ
NULL
) {

221 
DSRRou‹
 
»q_rou‹
 = 
	`exŒaù_»que¡_rou‹
(
v®
.
p
);

223 
IPAdd»ss
 
Ï¡_fÜw¬d”
 = 
»q_rou‹
[»q_rou‹.
	`size
(è- 1].
	`
();

224 
Eth”Add»ss
 
Ï¡_‘h
 = 
	`Ï¡_fÜw¬d”_‘h
(
v®
.
p
);

226 
¡©us
 = 
	`check_bÏckli¡
(
Ï¡_fÜw¬d”
);

227 ià(
¡©us
 =ğ
DSR_BLACKLIST_NOENTRY
) {

228 
	`DEBUG_CHATTER
(" * unidirectionalityest succeeded; forwarding„oute„equest\n");

229 
	`fÜw¬d_¼eq
(
v®
.
p
);

240 
»q_rou‹
.
	`push_back
(
	`DSRHİ
(*
me
, 
	`g‘_m‘ric
(
Ï¡_‘h
)));

241 
v®
.
be¡_m‘ric
 = 
	`rou‹_m‘ric
(
»q_rou‹
);

243 
v®
.
p
 = 
NULL
;

244 } ià((
¡©us
 =ğ
DSR_BLACKLIST_UNI_PROBABLE
) ||

245 (
	`diff_š_ms
(
cu¼_time
, 
v®
.
_time_unid‹¡_issued
è> 
DSR_BLACKLIST_UNITEST_TIMEOUT
)) {

246 
	`DEBUG_CHATTER
(" * unidirectionalityest failed; killing„oute„equest\n");

247 
v®
.
p
->
	`kl
();

248 
v®
.
p
 = 
NULL
;

256 ià(
	`diff_š_ms
(
cu¼_time
, 
i
.
	`v®ue
().
_time_fÜw¬ded
è> 
DSR_RREQ_TIMEOUT
) {

257 
IPAdd»ss
 
	`¤c
(
i
.
	`key
().
_¤c
);

258 
IPAdd»ss
 
	`d¡
(
i
.
	`key
().
_rg‘
);

259 
id
 = 
i
.
	`key
().
_id
;

260 
	`DEBUG_CHATTER
("RREQƒntry hasƒxpired; %s -> %s (%d)\n",

261 
¤c
.
	`uÅ¬£
().
	`c_¡r
(), 
d¡
.uÅ¬£().c_¡r(), 
id
);

263 
»move_li¡
.
	`push_back
(
i
.
	`key
());

266 
i
 = 0; i < 
»move_li¡
.
	`size
(); i++) {

268 
_fÜw¬ded_¼eq_m­
.
	`»move
(
»move_li¡
[
i
]);

272 
_¼eq_expœe_tim”
.
	`scheduË_aá”_m£c
(
DSR_RREQ_EXPIRE_TIMER_INTERVAL
);

274 
	`check
();

276 
	}
}

283 
	gDSRRou‹TabË
::
	$¡©ic_£ndbufãr_tim”_hook
(
Tim”
 *, *
v
)

285 
DSRRou‹TabË
 *
¹
 = (DSRRou‹TabË*)
v
;

286 
¹
->
	`£ndbufãr_tim”_hook
();

287 
	}
}

289 
	gDSRRou‹TabË
::
	$£ndbufãr_tim”_hook
()

293 
Time¡amp
 
cu¼_time
 = Time¡amp::
	`now
();

295 
tÙ®
 = 0;

296 
boŞ
 
check_Ãxt_time
 = 
çl£
;

298 
SBM­I‹r
 
i
=
_£ndbufãr_m­
.
	`begš
(); i.
	`live
(); i++) {

300 
S’dBufãr
 &
sb
 = 
i
.
	`v®ue
();

301 
IPAdd»ss
 
d¡
 = 
i
.
	`key
();

303 ià(! 
sb
.
	`size
()) {

308 ià(
_£ndbufãr_check_rou‹s
) {

316 
	`DEBUG_CHATTER
(" * send buffer has %d…acket%s with destination %s\n",

317 
sb
.
	`size
(),

318 
sb
.
	`size
() == 1 ? "" : "s",

319 
d¡
.
	`uÅ¬£
().
	`c_¡r
());

322 
_lšk_bË
->
	`dijk¡¿
(
çl£
);

323 
VeùÜ
<
IPAdd»ss
> 
rou‹
 = 
_lšk_bË
->
	`be¡_rou‹
(
d¡
, 
çl£
);

325 ià(
rou‹
.
	`size
() > 1) {

326 
	`DEBUG_CHATTER
(" * have‡„oute:\n");

328 
j
=0; j<
rou‹
.
	`size
(); j++)

329 
	`DEBUG_CHATTER
(" - %d %s \n",

330 
j
, 
rou‹
[j].
	`uÅ¬£
().
	`c_¡r
());

332 ià(
tÙ®
 < 
DSR_SENDBUFFER_MAX_BURST
) {

334 
k
;

335 
k
 = 0; k < 
sb
.
	`size
(è&& 
tÙ®
 < 
DSR_SENDBUFFER_MAX_BURST
; k++,otal++) {

337 
Pack‘
 *
p
 = 
sb
[
k
].
_p
;

338 
Pack‘
 *
p_out
 = 
	`add_d¤_h—d”
(
p
, 
rou‹
);

339 
	`ouut
(2).
	`push
(
p_out
);

342 ià(
k
 < 
sb
.
	`size
())

343 
check_Ãxt_time
 = 
Œue
;

346 
S’dBufãr
 
Ãw_sb
;

347  ; 
k
 < 
sb
.
	`size
() ; k++) {

350 
Ãw_sb
.
	`push_back
(
sb
[
k
].
_p
);

353 
sb
 = 
Ãw_sb
;

362 
	`DEBUG_CHATTER
("still‚o„outeo %s\n",

363 
d¡
.
	`uÅ¬£
().
	`c_¡r
());

370 
S’dBufãr
 
Ãw_sb
;

371 
j
 = 0; j < 
sb
.
	`size
(); j++) {

372 
time_–­£d
 = 
	`diff_š_ms
(
cu¼_time
, 
sb
[
j
].
_time_added
);

374 ià(
time_–­£d
 >ğ
DSR_SENDBUFFER_TIMEOUT
) {

375 
	`DEBUG_CHATTER
(" *…ack‘ %dƒxpœed iÀ£nd bufãr\n", 
j
);

376 
sb
[
j
].
_p
->
	`kl
();

379 
Ãw_sb
.
	`push_back
(
sb
[
j
]);

382 
sb
 = 
Ãw_sb
;

383 ià(
sb
.
	`size
() == 0) {

386 
	`¡İ_issušg_»que¡
(
d¡
);

390 
_£ndbufãr_check_rou‹s
 = 
check_Ãxt_time
;

391 
_£ndbufãr_tim”
.
	`scheduË_aá”_m£c
(
DSR_SENDBUFFER_TIMER_INTERVAL
);

393 
	`check
();

394 
	}
}

396 
	gDSRRou‹TabË
::
	$bufãr_·ck‘
(
Pack‘
 *
p
)

398 
IPAdd»ss
 
d¡
 = 
	`IPAdd»ss
(
p
->
	`d¡__ªno
());

399 
	`DEBUG_CHATTER
("bufãršg…ack‘ fÜ %s", 
d¡
.
	`uÅ¬£
().
	`c_¡r
());

401 
S’dBufãr
 *
sb
 = 
_£ndbufãr_m­
.
	`fšdp
(
d¡
);

402 ià(!
sb
) {

403 
_£ndbufãr_m­
.
	`š£¹
(
d¡
, 
	`S’dBufãr
());

404 
sb
 = 
_£ndbufãr_m­
.
	`fšdp
(
d¡
);

407 ià(
sb
->
	`size
(è>ğ
DSR_SENDBUFFER_MAX_LENGTH
) {

408 
	`DEBUG_CHATTER
("too many…ackets forhis host; killing\n");

409 
p
->
	`kl
();

411 
sb
->
	`push_back
(
p
);

412 
	`DEBUG_CHATTER
("%d…ack‘ fÜhi ho¡\n", 
sb
->
	`size
());

414 
	}
}

419 
	gDSRRou‹TabË
::
	$¡©ic_bÏckli¡_tim”_hook
(
Tim”
 *, *
v
)

421 
DSRRou‹TabË
 *
¹
 = (DSRRou‹TabË*)
v
;

422 
¹
->
	`bÏckli¡_tim”_hook
();

423 
	}
}

425 
	gDSRRou‹TabË
::
	$bÏckli¡_tim”_hook
()

427 
Time¡amp
 
cu¼_time
 = Time¡amp::
	`now
();

429 
BÏckli¡I‹r
 
i
 = 
_bÏckli¡
.
	`begš
(); i.
	`live
(); i++) {

430 ià((
i
.
	`v®ue
().
_¡©us
 =ğ
DSR_BLACKLIST_UNI_PROBABLE
) &&

431 (
	`diff_š_ms
(
cu¼_time
, 
i
.
	`v®ue
().
_time_upd©ed
è> 
DSR_BLACKLIST_ENTRY_TIMEOUT
)) {

433 
BÏckli¡EÁry
 &
e
 = 
i
.
	`v®ue
();

435 
	`DEBUG_CHATTER
(" * downg¿dšg bÏckli¡ƒÁry fÜ ho¡ %s\n", 
i
.
	`key
().
	`uÅ¬£
().
	`c_¡r
());

437 
e
.
_¡©us
 = 
DSR_BLACKLIST_UNI_QUESTIONABLE
;

440 
_bÏckli¡_tim”
.
	`scheduË_aá”_m£c
(
DSR_BLACKLIST_TIMER_INTERVAL
);

442 
	`check
();

443 
	}
}

447 
	gDSRRou‹TabË
::
	$push
(
pÜt
, 
Pack‘
 *
p_š
)

449 cÚ¡ 
şick_
 *

 = 
p_š
->
	`_h—d”
();

451 ià(
pÜt
==0) {

453 
IPAdd»ss
 
	`d¡_addr
(

->
_d¡
.
s_addr
);

455 
	`DEBUG_CHATTER
(" * DSR (%s): got IP…acket with destination is %s\n",

456 
this
->
	`Çme
().
	`c_¡r
(),

457 
d¡_addr
.
	`uÅ¬£
().
	`c_¡r
());

459 ià(
d¡_addr
 =ğ*
me
) {

461 
	`ouut
(0).
	`push
(
p_š
);

465 
_lšk_bË
->
	`dijk¡¿
(
çl£
);

466 
VeùÜ
<
IPAdd»ss
> 
rou‹
 = 
_lšk_bË
->
	`be¡_rou‹
(
d¡_addr
, 
çl£
);

467 ià(
rou‹
.
	`size
() > 1) {

469 
	`DEBUG_CHATTER
(" * have cached„oute:\n");

471 
j
=0; j < 
rou‹
.
	`size
(); j++)

472 
	`DEBUG_CHATTER
(" - %d %s\n", 
j
, 
rou‹
[j].
	`uÅ¬£
().
	`c_¡r
());

475 
Pack‘
 *
p
 = 
	`add_d¤_h—d”
(
p_š
, 
rou‹
);

477 
	`ouut
(2).
	`push
(
p
);

482 
	`DEBUG_CHATTER
(" * dÚ'ˆhavrou‹Ø%s; bufãršg…ack‘\n", 
d¡_addr
.
	`uÅ¬£
().
	`c_¡r
());

484 
	`bufãr_·ck‘
(
p_š
);

485 
	`¡¬t_issušg_»que¡
(
d¡_addr
);

491 } ià(
pÜt
==1) {

493 cÚ¡ 
şick_d¤_İtiÚ
 *
d¤_İtiÚ
 = (cÚ¡ click_d¤_İtiÚ *)(
p_š
->
	`d©a
() +

494 (
şick_
) +

495 (
şick_d¤
));

497 ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_RREQ
) {

499 cÚ¡ 
şick_d¤_¼eq
 *
d¤_¼eq
 = (cÚ¡ click_d¤_¼eq *)(
p_š
->
	`d©a
() +

500 (
şick_
) +

501 (
şick_d¤
));

502 
¤c
 = 

->
_¤c
.
s_addr
;

503 
IPAdd»ss
 
	`¤c_addr
(
¤c
);

504 
IPAdd»ss
 
	`d¡_addr
(
d¤_¼eq
->
rg‘
.
s_addr
);

506 
	`DEBUG_CHATTER
(" * DSR (%s): got„oute„equest for destination %s\n",

507 
this
->
	`Çme
().
	`c_¡r
(),

508 
d¡_addr
.
	`uÅ¬£
().
	`c_¡r
());

511 
DSRRou‹
 
»que¡_rou‹
 = 
	`exŒaù_»que¡_rou‹
(
p_š
);

514 
Eth”Add»ss
 
Ï¡_‘h
 = 
	`Ï¡_fÜw¬d”_‘h
(
p_š
);

515 
»que¡_rou‹
.
	`push_back
(
	`DSRHİ
(*
me
, 
	`g‘_m‘ric
(
Ï¡_‘h
)));

517 
j
=0; j<
»que¡_rou‹
.
	`size
(); j++)

518 
	`DEBUG_CHATTER
(" - %d %s (%d)\n",

519 
j
, 
»que¡_rou‹
[j].
	`
().
	`uÅ¬£
().
	`c_¡r
(),

520 
»que¡_rou‹
[
j
].
_m‘ric
);

522 
	`add_rou‹_to_lšk_bË
(
»que¡_rou‹
);

524 ià(*
me
==
¤c_addr
) {

525 
	`DEBUG_CHATTER
(" * I sourcedhis RREQ; ignore.\n");

526 
p_š
->
	`kl
();

528 } ià(*
me
==
d¡_addr
) {

531 
DSRRou‹
 
»¶y_rou‹
 = 
	`»v”£_rou‹
(
»que¡_rou‹
);

533 
	`DEBUG_CHATTER
(" * Generating„oute„eply with source„oute:\n");

534 
j
=0; j<
»¶y_rou‹
.
	`size
(); j++)

535 
	`DEBUG_CHATTER
(" - %d %s (%d)\n",

536 
j
, 
»¶y_rou‹
[j].
	`
().
	`uÅ¬£
().
	`c_¡r
(),

537 
»¶y_rou‹
[
j
].
_m‘ric
);

539 
	`issue_¼•
(
d¡_addr
, 
¤c_addr
, 
»que¡_rou‹
, 
»¶y_rou‹
);

540 
p_š
->
	`kl
();

549 ià(

->
_‰l
 == 1) {

550 
	`DEBUG_CHATTER
(" *imeo†iveƒxpired; killing…acket\n");

551 
p_š
->
	`kl
();

555 ià(
	`rou‹_šdex_of
(
»que¡_rou‹
, *
me
è!ğ»que¡_rou‹.
	`size
()-1) {

558 
	`DEBUG_CHATTER
(" * I'm‡lready†isted; killing…acket\n");

559 
p_š
->
	`kl
();

565 
FÜw¬dedReqKey
 
	`äk
(
¤c_addr
, 
d¡_addr
, 
	`Áohs
(
d¤_¼eq
->
d¤_id
));

566 
FÜw¬dedReqV®
 *
Şd_äv
 = 
_fÜw¬ded_¼eq_m­
.
	`fšdp
(
äk
);

569 
this_m‘ric
 = 
	`rou‹_m‘ric
(
»que¡_rou‹
);

570 ià(
Şd_äv
) {

571 
	`DEBUG_CHATTER
(" *‡lready forwardedhis„oute„equest (%d, %d)\n",

572 
this_m‘ric
, 
Şd_äv
->
be¡_m‘ric
);

573 ià(
	`m‘ric_´eã¿bË
(
this_m‘ric
, 
Şd_äv
->
be¡_m‘ric
))

574 
	`DEBUG_CHATTER
(" * buthis one is better\n");

576 
	`DEBUG_CHATTER
(" *‡ndhis one's‚ot‡s good\n");

579 ià(
Şd_äv
 && ! 
	`m‘ric_´eã¿bË
(
this_m‘ric
, old_äv->
be¡_m‘ric
)) {

580 
	`DEBUG_CHATTER
(" *‡lready forwardedhis„oute„equest\n");

582 
p_š
->
	`kl
();

590 
FÜw¬dedReqV®
 
Ãw_äv
;

592 
Time¡amp
 
cu¼’t_time
 = Time¡amp::
	`now
();

593 
Ãw_äv
.
_time_fÜw¬ded
 = 
cu¼’t_time
;

595 
IPAdd»ss
 
Ï¡_fÜw¬d”
 = 
	`IPAdd»ss
(
	`DSR_LAST_HOP_IP_ANNO
(
p_š
));

601 
¡©us
 = 
	`check_bÏckli¡
(
Ï¡_fÜw¬d”
);

603 ià(
¡©us
 =ğ
DSR_BLACKLIST_UNI_PROBABLE
) {

604 
	`DEBUG_CHATTER
(" *„equest came over‡ unidirectional†ink; killing\n");

605 
p_š
->
	`kl
();

607 } ià(
¡©us
 =ğ
DSR_BLACKLIST_UNI_QUESTIONABLE
) {

609 ià(
Şd_äv
) {

616 
	`DEBUG_CHATTER
(" *†ink may be unidirectional but unidirectionalityest is‡lready issued;\n");

617 
	`DEBUG_CHATTER
(" * droppinghis…acket instead...\n");

618 
p_š
->
	`kl
();

622 
	`DEBUG_CHATTER
(" *†ink may be unidirectional; sending out 1-hop RREQ\n");

625 
	`issue_¼eq
(
Ï¡_fÜw¬d”
, 1, 
Œue
);

626 
Ãw_äv
.
p
 = 
p_š
;

627 
Ãw_äv
.
_time_unid‹¡_issued
 = 
cu¼’t_time
;

633 
Ãw_äv
.
be¡_m‘ric
 = 
DSR_INVALID_ROUTE_METRIC
;

635 
_fÜw¬ded_¼eq_m­
.
	`š£¹
(
äk
, 
Ãw_äv
);

640 ià(
Şd_äv
 && old_äv->
p
) {

653 
Şd_äv
->
p
->
	`kl
();

654 
Şd_äv
->
p
 = 
NULL
;

657 
	`DEBUG_CHATTER
(" * forwardinghis RREQ\n");

658 
Ãw_äv
.
p
 = 
NULL
;

659 
Ãw_äv
.
be¡_m‘ric
 = 
this_m‘ric
;

660 
_fÜw¬ded_¼eq_m­
.
	`š£¹
(
äk
, 
Ãw_äv
);

661 
	`fÜw¬d_¼eq
(
p_š
);

669 } ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_RREP
) {

675 
IPAdd»ss
 
	`d¡_addr
(

->
_d¡
.
s_addr
);

679 
DSRRou‹
 
»¶y_rou‹
 = 
	`exŒaù_»¶y_rou‹
(
p_š
);

683 
	`add_rou‹_to_lšk_bË
(
»¶y_rou‹
);

685 
	`DEBUG_CHATTER
(" * DSR (%s):„eceived„oute„eply with„eply„oute:\n",

686 
this
->
	`Çme
().
	`c_¡r
());

687 
i
=0; i<
»¶y_rou‹
.
	`size
(); i++)

688 
	`DEBUG_CHATTER
(" - %d %s (%d)\n",

689 
i
,

690 
»¶y_rou‹
[
i
].
	`
().
	`uÅ¬£
().
	`c_¡r
(),

691 
»¶y_rou‹
[
i
].
_m‘ric
);

695 
_£ndbufãr_check_rou‹s
 = 
Œue
;

696 
_£ndbufãr_tim”
.
	`scheduË_now
();

699 
IPAdd»ss
 
Ï¡_fÜw¬d”
 = 
	`IPAdd»ss
(
	`DSR_LAST_HOP_IP_ANNO
(
p_š
));

707 
	`£t_bÏckli¡
(
Ï¡_fÜw¬d”
, 
DSR_BLACKLIST_NOENTRY
);

709 ià(
d¡_addr
==*
me
) {

714 
IPAdd»ss
 
»¶y_d¡
 = 
»¶y_rou‹
[»¶y_rou‹.
	`size
()-1].
	`
();

715 
	`DEBUG_CHATTER
(" * killed (routeo %s„eached final destination, %s)\n",

716 
»¶y_d¡
.
	`uÅ¬£
().
	`c_¡r
(), 
d¡_addr
.unparse().c_str());

717 
	`¡İ_issušg_»que¡
(
»¶y_d¡
);

718 
p_š
->
	`kl
();

721 
	`DEBUG_CHATTER
(" * fÜw¬dšgow¬d de¡š©iÚ %s\n", 
d¡_addr
.
	`uÅ¬£
().
	`c_¡r
());

722 
	`fÜw¬d_¼•
(
p_š
);

726 } ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_RERR
) {

728 
	`DEBUG_CHATTER
(" * DSR (%s): got„outeƒrror…acket\n",

729 
this
->
	`Çme
().
	`c_¡r
());

732 cÚ¡ 
şick_d¤_»¼
 *
d¤_»¼
 = (şick_d¤_»¼ *)
d¤_İtiÚ
;

734 
	`as£¹
(
d¤_»¼
->
d¤_”rÜ
 =ğ
DSR_RERR_TYPE_NODE_UNREACHABLE
);

736 cÚ¡ 
š_addr
 *
uÄ—chabË_addr
 = (š_add¸*)((*)
d¤_»¼
 + (
şick_d¤_»¼
));

739 
IPAdd»ss
 
	`”r_¤c
(
d¤_»¼
->
d¤_”r_¤c
);

740 
IPAdd»ss
 
	`”r_d¡
(
d¤_»¼
->
d¤_”r_d¡
);

741 
IPAdd»ss
 
	`uÄ—chabË_d¡
(
uÄ—chabË_addr
->
s_addr
);

744 
	`DEBUG_CHATTER
(" -„emoving†ink from %so %s;„err destination is %s\n",

745 
”r_¤c
.
	`uÅ¬£
().
	`c_¡r
(), 
uÄ—chabË_d¡
.uÅ¬£().c_¡r(), 
”r_d¡
.unparse().c_str());

748 
_lšk_bË
->
	`upd©e_bÙh_lšks
(
”r_¤c
, 
uÄ—chabË_d¡
, 0, 0, 
DSR_INVALID_ROUTE_METRIC
);

750 ià(
”r_d¡
 =ğ*
me
) {

751 
	`DEBUG_CHATTER
(" * killed (reached final destination)\n");

752 
p_š
->
	`kl
();

754 
	`fÜw¬d_»¼
(
p_š
);

759 ià(
_outq
) {

760 
VeùÜ
<
Pack‘
 *> 
y
;

761 
_outq
->
	`yªk
(
	`lšk_f‹r
(
”r_¤c
, 
uÄ—chabË_d¡
), 
y
);

762 
	`DEBUG_CHATTER
("yªked %d…ack‘s; klšg...\n", 
y
.
	`size
());

763 
i
 = 0; i < 
y
.
	`size
(); i++)

764 
y
[
i
]->
	`kl
();

769 } ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_SOURCE_ROUTE
) {

773 
_d¡
 = 

->_d¡.
s_addr
;

774 
IPAdd»ss
 
	`d¡_addr
(
_d¡
);

776 
	`DEBUG_CHATTER
(" * DSR (%s): incoming data…kt for %s; dsr_type is %d\n",

777 
this
->
	`Çme
().
	`c_¡r
(),

778 
d¡_addr
.
	`uÅ¬£
().
	`c_¡r
(), 
d¤_İtiÚ
->
d¤_ty³
);

781 
IPAdd»ss
 
Ï¡_fÜw¬d”
 = 
	`IPAdd»ss
(
	`DSR_LAST_HOP_IP_ANNO
(
p_š
));

784 
	`£t_bÏckli¡
(
Ï¡_fÜw¬d”
, 
DSR_BLACKLIST_NOENTRY
);

787 ià(
d¡_addr
 =ğ*
me
) {

788 
Pack‘
 *
p
 = 
	`¡r_h—d”s
(
p_š
);

790 
	`ouut
(0).
	`push
(
p
);

796 
	`fÜw¬d_d©a
(
p_š
);

800 
	`DEBUG_CHATTER
("uÃx³ùed…ack‘y³ %d\n", 
d¤_İtiÚ
->
d¤_ty³
);

801 
p_š
->
	`kl
();

804 } ià(
pÜt
 == 2) {

810 
IPAdd»ss
 
bad_¤c
 = *
me
;

811 cÚ¡ 
şick_d¤_İtiÚ
 *
d¤_İtiÚ
 = (cÚ¡ click_d¤_İtiÚ *)(
p_š
->
	`d©a
() +

812 (
şick_
) +

813 (
şick_d¤
));

815 
off£t
 = (
şick_
è+ (
şick_d¤
);

816 
IPAdd»ss
 
bad_d¡
;

818 ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_RREQ
) {

822 cÚ¡ 
şick_d¤_¼eq
 *
d¤_¼eq
 = (cÚ¡ click_d¤_¼eq *)
d¤_İtiÚ
;

823 
bad_d¡
 = 
	`IPAdd»ss
(
d¤_¼eq
->
rg‘
);

825 ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_RREP
) {

826 cÚ¡ 
şick_d¤_¼•
 *
d¤_¼•
 = (cÚ¡ click_d¤_¼• *)
d¤_İtiÚ
;

827 
hİ_couÁ
 = 
d¤_¼•
->
	`num_addrs
();

829 
off£t
 +ğ(
şick_d¤_¼•
è+ 
hİ_couÁ
 * (
DSRHİ
);

830 } ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_RERR
) {

831 cÚ¡ 
şick_d¤_»¼
 *
d¤_»¼
 = (cÚ¡ click_d¤_»¼ *)
d¤_İtiÚ
;

832 
	`as£¹
(
d¤_»¼
->
d¤_”rÜ
 =ğ
DSR_RERR_TYPE_NODE_UNREACHABLE
);

833 
off£t
 +ğ(
şick_d¤_»¼
è+ (
š_addr
);

835 
bad_d¡
 = 
	`Ãxt_¤_hİ
(
p_š
, 
off£t
);

838 
	`DEBUG_CHATTER
(" *…acket had bad source„oute with‚ext hop %s\n",

839 
bad_d¡
.
	`uÅ¬£
().
	`c_¡r
());

841 ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_RREP
) {

842 
	`DEBUG_CHATTER
(" *xƒrror sending„oute„eply;‡ddingƒntryo blacklist for %s\n",

843 
bad_d¡
.
	`uÅ¬£
().
	`c_¡r
());

844 
	`£t_bÏckli¡
(
bad_d¡
, 
DSR_BLACKLIST_UNI_PROBABLE
);

845 } ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_RREQ
) {

847 
	`DEBUG_CHATTER
(" * one-hop unicast RREQ failed\n");

848 
	`£t_bÏckli¡
(
bad_d¡
, 
DSR_BLACKLIST_UNI_PROBABLE
);

851 
_lšk_bË
->
	`upd©e_bÙh_lšks
(
bad_¤c
, 
bad_d¡
, 0, 0, 
DSR_INVALID_ROUTE_METRIC
);

853 cÚ¡ 
şick_
 *

 = 
p_š
->
	`_h—d”
();

854 
¤c
 = 

->
_¤c
.
s_addr
;

855 
IPAdd»ss
 
	`¤c_addr
(
¤c
);

858 ià(
¤c_addr
 =ğ*
me
) {

861 
p_š
->
	`kl
();

865 
DSRRou‹
 
sourû_rou‹
, 
Œunc_rou‹
, 
»v_rou‹
;

868 
sourû_rou‹
 = 
	`exŒaù_sourû_rou‹
(
p_š
, 
off£t
);

870 
Œunc_rou‹
 = 
	`Œunÿ‹_rou‹
(
sourû_rou‹
, *
me
);

871 ià(! 
Œunc_rou‹
.
	`size
()) {

873 
	`DEBUG_CHATTER
("couldn't find my‡ddress in bad source„oute!\n");

877 
»v_rou‹
 = 
	`»v”£_rou‹
(
Œunc_rou‹
);

878 
	`issue_»¼
(
bad_¤c
, 
bad_d¡
, 
¤c_addr
, 
»v_rou‹
);

882 ià(
_outq
) {

883 
VeùÜ
<
Pack‘
 *> 
y
;

884 
_outq
->
	`yªk
(
	`lšk_f‹r
(
bad_¤c
, 
bad_d¡
), 
y
);

885 
	`DEBUG_CHATTER
("yªked %d…ack‘s; klšg...\n", 
y
.
	`size
());

886 
i
 = 0; i < 
y
.
	`size
(); i++)

887 
y
[
i
]->
	`kl
();

907 
p_š
->
	`kl
();

912 
	`as£¹
(0);

913 
	}
}

915 
Pack‘
 *

916 
	gDSRRou‹TabË
::
add_d¤_h—d”
(
Pack‘
 *
p_š
, cÚ¡ 
VeùÜ
<
IPAdd»ss
> &
sourû_rou‹
)

918 
	gŞd_Ën
 = 
p_š
->
Ëngth
();

919 
	g·ylßd
;

920 
	gi
;

924 
as£¹
(
sourû_rou‹
.
size
() >= 2);

925 
	ghİ_couÁ
 = 
sourû_rou‹
.
size
() - 2;

927 
	g·ylßd
 = ((
şick_d¤
) +

928 (
şick_d¤_sourû
) +

929 
hİ_couÁ
 * (
DSRHİ
));

931 
DEBUG_CHATTER
(" * creating DSR source-routed…acket\n");

934 
şick_
 *
	g
 = (şick_ *)(
p_š
->
d©a
());

935 
şick_
 
	gŞd_
;

936 
memıy
(&
Şd_
, 

, (
şick_
));

939 
Wr™abËPack‘
 *
	gp
 = 
p_š
->
push
(
·ylßd
);

940 ià(!
	gp
) {

941 
şick_ch©‹r
("couldn't‡dd space for‚ew DSR header\n");

942  
	gp
;

945 
	g
 = (
şick_
 *)(
p
->
d©a
());

946 
memıy
(

, &
Şd_
, (
şick_
));

949 
şick_d¤
 *
	gd¤
 = (şick_d¤ *)(
p
->
d©a
(è+ (
şick_
));

951 
	gd¤
->
	gd¤_Ãxt_h—d”
 = 

->
_p
;

952 
	g
->
	g_p
 = 
IP_PROTO_DSR
;

953 
	gd¤
->
	gd¤_Ën
 = 
htÚs
(
·ylßd
 - (
şick_d¤
));

954 
	gd¤
->
	gd¤_»£rved
 = 0;

956 
DEBUG_CHATTER
(" *‡dd_d¤_h—d”:‚ew…ack‘ sizi %d, old wa %d \n", 
p
->
Ëngth
(), 
Şd_Ën
);

958 
	g
->
	g_Ën
 = 
htÚs
(
p
->
Ëngth
());

959 
	g
->
	g_d¡
.
	gs_addr
 = ()
p
->
d¡__ªno
();

960 
	g
->
	g_sum
 = 0;

961 
	g
->
	g_sum
 = 
şick_š_cksum
((*)

, (
şick_
));

963 
	gp
->
£t__h—d”
(

, (
şick_
));

966 
şick_d¤_sourû
 *
	gd¤_sourû
=(şick_d¤_sourû *)(
p
->
d©a
()+(
şick_
)+(
şick_d¤
));

968 
	gd¤_sourû
->
	gd¤_ty³
 = 
DSR_TYPE_SOURCE_ROUTE
;

969 
	gd¤_sourû
->
	gd¤_Ën
 = (
DSRHİ
è* 
hİ_couÁ
 + 2;

970 
	gd¤_sourû
->
	gd¤_£g¦eá
 = 
hİ_couÁ
;

972 
	gi
=0; i<
	ghİ_couÁ
; i++) {

973 
	gd¤_sourû
->
	gaddr
[
i
].
	g_
.
	gs_addr
 = 
sourû_rou‹
[i+1].
addr
();

974 
	gd¤_sourû
->
	gaddr
[
i
].
	g_m‘ric
 = 0;

978 
	gp
->
£t_d¡__ªno
(
sourû_rou‹
[
hİ_couÁ
].
addr
());

980 
DEBUG_CHATTER
(" *‡dded source„oute header");

982  
	gp
;

986 
Pack‘
 *

987 
	gDSRRou‹TabË
::
	$¡r_h—d”s
(
Pack‘
 *
p_š
)

989 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

990 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
p
->
	`d©a
());

991 
şick_d¤
 *
d¤
 = (şick_d¤ *)(
p
->
	`d©a
(è+ (
şick_
));

993 
	`as£¹
(

->
_p
 =ğ
IP_PROTO_DSR
);

996 
d¤_Ën
 = (
şick_d¤
è+ 
	`Áohs
(
d¤
->dsr_len);

999 
şick_
 
Ãw_
;

1000 
	`memıy
(&
Ãw_
, 

, (
şick_
));

1001 
Ãw_
.
_p
 = 
d¤
->
d¤_Ãxt_h—d”
;

1004 
p
->
	`puÎ
(
d¤_Ën
);

1005 
	`memıy
(
p
->
	`d©a
(), &
Ãw_
, (
şick_
));

1006 

=
»š‹½»t_ÿ¡
<
şick_
 *>(
p
->
	`d©a
());

1007 

->
_Ën
=
	`htÚs
(
p
->
	`Ëngth
());

1008 

->
_sum
=0;

1009 

->
_sum
=
	`şick_š_cksum
((*),(
şick_
));

1011 
p
->
	`£t__h—d”
((
şick_
*í->
	`d©a
(),(click_ip));

1013 
	`DEBUG_CHATTER
(" * sŒpšg h—d”s;„emoved %d by‹s\n", 
d¤_Ën
);

1015  
p
;

1016 
	}
}

1021 
DSRRou‹


1022 
	gDSRRou‹TabË
::
	$exŒaù_»que¡_rou‹
(cÚ¡ 
Pack‘
 *
p_š
)

1024 cÚ¡ 
şick_
 *

 = 
p_š
->
	`_h—d”
();

1027 
¤c
 = 

->
_¤c
.
s_addr
;

1028 
IPAdd»ss
 
	`¤c_addr
(
¤c
);

1030 cÚ¡ 
şick_d¤_¼eq
 *
d¤_¼eq
 = (cÚ¡ click_d¤_¼eq *)(
p_š
->
	`d©a
()+

1031 (
şick_
)+

1032 (
şick_d¤
));

1033 
	`as£¹
(
d¤_¼eq
->
d¤_ty³
 =ğ
DSR_TYPE_RREQ
);

1035 
num_addr
 = 
d¤_¼eq
->
	`num_addrs
();

1039 
DSRRou‹
 
rou‹
;

1040 
rou‹
.
	`push_back
(
	`DSRHİ
(
¤c_addr
));

1042 
i
=0; i<
num_addr
; i++) {

1043 
rou‹
.
	`push_back
(
d¤_¼eq
->
addr
[
i
]);

1048  
rou‹
;

1049 
	}
}

1052 
	gDSRRou‹TabË
::
	$issue_¼•
(
IPAdd»ss
 
¤c
, IPAdd»s 
d¡
,

1053 
DSRRou‹
 
»¶y_rou‹
,

1054 
DSRRou‹
 
sourû_rou‹
)

1057 
¤c_hİ_couÁ
 = 
sourû_rou‹
.
	`size
() - 2;

1061 
»¶y_hİ_couÁ
 = 
»¶y_rou‹
.
	`size
() - 1;

1064 
·ylßd
 = ((
şick_
è+ (
şick_d¤
) +

1065 (
şick_d¤_¼•
) +

1066 (
DSRHİ
è* 
»¶y_hİ_couÁ
 +

1067 (
şick_d¤_sourû
) +

1068 (
DSRHİ
è* 
¤c_hİ_couÁ
);

1070 
i
;

1072 
‰l
=255;

1074 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
·ylßd
);

1076 ià(!
p
) {

1077 
	`DEBUG_CHATTER
(" * issue_¼•: couldn'ˆmak·ck‘ oà%d by‹s\n", 
·ylßd
);

1083 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
p
->
	`d©a
());

1084 
şick_d¤
 *
d¤
 = (şick_d¤ *)(
p
->
	`d©a
(è+ (
şick_
));

1085 
şick_d¤_¼•
 *
d¤_¼•
 = (şick_d¤_¼• *)Ğ
p
->
	`d©a
() +

1086 (
şick_
) +

1087 (
şick_d¤
));

1088 
şick_d¤_sourû
 *
d¤_sourû
 = (şick_d¤_sourû *)Ğ
p
->
	`d©a
() +

1089 (
şick_
) +

1090 (
şick_d¤
) +

1091 (
şick_d¤_¼•
) +

1092 (
DSRHİ
è* 
»¶y_hİ_couÁ
);

1094 
p
->
	`£t__h—d”
(

, (
şick_
));

1097 
d¤_sourû
->
d¤_ty³
 = 
DSR_TYPE_SOURCE_ROUTE
;

1098 
d¤_sourû
->
d¤_Ën
 = (
DSRHİ
è* 
¤c_hİ_couÁ
 + 2;

1099 
d¤_sourû
->
d¤_£g¦eá
 = 
¤c_hİ_couÁ
;

1101 ià(
¤c_hİ_couÁ
 != 0) {

1104 
i
=1; i<
sourû_rou‹
.
	`size
()-1; i++) {

1105 
d¤_sourû
->
addr
[
i
-1].
_
 = 
sourû_rou‹
[i]._ip;

1106 
d¤_sourû
->
addr
[
i
-1].
_m‘ric
 = 0;

1111 
d¤_¼•
->
d¤_ty³
 = 
DSR_TYPE_RREP
;

1112 
d¤_¼•
->
d¤_Ën
 = (
DSRHİ
)*
»¶y_hİ_couÁ
+1;

1113 
d¤_¼•
->
d¤_æags
 = 0;

1117 
i
=1; i<
»¶y_rou‹
.
	`size
(); i++) {

1120 
d¤_¼•
->
addr
[
i
-1].
_
 = 
»¶y_rou‹
[i]._ip;

1121 
d¤_¼•
->
addr
[
i
-1].
_m‘ric
 = 
»¶y_rou‹
[i]._metric;

1125 

->
_v
 = 4;

1126 

->
_hl
 = (
şick_
) >> 2;

1127 

->
_Ën
 = 
	`htÚs
(
p
->
	`Ëngth
());

1129 

->
_p
 = 
IP_PROTO_DSR
;

1130 

->
_¤c
.
s_addr
 = 
¤c
.
	`addr
();

1131 

->
_d¡
.
s_addr
 = 
d¡
.
	`addr
();

1132 

->
_tos
 = 0;

1133 

->
_off
 = 0;

1134 

->
_‰l
 = 
‰l
;

1135 

->
_sum
 = 0;

1136 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

1139 
d¤
->
d¤_Ãxt_h—d”
 = 

->
_p
;

1140 
d¤
->
d¤_Ën
 = 
	`htÚs
(
·ylßd
 - (
şick_d¤
è- (
şick_
));

1141 
d¤
->
d¤_»£rved
 = 0;

1144 
p
->
	`£t_d¡__ªno
(
sourû_rou‹
[1].
_
);

1145 
IPAdd»ss
 
	`d¡_ªno_add»ss
(
p
->
	`d¡__ªno
());

1146 
	`DEBUG_CHATTER
(" * c»©ed RREP…ack‘ w™h‚exˆhİ %s\n", 
d¡_ªno_add»ss
.
	`uÅ¬£
().
	`c_¡r
());

1148 
	`ouut
(1).
	`push
(
p
);

1149 
	}
}

1155 
	gDSRRou‹TabË
::
	$issue_»¼
(
IPAdd»ss
 
bad_¤c
, IPAdd»s 
bad_d¡
, IPAdd»s 
¤c
,

1156 
DSRRou‹
 
sourû_rou‹
)

1158 
Wr™abËPack‘
 *
p
 = 
NULL
;

1161 
¤c_hİ_couÁ
 = 
sourû_rou‹
.
	`size
()-2;

1162 
	`as£¹
(
¤c_hİ_couÁ
 >= 0);

1165 
·ylßd
 = ((
şick_
) +

1166 (
şick_d¤
) +

1167 (
şick_d¤_»¼
) +

1168 (
š_addr
));

1174 
·ylßd
 +ğ((
şick_d¤_sourû
) +

1175 (
DSRHİ
è* (
¤c_hİ_couÁ
));

1177 
i
;

1180 
‰l
=255;

1183 
p
 = 
Pack‘
::
	`make
(
·ylßd
);

1185 ià(!
p
) {

1186 
	`DEBUG_CHATTER
(" * issue_»¼: couldn'ˆmak·ck‘ oà%d by‹s\n", 
·ylßd
);

1191 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
p
->
	`d©a
());

1193 
şick_d¤
 *
d¤
 = (şick_d¤ *)(
p
->
	`d©a
(è+ (
şick_
));

1195 
şick_d¤_»¼
 *
d¤_»¼
 = (şick_d¤_»¼ *)(
p
->
	`d©a
() +

1196 (
şick_
) +

1197 (
şick_d¤
));

1198 
š_addr
 *
d¤_uÄ—ch_addr
=(š_add¸*)(
p
->
	`d©a
() +

1199 (
şick_
) +

1200 (
şick_d¤
) +

1201 (
şick_d¤_»¼
));

1203 
şick_d¤_sourû
 *
d¤_sourû
 = (şick_d¤_sourû *)(
p
->
	`d©a
() +

1204 (
şick_
) +

1205 (
şick_d¤
) +

1206 (
şick_d¤_»¼
) +

1207 (
š_addr
));

1209 
p
->
	`£t__h—d”
(

, (
şick_
));

1212 
d¤_»¼
->
d¤_ty³
 = 
DSR_TYPE_RERR
;

1213 
d¤_»¼
->
d¤_Ën
 = 14;

1214 
d¤_»¼
->
d¤_”rÜ
 = 
DSR_RERR_TYPE_NODE_UNREACHABLE
;

1215 
d¤_»¼
->
d¤_æags
 = 0;

1216 
d¤_»¼
->
d¤_”r_¤c
.
s_addr
 = 
bad_¤c
.
	`addr
();

1217 
d¤_»¼
->
d¤_”r_d¡
.
s_addr
 = 
¤c
.
	`addr
();

1220 
d¤_uÄ—ch_addr
->
s_addr
 = 
bad_d¡
.
	`addr
();

1223 

->
_v
 = 4;

1224 

->
_hl
 = (
şick_
) >> 2;

1225 

->
_Ën
 = 
	`htÚs
(
p
->
	`Ëngth
());

1230 

->
_id
 = 
	`htÚs
(1);

1231 

->
_p
 = 
IP_PROTO_DSR
;

1232 

->
_¤c
.
s_addr
 = 
bad_¤c
.
	`addr
();

1233 

->
_d¡
.
s_addr
 = 
¤c
.
	`addr
();

1234 

->
_tos
 = 0;

1235 

->
_off
 = 0;

1236 

->
_‰l
 = 
‰l
;

1237 

->
_sum
 = 0;

1238 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

1241 
d¤
->
d¤_Ãxt_h—d”
 = 

->
_p
;

1242 
d¤
->
d¤_Ën
 = 
	`htÚs
(
·ylßd
 - (
şick_d¤
)-(
şick_
));

1243 
d¤
->
d¤_»£rved
 = 0;

1249 
d¤_sourû
->
d¤_ty³
 = 
DSR_TYPE_SOURCE_ROUTE
;

1250 
d¤_sourû
->
d¤_Ën
 = (
DSRHİ
è* 
¤c_hİ_couÁ
 + 2;

1251 
d¤_sourû
->
d¤_£g¦eá
 = 
¤c_hİ_couÁ
;

1255 
i
=1; i < 
sourû_rou‹
.
	`size
()-1; i++) {

1256 
d¤_sourû
->
addr
[
i
-1].
_
 = 
sourû_rou‹
[i]._ip;

1257 
d¤_sourû
->
addr
[
i
-1].
_m‘ric
 = 0;

1262 
p
->
	`£t_d¡__ªno
(
sourû_rou‹
[1].
_
);

1264 
IPAdd»ss
 
	`d¡_ªno_add»ss
(
p
->
	`d¡__ªno
());

1265 
	`DEBUG_CHATTER
(" * created RERR…acket with‚ext hop‡s %s\n",

1266 
d¡_ªno_add»ss
.
	`uÅ¬£
().
	`c_¡r
() );

1268 
	`ouut
(1).
	`push
(
p
);

1269 
	}
}

1274 
DSRRou‹


1275 
	gDSRRou‹TabË
::
	$exŒaù_»¶y_rou‹
(cÚ¡ 
Pack‘
 *
p
)

1277 cÚ¡ 
şick_
 *

 = 
p
->
	`_h—d”
();

1278 cÚ¡ 
şick_d¤_¼•
 *
d¤_¼•
 = (cÚ¡ click_d¤_¼• *)(
p
->
	`d©a
()+

1279 (
şick_
)+

1280 (
şick_d¤
));

1281 
IPAdd»ss
 
	`de¡_
(

->
_d¡
.
s_addr
);

1283 
	`as£¹
(
d¤_¼•
->
d¤_ty³
 =ğ
DSR_TYPE_RREP
);

1285 
hİ_couÁ
 = 
d¤_¼•
->
	`num_addrs
();

1288 
DSRRou‹
 
rou‹
;

1301 
rou‹
.
	`push_back
(
	`DSRHİ
(
de¡_
));

1303 
i
=0; i < 
hİ_couÁ
; i++) {

1304 
rou‹
.
	`push_back
(
d¤_¼•
->
addr
[
i
]);

1307  
rou‹
;

1308 
	}
}

1313 
DSRRou‹


1314 
	gDSRRou‹TabË
::
	$exŒaù_sourû_rou‹
(cÚ¡ 
Pack‘
 *
p_š
, 
off£t
)

1317 
	`as£¹
(
off£t
 < 
p_š
->
	`Ëngth
());

1318 cÚ¡ 
şick_
 *

 = 
p_š
->
	`_h—d”
();

1319 cÚ¡ 
şick_d¤_sourû
 *
d¤_sourû
 = (cÚ¡ click_d¤_sourû *)(
p_š
->
	`d©a
()+

1320 
off£t
);

1322 
	`as£¹
(
d¤_sourû
->
d¤_ty³
 =ğ
DSR_TYPE_SOURCE_ROUTE
);

1324 
sourû_hİs
 = 
d¤_sourû
->
	`num_addrs
();

1325 
DSRRou‹
 
rou‹
;

1328 
IPAdd»ss
 
	`¤c
(

->
_¤c
.
s_addr
);

1329 
IPAdd»ss
 
	`d¡
(

->
_d¡
.
s_addr
);

1331 
rou‹
.
	`push_back
(
	`DSRHİ
(
¤c
));

1334 
i
=0; i<
sourû_hİs
; i++) {

1335 
rou‹
.
	`push_back
(
d¤_sourû
->
addr
[
i
]);

1338 
rou‹
.
	`push_back
(
	`DSRHİ
(
d¡
));

1339  
rou‹
;

1340 
	}
}

1345 
	gDSRRou‹TabË
::
	$fÜw¬d_¼•
(
Pack‘
 * 
p_š
)

1347 
Wr™abËPack‘
 *
p
=
p_š
->
	`uniqueify
();

1351 
şick_d¤_¼•
 *
d¤_¼•
=(şick_d¤_¼• *)(
p
->
	`d©a
()+

1352 (
şick_
) +

1353 (
şick_d¤
));

1356 
num_addr
 = 
d¤_¼•
->
	`num_addrs
();

1366 
d¤_sourû_off£t
 = ((
şick_
) +

1367 (
şick_d¤
) +

1368 (
şick_d¤_¼•
) +

1369 
num_addr
 * (
DSRHİ
));

1371 
	`fÜw¬d_¤
(
p
, 
d¤_sourû_off£t
, 1);

1372 
	}
}

1377 
	gDSRRou‹TabË
::
	$fÜw¬d_d©a
(
Pack‘
 *
p_š
)

1379 
	`fÜw¬d_¤
(
p_š
, (
şick_
è+ (
şick_d¤
), 2);

1380 
	}
}

1384 
	gDSRRou‹TabË
::
	$fÜw¬d_»¼
(
Pack‘
 * 
p_š
)

1387 
d¤_sourû_off£t
 = ((
şick_
) +

1388 (
şick_d¤
) +

1389 (
şick_d¤_»¼
) +

1390 (
š_addr
));

1392 
	`fÜw¬d_¤
(
p_š
, 
d¤_sourû_off£t
, 1);

1393 
	}
}

1395 
IPAdd»ss


1396 
	gDSRRou‹TabË
::
	$Ãxt_hİ
(
Pack‘
 *
p
)

1398 cÚ¡ 
şick_
 *

 = (cÚ¡ click_*)(
p
->
	`d©a
(è+ (
şick_‘h”
));

1400 
şick_d¤
 *
d¤
 = (şick_d¤ *)(
p
->
	`d©a
(è+ (
şick_
));

1401 cÚ¡ 
d¤_Ën
 = 
d¤
->dsr_len;

1403 
şick_d¤_İtiÚ
 *
d¤_İtiÚ
 = (şick_d¤_İtiÚ *)(
p
->
	`d©a
() +

1404 (
şick_
) +

1405 (
şick_d¤
));

1407 ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_RREQ
) {

1409 
	`şick_ch©‹r
("next_hop called on‡ RREQ?\n");

1410 
IPAdd»ss
 
	`¤c_addr
(0xffffffff);

1411  (
¤c_addr
);

1413 } ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_RREP
) {

1415 cÚ¡ 
şick_d¤_¼•
 *
d¤_¼•
 = (cÚ¡ click_d¤_¼•*)
d¤_İtiÚ
;

1419 ià(
d¤_¼•
->
	`Ëngth
(è=ğ
d¤_Ën
) {

1421 
IPAdd»ss
 
	`d¡_addr
(

->
_d¡
.
s_addr
);

1422  (
d¡_addr
);

1424 
d¤_İtiÚ
 = (
şick_d¤_İtiÚ
 *)(
d¤_¼•
->
	`Ãxt_İtiÚ
());

1426 ià(
d¤_İtiÚ
->
d¤_ty³
 !ğ
DSR_TYPE_SOURCE_ROUTE
) {

1427 
	`şick_ch©‹r
(" * DSRArpTable::last_hop: source„oute option did‚ot follow„oute„eply option\n");

1429 
IPAdd»ss
 
z”os
;

1430  
z”os
;

1434 } ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_RERR
) {

1438 cÚ¡ 
şick_d¤_»¼
 *
d¤_»¼
 = (şick_d¤_»¼ *)
d¤_İtiÚ
;

1440 ià(
d¤_»¼
->
	`Ëngth
(è=ğ
d¤_Ën
) {

1442 
IPAdd»ss
 
	`d¡_addr
(

->
_d¡
.
s_addr
);

1443  (
d¡_addr
);

1445 
d¤_İtiÚ
 = (
şick_d¤_İtiÚ
 *)(
d¤_»¼
->
	`Ãxt_İtiÚ
());

1447 ià(
d¤_İtiÚ
->
d¤_ty³
 !ğ
DSR_TYPE_SOURCE_ROUTE
) {

1448 
	`şick_ch©‹r
(" * source„oute option did‚ot follow„outeƒrror option\n");

1450 
IPAdd»ss
 
z”os
;

1451  
z”os
;

1456 ià(
d¤_İtiÚ
->
d¤_ty³
 =ğ
DSR_TYPE_SOURCE_ROUTE
) {

1460 
şick_d¤_sourû
 *
d¤_sourû
 = (şick_d¤_sourû *)(
d¤_İtiÚ
);

1461 
	`as£¹
(
d¤_sourû
->
d¤_ty³
 =ğ
DSR_TYPE_SOURCE_ROUTE
);

1463 
£gm’ts
 = 
d¤_sourû
->
d¤_£g¦eá
;

1464 
sourû_hİs
 = 
d¤_sourû
->
	`num_addrs
();

1466 
	`as£¹
(
£gm’ts
 <ğ
sourû_hİs
);

1468 
šdex
 = 
sourû_hİs
 - 
£gm’ts
;

1470 ià(
£gm’ts
 == 0) {

1471 
IPAdd»ss
 
	`d¡
(

->
_d¡
.
s_addr
);

1472  
d¡
;

1474  
d¤_sourû
->
addr
[
šdex
-1].
	`
();

1478 
	`as£¹
(0);

1479  
	`IPAdd»ss
();

1480 
	}
}

1485 
IPAdd»ss


1486 
	gDSRRou‹TabË
::
	$Ãxt_¤_hİ
(
Pack‘
 *
p_š
, 
off£t
)

1488 
	`as£¹
(
off£t
 + (
şick_d¤_sourû
è<ğ
p_š
->
	`Ëngth
());

1490 
şick_d¤_sourû
 *
d¤_sourû
 = (şick_d¤_sourû *)(
p_š
->
	`d©a
() +

1491 
off£t
);

1494 
	`as£¹
 (
d¤_sourû
->
d¤_ty³
 =ğ
DSR_TYPE_SOURCE_ROUTE
);

1496 
£gm’ts
 = 
d¤_sourû
->
d¤_£g¦eá
;

1497 
sourû_hİs
 = 
d¤_sourû
->
	`num_addrs
();

1500 
	`as£¹
(
£gm’ts
 <ğ
sourû_hİs
);

1503 
šdex
 = 
sourû_hİs
 - 
£gm’ts
;

1505 ià(
£gm’ts
 == 0) {

1506 cÚ¡ 
şick_
 *

 = 
p_š
->
	`_h—d”
();

1507 
IPAdd»ss
 
	`fš®_d¡
(

->
_d¡
.
s_addr
);

1508  
fš®_d¡
;

1510  
d¤_sourû
->
addr
[
šdex
].
	`
();

1512 
	}
}

1516 
	gDSRRou‹TabË
::
	$fÜw¬d_¤
(
Pack‘
 *
p_š
, 
off£t
, 
pÜt
)

1518 ià(
off£t
 > 
p_š
->
	`Ëngth
()) {

1519 
	`DEBUG_CHATTER
(" * offset…assedo forwardSRPacket isoo big! (%d > %d)\n",

1520 
off£t
, 
p_š
->
	`Ëngth
());

1521 
p_š
->
	`kl
();

1525 
Wr™abËPack‘
 *
p
=
p_š
->
	`uniqueify
();

1527 
şick_d¤_sourû
 *
d¤_sourû
 = (şick_d¤_sourû *)(
p
->
	`d©a
() +

1528 
off£t
);

1530 ià(
d¤_sourû
->
d¤_ty³
 !ğ
DSR_TYPE_SOURCE_ROUTE
) {

1531 
	`DEBUG_CHATTER
(" * source„oute option‚ot found whereƒxpected in forward_sr\n");

1532 
p
->
	`kl
();

1537 
d¤_sourû
->
d¤_£g¦eá
--;

1538 
p
->
	`£t_d¡__ªno
(
	`Ãxt_¤_hİ
Õ, 
off£t
));

1540 
	`DEBUG_CHATTER
("fÜw¬d_¤: fÜw¬dšgØ%s\n", 
	`Ãxt_¤_hİ
(
p
, 
off£t
).
	`uÅ¬£
().
	`c_¡r
());

1542 
	`ouut
(
pÜt
).
	`push
(
p
);

1544 
	}
}

1549 
	gDSRRou‹TabË
::
	$fÜw¬d_¼eq
(
Pack‘
 *
p_š
)

1551 
şick_d¤
 *
Üig_d¤
 = (şick_d¤ *)(
p_š
->
	`d©a
()+

1552 (
şick_
));

1553 
şick_d¤_¼eq
 *
Üig_¼eq
 = (şick_d¤_¼eq *)(
p_š
->
	`d©a
() +

1554 (
şick_
) +

1555 (
şick_d¤
));

1557 
hİ_couÁ
 = 
Üig_¼eq
->
	`num_addrs
();

1559 
	`as£¹
(
	`Áohs
(
Üig_d¤
->
d¤_Ën
è=ğ((
şick_d¤_¼eq
) +

1560 
hİ_couÁ
 * (
DSRHİ
)));

1563 
Wr™abËPack‘
 *
p
=
p_š
->
	`uniqueify
();

1565 
p
 =…->
	`put
((
DSRHİ
));

1567 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
p
->
	`d©a
());

1568 
şick_d¤
 *
d¤
 = (şick_d¤ *)(
p
->
	`d©a
()+

1569 (
şick_
));

1570 
şick_d¤_¼eq
 *
d¤_¼eq
 = (şick_d¤_¼eq *)(
p
->
	`d©a
() +

1571 (
şick_
) +

1572 (
şick_d¤
));

1574 
d¤_¼eq
->
addr
[
hİ_couÁ
].
_
.
s_addr
 = 
me
->
	`addr
();

1576 
Eth”Add»ss
 
Ï¡_‘h
 = 
	`Ï¡_fÜw¬d”_‘h
(
p
);

1577 
d¤_¼eq
->
addr
[
hİ_couÁ
].
_m‘ric
 = 
	`g‘_m‘ric
(
Ï¡_‘h
);

1579 
d¤_¼eq
->
d¤_Ën
 +ğ(
DSRHİ
);

1580 
d¤
->
d¤_Ën
 = 
	`htÚs
(
	`Áohs
(d¤->d¤_Ën)+(
DSRHİ
));

1582 

->
_‰l
--;

1583 

->
_Ën
 = 
	`htÚs
(
p
->
	`Ëngth
());

1584 

->
_sum
 = 0;

1585 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

1587 
p
->
	`£t_d¡__ªno
(0xffffffff);

1589 
	`ouut
(1).
	`push
(
p
);

1590 
	}
}

1594 
	gDSRRou‹TabË
::
	$issue_¼eq
(
IPAdd»ss
 
d¡
, 
‰l
, 
boŞ
 
uniÿ¡
)

1600 
·ylßd
 = ((
şick_
)+

1601 (
şick_d¤
)+

1602 (
şick_d¤_¼eq
));

1603 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
·ylßd
);

1606 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
p
->
	`d©a
());

1607 
şick_d¤
 *
d¤
 = (şick_d¤*)(
p
->
	`d©a
(è+ (
şick_
));

1608 
şick_d¤_¼eq
 *
d¤_¼eq
 = (şick_d¤_¼eq*)(
p
->
	`d©a
() +

1609 (
şick_
) +

1610 (
şick_d¤
));

1612 

->
_v
 = 4;

1613 

->
_hl
 = (
şick_
) >> 2;

1614 

->
_Ën
 = 
	`htÚs
(
p
->
	`Ëngth
());

1615 

->
_id
 = 
	`htÚs
(
_¼eq_id
);

1616 

->
_p
 = 
IP_PROTO_DSR
;

1617 

->
_¤c
.
s_addr
 = 
me
->
	`addr
();

1618 ià(
uniÿ¡
)

1619 

->
_d¡
.
s_addr
 = 
d¡
.
	`addr
();

1621 

->
_d¡
.
s_addr
 = 0xffffffff;

1622 

->
_tos
 = 0;

1623 

->
_off
 = 0;

1624 

->
_‰l
 = 
‰l
;

1625 

->
_sum
 = 0;

1626 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

1628 
d¤
->
d¤_Ãxt_h—d”
 = 0;

1629 
d¤
->
d¤_Ën
 = 
	`htÚs
((
şick_d¤_¼eq
));

1630 
d¤
->
d¤_»£rved
 = 0;

1631 
d¤_¼eq
->
d¤_ty³
 = 
DSR_TYPE_RREQ
;

1632 
d¤_¼eq
->
d¤_Ën
 = 6;

1633 
d¤_¼eq
->
d¤_id
 = 
	`htÚs
(
_¼eq_id
);

1634 
d¤_¼eq
->
rg‘
.
s_addr
 = 
d¡
.
	`addr
();

1636 
p
->
	`£t_d¡__ªno
(

->
_d¡
.
s_addr
);

1638 
_¼eq_id
++;

1640 
	`ouut
(1).
	`push
(
p
);

1641 
	}
}

1645 
	gDSRRou‹TabË
::
	$¡¬t_issušg_»que¡
(
IPAdd»ss
 
ho¡
)

1648 
In™Ÿ‹dReq
 *
r
 = 
_š™Ÿ‹d_¼eq_m­
.
	`fšdp
(
ho¡
);

1650 ià(
r
) {

1651 
	`DEBUG_CHATTER
(" * s¹_issušg_»que¡:‡Ì—dy issušg„eque¡ fÜ %s\n", 
ho¡
.
	`uÅ¬£
().
	`c_¡r
());

1655 
In™Ÿ‹dReq
 
	`Ãw_¼eq
(
ho¡
);

1656 
_š™Ÿ‹d_¼eq_m­
.
	`š£¹
(
ho¡
, 
Ãw_¼eq
);

1657 
	`issue_¼eq
(
ho¡
, 
DSR_RREQ_TTL1
, 
çl£
);

1660 
	}
}

1664 
	gDSRRou‹TabË
::
	$¡İ_issušg_»que¡
(
IPAdd»ss
 
ho¡
)

1666 
In™Ÿ‹dReq
 *
r
 = 
_š™Ÿ‹d_¼eq_m­
.
	`fšdp
(
ho¡
);

1667 ià(!
r
) {

1668 
	`DEBUG_CHATTER
(" * stİ_issušg_»que¡:‚Ø’Œy iÀ»que¡abË fÜ %s\n", 
ho¡
.
	`uÅ¬£
().
	`c_¡r
());

1671 
_š™Ÿ‹d_¼eq_m­
.
	`»move
(
ho¡
);

1674 
	}
}

1676 
	gDSRRou‹TabË
::
	$¡©ic_¼eq_issue_hook
(
Tim”
 *, *
v
)

1678 
DSRRou‹TabË
 *
r
 = (DSRRou‹TabË *)
v
;

1679 
r
->
	`¼eq_issue_hook
();

1680 
	}
}

1682 
	gDSRRou‹TabË
::
	$¼eq_issue_hook
()

1686 
Time¡amp
 
cu¼_time
 = Time¡amp::
	`now
();

1690 
VeùÜ
<
IPAdd»ss
> 
»move_li¡
;

1692 
In™ReqI‹r
 
i
 = 
_š™Ÿ‹d_¼eq_m­
.
	`begš
(); i.
	`live
(); i++) {

1694 
In™Ÿ‹dReq
 &
œ
 = 
i
.
	`v®ue
();

1695 
	`as£¹
(
œ
.
_rg‘
 =ğ
i
.
	`key
());

1699 
_lšk_bË
->
	`dijk¡¿
(
çl£
);

1700 
VeùÜ
<
IPAdd»ss
> 
rou‹
 = 
_lšk_bË
->
	`be¡_rou‹
(
œ
.
_rg‘
,
çl£
);

1701 ià(
rou‹
.
	`size
() > 1) {

1702 
»move_li¡
.
	`push_back
(
œ
.
_rg‘
);

1705 ià(
	`diff_š_ms
(
cu¼_time
, 
œ
.
_time_Ï¡_issued
è> ir.
_backoff_š‹rv®
) {

1707 
	`DEBUG_CHATTER
("timtØissuÃw„eque¡ fÜ ho¡ %s\n", 
œ
.
_rg‘
.
	`uÅ¬£
().
	`c_¡r
());

1709 ià(
œ
.
_times_issued
 == 1) {

1711 
œ
.
_backoff_š‹rv®
 = 
DSR_RREQ_DELAY2
;

1713 
œ
.
_backoff_š‹rv®
 *ğ
DSR_RREQ_BACKOFF_FACTOR
;

1716 ià(
œ
.
_backoff_š‹rv®
 > 
DSR_RREQ_MAX_DELAY
)

1717 
œ
.
_backoff_š‹rv®
 = 
DSR_RREQ_MAX_DELAY
;

1719 
œ
.
_times_issued
++;

1720 
œ
.
_time_Ï¡_issued
 = 
cu¼_time
;

1721 
œ
.
_‰l
 = 
DSR_RREQ_TTL2
;

1723 
	`issue_¼eq
(
œ
.
_rg‘
, ir.
_‰l
, 
çl£
);

1728 
j
 = 0 ; j < 
»move_li¡
.
	`size
() ; j++) {

1729 
_š™Ÿ‹d_¼eq_m­
.
	`»move
(
»move_li¡
[
j
]);

1732 
_¼eq_issue_tim”
.
	`scheduË_aá”_m£c
(
DSR_RREQ_ISSUE_TIMER_INTERVAL
);

1734 
	`check
();

1735 
	}
}

1740 
DSRRou‹


1741 
	gDSRRou‹TabË
::
	$»v”£_rou‹
(
DSRRou‹
 
r
)

1743 
DSRRou‹
 
»v
;

1744 
i
=
r
.
	`size
()-1; i>=0; i--) {

1745 
»v
.
	`push_back
(
r
[
i
]);

1747  
»v
;

1748 
	}
}

1750 
DSRRou‹


1751 
	gDSRRou‹TabË
::
	$Œunÿ‹_rou‹
(
DSRRou‹
 
r
, 
IPAdd»ss
 

)

1753 
DSRRou‹
 
t
;

1754 
i
=0; i < 
r
.
	`size
(); i++) {

1755 
t
.
	`push_back
(
r
[
i
]);

1756 ià(
r
[
i
].
	`
(è=ğ

) {

1757  
t
;

1760  
	`DSRRou‹
();

1761 
	}
}

1764 
	gDSRRou‹TabË
::
	$rou‹_šdex_of
(
DSRRou‹
 
r
, 
IPAdd»ss
 

)

1766 
i
=0; i<
r
.
	`size
(); i++) {

1767 ià(
r
[
i
].
	`
(è=ğ

)

1768  
i
;

1771 
	}
}

1774 
	gDSRRou‹TabË
::
	$add_rou‹_to_lšk_bË
(
DSRRou‹
 
rou‹
)

1776 
i
=0; i < 
rou‹
.
	`size
() - 1; i++) {

1777 
IPAdd»ss
 
1
 = 
rou‹
[
i
].
	`
();

1778 
IPAdd»ss
 
2
 = 
rou‹
[
i
+1].
	`
();

1781 
m‘ric
 = 
rou‹
[
i
+1].
_m‘ric
;

1782 ià(
m‘ric
 =ğ
DSR_INVALID_HOP_METRIC
)

1783 
_lšk_bË
->
	`upd©e_bÙh_lšks
(
1
, 
2
, 0, 0, 9999);

1785 
_lšk_bË
->
	`upd©e_bÙh_lšks
(
1
, 
2
, 0, 0, 
m‘ric
);

1790 
	}
}

1793 
	gDSRRou‹TabË
::
	$check_bÏckli¡
(
IPAdd»ss
 

)

1795 ià(!
_u£_bÏckli¡
è 
DSR_BLACKLIST_NOENTRY
;

1797 
BÏckli¡EÁry
 *
e
 = 
_bÏckli¡
.
	`fšdp
(

);

1798 ià(! 
e
) {

1799  
DSR_BLACKLIST_NOENTRY
;

1801  
e
->
_¡©us
;

1803 
	}
}

1806 
	gDSRRou‹TabË
::
	$£t_bÏckli¡
(
IPAdd»ss
 

, 
s
)

1811 
_bÏckli¡
.
	`»move
(

);

1812 ià(
s
 !ğ
DSR_BLACKLIST_NOENTRY
) {

1813 
BÏckli¡EÁry
 
e
;

1814 
e
.
_time_upd©ed
.
	`assign_now
();

1815 
e
.
_¡©us
 = 
s
;

1816 
_bÏckli¡
.
	`š£¹
(

, 
e
);

1820 
	}
}

1823 
	gDSRRou‹TabË
::
	$diff_š_ms
(cÚ¡ 
Time¡amp
 &
t1
, cÚ¡ Time¡am°&
t2
)

1825 
Time¡amp
 
diff
 = 
t1
 - 
t2
;

1826 
	`as£¹
(
diff
.
	`£c
(è< (
Time¡amp
::
£cÚds_ty³
) ((1 << 31) / 1000));

1827  
diff
.
	`m£cv®
();

1828 
	}
}

1833 
	gDSRRou‹TabË
::
	$g‘_m‘ric
(
Eth”Add»ss
 
Ùh”
)

1836 
dá
 = 
DSR_INVALID_HOP_METRIC
;

1837 ià(
_ls
){

1838 
u
;

1839 
Time¡amp
 
tv
;

1840 
ä©e
, 
¼©e
;

1841 
boŞ
 
»s
 = 
_ls
->
	`g‘_fÜw¬d_¿‹
(
Ùh”
, &
ä©e
, &
u
, &
tv
);

1842 if(
»s
 =ğ
çl£
) {

1843  
dá
;

1845 
»s
 = 
_ls
->
	`g‘_»v”£_¿‹
(
Ùh”
, &
¼©e
, &
u
);

1846 ià(
»s
 =ğ
çl£
) {

1847  
dá
;

1849 ià(
ä©e
 =ğ0 || 
¼©e
 == 0) {

1850  
dá
;

1855 
u_shÜt
 
m
 = 10 * 100 * 100 / (
ä©e
 * (è
¼©e
);

1857 ià(
m
 > 
DSR_INVALID_HOP_METRIC
) {

1858 
	`şick_ch©‹r
("DSRRouteTable::get_metric: metricoo big for one byte?\n");

1859  
DSR_INVALID_HOP_METRIC
;

1862  ()
m
;

1865 ià(
_m‘ric
) {

1866 
GridG’”icM‘ric
::
m‘ric_t
 
m
 = 
_m‘ric
->
	`g‘_lšk_m‘ric
(
Ùh”
, 
çl£
);

1867 
c
 = 
_m‘ric
->
	`sÿË_to_ch¬
(
m
);

1868 ià(!
m
.
	`good
(è|| 
c
 >ğ
DSR_INVALID_HOP_METRIC
)

1869  
DSR_INVALID_HOP_METRIC
;

1870  
c
;

1876 
	}
}

1878 
boŞ


1879 
	gDSRRou‹TabË
::
	$m‘ric_´eã¿bË
(
a
, 
b
)

1881 ià(!
_m‘ric
)

1882  (
a
 < 
b
);

1883 ià(
a
 =ğ
DSR_INVALID_ROUTE_METRIC
 || 
b
 == DSR_INVALID_ROUTE_METRIC)

1884  
a
;

1886  
_m‘ric
->
	`m‘ric_v®_É
(_m‘ric->
	`unsÿË_äom_ch¬
(
a
),

1887 
_m‘ric
->
	`unsÿË_äom_ch¬
(
b
));

1888 
	}
}

1891 
	gDSRRou‹TabË
::
	$rou‹_m‘ric
(
DSRRou‹
 
r
)

1894 
»t
 = 0;

1897 
i
 = 1; i < 
r
.
	`size
(); i++) {

1898 ià(
r
[
i
].
_m‘ric
 =ğ
DSR_INVALID_HOP_METRIC
)

1899  
DSR_INVALID_ROUTE_METRIC
;

1900 
»t
 +ğ
r
[
i
].
_m‘ric
;

1902  
»t
;

1905 ià(
r
.
	`size
() < 2) {

1906 
	`şick_ch©‹r
("DSRRouteTable::route_metric:„oute isoo short,†esshanwo‚odes?\n");

1907  
DSR_INVALID_ROUTE_METRIC
;

1909 ià(!
_m‘ric
)

1910  
r
.
	`size
();

1912 ià(
r
[1].
_m‘ric
 =ğ
DSR_INVALID_HOP_METRIC
)

1913  
DSR_INVALID_ROUTE_METRIC
;

1914 
GridG’”icM‘ric
::
m‘ric_t
 
	`m
(
_m‘ric
->
	`unsÿË_äom_ch¬
(
r
[1]._metric));

1916 
i
 = 2; i < 
r
.
	`size
(); i++) {

1917 ià(
r
[
i
].
_m‘ric
 =ğ
DSR_INVALID_HOP_METRIC
)

1918  
DSR_INVALID_ROUTE_METRIC
;

1919 
m
 = 
_m‘ric
->
	`­³nd_m‘ric
(m, _m‘ric->
	`unsÿË_äom_ch¬
(
r
[
i
]._metric));

1921 ià(
m
.
	`good
())

1922  
_m‘ric
->
	`sÿË_to_ch¬
(
m
);

1924  
DSR_INVALID_ROUTE_METRIC
;

1925 
	}
}

1927 
Eth”Add»ss


1928 
	gDSRRou‹TabË
::
	$Ï¡_fÜw¬d”_‘h
(
Pack‘
 *
p
)

1930 
ušt16_t
 
d
[3];

1931 
d
[0] = 
	`DSR_LAST_HOP_ETH_ANNO1
(
p
);

1932 
d
[1] = 
	`DSR_LAST_HOP_ETH_ANNO2
(
p
);

1933 
d
[2] = 
	`DSR_LAST_HOP_ETH_ANNO3
(
p
);

1935  (
	`Eth”Add»ss
((*)
d
));

1936 
	}
}

1938 
	$ELEMENT_REQUIRES
(
LškTabË
)

1939 
	$EXPORT_ELEMENT
(
DSRRou‹TabË
)

1940 
CLICK_ENDDECLS


	@grid/dsrroutetable.hh

1 #iâdeà
DSRROUTETABLE_HH


2 
	#DSRROUTETABLE_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<şick/add»ss.hh
>

7 
	~<şick/tim”.hh
>

8 
	~<şick/hashm­.hh
>

9 
	~<as£¹.h
>

10 
	~<şick/bighashm­.hh
>

12 
	~<–em’ts/wifi/lškbË.hh
>

13 
	~<–em’ts/¡ªd¬d/sim¶equeue.hh
>

15 
	~"d¤.hh
"

17 
CLICK_DECLS


18 
şass
 
	gLškTabË
;

80 
şass
 
	gGridG’”icM‘ric
;

82 şas 
	cDSRRou‹TabË
 : 
public
 
EËm’t


84 
public
:

87 şas 
	cBufã»dPack‘


89 
public
:

90 
Pack‘
 *
_p
;

91 
Time¡amp
 
	m_time_added
;

93 
Bufã»dPack‘
(
Pack‘
 *
p
) {

94 
as£¹
(
p
);

95 
	m_p
=
p
;

96 
	m_time_added
.
assign_now
();

98 
check
(ècÚ¡ { 
as£¹
(
_p
); }

101 
	#DSR_SENDBUFFER_MAX_LENGTH
 5

102 
	#DSR_SENDBUFFER_MAX_BURST
 5

103 
	#DSR_SENDBUFFER_TIMEOUT
 5000

104 
	#DSR_SENDBUFFER_TIMER_INTERVAL
 1000

105 

	)

106 
	gVeùÜ
<
	tBufã»dPack‘
> 
	tS’dBufãr
;

107 
	gHashM­
<
	tIPAdd»ss
, 
	tS’dBufãr
> 
	tSBM­
;

108 
	gSBM­
::
	t™”©Ü
 
	tSBM­I‹r
;

114 şas 
	cFÜw¬dedReqKey


116 
	gpublic
:

117 
IPAdd»ss
 
_¤c
;

118 
IPAdd»ss
 
	g_rg‘
;

119 
	g_id
;

121 
FÜw¬dedReqKey
(
IPAdd»ss
 
¤c
, IPAdd»s 
rg‘
, 
id
) {

122 
	g_¤c
 = 
¤c
; 
	g_rg‘
 = 
rg‘
; 
	g_id
 = 
id
;

123 
check
();

125 
FÜw¬dedReqKey
() {

128 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
FÜw¬dedReqKey
 &
f1
) {

129 
check
();

130 
	gf1
.
check
();

131  ((
	g_¤c
 =ğ
f1
.
_¤c
) &&

132 (
_rg‘
 =ğ
f1
._target) &&

133 (
_id
 =ğ
f1
._id));

135 
šlše
 
size_t
 
hashcode
() const;

136 
check
() const {

137 
as£¹
(
_¤c
);

138 
as£¹
(
_rg‘
);

139 
as£¹
(
_¤c
 !ğ
_rg‘
);

143 şas 
	cFÜw¬dedReqV®
 {

144 
	gpublic
:

145 
Time¡amp
 
_time_fÜw¬ded
;

147 
	gbe¡_m‘ric
;

151 
Time¡amp
 
	g_time_unid‹¡_issued
;

152 
Pack‘
 *
	gp
;

154 
check
() const {

155 
as£¹
(
_time_fÜw¬ded
 > 0);

156 
as£¹
(
be¡_m‘ric
 > 0);

160 
	#DSR_RREQ_TIMEOUT
 600000

161 
	#DSR_RREQ_EXPIRE_TIMER_INTERVAL
 15000

162 

	)

163 
	gHashM­
<
	tFÜw¬dedReqKey
, 
	tFÜw¬dedReqV®
> 
	tFÜw¬dedReqM­
;

164 
	gFÜw¬dedReqM­
::
	t™”©Ü
 
	tFWReqI‹r
;

175 
	#DSR_BLACKLIST_NOENTRY
 1

	)

176 
	#DSR_BLACKLIST_UNI_PROBABLE
 2

	)

177 
	#DSR_BLACKLIST_UNI_QUESTIONABLE
 3

	)

178 
	#DSR_BLACKLIST_UNITEST_TIMEOUT
 1000

179 
	#DSR_BLACKLIST_TIMER_INTERVAL
 300

180 
	#DSR_BLACKLIST_ENTRY_TIMEOUT
 45000

181 

	)

182 şas 
	cBÏckli¡EÁry
 {

183 
	gpublic
:

184 
Time¡amp
 
_time_upd©ed
;

185 
	g_¡©us
;

187 
check
() const {

188 
as£¹
(
_time_upd©ed
 > 0);

189 
	g_¡©us
) {

190 
	gDSR_BLACKLIST_NOENTRY
:

191 
DSR_BLACKLIST_UNI_PROBABLE
:

192 
DSR_BLACKLIST_UNI_QUESTIONABLE
:

195 
as£¹
(0);

199 
	gHashM­
<
	tIPAdd»ss
, 
	tBÏckli¡EÁry
> 
	tBÏckli¡
;

200 
	gBÏckli¡
::
	t™”©Ü
 
	tBÏckli¡I‹r
;

207 şas 
	cIn™Ÿ‹dReq


209 
	gpublic
:

211 
IPAdd»ss
 
_rg‘
;

212 
	g_‰l
;

213 
Time¡amp
 
	g_time_Ï¡_issued
;

217 
	g_times_issued
;

220 
	g_backoff_š‹rv®
;

226 
	#DSR_RREQ_TTL1
 255

227 
	#DSR_RREQ_TTL2
 255

	)

228 
	#DSR_RREQ_DELAY1
 500

229 
	#DSR_RREQ_DELAY2
 500

230 
	#DSR_RREQ_BACKOFF_FACTOR
 2

	)

231 
	#DSR_RREQ_MAX_DELAY
 5000

232 

	)

233 
	#DSR_RREQ_ISSUE_TIMER_INTERVAL
 300

234 

	)

235 
In™Ÿ‹dReq
(
IPAdd»ss
 
rg
) {

236 
	g_rg‘
 = 
rg
;

237 
	g_‰l
 = 
DSR_RREQ_TTL1
;

238 
	g_times_issued
 = 1;

239 
	g_backoff_š‹rv®
 = 
DSR_RREQ_DELAY1
;

241 
	g_time_Ï¡_issued
.
assign_now
();

243 
check
();

245 
In™Ÿ‹dReq
() {

248 
check
() const {

249 
as£¹
(
_rg‘
);

250 
as£¹
(
_‰l
 > 0);

251 
as£¹
(
_time_Ï¡_issued
 > 0);

252 
as£¹
(
_times_issued
 > 0);

253 
as£¹
(
_backoff_š‹rv®
 > 0);

257 
	gHashM­
<
	tIPAdd»ss
, 
	tIn™Ÿ‹dReq
> 
	tIn™Ÿ‹dReqM­
;

258 
	gIn™Ÿ‹dReqM­
::
	t™”©Ü
 
	tIn™ReqI‹r
;

259 
	gHashM­
<
	tIPAdd»ss
, 
	tPack‘
 *> 
	tReque¡sToFÜw¬d
;

261 
	gpublic
:

263 
	$DSRRou‹TabË
(è
CLICK_COLD
;

264 ~
	$DSRRou‹TabË
(è
CLICK_COLD
;

266 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "DSRRou‹TabË"; 
	}
}

267 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "3/3"; 
	}
}

268 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

270 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

272 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

273 
	`unš™Ÿlize
();

275 
	`push
(, 
Pack‘
 *);

277 
	`¡©ic_¼eq_expœe_hook
(
Tim”
 *, *);

278 
	`¼eq_expœe_hook
();

280 
	`¡©ic_¼eq_issue_hook
(
Tim”
 *, *);

281 
	`¼eq_issue_hook
();

283 
	`¡©ic_£ndbufãr_tim”_hook
(
Tim”
 *, *);

284 
	`£ndbufãr_tim”_hook
();

286 
	`¡©ic_bÏckli¡_tim”_hook
(
Tim”
 *, *);

287 
	`bÏckli¡_tim”_hook
();

289 
	`check
();

291 
DSRRou‹
 
	`exŒaù_»que¡_rou‹
(cÚ¡ 
Pack‘
 *);

292 
DSRRou‹
 
	`exŒaù_»¶y_rou‹
(cÚ¡ 
Pack‘
 *);

293 
DSRRou‹
 
	`exŒaù_sourû_rou‹
(cÚ¡ 
Pack‘
 *, );

295 
DSRRou‹
 
	`»v”£_rou‹
(DSRRou‹ 
rou‹
);

296 
	`rou‹_šdex_of
(
DSRRou‹
 
r
, 
IPAdd»ss
 

);

297 
DSRRou‹
 
	`Œunÿ‹_rou‹
(DSRRou‹ 
r
, 
IPAdd»ss
 

);

299 
	slšk_f‹r
 {

300 cÚ¡ 
IPAdd»ss
 
_a
;

301 cÚ¡ 
IPAdd»ss
 
_b
;

302 
	`lšk_f‹r
(
IPAdd»ss
 
a
, IPAdd»s 
b
è: 
	`_a
×), 
	`_b
(b) { }

303 
boŞ
 
	`İ”©Ü
()(cÚ¡ 
Pack‘
 *
p
) {

309 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

310 cÚ¡ 
şick_
 *

 = 
p
->
	`_h—d”
();

312 ià(

->
_p
 !ğ
IP_PROTO_DSR
)

313  
çl£
;

315 cÚ¡ 
şick_d¤
 *
d¤
 = (cÚ¡ click_d¤ *)(
p
->
	`d©a
(è+ (
şick_
));

316 
d¤_Ën
 = 
	`Áohs
(
d¤
->dsr_len);

318 *
’d
 = (*)((*)
d¤
 + 
d¤_Ën
);

320 cÚ¡ 
şick_d¤_İtiÚ
 *
İ
 = (cÚ¡ click_d¤_İtiÚ *)((*)
d¤
 + (
şick_d¤
));

322 (*)
İ
 < 
’d
) {

325 ià(
İ
->
d¤_ty³
 =ğ
DSR_TYPE_RREP
) {

326 cÚ¡ 
şick_d¤_¼•
 *
¼•
 = (cÚ¡ click_d¤_¼• *)
İ
;

327 
İ
 = (cÚ¡ 
şick_d¤_İtiÚ
 *)(
¼•
->
	`Ãxt_İtiÚ
());

328 } ià(
İ
->
d¤_ty³
 =ğ
DSR_TYPE_RREQ
) {

329 cÚ¡ 
şick_d¤_¼eq
 *
¼eq
 = (cÚ¡ click_d¤_¼eq *)
İ
;

330 
İ
 = (cÚ¡ 
şick_d¤_İtiÚ
 *)(
¼eq
->
	`Ãxt_İtiÚ
());

331 } ià(
İ
->
d¤_ty³
 =ğ
DSR_TYPE_RERR
) {

332 cÚ¡ 
şick_d¤_»¼
 *
»¼
 = (cÚ¡ click_d¤_»¼ *)
İ
;

333 
İ
 = (cÚ¡ 
şick_d¤_İtiÚ
 *)(
»¼
->
	`Ãxt_İtiÚ
());

334 } ià(
İ
->
d¤_ty³
 =ğ
DSR_TYPE_SOURCE_ROUTE
) {

335 
off£t
 = (*)
İ
 - 
p
->
	`d©a
();

336 
DSRRou‹
 
r
 = 
	`exŒaù_sourû_rou‹
(
p
, 
off£t
);

338 
	`şick_ch©‹r
("link_filter:…acket has source„oute:\n");

339 
i
=0; i<
r
.
	`size
(); i++)

340 
	`şick_ch©‹r
(" - %d %s (%d)\n",

341 
i
,

342 
r
[
i
].
	`
().
	`uÅ¬£
().
	`c_¡r
(),

343 
r
[
i
].
_m‘ric
);

345 
i1
 = 
	`rou‹_šdex_of
(
r
, 
_a
);

346 ià(
i1
 =ğ-1è 
çl£
;

348 
i2
 = 
	`rou‹_šdex_of
(
r
, 
_b
);

349 ià(
i2
 =ğ-1è 
çl£
;

351 
	`şick_ch©‹r
("link_filter: src/dst is %s/%s (%d/%d)\n",

352 
_a
.
	`uÅ¬£
().
	`c_¡r
(), 
_b
.uÅ¬£().c_¡r(), 
i1
, 
i2
);

358 ià(
	`abs
(
i1
 - 
i2
) == 1) {

359 
	`şick_ch©‹r
("link_filter:rue\n");

360  
Œue
;

362 
	`şick_ch©‹r
("link_filter: false\n");

363  
çl£
;

369  
çl£
;

371 
	}
};

374 
	g´iv©e
:

376 
IPAdd»ss
 *
me
;

378 
LškTabË
 *
	g_lšk_bË
;

380 
SBM­
 
	g_£ndbufãr_m­
;

381 
FÜw¬dedReqM­
 
	g_fÜw¬ded_¼eq_m­
;

382 
In™Ÿ‹dReqM­
 
	g_š™Ÿ‹d_¼eq_m­
;

384 
BÏckli¡
 
	g_bÏckli¡
;

385 
Reque¡sToFÜw¬d
 
	g_¼eqs_to_fow¬d
;

387 
Tim”
 
	g_¼eq_expœe_tim”
;

388 
Tim”
 
	g_¼eq_issue_tim”
;

389 
Tim”
 
	g_£ndbufãr_tim”
;

390 
boŞ
 
	g_£ndbufãr_check_rou‹s
;

391 
Tim”
 
	g_bÏckli¡_tim”
;

393 
u_št16_t
 
	g_¼eq_id
;

395 
Sim¶eQueue
 *
	g_outq
;

396 
GridG’”icM‘ric
 *
	g_m‘ric
;

397 
boŞ
 
	g_u£_bÏckli¡
;

399 
Pack‘
 *
add_d¤_h—d”
(Pack‘ *, cÚ¡ 
VeùÜ
<
IPAdd»ss
> &);

400 
Pack‘
 *
¡r_h—d”s
(Packet *);

402 
¡¬t_issušg_»que¡
(
IPAdd»ss
 
ho¡
);

403 
¡İ_issušg_»que¡
(
IPAdd»ss
 
ho¡
);

405 
issue_¼eq
(
IPAdd»ss
 
d¡
, 
‰l
, 
boŞ
 
uniÿ¡
);

406 
issue_¼•
(
IPAdd»ss
 
¤c
, IPAdd»s 
d¡
,

407 
DSRRou‹
 
»¶y_rou‹
,

408 
DSRRou‹
 
sourû_rou‹
);

410 
issue_»¼
(
IPAdd»ss
 
bad_¤c
, IPAdd»s 
bad_d¡
,

411 
IPAdd»ss
 
¤c
,

412 
DSRRou‹
 
sourû_rou‹
);

414 
fÜw¬d_¼eq
(
Pack‘
 *);

415 
fÜw¬d_¼•
(
Pack‘
 *);

416 
fÜw¬d_»¼
(
Pack‘
 *);

417 
fÜw¬d_d©a
(
Pack‘
 *);

418 
IPAdd»ss
 
Ãxt_¤_hİ
(
Pack‘
 *, );

419 
fÜw¬d_¤
(
Pack‘
 *, , );

421 
add_rou‹_to_lšk_bË
(
DSRRou‹
 
rou‹
);

423 
bufãr_·ck‘
(
Pack‘
 *
p
);

425 
check_bÏckli¡
(
IPAdd»ss
 

);

426 
£t_bÏckli¡
(
IPAdd»ss
 

, 
s
);

428 
diff_š_ms
(cÚ¡ 
Time¡amp
 &, const Timestamp &);

430 
IPAdd»ss
 
Ãxt_hİ
(
Pack‘
 *
p
);

432 
g‘_m‘ric
(
Eth”Add»ss
);

433 
rou‹_m‘ric
(
DSRRou‹
 
r
);

434 
boŞ
 
m‘ric_´eã¿bË
(
a
, 
b
);

436 
æush_£ndbufãr
();

438 
Eth”Add»ss
 
Ï¡_fÜw¬d”_‘h
(
Pack‘
 *);

439 
boŞ
 
	g_debug
;

442 
šlše
 
size_t
 
	gDSRRou‹TabË
::
FÜw¬dedReqKey
::
	$hashcode
() const {

444 ((
_¤c
.
	`addr
() << 16) + (_src.addr() >> 16)) ^

445 
_rg‘
.
	`addr
() ^

446 
_id
));

447 
	}
}

449 
	gCLICK_ENDDECLS


	@grid/e2elossmetric.cc

16 
	~<şick/cÚfig.h
>

17 
	~<şick/¬gs.hh
>

18 
	~<şick/”rÜ.hh
>

19 
	~"–em’ts/grid/e2–ossm‘ric.hh
"

20 
	~"–em’ts/grid/lšk¡©.hh
"

21 
CLICK_DECLS


23 
	gE2ELossM‘ric
::
	$E2ELossM‘ric
()

24 : 
	`_ls
(0), 
	$_twoway
(
çl£
)

26 
	}
}

28 
	gE2ELossM‘ric
::~
	$E2ELossM‘ric
()

30 
	}
}

33 
E2ELossM‘ric
::
	$ÿ¡
(cÚ¡ *
n
)

35 ià(
	`¡rcmp
(
n
, "E2ELossMetric") == 0)

36  (
E2ELossM‘ric
 *è
this
;

37 ià(
	`¡rcmp
(
n
, "GridGenericMetric") == 0)

38  (
GridG’”icM‘ric
 *è
this
;

41 
	}
}

44 
	gE2ELossM‘ric
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

46 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

47 .
»ad_mp
("LINKSTAT", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_ls
))

48 .
»ad
("TWOWAY", 
_twoway
)

49 .
com¶‘e
();

50 ià(
	g»s
 < 0)

51  
	g»s
;

52 ià(
	g_ls
 == 0)

53 
”rh
->
”rÜ
("no LinkStatƒlement specified");

54 ià(
	g_ls
->
ÿ¡
("LinkStat") == 0)

55  
”rh
->
”rÜ
("LinkStat‡rgument is wrongƒlementype (should be LinkStat)");

60 
boŞ


61 
	gE2ELossM‘ric
::
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &
m1
, cÚ¡ m‘ric_ˆ&
m2
) const

63  
m1
.
	`v®
(è> 
m2
.val();

64 
	}
}

66 
	gGridG’”icM‘ric
::
m‘ric_t


67 
E2ELossM‘ric
::
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &
e
, 
boŞ
 
d©a_£nd”
) const

69 
u_fwd
, 
u_»v
;

70 
r_fwd
, 
r_»v
;

71 
Time¡amp
 
t_fwd
;

73 
boŞ
 
»s_fwd
 = 
_ls
->
	`g‘_fÜw¬d_¿‹
(
e
, &
r_fwd
, &
u_fwd
, &
t_fwd
);

74 
boŞ
 
»s_»v
 = 
_ls
->
	`g‘_»v”£_¿‹
(
e
, &
r_»v
, &
u_»v
);

82 ià(!
d©a_£nd”
) {

83 
	`grid_sw­
(
»s_fwd
, 
»s_»v
);

84 
	`grid_sw­
(
r_fwd
, 
r_»v
);

87 ià(!
»s_fwd
 || (
_twoway
 && !
»s_»v
))

88  
_bad_m‘ric
;

90 ià(
r_fwd
 > 100)

91 
r_fwd
 = 100;

92 ià(
_twoway
 && 
r_»v
 > 100)

93 
r_»v
 = 100;

95 
v®
 = 
r_fwd
;

96 ià(
_twoway
)

97 
v®
 = v® * 
r_»v
 / 100;

99 
	`as£¹
(
v®
 <= 100);

101  
	`m‘ric_t
(
v®
);

102 
	}
}

104 
	gGridG’”icM‘ric
::
m‘ric_t


105 
E2ELossM‘ric
::
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

107 ià(!
r
.
	`good
(è|| !
l
.good())

108  
_bad_m‘ric
;

110 ià(
r
.
	`v®
() > 100)

111 
	`şick_ch©‹r
("E2ELossMetric %s:‡ppend_metric WARNING: metric %u%%ransmissions isoo†arge for„oute metric",

112 
	`Çme
().
	`c_¡r
(), 
r
.
	`v®
());

113 ià(
l
.
	`v®
() > 100)

114 
	`şick_ch©‹r
("E2ELossMetric %s:‡ppend_metric WARNING: metric %u%%ransmissions isoo†arge for†ink metric",

115 
	`Çme
().
	`c_¡r
(), 
r
.
	`v®
());

117  
	`m‘ric_t
(
r
.
	`v®
(è* 
l
.val() / 100);

118 
	}
}

121 
	$ELEMENT_PROVIDES
(
GridG’”icM‘ric
)

122 
	$EXPORT_ELEMENT
(
E2ELossM‘ric
)

124 
CLICK_ENDDECLS


	@grid/e2elossmetric.hh

1 #iâdeà
E2EMETRIC_HH


2 
	#E2EMETRIC_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"gridg’”icm‘ric.hh
"

5 
CLICK_DECLS


37 
şass
 
	gLškSt
;

39 şas 
	cE2ELossM‘ric
 : 
public
 
GridG’”icM‘ric
 {

41 
public
:

43 
E2ELossM‘ric
();

44 ~
E2ELossM‘ric
();

46 cÚ¡ *
	$şass_Çme
() const {  "E2ELossMetric"; }

47 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_0
; 
	}
}

48 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

50 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

51 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
çl£
; 
	}
}

53 *
ÿ¡
(const *);

56 
boŞ
 
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

57 
m‘ric_t
 
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &, 
boŞ
) const;

58 
m‘ric_t
 
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

59 
m‘ric_t
 
	$´•’d_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

60 {  
	`­³nd_m‘ric
(
r
, 
l
); 
	}
}

62 
	$sÿË_to_ch¬
(cÚ¡ 
m‘ric_t
 &
m
ècÚ¡ {  (èm.
	`v®
(); 
	}
}

63 
m‘ric_t
 
	$unsÿË_äom_ch¬
(
c
ècÚ¡ {  
	`m‘ric_t
(c); 
	}
}

65 
	g´iv©e
:

66 
LškSt
 *
_ls
;

67 
boŞ
 
	g_twoway
;

70 
	gCLICK_ENDDECLS


	@grid/etx2metric.cc

16 
	~<şick/cÚfig.h
>

17 
	~<şick/¬gs.hh
>

18 
	~<şick/”rÜ.hh
>

19 
	~"–em’ts/grid/‘x2m‘ric.hh
"

20 
	~"–em’ts/grid/lšk¡©.hh
"

21 
CLICK_DECLS


23 
	gETX2M‘ric
::
	$ETX2M‘ric
()

24 : 
	`_ls_d©a
(0), 
	$_ls_ack
(0)

26 
	}
}

28 
	gETX2M‘ric
::~
	$ETX2M‘ric
()

30 
	}
}

33 
ETX2M‘ric
::
	$ÿ¡
(cÚ¡ *
n
)

35 ià(
	`¡rcmp
(
n
, "ETX2Metric") == 0)

36  (
ETX2M‘ric
 *è
this
;

37 ià(
	`¡rcmp
(
n
, "GridGenericMetric") == 0)

38  (
GridG’”icM‘ric
 *è
this
;

41 
	}
}

44 
	gETX2M‘ric
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

46 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

47 .
»ad_mp
("DATA_LINKSTAT", 
EËm’tCa¡Arg
("LškSt"), 
_ls_d©a
)

48 .
»ad_mp
("ACK_LINKSTAT", 
EËm’tCa¡Arg
("LškSt"), 
_ls_ack
)

49 .
com¶‘e
();

50 ià(
	g»s
 < 0)

51  
	g»s
;

56 
boŞ


57 
	gETX2M‘ric
::
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &
m1
, cÚ¡ m‘ric_ˆ&
m2
) const

59  
m1
.
	`v®
(è< 
m2
.val();

60 
	}
}

62 
	gGridG’”icM‘ric
::
m‘ric_t


63 
ETX2M‘ric
::
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &
e
, 
boŞ
 
d©a_£nd”
) const

65 
u_foo
;

66 
Time¡amp
 
t_foo
;

67 
r_d©a
, 
r_ack
;

70 
boŞ
 
»s_d©a
 = 
d©a_£nd”
 ?

71 
_ls_d©a
->
	`g‘_fÜw¬d_¿‹
(
e
, &
r_d©a
, &
u_foo
, &
t_foo
) :

72 
_ls_d©a
->
	`g‘_»v”£_¿‹
(
e
, &
r_d©a
, &
u_foo
);

74 
boŞ
 
»s_ack
 = 
d©a_£nd”
 ?

75 
_ls_ack
->
	`g‘_»v”£_¿‹
(
e
, &
r_ack
, &
u_foo
) :

76 
_ls_ack
->
	`g‘_fÜw¬d_¿‹
(
e
, &
r_ack
, &
u_foo
, &
t_foo
);

78 ià(!
»s_d©a
 || !
»s_ack
)

79  
_bad_m‘ric
;

80 ià(
r_d©a
 =ğ0 || 
r_ack
 == 0)

81  
_bad_m‘ric
;

83 ià(
r_d©a
 > 100)

84 
r_d©a
 = 100;

85 ià(
r_ack
 > 100)

86 
r_ack
 = 100;

88 
v®
 = (100 * 100 * 100è/ (
r_d©a
 * 
r_ack
);

89 
	`as£¹
(
v®
 >= 100);

91  
	`m‘ric_t
(
v®
);

92 
	}
}

94 
	gGridG’”icM‘ric
::
m‘ric_t


95 
ETX2M‘ric
::
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

97 ià(!
r
.
	`good
(è|| !
l
.good())

98  
_bad_m‘ric
;

100 ià(
r
.
	`v®
() < 100)

101 
	`şick_ch©‹r
("ETX2Metric %s:‡ppend_metric WARNING: metric %u%%ransmissions isoo†ow for„oute metric",

102 
	`Çme
().
	`c_¡r
(), 
r
.
	`v®
());

103 ià(
l
.
	`v®
() < 100)

104 
	`şick_ch©‹r
("ETX2Metric %s:‡ppend_metric WARNING: metric %u%%ransmissions isoo†ow for†ink metric",

105 
	`Çme
().
	`c_¡r
(), 
r
.
	`v®
());

107  
	`m‘ric_t
(
r
.
	`v®
(è+ 
l
.val());

108 
	}
}

111 
	gETX2M‘ric
::
	$sÿË_to_ch¬
(cÚ¡ 
m‘ric_t
 &
m
) const

113 ià(!
m
.
	`good
(è|| m.
	`v®
() > (0xff * 10))

116  
m
.
	`v®
() / 10;

117 
	}
}

119 
	gGridG’”icM‘ric
::
m‘ric_t


120 
ETX2M‘ric
::
	$unsÿË_äom_ch¬
(
c
) const

122  
	`m‘ric_t
(
c
 * 10);

123 
	}
}

125 
	$ELEMENT_PROVIDES
(
GridG’”icM‘ric
)

126 
	$EXPORT_ELEMENT
(
ETX2M‘ric
)

128 
CLICK_ENDDECLS


	@grid/etx2metric.hh

1 #iâdeà
ETX2METRIC_HH


2 
	#ETX2METRIC_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"gridg’”icm‘ric.hh
"

5 
CLICK_DECLS


23 
şass
 
	gLškSt
;

25 şas 
	cETX2M‘ric
 : 
public
 
GridG’”icM‘ric
 {

27 
public
:

29 
ETX2M‘ric
();

30 ~
ETX2M‘ric
();

32 cÚ¡ *
	$şass_Çme
() const {  "ETX2Metric"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_0
; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

36 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

37 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
çl£
; 
	}
}

39 *
ÿ¡
(const *);

42 
boŞ
 
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

43 
m‘ric_t
 
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &
n
, 
boŞ
) const;

44 
m‘ric_t
 
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

45 
m‘ric_t
 
	$´•’d_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

46 {  
	`­³nd_m‘ric
(
r
, 
l
); 
	}
}

48 
	$sÿË_to_ch¬
(cÚ¡ 
m‘ric_t
 &) const;

49 
m‘ric_t
 
	$unsÿË_äom_ch¬
() const;

51 
´iv©e
:

52 
LškSt
 *
_ls_d©a
;

53 
LškSt
 *
_ls_ack
;

54 
	}
};

56 
	gCLICK_ENDDECLS


	@grid/etxmetric.cc

16 
	~<şick/cÚfig.h
>

17 
	~<şick/¬gs.hh
>

18 
	~<şick/”rÜ.hh
>

19 
	~"–em’ts/grid/‘xm‘ric.hh
"

20 
	~"–em’ts/grid/lšk¡©.hh
"

21 
CLICK_DECLS


23 
	gETXM‘ric
::
	$ETXM‘ric
()

24 : 
	$_ls
(0)

26 
	}
}

28 
ETXM‘ric
::~
	$ETXM‘ric
()

30 
	}
}

33 
ETXM‘ric
::
	$ÿ¡
(cÚ¡ *
n
)

35 ià(
	`¡rcmp
(
n
, "ETXMetric") == 0)

36  (
ETXM‘ric
 *è
this
;

37 ià(
	`¡rcmp
(
n
, "GridGenericMetric") == 0)

38  (
GridG’”icM‘ric
 *è
this
;

41 
	}
}

44 
	gETXM‘ric
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

46  
Args
(
cÚf
, 
this
, 
”rh
)

47 .
»ad_mp
("LINKSTAT", 
EËm’tCa¡Arg
("LškSt"), 
_ls
)

48 .
com¶‘e
();

52 
boŞ


53 
	gETXM‘ric
::
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &
m1
, cÚ¡ m‘ric_ˆ&
m2
) const

55  
m1
.
	`v®
(è< 
m2
.val();

56 
	}
}

58 
	gGridG’”icM‘ric
::
m‘ric_t


59 
ETXM‘ric
::
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &
e
, 
boŞ
) const

65 
u_fwd
, 
u_»v
;

66 
r_fwd
, 
r_»v
;

67 
Time¡amp
 
t_fwd
;

69 
boŞ
 
»s_fwd
 = 
_ls
->
	`g‘_fÜw¬d_¿‹
(
e
, &
r_fwd
, &
u_fwd
, &
t_fwd
);

70 
boŞ
 
»s_»v
 = 
_ls
->
	`g‘_»v”£_¿‹
(
e
, &
r_»v
, &
u_»v
);

72 ià(!
»s_fwd
 || !
»s_»v
)

73  
_bad_m‘ric
;

74 ià(
r_fwd
 =ğ0 || 
r_»v
 == 0)

75  
_bad_m‘ric
;

77 ià(
r_fwd
 > 100)

78 
r_fwd
 = 100;

79 ià(
r_»v
 > 100)

80 
r_»v
 = 100;

82 
v®
 = (100 * 100 * 100è/ (
r_fwd
 * 
r_»v
);

83 
	`as£¹
(
v®
 >= 100);

85  
	`m‘ric_t
(
v®
);

86 
	}
}

88 
	gGridG’”icM‘ric
::
m‘ric_t


89 
ETXM‘ric
::
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

91 ià(!
r
.
	`good
(è|| !
l
.good())

92  
_bad_m‘ric
;

94 ià(
r
.
	`v®
() < 100)

95 
	`şick_ch©‹r
("ETXMetric %s:‡ppend_metric WARNING: metric %u%%ransmissions isoo†ow for„oute metric",

96 
	`Çme
().
	`c_¡r
(), 
r
.
	`v®
());

97 ià(
l
.
	`v®
() < 100)

98 
	`şick_ch©‹r
("ETXMetric %s:‡ppend_metric WARNING: metric %u%%ransmissions isoo†ow for†ink metric",

99 
	`Çme
().
	`c_¡r
(), 
r
.
	`v®
());

101  
	`m‘ric_t
(
r
.
	`v®
(è+ 
l
.val());

102 
	}
}

105 
	gETXM‘ric
::
	$sÿË_to_ch¬
(cÚ¡ 
m‘ric_t
 &
m
) const

107 ià(!
m
.
	`good
(è|| m.
	`v®
() > (0xff * 10))

110  
m
.
	`v®
() / 10;

111 
	}
}

113 
	gGridG’”icM‘ric
::
m‘ric_t


114 
ETXM‘ric
::
	$unsÿË_äom_ch¬
(
c
) const

116  
	`m‘ric_t
(
c
 * 10);

117 
	}
}

119 
	$ELEMENT_PROVIDES
(
GridG’”icM‘ric
)

120 
	$EXPORT_ELEMENT
(
ETXM‘ric
)

122 
CLICK_ENDDECLS


	@grid/etxmetric.hh

1 #iâdeà
ETXMETRIC_HH


2 
	#ETXMETRIC_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"gridg’”icm‘ric.hh
"

5 
CLICK_DECLS


23 
şass
 
	gLškSt
;

25 şas 
	cETXM‘ric
 : 
public
 
GridG’”icM‘ric
 {

27 
public
:

29 
	$ETXM‘ric
(è
CLICK_COLD
;

30 ~
	$ETXM‘ric
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "ETXMetric"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_0
; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

36 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

37 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
çl£
; 
	}
}

39 *
ÿ¡
(const *);

42 
boŞ
 
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

43 
m‘ric_t
 
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &
n
, 
boŞ
) const;

44 
m‘ric_t
 
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

45 
m‘ric_t
 
	$´•’d_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

46 {  
	`­³nd_m‘ric
(
r
, 
l
); 
	}
}

48 
	$sÿË_to_ch¬
(cÚ¡ 
m‘ric_t
 &) const;

49 
m‘ric_t
 
	$unsÿË_äom_ch¬
() const;

51 
´iv©e
:

52 
LškSt
 *
_ls
;

53 
	}
};

55 
	gCLICK_ENDDECLS


	@grid/filterbyhops.cc

18 
	~<şick/cÚfig.h
>

19 
	~<¡ddef.h
>

20 
	~"f‹rbyhİs.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şickÃt/‘h”.h
>

25 
	~<şick/glue.hh
>

26 
	~"grid.hh
"

28 
CLICK_DECLS


30 
	gF‹rByGridHİs
::
	$F‹rByGridHİs
()

32 
	}
}

34 
F‹rByGridHİs
::~
	$F‹rByGridHİs
()

36 
	}
}

39 
F‹rByGridHİs
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41 
	gmh
;

42 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("HOPS", 
mh
).
com¶‘e
();

43 ià(
	g»s
 < 0)

44  
	g»s
;

47 ià(
	gmh
 < 0)

48  
	g”rh
->
”rÜ
("max_hops must be…ositive");

49 
	g_max_hİs
 = 
mh
;

50  
	g»s
;

54 
	gF‹rByGridHİs
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

57 
	}
}

60 
	gF‹rByGridHİs
::
	$push
(, 
Pack‘
 *
p
)

62 
	`as£¹
(
p
);

63 
grid_nbr_’ÿp
 *
nb
 = (grid_nbr_’ÿ°*è(
p
->
	`d©a
(è+ (
şick_‘h”
è+ (
grid_hdr
));

65 ià(
	`Áohl
(
nb
->
hİs_Œav–Ëd
è< 
_max_hİs
)

66 
	`ouut
(0).
	`push
(
p
);

68 
	`ouut
(1).
	`push
(
p
);

69 
	}
}

71 
CLICK_ENDDECLS


72 
EXPORT_ELEMENT
(
F‹rByGridHİs
)

	@grid/filterbyhops.hh

1 #iâdeà
CLICK_FILTERBYHOPS_HH


2 
	#CLICK_FILTERBYHOPS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


20 şas 
	cF‹rByGridHİs
 : 
public
 
EËm’t
 {

22 
public
:

24 
	$F‹rByGridHİs
(è
CLICK_COLD
;

25 ~
	$F‹rByGridHİs
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "FilterByGridHops"; }

28 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/2"; 
	}
}

29 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

31 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

32 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

34 
	`push
(
pÜt
, 
Pack‘
 *);

35 
´iv©e
:

36 
_max_hİs
;

37 
	}
};

39 
	gCLICK_ENDDECLS


	@grid/filterbyrange.cc

18 
	~<şick/cÚfig.h
>

19 
	~<¡ddef.h
>

20 
	~"f‹rby¿nge.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şickÃt/‘h”.h
>

25 
	~<şick/glue.hh
>

26 
CLICK_DECLS


28 
	gF‹rByRªge
::
	$F‹rByRªge
(è: 
	$_locšfo
(0)

30 
	}
}

32 
F‹rByRªge
::~
	$F‹rByRªge
()

34 
	}
}

37 
F‹rByRªge
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39  
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad_mp
("RANGE", 
_¿nge
)

41 .
»ad_mp
("LOCINFO", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_locšfo
))

42 .
com¶‘e
();

46 
	gF‹rByRªge
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

48 if(
_locšfo
 && _locšfo->
	`ÿ¡
("GridLocationInfo") == 0){

49 
”rh
->
	`w¬nšg
("%s: GridLocationInfo‡rgument %s hashe wrongype",

50 
	`Çme
().
	`c_¡r
(),

51 
_locšfo
->
	`Çme
().
	`c_¡r
());

52 
_locšfo
 = 0;

53 } if(
_locšfo
 == 0){

54  
”rh
->
	`”rÜ
("no GridLocationInfo‡rgument");

58 
	}
}

61 
	gF‹rByRªge
::
	$push
(, 
Pack‘
 *
p
)

63 
	`as£¹
(
p
);

65 ià(
_¿nge
 < 0) {

66 
	`ouut
(0).
	`push
(
p
);

70 
grid_hdr
 *
gh
 = (grid_hd¸*è(
p
->
	`d©a
(è+ (
şick_‘h”
));

71 
grid_loÿtiÚ
 
	`»mÙe_loc
(
gh
->
tx_loc
);

73 
	`as£¹
(
_locšfo
);

74 
grid_loÿtiÚ
 
our_loc
 = 
_locšfo
->
	`g‘_cu¼’t_loÿtiÚ
();

75 
di¡
 = 
grid_loÿtiÚ
::
	`ÿlc_¿nge
(
our_loc
, 
»mÙe_loc
);

77 
IPAdd»ss
 
	`tx
(
gh
->
tx_
);

78 
	`şick_ch©‹r
("XXXXX„ªg% %f", 
tx
.
	`uÅ¬£
().
	`c_¡r
(), 
di¡
);

80 ià(
di¡
 < 0) {

81 
	`şick_ch©‹r
("bogus†ocation info in grid header");

82 
	`ouut
(1).
	`push
(
p
);

85 ià(
di¡
 < 
_¿nge
)

86 
	`ouut
(0).
	`push
(
p
);

88 
	`ouut
(1).
	`push
(
p
);

89 
	}
}

91 
CLICK_ENDDECLS


92 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
GridLoÿtiÚInfo
)

93 
	`EXPORT_ELEMENT
(
F‹rByRªge
)

	@grid/filterbyrange.hh

1 #iâdeà
CLICK_FILTERBYRANGE_HH


2 
	#CLICK_FILTERBYRANGE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"–em’ts/grid/gridloÿtiÚšfo.hh
"

5 
CLICK_DECLS


25 şas 
	cF‹rByRªge
 : 
public
 
EËm’t
 {

27 
public
:

29 
	$F‹rByRªge
(è
CLICK_COLD
;

30 ~
	$F‹rByRªge
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "FilterByRange"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/2"; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

36 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

37 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

39 
	`push
(
pÜt
, 
Pack‘
 *);

41 
´iv©e
:

42 
GridLoÿtiÚInfo
 *
_locšfo
;

43 
_¿nge
;

44 
	}
};

46 
	gCLICK_ENDDECLS


	@grid/fixdstloc.cc

18 
	~<şick/cÚfig.h
>

19 
	~"fixd¡loc.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~"grid.hh
"

24 
	~<şick/rou‹r.hh
>

25 
	~<şickÃt/‘h”.h
>

26 
CLICK_DECLS


28 
	gFixD¡Loc
::
	$FixD¡Loc
(è: 
	$_loùab
(0)

30 
	}
}

32 
FixD¡Loc
::~
	$FixD¡Loc
()

34 
	}
}

37 
FixD¡Loc
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39  
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad_mp
("LOCTABLE", 
EËm’tCa¡Arg
("LoÿtiÚTabË"), 
_loùab
)

41 .
com¶‘e
();

45 
Pack‘
 *

46 
	gFixD¡Loc
::
	$sim¶e_aùiÚ
(
Pack‘
 *
xp
)

48 
	`as£¹
(
_loùab
);

49 
grid_hdr
 *
gh
 = (grid_hd¸*è(
xp
->
	`d©a
(è+ (
şick_‘h”
));

50 ià(
gh
->
ty³
 !ğ
grid_hdr
::
GRID_NBR_ENCAP
) {

51 
	`şick_ch©‹r
("FixD¡Loø%s:‚Ù‡À’ÿpsuÏ‹d d©¨·ck‘;‚Ù modifyšg it\n", 
	`Çme
().
	`c_¡r
());

52  
xp
;

55 #iâdeà
SMALL_GRID_HEADERS


56 
Wr™abËPack‘
 *
p
 = 
xp
->
	`uniqueify
();

57 
grid_nbr_’ÿp
 *
nb
 = (grid_nbr_’ÿ°*è(
p
->
	`d©a
(è+ (
şick_‘h”
è+ (
grid_hdr
));

58 
IPAdd»ss
 
	`d¡
(
nb
->
d¡_
);

59 
grid_loÿtiÚ
 
loc
;

60 
nb
->
d¡_loc_good
 = 
_loùab
.
	`g‘_loÿtiÚ
(
d¡
,‚b->
d¡_loc
,‚b->
d¡_loc_”r
);

62  
p
;

64  
xp
;

66 
	}
}

68 
CLICK_ENDDECLS


69 
	$ELEMENT_REQUIRES
(
LoÿtiÚTabË
)

70 
	`EXPORT_ELEMENT
(
FixD¡Loc
)

	@grid/fixdstloc.hh

1 #iâdeà
CLICK_FIXDSTLOC_HH


2 
	#CLICK_FIXDSTLOC_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~"loùabË.hh
"

6 
CLICK_DECLS


20 şas 
	cFixD¡Loc
 : 
public
 
EËm’t
 {

22 
public
:

23 
	$FixD¡Loc
(è
CLICK_COLD
;

24 ~
	$FixD¡Loc
(è
CLICK_COLD
;

26 cÚ¡ *
	$şass_Çme
() const {  "FixDstLoc"; }

27 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

28 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

30 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

32 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

34 
	g´iv©e
:

35 
LoÿtiÚTabË
 *
_loùab
;

38 
	gCLICK_ENDDECLS


	@grid/fixsrcloc.cc

18 
	~<şick/cÚfig.h
>

19 
	~"fix¤şoc.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~"grid.hh
"

24 
	~<şick/rou‹r.hh
>

25 
	~<şickÃt/‘h”.h
>

26 
	~"gridg’”işocšfo.hh
"

27 
CLICK_DECLS


29 
	gFixSrcLoc
::
	$FixSrcLoc
(è: 
	$_locšfo
(0)

31 
	}
}

33 
FixSrcLoc
::~
	$FixSrcLoc
()

35 
	}
}

38 
FixSrcLoc
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40  
Args
(
cÚf
, 
this
, 
”rh
)

41 .
»ad_mp
("LOCINFO", 
EËm’tCa¡Arg
("GridG’”icLocInfo"), 
_locšfo
)

42 .
com¶‘e
();

46 
Pack‘
 *

47 
	gFixSrcLoc
::
	$sim¶e_aùiÚ
(
Pack‘
 *
xp
)

49 
	`as£¹
(
_locšfo
);

50 
Wr™abËPack‘
 *
p
 = 
xp
->
	`uniqueify
();

51 
grid_hdr
 *
gh
 = (grid_hd¸*è(
p
->
	`d©a
(è+ (
şick_‘h”
));

52 
gh
->
tx_loc
 = 
_locšfo
->
	`g‘_cu¼’t_loÿtiÚ
(&gh->
loc_£q_no
);

53 
gh
->
tx_loc_£q_no
 = 
	`htÚl
(
_locšfo
->
	`£q_no
());

54 
gh
->
tx_loc_”r
 = 
	`htÚs
(
_locšfo
->
	`loc_”r
());

55 
gh
->
tx_loc_good
 = 
_locšfo
->
	`loc_good
();

57 ià(
gh
->

 =ğgh->
tx_
) {

58 
gh
->
loc
 = gh->
tx_loc
;

59 
gh
->
loc_£q_no
 = gh->
tx_loc_£q_no
;

60 
gh
->
loc_”r
 = gh->
tx_loc_”r
;

61 
gh
->
loc_good
 = gh->
tx_loc_good
;

63  
p
;

64 
	}
}

66 
CLICK_ENDDECLS


67 
	$ELEMENT_REQUIRES
(
GridG’”icLocInfo
)

68 
	`EXPORT_ELEMENT
(
FixSrcLoc
)

	@grid/fixsrcloc.hh

1 #iâdeà
FIXSRCLOC_HH


2 
	#FIXSRCLOC_HH


	)

18 
	~<şick/–em’t.hh
>

19 
	~<şick/glue.hh
>

20 
CLICK_DECLS


22 
şass
 
	gGridG’”icLocInfo
;

24 şas 
	cFixSrcLoc
 : 
public
 
EËm’t
 {

26 
public
:

27 
	$FixSrcLoc
(è
CLICK_COLD
;

28 ~
	$FixSrcLoc
(è
CLICK_COLD
;

30 cÚ¡ *
	$şass_Çme
() const {  "FixSrcLoc"; }

31 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

32 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

34 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

36 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

38 
	g´iv©e
:

39 
GridG’”icLocInfo
 *
_locšfo
;

42 
	gCLICK_ENDDECLS


	@grid/floodinglocquerier.cc

19 
	~<şick/cÚfig.h
>

20 
	~"æoodšglocqu”›r.hh
"

21 
	~<şickÃt/‘h”.h
>

22 
	~<şick/‘h”add»ss.hh
>

23 
	~<şick/add»ss.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/b™veùÜ.hh
>

26 
	~<şick/”rÜ.hh
>

27 
	~<şick/glue.hh
>

28 
	gCLICK_DECLS


30 
	#NOISY
 1

	)

32 
GridRou‹AùiÚC®lback
 
	tGRCB
;

34 
	gFloodšgLocQu”›r
::
	$FloodšgLocQu”›r
()

35 : 
	$_expœe_tim”
(
expœe_hook
, 
this
)

41 
	}
}

43 
	gFloodšgLocQu”›r
::~
	$FloodšgLocQu”›r
()

45 
	}
}

49 
FloodšgLocQu”›r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

51  
Args
(
cÚf
, 
this
, 
”rh
)

52 .
»ad_mp
("ETH", 
_my_’
)

53 .
»ad_mp
("IP", 
_my_
)

54 .
com¶‘e
();

58 
	gFloodšgLocQu”›r
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

60 
_expœe_tim”
.
	`š™Ÿlize
(
this
);

61 
_expœe_tim”
.
	`scheduË_aá”_m£c
(
EXPIRE_TIMEOUT_MS
);

62 
_loc_qu”›s
 = 0;

63 
_pkts_kËd
 = 0;

64 
_timeout_jiff›s
 = (
CLICK_HZ
 * 
EXPIRE_TIMEOUT_MS
) / 1000;

67 
	}
}

71 
	gFloodšgLocQu”›r
::
	$expœe_hook
(
Tim”
 *, *
thunk
)

74 
FloodšgLocQu”›r
 *
locq
 = (FloodšgLocQu”›¸*)
thunk
;

75 
jiff
 = 
	`şick_jiff›s
();

78 
£q_m­
::
	t™”©Ü
 
	tsmi_t
;

79 
VeùÜ
<
IPAdd»ss
> 
Şd_£qs
;

80 
smi_t
 
i
 = 
locq
->
_qu”y_£qs
.
	`begš
(); i.
	`live
(); i++) {

81 ià(
i
.
	`key
(è=ğ
locq
->
_my_
)

83 ià(
jiff
 - 
i
.
	`v®ue
().
Ï¡_»¥Ú£_jiff›s
 > 
locq
->
_timeout_jiff›s
)

84 
Şd_£qs
.
	`push_back
(
i
.
	`key
());

86 
i
 = 0; i < 
Şd_£qs
.
	`size
(); i++)

87 
locq
->
_qu”y_£qs
.
	`»move
(
Şd_£qs
[
i
]);

92 
qm­
::
	t™”©Ü
 
	tqmi_t
;

93 
VeùÜ
<
IPAdd»ss
> 
Şd_’Œ›s
;

94 
qmi_t
 
i
 = 
locq
-> 
_qu”›s
.
	`begš
(); i.
	`live
(); i++) {

95 ià(
jiff
 - 
i
.
	`v®ue
().
Ï¡_»¥Ú£_jiff›s
 > 
locq
->
_timeout_jiff›s
) {

96 
Şd_’Œ›s
.
	`push_back
(
i
.
	`key
());

97 ià(
i
.
	`v®ue
().
p
 != 0)

98 
i
.
	`v®ue
().
p
->
	`kl
();

101 
i
 = 0; i < 
Şd_’Œ›s
.
	`size
(); i++)

102 
locq
->
_qu”›s
.
	`»move
(
Şd_’Œ›s
[
i
]);

104 
locq
->
_expœe_tim”
.
	`scheduË_aá”_m£c
(
EXPIRE_TIMEOUT_MS
);

105 
	}
}

108 
	gFloodšgLocQu”›r
::
	$£nd_qu”y_fÜ
(cÚ¡ 
IPAdd»ss
 &
wªt_
)

110 
şick_‘h”
 *
e
;

111 
grid_hdr
 *
gh
;

112 
grid_loc_qu”y
 *
fq
;

113 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((*
e
è+ (*
gh
è+ (*
fq
) + 2);

114 ià(
q
 == 0) {

115 
	`şick_ch©‹r
("š %s: cªnÙ mak·ck‘!", 
	`Çme
().
	`c_¡r
());

116 
	`as£¹
(0);

118 
	`ASSERT_4ALIGNED
(
q
->
	`d©a
());

119 
q
->
	`puÎ
(2);

121 
q
->
	`£t_time¡amp_ªno
(
Time¡amp
::
	`now
());

123 
	`mem£t
(
q
->
	`d©a
(), '\0', q->
	`Ëngth
());

124 
e
 = (
şick_‘h”
 *è
q
->
	`d©a
();

125 
gh
 = (
grid_hdr
 *è(
e
 + 1);

126 
fq
 = (
grid_loc_qu”y
 *è(
gh
 + 1);

128 
	`memıy
(
e
->
‘h”_dho¡
, "\xff\xff\xff\xff\xff\xff", 6);

129 
	`memıy
(
e
->
‘h”_sho¡
, 
_my_’
.
	`d©a
(), 6);

130 
e
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_GRID
);

132 
gh
->
hdr_Ën
 = (
grid_hdr
);

133 
gh
->
ty³
 = 
grid_hdr
::
GRID_LOC_QUERY
;

134 
gh
->

 = gh->
tx_
 = 
_my_
;

135 
gh
->
tÙ®_Ën
 = 
	`htÚs
(
q
->
	`Ëngth
(è- (
şick_‘h”
));

137 
fq
->
d¡_
 = 
wªt_
;

138 
fq
->
£q_no
 = 
	`htÚl
(
_loc_qu”›s
);

141 
_qu”y_£qs
.
	`š£¹
(
_my_
, 
	`£q_t
(
_loc_qu”›s
, 
	`şick_jiff›s
()));

143 
_loc_qu”›s
++;

144 
	`ouut
(1).
	`push
(
q
);

145 
	}
}

158 
	gFloodšgLocQu”›r
::
	$hªdË_nbr_’ÿp
(
Pack‘
 *
p
)

160 
şick_‘h”
 *
eh
 = (şick_‘h” *è
p
->
	`d©a
();

161 
grid_hdr
 *
gh
 = (grid_hd¸*è(
eh
 + 1);

162 
grid_nbr_’ÿp
 *
nb
 = (grid_nbr_’ÿ°*è(
gh
 + 1);

164 #ià
NOISY


165 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s: gÙ…ack‘ fÜ %p{_±r}", 
	`Çme
().
	`c_¡r
(), &
nb
->
d¡_
);

168 #ifdeà
SMALL_GRID_HEADERS


169 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s:‚Ùƒnough infØš sm®Ègrid h—d”s, drİpšg…ack‘", 
	`Çme
().
	`c_¡r
());

170 
p
->
	`kl
();

174 ià(
nb
->
d¡_loc_good
) {

175 #ià
NOISY


176 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s:…ack‘ ha loøšfo, s’dšg immedŸ‹ly", 
	`Çme
().
	`c_¡r
());

179 
	`nÙify_rou‹_cbs
(
p
, 
nb
->
d¡_
, 
GRCB
::
NoLocQu”yN“ded
, 0, 0);

180 
	`ouut
(0).
	`push
(
p
);

185 
LocEÁry
 *
«
 = 
_qu”›s
.
	`fšdp
(
nb
->
d¡_
);

187 ià(
«
 != 0) {

189 ià(
«
->
p
 == 0) {

190 #ià
NOISY


191 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s: de¡ %p{_±r} ha good cached info, s’dšg immedŸ‹ly", 
	`Çme
().
	`c_¡r
(), &
nb
->
d¡_
);

194 
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
();

195 
şick_‘h”
 *
eh2
 = (şick_‘h” *è
q
->
	`d©a
();

196 
grid_hdr
 *
gh2
 = (grid_hd¸*è(
eh2
 + 1);

197 
gh2
->
tx_
 = 
_my_
;

198 
grid_nbr_’ÿp
 *
nb2
 = (grid_nbr_’ÿ°*è(
gh2
 + 1);

199 
nb2
->
d¡_loc
 = 
«
->
loc
;

200 
nb2
->
d¡_loc_”r
 = 
	`htÚs
(
«
->
loc_”r
);

201 
nb2
->
d¡_loc_good
 = 
«
->
loc_good
;

202 ià(!
«
->
loc_good
)

203 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s: ``bad''†oÿtiÚ infÜm©iÚ iÀbË! s’dšg…ack‘‡nyway...", 
	`Çme
().
	`c_¡r
());

205 
	`nÙify_rou‹_cbs
(
p
, 
nb
->
d¡_
, 
GRCB
::
CachedLocFound
, 0, 0);

206 
	`ouut
(0).
	`push
(
q
);

211 #ià
NOISY


212 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s: de¡ % ha ou¡ªdšg qu”y, klšg cached…ack‘,„eissušg†oøqu”y", 
	`Çme
().
	`c_¡r
(), 
	`IPAdd»ss
(
nb
->
d¡_
).
	`uÅ¬£
().c_str());

214 
«
->
p
->
	`kl
();

215 
_pkts_kËd
++;

216 
«
->
p
 =…;

217 
«
->
Ï¡_»¥Ú£_jiff›s
 = 
	`şick_jiff›s
();

218 
	`nÙify_rou‹_cbs
(
p
, 
nb
->
d¡_
, 
GRCB
::
QueuedFÜLocQu”y
, 0, 0);

219 
	`£nd_qu”y_fÜ
(
nb
->
d¡_
);

224 #ià
NOISY


225 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s: de¡ % ha NO cached info, issušg†oøqu”y", 
	`Çme
().
	`c_¡r
(), 
	`IPAdd»ss
(
nb
->
d¡_
).
	`uÅ¬£
().c_str());

227 
LocEÁry
 
«2
;

228 
«2
.

 = 
nb
->
d¡_
;

229 
«2
.
p
 =…;

230 
«2
.
Ï¡_»¥Ú£_jiff›s
 = 
	`şick_jiff›s
();

231 
_qu”›s
.
	`š£¹
(
nb
->
d¡_
, 
«2
);

232 
	`nÙify_rou‹_cbs
(
p
, 
nb
->
d¡_
, 
GRCB
::
QueuedFÜLocQu”y
, 0, 0);

233 
	`£nd_qu”y_fÜ
(
nb
->
d¡_
);

236 
	}
}

244 
	gFloodšgLocQu”›r
::
	$hªdË_»¶y
(
Pack‘
 *
p
)

246 ià(
p
->
	`Ëngth
(è< (
şick_‘h”
è+ (
grid_hdr
è+ (
grid_nbr_’ÿp
))

249 
şick_‘h”
 *
‘hh
 = (şick_‘h” *è
p
->
	`d©a
();

250 
grid_hdr
 *
gh
 = (grid_hd¸*è(
‘hh
 + 1);

251 
grid_nbr_’ÿp
 *
nb
 = (grid_nbr_’ÿ°*è(
gh
 + 1);

252 
IPAdd»ss
 
	`_»¶
(
gh
->

);

253 
IPAdd»ss
 
	`_d¡
(
nb
->
d¡_
);

255 #ià
NOISY


256 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s: gÙ„•ly fÜ % äom %s", 
	`Çme
().
	`c_¡r
(), 
_d¡
.
	`uÅ¬£
().c_¡r(), 
_»¶
.unparse().c_str());

259 ià(
_d¡
 !ğ
_my_
) {

260 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s: gÙ†oÿtiÚ qu”y„•ly fÜ % ÒÙ fÜ us!); checkhcÚfigu¿tiÚ", 
	`Çme
().
	`c_¡r
(), 
_»¶
.
	`uÅ¬£
().c_str());

261 
p
->
	`kl
();

265 
LocEÁry
 *
«
 = 
_qu”›s
.
	`fšdp
(
_»¶
);

266 ià(!
«
) {

267 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s: gÙ†oÿtiÚ qu”y„•ly from %s, buˆth”i nØ’Œy; ignÜšg it", 
	`Çme
().
	`c_¡r
(), 
_»¶
.
	`uÅ¬£
().c_str());

268 
p
->
	`kl
();

272 
loc_£q_no
 = 
	`Áohl
(
gh
->loc_seq_no);

273 ià(
loc_£q_no
 < 
«
->loc_£q_nØ&&‡e->
p
 == 0) {

274 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s: gÙ†oÿtiÚ qu”y„•ly from % w™h old infÜm©iÚ, ignÜšg it", 
	`Çme
().
	`c_¡r
(), 
_»¶
.
	`uÅ¬£
().c_str());

275 
p
->
	`kl
();

281 
«
->
loc
 = 
gh
->loc;

282 
«
->
loc_”r
 = 
	`Áohs
(
gh
->loc_err);

283 
«
->
loc_good
 = 
gh
->loc_good;

284 
«
->
loc_£q_no
 =†oc_seq_no;

285 
«
->
Ï¡_»¥Ú£_jiff›s
 = 
	`şick_jiff›s
();

287 ià(!
«
->
loc_good
)

288 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s: cachšg bad†oÿtiÚ infØäom %s", 
	`Çme
().
	`c_¡r
(), 
_»¶
.
	`uÅ¬£
().c_str());

290 
Pack‘
 *
ÿched_·ck‘
 = 
«
->
p
;

291 
«
->
p
 = 0;

293 ià(
ÿched_·ck‘
) {

294 #ià
NOISY


295 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s:‡á”„•ly,„e-£ndšg…ack‘ fÜ %s", 
	`Çme
().
	`c_¡r
(), 
_»¶
.
	`uÅ¬£
().c_str());

297 
	`hªdË_nbr_’ÿp
(
ÿched_·ck‘
);

300 
p
->
	`kl
();

301 
	}
}

304 
	gFloodšgLocQu”›r
::
	$hªdË_qu”y
(
Pack‘
 *
p
)

306 
grid_hdr
 *
gh
 = (grid_hd¸*è(
p
->
	`d©a
(è+ (
şick_‘h”
));

307 
grid_loc_qu”y
 *
lq
 = (grid_loc_qu”y *è(
gh
 + 1);

309 #ià
NOISY


310 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s: gÙ qu”y fÜ % äom % (%u)", 
	`Çme
().
	`c_¡r
(), 
	`IPAdd»ss
(
lq
->
d¡_
).
	`uÅ¬£
().c_¡r(), IPAdd»ss(
gh
->

).uÅ¬£().c_¡r(), 
	`Áohl
Öq->
£q_no
));

313 ià(
lq
->
d¡_
 =ğ(è
_my_
) {

314 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s: gÙ†oÿtiÚ qu”y fÜ us, buˆ™ should gØtØthLocQu”yRe¥Úd”. CheckhcÚfigu¿tiÚ.", 
	`Çme
().
	`c_¡r
());

315 
p
->
	`kl
();

320 
£q_t
 *
£q_»c
 = 
_qu”y_£qs
.
	`fšdp
(
gh
->

);

321 
q_£q_no
 = 
	`Áohl
(
lq
->
£q_no
);

322 ià(
£q_»c
 && seq_»c->
£q_no
 >ğ
q_£q_no
) {

323 #ià
NOISY


324 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s: klšg qu”y fÜ % äom % (%u)", 
	`Çme
().
	`c_¡r
(), 
	`IPAdd»ss
(
lq
->
d¡_
).
	`uÅ¬£
().c_¡r(), IPAdd»ss(
gh
->

).uÅ¬£().c_¡r(), 
	`Áohl
Öq->
£q_no
));

327 
p
->
	`kl
();

330 #ià
NOISY


331 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s:…rİag©šg qu”y fÜ % äom % (%u)", 
	`Çme
().
	`c_¡r
(), 
	`IPAdd»ss
(
lq
->
d¡_
).
	`uÅ¬£
().c_¡r(), IPAdd»ss(
gh
->

).uÅ¬£().c_¡r(), 
	`Áohl
Öq->
£q_no
));

333 
_qu”y_£qs
.
	`š£¹
(
gh
->

, 
	`£q_t
(
q_£q_no
, 
	`şick_jiff›s
()));

334 
Wr™abËPack‘
 *
wp
 = 
p
->
	`uniqueify
();

335 
şick_‘h”
 *
eh
 = (şick_‘h” *è
wp
->
	`d©a
();

336 
	`memıy
(&
eh
->
‘h”_sho¡
, 
_my_’
.
	`d©a
(), 6);

337 
gh
 = (
grid_hdr
 *è(
eh
 + 1);

338 
gh
->
tx_
 = 
_my_
;

340 
	`ouut
(1).
	`push
(
wp
);

342 
	}
}

345 
	gFloodšgLocQu”›r
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

347 ià(
pÜt
 == 0)

348 
	`hªdË_nbr_’ÿp
(
p
);

350 
grid_hdr
 *
gh
 = (grid_hd¸*è(
p
->
	`d©a
(è+ (
şick_‘h”
));

351 ià(
gh
->
ty³
 =ğ
grid_hdr
::
GRID_LOC_QUERY
)

352 
	`hªdË_qu”y
(
p
);

353 ià(
gh
->
ty³
 =ğ
grid_hdr
::
GRID_LOC_REPLY
) {

354 
	`hªdË_»¶y
(
p
);

357 
	`şick_ch©‹r
("FloodšgLocQu”›¸%s: gÙ‡ÀuÃx³ùed…ack‘y³", 
	`Çme
().
	`c_¡r
());

358 
	`as£¹
(0);

361 
	}
}

363 
SŒšg


364 
	gFloodšgLocQu”›r
::
	$»ad_£qs
(
EËm’t
 *
e
, *)

366 
FloodšgLocQu”›r
 *
q
 = (FloodšgLocQu”›¸*)
e
;

367 
SŒšg
 
s
;

369 
jiff
 = 
	`şick_jiff›s
();

371 
£q_m­
::
	t™”©Ü
 
	tsi_t
;

372 
si_t
 
i
 = 
q
->
_qu”y_£qs
.
	`begš
(); i.
	`live
(); i++) {

373 cÚ¡ 
£q_t
 &
e
 = 
i
.
	`v®ue
();

374 
age
 = (1000 * (
jiff
 - 
e
.
Ï¡_»¥Ú£_jiff›s
)è/ 
CLICK_HZ
;

375 
s
 +ğ
i
.
	`key
().
	`uÅ¬£
(è+ " seq=" + 
	`SŒšg
(
e
.
£q_no
è+ "‡ge=" + SŒšg(
age
) + "\n";

378  
s
;

379 
	}
}

381 
SŒšg


382 
	gFloodšgLocQu”›r
::
	$»ad_bË
(
EËm’t
 *
e
, *)

384 
FloodšgLocQu”›r
 *
q
 = (FloodšgLocQu”›¸*)
e
;

385 
SŒšg
 
s
;

387 
jiff
 = 
	`şick_jiff›s
();

389 
qm­
::
	t™”©Ü
 
	tsmi_t
;

390 
smi_t
 
i
 = 
q
->
_qu”›s
.
	`begš
(); i.
	`live
(); i++) {

391 cÚ¡ 
LocEÁry
 &
e
 = 
i
.
	`v®ue
();

392 
age
 = (1000 * (
jiff
 - 
e
.
Ï¡_»¥Ú£_jiff›s
)è/ 
CLICK_HZ
;

393 ià(
e
.
p
 == 0) {

394 
locbuf
[255];

395 
	`¢´štf
(
locbuf
, Öocbuf), "†©_ms=%d†Ú_ms=%d h_mm=%d", (è
e
.
loc
.
	`Ït_ms
(), (èe.loc.
	`lÚ_ms
(), (èe.loc.
	`h_mm
());

396 
s
 +ğ
e
.

.
	`uÅ¬£
(è+ 
	`SŒšg
(
locbuf
)

397 + " seq=" + 
	`SŒšg
(
e
.
loc_£q_no
è+ "‡ge=" + SŒšg(
age
) + "\n";

400 
s
 +ğ
e
.

.
	`uÅ¬£
(è+ " <nØloøy‘>‡ge=" + 
	`SŒšg
(
age
) + "\n";

402  
s
;

403 
	}
}

405 
SŒšg


406 
	$FloodšgLocQu”›r_»ad_¡©s
(
EËm’t
 *
e
, *)

408 
FloodšgLocQu”›r
 *
q
 = (FloodšgLocQu”›¸*)
e
;

410 
	`SŒšg
(
q
->
_pkts_kËd
) + "…ackets killed\n" +

411 
	`SŒšg
(
q
->
_loc_qu”›s
) + "†oc queries sent\n";

412 
	}
}

415 
	gFloodšgLocQu”›r
::
	$add_hªdËrs
()

417 
	`add_»ad_hªdËr
("bË", 
»ad_bË
, 0);

418 
	`add_»ad_hªdËr
("qu”›s", 
»ad_£qs
, 0);

419 
	`add_»ad_hªdËr
("¡©s", 
FloodšgLocQu”›r_»ad_¡©s
, 0);

420 
	}
}

422 
	$EXPORT_ELEMENT
(
FloodšgLocQu”›r
)

423 
CLICK_ENDDECLS


	@grid/floodinglocquerier.hh

1 #iâdeà
CLICK_FLOODLOCQUERIER_HH


2 
	#CLICK_FLOODLOCQUERIER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/add»ss.hh
>

6 
	~<şick/tim”.hh
>

7 
	~"–em’ts/grid/gridloÿtiÚšfo.hh
"

8 
	~<şick/bighashm­.hh
>

9 
	~"gridrou‹cb.hh
"

10 
CLICK_DECLS


40 
şass
 
	gFloodšgLocQu”›r
 : 
public
 
EËm’t
,…ubliø
	gGridRou‹AùÜ
 {

41 
	gpublic
:

43 
FloodšgLocQu”›r
(è
CLICK_COLD
;

44 ~
FloodšgLocQu”›r
(è
	gCLICK_COLD
;

46 cÚ¡ *
şass_Çme
() const {  "FloodingLocQuerier"; }

47 cÚ¡ *
pÜt_couÁ
() const {  "2/2"; }

48 cÚ¡ *
´oûssšg
(ècÚ¡ {  
	gPUSH
; }

49 
add_hªdËrs
(è
	gCLICK_COLD
;

51 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

52 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

54 
push
(
pÜt
, 
Pack‘
 *);

56 
	sLocEÁry
 {

57 
IPAdd»ss
 
	g
;

58 
grid_loÿtiÚ
 
	gloc
;

59 
	gloc_”r
;

60 
boŞ
 
	gloc_good
;

61 
	gloc_£q_no
;;

62 
	gÏ¡_»¥Ú£_jiff›s
;

63 
Pack‘
 *
	gp
;

69 
	gHashM­
<
	tIPAdd»ss
, 
	tLocEÁry
> 
	tqm­
;

70 
qm­
 
	g_qu”›s
;

73 
	g_loc_qu”›s
;

74 
	g_pkts_kËd
;

77 
	g´iv©e
:

79 
	s£q_t
 {

80 
£q_no
;

81 
	gÏ¡_»¥Ú£_jiff›s
;

82 
£q_t
(
s
, 
j
è: 
£q_no
(s), 
Ï¡_»¥Ú£_jiff›s
(j) { }

83 
£q_t
(è: 
£q_no
(0), 
Ï¡_»¥Ú£_jiff›s
(0) { }

85 
	gHashM­
<
	tIPAdd»ss
, 
	t£q_t
> 
	t£q_m­
;

86 
£q_m­
 
	g_qu”y_£qs
;

88 
Eth”Add»ss
 
	g_my_’
;

89 
IPAdd»ss
 
	g_my_
;

90 
Tim”
 
	g_expœe_tim”
;

92 
£nd_qu”y_fÜ
(cÚ¡ 
IPAdd»ss
 &);

94 
hªdË_nbr_’ÿp
(
Pack‘
 *);

95 
hªdË_»¶y
(
Pack‘
 *);

96 
hªdË_qu”y
(
Pack‘
 *);

98 ’um { 
	gEXPIRE_TIMEOUT_MS
 = 15 * 1000 };

99 
	g_timeout_jiff›s
;

100 
expœe_hook
(
Tim”
 *, *);

101 
SŒšg
 
»ad_bË
(
EËm’t
 *, *);

102 
SŒšg
 
»ad_£qs
(
EËm’t
 *, *);

106 
	gCLICK_ENDDECLS


	@grid/grid.hh

1 #iâdeà
GRID_HH


2 
	#GRID_HH


	)

3 
	~<şick/glue.hh
>

4 
	~<şick/¡ršg.hh
>

5 
	gCLICK_DECLS


8 
	#SMALL_GRID_HEADERS


	)

9 
	#SMALL_GRID_PROBES


	)

14 
	#ASSERT_4ALIGNED
(
p
è
	`as£¹
(((
ušŒ_t
èÕè% 4è=ğ0)

	)

19 cÚ¡ 
	gGRID_RAD_PER_DEG
 = 0.017453293;

20 cÚ¡ 
	gGRID_EARTH_RADIUS
 = 6378156;

21 cÚ¡ 
	gGRID_PI
 = 3.1415927;

25 
	sgrid_loÿtiÚ
 {

26 
	mpublic
:

28 
grid_loÿtiÚ
(è: 
_m¦©
(0), 
_m¦Ú
(0), 
_h
(0) { };

30 #ifdeà
CLICK_USERLEVEL


32 
grid_loÿtiÚ
(
Ït
, 
lÚ
, 
h
 = 0)

33 { 
£t
(
Ït
, 
lÚ
, 
h
); }

36 
Ït
() const {

37 (
toDeg
(
_m¦©
));

41 
lÚ
() const {

42 (
toDeg
(
_m¦Ú
));

46 
h
() const {

47  (è
Áohl
(
_h
) / 1000.0;

52 
ÿlc_¿nge
(cÚ¡ 
grid_loÿtiÚ
 &
l1
, cÚ¡ grid_loÿtiÚ &
l2
);

54 
SŒšg
 
s
() const {

55 
	mbuf
[255];

56 
¢´štf
(
buf
, 255, "%.5f,%.5f,%.3f", 
Ït
(), 
lÚ
(), 
h
());

57  
SŒšg
(
buf
);

60 
SŒšg
 
s
() const {

61 
	mbuf
[255];

62 
¢´štf
(
buf
, 255, "%ld,%ld,%ld", 
Ït_ms
(), 
lÚ_ms
(), 
h_mm
());

63  
SŒšg
(
buf
);

68 
grid_loÿtiÚ
(
št32_t
 
Ït
, iÁ32_ˆ
lÚ
, iÁ32_ˆ
h
 = 0)

69 { 
£t
(
Ït
, 
lÚ
, 
h
); }

71 
št32_t
 
Ït_ms
(ècÚ¡ {  
Áohl
(
_m¦©
); }

72 
št32_t
 
lÚ_ms
(ècÚ¡ {  
Áohl
(
_m¦Ú
); }

73 
št32_t
 
h_mm
(ècÚ¡ {  
Áohl
(
_h
); }

75 
	m´iv©e
:

78 
št32_t
 
_m¦©
;

79 
št32_t
 
	m_m¦Ú
;

83 
št32_t
 
	m_h
;

85 #ifdeà
CLICK_USERLEVEL


87 
toDeg
(
št32_t
 
ms
) {

88 (((
	mšt32_t
)
Áohl
(
ms
)) / (1000.0 * 60.0 * 60.0));

92 
toMS
(
d
) {

93 
as£¹
(
d
 >= -180.0 && d <= 180.0);

94 (
htÚl
(()(
d
 * 1000 * 60 * 60)));

98 
£t
(
Ït
, 
lÚ
, 
h
) {

99 
	m_m¦©
 = 
toMS
(
Ït
);

100 
	m_m¦Ú
 = 
toMS
(
lÚ
);

101 
	m_h
 = 
htÚl
((è(
h
 * 1000));

104 
sign
(
x
è{  (((
	mx
) < 0) ? -1 : 1); }

107 
£t
(
št32_t
 
Ït
, iÁ32_ˆ
lÚ
, iÁ32_ˆ
h
) {

108 
	m_m¦©
 = 
htÚl
(
Ït
);

109 
	m_m¦Ú
 = 
htÚl
(
lÚ
);

110 
	m_h
 = 
htÚl
(
h
);

115 
	sgrid_»giÚ
 {

116 
	mpublic
:

117 
grid_»giÚ
(cÚ¡ 
grid_loÿtiÚ
 &
c
, 
r
)

118 : 
_ûÁ”
(
c
è{ 
_¿dius
 = 
htÚl
(
r
); }

120 
grid_»giÚ
(è: 
_¿dius
(0) { }

122 
¿dius
(ècÚ¡ {  
Áohl
(
_¿dius
); }

123 cÚ¡ 
	mgrid_loÿtiÚ
 &
ûÁ”
(ècÚ¡ {  
	m_ûÁ”
; }

125 #ifdeà
CLICK_USERLEVEL


126 
boŞ
 
cÚšs
(cÚ¡ 
grid_loÿtiÚ
 &
l
)

127 {  
	mgrid_loÿtiÚ
::
ÿlc_¿nge
(
l
, 
_ûÁ”
è<ğ
_¿dius
; }

130 
	m´iv©e
:

131 
grid_loÿtiÚ
 
_ûÁ”
;

132 
ušt32_t
 
	m_¿dius
;

137 
	sgrid_hdr
 {

141 
	mGRID_VERSION
 = 0xFED4

144 
ušt32_t
 
	mv”siÚ
;

146 
ušt8_t
 
	mhdr_Ën
;

148 
ušt8_t
 
	mty³
;

149 
	eTy³
 {

150 
	mGRID_HELLO
 = 1,

151 
	mGRID_LR_HELLO
 = 2,

152 
	mGRID_NBR_ENCAP
 = 3,

153 
	mGRID_LOC_QUERY
 = 4,

154 
	mGRID_LOC_REPLY
 = 5,

155 
	mGRID_ROUTE_PROBE
 = 6,

156 
	mGRID_ROUTE_REPLY
 = 7,

157 
	mGRID_GEOCAST
 = 8,

158 
	mGRID_LINK_PROBE
 = 9

161 
ušt8_t
 
	m·d1
, 
	m·d2
;

185 
ušt32_t
 
	m
;

186 
grid_loÿtiÚ
 
	mloc
;

187 
ušt16_t
 
	mloc_”r
;

188 
ušt8_t
 
	mloc_good
;

189 
ušt8_t
 
	m·d3
;

190 
ušt32_t
 
	mloc_£q_no
;

192 
ušt32_t
 
	mtx_
;

193 
grid_loÿtiÚ
 
	mtx_loc
;

194 
ušt16_t
 
	mtx_loc_”r
;

195 
ušt8_t
 
	mtx_loc_good
;

196 
ušt8_t
 
	m·d4
;

197 
ušt32_t
 
	mtx_loc_£q_no
;

205 
ušt16_t
 
	mtÙ®_Ën
;

207 
ušt16_t
 
	mcksum
;

209 
grid_hdr
(è: 
hdr_Ën
((grid_hdr)), 
cksum
(0)

210 { 
	mtÙ®_Ën
 = 
htÚs
((
grid_hdr
)); 
as£¹
(
tÙ®_Ën
 % 4 == 0); }

212 
SŒšg
 
ty³_¡ršg
(
ušt8_t
 
ty³
);

214 
ušt32_t
 
g‘_·d_by‹s
(
grid_hdr
 &
gh
)

215 {  (
	mgh
.
	m·d1
 << 24è| (gh.
	m·d2
 << 16è| (gh.
	m·d3
 << 8è| gh.
	m·d4
; }

217 
£t_·d_by‹s
(
grid_hdr
 &
gh
, 
ušt32_t
 
v
)

218 { 
	mgh
.
	m·d1
 = (
v
 >> 24); gh.
	m·d2
 = (v >> 16è& 0xff; gh.
	m·d3
 = (v >> 8è& 0xff; gh.
	m·d4
 = v & 0xff; }

221 
	sgrid_nbr_’Œy
 {

225 
ušt32_t
 
	m
;

226 
ušt32_t
 
	mÃxt_hİ_
;

227 
ušt8_t
 
	mnum_hİs
;

231 
grid_loÿtiÚ
 
	mloc
;

232 
ušt16_t
 
	mloc_”r
;

233 
ušt8_t
 
	mloc_good
;

234 
ušt8_t
 
	mis_g©eway
;

235 
ušt32_t
 
	m£q_no
;

237 
ušt32_t
 
	mage
;

238 
ušt32_t
 
	m‰l
;

241 
ušt32_t
 
	mm‘ric
;

242 
ušt8_t
 
	mm‘ric_v®id
;

244 #iâdeà
SMALL_GRID_HEADERS


250 
št32_t
 
	mlšk_qu®
;

251 
št32_t
 
	mlšk_sig
;

252 
timev®
 
	mm—su»m’t_time
;

254 
ušt8_t
 
	mnum_rx
;

255 
ušt8_t
 
	mnum_ex³ùed
;

256 
timev®
 
	mÏ¡_bÿ¡
;

259 
grid_nbr_’Œy
(è: 

(0), 
Ãxt_hİ_
(0), 
num_hİs
(0), 
loc
(0, 0, 0), 
£q_no
(0)

260 { 
as£¹
((
grid_nbr_’Œy
) % 4 == 0); }

262 
grid_nbr_’Œy
(
ušt32_t
 
_
, ušt32_ˆ
_nh
, 
ušt8_t
 
h
, ušt32_ˆ
s
)

263 : 

(
_
), 
Ãxt_hİ_
(
_nh
), 
num_hİs
(
h
), 
loc
(0, 0, 0), 
£q_no
(
s
)

264 { 
as£¹
((
grid_nbr_’Œy
) % 4 == 0); }

267 
	sgrid_h–lo
 {

271 
ušt32_t
 
	m£q_no
;

273 
ušt32_t
 
	mage
;

274 
ušt32_t
 
	m‰l
;

277 
ušt8_t
 
	mis_g©eway
;

279 
ušt8_t
 
	mnum_nbrs
;

280 
ušt8_t
 
	mnbr_’Œy_sz
;

284 
grid_h–lo
(è: 
num_nbrs
(0), 
nbr_’Œy_sz
((
grid_nbr_’Œy
))

285 { 
as£¹
((
grid_h–lo
) % 4 == 0); }

288 
	mMIN_AGE_DECREMENT
 = 10,

289 
	mMAX_AGE_DEFAULT
 = 300000,

291 
	mMIN_TTL_DECREMENT
 = 
MIN_AGE_DECREMENT
,

292 
	mMAX_TTL_DEFAULT
 = 
MAX_AGE_DEFAULT


296 
	sgrid_nbr_’ÿp
 {

300 
grid_nbr_’ÿp
(è{ 
as£¹
((grid_nbr_encap) % 4 == 0); }

301 
ušt32_t
 
	md¡_
;

302 #iâdeà
SMALL_GRID_HEADERS


303 
grid_loÿtiÚ
 
	md¡_loc
;

304 
ušt16_t
 
	md¡_loc_”r
;

305 
ušt8_t
 
	md¡_loc_good
;

307 
ušt8_t
 
	m·d1
, 
	m·d2
, 
	m·d3
;

309 
ušt8_t
 
	mhİs_Œav–Ëd
;

311 #iâdeà
SMALL_GRID_HEADERS


312 
št32_t
 
	mlšk_qu®
;

313 
št32_t
 
	mlšk_sig
;

314 
timev®
 
	mm—su»m’t_time
;

316 
ušt8_t
 
	mnum_rx
;

317 
ušt8_t
 
	mnum_ex³ùed
;

318 
timev®
 
	mÏ¡_bÿ¡
;

322 
	sgrid_loc_qu”y
 {

326 
grid_loc_qu”y
(è{ 
as£¹
((grid_loc_query) % 4 == 0); }

327 
ušt32_t
 
	md¡_
;

328 
ušt32_t
 
	m£q_no
;

331 
	sgrid_rou‹_´obe
 {

332 
ušt32_t
 
	mnÚû
;

333 
timev®
 
	m£nd_time
;

336 
	sgrid_rou‹_»¶y
 {

337 
ušt32_t
 
	mnÚû
;

338 
ušt32_t
 
	m´obe_de¡
;

339 
ušt8_t
 
	m»¶y_hİ
;

340 
timev®
 
	m´obe_£nd_time
;

341 
ušt32_t
 
	mrou‹_aùiÚ
;

342 
ušt32_t
 
	md©a1
;

343 
ušt32_t
 
	md©a2
;

346 
	sgrid_geoÿ¡
 {

347 
grid_»giÚ
 
	md¡_»giÚ
;

348 
ušt16_t
 
	md¡_loc_”r
;

349 
ušt8_t
 
	mhİs_Œav–Ëd
;

350 
ušt8_t
 
	m·d
;

351 
ušt32_t
 
	m£q_no
;

356 
	sgrid_lšk_´obe
 {

357 
ušt32_t
 
	m£q_no
;

358 
ušt32_t
 
	m³riod
;

359 
ušt32_t
 
	mnum_lšks
;

360 
ušt32_t
 
	mu
;

363 
	sgrid_lšk_’Œy
 {

364 #ifdeà
SMALL_GRID_PROBES


365 
ušt8_t
 
	m
;

366 
ušt8_t
 
	mnum_rx
;

368 
ušt32_t
 
	m
;

369 
ušt32_t
 
	m³riod
;

370 
timev®
 
	mÏ¡_rx_time
;

371 
ušt32_t
 
	mÏ¡_£q_no
;

372 
ušt32_t
 
	mnum_rx
;

376 
šlše
 
SŒšg


377 
	ggrid_hdr
::
	$ty³_¡ršg
(
ušt8_t
 
ty³
)

379 
ty³
) {

380 
GRID_HELLO
:  
	`SŒšg
("GRID_HELLO"); ;

381 
GRID_LR_HELLO
:  
	`SŒšg
("GRID_LR_HELLO"); ;

382 
GRID_NBR_ENCAP
:  
	`SŒšg
("GRID_NBR_ENCAP"); ;

383 
GRID_LOC_REPLY
:  
	`SŒšg
("GRID_LOC_REPLY"); ;

384 
GRID_LOC_QUERY
:  
	`SŒšg
("GRID_LOC_QUERY"); ;

385 
GRID_ROUTE_PROBE
:  
	`SŒšg
("GRID_ROUTE_PROBE"); ;

386 
GRID_ROUTE_REPLY
:  
	`SŒšg
("GRID_ROUTE_REPLY"); ;

387 
GRID_GEOCAST
:  
	`SŒšg
("GRID_GEOCAST"); ;

388 
GRID_LINK_PROBE
:  
	`SŒšg
("GRID_LINK_PROBE"); ;

391 
buf
[100];

392 
	`¢´štf
(
buf
, (buf), "Unknown-ty³ 0x%02x", (è
ty³
);

393  
	`SŒšg
(
buf
);

396 
	}
}

398 
	gCLICK_ENDDECLS


	@grid/gridencap.cc

18 
	~<şick/cÚfig.h
>

19 
	~<–em’ts/grid/grid.hh
>

20 
	~<–em’ts/grid/grid’ÿp.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şickÃt/‘h”.h
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/glue.hh
>

26 
CLICK_DECLS


28 
	gGridEnÿp
::
	$GridEnÿp
()

30 
	}
}

32 
GridEnÿp
::~
	$GridEnÿp
()

34 
	}
}

37 
GridEnÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39 ià(
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad_mp
("ETH", 
_‘h
)

41 .
»ad_mp
("IP", 
_
)

42 .
com¶‘e
() < 0)

45 
mem£t
(&
_eh
, 0, (_eh));

46 
mem£t
(&
_gh
, 0, (_gh));

47 
mem£t
(&
_nb
, 0, (_nb));

49 
	g_eh
.
	g‘h”_ty³
 = 
htÚs
(
ETHERTYPE_GRID
);

50 
memıy
(
_eh
.
‘h”_sho¡
, 
_‘h
.
d©a
(), 6);

52 
	g_gh
.
	gv”siÚ
 = 
htÚl
(
grid_hdr
::
GRID_VERSION
);

53 
	g_gh
.
	ghdr_Ën
 = (
grid_hdr
);

54 
	g_gh
.
	gty³
 = 
grid_hdr
::
GRID_NBR_ENCAP
;

55 
	g_gh
.
	g
 = 
_
.
addr
();

56 
	g_gh
.
	gtx_
 = 
_
.
addr
();

61 #iâdeà
SMALL_GRID_HEADERS


62 
	g_nb
.
	gd¡_loc_good
 = 
çl£
;

64 
	g_nb
.
	ghİs_Œav–Ëd
 = 0;

70 
	gGridEnÿp
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

73 
	}
}

75 
Pack‘
 *

76 
	gGridEnÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

78 
exŒa
 = (
_eh
è+ (
_gh
è+ (
_nb
);

79 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`push
(
exŒa
);

80 ià(!
p
)

83 
_gh
.
tÙ®_Ën
 = 
	`htÚs
(
p
->
	`Ëngth
(è- (
_eh
));

84 
_nb
.
d¡_
 = 
p
->
	`d¡__ªno
();

86 
	`memıy
(
p
->
	`d©a
(), &
_eh
, (_eh));

87 
	`memıy
(
p
->
	`d©a
(è+ (
_eh
), &
_gh
, (_gh));

88 
	`memıy
(
p
->
	`d©a
(è+ (
_eh
è+ (
_gh
), &
_nb
, (_nb));

90  
p
;

91 
	}
}

94 
CLICK_ENDDECLS


95 
EXPORT_ELEMENT
(
GridEnÿp
)

	@grid/gridencap.hh

1 #iâdeà
CLICK_GRIDENCAP_HH


2 
	#CLICK_GRIDENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/add»ss.hh
>

6 
	~<şick/‘h”add»ss.hh
>

7 
	~<şickÃt/‘h”.h
>

8 
	~<–em’ts/grid/grid.hh
>

9 
CLICK_DECLS


35 şas 
	cGridEnÿp
 : 
public
 
EËm’t
 {…ublic:

37 
	$GridEnÿp
(è
CLICK_COLD
;

38 ~
	$GridEnÿp
(è
CLICK_COLD
;

40 cÚ¡ *
	$şass_Çme
() const {  "GridEncap"; }

41 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

42 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

44 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

45 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

46 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

48 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

50 
´iv©e
:

52 
Eth”Add»ss
 
_‘h
;

53 
IPAdd»ss
 
_
;

54 
şick_‘h”
 
_eh
;

55 
grid_hdr
 
_gh
;

56 
grid_nbr_’ÿp
 
_nb
;

57 
	}
};

59 
	gCLICK_ENDDECLS


	@grid/gridgatewayinfo.cc

17 
	~<şick/cÚfig.h
>

18 
	~"–em’ts/grid/gridg©ewayšfo.hh
"

19 
	~<şick/glue.hh
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/add»ss.hh
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/”rÜ.hh
>

24 
CLICK_DECLS


26 
	gGridG©ewayInfo
::
	$GridG©ewayInfo
()

28 
_is_g©eway
 = 
çl£
;

29 
	}
}

31 
	gGridG©ewayInfo
::~
	$GridG©ewayInfo
()

33 
	}
}

37 
GridG©ewayInfo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad_mp
("ROUTETABLE", 
EËm’tCa¡Arg
("GridG’”icRou‹TabË"), 
_¹
)

41 .
»ad_mp
("IS_GATEWAY", 
_is_g©eway
)

42 .
com¶‘e
();

43  
	g»s
;

47 
boŞ


48 
	gGridG©ewayInfo
::
	$is_g©eway
()

50  
_is_g©eway
;

51 
	}
}

53 
SŒšg


54 
	$gw_»ad_hªdËr
(
EËm’t
 *
f
, *)

56 
GridG©ewayInfo
 *
l
 = (GridG©ewayInfØ*è
f
;

58 cÚ¡ 
BUFSZ
 = 256;

59 
buf
[
BUFSZ
];

60 
	`¢´štf
(
buf
, 
BUFSZ
, "%s\n", 
l
->
	`is_g©eway
() ? "true" : "false");

61  
	`SŒšg
(
buf
);

62 
	}
}

64 
SŒšg


65 
	gGridG©ewayInfo
::
	$´št_be¡_g©eway
(
EËm’t
 *
f
, *)

67 
GridG©ewayInfo
 *
l
 = (GridG©ewayInfØ*è
f
;

68 
SŒšg
 
s
;

70 
GridG’”icRou‹TabË
::
Rou‹EÁry
 
gw
;

71 ià(
l
->
_¹
->
	`cu¼’t_g©eway
(
gw
)) {

72 
s
 +ğ
gw
.
de¡_
.
	`uÅ¬£
() + "\n";

74 
s
 += "none\n";

77  
s
;

78 
	}
}

81 
	gGridG©ewayInfo
::
	$add_hªdËrs
()

83 
	`add_»ad_hªdËr
("be¡_g©eway", 
´št_be¡_g©eway
, 0);

84 
	`add_»ad_hªdËr
("is_g©eway", 
gw_»ad_hªdËr
, 0);

85 
	}
}

87 
Pack‘
 *

88 
	gGridG©ewayInfo
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

90 
GridG’”icRou‹TabË
::
Rou‹EÁry
 
gw
;

91 ià(
_¹
->
	`cu¼’t_g©eway
(
gw
)) {

92 
p
->
	`£t_d¡__ªno
(
gw
.
de¡_
);

93  
p
;

96 
	`şick_ch©‹r
("GridG©ewayInfØ%s: couldn'ˆfšd‡ g©eway, drİpšg…ack‘.", 
	`Çme
().
	`c_¡r
());

97 
p
->
	`kl
();

101 
	}
}

103 
CLICK_ENDDECLS


104 
EXPORT_ELEMENT
(
GridG©ewayInfo
)

	@grid/gridgatewayinfo.hh

1 #iâdeà
GRIDGATEWAYINFO_HH


2 
	#GRIDGATEWAYINFO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"grid.hh
"

5 
	~"gridg’”iüt.hh
"

6 
CLICK_DECLS


35 şas 
	cGridG©ewayInfo
 : 
public
 
EËm’t
 {

37 
public
:

39 
	$GridG©ewayInfo
(è
CLICK_COLD
;

40 ~
	$GridG©ewayInfo
(è
CLICK_COLD
;

42 cÚ¡ *
	$şass_Çme
() const {  "GridGatewayInfo"; }

43 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

44 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

46 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

47 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

49 
	$add_hªdËrs
(è
CLICK_COLD
;

51 
boŞ
 
	`is_g©eway
 ();

52 
SŒšg
 
	`´št_be¡_g©eway
(
EËm’t
 *
f
, *);

54 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

55 
şass
 
GridG’”icRou‹TabË
 *
_¹
;

56 
´Ùeùed
:

58 
boŞ
 
_is_g©eway
;

60 
	}
};

62 
	gCLICK_ENDDECLS


	@grid/gridgenericlocinfo.cc

17 
	~<şick/cÚfig.h
>

18 
	~"gridg’”işocšfo.hh
"

22 
ELEMENT_PROVIDES
(
GridG’”icLocInfo
)

	@grid/gridgenericlocinfo.hh

1 #iâdeà
GRIDGENERICLOCINFO_HH


2 
	#GRIDGENERICLOCINFO_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~"grid.hh
"

6 
CLICK_DECLS


8 şas 
	cGridG’”icLocInfo
 : 
public
 
EËm’t
 {

9 
public
:

10 
	$GridG’”icLocInfo
() { }

11 
vœtu®
 ~
	$GridG’”icLocInfo
(è{ 
	}
}

15 
vœtu®
 
grid_loÿtiÚ
 
g‘_cu¼’t_loÿtiÚ
(*
£q_no
 = 0) = 0;

17 
vœtu®
 
£q_no
() = 0;

18 
vœtu®
 
boŞ
 
loc_good
() = 0;

19 
vœtu®
 
loc_”r
() = 0;

23 
	gCLICK_ENDDECLS


	@grid/gridgenericlogger.cc

17 
	~<şick/cÚfig.h
>

18 
	~"gridg’”işogg”.hh
"

22 
ELEMENT_PROVIDES
(
GridG’”icLogg”
)

	@grid/gridgenericlogger.hh

1 #iâdeà
GRIDGENERICLOGGER_HH


2 
	#GRIDGENERICLOGGER_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~"gridg’”iüt.hh
"

6 
CLICK_DECLS


8 şas 
	cGridG’”icLogg”
 : 
public
 
EËm’t
 {

10 
public
:

12 
	$GridG’”icLogg”
() { }

14 
	e»asÚ_t
 {

15 
WAS_SENDER
 = 0xf1,

16 
WAS_ENTRY
 = 0xf2,

17 
BROKEN_AD
 = 0xf3,

18 
TIMEOUT
 = 0xf4,

19 
NEXT_HOP_EXPIRED
 = 0xf5,

22 
NEW_DEST
 = 0xe0,

23 
NEW_DEST_SENDER
 = 0xe1,

24 
BETTER_RTE
 = 0xe2,

25 
BETTER_RTE_SENDER
 = 0xe3,

26 
NEWER_SEQ
 = 0xe4,

27 
NEWER_SEQ_SENDER
 = 0xe5,

28 
REBOOT_SEQ
 = 0xe6,

29 
REBOOT_SEQ_SENDER
 = 0xe7

30 
	}
};

33 
vœtu®
 
log_£Á_adv”ti£m’t
(
£q_no
, cÚ¡ 
Time¡amp
 &
wh’
) = 0;

34 
vœtu®
 
log_¡¬t_»cv_adv”ti£m’t
(
£q_no
, 

, cÚ¡ 
Time¡amp
 &
wh’
) = 0;

35 
vœtu®
 
log_added_rou‹
(
»asÚ_t
 
why
, cÚ¡ 
GridG’”icRou‹TabË
::
Rou‹EÁry
 &
r
) = 0;

36 
vœtu®
 
log_added_rou‹
(
»asÚ_t
 
why
, cÚ¡ 
GridG’”icRou‹TabË
::
Rou‹EÁry
 &
r
,

37 cÚ¡ 
exŒa
) = 0;

38 
vœtu®
 
log_expœed_rou‹
(
»asÚ_t
 
why
, 

) = 0;

39 
vœtu®
 
log_Œigg”ed_rou‹
(

) = 0;

40 
vœtu®
 
log_’d_»cv_adv”ti£m’t
() = 0;

41 
vœtu®
 
log_¡¬t_expœe_hªdËr
(cÚ¡ 
Time¡amp
 &
wh’
) = 0;

42 
vœtu®
 
log_’d_expœe_hªdËr
() = 0;

43 
vœtu®
 
log_rou‹_dump
(cÚ¡ 
VeùÜ
<
GridG’”icRou‹TabË
::
Rou‹EÁry
> &
¹
, cÚ¡ 
Time¡amp
 &
wh’
) = 0;

46 
vœtu®
 
log_tx_”r
(cÚ¡ 
Pack‘
 *
p
, 
”r
, cÚ¡ 
Time¡amp
 &
wh’
) = 0;

47 
vœtu®
 
log_no_rou‹
(cÚ¡ 
Pack‘
 *
p
, cÚ¡ 
Time¡amp
 &
wh’
) = 0;

49 
	gvœtu®
 ~
	$GridG’”icLogg”
(è{ 
	}
}

52 
	gCLICK_ENDDECLS


	@grid/gridgenericmetric.cc

17 
	~<şick/cÚfig.h
>

18 
	~"gridg’”icm‘ric.hh
"

22 
ELEMENT_PROVIDES
(
GridG’”icM‘ric
)

	@grid/gridgenericmetric.hh

1 #iâdeà
GRIDGENERICMETRIC_HH


2 
	#GRIDGENERICMETRIC_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


6 
şass
 
	gEth”Add»ss
;

10 şas 
	cGridG’”icM‘ric
 : 
public
 
EËm’t
 {

12 
public
:

14 
	$GridG’”icM‘ric
() { }

16 
vœtu®
 ~
	$GridG’”icM‘ric
(è{ 
	}
}

19 şas 
	cm‘ric_t
 {

20 
boŞ
 
_good
;

21 
	g_v®
;

22 
	gpublic
:

23 
m‘ric_t
(è: 
_good
(
çl£
), 
_v®
(77777) { }

24 
m‘ric_t
(
v
, 
boŞ
 
g
 = 
Œue
è: 
_good
(g), 
_v®
(v) { }

26 
v®
(ècÚ¡ {  
	g_v®
; }

27 
boŞ
 
good
(ècÚ¡ {  
	g_good
; }

33 
vœtu®
 
boŞ
 
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &
m1
, cÚ¡ m‘ric_ˆ&
m2
) const = 0;

43 
vœtu®
 
m‘ric_t
 
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &
n
, 
boŞ
 
d©a_£nd”
) const = 0;

48 
vœtu®
 
m‘ric_t
 
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const = 0;

53 
vœtu®
 
m‘ric_t
 
	$´•’d_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const = 0;

69 
vœtu®
 
	$sÿË_to_ch¬
(cÚ¡ 
m‘ric_t
 &
m
) const = 0;

72 
vœtu®
 
m‘ric_t
 
	$unsÿË_äom_ch¬
(
c
) const = 0;

74 
´Ùeùed
:

75 cÚ¡ 
m‘ric_t
 
_bad_m‘ric
;

76 
	}
};

78 
	gCLICK_ENDDECLS


	@grid/gridgenericrt.hh

1 #iâdeà
GRIDGENERICRT_HH


2 
	#GRIDGENERICRT_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/add»ss.hh
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<şick/veùÜ.hh
>

7 
	~"grid.hh
"

8 
CLICK_DECLS


13 şas 
	cGridG’”icRou‹TabË
 : 
public
 
EËm’t
 {

15 
public
:

17 
	$GridG’”icRou‹TabË
() { }

19 
	sRou‹EÁry
 {

21 
şass
 
IPAdd»ss
 
de¡_
;

23 
grid_loÿtiÚ
 
de¡_loc
;

24 
boŞ
 
loc_good
;

25 
loc_”r
;

27 
şass
 
Eth”Add»ss
 
Ãxt_hİ_‘h
;

28 
şass
 
IPAdd»ss
 
Ãxt_hİ_
;

29 
Ãxt_hİ_š‹rçû
;

31 
´Ùeùed
:

32 
_£q_no
;

33 
_num_hİs
;

34 
public
:

35 
	`£q_no
(ècÚ¡ {  
_£q_no
; }

36 
	`num_hİs
(ècÚ¡ {  
_num_hİs
; }

37 
boŞ
 
	`good
(ècÚ¡ {  
_num_hİs
 != 0; }

38 
boŞ
 
	`brok’
(ècÚ¡ {  !
	`good
(); }

40 
	`Rou‹EÁry
(cÚ¡ 
IPAdd»ss
 &
d¡
,

41 
boŞ
 
lg
, 
Ë
, cÚ¡ 
grid_loÿtiÚ
 &
l
,

42 cÚ¡ 
Eth”Add»ss
 &
nhe
, cÚ¡ 
IPAdd»ss
 &
nhi
, 
š‹rçû
,

43 
¢
, 
nh
) :

44 
	`de¡_
(
d¡
), 
	`de¡_loc
(
l
), 
	`loc_good
(
lg
), 
	`loc_”r
(
Ë
),

45 
	`Ãxt_hİ_‘h
(
nhe
), 
	`Ãxt_hİ_
(
nhi
), 
	`Ãxt_hİ_š‹rçû
(
š‹rçû
),

46 
	`_£q_no
(
¢
), 
	`_num_hİs
(
nh
)

49 
	`Rou‹EÁry
(è: 
	`loc_good
(
çl£
), 
	`loc_”r
(0), 
	`Ãxt_hİ_š‹rçû
(0), 
	`_£q_no
(0), 
	`_num_hİs
(0) { }

50 
	}
};

54 
vœtu®
 
boŞ
 
cu¼’t_g©eway
(
Rou‹EÁry
 &
’Œy
) = 0;

57 
vœtu®
 
boŞ
 
g‘_Úe_’Œy
(cÚ¡ 
IPAdd»ss
 &
de¡_
, 
Rou‹EÁry
 &
’Œy
) = 0;

61 
vœtu®
 
g‘_®l_’Œ›s
(
VeùÜ
<
Rou‹EÁry
> &
vec
) = 0;

67 
vœtu®
 
	$g‘_numb”_dœeù_ÃigbÜs
() {

68 
VeùÜ
<
Rou‹EÁry
> 
v
;

69 
	`g‘_®l_’Œ›s
(
v
);

72 
num_nbrs
 = 0;

73 
i
 = 0; i < 
v
.
	`size
(); i++)

74 ià(
v
[
i
].
	`num_hİs
(è=ğ1 && v[i].
	`good
())

75 
num_nbrs
++;

76  
num_nbrs
;

77 
	}
}

79 
	gvœtu®
 ~
	$GridG’”icRou‹TabË
(è{ 
	}
}

82 
	gCLICK_ENDDECLS


	@grid/gridheaderinfo.cc

16 
	~<şick/cÚfig.h
>

17 
	~"–em’ts/grid/gridh—d”šfo.hh
"

18 
	~<şick/glue.hh
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/rou‹r.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şickÃt/‘h”.h
>

23 
	~"–em’ts/grid/lšk¡©.hh
"

24 
CLICK_DECLS


31 cÚ¡ 
	gGridH—d”Info
::
šfo_t


32 
hªdËr_šfo_¬¿y
[] = {

33 { "grid_hdr_v”siÚ" , 
grid_hdr
::
GRID_VERSION
 , 'h', -1 },

35 { "grid_‘h”_´Ùo" , 
ETHERTYPE_GRID
 , 'h', 4 },

37 { "grid_´Ùo_h–lo" , 
grid_hdr
::
GRID_HELLO
 , 'h', 2 },

38 { "grid_´Ùo_Ì_h–lo" , 
grid_hdr
::
GRID_LR_HELLO
 , 'h', 2 },

39 { "grid_´Ùo_nbr_’ÿp" , 
grid_hdr
::
GRID_NBR_ENCAP
 , 'h', 2 },

40 { "grid_´Ùo_loc_qu”y" , 
grid_hdr
::
GRID_LOC_QUERY
 , 'h', 2 },

41 { "grid_´Ùo_loc_»¶y" , 
grid_hdr
::
GRID_LOC_REPLY
 , 'h', 2 },

42 { "grid_´Ùo_rou‹_´obe" , 
grid_hdr
::
GRID_ROUTE_PROBE
 , 'h', 2 },

43 { "grid_´Ùo_rou‹_»¶y" , 
grid_hdr
::
GRID_ROUTE_REPLY
 , 'h', 2 },

44 { "grid_´Ùo_geoÿ¡" , 
grid_hdr
::
GRID_GEOCAST
 , 'h', 2 },

45 { "grid_´Ùo_lšk_´obe" , 
grid_hdr
::
GRID_LINK_PROBE
 , 'h', 2 },

47 { "sizeof_grid_loÿtiÚ" , (
grid_loÿtiÚ
) , 'd', -1 },

48 { "sizeof_grid_hdr" , (
grid_hdr
) , 'd', -1 },

49 { "sizeof_grid_nbr_’Œy" , (
grid_nbr_’Œy
) , 'd', -1 },

50 { "sizeof_grid_h–lo" , (
grid_h–lo
) , 'd', -1 },

51 { "sizeof_grid_nbr_’ÿp" , (
grid_nbr_’ÿp
) , 'd', -1 },

52 { "sizeof_grid_loc_qu”y" , (
grid_loc_qu”y
) , 'd', -1 },

53 { "sizeof_grid_rou‹_´obe" , (
grid_rou‹_´obe
) , 'd', -1 },

54 { "sizeof_grid_rou‹_»¶y" , (
grid_rou‹_»¶y
) , 'd', -1 },

55 { "sizeof_grid_lšk_´obe" , (
grid_lšk_´obe
) , 'd', -1 },

56 { "sizeof_grid_lšk_’Œy" , (
grid_lšk_’Œy
) , 'd', -1 },

58 { "sizeof_lšk¡©_lšk_´obe" , 
LškSt
::
lšk_´obe
::
size
 , 'd', -1 },

59 { "sizeof_lšk¡©_lšk_’Œy" , 
LškSt
::
lšk_’Œy
::
size
 , 'd', -1 },

61 { "off£tof_grid_hdr_v”siÚ" , 
off£tof
(
grid_hdr
, 
v”siÚ
) , 'd', -1 },

62 { "off£tof_grid_hdr_ty³" , 
off£tof
(
grid_hdr
, 
ty³
) , 'd', -1 },

63 { "off£tof_grid_hdr_" , 
off£tof
(
grid_hdr
, 

) , 'd', -1 },

64 { "off£tof_grid_hdr_tx_" , 
off£tof
(
grid_hdr
, 
tx_
) , 'd', -1 },

65 { "off£tof_grid_hdr_tÙ®_Ën" , 
off£tof
(
grid_hdr
, 
tÙ®_Ën
) , 'd', -1 },

67 { "off£tof_grid_nbr_’ÿp_d¡_" , 
off£tof
(
grid_nbr_’ÿp
, 
d¡_
) , 'd', -1 },

69 { "off£tof_grid_loc_qu”y_d¡_" , 
off£tof
(
grid_loc_qu”y
, 
d¡_
) , 'd', -1 },

74 
	gGridH—d”Info
::
	$GridH—d”Info
()

76 
	}
}

78 
GridH—d”Info
::~
	$GridH—d”Info
()

80 
	}
}

83 
GridH—d”Info
::
»ad_¬gs
(cÚ¡ 
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *)

88 
	gGridH—d”Info
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *)

94 
SŒšg


95 
	$ghi_»ad_hªdËr
(
EËm’t
 *, *
v
)

97 
num_hªdËrs
 = (
hªdËr_šfo_¬¿y
è/ (
GridH—d”Info
::
šfo_t
);

98 
šŒ_t
 
hªdËr_šdex
 = (šŒ_tè
v
;

99 ià(
hªdËr_šdex
 < 0 || hªdËr_šdex >ğ
num_hªdËrs
)

100  
	`SŒšg
("An‚on-existent handler was specified\n");

102 
GridH—d”Info
::
šfo_t
 
šfo
 = 
hªdËr_šfo_¬¿y
[
hªdËr_šdex
];

105 
fmt
[10];

106 ià(
šfo
.
width
 > 0)

107 
	`¢´štf
(
fmt
, (fmt), "%%0%d%c", 
šfo
.
width
, (šfo.
ba£
 == 'h') ? 'x' : 'u');

109 
	`¢´štf
(
fmt
, (fmt), "%%%c", (
šfo
.
ba£
 == 'h') ? 'x' : 'u');

111 
buf
[80];

112 
	`¢´štf
(
buf
, (buf), 
fmt
, 
šfo
.
v®
);

114  
	`SŒšg
(
buf
) + "\n";

115 
	}
}

121 
	gGridH—d”Info
::
	$add_hªdËrs
()

123 
i
 = 0; i < (
hªdËr_šfo_¬¿y
)/(
GridH—d”Info
::
šfo_t
); i++)

124 
	`add_»ad_hªdËr
(
hªdËr_šfo_¬¿y
[
i
].
Çme
, 
ghi_»ad_hªdËr
, i);

125 
	}
}

127 
CLICK_ENDDECLS


128 
EXPORT_ELEMENT
(
GridH—d”Info
)

	@grid/gridheaderinfo.hh

1 #iâdeà
GRIDHEADERINFO_HH


2 
	#GRIDHEADERINFO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"grid.hh
"

5 
CLICK_DECLS


76 şas 
	cGridH—d”Info
 : 
public
 
EËm’t
 {

78 
public
:

80 
	$GridH—d”Info
(è
CLICK_COLD
;

81 ~
	$GridH—d”Info
(è
CLICK_COLD
;

83 cÚ¡ *
	$şass_Çme
() const {  "GridHeaderInfo"; }

85 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

86 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

88 
	$add_hªdËrs
(è
CLICK_COLD
;

89 
	`»ad_¬gs
(cÚ¡ 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
);

91 
	sšfo_t
 {

92 
Çme
[100];

93 
v®
;

94 
ba£
;

95 
width
;

96 
	}
};

99 
	gCLICK_ENDDECLS


	@grid/gridlocationinfo.cc

18 
	~<şick/cÚfig.h
>

19 
	~"grid.hh
"

20 
	~"gridloÿtiÚšfo.hh
"

21 
	~<şick/glue.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<m©h.h
>

26 
CLICK_DECLS


28 
	gGridLoÿtiÚInfo
::
	$GridLoÿtiÚInfo
(è: 
	`_£q_no
(0), 
	$_loggšg_tim”
(
loggšg_hook
, 
this
)

30 
_move
 = 0;

31 
_Ït0
 = 32.2816;

32 
_lÚ0
 = -64.7685;

33 
_h0
 = 0;

34 
_t0
 = 0;

35 
_t1
 = 0;

36 
_vÏt
 = 0;

37 
_vlÚ
 = 0;

39 
_g
 = "<unknown>";

41 
_loc_”r
 = 0;

42 
_loc_good
 = 
çl£
;

43 
	}
}

45 
	gGridLoÿtiÚInfo
::~
	$GridLoÿtiÚInfo
()

47 
	}
}

50 
GridLoÿtiÚInfo
::
	$ÿ¡
(cÚ¡ *
n
)

52 ià(
	`¡rcmp
(
n
, "GridLocationInfo") == 0 ||

53 
	`¡rcmp
(
n
, "GridGenericLocInfo") == 0)

54  
this
;

56 
	}
}

59 
	gGridLoÿtiÚInfo
::
	$loggšg_hook
(
Tim”
 *, *
thunk
) {

61 
GridLoÿtiÚInfo
 *
l
 = (GridLoÿtiÚInfØ*è
thunk
;

62 
grid_loÿtiÚ
 
loc
 = 
l
->
	`g‘_cu¼’t_loÿtiÚ
();

64 cÚ¡ 
BUFSZ
 = 255;

65 
buf
[
BUFSZ
];

66 
»s
 = 
	`¢´štf
(
buf
, 
BUFSZ
, "loø%s\n\n", 
loc
.
	`s
().
	`c_¡r
());

67 ià(
»s
 < 0) {

68 
	`şick_ch©‹r
("LocationInfo„ead handler bufferoo small");

72 
l
->
_ex‹nded_loggšg_”rh
->
	`mes§ge
(
buf
);

73 
l
->
_loggšg_tim”
.
	`scheduË_aá”_m£c
 (1000);

74 
	}
}

77 
	gGridLoÿtiÚInfo
::
»ad_¬gs
(cÚ¡ 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

79 
	gdo_move
 = 0;

80 
	gÏt_št
, 
	glÚ_št
;

81 
	gh_št
 = 0;

83 
SŒšg
 
chª
("routelog");

84 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

86 .
»ad_mp
("LATITUDE", 
Decim®FixedPoštArg
(5), 
Ït_št
)

87 .
»ad_mp
("LONGITUDE", 
Decim®FixedPoštArg
(5), 
lÚ_št
)

88 .
»ad_p
("HEIGHT", 
Decim®FixedPoštArg
(3), 
h_št
)

89 .
»ad
("MOVESIM", 
do_move
)

90 .
»ad
("LOC_GOOD", 
_loc_good
)

91 .
»ad
("ERR_RADIUS", 
_loc_”r
)

92 .
»ad
("LOGCHANNEL", 
chª
)

93 .
»ad
("TAG", 
_g
)

94 .
com¶‘e
();

95 ià(
	g»s
 < 0)

96  
	g»s
;

98 
	gÏt
 = ((è
Ït_št
) / 1e5;

99 
	glÚ
 = ((è
lÚ_št
) / 1e5;

100 
	gh
 = ((è
h_št
) / 1e3;

101 ià(
	gÏt
 > 90 ||†at < -90)

102  
	g”rh
->
”rÜ
("%s:†©™udmu¡ bb‘w“À+/- 90 deg»es", 
Çme
().
c_¡r
());

103 ià(
	glÚ
 > 180 ||†on < -180)

104  
	g”rh
->
”rÜ
("%s:†Úg™udmu¡ bb‘w“À+/- 180 deg»es", 
Çme
().
c_¡r
());

106 
	g_Ït0
 = 
Ït
;

107 
	g_lÚ0
 = 
lÚ
;

108 
	g_h0
 = 
h
;

109 
	g_move
 = 
do_move
;

111 
	g_ex‹nded_loggšg_”rh
 = 
rou‹r
()->
ch©‹r_chªÃl
(
chª
);

113  
	g»s
;

116 
	gGridLoÿtiÚInfo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

118 
	g_£q_no
++;

119 
	g»s
 = 
»ad_¬gs
(
cÚf
, 
”rh
);

120 ià(
	g»s
 < 0)

121  
	g»s
;

123 
	g_loggšg_tim”
.
š™Ÿlize
(
this
);

124 
	g_loggšg_tim”
.
scheduË_aá”_m£c
(100);

126  
	g»s
;

130 
	gGridLoÿtiÚInfo
::
	$now
()

132  
Time¡amp
::
	`now
().
	`doubËv®
();

133 
	}
}

136 
	gGridLoÿtiÚInfo
::
	$xÏt
()

138 if(
_move
){

139 (
_Ït0
 + 
_vÏt
 * (
	`now
(è- 
_t0
));

141 (
_Ït0
);

143 
	}
}

146 
	gGridLoÿtiÚInfo
::
	$xlÚ
()

148 if(
_move
){

149 (
_lÚ0
 + 
_vlÚ
 * (
	`now
(è- 
_t0
));

151 (
_lÚ0
);

153 
	}
}

156 
	gGridLoÿtiÚInfo
::
	$unifÜm
()

158 
x
;

160 
x
 = ()
	`şick_¿ndom
() / 0x7fffffff;

161 (
x
);

162 
	}
}

168 
	gGridLoÿtiÚInfo
::
	$choo£_Ãw_Ëg
(*
Æ©
, *
ÆÚ
, *
Á
)

170 *
Æ©
 = 
_Ït0
 + 0.0001 - (
	`unifÜm
() * 0.0002);

171 *
ÆÚ
 = 
_lÚ0
 + 0.0001 - (
	`unifÜm
() * 0.0002);

172 *
Á
 = 
_t0
 + 20 * 
	`unifÜm
();

173 
	}
}

175 
grid_loÿtiÚ


176 
	gGridLoÿtiÚInfo
::
	$g‘_cu¼’t_loÿtiÚ
(*
£q_no
)

178 
t
 = 
	`now
();

180 if(
_move
 =ğ1 && 
t
 >ğ
_t1
){

181 
_Ït0
 = 
	`xÏt
();

182 
_lÚ0
 = 
	`xlÚ
();

183 
_t0
 = 
t
;

184 
Æ©
 = 0, 
ÆÚ
 = 0, 
Á
 = 0;

185 
	`choo£_Ãw_Ëg
(&
Æ©
, &
ÆÚ
, &
Á
);

186 
	`as£¹
(
Á
 > 0);

187 
_vÏt
 = (
Æ©
 - 
_Ït0
è/ (
Á
 - 
_t0
);

188 
_vlÚ
 = (
ÆÚ
 - 
_lÚ0
è/ (
Á
 - 
_t0
);

189 
_t1
 = 
Á
;

190 
_£q_no
++;

193 ià(
_move
 == 2) {

194 
_Ït0
 = 
	`xÏt
();

195 
_lÚ0
 = 
	`xlÚ
();

196 
_t0
 = 
t
;

197 
_£q_no
++;

200 
grid_loÿtiÚ
 
	`gl
(
	`xÏt
(), 
	`xlÚ
(), 
_h0
);

201 ià(
£q_no
 != 0)

202 *
£q_no
 = 
_£q_no
;

203 (
gl
);

204 
	}
}

206 
SŒšg


207 
	$loc_»ad_hªdËr
(
EËm’t
 *
f
, *)

209 
GridLoÿtiÚInfo
 *
l
 = (GridLoÿtiÚInfØ*è
f
;

210 
grid_loÿtiÚ
 
loc
 = 
l
->
	`g‘_cu¼’t_loÿtiÚ
();

212 cÚ¡ 
BUFSZ
 = 255;

213 
buf
[
BUFSZ
];

214 
»s
 = 
	`¢´štf
(
buf
, 
BUFSZ
, "% Ó¼=%hu good=% £q=%u)\n", 
loc
.
	`s
().
	`c_¡r
(),

215 
l
->
	`loc_”r
(), (l->
	`loc_good
(è? "yes" : "no"),†->
	`£q_no
());

216 ià(
»s
 < 0) {

217 
	`şick_ch©‹r
("GridLocationInfo„ead handler bufferoo small");

218  
	`SŒšg
("");

220  
	`SŒšg
(
buf
);

221 
	}
}

225 
	$loc_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–em’t
,

226 *, 
E¼ÜHªdËr
 *
”rh
)

228 
GridLoÿtiÚInfo
 *
l
 = (GridLoÿtiÚInfØ*è
–em’t
;

229 
VeùÜ
<
SŒšg
> 
¬g_li¡
;

230 
	`ı_¬gvec
(
¬g
, 
¬g_li¡
);

232 
l
->
_£q_no
++;

233  
l
->
	`»ad_¬gs
(
¬g_li¡
, 
”rh
);

234 
	}
}

236 
SŒšg


237 
	$g_»ad_hªdËr
(
EËm’t
 *
f
, *)

239 
GridLoÿtiÚInfo
 *
l
 = (GridLoÿtiÚInfØ*è
f
;

240  "g=" + 
l
->
_g
 + "\n";

241 
	}
}

245 
	$g_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–em’t
,

246 *, 
E¼ÜHªdËr
 *)

248 
GridLoÿtiÚInfo
 *
l
 = (GridLoÿtiÚInfØ*è
–em’t
;

249 
l
->
_g
 = 
¬g
;

251 
	}
}

254 
	gGridLoÿtiÚInfo
::
	$add_hªdËrs
()

256 
	`add_wr™e_hªdËr
("loc", 
loc_wr™e_hªdËr
, 0);

257 
	`add_»ad_hªdËr
("loc", 
loc_»ad_hªdËr
, 0);

258 
	`add_wr™e_hªdËr
("g", 
g_wr™e_hªdËr
, 0);

259 
	`add_»ad_hªdËr
("g", 
g_»ad_hªdËr
, 0);

260 
	}
}

264 
	gGridLoÿtiÚInfo
::
	$£t_Ãw_de¡
(
v_Ït
, 
v_lÚ
)

267 ià(
_move
 != 2) {

268 
	`şick_ch©‹r
("%s:‚Ù cÚfigu»dØacû± s‘_Ãw_de¡ dœeùives!", 
	`Çme
().
	`c_¡r
());

272 
t
 = 
	`now
();

274 
_Ït0
 = 
	`xÏt
();

275 
_lÚ0
 = 
	`xlÚ
();

276 
_t0
 = 
t
;

277 
_vÏt
 = 
v_Ït
;

278 
_vlÚ
 = 
v_lÚ
;

279 
	}
}

283 
	ggrid_loÿtiÚ
::
	$ÿlc_¿nge
(cÚ¡ 
grid_loÿtiÚ
 &
l1
, cÚ¡ grid_loÿtiÚ &
l2
)

300 
l1_Ït
 = 
l1
.
	`Ït
(è* 
GRID_RAD_PER_DEG
;

301 
l1_lÚ
 = 
l1
.
	`lÚ
(è* 
GRID_RAD_PER_DEG
;

302 
l2_Ït
 = 
l2
.
	`Ït
(è* 
GRID_RAD_PER_DEG
;

303 
l2_lÚ
 = 
l2
.
	`lÚ
(è* 
GRID_RAD_PER_DEG
;

305 
diff_lÚ
;

306 ià(
	`sign
(
l1_lÚ
è=ğsign(
l2_lÚ
))

307 
diff_lÚ
 = 
	`çbs
(
l1_lÚ
 - 
l2_lÚ
);

309 ià(
	`sign
(
l1_lÚ
) < 0)

310 
diff_lÚ
 = 
l2_lÚ
 - 
l1_lÚ
;

312 
diff_lÚ
 = 
l1_lÚ
 - 
l2_lÚ
;

315 
sš_‹rm
 = 
	`sš
(
l1_Ït
è* sš(
l2_Ït
);

316 
cos_‹rm
 = 
	`cos
(
l1_Ït
è* cos(
l2_Ït
);

317 
cos_dl
 = 
	`cos
(
diff_lÚ
);

318 
cos_g_c
 = 
sš_‹rm
 + 
cos_‹rm
*
cos_dl
;

321 
	#EPSILON
 1.0e-7

	)

322 ià((
cos_g_c
 + 1.0 <ğ
EPSILON
) ||

323 (
cos_g_c
 - 1.0 >ğ
EPSILON
)) {

325 
	`şick_ch©‹r
("cos_g_c: %0.30f", 
cos_g_c
);

326 
	`şick_ch©‹r
("sš_‹rm: %0.30f", 
sš_‹rm
);

327 
	`şick_ch©‹r
("cos_‹rm: %0.30f", 
cos_‹rm
);

328 
	`şick_ch©‹r
("cos_dl: %0.30f", 
cos_dl
);

329 
	`şick_ch©‹r
("l1_Ït: %0.30f", 
l1_Ït
);

330 
	`şick_ch©‹r
("l1_lÚ: %0.30f", 
l1_lÚ
);

331 
	`şick_ch©‹r
("l2_Ït: %0.30f", 
l2_Ït
);

332 
	`şick_ch©‹r
("l2_lÚ: %0.30f", 
l2_lÚ
);

333 
	`şick_ch©‹r
("l1.Ït: %0.30f", 
l1
.
	`Ït
());

334 
	`şick_ch©‹r
("l1.lÚ: %0.30f", 
l1
.
	`lÚ
());

335 
	`şick_ch©‹r
("l2.Ït: %0.30f", 
l2
.
	`Ït
());

336 
	`şick_ch©‹r
("l2.lÚ: %0.30f", 
l2
.
	`lÚ
());

340 
g_c_di¡
 = 
	`acos
(
cos_g_c
è* 
GRID_EARTH_RADIUS
;

342 
dh
 = 
	`çbs
(
l1
.
	`h
(è- 
l2
.h());

343 
r_squ¬ed
 = 
dh
*dh + 
g_c_di¡
*g_c_dist;

344  
	`sq¹
(
r_squ¬ed
);

345 
	}
}

347 
CLICK_ENDDECLS


348 
	$ELEMENT_PROVIDES
(
GridG’”icLocInfo
)

349 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

350 
	`EXPORT_ELEMENT
(
GridLoÿtiÚInfo
)

	@grid/gridlocationinfo.hh

1 #iâdeà
GRIDLOCATIONINFO_HH


2 
	#GRIDLOCATIONINFO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tim”.hh
>

5 
	~"gridg’”işocšfo.hh
"

6 
CLICK_DECLS


79 şas 
	cGridLoÿtiÚInfo
 : 
public
 
GridG’”icLocInfo
 {

81 
public
:

82 
	$GridLoÿtiÚInfo
(è
CLICK_COLD
;

83 ~
	$GridLoÿtiÚInfo
(è
CLICK_COLD
;

85 cÚ¡ *
	$şass_Çme
() const {  "GridLocationInfo"; }

87 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

88 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

89 *
ÿ¡
(const *);

93 
grid_loÿtiÚ
 
g‘_cu¼’t_loÿtiÚ
(*
£q_no
 = 0);

95 
	$add_hªdËrs
(è
CLICK_COLD
;

96 
	`»ad_¬gs
(cÚ¡ 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
);

98 
	`£t_Ãw_de¡
(
v_Ït
, 
v_lÚ
);

100 
	$£q_no
(è{  
_£q_no
; 
	}
}

101 
boŞ
 
	$loc_good
(è{  
_loc_good
; 
	}
}

102 
	$loc_”r
(è{  
_loc_”r
; 
	}
}

104 
	g_£q_no
;

105 
SŒšg
 
	g_g
;

107 
	g´Ùeùed
:

109 
boŞ
 
_loc_good
;

110 
	g_loc_”r
;

112 
	g_move
;

113 
	g_Ït0
;

114 
	g_lÚ0
;

115 
	g_h0
;

116 
	g_t0
;

117 
	g_t1
;

118 
	g_vÏt
;

119 
	g_vlÚ
;

121 
now
();

122 
xÏt
();

123 
xlÚ
();

124 
unifÜm
();

125 
vœtu®
 
choo£_Ãw_Ëg
(*, *, *);

127 
E¼ÜHªdËr
 *
	g_ex‹nded_loggšg_”rh
;

128 
Tim”
 
	g_loggšg_tim”
;

129 
loggšg_hook
(
Tim”
 *, *);

133 
	gCLICK_ENDDECLS


	@grid/gridlocationinfo2.cc

18 
	~<şick/cÚfig.h
>

19 
	~"gridloÿtiÚšfo2.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/”rÜ.hh
>

24 
CLICK_DECLS


26 
	gGridLoÿtiÚInfo2
::
	$GridLoÿtiÚInfo2
()

27 : 
	`_£q_no
(0), 
	`_g
("<unknown>"),

28 
	`_loc_good
(
çl£
), 
	`_loc_”r
(0), 
	$_loc
(0, 0, 0)

30 
	}
}

32 
	gGridLoÿtiÚInfo2
::~
	$GridLoÿtiÚInfo2
()

34 
	}
}

37 
GridLoÿtiÚInfo2
::
	$ÿ¡
(cÚ¡ *
n
)

39 ià(
	`¡rcmp
(
n
, "GridLocationInfo2") == 0 ||

40 
	`¡rcmp
(
n
, "GridGenericLocInfo") == 0)

41  
this
;

43 
	}
}

46 
	gGridLoÿtiÚInfo2
::
»ad_¬gs
(cÚ¡ 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

48 
	gÏt
, 
	glÚ
, 
	gh
 = 0;

49 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

50 .
»ad_mp
("LATITUDE", 
Ït
)

51 .
»ad_mp
("LONGITUDE", 
lÚ
)

52 .
»ad_p
("HEIGHT", 
h
)

53 .
»ad
("LOC_GOOD", 
_loc_good
)

54 .
»ad
("ERR_RADIUS", 
_loc_”r
)

55 .
»ad
("TAG", 
_g
)

56 .
com¶‘e
();

57 ià(
	g»s
 < 0)

58  
	g»s
;

60 cÚ¡ 
	gm£c_³r_deg
 = 1000 * 60 * 60;

62 ià(
	gÏt
 > 90*
	gm£c_³r_deg
 ||†at < -90*msec_per_deg)

63  
	g”rh
->
”rÜ
("%s:†©™ud¬g %d mu¡ bb‘w“À+/- 90 deg»e (+/- %d mli£cÚds)", 
Çme
().
c_¡r
(), 
Ït
, 90*
m£c_³r_deg
);

64 ià(
	glÚ
 > 180*
	gm£c_³r_deg
 ||†on < -180*msec_per_deg)

65  
	g”rh
->
”rÜ
("%s:†Úg™ud¬g %d mu¡ bb‘w“À+/- 180 deg»e (+/- %d mli£cÚds)", 
Çme
().
c_¡r
(), 
lÚ
, 180*
m£c_³r_deg
);

67 
	g_loc
 = 
grid_loÿtiÚ
((
št32_t
è
Ït
, (št32_tè
lÚ
, (št32_tè
h
);

68  
	g»s
;

71 
	gGridLoÿtiÚInfo2
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

73 
	g_£q_no
++;

74 
	g»s
 = 
»ad_¬gs
(
cÚf
, 
”rh
);

75 ià(
	g»s
 < 0)

76  
	g»s
;

78  
	g»s
;

81 
grid_loÿtiÚ


82 
	gGridLoÿtiÚInfo2
::
	$g‘_cu¼’t_loÿtiÚ
(*
£q_no
)

84 ià(
£q_no
 != 0)

85 *
£q_no
 = 
_£q_no
;

86  
_loc
;

87 
	}
}

89 
SŒšg


90 
	$loc_»ad_hªdËr
(
EËm’t
 *
f
, *)

92 
GridLoÿtiÚInfo2
 *
l
 = (GridLoÿtiÚInfo2 *è
f
;

93 
grid_loÿtiÚ
 
loc
 = 
l
->
	`g‘_cu¼’t_loÿtiÚ
();

95 cÚ¡ 
BUFSZ
 = 255;

96 
buf
[
BUFSZ
];

97 
»s
 = 
	`¢´štf
(
buf
, 
BUFSZ
, "% Ó¼=%hu good=% £q=%u)\n", 
loc
.
	`s
().
	`c_¡r
(),

98 
l
->
	`loc_”r
(), (l->
	`loc_good
(è? "yes" : "no"),†->
	`£q_no
());

99 ià(
»s
 < 0) {

100 
	`şick_ch©‹r
("GridLocationInfo2„ead handler bufferoo small");

101  
	`SŒšg
("");

103  
	`SŒšg
(
buf
);

104 
	}
}

108 
	$loc_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–em’t
,

109 *, 
E¼ÜHªdËr
 *
”rh
)

111 
GridLoÿtiÚInfo2
 *
l
 = (GridLoÿtiÚInfo2 *è
–em’t
;

112 
VeùÜ
<
SŒšg
> 
¬g_li¡
;

113 
	`ı_¬gvec
(
¬g
, 
¬g_li¡
);

115 
l
->
_£q_no
++;

116  
l
->
	`»ad_¬gs
(
¬g_li¡
, 
”rh
);

117 
	}
}

119 
SŒšg


120 
	$g_»ad_hªdËr
(
EËm’t
 *
f
, *)

122 
GridLoÿtiÚInfo2
 *
l
 = (GridLoÿtiÚInfo2 *è
f
;

123  "g=" + 
l
->
_g
 + "\n";

124 
	}
}

128 
	$g_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–em’t
,

129 *, 
E¼ÜHªdËr
 *)

131 
GridLoÿtiÚInfo2
 *
l
 = (GridLoÿtiÚInfo2 *è
–em’t
;

132 
l
->
_g
 = 
¬g
;

134 
	}
}

137 
	gGridLoÿtiÚInfo2
::
	$add_hªdËrs
()

139 
	`add_wr™e_hªdËr
("loc", 
loc_wr™e_hªdËr
, 0);

140 
	`add_»ad_hªdËr
("loc", 
loc_»ad_hªdËr
, 0);

141 
	`add_wr™e_hªdËr
("g", 
g_wr™e_hªdËr
, 0);

142 
	`add_»ad_hªdËr
("g", 
g_»ad_hªdËr
, 0);

143 
	}
}

145 
CLICK_ENDDECLS


146 
	$ELEMENT_PROVIDES
(
GridG’”icLocInfo
)

147 
	`EXPORT_ELEMENT
(
GridLoÿtiÚInfo2
)

	@grid/gridlocationinfo2.hh

1 #iâdeà
GRIDLOCATIONINFO2_HH


2 
	#GRIDLOCATIONINFO2_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tim”.hh
>

5 
	~"gridg’”işocšfo.hh
"

6 
CLICK_DECLS


64 şas 
	cGridLoÿtiÚInfo2
 : 
public
 
GridG’”icLocInfo
 {

66 
public
:

67 
GridLoÿtiÚInfo2
();

68 ~
GridLoÿtiÚInfo2
();

70 cÚ¡ *
	$şass_Çme
() const {  "GridLocationInfo2"; }

72 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

73 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

74 *
ÿ¡
(const *);

78 
grid_loÿtiÚ
 
g‘_cu¼’t_loÿtiÚ
(*
£q_no
 = 0);

80 
	$add_hªdËrs
(è
CLICK_COLD
;

81 
	`»ad_¬gs
(cÚ¡ 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
);

83 
	$£q_no
(è{  
_£q_no
; 
	}
}

84 
boŞ
 
	$loc_good
(è{  
_loc_good
; 
	}
}

85 
	$loc_”r
(è{  
_loc_”r
; 
	}
}

87 
	g_£q_no
;

88 
SŒšg
 
	g_g
;

90 
	g´Ùeùed
:

92 
boŞ
 
_loc_good
;

93 
	g_loc_”r
;

94 
grid_loÿtiÚ
 
	g_loc
;

97 
	gCLICK_ENDDECLS


	@grid/gridlogger.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/glue.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~"gridlogg”.hh
"

23 
CLICK_DECLS


25 
	gGridLogg”
::
	$GridLogg”
()

26 : 
	`GridG’”icLogg”
(), 
	`_¡©e
(
WAITING
), 
	`_fd
(-1), 
	$_buåŒ
(0)

28 
	}
}

30 
	gGridLogg”
::~
	$GridLogg”
() {

31 ià(
	`log_is_İ’
())

32 
	`şo£_log
();

33 
	}
}

36 
	gGridLogg”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

38 
SŒšg
 
	glogfe
;

39 
boŞ
 
	gshÜt_
 = 
Œue
;

41 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

42 .
»ad
("LOGFILE", 
logfe
)

43 .
»ad
("SHORT_IP", 
shÜt_
)

44 .
com¶‘e
();

45 ià(
	g»s
 < 0)

46  
	g»s
;

48 
	g_log_fuÎ_
 = !
shÜt_
;

49 ià(
	glogfe
.
Ëngth
() > 0) {

50 
boŞ
 
	gok
 = 
İ’_log
(
logfe
);

51 ià(!
	gok
)

59 
	gGridLogg”
::
	$ÿ¡
(cÚ¡ *
n
)

61 ià(
	`¡rcmp
(
n
, "GridLogger") == 0)

62  (
GridLogg”
 *è
this
;

63 ià(
	`¡rcmp
(
n
, "GridGenericLogger") == 0)

64  (
GridG’”icLogg”
 *è
this
;

67 
	}
}

71 
	gGridLogg”
::
	$add_hªdËrs
()

73 
	`add_»ad_hªdËr
("logfe", 
»ad_logfe
, 0);

74 
	`add_wr™e_hªdËr
("¡¬t_log", 
wr™e_¡¬t_log
, 0);

75 
	`add_wr™e_hªdËr
("¡İ_log", 
wr™e_¡İ_log
, 0);

76 
	}
}

78 
SŒšg


79 
	gGridLogg”
::
	$»ad_logfe
(
EËm’t
 *
e
, *)

81 
GridLogg”
 *
g
 = (GridLogg” *è
e
;

82 ià(
g
->
	`log_is_İ’
())

83  
g
->
_â
 + "\n";

86 
	}
}

89 
	gGridLogg”
::
	$wr™e_¡¬t_log
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
e
,

90 *, 
E¼ÜHªdËr
 *
”rh
)

92 
GridLogg”
 *
g
 = (GridLogg” *è
e
;

93 ià(
g
->
	`log_is_İ’
())

94 
g
->
	`şo£_log
();

95 
boŞ
 
»s
 = 
g
->
	`İ’_log
(
¬g
);

96 ià(!
»s
)

97  
”rh
->
	`”rÜ
("uÇbËØİ’†ogf``%s''", ((
SŒšg
è
¬g
).
	`c_¡r
());

99 
	}
}

102 
	gGridLogg”
::
	$wr™e_¡İ_log
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
,

103 *, 
E¼ÜHªdËr
 *)

105 
GridLogg”
 *
g
 = (GridLogg” *è
e
;

106 ià(
g
->
	`log_is_İ’
())

107 
g
->
	`şo£_log
();

109 
	}
}

111 
boŞ


112 
	gGridLogg”
::
	$İ’_log
(cÚ¡ 
SŒšg
 &
f’ame
)

114 
SŒšg
 
Ãw_â
 = 
f’ame
;

115 
Ãw_fd
 = 
	`İ’
(
Ãw_â
.
	`c_¡r
(), 
O_WRONLY
 | 
O_CREAT
, 0777);

116 ià(
Ãw_fd
 == -1) {

117 
	`şick_ch©‹r
("GridLogger %s: unableo open†og file ``%s'': %s",

118 
	`Çme
().
	`c_¡r
(), 
Ãw_â
.c_¡r(), 
	`¡»¼Ü
(
”ºo
));

119 ià(
	`log_is_İ’
())

120 
	`şick_ch©‹r
("Gridlogger %s:…revious†oggingo ``%s'' is stillƒnabled",

121 
	`Çme
().
	`c_¡r
(), 
_â
.c_str());

122  
çl£
;

125 ià(
	`log_is_İ’
())

126 
	`şo£_log
();

128 
_fd
 = 
Ãw_fd
;

129 
_â
 = 
Ãw_â
;

131 
	`şick_ch©‹r
("GridLogg” %s: s¹ed†oggšgØ%s", 
	`Çme
().
	`c_¡r
(), 
_â
.c_str());

132  
Œue
;

133 
	}
}

136 
	gGridLogg”
::
	$şo£_log
() {

137 ià(
_fd
 != -1) {

138 
	`şo£
(
_fd
);

139 
_fd
 = -1;

140 
	`şick_ch©‹r
("GridLogg” %s: stİ³d†oggšg oÀ%s", 
	`Çme
().
	`c_¡r
(), 
_â
.c_str());

141 
_â
 = "";

143 
	}
}

145 
CLICK_ENDDECLS


146 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

147 
	$ELEMENT_PROVIDES
(
GridG’”icLogg”
)

148 
	`EXPORT_ELEMENT
(
GridLogg”
)

	@grid/gridlogger.hh

1 #iâdeà
GRIDLOGGER_HH


2 
	#GRIDLOGGER_HH


	)

3 
	~<sys/ty³s.h
>

4 
	~<sys/uio.h
>

5 
	~<uni¡d.h
>

6 
	~<fú.h
>

7 
	~<şickÃt/‘h”.h
>

8 
	~<şickÃt/.h
>

9 
	~<şickÃt/udp.h
>

10 
	~<şick/¡ršg.hh
>

11 
	~<şick/–em’t.hh
>

12 
	~"grid.hh
"

13 
	~"gridg’”iüt.hh
"

14 
	~"gridg’”işogg”.hh
"

15 
CLICK_DECLS


65 şas 
	cGridLogg”
 : 
public
 
GridG’”icLogg”
 {

67 
	e¡©e_t
 {

68 
WAITING
,

69 
	mRECV_AD
,

70 
	mEXPIRE_HANDLER


73 
¡©e_t
 
	g_¡©e
;

75 
	g_fd
;

76 
SŒšg
 
	g_â
;

77 
boŞ
 
	g_log_fuÎ_
;

79 
	g_buf
[1024];

80 
size_t
 
	g_buåŒ
;

82 
boŞ
 
	$check_¡©e
(
¡©e_t
 
s
) {

83 
	`as£¹
(
_¡©e
 =ğ
s
);

84  
_¡©e
 =ğ
s
;

85 
	}
}

87 
boŞ
 
	$check_¥aû
(
size_t
 
Ãeded
) {

88 
size_t
 
ava
 = (
_buf
è- 
_buåŒ
;

89 ià(
ava
 < 
Ãeded
) {

90 
	`şick_ch©‹r
("GridLogger %s:†og buffer isoo small.otal buf size: %u,‚eeded‡t†east %u",

91 
	`Çme
().
	`c_¡r
(), (
_buf
), 
Ãeded
 + 
_buåŒ
);

92  
çl£
;

94  
Œue
;

95 
	}
}

96 
	$wr™e_buf
() {

97 ià(!
	`log_is_İ’
()) {

98 
_buåŒ
 = 0;

101 
»s
 = 
	`wr™e
(
_fd
, 
_buf
, 
_buåŒ
);

102 ià(
»s
 < 0)

103 
	`şick_ch©‹r
("GridLogger %s:ƒrror writing†og buffer: %s",

104 
	`Çme
().
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

105 ià(
»s
 !ğ(è
_buåŒ
)

106 
	`şick_ch©‹r
("GridLogger %s: bad writeo†og buffer, had %u bytes in buffer but wrote %d bytes",

107 
	`Çme
().
	`c_¡r
(), (è
_buåŒ
, 
»s
);

108 
_buåŒ
 = 0;

109 
	}
}

110 
	$ş—r_buf
(è{ 
_buåŒ
 = 0; 
	}
}

111 
size_t
 
	$bufsz
(è{  
_buåŒ
; 
	}
}

112 
	$add_by‹s
(*
by‹s
, 
size_t
 
n
) {

113 ià(!
	`check_¥aû
(
n
))

115 
	`memıy
(
_buf
 + 
_buåŒ
, 
by‹s
, 
n
);

116 
_buåŒ
 +ğ
n
;

117 
	}
}

118 
	$add_Úe_by‹
(
c
è{ 
	`add_by‹s
(&c, 1); 
	}
}

119 
	$add_
(

) {

120 ià(
_log_fuÎ_
)

121 
	`add_by‹s
(&

, (ip));

123 
	`add_Úe_by‹
(
	`Áohl
(

) & 0xff);

124 
	}
}

125 
	$add_lÚg
(
v
) {

126 
v
 = 
	`htÚl
(v);

127 
	`add_by‹s
(&
v
, (v));

128 
	}
}

129 
	$dump_buf
() {

130 
size_t
 
i
 = 0; i < 
_buåŒ
; i++)

131 
	`şick_ch©‹r
("XXXX %x ", (è
_buf
[
i
]);

132 
	}
}

133 
	$add_timev®
(
timev®
 
tv
) {

134 
tv
.
tv_£c
 = 
	`htÚl
(tv.tv_sec);

135 
tv
.
tv_u£c
 = 
	`htÚl
(tv.tv_usec);

136 
	`add_by‹s
(&
tv
, (tv));

137 
	}
}

139 
	$log_pkt
(
şick_‘h”
 *
eh
) {

140 
grid_hdr
 *
gh
 = (grid_hd¸*è(
eh
 + 1);

141 
	`add_Úe_by‹
(
gh
->
ty³
);

142 
gh
->
ty³
) {

143 
grid_hdr
::
GRID_LR_HELLO
:

144 
grid_hdr
::
GRID_HELLO
: {

145 
grid_h–lo
 *
hlo
 = (grid_h–lØ*è(
gh
 + 1);

146 
	`add_lÚg
(
	`Áohl
(
hlo
->
£q_no
));

149 
grid_hdr
::
GRID_NBR_ENCAP
: {

150 
grid_nbr_’ÿp
 *
nbr
 = (grid_nbr_’ÿ°*è(
gh
 + 1);

151 
	`add_
(
gh
->

);

152 
	`add_
(
nbr
->
d¡_
);

153 
	`add_by‹s
(
eh
->
‘h”_dho¡
, 6);

154 
	`log_¥ecŸl_pkt
((
şick_
 *è(
nbr
 + 1));

160 
	}
}

162 
	$log_¥ecŸl_pkt
(
şick_
 *

) {

163 
boŞ
 
¥ecŸl
 = 
çl£
;

164 ià(

->
_p
 =ğ
IP_PROTO_UDP
) {

165 
şick_udp
 *
udp
 = (şick_ud°*è(

 + 1);

166 ià(
udp
->
uh_dpÜt
 =ğ
	`htÚs
(8021)) {

168 
¥ecŸl
 = 
Œue
;

169 *
d©a
 = (*è(
udp
 + 1);

170 
num_£Á
 = 0;

171 
	`memıy
(&
num_£Á
, 
d©a
, 4);

172 
	`add_Úe_by‹
(
SPECIAL_PKT_CODE
);

173 
	`add_lÚg
(
num_£Á
);

176 ià(!
¥ecŸl
)

177 
	`add_Úe_by‹
(
BORING_PKT_CODE
);

178 
	}
}

180 
	gpublic
:

182 
	$GridLogg”
(è
CLICK_COLD
;

183 ~
	$GridLogg”
(è
CLICK_COLD
;

185 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "GridLogg”"; 
	}
}

186 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

187 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
çl£
; 
	}
}

188 *
ÿ¡
(const *);

189 
	$add_hªdËrs
(è
CLICK_COLD
;

192 
SŒšg
 
	`»ad_logfe
(
EËm’t
 *, *);

193 
	`wr™e_¡¬t_log
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

194 
	`wr™e_¡İ_log
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

196 
boŞ
 
	`İ’_log
(cÚ¡ 
SŒšg
 &);

197 
	`şo£_log
();

198 
boŞ
 
	$log_is_İ’
(è{  
_fd
 >ğ0; 
	}
}

200 
	g´iv©e
:

202 cÚ¡ 
SENT_AD_CODE
 = 0x01;

203 cÚ¡ 
	gBEGIN_RECV_CODE
 = 0x02;

204 cÚ¡ 
	gEND_RECV_CODE
 = 0x03;

205 cÚ¡ 
	gBEGIN_EXPIRE_CODE
 = 0x04;

206 cÚ¡ 
	gEND_EXPIRE_CODE
 = 0x05;

207 cÚ¡ 
	gTRUNCATED_CODE
 = 0x06;

208 cÚ¡ 
	gRECV_ADD_ROUTE_CODE
 = 0x07;

209 cÚ¡ 
	gRECV_TRIGGER_ROUTE_CODE
 = 0x08;

210 cÚ¡ 
	gRECV_EXPIRE_ROUTE_CODE
 = 0x09;

211 cÚ¡ 
	gROUTE_DUMP_CODE
 = 0x0A;

212 cÚ¡ 
	gTX_ERR_CODE
 = 0x0B;

213 cÚ¡ 
	gNO_ROUTE_CODE
 = 0x0C;

214 cÚ¡ 
	gSPECIAL_PKT_CODE
 = 0x0D;

215 cÚ¡ 
	gBORING_PKT_CODE
 = 0x0E;

216 cÚ¡ 
	gRECV_ADD_ROUTE_CODE_EXTRA
 = 0x0F;

218 
	gpublic
:

220 
	$log_£Á_adv”ti£m’t
(
£q_no
, cÚ¡ 
Time¡amp
 &
wh’
) {

221 ià(!
	`check_¡©e
(
WAITING
))

223 ià(!
	`check_¥aû
(1 + (
£q_no
è+ (
wh’
)))

225 
	`add_Úe_by‹
(
SENT_AD_CODE
);

226 
	`add_lÚg
(
£q_no
);

227 
	`add_timev®
(
wh’
.
	`timev®
());

228 
	`wr™e_buf
();

229 
	}
}

231 
	$log_¡¬t_»cv_adv”ti£m’t
(
£q_no
, 

, cÚ¡ 
Time¡amp
 &
wh’
) {

232 ià(!
	`check_¡©e
(
WAITING
))

234 
_¡©e
 = 
RECV_AD
;

235 
	`add_Úe_by‹
(
BEGIN_RECV_CODE
);

236 
	`add_
(

);

237 
	`add_lÚg
(
£q_no
);

238 
	`add_timev®
(
wh’
.
	`timev®
());

239 
	}
}

241 
	$log_added_rou‹
(
»asÚ_t
 
why
, cÚ¡ 
GridG’”icRou‹TabË
::
Rou‹EÁry
 &
r
) {

242 ià(!
	`check_¡©e
(
RECV_AD
))

244 
	`add_Úe_by‹
(
RECV_ADD_ROUTE_CODE
);

245 
	`add_Úe_by‹
(
why
);

246 
	`add_
(
r
.
de¡_
);

247 
	`add_
(
r
.
Ãxt_hİ_
);

248 
	`add_Úe_by‹
(
r
.
	`num_hİs
());

249 
	`add_lÚg
(
r
.
	`£q_no
());

250 
	}
}

252 
	$log_added_rou‹
(
»asÚ_t
 
why
, cÚ¡ 
GridG’”icRou‹TabË
::
Rou‹EÁry
 &
r
, cÚ¡ 
exŒa
) {

253 ià(!
	`check_¡©e
(
RECV_AD
))

255 
	`add_Úe_by‹
(
RECV_ADD_ROUTE_CODE_EXTRA
);

256 
	`add_Úe_by‹
(
why
);

257 
	`add_
(
r
.
de¡_
);

258 
	`add_
(
r
.
Ãxt_hİ_
);

259 
	`add_Úe_by‹
(
r
.
	`num_hİs
());

260 
	`add_lÚg
(
r
.
	`£q_no
());

261 
	`add_lÚg
(
exŒa
);

262 
	}
}

264 
	$log_expœed_rou‹
(
»asÚ_t
 
why
, 

) {

265 ià(
_¡©e
 !ğ
RECV_AD
 && _¡©!ğ
EXPIRE_HANDLER
) {

266 
	`as£¹
(0);

269 ià(
_¡©e
 =ğ
RECV_AD
) {

270 
	`add_Úe_by‹
(
RECV_EXPIRE_ROUTE_CODE
);

271 
	`add_
(

);

274 
	`add_Úe_by‹
(
why
);

275 
	`add_
(

);

277 
	}
}

279 
	$log_Œigg”ed_rou‹
(

) {

280 ià(!
	`check_¡©e
(
RECV_AD
))

282 
	`add_Úe_by‹
(
RECV_TRIGGER_ROUTE_CODE
);

283 
	`add_
(

);

284 
	}
}

286 
	$log_’d_»cv_adv”ti£m’t
() {

287 ià(!
	`check_¡©e
(
RECV_AD
))

289 
_¡©e
 = 
WAITING
;

290 
	`add_Úe_by‹
(
END_RECV_CODE
);

291 
	`wr™e_buf
();

292 
	}
}

294 
	$log_¡¬t_expœe_hªdËr
(cÚ¡ 
Time¡amp
 &
wh’
) {

295 ià(!
	`check_¡©e
(
WAITING
))

297 
_¡©e
 = 
EXPIRE_HANDLER
;

298 
	`add_Úe_by‹
(
BEGIN_EXPIRE_CODE
);

299 
	`add_timev®
(
wh’
.
	`timev®
());

300 
	}
}

302 
	$log_’d_expœe_hªdËr
() {

303 ià(!
	`check_¡©e
(
EXPIRE_HANDLER
))

305 
_¡©e
 = 
WAITING
;

306 
	`add_Úe_by‹
(
END_EXPIRE_CODE
);

307 ià(
	`bufsz
(è<ğ2 + (
timev®
))

308 
	`ş—r_buf
();

310 
	`wr™e_buf
();

311 
	}
}

313 
log_rou‹_dump
(cÚ¡ 
VeùÜ
<
GridG’”icRou‹TabË
::
Rou‹EÁry
> &
¹
, cÚ¡ 
Time¡amp
 &
wh’
) {

314 ià(!
check_¡©e
(
WAITING
))

316 
add_Úe_by‹
(
ROUTE_DUMP_CODE
);

317 
add_timev®
(
wh’
.
timev®
());

318 
	gn
 = 
¹
.
size
();

319 
add_lÚg
(
n
);

320 
	gi
 = 0; i < 
	g¹
.
size
(); i++) {

321 cÚ¡ 
	gGridG’”icRou‹TabË
::
Rou‹EÁry
 &
r
 = 
¹
[
i
];

322 
add_
(
r
.
de¡_
);

323 
add_
(
r
.
Ãxt_hİ_
);

324 
add_Úe_by‹
(
r
.
num_hİs
());

325 
add_lÚg
(
r
.
£q_no
());

327 
wr™e_buf
();

331 
	$log_tx_”r
(cÚ¡ 
Pack‘
 *
p
, 
”r
, cÚ¡ 
Time¡amp
 &
wh’
) {

332 ià(!
	`check_¡©e
(
WAITING
))

334 
şick_‘h”
 *
eh
 = (şick_‘h” *è(
p
->
	`d©a
());

335 ià(
eh
->
‘h”_ty³
 !ğ
	`htÚs
(
ETHERTYPE_GRID
))

337 
	`add_Úe_by‹
(
TX_ERR_CODE
);

338 
	`add_timev®
(
wh’
.
	`timev®
());

339 
	`add_lÚg
((è
”r
);

340 
	`log_pkt
(
eh
);

341 
	`wr™e_buf
();

342 
	}
}

344 
	$log_no_rou‹
(cÚ¡ 
Pack‘
 *
p
, cÚ¡ 
Time¡amp
 &
wh’
) {

345 ià(!
	`check_¡©e
(
WAITING
))

347 
şick_‘h”
 *
eh
 = (şick_‘h” *è(
p
->
	`d©a
());

348 ià(
eh
->
‘h”_ty³
 !ğ
	`htÚs
(
ETHERTYPE_GRID
))

350 
	`add_Úe_by‹
(
NO_ROUTE_CODE
);

351 
	`add_timev®
(
wh’
.
	`timev®
());

352 
	`log_pkt
(
eh
);

353 
	`wr™e_buf
();

354 
	}
}

358 
	gCLICK_ENDDECLS


	@grid/gridprobehandler.cc

18 
	~<şick/cÚfig.h
>

19 
	~"grid´obehªdËr.hh
"

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/‘h”add»ss.hh
>

22 
	~<şick/add»ss.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/glue.hh
>

26 
	~<şick/rou‹r.hh
>

27 
	~"grid.hh
"

28 
CLICK_DECLS


30 
	gGridProbeHªdËr
::
	$GridProbeHªdËr
() :

31 
	`_gf_cb_id
(-1), 
	`_fq_cb_id
(-1), 
	`_Ì_cb_id
(-1),

32 
	`_Ì_–
(0), 
	`_gf_–
(0), 
	`_fq_–
(0),

33 
	$_ÿched_»¶y_pkt
(0)

35 
	}
}

38 
	gGridProbeHªdËr
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

40 ià(!
_Ì_–
 || !_Ì_–->
	`ÿ¡
("LookupLocalGridRoute")) {

41 
”rh
->
	`w¬nšg
("%s: LookupLocalGridRoute‡rgument is missing or hashe wrongype,…robe„eplies will‚ot contain‡ll info",

42 
	`Çme
().
	`c_¡r
());

43 
_Ì_–
 = 0;

45 ià(!
_gf_–
 || !_gf_–->
	`ÿ¡
("LookupGeographicGridRoute")) {

46 
”rh
->
	`w¬nšg
("%s: LookupGeographicGridRoute‡rgument is missing or hashe wrongype,…robe„eplies will‚ot contain‡ll info",

47 
	`Çme
().
	`c_¡r
());

48 
_gf_–
 = 0;

50 ià(!
_fq_–
 || !_fq_–->
	`ÿ¡
("FloodingLocQuerier")) {

51 
”rh
->
	`w¬nšg
("%s: FloodingLocQuerier‡rgument is missing or hashe wrongype,…robe„eplies will‚ot contain‡ll info",

52 
	`Çme
().
	`c_¡r
());

53 
_fq_–
 = 0;

56 ià(
_Ì_–
)

57 
_Ì_cb_id
 = 
_Ì_–
->
	`add_ÿÎback
(
this
);

58 ià(
_gf_–
)

59 
_gf_cb_id
 = 
_gf_–
->
	`add_ÿÎback
(
this
);

60 ià(
_fq_–
)

61 
_fq_cb_id
 = 
_fq_–
->
	`add_ÿÎback
(
this
);

63 ià(
_Ì_cb_id
 < 0)

64 
”rh
->
	`w¬nšg
("%s: unableo install†ocal„outing‡ction callback,…robe„eplies will‚ot contain‡ll info",

65 
	`Çme
().
	`c_¡r
());

66 ià(
_gf_cb_id
 < 0)

67 
”rh
->
	`w¬nšg
("%s: unableo install geographic forwarding‡ction callback,…robe„eplies will‚ot contain‡ll info",

68 
	`Çme
().
	`c_¡r
());

69 ià(
_fq_cb_id
 < 0)

70 
”rh
->
	`w¬nšg
("%s: unableo install†oc query‡ction callback,…robe„eplies will‚ot contain‡ll info",

71 
	`Çme
().
	`c_¡r
());

74 
	}
}

76 
	gGridProbeHªdËr
::~
	$GridProbeHªdËr
()

78 
	}
}

82 
GridProbeHªdËr
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

84  
Args
(
cÚf
, 
this
, 
”rh
)

85 .
»ad_mp
("ETH", 
_‘h
)

86 .
»ad_mp
("IP", 
_
)

87 .
»ad_p
("GRIDROUTE", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_Ì_–
))

88 .
»ad_p
("GEOGRAPHICROUTE", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_gf_–
))

89 .
»ad_p
("LOCQUERIER", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_fq_–
))

90 .
com¶‘e
();

95 
	gGridProbeHªdËr
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

97 
	`as£¹
(
pÜt
 == 0);

98 
	`as£¹
(
p
);

100 
şick_‘h”
 *
e
 = (şick_‘h” *è
p
->
	`d©a
();

101 
grid_hdr
 *
gh
 = (grid_hd¸*è(
e
 + 1);

102 
grid_nbr_’ÿp
 *
nb
 = (grid_nbr_’ÿ°*è(
gh
 + 1);

103 
grid_rou‹_´obe
 *
½
 = (grid_rou‹_´ob*è(
nb
 + 1);

105 ià(
gh
->
ty³
 !ğ
grid_hdr
::
GRID_ROUTE_PROBE
) {

106 
	`şick_ch©‹r
("GridProbeHandler %s:„eceived unexpected Grid…acketype %s; ishe configuration wrong?",

107 
	`Çme
().
	`c_¡r
(), 
grid_hdr
::
	`ty³_¡ršg
(
gh
->
ty³
).c_str());

108 
p
->
	`kl
();

113 
grid_hdr
 *
gh2
;

114 
grid_nbr_’ÿp
 *
nb2
;

115 
grid_rou‹_»¶y
 *
¼
;

116 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((*
e
è+ (*
gh2
è+ (*
nb2
è+ (*
¼
) + 2);

117 
q
->
	`puÎ
(2);

119 
q
->
	`£t_time¡amp_ªno
(
Time¡amp
::
	`now
());

121 
	`mem£t
(
q
->
	`d©a
(), 0, q->
	`Ëngth
());

122 
e
 = (
şick_‘h”
 *è
q
->
	`d©a
();

123 
gh2
 = (
grid_hdr
 *è(
e
 + 1);

124 
nb2
 = (
grid_nbr_’ÿp
 *è(
gh2
 + 1);

125 
¼
 = (
grid_rou‹_»¶y
 *è(
nb2
 + 1);

127 
e
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_GRID
);

130 
gh2
->
hdr_Ën
 = (
grid_hdr
);

131 
gh2
->
ty³
 = 
grid_hdr
::
GRID_ROUTE_REPLY
;

132 
gh2
->

 = 
_
;

133 
gh2
->
tÙ®_Ën
 = 
	`htÚs
(
q
->
	`Ëngth
(è- (
şick_‘h”
));

135 
nb2
->
d¡_
 = 
gh
->

;

136 #iâdeà
SMALL_GRID_HEADERS


137 
nb2
->
d¡_loc_good
 = 
çl£
;

139 
nb2
->
hİs_Œav–Ëd
 = 0;

141 
¼
->
nÚû
 = 
½
->nonce;

142 
¼
->
´obe_£nd_time
 = 
½
->
£nd_time
;

144 
¼
->
´obe_de¡
 = 
nb
->
d¡_
;

145 
¼
->
»¶y_hİ
 = 
nb
->
hİs_Œav–Ëd
;

148 ià(
_ÿched_»¶y_pkt
 != 0) {

149 
	`şick_ch©‹r
("GridProbeHandler:ƒrror!!! cached„eply…acket was deleted before being sent;he‡ppropriate„oute‡ction callback was‚ot„eceived\n");

150 
_ÿched_»¶y_pkt
->
	`kl
();

151 
_ÿched_»¶y_pkt
 = 0;

156 ià(
_Ì_–
 && 
_gf_–
 && 
_fq_–


157 && 
_Ì_cb_id
 > -1 && 
_gf_cb_id
 > -1 && 
_fq_cb_id
 > -1) {

159 ià(
_
 !ğ
nb
->
d¡_
) {

162 
_ÿched_»¶y_pkt
 = 
q
;

163 
	`£t_rou‹_cb_b™
(
p
, 
_gf_cb_id
);

164 
	`£t_rou‹_cb_b™
(
p
, 
_Ì_cb_id
);

165 
	`£t_rou‹_cb_b™
(
p
, 
_fq_cb_id
);

170 
¼
->
rou‹_aùiÚ
 = 
	`htÚl
(
ProbeFšished
);

171 
_ÿched_»¶y_pkt
 = 0;

172 
	`ouut
(1).
	`push
(
q
);

178 
¼
->
rou‹_aùiÚ
 = 
	`htÚl
(
UnknownAùiÚ
);

179 
_ÿched_»¶y_pkt
 = 0;

180 
	`ouut
(1).
	`push
(
q
);

185 ià(
_
 !ğ
nb
->
d¡_
)

186 
	`ouut
(0).
	`push
(
p
);

188 
p
->
	`kl
();

189 
	}
}

192 
	gGridProbeHªdËr
::
	$rou‹_cb
(
id
, 
de¡_
, 
AùiÚ
 
a
, 
d©a
, 
d©a2
)

194 ià(
id
 !ğ
_Ì_cb_id
 && id !ğ
_gf_cb_id
 && id !ğ
_fq_cb_id
) {

195 
	`şick_ch©‹r
("GridProbeHandler:ƒrror!!!„oute‡ction callback invoked withhe wrong callback id\n");

196 ià(
_ÿched_»¶y_pkt
) {

197 
_ÿched_»¶y_pkt
->
	`kl
();

198 
_ÿched_»¶y_pkt
 = 0;

203 ià(!
_ÿched_»¶y_pkt
) {

204 
	`şick_ch©‹r
("GridProbeHandler:ƒrror!!!„oute‡ction callback invoked, buthere is‚o…robe„eply cached\n");

208 
grid_rou‹_»¶y
 *
¼
 = (grid_rou‹_»¶y *è(
_ÿched_»¶y_pkt
->
	`d©a
(è+ (
şick_‘h”
)

209 + (
grid_hdr
è+ (
grid_nbr_’ÿp
));

210 ià(
¼
->
´obe_de¡
 !ğ
de¡_
) {

211 
	`şick_ch©‹r
("GridProbeHandler:ƒrror!!!„oute‡ction callback…robe dest‡rg does‚ot match cached„eply\n");

212 
_ÿched_»¶y_pkt
->
	`kl
();

213 
_ÿched_»¶y_pkt
 = 0;

217 
¼
->
rou‹_aùiÚ
 = 
	`htÚl
(
a
);

218 
¼
->
d©a1
 = 
	`htÚl
(
d©a
);

219 
¼
->
d©a2
 = 
	`htÚl
(data2);

221 
a
) {

222 
QueuedFÜLocQu”y
:

223 
S’dToIP
:

224 
FÜw¬dDSDV
:

225 
FÜw¬dGF
:

226 
Drİ
:

227 
	`ouut
(1).
	`push
(
_ÿched_»¶y_pkt
);

228 
_ÿched_»¶y_pkt
 = 0;

230 
F®lbackToGF
:

231 
NoLocQu”yN“ded
:

232 
CachedLocFound
:

236 
ProbeFšished
:

237 
	`şick_ch©‹r
("GridProbeHªdËr:ƒ¼Ü!!!„ou‹‡ùiÚ c®lback invoked w™h ProbeFšished‡ùiÚ, buˆGridProbeHªdË¸should kÈ´obªd s’d„•ly iÀthi ÿ£\n", 
a
);

238 
UnknownAùiÚ
:

240 
	`şick_ch©‹r
("GridProbeHªdËr:ƒ¼Ü!!!„ou‹‡ùiÚ c®lback invoked w™h‡ÀunknowÀaùiÚ (%d), s’dšg„•ly‚ow\n", 
a
);

241 
	`ouut
(1).
	`push
(
_ÿched_»¶y_pkt
);

242 
_ÿched_»¶y_pkt
 = 0;

245 
	}
}

247 
CLICK_ENDDECLS


248 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

249 
	`EXPORT_ELEMENT
(
GridProbeHªdËr
)

	@grid/gridprobehandler.hh

1 #iâdeà
GRIDPROBEHANDLER_HH


2 
	#GRIDPROBEHANDLER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/add»ss.hh
>

6 
	~<şick/veùÜ.hh
>

7 
	~<şick/bighashm­.hh
>

8 
	~<şick/tim”.hh
>

9 
	~"gridrou‹cb.hh
"

10 
	~"looku¶oÿlgridrou‹.hh
"

11 
	~"lookupgeogridrou‹.hh
"

12 
	~"æoodšglocqu”›r.hh
"

13 
CLICK_DECLS


35 
şass
 
	gGridProbeHªdËr
 : 
public
 
EËm’t
, 
	gGridRou‹AùiÚC®lback
 {

37 
	gpublic
:

38 
GridProbeHªdËr
(è
CLICK_COLD
;

39 ~
GridProbeHªdËr
(è
	gCLICK_COLD
;

41 cÚ¡ *
şass_Çme
() const {  "GridProbeHandler"; }

42 cÚ¡ *
pÜt_couÁ
() const {  "1/2"; }

43 cÚ¡ *
´oûssšg
(ècÚ¡ {  
	gPUSH
; }

44 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

45 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

47 
push
(, 
Pack‘
 *);

49 
rou‹_cb
(
id
, 
de¡_
, 
AùiÚ
 
a
, 
d©a
, 
d©a2
);

51 
	g´iv©e
:

52 
Eth”Add»ss
 
_‘h
;

53 
IPAdd»ss
 
	g_
;

55 
	g_gf_cb_id
;

56 
	g_fq_cb_id
;

57 
	g_Ì_cb_id
;

59 
LookupLoÿlGridRou‹
 *
	g_Ì_–
;

60 
LookupGeog¿phicGridRou‹
 *
	g_gf_–
;

61 
FloodšgLocQu”›r
 *
	g_fq_–
;

63 
Pack‘
 *
	g_ÿched_»¶y_pkt
;

66 
	gCLICK_ENDDECLS


	@grid/gridprobereplyreceiver.cc

18 
	~<şick/cÚfig.h
>

19 
	~"grid´ob”•ly»ûiv”.hh
"

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/‘h”add»ss.hh
>

22 
	~<şick/add»ss.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/glue.hh
>

26 
	~<şick/rou‹r.hh
>

27 
	~"grid.hh
"

28 
	~"timeuts.hh
"

29 
CLICK_DECLS


31 
	gGridProbeR•lyReûiv”
::
	$GridProbeR•lyReûiv”
()

33 
	}
}

36 
GridProbeR•lyReûiv”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

39 
	}
}

41 
	gGridProbeR•lyReûiv”
::~
	$GridProbeR•lyReûiv”
()

43 
	}
}

47 
GridProbeR•lyReûiv”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

49 
SŒšg
 
	gchª
;

50 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

51 .
»ad_mp
("CHANNEL", 
chª
)

52 .
com¶‘e
();

53 ià(
	g»s
 < 0)

54  
	g»s
;

55 
	g_»¶_”rh
 = 
rou‹r
()->
ch©‹r_chªÃl
(
chª
);

56 
as£¹
(
_»¶_”rh
);

57  
	g»s
;

61 
Pack‘
 *

62 
	gGridProbeR•lyReûiv”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

64 
şick_‘h”
 *
e
 = (şick_‘h” *è
p
->
	`d©a
();

65 
grid_hdr
 *
gh
 = (grid_hd¸*è(
e
 + 1);

66 
grid_nbr_’ÿp
 *
nb
 = (grid_nbr_’ÿ°*è(
gh
 + 1);

67 
grid_rou‹_»¶y
 *
¼
 = (grid_rou‹_»¶y *è(
nb
 + 1);

69 ià(
gh
->
ty³
 !ğ
grid_hdr
::
GRID_ROUTE_REPLY
) {

70 
	`şick_ch©‹r
("GridProbeReplyReceiver %s:„eceived unexpected Grid…acketype %s; ishe configuration wrong?",

71 
	`Çme
().
	`c_¡r
(), 
grid_hdr
::
	`ty³_¡ršg
(
gh
->
ty³
).c_str());

72 
p
->
	`kl
();

76 
timev®
 
tx_time
 = 
¼
->
´obe_£nd_time
;

77 
tx_time
.
tv_£c
 = 
	`Áohl
(tx_time.tv_sec);

78 
tx_time
.
tv_u£c
 = 
	`Áohl
(tx_time.tv_usec);

80 
timev®
 
¹t
 = 
p
->
	`time¡amp_ªno
().
	`timev®
(è- 
tx_time
;

82 
buf
[200];

83 
	`¢´štf
(
buf
, (buf),

85 
	`IPAdd»ss
(
¼
->
´obe_de¡
).
	`uÅ¬£
().
	`c_¡r
(),

86 (è
	`Áohl
(
¼
->
nÚû
),

87 
	`IPAdd»ss
(
gh
->

).
	`uÅ¬£
().
	`c_¡r
(),

88 (è
¼
->
»¶y_hİ
,

89 (è
¹t
.
tv_£c
, (è¹t.
tv_u£c
,

90 (è
tx_time
.
tv_£c
,

91 (è
tx_time
.
tv_u£c
,

92 (è
	`Áohl
(
¼
->
rou‹_aùiÚ
),

93 (è
	`Áohl
(
¼
->
d©a1
),

94 (è
	`Áohl
(
¼
->
d©a2
));

96 
_»¶_”rh
->
	`mes§ge
(
buf
);

97 
p
->
	`kl
();

99 
	}
}

101 
CLICK_ENDDECLS


102 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

103 
	`EXPORT_ELEMENT
(
GridProbeR•lyReûiv”
)

	@grid/gridprobereplyreceiver.hh

1 #iâdeà
GRIDPROBEREPLYRECEIVER_HH


2 
	#GRIDPROBEREPLYRECEIVER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/add»ss.hh
>

6 
	~<şick/veùÜ.hh
>

7 
	~<şick/bighashm­.hh
>

8 
	~<şick/tim”.hh
>

9 
CLICK_DECLS


32 şas 
	cGridProbeR•lyReûiv”
 : 
public
 
EËm’t
 {

34 
public
:

35 
	$GridProbeR•lyReûiv”
(è
CLICK_COLD
;

36 ~
	$GridProbeR•lyReûiv”
(è
CLICK_COLD
;

38 cÚ¡ *
	$şass_Çme
() const {  "GridProbeReplyReceiver"; }

39 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_0
; 
	}
}

40 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

41 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

42 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

44 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

46 
´iv©e
:

47 
E¼ÜHªdËr
 *
_»¶_”rh
;

48 
	}
};

50 
	gCLICK_ENDDECLS


	@grid/gridprobesender.cc

18 
	~<şick/cÚfig.h
>

19 
	~"grid´obe£nd”.hh
"

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/‘h”add»ss.hh
>

22 
	~<şick/add»ss.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/glue.hh
>

26 
	~"grid.hh
"

27 
CLICK_DECLS


29 
	gGridProbeS’d”
::
	$GridProbeS’d”
()

31 
	}
}

34 
GridProbeS’d”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

37 
	}
}

39 
	gGridProbeS’d”
::~
	$GridProbeS’d”
()

41 
	}
}

45 
GridProbeS’d”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

47  
Args
(
cÚf
, 
this
, 
”rh
)

48 .
»ad_mp
("ETH", 
_‘h
)

49 .
»ad_mp
("IP", 
_
)

50 .
com¶‘e
();

54 
	gGridProbeS’d”
::
	$£nd_´obe
(
IPAdd»ss
 &

, 
nÚû
)

56 
şick_‘h”
 *
e
;

57 
grid_hdr
 *
gh
;

58 
grid_nbr_’ÿp
 *
nb
;

59 
grid_rou‹_´obe
 *
½
;

60 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((*
e
è+ (*
gh
è+ (*
nb
è+ (*
½
) + 2);

61 
q
->
	`puÎ
(2);

63 
q
->
	`£t_time¡amp_ªno
(
Time¡amp
::
	`now
());

65 
	`mem£t
(
q
->
	`d©a
(), 0, q->
	`Ëngth
());

66 
e
 = (
şick_‘h”
 *è
q
->
	`d©a
();

67 
gh
 = (
grid_hdr
 *è(
e
 + 1);

68 
nb
 = (
grid_nbr_’ÿp
 *è(
gh
 + 1);

69 
½
 = (
grid_rou‹_´obe
 *è(
nb
 + 1);

71 
e
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_GRID
);

74 
gh
->
hdr_Ën
 = (
grid_hdr
);

75 
gh
->
ty³
 = 
grid_hdr
::
GRID_ROUTE_PROBE
;

76 
gh
->

 = 
_
;

77 
gh
->
tÙ®_Ën
 = 
	`htÚs
(
q
->
	`Ëngth
(è- (
şick_‘h”
));

79 
nb
->
d¡_
 = 

;

80 #iâdeà
SMALL_GRID_HEADERS


81 
nb
->
d¡_loc_good
 = 
çl£
;

83 
nb
->
hİs_Œav–Ëd
 = 0;

85 
½
->
nÚû
 = 
	`htÚl
(nonce);

86 
½
->
£nd_time
.
tv_£c
 = 
	`htÚl
(
q
->
	`time¡amp_ªno
().
	`£c
());

87 
½
->
£nd_time
.
tv_u£c
 = 
	`htÚl
(
q
->
	`time¡amp_ªno
().
	`u£c
());

89 
	`ouut
(0).
	`push
(
q
);

90 
	}
}

94 
	$´obe_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–em’t
,

95 *, 
E¼ÜHªdËr
 *
”rh
)

97 
GridProbeS’d”
 *
l
 = (GridProbeS’d” *è
–em’t
;

99 
VeùÜ
<
SŒšg
> 
¬g_li¡
;

100 
	`ı_¬gvec
(
¬g
, 
¬g_li¡
);

102 
IPAdd»ss
 

;

103 
nÚû
;

104 
»s
 = 
	`Args
(
¬g_li¡
, 
–em’t
, 
”rh
)

105 .
	`»ad_mp
("IP", 

)

106 .
	`»ad_mp
("NONCE", 
nÚû
)

107 .
	`com¶‘e
();

108 ià(
»s
 < 0)

109  
»s
;

111 
l
->
	`£nd_´obe
(

, 
nÚû
);

113 
	}
}

117 
	gGridProbeS’d”
::
	$add_hªdËrs
()

119 
	`add_wr™e_hªdËr
("£nd_´obe", 
´obe_wr™e_hªdËr
, 0);

120 
	}
}

122 
CLICK_ENDDECLS


123 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

124 
	`EXPORT_ELEMENT
(
GridProbeS’d”
)

	@grid/gridprobesender.hh

1 #iâdeà
GRIDPROBESENDER_HH


2 
	#GRIDPROBESENDER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/add»ss.hh
>

6 
	~<şick/veùÜ.hh
>

7 
	~<şick/bighashm­.hh
>

8 
	~<şick/tim”.hh
>

9 
CLICK_DECLS


30 şas 
	cGridProbeS’d”
 : 
public
 
EËm’t
 {

32 
public
:

33 
	$GridProbeS’d”
(è
CLICK_COLD
;

34 ~
	$GridProbeS’d”
(è
CLICK_COLD
;

36 cÚ¡ *
	$şass_Çme
() const {  "GridProbeSender"; }

37 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

38 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

39 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

40 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

42 
	`£nd_´obe
(
IPAdd»ss
 &, );

44 
	$add_hªdËrs
(è
CLICK_COLD
;

46 
´iv©e
:

47 
IPAdd»ss
 
_
;

48 
Eth”Add»ss
 
_‘h
;

49 
	}
};

51 
	gCLICK_ENDDECLS


	@grid/gridproxy.cc

18 
	~<şick/cÚfig.h
>

19 
	~"grid´oxy.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/¡¿ccum.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

24 
CLICK_DECLS


26 
	gGridProxy
::
	$GridProxy
()

28 
	}
}

30 
GridProxy
::~
	$GridProxy
()

32 
	}
}

35 
GridProxy
::
	$ş—nup
(
CËªupSge
)

37 
	}
}

40 
GridProxy
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

42 
şick_
 
	gh
;

43 
mem£t
(&
h
, 0, (
şick_
));

44 
	gh
.
	g_v
 = 4;

45 
	gh
.
	g_hl
 = (
şick_
) >> 2;

46 
	gh
.
	g_tos
 = 0;

47 
	gh
.
	g_off
 = 0;

48 
	gh
.
	g_‰l
 = 250;

49 
	gh
.
	g_sum
 = 0;

50 
	gh
.
	g_p
 = 4;

52 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("IP", 
h
.
_¤c
).
com¶‘e
();

54 ià(
	g»s
 < 0)

55  
	g»s
;

57 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


60 
	gªs
, 
	gc
, 
	go
;

61 
	gªs
 = 
Alignm’tInfo
::
qu”y
(
this
, 1, 
c
, 
o
);

62 
	g_®igÃd
 = (
ªs
 && 
c
 =ğ4 && 
o
 == 0);

63 ià(!
	g_®igÃd
)

64 
	g”rh
->
w¬nšg
("IP header unaligned, cannot use fast IP checksum");

65 ià(!
	gªs
)

66 
	g”rh
->
mes§ge
("(Try…assinghe configurationhrough 'click-align'.)");

70 
	g_h
 = 
h
;

71  
	g»s
;

76 
	gGridProxy
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

78 
_id
 = 0;

80 
	}
}

84 
	gGridProxy
::
	$push
(
pÜt
, 
Pack‘
 *
p_š
)

86 ià(0 =ğ
pÜt
) {

87 
	`fÜw¬d_m­pšg
(
p_š
);

89 
	`»v”£_m­pšg
(
p_š
);

91 
	}
}

95 
	gGridProxy
::
	$»v”£_m­pšg
(
Pack‘
 *
p_š
) {

98 
IPAdd»ss
 
d¡
 = 
	`IPAdd»ss
(
p_š
->
	`_h—d”
()->
_d¡
);

99 
D¡Info
 *
nfo
 = 
_m­
.
	`fšdp
(
d¡
);

100 ià(!
nfo
) {

102 
p_š
->
	`kl
();

106 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`push
((
şick_
));

107 ià(!
p
) {

108 
p_š
->
	`kl
();

112 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
p
->
	`d©a
());

113 
	`memıy
(

, &
_h
, (
şick_
));

114 

->
_Ën
 = 
	`htÚs
(
p
->
	`Ëngth
());

115 

->
_id
 = 
	`htÚs
(
_id
.
	`ãtch_ªd_add
(1));

117 
p
->
	`£t_d¡__ªno
(
nfo
->
_gw
);

118 
p
->
	`£t__h—d”
(

, (
şick_
));

119 
p
->
	`_h—d”
()->
_d¡
 = 
nfo
->
_gw
.
	`š_addr
();

122 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


123 ià(
_®igÃd
)

124 

->
_sum
 = 
	`_ç¡_csum
((*), (
şick_
) >> 2);

126 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

127 #–ià
HAVE_FAST_CHECKSUM


128 

->
_sum
 = 
	`_ç¡_csum
((*), (
şick_
) >> 2);

130 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

133 
	`ouut
(1).
	`push
(
p
);

134 
	}
}

137 
	gGridProxy
::
	$fÜw¬d_m­pšg
(
Pack‘
 *
p_š
) {

139 
IPAdd»ss
 
g©eway
;

140 
IPAdd»ss
 
¤c
;

142 
g©eway
 = 
	`IPAdd»ss
(
p_š
->
	`_h—d”
()->
_¤c
);

145 
p_š
->
	`puÎ
((í_š->
	`Œª¥Üt_h—d”_off£t
());

148 cÚ¡ 
şick_
 *

 = 
»š‹½»t_ÿ¡
<cÚ¡ click_ *>(
p_š
->
	`d©a
());

149 
p_š
->
	`£t__h—d”
(

, ip->
_hl
 << 2);

152 
¤c
 = 
	`IPAdd»ss
(
p_š
->
	`_h—d”
()->
_¤c
);

154 
Time¡amp
 
now
 = Time¡amp::
	`now
();

155 
_m­
.
	`š£¹
(
¤c
, 
	`D¡Info
(¤c, 
g©eway
, 
now
));

157 
	`ouut
(0).
	`push
(
p_š
);

159 
	}
}

161 
SŒšg


162 
	gGridProxy
::
	$¡©ic_´št_¡©s
(
EËm’t
 *
e
, *)

164 
GridProxy
 *
n
 = (GridProxy *è
e
;

165  
n
->
	`´št_¡©s
();

166 
	}
}

168 
SŒšg


169 
	gGridProxy
::
	$´št_¡©s
()

171 
SŒšgAccum
 
§
;

173 
Time¡amp
 
now
 = Time¡amp::
	`now
();

175 
ProxyM­
::
™”©Ü
 
™”
 = 
_m­
.
	`begš
(); i‹r.
	`live
(); iter++) {

176 
D¡Info
 
nfo
 = 
™”
.
	`v®ue
();

177 
§
 << 
nfo
.
_
.
	`uÅ¬£
().
	`c_¡r
() << " ";

178 
§
 << 
nfo
.
_gw
.
	`uÅ¬£
().
	`c_¡r
() << " ";

179 
§
 << 
now
 - 
nfo
.
_Ï¡_upd©ed
 << "\n";

182  
§
.
	`ke_¡ršg
();

184 
	}
}

186 
	gGridProxy
::
	$add_hªdËrs
()

188 
	`add_»ad_hªdËr
("¡©s", 
¡©ic_´št_¡©s
, 0);

189 
	}
}

192 
CLICK_ENDDECLS


193 
EXPORT_ELEMENT
(
GridProxy
)

	@grid/gridproxy.hh

1 #iâdeà
CLICK_GRID_PROXY_HH


2 
	#CLICK_GRID_PROXY_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/add»ss.hh
>

5 
	~<şick/glue.hh
>

6 
	~<şick/©omic.hh
>

7 
	~<şick/hashm­.hh
>

8 
	~<şickÃt/.h
>

9 
CLICK_DECLS


27 şas 
	cGridProxy
 : 
public
 
EËm’t
 {

29 şas 
	cD¡Info
 {

30 
public
:

31 
IPAdd»ss
 
_
;

32 
Time¡amp
 
	m_Ï¡_upd©ed
;

33 
IPAdd»ss
 
	m_gw
;

34 
D¡Info
(è{
	m_
 = 
IPAdd»ss
(0); 
	m_gw
 = IPAddress(0); }

35 
D¡Info
(
IPAdd»ss
 

, IPAdd»s 
gw
, 
Time¡amp
 
now
) {

36 
	m_
 = 

;

37 
	m_Ï¡_upd©ed
 = 
now
;

38 
	m_gw
 = 
gw
;

42 
	gHashM­
<
	tIPAdd»ss
, 
	tD¡Info
> 
	tProxyM­
;

43 
ProxyM­
 
	g_m­
;

45 
şick_
 
	g_h
;

46 
u©omic32_t
 
	g_id
;

47 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


48 
boŞ
 
	g_®igÃd
;

51 
»v”£_m­pšg
(
Pack‘
 *
p_š
);

52 
fÜw¬d_m­pšg
(
Pack‘
 *
p_š
);

55 
	gpublic
:

56 
	$GridProxy
(è
CLICK_COLD
;

57 ~
	$GridProxy
(è
CLICK_COLD
;

59 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "GridProxy"; 
	}
}

60 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/2"; 
	}
}

61 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

62 cÚ¡ *
	$æags
(ècÚ¡ {  "A"; 
	}
}

64 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

65 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

66 
	$add_hªdËrs
(è
CLICK_COLD
;

67 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

69 
	`push
(, 
Pack‘
 *);

71 
SŒšg
 
	`¡©ic_´št_¡©s
(
EËm’t
 *
e
, *);

72 
SŒšg
 
	`´št_¡©s
();

75 
	}
};

77 
	gCLICK_ENDDECLS


	@grid/gridroutecb.hh

18 #iâdeà
GRIDROUTECB_HH


19 
	#GRIDROUTECB_HH


	)

20 
	~<şick/·ck‘_ªno.hh
>

21 
CLICK_DECLS


23 şas 
	cGridRou‹AùiÚC®lback
 {

24 
	mpublic
:

26 
vœtu®
 ~
	$GridRou‹AùiÚC®lback
() { }

28 
	eAùiÚ
 {

29 
UnknownAùiÚ
 = 0,

30 
S’dToIP
 = 1,

31 
FÜw¬dDSDV
 = 2,

32 
F®lbackToGF
 = 3,

33 
QueuedFÜLocQu”y
 = 4,

34 
FÜw¬dGF
 = 5,

35 
Drİ
 = 6,

36 
ProbeFšished
 = 7,

37 
NoLocQu”yN“ded
 = 8,

38 
CachedLocFound
 = 9

39 
	}
};

41 
	eDrİR—sÚ
 {

42 
	gUnknownR—sÚ
 = 0,

43 
	gUnknownTy³
 = 1,

44 
	gNoLoÿlRou‹
 = 2,

45 
	gNoDe¡Loc
 = 3,

46 
	gNoClo£rNode
 = 4,

47 
	gCÚfigE¼Ü
 = 5,

48 
	gOwnLocUnknown
 = 6,

49 
	gBadPack‘
 = 7

52 
vœtu®
 
rou‹_cb
(
id
, 
de¡_
, 
AùiÚ
 
a
, 
d©a
, 
d©a2
) = 0;

54 
	g´Ùeùed
:

55 
	$£t_rou‹_cb_b™
(
Pack‘
 *
p
, 
cb_num
) {

56 
mask
 = 1 << 
cb_num
;

57 
Ãwv®
 = 
mask
 | 
	`GRID_ROUTE_CB_ANNO
(
p
);

58 
	`SET_GRID_ROUTE_CB_ANNO
(
p
, 
Ãwv®
);

59 
	}
}

63 şas 
	cGridRou‹AùÜ
 {

64 
	mpublic
:

65 
	$GridRou‹AùÜ
(è{ 
	`mem£t
(&
_cbs
, 0, (_cbs)); }

66 
	$add_ÿÎback
(
GridRou‹AùiÚC®lback
 *
cb
) {

67 
id
 = 
	`®loc_cb_id
();

68 ià(
id
 < 0)

70 
_cbs
[
id
] = 
cb
;

71  
id
;

72 
	}
}

74 
	g´iv©e
:

75 
boŞ
 
	$cb_is_£t
(
Pack‘
 *
p
, 
cb_num
) {

76 
mask
 = 1 << 
cb_num
;

77  
mask
 & 
	`GRID_ROUTE_CB_ANNO
(
p
);

78 
	}
}

82 cÚ¡ 
	g_max_rou‹_cbs
 = 8;

86 
	g_Ãxt_ä“_cb
;

88 
	$®loc_cb_id
() {

89 ià(
_Ãxt_ä“_cb
 >ğ
_max_rou‹_cbs
)

91 
id
 = 
_Ãxt_ä“_cb
;

92 
_Ãxt_ä“_cb
++;

93  
id
;

94 
	}
}

96 
GridRou‹AùiÚC®lback
 *
	g_cbs
[
_max_rou‹_cbs
];

98 
	g´Ùeùed
:

99 
	$nÙify_rou‹_cbs
(
Pack‘
 *
p
, 
de¡_
, 
GridRou‹AùiÚC®lback
::
AùiÚ
 
a
,

100 
d©a
, 
d©a2
) {

101 
i
 = 0; i < 
_max_rou‹_cbs
; i++) {

102 ià(
_cbs
[
i
] && 
	`cb_is_£t
(
p
, i))

103 
_cbs
[
i
]->
	`rou‹_cb
(i, 
de¡_
, 
a
, 
d©a
, 
d©a2
);

105 
	}
}

108 
	gCLICK_ENDDECLS


	@grid/gridroutetable.cc

18 
	~<şick/cÚfig.h
>

19 
	~"timeuts.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şickÃt/‘h”.h
>

24 
	~<şickÃt/.h
>

25 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

26 
	~<şick/rou‹r.hh
>

27 
	~<şick/–em’t.hh
>

28 
	~<şick/glue.hh
>

29 
	~"gridrou‹bË.hh
"

30 
	~"gridlogg”.hh
"

31 
	gCLICK_DECLS


33 
	#NEXT_HOP_ETH_FIXUP
 0

	)

35 
boŞ


36 
	gGridRou‹TabË
::
	$g‘_Úe_’Œy
(cÚ¡ 
IPAdd»ss
 &
de¡_
, 
Rou‹EÁry
 &
’Œy
)

38 
RTEÁry
 *
r
 = 
_¹es
.
	`fšdp
(
de¡_
);

39 ià(
r
 == 0)

40  
çl£
;

42 
’Œy
 = 
	`Rou‹EÁry
(
de¡_
, 
r
->
loc_good
,„->
loc_”r
,„->
loc
,

43 
r
->
Ãxt_hİ_‘h
,„->
Ãxt_hİ_
,

45 
r
->
	`£q_no
(),„->
	`num_hİs
());

46  
Œue
;

47 
	}
}

50 
	gGridRou‹TabË
::
g‘_®l_’Œ›s
(
VeùÜ
<
Rou‹EÁry
> &
vec
)

52 
RTI‹r
 
™”
 = 
_¹es
.
begš
(); 
	g™”
.
live
(); iter++) {

53 cÚ¡ 
	gRTEÁry
 &
	g¹e
 = 
™”
.
v®ue
();

54 
	gvec
.
push_back
(
Rou‹EÁry
(
¹e
.
de¡_
,„‹.
loc_good
,„‹.
loc_”r
,„‹.
loc
,

55 
¹e
.
Ãxt_hİ_‘h
,„‹.
Ãxt_hİ_
, 0,

56 
¹e
.
£q_no
(),„‹.
num_hİs
()));

61 
	gGridRou‹TabË
::
	$GridRou‹TabË
() :

62 
	`_log
(0), 
	`_dump_tick
(0),

63 
	`_£q_no
(0), 
	`_çke_£q_no
(0), 
	`_bÿ¡_couÁ
(0),

64 
	`_£q_d–ay
(1),

65 
	`_max_hİs
(3),

66 
	`_expœe_tim”
(
expœe_hook
, 
this
),

67 
	`_h–lo_tim”
(
h–lo_hook
, 
this
),

68 
	`_m‘ric_ty³
(
M‘ricE¡TxCouÁ
),

69 
	`_max_m‘ric
(0), 
	`_mš_m‘ric
(0),

70 
	`_e¡_ty³
(
E¡BySigQu®
),

71 
	$_äoz’
(
çl£
)

73 
	}
}

75 
	gGridRou‹TabË
::~
	$GridRou‹TabË
()

77 
	}
}

82 
GridRou‹TabË
::
	$ÿ¡
(cÚ¡ *
n
)

84 ià(
	`¡rcmp
(
n
, "GridRouteTable") == 0)

85  (
GridRou‹TabË
 *è
this
;

86 ià(
	`¡rcmp
(
n
, "GridGenericRouteTable") == 0)

87  (
GridG’”icRou‹TabË
 *è
this
;

90 
	}
}

95 
	gGridRou‹TabË
::
	$log_rou‹_bË
 ()

97 
¡r
[80];

98 
RTI‹r
 
i
 = 
_¹es
.
	`begš
(); i.
	`live
(); i++) {

99 cÚ¡ 
RTEÁry
 &
f
 = 
i
.
	`v®ue
();

101 
	`¢´štf
(
¡r
, (str),

103 
f
.
de¡_
.
	`uÅ¬£
().
	`c_¡r
(),

104 
f
.
loc
.
	`s
().
	`c_¡r
(),

105 
f
.
Ãxt_hİ_
.
	`uÅ¬£
().
	`c_¡r
(),

106 
f
.
	`num_hİs
(),

107 (
f
.
is_g©eway
 ? 'y' : 'n'),

108 
f
.
	`£q_no
());

109 
_ex‹nded_loggšg_”rh
->
	`mes§ge
(
¡r
);

111 
_ex‹nded_loggšg_”rh
->
	`mes§ge
("\n");

112 
	}
}

116 
	gGridRou‹TabË
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

118 
SŒšg
 
chª
("routelog");

119 
SŒšg
 
m‘ric
("est_tx_count");

120 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

121 .
»ad_mp
("TIMEOUT", 
_timeout
)

122 .
»ad_mp
("PERIOD", 
_³riod
)

123 .
»ad_mp
("JITTER", 
_j™‹r
)

124 .
»ad_mp
("ETH", 
_‘h
)

125 .
»ad_mp
("IP", 
_
)

126 .
»ad_mp
("GATEWAYINFO", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_gw_šfo
))

127 .
»ad_mp
("LINKTRACKER", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_lšk_Œack”
))

128 .
»ad_mp
("LINKSTAT", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_lšk_¡©
))

129 .
»ad
("MAX_HOPS", 
_max_hİs
)

130 .
»ad
("LOGCHANNEL", 
chª
)

131 .
»ad
("METRIC", 
m‘ric
)

132 .
»ad
("LOG", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_log
))

133 .
com¶‘e
();

135 ià(
	g»s
 < 0)

136  
	g»s
;

139 ià(
	g_timeout
 == 0)

140 
_timeout
 = -1;

141 ià(
	g_timeout
 > 0) {

142 
	g_timeout_jiff›s
 = 
m£c_to_jiff
(
_timeout
);

143 ià(
	g_timeout_jiff›s
 < 1)

144  
	g”rh
->
”rÜ
("timeout interval isoo small");

147 
şick_ch©‹r
("%s:‚Ùimšg ouˆbËƒÁr›s", 
Çme
().
c_¡r
());

149 ià(
	g_³riod
 <= 0)

150  
”rh
->
”rÜ
("period must be greaterhan 0");

151 ià(
	g_j™‹r
 < 0)

152  
	g”rh
->
”rÜ
("period must be…ositive");

153 ià(
	g_j™‹r
 > 
	g_³riod
)

154  
	g”rh
->
”rÜ
("jitter is biggerhan…eriod");

155 ià(
	g_max_hİs
 < 0)

156  
	g”rh
->
”rÜ
("max hops must be greaterhan 0");

158 
	g_ex‹nded_loggšg_”rh
 = 
rou‹r
()->
ch©‹r_chªÃl
(
chª
);

159 
as£¹
(
_ex‹nded_loggšg_”rh
);

161 
	g_m‘ric_ty³
 = 
check_m‘ric_ty³
(
m‘ric
);

162 ià(
	g_m‘ric_ty³
 < 0)

163  
	g”rh
->
”rÜ
("UnknowÀm‘riøty³ ``%s''", 
m‘ric
.
c_¡r
());

165  
	g»s
;

171 
	gGridRou‹TabË
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

173 
_h–lo_tim”
.
	`š™Ÿlize
(
this
);

174 
_h–lo_tim”
.
	`scheduË_aá”_m£c
(
_³riod
);

176 
_expœe_tim”
.
	`š™Ÿlize
(
this
);

177 ià(
_timeout
 > 0)

178 
_expœe_tim”
.
	`scheduË_aá”_m£c
(
EXPIRE_TIMER_PERIOD
);

181 
	}
}

184 
boŞ


185 
	gGridRou‹TabË
::
	$cu¼’t_g©eway
(
Rou‹EÁry
 &
’Œy
)

187 
RTI‹r
 
i
 = 
_¹es
.
	`begš
(); i.
	`live
(); i++) {

188 cÚ¡ 
RTEÁry
 &
f
 = 
i
.
	`v®ue
();

190 ià(
f
.
is_g©eway
) {

191 
’Œy
 = 
	`Rou‹EÁry
(
f
.
de¡_
, f.
loc_good
, f.
loc_”r
, f.
loc
,

192 
f
.
Ãxt_hİ_‘h
, f.
Ãxt_hİ_
, 0,

193 
f
.
	`£q_no
(), f.
	`num_hİs
());

194  
Œue
;

198  
çl£
;

199 
	}
}

203 
	gGridRou‹TabË
::
	$qu®_to_pù
(
q
)

206 ià(
q
 > 
_max_m‘ric
)

208 ià(
q
 < 
_mš_m‘ric
)

211 
d–
 = 
_max_m‘ric
 - 
_mš_m‘ric
;

212  (100 * (
_max_m‘ric
 - 
q
)è/ 
d–
;

213 
	}
}

216 
	gGridRou‹TabË
::
	$sig_to_pù
(
s
)

219 ià(
s
 > 
_max_m‘ric
)

221 ià(
s
 < 
_mš_m‘ric
)

224 
d–
 = 
_max_m‘ric
 - 
_mš_m‘ric
;

225  (100 * (
s
 - 
_mš_m‘ric
)è/ 
d–
;

226 
	}
}

229 
	#h
(
x
)

	)

231 
boŞ


232 
	gGridRou‹TabË
::
	$e¡_fÜw¬d_d–iv”y_¿‹
(cÚ¡ 
IPAdd»ss
 

, &
¿‹
)

234 
_e¡_ty³
) {

235 
E¡BySig
:

236 
E¡ByQu®
:

237 
E¡BySigQu®
: {

238 
sig
 = 0;

239 
qu®
 = 0;

240 
Time¡amp
 
Ï¡
;

241 
boŞ
 
»s
 = 
_lšk_Œack”
->
	`g‘_¡©
(

, 
sig
, 
qu®
, 
Ï¡
);

242 ià(!
»s
) {

243 
	`h
(1);

244  
çl£
;

246 ià(
_e¡_ty³
 =ğ
E¡ByQu®
) {

247  
çl£
;

249 ià(
_e¡_ty³
 =ğ
E¡BySig
) {

250  
çl£
;

252 ià(
_e¡_ty³
 =ğ
E¡BySigQu®
) {

253 
	`h
(2);

255 
	`şick_ch©‹r
("XXX %s", 

.
	`uÅ¬£
().
	`c_¡r
());

267 
»s
 = 
_lšk_Œack”
->
	`g‘_bÿ¡_¡©
(

, 
¿‹
, 
Ï¡
);

268 
z
 = 9.4519 + 0.0391 * 
sig
 + 0.5518 * 
qu®
;

269 
z2
 = 1 / (1 + 
	`exp
(
z
));

270 
th»sh
 = 0.8;

271 
boŞ
 
lšk_good
 = 
z2
 > 
th»sh
;

273 ià(
lšk_good
)

274 
¿‹
 = 1;

276 
¿‹
 = 0.1;

277  
Œue
;

278 
	`h
(3);

279 ià(!
lšk_good
 && !
»s
) {

280 
	`h
(4);

281  
çl£
;

283 ià(
lšk_good
 && !
»s
) {

284 
	`h
(5);

285 
¿‹
 = 0.8;

286  
Œue
;

288 ià(!
lšk_good
 && 
»s
) {

289 
	`h
(6);

290  
Œue
;

293 
	`h
(7);

294 ià(
¿‹
 < 0.8) {

295 
	`h
(8);

296 
¿‹
 = 0.8;

298  
Œue
;

300 
	`h
(9);

303 
	`h
(10);

304  
çl£
;

307 
E¡ByM—s
: {

308 
	`h
(11);

309 
Time¡amp
 
Ï¡
;

310 
boŞ
 
»s
 = 
_lšk_Œack”
->
	`g‘_bÿ¡_¡©
(

, 
¿‹
, 
Ï¡
);

311  
»s
;

315 
	`h
(12);

316  
çl£
;

318 
	}
}

320 
boŞ


321 
	gGridRou‹TabË
::
	$e¡_»v”£_d–iv”y_¿‹
(cÚ¡ 
IPAdd»ss
 

, &
¿‹
)

323 
_e¡_ty³
) {

324 
E¡BySig
:

325 
E¡ByQu®
:

326 
	`h
(101);

327  
çl£
;

329 
E¡BySigQu®
: {

330 
	`h
(102);

331 
RTEÁry
 *
r
 = 
_¹es
.
	`fšdp
(

);

332 ià(
r
 =ğ0 ||„->
	`num_hİs
() > 1) {

333 
	`h
(103);

334  
çl£
;

337 
timev®
 
Ï¡
;

339 
LškSt
::
¡©_t
 *
s
 = 
_lšk_¡©
->
_¡©s
.
	`fšdp
(
r
->
Ãxt_hİ_‘h
);

342 
qu®
;

343 
sig
;

344 
timev®
 
wh’
;

345 } *
s
 = 0;

347 ià(
s
 == 0) {

348  
çl£
;

349 
	`h
(104);

351 
z
 = 9.4519 + 0.0391 * 
s
->
sig
 + 0.5518 * s->
qu®
;

352 
z2
 = 1 / (1 + 
	`exp
(
z
));

353 
th»sh
 = 0.8;

354 
boŞ
 
lšk_good
 = 
z2
 > 
th»sh
;

357 ià(
lšk_good
)

358 
¿‹
 = 1;

360 
¿‹
 = 0.1;

361  
Œue
;

363 
wšdow
 = 0;

364 
num_rx
 = 0;

365 
num_ex³ùed
 = 0;

366 
boŞ
 
»s
 = 
çl£
;
_lšk_¡©
->
	`g‘_bÿ¡_¡©s
(
r
->
Ãxt_hİ_‘h
, 
Ï¡
, 
wšdow
, 
num_rx
, 
num_ex³ùed
);

367 ià(
»s
 && 
num_ex³ùed
 > 1) {

368 
	`h
(105);

369 
num_rx_
 = 
num_rx
;

371 
num_ex³ùed_
 = 
num_ex³ùed
;

372 
¿‹
 = (
num_rx_
 - 0.5è/ 
num_ex³ùed_
;

375 
	`h
(107);

376 
¿‹
 = 0;

378 ià(!
lšk_good
 && !
»s
) {

379 
	`h
(108);

380  
çl£
;

382 ià(
lšk_good
 && !
»s
) {

383 
	`h
(109);

384 
¿‹
 = 0.8;

385  
Œue
;

387 ià(!
lšk_good
 && 
»s
) {

388 
	`h
(110);

389  
Œue
;

392 
	`h
(111);

393 ià(
¿‹
 < 0.8) {

394 
	`h
(112);

395 
¿‹
 = 0.8;

397  
Œue
;

400 
¿‹
 = 0;

401  
çl£
;

404 
	`h
(113);

405 
E¡ByM—s
: {

407 
timev®
 
Ï¡
;

408 
RTEÁry
 *
r
 = 
_¹es
.
	`fšdp
(

);

409 ià(
r
 =ğ0 ||„->
	`num_hİs
() > 1)

410  
çl£
;

411 
wšdow
 = 0;

412 
num_rx
 = 0;

413 
num_ex³ùed
 = 0;

414 
boŞ
 
»s
 = 
_lšk_¡©
->
	`g‘_bÿ¡_¡©s
(
r
->
Ãxt_hİ_‘h
, 
Ï¡
, 
wšdow
, 
num_rx
, 
num_ex³ùed
);

415 ià(!
»s
 || 
num_ex³ùed
 <= 1)

416  
çl£
;

417 
num_rx_
 = 
num_rx
;

418 
num_ex³ùed_
 = 
num_ex³ùed
;

419 ià(
num_rx
 > 
num_ex³ùed
)

420 
	`şick_ch©‹r
("WARNING:ƒst_reverse_delivery_rate:‚um_rx (%d) >‚um_expected (%d) for %s",

421 
num_rx
, 
num_ex³ùed
, 
r
->
Ãxt_hİ_‘h
.
	`uÅ¬£
().
	`c_¡r
());

422 
¿‹
 = (
num_rx_
 - 0.5è/ 
num_ex³ùed_
;

424  
Œue
;

428  
çl£
;

430 
	}
}

434 
	gGridRou‹TabË
::
	$š™_m‘ric
(
RTEÁry
 &
r
)

436 
	`as£¹
(
r
.
	`num_hİs
() == 1);

438 
_m‘ric_ty³
) {

439 
M‘ricHİCouÁ
:

440 
r
.
m‘ric
 =„.
	`num_hİs
();

441 
r
.
m‘ric_v®id
 = 
Œue
;

443 
M‘ricMšD–iv”yR©e
:

444 
M‘ricCumuÏtiveD–iv”yR©e
:

445 
	`as£¹
(0);

447 
r
.
m‘ric_v®id
 = 
Œue
;

449 
M‘ricMšSigSŒ’gth
:

450 
M‘ricMšSigQu®™y
:

451 
M‘ricCumuÏtiveQu®Pù
:

452 
M‘ricCumuÏtiveSigPù
: {

453 
sig
 = 0;

454 
qu®
 = 0;

455 
Time¡amp
 
Ï¡
;

456 
boŞ
 
»s
 = 
_lšk_Œack”
->
	`g‘_¡©
(
r
.
de¡_
, 
sig
, 
qu®
, 
Ï¡
);

457 ià(!
»s
) {

458 
	`şick_ch©‹r
("GridRouteTable:‚o†ink sig/qual stats from 1-hop‚eighbor %s;‚ot initializing metric\n",

459 
r
.
de¡_
.
	`uÅ¬£
().
	`c_¡r
());

460 
r
.
m‘ric
 = 
_bad_m‘ric
;

461 
r
.
m‘ric_v®id
 = 
çl£
;

464 
Time¡amp
 
now
 = Time¡amp::
	`now
(è- 
Ï¡
;

465 
d–_ms
 = 
now
.
	`m£cv®
();

466 ià(
d–_ms
 > 
_timeout
) {

467 
	`şick_ch©‹r
("GridRouteTable:†ink sig/qual stats from 1-hop‚eighbor %s‡reoo old;‚ot initializing metric\n",

468 
r
.
de¡_
.
	`uÅ¬£
().
	`c_¡r
());

469 
r
.
m‘ric
 = 
_bad_m‘ric
;

470 
r
.
m‘ric_v®id
 = 
çl£
;

473 ià(
_m‘ric_ty³
 =ğ
M‘ricMšSigQu®™y
)

474 
r
.
m‘ric
 = (è
qu®
;

475 ià(
_m‘ric_ty³
 =ğ
M‘ricMšSigSŒ’gth
)

476 
r
.
m‘ric
 = (è-
sig
;

477 ià(
_m‘ric_ty³
 =ğ
M‘ricCumuÏtiveQu®Pù
)

478 
r
.
m‘ric
 = 
	`qu®_to_pù
(
qu®
);

480 
r
.
m‘ric
 = 
	`sig_to_pù
(
sig
);

481 
r
.
m‘ric_v®id
 = 
Œue
;

484 
M‘ricE¡TxCouÁ
: {

486 
	`şick_ch©‹r
("XXX");

488 
fwd_¿‹
 = 0;

489 
»v_¿‹
 = 0;

490 
boŞ
 
»s
 = 
	`e¡_fÜw¬d_d–iv”y_¿‹
(
r
.
Ãxt_hİ_
, 
fwd_¿‹
);

491 
boŞ
 
»s2
 = 
	`e¡_»v”£_d–iv”y_¿‹
(
r
.
Ãxt_hİ_
, 
»v_¿‹
);

493 
buf
[255];

494 
	`¢´štf
(
buf
, 255, "YYY %s %s --„es: %s,„es2: %s, fwd: %f,„ev: %f",

495 
r
.
de¡_
.
	`uÅ¬£
().
	`c_¡r
(),„.
Ãxt_hİ_
.
	`s
().c_str(),

496 
»s
 ? "Œue" : "çl£", 
»s2
 ? "true" : "false",

497 
fwd_¿‹
, 
»v_¿‹
);

498 
	`şick_ch©‹r
(
buf
);

500 ià(
»s
 && 
»s2
 && 
fwd_¿‹
 > 0 && 
»v_¿‹
 > 0) {

501 ià(
fwd_¿‹
 >= 1) {

502 
	`şick_ch©‹r
("init_metric ERROR: fwd„ate %d isoo high for %s",

503 (è(100 * 
fwd_¿‹
), 
r
.
Ãxt_hİ_
.
	`uÅ¬£
().
	`c_¡r
());

504 
fwd_¿‹
 = 1;

506 ià(
»v_¿‹
 >= 1) {

507 
	`şick_ch©‹r
("init_metric ERROR:„ev„ate %d isoo high for %s",

508 (è(100 * 
»v_¿‹
), 
r
.
Ãxt_hİ_
.
	`uÅ¬£
().
	`c_¡r
());

509 
»v_¿‹
 = 1;

511 
r
.
m‘ric
 = (è(100 / (
fwd_¿‹
 * 
»v_¿‹
));

512 ià(
r
.
m‘ric
 < 100)

513 
	`şick_ch©‹r
("init_metric WARNING: metricoo small (%d) for %s",

514 
r
.
m‘ric
,„.
Ãxt_hİ_
.
	`uÅ¬£
().
	`c_¡r
());

515 
r
.
m‘ric_v®id
 = 
Œue
;

516 
	`h
(201);

519 
r
.
m‘ric
 = 
_bad_m‘ric
;

520 
r
.
m‘ric_v®id
 = 
çl£
;

521 
	`h
(202);

526 
	`as£¹
(0);

528 
	}
}

531 
	gGridRou‹TabË
::
	$upd©e_m‘ric
(
RTEÁry
 &
r
)

533 ià(
r
.
	`num_hİs
() == 0)

536 
RTEÁry
 *
Ãxt_hİ
 = 
_¹es
.
	`fšdp
(
r
.
Ãxt_hİ_
);

537 ià(!
Ãxt_hİ
) {

538 
	`şick_ch©‹r
("GridRouteTable: ERROR updating metric for %s;‚o information for‚ext hop %s; invalidating metric",

539 
r
.
de¡_
.
	`uÅ¬£
().
	`c_¡r
(),„.
Ãxt_hİ_
.unparse().c_str());

540 
r
.
m‘ric_v®id
 = 
çl£
;

544 ià(!
r
.
m‘ric_v®id
)

547 ià(!
Ãxt_hİ
->
m‘ric_v®id
) {

548 
r
.
m‘ric_v®id
 = 
çl£
;

552 
_m‘ric_ty³
) {

553 
M‘ricHİCouÁ
:

554 ià(
Ãxt_hİ
->
m‘ric
 > 1)

555 
	`şick_ch©‹r
("GridRouteTable: WARNING metricype is hop count but‚ext-hop %s metric is > 1 (%u)",

556 
Ãxt_hİ
->
de¡_
.
	`uÅ¬£
().
	`c_¡r
(),‚ext_hİ->
m‘ric
);

557 
M‘ricE¡TxCouÁ
:

558 ià(
_m‘ric_ty³
 =ğ
M‘ricE¡TxCouÁ
) {

559 ià(
r
.
m‘ric
 < (è100 * (r.
	`num_hİs
() - 1))

560 
	`şick_ch©‹r
("update_metric WARNING„eceived metric (%d)oo†ow for %s (%d hops)",

561 
r
.
m‘ric
,„.
de¡_
.
	`uÅ¬£
().
	`c_¡r
(),„.
	`num_hİs
());

562 ià(
Ãxt_hİ
->
m‘ric
 < 100)

563 
	`şick_ch©‹r
("update_metric WARNING‚ext hop %p{ip_ptr} for %p{ip_ptr} metric isoo†ow (%d)",

564 &
Ãxt_hİ
->
de¡_
, &
r
.de¡_,‚ext_hİ->
m‘ric
);

566 
r
.
m‘ric
 +ğ
Ãxt_hİ
->metric;

568 
M‘ricCumuÏtiveD–iv”yR©e
:

569 
M‘ricCumuÏtiveQu®Pù
:

570 
M‘ricCumuÏtiveSigPù
:

571 
r
.
m‘ric
 = (r.m‘riø* 
Ãxt_hİ
->metric) / 100;

573 
M‘ricMšD–iv”yR©e
:

574 
r
.
m‘ric
 = (
Ãxt_hİ
->metric <„.metric) ?‚ext_hop->metric :„.metric;

576 
M‘ricMšSigSŒ’gth
:

577 
M‘ricMšSigQu®™y
:

580 
r
.
m‘ric
 = (
Ãxt_hİ
->metric >„.metric) ?‚ext_hop->metric :„.metric;

583 
	`as£¹
(0);

585 
r
.
m‘ric_v®id
 = 
Œue
;

586 
	}
}

589 
boŞ


590 
	gGridRou‹TabË
::
	$m‘ric_is_´eã¿bË
(cÚ¡ 
RTEÁry
 &
r1
, cÚ¡ RTEÁry &
r2
)

592 
	`as£¹
(
r1
.
m‘ric_v®id
 && 
r2
.metric_valid);

594 
_m‘ric_ty³
) {

595 
M‘ricHİCouÁ
:

596 
M‘ricE¡TxCouÁ
:

597  
r1
.
m‘ric
 < 
r2
.metric;

598 
M‘ricCumuÏtiveD–iv”yR©e
:

599 
M‘ricMšD–iv”yR©e
:

600  
r1
.
m‘ric
 > 
r2
.metric;

601 
M‘ricMšSigQu®™y
:

602 
M‘ricMšSigSŒ’gth
:

605  
r1
.
m‘ric
 < 
r2
.metric;

606 
M‘ricCumuÏtiveQu®Pù
:

607 
M‘ricCumuÏtiveSigPù
:

609 
	`as£¹
(0);

611  
çl£
;

612 
	}
}

615 
boŞ


616 
	gGridRou‹TabË
::
	$should_»¶aû_Şd_rou‹
(cÚ¡ 
RTEÁry
 &
Şd_rou‹
, cÚ¡ RTEÁry &
Ãw_rou‹
)

619 ià(
Şd_rou‹
.
	`£q_no
(è> 
Ãw_rou‹
.seq_no())

620  
çl£
;

621 ià(
Şd_rou‹
.
	`£q_no
(è< 
Ãw_rou‹
.seq_no())

622  
Œue
;

629 ià(
Şd_rou‹
.
m‘ric_v®id
 && !
Ãw_rou‹
.metric_valid)

630  
çl£
;

631 ià(!
Şd_rou‹
.
m‘ric_v®id
 && 
Ãw_rou‹
.metric_valid)

632  
Œue
;

641 ià(!
Şd_rou‹
.
m‘ric_v®id
 && !
Ãw_rou‹
.metric_valid) {

643  
Ãw_rou‹
.
	`num_hİs
(è< 
Şd_rou‹
.num_hops();

648 ià(
Şd_rou‹
.
Ãxt_hİ_
 =ğ
Ãw_rou‹
.next_hop_ip)

649  
Œue
;

652  
	`m‘ric_is_´eã¿bË
(
Ãw_rou‹
, 
Şd_rou‹
);

653 
	}
}

659 
Pack‘
 *

660 
	gGridRou‹TabË
::
	$sim¶e_aùiÚ
(
Pack‘
 *
·ck‘
)

662 
	`as£¹
(
·ck‘
);

663 
jiff
 = 
	`şick_jiff›s
();

668 
şick_‘h”
 *
eh
 = (şick_‘h” *è
·ck‘
->
	`d©a
();

669 ià(
	`Áohs
(
eh
->
‘h”_ty³
è!ğ
ETHERTYPE_GRID
) {

670 
	`şick_ch©‹r
("GridRou‹TabË %s: gÙ‚Ú-Grid…ack‘y³", 
	`Çme
().
	`c_¡r
());

671 
·ck‘
->
	`kl
();

674 
grid_hdr
 *
gh
 = (grid_hd¸*è(
eh
 + 1);

676 ià(
gh
->
ty³
 !ğ
grid_hdr
::
GRID_LR_HELLO
) {

677 
	`şick_ch©‹r
("GridRou‹TabË %s:„eûived unknowÀGrid…ack‘; ignÜšg it", 
	`Çme
().
	`c_¡r
());

678 
·ck‘
->
	`kl
();

682 
IPAdd»ss
 
	`addr
((*è&
gh
->
tx_
);

683 
Eth”Add»ss
 
	`‘haddr
((*è
eh
->
‘h”_sho¡
);

686 ià(
‘haddr
 =ğ
_‘h
) {

687 
	`şick_ch©‹r
("GridRou‹TabË %s:„eûived owÀGrid…ack‘; ignÜšg it", 
	`Çme
().
	`c_¡r
());

688 
·ck‘
->
	`kl
();

692 
grid_h–lo
 *
hlo
 = (grid_h–lØ*è(
gh
 + 1);

695 
Time¡amp
 
ts
 = Time¡amp::
	`now
();

696 
_ex‹nded_loggšg_”rh
->
	`mes§ge
("»cvd %u from % %d %d", 
	`Áohl
(
hlo
->
£q_no
), 
addr
.
	`uÅ¬£
().
	`c_¡r
(), 
ts
.
	`£c
(),s.
	`u£c
());

697 ià(
_log
)

698 
_log
->
	`log_¡¬t_»cv_adv”ti£m’t
(
	`Áohl
(
hlo
->
£q_no
), 
addr
, 
ts
);

700 ià(
_äoz’
) {

701 ià(
_log
)

702 
_log
->
	`log_’d_»cv_adv”ti£m’t
();

703 
·ck‘
->
	`kl
();

713 
RTEÁry
 *
r
 = 
_¹es
.
	`fšdp
(
addr
);

715 ià(!
r
)

716 
	`şick_ch©‹r
("GridRouteTable %s:‡dding‚ew 1-hop„oute %p{ip_ptr} -- %p{ether_ptr}",

717 
	`Çme
().
	`c_¡r
(), &
addr
, &
‘haddr
);

718 ià(
r
->
	`num_hİs
(è=ğ1 &&„->
Ãxt_hİ_‘h
 !ğ
‘haddr
)

719 
	`şick_ch©‹r
("GridRouteTable %s:ƒthernet‡ddress of %p{ip_ptr} changed from %p{ether_ptr}o %p{ether_ptr}",

720 
	`Çme
().
	`c_¡r
(), &
addr
, &
r
->
Ãxt_hİ_‘h
, &
‘haddr
);

752 
’Œy_sz
 = 
hlo
->
nbr_’Œy_sz
;

753 *
’Œy_±r
 = (*è(
hlo
 + 1);

756 #iâdeà
SMALL_GRID_HEADERS


757 
i
 = 0; i < 
hlo
->
num_nbrs
; i++, 
’Œy_±r
 +ğ
’Œy_sz
) {

758 
grid_nbr_’Œy
 *
cu¼
 = (grid_nbr_’Œy *è
’Œy_±r
;

759 ià(
_
 =ğ
cu¼
->

 && cu¼->
num_hİs
 == 1) {

760 
timev®
 
tv
;

761 
tv
 = 
	`Áoh
(
cu¼
->
m—su»m’t_time
);

762 
_lšk_Œack”
->
	`add_¡©
(
addr
, 
	`Áohl
(
cu¼
->
lšk_sig
),‚tohl(cu¼->
lšk_qu®
), 
tv
);

763 
tv
 = 
	`Áoh
(
cu¼
->
Ï¡_bÿ¡
);

764 
_lšk_Œack”
->
	`add_bÿ¡_¡©
(
addr
, 
cu¼
->
num_rx
, cu¼->
num_ex³ùed
, 
tv
);

770 ià(
	`Áohl
(
hlo
->
‰l
) > 0) {

771 
RTEÁry
 
	`Ãw_r
(
addr
, 
‘haddr
, 
gh
, 
hlo
, 
jiff
);

772 
	`š™_m‘ric
(
Ãw_r
);

773 ià(
r
 =ğ0 || 
	`should_»¶aû_Şd_rou‹
(*r, 
Ãw_r
)) {

774 ià(
_log
)

775 
_log
->
	`log_added_rou‹
(
GridLogg”
::
WAS_SENDER
, 
	`make_g’”ic_¹e
(
Ãw_r
));

776 
_¹es
.
	`š£¹
(
addr
, 
Ãw_r
);

777 ià(
Ãw_r
.
	`num_hİs
(è> 1 && 
r
 &&„->num_hops() == 1) {

779 
_lšk_Œack”
->
	`»move_®l_¡©s
(
r
->
de¡_
);

782 ià(
r
)

783 
r
->
de¡_‘h
 = 
‘haddr
;

789 
VeùÜ
<
RTEÁry
> 
Œigg”ed_¹es
;

790 
VeùÜ
<
IPAdd»ss
> 
brok’_de¡s
;

792 
’Œy_±r
 = (*è(
hlo
 + 1);

793 
i
 = 0; i < 
hlo
->
num_nbrs
; i++, 
’Œy_±r
 +ğ
’Œy_sz
) {

795 
grid_nbr_’Œy
 *
cu¼
 = (grid_nbr_’Œy *è
’Œy_±r
;

796 
RTEÁry
 
	`rou‹
(
addr
, 
‘haddr
, 
cu¼
, 
jiff
);

799 ià(
rou‹
.
‰l
 <= 0)

803 ià(
rou‹
.
de¡_
 =ğ
_
)

808 ià(
cu¼
->
Ãxt_hİ_
 =ğ(è
_
)

811 
	`upd©e_m‘ric
(
rou‹
);

813 
RTEÁry
 *
our_¹e
 = 
_¹es
.
	`fšdp
(
cu¼
->

);

818 ià(
cu¼
->
num_hİs
 == 0) {

820 ià((
rou‹
.
	`£q_no
() & 1) == 0) {

822 
	`şick_ch©‹r
("ignoring invalid broken„outeƒntry from %p{ip_ptr} for %p{ip_ptr}:‚um_hops was 0 but seq_no wasƒven\n",

823 &
addr
, &
rou‹
.
de¡_
);

828 ià(!
our_¹e
)

836 ià(
our_¹e
->
Ãxt_hİ_
 =ğ
addr
 &&

837 
rou‹
.
	`£q_no
(è> 
our_¹e
->seq_no()) {

838 
brok’_de¡s
.
	`push_back
(
rou‹
.
de¡_
);

841 
Œigg”ed_¹es
.
	`push_back
(
rou‹
);

843 ià(
_log
)

844 
_log
->
	`log_expœed_rou‹
(
GridLogg”
::
BROKEN_AD
, 
rou‹
.
de¡_
);

851 ià(
rou‹
.
	`£q_no
(è< 
our_¹e
->seq_no()) {

852 
	`as£¹
(!(
our_¹e
->
	`£q_no
() & 1));

853 ià(
our_¹e
->
‰l
 > 0 && our_¹e->
m‘ric_v®id
) {

854 
Œigg”ed_¹es
.
	`push_back
(*
our_¹e
);

856 ià(
_log
)

857 
_log
->
	`log_Œigg”ed_rou‹
(
our_¹e
->
de¡_
);

865 ià(
rou‹
.
	`num_hİs
(è+ 1 > 
_max_hİs
)

871 ià(
our_¹e
 =ğ0 || 
	`should_»¶aû_Şd_rou‹
(*our_¹e, 
rou‹
)) {

872 
_¹es
.
	`š£¹
(
rou‹
.
de¡_
,„oute);

873 ià(
rou‹
.
	`num_hİs
(è> 1 && 
our_¹e
 && our_rte->num_hops() == 1) {

875 
_lšk_Œack”
->
	`»move_®l_¡©s
(
our_¹e
->
de¡_
);

877 #ià
NEXT_HOP_ETH_FIXUP


879 
VeùÜ
<
RTEÁry
> 
chªged_Ãxt_hİ
;

880 
RTI‹r
 
i
 = 
_¹es
.
	`begš
(); i; i++) {

881 ià(
i
.
	`v®ue
().
Ãxt_hİ_
 =ğ
rou‹
.
de¡_
) {

882 
RTEÁry
 
r
 = 
i
.
	`v®ue
();

884 
r
.
Ãxt_hİ_
 = 
rou‹
.next_hop_ip;

885 
r
.
Ãxt_hİ_‘h
 = 
rou‹
.next_hop_eth;

890 
i
 = 0; i < 
chªged_Ãxt_hİ
.
	`size
(); i++)

891 
_¹es
.
	`š£¹
(
chªged_Ãxt_hİ
[
i
].
de¡_
, changed_next_hop[i]);

896 ià(
_log
)

897 
_log
->
	`log_added_rou‹
(
GridLogg”
::
WAS_ENTRY
, 
	`make_g’”ic_¹e
(
rou‹
));

902 
i
 = 0; i < 
brok’_de¡s
.
	`size
(); i++) {

903 
boŞ
 
»moved
 = 
_¹es
.
	`»move
(
brok’_de¡s
[
i
]);

904 
	`as£¹
(
»moved
);

907 
	`log_rou‹_bË
();

909 ià(
_log
)

910 
_log
->
	`log_’d_»cv_adv”ti£m’t
();

913 ià(
Œigg”ed_¹es
.
	`size
() > 0)

914 
	`£nd_routšg_upd©e
(
Œigg”ed_¹es
, 
çl£
);

916 
·ck‘
->
	`kl
();

918 
	}
}

922 
SŒšg


923 
	gGridRou‹TabË
::
	$´št_¹es_v
(
EËm’t
 *
e
, *)

925 
GridRou‹TabË
 *
n
 = (GridRou‹TabË *è
e
;

927 
SŒšg
 
s
;

928 
RTI‹r
 
i
 = 
n
->
_¹es
.
	`begš
(); i.
	`live
(); i++) {

929 cÚ¡ 
RTEÁry
 &
f
 = 
i
.
	`v®ue
();

930 
s
 +ğ
f
.
de¡_
.
	`uÅ¬£
()

931 + "‚ext=" + 
f
.
Ãxt_hİ_
.
	`uÅ¬£
()

932 + " hİs=" + 
	`SŒšg
((è
f
.
	`num_hİs
())

933 + " gw=" + (
f
.
is_g©eway
 ? "y" : "n")

934 + "†oc=" + 
f
.
loc
.
	`s
()

935 + "ƒ¼=" + (
f
.
loc_good
 ? "" : "-"è+ 
	`SŒšg
(f.
loc_”r
)

936 + " seq=" + 
	`SŒšg
(
f
.
	`£q_no
())

937 + " m‘ric_v®id=" + (
f
.
m‘ric_v®id
 ? "yes" : "no")

938 + " m‘ric=" + 
	`SŒšg
(
f
.
m‘ric
)

942  
s
;

943 
	}
}

945 
SŒšg


946 
	gGridRou‹TabË
::
	$´št_¹es
(
EËm’t
 *
e
, *)

948 
GridRou‹TabË
 *
n
 = (GridRou‹TabË *è
e
;

950 
SŒšg
 
s
;

951 
RTI‹r
 
i
 = 
n
->
_¹es
.
	`begš
(); i.
	`live
(); i++) {

952 cÚ¡ 
RTEÁry
 &
f
 = 
i
.
	`v®ue
();

953 
s
 +ğ
f
.
de¡_
.
	`uÅ¬£
()

954 + "‚ext=" + 
f
.
Ãxt_hİ_
.
	`uÅ¬£
()

955 + " hİs=" + 
	`SŒšg
((è
f
.
	`num_hİs
())

956 + " gw=" + (
f
.
is_g©eway
 ? "y" : "n")

959 + " seq=" + 
	`SŒšg
(
f
.
	`£q_no
())

963  
s
;

964 
	}
}

966 
SŒšg


967 
	gGridRou‹TabË
::
	$´št_nbrs_v
(
EËm’t
 *
e
, *)

969 
GridRou‹TabË
 *
n
 = (GridRou‹TabË *è
e
;

971 
SŒšg
 
s
;

972 
RTI‹r
 
i
 = 
n
->
_¹es
.
	`begš
(); i.
	`live
(); i++) {

974 ià(
i
.
	`v®ue
().
	`num_hİs
() != 1)

976 
s
 +ğ
i
.
	`key
().
	`uÅ¬£
();

977 
s
 +ğ"ƒth=" + 
i
.
	`v®ue
().
Ãxt_hİ_‘h
.
	`uÅ¬£
();

978 
buf
[300];

979 
	`¢´štf
(
buf
, 300, " metric_valid=%s metric=%d",

980 
i
.
	`v®ue
().
m‘ric_v®id
 ? "yes" : "no", i.v®ue().
m‘ric
);

981 
s
 +ğ
buf
;

982 
s
 += "\n";

985  
s
;

986 
	}
}

988 
SŒšg


989 
	gGridRou‹TabË
::
	$´št_nbrs
(
EËm’t
 *
e
, *)

991 
GridRou‹TabË
 *
n
 = (GridRou‹TabË *è
e
;

993 
SŒšg
 
s
;

994 
RTI‹r
 
i
 = 
n
->
_¹es
.
	`begš
(); i.
	`live
(); i++) {

996 ià(
i
.
	`v®ue
().
	`num_hİs
() != 1)

998 
s
 +ğ
i
.
	`key
().
	`uÅ¬£
();

999 
s
 +ğ"ƒth=" + 
i
.
	`v®ue
().
Ãxt_hİ_‘h
.
	`uÅ¬£
();

1000 
s
 += "\n";

1003  
s
;

1004 
	}
}

1007 
SŒšg


1008 
	gGridRou‹TabË
::
	$´št_
(
EËm’t
 *
e
, *)

1010 
GridRou‹TabË
 *
n
 = (GridRou‹TabË *è
e
;

1011  
n
->
_
.
	`uÅ¬£
();

1012 
	}
}

1015 
SŒšg


1016 
	gGridRou‹TabË
::
	$´št_‘h
(
EËm’t
 *
e
, *)

1018 
GridRou‹TabË
 *
n
 = (GridRou‹TabË *è
e
;

1019  
n
->
_‘h
.
	`uÅ¬£
();

1020 
	}
}

1022 
SŒšg


1023 
	gGridRou‹TabË
::
	$m‘ric_ty³_to_¡ršg
(
M‘ricTy³
 
t
)

1025 
t
) {

1026 
M‘ricHİCouÁ
:  "hopcount"; ;

1027 
M‘ricCumuÏtiveD–iv”yR©e
:  "cumulative_delivery_rate"; ;

1028 
M‘ricMšD–iv”yR©e
:  "min_delivery_rate"; ;

1029 
M‘ricMšSigSŒ’gth
:  "min_sig_strength"; ;

1030 
M‘ricMšSigQu®™y
:  "min_sig_quality"; ;

1031 
M‘ricCumuÏtiveQu®Pù
:  "cumulative_qual_pct"; ;

1032 
M‘ricCumuÏtiveSigPù
:  "cumulative_sig_pct"; ;

1033 
M‘ricE¡TxCouÁ
:  "est_tx_count"; ;

1037 
	}
}

1040 
SŒšg


1041 
	gGridRou‹TabË
::
	$´št_m‘ric_ty³
(
EËm’t
 *
e
, *)

1043 
GridRou‹TabË
 *
n
 = (GridRou‹TabË *è
e
;

1044  
	`m‘ric_ty³_to_¡ršg
(
n
->
_m‘ric_ty³
) + "\n";

1045 
	}
}

1047 
	gGridRou‹TabË
::
M‘ricTy³


1048 
GridRou‹TabË
::
	$check_m‘ric_ty³
(cÚ¡ 
SŒšg
 &
s
)

1050 
SŒšg
 
s2
 = 
s
.
	`low”
();

1051 ià(
s2
 == "hopcount")

1052  
M‘ricHİCouÁ
;

1053 ià(
s2
 == "cumulative_delivery_rate")

1054  
M‘ricCumuÏtiveD–iv”yR©e
;

1055 ià(
s2
 == "min_delivery_rate")

1056  
M‘ricMšD–iv”yR©e
;

1057 ià(
s2
 == "min_sig_strength")

1058  
M‘ricMšSigSŒ’gth
;

1059 ià(
s2
 == "min_sig_quality")

1060  
M‘ricMšSigQu®™y
;

1061 ià(
s2
 == "cumulative_qual_pct")

1062  
M‘ricCumuÏtiveQu®Pù
;

1063 ià(
s2
 == "cumulative_sig_pct")

1064  
M‘ricCumuÏtiveSigPù
;

1065 ià(
s2
 == "est_tx_count")

1066  
M‘ricE¡TxCouÁ
;

1068  
M‘ricUnknown
;

1069 
	}
}

1072 
	gGridRou‹TabË
::
	$wr™e_m‘ric_ty³
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–
,

1073 *, 
E¼ÜHªdËr
 *
”rh
)

1075 
GridRou‹TabË
 *
¹
 = (GridRou‹TabË *è
–
;

1076 
M‘ricTy³
 
ty³
 = 
	`check_m‘ric_ty³
(
¬g
);

1077 ià(
ty³
 < 0)

1078  
”rh
->
	`”rÜ
("unknowÀm‘riøty³ ``%s''", ((
SŒšg
è
¬g
).
	`c_¡r
());

1080 ià(
ty³
 !ğ
¹
->
_m‘ric_ty³
) {

1081 
¹
->
_m‘ric_ty³
 = 
ty³
;

1083 ià(
ty³
 =ğ
M‘ricCumuÏtiveSigPù
) {

1084 
¹
->
_max_m‘ric
 = 
_max_sig
;

1085 
¹
->
_mš_m‘ric
 = 
_mš_sig
;

1087 ià(
ty³
 =ğ
M‘ricCumuÏtiveQu®Pù
) {

1088 
¹
->
_max_m‘ric
 = 
_max_qu®
;

1089 
¹
->
_mš_m‘ric
 = 
_mš_qu®
;

1092 
¹
->
_max_m‘ric
 =„t->
_mš_m‘ric
 = 0;

1096 
VeùÜ
<
RTEÁry
> 
’Œ›s
;

1097 
RTI‹r
 
i
 = 
¹
->
_¹es
.
	`begš
(); i.
	`live
(); i++) {

1100 
RTEÁry
 
e
 = 
i
.
	`v®ue
();

1101 
e
.
m‘ric_v®id
 = 
çl£
;

1102 
’Œ›s
.
	`push_back
(
e
);

1105 
i
 = 0; i < 
’Œ›s
.
	`size
(); i++)

1106 
¹
->
_¹es
.
	`š£¹
(
’Œ›s
[
i
].
de¡_
,ƒntries[i]);

1109 
	}
}

1111 
SŒšg


1112 
	gGridRou‹TabË
::
	$´št_m‘ric_¿nge
(
EËm’t
 *
e
, *)

1114 
GridRou‹TabË
 *
¹
 = (GridRou‹TabË *è
e
;

1116  "max=" + 
	`SŒšg
(
¹
->
_max_m‘ric
è+ " mš=" + SŒšgÔt->
_mš_m‘ric
) + "\n";

1117 
	}
}

1120 
	gGridRou‹TabË
::
	$wr™e_m‘ric_¿nge
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–
,

1121 *, 
E¼ÜHªdËr
 *
”rh
)

1123 
GridRou‹TabË
 *
¹
 = (GridRou‹TabË *è
–
;

1124 
max
, 
mš
;

1125 
»s
 = 
	`Args
(
¹
, 
”rh
).
	`push_back_wÜds
(
¬g
)

1126 .
	`»ad_mp
("MAX", 
max
)

1127 .
	`»ad_mp
("MIN", 
mš
)

1128 .
	`com¶‘e
();

1129 ià(
»s
 < 0)

1132 ià(
max
 < 
mš
) {

1133 
t
 = 
max
;

1134 
max
 = 
mš
;

1135 
mš
 = 
t
;

1138 
¹
->
_max_m‘ric
 = 
max
;

1139 
¹
->
_mš_m‘ric
 = 
mš
;

1142 
	}
}

1144 
SŒšg


1145 
	gGridRou‹TabË
::
	$´št_e¡_ty³
(
EËm’t
 *
e
, *)

1147 
GridRou‹TabË
 *
¹
 = (GridRou‹TabË *è
e
;

1149  
	`SŒšg
(
¹
->
_e¡_ty³
) + "\n";

1150 
	}
}

1153 
	gGridRou‹TabË
::
	$wr™e_e¡_ty³
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–
,

1154 *, 
E¼ÜHªdËr
 *)

1156 
GridRou‹TabË
 *
¹
 = (GridRou‹TabË *è
–
;

1157 
¹
->
_e¡_ty³
 = 
	`©oi
(((
SŒšg
è
¬g
).
	`c_¡r
());

1160 
	}
}

1163 
SŒšg


1164 
	gGridRou‹TabË
::
	$´št_£q_d–ay
(
EËm’t
 *
e
, *)

1166 
GridRou‹TabË
 *
¹
 = (GridRou‹TabË *è
e
;

1168  
	`SŒšg
(
¹
->
_£q_d–ay
) + "\n";

1169 
	}
}

1172 
	gGridRou‹TabË
::
	$wr™e_£q_d–ay
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–
,

1173 *, 
E¼ÜHªdËr
 *)

1175 
GridRou‹TabË
 *
¹
 = (GridRou‹TabË *è
–
;

1176 
¹
->
_£q_d–ay
 = 
	`©oi
(((
SŒšg
è
¬g
).
	`c_¡r
());

1179 
	}
}

1182 
SŒšg


1183 
	gGridRou‹TabË
::
	$´št_äoz’
(
EËm’t
 *
e
, *)

1185 
GridRou‹TabË
 *
¹
 = (GridRou‹TabË *è
e
;

1187  (
¹
->
_äoz’
 ? "true\n" : "false\n");

1188 
	}
}

1191 
	gGridRou‹TabË
::
	$wr™e_äoz’
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–
,

1192 *, 
E¼ÜHªdËr
 *)

1194 
GridRou‹TabË
 *
¹
 = (GridRou‹TabË *è
–
;

1195 
¹
->
_äoz’
 = 
	`©oi
(((
SŒšg
è
¬g
).
	`c_¡r
());

1197 
	`şick_ch©‹r
("GridRou‹TabË: s‘tšg _äoz’Ø%s", 
¹
->
_äoz’
 ? "true" : "false");

1200 
	}
}

1202 
SŒšg


1203 
	gGridRou‹TabË
::
	$´št_lšks
(
EËm’t
 *
e
, *)

1205 
GridRou‹TabË
 *
¹
 = (GridRou‹TabË *è
e
;

1207 
SŒšg
 
s
 = "M‘riøty³: " + 
	`m‘ric_ty³_to_¡ršg
(
¹
->
_m‘ric_ty³
) + "\n";

1209 
RTI‹r
 
i
 = 
¹
->
_¹es
.
	`begš
(); i.
	`live
(); i++) {

1210 cÚ¡ 
RTEÁry
 &
r
 = 
i
.
	`v®ue
();

1211 ià(
r
.
	`num_hİs
() > 1)

1217 
LškSt
::
¡©_t
 *
s1
 = 
¹
->
_lšk_¡©
->
_¡©s
.
	`fšdp
(
r
.
Ãxt_hİ_‘h
);

1220 
qu®
;

1221 
sig
;

1222 
timev®
 
wh’
;

1223 } *
s1
 = 0;

1226 
timev®
 
Ï¡
;

1227 
wšdow
 = 0;

1228 
num_rx
 = 0;

1229 
num_ex³ùed
 = 0;

1230 
boŞ
 
»s1
 = 
¹
->
_lšk_¡©
->
	`g‘_bÿ¡_¡©s
(
r
.
Ãxt_hİ_‘h
, 
Ï¡
, 
wšdow
, 
num_rx
, 
num_ex³ùed
);

1233 
tx_sig
 = 0;

1234 
tx_qu®
 = 0;

1235 
boŞ
 
»s2
 = 
¹
->
_lšk_Œack”
->
	`g‘_¡©
(
r
.
de¡_
, 
tx_sig
, 
tx_qu®
, 
Ï¡
);

1236 
bÿ¡_¿‹
 = 0;

1237 
boŞ
 
»s3
 = 
¹
->
_lšk_Œack”
->
	`g‘_bÿ¡_¡©
(
r
.
de¡_
, 
bÿ¡_¿‹
, 
Ï¡
);

1239 
buf
[255];

1240 
tx_¿‹
 = 
num_rx
;

1241 
tx_¿‹
 -= 0.5;

1242 
tx_¿‹
 /ğ
num_ex³ùed
;

1243 
	`¢´štf
(
buf
, 255, "%s %s metric=%u (%s)„x_sig=%d„x_qual=%d„x_rate=%dx_sig=%dx_qual=%dx_rate=%d\n",

1244 
r
.
de¡_
.
	`uÅ¬£
().
	`c_¡r
(),„.
Ãxt_hİ_‘h
.
	`s
().c_¡r(),„.
m‘ric
,„.
m‘ric_v®id
 ? "valid" : "invalid",

1245 
s1
 ? s1->
sig
 : -1, s1 ? s1->
qu®
 : -1, 
»s1
 ? ((è(100 * 
tx_¿‹
)) : -1,

1246 
»s2
 ? 
tx_sig
 : -1,„es2 ? 
tx_qu®
 : -1, 
»s3
 ? (è(100 * 
bÿ¡_¿‹
) : -1);

1247 
s
 +ğ
buf
;

1250  
s
;

1251 
	}
}

1254 
	gGridRou‹TabË
::
	$add_hªdËrs
()

1256 
	`add_»ad_hªdËr
("nbrs_v", 
´št_nbrs_v
, 0);

1257 
	`add_»ad_hªdËr
("nbrs", 
´št_nbrs
, 0);

1258 
	`add_»ad_hªdËr
("¹es_v", 
´št_¹es_v
, 0);

1259 
	`add_»ad_hªdËr
("¹es", 
´št_¹es
, 0);

1260 
	`add_»ad_hªdËr
("", 
´št_
, 0);

1261 
	`add_»ad_hªdËr
("‘h", 
´št_‘h
, 0);

1262 
	`add_»ad_hªdËr
("lšks", 
´št_lšks
, 0);

1263 
	`add_»ad_hªdËr
("m‘ric_ty³", 
´št_m‘ric_ty³
, 0);

1264 
	`add_wr™e_hªdËr
("m‘ric_ty³", 
wr™e_m‘ric_ty³
, 0);

1265 
	`add_»ad_hªdËr
("m‘ric_¿nge", 
´št_m‘ric_¿nge
, 0);

1266 
	`add_wr™e_hªdËr
("m‘ric_¿nge", 
wr™e_m‘ric_¿nge
, 0);

1267 
	`add_»ad_hªdËr
("e¡_ty³", 
´št_e¡_ty³
, 0);

1268 
	`add_wr™e_hªdËr
("e¡_ty³", 
wr™e_e¡_ty³
, 0);

1269 
	`add_»ad_hªdËr
("£q_d–ay", 
´št_£q_d–ay
, 0);

1270 
	`add_wr™e_hªdËr
("£q_d–ay", 
wr™e_£q_d–ay
, 0);

1271 
	`add_»ad_hªdËr
("äoz’", 
´št_äoz’
, 0);

1272 
	`add_wr™e_hªdËr
("äoz’", 
wr™e_äoz’
, 0);

1273 
	}
}

1277 
	gGridRou‹TabË
::
	$expœe_hook
(
Tim”
 *, *
thunk
)

1279 
GridRou‹TabË
 *
n
 = (GridRou‹TabË *è
thunk
;

1280 
n
->
	`expœe_rou‹s
();

1281 
n
->
_expœe_tim”
.
	`scheduË_aá”_m£c
(
EXPIRE_TIMER_PERIOD
);

1282 
	}
}

1285 
	gVeùÜ
<
	gGridRou‹TabË
::
RTEÁry
>

1286 
GridRou‹TabË
::
	$expœe_rou‹s
()

1295 
_dump_tick
++;

1296 ià(
_dump_tick
 == 50) {

1297 
_dump_tick
 = 0;

1298 ià(
_log
) {

1299 
VeùÜ
<
Rou‹EÁry
> 
vec
;

1300 
	`g‘_®l_’Œ›s
(
vec
);

1301 
_log
->
	`log_rou‹_dump
(
vec
, 
Time¡amp
::
	`now
());

1305 
	`as£¹
(
_timeout
 > 0);

1306 
jiff
 = 
	`şick_jiff›s
();

1308 
VeùÜ
<
RTEÁry
> 
»tv®
;

1310 ià(
_äoz’
)

1311  
»tv®
;

1314 
HashM­
<
	tIPAdd»ss
, 
	tboŞ
> 
	tx_t
;

1315 
x_t
 
expœed_¹es
;

1316 
x_t
 
expœed_Ãxt_hİs
;

1318 
Time¡amp
 
ts
 = Time¡amp::
	`now
();

1319 ià(
_log
)

1320 
_log
->
	`log_¡¬t_expœe_hªdËr
(
ts
);

1322 
boŞ
 
bË_chªged
 = 
çl£
;

1328 
RTI‹r
 
i
 = 
_¹es
.
	`begš
(); i.
	`live
(); i++) {

1329 ià(
jiff
 - 
i
.
	`v®ue
().
Ï¡_upd©ed_jiff›s
 > 
_timeout_jiff›s
 ||

1330 
	`deü_‰l
(
i
.
	`v®ue
().
‰l
, 
	`jiff_to_m£c
(
jiff
 - i.v®ue().
Ï¡_upd©ed_jiff›s
)) == 0) {

1331 
expœed_¹es
.
	`š£¹
(
i
.
	`v®ue
().
de¡_
, 
Œue
);

1333 
_ex‹nded_loggšg_”rh
->
	`mes§ge
 ("expœšg % %d %d", 
i
.
	`v®ue
().
de¡_
.
	`uÅ¬£
().
	`c_¡r
(), 
ts
.
	`£c
(),s.
	`u£c
());

1334 
bË_chªged
 = 
Œue
;

1336 ià(
_log
)

1337 
_log
->
	`log_expœed_rou‹
(
GridLogg”
::
TIMEOUT
, 
i
.
	`v®ue
().
de¡_
);

1339 ià(
i
.
	`v®ue
().
	`num_hİs
() == 1) {

1341 
expœed_Ãxt_hİs
.
	`š£¹
(
i
.
	`v®ue
().
de¡_
, 
Œue
);

1343 
_lšk_Œack”
->
	`»move_®l_¡©s
(
i
.
	`v®ue
().
de¡_
);

1350 
RTI‹r
 
i
 = 
_¹es
.
	`begš
(); i.
	`live
(); i++) {

1352 ià(
i
.
	`v®ue
().
	`num_hİs
() > 1 &&

1353 
expœed_Ãxt_hİs
.
	`fšdp
(
i
.
	`v®ue
().
Ãxt_hİ_
) &&

1354 !
expœed_¹es
.
	`fšdp
(
i
.
	`v®ue
().
de¡_
)) {

1355 
expœed_¹es
.
	`š£¹
(
i
.
	`v®ue
().
de¡_
, 
Œue
);

1357 
_ex‹nded_loggšg_”rh
->
	`mes§ge
("ÃxˆtØ% expœed %d %d", 
i
.
	`v®ue
().
de¡_
.
	`uÅ¬£
().
	`c_¡r
(), 
ts
.
	`£c
(),s.
	`u£c
());

1359 ià(
_log
)

1360 
_log
->
	`log_expœed_rou‹
(
GridLogg”
::
NEXT_HOP_EXPIRED
, 
i
.
	`v®ue
().
de¡_
);

1366 
x_t
::
™”©Ü
 
i
 = 
expœed_¹es
.
	`begš
(); i.
	`live
(); i++) {

1367 
RTEÁry
 *
r
 = 
_¹es
.
	`fšdp
(
i
.
	`key
());

1368 
	`as£¹
(
r
);

1369 
r
->
	`šv®id©e
();

1370 
r
->
‰l
 = 
grid_h–lo
::
MAX_TTL_DEFAULT
;

1371 
»tv®
.
	`push_back
(*
r
);

1373 
x_t
::
™”©Ü
 
i
 = 
expœed_¹es
.
	`begš
(); i.
	`live
(); i++) {

1374 
boŞ
 
»moved
 = 
_¹es
.
	`»move
(
i
.
	`key
());

1375 
	`as£¹
(
»moved
);

1378 ià(
bË_chªged
)

1379 
	`log_rou‹_bË
();

1381 ià(
_log
)

1382 
_log
->
	`log_’d_expœe_hªdËr
();

1384  
»tv®
;

1385 
	}
}

1389 
	gGridRou‹TabË
::
	$h–lo_hook
(
Tim”
 *, *
thunk
)

1391 
GridRou‹TabË
 *
n
 = (GridRou‹TabË *è
thunk
;

1395 
n
->
	`expœe_rou‹s
();

1397 
VeùÜ
<
RTEÁry
> 
¹e_’Œ›s
;

1398 
RTI‹r
 
i
 = 
n
->
_¹es
.
	`begš
(); i.
	`live
(); i++) {

1406 
¹e_’Œ›s
.
	`push_back
(
i
.
	`v®ue
());

1410 
n
->
	`£nd_routšg_upd©e
(
¹e_’Œ›s
);

1412 
ušt32_t
 
r2
 = 
	`şick_¿ndom
();

1413 
r
 = (è(
r2
 >> 1);

1414 
j™‹r
 = (è(((è
n
->
_j™‹r
è* 
r
 / (() 0x7FffFFff));

1415 ià(
r2
 & 1)

1416 
j™‹r
 *= -1;

1417 
n
->
_h–lo_tim”
.
	`scheduË_aá”_m£c
Ò->
_³riod
 + (è
j™‹r
);

1418 
	}
}

1422 
	gGridRou‹TabË
::
£nd_routšg_upd©e
(
VeùÜ
<
RTEÁry
> &
¹es_to_£nd
,

1423 
boŞ
 
upd©e_£q
, boŞ 
check_‰ls
)

1433 ià(
	g_äoz’
)

1436 
	gjiff
 = 
şick_jiff›s
();

1438 
	gVeùÜ
<
	gRTEÁry
> 
	g¹e_šfo
 = 
VeùÜ
<
RTEÁry
>();

1445 
	gi
 = 0; i < 
	g¹es_to_£nd
.
size
(); i++) {

1446 
	gRTEÁry
 &
	gr
 = 
¹es_to_£nd
[
i
];

1447 ià(
	gcheck_‰ls
) {

1448 
	gage
 = 
jiff_to_m£c
(
jiff
 - 
r
.
Ï¡_upd©ed_jiff›s
);

1449 
	gÃw_‰l
 = 
deü_‰l
(
r
.
‰l
, (
age
 > 
grid_h–lo
::
MIN_TTL_DECREMENT
 ?‡ge : () grid_hello::MIN_TTL_DECREMENT));

1450 ià(
	gÃw_‰l
 > 0) {

1451 
	gr
.
	g‰l
 = 
Ãw_‰l
;

1452 
	g¹e_šfo
.
push_back
(
r
);

1455 
	g¹e_šfo
.
push_back
(
r
);

1459 
	ghdr_sz
 = (
şick_‘h”
è+ (
grid_hdr
è+ (
grid_h–lo
);

1460 
	gmax_¹es
 = (1500 - 
hdr_sz
è/ (
grid_nbr_’Œy
);

1461 
	gnum_¹es
 = (
max_¹es
 < 
¹e_šfo
.
size
() ? max_rtes :„te_info.size());

1462 
	gpsz
 = 
hdr_sz
 + (
grid_nbr_’Œy
è* 
num_¹es
;

1464 
as£¹
(
psz
 <= 1500);

1465 ià(
	gnum_¹es
 < 
	g¹e_šfo
.
size
())

1466 
şick_ch©‹r
("GridRouteTable %s:oo many„outes,runcating„oute‡dvertisement",

1467 
Çme
().
c_¡r
());

1470 
Wr™abËPack‘
 *
	gp
 = 
Pack‘
::
make
(
psz
 + 2);

1471 ià(
	gp
 == 0) {

1472 
şick_ch©‹r
("š %s: cªnÙ mak·ck‘!", 
Çme
().
c_¡r
());

1473 
as£¹
(0);

1475 
ASSERT_4ALIGNED
(
p
->
d©a
());

1476 
	gp
->
puÎ
(2);

1477 
mem£t
(
p
->
d©a
(), 0,…->
Ëngth
());

1480 
	gp
->
£t_time¡amp_ªno
(
Time¡amp
::
now
());

1483 
şick_‘h”
 *
	geh
 = (şick_‘h” *è
p
->
d©a
();

1484 
mem£t
(
eh
->
‘h”_dho¡
, 0xff, 6);

1485 
	geh
->
	g‘h”_ty³
 = 
htÚs
(
ETHERTYPE_GRID
);

1486 
memıy
(
eh
->
‘h”_sho¡
, 
_‘h
.
d©a
(), 6);

1489 
grid_hdr
 *
	ggh
 = (grid_hd¸*è(
eh
 + 1);

1490 
ASSERT_4ALIGNED
(
gh
);

1491 
	ggh
->
	ghdr_Ën
 = (
grid_hdr
);

1492 
	ggh
->
	gtÙ®_Ën
 = 
htÚs
(
psz
 - (
şick_‘h”
));

1493 
	ggh
->
	gty³
 = 
grid_hdr
::
GRID_LR_HELLO
;

1494 
	ggh
->
	g
 = 
gh
->
tx_
 = 
_
;

1495 
grid_h–lo
 *
	ghlo
 = (grid_h–lØ*è(
gh
 + 1);

1496 
as£¹
(
num_¹es
 <= 255);

1497 
	ghlo
->
	gnum_nbrs
 = (è
num_¹es
;

1498 
	ghlo
->
	gnbr_’Œy_sz
 = (
grid_nbr_’Œy
);

1499 
	ghlo
->
	g£q_no
 = 
htÚl
(
_£q_no
);

1501 
	ghlo
->
	gis_g©eway
 = 
_gw_šfo
->
is_g©eway
 ();

1504 
Time¡amp
 
	gnow
 = Time¡amp::
now
();

1505 
	g_ex‹nded_loggšg_”rh
->
mes§ge
("£ndšg %u %ld %ld", 
_£q_no
, 
now
.
£c
(),‚ow.
u£c
());

1506 ià(
	g_log
)

1507 
	g_log
->
log_£Á_adv”ti£m’t
(
_£q_no
, 
now
);

1515 
as£¹
(!(
_£q_no
 & 1));

1516 ià(
	gupd©e_£q
) {

1517 
	g_çke_£q_no
++;

1518 ià((
	g_çke_£q_no
 % 
	g_£q_d–ay
) == 0)

1519 
_£q_no
 += 2;

1522 
	g_bÿ¡_couÁ
++;

1523 
	ggrid_hdr
::
£t_·d_by‹s
(*
gh
, 
htÚl
(
_bÿ¡_couÁ
));

1525 
	ghlo
->
	g‰l
 = 
htÚl
(
grid_h–lo
::
MAX_TTL_DEFAULT
);

1527 
grid_nbr_’Œy
 *
	gcu¼
 = (grid_nbr_’Œy *è(
hlo
 + 1);

1529 
	g¡r
[80];

1530 
	gi
 = 0; i < 
	gnum_¹es
; i++, 
	gcu¼
++) {

1532 cÚ¡ 
	gRTEÁry
 &
	gf
 = 
¹e_šfo
[
i
];

1533 
¢´štf
(
¡r
, (str),

1535 
f
.
de¡_
.
uÅ¬£
().
c_¡r
(),

1536 
f
.
loc
.
s
().
c_¡r
(),

1537 
f
.
Ãxt_hİ_
.
uÅ¬£
().
c_¡r
(),

1538 
f
.
num_hİs
(),

1539 (
f
.
is_g©eway
 ? 'y' : 'n'),

1540 
f
.
£q_no
(),

1541 
f
.
m‘ric
);

1542 
	g_ex‹nded_loggšg_”rh
->
mes§ge
(
¡r
);

1544 
	g¹e_šfo
[
i
].
fl_š
(
cu¼
, 
_lšk_¡©
);

1547 
	g_ex‹nded_loggšg_”rh
->
mes§ge
("\n");

1549 
ouut
(0).
push
(
p
);

1554 
	gGridRou‹TabË
::
RTEÁry
::
	$fl_š
(
grid_nbr_’Œy
 *
nb
, 
LškSt
 *
ls
)

1556 
	`check
();

1557 
nb
->

 = 
de¡_
;

1558 
nb
->
Ãxt_hİ_
 =‚ext_hop_ip;

1559 
nb
->
num_hİs
 = 
	`num_hİs
();

1560 
nb
->
loc
 =†oc;

1561 
nb
->
loc_”r
 = 
	`htÚs
(loc_err);

1562 
nb
->
loc_good
 =†oc_good;

1563 
nb
->
£q_no
 = 
	`htÚl
(
	`£q_no
());

1564 
nb
->
m‘ric
 = 
	`htÚl
(metric);

1565 
nb
->
m‘ric_v®id
 = metric_valid;

1566 
nb
->
is_g©eway
 = is_gateway;

1567 
nb
->
‰l
 = 
	`htÚl
(ttl);

1570 #iâdeà
SMALL_GRID_HEADERS


1571 
nb
->
lšk_qu®
 = 0;

1572 
nb
->
lšk_sig
 = 0;

1573 
nb
->
m—su»m’t_time
.
tv_£c
 =‚b->m—su»m’t_time.
tv_u£c
 = 0;

1574 ià(
ls
 && 
	`num_hİs
() == 1) {

1576 
LškSt
::
¡©_t
 *
s
 = 
ls
->
_¡©s
.
	`fšdp
(
Ãxt_hİ_‘h
);

1579 
qu®
;

1580 
sig
;

1581 
timev®
 
wh’
;

1582 } *
s
 = 0;

1584 ià(
s
) {

1585 
nb
->
lšk_qu®
 = 
	`htÚl
(
s
->
qu®
);

1586 
nb
->
lšk_sig
 = 
	`htÚl
(
s
->
sig
);

1587 
nb
->
m—su»m’t_time
.
tv_£c
 = 
	`htÚl
(
s
->
wh’
.tv_sec);

1588 
nb
->
m—su»m’t_time
.
tv_u£c
 = 
	`htÚl
(
s
->
wh’
.tv_usec);

1591 
	`şick_ch©‹r
("GridRouteTable:ƒrror! unableo get signal strength or quality info for one-hop‚eighbor %s\n",

1592 
	`IPAdd»ss
(
de¡_
).
	`uÅ¬£
().
	`c_¡r
());

1594 
nb
->
num_rx
 = 0;

1595 
nb
->
num_ex³ùed
 = 0;

1596 
nb
->
Ï¡_bÿ¡
.
tv_£c
 =‚b->Ï¡_bÿ¡.
tv_u£c
 = 0;

1597 
wšdow
 = 0;

1598 
num_rx
 = 0;

1599 
num_ex³ùed
 = 0;

1600 
boŞ
 
»s
 = 
ls
->
	`g‘_bÿ¡_¡©s
(
Ãxt_hİ_‘h
, 
nb
->
Ï¡_bÿ¡
, 
wšdow
, 
num_rx
, 
num_ex³ùed
);

1601 ià(
»s
) {

1602 ià(
num_rx
 > 255 || 
num_ex³ùed
 > 255) {

1603 
	`şick_ch©‹r
("GridRouteTable:ƒrror! overflow on broadcast†oss stats for one-hop‚eighbor %s",

1604 
	`IPAdd»ss
(
de¡_
).
	`uÅ¬£
().
	`c_¡r
());

1605 
num_rx
 = 
num_ex³ùed
 = 255;

1607 
nb
->
num_rx
 =‚um_rx;

1608 
nb
->
num_ex³ùed
 =‚um_expected;

1609 
nb
->
Ï¡_bÿ¡
 = 
	`htÚ
(nb->last_bcast);

1613 
ls
 = 0;

1615 
	}
}

1617 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

1618 
	$EXPORT_ELEMENT
(
GridRou‹TabË
)

1619 
	$ELEMENT_PROVIDES
(
GridG’”icRou‹TabË
)

1620 
CLICK_ENDDECLS


	@grid/gridroutetable.hh

1 #iâdeà
GRIDROUTETABLE_HH


2 
	#GRIDROUTETABLE_HH


	)

77 
	~<şick/bighashm­.hh
>

78 
	~<şick/‘h”add»ss.hh
>

79 
	~<şick/add»ss.hh
>

80 
	~<–em’ts/grid/gridg©ewayšfo.hh
>

81 
	~<–em’ts/grid/lškŒack”.hh
>

82 
	~<–em’ts/grid/lšk¡©.hh
>

83 
	~"grid.hh
"

84 
	~"gridg’”iüt.hh
"

85 
	~<şick/tim”.hh
>

86 
CLICK_DECLS


90 
şass
 
	gGridLogg”
;

92 şas 
	cGridRou‹TabË
 : 
public
 
GridG’”icRou‹TabË
 {

93 
public
:

95 
boŞ
 
cu¼’t_g©eway
(
Rou‹EÁry
 &
’Œy
);

96 
boŞ
 
g‘_Úe_’Œy
(cÚ¡ 
IPAdd»ss
 &
de¡_
, 
Rou‹EÁry
 &
’Œy
);

97 
g‘_®l_’Œ›s
(
VeùÜ
<
Rou‹EÁry
> &
vec
);

100 
	mpublic
:

102 
	$GridRou‹TabË
(è
CLICK_COLD
;

103 ~
	$GridRou‹TabË
(è
CLICK_COLD
;

105 cÚ¡ *
	$şass_Çme
() const {  "GridRouteTable"; }

106 *
	`ÿ¡
(const *);

107 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

108 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "h/h"; 
	}
}

109 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

111 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

112 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

114 
vœtu®
 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
çl£
; 
	}
}

116 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

118 
	$add_hªdËrs
(è
CLICK_COLD
;

121 
´iv©e
:

125 şas 
	cRTEÁry
 {

126 
boŞ
 
_š™
;

128 
public
:

129 
IPAdd»ss
 
de¡_
;

130 
Eth”Add»ss
 
de¡_‘h
;

131 
IPAdd»ss
 
Ãxt_hİ_
;

132 
Eth”Add»ss
 
Ãxt_hİ_‘h
;

134 
´iv©e
:

135 
_num_hİs
;

136 
public
:

137 
	`num_hİs
(ècÚ¡ { 
	`check
();  
_num_hİs
; }

139 
	`šv®id©e
() {

140 
	`check
();

141 
	`as£¹
(
_num_hİs
 > 0 && !(
_£q_no
 & 1));

142 
_num_hİs
 = 0; 
_£q_no
++;

143 
	`check
();

146 
grid_loÿtiÚ
 
loc
;

147 
loc_”r
;

148 
boŞ
 
loc_good
;

149 
boŞ
 
is_g©eway
;

151 
´iv©e
:

152 
_£q_no
;

153 
public
:

154 
	`£q_no
(ècÚ¡ { 
	`check
();  
_£q_no
; }

155 
‰l
;

157 
Ï¡_upd©ed_jiff›s
;

159 
m‘ric
;

160 
boŞ
 
m‘ric_v®id
;

165 
	`RTEÁry
() :

166 
	`_š™
(
çl£
), 
	`_num_hİs
(0), 
	`loc_good
(çl£), 
	`is_g©eway
(false),

167 
	`_£q_no
(0), 
	`‰l
(0), 
	`Ï¡_upd©ed_jiff›s
(-1), 
	`m‘ric_v®id
(
çl£
)

170 
public
:

171 
	`RTEÁry
(
IPAdd»ss
 
_de¡_
, IPAdd»s 
_Ãxt_hİ_
, 
Eth”Add»ss
 
_Ãxt_hİ_‘h
,

172 
num_hİs
, 
grid_loÿtiÚ
 
_loc
, 
_loc_”r
,

173 
boŞ
 
_loc_good
, boŞ 
_is_g©eway
, 
£q_no
, 
_‰l
,

174 
_Ï¡_upd©ed_jiff›s
) :

175 
	`_š™
(
Œue
), 
	`de¡_
(
_de¡_
), 
	`Ãxt_hİ_
(
_Ãxt_hİ_
),

176 
	`Ãxt_hİ_‘h
(
_Ãxt_hİ_‘h
), 
	`_num_hİs
(
num_hİs
), 
	`loc
(
_loc
),

177 
	`loc_”r
(
_loc_”r
), 
	`loc_good
(
_loc_good
), 
	`is_g©eway
(
_is_g©eway
),

178 
	`_£q_no
(
£q_no
), 
	`‰l
(
_‰l
),

179 
	`Ï¡_upd©ed_jiff›s
(
_Ï¡_upd©ed_jiff›s
), 
	`m‘ric_v®id
(
çl£
)

180 { 
	`check
(); }

183 
	`RTEÁry
(
IPAdd»ss
 

, 
Eth”Add»ss
 
‘h
, 
grid_hdr
 *
gh
, 
grid_h–lo
 *
hlo
,

184 
jiff
) :

185 
	`_š™
(
Œue
), 
	`de¡_
(

), 
	`de¡_‘h
(
‘h
), 
	`Ãxt_hİ_
(), 
	`Ãxt_hİ_‘h
Óth), 
	`_num_hİs
(1),

186 
	`loc
(
gh
->
loc
), 
	`loc_good
(gh->
loc_good
), 
	`is_g©eway
(
hlo
->
is_g©eway
),

187 
	`Ï¡_upd©ed_jiff›s
(
jiff
), 
	`m‘ric_v®id
(
çl£
)

189 
loc_”r
 = 
	`Áohs
(
gh
->loc_err);

190 
_£q_no
 = 
	`Áohl
(
hlo
->
£q_no
);

191 
‰l
 = 
	`Áohl
(
hlo
->ttl);

192 
	`check
();

196 
	`RTEÁry
(
IPAdd»ss
 

, 
Eth”Add»ss
 
‘h
, 
grid_nbr_’Œy
 *
nbr
,

197 
jiff
) :

198 
	`_š™
(
Œue
), 
	`de¡_
(
nbr
->

), 
	`Ãxt_hİ_
(), 
	`Ãxt_hİ_‘h
(
‘h
),

199 
	`_num_hİs
(
nbr
->
num_hİs
 ?‚br->num_hİ + 1 : 0), 
	`loc
Òbr->
loc
), 
	`loc_good
Òbr->
loc_good
),

200 
	`is_g©eway
(
nbr
->
is_g©eway
), 
	`Ï¡_upd©ed_jiff›s
(
jiff
),

201 
	`m‘ric_v®id
(
nbr
->
m‘ric_v®id
)

203 
loc_”r
 = 
	`Áohs
(
nbr
->loc_err);

204 
_£q_no
 = 
	`Áohl
(
nbr
->
£q_no
);

205 
‰l
 = 
	`Áohl
(
nbr
->ttl);

206 
m‘ric
 = 
	`Áohl
(
nbr
->metric);

207 
	`check
();

211 
	`fl_š
(
grid_nbr_’Œy
 *
nb
, 
LškSt
 *
ls
 = 0);

212 
	`check
(ècÚ¡ { 
	`as£¹
(
_š™
);‡s£¹((
_num_hİs
 > 0è!ğ(
_£q_no
 & 1)); }

213 
	}
};

215 
	gHashM­
<
	tIPAdd»ss
, 
	tRTEÁry
> 
	tRTabË
;

216 
	gRTabË
::
	t™”©Ü
 
	tRTI‹r
;

219 
RTabË
 
	g_¹es
;

221 
g‘_¹es
(
VeùÜ
<
RTEÁry
> *
»tv®
);

223 
	g´iv©e
:

225 
_timeout
;

226 
	g_timeout_jiff›s
;

229 
	g_³riod
;

230 
	g_j™‹r
;

232 
GridG©ewayInfo
 *
	g_gw_šfo
;

233 
LškT¿ck”
 *
	g_lšk_Œack”
;

234 
LškSt
 *
	g_lšk_¡©
;

237 cÚ¡ 
	gEXPIRE_TIMER_PERIOD
 = 100;

240 
E¼ÜHªdËr
 *
	g_ex‹nded_loggšg_”rh
;

241 
log_rou‹_bË
();

244 
GridLogg”
 *
	g_log
;

245 
	g_dump_tick
;

248 
IPAdd»ss
 
	g_
;

249 
Eth”Add»ss
 
	g_‘h
;

252 
	g_£q_no
;

253 
	g_çke_£q_no
;

254 
	g_bÿ¡_couÁ
;

255 
	g_£q_d–ay
;

258 
	g_max_hİs
;

260 
Tim”
 
	g_expœe_tim”
;

261 
Tim”
 
	g_h–lo_tim”
;

264 
expœe_hook
(
Tim”
 *, *);

267 
	gVeùÜ
<
	gRTEÁry
> 
expœe_rou‹s
();

270 
h–lo_hook
(
Tim”
 *, *);

273 
£nd_routšg_upd©e
(
VeùÜ
<
RTEÁry
> &
¹es_to_£nd
, 
boŞ
 
upd©e_£q
 = 
Œue
, boŞ 
check_‰ls
 =rue);

275 
	$deü_‰l
(
‰l
, 
deü
)

276 {  (
‰l
 > 
deü
 ? - deü : 0); 
	}
}

278 
	$jiff_to_m£c
(
j
)

279 {  (
j
 * 1000è/ 
CLICK_HZ
; 
	}
}

281 
	$m£c_to_jiff
(
m
)

282 {  (
CLICK_HZ
 * 
m
è/ 1000; 
	}
}

285 
upd©e_m‘ric
(
RTEÁry
 &);

288 
š™_m‘ric
(
RTEÁry
 &);

294 
boŞ
 
m‘ric_is_´eã¿bË
(cÚ¡ 
RTEÁry
 &, const RTEntry &);

297 
boŞ
 
should_»¶aû_Şd_rou‹
(cÚ¡ 
RTEÁry
 &, const RTEntry &);

299 
SŒšg
 
´št_¹es
(
EËm’t
 *
e
, *);

300 
SŒšg
 
´št_¹es_v
(
EËm’t
 *
e
, *);

301 
SŒšg
 
´št_nbrs
(
EËm’t
 *
e
, *);

302 
SŒšg
 
´št_nbrs_v
(
EËm’t
 *
e
, *);

303 
SŒšg
 
´št_
(
EËm’t
 *
e
, *);

304 
SŒšg
 
´št_‘h
(
EËm’t
 *
e
, *);

305 
SŒšg
 
´št_lšks
(
EËm’t
 *
e
, *);

307 
SŒšg
 
´št_m‘ric_ty³
(
EËm’t
 *
e
, *);

308 
wr™e_m‘ric_ty³
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

310 
SŒšg
 
´št_m‘ric_¿nge
(
EËm’t
 *
e
, *);

311 
wr™e_m‘ric_¿nge
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

313 
SŒšg
 
´št_e¡_ty³
(
EËm’t
 *
e
, *);

314 
wr™e_e¡_ty³
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

316 
SŒšg
 
´št_£q_d–ay
(
EËm’t
 *
e
, *);

317 
wr™e_£q_d–ay
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

319 
SŒšg
 
´št_äoz’
(
EËm’t
 *
e
, *);

320 
wr™e_äoz’
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

322 
qu®_to_pù
(
q
);

323 
sig_to_pù
(
s
);

325 
boŞ
 
e¡_fÜw¬d_d–iv”y_¿‹
(cÚ¡ 
IPAdd»ss
, &);

326 
boŞ
 
e¡_»v”£_d–iv”y_¿‹
(cÚ¡ 
IPAdd»ss
, &);

328 
	eM‘ricTy³
 {

329 
	gM‘ricUnknown
 = -1,

330 
	gM‘ricHİCouÁ
 = 0,

331 
	gM‘ricCumuÏtiveD–iv”yR©e
,

332 
	gM‘ricMšD–iv”yR©e
,

333 
	gM‘ricMšSigSŒ’gth
,

334 
	gM‘ricMšSigQu®™y
,

335 
	gM‘ricCumuÏtiveQu®Pù
,

336 
	gM‘ricCumuÏtiveSigPù
,

337 
	gM‘ricE¡TxCouÁ


340 
SŒšg
 
m‘ric_ty³_to_¡ršg
(
M‘ricTy³
 
t
);

341 
M‘ricTy³
 
check_m‘ric_ty³
(cÚ¡ 
SŒšg
 &);

343 
M‘ricTy³
 
	g_m‘ric_ty³
;

346 
	g_max_m‘ric
;

347 
	g_mš_m‘ric
;

349 cÚ¡ 
	g_bad_m‘ric
 = 7777777;

359 cÚ¡ 
	g_max_qu®
 = 130;

360 cÚ¡ 
	g_mš_qu®
 = 0;

361 cÚ¡ 
	g_max_sig
 = -13;

362 cÚ¡ 
	g_mš_sig
 = -100;

366 
	gE¡ByQu®
 = 0,

367 
	gE¡BySig
,

368 
	gE¡BySigQu®
,

369 
	gE¡ByM—s


372 
	g_e¡_ty³
;

374 
boŞ
 
	g_äoz’
;

376 
Rou‹EÁry
 
	$make_g’”ic_¹e
(cÚ¡ 
RTEÁry
 &
¹e
) {

377  
	`Rou‹EÁry
(
¹e
.
de¡_
,„‹.
loc_good
,„‹.
loc_”r
,„‹.
loc
,

378 
¹e
.
Ãxt_hİ_‘h
,„‹.
Ãxt_hİ_
,

380 
¹e
.
	`£q_no
(),„‹.
	`num_hİs
());

381 
	}
}

385 
	gCLICK_ENDDECLS


	@grid/gridsrforwarder.cc

1 
	~<şick/cÚfig.h
>

2 
	~<şick/”rÜ.hh
>

3 
	~<şick/glue.hh
>

4 
	~<şick/¬gs.hh
>

5 
	~<şickÃt/udp.h
>

6 
	~<şick/·ck‘.hh
>

7 
	~"grid¤fÜw¬d”.hh
"

8 
CLICK_DECLS


10 
	gGridSRFÜw¬d”
::
	$GridSRFÜw¬d”
()

13 
	}
}

15 
GridSRFÜw¬d”
::~
	$GridSRFÜw¬d”
()

18 
	}
}

21 
GridSRFÜw¬d”
::
	$ÿ¡
(cÚ¡ *
Çme
)

24 ià(
	`¡rcmp
(
Çme
, "GridSRForwarder") == 0)

25  (*è
this
;

28 
	}
}

31 
	gGridSRFÜw¬d”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

33  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("IP", 
_
).
com¶‘e
();

37 
	gGridSRFÜw¬d”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

40 
	}
}

43 
	gGridSRFÜw¬d”
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

45 
	`as£¹
(
pÜt
 == 0);

46 
	`hªdË_ho¡
(
p
);

47 
	}
}

50 
	gGridSRFÜw¬d”
::
	$hªdË_ho¡
(
Pack‘
 *
p
)

54 ià(
p
->
	`Ëngth
() != 124 - 14) {

55 
	`şick_ch©‹r
("GridSRForwarder: bad SR…acket†ength %d, should be 124 - 14, dropping",

56 
p
->
	`Ëngth
());

57 
p
->
	`kl
();

61 
şick_
 *
h
 = (şick_ *è
p
->
	`d©a
();

62 
şick_udp
 *
uh
 = (şick_ud°*è(
h
 + 1);

63 *
¥
 = (*è(
uh
 + 1);

65 
rou‹_Ën
 = 
	`Áohs
(*
¥
);

66 
¥
++;

67 
VeùÜ
<> 
hİs
;

68 
i
 = 0; i < 
rou‹_Ën
; i++, 
¥
++)

69 
hİs
.
	`push_back
(
	`Áohs
(*
¥
));

71 *
Í
 = (*è
¥
;

72 
¤c
 = 
	`Áohl
(*
Í
);

73 
Í
++;

75 *
ı
 = (*è
Í
;

76 
exp_id
[18];

77 
	`mem£t
(
exp_id
, 0, (exp_id));

78 
	`memıy
(
exp_id
, 
ı
, (exp_id));

79 
exp_id
[17] = 0;

81 
ı
 += 18;

82 
rou‹_id
[18];

83 
	`mem£t
(
rou‹_id
, 0, (route_id));

84 
	`memıy
(
rou‹_id
, 
ı
, (route_id));

85 
rou‹_id
[17] = 0;

87 
ı
 += 18;

88 
Í
 = (*è
ı
;

89 
·ck‘_couÁ
 = 
	`Áohl
(*
Í
);

91 ià(
rou‹_Ën
 < 1) {

92 
	`şick_ch©‹r
("GridSRForwarder:‚o hop data, dropping");

93 
p
->
	`kl
();

97 
my_addr
 = 
	`Áohl
(
_
.
	`addr
()) & 0xff;

98 ià(
my_addr
 !ğ
hİs
[0]) {

99 
	`şick_ch©‹r
("GridSRForwarder:his hop‚ot us! dropping");

100 
p
->
	`kl
();

104 ià(
rou‹_Ën
 == 1) {

106 
	`ouut
(1).
	`push
(
p
);

110 
¥
 = (*è(
uh
 + 1);

111 *
¥
 = 
	`htÚs
(
rou‹_Ën
 - 1);

112 
¥
++;

113 
i
 = 1; i < 
rou‹_Ën
; i++, 
¥
++)

114 *
¥
 = 
	`htÚs
(
hİs
[
i
]);

115 
Í
 = (*)
¥
;

116 *
Í
 = 
	`htÚl
(
¤c
);

117 
Í
++;

118 
ı
 = (*è
Í
;

119 
	`memıy
(
ı
, 
rou‹_id
, 18);

120 
ı
 += 18;

121 
	`memıy
(
ı
, 
exp_id
, 18);

122 
ı
 += 18;

123 
Í
 = (*è
ı
;

124 *
Í
 = 
	`htÚl
(
·ck‘_couÁ
);

127 
h
->
_¤c
 = 
_
;

128 
h
->
_d¡
.
s_addr
 = 
	`htÚl
((
	`Áohl
(
_
.
	`addr
()è& 0xffFFff00è| 
hİs
[1]);

132 
uh
->
uh_sum
 = 0;

133 
csum
 = ~
	`şick_š_cksum
((*è
uh
, 
	`Áohs
(uh->
uh_uËn
)) & 0xFFFF;

134 *
wÜds
 = (*è&
h
->
_¤c
;

135 
csum
 +ğ
wÜds
[0];

136 
csum
 +ğ
wÜds
[1];

137 
csum
 +ğ
wÜds
[2];

138 
csum
 +ğ
wÜds
[3];

139 
csum
 +ğ
	`htÚs
(
IP_PROTO_UDP
);

140 
csum
 +ğ
	`htÚs
(
p
->
	`Ëngth
(è- (
şick_
));

141 
csum
 >> 16)

142 
csum
 = (csum & 0xFFFF) + (csum >> 16);

143 
uh
->
uh_sum
 = ~
csum
 & 0xFFFF;

145 
	`ouut
(0).
	`push
(
p
);

147 
	}
}

149 
CLICK_ENDDECLS


150 
	$EXPORT_ELEMENT
(
GridSRFÜw¬d”
)

151 
	`ELEMENT_REQUIRES
(
u£¾ev–
)

	@grid/gridsrforwarder.hh

1 #iâdeà
GRIDSRFW


2 
	#GRIDSRFW


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/add»ss.hh
>

6 
CLICK_DECLS


8 şas 
	cGridSRFÜw¬d”
 : 
public
 
EËm’t
 {

10 
public
:

11 
	$GridSRFÜw¬d”
(è
CLICK_COLD
;

12 ~
	$GridSRFÜw¬d”
(è
CLICK_COLD
;

14 cÚ¡ *
	$şass_Çme
() const {  "GridSRForwarder"; }

15 *
	`ÿ¡
(const *);

16 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/2"; 
	}
}

17 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "h/h"; 
	}
}

18 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/x"; 
	}
}

19 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

20 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

22 
	`push
(
pÜt
, 
Pack‘
 *);

24 
´iv©e
:

25 
IPAdd»ss
 
_
;

27 
	`hªdË_ho¡
(
Pack‘
 *
p
);

28 
	}
};

30 
	gCLICK_ENDDECLS


	@grid/gridtxerror.cc

19 
	~<şick/cÚfig.h
>

20 
	~"gridtx”rÜ.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
	~"gridg’”işogg”.hh
"

26 
CLICK_DECLS


28 
	gGridTxE¼Ü
::
	$GridTxE¼Ü
()

29 : 
	$_log
(0)

31 
	}
}

33 
GridTxE¼Ü
::~
	$GridTxE¼Ü
()

35 
	}
}

38 
GridTxE¼Ü
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

41 
	}
}

44 
	gGridTxE¼Ü
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

46  
Args
(
cÚf
, 
this
, 
”rh
)

47 .
»ad
("LOG", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_log
))

48 .
com¶‘e
();

52 
	gGridTxE¼Ü
::
	$push
(, 
Pack‘
 *
p
)

55 ià(
_log
)

56 
_log
->
	`log_tx_”r
(
p
, 
	`SEND_ERR_ANNO
Õ), 
Time¡amp
::
	`now
());

58 
p
->
	`kl
();

59 
	}
}

61 
CLICK_ENDDECLS


62 
EXPORT_ELEMENT
(
GridTxE¼Ü
);

	@grid/gridtxerror.hh

1 #iâdeà
GRIDTXERR_HH


2 
	#GRIDTXERR_HH


	)

17 
	~<şick/–em’t.hh
>

18 
CLICK_DECLS


20 
şass
 
	gGridG’”icLogg”
;

22 şas 
	cGridTxE¼Ü
 : 
public
 
EËm’t
 {…ublic:

24 
	$GridTxE¼Ü
(è
CLICK_COLD
;

25 ~
	$GridTxE¼Ü
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "GridTxError"; }

28 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_0
; 
	}
}

29 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

31 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

32 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

33 
	`push
(, 
Pack‘
 *);

35 
´iv©e
:

36 
GridG’”icLogg”
 *
_log
;

38 
	}
};

40 
	gCLICK_ENDDECLS


	@grid/hello.cc

18 
	~<şick/cÚfig.h
>

19 
	~"h–lo.hh
"

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~"grid.hh
"

25 
CLICK_DECLS


27 
	gS’dGridH–lo
::
	$S’dGridH–lo
()

28 : 
	$_tim”
(
this
)

30 
	}
}

32 
S’dGridH–lo
::~
	$S’dGridH–lo
()

34 
	}
}

37 
S’dGridH–lo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad_mp
("PERIOD", 
_³riod
)

41 .
»ad_mp
("JITTER", 
_j™‹r
)

42 .
»ad_mp
("ETH", 
_äom_‘h
)

43 .
»ad_mp
("IP", 
_äom_
)

44 .
com¶‘e
();

45 ià(
	g»s
 < 0)

46  
	g»s
;

48 ià(
	g_³riod
 <= 0)

49  
”rh
->
”rÜ
("period must be greaterhan 0");

50 ià(
	g_j™‹r
 < 0)

51  
	g”rh
->
”rÜ
("period must be…ositive");

52 ià(
	g_j™‹r
 > 
	g_³riod
)

53  
	g”rh
->
”rÜ
("jitter is biggerhan…eriod");

54  
	g»s
;

58 
	gS’dGridH–lo
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

60 
_tim”
.
	`š™Ÿlize
(
this
);

61 
_tim”
.
	`scheduË_aá”_m£c
(
_³riod
);

64 
	}
}

67 
	gS’dGridH–lo
::
	$run_tim”
(
Tim”
 *)

69 
	`ouut
(0).
	`push
(
	`make_h–lo
());

73 
ušt32_t
 
r2
 = 
	`şick_¿ndom
();

74 
r
 = (è(
r2
 >> 1);

75 
j™‹r
 = (è(((è
_j™‹r
è* 
r
 / (() 0x7FffFFff));

76 ià(
r2
 & 1)

77 
j™‹r
 *= -1;

78 
_tim”
.
	`scheduË_aá”_m£c
(
_³riod
 + (è
j™‹r
);

79 
	}
}

81 
Pack‘
 *

82 
	gS’dGridH–lo
::
	$make_h–lo
()

84 
psz
 = (
şick_‘h”
è+ (
grid_hdr
);

86 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
psz
 + 2);

87 ià(
p
 == 0) {

88 
	`şick_ch©‹r
("š %s: cªnÙ mak·ck‘!", 
	`Çme
().
	`c_¡r
());

89 
	`as£¹
(0);

91 
	`ASSERT_4ALIGNED
(
p
->
	`d©a
());

92 
p
->
	`puÎ
(2);

93 
	`mem£t
(
p
->
	`d©a
(), 0,…->
	`Ëngth
());

95 
p
->
	`£t_time¡amp_ªno
(
Time¡amp
::
	`now
());

97 
şick_‘h”
 *
eh
 = (şick_‘h” *è
p
->
	`d©a
();

98 
	`mem£t
(
eh
->
‘h”_dho¡
, 0xff, 6);

99 
eh
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_GRID
);

100 
	`memıy
(
eh
->
‘h”_sho¡
, 
_äom_‘h
.
	`d©a
(), 6);

102 
grid_hdr
 *
gh
 = (grid_hd¸*è(
eh
 + 1);

103 
gh
->
hdr_Ën
 = (
grid_hdr
);

104 
gh
->
tÙ®_Ën
 = 
	`htÚs
((
grid_hdr
));

105 
gh
->
ty³
 = 
grid_hdr
::
GRID_HELLO
;

106 
gh
->

 = 
_äom_
;

108  
p
;

109 
	}
}

111 
CLICK_ENDDECLS


112 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

113 
	`EXPORT_ELEMENT
(
S’dGridH–lo
)

	@grid/hello.hh

1 #iâdeà
HELLO_HH


2 
	#HELLO_HH


	)

25 
	~<şick/–em’t.hh
>

26 
	~<şick/tim”.hh
>

27 
	~<şick/‘h”add»ss.hh
>

28 
	~<şick/add»ss.hh
>

29 
CLICK_DECLS


31 şas 
	cS’dGridH–lo
 : 
public
 
EËm’t
 {

33 
public
:

35 
	$S’dGridH–lo
(è
CLICK_COLD
;

36 ~
	$S’dGridH–lo
(è
CLICK_COLD
;

38 cÚ¡ *
	$şass_Çme
() const {  "SendGridHello"; }

39 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

40 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

42 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

43 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

45 
Pack‘
 *
	`make_h–lo
();

47 
	`run_tim”
(
Tim”
 *);

49 
´iv©e
:

51 
Eth”Add»ss
 
_äom_‘h
;

52 
IPAdd»ss
 
_äom_
;

53 
_³riod
;

54 
_j™‹r
;

55 
Tim”
 
_tim”
;

56 
	}
};

58 
	gCLICK_ENDDECLS


	@grid/hopcountmetric.cc

16 
	~<şick/cÚfig.h
>

17 
	~<şick/¬gs.hh
>

18 
	~"–em’ts/grid/hİcouÁm‘ric.hh
"

19 
CLICK_DECLS


21 cÚ¡ 
	gGridG’”icM‘ric
::
m‘ric_t
 
GridG’”icM‘ric
::
_bad_m‘ric
(777777, 
çl£
);

23 
	gHİcouÁM‘ric
::
	$HİcouÁM‘ric
()

25 
	}
}

27 
HİcouÁM‘ric
::~
	$HİcouÁM‘ric
()

29 
	}
}

32 
HİcouÁM‘ric
::
	$ÿ¡
(cÚ¡ *
n
)

34 ià(
	`¡rcmp
(
n
, "HopcountMetric") == 0)

35  (
HİcouÁM‘ric
 *è
this
;

36 ià(
	`¡rcmp
(
n
, "GridGenericMetric") == 0)

37  (
GridG’”icM‘ric
 *è
this
;

40 
	}
}

43 
boŞ


44 
	gHİcouÁM‘ric
::
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &
m1
, cÚ¡ m‘ric_ˆ&
m2
) const

46  
m1
.
	`v®
(è< 
m2
.val();

47 
	}
}

49 
	gGridG’”icM‘ric
::
m‘ric_t


50 
HİcouÁM‘ric
::
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &, 
boŞ
) const

53  
	`m‘ric_t
(1);

54 
	}
}

56 
	gGridG’”icM‘ric
::
m‘ric_t


57 
HİcouÁM‘ric
::
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

59 ià(!
r
.
	`good
(è|| !
l
.good())

60  
_bad_m‘ric
;

62  
	`m‘ric_t
(
r
.
	`v®
(è+ 
l
.val());

63 
	}
}

66 
	$ELEMENT_PROVIDES
(
GridG’”icM‘ric
)

67 
	$EXPORT_ELEMENT
(
HİcouÁM‘ric
)

69 
CLICK_ENDDECLS


	@grid/hopcountmetric.hh

1 #iâdeà
HCMETRIC_HH


2 
	#HCMETRIC_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"gridg’”icm‘ric.hh
"

5 
CLICK_DECLS


18 şas 
	cHİcouÁM‘ric
 : 
public
 
GridG’”icM‘ric
 {

20 
public
:

22 
	$HİcouÁM‘ric
(è
CLICK_COLD
;

23 ~
	$HİcouÁM‘ric
(è
CLICK_COLD
;

25 cÚ¡ *
	$şass_Çme
() const {  "HopcountMetric"; }

26 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_0
; 
	}
}

27 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

29 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
çl£
; 
	}
}

31 *
ÿ¡
(const *);

34 
boŞ
 
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

35 
m‘ric_t
 
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &
n
, 
boŞ
) const;

36 
m‘ric_t
 
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

37 
m‘ric_t
 
	$´•’d_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

38 {  
	`­³nd_m‘ric
(
r
, 
l
); 
	}
}

40 
	$sÿË_to_ch¬
(cÚ¡ 
m‘ric_t
 &
m
ècÚ¡ {  (èm.
	`v®
(); 
	}
}

41 
m‘ric_t
 
	$unsÿË_äom_ch¬
(
c
ècÚ¡ {  
	`m‘ric_t
(c); 
	}
}

46 
	gCLICK_ENDDECLS


	@grid/incseqno.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/”rÜ.hh
>

20 
	~<şick/¬gs.hh
>

21 
	~"šc£qno.hh
"

22 
CLICK_DECLS


24 
	gInüem’tSeqNo
::
	$Inüem’tSeqNo
()

25 : 
	`_£qno
(0), 
	$_off£t
(0)

27 
	}
}

29 
	gInüem’tSeqNo
::~
	$Inüem’tSeqNo
()

31 
	}
}

33 
Pack‘
 *

34 
Inüem’tSeqNo
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

36 ià(
p
->
	`Ëngth
(è< 
_off£t
 + 4) {

37 
	`şick_ch©‹r
("IncrementSeqNo %s:…acket of %d bytes isoo smallo hold sequence‚umber‡t offset %u",

38 
	`Çme
().
	`c_¡r
(), 
p
->
	`Ëngth
(), 
_off£t
);

39  
p
;

42 
Wr™abËPack‘
 *
wp
 = 
p
->
	`uniqueify
();

43 
ušt32_t
 *
up
 = (ušt32_ˆ*è(
wp
->
	`d©a
(è+ 
_off£t
);

44 ià(
_u£_Ãt_by‹Üd”
)

45 *
up
 = 
	`htÚl
(
_£qno
);

47 *
up
 = 
_£qno
;

48 
_£qno
++;

49  
wp
;

50 
	}
}

53 
	gInüem’tSeqNo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

55 
	g_£qno
 = 0;

56 
	g_off£t
 = 0;

57 
	g_u£_Ãt_by‹Üd”
 = 
çl£
;

58  
Args
(
cÚf
, 
this
, 
”rh
)

59 .
»ad
("OFFSET", 
_off£t
)

60 .
»ad
("FIRST", 
_£qno
)

61 .
»ad
("NET_BYTE_ORDER", 
_u£_Ãt_by‹Üd”
)

62 .
com¶‘e
();

66 
	gInüem’tSeqNo
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

69 
	}
}

72 
	gInüem’tSeqNo
::
	$add_hªdËrs
() {

73 
	`add_»ad_hªdËr
("£q", 
Ãxt_£q
, 0);

74 
	`add_wr™e_hªdËr
("£q", 
wr™e_£q
, 0);

75 
	}
}

78 
	gInüem’tSeqNo
::
	$wr™e_£q
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *,

79 
E¼ÜHªdËr
 *
”rh
)

81 
Inüem’tSeqNo
 *
e2
 = (Inüem’tSeqNØ*è
e
;

83 
i
;

84 ià(!
	`IÁArg
().
	`·r£
(
š_s
, 
i
)) {

85  
”rh
->
	`”rÜ
("seq must be unsigned");

87 
e2
->
_£qno
 = 
i
;

89 
	}
}

91 
SŒšg


92 
	gInüem’tSeqNo
::
	$Ãxt_£q
(
EËm’t
 *
e
, *)

94 
Inüem’tSeqNo
 *
e2
 = (Inüem’tSeqNØ*è
e
;

95  
	`SŒšg
(
e2
->
_£qno
);

96 
	}
}

98 
CLICK_ENDDECLS


99 
EXPORT_ELEMENT
(
Inüem’tSeqNo
)

	@grid/incseqno.hh

1 #iâdeà
INCSEQNO_HH


2 
	#INCSEQNO_HH


	)

42 
	~<şick/–em’t.hh
>

44 
CLICK_DECLS


46 şas 
	cInüem’tSeqNo
 : 
public
 
EËm’t
 {

47 
public
:

49 
	$Inüem’tSeqNo
(è
CLICK_COLD
;

50 ~
	$Inüem’tSeqNo
(è
CLICK_COLD
;

52 cÚ¡ *
	$şass_Çme
() const {  "IncrementSeqNo"; }

53 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

54 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

56 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

57 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

59 
	$add_hªdËrs
(è
CLICK_COLD
;

61 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

63 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

65 
	g´iv©e
:

67 
SŒšg
 
Ãxt_£q
(
EËm’t
 *
e
, *);

68 
wr™e_£q
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

69 
E¼ÜHªdËr
 *
”rh
);

70 
ušt32_t
 
	g_£qno
;

71 
	g_off£t
;

72 
boŞ
 
	g_u£_Ãt_by‹Üd”
;

75 
	gCLICK_ENDDECLS


	@grid/linkstat.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/tim”.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<–em’ts/grid/grid.hh
>

26 
	~<–em’ts/grid/lšk¡©.hh
>

27 
	~<–em’ts/grid/timeuts.hh
>

28 
CLICK_DECLS


30 
	gLškSt
::
	$LškSt
()

31 : 
	`_wšdow
(100), 
	`_u
(10000), 
	`_³riod
(1000),

32 
	`_´obe_size
(1000), 
	`_£q
(0), 
	`_£nd_tim”
(0),

33 
	$_u£_´Ùo2
(
çl£
)

35 
	}
}

37 
	gLškSt
::~
	$LškSt
()

39 
	}
}

43 
LškSt
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

45 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

46 .
»ad
("WINDOW", 
_wšdow
)

47 .
»ad
("ETH", 
_‘h
)

48 .
»ad
("PERIOD", 
_³riod
)

49 .
»ad
("TAU", 
_u
)

50 .
»ad
("SIZE", 
_´obe_size
)

51 .
»ad
("USE_SECOND_PROTO", 
_u£_´Ùo2
)

52 .
com¶‘e
();

53 ià(
	g»s
 < 0)

54  
	g»s
;

56 
	gmš_sz
 = (
şick_‘h”
è+ 
lšk_´obe
::
size
;

57 ià(
	g_´obe_size
 < 
	gmš_sz
)

58  
	g”rh
->
”rÜ
("Specified…acket size is†esshanhe minimum…robe size of %u",

59 
mš_sz
);

61  
	g»s
;

65 
	gLškSt
::
	$£nd_hook
()

67 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
_´obe_size
 + 2);

68 ià(
p
 == 0) {

69 
	`şick_ch©‹r
("LškSˆ%s: cªnÙ mak·ck‘!", 
	`Çme
().
	`c_¡r
());

72 
	`ASSERT_4ALIGNED
(
p
->
	`d©a
());

73 
p
->
	`puÎ
(2);

74 
	`mem£t
(
p
->
	`d©a
(), 0,…->
	`Ëngth
());

76 
p
->
	`£t_time¡amp_ªno
(
Time¡amp
::
	`now
());

79 
şick_‘h”
 *
eh
 = (şick_‘h” *è
p
->
	`d©a
();

80 
	`mem£t
(
eh
->
‘h”_dho¡
, 0xff, 6);

81 
eh
->
‘h”_ty³
 = 
	`htÚs
(
_u£_´Ùo2
 ? 
ETHERTYPE_LINKSTAT2
 : 
ETHERTYPE_LINKSTAT
);

82 
	`memıy
(
eh
->
‘h”_sho¡
, 
_‘h
.
	`d©a
(), 6);

85 
mš_·ck‘_sz
 = (
şick_‘h”
è+ 
lšk_´obe
::
size
;

86 
max_’Œ›s
 = (
_´obe_size
 - 
mš_·ck‘_sz
è/ 
lšk_’Œy
::
size
;

87 
boŞ
 
size_w¬nšg
 = 
çl£
;

88 ià(!
size_w¬nšg
 && 
max_’Œ›s
 < (è
_bÿ¡_¡©s
.
	`size
()) {

89 
size_w¬nšg
 = 
Œue
;

90 
	`şick_ch©‹r
("LškSˆ%s: WARNING,…rob·ck‘ i toØsm®ÈtØcÚš‡Î†šk sts", 
	`Çme
().
	`c_¡r
());

92 
num_’Œ›s
 = 
max_’Œ›s
 < (è
_bÿ¡_¡©s
.
	`size
() ? max_entries : _bcast_stats.size();

95 
lšk_´obe
 
	`Í
(
_£q
, 
_³riod
, 
num_’Œ›s
, 
_u
, 
_´obe_size
);

96 
_£q
++;

97 *
d
 = 
p
->
	`d©a
(è+ (
şick_‘h”
);

98 
d
 +ğ
Í
.
	`wr™e
(d);

100 
ProbeM­
::
cÚ¡_™”©Ü
 
i
 = 
_bÿ¡_¡©s
.
	`begš
();

101 
i
.
	`live
(è&& 
num_’Œ›s
 > 0;

102 
num_’Œ›s
--, 
i
++) {

103 cÚ¡ 
´obe_li¡_t
 &
v®
 = 
i
.
	`v®ue
();

104 ià(
v®
.
´obes
.
	`size
() == 0) {

105 
num_’Œ›s
++;

108 
n
 = 
	`couÁ_rx
(&
v®
);

109 ià(
n
 > 0xFFff)

110 
	`şick_ch©‹r
("LškSˆ%s: WARNING, ov”æow iÀnumb” oà´obe »ûived from %s", 
	`Çme
().
	`c_¡r
(), 
v®
.
‘h
.
	`uÅ¬£
().c_str());

111 
lšk_’Œy
 
	`Ë
(
v®
.
‘h
, 
n
 & 0xFFff);

112 
d
 +ğ
Ë
.
	`wr™e
(d);

115 
lšk_´obe
::
	`upd©e_cksum
(
p
->
	`d©a
(è+ (
şick_‘h”
));

117 
max_j™‹r
 = 
_³riod
 / 10;

118 
j
 = 
	`şick_¿ndom
(0, 
max_j™‹r
 * 2);

119 
_£nd_tim”
->
	`»scheduË_aá”_m£c
(
_³riod
 + 
j
 - 
max_j™‹r
);

121 
	`checked_ouut_push
(0, 
p
);

122 
	}
}

125 
	gLškSt
::
	$couÁ_rx
(cÚ¡ 
´obe_li¡_t
 *
¶
)

127 ià(!
¶
)

130 
Time¡amp
 
—¾›¡
 = Time¡amp::
	`now
(è- Time¡amp::
	`make_m£c
(
_u
);

132 
num
 = 0;

133 
i
 = 
¶
->
´obes
.
	`size
() - 1; i >= 0; i--) {

134 ià(
¶
->
´obes
[
i
].
wh’
 >ğ
—¾›¡
)

135 
num
++;

139  
num
;

140 
	}
}

143 
	gLškSt
::
	$couÁ_rx
(cÚ¡ 
Eth”Add»ss
 &
‘h
)

145 
´obe_li¡_t
 *
¶
 = 
_bÿ¡_¡©s
.
	`fšdp
(
‘h
);

146 ià(
¶
)

147  
	`couÁ_rx
(
¶
);

150 
	}
}

153 
	gLškSt
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

155 ià(
	`nouuts
() > 0) {

156 ià(!
_‘h
)

157  
”rh
->
	`”rÜ
("Source Ethernet‡ddress must be specifiedo send…robes");

158 
_£nd_tim”
 = 
Ãw
 
	`Tim”
(
¡©ic_£nd_hook
, 
this
);

159 
_£nd_tim”
->
	`š™Ÿlize
(
this
);

160 
_£nd_tim”
->
	`scheduË_aá”_£c
(1);

163 
	}
}

167 
Pack‘
 *

168 
	gLškSt
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

170 
mš_sz
 = (
şick_‘h”
è+ 
lšk_´obe
::
size
;

171 ià(
p
->
	`Ëngth
(è< 
mš_sz
) {

172 
	`şick_ch©‹r
("LškSˆ%s:…ack‘ i toØsm®l", 
	`Çme
().
	`c_¡r
());

173 
p
->
	`kl
();

177 
şick_‘h”
 *
eh
 = (şick_‘h” *è
p
->
	`d©a
();

179 ià(
	`Áohs
(
eh
->
‘h”_ty³
è!ğ(
_u£_´Ùo2
 ? 
ETHERTYPE_LINKSTAT2
 : 
ETHERTYPE_LINKSTAT
)) {

180 
	`şick_ch©‹r
("LškSˆ%s: gÙ‚Ú-LškSˆ·ck‘y³", 
	`Çme
().
	`c_¡r
());

181 
p
->
	`kl
();

185 
lšk_´obe
 
	`Í
(
p
->
	`d©a
(è+ (
şick_‘h”
));

186 ià(
lšk_´obe
::
	`ÿlc_cksum
(
p
->
	`d©a
(è+ (
şick_‘h”
)) != 0) {

187 
	`şick_ch©‹r
("LškSˆ%s: bad checksum from %s", 
	`Çme
().
	`c_¡r
(), 
	`Eth”Add»ss
(
eh
->
‘h”_sho¡
).
	`uÅ¬£
().c_str());

188 
p
->
	`kl
();

192 ià(
p
->
	`Ëngth
(è< 
Í
.
psz
)

193 
	`şick_ch©‹r
("LinkStat %s:…acket is smaller (%d)han it claims (%u)",

194 
	`Çme
().
	`c_¡r
(), 
p
->
	`Ëngth
(), 
Í
.
psz
);

196 
	`add_bÿ¡_¡©
(
	`Eth”Add»ss
(
eh
->
‘h”_sho¡
), 
Í
);

199 
Time¡amp
 
now
 = Time¡amp::
	`now
();

200 
max_’Œ›s
 = (
p
->
	`Ëngth
(è- (*
eh
è- 
lšk_´obe
::
size
è/ 
lšk_’Œy
::size;

201 
num_’Œ›s
 = 
Í
.
num_lšks
;

202 ià(
num_’Œ›s
 > 
max_’Œ›s
) {

203 
	`şick_ch©‹r
("LinkStat %s: WARNING,…robe…acket from %s contains fewer†inkƒntries (at most %u)han claimed (%u)",

204 
	`Çme
().
	`c_¡r
(), 
	`Eth”Add»ss
(
eh
->
‘h”_sho¡
).
	`uÅ¬£
().c_¡r(), 
max_’Œ›s
, 
num_’Œ›s
);

205 
num_’Œ›s
 = 
max_’Œ›s
;

208 cÚ¡ *
d
 = 
p
->
	`d©a
(è+ (
şick_‘h”
è+ 
lšk_´obe
::
size
;

209 
i
 = 0; i < 
num_’Œ›s
; i++, 
d
 +ğ
lšk_’Œy
::
size
) {

210 
lšk_’Œy
 
	`Ë
(
d
);

211 ià(
Ë
.
‘h
 =ğ
_‘h
) {

212 
_»v_bÿ¡_¡©s
.
	`š£¹
(
	`Eth”Add»ss
(
eh
->
‘h”_sho¡
), 
	`outgošg_lšk_’Œy_t
(
Ë
, 
now
, 
Í
.
u
));

217 
p
->
	`kl
();

219 
	}
}

221 
boŞ


222 
	gLškSt
::
	$g‘_fÜw¬d_¿‹
(cÚ¡ 
Eth”Add»ss
 &
‘h
, *
r
,

223 *
u
, 
Time¡amp
 *
t
)

225 
outgošg_lšk_’Œy_t
 *
Ş
 = 
_»v_bÿ¡_¡©s
.
	`fšdp
(
‘h
);

226 ià(!
Ş
)

227  
çl£
;

229 ià(
_³riod
 == 0)

230  
çl£
;

232 
num_ex³ùed
 = 
Ş
->
u
 / 
_³riod
;

233 
num_»ûived
 = 
Ş
->
num_rx
;

237 ià(
num_ex³ùed
 == 0)

238  
çl£
;

240 
pù
 = 100 * 
num_»ûived
 / 
num_ex³ùed
;

241 ià(
pù
 > 100)

242 
pù
 = 100;

243 *
r
 = 
pù
;

244 *
u
 = 
Ş
->tau;

245 *
t
 = 
Ş
->
»ûived_©
;

247  
Œue
;

248 
	}
}

250 
boŞ


251 
	gLškSt
::
	$g‘_»v”£_¿‹
(cÚ¡ 
Eth”Add»ss
 &
‘h
, *
r
,

252 *
u
)

254 
´obe_li¡_t
 *
¶
 = 
_bÿ¡_¡©s
.
	`fšdp
(
‘h
);

255 ià(!
¶
)

256  
çl£
;

258 ià(
¶
->
³riod
 == 0)

259  
çl£
;

261 
num_ex³ùed
 = 
_u
 / 
¶
->
³riod
;

262 
num_»ûived
 = 
	`couÁ_rx
(
‘h
);

266 ià(
num_ex³ùed
 == 0)

267  
çl£
;

269 
pù
 = 100 * 
num_»ûived
 / 
num_ex³ùed
;

270 ià(
pù
 > 100)

271 
pù
 = 100;

272 *
r
 = 
pù
;

273 *
u
 = 
_u
;

275  
Œue
;

276 
	}
}

279 
	gLškSt
::
	$add_bÿ¡_¡©
(cÚ¡ 
Eth”Add»ss
 &
‘h
, cÚ¡ 
lšk_´obe
 &
Í
)

281 
Time¡amp
 
now
 = Time¡amp::
	`now
();

282 
´obe_t
 
	`´obe
(
now
, 
Í
.
£q_no
);

284 
Ãw_³riod
 = 
Í
.
³riod
;

286 
´obe_li¡_t
 *
l
 = 
_bÿ¡_¡©s
.
	`fšdp
(
‘h
);

287 ià(!
l
) {

288 
´obe_li¡_t
 
	`l2
(
‘h
, 
Ãw_³riod
, 
Í
.
u
);

289 
_bÿ¡_¡©s
.
	`š£¹
(
‘h
, 
l2
);

290 
l
 = 
_bÿ¡_¡©s
.
	`fšdp
(
‘h
);

292 ià(
l
->
³riod
 !ğ
Ãw_³riod
) {

293 
	`şick_ch©‹r
("LinkStat %s: %s has changed its†ink…robe…eriod from %uo %u; clearing…robe info\n",

294 
	`Çme
().
	`c_¡r
(), 
‘h
.
	`uÅ¬£
().c_¡r(), 
l
->
³riod
, 
Ãw_³riod
);

295 
l
->
´obes
.
	`ş—r
();

296 
l
->
³riod
 = 
Ãw_³riod
;

300 
l
->
´obes
.
	`push_back
(
´obe
);

303 (è
l
->
´obes
.
	`size
(è> 
_wšdow
)

304 
l
->
´obes
.
	`pİ_äÚt
();

305 
	}
}

307 
SŒšg


308 
	gLškSt
::
	$»ad_wšdow
(
EËm’t
 *
xf
, *)

310 
LškSt
 *
f
 = (LškSˆ*è
xf
;

311  
	`SŒšg
(
f
->
_wšdow
) + "\n";

312 
	}
}

314 
SŒšg


315 
	gLškSt
::
	$»ad_³riod
(
EËm’t
 *
xf
, *)

317 
LškSt
 *
f
 = (LškSˆ*è
xf
;

318  
	`SŒšg
(
f
->
_³riod
) + "\n";

319 
	}
}

321 
SŒšg


322 
	gLškSt
::
	$»ad_u
(
EËm’t
 *
xf
, *)

324 
LškSt
 *
f
 = (LškSˆ*è
xf
;

325  
	`SŒšg
(
f
->
_u
) + "\n";

326 
	}
}

328 
SŒšg


329 
	gLškSt
::
	$»ad_bÿ¡_¡©s
(
EËm’t
 *
xf
, *)

331 
LškSt
 *
e
 = (LškSˆ*è
xf
;

333 
HashM­
<
	tEth”Add»ss
, 
	tboŞ
> 
	tEthM­
;

334 
EthM­
 
‘h_addrs
;

336 
ProbeM­
::
cÚ¡_™”©Ü
 
i
 = 
e
->
_bÿ¡_¡©s
.
	`begš
(); i.
	`live
(); i++)

337 
‘h_addrs
.
	`š£¹
(
i
.
	`key
(), 
Œue
);

338 
Rev”£ProbeM­
::
cÚ¡_™”©Ü
 
i
 = 
e
->
_»v_bÿ¡_¡©s
.
	`begš
(); i.
	`live
(); i++)

339 
‘h_addrs
.
	`š£¹
(
i
.
	`key
(), 
Œue
);

341 
Time¡amp
 
now
 = Time¡amp::
	`now
();

343 
SŒšgAccum
 
§
;

344 
EthM­
::
cÚ¡_™”©Ü
 
i
 = 
‘h_addrs
.
	`begš
(); i.
	`live
(); i++) {

345 cÚ¡ 
Eth”Add»ss
 &
‘h
 = 
i
.
	`key
();

347 
´obe_li¡_t
 *
¶
 = 
e
->
_bÿ¡_¡©s
.
	`fšdp
(
‘h
);

348 
outgošg_lšk_’Œy_t
 *
Ş
 = 
e
->
_»v_bÿ¡_¡©s
.
	`fšdp
(
‘h
);

350 
§
 << 
‘h
 << ' ';

352 
§
 << "fwd ";

353 ià(
Ş
) {

354 
Time¡amp
 
age
 = 
now
 - 
Ş
->
»ûived_©
;

355 
§
 << "age=" << 
age
 << "au=" << 
Ş
->
u
 << "‚um_rx=" << (èŞ->
num_rx


356 << "…”iod=" << 
e
->
_³riod
 << "…ù=" << 
	`ÿlc_pù
(
Ş
->
u
,ƒ->_³riod, ol->
num_rx
);

359 
§
 << "age=-1au=-1‚um_rx=-1…eriod=-1…ct=-1";

361 
§
 << " --„ev ";

362 ià(
¶
) {

363 
num_rx
 = 
e
->
	`couÁ_rx
(
¶
);

364 
§
 << "u=" << 
e
->
_u
 << "‚um_rx=" << 
num_rx
 << "…”iod=" << 
¶
->
³riod


365 << "…ù=" << 
	`ÿlc_pù
(
e
->
_u
, 
¶
->
³riod
, 
num_rx
);

368 
§
 << "tau=-1‚um_rx=-1…eriod=-1…ct=-1";

370 
§
 << '\n';

373  
§
.
	`ke_¡ršg
();

374 
	}
}

377 
	gLškSt
::
	$ÿlc_pù
(
u
, 
³riod
, 
num_rx
)

379 ià(
³riod
 == 0)

381 
num_ex³ùed
 = 
u
 / 
³riod
;

382 ià(
num_ex³ùed
 == 0)

384  100 * 
num_rx
 / 
num_ex³ùed
;

385 
	}
}

389 
	gLškSt
::
	$wr™e_wšdow
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–
,

390 *, 
E¼ÜHªdËr
 *
”rh
)

392 
LškSt
 *
e
 = (LškSˆ*è
–
;

393 ià(!
	`IÁArg
().
	`·r£
(
¬g
, 
e
->
_wšdow
))

394  
”rh
->
	`”rÜ
("window must be >= 0");

396 
	}
}

399 
	gLškSt
::
	$wr™e_³riod
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–
,

400 *, 
E¼ÜHªdËr
 *
”rh
)

402 
LškSt
 *
e
 = (LškSˆ*è
–
;

403 ià(!
	`IÁArg
().
	`·r£
(
¬g
, 
e
->
_³riod
))

404  
”rh
->
	`”rÜ
("period must be >= 0");

407 
	}
}

410 
	gLškSt
::
	$wr™e_u
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–
,

411 *, 
E¼ÜHªdËr
 *
”rh
)

413 
LškSt
 *
e
 = (LškSˆ*è
–
;

414 ià(!
	`IÁArg
().
	`·r£
(
¬g
, 
e
->
_u
))

415  
”rh
->
	`”rÜ
("tau must be >= 0");

417 
	}
}

421 
	gLškSt
::
	$add_hªdËrs
()

423 
	`add_»ad_hªdËr
("bÿ¡_¡©s", 
»ad_bÿ¡_¡©s
, 0);

425 
	`add_»ad_hªdËr
("wšdow", 
»ad_wšdow
, 0);

426 
	`add_»ad_hªdËr
("u", 
»ad_u
, 0);

427 
	`add_»ad_hªdËr
("³riod", 
»ad_³riod
, 0);

429 
	`add_wr™e_hªdËr
("wšdow", 
wr™e_wšdow
, 0);

430 
	`add_wr™e_hªdËr
("u", 
wr™e_u
, 0);

431 
	`add_wr™e_hªdËr
("³riod", 
wr™e_³riod
, 0);

432 
	}
}

435 
	gLškSt
::
lšk_´obe
::
	$lšk_´obe
(cÚ¡ *
d
)

436 : 
	`£q_no
(
	`ušt_©
(
d
 + 0)), 
	`³riod
(ušt_©(d + 4)), 
	`num_lšks
(uint_at(d + 8)),

437 
	`u
(
	`ušt_©
(
d
 + 12)), 
	`cksum
(
	`ushÜt_©
(d + 16)), 
	`psz
(ushort_at(d + 18))

439 
	}
}

442 
	gLškSt
::
lšk_´obe
::
	$wr™e
(*
d
) const

444 
	`wr™e_ušt_©
(
d
 + 0, 
£q_no
);

445 
	`wr™e_ušt_©
(
d
 + 4, 
³riod
);

446 
	`wr™e_ušt_©
(
d
 + 8, 
num_lšks
);

447 
	`wr™e_ušt_©
(
d
 + 12, 
u
);

448 
	`wr™e_ushÜt_©
(
d
 + 16, 0);

449 
	`wr™e_ushÜt_©
(
d
 + 18, 
psz
);

450  
size
;

451 
	}
}

454 
	gLškSt
::
lšk_´obe
::
	$upd©e_cksum
(*
d
)

456 
cksum
 = 
	`ÿlc_cksum
(
d
);

457 *
c
 = (*è&
cksum
;

458 
d
[
cksum_off£t
] = 
c
[0];

459 
d
[
cksum_off£t
 + 1] = 
c
[1];

460 
	}
}

463 
	gLškSt
::
lšk_´obe
::
	$ÿlc_cksum
(cÚ¡ *
d
)

465 
lšk_´obe
 
	`Í
(
d
);

466 
nby‹s
 = 
lšk_´obe
::
size
 + 
Í
.
num_lšks
 * 
lšk_’Œy
::size;

467  
	`şick_š_cksum
(
d
, 
nby‹s
);

468 
	}
}

470 
	gLškSt
::
lšk_’Œy
::
	$lšk_’Œy
(cÚ¡ *
d
)

471 : 
	`‘h
(
d
), 
	`num_rx
(
	`ushÜt_©
(d + 6))

473 
	}
}

476 
	gLškSt
::
lšk_’Œy
::
	$wr™e
(*
d
) const

478 
	`memıy
(
d
, 
‘h
.
	`d©a
(), 6);

479 
	`wr™e_ushÜt_©
(
d
 + 6, 
num_rx
);

480  
size
;

481 
	}
}

483 
	$EXPORT_ELEMENT
(
LškSt
)

484 
CLICK_ENDDECLS


	@grid/linkstat.hh

1 #iâdeà
LINKSTATHH


2 
	#LINKSTATHH


	)

56 
	~<şick/bighashm­.hh
>

57 
	~<şick/deque.hh
>

58 
	~<şick/–em’t.hh
>

59 
	~<şick/glue.hh
>

60 
	~<şick/‘h”add»ss.hh
>

61 
	~<–em’ts/grid/timeuts.hh
>

63 
CLICK_DECLS


65 
şass
 
	gTim”
;

67 şas 
	cLškSt
 : 
public
 
EËm’t
 {

69 
public
:

72 
	$ušt_©
(cÚ¡ *
c
)

73 {  (
c
[0] << 24) | (c[1] << 16) | (c[2] << 8) | c[3]; }

75 
	$ushÜt_©
(cÚ¡ *
c
)

76 {  (
c
[0] << 8è| c[1]; 
	}
}

78 
	$wr™e_ušt_©
(*
c
, 
u
) {

79 
c
[0] = (
u
 >> 24) & 0xff; c[1] = (u >> 16) & 0xff;

80 
c
[2] = (
u
 >> 8) & 0xff; c[3] = u & 0xff;

81 
	}
}

83 
	$wr™e_ushÜt_©
(*
c
, 
u
) {

84 
c
[0] = (
u
 >> 8) & 0xff; c[1] = u & 0xff;

85 
	}
}

93 
	#FUCKED_GCC_2_96


	)

94 #ifdeà
FUCKED_GCC_2_96


96 
	gETHERTYPE_LINKSTAT
 = 0x7ffe,

97 
	gETHERTYPE_LINKSTAT2
 = 0x7ffd

100 cÚ¡ 
	gETHERTYPE_LINKSTAT
 = 0x7ffe;

101 cÚ¡ 
	gETHERTYPE_LINKSTAT2
 = 0x7ffd;

104 
	slšk_´obe
 {

105 cÚ¡ 
	gsize
 = 20;

106 cÚ¡ 
	gcksum_off£t
 = 16;

108 
	g£q_no
;

109 
	g³riod
;

110 
	gnum_lšks
;

111 
	gu
;

112 
	gcksum
;

113 
	gpsz
;

115 
lšk_´obe
(è: 
£q_no
(0), 
³riod
(0), 
num_lšks
(0), 
u
(0), 
cksum
(0), 
psz
(0) { }

116 
lšk_´obe
(
s
, 
p
, 
n
, 
t
, 
sz
)

117 : 
£q_no
(
s
), 
³riod
(
p
), 
num_lšks
(
n
), 
u
(
t
), 
cksum
(0), 
psz
(
sz
) { }

120 
lšk_´obe
(const *);

123 
wr™e
(*) const;

126 
upd©e_cksum
(*
d
);

127 
ÿlc_cksum
(cÚ¡ *
d
);

130 
	slšk_’Œy
 {

131 cÚ¡ 
	gsize
 = 8;

133 
şass
 
Eth”Add»ss
 
	g‘h
;

134 
	gnum_rx
;

136 
lšk_’Œy
(è: 
num_rx
(0) { }

137 
lšk_’Œy
(cÚ¡ 
Eth”Add»ss
 &
e
, 
n
è: 
‘h
Ó), 
num_rx
(n) { }

138 
lšk_’Œy
(const *);

139 
wr™e
(*) const;

142 
	g´iv©e
:

143 
_wšdow
;

144 
	g_u
;

145 
	g_³riod
;

147 
	g_´obe_size
;

149 
	g_£q
;

150 
Eth”Add»ss
 
	g_‘h
;

154 
	s´obe_t
 {

155 
Time¡amp
 
	gwh’
;

156 
	g£q_no
;

157 
´obe_t
(cÚ¡ 
Time¡amp
 &
t
, 
s
è: 
wh’
Ñ), 
£q_no
(s) { }

160 
	s´obe_li¡_t
 {

161 
Eth”Add»ss
 
	g‘h
;

162 
	g³riod
;

163 
	gu
;

164 
	gDeque
<
	g´obe_t
> 
	g´obes
;

165 
´obe_li¡_t
(cÚ¡ 
Eth”Add»ss
 &
e
, 
p
, 
t
è: 
‘h
Ó), 
³riod
Õ), 
u
(t) { }

166 
´obe_li¡_t
(è: 
³riod
(0), 
u
(0) { }

170 
	gHashM­
<
	tEth”Add»ss
, 
	t´obe_li¡_t
> 
	tProbeM­
;

171 
ProbeM­
 
	g_bÿ¡_¡©s
;

174 
	goutgošg_lšk_’Œy_t
 : 
public
 
lšk_’Œy
 {

175 
Time¡amp
 
»ûived_©
;

176 
	gu
;

177 
outgošg_lšk_’Œy_t
(è{ 
mem£t
(
this
, 0, (*this)); }

178 
outgošg_lšk_’Œy_t
(cÚ¡ 
lšk_’Œy
 &
l
, cÚ¡ 
Time¡amp
 &
now
, 
t
)

179 : 
lšk_’Œy
(
l
), 
»ûived_©
(
now
), 
u
(
t
) { }

180 
outgošg_lšk_’Œy_t
(cÚ¡ *
d
, cÚ¡ 
Time¡amp
 &
now
, 
t
)

181 : 
lšk_’Œy
(
d
), 
»ûived_©
(
now
), 
u
(
t
) { }

185 
	gHashM­
<
	tEth”Add»ss
, 
	toutgošg_lšk_’Œy_t
> 
	tRev”£ProbeM­
;

186 
Rev”£ProbeM­
 
	g_»v_bÿ¡_¡©s
;

188 
SŒšg
 
»ad_¡©s
(
EËm’t
 *, *);

189 
SŒšg
 
»ad_bÿ¡_¡©s
(
EËm’t
 *, *);

193 
couÁ_rx
(cÚ¡ 
Eth”Add»ss
 &);

194 
couÁ_rx
(cÚ¡ 
´obe_li¡_t
 *);

197 
SŒšg
 
»ad_wšdow
(
EËm’t
 *, *);

198 
SŒšg
 
»ad_³riod
(
EËm’t
 *, *);

199 
SŒšg
 
»ad_u
(
EËm’t
 *, *);

200 
wr™e_wšdow
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

201 
wr™e_³riod
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

202 
wr™e_u
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

204 
add_bÿ¡_¡©
(cÚ¡ 
Eth”Add»ss
 &, cÚ¡ 
lšk_´obe
 &);

206 
	$¡©ic_£nd_hook
(
Tim”
 *, *
e
è{ ((
LškSt
 *èe)->
	`£nd_hook
(); 
	}
}

207 
£nd_hook
();

209 
Tim”
 *
	g_£nd_tim”
;

211 
boŞ
 
	g_u£_´Ùo2
;

213 
ÿlc_pù
(
u
, 
³riod
, 
num_rx
);

215 
	gpublic
:

220 
boŞ
 
g‘_fÜw¬d_¿‹
(cÚ¡ 
Eth”Add»ss
 &
‘h
, *
r
, *
u
,

221 
Time¡amp
 *
t
);

226 
boŞ
 
g‘_»v”£_¿‹
(cÚ¡ 
Eth”Add»ss
 &
‘h
, *
r
, *
u
);

228 
	$g‘_´obe_size
(ècÚ¡ {  
_´obe_size
; 
	}
}

230 
	$LškSt
(è
CLICK_COLD
;

231 ~
	$LškSt
(è
CLICK_COLD
;

233 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "LškSt"; 
	}
}

234 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/0-1"; 
	}
}

235 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

236 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

238 
	$add_hªdËrs
(è
CLICK_COLD
;

240 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

241 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

243 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

244 
	}
};

246 
	g‹m¶©e
 <
şass
 
	gT
> 
	$grid_sw­
(
T
 &
a
, T &
b
) {

247 
T
 
t
 = 
a
;

248 
a
 = 
b
;

249 
b
 = 
t
;

250 
	}
}

252 
	gCLICK_ENDDECLS


	@grid/linktester.cc

18 
	~<fú.h
>

19 
	~<şick/cÚfig.h
>

20 
	~<şick/¬gs.hh
>

21 
	~"lšk‹¡”.hh
"

22 
	~<şick/glue.hh
>

23 
	~<şickÃt/‘h”.h
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/rou‹r.hh
>

26 
	~"timeuts.hh
"

27 
	~<uni¡d.h
>

29 
CLICK_DECLS


31 
	gLškTe¡”
::
	$LškTe¡”
() :

32 
	`_¡¬t_time
(-1),

33 
	`_tim”
(
¡©ic_tim”_hook
, 
this
),

34 
	`_cu¼_¡©e
(
WAITING_TO_START
),

35 
	`_™”©iÚs_dÚe
(0),

36 
	`_num_™”s
(1),

37 
	`_·d
(10000),

38 
	`_·ck‘_size
((
şick_‘h”
è+ (
·ylßd_t
)),

39 
	`_£nd_time
(10000),

40 
	`_Ïmbda
(1),

41 
	`_bÿ¡_·ck‘_size
((
şick_‘h”
è+ (
·ylßd_t
)),

42 
	`_bÿ¡_£nd_time
(10000),

43 
	`_bÿ¡_Ïmbda
(1),

44 
	$_d©a_buf
(0)

46 
	}
}

48 
	gLškTe¡”
::~
	$LškTe¡”
()

50 ià(
_d©a_buf
)

51 
d–‘e
[] 
_d©a_buf
;

52 
	}
}

55 
	gLškTe¡”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

57 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

58 .
»ad_mp
("SRC", 
_¤c_‘h
)

59 .
»ad_mp
("DST", 
_d¡_‘h
)

60 .
»ad
("START_TIME", 
_¡¬t_time
)

61 .
»ad
("ITERATIONS", 
_num_™”s
)

62 .
»ad
("SEND_FIRST", 
_£nd_fœ¡
)

63 .
»ad
("PAD_TIME", 
_·d
)

64 .
»ad
("UNICAST_SEND_TIME", 
_£nd_time
)

65 .
»ad
("BROADCAST_SEND_TIME", 
_bÿ¡_£nd_time
)

66 .
»ad
("UNICAST_PACKET_SZ", 
_·ck‘_size
)

67 .
»ad
("BROADCAST_PACKET_SZ", 
_bÿ¡_·ck‘_size
)

68 .
»ad
("UNICAST_LAMBDA", 
_Ïmbda
)

69 .
»ad
("BROADCAST_LAMBDA", 
_bÿ¡_Ïmbda
)

70 .
com¶‘e
();

72 ià(
	g»s
 > -1 && 
ex³rim’t_·¿ms_ok
(
”rh
))

79 
boŞ


80 
	gLškTe¡”
::
	$ex³rim’t_·¿ms_ok
(
E¼ÜHªdËr
 *
”rh
)

82 ià(
_·ck‘_size
 < (
şick_‘h”
è+ (
·ylßd_t
)) {

83 
”rh
->
	`”rÜ
("Unicast…acketsoo small forƒther header‡nd sequence‚umbers");

84  
çl£
;

86 ià(
_bÿ¡_·ck‘_size
 < (
şick_‘h”
è+ (
·ylßd_t
)) {

87 
”rh
->
	`”rÜ
("Broadcast…acketsoo small forƒther header‡nd sequence‚umbers");

88  
çl£
;

90  
Œue
;

91 
	}
}

94 
	gLškTe¡”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

96 
bigge¡
 = 
_·ck‘_size
 > 
_bÿ¡_·ck‘_size
 ?

97 
_·ck‘_size
 : 
_bÿ¡_·ck‘_size
;

98 
d©a_sz
 = 
bigge¡
 - (
şick_‘h”
è- (
·ylßd_t
);

99 
_d©a_buf
 = 
Ãw
 [
d©a_sz
];

100 ià(!
_d©a_buf
)

101  
”rh
->
	`”rÜ
("Unableo‡llocate data buffer");

102 
i
 = 0; i < 
d©a_sz
; i++)

103 
_d©a_buf
[
i
] = i % 256;

105 
boŞ
 
»s
 = 
	`š™_¿ndom
();

106 ià(!
»s
)

107  
”rh
->
	`”rÜ
("Unableo initialize„andom‚umber generator");

109 
Time¡amp
 
now
 = Time¡amp::
	`now
();

111 ià(
_¡¬t_time
 < 0)

112 
_¡¬t_time
 = 
now
.
	`£c
() + 5;

114 ià(
now
.
	`£c
(è>ğ(è
_¡¬t_time
)

115  
”rh
->
	`”rÜ
("S¹im%u ha ®»ad…as£d", 
_¡¬t_time
);

117 
_tim”
.
	`š™Ÿlize
(
this
);

118 
_¡¬t_time_tv
 = 
	`Time¡amp
(
_¡¬t_time
, 0);

119 
_tim”
.
	`scheduË_©
(
_¡¬t_time_tv
);

121 
_Ï¡_time
 = 
now
;

122 
_Ãxt_time
 = 
_¡¬t_time_tv
;

125 
	}
}

128 
	gLškTe¡”
::
	$tim”_hook
()

130 
Time¡amp
 
tv
 = Time¡amp::
	`now
();

132 
	`şick_ch©‹r
("OK %p{time¡amp} (d–: %s)\n", 
tv
.
	`uÅ¬£
().
	`c_¡r
(),

133 (
tv
 - 
_Ï¡_time
).
	`uÅ¬£
().
	`c_¡r
());

135 
_Ï¡_time
 = 
tv
;

136 
_cu¼_¡©e
) {

137 
WAITING_TO_START
: 
	`hªdË_tim”_wa™šg
(
tv
); ;

138 
LISTENING
: 
	`hªdË_tim”_li¡’šg
(
tv
); ;

139 
BCAST_1
: 
	`hªdË_tim”_bÿ¡
(
tv
); ;

140 
UNICAST
: 
	`hªdË_tim”_uniÿ¡
(
tv
); ;

141 
BCAST_2
: 
	`hªdË_tim”_bÿ¡
(
tv
); ;

142 
DONE
:

144 
	`as£¹
(0);

146 
	}
}

149 
	gLškTe¡”
::
	$hªdË_tim”_wa™šg
(cÚ¡ 
Time¡amp
 &
tv
)

151 
	`as£¹
(
_cu¼_¡©e
 =ğ
WAITING_TO_START
);

152 
_™”©iÚs_dÚe
 = 0;

154 ià(
_num_™”s
 == 0) {

155 
	`fšish_ex³rim’t
();

159 ià(
_£nd_fœ¡
) {

160 
_cu¼_¡©e
 = 
BCAST_1
;

161 
_bÿ¡_·ck‘s_£Á
 = 0;

162 
	`hªdË_tim”_bÿ¡
(
tv
);

165 
_cu¼_¡©e
 = 
LISTENING
;

166 
li¡’_fÜ
 = 
	`ÿlc_li¡’_time
(è+ 
	`ÿlc_·d_time
();

167 
_Ãxt_time
 = 
_¡¬t_time_tv
 + 
Time¡amp
::
	`make_m£c
(
li¡’_fÜ
);

169 
	`as£¹
(
_Ãxt_time
 > 
tv
);

170 
_tim”
.
	`scheduË_©
(
_Ãxt_time
);

172 
	}
}

175 
	gLškTe¡”
::
	$hªdË_tim”_li¡’šg
(cÚ¡ 
Time¡amp
 &
tv
)

177 
	`as£¹
(
_cu¼_¡©e
 =ğ
LISTENING
);

180 ià(
_£nd_fœ¡
) {

181 
_™”©iÚs_dÚe
++;

182 ià(
_™”©iÚs_dÚe
 >ğ
_num_™”s
) {

183 
	`fšish_ex³rim’t
();

188 
_cu¼_¡©e
 = 
BCAST_1
;

189 
_bÿ¡_·ck‘s_£Á
 = 0;

190 
	`hªdË_tim”_bÿ¡
(
tv
);

191 
	}
}

194 
	gLškTe¡”
::
	$hªdË_tim”_bÿ¡
(cÚ¡ 
Time¡amp
 &
tv
)

196 
	`as£¹
(
_cu¼_¡©e
 =ğ
BCAST_1
 || _cu¼_¡©=ğ
BCAST_2
);

197 
	`£nd_brßdÿ¡_·ck‘
((è
_bÿ¡_·ck‘_size
, 
tv
,

198 
_cu¼_¡©e
 =ğ
BCAST_1
, 
_bÿ¡_·ck‘s_£Á
,

199 
_™”©iÚs_dÚe
);

200 
_bÿ¡_·ck‘s_£Á
++;

203 
d–
 = 
	`d¿w_¿ndom_m£cs
(
_bÿ¡_Ïmbda
);

204 
Time¡amp
 
Ãw_Ãxt_time
 = 
_Ãxt_time
 + Time¡amp::
	`make_m£c
(
d–
);

207 ià(
Ãw_Ãxt_time
 <ğ
	`Ï¡_bÿ¡_time
(
_™”©iÚs_dÚe
,

208 
_cu¼_¡©e
 =ğ
BCAST_1
)) {

209 
_Ãxt_time
 = 
Ãw_Ãxt_time
;

213 ià(
_cu¼_¡©e
 =ğ
BCAST_1
) {

214 
_cu¼_¡©e
 = 
UNICAST
;

215 
_·ck‘s_£Á
 = 0;

216 
_Ãxt_time
 = 
	`fœ¡_uniÿ¡_time
(
_™”©iÚs_dÚe
);

219 
	`as£¹
(
_cu¼_¡©e
 =ğ
BCAST_2
);

225 ià(
_£nd_fœ¡
) {

226 
_cu¼_¡©e
 = 
LISTENING
;

227 
_Ãxt_time
 = 
	`fœ¡_bÿ¡_time
(
_™”©iÚs_dÚe
 + 1, 
Œue
);

230 
_™”©iÚs_dÚe
++;

231 ià(
_™”©iÚs_dÚe
 >ğ
_num_™”s
) {

232 
	`fšish_ex³rim’t
();

236 
_cu¼_¡©e
 = 
LISTENING
;

237 
_Ãxt_time
 = 
	`fœ¡_bÿ¡_time
(
_™”©iÚs_dÚe
, 
Œue
);

243 
	`as£¹
(
_Ãxt_time
 > 
tv
);

244 
_tim”
.
	`scheduË_©
(
_Ãxt_time
);

246 
	}
}

249 
	gLškTe¡”
::
	$hªdË_tim”_uniÿ¡
(cÚ¡ 
Time¡amp
 &
tv
)

251 
	`as£¹
(
_cu¼_¡©e
 =ğ
UNICAST
);

252 
	`£nd_uniÿ¡_·ck‘
(
tv
, 
_·ck‘s_£Á
, 
_™”©iÚs_dÚe
);

253 
_·ck‘s_£Á
++;

255 
d–
 = 
	`d¿w_¿ndom_m£cs
(
_Ïmbda
);

256 
Time¡amp
 
Ãw_Ãxt_time
 = 
_Ãxt_time
 + Time¡amp::
	`make_m£c
(
d–
);

259 ià(
Ãw_Ãxt_time
 <ğ
	`Ï¡_uniÿ¡_time
(
_™”©iÚs_dÚe
))

260 
_Ãxt_time
 = 
Ãw_Ãxt_time
;

263 
_cu¼_¡©e
 = 
BCAST_2
;

264 
_bÿ¡_·ck‘s_£Á
 = 0;

265 
_Ãxt_time
 = 
	`fœ¡_bÿ¡_time
(
_™”©iÚs_dÚe
, 
çl£
);

268 
	`as£¹
(
_Ãxt_time
 > 
tv
);

269 
_tim”
.
	`scheduË_©
(
_Ãxt_time
);

270 
	}
}

273 
	gLškTe¡”
::
	$ÿlc_li¡’_time
()

275  
	`ÿlc_bÿ¡_time
(è+ 
	`ÿlc_·d_time
(è+ 
	`ÿlc_uniÿ¡_time
()

276 + 
	`ÿlc_·d_time
(è+ 
	`ÿlc_bÿ¡_time
();

277 
	}
}

280 
	gLškTe¡”
::
	$ÿlc_uniÿ¡_time
()

282  
_£nd_time
;

283 
	}
}

286 
	gLškTe¡”
::
	$ÿlc_bÿ¡_time
()

288  
_bÿ¡_£nd_time
;

289 
	}
}

291 
Time¡amp


292 
	gLškTe¡”
::
	$fœ¡_uniÿ¡_time
(
™”
)

294 
™”_time
 = 2 * (
	`ÿlc_li¡’_time
(è+ 
	`ÿlc_·d_time
());

295 
d–
 = 
™”_time
 * 
™”
;

296 
d–
 +ğ
	`ÿlc_bÿ¡_time
(è+ 
	`ÿlc_·d_time
();

297 ià(!
_£nd_fœ¡
)

298 
d–
 +ğ
	`ÿlc_li¡’_time
(è+ 
	`ÿlc_·d_time
();

299  
Time¡amp
::
	`make_m£c
(
d–
è+ 
_¡¬t_time_tv
;

300 
	}
}

302 
Time¡amp


303 
	gLškTe¡”
::
	$fœ¡_bÿ¡_time
(
™”
, 
boŞ
 
befÜe
)

305 
™”_time
 = 2 * (
	`ÿlc_li¡’_time
(è+ 
	`ÿlc_·d_time
());

306 
d–
 = 
™”_time
 * 
™”
;

307 ià(!
_£nd_fœ¡
)

308 
d–
 +ğ
	`ÿlc_li¡’_time
(è+ 
	`ÿlc_·d_time
();

309 ià(!
befÜe
)

310 
d–
 +ğ
	`ÿlc_bÿ¡_time
(è+ 
	`ÿlc_·d_time
(è+ 
	`ÿlc_uniÿ¡_time
() + calc_pad_time();

311  
Time¡amp
::
	`make_m£c
(
d–
è+ 
_¡¬t_time_tv
;

312 
	}
}

314 
Time¡amp


315 
	gLškTe¡”
::
	$Ï¡_uniÿ¡_time
(
™”
)

317  
	`fœ¡_uniÿ¡_time
(
™”
è+ 
Time¡amp
::
	`make_m£c
(
	`ÿlc_uniÿ¡_time
());

318 
	}
}

320 
Time¡amp


321 
	gLškTe¡”
::
	$Ï¡_bÿ¡_time
(
™”
, 
boŞ
 
befÜe
)

323  
	`fœ¡_bÿ¡_time
(
™”
, 
befÜe
è+ 
Time¡amp
::
	`make_m£c
(
	`ÿlc_bÿ¡_time
());

324 
	}
}

327 
	gLškTe¡”
::
	$£nd_uniÿ¡_·ck‘
(cÚ¡ 
Time¡amp
 &
tv
,

328 
£q
, 
™”
)

330 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
_·ck‘_size
);

331 
şick_‘h”
 *
eh
 = (şick_‘h” *è(
p
->
	`d©a
());

333 
	`memıy
(
eh
->
‘h”_dho¡
, 
_d¡_‘h
.
	`d©a
(), 6);

334 
	`memıy
(
eh
->
‘h”_sho¡
, 
_¤c_‘h
.
	`d©a
(), 6);

335 
eh
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE
);

337 
·ylßd_t
 *
·ylßd
 = (·ylßd_ˆ*è(
eh
 + 1);

338 
	`mem£t
(
·ylßd
, 0, (
·ylßd_t
));

339 
·ylßd
->
size
 = 
	`htÚs
(
_·ck‘_size
);

340 
·ylßd
->
™”©iÚ
 = 
	`htÚl
(
™”
);

341 
·ylßd
->
£q_no
 = 
	`htÚl
(
£q
);

342 
·ylßd
->
tx_£c
 = 
	`htÚl
(
tv
.
	`£c
());

343 
·ylßd
->
tx_u£c
 = 
	`htÚl
(
tv
.
	`u£c
());

345 
d©a_sz
 = 
_·ck‘_size
 - (
şick_‘h”
è- (
·ylßd_t
);

346 ià(
d©a_sz
 > 0)

347 
	`memıy
(
p
->
	`d©a
(è+ (
şick_‘h”
è+ (
·ylßd_t
),

348 
_d©a_buf
, 
d©a_sz
);

349 
	`ouut
(0).
	`push
(
p
);

350 
	}
}

353 
	gLškTe¡”
::
	$£nd_brßdÿ¡_·ck‘
(
psz
, cÚ¡ 
Time¡amp
 &
tv
,

354 
boŞ
 
befÜe
, 
£q
, 
™”
)

356 
	`as£¹
(
psz
 >ğ(
şick_‘h”
è+ (
·ylßd_t
));

357 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
psz
);

358 
şick_‘h”
 *
eh
 = (şick_‘h” *è(
p
->
	`d©a
());

360 
bÿ¡_addr
[] = { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff };

361 
	`memıy
(
eh
->
‘h”_dho¡
, 
bÿ¡_addr
, 6);

362 
	`memıy
(
eh
->
‘h”_sho¡
, 
_¤c_‘h
.
	`d©a
(), 6);

363 
eh
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE
);

365 
·ylßd_t
 *
·ylßd
 = (·ylßd_ˆ*è(
eh
 + 1);

366 
	`mem£t
(
·ylßd
, 0, (
·ylßd_t
));

367 
·ylßd
->
size
 = 
	`htÚs
(
psz
);

368 
·ylßd
->
befÜe
 = before ? 1 : 0;

369 
·ylßd
->
™”©iÚ
 = 
	`htÚl
(
™”
);

370 
·ylßd
->
£q_no
 = 
	`htÚl
(
£q
);

371 
·ylßd
->
tx_£c
 = 
	`htÚl
(
tv
.
	`£c
());

372 
·ylßd
->
tx_u£c
 = 
	`htÚl
(
tv
.
	`u£c
());

374 
d©a_sz
 = 
psz
 - (
şick_‘h”
è- (
·ylßd_t
);

375 ià(
d©a_sz
 > 0)

376 
	`memıy
(
p
->
	`d©a
(è+ (
şick_‘h”
è+ (
·ylßd_t
),

377 
_d©a_buf
, 
d©a_sz
);

378 
	`ouut
(0).
	`push
(
p
);

379 
	}
}

382 
	gLškTe¡”
::
	$fšish_ex³rim’t
()

384 
	`şick_ch©‹r
("DONE\n");

385 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

386 
	}
}

388 
boŞ


389 
	gLškTe¡”
::
	$š™_¿ndom
()

391 
fd
 = 
	`İ’
("/dev/u¿ndom", 
O_RDONLY
);

392 ià(
fd
 == -1)

393  
çl£
;

395 
£ed
;

396 
”r
 = 
	`»ad
(
fd
, &
£ed
, (seed));

397 ià(
”r
 !ğ(
£ed
))

398  
çl£
;

400 
	`şo£
(
fd
);

401 
	`şick_¤ªdom
(
£ed
);

402  
Œue
;

403 
	}
}

406 
	gLškTe¡”
::
	$d¿w_¿ndom
(
Ïmbda
)

410 
r
 = (è
	`şick_¿ndom
(è/ (è
CLICK_RAND_MAX
;

411  -
Ïmbda
 * 
	`log
(
r
);

413 
Ïmbda
 = 0;

416 
	}
}

418 
	$EXPORT_ELEMENT
(
LškTe¡”
)

419 
	`ELEMENT_REQUIRES
(
u£¾ev–
)

	@grid/linktester.hh

1 #iâdeà
LINKTESTER_HH


2 
	#LINKTESTER_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/glue.hh
>

6 
	~<şick/‘h”add»ss.hh
>

7 
	~<şick/tim”.hh
>

8 
CLICK_DECLS


72 şas 
	cLškTe¡”
 : 
public
 
EËm’t
 {

74 
public
:

75 cÚ¡ 
ušt16_t
 
ETHERTYPE
 = 0x7eee;

77 
	s·ylßd_t
 {

78 
	mbefÜe
;

79 
	msize
;

80 
	m™”©iÚ
;

81 
	m£q_no
;

82 
	mtx_£c
;

83 
	mtx_u£c
;

86 
	$LškTe¡”
(è
CLICK_COLD
;

87 ~
	$LškTe¡”
(è
CLICK_COLD
;

89 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "LškTe¡”"; 
	}
}

90 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

91 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

93 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

94 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

96 
´iv©e
:

98 
	`tim”_hook
();

99 
	$¡©ic_tim”_hook
(
Tim”
 *, *
e
)

100 { 
¡©ic_ÿ¡
<
LškTe¡”
 *>(
e
)->
	`tim”_hook
(); 
	}
}

102 
boŞ
 
ex³rim’t_·¿ms_ok
(
E¼ÜHªdËr
 *);

104 
hªdË_tim”_wa™šg
(cÚ¡ 
Time¡amp
 &
tv
);

105 
hªdË_tim”_li¡’šg
(cÚ¡ 
Time¡amp
 &
tv
);

106 
hªdË_tim”_bÿ¡
(cÚ¡ 
Time¡amp
 &
tv
);

107 
hªdË_tim”_uniÿ¡
(cÚ¡ 
Time¡amp
 &
tv
);

112 
ÿlc_li¡’_time
();

113 
ÿlc_uniÿ¡_time
();

114 
ÿlc_bÿ¡_time
();

116 
	$ÿlc_·d_time
(è{  
_·d
; 
	}
}

120 
Time¡amp
 
fœ¡_uniÿ¡_time
(
™”
);

121 
Time¡amp
 
fœ¡_bÿ¡_time
(
™”
, 
boŞ
 
befÜe
);

122 
Time¡amp
 
Ï¡_uniÿ¡_time
(
™”
);

123 
Time¡amp
 
Ï¡_bÿ¡_time
(
™”
, 
boŞ
 
befÜe
);

125 
£nd_uniÿ¡_·ck‘
(cÚ¡ 
Time¡amp
 &,

126 
£q
, 
™”
);

127 
£nd_brßdÿ¡_·ck‘
(
psz
, cÚ¡ 
Time¡amp
 &,

128 
boŞ
 
befÜe
, 
£q
, 
™”
);

130 
fšish_ex³rim’t
();

132 
boŞ
 
š™_¿ndom
();

133 
d¿w_¿ndom
(
Ïmbda
);

135 
	$d¿w_¿ndom_m£cs
(
Ïmbda
)

136 {  
¡©ic_ÿ¡
<>(
	`d¿w_¿ndom
(
Ïmbda
)); 
	}
}

138 
	e¡©e_t
 {

139 
	gWAITING_TO_START
,

140 
	gLISTENING
,

141 
	gBCAST_1
,

142 
	gUNICAST
,

143 
	gBCAST_2
,

144 
	gDONE


147 
	g_¡¬t_time
;

148 
Time¡amp
 
	g_¡¬t_time_tv
;

149 
şass
 
Eth”Add»ss
 
	g_¤c_‘h
;

150 
şass
 
Eth”Add»ss
 
	g_d¡_‘h
;

151 
şass
 
Tim”
 
	g_tim”
;

152 
¡©e_t
 
	g_cu¼_¡©e
;

154 
boŞ
 
	g_£nd_fœ¡
;

156 
	g_™”©iÚs_dÚe
;

157 
	g_num_™”s
;

159 
	g_·ck‘s_£Á
;

160 
	g_bÿ¡_·ck‘s_£Á
;

162 
	g_·d
;

165 
	g_·ck‘_size
;

166 
	g_£nd_time
;

167 
	g_Ïmbda
;

170 
	g_bÿ¡_·ck‘_size
;

171 
	g_bÿ¡_£nd_time
;

172 
	g_bÿ¡_Ïmbda
;

174 *
	g_d©a_buf
;

176 
Time¡amp
 
	g_Ï¡_time
;

177 
Time¡amp
 
	g_Ãxt_time
;

181 
	gCLICK_ENDDECLS


	@grid/linktestreceiver.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/”rÜ.hh
>

22 
	~"lšk‹¡»ûiv”.hh
"

23 
	~"lšk‹¡”.hh
"

24 
	~"aœošfo.hh
"

26 
CLICK_DECLS


28 
	gLškTe¡Reûiv”
::
	$LškTe¡Reûiv”
(è: 
	$_ai
(0)

30 
	}
}

32 
LškTe¡Reûiv”
::~
	$LškTe¡Reûiv”
()

34 
	}
}

37 
LškTe¡Reûiv”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39  
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad_p
("AIROINFO", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_ai
))

41 .
com¶‘e
();

45 
	gLškTe¡Reûiv”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

48 
	}
}

50 
Pack‘
 *

51 
	gLškTe¡Reûiv”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

53 
şick_‘h”
 *
eh
 = (şick_‘h” *è
p
->
	`d©a
();

54 ià(
	`htÚs
(
eh
->
‘h”_ty³
è!ğ
LškTe¡”
::
ETHERTYPE
)

55  
p
;

56 
Eth”Add»ss
 
	`¤c
(
eh
->
‘h”_sho¡
);

57 
Eth”Add»ss
 
	`d¡
(
eh
->
‘h”_dho¡
);

59 
boŞ
 
»s
 = 
çl£
;

60 
dbm
, 
qu®™y
;

61 ià(
_ai
)

62 
»s
 = 
_ai
->
	`g‘_sigÇl_šfo
(
¤c
, 
dbm
, 
qu®™y
);

63 ià(!
_ai
 || !
»s
)

64 
dbm
 = 
qu®™y
 = -1;

66 
»s
 = 
çl£
;

67 
avg_ov”_£c
, 
avg_ov”_mšu‹
, 
max_ov”_mšu‹
;

68 ià(
_ai
)

69 
»s
 = 
_ai
->
	`g‘_noi£
(
avg_ov”_£c
, 
avg_ov”_mšu‹
, 
max_ov”_mšu‹
);

70 ià(!
_ai
 || !
»s
)

71 
avg_ov”_£c
 = 
avg_ov”_mšu‹
 = 
max_ov”_mšu‹
 = -1;

73 
LškTe¡”
::
·ylßd_t
 *
·ylßd
 = (LškTe¡”::·ylßd_ˆ*è(
eh
 + 1);

75 
	`şick_ch©‹r
("%p{timestamp},%u.%06u,%p{ether_ptr},%p{ether_ptr},%hu,%d,%u,%u\n",

76 &
p
->
	`time¡amp_ªno
(),

77 
	`Áohl
(
·ylßd
->
tx_£c
),‚tohlÕaylßd->
tx_u£c
),

78 &
¤c
, &
d¡
, 
	`Áohs
(
·ylßd
->
size
),

79 
·ylßd
->
befÜe
 ? 1 : 0, 
	`Áohl
Õaylßd->
™”©iÚ
),

80 
	`Áohl
(
·ylßd
->
£q_no
));

82  
p
;

83 
	}
}

87 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

88 
	`EXPORT_ELEMENT
(
LškTe¡Reûiv”
)

	@grid/linktestreceiver.hh

1 #iâdeà
LINKTESTRECEIVER_HH


2 
	#LINKTESTRECEIVER_HH


	)

18 
	~<şick/–em’t.hh
>

19 
CLICK_DECLS


21 
şass
 
	gAœoInfo
;

23 şas 
	cLškTe¡Reûiv”
 : 
public
 
EËm’t
 {

25 
public
:

26 
	$LškTe¡Reûiv”
(è
CLICK_COLD
;

27 ~
	$LškTe¡Reûiv”
(è
CLICK_COLD
;

29 cÚ¡ *
	$şass_Çme
() const {  "LinkTestReceiver"; }

30 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

31 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

33 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

34 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

36 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

38 
´iv©e
:

39 
AœoInfo
 *
_ai
;

40 
	}
};

42 
	gCLICK_ENDDECLS


	@grid/linktracker.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/”rÜ.hh
>

22 
	~"lškŒack”.hh
"

23 
	~<şick/glue.hh
>

24 
	~<sys/time.h
>

25 
	~"grid.hh
"

26 
	~<m©h.h
>

27 
	~"timeuts.hh
"

28 
CLICK_DECLS


30 
	gLškT¿ck”
::
	$LškT¿ck”
()

32 
	}
}

34 
LškT¿ck”
::~
	$LškT¿ck”
()

36 
	}
}

40 
LškT¿ck”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

42 
	gu_št
 = 0;

43 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

44 .
»ad_mp
("TAU", 
u_št
)

45 .
com¶‘e
();

46 ià(
	g»s
 < 0)

47  
	g»s
;

49 
	g_u
 = 
u_št
;

50 
	g_u
 *= 0.001;

52  
	g»s
;

58 
	gLškT¿ck”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

61 
	}
}

64 
	gLškT¿ck”
::
	$»move_®l_¡©s
(
IPAdd»ss
 
d¡
)

66 
_¡©s
.
	`»move
(
d¡
);

67 
_bÿ¡_¡©s
.
	`»move
(
d¡
);

68 
	}
}

72 
	gLškT¿ck”
::
	$add_¡©
(
IPAdd»ss
 
d¡
, 
sig
, 
qu®
, 
Time¡amp
 
wh’
)

74 ià(
sig
 =ğ0 && 
qu®
 == 0) {

75 
	`şick_ch©‹r
("LinkTracker: ignoring…robably bad†ink info from %s\n",

76 
d¡
.
	`uÅ¬£
().
	`c_¡r
());

80 
Time¡amp
 
now
 = Time¡amp::
	`now
();

82 
¡©_t
 *
s
 = 
_¡©s
.
	`fšdp
(
d¡
);

83 ià(
s
 == 0) {

85 
¡©_t
 
s2
;

86 
s2
.
Ï¡_d©a
 = 
wh’
;

87 
s2
.
Ï¡_upd©e
 = 
now
;

89 
s2
.
qu®_tİ
 = 
qu®
;

90 
s2
.
qu®_bÙ
 = 1.0;

92 
s2
.
sig_tİ
 = 
sig
;

93 
s2
.
sig_bÙ
 = 1.0;

95 
_¡©s
.
	`š£¹
(
d¡
, 
s2
);

99 
Time¡amp
 
tv
 = 
wh’
 - 
s
->
Ï¡_d©a
;

100 ià(!
tv
) {

107 
d–
 = 
tv
.
	`doubËv®
();

109 
Şd_weight
 = 
	`exp
(-
d–
 / 
_u
);

111 
s
->
qu®_tİ
 *ğ
Şd_weight
;

112 
s
->
qu®_tİ
 +ğ
qu®
;

114 
s
->
qu®_bÙ
 *ğ
Şd_weight
;

115 
s
->
qu®_bÙ
 += 1.0;

117 
s
->
sig_tİ
 *ğ
Şd_weight
;

118 
s
->
sig_tİ
 +ğ
sig
;

120 
s
->
sig_bÙ
 *ğ
Şd_weight
;

121 
s
->
sig_bÙ
 += 1.0;

123 
s
->
Ï¡_d©a
 = 
wh’
;

124 
s
->
Ï¡_upd©e
 = 
now
;

126 ià(
s
->
sig_tİ
 > 1e100) {

127 
	`şick_ch©‹r
("LinkTracker: warning, signal strength‡ccumulators‡re getting„eally big!!! Renormalizing.\n");

128 
s
->
sig_tİ
 *= 1e-80;

129 
s
->
sig_bÙ
 *= 1e-80;

131 ià(
s
->
qu®_tİ
 > 1e100) {

132 
	`şick_ch©‹r
("LinkTracker: warning, signal quality‡ccumulators‡re getting„eally big!!! Renormalizing.\n");

133 
s
->
qu®_tİ
 *= 1e-80;

134 
s
->
qu®_bÙ
 *= 1e-80;

137 
	}
}

140 
boŞ


141 
	gLškT¿ck”
::
	$g‘_¡©
(
IPAdd»ss
 
d¡
, &
sig
, &
qu®
, 
Time¡amp
 &
Ï¡_upd©e
)

143 
¡©_t
 *
s
 = 
_¡©s
.
	`fšdp
(
d¡
);

144 ià(
s
 == 0)

145  
çl£
;

147 
sig
 = (è(
s
->
sig_tİ
 / s->
sig_bÙ
);

148 
qu®
 = (è(
s
->
qu®_tİ
 / s->
qu®_bÙ
);

149 
Ï¡_upd©e
 = 
s
->last_update;

151  
Œue
;

152 
	}
}

155 
	gLškT¿ck”
::
	$add_bÿ¡_¡©
(
IPAdd»ss
 
d¡
, 
num_rx
, 
num_ex³ùed
, 
Time¡amp
 
Ï¡_bÿ¡
)

158 ià(
num_rx
 < 2)

161 ià(
num_rx
 > 
num_ex³ùed
)

162 
	`şick_ch©‹r
("LinkTracker::add_bcast_stat WARNING‚um_rx (%d) >‚um_expected (%d) for %s",

163 
num_rx
, 
num_ex³ùed
, 
d¡
.
	`uÅ¬£
().
	`c_¡r
());

165 
num_rx_
 = 
num_rx
;

166 
num_ex³ùed_
 = 
num_ex³ùed
;

177 
r
 = (
num_rx_
 - 0.5è/ 
num_ex³ùed_
;

179 
Time¡amp
 
now
 = Time¡amp::
	`now
();

181 
bÿ¡_t
 *
s
 = 
_bÿ¡_¡©s
.
	`fšdp
(
d¡
);

182 ià(
s
 == 0) {

184 
bÿ¡_t
 
s2
;

185 
s2
.
Ï¡_bÿ¡
 =†ast_bcast;

186 
s2
.
Ï¡_upd©e
 = 
now
;

188 
s2
.
r_tİ
 = 
r
;

189 
s2
.
r_bÙ
 = 1.0;

191 
_bÿ¡_¡©s
.
	`š£¹
(
d¡
, 
s2
);

194 
Time¡amp
 
tv
 = 
Ï¡_bÿ¡
 - 
s
->last_bcast;

195 ià(!
tv
)

198 
d–
 = 
tv
.
	`doubËv®
();

200 
Şd_weight
 = 
	`exp
(-
d–
 / 
_u
);

202 
s
->
r_tİ
 *ğ
Şd_weight
;

203 
s
->
r_tİ
 +ğ
r
;

205 
s
->
r_bÙ
 *ğ
Şd_weight
;

206 
s
->
r_bÙ
 += 1.0;

208 ià(
s
->
r_tİ
 > 1e100) {

209 
	`şick_ch©‹r
("LinkTracker: warning, broadcast delivery„ate‡ccumulators‡re getting„eally big!!! Renormalizing.\n");

210 
s
->
r_tİ
 *= 1e-80;

211 
s
->
r_bÙ
 *= 1e-80;

214 
	}
}

217 
boŞ


218 
	gLškT¿ck”
::
	$g‘_bÿ¡_¡©
(
IPAdd»ss
 
d¡
, &
d–iv”y_¿‹
, 
Time¡amp
 &
Ï¡_upd©e
)

220 
bÿ¡_t
 *
s
 = 
_bÿ¡_¡©s
.
	`fšdp
(
d¡
);

221 ià(
s
 == 0)

222  
çl£
;

224 
d–iv”y_¿‹
 = 
s
->
r_tİ
 / s->
r_bÙ
;

225 
Ï¡_upd©e
 = 
s
->last_update;

227  
Œue
;

228 
	}
}

231 
Pack‘
 *

232 
	gLškT¿ck”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

234 
şick_‘h”
 *
eh
 = (şick_‘h” *è
p
->
	`d©a
();

235 
grid_hdr
 *
gh
 = (grid_hd¸*è(
eh
 + 1);

237 
gh
->
ty³
) {

238 
grid_hdr
::
GRID_NBR_ENCAP
:

239 
grid_hdr
::
GRID_LOC_REPLY
:

240 
grid_hdr
::
GRID_ROUTE_PROBE
:

241 
grid_hdr
::
GRID_ROUTE_REPLY
: {

242 #iâdeà
SMALL_GRID_HEADERS


243 
grid_nbr_’ÿp
 *
nb
 = (grid_nbr_’ÿ°*è(
gh
 + 1);

244 
Time¡amp
 
tv
 = Time¡amp::
	`make_u£c
(
	`Áohl
(
nb
->
m—su»m’t_time
.
tv_£c
),

245 
	`Áohl
(
nb
->
m—su»m’t_time
.
tv_u£c
));

246 
	`add_¡©
(
	`IPAdd»ss
(
gh
->
tx_
), 
	`Áohl
(
nb
->
lšk_sig
),‚tohlÒb->
lšk_qu®
), 
tv
);

254  
p
;

255 
	}
}

257 
SŒšg


258 
	gLškT¿ck”
::
	$»ad_u
(
EËm’t
 *
xf
, *)

260 
LškT¿ck”
 *
f
 = (LškT¿ck” *è
xf
;

261 
u
 = (è(
f
->
_u
 * 1000);

262  
	`SŒšg
(
u
) + "\n";

263 
	}
}

266 
SŒšg


267 
	gLškT¿ck”
::
	$»ad_¡©s
(
EËm’t
 *
xf
, *)

269 
LškT¿ck”
 *
f
 = (LškT¿ck” *è
xf
;

271 
timebuf
[80];

272 
SŒšg
 
s
;

273 
HashM­
<
IPAdd»ss
, 
LškT¿ck”
::
¡©_t
>::
™”©Ü
 
i
 = 
f
->
_¡©s
.
	`begš
(); i.
	`live
(); i++) {

274 
	`¢´štf
(
timebuf
, 80, " %ld.%06ld",

275 (è
i
.
	`v®ue
().
Ï¡_upd©e
.
	`£c
(),

276 (è
i
.
	`v®ue
().
Ï¡_upd©e
.
	`u£c
());

277 
s
 +ğ
i
.
	`key
().
	`uÅ¬£
()

278 + 
	`SŒšg
(
timebuf
)

279 + " sig: " + 
	`SŒšg
(
i
.
	`v®ue
().
sig_tİ
 / i.v®ue().
sig_bÙ
)

280 + ", qu®: " + 
	`SŒšg
(
i
.
	`v®ue
().
qu®_tİ
 / i.v®ue().
qu®_bÙ
) + "\n";

282  
s
;

283 
	}
}

285 
SŒšg


286 
	gLškT¿ck”
::
	$»ad_bÿ¡_¡©s
(
EËm’t
 *
xf
, *)

288 
LškT¿ck”
 *
f
 = (LškT¿ck” *è
xf
;

290 
timebuf
[80];

291 
SŒšg
 
s
;

292 
HashM­
<
IPAdd»ss
, 
LškT¿ck”
::
bÿ¡_t
>::
™”©Ü
 
i
 = 
f
->
_bÿ¡_¡©s
.
	`begš
(); i.
	`live
(); i++) {

293 
	`¢´štf
(
timebuf
, 80, " %ld.%06ld",

294 (è
i
.
	`v®ue
().
Ï¡_upd©e
.
	`£c
(),

295 (è
i
.
	`v®ue
().
Ï¡_upd©e
.
	`u£c
());

296 
s
 +ğ
i
.
	`key
().
	`uÅ¬£
()

297 + 
	`SŒšg
(
timebuf
)

298 + " " + 
	`SŒšg
(
i
.
	`v®ue
().
r_tİ
 / i.v®ue().
r_bÙ
) + "\n";

300  
s
;

301 
	}
}

305 
	gLškT¿ck”
::
	$wr™e_u
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–
,

306 *, 
E¼ÜHªdËr
 *
”rh
)

308 
LškT¿ck”
 *
e
 = (LškT¿ck” *è
–
;

309 
u
 = 
	`©of
(((
SŒšg
è
¬g
).
	`c_¡r
());

310 ià(
u
 < 0)

311  
”rh
->
	`”rÜ
("tau must be >= 0");

312 
e
->
_u
 = 
u
 * 0.001;

316 
e
->
_¡©s
.
	`ş—r
();

317 
e
->
_bÿ¡_¡©s
.
	`ş—r
();

320 
	}
}

324 
	gLškT¿ck”
::
	$add_hªdËrs
()

326 
	`add_»ad_hªdËr
("¡©s", 
»ad_¡©s
, 0);

327 
	`add_»ad_hªdËr
("bÿ¡_¡©s", 
»ad_bÿ¡_¡©s
, 0);

328 
	`add_»ad_hªdËr
("u", 
»ad_u
, 0);

329 
	`add_wr™e_hªdËr
("u", 
wr™e_u
, 0);

330 
	}
}

332 
ELEMENT_REQUIRES
(
u£¾ev–
|
ns
)

333 
	$EXPORT_ELEMENT
(
LškT¿ck”
)

334 
CLICK_ENDDECLS


	@grid/linktracker.hh

1 #iâdeà
LINKTRACKERHH


2 
	#LINKTRACKERHH


	)

18 
	~<şick/bighashm­.hh
>

19 
	~<şick/–em’t.hh
>

20 
	~<şick/glue.hh
>

21 
	~<şick/add»ss.hh
>

22 
CLICK_DECLS


24 şas 
	cLškT¿ck”
 : 
public
 
EËm’t
 {

26 
_u
;

28 
SŒšg
 
»ad_¡©s
(
EËm’t
 *, *);

29 
SŒšg
 
»ad_bÿ¡_¡©s
(
EËm’t
 *, *);

30 
SŒšg
 
»ad_u
(
EËm’t
 *, *);

31 
wr™e_u
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

33 
	s¡©_t
 {

34 
	mqu®_tİ
;

35 
	mqu®_bÙ
;

36 
	msig_tİ
;

37 
	msig_bÙ
;

38 
Time¡amp
 
	mÏ¡_d©a
;

39 
Time¡amp
 
	mÏ¡_upd©e
;

42 
	sbÿ¡_t
 {

44 
	gr_tİ
;

45 
	gr_bÙ
;

46 
Time¡amp
 
	gÏ¡_bÿ¡
;

47 
Time¡amp
 
	gÏ¡_upd©e
;

50 
	gHashM­
<
	gIPAdd»ss
, 
	g¡©_t
> 
	g_¡©s
;

51 
	gHashM­
<
	gIPAdd»ss
, 
	gbÿ¡_t
> 
	g_bÿ¡_¡©s
;

53 
	gpublic
:

54 
add_¡©
(
IPAdd»ss
 
d¡
, 
sig
, 
qu®
, 
Time¡amp
 
wh’
);

55 
boŞ
 
g‘_¡©
(
IPAdd»ss
 
d¡
, &
sig
, &
qu®
, 
Time¡amp
 &
Ï¡_upd©e
);

56 
add_bÿ¡_¡©
(
IPAdd»ss
 
d¡
, 
num_rx
, 
num_ex³ùed
, 
Time¡amp
 
Ï¡_bÿ¡
);

57 
boŞ
 
g‘_bÿ¡_¡©
(
IPAdd»ss
 
d¡
, &
d–iv”y_¿‹
, 
Time¡amp
 &
Ï¡_upd©e
);

58 
»move_®l_¡©s
(
IPAdd»ss
 
d¡
);

60 
	$LškT¿ck”
(è
CLICK_COLD
;

61 ~
	$LškT¿ck”
(è
CLICK_COLD
;

63 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "LškT¿ck”"; 
	}
}

64 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

65 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "a/a"; 
	}
}

67 
	$add_hªdËrs
(è
CLICK_COLD
;

69 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

70 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

72 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

73 
	}
};

75 
	gCLICK_ENDDECLS


	@grid/lirmetric.cc

16 
	~<şick/cÚfig.h
>

17 
	~<şick/¬gs.hh
>

18 
	~<şick/”rÜ.hh
>

19 
	~"–em’ts/grid/lœm‘ric.hh
"

20 
	~"–em’ts/grid/lšk¡©.hh
"

21 
	~"–em’ts/grid/gridg’”iüt.hh
"

22 
CLICK_DECLS


24 
	gLIRM‘ric
::
	$LIRM‘ric
()

25 : 
	$_¹
(0)

27 
	}
}

29 
LIRM‘ric
::~
	$LIRM‘ric
()

31 
	}
}

34 
LIRM‘ric
::
	$ÿ¡
(cÚ¡ *
n
)

36 ià(
	`¡rcmp
(
n
, "LIRMetric") == 0)

37  (
LIRM‘ric
 *è
this
;

38 ià(
	`¡rcmp
(
n
, "GridGenericMetric") == 0)

39  (
GridG’”icM‘ric
 *è
this
;

42 
	}
}

45 
	gLIRM‘ric
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

47  
Args
(
cÚf
, 
this
, 
”rh
)

48 .
»ad_mp
("GRIDROUTES", 
EËm’tCa¡Arg
("GridG’”icRou‹TabË"), 
_¹
)

49 .
com¶‘e
();

53 
boŞ


54 
	gLIRM‘ric
::
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &
m1
, cÚ¡ m‘ric_ˆ&
m2
) const

56  
m1
.
	`v®
(è< 
m2
.val();

57 
	}
}

59 
	gGridG’”icM‘ric
::
m‘ric_t


60 
LIRM‘ric
::
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &, 
boŞ
) const

66  
	`m‘ric_t
(
_¹
->
	`g‘_numb”_dœeù_ÃigbÜs
());

67 
	}
}

69 
	gGridG’”icM‘ric
::
m‘ric_t


70 
LIRM‘ric
::
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

72 ià(!
r
.
	`good
(è|| !
l
.good())

73  
_bad_m‘ric
;

77 ià(
r
.
	`v®
() < 1)

78 
	`şick_ch©‹r
("LIRMetric %s:‡ppend_metric WARNING: metric %u%%‚eighbors isoo†ow for„oute metric",

79 
	`Çme
().
	`c_¡r
(), 
r
.
	`v®
());

80 ià(
l
.
	`v®
() < 1)

81 
	`şick_ch©‹r
("LIRMetric %s:‡ppend_metric WARNING: metric %u%%‚eighbors isoo†ow for†ink metric",

82 
	`Çme
().
	`c_¡r
(), 
r
.
	`v®
());

84  
	`m‘ric_t
(
r
.
	`v®
(è+ 
l
.val());

85 
	}
}

88 
	$ELEMENT_PROVIDES
(
GridG’”icM‘ric
)

89 
	$EXPORT_ELEMENT
(
LIRM‘ric
)

91 
CLICK_ENDDECLS


	@grid/lirmetric.hh

1 #iâdeà
LIRMETRIC_HH


2 
	#LIRMETRIC_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"gridg’”icm‘ric.hh
"

5 
CLICK_DECLS


28 
şass
 
	gGridG’”icRou‹TabË
;

30 şas 
	cLIRM‘ric
 : 
public
 
GridG’”icM‘ric
 {

32 
public
:

34 
	$LIRM‘ric
(è
CLICK_COLD
;

35 ~
	$LIRM‘ric
(è
CLICK_COLD
;

37 cÚ¡ *
	$şass_Çme
() const {  "LIRMetric"; }

38 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_0
; 
	}
}

39 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

41 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

42 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
çl£
; 
	}
}

44 *
ÿ¡
(const *);

47 
boŞ
 
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

48 
m‘ric_t
 
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &, 
boŞ
) const;

49 
m‘ric_t
 
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

50 
m‘ric_t
 
	$´•’d_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

51 {  
	`­³nd_m‘ric
(
r
, 
l
); 
	}
}

53 
	$sÿË_to_ch¬
(cÚ¡ 
m‘ric_t
 &
m
ècÚ¡ {  (èm.
	`v®
(); 
	}
}

54 
m‘ric_t
 
	$unsÿË_äom_ch¬
(
c
ècÚ¡ {  
	`m‘ric_t
(c); 
	}
}

56 
	g´iv©e
:

58 
GridG’”icRou‹TabË
 *
_¹
;

62 
	gCLICK_ENDDECLS


	@grid/locfromfile.cc

18 
	~<şick/cÚfig.h
>

19 
	~"locäomfe.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/”rÜ.hh
>

24 
CLICK_DECLS


26 
	gLocFromFe
::
	$LocFromFe
()

28 
_Ãxt
 = 0;

29 
_move
 = 1;

30 
	}
}

32 
	gLocFromFe
::~
	$LocFromFe
()

34 
	}
}

37 
LocFromFe
::
	$ÿ¡
(cÚ¡ *
Çme
)

39 if(
	`¡rcmp
(
Çme
, "GridLocationInfo") == 0)

40 (
this
);

41 (
GridLoÿtiÚInfo
::
	`ÿ¡
(
Çme
));

42 
	}
}

45 
	gLocFromFe
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

47 
SŒšg
 
	gf’ame
;

48 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

49 .
»ad_mp
("FILENAME", 
F’ameArg
(), 
f’ame
)

50 .
com¶‘e
();

51 if(
	g»s
 >= 0){

52 
FILE
 *
å
 = 
fİ’
(
f’ame
.
c_¡r
(), "r");

53 if(
	gå
 == 0)

54 (
”rh
->
”rÜ
("ÿÂÙ o³Àf%s", 
f’ame
.
c_¡r
()));

55 
	gbuf
[512];

56 
fg‘s
(
buf
, (buf), 
å
)){

57 
d–
 
	gd
;

58 if(
ssÿnf
(
buf
, "%lf%lf%lf", &
d
.
š‹rv®
, &d.
Ït
, &d.
lÚ
) == 3){

59 
_d–s
.
push_back
(
d
);

61 
fşo£
(
å
);

62 (
	g”rh
->
”rÜ
("ÿÂÙ…¬£‡†šš f%s", 
f’ame
.
c_¡r
()));

65 
fşo£
(
å
);

66 if(
	g_d–s
.
size
() < 1)

67 (
	g”rh
->
”rÜ
("nØloÿtiÚ š f%s", 
f’ame
.
c_¡r
()));

68 
şick_ch©‹r
("read %d deltas from %s",

69 
_d–s
.
size
(),

70 
f’ame
.
c_¡r
());

72  
	g»s
;

78 
	gLocFromFe
::
	$choo£_Ãw_Ëg
(*
Æ©
, *
ÆÚ
, *
Á
)

80 *
Æ©
 = 
_d–s
[
_Ãxt
].
Ït
;

81 *
ÆÚ
 = 
_d–s
[
_Ãxt
].
lÚ
;

82 *
Á
 = 
_t0
 + 
_d–s
[
_Ãxt
].
š‹rv®
;

84 
_Ãxt
 += 1;

85 if(
_Ãxt
 >ğ
_d–s
.
	`size
())

86 
_Ãxt
 = 0;

87 
	}
}

89 
CLICK_ENDDECLS


90 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
GridLoÿtiÚInfo
)

91 
	`EXPORT_ELEMENT
(
LocFromFe
)

	@grid/locfromfile.hh

1 #iâdeà
LocFromFe_hh


2 
	#LocFromFe_hh
 1

	)

28 
	~<şick/–em’t.hh
>

29 
	~"–em’ts/grid/gridloÿtiÚšfo.hh
"

30 
CLICK_DECLS


32 şas 
	cLocFromFe
 : 
public
 
GridLoÿtiÚInfo
 {

33 
public
:

34 
	$LocFromFe
(è
CLICK_COLD
;

35 ~
	$LocFromFe
(è
CLICK_COLD
;

37 cÚ¡ *
	$şass_Çme
() const {  "LocFromFile"; }

39 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

40 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

41 
vœtu®
 *
ÿ¡
(const *);

43 
	g´Ùeùed
:

44 
vœtu®
 
choo£_Ãw_Ëg
(*, *, *);

46 
	g´iv©e
:

47 
	sd–
 {

48 
š‹rv®
;

49 
	gÏt
;

50 
	glÚ
;

52 
	gVeùÜ
<
	gd–
> 
	g_d–s
;

53 
	g_Ãxt
;

56 
	gCLICK_ENDDECLS


	@grid/locqueryresponder.cc

19 
	~<şick/cÚfig.h
>

20 
	~"locqu”y»¥Úd”.hh
"

21 
	~<şickÃt/‘h”.h
>

22 
	~<şick/‘h”add»ss.hh
>

23 
	~<şick/add»ss.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/glue.hh
>

27 
	~"grid.hh
"

28 
	gCLICK_DECLS


30 
	#NOISY
 1

	)

32 
	gLocQu”yRe¥Úd”
::
	$LocQu”yRe¥Úd”
()

33 : 
	$_expœe_tim”
(
expœe_hook
, 
this
)

35 
	}
}

38 
	gLocQu”yRe¥Úd”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

40 
_expœe_tim”
.
	`š™Ÿlize
(
this
);

41 
_expœe_tim”
.
	`scheduË_aá”_m£c
(
EXPIRE_TIMEOUT_MS
);

42 
_timeout_jiff›s
 = (
CLICK_HZ
 * 
EXPIRE_TIMEOUT_MS
) / 1000;

44 
	}
}

46 
	gLocQu”yRe¥Úd”
::~
	$LocQu”yRe¥Úd”
()

48 
	}
}

51 
LocQu”yRe¥Úd”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

53  
Args
(
cÚf
, 
this
, 
”rh
)

54 .
»ad_mp
("ETH", 
_‘h
)

55 .
»ad_mp
("IP", 
_
)

56 .
com¶‘e
();

60 
	gLocQu”yRe¥Úd”
::
	$expœe_hook
(
Tim”
 *, *
thunk
)

62 
LocQu”yRe¥Úd”
 *
»¥
 = (LocQu”yRe¥Úd” *)
thunk
;

63 
jiff
 = 
	`şick_jiff›s
();

66 
£q_m­
::
	t™”©Ü
 
	tsmi_t
;

67 
VeùÜ
<
IPAdd»ss
> 
Şd_£qs
;

68 
smi_t
 
i
 = 
»¥
->
_qu”y_£qs
.
	`begš
(); i.
	`live
(); i++)

69 ià(
jiff
 - 
i
.
	`v®ue
().
Ï¡_jiff›s
 > 
»¥
->
_timeout_jiff›s
)

70 
Şd_£qs
.
	`push_back
(
i
.
	`key
());

72 
i
 = 0; i < 
Şd_£qs
.
	`size
(); i++)

73 
»¥
->
_qu”y_£qs
.
	`»move
(
Şd_£qs
[
i
]);

75 
»¥
->
_expœe_tim”
.
	`scheduË_aá”_m£c
(
EXPIRE_TIMEOUT_MS
);

76 
	}
}

79 
Pack‘
 *

80 
	gLocQu”yRe¥Úd”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

82 
şick_‘h”
 *
e
 = (şick_‘h” *è
p
->
	`d©a
();

83 
grid_hdr
 *
gh
 = (grid_hd¸*è(
e
 + 1);

84 
grid_loc_qu”y
 *
lq
 = (grid_loc_qu”y *è(
gh
 + 1);

86 ià(
gh
->
ty³
 !ğ
grid_hdr
::
GRID_LOC_QUERY
) {

87 
	`şick_ch©‹r
("LocQueryResponder %s:„eceived unexpected Grid…acketype %s; ishe configuration wrong?",

88 
	`Çme
().
	`c_¡r
(), 
grid_hdr
::
	`ty³_¡ršg
(
gh
->
ty³
).c_str());

89 
p
->
	`kl
();

93 ià(
lq
->
d¡_
 !ğ(è
_
) {

94 
	`şick_ch©‹r
("LocQueryResponder %s:„eceived†ocation query for someoneƒlse (%s); ishe configuration wrong?",

95 
	`Çme
().
	`c_¡r
(), 
	`IPAdd»ss
(
lq
->
d¡_
).
	`uÅ¬£
().c_str());

96 
p
->
	`kl
();

101 
£q_no
 = 
	`Áohl
(
lq
->seq_no);

102 
£q_t
 *
Şd_£q
 = 
_qu”y_£qs
.
	`fšdp
(
gh
->

);

103 ià(
Şd_£q
 && old_£q->
£q_no
 >= seq_no) {

104 #ià
NOISY


105 
	`şick_ch©‹r
("LocQu”yRe¥Úd” %s: ignÜšg old qu”y from % (%uè", 
	`Çme
().
	`c_¡r
(), 
	`IPAdd»ss
(
gh
->

).
	`uÅ¬£
().c_¡r(), 
£q_no
);

107 
p
->
	`kl
();

110 
_qu”y_£qs
.
	`š£¹
(
gh
->

, 
	`£q_t
(
£q_no
, 
	`şick_jiff›s
()));

113 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((
şick_‘h”
è+ (
grid_hdr
è+ (
grid_nbr_’ÿp
) + 2);

114 ià(
q
 == 0) {

115 
	`şick_ch©‹r
("š %s: cªnÙ mak·ck‘!", 
	`Çme
().
	`c_¡r
());

116 
	`as£¹
(0);

118 
	`ASSERT_4ALIGNED
(
q
->
	`d©a
());

119 
q
->
	`puÎ
(2);

121 
p
->
	`£t_time¡amp_ªno
(
Time¡amp
::
	`now
());

123 
	`mem£t
(
q
->
	`d©a
(), 0, q->
	`Ëngth
());

124 
e
 = (
şick_‘h”
 *è
q
->
	`d©a
();

125 
grid_hdr
 *
ngh
 = (grid_hd¸*è(
e
 + 1);

126 
grid_nbr_’ÿp
 *
nb
 = (grid_nbr_’ÿ°*è(
ngh
 + 1);

128 
e
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_GRID
);

131 
ngh
->
hdr_Ën
 = (
grid_hdr
);

132 
ngh
->
ty³
 = 
grid_hdr
::
GRID_LOC_REPLY
;

133 
ngh
->

 =‚gh->
tx_
 = 
_
;

134 
ngh
->
tÙ®_Ën
 = 
	`htÚs
(
q
->
	`Ëngth
(è- (
şick_‘h”
));

136 
nb
->
d¡_
 = 
gh
->

;

137 #iâdeà
SMALL_GRID_HEADERS


138 
nb
->
d¡_loc
 = 
gh
->
loc
;

139 
nb
->
d¡_loc_”r
 = 
gh
->
loc_”r
;

140 
nb
->
d¡_loc_good
 = 
gh
->
loc_good
;

142 
nb
->
hİs_Œav–Ëd
 = 0;

144 
p
->
	`kl
();

145 (
q
);

146 
	}
}

148 
	$EXPORT_ELEMENT
(
LocQu”yRe¥Úd”
)

149 
CLICK_ENDDECLS


	@grid/locqueryresponder.hh

1 #iâdeà
LOCQUERYRESPONDER_HH


2 
	#LOCQUERYRESPONDER_HH


	)

23 
	~<şick/–em’t.hh
>

24 
	~<şick/‘h”add»ss.hh
>

25 
	~<şick/add»ss.hh
>

26 
	~<şick/veùÜ.hh
>

27 
	~<şick/bighashm­.hh
>

28 
	~<şick/tim”.hh
>

29 
CLICK_DECLS


31 şas 
	cLocQu”yRe¥Úd”
 : 
public
 
EËm’t
 {

33 
public
:

34 
	$LocQu”yRe¥Úd”
(è
CLICK_COLD
;

35 ~
	$LocQu”yRe¥Úd”
(è
CLICK_COLD
;

37 cÚ¡ *
	$şass_Çme
() const {  "LocQueryResponder"; }

38 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

39 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

40 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

41 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

43 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

46 
´iv©e
:

47 
IPAdd»ss
 
_
;

48 
Eth”Add»ss
 
_‘h
;

49 
Tim”
 
_expœe_tim”
;

51 cÚ¡ 
EXPIRE_TIMEOUT_MS
 = 2 * 1000;

52 
_timeout_jiff›s
;

53 
	`expœe_hook
(
Tim”
 *, *);

55 
	s£q_t
 {

56 
£q_no
;

57 
Ï¡_jiff›s
;

58 
	`£q_t
(
s
, 
j
è: 
	`£q_no
(s), 
	`Ï¡_jiff›s
(j) { }

59 
	`£q_t
(è: 
	`£q_no
(0), 
	`Ï¡_jiff›s
(0) { }

60 
	}
};

62 
	gHashM­
<
	tIPAdd»ss
, 
	t£q_t
> 
	t£q_m­
;

63 
£q_m­
 
	g_qu”y_£qs
;

67 
	gCLICK_ENDDECLS


	@grid/loctable.cc

18 
	~<şick/cÚfig.h
>

19 
	~"loùabË.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/”rÜ.hh
>

24 
CLICK_DECLS


26 
	gLoÿtiÚTabË
::
	$LoÿtiÚTabË
()

28 
	}
}

30 
LoÿtiÚTabË
::~
	$LoÿtiÚTabË
()

32 
	}
}

35 
LoÿtiÚTabË
::
»ad_¬gs
(cÚ¡ 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

38 
IPAdd»ss
 
	g
;

39 
	gÏt
, 
	glÚ
;

40 
	g”r
;

41 
	g»s
 = 
Args
(
this
, 
”rh
).
push_back_wÜds
(
cÚf
[
i
])

42 .
»ad_mp
("IP", 

)

43 .
»ad_mp
("LATITUDE", 
Decim®FixedPoštArg
(7), 
Ït
)

44 .
»ad_mp
("LONGITUDE", 
Decim®FixedPoštArg
(7), 
lÚ
)

45 .
»ad_mp
("ERROR_RADIUS", 
”r
)

46 .
com¶‘e
();

47 ià(
	g»s
 < 0)

50 
grid_loÿtiÚ
 
loc
((è
Ït
 / 1.0e7, (è
lÚ
 / 1.0e7);

51 
boŞ
 
	gis_Ãw
 = 
_locs
.
š£¹
(

, 
’Œy
(
loc
, 
”r
));

52 ià(!
	gis_Ãw
)

53  
	g”rh
->
”rÜ
("LocationTable %s: %s‡lready has‡†ocation mapping",

54 
Çme
().
c_¡r
(), 

.
uÅ¬£
().c_str());

59 
	gLoÿtiÚTabË
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

61  
»ad_¬gs
(
cÚf
, 
”rh
);

65 
SŒšg


66 
	$bË_»ad_hªdËr
(
EËm’t
 *
f
, *)

68 
LoÿtiÚTabË
 *
l
 = (LoÿtiÚTabË *è
f
;

70 
SŒšg
 
	`»s
("");

71 cÚ¡ 
BUFSZ
 = 255;

72 
buf
[
BUFSZ
];

73 
LoÿtiÚTabË
::
TabË
::
™”©Ü
 
™”
 = 
l
->
_locs
.
	`begš
(); i‹r.
	`live
(); iter++) {

74 cÚ¡ 
LoÿtiÚTabË
::
’Œy
 &
’t
 = 
™”
.
	`v®ue
();

75 
r
 = 
	`¢´štf
(
buf
, 
BUFSZ
, "% loc=% ”r=%d\n", 
™”
.
	`key
().
	`uÅ¬£
().
	`c_¡r
(), 
’t
.
loc
.
	`s
().c_¡r(),ƒÁ.
”r
);

76 ià(
r
 < 0) {

77 
	`şick_ch©‹r
("LoÿtiÚTabË % »ad hªdË¸bufã¸toØsm®l", 
l
->
	`Çme
().
	`c_¡r
());

78  
	`SŒšg
("");

80 
»s
 +ğ
buf
;

82  
»s
;

83 
	}
}

85 
boŞ


86 
	gLoÿtiÚTabË
::
	$g‘_loÿtiÚ
(
IPAdd»ss
 

, 
grid_loÿtiÚ
 &
loc
, &
”r_¿dius
)

88 
’Œy
 *
l2
 = 
_locs
.
	`fšdp
(

);

89 ià(!
l2
)

90  
çl£
;

91 
loc
 = 
l2
->loc;

92 
”r_¿dius
 = 
l2
->
”r
;

93  
Œue
;

94 
	}
}

98 
	$loc_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–em’t
,

99 *, 
E¼ÜHªdËr
 *
”rh
)

101 
LoÿtiÚTabË
 *
l
 = (LoÿtiÚTabË *è
–em’t
;

102 
Ït
, 
lÚ
;

103 
IPAdd»ss
 

;

104 
”r
;

105 
»s
 = 
	`Args
(
l
, 
”rh
).
	`push_back_wÜds
(
¬g
)

106 .
	`»ad_mp
("IP", 

)

107 .
	`»ad_mp
("LATITUDE", 
	`Decim®FixedPoštArg
(7), 
Ït
)

108 .
	`»ad_mp
("LONGITUDE", 
	`Decim®FixedPoštArg
(7), 
lÚ
)

109 .
	`»ad_mp
("ERROR_RADIUS", 
”r
)

110 .
	`com¶‘e
();

111 ià(
»s
 < 0)

113 
grid_loÿtiÚ
 
	`loc
((è
Ït
 / 1.0e7, (è
lÚ
 / 1.0e7);

114 
l
->
_locs
.
	`š£¹
(

, 
LoÿtiÚTabË
::
	`’Œy
(
loc
, 
”r
));

116 
	}
}

119 
	gLoÿtiÚTabË
::
	$add_hªdËrs
()

121 
	`add_wr™e_hªdËr
("loc", 
loc_wr™e_hªdËr
, 0);

122 
	`add_»ad_hªdËr
("bË", 
bË_»ad_hªdËr
, 0);

123 
	}
}

127 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

128 
	$EXPORT_ELEMENT
(
LoÿtiÚTabË
)

129 
CLICK_ENDDECLS


	@grid/loctable.hh

1 #iâdeà
LOCTAB_HH


2 
	#LOCTAB_HH


	)

29 
	~<şick/–em’t.hh
>

30 
	~"grid.hh
"

31 
	~<şick/bighashm­.hh
>

32 
CLICK_DECLS


34 şas 
	cLoÿtiÚTabË
 : 
public
 
EËm’t
 {

36 
public
:

37 
	$LoÿtiÚTabË
(è
CLICK_COLD
;

38 ~
	$LoÿtiÚTabË
(è
CLICK_COLD
;

40 cÚ¡ *
	$şass_Çme
() const {  "LocationTable"; }

42 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

43 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

45 
boŞ
 
g‘_loÿtiÚ
(
IPAdd»ss
 

, 
grid_loÿtiÚ
 &
loc
, &
”r_¿dius
);

47 
	$add_hªdËrs
(è
CLICK_COLD
;

48 
	`»ad_¬gs
(cÚ¡ 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
);

52 
	s’Œy
 {

53 
grid_loÿtiÚ
 
loc
;

54 
”r
;

55 
	`’Œy
(
grid_loÿtiÚ
 
l
, 
e
è: 
	`loc
Ö), 
	`”r
(e) { }

56 
	`’Œy
(è: 
	`”r
(-1) { }

57 
	}
};

58 
	gHashM­
<
	tIPAdd»ss
, 
	t’Œy
> 
	tTabË
;

59 
TabË
 
	g_locs
;

61 
	g´iv©e
:

67 
	gCLICK_ENDDECLS


	@grid/lookupgeogridroute.cc

18 
	~<şick/cÚfig.h
>

19 
	~<¡ddef.h
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şickÃt/‘h”.h
>

23 
	~<şickÃt/.h
>

24 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

25 
	~<şick/rou‹r.hh
>

26 
	~<şick/glue.hh
>

27 
	~"grid.hh
"

28 
	~"lookupgeogridrou‹.hh
"

29 
	~"gridg’”iüt.hh
"

30 
	~"f‹rby¿nge.hh
"

31 
	~"gridloÿtiÚšfo.hh
"

33 
CLICK_DECLS


35 
	gLookupGeog¿phicGridRou‹
::
	$LookupGeog¿phicGridRou‹
()

36 : 
	`_¹
(0), 
	$_sk
(
this
)

38 
	}
}

40 
	gLookupGeog¿phicGridRou‹
::~
	$LookupGeog¿phicGridRou‹
()

42 
	}
}

45 
LookupGeog¿phicGridRou‹
::
	$ÿ¡
(cÚ¡ *
n
)

47 ià(
	`¡rcmp
(
n
, "LookupGeographicGridRoute") == 0)

48  (
LookupGeog¿phicGridRou‹
 *)
this
;

51 
	}
}

54 
	gLookupGeog¿phicGridRou‹
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

56  
Args
(
cÚf
, 
this
, 
”rh
)

57 .
»ad_mp
("ETH", 
_‘haddr
)

58 .
»ad_mp
("IP", 
_addr
)

59 .
»ad_mp
("GRIDROUTES", 
EËm’tCa¡Arg
("GridG’”icRou‹TabË"), 
_¹
)

60 .
»ad_mp
("LOCINFO", 
EËm’tCa¡Arg
("GridLoÿtiÚInfo"), 
_li
)

61 .
com¶‘e
();

65 
	gLookupGeog¿phicGridRou‹
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

67 ià(
	`šput_is_puÎ
(0))

68 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

70 
	}
}

72 
boŞ


73 
	gLookupGeog¿phicGridRou‹
::
	$run_sk
(
Task
 *)

75 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

76 ià(
p
)

77 
	`push
(0, 
p
);

78 
_sk
.
	`ç¡_»scheduË
();

79  
p
 != 0;

80 
	}
}

82 
GridRou‹AùiÚC®lback
 
	tGRCB
;

85 
	gLookupGeog¿phicGridRou‹
::
	$push
(
pÜt
, 
Pack‘
 *
·ck‘
)

90 
	`as£¹
(
·ck‘
);

91 
	`as£¹
(
pÜt
 == 0);

93 
grid_hdr
 *
gh
 = (grid_hd¸*è(
·ck‘
->
	`d©a
(è+ (
şick_‘h”
));

95 ià(
	`dÚt_fÜw¬d
(
·ck‘
)) {

96 
	`şick_ch©‹r
("LookupGeographicGridRoute %s:‚ot supposedo forward…acket ofype %s",

97 
	`Çme
().
	`c_¡r
(), 
grid_hdr
::
	`ty³_¡ršg
(
gh
->
ty³
).c_str());

98 
	`nÙify_rou‹_cbs
(
·ck‘
, 0, 
GRCB
::
Drİ
, GRCB::
UnknownTy³
, 0);

99 
	`ouut
(1).
	`push
(
·ck‘
);

103 
de¡_
 = 0;

104 ià(
gh
->
ty³
 =ğ
grid_hdr
::
GRID_NBR_ENCAP
) {

105 
grid_nbr_’ÿp
 *
nb
 = (grid_nbr_’ÿ°*è(
gh
 + 1);

106 
de¡_
 = 
nb
->
d¡_
;

110 ià(!
_li
->
	`loc_good
()) {

111 
	`şick_ch©‹r
("LookupGeog¿phicGridRou‹ %s: cª'ˆfÜw¬d…ack‘; wdÚ'ˆknow ou¸owÀloÿtiÚ", 
	`Çme
().
	`c_¡r
());

112 
	`nÙify_rou‹_cbs
(
·ck‘
, 
de¡_
, 
GRCB
::
Drİ
, GRCB::
OwnLocUnknown
, 0);

113 
	`ouut
(1).
	`push
(
·ck‘
);

117 ià(!
	`de¡_loc_good
(
·ck‘
)) {

118 
	`şick_ch©‹r
("LookupGeographicGridRoute %s:„eceived…acket ofype %s without good destination†ocation",

119 
	`Çme
().
	`c_¡r
(), 
grid_hdr
::
	`ty³_¡ršg
(
gh
->
ty³
).c_str());

120 
	`nÙify_rou‹_cbs
(
·ck‘
, 
de¡_
, 
GRCB
::
Drİ
, GRCB::
NoDe¡Loc
, 0);

121 
	`ouut
(1).
	`push
(
·ck‘
);

126 
Eth”Add»ss
 
Ãxt_hİ_‘h
;

127 
IPAdd»ss
 
Ãxt_hİ_
;

128 
Ãxt_hİ_š‹rçû
 = 0;

129 
IPAdd»ss
 
be¡_nbr_
;

130 
boŞ
 
found_Ãxt_hİ
 = 
	`g‘_Ãxt_geog¿phic_hİ
(
	`g‘_de¡_loc
(
·ck‘
), &
Ãxt_hİ_‘h
, &
Ãxt_hİ_
,

131 &
be¡_nbr_
, &
Ãxt_hİ_š‹rçû
);

133 
Wr™abËPack‘
 *
xp
 = 
·ck‘
->
	`uniqueify
();

135 ià(
found_Ãxt_hİ
) {

136 
şick_‘h”
 *
eh
 = (şick_‘h” *è
xp
->
	`d©a
();

137 
	`memıy
(
eh
->
‘h”_sho¡
, 
_‘haddr
.
	`d©a
(), 6);

138 
	`memıy
(
eh
->
‘h”_dho¡
, 
Ãxt_hİ_‘h
.
	`d©a
(), 6);

139 
grid_hdr
 *
gh
 = (grid_hd¸*è(
xp
->
	`d©a
(è+ (
şick_‘h”
));

140 
gh
->
tx_
 = 
_addr
;

141 
	`šüem’t_hİs_Œav–Ëd
(
xp
);

142 
	`nÙify_rou‹_cbs
(
·ck‘
, 
de¡_
, 
GRCB
::
FÜw¬dGF
, 
Ãxt_hİ_
, 
be¡_nbr_
);

144 
	`SET_PAINT_ANNO
(
xp
, 
Ãxt_hİ_š‹rçû
);

145 
	`ouut
(0).
	`push
(
xp
);

148 
	`şick_ch©‹r
("LookupGeographicGridRoute %s: unableo forward %s…acket with geographic„outing",

149 
	`Çme
().
	`c_¡r
(), 
grid_hdr
::
	`ty³_¡ršg
(
gh
->
ty³
).c_str());

151 ià(
gh
->
ty³
 =ğ
grid_hdr
::
GRID_NBR_ENCAP
) {

152 
_off
 = (
şick_‘h”
è+ (
grid_hdr
è+ (
grid_nbr_’ÿp
);

153 
xp
->
	`puÎ
(
_off
);

154 
IPAdd»ss
 
	`¤c_
(
xp
->
	`d©a
() + 12);

155 
IPAdd»ss
 
	`d¡_
(
xp
->
	`d©a
() + 16);

156 *
¥
 = (*è(
xp
->
	`d©a
() + 20);

157 *
dp
 = (*è(
xp
->
	`d©a
() + 22);

158 
¤c_pÜt
 = 
	`Áohs
(*
¥
);

159 
d¡_pÜt
 = 
	`Áohs
(*
dp
);

160 
	`şick_ch©‹r
("IP…ack‘ info: %s:%hu -> %s:%hu", 
¤c_
.
	`uÅ¬£
().
	`c_¡r
(), 
¤c_pÜt
, 
d¡_
.
	`s
().c_¡r(), 
d¡_pÜt
);

163 
	`nÙify_rou‹_cbs
(
·ck‘
, 
de¡_
, 
GRCB
::
Drİ
, GRCB::
NoClo£rNode
, 0);

164 
	`ouut
(1).
	`push
(
xp
);

166 
	}
}

169 
boŞ


170 
	gLookupGeog¿phicGridRou‹
::
	$g‘_Ãxt_geog¿phic_hİ
(
grid_loÿtiÚ
 
de¡_loc
, 
Eth”Add»ss
 *
de¡_‘h
,

171 
IPAdd»ss
 *
de¡_
, IPAdd»s *
be¡_nbr
,

172 *
Ãxt_hİ_š‹rçû
) const

181 
	`as£¹
(
_li
->
	`loc_good
());

182 
d
 = 
grid_loÿtiÚ
::
	`ÿlc_¿nge
(
de¡_loc
, 
_li
->
	`g‘_cu¼’t_loÿtiÚ
());

183 
boŞ
 
found_Úe
 = 
çl£
;

185 
VeùÜ
<
GridG’”icRou‹TabË
::
Rou‹EÁry
> 
¹es
;

186 
_¹
->
	`g‘_®l_’Œ›s
(
¹es
);

188 
GridG’”icRou‹TabË
::
Rou‹EÁry
 
be¡_nbr_’Œy
;

190 
i
 = 0; i < 
¹es
.
	`size
(); i++) {

191 cÚ¡ 
GridG’”icRou‹TabË
::
Rou‹EÁry
 &
¹e
 = 
¹es
[
i
];

192 ià(!
¹e
.
loc_good
)

194 
Ãw_d
 = 
grid_loÿtiÚ
::
	`ÿlc_¿nge
(
de¡_loc
, 
¹e
.dest_loc);

195 ià(!
found_Úe
) {

196 
found_Úe
 = 
Œue
;

197 
d
 = 
Ãw_d
;

198 
be¡_nbr_’Œy
 = 
¹e
;

200 ià(
Ãw_d
 < 
d
) {

201 
d
 = 
Ãw_d
;

202 
be¡_nbr_’Œy
 = 
¹e
;

206 ià(!
found_Úe
)

207  
çl£
;

220 *
de¡_‘h
 = 
be¡_nbr_’Œy
.
Ãxt_hİ_‘h
;

221 *
de¡_
 = 
be¡_nbr_’Œy
.
Ãxt_hİ_
;

222 *
Ãxt_hİ_š‹rçû
 = 
be¡_nbr_’Œy
.next_hop_interface;

223 *
be¡_nbr
 = 
be¡_nbr_’Œy
.
de¡_
;

225  
Œue
;

226 
	}
}

230 
	gLookupGeog¿phicGridRou‹
::
	$šüem’t_hİs_Œav–Ëd
(
Wr™abËPack‘
 *
p
) const

232 
grid_hdr
 *
gh
 = (grid_hd¸*è(
p
->
	`d©a
(è+ (
şick_‘h”
));

233 
grid_nbr_’ÿp
 *
’ÿp
 = 0;

234 
grid_geoÿ¡
 *
gc
 = 0;

236 
gh
->
ty³
) {

237 
grid_hdr
::
GRID_NBR_ENCAP
:

238 
grid_hdr
::
GRID_LOC_REPLY
:

239 
grid_hdr
::
GRID_ROUTE_PROBE
:

240 
grid_hdr
::
GRID_ROUTE_REPLY
:

241 
’ÿp
 = (
grid_nbr_’ÿp
 *è(
p
->
	`d©a
(è+ (
şick_‘h”
è+ 
gh
->
hdr_Ën
);

242 
’ÿp
->
hİs_Œav–Ëd
++;

244 
grid_hdr
::
GRID_GEOCAST
:

245 
gc
 = (
grid_geoÿ¡
 *è(
p
->
	`d©a
(è+ (
şick_‘h”
è+ 
gh
->
hdr_Ën
);

246 
gc
->
hİs_Œav–Ëd
++;

252 
	}
}

254 
boŞ


255 
	gLookupGeog¿phicGridRou‹
::
	$dÚt_fÜw¬d
(cÚ¡ 
Pack‘
 *
p
) const

257 
grid_hdr
 *
gh
 = (grid_hd¸*è(
p
->
	`d©a
(è+ (
şick_‘h”
));

258 
grid_nbr_’ÿp
 *
’ÿp
 = 0;

259 
grid_geoÿ¡
 *
gc
 = 0;

261 
gh
->
ty³
) {

262 
grid_hdr
::
GRID_NBR_ENCAP
:

263 
grid_hdr
::
GRID_LOC_REPLY
:

264 
grid_hdr
::
GRID_ROUTE_PROBE
:

265 
grid_hdr
::
GRID_ROUTE_REPLY
:

266 
’ÿp
 = (
grid_nbr_’ÿp
 *è(
p
->
	`d©a
(è+ (
şick_‘h”
è+ 
gh
->
hdr_Ën
);

267  
	`IPAdd»ss
(
’ÿp
->
d¡_
è=ğ
_addr
;

269 
grid_hdr
::
GRID_GEOCAST
:

270 
gc
 = (
grid_geoÿ¡
 *è(
p
->
	`d©a
(è+ (
şick_‘h”
è+ 
gh
->
hdr_Ën
);

271 
	`as£¹
(
_li
->
	`loc_good
());

272  
gc
->
d¡_»giÚ
.
	`cÚšs
(
_li
->
	`g‘_cu¼’t_loÿtiÚ
());

275  
Œue
;

278  
Œue
;

279 
	}
}

281 
boŞ


282 
	gLookupGeog¿phicGridRou‹
::
	$de¡_loc_good
(cÚ¡ 
Pack‘
 *
p
) const

284 
grid_hdr
 *
gh
 = (grid_hd¸*è(
p
->
	`d©a
(è+ (
şick_‘h”
));

286 
gh
->
ty³
) {

287 
grid_hdr
::
GRID_NBR_ENCAP
:

288 
grid_hdr
::
GRID_LOC_REPLY
:

289 
grid_hdr
::
GRID_ROUTE_PROBE
:

290 
grid_hdr
::
GRID_ROUTE_REPLY
: {

291 #iâdeà
SMALL_GRID_HEADERS


292 
grid_nbr_’ÿp
 *
’ÿp
 = (grid_nbr_’ÿ°*è(
p
->
	`d©a
(è+ (
şick_‘h”
è+ 
gh
->
hdr_Ën
);

293  
’ÿp
->
d¡_loc_good
;

295  
çl£
;

299 
grid_hdr
::
GRID_GEOCAST
:

300  
Œue
;

303  
çl£
;

306  
çl£
;

307 
	}
}

309 
grid_loÿtiÚ


310 
	gLookupGeog¿phicGridRou‹
::
	$g‘_de¡_loc
(cÚ¡ 
Pack‘
 *
p
) const

312 
grid_hdr
 *
gh
 = (grid_hd¸*è(
p
->
	`d©a
(è+ (
şick_‘h”
));

314 
gh
->
ty³
) {

315 
grid_hdr
::
GRID_NBR_ENCAP
:

316 
grid_hdr
::
GRID_LOC_REPLY
:

317 
grid_hdr
::
GRID_ROUTE_PROBE
:

318 
grid_hdr
::
GRID_ROUTE_REPLY
: {

319 #iâdeà
SMALL_GRID_HEADERS


320 
grid_nbr_’ÿp
 *
’ÿp
 = (grid_nbr_’ÿ°*è(
p
->
	`d©a
(è+ (
şick_‘h”
è+ 
gh
->
hdr_Ën
);

321  
’ÿp
->
d¡_loc
;

323  
	`grid_loÿtiÚ
(0, 0, 0);

327 
grid_hdr
::
GRID_GEOCAST
: {

328 
grid_geoÿ¡
 *
gc
 = (grid_geoÿ¡ *è(
p
->
	`d©a
(è+ (
şick_‘h”
è+ 
gh
->
hdr_Ën
);

329  
gc
->
d¡_»giÚ
.
	`ûÁ”
();

333 
	`as£¹
(0);

336  
	`grid_loÿtiÚ
(0, 0, 0);

337 
	}
}

347 
CLICK_ENDDECLS


348 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

349 
	`EXPORT_ELEMENT
(
LookupGeog¿phicGridRou‹
)

	@grid/lookupgeogridroute.hh

1 #iâdeà
GEOROUTE_HH


2 
	#GEOROUTE_HH


	)

38 
	~<şick/–em’t.hh
>

39 
	~<şick/glue.hh
>

40 
	~"grid.hh
"

41 
	~"gridrou‹cb.hh
"

42 
	~<şick/‘h”add»ss.hh
>

43 
	~<şick/add»ss.hh
>

44 
	~<şick/sk.hh
>

45 
CLICK_DECLS


47 
şass
 
	gGridG’”icRou‹TabË
;

48 
şass
 
	gGridLoÿtiÚInfo
;

50 
şass
 
	gLookupGeog¿phicGridRou‹
 : 
public
 
EËm’t
,…ubliø
	gGridRou‹AùÜ
 {

51 
	gpublic
:

53 
LookupGeog¿phicGridRou‹
(è
CLICK_COLD
;

54 ~
LookupGeog¿phicGridRou‹
(è
	gCLICK_COLD
;

56 cÚ¡ *
şass_Çme
() const {  "LookupGeographicGridRoute"; }

57 *
ÿ¡
(const *);

58 cÚ¡ *
pÜt_couÁ
() const {  "1/2"; }

59 cÚ¡ *
´oûssšg
(ècÚ¡ {  
	gPUSH
; }

61 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

62 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

64 
boŞ
 
run_sk
(
Task
 *);

66 
push
(
pÜt
, 
Pack‘
 *);

68 
	g´iv©e
:

70 
boŞ
 
g‘_Ãxt_geog¿phic_hİ
(
grid_loÿtiÚ
 
de¡_loc
, 
Eth”Add»ss
 *
de¡_‘h
,

71 
IPAdd»ss
 *
de¡_
, IPAdd»s *
be¡_nbr_
,

72 *
Ãxt_hİ_š‹rçû
) const;

74 
šüem’t_hİs_Œav–Ëd
(
Wr™abËPack‘
 *
p
) const;

75 
boŞ
 
dÚt_fÜw¬d
(cÚ¡ 
Pack‘
 *
p
) const;

76 
boŞ
 
de¡_loc_good
(cÚ¡ 
Pack‘
 *
p
) const;

77 
grid_loÿtiÚ
 
g‘_de¡_loc
(cÚ¡ 
Pack‘
 *
p
) const;

79 
GridG’”icRou‹TabË
 *
	g_¹
;

80 
GridLoÿtiÚInfo
 *
	g_li
;

81 
Eth”Add»ss
 
	g_‘haddr
;

82 
IPAdd»ss
 
	g_addr
;

83 
Task
 
	g_sk
;

86 
	gCLICK_ENDDECLS


	@grid/lookuplocalgridroute.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şickÃt/‘h”.h
>

22 
	~<şickÃt/.h
>

23 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

24 
	~<şick/rou‹r.hh
>

25 
	~<şick/glue.hh
>

27 
	~<–em’ts/grid/grid.hh
>

28 
	~<–em’ts/grid/gridg©ewayšfo.hh
>

29 
	~<–em’ts/grid/looku¶oÿlgridrou‹.hh
>

30 
	~<–em’ts/grid/lškŒack”.hh
>

31 
	~<–em’ts/grid/gridg’”iüt.hh
>

32 
	~<–em’ts/grid/gridg’”işogg”.hh
>

34 
CLICK_DECLS


36 
	gGridRou‹AùÜ
::
_Ãxt_ä“_cb
 = 0;

38 
	#NOISY
 0

	)

40 
	gLookupLoÿlGridRou‹
::
	$LookupLoÿlGridRou‹
()

41 : 
	`_gw_šfo
(0), 
	`_lšk_Œack”
(0), 
	`_¹es
(0),

42 
	`_ªy_g©eway_
(0), 
	`_sk
(
this
),

43 
	$_log
(0)

45 
	}
}

47 
	gLookupLoÿlGridRou‹
::~
	$LookupLoÿlGridRou‹
()

49 
	}
}

52 
LookupLoÿlGridRou‹
::
	$ÿ¡
(cÚ¡ *
n
)

54 ià(
	`¡rcmp
(
n
, "LookupLocalGridRoute") == 0)

55  (
LookupLoÿlGridRou‹
 *)
this
;

58 
	}
}

61 
	gLookupLoÿlGridRou‹
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

63 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

64 .
»ad_mp
("ETH", 
_‘haddr
)

65 .
»ad_mp
("IP", 
_addr
)

66 .
»ad_mp
("GRIDROUTES", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_¹es
))

67 .
»ad
("GWI", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_gw_šfo
))

68 .
»ad
("LT", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_lšk_Œack”
))

69 .
»ad
("LOG", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_log
))

70 .
com¶‘e
();

71 
	g_ªy_g©eway_
 = 
htÚl
((
Áohl
(
_addr
.
addr
()) & 0xFFffFF00) | 254);

72  
	g»s
;

76 
	gLookupLoÿlGridRou‹
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

79 ià(
_¹es
 && _¹es->
	`ÿ¡
("GridGenericRouteTable") == 0) {

80  
”rh
->
	`”rÜ
("%s: GridRouteTable‡rgument %s hashe wrongype",

81 
	`Çme
().
	`c_¡r
(),

82 
_¹es
->
	`Çme
().
	`c_¡r
());

85 ià(
_¹es
 == 0) {

86  
”rh
->
	`”rÜ
("%s:‚o GridRouteTableƒlement given",

87 
	`Çme
().
	`c_¡r
());

91 ià(
_gw_šfo
 && _gw_šfo->
	`ÿ¡
("GridGatewayInfo") == 0) {

92  
”rh
->
	`”rÜ
("%s: GridGatewayInfo‡rgument %s hashe wrongype",

93 
	`Çme
().
	`c_¡r
(),

94 
_gw_šfo
->
	`Çme
().
	`c_¡r
());

97 ià(
_lšk_Œack”
 && _lšk_Œack”->
	`ÿ¡
("LinkTracker") == 0) {

98  
”rh
->
	`”rÜ
("%s: LinkTracker‡rgument %s hashe wrongype",

99 
	`Çme
().
	`c_¡r
(),

100 
_lšk_Œack”
->
	`Çme
().
	`c_¡r
());

103 ià(
_log
 && _log->
	`ÿ¡
("GridGenericLogger") == 0) {

104  
”rh
->
	`”rÜ
("%s: GridGenericLoggerƒlement %s hashe wrongype",

105 
	`Çme
().
	`c_¡r
(),

106 
_log
->
	`Çme
().
	`c_¡r
());

109 ià(
	`šput_is_puÎ
(0))

110 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

112 
	}
}

114 
boŞ


115 
	gLookupLoÿlGridRou‹
::
	$run_sk
(
Task
 *)

117 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

118 ià(
p
)

119 
	`push
(0, 
p
);

120 
_sk
.
	`ç¡_»scheduË
();

121  
p
 != 0;

122 
	}
}

124 
boŞ


125 
	gLookupLoÿlGridRou‹
::
	$is_gw
()

127  
_gw_šfo
 && _gw_šfo->
	`is_g©eway
();

128 
	}
}

131 
GridRou‹AùiÚC®lback
 
	tGRCB
;

134 
	gLookupLoÿlGridRou‹
::
	$push
(
pÜt
, 
Pack‘
 *
·ck‘
)

141 
	`as£¹
(
·ck‘
);

143 ià(
pÜt
 == 0) {

147 
grid_hdr
 *
gh
 = (grid_hd¸*è(
·ck‘
->
	`d©a
(è+ (
şick_‘h”
));

148 
gh
->
ty³
) {

150 
grid_hdr
::
GRID_NBR_ENCAP
:

151 
grid_hdr
::
GRID_LOC_REPLY
:

152 
grid_hdr
::
GRID_ROUTE_PROBE
:

153 
grid_hdr
::
GRID_ROUTE_REPLY
:

158 
grid_nbr_’ÿp
 *
’ÿp
 = (grid_nbr_’ÿ°*è(
·ck‘
->
	`d©a
(è+ (
şick_‘h”
è+ 
gh
->
hdr_Ën
);

159 
IPAdd»ss
 
	`de¡_
(
’ÿp
->
d¡_
);

160 #ià
NOISY


161 
	`şick_ch©‹r
("lr %s: got %s…acket for %s; I‡m %s;‡gi=%s, is_gw = %d\n",

162 
	`Çme
().
	`c_¡r
(),

163 
grid_hdr
::
	`ty³_¡ršg
(
gh
->
ty³
).
	`c_¡r
(),

164 
de¡_
.
	`uÅ¬£
().
	`c_¡r
(),

165 
_addr
.
	`uÅ¬£
().
	`c_¡r
(),

166 
_ªy_g©eway_
.
	`uÅ¬£
().
	`c_¡r
(),

167 
	`is_gw
() ? 1 : 0);

170 ià((
de¡_
 =ğ
_addr
) ||

171 (
de¡_
 =ğ
_ªy_g©eway_
 && 
	`is_gw
())) {

173 ià(
gh
->
ty³
 =ğ
grid_hdr
::
GRID_NBR_ENCAP
) {

174 #ià
NOISY


175 
	`şick_ch©‹r
("%s: got‡n IP…acket for us %s",

176 
	`Çme
().
	`c_¡r
(),

177 
de¡_
.
	`uÅ¬£
().
	`c_¡r
());

179 
·ck‘
->
	`puÎ
((
şick_‘h”
è+ 
gh
->
hdr_Ën
 + (
grid_nbr_’ÿp
));

180 
	`nÙify_rou‹_cbs
(
·ck‘
, 
de¡_
, 
GRCB
::
S’dToIP
, 0, 0);

181 
	`ouut
(1).
	`push
(
·ck‘
);

184 
	`şick_ch©‹r
("%s: got %s…acket for us, but don't know howo handle it",

185 
	`Çme
().
	`c_¡r
(), 
grid_hdr
::
	`ty³_¡ršg
(
gh
->
ty³
).c_str());

189 
	`fÜw¬d_grid_·ck‘
(
·ck‘
, 
’ÿp
->
d¡_
);

195 
	`şick_ch©‹r
("%s:„eceived unexpected Grid…acketype: %s",

196 
	`Çme
().
	`c_¡r
(), 
grid_hdr
::
	`ty³_¡ršg
(
gh
->
ty³
).c_str());

197 
	`nÙify_rou‹_cbs
(
·ck‘
, 0, 
GRCB
::
Drİ
, GRCB::
UnknownTy³
, 0);

198 
	`ouut
(3).
	`push
(
·ck‘
);

206 
	`as£¹
(
pÜt
 == 1);

208 
IPAdd»ss
 
d¡
 = 
·ck‘
->
	`d¡__ªno
();

209 #ià
NOISY


210 
	`şick_ch©‹r
("lr %s: got…acket for %s; I‡m %s;‡gi=%s, is_gw=%d\n",

211 
	`Çme
().
	`c_¡r
(),

212 
d¡
.
	`uÅ¬£
().
	`c_¡r
(),

213 
_addr
.
	`uÅ¬£
().
	`c_¡r
(),

214 
_ªy_g©eway_
.
	`uÅ¬£
().
	`c_¡r
(),

215 
	`is_gw
() ? 1 : 0);

217 ià(
d¡
 =ğ
_ªy_g©eway_
 && 
	`is_gw
()) {

218 
·ck‘
->
	`kl
();

219 } ià(
d¡
 =ğ
_addr
) {

220 
	`şick_ch©‹r
("%s: gÙ IP…ack‘ from u fÜ ou¸add»ss;†oİšg iˆback. CheckhcÚfigu¿tiÚ.", 
	`Çme
().
	`c_¡r
());

221 
	`ouut
(1).
	`push
(
·ck‘
);

225 
Wr™abËPack‘
 *
Ãw_·ck‘
 = 
·ck‘
->
	`push
((
şick_‘h”
è+ (
grid_hdr
è+ (
grid_nbr_’ÿp
));

226 
	`mem£t
(
Ãw_·ck‘
->
	`d©a
(), 0, (
şick_‘h”
è+ (
grid_hdr
è+ (
grid_nbr_’ÿp
));

228 
şick_‘h”
 *
eh
 = (şick_‘h” *è
Ãw_·ck‘
->
	`d©a
();

229 
eh
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_GRID
);

231 
grid_hdr
 *
gh
 = (grid_hd¸*è(
Ãw_·ck‘
->
	`d©a
(è+ (
şick_‘h”
));

232 
gh
->
hdr_Ën
 = (
grid_hdr
);

233 
gh
->
tÙ®_Ën
 = 
Ãw_·ck‘
->
	`Ëngth
(è- (
şick_‘h”
);

234 
gh
->
tÙ®_Ën
 = 
	`htÚs
(gh->total_len);

235 
gh
->
ty³
 = 
grid_hdr
::
GRID_NBR_ENCAP
;

240 
gh
->

 = 
_addr
;

242 
grid_nbr_’ÿp
 *
’ÿp
 = (grid_nbr_’ÿ°*è(
Ãw_·ck‘
->
	`d©a
(è+ (
şick_‘h”
è+ (
grid_hdr
));

243 
’ÿp
->
hİs_Œav–Ëd
 = 0;

244 
’ÿp
->
d¡_
 = 
d¡
;

246 #iâdeà
SMALL_GRID_HEADERS


247 
’ÿp
->
d¡_loc_good
 = 
çl£
;

249 
	`fÜw¬d_grid_·ck‘
(
Ãw_·ck‘
, 
d¡
);

252 
	}
}

254 
boŞ


255 
	gLookupLoÿlGridRou‹
::
	$g‘_Ãxt_hİ
(
IPAdd»ss
 
de¡_
, 
Eth”Add»ss
 *
de¡_‘h
,

256 
IPAdd»ss
 *
Ãxt_hİ_
, *
Ãxt_hİ_š‹rçû
) const

258 
	`as£¹
(
de¡_‘h
 != 0);

260 
GridG’”icRou‹TabË
::
Rou‹EÁry
 
¹e
;

261 
boŞ
 
found_rou‹
;

263 ià(
de¡_
 =ğ
_ªy_g©eway_
) {

265 
found_rou‹
 = 
_¹es
->
	`cu¼’t_g©eway
(
¹e
);

275 
found_rou‹
 = 
_¹es
->
	`g‘_Úe_’Œy
(
de¡_
, 
¹e
);

279 ià(
found_rou‹
 && 
¹e
.
	`good
()) {

280 *
de¡_‘h
 = 
¹e
.
Ãxt_hİ_‘h
;

281 *
Ãxt_hİ_
 = 
¹e
.next_hop_ip;

282 *
Ãxt_hİ_š‹rçû
 = 
¹e
.next_hop_interface;

283  
Œue
;

286  
çl£
;

287 
	}
}

291 
	gLookupLoÿlGridRou‹
::
	$fÜw¬d_grid_·ck‘
(
Pack‘
 *
xp
, 
IPAdd»ss
 
de¡_
)

293 
Wr™abËPack‘
 *
·ck‘
 = 
xp
->
	`uniqueify
();

308 ià(
_¹es
 == 0) {

310 
	`şick_ch©‹r
("%s: cª'ˆfÜw¬d…ack‘ fÜ %s;h”i nØroutšgabË,ryšg geog¿phiøfÜw¬dšg", 
	`Çme
().
	`c_¡r
(), 
de¡_
.
	`uÅ¬£
().c_str());

311 
	`nÙify_rou‹_cbs
(
·ck‘
, 
de¡_
, 
GRCB
::
F®lbackToGF
, 0, 0);

312 
	`ouut
(2).
	`push
(
·ck‘
);

316 
grid_nbr_’ÿp
 *
’ÿp
 = (grid_nbr_’ÿ°*è(
·ck‘
->
	`d©a
(è+ (
şick_‘h”
è+ (
grid_hdr
));

318 
Eth”Add»ss
 
Ãxt_hİ_‘h
;

319 
IPAdd»ss
 
Ãxt_hİ_
;

320 
Ãxt_hİ_š‹rçû
 = 0;

321 
boŞ
 
found_Ãxt_hİ
 = 
	`g‘_Ãxt_hİ
(
de¡_
, &
Ãxt_hİ_‘h
, &
Ãxt_hİ_
, &
Ãxt_hİ_š‹rçû
);

323 ià(
found_Ãxt_hİ
) {

324 
şick_‘h”
 *
eh
 = (şick_‘h” *è
·ck‘
->
	`d©a
();

325 
	`memıy
(
eh
->
‘h”_sho¡
, 
_‘haddr
.
	`d©a
(), 6);

326 
	`memıy
(
eh
->
‘h”_dho¡
, 
Ãxt_hİ_‘h
.
	`d©a
(), 6);

327 
grid_hdr
 *
gh
 = (grid_hd¸*è(
·ck‘
->
	`d©a
(è+ (
şick_‘h”
));

328 
gh
->
tx_
 = 
_addr
;

329 
’ÿp
->
hİs_Œav–Ëd
++;

331 
sig
 = 0;

332 
qu®
 = 0;

333 
Time¡amp
 
tv
;

334 #ifdeà
CLICK_USERLEVEL


335 ià(
_lšk_Œack”
)

336 
_lšk_Œack”
->
	`g‘_¡©
(
Ãxt_hİ_
, 
sig
, 
qu®
, 
tv
);

338 
d©a2
 = (
qu®
 << 16è| ((-
sig
) & 0xFFff);

339 
	`nÙify_rou‹_cbs
(
·ck‘
, 
de¡_
, 
GRCB
::
FÜw¬dDSDV
, 
Ãxt_hİ_
, 
d©a2
);

340 
	`SET_PAINT_ANNO
(
·ck‘
, 
Ãxt_hİ_š‹rçû
);

341 
	`ouut
(0).
	`push
(
·ck‘
);

344 #ià
NOISY


345 
	`şick_ch©‹r
("%s: uÇbËØfÜw¬d…ack‘ fÜ % w™h†oÿÈroutšg,ryšg geog¿phiøroutšg", 
	`Çme
().
	`c_¡r
(), 
de¡_
.
	`uÅ¬£
().c_str());

349 
	`nÙify_rou‹_cbs
(
·ck‘
, 
de¡_
, 
GRCB
::
F®lbackToGF
, 0, 0);

351 ià(
_log
)

352 
_log
->
	`log_no_rou‹
(
·ck‘
, 
Time¡amp
::
	`now
());

354 
	`ouut
(2).
	`push
(
·ck‘
);

356 
	}
}

358 
CLICK_ENDDECLS


360 
EXPORT_ELEMENT
(
LookupLoÿlGridRou‹
)

	@grid/lookuplocalgridroute.hh

1 #iâdeà
LOCALROUTE_HH


2 
	#LOCALROUTE_HH


	)

55 
	~<şick/–em’t.hh
>

56 
	~<şick/glue.hh
>

57 
	~<şick/‘h”add»ss.hh
>

58 
	~<şick/add»ss.hh
>

59 
	~<şick/sk.hh
>

61 
	~<–em’ts/grid/gridrou‹cb.hh
>

62 
CLICK_DECLS


64 
şass
 
	gGridG©ewayInfo
;

65 
şass
 
	gLškT¿ck”
;

66 
şass
 
	gGridG’”icLogg”
;

67 
şass
 
	gGridG’”icRou‹TabË
;

69 
şass
 
	gLookupLoÿlGridRou‹
 : 
public
 
EËm’t
,…ubliø
	gGridRou‹AùÜ
 {

70 
	gpublic
:

72 
LookupLoÿlGridRou‹
(è
CLICK_COLD
;

73 ~
LookupLoÿlGridRou‹
(è
	gCLICK_COLD
;

75 cÚ¡ *
şass_Çme
() const {  "LookupLocalGridRoute"; }

76 *
ÿ¡
(const *);

77 cÚ¡ *
pÜt_couÁ
() const {  "2/4"; }

78 cÚ¡ *
´oûssšg
(ècÚ¡ {  
	gPUSH
; }

80 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

81 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

83 
boŞ
 
run_sk
(
Task
 *);

85 
push
(
pÜt
, 
Pack‘
 *);

87 
	g´iv©e
:

89 
boŞ
 
g‘_Ãxt_hİ
(
IPAdd»ss
 
de¡_
, 
Eth”Add»ss
 *
de¡_‘h
,

90 
IPAdd»ss
 *
Ãxt_hİ_
, *
Ãxt_hİ_š‹rçû
) const;

91 
fÜw¬d_grid_·ck‘
(
Pack‘
 *
·ck‘
, 
IPAdd»ss
 
de¡_
);

93 
GridG©ewayInfo
 *
	g_gw_šfo
;

94 
LškT¿ck”
 *
	g_lšk_Œack”
;

95 
GridG’”icRou‹TabË
 *
	g_¹es
;

96 
Eth”Add»ss
 
	g_‘haddr
;

97 
IPAdd»ss
 
	g_addr
;

98 
IPAdd»ss
 
	g_ªy_g©eway_
;

99 
Task
 
	g_sk
;

101 
GridG’”icLogg”
 *
	g_log
;

103 
boŞ
 
is_gw
();

106 
	gCLICK_ENDDECLS


	@grid/lookuplocalgridroute2.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şickÃt/‘h”.h
>

22 
	~<şickÃt/.h
>

23 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

24 
	~<şick/rou‹r.hh
>

25 
	~<şick/glue.hh
>

27 
	~<–em’ts/grid/grid.hh
>

28 
	~<–em’ts/grid/looku¶oÿlgridrou‹2.hh
>

29 
	~<–em’ts/grid/gridg’”iüt.hh
>

30 
	~<–em’ts/grid/gridg’”işogg”.hh
>

32 
CLICK_DECLS


34 
	gLookupLoÿlGridRou‹2
::
	$LookupLoÿlGridRou‹2
()

35 : 
	`_¹es
(0), 
	`_log
(0), 
	$_v”bo£
(
çl£
)

37 
	}
}

39 
	gLookupLoÿlGridRou‹2
::~
	$LookupLoÿlGridRou‹2
()

41 
	}
}

44 
LookupLoÿlGridRou‹2
::
	$ÿ¡
(cÚ¡ *
n
)

46 ià(
	`¡rcmp
(
n
, "LookupLocalGridRoute2") == 0)

47  (
LookupLoÿlGridRou‹2
 *)
this
;

50 
	}
}

53 
	gLookupLoÿlGridRou‹2
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

55  
Args
(
cÚf
, 
this
, 
”rh
)

56 .
»ad_mp
("ETH", 
_‘h
)

57 .
»ad_mp
("IP", 
_
)

58 .
»ad_p
("GRIDROUTES", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_¹es
))

59 .
»ad
("LOG", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_log
))

60 .
»ad
("VERBOSE", 
_v”bo£
)

61 .
com¶‘e
();

65 
	gLookupLoÿlGridRou‹2
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

68 ià(
_¹es
 && _¹es->
	`ÿ¡
("GridGenericRouteTable") == 0) {

69  
”rh
->
	`”rÜ
("%s: GridRouteTable‡rgument %s hashe wrongype",

70 
	`Çme
().
	`c_¡r
(),

71 
_¹es
->
	`Çme
().
	`c_¡r
());

74 ià(
_¹es
 == 0) {

75  
”rh
->
	`”rÜ
("%s:‚o GridRouteTableƒlement given",

76 
	`Çme
().
	`c_¡r
());

80 ià(
_log
 && _log->
	`ÿ¡
("GridGenericLogger") == 0) {

81  
”rh
->
	`”rÜ
("%s: GridGenericLoggerƒlement %s hashe wrongype",

82 
	`Çme
().
	`c_¡r
(),

83 
_log
->
	`Çme
().
	`c_¡r
());

86 
	}
}

88 
GridRou‹AùiÚC®lback
 
	tGRCB
;

90 
Pack‘
 *

91 
	gLookupLoÿlGridRou‹2
::
	$sim¶e_aùiÚ
(
Pack‘
 *
·ck‘
)

93 
	`as£¹
(
·ck‘
);

94 ià(
·ck‘
->
	`Ëngth
(è< (
şick_‘h”
è+ (
grid_hdr
è+ (
grid_nbr_’ÿp
)) {

95 
	`şick_ch©‹r
("LookupLocalGridRoute2 %s:…acketoo small (%d), dropping",

96 
	`Çme
().
	`c_¡r
(), 
·ck‘
->
	`Ëngth
());

97 
	`nÙify_rou‹_cbs
(
·ck‘
,…ack‘->
	`d¡__ªno
(), 
GRCB
::
Drİ
, GRCB::
BadPack‘
, 0);

98 
·ck‘
->
	`kl
();

102 
grid_hdr
 *
gh
 = (grid_hd¸*è(
·ck‘
->
	`d©a
(è+ (
şick_‘h”
));

103 
gh
->
ty³
) {

104 
grid_hdr
::
GRID_NBR_ENCAP
:

105 
grid_hdr
::
GRID_LOC_REPLY
:

106 
grid_hdr
::
GRID_ROUTE_PROBE
:

107 
grid_hdr
::
GRID_ROUTE_REPLY
:

108  
	`fÜw¬d_grid_·ck‘
(
·ck‘
,…ack‘->
	`d¡__ªno
());

111 
	`şick_ch©‹r
("LookupLocalGridRoute2 %s:„eceived unexpected Grid…acketype (%s), dropping",

112 
	`Çme
().
	`c_¡r
(), 
grid_hdr
::
	`ty³_¡ršg
(
gh
->
ty³
).c_str());

113 
	`nÙify_rou‹_cbs
(
·ck‘
,…ack‘->
	`d¡__ªno
(), 
GRCB
::
Drİ
, GRCB::
UnknownTy³
, 0);

114 
·ck‘
->
	`kl
();

117 
	}
}

120 
Pack‘
 *

121 
	gLookupLoÿlGridRou‹2
::
	$fÜw¬d_grid_·ck‘
(
Pack‘
 *
xp
, 
IPAdd»ss
 
de¡_
)

123 
Wr™abËPack‘
 *
·ck‘
 = 
xp
->
	`uniqueify
();

125 ià(
_¹es
 == 0) {

126 
	`şick_ch©‹r
("LookupLoÿlGridRou‹2 %s:h”i nØroutšgabË, drİpšg", 
	`Çme
().
	`c_¡r
());

127 
	`nÙify_rou‹_cbs
(
·ck‘
, 
de¡_
, 
GRCB
::
Drİ
, GRCB::
CÚfigE¼Ü
, 0);

128 
·ck‘
->
	`kl
();

132 
GridG’”icRou‹TabË
::
Rou‹EÁry
 
¹e
;

133 ià(
_¹es
->
	`g‘_Úe_’Œy
(
de¡_
, 
¹e
)) {

135 
şick_‘h”
 *
eh
 = (şick_‘h” *è
·ck‘
->
	`d©a
();

136 
	`memıy
(
eh
->
‘h”_dho¡
, 
¹e
.
Ãxt_hİ_‘h
.
	`d©a
(), 6);

137 
	`memıy
(
eh
->
‘h”_sho¡
, 
_‘h
.
	`d©a
(), 6);

139 
grid_hdr
 *
gh
 = (grid_hd¸*è(
eh
 + 1);

140 
gh
->
tx_
 = 
_
.
	`addr
();

142 
grid_nbr_’ÿp
 *
’ÿp
 = (grid_nbr_’ÿ°*è(
gh
 + 1);

143 
’ÿp
->
hİs_Œav–Ëd
++;

145 
	`SET_PAINT_ANNO
(
·ck‘
, 
¹e
.
Ãxt_hİ_š‹rçû
);

146  
·ck‘
;

151 ià(
_v”bo£
)

152 
	`şick_ch©‹r
("LookupLoÿlGridRou‹2 %s:‚Ørou‹Ø%s, drİpšg", 
	`Çme
().
	`c_¡r
(), 
de¡_
.
	`uÅ¬£
().c_str());

154 
	`nÙify_rou‹_cbs
(
·ck‘
, 
de¡_
, 
GRCB
::
Drİ
, GRCB::
NoLoÿlRou‹
, 0);

156 ià(
_log
)

157 
_log
->
	`log_no_rou‹
(
·ck‘
, 
Time¡amp
::
	`now
());

159 
·ck‘
->
	`kl
();

162 
	}
}

164 
CLICK_ENDDECLS


166 
EXPORT_ELEMENT
(
LookupLoÿlGridRou‹2
)

	@grid/lookuplocalgridroute2.hh

1 #iâdeà
LOCALROUTE2_HH


2 
	#LOCALROUTE2_HH


	)

45 
	~<şick/–em’t.hh
>

46 
	~<şick/glue.hh
>

47 
	~<şick/‘h”add»ss.hh
>

48 
	~<şick/add»ss.hh
>

49 
	~<şick/sk.hh
>

50 
	~<–em’ts/grid/gridrou‹cb.hh
>

51 
CLICK_DECLS


53 
şass
 
	gGridG’”icLogg”
;

54 
şass
 
	gGridG’”icRou‹TabË
;

56 
şass
 
	gLookupLoÿlGridRou‹2
 : 
public
 
EËm’t
,…ubliø
	gGridRou‹AùÜ
 {

58 
	gpublic
:

60 
LookupLoÿlGridRou‹2
();

61 ~
LookupLoÿlGridRou‹2
();

63 cÚ¡ *
şass_Çme
() const {  "LookupLocalGridRoute2"; }

64 *
ÿ¡
(const *);

65 cÚ¡ *
pÜt_couÁ
(ècÚ¡ {  
	gPORTS_1_1
; }

66 cÚ¡ *
´oûssšg
(ècÚ¡ {  
	gAGNOSTIC
; }

68 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

69 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

71 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

73 
	g´iv©e
:

75 
Pack‘
 *
fÜw¬d_grid_·ck‘
(Pack‘ *
·ck‘
, 
IPAdd»ss
 
de¡_
);

77 
GridG’”icRou‹TabË
 *
	g_¹es
;

78 
GridG’”icLogg”
 *
	g_log
;

79 
Eth”Add»ss
 
	g_‘h
;

80 
IPAdd»ss
 
	g_
;

81 
boŞ
 
	g_v”bo£
;

84 
	gCLICK_ENDDECLS


	@grid/lrhello.cc

18 
	~<şick/cÚfig.h
>

19 
	~"Ìh–lo.hh
"

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~"grid.hh
"

25 
CLICK_DECLS


27 
	gS’dGridLRH–lo
::
	$S’dGridLRH–lo
()

28 : 
	`_tim”
(
this
), 
	`_nbr
(0), 
	$_hİs
(1)

30 
	}
}

32 
	gS’dGridLRH–lo
::~
	$S’dGridLRH–lo
()

34 
	}
}

37 
S’dGridLRH–lo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad_mp
("PERIOD", 
_³riod
)

41 .
»ad_mp
("JITTER", 
_j™‹r
)

42 .
»ad_mp
("ETH", 
_äom_‘h
)

43 .
»ad_mp
("IP", 
_äom_
)

44 .
»ad_mp
("UPDATEROUTES", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_nbr
))

45 .
»ad_p
("MAXHOPS", 
_hİs
)

46 .
com¶‘e
();

47 ià(
	g»s
 < 0)

48  
	g»s
;

50 ià(
	g_³riod
 <= 0)

51  
”rh
->
”rÜ
("period must be greaterhan 0");

52 ià(
	g_j™‹r
 < 0)

53  
	g”rh
->
”rÜ
("period must be…ositive");

54 ià(
	g_j™‹r
 > 
	g_³riod
)

55  
	g”rh
->
”rÜ
("jitter is biggerhan…eriod");

56 ià(
	g_hİs
 < 0)

57  
	g”rh
->
”rÜ
("max hops must be greaterhan 0");

58  
	g»s
;

62 
	gS’dGridLRH–lo
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

64 
_tim”
.
	`š™Ÿlize
(
this
);

65 
_tim”
.
	`scheduË_aá”_m£c
(
_³riod
);

67 if(
_nbr
 && _nbr->
	`ÿ¡
("UpdateLocalGridRoutes") == 0){

68 
”rh
->
	`w¬nšg
("%s: UpdateLocalGridRoutes‡rgument %s hashe wrongype",

69 
	`Çme
().
	`c_¡r
(),

70 
_nbr
->
	`Çme
().
	`c_¡r
());

71 
_nbr
 = 0;

72 } ià(
_nbr
 == 0) {

73 
”rh
->
	`w¬nšg
("%s:‚o UpdateLocalGridRoutesƒlement given",

74 
	`Çme
().
	`c_¡r
());

78 
	}
}

81 
	gS’dGridLRH–lo
::
	$run_tim”
(
Tim”
 *)

83 
	`ouut
(0).
	`push
(
	`make_h–lo
());

87 
ušt32_t
 
r2
 = 
	`şick_¿ndom
();

88 
r
 = (è(
r2
 >> 1);

89 
j™‹r
 = (è(((è
_j™‹r
è* 
r
 / (() 0x7FffFFff));

90 ià(
r2
 & 1)

91 
j™‹r
 *= -1;

92 
_tim”
.
	`scheduË_aá”_m£c
(
_³riod
 + (è
j™‹r
);

93 
	}
}

95 
Pack‘
 *

96 
	gS’dGridLRH–lo
::
	$make_h–lo
()

98 
psz
 = (
şick_‘h”
è+ (
grid_hdr
è+ (
grid_h–lo
);

99 
num_nbrs
 = 0;

100 
VeùÜ
<
grid_nbr_’Œy
> 
nbrs
;

101 ià(
_nbr
) {

102 
_nbr
->
	`g‘_¹es
(&
nbrs
);

104 
i
 = 0; i < 
nbrs
.
	`size
(); i++)

105 ià(
nbrs
[
i
].
num_hİs
 <ğ
_hİs
)

106 
num_nbrs
++;

107 
psz
 +ğ(
grid_nbr_’Œy
è* 
num_nbrs
;

110 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
psz
 + 2);

111 ià(
p
 == 0) {

112 
	`şick_ch©‹r
("š %s: cªnÙ mak·ck‘!", 
	`Çme
().
	`c_¡r
());

113 
	`as£¹
(0);

115 
	`ASSERT_4ALIGNED
(
p
->
	`d©a
());

116 
p
->
	`puÎ
(2);

117 
	`mem£t
(
p
->
	`d©a
(), 0,…->
	`Ëngth
());

119 
p
->
	`£t_time¡amp_ªno
(
Time¡amp
::
	`now
());

121 
şick_‘h”
 *
eh
 = (şick_‘h” *è
p
->
	`d©a
();

122 
	`mem£t
(
eh
->
‘h”_dho¡
, 0xff, 6);

123 
eh
->
‘h”_ty³
 = 
	`htÚs
(
ETHERTYPE_GRID
);

124 
	`memıy
(
eh
->
‘h”_sho¡
, 
_äom_‘h
.
	`d©a
(), 6);

126 
grid_hdr
 *
gh
 = (grid_hd¸*è(
p
->
	`d©a
(è+ (
şick_‘h”
));

127 
gh
->
hdr_Ën
 = (
grid_hdr
);

128 
gh
->
tÙ®_Ën
 = 
psz
 - (
şick_‘h”
);

129 
gh
->
tÙ®_Ën
 = 
	`htÚs
(gh->total_len);

130 
gh
->
ty³
 = 
grid_hdr
::
GRID_LR_HELLO
;

131 
gh
->

 = gh->
tx_
 = 
_äom_
;

132 
grid_h–lo
 *
hlo
 = (grid_h–lØ*è(
p
->
	`d©a
(è+ (
şick_‘h”
è+ (
grid_hdr
));

133 
	`as£¹
(
num_nbrs
 <= 255);

134 
hlo
->
num_nbrs
 = ()‚um_nbrs;

135 
	`şick_ch©‹r
("num_nbrs = %d , _hops = %d,‚brs.size() = %d",

136 
num_nbrs
, 
_hİs
, 
nbrs
.
	`size
());

137 
hlo
->
nbr_’Œy_sz
 = (
grid_nbr_’Œy
);

139 
grid_nbr_’Œy
 *
cu¼
 = (grid_nbr_’Œy *è(
p
->
	`d©a
(è+ (
şick_‘h”
) +

140 (
grid_hdr
è+ (
grid_h–lo
));

141 
i
 = 0; i < 
nbrs
.
	`size
(); i++) {

143 ià(
nbrs
[
i
].
num_hİs
 <ğ
_hİs
) {

144 
	`memıy
(
cu¼
, &
nbrs
[
i
], (
grid_nbr_’Œy
));

145 
cu¼
++;

149  
p
;

150 
	}
}

152 
CLICK_ENDDECLS


153 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

154 
	`EXPORT_ELEMENT
(
S’dGridLRH–lo
)

	@grid/lrhello.hh

1 #iâdeà
LRHELLO_HH


2 
	#LRHELLO_HH


	)

25 
	~<şick/–em’t.hh
>

26 
	~<şick/tim”.hh
>

27 
	~<şick/‘h”add»ss.hh
>

28 
	~<şick/add»ss.hh
>

29 
	~"upd©”ou‹s.hh
"

30 
CLICK_DECLS


32 şas 
	cS’dGridLRH–lo
 : 
public
 
EËm’t
 {

34 
public
:

36 
	$S’dGridLRH–lo
(è
CLICK_COLD
;

37 ~
	$S’dGridLRH–lo
(è
CLICK_COLD
;

39 cÚ¡ *
	$şass_Çme
() const {  "SendGridLRHello"; }

40 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

41 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

43 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

44 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

46 
Pack‘
 *
	`make_h–lo
();

48 
	`run_tim”
(
Tim”
 *);

50 
´iv©e
:

52 
Eth”Add»ss
 
_äom_‘h
;

53 
IPAdd»ss
 
_äom_
;

54 
_³riod
;

55 
_j™‹r
;

56 
Tim”
 
_tim”
;

57 
Upd©eGridRou‹s
 *
_nbr
;

58 
_hİs
;

59 
	}
};

61 
	gCLICK_ENDDECLS


	@grid/movesim.cc

19 
	~<şick/cÚfig.h
>

20 
	~"movesim.hh
"

21 
	~<şick/glue.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/”rÜ.hh
>

25 
CLICK_DECLS


27 
	gMovem’tSimuÏtÜ
::
	$Movem’tSimuÏtÜ
()

28 : 
	$_ev’t_tim”
(
ev’t_hook
, 
this
)

30 
_ev’ts
 = 
Ãw
 
ev’t_’Œy
;

31 
_ev’ts
->
Ãxt
 = _events;

32 
	}
}

34 
	gMovem’tSimuÏtÜ
::~
	$Movem’tSimuÏtÜ
()

36 
ev’t_’Œy
 *
cur
 = 
_ev’ts
->
Ãxt
;

37 
ev’t_’Œy
 *
Ãxt
;

38 
cur
 !ğ
_ev’ts
) {

39 
Ãxt
 = 
cur
->next;

40 
d–‘e
 
cur
;

41 
cur
 = 
Ãxt
;

43 
d–‘e
 
_ev’ts
;

44 
	}
}

47 
	gMovem’tSimuÏtÜ
::
»ad_¬gs
(cÚ¡ 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

49 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

50 
	gt
;

51 
	gšt_vÏt
, 
	gšt_vlÚ
;

52 
EËm’t
 *
	g–
 = 0;

53 ià(
Args
(
this
, 
”rh
).
push_back_wÜds
(
cÚf
[
i
])

54 .
»ad_mp
("INTERVAL", 
t
)

55 .
»ad_mp
("LOCINFO", 
–
)

56 .
»ad_mp
("LATITUDE", 
Decim®FixedPoštArg
(7), 
št_vÏt
)

57 .
»ad_mp
("LONGITUDE", 
Decim®FixedPoštArg
(7), 
št_vlÚ
)

58 .
com¶‘e
() < 0)

60 
GridLoÿtiÚInfo
 *
	gli
 = (GridLoÿtiÚInfØ*)
–
->
ÿ¡
("GridLocationInfo");

61 ià(!
	gli
)

62  
	g”rh
->
”rÜ
("–em’ˆi nÙ‡ GridLoÿtiÚInfØšƒÁry %d", 
i
);

64 
ev’t_’Œy
 *
	gÃw_’Œy
;

65 
ev’t_’Œy
 *
	g´ev
;

66 
boŞ
 
	gu£_´ev
 = 
fšd_’Œy
(
t
, &
´ev
);

67 ià(
	gu£_´ev
) {

68 
	gÃw_’Œy
 = 
´ev
;

69 
as£¹
(
´ev
->
t
 ==);

72 
	gÃw_’Œy
 = 
Ãw
 
ev’t_’Œy
;

73 
	gÃw_’Œy
->
	gÃxt
 = 
´ev
->
Ãxt
;

74 
	g´ev
->
	gÃxt
 = 
Ãw_’Œy
;

76 
	gÃw_’Œy
->
	gt
 = 
t
;

77 
node_ev’t
 
	gÃ
;

78 
	gÃ
.
	gloc_–
 = 
li
;

79 
	gÃ
.
	gv_Ït
 = ((è
št_vÏt
 / 1.0e7);

80 
	gÃ
.
	gv_lÚ
 = ((è
št_vlÚ
 / 1.0e7);

81 
	gÃw_’Œy
->
	gnodes
.
push_back
(
Ã
);

88 
	gMovem’tSimuÏtÜ
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

90  
»ad_¬gs
(
cÚf
, 
”rh
);

94 
	gMovem’tSimuÏtÜ
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

96 
_ev’t_tim”
.
	`š™Ÿlize
(
this
);

99 
_ev’t_tim”
.
	`scheduË_aá”_m£c
(300);

101 
	}
}

105 
	gMovem’tSimuÏtÜ
::
	$ev’t_hook
(
Tim”
 *, *
thunk
)

107 
Movem’tSimuÏtÜ
 *
–
 = (Movem’tSimuÏtÜ *è
thunk
;

108 
ev’t_’Œy
 *
Ãxt_ev’t
 = 
–
->
_ev’ts
->
Ãxt
;

109 ià(
Ãxt_ev’t
 =ğ
–
->
_ev’ts
) {

113 
–
->
_ev’ts
->
Ãxt
 = 
Ãxt_ev’t
->next;

115 
i
 = 0; i < 
Ãxt_ev’t
->
nodes
.
	`size
(); i++)

116 
Ãxt_ev’t
->
nodes
[
i
].
loc_–
->
	`£t_Ãw_de¡
Òext_ev’t->nodes[i].
v_Ït
,

117 
Ãxt_ev’t
->
nodes
[
i
].
v_lÚ
);

119 ià(
–
->
_ev’ts
->
Ãxt
 !=ƒl->_events)

120 
–
->
_ev’t_tim”
.
	`scheduË_aá”_m£c
Ól->
_ev’ts
->
Ãxt
->
t
 - 
Ãxt_ev’t
->t);

121 
d–‘e
 
Ãxt_ev’t
;

122 
	}
}

125 
boŞ


126 
	gMovem’tSimuÏtÜ
::
	$fšd_’Œy
(
t
, 
ev’t_’Œy
 **
»tv®
)

128 
ev’t_’Œy
 *
Ãxt
 = 
_ev’ts
->next;

129 
ev’t_’Œy
 *
´ev
 = 
_ev’ts
;

130 
Ãxt
 !ğ
_ev’ts
) {

131 ià(
Ãxt
->
t
 ==) {

132 *
»tv®
 = 
Ãxt
;

133  
Œue
;

135 ià(
Ãxt
->
t
 >) {

136 *
»tv®
 = 
´ev
;

137  
çl£
;

139 
´ev
 = 
Ãxt
;

140 
Ãxt
 =‚ext->next;

143 *
»tv®
 = 
_ev’ts
;

144  
çl£
;

145 
	}
}

147 
CLICK_ENDDECLS


148 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
GridLoÿtiÚInfo
)

149 
	`EXPORT_ELEMENT
(
Movem’tSimuÏtÜ
)

	@grid/movesim.hh

1 #iâdeà
MOVESIM_HH


2 
	#MOVESIM_HH


	)

21 
	~<şick/–em’t.hh
>

22 
	~"grid.hh
"

23 
	~<şick/tim”.hh
>

24 
	~<şick/veùÜ.hh
>

25 
	~"–em’ts/grid/gridloÿtiÚšfo.hh
"

26 
CLICK_DECLS


28 şas 
	cMovem’tSimuÏtÜ
 : 
public
 
EËm’t
 {

30 
public
:

31 
	$Movem’tSimuÏtÜ
(è
CLICK_COLD
;

32 ~
	$Movem’tSimuÏtÜ
(è
CLICK_COLD
;

34 cÚ¡ *
	$şass_Çme
() const {  "MovementSimulator"; }

36 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

37 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

39 
	`»ad_¬gs
(cÚ¡ 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
);

41 
´iv©e
:

42 
Tim”
 
_ev’t_tim”
;

44 
	snode_ev’t
 {

45 
GridLoÿtiÚInfo
 *
loc_–
;

46 
v_Ït
;

47 
v_lÚ
;

48 
	`node_ev’t
(è: 
	`loc_–
(0) { }

49 
	`node_ev’t
(
GridLoÿtiÚInfo
 *
–
, 
vÏt
, 
vlÚ
) :

50 
	`loc_–
(
–
), 
	`v_Ït
(
vÏt
), 
	`v_lÚ
(
vlÚ
) { }

51 
	}
};

53 
	sev’t_’Œy
 {

54 
	gt
;

55 
	gVeùÜ
<
	gnode_ev’t
> 
	gnodes
;

56 
ev’t_’Œy
 *
	gÃxt
;

59 
ev’t_’Œy
 *
	g_ev’ts
;

61 
ev’t_hook
(
Tim”
 *, *);

62 
boŞ
 
fšd_’Œy
(
t
, 
ev’t_’Œy
 **
»tv®
);

65 
	gCLICK_ENDDECLS


	@grid/packetlogger.cc

1 
	~<şick/cÚfig.h
>

2 
	~<şick/¬gs.hh
>

3 
	~<şick/”rÜ.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/·ck‘_ªno.hh
>

6 
	~<şick/¡¿ccum.hh
>

7 
	~<şickÃt/‘h”.h
>

8 
	~"·ck‘logg”.hh
"

9 
CLICK_DECLS


11 
	gPack‘Logg”
::
	$Pack‘Logg”
()

13 
	}
}

15 
Pack‘Logg”
::~
	$Pack‘Logg”
()

17 
	}
}

20 
Pack‘Logg”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

22  
Args
(
cÚf
, 
this
, 
”rh
)

23 .
»ad
("ETHERTYPE", 
_‘
)

24 .
»ad
("NBYTES", 
_nb
)

25 .
com¶‘e
();

28 
Pack‘
 *

29 
	gPack‘Logg”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

31 
şick_‘h”
 *
e
 = (şick_‘h” *)
p_š
->
	`d©a
();

32 ià(
p_š
->
	`Ëngth
(è>ğ(
şick_‘h”
è+ 
NBYTES
 &&

33 
	`Áohs
(
e
->
‘h”_ty³
è=ğ
_‘
) {

35 
log_’Œy
 
d
;

36 
d
.
time¡amp
 = 
p_š
->
	`time¡amp_ªno
();

37 
	`memıy
(
d
.
¤c_mac
, 
e
->
‘h”_sho¡
, 6);

55 
	`memıy
(
d
.
by‹s
, 
p_š
->
	`d©a
(è+ (
şick_‘h”
), 
NBYTES
);

57 
_p
.
	`push_back
(
d
);

59  
p_š
;

60 
	}
}

63 
	gPack‘Logg”
::
	$add_hªdËrs
()

65 
	`add_»ad_hªdËr
("log", 
´št_log
, 0);

66 
	}
}

68 
	#MAX_PROC_SIZE
 16384

	)

69 
SŒšg


70 
	gPack‘Logg”
::
	$´št_log
(
EËm’t
 *
e
, *)

72 
Pack‘Logg”
 *
p
 = (Pack‘Logg” *)
e
;

74 
by‹s_³r_’Œy
 = 18 + 2 + 17 + 3 + 
NBYTES
 * 2 + NBYTES / 4 + 1;

75 
n
 = 
p
->
_p
.
	`size
(è* 
by‹s_³r_’Œy
;

77 
n
 =‚ > 
MAX_PROC_SIZE
 ? MAX_PROC_SIZE :‚;

78 
SŒšgAccum
 
	`§
(
n
);

81 
p
->
_p
.
	`size
() &&

82 
§
.
	`Ëngth
(è< 
MAX_PROC_SIZE
 - 
by‹s_³r_’Œy
) {

83 
log_’Œy
 
d
;

84 
d
 = 
p
->
_p
[0];

85 
p
->
_p
.
	`pİ_äÚt
();

87 
§
 << 
d
.
time¡amp
 << " ";

88 *
buf
 = 
§
.
	`d©a
(è+ sa.
	`Ëngth
();

90 
pos
 = 0;

91 
i
 = 0; i < 6; i++) {

92 
	`¥rštf
(
buf
 + 
pos
, "%02x", 
d
.
¤c_mac
[
i
]);

93 
pos
 += 2;

94 ià(
i
 !ğ5è
buf
[
pos
++] = ':';

96 
buf
[
pos
++] = ' ';

97 
buf
[
pos
++] = '|';

98 
buf
[
pos
++] = ' ';

100 
i
 = 0; i < 
NBYTES
; i++) {

101 
	`¥rštf
(
buf
 + 
pos
, "%02x", 
d
.
by‹s
[
i
]);

102 
pos
 += 2;

103 ià((
i
 % 4è=ğ3è{ 
buf
[
pos
++] = ' '; }

105 
buf
[
pos
++] = '\n';

107 
§
.
	`adju¡_Ëngth
(
pos
);

110  
§
.
	`ke_¡ršg
();

111 
	}
}

113 
CLICK_ENDDECLS


114 
EXPORT_ELEMENT
(
Pack‘Logg”
)

	@grid/packetlogger.hh

1 #iâdeà
CLICK_PACKETLOGGER_HH


2 
	#CLICK_PACKETLOGGER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/deque.hh
>

7 
CLICK_DECLS


30 şas 
	cPack‘Logg”
 : 
public
 
EËm’t
 {…ublic:

32 
	$Pack‘Logg”
(è
CLICK_COLD
;

33 ~
	$Pack‘Logg”
(è
CLICK_COLD
;

35 cÚ¡ *
	$şass_Çme
() const {  "PacketLogger"; }

36 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

37 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

39 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

40 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

42 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

44 
	$add_hªdËrs
(è
CLICK_COLD
;

45 
SŒšg
 
	`´št_log
(
EËm’t
 *, *);

47 ’um { 
NBYTES
 = 8 
	}
};

49 
	slog_’Œy
 {

50 
Time¡amp
 
	gtime¡amp
;

51 
ušt8_t
 
	g¤c_mac
[6];

52 
ušt8_t
 
	gby‹s
[
NBYTES
];

55 
	g´iv©e
:

57 
ušt16_t
 
_‘
;

58 
	g_nb
;

60 
	gDeque
<
	glog_’Œy
> 
	g_p
;

64 
	gCLICK_ENDDECLS


	@grid/packetlogger2.cc

1 
	~<şick/cÚfig.h
>

2 
	~<şick/¬gs.hh
>

3 
	~<şick/”rÜ.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/·ck‘_ªno.hh
>

6 
	~<şick/¡¿ccum.hh
>

7 
	~<şickÃt/‘h”.h
>

8 
	~"·ck‘logg”2.hh
"

9 
CLICK_DECLS


11 
	gPack‘Logg”2
::
	$Pack‘Logg”2
()

12 : 
	$_nb
(34)

14 
_p
.
	`»£rve
(1000);

15 
	}
}

17 
	gPack‘Logg”2
::~
	$Pack‘Logg”2
()

19 
	}
}

22 
Pack‘Logg”2
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

24 ià(
Args
(
cÚf
, 
this
, 
”rh
)

25 .
»ad
("NBYTES", 
_nb
)

26 .
com¶‘e
() < 0)

29 
	g_nb
 = 
NBYTES
;

34 
Pack‘
 *

35 
	gPack‘Logg”2
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

37 
log_’Œy
 
d
;

38 
d
.
time¡amp
 = 
p_š
->
	`time¡amp_ªno
();

39 
d
.
Ëngth
 = 
p_š
->
	`Ëngth
();

40 
	`memıy
(
d
.
ªno
, 
p_š
->
	`ªno
(), 
Pack‘
::
ªno_size
);

41 
	`memıy
(
d
.
by‹s
, 
p_š
->
	`d©a
(), 
_nb
 < d.
Ëngth
 ? _nb : d.length);

43 
s_´e
 = 
_p
.
	`size
();

44 
_p
.
	`push_back
(
d
);

45 
s_po¡
 = 
_p
.
	`size
();

47 ià(
s_po¡
 !ğ
s_´e
 + 1)

48 
	`şick_ch©‹r
("Pack‘Logg”2 %s: ERROR: couldn'ˆadd…ack‘Ølog,†og sizğ%d", 
	`Çme
().
	`c_¡r
(), 
s_´e
);

50  
p_š
;

51 
	}
}

54 
	gPack‘Logg”2
::
	$add_hªdËrs
()

56 
	`add_»ad_hªdËr
("log", 
´št_log
, 0);

57 
	`add_wr™e_hªdËr
("ş—r", 
ş—r
, 0);

58 
	`add_»ad_hªdËr
("Ëá", 
Ëá
, 0);

59 
	}
}

62 
	gPack‘Logg”2
::
	$ş—r
(cÚ¡ 
SŒšg
 &
foo
, 
EËm’t
 *
e
, *
v·¿m
, 
E¼ÜHªdËr
 *
”rh
)

64 
Pack‘Logg”2
 *
p
 = (Pack‘Logg”2 *è
e
;

65 
p
->
_p
.
	`size
()) {

66 
p
->
_p
.
	`pİ_äÚt
();

68 
	}
}

72 
SŒšg


73 
	gPack‘Logg”2
::
	$Ëá
(
EËm’t
 *
e
, *)

75 
Pack‘Logg”2
 *
p
 = (Pack‘Logg”2 *è
e
;

76  
	`SŒšg
(
p
->
_p
.
	`size
());

77 
	}
}

79 
	#MAX_PROC_SIZE
 16384

	)

80 
SŒšg


81 
	gPack‘Logg”2
::
	$´št_log
(
EËm’t
 *
e
, *)

83 
Pack‘Logg”2
 *
p
 = (Pack‘Logg”2 *è
e
;

85 
by‹s_³r_’Œy
 = 9 + 1 + 9;

86 
by‹s_³r_’Œy
 += 5;

87 
by‹s_³r_’Œy
 += 4;

88 
by‹s_³r_’Œy
 +ğ2 * 
Pack‘
::
ªno_size
;

89 
by‹s_³r_’Œy
 += 4;

90 
by‹s_³r_’Œy
 +ğ2 * 
p
->
_nb
;

91 
by‹s_³r_’Œy
 +ğ
p
->
_nb
 / 4;

92 
by‹s_³r_’Œy
 += 1;

94 
n
 = 
p
->
_p
.
	`size
(è* 
by‹s_³r_’Œy
;

95 
n
 =‚ > 
MAX_PROC_SIZE
 ? MAX_PROC_SIZE :‚;

96 ià(
n
 <= 0)

98 
SŒšgAccum
 
	`§
(
n
);

100 
p
->
_p
.
	`size
() &&

101 
§
.
	`Ëngth
(è< 
MAX_PROC_SIZE
 - 
by‹s_³r_’Œy
) {

102 cÚ¡ 
log_’Œy
 &
d
 = 
p
->
_p
.
	`äÚt
();

104 
§
 << 
d
.
time¡amp
;

105 *
buf
 = 
§
.
	`d©a
(è+ sa.
	`Ëngth
();

106 
pos
 = 
	`¥rštf
(
buf
, " %4u | ", 
d
.
Ëngth
);

107 
i
 = 0; i < 
Pack‘
::
ªno_size
; i++) {

108 
	`¥rštf
(
buf
 + 
pos
, "%02x", 
d
.
ªno
[
i
]);

109 
pos
 += 2;

111 
buf
[
pos
++] = ' ';

112 
buf
[
pos
++] = '|';

113 
buf
[
pos
++] = ' ';

115 
num_to_´št
 = 
p
->
_nb
 > 
d
.
Ëngth
 ? d.length :…->_nb;

116 
i
 = 0; i < 
num_to_´št
; i++) {

117 
	`¥rštf
(
buf
 + 
pos
, "%02x", 
d
.
by‹s
[
i
]);

118 
pos
 += 2;

119 ià((
i
 % 4è=ğ3è{ 
buf
[
pos
++] = ' '; }

121 
buf
[
pos
++] = '\n';

123 
§
.
	`adju¡_Ëngth
(
pos
);

125 
p
->
_p
.
	`pİ_äÚt
();

128  
§
.
	`ke_¡ršg
();

129 
	}
}

131 
CLICK_ENDDECLS


132 
EXPORT_ELEMENT
(
Pack‘Logg”2
)

	@grid/packetlogger2.hh

1 #iâdeà
CLICK_PACKETLOGGER2_HH


2 
	#CLICK_PACKETLOGGER2_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/deque.hh
>

7 
CLICK_DECLS


38 şas 
	cPack‘Logg”2
 : 
public
 
EËm’t
 {…ublic:

40 
Pack‘Logg”2
();

41 ~
Pack‘Logg”2
();

43 cÚ¡ *
	$şass_Çme
() const {  "PacketLogger2"; }

44 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

45 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

46 cÚ¡ *
	$æow_code
(ècÚ¡ {  "#/#"; 
	}
}

48 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

49 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

51 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

53 
	$add_hªdËrs
(è
CLICK_COLD
;

54 
SŒšg
 
	`´št_log
(
EËm’t
 *, *);

55 
	`ş—r
(cÚ¡ 
SŒšg
 &
foo
, 
EËm’t
 *
e
, *
v·¿m
, 
E¼ÜHªdËr
 *
”rh
);

56 
SŒšg
 
	`Ëá
(
EËm’t
 *, *);

58 ’um { 
NBYTES
 = 18 
	}
};

60 
	slog_’Œy
 {

61 
Time¡amp
 
	gtime¡amp
;

62 
	gËngth
;

63 
ušt8_t
 
	gªno
[
Pack‘
::
ªno_size
];

64 
ušt8_t
 
	gby‹s
[
NBYTES
];

67 
	g´iv©e
:

69 
_nb
;

71 
	gDeque
<
	glog_’Œy
> 
	g_p
;

75 
	gCLICK_ENDDECLS


	@grid/pep.cc

18 
	~<şick/cÚfig.h
>

19 
	~"³p.hh
"

20 
	~"amÛba.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~"grid.hh
"

24 
	~<m©h.h
>

25 
CLICK_DECLS


27 
	gPEP
::
	$PEP
()

28 : 
	$_tim”
(
this
)

30 
_fixed
 = 0;

31 
_£q
 = 1;

32 
_debug
 = 
çl£
;

33 
	}
}

35 
	gPEP
::~
	$PEP
()

37 
	}
}

40 
PEP
::
	$ÿ¡
(cÚ¡ *
Çme
)

42 if(
	`¡rcmp
(
Çme
, "GridLocationInfo") == 0)

43 (
this
);

44 (
GridLoÿtiÚInfo
::
	`ÿ¡
(
Çme
));

45 
	}
}

48 
	gPEP
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

50 
	gÏt_št
 = 0, 
	glÚ_št
 = 0;

51 
boŞ
 
	gfixed
 = 
çl£
;

52 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

53 .
»ad_mp
("IP", 
_my_
)

54 .
»ad_p
("FIXED", 
fixed
)

55 .
»ad_p
("LATITUDE", 
Decim®FixedPoštArg
(5), 
Ït_št
)

56 .
»ad_p
("LONGITUDE", 
Decim®FixedPoštArg
(5), 
lÚ_št
)

57 .
com¶‘e
();

58 if(
	g»s
 < 0)

59 (
	g»s
);

61 if(
	gfixed
){

62 
	gÏt
 = ((è
Ït_št
) / 100000.0f;

63 
	glÚ
 = ((è
lÚ_št
) / 100000.0f;

64 ià(
	gÏt
 > 90 ||†at < -90)

65  
	g”rh
->
”rÜ
("%s:†atitude must be between +/- 90 degrees",

66 
Çme
().
c_¡r
());

67 ià(
	glÚ
 > 180 ||†on < -180)

68  
	g”rh
->
”rÜ
("%s:†ongitude must be between +/- 180 degrees",

69 
Çme
().
c_¡r
());

70 
	g_Ït
 = 
Ït
;

71 
	g_lÚ
 = 
lÚ
;

72 
	g_fixed
 = 
Œue
;

79 
	gPEP
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

81 
_tim”
.
	`š™Ÿlize
(
this
);

82 
_tim”
.
	`scheduË_aá”_m£c
(
³p_upd©e
 * 1000);

84 
	}
}

87 
	gPEP
::
	$run_tim”
(
Tim”
 *)

89 
	`purge_Şd
();

90 
	`ouut
(0).
	`push
(
	`make_PEP
());

91 
_tim”
.
	`scheduË_aá”_m£c
(
	`şick_¿ndom
(è% (
³p_upd©e
 * 1000 * 2));

92 
	}
}

95 
	gPEP
::
	$purge_Şd
()

97 
Time¡amp
 
tv
 = Time¡amp::
	`now
();

99 
i
 = 0;

100 
j
;

101 
j
 = 0; j < 
_’Œ›s
.
	`size
(); j++){

102 if(
tv
.
	`£c
(è- 
_’Œ›s
[
j
].
_wh’
.£c(è<ğ
³p_purge
){

103 
_’Œ›s
[
i
++] = _’Œ›s[
j
];

105 if(
_debug
)

106 
	`şick_ch©‹r
("PEP %s %s:…urging oldƒntry for %s (%d %d %d)",

107 
	`Çme
().
	`c_¡r
(),

108 
_my_
.
	`uÅ¬£
().
	`c_¡r
(),

109 
	`IPAdd»ss
(
_’Œ›s
[
j
].
_fix
.
fix_id
).
	`uÅ¬£
().
	`c_¡r
(),

110 (è
_’Œ›s
[
j
].
_wh’
.
	`£c
(),

111 (è
tv
.
	`£c
(),

112 
³p_purge
);

116 
EÁry
 
dud
;

117 
_’Œ›s
.
	`»size
(
i
, 
dud
);

118 
	}
}

121 
	gPEP
::
	$sÜt_’Œ›s
()

123 
n
 = 
_’Œ›s
.
	`size
();

124 
i
, 
j
;

126 
i
 = 0; i < 
n
; i++){

127 
h
 = 
_’Œ›s
[
i
].
_fix
.
fix_hİs
;

128 
j
 = 
i
 + 1; j < 
n
; j++){

129 if(
_’Œ›s
[
j
].
_fix
.
fix_hİs
 < 
h
){

130 
EÁry
 
tmp
 = 
_’Œ›s
[
i
];

131 
_’Œ›s
[
i
] = _’Œ›s[
j
];

132 
_’Œ›s
[
j
] = 
tmp
;

136 
	}
}

139 
boŞ


140 
	gPEP
::
	$£ndabË
(
EÁry
 
e
)

142 
Time¡amp
 
tv
 = Time¡amp::
	`now
();

144 if(
e
.
_wh’
.
	`£c
(è+ 
³p_¡®e
 > 
tv
.sec() &&

145 
e
.
_fix
.
fix_hİs
 < 
³p_max_hİs
){

146 (
Œue
);

149 (
çl£
);

150 
	}
}

153 
	gPEP
::
	$ex‹º®ize
(
³p_fix
 *
å
)

155 
å
->
fix_£q
 = 
	`htÚl
(fp->fix_seq);

156 
å
->
fix_hİs
 = 
	`htÚl
(fp->fix_hops);

157 
	}
}

160 
	gPEP
::
	$š‹º®ize
(
³p_fix
 *
å
)

162 
å
->
fix_£q
 = 
	`Áohl
(fp->fix_seq);

163 
å
->
fix_hİs
 = 
	`Áohl
(fp->fix_hops);

164 
	}
}

166 
Pack‘
 *

167 
	gPEP
::
	$make_PEP
()

169 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
((
³p_´Ùo
));

170 
	`mem£t
(
p
->
	`d©a
(), 0,…->
	`Ëngth
());

172 
³p_´Ùo
 *
µ
 = (³p_´ÙØ*è
p
->
	`d©a
();

173 
µ
->
id
 = 
_my_
.
	`addr
();

174 
nf
 = 0;

176 if(
_fixed
){

177 
³p_fix
 *
f
 = 
µ
->
fixes
 + 
nf
;

178 
nf
++;

179 
f
->
fix_id
 = 
_my_
.
	`addr
();

180 
f
->
fix_£q
 = 
	`htÚl
(
_£q
++);

181 
f
->
fix_loc
 = 
	`grid_loÿtiÚ
(
_Ït
, 
_lÚ
);

182 
f
->
fix_hİs
 = 
	`htÚl
(0);

185 
	`sÜt_’Œ›s
();

187 
i
;

188 
i
 = 0; i < 
_’Œ›s
.
	`size
(è&& 
nf
 < 
³p_´Ùo_fixes
; i++){

189 if(
	`£ndabË
(
_’Œ›s
[
i
])){

190 
µ
->
fixes
[
nf
] = 
_’Œ›s
[
i
].
_fix
;

191 
µ
->
fixes
[
nf
].
fix_hİs
 += 1;

192 
	`ex‹º®ize
(&(
µ
->
fixes
[
nf
]));

193 
nf
++;

197 
µ
->
n_fixes
 = 
	`htÚl
(
nf
);

199  
p
;

200 
	}
}

203 
	gPEP
::
	$fšdEÁry
(
id
, 
boŞ
 
ü—‹
)

205 
i
;

207 
i
 = 0; i < 
_’Œ›s
.
	`size
(); i++)

208 if(
_’Œ›s
[
i
].
_fix
.
fix_id
 =ğ
id
)

209 (
i
);

211 if(
ü—‹
){

212 if(
_debug
)

213 
	`şick_ch©‹r
("PEP %s %s:‚ewƒntry for %s",

214 
this
->
	`Çme
().
	`c_¡r
(),

215 
_my_
.
	`uÅ¬£
().
	`c_¡r
(),

216 
	`IPAdd»ss
(
id
).
	`uÅ¬£
().
	`c_¡r
());

217 
i
 = 
_’Œ›s
.
	`size
();

218 
EÁry
 
e
;

219 
e
.
_fix
.
fix_id
 = 
id
;

220 
e
.
_fix
.
fix_hİs
 = -1;

221 
e
.
_fix
.
fix_£q
 = -1;

222 
_’Œ›s
.
	`push_back
(
e
);

223 
	`as£¹
(
_’Œ›s
.
	`size
(è=ğ
i
+1 && _’Œ›s[i].
_fix
.
fix_id
 =ğ
id
);

224 (
i
);

228 
	}
}

230 
Pack‘
 *

231 
	gPEP
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

233 
nf
;

234 
³p_´Ùo
 *
µ
;

235 
Time¡amp
 
tv
 = Time¡amp::
	`now
();

237 if(
p
->
	`Ëngth
(è!ğ(
³p_´Ùo
)){

238 
	`şick_ch©‹r
("PEP: bad siz·ck‘ (%d by‹s)", 
p
->
	`Ëngth
());

239 
out
;

242 
µ
 = (
³p_´Ùo
 *è
p
->
	`d©a
();

243 
nf
 = 
	`Áohl
(
µ
->
n_fixes
);

244 if(
nf
 < 0 || (cÚ¡ 
u_ch¬
*)&
µ
->
fixes
[nf] > 
p
->
	`d©a
()+p->
	`Ëngth
()){

245 
	`şick_ch©‹r
("PEP: bad‚_fixe %d", 
nf
);

246 
out
;

249 
i
;

250 
i
 = 0; i < 
nf
 && i < 
³p_´Ùo_fixes
; i++){

251 
³p_fix
 
f
 = 
µ
->
fixes
[
i
];

252 
	`š‹º®ize
(&
f
);

253 if(
f
.
fix_id
 =ğ
_my_
.
	`addr
())

255 
j
 = 
	`fšdEÁry
(
f
.
fix_id
, 
Œue
);

256 if(
j
 < 0)

259 
os
 = 
_’Œ›s
[
j
].
_fix
.
fix_£q
;

260 
oh
 = 
_’Œ›s
[
j
].
_fix
.
fix_hİs
;

261 if(
f
.
fix_£q
 > 
os
 ||

262 (
f
.
fix_£q
 =ğ
os
 && f.
fix_hİs
 < 
oh
)){

263 
_’Œ›s
[
j
].
_fix
 = 
f
;

264 
_’Œ›s
[
j
].
_wh’
 = 
tv
;

265 if(
_debug
 && 
f
.
fix_hİs
 !ğ
oh
)

266 
	`şick_ch©‹r
("PEP %s %s: updating %s, seq %d -> %d, hops %d -> %d, my…os %s",

267 
	`Çme
().
	`c_¡r
(),

268 
_my_
.
	`uÅ¬£
().
	`c_¡r
(),

269 
	`IPAdd»ss
(
f
.
fix_id
).
	`uÅ¬£
().
	`c_¡r
(),

270 
os
,

271 
f
.
fix_£q
,

272 
oh
,

273 
f
.
fix_hİs
,

274 
	`g‘_cu¼’t_loÿtiÚ
().
	`s
().
	`c_¡r
());

278 
out
:

279 
p
->
	`kl
();

281 
	}
}

284 
grid_loÿtiÚ


285 
	gPEP
::
	$®gÜ™hm1
()

287 
Ït
 = 0, 
lÚ
 = 0;

288 
weight
 = 0;

289 
i
;

290 
Time¡amp
 
now
 = Time¡amp::
	`now
();

292 
i
 = 0; i < 
_’Œ›s
.
	`size
(); i++){

293 if(
now
.
	`£c
(è- 
_’Œ›s
[
i
].
_wh’
.£c(è< 
³p_¡®e
){

294 
w
 = 1.0 / (
_’Œ›s
[
i
].
_fix
.
fix_hİs
 + 1);

295 
Ït
 +ğ
w
 * 
_’Œ›s
[
i
].
_fix
.
fix_loc
.
	`Ït
();

296 
lÚ
 +ğ
w
 * 
_’Œ›s
[
i
].
_fix
.
fix_loc
.
	`lÚ
();

297 
weight
 +ğ
w
;

301 (
	`grid_loÿtiÚ
(
Ït
 / 
weight
, 
lÚ
 / weight));

302 
	}
}

304 şas 
	cPEPAmÛba
 : 
public
 
AmÛba
 {

305 
public
:

306 
	$PEPAmÛba
 (è: 
	$AmÛba
(2) { }

307 
	`â
(
a
[]);

308 
_n
;

309 
_x
[20];

310 
_y
[20];

311 
_d
[20];

312 
	}
};

315 
	gPEPAmÛba
::
	$â
(
a
[])

317 
x
 = 
a
[0];

318 
y
 = 
a
[1];

319 
d
 = 0;

320 
i
;

322 
i
 = 0; i < 
_n
; i++){

323 
dx
 = 
x
 - 
_x
[
i
];

324 
dy
 = 
y
 - 
_y
[
i
];

325 
dd
 = 
_d
[
i
] - 
	`sq¹
(
dx
*dx + 
dy
*dy);

326 
dd
 = dd * dd;

327 
d
 +ğ
dd
;

330 (
d
);

331 
	}
}

333 
grid_loÿtiÚ


334 
	gPEP
::
	$®gÜ™hm2
()

336 
PEPAmÛba
 
a
;

337 
i
;

338 
Time¡amp
 
now
 = Time¡amp::
	`now
();

339 
a
.
_n
 = 0;

341 
i
 = 0; i < 
_’Œ›s
.
	`size
(è&& 
a
.
_n
 < 5; i++){

342 if(
now
.
	`£c
(è- 
_’Œ›s
[
i
].
_wh’
.£c(è< 
³p_¡®e
){

343 
a
.
_x
[a.
_n
] = 
_’Œ›s
[
i
].
_fix
.
fix_loc
.
	`Ït
();

344 
a
.
_y
[a.
_n
] = 
_’Œ›s
[
i
].
_fix
.
fix_loc
.
	`Ït
();

345 
a
.
_d
[a.
_n
] = 
_’Œ›s
[
i
].
_fix
.
fix_hİs
 * 0.002;

346 
a
.
_n
 += 1;

350 
±s
[2];

351 
a
.
	`mšimize
(
±s
);

353 (
	`grid_loÿtiÚ
(
±s
[0],…ts[1]));

354 
	}
}

356 
grid_loÿtiÚ


357 
	gPEP
::
	$g‘_cu¼’t_loÿtiÚ
()

359 if(
_fixed
)

360 (
	`grid_loÿtiÚ
(
_Ït
, 
_lÚ
));

362 if(
_’Œ›s
.
	`size
() < 1)

363 (
	`grid_loÿtiÚ
(0.0, 0.0));

365 (
	`®gÜ™hm1
());

366 
	}
}

368 
SŒšg


369 
	$³p_»ad_hªdËr
(
EËm’t
 *
f
, *)

371 
PEP
 *
l
 = (PEP *è
f
;

372 (
l
->
	`s
());

373 
	}
}

375 
SŒšg


376 
	gPEP
::
	$s
()

378 
SŒšg
 
s
;

379 
i
, 
n
;

380 
Time¡amp
 
now
 = Time¡amp::
	`now
();

382 if(
_fixed
){

383 
s
 = 
_my_
.
	`uÅ¬£
() + " " +

384 
	`grid_loÿtiÚ
(
_Ït
, 
_lÚ
).
	`s
() + "\n";

386 
s
 = 
_my_
.
	`uÅ¬£
() + "\n";

389 
s
 +ğ
	`g‘_cu¼’t_loÿtiÚ
().
	`s
() + "\n";

391 
n
 = 
_’Œ›s
.
	`size
();

392 
i
 = 0; i < 
n
; i++){

393 
³p_fix
 
f
 = 
_’Œ›s
[
i
].
_fix
;

394 
buf
[512];

395 
	`¢´štf
(
buf
, (buf), "%s seq=%d %s hops=%d‡ge=%d\n",

396 
	`IPAdd»ss
(
f
.
fix_id
).
	`uÅ¬£
().
	`c_¡r
(),

397 
f
.
fix_£q
,

398 
f
.
fix_loc
.
	`s
().
	`c_¡r
(),

399 
f
.
fix_hİs
,

400 ()(
now
.
	`£c
(è- 
_’Œ›s
[
i
].
_wh’
.sec()));

401 
s
 +ğ
buf
;

403  
s
;

404 
	}
}

407 
	gPEP
::
	$add_hªdËrs
()

409 
	`add_»ad_hªdËr
("¡©us", 
³p_»ad_hªdËr
, 0);

410 
	}
}

412 
CLICK_ENDDECLS


413 
	$ELEMENT_REQUIRES
(
GridLoÿtiÚInfo
 
AmÛba
)

414 
	`EXPORT_ELEMENT
(
PEP
)

	@grid/pep.hh

1 #iâdeà
³p_hh


2 
	#³p_hh


	)

58 
	~<şick/–em’t.hh
>

59 
	~<şick/tim”.hh
>

60 
	~<şick/add»ss.hh
>

61 
	~"³p_´Ùo.hh
"

62 
	~"grid.hh
"

63 
	~"–em’ts/grid/gridloÿtiÚšfo.hh
"

64 
CLICK_DECLS


66 şas 
	cPEP
 : 
public
 
GridLoÿtiÚInfo
 {

68 
public
:

70 
	$PEP
(è
CLICK_COLD
;

71 ~
	$PEP
(è
CLICK_COLD
;

73 cÚ¡ *
	$şass_Çme
() const {  "PEP"; }

74 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

75 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

77 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

78 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

79 
vœtu®
 *
	`ÿ¡
(const *);

80 
	`run_tim”
(
Tim”
 *);

81 
	$add_hªdËrs
(è
CLICK_COLD
;

82 
Pack‘
 *
	`sim¶e_aùiÚ
(Pack‘ *
p
);

84 
grid_loÿtiÚ
 
	`g‘_cu¼’t_loÿtiÚ
();

85 
SŒšg
 
	`s
();

87 
boŞ
 
_debug
;

89 
´iv©e
:

91 
IPAdd»ss
 
_my_
;

92 
Tim”
 
_tim”
;

94 
boŞ
 
_fixed
;

95 
_Ït
;

96 
_lÚ
;

97 
_£q
;

99 
	sEÁry
 {

100 
Time¡amp
 
_wh’
;

101 
³p_fix
 
_fix
;

102 
	}
};

103 
	gVeùÜ
<
	gEÁry
> 
	g_’Œ›s
;

104 
fšdEÁry
(
id
, 
boŞ
 
®loÿ‹
);

106 
purge_Şd
();

107 
sÜt_’Œ›s
();

108 
boŞ
 
£ndabË
(
EÁry
);

109 
ex‹º®ize
(
³p_fix
 *);

110 
š‹º®ize
(
³p_fix
 *);

111 
Pack‘
 *
make_PEP
();

112 
grid_loÿtiÚ
 
®gÜ™hm1
();

113 
grid_loÿtiÚ
 
®gÜ™hm2
();

116 
	gCLICK_ENDDECLS


	@grid/pep_proto.hh

1 #iâdeà
³p_´Ùo_hh


2 
	#³p_´Ùo_hh


	)

8 
	~"grid.hh
"

9 
CLICK_DECLS


11 cÚ¡ 
	g³p_´Ùo_fixes
 = 5;

12 cÚ¡ 
	g³p_max_hİs
 = 10;

16 cÚ¡ 
	g³p_upd©e
 = 1;

17 cÚ¡ 
	g³p_¡®e
 = 5;

18 cÚ¡ 
	g³p_purge
 = 100;

23 
	s³p_fix
 {

24 
	mfix_id
;

25 
	mfix_£q
;

26 
grid_loÿtiÚ
 
	mfix_loc
;

27 
	mfix_hİs
;

30 
	s³p_´Ùo
 {

31 
	mid
;

32 
	mn_fixes
;

33 
³p_fix
 
	mfixes
[
³p_´Ùo_fixes
];

41 
	s³p_rgn_fix
 {

42 
	mfix_id
;

43 
	mfix_£q
;

44 
grid_loÿtiÚ
 
	mfix_loc
;

45 
grid_loÿtiÚ
 
	mfix_dim
;

46 
	mfix_hİs
;

49 
	s³p_rgn_´Ùo
 {

50 
	mid
;

51 
	mn_fixes
;

52 
³p_rgn_fix
 
	mfixes
[
³p_´Ùo_fixes
];

55 
	gCLICK_ENDDECLS


	@grid/pingpong.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şickÃt/‘h”.h
>

21 
	~"pšgpÚg.hh
"

22 
	~<şick/glue.hh
>

23 
	~"grid.hh
"

24 
	~"lšk¡©.hh
"

25 
CLICK_DECLS


27 
	gPšgPÚg
::
	$PšgPÚg
()

29 
	}
}

31 
PšgPÚg
::~
	$PšgPÚg
()

33 
	}
}

37 
PšgPÚg
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39  
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad_mp
("LINKSTAT", 
»š‹½»t_ÿ¡
<
EËm’t
 *&>(
_ls
))

41 .
com¶‘e
();

47 
	gPšgPÚg
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

50 
	}
}

53 
Pack‘
 *

54 
	gPšgPÚg
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

56 
şick_‘h”
 *
eh
 = (şick_‘h” *è
p
->
	`d©a
();

57 
grid_hdr
 *
gh
 = (grid_hd¸*è(
eh
 + 1);

59 
gh
->
ty³
) {

60 
grid_hdr
::
GRID_NBR_ENCAP
:

61 
grid_hdr
::
GRID_LOC_REPLY
:

62 
grid_hdr
::
GRID_ROUTE_PROBE
:

63 
grid_hdr
::
GRID_ROUTE_REPLY
: {

64 #iâdeà
SMALL_GRID_HEADERS


65 
grid_nbr_’ÿp
 *
nb
 = (grid_nbr_’ÿ°*è(
gh
 + 1);

67 
nb
->
lšk_qu®
 = 0;

68 
nb
->
lšk_sig
 = 0;

69 
nb
->
m—su»m’t_time
.
tv_£c
 =‚b->m—su»m’t_time.
tv_u£c
 = 0;

71 
Eth”Add»ss
 
	`‘h
(
eh
->
‘h”_dho¡
);

72 
LškSt
::
¡©_t
 *
s
 = 
_ls
->
_¡©s
.
	`fšdp
(
‘h
);

73 ià(
s
) {

74 
nb
->
lšk_qu®
 = 
	`htÚl
(
s
->
qu®
);

75 
nb
->
lšk_sig
 = 
	`htÚl
(
s
->
sig
);

76 
nb
->
m—su»m’t_time
.
tv_£c
 = 
	`htÚl
(
s
->
wh’
.tv_sec);

77 
nb
->
m—su»m’t_time
.
tv_u£c
 = 
	`htÚl
(
s
->
wh’
.tv_usec);

80 
	`şick_ch©‹r
("PingPong:ƒrror! unableo get signal strength or quality info for one-hop‚eighbor %s\n",

81 
	`IPAdd»ss
(
nb
->
d¡_
).
	`uÅ¬£
().
	`c_¡r
());

83 
nb
->
num_rx
 = 0;

84 
nb
->
num_ex³ùed
 = 0;

85 
nb
->
Ï¡_bÿ¡
.
tv_£c
 =‚b->Ï¡_bÿ¡.
tv_u£c
 = 0;

86 
wšdow
 = 0;

87 
num_rx
 = 0;

88 
num_ex³ùed
 = 0;

89 
boŞ
 
»s
 = 
_ls
->
	`g‘_bÿ¡_¡©s
(
‘h
, 
nb
->
Ï¡_bÿ¡
, 
wšdow
, 
num_rx
, 
num_ex³ùed
);

90 ià(
»s
) {

91 ià(
num_rx
 > 255 || 
num_ex³ùed
 > 255) {

92 
	`şick_ch©‹r
("PingPong:ƒrror! overflow on broadcast†oss stats for one-hop‚eighbor %s",

93 
	`IPAdd»ss
(
nb
->
d¡_
).
	`uÅ¬£
().
	`c_¡r
());

94 
num_rx
 = 
num_ex³ùed
 = 255;

96 
nb
->
num_rx
 =‚um_rx;

97 
nb
->
num_ex³ùed
 =‚um_expected;

98 
nb
->
Ï¡_bÿ¡
 = 
	`htÚ
(nb->last_bcast);

107  
p
;

108 
	}
}

110 
CLICK_ENDDECLS


111 
EXPORT_ELEMENT
(
PšgPÚg
)

	@grid/pingpong.hh

1 #iâdeà
PINGPONGHH


2 
	#PINGPONGHH


	)

18 
	~<şick/bighashm­.hh
>

19 
	~<şick/–em’t.hh
>

20 
	~<şick/glue.hh
>

21 
	~<şick/add»ss.hh
>

22 
CLICK_DECLS


24 
şass
 
	gLškSt
;

26 şas 
	cPšgPÚg
 : 
public
 
EËm’t
 {

28 
LškSt
 *
_ls
;

30 
	mpublic
:

32 
	$PšgPÚg
(è
CLICK_COLD
;

33 ~
	$PšgPÚg
(è
CLICK_COLD
;

35 cÚ¡ *
	$şass_Çme
() const {  "PingPong"; }

36 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

37 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "a/a"; 
	}
}

39 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

40 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

42 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

43 
	}
};

45 
	gCLICK_ENDDECLS


	@grid/printgrid.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/glue.hh
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şick/‘h”add»ss.hh
>

24 
	~<şick/add»ss.hh
>

25 
	~<şickÃt/‘h”.h
>

26 
	~<–em’ts/grid/grid.hh
>

27 
	~<–em’ts/grid/timeuts.hh
>

28 
	~<–em’ts/grid/´štgrid.hh
>

29 
	~<–em’ts/grid/lšk¡©.hh
>

30 
CLICK_DECLS


32 
	gPrštGrid
::
	$PrštGrid
()

33 : 
	`_´št_rou‹s
(
çl£
), 
	`_´št_´obe_’Œ›s
(false),

34 
	`_v”bo£
(
Œue
), 
	`_time¡amp
(
çl£
), 
	$_´št_‘h
(
çl£
)

36 
_Ïb–
 = "";

37 
	}
}

39 
	gPrštGrid
::~
	$PrštGrid
()

41 
	}
}

44 
PrštGrid
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
* 
”rh
)

46  
Args
(
cÚf
, 
this
, 
”rh
)

47 .
»ad_p
("LABEL", 
_Ïb–
)

48 .
»ad
("SHOW_ROUTES", 
_´št_rou‹s
)

49 .
»ad
("SHOW_PROBE_CONTENTS", 
_´št_´obe_’Œ›s
)

50 .
»ad
("VERBOSE", 
_v”bo£
)

51 .
»ad
("TIMESTAMP", 
_time¡amp
)

52 .
»ad
("PRINT_ETH", 
_´št_‘h
)

53 .
com¶‘e
();

56 
SŒšg


57 
	gPrštGrid
::
	$’ÿp_to_¡ršg
(cÚ¡ 
grid_nbr_’ÿp
 *
nb
) const

59 
SŒšg
 
lše
;

60 
lše
 +ğ"hİs_Œav–Ëd=" + 
	`SŒšg
((è
nb
->
hİs_Œav–Ëd
) + " ";

61 
lše
 +ğ"d¡=" + 
	`IPAdd»ss
(
nb
->
d¡_
).
	`uÅ¬£
() + " ";

62 ià(
_v”bo£
) {

63 #iâdeà
SMALL_GRID_HEADERS


64 ià(
nb
->
d¡_loc_good
) {

65 
buf
[50];

66 
	`¢´štf
(
buf
, 50, "d¡_loc=% ", 
nb
->
d¡_loc
.
	`uÅ¬£
().
	`c_¡r
());

67 
lše
 +ğ
buf
;

68 
lše
 +ğ"d¡_loc_”r=" + 
	`SŒšg
(
	`Áohs
(
nb
->
d¡_loc_”r
)) + " ";

71 
lše
 += "bad-dst-loc";

73 
lše
 += "bad-dst-loc";

76  
lše
;

77 
	}
}

79 
Pack‘
 *

80 
	gPrštGrid
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

82 
şick_‘h”
 *
eh
 = (şick_‘h” *è
p
->
	`d©a
();

83 ià(
	`Áohs
(
eh
->
‘h”_ty³
è!ğ
ETHERTYPE_GRID
 &&‚tohsÓh->‘h”_ty³è!ğ
LškSt
::
ETHERTYPE_LINKSTAT
) {

84 
	`şick_ch©‹r
("PrintGrid %s%s%s :‚ot‡ Grid…acket",

85 
	`Çme
().
	`c_¡r
(),

86 
_Ïb–
.
	`c_¡r
()[0] ? " " : "",

87 
_Ïb–
.
	`c_¡r
());

88  
p
;

91 ià(
	`Áohs
(
eh
->
‘h”_ty³
è=ğ
LškSt
::
ETHERTYPE_LINKSTAT
) {

92 
	`´št_‘h”_lšk¡©
(
p
);

93  
p
;

96 
grid_hdr
 *
gh
 = (grid_hd¸*è(
p
->
	`d©a
(è+ (
şick_‘h”
));

98 
SŒšg
 
ty³
 = 
grid_hdr
::
	`ty³_¡ršg
(
gh
->type);

100 
SŒšgAccum
 
lše
;

101 
lše
 << "PrintGrid ";

102 ià(
_v”bo£
)

103 
lše
 << 
	`Çme
() << " ";

104 ià(
_Ïb–
[0] != 0)

105 
lše
 << 
_Ïb–
 << " ";

106 ià(
_time¡amp
)

107 
lše
 << 
p
->
	`time¡amp_ªno
() << ' ';

109 ià(
_´št_‘h
) {

110 
lše
 << 
	`Eth”Add»ss
(
eh
->
‘h”_sho¡
è<< ' ' << Eth”Add»ssÓh->
‘h”_dho¡
) << ' ';

111 
lše
.
	`¢´štf
(10, "%04hx ", 
	`Áohs
(
eh
->
‘h”_ty³
));

114 
lše
 << ": " << 
ty³
 << " ";

115 ià(
_v”bo£
)

116 
lše
 << "hdr_Ën=" << 
gh
->
hdr_Ën
 << " ";

119 
lše
 << "=" << 
	`IPAdd»ss
(
gh
->

).
	`uÅ¬£
() << " ";

120 ià(
_v”bo£
) {

121 ià(
gh
->
loc_good
)

122 
lše
 << "loc=" << 
gh
->
loc
.
	`s
(è<< "†oc_”r=" << 
	`Áohs
(gh->
loc_”r
) << ' ';

124 
lše
 << "bad-loc ";

125 
lše
 << "loc_£q_no=" << 
	`Áohl
(
gh
->
loc_£q_no
) << " ";

129 
lše
 << "tx_=" << 
	`IPAdd»ss
(
gh
->
tx_
) << " ";

130 ià(
_v”bo£
) {

131 ià(
gh
->
tx_loc_good
)

132 
lše
 << "tx_loc=" << 
gh
->
tx_loc
.
	`s
(è<< "x_loc_”r=" << 
	`Áohs
(gh->
tx_loc_”r
) << ' ';

134 
lše
 << "bad-tx-loc ";

135 
lše
 << "tx_loc_£q_no=" << 
	`Áohl
(
gh
->
tx_loc_£q_no
) << " ";

138 ià(
_v”bo£
)

139 
lše
 << "pkt_Ën=" << 
	`Áohs
(
gh
->
tÙ®_Ën
) << " ";

141 
lše
 << "** ";

143 
grid_h–lo
 *
gh2
 = 0;

144 
grid_nbr_’ÿp
 *
nb
 = 0;

145 
grid_loc_qu”y
 *
lq
 = 0;

146 
grid_rou‹_´obe
 *
½
 = 0;

147 
grid_rou‹_»¶y
 *
¼
 = 0;

149 
gh
->
ty³
) {

151 
grid_hdr
::
GRID_LR_HELLO
:

152 
gh2
 = (
grid_h–lo
 *è(
gh
 + 1);

153 
lše
 << "£q_no=" << 
	`Áohl
(
gh2
->
£q_no
) << " ";

154 ià(
_v”bo£
)

155 
lše
 << "age=" << 
	`Áohl
(
gh2
->
age
) << " ";

156 
lše
 << "num_nbrs=" << (è
gh2
->
num_nbrs
;

157 ià(
_´št_rou‹s
)

158 
lše
 << 
	`g‘_’Œ›s
(
gh2
);

161 
grid_hdr
::
GRID_NBR_ENCAP
:

162 
grid_hdr
::
GRID_LOC_REPLY
:

163 
nb
 = (
grid_nbr_’ÿp
 *è(
gh
 + 1);

164 
lše
 << 
	`’ÿp_to_¡ršg
(
nb
);

167 
grid_hdr
::
GRID_LOC_QUERY
:

168 
lq
 = (
grid_loc_qu”y
 *è(
gh
 + 1);

169 
lše
 << "d¡_=" << 
	`IPAdd»ss
(
lq
->
d¡_
) << " "

170 << "£q_no=" << 
	`Áohl
(
lq
->
£q_no
);

173 
grid_hdr
::
GRID_ROUTE_PROBE
:

174 
nb
 = (
grid_nbr_’ÿp
 *è(
gh
 + 1);

175 
lše
 << 
	`’ÿp_to_¡ršg
(
nb
);

176 
½
 = (
grid_rou‹_´obe
 *è(
nb
 + 1);

177 
lše
 << "‚Úû=" << 
	`Áohl
(
½
->
nÚû
);

180 
grid_hdr
::
GRID_ROUTE_REPLY
:

181 
nb
 = (
grid_nbr_’ÿp
 *è(
gh
 + 1);

182 
lše
 << 
	`’ÿp_to_¡ršg
(
nb
);

183 
¼
 = (
grid_rou‹_»¶y
 *è(
nb
 + 1);

184 
lše
 << "‚Úû=" << 
	`Áohl
(
¼
->
nÚû
)

185 << "…robe_de¡=" << 
	`IPAdd»ss
(
¼
->
´obe_de¡
)

186 << "„•ly_hİ=" << (è
¼
->
»¶y_hİ
;

189 
grid_hdr
::
GRID_LINK_PROBE
: {

190 
grid_lšk_´obe
 *
Í
 = (grid_lšk_´ob*è(
gh
 + 1);

191 
lše
 << " seq_no=" << 
	`Áohl
(
Í
->
£q_no
)

192 << "…”iod=" << 
	`Áohl
(
Í
->
³riod
)

193 << "au=" << 
	`Áohl
(
Í
->
u
)

194 << "‚um_lšks=" << 
	`Áohl
(
Í
->
num_lšks
);

195 ià(
_´št_´obe_’Œ›s
)

196 
lše
 << 
	`g‘_´obe_’Œ›s
(
Í
);

201 
lše
 << "UnknowÀgrid h—d”y³ " << (è
gh
->
ty³
;

204 
	`şick_ch©‹r
("%s", 
lše
.
	`c_¡r
());

206  
p
;

207 
	}
}

210 
	gPrštGrid
::
	$´št_‘h”_lšk¡©
(
Pack‘
 *
p
) const

212 
SŒšgAccum
 
lše
;

213 
lše
 << "PrintGrid ";

214 ià(
_v”bo£
)

215 
lše
 << 
	`Çme
() << " ";

216 ià(
_Ïb–
[0] != 0)

217 
lše
 << 
_Ïb–
 << " ";

218 ià(
_time¡amp
)

219 
lše
 << 
p
->
	`time¡amp_ªno
();

221 
mš_sz
 = (
şick_‘h”
è+ 
LškSt
::
lšk_´obe
::
size
;

222 ià(
p
->
	`Ëngth
(è< 
mš_sz
) {

223 
lše
 << "LinkStat…acket isoo small";

224 
	`şick_ch©‹r
("%s", 
lše
.
	`c_¡r
());

228 ià(
_´št_‘h
) {

229 
şick_‘h”
 *
eh
 = (şick_‘h” *è
p
->
	`d©a
();

230 
buf
[100];

231 
	`¢´štf
(
buf
, (buf), "%s %s %04hx ",

232 
	`Eth”Add»ss
(
eh
->
‘h”_sho¡
).
	`uÅ¬£
().
	`c_¡r
(), Eth”Add»ssÓh->
‘h”_dho¡
).unparse().c_str(),

233 
	`Áohs
(
eh
->
‘h”_ty³
));

234 
lše
 << 
buf
;

237 
lše
 << ": ETHER_LINK_PROBE ";

239 
LškSt
::
lšk_´obe
 
	`Í
(
p
->
	`d©a
(è+ (
şick_‘h”
));

240 ià(
LškSt
::
lšk_´obe
::
	`ÿlc_cksum
(
p
->
	`d©a
(è+ (
şick_‘h”
)) != 0) {

241 
lše
 << "Bad checksum";

242 
	`şick_ch©‹r
("%s", 
lše
.
	`c_¡r
());

246 
lše
 << "psz=" << 
Í
.
psz
 << "‚um_lšks=" <<†p.
num_lšks
;

248 ià(
p
->
	`Ëngth
(è< 
Í
.
psz
)

249 
lše
 << " (short…acket) ";

251 
max_’Œ›s
 = (
p
->
	`Ëngth
(è- (
şick_‘h”
è- 
LškSt
::
lšk_´obe
::
size
è/ LškSt::
lšk_’Œy
::size;

252 
num_’Œ›s
 = 
Í
.
num_lšks
;

253 ià(
num_’Œ›s
 > 
max_’Œ›s
) {

254 
lše
 << " (Œunÿ‹dØ" << 
max_’Œ›s
 << "†inks)";

255 
num_’Œ›s
 = 
max_’Œ›s
;

258 ià(
_´št_´obe_’Œ›s
) {

259 cÚ¡ *
d
 = 
p
->
	`d©a
(è+ (
şick_‘h”
è+ 
LškSt
::
lšk_´obe
::
size
;

260 
i
 = 0; i < 
num_’Œ›s
; i++, 
d
 +ğ
LškSt
::
lšk_’Œy
::
size
) {

261 
LškSt
::
lšk_’Œy
 
	`Ë
(
d
);

262 
lše
 << "\n\t" << 
Ë
.
‘h
 << "‚um_rx=" <<†e.
num_rx
;

266 
	`şick_ch©‹r
("%s", 
lše
.
	`c_¡r
());

267 
	}
}

269 
SŒšg


270 
	gPrštGrid
::
	$g‘_´obe_’Œ›s
(cÚ¡ 
grid_lšk_´obe
 *
Í
) const

272 
SŒšgAccum
 
§
;

273 
grid_lšk_’Œy
 *
Ë
 = (grid_lšk_’Œy *è(
Í
 + 1);

274 
i
 = 0; i < 
	`Áohl
(
Í
->
num_lšks
); i++, 
Ë
++) {

275 
§
 << "\n\t" << 
	`IPAdd»ss
(
Ë
->

);

276 
§
 << "‚um_rx=" << 
	`Áohl
(
Ë
->
num_rx
);

277 #iâdeà
SMALL_GRID_PROBES


278 
§
 << "…”iod=" << 
	`Áohl
(
Ë
->
³riod
);

279 
§
 << "†a¡_£q_no=" << 
	`Áohl
(
Ë
->
Ï¡_£q_no
);

280 
§
 << "†a¡_rx_time=" << 
	`Áoh
(
Ë
->
Ï¡_rx_time
);

281 
pù
 = 0;

282 ià(
	`Áohl
(
Ë
->
³riod
 > 0)) {

283 
num_ex³ùed
 = 
	`Áohl
(
Í
->
u
è/‚tohl(
Ë
->
³riod
);

284 ià(
num_ex³ùed
 > 0)

285 
pù
 = 100 * 
	`htÚl
(
Ë
->
num_rx
è/ 
num_ex³ùed
;

287 
§
 << "…ù=" << 
pù
;

291  
§
.
	`ke_¡ršg
();

292 
	}
}

294 
SŒšg


295 
	gPrštGrid
::
	$g‘_’Œ›s
(cÚ¡ 
grid_h–lo
 *
gh
) const

297 
SŒšgAccum
 
»t
;

298 *
ı
 = (*è(
gh
 + 1);

299 
i
 = 0; i < 
gh
->
num_nbrs
; i++) {

300 
grid_nbr_’Œy
 *
Ç
 = (grid_nbr_’Œy *è(
ı
 + 
gh
->
nbr_’Œy_sz
 * 
i
);

301 
»t
 << "\n\t=" << 
	`IPAdd»ss
(
Ç
->

)

302 << "‚ext=" << 
	`IPAdd»ss
(
Ç
->
Ãxt_hİ_
)

303 << " hİs=" << (è
Ç
->
num_hİs


304 << " seq=" << (è
	`Áohl
(
Ç
->
£q_no
) << ' ';

306 ià(
Ç
->
m‘ric_v®id
)

307 
»t
 << "m‘ric=" << (è
	`Áohl
(
Ç
->
m‘ric
);

309 
»t
 << "bad-metric";

311 ià(
_v”bo£
) {

312 
»t
 << " gw=" << (
Ç
->
is_g©eway
 ? "yes" : "no")

313 << "=" << 
	`Áohl
(
Ç
->
‰l
);

314 ià(
Ç
->
loc_good
)

315 
»t
 << "†oc=" << 
Ç
->
loc
.
	`s
(è<< "†oc_”r=" << (èÇ->
loc_”r
;

317 
»t
 << " bad-loc";

320  
»t
.
	`ke_¡ršg
();

321 
	}
}

323 
CLICK_ENDDECLS


324 
EXPORT_ELEMENT
(
PrštGrid
)

	@grid/printgrid.hh

1 #iâdeà
PRINTGRID_HH


2 
	#PRINTGRID_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/¡ršg.hh
>

5 
	~"grid.hh
"

6 
CLICK_DECLS


45 şas 
	cPrštGrid
 : 
public
 
EËm’t
 {

47 
SŒšg
 
_Ïb–
;

49 
	mpublic
:

51 
	$PrštGrid
(è
CLICK_COLD
;

52 ~
	$PrštGrid
(è
CLICK_COLD
;

54 cÚ¡ *
	$şass_Çme
() const {  "PrintGrid"; }

55 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

56 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

58 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

60 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

62 
	g´iv©e
:

63 
SŒšg
 
	$’ÿp_to_¡ršg
(cÚ¡ 
grid_nbr_’ÿp
 *) const;

65 
boŞ
 
_´št_rou‹s
;

66 
SŒšg
 
	$g‘_’Œ›s
(cÚ¡ 
grid_h–lo
 *) const;

68 
boŞ
 
_´št_´obe_’Œ›s
;

69 
SŒšg
 
	$g‘_´obe_’Œ›s
(cÚ¡ 
grid_lšk_´obe
 *) const;

71 
	$´št_‘h”_lšk¡©
(
Pack‘
 *) const;

73 
boŞ
 
_v”bo£
;

74 
boŞ
 
_time¡amp
;

75 
boŞ
 
_´št_‘h
;

76 
	}
};

78 
	gCLICK_ENDDECLS


	@grid/qvec.hh

7 #iâdeà
CLICK_QUEUE_HH


8 
	#CLICK_QUEUE_HH


	)

10 
	~<şick/veùÜ.hh
>

12 
CLICK_DECLS


14 
	g‹m¶©e
 <
şass
 
	gT
>

15 
şass
 
	gQVec
 : 
public
 
VeùÜ
<
T
> {

16 
VeùÜ
<
	tT
> 
	tBa£
;

17 
	gpublic
:

18 
QVec
() { }

19 
ex¶ic™
 
QVec
(
ÿ·c™y
è: 
Ba£
(capacity) { }

21 
T
 &
äÚt
(è{  
©
(0); }

23 
push_äÚt
(cÚ¡ 
T
 &);

24 
pİ_äÚt
();

29 
	g‹m¶©e
 <
şass
 
	gT
> 
šlše
 

30 
	gQVec
<
	gT
>::
	$push_äÚt
(cÚ¡ 
T
 &
e
)

32 
n
 = 
	`size
();

33 ià(
n
 > 0)

34 
	`push_back
(
	`back
());

35 
i
 = 1; i < 
n
; i++)

36 
this
->
	`©
(
i
) =his->at(i - 1);

37 
this
->
	`©
(0èğ
e
;

38 
	}
}

40 
	g‹m¶©e
 <
şass
 
	gT
> 
šlše
 

41 
	gQVec
<
	gT
>::
	$pİ_äÚt
()

43 
	`as£¹
(
	`size
() > 0);

44 
n
 = 
	`size
();

45 
i
 = 0; i < 
n
 - 1; i++)

46 
this
->
	`©
(
i
) =his->at(i + 1);

47 
	`pİ_back
();

48 
	}
}

51 
	gCLICK_ENDDECLS


	@grid/radiosim.cc

18 
	~<şick/cÚfig.h
>

19 
	~"¿diosim.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

23 
	~<m©h.h
>

24 
	~"–em’ts/grid/f‹rby¿nge.hh
"

25 
CLICK_DECLS


27 
	gRadioSim
::
	$RadioSim
()

28 : 
	`_sk
(
this
), 
	$_u£_xy
(
çl£
)

30 
	}
}

32 
	gRadioSim
::~
	$RadioSim
()

34 
	}
}

37 
RadioSim
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39 
	gi
;

41 
	g_nodes
.
ş—r
();

42 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++){

44 
SŒšg
 
	gkw
;

45 
SŒšg
 
	g»¡
;

46 ià(
ı_keywÜd
(
cÚf
[
i
], &
kw
, &
»¡
)) {

47 ià(
	gkw
 == "USE_XY") {

48 
boŞ
 
»s
 = 
BoŞArg
().
·r£
(
»¡
, 
_u£_xy
);

49 ià(!
	g»s
)

50  
	g”rh
->
”rÜ
("unableo…arse boolean‡rgo USE_XY keyword");

56 
	gVeùÜ
<
	gSŒšg
> 
	gwÜds
;

57 
ı_¥aûvec
(
cÚf
[
i
], 
wÜds
);

58 if(
	gwÜds
.
size
() != 2)

59  
”rh
->
”rÜ
("¬gum’ˆ%d dÛ¢'ˆhavÏˆªd†Ú", 
i
);

60 
	gxÏt
, 
	gxlÚ
;

61 if(!
ı_»®10
(
wÜds
[0], 5, &
xÏt
è|| !ı_»®10(wÜds[1], 5, &
xlÚ
))

62  
	g”rh
->
”rÜ
("could‚Ù…¬£†© o¸lÚ from‡rg %d", 
i
);

63 
Node
 
	gn
;

64 
	gn
.
	g_Ït
 = (()
xÏt
) / 100000.0;

65 
	gn
.
	g_lÚ
 = (()
xlÚ
) / 100000.0;

66 
	g_nodes
.
push_back
(
n
);

73 
	gRadioSim
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

75 
n
, 
i
;

77 
n
 = 
	`nšputs
();

78 
	`as£¹
(
n
 =ğ
	`nouuts
());

79 
i
 = 
_nodes
.
	`size
(); i < 
n
; i++){

80 
Node
 
no
;

81 
no
.
_Ït
 = 0;

82 
no
.
_lÚ
 = 0;

83 
_nodes
.
	`push_back
(
no
);

86 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

89 
	}
}

91 
boŞ


92 
	gRadioSim
::
	$run_sk
(
Task
 *)

94 
š
, 
out
;

96 
š
 = 0; iÀ< 
	`nšputs
(); in++){

97 
Pack‘
 *
p
 = 
	`šput
(
š
).
	`puÎ
();

98 if(
p
){

99 
out
 = 0; ouˆ< 
	`nouuts
(); out++){

100 
r
;

101 ià(
_u£_xy
) {

102 
dx
 = 
_nodes
[
š
].
_Ït
 - _nodes[
out
]._lat;

103 
dy
 = 
_nodes
[
š
].
_lÚ
 - _nodes[
out
]._lon;

104 
r
 = 
	`sq¹
(
dx
*dx + 
dy
*dy);

107 
grid_loÿtiÚ
 
g1
 = 
	`grid_loÿtiÚ
(
_nodes
[
š
].
_Ït
, _nodes[š].
_lÚ
);

108 
grid_loÿtiÚ
 
g2
 = 
	`grid_loÿtiÚ
(
_nodes
[
out
].
_Ït
, _nodes[out].
_lÚ
);

109 
r
 = 
grid_loÿtiÚ
::
	`ÿlc_¿nge
(
g1
, 
g2
);

111 ià(
r
 < 250){

112 
	`ouut
(
out
).
	`push
(
p
->
	`şÚe
());

115 
p
->
	`kl
();

119 
_sk
.
	`ç¡_»scheduË
();

120  
Œue
;

121 
	}
}

123 
	gRadioSim
::
Node


124 
RadioSim
::
	$g‘_node_loc
(
i
)

126 if(
i
 >ğ0 && i < 
_nodes
.
	`size
())

127  
_nodes
[
i
];

129  
	`Node
(0, 0);

130 
	}
}

133 
	gRadioSim
::
	$£t_node_loc
(
i
, 
Ït
, 
lÚ
)

135 if(
i
 >ğ0 && i < 
_nodes
.
	`size
()){

136 
_nodes
[
i
].
_Ït
 = 
Ït
;

137 
_nodes
[
i
].
_lÚ
 = 
lÚ
;

139 
	}
}

144 
	gRadioSim
::
	$rs_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–em’t
,

145 *, 
E¼ÜHªdËr
 *
”rh
)

147 
RadioSim
 *
l
 = (RadioSim *è
–em’t
;

148 
VeùÜ
<
SŒšg
> 
wÜds
;

149 
	`ı_¥aûvec
(
¬g
, 
wÜds
);

150 
xi
, 
xÏt
, 
xlÚ
;

151 if(
wÜds
.
	`size
() != 3 ||

152 !
	`IÁArg
(10).
	`·r£
(
wÜds
[0], 
xi
) ||

153 !
	`ı_»®10
(
wÜds
[1], 5, &
xÏt
) ||

154 !
	`ı_»®10
(
wÜds
[2], 5, &
xlÚ
))

155  
”rh
->
	`”rÜ
("%s:ƒx³ùšg‚ode-šdex†©†Ú", 
l
->
	`Çme
().
	`c_¡r
());

156 if(
xi
 >ğ0 && x˜< 
l
->
	`Âodes
()){

157 
Ït
 = (()
xÏt
) / 100000.0;

158 
lÚ
 = (()
xlÚ
) / 100000.0;

159 
l
->
	`£t_node_loc
(
xi
, 
Ït
, 
lÚ
);

162  
”rh
->
	`”rÜ
("%s: iÎeg® index %d", 
l
->
	`Çme
().
	`c_¡r
(), 
xi
);

164 
	}
}

166 
SŒšg


167 
	gRadioSim
::
	$rs_»ad_hªdËr
(
EËm’t
 *
f
, *)

169 
RadioSim
 *
l
 = (RadioSim *è
f
;

170 
SŒšg
 
s
;

171 
i
, 
n
;

173 
n
 = 
l
->
	`Âodes
();

174 
i
 = 0; i < 
n
; i++){

175 
Node
 
n
 = 
l
->
	`g‘_node_loc
(
i
);

176 cÚ¡ 
BUFSZ
 = 255;

177 
buf
[
BUFSZ
];

178 
	`¢´štf
(
buf
, 
BUFSZ
, "%d %à%f\n", 
i
, 
n
.
_Ït
,‚.
_lÚ
);

179 
s
 +ğ
buf
;

181  
s
;

182 
	}
}

185 
	gRadioSim
::
	$add_hªdËrs
()

187 
	`add_wr™e_hªdËr
("loc", 
rs_wr™e_hªdËr
, 0);

188 
	`add_»ad_hªdËr
("loc", 
rs_»ad_hªdËr
, 0);

189 
	}
}

191 
CLICK_ENDDECLS


192 
	$ELEMENT_REQUIRES
(
F‹rByRªge
)

193 
	`EXPORT_ELEMENT
(
RadioSim
)

	@grid/radiosim.hh

1 #iâdeà
RADIOSIM_HH


2 
	#RADIOSIM_HH


	)

39 
	~<şick/–em’t.hh
>

40 
	~<şick/veùÜ.hh
>

41 
	~"grid.hh
"

42 
	~<şick/sk.hh
>

43 
CLICK_DECLS


45 şas 
	cRadioSim
 : 
public
 
EËm’t
 {

47 
public
:

49 
	$RadioSim
(è
CLICK_COLD
;

50 ~
	$RadioSim
(è
CLICK_COLD
;

52 cÚ¡ *
	$şass_Çme
() const {  "RadioSim"; }

53 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/-"; 
	}
}

54 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL_TO_PUSH
; 
	}
}

55 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

56 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

57 
	$add_hªdËrs
(è
CLICK_COLD
;

59 
boŞ
 
	`run_sk
(
Task
 *);

63 
´iv©e
:

65 
	sNode
 {

66 
_Ït
;

67 
_lÚ
;

68 
	`Node
(
Ï
, 
lo
è: 
	`_Ït
Öa), 
	`_lÚ
(lo) { }

69 
	`Node
(è: 
	`_Ït
(0), 
	`_lÚ
(0) { }

70 
	}
};

72 
Node
 
g‘_node_loc
(
i
);

73 
£t_node_loc
(
i
, 
Ït
, 
lÚ
);

74 
	$Âodes
(è{ (
_nodes
.
	`size
()); 
	}
}

76 
	$rs_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

77 
SŒšg
 
	$rs_»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

79 
VeùÜ
<
Node
> 
_nodes
;

80 
Task
 
_sk
;

82 
boŞ
 
_u£_xy
;

83 
	}
};

85 
	gCLICK_ENDDECLS


	@grid/region.cc

18 
	~<şick/cÚfig.h
>

19 
	~<¡dio.h
>

20 
	~"»giÚ.hh
"

21 
CLICK_DECLS


24 
	$max
(
a
, 
b
)

25 {  
a
 > 
b
 ?‡ : b; 
	}
}

28 
	$mš
(
a
, 
b
)

29 {  
a
 > 
b
 ? b :‡; 
	}
}

31 
SŒšg


32 
	gReùRegiÚ
::
	$s
()

34 
buf
[200];

35 ià(
	`em±y
())

36 
	`¢´štf
(
buf
, 200, "<empty„gn>");

38 
	`¢´štf
(
buf
, 200, "(%f, %fè+%à+%f", 
_x
, 
_y
, 
_w
, 
_h
);

39  
	`SŒšg
(
buf
);

40 
	}
}

42 
ReùRegiÚ


43 
	gReùRegiÚ
::
	$š‹r£ù
(
ReùRegiÚ
 &
r
)

45 
ReùRegiÚ
 
»t
;

46 ià(
	`em±y
(è|| 
r
.empty())

47  
r
;

48 ià(!(
r
.
_x
 > _x + 
_w
 ||

49 
r
.
_x
 +„.
_w
 < _x ||

50 
r
.
_y
 > _y + 
_h
 ||

51 
r
.
_y
 +„.
_h
 < _y)) {

52 
»t
.
_x
 = 
	`max
(_x, 
r
._x);

53 
»t
.
_y
 = 
	`max
(_y, 
r
._y);

54 
»t
.
_w
 = 
	`mš
(
_x
 + _w, 
r
._x +„._w) -„et._x;

55 
»t
.
_h
 = 
	`mš
(
_y
 + _h, 
r
._h +„._h) -„et._y;

57  
»t
;

58 
	}
}

61 
ReùRegiÚ


62 
	gReùRegiÚ
::
	$ex·nd
(
l
)

64 
ReùRegiÚ
 
	`r
(*
this
);

65 
r
.
_x
 -ğ
l
;

66 
r
.
_y
 -ğ
l
;

67 
r
.
_w
 +ğ2 * 
l
;

68 
r
.
_h
 +ğ2 * 
l
;

69  
r
;

70 
	}
}

72 
CLICK_ENDDECLS


73 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

74 
	`ELEMENT_PROVIDES
(
ReùRegiÚ
)

	@grid/region.hh

1 #iâdeà
REGION_HH


2 
	#REGION_HH


	)

4 
	~<şick/¡ršg.hh
>

5 
CLICK_DECLS


7 şas 
	cReùRegiÚ
 {

9 
	mpublic
:

13 
	$ReùRegiÚ
(
x_bl
, 
y_bl
, 
width
, 
height
) :

14 
	`_x
(
x_bl
), 
	`_y
(
y_bl
), 
	`_w
(
width
), 
	$_h
(
height
)

15 { 
	`as£¹
(
width
 >ğ0);‡s£¹(
height
 >= 0); }

18 
	$ReùRegiÚ
(
x
, 
y
è: 
	`_x
(x), 
	`_y
(y), 
	`_w
(0), 
	$_h
(0è{ 
	}
}

21 
	$ReùRegiÚ
(
x
, 
y
, 
l
è: 
	`_x
(x-l/2), 
	`_y
(y-l/2), 
	`_w
Ö), 
	$_h
(
l
è{ 
	}
}

25 
	$ReùRegiÚ
(è: 
	`_x
(0), 
	`_y
(0), 
	`_w
(-1), 
	`_h
(-1è{ 
	}
}

28 
ReùRegiÚ
 
š‹r£ù
(ReùRegiÚ &
r
);

30 
ReùRegiÚ
 
ex·nd
(
l
);

32 
boŞ
 
	$cÚšs
(
x
, 
y
)

33 {  (
x
 >ğ
_x
è&& (x <ğ_x + 
_w
è&& (
y
 >ğ
_y
è&& (y <ğ_y + 
_h
); 
	}
}

35 
boŞ
 
	$em±y
(è{  
_w
 < 0 || 
_h
 < 0; 
	}
}

37 
	$x
(è{  
_x
; 
	}
};

38 
	$y
(è{  
_y
; 
	}
};

39 
	$w
(è{  
_w
; 
	}
};

40 
	$h
(è{  
_h
; 
	}
};

42 
	$ûÁ”_x
(è{  
_x
 + 
_w
/2; 
	}
}

43 
	$ûÁ”_y
(è{  
_y
 + 
_h
/2; 
	}
}

45 
SŒšg
 
s
();

47 
	g´iv©e
:

49 
_x
;

50 
	g_y
;

52 
	g_w
;

53 
	g_h
;

56 
	gCLICK_ENDDECLS


	@grid/regionpep.cc

18 
	~<şick/cÚfig.h
>

19 
	~"»giÚ³p.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~"grid.hh
"

23 
CLICK_DECLS


25 
	gE¡im©eRou‹rRegiÚ
::
	$E¡im©eRou‹rRegiÚ
()

26 : 
	$_tim”
(
this
)

28 
_fixed
 = 
çl£
;

29 
_£q
 = 1;

30 
_debug
 = 
çl£
;

31 
	}
}

33 
	gE¡im©eRou‹rRegiÚ
::~
	$E¡im©eRou‹rRegiÚ
()

35 
	}
}

38 
E¡im©eRou‹rRegiÚ
::
	$ÿ¡
(cÚ¡ *
Çme
)

40 if(
	`¡rcmp
(
Çme
, "GridLocationInfo") == 0)

41 (
this
);

42 (
GridLoÿtiÚInfo
::
	`ÿ¡
(
Çme
));

43 
	}
}

46 
	gE¡im©eRou‹rRegiÚ
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

48 
	gÏt_št
 = 0, 
	glÚ_št
 = 0;

49 
boŞ
 
	gfixed
 = 
çl£
;

50 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

51 .
»ad_mp
("IP", 
_my_
)

52 .
»ad_p
("FIXED", 
fixed
)

53 .
»ad_p
("LATITUDE", 
Decim®FixedPoštArg
(5), 
Ït_št
)

54 .
»ad_p
("LONGITUDE", 
Decim®FixedPoštArg
(5), 
lÚ_št
)

55 .
com¶‘e
();

56 if(
	g»s
 < 0)

57 (
	g»s
);

59 if(
	gfixed
){

60 
	gÏt
 = ((è
Ït_št
) / 100000.0f;

61 
	glÚ
 = ((è
lÚ_št
) / 100000.0f;

62 ià(
	gÏt
 > 90 ||†at < -90)

63  
	g”rh
->
”rÜ
("%s:†atitude must be between +/- 90 degrees",

64 
Çme
().
c_¡r
());

65 ià(
	glÚ
 > 180 ||†on < -180)

66  
	g”rh
->
”rÜ
("%s:†ongitude must be between +/- 180 degrees",

67 
Çme
().
c_¡r
());

68 
	g_Ït
 = 
Ït
;

69 
	g_lÚ
 = 
lÚ
;

70 
	g_fixed
 = 
Œue
;

77 
	gE¡im©eRou‹rRegiÚ
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

79 
_tim”
.
	`š™Ÿlize
(
this
);

80 
_tim”
.
	`scheduË_aá”_m£c
(
³p_upd©e
 * 1000);

82 
	}
}

85 
	gE¡im©eRou‹rRegiÚ
::
	$run_tim”
(
Tim”
 *)

87 
	`purge_Şd
();

88 
	`ouut
(0).
	`push
(
	`make_PEP
());

89 
_tim”
.
	`scheduË_aá”_m£c
(
	`şick_¿ndom
(è% (
³p_upd©e
 * 1000 * 2));

90 
	}
}

93 
	gE¡im©eRou‹rRegiÚ
::
	$purge_Şd
()

95 
Time¡amp
 
tv
 = Time¡amp::
	`now
();

97 
i
 = 0;

98 
j
;

99 
j
 = 0; j < 
_’Œ›s
.
	`size
(); j++){

100 if(
tv
.
	`£c
(è- 
_’Œ›s
[
j
].
_wh’
.£c(è<ğ
³p_purge
){

101 
_’Œ›s
[
i
++] = _’Œ›s[
j
];

103 if(
_debug
)

104 
	`şick_ch©‹r
("EstimateRouterRegion %s %s:…urging oldƒntry for %s (%d %d %d)",

105 
	`Çme
().
	`c_¡r
(),

106 
_my_
.
	`uÅ¬£
().
	`c_¡r
(),

107 
	`IPAdd»ss
(
_’Œ›s
[
j
].
_fix
.
fix_id
).
	`uÅ¬£
().
	`c_¡r
(),

108 (è
_’Œ›s
[
j
].
_wh’
.
	`£c
(),

109 (è
tv
.
	`£c
(),

110 
³p_purge
);

114 
EÁry
 
dud
;

115 
_’Œ›s
.
	`»size
(
i
, 
dud
);

116 
	}
}

119 
	gE¡im©eRou‹rRegiÚ
::
	$sÜt_’Œ›s
()

121 
n
 = 
_’Œ›s
.
	`size
();

122 
i
, 
j
;

124 
i
 = 0; i < 
n
; i++){

125 
h
 = 
_’Œ›s
[
i
].
_fix
.
fix_hİs
;

126 
j
 = 
i
 + 1; j < 
n
; j++){

127 if(
_’Œ›s
[
j
].
_fix
.
fix_hİs
 < 
h
){

128 
EÁry
 
tmp
 = 
_’Œ›s
[
i
];

129 
_’Œ›s
[
i
] = _’Œ›s[
j
];

130 
_’Œ›s
[
j
] = 
tmp
;

134 
	}
}

137 
boŞ


138 
	gE¡im©eRou‹rRegiÚ
::
	$£ndabË
(
EÁry
 
e
)

140 
Time¡amp
 
tv
 = Time¡amp::
	`now
();

142 if(
e
.
_wh’
.
	`£c
(è+ 
³p_¡®e
 > 
tv
.sec() &&

143 
e
.
_fix
.
fix_hİs
 < 
³p_max_hİs
){

144 (
Œue
);

147 (
çl£
);

148 
	}
}

151 
	gE¡im©eRou‹rRegiÚ
::
	$ex‹º®ize
(
³p_rgn_fix
 *
å
)

153 
å
->
fix_£q
 = 
	`htÚl
(fp->fix_seq);

154 
å
->
fix_hİs
 = 
	`htÚl
(fp->fix_hops);

155 
	}
}

158 
	gE¡im©eRou‹rRegiÚ
::
	$š‹º®ize
(
³p_rgn_fix
 *
å
)

160 
å
->
fix_£q
 = 
	`Áohl
(fp->fix_seq);

161 
å
->
fix_hİs
 = 
	`Áohl
(fp->fix_hops);

162 
	}
}

164 
Pack‘
 *

165 
	gE¡im©eRou‹rRegiÚ
::
	$make_PEP
()

167 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
((
³p_rgn_´Ùo
));

168 
	`mem£t
(
p
->
	`d©a
(), 0,…->
	`Ëngth
());

170 
³p_rgn_´Ùo
 *
µ
 = (³p_rgn_´ÙØ*è
p
->
	`d©a
();

171 
µ
->
id
 = 
_my_
.
	`addr
();

172 
nf
 = 0;

174 if(
_fixed
){

175 
³p_rgn_fix
 *
f
 = 
µ
->
fixes
 + 
nf
;

176 
nf
++;

177 
f
->
fix_id
 = 
_my_
.
	`addr
();

178 
f
->
fix_£q
 = 
	`htÚl
(
_£q
++);

179 
f
->
fix_loc
 = 
	`grid_loÿtiÚ
(
_Ït
, 
_lÚ
);

180 
f
->
fix_dim
 = 
	`grid_loÿtiÚ
(0, 0);

181 
f
->
fix_hİs
 = 
	`htÚl
(0);

183 ià(
_’Œ›s
.
	`size
() > 0) {

185 
³p_rgn_fix
 *
f
 = 
µ
->
fixes
 + 
nf
;

186 
nf
++;

187 
f
->
fix_id
 = 
_my_
.
	`addr
();

188 
f
->
fix_£q
 = 
	`htÚl
(
_£q
++);

189 
ReùRegiÚ
 
rgn
 = 
	`bud_»giÚ
();

190 
f
->
fix_loc
 = 
	`grid_loÿtiÚ
(
rgn
.
	`y
(),„gn.
	`x
());

191 
f
->
fix_dim
 = 
	`grid_loÿtiÚ
(
rgn
.
	`h
(),„gn.
	`w
());

192 
f
->
fix_hİs
 = 
	`htÚl
(0);

195 
	`sÜt_’Œ›s
();

197 
i
;

198 
i
 = 0; i < 
_’Œ›s
.
	`size
(è&& 
nf
 < 
³p_´Ùo_fixes
; i++){

199 if(
	`£ndabË
(
_’Œ›s
[
i
])){

200 
µ
->
fixes
[
nf
] = 
_’Œ›s
[
i
].
_fix
;

201 
	`ex‹º®ize
(&(
µ
->
fixes
[
nf
]));

202 
nf
++;

206 
µ
->
n_fixes
 = 
	`htÚl
(
nf
);

208  
p
;

209 
	}
}

212 
	gE¡im©eRou‹rRegiÚ
::
	$fšdEÁry
(
id
, 
boŞ
 
ü—‹
)

214 
i
;

216 
i
 = 0; i < 
_’Œ›s
.
	`size
(); i++)

217 if(
_’Œ›s
[
i
].
_fix
.
fix_id
 =ğ
id
)

218 (
i
);

220 ià(
ü—‹
) {

221 ià(
_debug
)

222 
	`şick_ch©‹r
("EstimateRouterRegion %s %s:‚ewƒntry for %s",

223 
this
->
	`Çme
().
	`c_¡r
(),

224 
_my_
.
	`uÅ¬£
().
	`c_¡r
(),

225 
	`IPAdd»ss
(
id
).
	`uÅ¬£
().
	`c_¡r
());

226 
i
 = 
_’Œ›s
.
	`size
();

227 
EÁry
 
e
;

228 
e
.
_fix
.
fix_id
 = 
id
;

229 
e
.
_fix
.
fix_hİs
 = -1;

230 
e
.
_fix
.
fix_£q
 = -1;

231 
_’Œ›s
.
	`push_back
(
e
);

232 
	`as£¹
(
_’Œ›s
.
	`size
(è=ğ
i
+1 && _’Œ›s[i].
_fix
.
fix_id
 =ğ
id
);

233 (
i
);

237 
	}
}

239 
Pack‘
 *

240 
	gE¡im©eRou‹rRegiÚ
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

242 
nf
;

243 
³p_rgn_´Ùo
 *
µ
;

244 
Time¡amp
 
tv
 = Time¡amp::
	`now
();

246 if(
p
->
	`Ëngth
(è!ğ(
³p_rgn_´Ùo
)) {

247 
	`şick_ch©‹r
("E¡im©eRou‹rRegiÚ: bad siz·ck‘ (%d by‹s)", 
p
->
	`Ëngth
());

248 
out
;

251 
µ
 = (
³p_rgn_´Ùo
 *è
p
->
	`d©a
();

252 
nf
 = 
	`Áohl
(
µ
->
n_fixes
);

253 if(
nf
 < 0 || (cÚ¡ 
u_ch¬
*)&
µ
->
fixes
[nf] > 
p
->
	`d©a
()+p->
	`Ëngth
()){

254 
	`şick_ch©‹r
("E¡im©eRou‹rRegiÚ: bad‚_fixe %d", 
nf
);

255 
out
;

258 
i
;

259 
i
 = 0; i < 
nf
 && i < 
³p_´Ùo_fixes
; i++){

260 
³p_rgn_fix
 
f
 = 
µ
->
fixes
[
i
];

261 
	`š‹º®ize
(&
f
);

262 if(
f
.
fix_id
 =ğ
_my_
.
	`addr
())

264 
j
 = 
	`fšdEÁry
(
f
.
fix_id
, 
Œue
);

265 if(
j
 < 0)

268 
os
 = 
_’Œ›s
[
j
].
_fix
.
fix_£q
;

269 
oh
 = 
_’Œ›s
[
j
].
_fix
.
fix_hİs
;

270 if(
f
.
fix_£q
 > 
os
 ||

271 (
f
.
fix_£q
 =ğ
os
 && (f.
fix_hİs
+1è< 
oh
)){

272 
_’Œ›s
[
j
].
_fix
 = 
f
;

273 
_’Œ›s
[
j
].
_fix
.
fix_hİs
++;

274 
_’Œ›s
[
j
].
_wh’
 = 
tv
;

275 if(
_debug
 && 
f
.
fix_hİs
 !ğ
oh
)

276 
	`şick_ch©‹r
("EstimateRouterRegion %s %s: updating %s, seq %d -> %d, hops %d -> %d, my…os %s",

277 
	`Çme
().
	`c_¡r
(),

278 
_my_
.
	`uÅ¬£
().
	`c_¡r
(),

279 
	`IPAdd»ss
(
f
.
fix_id
).
	`uÅ¬£
().
	`c_¡r
(),

280 
os
,

281 
f
.
fix_£q
,

282 
oh
,

283 
f
.
fix_hİs
,

284 
	`g‘_cu¼’t_loÿtiÚ
().
	`s
().
	`c_¡r
());

288 
out
:

289 
p
->
	`kl
();

291 
	}
}

294 
	gE¡im©eRou‹rRegiÚ
::
	$¿dio_¿nge
(
grid_loÿtiÚ
)

295 {  0.002; 
	}
}

297 
ReùRegiÚ


298 
	gE¡im©eRou‹rRegiÚ
::
	$bud_»giÚ
()

300 
³p_rgn_fix
 
f
 = 
_’Œ›s
[0].
_fix
;

301 
ReùRegiÚ
 
	`rgn
(
f
.
fix_loc
.
	`lÚ
(), f.fix_loc.
	`Ït
(), f.
fix_dim
.lon(), f.fix_dim.lat());

302 
rgn
 =„gn.
	`ex·nd
(
f
.
fix_hİs
 * 
	`¿dio_¿nge
(f.
fix_loc
));

304 
num_sks
 = 0;

305 
i
 = 1; i < 
_’Œ›s
.
	`size
(); i++) {

306 
f
 = 
_’Œ›s
[
i
].
_fix
;

307 
ReùRegiÚ
 
	`rgn2
(
f
.
fix_loc
.
	`lÚ
(), f.fix_loc.
	`Ït
(), f.
fix_dim
.lon(), f.fix_dim.lat());

308 
rgn2
 =„gn2.
	`ex·nd
(
f
.
fix_hİs
 * 
	`¿dio_¿nge
(f.
fix_loc
));

310 
ReùRegiÚ
 
Ãw_rgn
 = 
rgn2
.
	`š‹r£ù
(
rgn
);

311 ià(
Ãw_rgn
.
	`em±y
()) {

312 
	`şick_ch©‹r
("E¡im©eRou‹rRegiÚ %s: skpšg„egiÚ which would„esuÉ iÀem±y iÁ”£ùiÚ (%d)", 
	`Çme
().
	`c_¡r
(), ++
num_sks
);

315 
rgn
 = 
Ãw_rgn
;

318  
rgn
;

319 
	}
}

321 
grid_loÿtiÚ


322 
	gE¡im©eRou‹rRegiÚ
::
	$g‘_cu¼’t_loÿtiÚ
()

324 if(
_fixed
)

325 (
	`grid_loÿtiÚ
(
_Ït
, 
_lÚ
));

327 if(
_’Œ›s
.
	`size
() < 1)

328 (
	`grid_loÿtiÚ
(0.0, 0.0));

330 
ReùRegiÚ
 
rgn
 = 
	`bud_»giÚ
();

331  
	`grid_loÿtiÚ
(
rgn
.
	`ûÁ”_y
(),„gn.
	`ûÁ”_x
());

332 
	}
}

334 
SŒšg


335 
	$³p_»ad_hªdËr
(
EËm’t
 *
f
, *)

337 
E¡im©eRou‹rRegiÚ
 *
l
 = (E¡im©eRou‹rRegiÚ *è
f
;

338 (
l
->
	`s
());

339 
	}
}

341 
SŒšg


342 
	gE¡im©eRou‹rRegiÚ
::
	$s
()

344 
SŒšg
 
s
;

345 
i
, 
n
;

346 
Time¡amp
 
now
 = Time¡amp::
	`now
();

348 if(
_fixed
){

349 
s
 = 
_my_
.
	`uÅ¬£
() + " " +

350 
	`grid_loÿtiÚ
(
_Ït
, 
_lÚ
).
	`s
() + "\n";

352 
s
 = 
_my_
.
	`uÅ¬£
() + "\n";

355 
s
 +ğ
	`g‘_cu¼’t_loÿtiÚ
().
	`s
() + "\n";

357 
n
 = 
_’Œ›s
.
	`size
();

358 
i
 = 0; i < 
n
; i++){

359 
³p_rgn_fix
 
f
 = 
_’Œ›s
[
i
].
_fix
;

360 
buf
[512];

361 
	`¢´štf
(
buf
, (buf), "%s seq=%d %s hops=%d‡ge=%d\n",

362 
	`IPAdd»ss
(
f
.
fix_id
).
	`uÅ¬£
().
	`c_¡r
(),

363 
f
.
fix_£q
,

364 
f
.
fix_loc
.
	`s
().
	`c_¡r
(),

365 
f
.
fix_hİs
,

366 ()(
now
.
	`£c
(è- 
_’Œ›s
[
i
].
_wh’
.sec()));

367 
s
 +ğ
buf
;

369  
s
;

370 
	}
}

373 
	gE¡im©eRou‹rRegiÚ
::
	$add_hªdËrs
()

375 
	`add_»ad_hªdËr
("¡©us", 
³p_»ad_hªdËr
, 0);

376 
	}
}

378 
CLICK_ENDDECLS


379 
	$ELEMENT_REQUIRES
(
GridLoÿtiÚInfo
 
AmÛba
 
ReùRegiÚ
)

380 
	`EXPORT_ELEMENT
(
E¡im©eRou‹rRegiÚ
)

	@grid/regionpep.hh

1 #iâdeà
rgÅ•_hh


2 
	#rgÅ•_hh


	)

14 
	~<şick/–em’t.hh
>

15 
	~<şick/tim”.hh
>

16 
	~<şick/add»ss.hh
>

17 
	~"³p_´Ùo.hh
"

18 
	~"grid.hh
"

19 
	~"–em’ts/grid/gridloÿtiÚšfo.hh
"

20 
	~"»giÚ.hh
"

21 
CLICK_DECLS


23 şas 
	cE¡im©eRou‹rRegiÚ
 : 
public
 
GridLoÿtiÚInfo
 {

25 
public
:

27 
	$E¡im©eRou‹rRegiÚ
(è
CLICK_COLD
;

28 ~
	$E¡im©eRou‹rRegiÚ
(è
CLICK_COLD
;

30 cÚ¡ *
	$şass_Çme
() const {  "EstimateRouterRegion"; }

31 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

32 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

34 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

35 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

36 
vœtu®
 *
	`ÿ¡
(const *);

37 
	`run_tim”
(
Tim”
 *);

38 
	$add_hªdËrs
(è
CLICK_COLD
;

39 
Pack‘
 *
	`sim¶e_aùiÚ
(Pack‘ *
p
);

41 
grid_loÿtiÚ
 
	`g‘_cu¼’t_loÿtiÚ
();

42 
SŒšg
 
	`s
();

44 
boŞ
 
_debug
;

46 
´iv©e
:

48 
IPAdd»ss
 
_my_
;

49 
Tim”
 
_tim”
;

51 
boŞ
 
_fixed
;

52 
_Ït
;

53 
_lÚ
;

54 
_£q
;

56 
	sEÁry
 {

57 
Time¡amp
 
_wh’
;

58 
³p_rgn_fix
 
_fix
;

59 
	}
};

60 
	gVeùÜ
<
	gEÁry
> 
	g_’Œ›s
;

61 
fšdEÁry
(
id
, 
boŞ
 
®loÿ‹
);

63 
ReùRegiÚ
 
bud_»giÚ
();

65 
purge_Şd
();

66 
sÜt_’Œ›s
();

67 
boŞ
 
£ndabË
(
EÁry
);

68 
ex‹º®ize
(
³p_rgn_fix
 *);

69 
š‹º®ize
(
³p_rgn_fix
 *);

70 
Pack‘
 *
make_PEP
();

71 
¿dio_¿nge
(
grid_loÿtiÚ
);

74 
	gCLICK_ENDDECLS


	@grid/setgridchecksum.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/¬gs.hh
>

21 
	~"£tgridchecksum.hh
"

22 
	~<şick/glue.hh
>

23 
	~"grid.hh
"

24 
	~<şickÃt/‘h”.h
>

25 
	~<şickÃt/.h
>

26 
CLICK_DECLS


28 
	gS‘GridChecksum
::
	$S‘GridChecksum
()

30 
	}
}

32 
S‘GridChecksum
::~
	$S‘GridChecksum
()

34 
	}
}

36 
Pack‘
 *

37 
S‘GridChecksum
::
	$sim¶e_aùiÚ
(
Pack‘
 *
xp
)

39 
Wr™abËPack‘
 *
p
 = 
xp
->
	`uniqueify
();

40 
grid_hdr
 *
gh
 = (grid_hd¸*è(
p
->
	`d©a
(è+ (
şick_‘h”
));

41 
¶’
 = 
p
->
	`Ëngth
();

42 
’
 = 
	`Áohs
(
gh
->
tÙ®_Ën
);

44 ià(!
gh
 || 
¶’
 < (
grid_hdr
è+ (
şick_‘h”
))

45 
bad
;

48 
’
 > 
¶’
 - (
şick_‘h”
))

49 
bad
;

51 
gh
->
v”siÚ
 = 
	`htÚl
(
grid_hdr
::
GRID_VERSION
);

53 
gh
->
cksum
 = 0;

54 
gh
->
cksum
 = 
	`şick_š_cksum
((*ègh, 
’
);

56  
p
;

58 
bad
:

59 
	`şick_ch©‹r
("SetGridChecksum: bad†engths");

60 
p
->
	`kl
();

62 
	}
}

64 
CLICK_ENDDECLS


65 
EXPORT_ELEMENT
(
S‘GridChecksum
)

	@grid/setgridchecksum.hh

1 #iâdeà
SETGRIDCHECKSUM_HH


2 
	#SETGRIDCHECKSUM_HH


	)

15 
	~<şick/–em’t.hh
>

16 
	~<şick/glue.hh
>

17 
CLICK_DECLS


19 şas 
	cS‘GridChecksum
 : 
public
 
EËm’t
 {

20 
public
:

21 
	$S‘GridChecksum
(è
CLICK_COLD
;

22 ~
	$S‘GridChecksum
(è
CLICK_COLD
;

24 cÚ¡ *
	$şass_Çme
() const {  "SetGridChecksum"; }

25 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

26 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

28 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

31 
	gCLICK_ENDDECLS


	@grid/simplelocquerier.cc

18 
	~<şick/cÚfig.h
>

19 
	~"sim¶–ocqu”›r.hh
"

20 
	~<şickÃt/‘h”.h
>

21 
	~<şick/‘h”add»ss.hh
>

22 
	~<şick/add»ss.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/b™veùÜ.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/glue.hh
>

27 
CLICK_DECLS


29 
	gSim¶eLocQu”›r
::
	$Sim¶eLocQu”›r
()

31 
	}
}

33 
Sim¶eLocQu”›r
::~
	$Sim¶eLocQu”›r
()

35 
	}
}

39 
Sim¶eLocQu”›r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

42 
IPAdd»ss
 
	g
;

43 
	g©
, 
	gÚ
;

44 ià(
Args
(
this
, 
”rh
).
push_back_wÜds
(
cÚf
[
i
])

45 .
»ad_mp
("IP", 

)

46 .
»ad_mp
("LATITUDE", 
Decim®FixedPoštArg
(7), 
©
)

47 .
»ad_mp
("LONGITUDE", 
Decim®FixedPoštArg
(7), 
Ú
)

48 .
com¶‘e
() < 0)

50 
grid_loÿtiÚ
 
loc
((è
©
 / 1.0e7, (è
Ú
 / 1.0e7);

51 
	g_locs
.
š£¹
(

, 
loc
);

57 
	gSim¶eLocQu”›r
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

60 
	}
}

66 
	gSim¶eLocQu”›r
::
	$push
(, 
Pack‘
 *
p
)

68 
Wr™abËPack‘
 *
wp
 = 
p
->
	`uniqueify
();

69 
grid_nbr_’ÿp
 *
nb
 = (grid_nbr_’ÿ°*è(
p
->
	`d©a
(è+ (
grid_hdr
è+ (
şick_‘h”
));

70 
IPAdd»ss
 
	`d¡_
(
nb
->
d¡_
);

71 
grid_loÿtiÚ
 *
l
 = 
_locs
.
	`fšdp
(
d¡_
);

72 ià(
l
 == 0) {

73 
	`şick_ch©‹r
("SimpleLocQuerier %s: dropping…acket for %s;here is‚o†ocation information",

74 
	`Çme
().
	`c_¡r
(), 
d¡_
.
	`uÅ¬£
().c_str());

75 
wp
->
	`kl
();

78 #iâdeà
SMALL_GRID_HEADERS


79 
nb
->
d¡_loc
 = *
l
;

81 
	`ouut
(0).
	`push
(
wp
);

83 
	}
}

85 
SŒšg


86 
	gSim¶eLocQu”›r
::
	$»ad_bË
(
EËm’t
 *
e
, *)

88 
Sim¶eLocQu”›r
 *
¦q
 = (Sim¶eLocQu”›¸*è
e
;

89 
SŒšg
 
s
;

90 
locm­
::
™”©Ü
 
i
 = 
¦q
->
_locs
.
	`begš
(); i.
	`live
(); i++)

91 
s
 +ğ
i
.
	`key
().
	`uÅ¬£
(è+ " " + i.
	`v®ue
().
	`s
() + "\n";

92  
s
;

93 
	}
}

96 
	gSim¶eLocQu”›r
::
	$add_’Œy
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–em’t
,

97 *, 
E¼ÜHªdËr
 *
”rh
)

99 
Sim¶eLocQu”›r
 *
l
 = (Sim¶eLocQu”›¸*è
–em’t
;

101 
IPAdd»ss
 

;

102 
©
, 
Ú
;

103 ià(
	`Args
(
l
, 
”rh
).
	`push_back_wÜds
(
¬g
)

104 .
	`»ad_mp
("IP", 

)

105 .
	`»ad_mp
("LATITUDE", 
	`Decim®FixedPoštArg
(7), 
©
)

106 .
	`»ad_mp
("LONGITUDE", 
	`Decim®FixedPoštArg
(7), 
Ú
)

107 .
	`com¶‘e
() < 0)

109 
grid_loÿtiÚ
 
	`loc
((è
©
 / 1.0e7, (è
Ú
 / 1.0e7);

110 
l
->
_locs
.
	`š£¹
(

, 
loc
);

113 
	}
}

116 
	gSim¶eLocQu”›r
::
	$add_hªdËrs
()

118 
	`add_»ad_hªdËr
("bË", 
»ad_bË
, 0);

119 
	`add_wr™e_hªdËr
("add", 
add_’Œy
, 0);

120 
	}
}

122 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

123 
	$EXPORT_ELEMENT
(
Sim¶eLocQu”›r
)

124 
CLICK_ENDDECLS


	@grid/simplelocquerier.hh

1 #iâdeà
SIMPLELOCQUERIER_HH


2 
	#SIMPLELOCQUERIER_HH


	)

21 
	~<şick/–em’t.hh
>

22 
	~<şick/add»ss.hh
>

23 
	~<şick/bighashm­.hh
>

24 
	~"grid.hh
"

25 
CLICK_DECLS


27 şas 
	cSim¶eLocQu”›r
 : 
public
 
EËm’t
 {

28 
public
:

30 
	$Sim¶eLocQu”›r
(è
CLICK_COLD
;

31 ~
	$Sim¶eLocQu”›r
(è
CLICK_COLD
;

33 cÚ¡ *
	$şass_Çme
() const {  "SimpleLocQuerier"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

35 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

36 
	$add_hªdËrs
(è
CLICK_COLD
;

38 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

39 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

41 
	`push
(
pÜt
, 
Pack‘
 *);

44 
´iv©e
:

45 
HashM­
<
	tIPAdd»ss
, 
	tgrid_loÿtiÚ
> 
	tlocm­
;

46 
locm­
 
_locs
;

48 
	`£nd_qu”y_fÜ
(cÚ¡ 
IPAdd»ss
 &);

50 
SŒšg
 
	`»ad_bË
(
EËm’t
 *, *);

51 
	`add_’Œy
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
–em’t
, *, 
E¼ÜHªdËr
 *
”rh
);

52 
	}
};

54 
	gCLICK_ENDDECLS


	@grid/stripdsrheader.cc

22 
	~<şick/cÚfig.h
>

23 
	~"¡rd¤h—d”.hh
"

24 
	~<şick/·ck‘_ªno.hh
>

25 
	~<şickÃt/.h
>

26 
	~"d¤.hh
"

27 
CLICK_DECLS


29 
	gSŒDSRH—d”
::
	$SŒDSRH—d”
()

31 
	}
}

33 
SŒDSRH—d”
::~
	$SŒDSRH—d”
()

35 
	}
}

37 
Pack‘
 *

38 
SŒDSRH—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

40 cÚ¡ 
şick_d¤_İtiÚ
 *
d¤_İtiÚ
 = (const click_dsr_option *)

41 (
p
->
	`d©a
(è+ (
şick_
)

42 + (
şick_d¤
));

44 ià(
d¤_İtiÚ
->
d¤_ty³
 !ğ
DSR_TYPE_SOURCE_ROUTE
) {

47 
	`SET_VLAN_TCI_ANNO
(
p
, 1);

49  
p
;

52  
	`sw­_h—d”s
(
p
);

53 
	}
}

58 
Pack‘
 *

59 
	gSŒDSRH—d”
::
	$sw­_h—d”s
(
Pack‘
 *
p_š
)

61 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

62 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
p
->
	`d©a
());

63 
şick_d¤
 *
d¤
 = (şick_d¤ *)(
p
->
	`d©a
(è+ (
şick_
));

65 
	`as£¹
(

->
_p
 =ğ
IP_PROTO_DSR
);

68 
d¤_Ën
 = (
şick_d¤
è+ 
	`Áohs
(
d¤
->dsr_len);

71 
şick_
 
Ãw_
;

72 
	`memıy
(&
Ãw_
, 

, (
şick_
));

73 
Ãw_
.
_p
 = 
d¤
->
d¤_Ãxt_h—d”
;

76 
	`memıy
(

, 
d¤
, 
d¤_Ën
);

78 
	`SET_VLAN_TCI_ANNO
(
p
, 
	`htÚs
(
d¤_Ën
));

81 
p
->
	`puÎ
(
d¤_Ën
);

83 
	`memıy
(
p
->
	`d©a
(), &
Ãw_
, (
şick_
));

84 

=
»š‹½»t_ÿ¡
<
şick_
 *>(
p
->
	`d©a
());

85 

->
_Ën
=
	`htÚs
(
p
->
	`Ëngth
());

86 

->
_sum
=0;

87 

->
_sum
=
	`şick_š_cksum
((*),(
şick_
));

89 
p
->
	`£t__h—d”
((
şick_
*í->
	`d©a
(),(click_ip));

93  
p
;

94 
	}
}

97 
CLICK_ENDDECLS


98 
	$EXPORT_ELEMENT
(
SŒDSRH—d”
)

99 
	`ELEMENT_MT_SAFE
(
SŒDSRH—d”
)

	@grid/stripdsrheader.hh

1 #iâdeà
CLICK_STRIPDSRHEADER_HH


2 
	#CLICK_STRIPDSRHEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


36 şas 
	cSŒDSRH—d”
 : 
public
 
EËm’t
 {…ublic:

38 
	$SŒDSRH—d”
(è
CLICK_COLD
;

39 ~
	$SŒDSRH—d”
(è
CLICK_COLD
;

41 cÚ¡ *
	$şass_Çme
() const {  "StripDSRHeader"; }

42 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

44 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

46 
Pack‘
 *
sw­_h—d”s
(Packet *);

49 
	gCLICK_ENDDECLS


	@grid/threshmetric.cc

16 
	~<şick/cÚfig.h
>

17 
	~<şick/¬gs.hh
>

18 
	~<şick/”rÜ.hh
>

19 
	~"–em’ts/grid/th»shm‘ric.hh
"

20 
	~"–em’ts/grid/lšk¡©.hh
"

21 
CLICK_DECLS


23 
	gTh»shŞdM‘ric
::
	$Th»shŞdM‘ric
()

24 : 
	`_ls
(0), 
	`_th»sh
(63), 
	$_twoway
(
çl£
)

26 
	}
}

28 
	gTh»shŞdM‘ric
::~
	$Th»shŞdM‘ric
()

30 
	}
}

33 
Th»shŞdM‘ric
::
	$ÿ¡
(cÚ¡ *
n
)

35 ià(
	`¡rcmp
(
n
, "ThresholdMetric") == 0)

36  (
Th»shŞdM‘ric
 *è
this
;

37 ià(
	`¡rcmp
(
n
, "GridGenericMetric") == 0)

38  (
GridG’”icM‘ric
 *è
this
;

41 
	}
}

44 
	gTh»shŞdM‘ric
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

46 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

47 .
»ad_mp
("LINKSTAT", 
EËm’tCa¡Arg
("LškSt"), 
_ls
)

48 .
»ad
("THRESH", 
_th»sh
)

49 .
»ad
("TWOWAY", 
_twoway
)

50 .
com¶‘e
();

51 ià(
	g»s
 < 0)

52  
	g»s
;

53 ià(
	g_th»sh
 > 100)

54  
	g”rh
->
”rÜ
("THRESH keyword‡rgument isoo†arge, it must be <= 100…ercent");

59 
boŞ


60 
	gTh»shŞdM‘ric
::
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &
m1
, cÚ¡ m‘ric_ˆ&
m2
) const

62 ià(
m1
.
	`good
(è&& 
m2
.good())

63  
m1
.
	`v®
(è< 
m2
.val();

64 ià(
m2
.
	`good
())

65  
çl£
;

67  
Œue
;

68 
	}
}

70 
	gGridG’”icM‘ric
::
m‘ric_t


71 
Th»shŞdM‘ric
::
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &
e
, 
boŞ
 
d©a_£nd”
) const

73 
u_fwd
, 
u_»v
;

74 
r_fwd
, 
r_»v
;

75 
Time¡amp
 
t_fwd
;

77 
boŞ
 
»s_fwd
 = 
_ls
->
	`g‘_fÜw¬d_¿‹
(
e
, &
r_fwd
, &
u_fwd
, &
t_fwd
);

78 
boŞ
 
»s_»v
 = 
_ls
->
	`g‘_»v”£_¿‹
(
e
, &
r_»v
, &
u_»v
);

82 ià(!
d©a_£nd”
) {

83 
	`grid_sw­
(
»s_fwd
, 
»s_»v
);

84 
	`grid_sw­
(
r_fwd
, 
r_»v
);

87 ià(!
»s_fwd
 || (
_twoway
 && !
»s_»v
))

88  
_bad_m‘ric
;

89 ià(
r_»v
 =ğ0 || 
r_fwd
 == 0)

90  
_bad_m‘ric
;

92 ià(
r_fwd
 >ğ
_th»sh
 && (!
_twoway
 || 
r_»v
 >= _thresh))

93  
	`m‘ric_t
(1);

95  
_bad_m‘ric
;

96 
	}
}

98 
	gGridG’”icM‘ric
::
m‘ric_t


99 
Th»shŞdM‘ric
::
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

101 ià(!
r
.
	`good
(è|| !
l
.good())

102  
_bad_m‘ric
;

104 ià(
r
.
	`v®
() < 1)

105 
	`şick_ch©‹r
("ThresholdMetric %s:‡ppend_metric WARNING: metric %u hops isoo†ow for„oute metric",

106 
	`Çme
().
	`c_¡r
(), 
r
.
	`v®
());

107 ià(
l
.
	`v®
() != 1)

108 
	`şick_ch©‹r
("ThresholdMetric %s:‡ppend_metric WARNING: metric %u hops should be 1 for†ink metric",

109 
	`Çme
().
	`c_¡r
(), 
r
.
	`v®
());

111  
	`m‘ric_t
(
r
.
	`v®
(è+ 
l
.val());

112 
	}
}

115 
CLICK_ENDDECLS


116 
	$ELEMENT_PROVIDES
(
GridG’”icM‘ric
)

117 
	`EXPORT_ELEMENT
(
Th»shŞdM‘ric
)

	@grid/threshmetric.hh

1 #iâdeà
THRESHMETRIC_HH


2 
	#THRESHMETRIC_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"gridg’”icm‘ric.hh
"

5 
CLICK_DECLS


51 
şass
 
	gLškSt
;

53 şas 
	cTh»shŞdM‘ric
 : 
public
 
GridG’”icM‘ric
 {

55 
public
:

57 
	$Th»shŞdM‘ric
(è
CLICK_COLD
;

58 ~
	$Th»shŞdM‘ric
(è
CLICK_COLD
;

60 cÚ¡ *
	$şass_Çme
() const {  "ThresholdMetric"; }

61 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_0
; 
	}
}

62 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

64 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

65 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
çl£
; 
	}
}

67 *
ÿ¡
(const *);

70 
boŞ
 
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

71 
m‘ric_t
 
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &, 
boŞ
) const;

72 
m‘ric_t
 
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

73 
m‘ric_t
 
	$´•’d_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

74 {  
	`­³nd_m‘ric
(
r
, 
l
); 
	}
}

76 
	$sÿË_to_ch¬
(cÚ¡ 
m‘ric_t
 &
m
ècÚ¡ {  (èm.
	`v®
(); 
	}
}

77 
m‘ric_t
 
	$unsÿË_äom_ch¬
(
c
ècÚ¡ {  
	`m‘ric_t
(c); 
	}
}

79 
	g´iv©e
:

80 
LškSt
 *
_ls
;

81 
	g_th»sh
;

82 
boŞ
 
	g_twoway
;

85 
	gCLICK_ENDDECLS


	@grid/timeutils.hh

7 #iâdeà
TIMEUTIL_H


8 
	#TIMEUTIL_H


	)

10 #ifdeà
CLICK_USERLEVEL


11 
	~<m©h.h
>

13 
	~<şick/¡ršg.hh
>

14 
	~<şick/glue.hh
>

15 
CLICK_DECLS


17 
šlše
 
timev®


18 
	$htÚ
(cÚ¡ 
timev®
 &
tv
) {

19 
timev®
 
tv2
;

20 
tv2
.
tv_£c
 = 
	`htÚl
(
tv
.tv_sec);

21 
tv2
.
tv_u£c
 = 
	`htÚl
(
tv
.tv_usec);

22  
tv2
;

23 
	}
}

25 
šlše
 
timev®


26 
	$Áoh
(cÚ¡ 
timev®
 &
tv
) {

27 
timev®
 
tv2
;

28 
tv2
.
tv_£c
 = 
	`Áohl
(
tv
.tv_sec);

29 
tv2
.
tv_u£c
 = 
	`Áohl
(
tv
.tv_usec);

30  
tv2
;

31 
	}
}

33 
	gCLICK_ENDDECLS


	@grid/unstripdsrheader.cc

21 
	~<şick/cÚfig.h
>

22 
	~"un¡rd¤h—d”.hh
"

23 
	~<şick/·ck‘_ªno.hh
>

24 
	~<şickÃt/.h
>

25 
	~"d¤.hh
"

26 
CLICK_DECLS


28 
	gUn¡rDSRH—d”
::
	$Un¡rDSRH—d”
()

30 
	}
}

32 
Un¡rDSRH—d”
::~
	$Un¡rDSRH—d”
()

34 
	}
}

36 
Pack‘
 *

37 
Un¡rDSRH—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

39 ià(
	`VLAN_TCI_ANNO
(
p_š
) == 0) {

41  
p_š
;

43 ià(
	`VLAN_TCI_ANNO
(
p_š
) == 1) {

45 
	`SET_VLAN_TCI_ANNO
(
p_š
, 0);

46  
p_š
;

49 
±rdiff_t
 
d¤_Ën
 = 
	`Áohs
(
	`VLAN_TCI_ANNO
(
p_š
));

51 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

52 
şick_d¤
 *
d¤_Şd
 = 
»š‹½»t_ÿ¡
<şick_d¤ *>(
p
->
	`d©a
(è- 
d¤_Ën
);

53 
şick_d¤
 *
d¤_Ãw
 = 
»š‹½»t_ÿ¡
<şick_d¤ *>(
p
->
	`d©a
(è- 
d¤_Ën
 +

54 (
şick_
));

55 
şick_
 *

 = (şick_ *)(
p
->
	`d©a
());

58 
şick_
 
Ãw_
;

59 
	`memıy
(&
Ãw_
, 

, (
şick_
));

60 
Ãw_
.
_p
 = 
IP_PROTO_DSR
;

63 
	`memıy
(
d¤_Ãw
, 
d¤_Şd
, 
d¤_Ën
);

66 
p
 =…->
	`push
(
d¤_Ën
);

68 
	`SET_VLAN_TCI_ANNO
(
p
, 0);

70 
	`memıy
(
p
->
	`d©a
(), &
Ãw_
, (
şick_
));

71 

=
»š‹½»t_ÿ¡
<
şick_
 *>(
p
->
	`d©a
());

72 

->
_Ën
=
	`htÚs
(
p
->
	`Ëngth
());

73 

->
_sum
=0;

74 

->
_sum
=
	`şick_š_cksum
((*),(
şick_
));

76 
p
->
	`£t__h—d”
((
şick_
*í->
	`d©a
(),(click_ip));

80  
p
;

81 
	}
}

83 
CLICK_ENDDECLS


84 
	$EXPORT_ELEMENT
(
Un¡rDSRH—d”
)

85 
	`ELEMENT_MT_SAFE
(
Un¡rDSRH—d”
)

	@grid/unstripdsrheader.hh

1 #iâdeà
CLICK_UNSTRIPDSRHEADER_HH


2 
	#CLICK_UNSTRIPDSRHEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


18 şas 
	cUn¡rDSRH—d”
 : 
public
 
EËm’t
 {…ublic:

20 
	$Un¡rDSRH—d”
(è
CLICK_COLD
;

21 ~
	$Un¡rDSRH—d”
(è
CLICK_COLD
;

23 cÚ¡ *
	$şass_Çme
() const {  "UnstripDSRHeader"; }

24 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

26 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

30 
	gCLICK_ENDDECLS


	@grid/updateroutes.cc

18 
	~<şick/cÚfig.h
>

19 
	~"upd©”ou‹s.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şickÃt/‘h”.h
>

23 
	~<şickÃt/.h
>

24 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

25 
	~<şick/rou‹r.hh
>

26 
	~"grid.hh
"

27 
CLICK_DECLS


29 
	gUpd©eGridRou‹s
::
	$Upd©eGridRou‹s
(è: 
	`_max_hİs
(3),

30 
	`_h–lo_tim”
(
h–lo_hook
, 
this
),

31 
	`_expœe_tim”
(
expœe_hook
, 
this
),

32 
	`_§n™y_tim”
(
§n™y_hook
, 
this
),

33 
	`_num_upd©es_£Á
(0), 
	$_£q_no
(0)

35 
	}
}

37 
	gUpd©eGridRou‹s
::~
	$Upd©eGridRou‹s
()

39 
	}
}

44 
Upd©eGridRou‹s
::
	$ÿ¡
(cÚ¡ *
n
)

46 ià(
	`¡rcmp
(
n
, "UpdateGridRoutes") == 0)

47  (
Upd©eGridRou‹s
 *)
this
;

50 
	}
}

55 
	gUpd©eGridRou‹s
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

57 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

58 .
»ad_mp
("TIMEOUT", 
_timeout
)

59 .
»ad_mp
("PERIOD", 
_³riod
)

60 .
»ad_mp
("JITTER", 
_j™‹r
)

61 .
»ad_mp
("ETH", 
_‘haddr
)

62 .
»ad_mp
("IP", 
_addr
)

63 .
»ad_p
("MAXHOPS", 
_max_hİs
)

64 .
com¶‘e
();

65 ià(
	g»s
 < 0)

66  
	g»s
;

69 ià(
	g_timeout
 == 0)

70 
_timeout
 = -1;

71 ià(
	g_timeout
 > 0) {

72 
	g_timeout_jiff›s
 = (
CLICK_HZ
 * 
_timeout
) / 1000;

73 ià(
	g_timeout_jiff›s
 < 1)

74  
	g”rh
->
”rÜ
("timeout interval isoo small");

77 
şick_ch©‹r
("%s:‚Ùimšg ouˆbËƒÁr›s", 
Çme
().
c_¡r
());

79 ià(
	g_³riod
 <= 0)

80  
”rh
->
”rÜ
("period must be greaterhan 0");

81 ià(
	g_j™‹r
 < 0)

82  
	g”rh
->
”rÜ
("period must be…ositive");

83 ià(
	g_j™‹r
 > 
	g_³riod
)

84  
	g”rh
->
”rÜ
("jitter is biggerhan…eriod");

85 ià(
	g_max_hİs
 < 0)

86  
	g”rh
->
”rÜ
("max hops must be greaterhan 0");

88  
	g»s
;

94 
	gUpd©eGridRou‹s
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

97 
_h–lo_tim”
.
	`š™Ÿlize
(
this
);

98 
_h–lo_tim”
.
	`scheduË_aá”_m£c
(
_³riod
);

100 
_expœe_tim”
.
	`š™Ÿlize
(
this
);

101 ià(
_timeout
 > 0)

102 
_expœe_tim”
.
	`scheduË_aá”_m£c
(
EXPIRE_TIMER_PERIOD
);

104 
_§n™y_tim”
.
	`š™Ÿlize
(
this
);

105 
_§n™y_tim”
.
	`scheduË_aá”_m£c
(
SANITY_CHECK_PERIOD
);

108 
	}
}

112 
Pack‘
 *

113 
	gUpd©eGridRou‹s
::
	$sim¶e_aùiÚ
(
Pack‘
 *
·ck‘
)

118 
	`as£¹
(
·ck‘
);

119 
jiff
 = 
	`şick_jiff›s
();

125 
şick_‘h”
 *
eh
 = (şick_‘h” *è
·ck‘
->
	`d©a
();

126 ià(
	`Áohs
(
eh
->
‘h”_ty³
è!ğ
ETHERTYPE_GRID
) {

127 
	`şick_ch©‹r
("%s: gÙ‚Ú-Grid…ack‘y³", 
	`Çme
().
	`c_¡r
());

128  
·ck‘
;

130 
grid_hdr
 *
gh
 = (grid_hd¸*è(
·ck‘
->
	`d©a
(è+ (
şick_‘h”
));

131 
IPAdd»ss
 
	`addr
((*è&
gh
->
tx_
);

132 
Eth”Add»ss
 
	`‘haddr
((*è
eh
->
‘h”_sho¡
);

134 ià(
‘haddr
 =ğ
_‘haddr
) {

135 
	`şick_ch©‹r
("%s:„eûived owÀGrid…ack‘; ignÜšg it", 
	`Çme
().
	`c_¡r
());

136  
·ck‘
;

139 
NbrEÁry
 *
nbr
 = 
_add»s£s
.
	`fšdp
(
addr
);

140 ià(
nbr
 == 0) {

142 
NbrEÁry
 
	`Ãw_nbr
(
‘haddr
, 
addr
, 
jiff
);

143 
_add»s£s
.
	`š£¹
(
addr
, 
Ãw_nbr
);

144 
	`şick_ch©‹r
("%s:‡ddšg % -- %s", 
	`Çme
().
	`c_¡r
(), 
addr
.
	`uÅ¬£
().c_¡r(), 
‘haddr
.unparse().c_str());

148 
nbr
->
Ï¡_upd©ed_jiff›s
 = 
jiff
;

149 ià(
nbr
->
‘h
 !ğ
‘haddr
)

150 
	`şick_ch©‹r
("%s: upd©šg % -- %s", 
	`Çme
().
	`c_¡r
(), 
addr
.
	`uÅ¬£
().c_¡r(), 
‘haddr
.unparse().c_str());

151 
nbr
->
‘h
 = 
‘haddr
;

160 
gh
->
ty³
) {

161 
grid_hdr
::
GRID_LR_HELLO
:

163 
grid_h–lo
 *
hlo
 = (grid_h–lØ*è(
·ck‘
->
	`d©a
(è+ (
şick_‘h”
è+ (
grid_hdr
));

169 
çr_’Œy
 *
ã
 = 
_¹es
.
	`fšdp
(
addr
);

170 ià(
ã
 == 0) {

178 
_¹es
.
	`š£¹
(
addr
, 
	`çr_’Œy
(
jiff
, 
	`grid_nbr_’Œy
(
gh
->

, gh->, 1, 
	`Áohl
(
hlo
->
£q_no
))));

179 
ã
 = 
_¹es
.
	`fšdp
(
addr
);

180 
ã
->
nbr
.
loc
 = 
gh
->loc;

181 
ã
->
nbr
.
loc_”r
 = 
	`Áohs
(
gh
->loc_err);

182 
ã
->
nbr
.
loc_good
 = 
gh
->loc_good;

183 
ã
->
nbr
.
age
 = 
	`deü_age
(
	`Áohl
(
hlo
->age), 
grid_h–lo
::
MIN_AGE_DECREMENT
);

188 
ã
->
Ï¡_upd©ed_jiff›s
 = 
jiff
;

189 
ã
->
nbr
.
num_hİs
 = 1;

190 
ã
->
nbr
.
Ãxt_hİ_
 = 
gh
->

;

191 
ã
->
nbr
.
loc
 = 
gh
->loc;

192 
ã
->
nbr
.
loc_”r
 = 
	`Áohs
(
gh
->loc_err);

193 
ã
->
nbr
.
loc_good
 = 
gh
->loc_good;

194 
ã
->
nbr
.
£q_no
 = 
	`Áohl
(
hlo
->seq_no);

195 
ã
->
nbr
.
age
 = 
	`deü_age
(
	`Áohl
(
hlo
->age), 
grid_h–lo
::
MIN_AGE_DECREMENT
);

202 
’Œy_sz
 = 
hlo
->
nbr_’Œy_sz
;

203 
VeùÜ
<
grid_nbr_’Œy
> 
Œigg”ed_¹es
;

204 
VeùÜ
<
IPAdd»ss
> 
brok’_¹es
;

207 
i
 = 0; i < 
hlo
->
num_nbrs
; i++) {

208 
grid_nbr_’Œy
 *
cu¼
 = (grid_nbr_’Œy *è(
·ck‘
->
	`d©a
(è+ (
şick_‘h”
) +

209 (
grid_hdr
è+ (
grid_h–lo
) +

210 
i
 * 
’Œy_sz
);

212 ià(
	`IPAdd»ss
(
cu¼
->

è=ğ
_addr
)

215 ià(
	`IPAdd»ss
(
cu¼
->
Ãxt_hİ_
è=ğ
_addr
)

218 ià(
cu¼
->
num_hİs
 == 0) {

227 
IPAdd»ss
 
	`brok’_
(
cu¼
->

);

228 
ã
 = 
_¹es
.
	`fšdp
(
brok’_
);

229 ià(
ã
 != 0) {

230 ià(
	`Áohl
(
cu¼
->
£q_no
è> 
ã
->
nbr
.£q_nØ&& fe->nbr.
Ãxt_hİ_
 =ğ
gh
->

) {

232 
grid_nbr_’Œy
 
Ãw_’Œy
 = 
ã
->
nbr
;

233 
Ãw_’Œy
.
num_hİs
 = 0;

236 
Ãw_’Œy
.
Ãxt_hİ_
 = 
cu¼
->

;

238 
Ãw_’Œy
.
£q_no
 = 
	`Áohl
(
cu¼
->seq_no);

239 
	`as£¹
((
Ãw_’Œy
.
£q_no
 & 1) == 1);

240 
Ãw_’Œy
.
age
 = 
	`deü_age
(
	`Áohl
(
cu¼
->age), 
grid_h–lo
::
MIN_AGE_DECREMENT
);

241 ià(
Ãw_’Œy
.
age
 > 0)

242 
Œigg”ed_¹es
.
	`push_back
(
Ãw_’Œy
);

243 
brok’_¹es
.
	`push_back
(
ã
->
nbr
.

);

245 ià(
	`Áohl
(
cu¼
->
£q_no
è< 
ã
->
nbr
.seq_no) {

248 
grid_nbr_’Œy
 
Ãw_’Œy
 = 
ã
->
nbr
;

249 
	`as£¹
((
Ãw_’Œy
.
£q_no
 & 1) == 0);

250 ià(
Ãw_’Œy
.
age
 > 0)

251 
Œigg”ed_¹es
.
	`push_back
(
Ãw_’Œy
);

261 ià(
cu¼
->
num_hİs
 + 1 > 
_max_hİs
)

264 
IPAdd»ss
 
	`cu¼_
(
cu¼
->

);

265 
ã
 = 
_¹es
.
	`fšdp
(
cu¼_
);

266 ià(
ã
 == 0) {

268 
_¹es
.
	`š£¹
(
cu¼_
, 
	`çr_’Œy
(
jiff
, 
	`grid_nbr_’Œy
(
cu¼
->

, 
gh
->, cu¼->
num_hİs
 + 1, 
	`Áohl
(cu¼->
£q_no
))));

269 
ã
 =
_¹es
.
	`fšdp
(
cu¼_
);

270 
ã
->
nbr
.
loc
 = 
cu¼
->loc;

271 
ã
->
nbr
.
loc_”r
 = 
	`Áohs
(
cu¼
->loc_err);

272 
ã
->
nbr
.
loc_good
 = 
cu¼
->loc_good;

273 
ã
->
nbr
.
age
 = 
	`deü_age
(
	`Áohl
(
cu¼
->age), 
grid_h–lo
::
MIN_AGE_DECREMENT
);

277 
cu¼_£q
 = 
	`Áohl
(
cu¼
->
£q_no
);

278 ià(
cu¼_£q
 > 
ã
->
nbr
.
£q_no
 ||

279 (
cu¼_£q
 =ğ
ã
->
nbr
.
£q_no
 && (
cu¼
->
num_hİs
 + 1) < fe->nbr.num_hops)) {

280 
ã
->
nbr
.
num_hİs
 = 
cu¼
->num_hops + 1;

281 
ã
->
nbr
.
Ãxt_hİ_
 = 
gh
->

;

282 
ã
->
nbr
.
loc
 = 
cu¼
->loc;

283 
ã
->
nbr
.
loc_”r
 = 
	`Áohs
(
cu¼
->loc_err);

284 
ã
->
nbr
.
loc_good
 = 
cu¼
->loc_good;

285 
ã
->
nbr
.
£q_no
 = 
cu¼_£q
;

286 
ã
->
Ï¡_upd©ed_jiff›s
 = 
jiff
;

287 
ã
->
nbr
.
age
 = 
	`deü_age
(
	`Áohl
(
cu¼
->age), 
grid_h–lo
::
MIN_AGE_DECREMENT
);

289 ià(
ã
->
nbr
.
num_hİs
 > 1)

290 
_add»s£s
.
	`»move
(
ã
->
nbr
.

);

295 ià(
Œigg”ed_¹es
.
	`size
() > 0) {

297 
	`£nd_routšg_upd©e
(
Œigg”ed_¹es
, 
çl£
);

301 
i
 = 0; i < 
brok’_¹es
.
	`size
(); i++)

302 
	`as£¹
(
_¹es
.
	`»move
(
brok’_¹es
[
i
]));

309  
·ck‘
;

310 
	}
}

314 
SŒšg


315 
	$´št_¹es
(
EËm’t
 *
e
, *)

317 
Upd©eGridRou‹s
 *
n
 = (Upd©eGridRou‹ *è
e
;

319 
SŒšg
 
s
;

320 
Upd©eGridRou‹s
::
F¬TabË
::
™”©Ü
 
™”
 = 
n
->
_¹es
.
	`begš
(); i‹r.
	`live
(); iter++) {

321 
Upd©eGridRou‹s
::
çr_’Œy
 
f
 = 
™”
.
	`v®ue
();

322 
s
 +ğ
	`IPAdd»ss
(
f
.
nbr
.

).
	`uÅ¬£
()

323 + "‚ext_hİ=" + 
	`IPAdd»ss
(
f
.
nbr
.
Ãxt_hİ_
).
	`uÅ¬£
()

324 + "‚um_hİs=" + 
	`SŒšg
((è
f
.
nbr
.
num_hİs
)

325 + "†oc=" + 
f
.
nbr
.
loc
.
	`s
()

326 + "ƒ¼=" + (
f
.
nbr
.
loc_good
 ? "" : "-"è+ 
	`SŒšg
(f.nbr.
loc_”r
)

327 + " seq_no=" + 
	`SŒšg
(
f
.
nbr
.
£q_no
)

330  
s
;

331 
	}
}

333 
SŒšg


334 
	$´št_nbrs
(
EËm’t
 *
e
, *)

336 
Upd©eGridRou‹s
 *
n
 = (Upd©eGridRou‹ *è
e
;

338 
SŒšg
 
s
;

339 
Upd©eGridRou‹s
::
TabË
::
™”©Ü
 
™”
 = 
n
->
_add»s£s
.
	`begš
(); i‹r.
	`live
(); iter++) {

340 
s
 +ğ
™”
.
	`key
().
	`uÅ¬£
();

341 
s
 +ğ"ƒth=" + 
™”
.
	`v®ue
().
‘h
.
	`uÅ¬£
();

342 
s
 += "\n";

344  
s
;

345 
	}
}

347 
SŒšg


348 
	$´št_
(
EËm’t
 *
e
, *)

350 
Upd©eGridRou‹s
 *
n
 = (Upd©eGridRou‹ *è
e
;

351  
n
->
_addr
.
	`uÅ¬£
();

352 
	}
}

355 
SŒšg


356 
	$´št_‘h
(
EËm’t
 *
e
, *)

358 
Upd©eGridRou‹s
 *
n
 = (Upd©eGridRou‹ *è
e
;

359  
n
->
_‘haddr
.
	`uÅ¬£
();

360 
	}
}

364 
	gUpd©eGridRou‹s
::
	$add_hªdËrs
()

366 
	`add_»ad_hªdËr
("nbrs", 
´št_nbrs
, 0);

367 
	`add_»ad_hªdËr
("¹es", 
´št_¹es
, 0);

368 
	`add_»ad_hªdËr
("", 
´št_
, 0);

369 
	`add_»ad_hªdËr
("‘h", 
´št_‘h
, 0);

370 
	}
}

376 
	gUpd©eGridRou‹s
::
g‘_¹es
(
VeùÜ
<
grid_nbr_’Œy
> *
»tv®
)

378 
as£¹
(
»tv®
 != 0);

379 
expœe_rou‹s
();

380 
	gUpd©eGridRou‹s
::
F¬TabË
::
™”©Ü
 
™”
 = 
_¹es
.
begš
(); 
	g™”
.
live
(); iter++)

381 
	g»tv®
->
push_back
(
™”
.
v®ue
().
nbr
);

386 
	gUpd©eGridRou‹s
::
	$§n™y_hook
(
Tim”
 *, *
thunk
)

388 
Upd©eGridRou‹s
 *
n
 = (Upd©eGridRou‹ *è
thunk
;

390 ià(
n
->
_num_upd©es_£Á
 > 
SANITY_CHECK_MAX_PACKETS
)

391 
	`şick_ch©‹r
("%s: sent morehan %d„outing updates in %d milliseconds!",

392 
n
->
	`Çme
().
	`c_¡r
(), 
SANITY_CHECK_MAX_PACKETS
, 
SANITY_CHECK_PERIOD
);

393 
n
->
_num_upd©es_£Á
 = 0;

395 
n
->
_expœe_tim”
.
	`scheduË_aá”_m£c
(
SANITY_CHECK_PERIOD
);

396 
	}
}

399 
	gUpd©eGridRou‹s
::
	$expœe_hook
(
Tim”
 *, *
thunk
)

401 
Upd©eGridRou‹s
 *
n
 = (Upd©eGridRou‹ *è
thunk
;

411 
Upd©eGridRou‹s
::
F¬TabË
::
™”©Ü
 
™”
 = 
n
->
_¹es
.
	`begš
(); i‹r.
	`live
(); iter++) {

413 *((*è&(
™”
.
	`v®ue
().
nbr
.
age
)èğ
	`deü_age
(™”.v®ue().nbr.age, 
EXPIRE_TIMER_PERIOD
);

416 
VeùÜ
<
grid_nbr_’Œy
> 
expœed_šfo
 = 
n
->
	`expœe_rou‹s
();

418 ià(
expœed_šfo
.
	`size
() > 0) {

420 
n
->
	`£nd_routšg_upd©e
(
expœed_šfo
, 
çl£
);

423 
n
->
_expœe_tim”
.
	`scheduË_aá”_m£c
(
EXPIRE_TIMER_PERIOD
);

424 
	}
}

427 
	gVeùÜ
<
	ggrid_nbr_’Œy
>

428 
	gUpd©eGridRou‹s
::
	$expœe_rou‹s
()

434 
	`as£¹
(
_timeout
 > 0);

435 
jiff
 = 
	`şick_jiff›s
();

439 
HashM­
<
	tIPAdd»ss
, 
	tboŞ
> 
	txa_t
;

440 
xa_t
 
expœed_add»s£s
;

441 
VeùÜ
<
grid_nbr_’Œy
> 
expœed_nbrs
;

444 
Upd©eGridRou‹s
::
TabË
::
™”©Ü
 
™”
 = 
_add»s£s
.
	`begš
(); i‹r.
	`live
(); iter++)

445 ià(
jiff
 - 
™”
.
	`v®ue
().
Ï¡_upd©ed_jiff›s
 > 
_timeout_jiff›s
)

446 
expœed_add»s£s
.
	`š£¹
(
™”
.
	`key
(), 
Œue
);

451 
Upd©eGridRou‹s
::
F¬TabË
::
™”©Ü
 
™”
 = 
_¹es
.
	`begš
(); i‹r.
	`live
(); iter++) {

452 
	`as£¹
(
™”
.
	`v®ue
().
nbr
.
num_hİs
 > 0);

453 ià(
jiff
 - 
™”
.
	`v®ue
().
Ï¡_upd©ed_jiff›s
 > 
_timeout_jiff›s
 ||

454 
™”
.
	`v®ue
().
nbr
.
age
 == 0 ||

455 
expœed_add»s£s
.
	`fšdp
(
™”
.
	`v®ue
().
nbr
.
Ãxt_hİ_
)) {

456 
grid_nbr_’Œy
 
nbr
 = 
™”
.
	`v®ue
().nbr;

457 
nbr
.
num_hİs
 = 0;

458 
nbr
.
£q_no
++;

459 
nbr
.
age
 = 
grid_h–lo
::
MAX_AGE_DEFAULT
;

460 
expœed_nbrs
.
	`push_back
(
nbr
);

465 
xa_t
::
™”©Ü
 
™”
 = 
expœed_add»s£s
.
	`begš
(); i‹r.
	`live
(); iter++) {

466 
	`şick_ch©‹r
("%s:ƒxpiring‡ddress for %s",

467 
	`Çme
().
	`c_¡r
(), 
™”
.
	`key
().
	`uÅ¬£
().c_str());

468 
	`as£¹
(
_add»s£s
.
	`»move
(
™”
.
	`key
()));

472 
i
 = 0; i < 
expœed_nbrs
.
	`size
(); i++) {

473 
	`şick_ch©‹r
("%s:ƒxpœšg„ou‹ƒÁry fÜ %s", 
	`Çme
().
	`c_¡r
(), 
	`IPAdd»ss
(
expœed_nbrs
[
i
].

).
	`uÅ¬£
().c_str());

474 
	`as£¹
(
_¹es
.
	`»move
(
expœed_nbrs
[
i
].

));

477  
expœed_nbrs
;

478 
	}
}

482 
	gUpd©eGridRou‹s
::
	$h–lo_hook
(
Tim”
 *, *
thunk
)

484 
Upd©eGridRou‹s
 *
n
 = (Upd©eGridRou‹ *è
thunk
;

488 
n
->
	`expœe_rou‹s
();

490 
VeùÜ
<
grid_nbr_’Œy
> 
¹e_’Œ›s
;

491 
Upd©eGridRou‹s
::
F¬TabË
::
™”©Ü
 
™”
 = 
n
->
_¹es
.
	`begš
(); i‹r.
	`live
(); iter++) {

500 
¹e_’Œ›s
.
	`push_back
(
™”
.
	`v®ue
().
nbr
);

504 
n
->
	`£nd_routšg_upd©e
(
¹e_’Œ›s
, 
Œue
);

508 
ušt32_t
 
r2
 = 
	`şick_¿ndom
();

509 
r
 = (è(
r2
 >> 1);

510 
j™‹r
 = (è(((è
n
->
_j™‹r
è* 
r
 / (() 0x7FffFFff));

511 ià(
r2
 & 1)

512 
j™‹r
 *= -1;

513 
n
->
_h–lo_tim”
.
	`scheduË_aá”_m£c
Ò->
_³riod
 + (è
j™‹r
);

514 
	}
}

518 
	gUpd©eGridRou‹s
::
£nd_routšg_upd©e
(
VeùÜ
<
grid_nbr_’Œy
> &
¹e_šfo
,

519 
boŞ
 
upd©e_£q
)

525 
	g_num_upd©es_£Á
++;

527 
	gnum_¹es
 = 
¹e_šfo
.
size
();

528 
	gpsz
 = (
şick_‘h”
è+ (
grid_hdr
è+ (
grid_h–lo
);

529 
	gpsz
 +ğ(
grid_nbr_’Œy
è* 
num_¹es
;

531 
Wr™abËPack‘
 *
	gp
 = 
Pack‘
::
make
(
psz
 + 2);

532 ià(
	gp
 == 0) {

533 
şick_ch©‹r
("š %s: cªnÙ mak·ck‘!", 
Çme
().
c_¡r
());

534 
as£¹
(0);

536 
ASSERT_4ALIGNED
(
p
->
d©a
());

537 
	gp
->
puÎ
(2);

538 
mem£t
(
p
->
d©a
(), 0,…->
Ëngth
());

540 
	gp
->
£t_time¡amp_ªno
(
Time¡amp
::
now
());

542 
şick_‘h”
 *
	geh
 = (şick_‘h” *è
p
->
d©a
();

543 
mem£t
(
eh
->
‘h”_dho¡
, 0xff, 6);

544 
	geh
->
	g‘h”_ty³
 = 
htÚs
(
ETHERTYPE_GRID
);

545 
memıy
(
eh
->
‘h”_sho¡
, 
_‘haddr
.
d©a
(), 6);

547 
grid_hdr
 *
	ggh
 = (grid_hd¸*è(
eh
 + 1);

548 
ASSERT_4ALIGNED
(
gh
);

549 
	ggh
->
	ghdr_Ën
 = (
grid_hdr
);

550 
	ggh
->
	gtÙ®_Ën
 = 
psz
 - (
şick_‘h”
);

551 
	ggh
->
	gtÙ®_Ën
 = 
htÚs
(
gh
->
tÙ®_Ën
);

552 
	ggh
->
	gty³
 = 
grid_hdr
::
GRID_LR_HELLO
;

553 
	ggh
->
	g
 = 
gh
->
tx_
 = 
_addr
.
addr
();

554 
grid_h–lo
 *
	ghlo
 = (grid_h–lØ*è(
gh
 + 1);

555 
as£¹
(
num_¹es
 <= 255);

556 
	ghlo
->
	gnum_nbrs
 = (è
num_¹es
;

557 
	ghlo
->
	gnbr_’Œy_sz
 = (
grid_nbr_’Œy
);

558 
	ghlo
->
	g£q_no
 = 
htÚl
(
_£q_no
);

562 ià(
	gupd©e_£q
) {

566 
	g_£q_no
 += 2;

569 
	ghlo
->
	gage
 = 
htÚl
(
grid_h–lo
::
MAX_AGE_DEFAULT
);

571 
grid_nbr_’Œy
 *
	gcu¼
 = (grid_nbr_’Œy *è(
hlo
 + 1);

572 
	gi
 = 0; i < 
	gnum_¹es
; i++) {

573 *
	gcu¼
 = 
¹e_šfo
[
i
];

574 
	gcu¼
->
	g£q_no
 = 
htÚl
(
cu¼
->
£q_no
);

575 
	gcu¼
->
	gage
 = 
htÚl
(
cu¼
->
age
);

576 
	gcu¼
++;

579 
ouut
(1).
push
(
p
);

582 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

583 
	$EXPORT_ELEMENT
(
Upd©eGridRou‹s
)

584 
CLICK_ENDDECLS


	@grid/updateroutes.hh

1 #iâdeà
UPDATEROUTE_HH


2 
	#UPDATEROUTE_HH


	)

59 
	~<şick/–em’t.hh
>

60 
	~<şick/glue.hh
>

61 
	~<şick/bighashm­.hh
>

62 
	~<şick/‘h”add»ss.hh
>

63 
	~<şick/add»ss.hh
>

64 
	~"grid.hh
"

65 
	~<şick/tim”.hh
>

66 
CLICK_DECLS


68 şas 
	cUpd©eGridRou‹s
 : 
public
 
EËm’t
 {

70 
public
:

88 şas 
	cNbrEÁry
 {

89 
boŞ
 
_š™
;

90 
	mpublic
:

91 
Eth”Add»ss
 
‘h
;

92 
IPAdd»ss
 
	m
;

93 
	mÏ¡_upd©ed_jiff›s
;

94 
NbrEÁry
(è: 
_š™
(
çl£
), 
Ï¡_upd©ed_jiff›s
(0) { }

95 
NbrEÁry
(
Eth”Add»ss
 
‘h_š
, 
IPAdd»ss
 
_š
, 
jiff
)

96 : 
_š™
(
Œue
), 
‘h
(
‘h_š
), 

(
_š
), 
Ï¡_upd©ed_jiff›s
(
jiff
) { }

97 
İ”©Ü
 
boŞ
(ècÚ¡ {  
	m_š™
; }

98 
hashcode
(ècÚ¡ {  *(*)
	m
.
d©a
(); }

99 
SŒšg
 
s
() const

100 {  
	m‘h
.
uÅ¬£
(è+ " -- " + 
	m
.uÅ¬£(è+ " -- " + 
SŒšg
(
Ï¡_upd©ed_jiff›s
); }

103 
	gHashM­
<
	tIPAdd»ss
, 
	tNbrEÁry
> 
	tTabË
;

104 
TabË
 
	g_add»s£s
;

111 
	sçr_’Œy
 {

112 
çr_’Œy
(è: 
Ï¡_upd©ed_jiff›s
(0) { }

113 
çr_’Œy
(
j
, 
grid_nbr_’Œy
 
n
è: 
Ï¡_upd©ed_jiff›s
(j), 
£Á_Ãw
(
çl£
), 
nbr
(n) { }

114 
	gÏ¡_upd©ed_jiff›s
;

115 
boŞ
 
	g£Á_Ãw
;

116 
grid_nbr_’Œy
 
	gnbr
;

119 
	gHashM­
<
	tIPAdd»ss
, 
	tçr_’Œy
> 
	tF¬TabË
;

120 
F¬TabË
 
	g_¹es
;

141 
	$Upd©eGridRou‹s
(è
CLICK_COLD
;

142 ~
	$Upd©eGridRou‹s
(è
CLICK_COLD
;

144 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "Upd©eGridRou‹s"; 
	}
}

145 *
ÿ¡
(const *);

146 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/2"; 
	}
}

147 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

149 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

150 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

152 
	$add_hªdËrs
(è
CLICK_COLD
;

154 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

156 
	`g‘_¹es
(
VeùÜ
<
grid_nbr_’Œy
> *
»tv®
);

158 
IPAdd»ss
 
_addr
;

159 
Eth”Add»ss
 
_‘haddr
;

161 
´iv©e
:

162 
_timeout
;

163 
_timeout_jiff›s
;

165 
_max_hİs
;

167 
_³riod
;

168 
_j™‹r
;

169 
Tim”
 
_h–lo_tim”
;

171 cÚ¡ 
EXPIRE_TIMER_PERIOD
 = 100;

172 
Tim”
 
_expœe_tim”
;

175 cÚ¡ 
SANITY_CHECK_PERIOD
 = 10000;

176 cÚ¡ 
SANITY_CHECK_MAX_PACKETS
 = 100;

177 
Tim”
 
_§n™y_tim”
;

178 
_num_upd©es_£Á
;

180 
_£q_no
;

182 
	`expœe_hook
(
Tim”
 *, *);

183 
	`h–lo_hook
(
Tim”
 *, *);

184 
	`§n™y_hook
(
Tim”
 *, *);

186 
VeùÜ
<
grid_nbr_’Œy
> 
	`expœe_rou‹s
();

187 
	`£nd_routšg_upd©e
(
VeùÜ
<
grid_nbr_’Œy
> &
¹e_šfo
, 
boŞ
);

189 
Pack‘
 *
	`make_h–lo
();

192 
	$deü_age
(
age
, 
deü
)

193 {  (
age
 > 
deü
 ?‡g- deü : 0); 
	}
}

196 
	gCLICK_ENDDECLS


	@grid/yarvismetric.cc

16 
	~<şick/cÚfig.h
>

17 
	~<şick/¬gs.hh
>

18 
	~<şick/”rÜ.hh
>

19 
	~"–em’ts/grid/y¬vism‘ric.hh
"

20 
	~"–em’ts/grid/lšk¡©.hh
"

21 
CLICK_DECLS


23 
	gY¬visM‘ric
::
	$Y¬visM‘ric
()

24 : 
	$_ls
(0)

26 
	}
}

28 
Y¬visM‘ric
::~
	$Y¬visM‘ric
()

30 
	}
}

33 
Y¬visM‘ric
::
	$ÿ¡
(cÚ¡ *
n
)

35 ià(
	`¡rcmp
(
n
, "YarvisMetric") == 0)

36  (
Y¬visM‘ric
 *è
this
;

37 ià(
	`¡rcmp
(
n
, "GridGenericMetric") == 0)

38  (
GridG’”icM‘ric
 *è
this
;

41 
	}
}

44 
	gY¬visM‘ric
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

46  
Args
(
cÚf
, 
this
, 
”rh
)

47 .
»ad_mp
("LINKSTAT", 
EËm’tCa¡Arg
("LškSt"), 
_ls
)

48 .
com¶‘e
();

52 
boŞ


53 
	gY¬visM‘ric
::
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &
m1
, cÚ¡ m‘ric_ˆ&
m2
) const

55  
m1
.
	`v®
(è< 
m2
.val();

56 
	}
}

58 
	gGridG’”icM‘ric
::
m‘ric_t


59 
Y¬visM‘ric
::
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &
e
, 
boŞ
 
d©a_£nd”
) const

61 
u_fwd
, 
u_»v
;

62 
r_fwd
, 
r_»v
;

63 
Time¡amp
 
t_fwd
;

65 
boŞ
 
»s_fwd
 = 
_ls
->
	`g‘_fÜw¬d_¿‹
(
e
, &
r_fwd
, &
u_fwd
, &
t_fwd
);

66 
boŞ
 
»s_»v
 = 
_ls
->
	`g‘_»v”£_¿‹
(
e
, &
r_»v
, &
u_»v
);

74 ià(!
d©a_£nd”
) {

75 
	`grid_sw­
(
»s_fwd
, 
»s_»v
);

76 
	`grid_sw­
(
r_fwd
, 
r_»v
);

79 ià(!
»s_fwd
)

80  
_bad_m‘ric
;

82 
m
;

84 ià(
r_fwd
 >ğ90è
m
 = 1;

85 ià(
r_fwd
 >ğ79è
m
 = 3;

86 ià(
r_fwd
 >ğ47è
m
 = 6;

87 
m
 = 15;

89  
	`m‘ric_t
(
m
);

90 
	}
}

92 
	gGridG’”icM‘ric
::
m‘ric_t


93 
Y¬visM‘ric
::
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

95 ià(!
r
.
	`good
(è|| !
l
.good())

96  
_bad_m‘ric
;

98 ià(
l
.
	`v®
() > 15)

99 
	`şick_ch©‹r
("YarvisMetric %s:‡ppend_metric WARNING: metric %u%% isoo†arge (> 15!) for†ink metric",

100 
	`Çme
().
	`c_¡r
(), 
r
.
	`v®
());

102  
	`m‘ric_t
(
r
.
	`v®
(è+ 
l
.val());

103 
	}
}

105 
CLICK_ENDDECLS


106 
	$ELEMENT_PROVIDES
(
GridG’”icM‘ric
)

107 
	`EXPORT_ELEMENT
(
Y¬visM‘ric
)

	@grid/yarvismetric.hh

1 #iâdeà
YARVISMETRIC_HH


2 
	#YARVISMETRIC_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"gridg’”icm‘ric.hh
"

5 
CLICK_DECLS


27 
şass
 
	gLškSt
;

29 şas 
	cY¬visM‘ric
 : 
public
 
GridG’”icM‘ric
 {

31 
public
:

33 
	$Y¬visM‘ric
(è
CLICK_COLD
;

34 ~
	$Y¬visM‘ric
(è
CLICK_COLD
;

36 cÚ¡ *
	$şass_Çme
() const {  "YarvisMetric"; }

37 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_0
; 
	}
}

38 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

40 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

41 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
çl£
; 
	}
}

43 *
ÿ¡
(const *);

46 
boŞ
 
	$m‘ric_v®_É
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

47 
m‘ric_t
 
	$g‘_lšk_m‘ric
(cÚ¡ 
Eth”Add»ss
 &, 
boŞ
) const;

48 
m‘ric_t
 
	$­³nd_m‘ric
(cÚ¡ 
m‘ric_t
 &, const metric_t &) const;

49 
m‘ric_t
 
	$´•’d_m‘ric
(cÚ¡ 
m‘ric_t
 &
r
, cÚ¡ m‘ric_ˆ&
l
) const

50 {  
	`­³nd_m‘ric
(
r
, 
l
); 
	}
}

52 
	$sÿË_to_ch¬
(cÚ¡ 
m‘ric_t
 &
m
ècÚ¡ {  (èm.
	`v®
(); 
	}
}

53 
m‘ric_t
 
	$unsÿË_äom_ch¬
(
c
ècÚ¡ {  
	`m‘ric_t
(c); 
	}
}

55 
	g´iv©e
:

56 
LškSt
 *
_ls
;

59 
	gCLICK_ENDDECLS


	@icmp/checkicmpheader.cc

19 
	~<şick/cÚfig.h
>

20 
	~"checkicmph—d”.hh
"

21 
	~<şickÃt/.h
>

22 
	~<şickÃt/icmp.h
>

23 
	~<şick/glue.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/b™veùÜ.hh
>

27 
	~<şick/¡¿ccum.hh
>

28 
CLICK_DECLS


30 cÚ¡ *
	gCheckICMPH—d”
::
»asÚ_‹xts
[
NREASONS
] = {

34 
	gCheckICMPH—d”
::
	$CheckICMPH—d”
()

35 : 
	$_»asÚ_drİs
(0)

37 
_drİs
 = 0;

38 
	}
}

40 
	gCheckICMPH—d”
::~
	$CheckICMPH—d”
()

42 
d–‘e
[] 
_»asÚ_drİs
;

43 
	}
}

46 
	gCheckICMPH—d”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

48 
boŞ
 
	gv”bo£
 = 
çl£
, 
	gd‘as
 = false;

50 ià(
Args
(
cÚf
, 
this
, 
”rh
)

51 .
»ad
("VERBOSE", 
v”bo£
)

52 .
»ad
("DETAILS", 
d‘as
)

53 .
com¶‘e
() < 0)

56 
	g_v”bo£
 = 
v”bo£
;

57 ià(
	gd‘as
)

58 
	g_»asÚ_drİs
 = 
Ãw
 
©omic_ušt32_t
[
NREASONS
];

64 
Pack‘
 *

65 
	gCheckICMPH—d”
::
	$drİ
(
R—sÚ
 
»asÚ
, 
Pack‘
 *
p
)

67 ià(
_drİs
 =ğ0 || 
_v”bo£
)

68 
	`şick_ch©‹r
("%p{–em’t}: ICMP h—d” check faed: %s", 
this
, 
»asÚ_‹xts
[
»asÚ
]);

69 
_drİs
++;

71 ià(
_»asÚ_drİs
)

72 
_»asÚ_drİs
[
»asÚ
]++;

74 ià(
	`nouuts
() == 2)

75 
	`ouut
(1).
	`push
(
p
);

77 
p
->
	`kl
();

80 
	}
}

82 
Pack‘
 *

83 
	gCheckICMPH—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

85 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

86 
csum
, 
icmp_Ën
;

87 cÚ¡ 
şick_icmp
 *
icmph
 = 
p
->
	`icmp_h—d”
();

89 ià(!
p
->
	`has_ÃtwÜk_h—d”
(è|| 
h
->
_p
 !ğ
IP_PROTO_ICMP
)

90  
	`drİ
(
NOT_ICMP
, 
p
);

92 
icmp_Ën
 = 
p
->
	`Ëngth
(è-…->
	`Œª¥Üt_h—d”_off£t
();

93 ià(
icmp_Ën
 < (
şick_icmp
))

94  
	`drİ
(
BAD_LENGTH
, 
p
);

96 
icmph
->
icmp_ty³
) {

98 
ICMP_UNREACH
:

99 
ICMP_TIMXCEED
:

100 
ICMP_PARAMPROB
:

101 
ICMP_SOURCEQUENCH
:

102 
ICMP_REDIRECT
:

104 ià(
icmp_Ën
 < (
şick_icmp
) + 28)

105  
	`drİ
(
BAD_LENGTH
, 
p
);

108 
ICMP_TSTAMP
:

109 
ICMP_TSTAMPREPLY
:

111 ià(
icmp_Ën
 !ğ(
şick_icmp_t¡amp
))

112  
	`drİ
(
BAD_LENGTH
, 
p
);

115 
ICMP_IREQ
:

116 
ICMP_IREQREPLY
:

118 ià(
icmp_Ën
 !ğ(
şick_icmp
))

119  
	`drİ
(
BAD_LENGTH
, 
p
);

122 
ICMP_ROUTERADVERT
:

124 
ICMP_MASKREQ
:

125 
ICMP_MASKREQREPLY
:

128 
ICMP_ECHO
:

129 
ICMP_ECHOREPLY
:

136 
csum
 = 
	`şick_š_cksum
((*)
icmph
, 
icmp_Ën
) & 0xFFFF;

137 ià(
csum
 != 0)

138  
	`drİ
(
BAD_CHECKSUM
, 
p
);

140  
p
;

141 
	}
}

143 
SŒšg


144 
	gCheckICMPH—d”
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

146 
CheckICMPH—d”
 *
c
 = 
»š‹½»t_ÿ¡
<CheckICMPH—d” *>(
e
);

147 (
šŒ_t
)
thunk
) {

150  
	`SŒšg
(
c
->
_drİs
);

153 
SŒšgAccum
 
§
;

154 
i
 = 0; i < 
NREASONS
; i++)

155 
§
 << 
c
->
_»asÚ_drİs
[
i
] << '\t' << 
»asÚ_‹xts
[i] << '\n';

156  
§
.
	`ke_¡ršg
();

160  
	`SŒšg
("<error>");

163 
	}
}

166 
	gCheckICMPH—d”
::
	$add_hªdËrs
()

168 
	`add_»ad_hªdËr
("drİs", 
»ad_hªdËr
, 0);

169 ià(
_»asÚ_drİs
)

170 
	`add_»ad_hªdËr
("drİ_d‘as", 
»ad_hªdËr
, 1);

171 
	}
}

173 
CLICK_ENDDECLS


174 
EXPORT_ELEMENT
(
CheckICMPH—d”
)

	@icmp/checkicmpheader.hh

1 #iâdeà
CLICK_CHECKICMPHEADER_HH


2 
	#CLICK_CHECKICMPHEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/©omic.hh
>

5 
CLICK_DECLS


52 şas 
	cCheckICMPH—d”
 : 
public
 
EËm’t
 {…ublic:

54 
	$CheckICMPH—d”
(è
CLICK_COLD
;

55 ~
	$CheckICMPH—d”
(è
CLICK_COLD
;

57 cÚ¡ *
	$şass_Çme
() const {  "CheckICMPHeader"; }

58 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

59 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

61 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

62 
	$add_hªdËrs
(è
CLICK_COLD
;

64 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

66 
´iv©e
:

68 
boŞ
 
_v”bo£
 : 1;

69 
©omic_ušt32_t
 
_drİs
;

70 
©omic_ušt32_t
 *
_»asÚ_drİs
;

72 
	eR—sÚ
 {

73 
NOT_ICMP
,

74 
BAD_LENGTH
,

75 
BAD_CHECKSUM
,

76 
NREASONS


77 
	}
};

78 cÚ¡ *
	g»asÚ_‹xts
[
NREASONS
];

80 
Pack‘
 *
drİ
(
R—sÚ
, Packet *);

81 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

83 
	}
};

85 
	gCLICK_ENDDECLS


	@icmp/icmperror.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şickÃt/icmp.h
>

21 
	~<şickÃt/.h
>

22 
	~"icm³¼Ü.hh
"

23 
	~<şick/add»ss.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/glue.hh
>

27 
	~<şick/·ck‘_ªno.hh
>

28 
	~<şick/Çmešfo.hh
>

29 
CLICK_DECLS


31 
	gICMPE¼Ü
::
	$ICMPE¼Ü
()

32 : 
	`_ty³
(-1), 
	`_code
(-1)

34 
	}
}

36 
	gICMPE¼Ü
::~
	$ICMPE¼Ü
()

38 
	}
}

40 
boŞ


41 
ICMPE¼Ü
::
	$is_”rÜ_ty³
(
ty³
)

43  
ty³
 =ğ
ICMP_UNREACH
 ||y³ =ğ
ICMP_SOURCEQUENCH


44 || 
ty³
 =ğ
ICMP_REDIRECT
 ||y³ =ğ
ICMP_TIMXCEED


45 || 
ty³
 =ğ
ICMP_PARAMPROB
;

46 
	}
}

49 
	gICMPE¼Ü
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

51 
SŒšg
 
	gcode_¡r
 = "0";

52 
	gmtu
 = 576, 
	gpmtu
 = 0;

53 
IPAdd»ss
 
	g¤c_
;

54 
	gty³
, 
	gcode
;

55 
	gVeùÜ
<
	gIPAdd»ss
> 
	gbad_addrs
;

56 
boŞ
 
	gu£_fix_ªno
 = 
Œue
;

58 ià(
Args
(
cÚf
, 
this
, 
”rh
)

59 .
»ad_mp
("SRC", 
¤c_
)

60 .
»ad_mp
("TYPE", 
NamedIÁArg
(
NameInfo
::
T_ICMP_TYPE
), 
ty³
)

61 .
»ad_p
("CODE", 
WÜdArg
(), 
code_¡r
)

62 .
»ad_p
("BADADDRS", 
bad_addrs
)

63 .
»ad
("MTU", 
mtu
)

64 .
»ad
("PMTU", 
pmtu
)

65 .
»ad
("SET_FIX_ANNO", 
u£_fix_ªno
)

66 .
com¶‘e
() < 0)

69 ià(
	gty³
 < 0 ||ype > 255)

70  
	g”rh
->
”rÜ
("ICMPype must be between 0‡nd 255");

71 ià(!
is_”rÜ_ty³
(
ty³
))

72  
	g”rh
->
”rÜ
("ICMPy³ %d i nÙ‡À”rÜy³", 
ty³
);

73 ià(!
	gNameInfo
::
qu”y_št
(
NameInfo
::
T_ICMP_CODE
 + 
ty³
, 
this
, 
code_¡r
, &
code
)

74 || 
	gcode
 < 0 || code > 255)

75  
	g”rh
->
”rÜ
("argument 2akes ICMP code (integer between 0‡nd 255)");

77 
	g_¤c_
 = 
¤c_
;

78 
	g_ty³
 = 
ty³
;

79 
	g_code
 = 
code
;

80 
	g_bad_addrs
.
sw­
(
bad_addrs
);

81 
	g_mtu
 = 
mtu
;

82 
	g_pmtu
 = 
pmtu
;

83 
	g_u£_fix_ªno
 = 
u£_fix_ªno
;

90 
boŞ


91 
	gICMPE¼Ü
::
	$uniÿ¡
(
š_addr
 
¯
) const

93 
ušt32_t
 
a
 = 
¯
.
s_addr
;

94 
ušt32_t
 
ha
 = 
	`Áohl
(
a
);

97 if(
ha
 == 0xffffffff)

101 if((
ha
 & 0xf0000000u) == 0xe0000000u)

105 ià(
	`fšd
(
_bad_addrs
.
	`begš
(), _bad_addrs.
	`’d
(), 
	`IPAdd»ss
(
a
)) < _bad_addrs.end())

109 
	}
}

115 
boŞ


116 
	gICMPE¼Ü
::
	$v®id_sourû
(
š_addr
 
¯
) const

118 
a
 = 
¯
.
s_addr
;

119 
ha
 = 
	`Áohl
(
a
);

120 
Ãt
 = (
ha
 >> 24) & 0xff;

123 if(
	`uniÿ¡
(
¯
) == 0)

127 if(
Ãt
 == 0)

131 if(
Ãt
 == 127)

135 if((
Ãt
 & 0xf0) == 0xf0)

139 
	}
}

144 cÚ¡ 
ušt8_t
 *

145 
	gICMPE¼Ü
::
	$v®id_sourû_rou‹
(cÚ¡ 
şick_
 *
h
)

147 cÚ¡ 
ušt8_t
 *
ß
 = (cÚ¡ ušt8_ˆ*)
h
;

148 
hËn
 = 
h
->
_hl
 << 2;

150 
oi
 = (
şick_
); o˜< 
hËn
; ) {

152 
ty³
 = 
ß
[
oi
];

153 ià(
ty³
 =ğ
IPOPT_NOP
) {

154 
oi
++;

156 } ià(
ty³
 =ğ
IPOPT_EOL
)

160 
xËn
 = 
ß
[
oi
 + 1];

161 ià(
xËn
 < 2 || 
oi
 + xËÀ> 
hËn
)

163 ià((
ty³
 =ğ
IPOPT_LSRR
 ||y³ =ğ
IPOPT_SSRR
)

164 && 
ß
[
oi
 + 2] >= 4 && oa[oi + 2] % 4 == 0

165 && 
ß
[
oi
 + 2] <ğ
xËn
 + 1)

166  
ß
 + 
oi
;

168 
oi
 +ğ
xËn
;

172 
	}
}

174 
Pack‘
 *

175 
	gICMPE¼Ü
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

177 
Wr™abËPack‘
 *
q
 = 0;

178 cÚ¡ 
şick_
 *
p
 = 
p
->
	`_h—d”
();

179 cÚ¡ 
ušt8_t
 *
sourû_rou‹
;

180 
şick_
 *
n
;

181 
şick_icmp
 *
iı
;

182 
hËn
, 
xËn
;

183 
id
 = 1;

185 ià(!
p
->
	`has_ÃtwÜk_h—d”
())

186 
out
;

188 
hËn
 = 
p
->
_hl
 << 2;

193 if(
p
->
_p
 =ğ
IP_PROTO_ICMP
) {

194 cÚ¡ 
şick_icmp
 *
icmph
 = 
p
->
	`icmp_h—d”
();

195 if(
hËn
 + 4 > 
p
->
	`Ëngth
(è|| 
	`is_”rÜ_ty³
(
icmph
->
icmp_ty³
))

196 
out
;

200 if(!
	`uniÿ¡
(
p
->
_d¡
))

201 
out
;

204 ià(
p
->
	`·ck‘_ty³_ªno
(è=ğ
Pack‘
::
BROADCAST
 ||…->·ck‘_ty³_ªno(è=ğPack‘::
MULTICAST
)

205 
out
;

208 if(!
	`v®id_sourû
(
p
->
_¤c
))

209 
out
;

212 if(!
	`IP_FIRSTFRAG
(
p
))

213 
out
;

215 
sourû_rou‹
 = 
	`v®id_sourû_rou‹
(
p
);

216 ià(
sourû_rou‹
) {

218 ià(
_ty³
 =ğ
ICMP_REDIRECT
)

219 
out
;

223 ià(
_ty³
 =ğ
ICMP_PARAMPROB
 && 
_code
 =ğ
ICMP_PARAMPROB_ERRATPTR


224 && 
sourû_rou‹
 <ğ((cÚ¡ 
ušt8_t
 *)
p
 + 
	`ICMP_PARAMPROB_ANNO
(
p
))

225 && ((cÚ¡ 
ušt8_t
 *)
p
 + 
	`ICMP_PARAMPROB_ANNO
(
p
)è< (
sourû_rou‹
 + source_route[1]))

226 
sourû_rou‹
 = 0;

230 
q
 = 
Pack‘
::
	`make
(
_mtu
);

231 ià(!
q
)

232 
out
;

235 
n
 = 
»š‹½»t_ÿ¡
<
şick_
 *>(
q
->
	`d©a
());

237 
n
->
_v
 = 4;

238 
n
->
_tos
 = 0;

239 
n
->
_id
 = 
	`htÚs
(
id
);

240 ++
id
;

241 
n
->
_off
 = 0;

242 
n
->
_‰l
 = 200;

243 
n
->
_p
 = 
IP_PROTO_ICMP
;

244 
n
->
_sum
 = 0;

245 
n
->
_¤c
 = 
_¤c_
.
	`š_addr
();

246 
n
->
_d¡
 = 
p
->
_¤c
;

249 ià(
sourû_rou‹
) {

250 
ušt8_t
 *
o
 = (ušt8_ˆ*è(
n
 + 1);

251 
Ş’
 = 
sourû_rou‹
[2] - 1;

252 
o
[0] = 
sourû_rou‹
[0];

253 
o
[1] = 
Ş’
;

254 
o
[2] = 4;

255 
o
[
Ş’
] = 
IPOPT_EOL
;

256 
o
 += 3;

257 cÚ¡ 
ušt8_t
 *
oo
 = 
sourû_rou‹
 + sourû_rou‹[2] - 5; oØ>ğsourû_rou‹ + 3; oØ-ğ4, 
o
 += 4)

258 
	`memıy
(
o
, 
oo
, 4);

259 
n
->
_hl
 = ((
şick_
è+ 
Ş’
 + 3) >> 2;

261 
n
->
_hl
 = (
şick_
) >> 2;

262 
q
->
	`£t__h—d”
(
n
,‚->
_hl
 << 2);

265 
iı
 = 
q
->
	`icmp_h—d”
();

266 
iı
->
icmp_ty³
 = 
_ty³
;

267 
iı
->
icmp_code
 = 
_code
;

268 
iı
->
icmp_cksum
 = 0;

269 
iı
->
·ddšg
 = 0;

272 ià(
_ty³
 =ğ
ICMP_PARAMPROB
 && 
_code
 =ğ
ICMP_PARAMPROB_ERRATPTR
)

274 ((
şick_icmp_·¿m´ob
 *è
iı
)->
icmp_poš‹r
 = 
	`ICMP_PARAMPROB_ANNO
(
p
);

275 ià(
_ty³
 =ğ
ICMP_REDIRECT
)

276 ((
şick_icmp_»dœeù
 *è
iı
)->
icmp_g©eway
 = 
p
->
	`d¡__ªno
();

277 ià(
_ty³
 =ğ
ICMP_UNREACH
 && 
_code
 =ğ
ICMP_UNREACH_NEEDFRAG
)

278 ((
şick_icmp_Ãedäag
 *è
iı
)->
icmp_Ãxtmtu
 = 
	`htÚs
(
_pmtu
);

281 
xËn
 = 
q
->
	`’d_d©a
(è- (
ušt8_t
 *)(
iı
 + 1);

282 ià(()
xËn
 > 
p
->
	`ÃtwÜk_Ëngth
()) {

283 
q
->
	`ke
(
xËn
 - 
p
->
	`ÃtwÜk_Ëngth
());

284 
xËn
 = 
p
->
	`ÃtwÜk_Ëngth
();

286 
	`memıy
((
ušt8_t
 *)(
iı
 + 1), 
p
->
	`ÃtwÜk_h—d”
(), 
xËn
);

287 
iı
->
icmp_cksum
 = 
	`şick_š_cksum
((*)iı, (
şick_icmp
è+ 
xËn
);

290 
n
->
_Ën
 = 
	`htÚs
(
q
->
	`ÃtwÜk_Ëngth
());

291 
n
->
_sum
 = 
	`şick_š_cksum
((*ê,‚->
_hl
 << 2);

294 
q
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(
n
->
_d¡
));

295 ià(
_u£_fix_ªno
)

296 
	`SET_FIX_IP_SRC_ANNO
(
q
, 1);

297 
q
->
	`time¡amp_ªno
().
	`assign_now
();

299 
out
:

300 
p
->
	`kl
();

301 (
q
);

302 
	}
}

305 
	gICMPE¼Ü
::
	$add_hªdËrs
()

307 
	`add_d©a_hªdËrs
("¤c", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_¤c_
);

308 
	`add_d©a_hªdËrs
("mtu", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_mtu
);

309 
	`add_d©a_hªdËrs
("pmtu", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_pmtu
);

310 
	}
}

312 
CLICK_ENDDECLS


313 
	$EXPORT_ELEMENT
(
ICMPE¼Ü
)

314 
	`ELEMENT_MT_SAFE
(
ICMPE¼Ü
)

	@icmp/icmperror.hh

1 #iâdeà
CLICK_ICMPERROR_HH


2 
	#CLICK_ICMPERROR_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


105 şas 
	cICMPE¼Ü
 : 
public
 
EËm’t
 {…ublic:

107 
	$ICMPE¼Ü
(è
CLICK_COLD
;

108 ~
	$ICMPE¼Ü
(è
CLICK_COLD
;

110 cÚ¡ *
	$şass_Çme
() const {  "ICMPError"; }

111 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

113 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

114 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

115 
	$add_hªdËrs
(è
CLICK_COLD
;

117 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

119 
´iv©e
:

121 
IPAdd»ss
 
_¤c_
;

122 
_ty³
;

123 
_code
;

124 
VeùÜ
<
IPAdd»ss
> 
_bad_addrs
;

125 
_mtu
;

126 
_pmtu
;

127 
boŞ
 
_u£_fix_ªno
;

129 
boŞ
 
	`is_”rÜ_ty³
();

130 
boŞ
 
	$uniÿ¡
(
š_addr
) const;

131 
boŞ
 
	$v®id_sourû
(
š_addr
) const;

132 cÚ¡ 
ušt8_t
 *
	`v®id_sourû_rou‹
(cÚ¡ 
şick_
 *

);

134 
	}
};

136 
	gCLICK_ENDDECLS


	@icmp/icmpipencap.cc

1 
	~<şick/cÚfig.h
>

2 
	~"icmp’ÿp.hh
"

3 
	~<şick/¬gs.hh
>

4 
	~<şick/”rÜ.hh
>

5 
	~<şickÃt/.h
>

6 
	~<şickÃt/icmp.h
>

7 
	~<şick/·ck‘_ªno.hh
>

8 
	~<şick/Çmešfo.hh
>

9 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

10 
CLICK_DECLS


12 
	gICMPIPEnÿp
::
	$ICMPIPEnÿp
()

13 : 
	`_icmp_id
(0), 
	`__id
(1), 
	`_icmp_ty³
(0), 
	$_icmp_code
(0)

15 
	}
}

17 
	gICMPIPEnÿp
::~
	$ICMPIPEnÿp
()

19 
	}
}

22 
ICMPIPEnÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

24 
SŒšg
 
	gcode_¡r
 = "0";

25 
	gicmp_ty³
, 
	gicmp_code
;

26 ià(
Args
(
cÚf
, 
this
, 
”rh
)

27 .
»ad_mp
("SRC", 
_¤c
)

28 .
»ad_mp
("DST", 
_d¡
)

29 .
»ad_mp
("TYPE", 
NamedIÁArg
(
NameInfo
::
T_ICMP_TYPE
), 
icmp_ty³
)

30 .
»ad_p
("CODE", 
WÜdArg
(), 
code_¡r
)

31 .
»ad
("IDENTIFIER", 
_icmp_id
)

32 .
com¶‘e
() < 0)

35 ià(
	gicmp_ty³
 < 0 || icmp_type > 255)

36  
	g”rh
->
”rÜ
("invalid TYPE");

37 ià(!
	gNameInfo
::
qu”y_št
(
NameInfo
::
T_ICMP_CODE
 + 
icmp_ty³
, 
this
, 
code_¡r
, &
icmp_code
)

38 || 
	gicmp_code
 < 0 || icmp_code > 255)

39  
	g”rh
->
”rÜ
("invalid CODE");

40 
	g_icmp_ty³
 = 
icmp_ty³
;

41 
	g_icmp_code
 = 
icmp_code
;

43 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


45 
	gªs
, 
	gc
, 
	go
;

46 
	gªs
 = 
Alignm’tInfo
::
qu”y
(
this
, 0, 
c
, 
o
);

47 
	g_®igÃd
 = (
ªs
 && 
c
 =ğ4 && 
o
 == 0);

48 ià(!
	g_®igÃd
)

49 
	g”rh
->
w¬nšg
("IP header unaligned, cannot use fast IP checksum");

50 ià(!
	gªs
)

51 
	g”rh
->
mes§ge
("(Try…assinghe configurationhrough `click-align'.)");

58 
Pack‘
 *

59 
	gICMPIPEnÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

61 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`push
((
şick_
è+ 
	`şick_icmp_hl
(
_icmp_ty³
))) {

62 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
q
->
	`d©a
());

63 

->
_v
 = 4;

64 

->
_hl
 = (
şick_
) >> 2;

65 

->
_tos
 = 0;

66 

->
_Ën
 = 
	`htÚs
(
q
->
	`Ëngth
());

67 

->
_id
 = 
	`htÚs
(
__id
);

68 

->
_off
 = 0;

69 

->
_‰l
 = 255;

70 

->
_p
 = 
IP_PROTO_ICMP
;

71 

->
_sum
 = 0;

72 

->
_¤c
 = 
_¤c
;

73 

->
_d¡
 = 
_d¡
;

75 
şick_icmp_£qu’ûd
 *
icmp
 = (şick_icmp_£qu’ûd *è(

 + 1);

76 
	`mem£t
(
icmp
, 0, 
	`şick_icmp_hl
(
_icmp_ty³
));

77 
icmp
->
icmp_ty³
 = 
_icmp_ty³
;

78 
icmp
->
icmp_code
 = 
_icmp_code
;

80 if(
_icmp_ty³
 =ğ
ICMP_TSTAMP
 || _icmp_ty³ =ğ
ICMP_TSTAMPREPLY
 || _icmp_ty³ =ğ
ICMP_ECHO


81 || 
_icmp_ty³
 =ğ
ICMP_ECHOREPLY
 || _icmp_ty³ =ğ
ICMP_IREQ
 || _icmp_ty³ =ğ
ICMP_IREQREPLY
) {

82 
icmp
->
icmp_id’tif›r
 = 
	`htÚs
(
_icmp_id
);

83 
icmp
->
icmp_£qu’û
 = 
	`htÚs
(
__id
);

86 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


87 ià(
_®igÃd
)

88 

->
_sum
 = 
	`_ç¡_csum
((*), (
şick_
) >> 2);

90 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

91 #–ià
HAVE_FAST_CHECKSUM


92 

->
_sum
 = 
	`_ç¡_csum
((*), (
şick_
) >> 2);

94 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

96 
icmp
->
icmp_cksum
 = 
	`şick_š_cksum
((cÚ¡ *)icmp, 
q
->
	`Ëngth
(è- (
şick_
));

98 
q
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(
_d¡
));

99 
q
->
	`£t__h—d”
(

, (
şick_
));

101 
__id
 += (_ip_id == 0xFFFF ? 2 : 1);

102  
q
;

105 
	}
}

107 
SŒšg
 
	gICMPIPEnÿp
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

109 
ICMPIPEnÿp
 *
i
 = 
¡©ic_ÿ¡
<ICMPIPEnÿ°*>(
e
);

110 ià(
thunk
)

111  
	`IPAdd»ss
(
i
->
_d¡
).
	`uÅ¬£
();

113  
	`IPAdd»ss
(
i
->
_¤c
).
	`uÅ¬£
();

114 
	}
}

116 
	gICMPIPEnÿp
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

118 
ICMPIPEnÿp
 *
i
 = 
¡©ic_ÿ¡
<ICMPIPEnÿ°*>(
e
);

119 
IPAdd»ss
 
a
;

120 ià(!
	`IPAdd»ssArg
().
	`·r£
(
¡r
, 
a
))

121  
”rh
->
	`”rÜ
("syntaxƒrror");

122 ià(
thunk
)

123 
i
->
_d¡
 = 
a
;

125 
i
->
_¤c
 = 
a
;

127 
	}
}

129 
	gICMPIPEnÿp
::
	$add_hªdËrs
()

131 
	`add_»ad_hªdËr
("¤c", 
»ad_hªdËr
, 0, 
HªdËr
::
CALM
);

132 
	`add_wr™e_hªdËr
("¤c", 
wr™e_hªdËr
, 0);

133 
	`add_»ad_hªdËr
("d¡", 
»ad_hªdËr
, 1, 
HªdËr
::
CALM
);

134 
	`add_wr™e_hªdËr
("d¡", 
wr™e_hªdËr
, 1);

135 
	}
}

137 
CLICK_ENDDECLS


138 
EXPORT_ELEMENT
(
ICMPIPEnÿp
)

	@icmp/icmpipencap.hh

1 #iâdeà
CLICK_ICMPIPENCAP_HH


2 
	#CLICK_ICMPIPENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tim”.hh
>

5 
CLICK_DECLS


48 şas 
	cICMPIPEnÿp
 : 
public
 
EËm’t
 {…ublic:

50 
	$ICMPIPEnÿp
(è
CLICK_COLD
;

51 ~
	$ICMPIPEnÿp
(è
CLICK_COLD
;

53 cÚ¡ *
	$şass_Çme
() const {  "ICMPIPEncap"; }

54 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

55 cÚ¡ *
	$æags
(ècÚ¡ {  "A"; 
	}
}

57 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

58 
	$add_hªdËrs
(è
CLICK_COLD
;

60 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

62 
´iv©e
:

64 
š_addr
 
_¤c
;

65 
š_addr
 
_d¡
;

66 
ušt16_t
 
_icmp_id
;

67 
ušt16_t
 
__id
;

68 
ušt8_t
 
_icmp_ty³
;

69 
ušt8_t
 
_icmp_code
;

70 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


71 
boŞ
 
_®igÃd
;

74 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

75 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

77 
	}
};

79 
	gCLICK_ENDDECLS


	@icmp/icmppingencap.cc

21 
	~<şick/cÚfig.h
>

22 
	~"icmµšg’ÿp.hh
"

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şickÃt/.h
>

26 
	~<şickÃt/icmp.h
>

27 
	~<şick/·ck‘_ªno.hh
>

28 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

29 
CLICK_DECLS


31 
	gICMPPšgEnÿp
::
	$ICMPPšgEnÿp
()

32 : 
	`_icmp_id
(0), 
	$__id
(1)

34 
	}
}

36 
	gICMPPšgEnÿp
::~
	$ICMPPšgEnÿp
()

38 
	}
}

41 
ICMPPšgEnÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

43 ià(
Args
(
cÚf
, 
this
, 
”rh
)

44 .
»ad_mp
("SRC", 
_¤c
)

45 .
»ad_mp
("DST", 
_d¡
)

46 .
»ad
("IDENTIFIER", 
_icmp_id
)

47 .
com¶‘e
() < 0)

50 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


52 
	gªs
, 
	gc
, 
	go
;

53 
	gªs
 = 
Alignm’tInfo
::
qu”y
(
this
, 0, 
c
, 
o
);

54 
	g_®igÃd
 = (
ªs
 && 
c
 =ğ4 && 
o
 == 0);

55 ià(!
	g_®igÃd
)

56 
	g”rh
->
w¬nšg
("IP header unaligned, cannot use fast IP checksum");

57 ià(!
	gªs
)

58 
	g”rh
->
mes§ge
("(Try…assinghe configurationhrough `click-align'.)");

65 
Pack‘
 *

66 
	gICMPPšgEnÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

68 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`push
((
şick_
è+ (
şick_icmp_echo
))) {

69 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
q
->
	`d©a
());

70 

->
_v
 = 4;

71 

->
_hl
 = (
şick_
) >> 2;

72 

->
_tos
 = 0;

73 

->
_Ën
 = 
	`htÚs
(
q
->
	`Ëngth
());

74 

->
_id
 = 
	`htÚs
(
__id
);

75 

->
_off
 = 0;

76 

->
_‰l
 = 255;

77 

->
_p
 = 
IP_PROTO_ICMP
;

78 

->
_sum
 = 0;

79 

->
_¤c
 = 
_¤c
;

80 

->
_d¡
 = 
_d¡
;

82 
şick_icmp_echo
 *
icmp
 = (şick_icmp_echØ*è(

 + 1);

83 
icmp
->
icmp_ty³
 = 
ICMP_ECHO
;

84 
icmp
->
icmp_code
 = 0;

85 
icmp
->
icmp_cksum
 = 0;

86 
icmp
->
icmp_id’tif›r
 = 
	`htÚs
(
_icmp_id
);

87 
icmp
->
icmp_£qu’û
 = 
	`htÚs
(
__id
);

89 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


90 ià(
_®igÃd
)

91 

->
_sum
 = 
	`_ç¡_csum
((*), (
şick_
) >> 2);

93 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

94 #–ià
HAVE_FAST_CHECKSUM


95 

->
_sum
 = 
	`_ç¡_csum
((*), (
şick_
) >> 2);

97 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

99 
icmp
->
icmp_cksum
 = 
	`şick_š_cksum
((cÚ¡ *)icmp, 
q
->
	`Ëngth
(è- (
şick_
));

101 
q
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(
_d¡
));

102 
q
->
	`£t__h—d”
(

, (
şick_
));

104 
__id
 += (_ip_id == 0xFFFF ? 2 : 1);

105  
q
;

108 
	}
}

110 
SŒšg
 
	gICMPPšgEnÿp
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

112 
ICMPPšgEnÿp
 *
i
 = 
¡©ic_ÿ¡
<ICMPPšgEnÿ°*>(
e
);

113 ià(
thunk
)

114  
	`IPAdd»ss
(
i
->
_d¡
).
	`uÅ¬£
();

116  
	`IPAdd»ss
(
i
->
_¤c
).
	`uÅ¬£
();

117 
	}
}

119 
	gICMPPšgEnÿp
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

121 
ICMPPšgEnÿp
 *
i
 = 
¡©ic_ÿ¡
<ICMPPšgEnÿ°*>(
e
);

122 
IPAdd»ss
 
a
;

123 ià(!
	`IPAdd»ssArg
().
	`·r£
(
¡r
, 
a
))

124  
”rh
->
	`”rÜ
("syntaxƒrror");

125 ià(
thunk
)

126 
i
->
_d¡
 = 
a
;

128 
i
->
_¤c
 = 
a
;

130 
	}
}

132 
	gICMPPšgEnÿp
::
	$add_hªdËrs
()

134 
	`add_»ad_hªdËr
("¤c", 
»ad_hªdËr
, 0, 
HªdËr
::
CALM
);

135 
	`add_wr™e_hªdËr
("¤c", 
wr™e_hªdËr
, 0);

136 
	`add_»ad_hªdËr
("d¡", 
»ad_hªdËr
, 1, 
HªdËr
::
CALM
);

137 
	`add_wr™e_hªdËr
("d¡", 
wr™e_hªdËr
, 1);

138 
	}
}

140 
CLICK_ENDDECLS


141 
EXPORT_ELEMENT
(
ICMPPšgEnÿp
)

	@icmp/icmppingencap.hh

2 #iâdeà
CLICK_ICMPPINGENCAP_HH


3 
	#CLICK_ICMPPINGENCAP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/tim”.hh
>

6 
CLICK_DECLS


47 şas 
	cICMPPšgEnÿp
 : 
public
 
EËm’t
 {…ublic:

49 
	$ICMPPšgEnÿp
(è
CLICK_COLD
;

50 ~
	$ICMPPšgEnÿp
(è
CLICK_COLD
;

52 cÚ¡ *
	$şass_Çme
() const {  "ICMPPingEncap"; }

53 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

54 cÚ¡ *
	$æags
(ècÚ¡ {  "A"; 
	}
}

56 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

57 
	$add_hªdËrs
(è
CLICK_COLD
;

59 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

61 
´iv©e
:

63 
š_addr
 
_¤c
;

64 
š_addr
 
_d¡
;

65 
ušt16_t
 
_icmp_id
;

66 
ušt16_t
 
__id
;

67 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


68 
boŞ
 
_®igÃd
;

71 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

72 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

74 
	}
};

76 
	gCLICK_ENDDECLS


	@icmp/icmppingresponder.cc

20 
	~<şick/cÚfig.h
>

21 
	~"icmµšg»¥Úd”.hh
"

22 
	~<şick/cÚå¬£.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/glue.hh
>

25 
	~<şickÃt/‘h”.h
>

26 
	~<şickÃt/.h
>

27 
	~<şickÃt/icmp.h
>

28 
	~<şick/·ck‘_ªno.hh
>

29 
CLICK_DECLS


31 
	gICMPPšgRe¥Úd”
::
	$ICMPPšgRe¥Úd”
()

33 
	}
}

35 
ICMPPšgRe¥Úd”
::~
	$ICMPPšgRe¥Úd”
()

37 
	}
}

39 
Pack‘
 *

40 
ICMPPšgRe¥Úd”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

42 cÚ¡ 
şick_
 *
h_š
 = 
p_š
->
	`_h—d”
();

43 cÚ¡ 
şick_icmp
 *
icmph_š
 = 
p_š
->
	`icmp_h—d”
();

45 ià(
p_š
->
	`Œª¥Üt_Ëngth
(è< (è(
şick_icmp_£qu’ûd
)

46 || 
h_š
->
_p
 !ğ
IP_PROTO_ICMP
 || 
icmph_š
->
icmp_ty³
 !ğ
ICMP_ECHO
) {

47 ià(
	`nouuts
() == 2)

48 
	`ouut
(1).
	`push
(
p_š
);

50 
p_š
->
	`kl
();

54 
Wr™abËPack‘
 *
q
 = 
p_š
->
	`uniqueify
();

55 ià(!
q
)

59 
şick_
 *
h
 = 
q
->
	`_h—d”
();

60 
š_addr
 
tmp_addr
 = 
h
->
_d¡
;

61 
h
->
_d¡
 = iph->
_¤c
;

62 
h
->
_¤c
 = 
tmp_addr
;

66 
	`şick_upd©e_š_cksum
(&
h
->
_sum
, iph->
_off
, 0);

67 
h
->
_off
 = 0;

71 
ušt16_t
 
Şd_hw
 = ((ušt16_ˆ*)
h
)[4];

72 
h
->
_‰l
 = 255;

73 
ušt16_t
 
Ãw_hw
 = ((ušt16_ˆ*)
h
)[4];

74 
	`şick_upd©e_š_cksum
(&
h
->
_sum
, 
Şd_hw
, 
Ãw_hw
);

78 
q
->
	`£t_d¡__ªno
(
h
->
_d¡
);

79 
q
->
	`time¡amp_ªno
().
	`assign_now
();

80 
	`SET_PAINT_ANNO
(
q
, 0);

83 
şick_icmp_echo
 *
icmph
 = 
»š‹½»t_ÿ¡
<şick_icmp_echØ*>(
q
->
	`icmp_h—d”
());

84 
Şd_hw
 = ((
ušt16_t
 *)
icmph
)[0];

85 
icmph
->
icmp_ty³
 = 
ICMP_ECHOREPLY
;

86 
icmph
->
icmp_code
 = 0;

87 
Ãw_hw
 = ((
ušt16_t
 *)
icmph
)[0];

88 
	`şick_upd©e_š_cksum
(&
icmph
->
icmp_cksum
, 
Şd_hw
, 
Ãw_hw
);

89 
	`şick_upd©e_z”o_š_cksum
(&
icmph
->
icmp_cksum
, 
q
->
	`Œª¥Üt_h—d”
(), q->
	`Œª¥Üt_Ëngth
());

91  
q
;

92 
	}
}

94 
CLICK_ENDDECLS


95 
	$EXPORT_ELEMENT
(
ICMPPšgRe¥Úd”
)

96 
	`ELEMENT_MT_SAFE
(
ICMPPšgRe¥Úd”
)

	@icmp/icmppingresponder.hh

1 #iâdeà
CLICK_ICMPPINGRESPONDER_HH


2 
	#CLICK_ICMPPINGRESPONDER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


33 şas 
	cICMPPšgRe¥Úd”
 : 
public
 
EËm’t
 {…ublic:

35 
	$ICMPPšgRe¥Úd”
(è
CLICK_COLD
;

36 ~
	$ICMPPšgRe¥Úd”
(è
CLICK_COLD
;

38 cÚ¡ *
	$şass_Çme
() const {  "ICMPPingResponder"; }

39 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

40 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

42 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

46 
	gCLICK_ENDDECLS


	@icmp/icmppingrewriter.cc

19 
	~<şick/cÚfig.h
>

20 
	~"icmµšg»wr™”.hh
"

21 
	~<şickÃt/.h
>

22 
	~<şickÃt/icmp.h
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/”rÜ.hh
>

26 
CLICK_DECLS


31 
	gICMPPšgRewr™”
::
ICMPPšgFlow
::
	$­¶y
(
Wr™abËPack‘
 *
p
, 
boŞ
 
dœeùiÚ
, 
ªnos
)

33 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

34 
şick_
 *
h
 = 
p
->
	`_h—d”
();

37 cÚ¡ 
IPFlowID
 &
»væow
 = 
_e
[!
dœeùiÚ
].
	`æowid
();

38 
h
->
_¤c
 = 
»væow
.
	`daddr
();

39 
h
->
_d¡
 = 
»væow
.
	`§ddr
();

40 ià(
ªnos
 & 1)

41 
p
->
	`£t_d¡__ªno
(
»væow
.
	`§ddr
());

42 ià(
dœeùiÚ
 && (
ªnos
 & 2))

43 
p
->
	`£t_ªno_u8
(
ªnos
 >> 2, 
_»¶y_ªno
);

44 
	`upd©e_csum
(&
h
->
_sum
, 
dœeùiÚ
, 
__csum_d–
);

47 ià(!
	`IP_FIRSTFRAG
(
h
))

51 
şick_icmp_echo
 *
icmph
 = 
»š‹½»t_ÿ¡
<şick_icmp_echØ*>(
p
->
	`Œª¥Üt_h—d”
());

52 
icmph
->
icmp_id’tif›r
 = (
dœeùiÚ
 ? 
»væow
.
	`¥Üt
(è:„evæow.
	`dpÜt
());

53 
	`upd©e_csum
(&
icmph
->
icmp_cksum
, 
dœeùiÚ
, 
_udp_csum_d–
);

54 
	`şick_upd©e_z”o_š_cksum
(&
icmph
->
icmp_cksum
, 
p
->
	`Œª¥Üt_h—d”
(),…->
	`Œª¥Üt_Ëngth
());

55 
	}
}

58 
	gICMPPšgRewr™”
::
ICMPPšgFlow
::
	$uÅ¬£
(
SŒšgAccum
 &
§
, 
boŞ
 
dœeùiÚ
,

59 
şick_jiff›s_t
 
now
) const

61 cÚ¡ 
IPFlowID
 &
æow
 = 
_e
[
dœeùiÚ
].
	`æowid
();

62 
IPFlowID
 
»wr™‹n_æow
 = 
_e
[
dœeùiÚ
].
	`»wr™‹n_æowid
();

63 
§
 << '(' << 
æow
.
	`§ddr
(è<< ", " << flow.
	`daddr
() << ", "

64 << 
	`Áohs
(
æow
.
	`¥Üt
()) << ") => ("

65 << 
»wr™‹n_æow
.
	`§ddr
(è<< ", " <<„ewr™‹n_æow.
	`daddr
() << ", "

66 << 
	`Áohs
(
»wr™‹n_æow
.
	`¥Üt
()) << ")";

67 
	`uÅ¬£_pÜts
(
§
, 
dœeùiÚ
, 
now
);

68 
	}
}

72 
	gICMPPšgRewr™”
::
	$ICMPPšgRewr™”
()

74 
	}
}

76 
ICMPPšgRewr™”
::~
	$ICMPPšgRewr™”
()

78 
	}
}

81 
ICMPPšgRewr™”
::
	$ÿ¡
(cÚ¡ *
n
)

83 ià(
	`¡rcmp
(
n
, "IPRewriterBase") == 0)

84  
¡©ic_ÿ¡
<
IPRewr™”Ba£
 *>(
this
);

85 ià(
	`¡rcmp
(
n
, "ICMPPingRewriter") == 0)

86  
¡©ic_ÿ¡
<
ICMPPšgRewr™”
 *>(
this
);

89 
	}
}

92 
	gICMPPšgRewr™”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

95 
	g_timeouts
[0] = 5 * 60;

96 
boŞ
 
	gd¡_ªno
 = 
Œue
, 
	ghas_»¶y_ªno
 = 
çl£
;

97 
	g»¶y_ªno
;

99 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

100 .
»ad
("DST_ANNO", 
d¡_ªno
)

101 .
»ad
("REPLY_ANNO", 
AÂoArg
(1), 
»¶y_ªno
).
»ad_¡©us
(
has_»¶y_ªno
)

102 .
cÚsume
() < 0)

105 
	g_ªnos
 = (
d¡_ªno
 ? 1 : 0è+ (
has_»¶y_ªno
 ? 2 + (
»¶y_ªno
 << 2) : 0);

106  
	gIPRewr™”Ba£
::
cÚfigu»
(
cÚf
, 
”rh
);

109 
IPRewr™”EÁry
 *

110 
	gICMPPšgRewr™”
::
	$g‘_’Œy
(
_p
, cÚ¡ 
IPFlowID
 &
xæowid
, 
šput
)

112 ià(
_p
 !ğ
IP_PROTO_ICMP
)

114 
boŞ
 
echo
 = (
šput
 !ğ
g‘_’Œy_»¶y
);

115 
IPFlowID
 
	`æowid
(
xæowid
.
	`§ddr
(), xæowid.
	`¥Üt
(è+ !
echo
,

116 
xæowid
.
	`daddr
(), xæowid.
	`¥Üt
(è+ 
echo
);

117 
IPRewr™”EÁry
 *
m
 = 
_m­
.
	`g‘
(
æowid
);

118 ià(!
m
 && (è
šput
 < (è
_šput_¥ecs
.
	`size
()) {

119 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
[
šput
];

120 
IPFlowID
 
»wr™‹n_æowid
 = IPFlowID::
	`unš™Ÿlized_t
();

121 ià(
is
.
	`»wr™e_æowid
(
æowid
, 
»wr™‹n_æowid
, 0è=ğ
rw_addm­
) {

122 
»wr™‹n_æowid
.
	`£t_dpÜt
Ôewr™‹n_æowid.
	`¥Üt
() + 1);

123 
m
 = 
ICMPPšgRewr™”
::
	`add_æow
(
IP_PROTO_ICMP
, 
æowid
, 
»wr™‹n_æowid
, 
šput
);

126  
m
;

127 
	}
}

129 
IPRewr™”EÁry
 *

130 
	gICMPPšgRewr™”
::
	$add_æow
(, cÚ¡ 
IPFlowID
 &
æowid
,

131 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
, 
šput
)

133 *
d©a
;

134 ià((
ušt16_t
è(
æowid
.
	`¥Üt
(è+ 1è!ğæowid.
	`dpÜt
()

135 || (
ušt16_t
è(
»wr™‹n_æowid
.
	`¥Üt
(è+ 1è!ğ»wr™‹n_æowid.
	`dpÜt
()

136 || !(
d©a
 = 
_®loÿtÜ
.
	`®loÿ‹
()))

139 
ICMPPšgFlow
 *
æow
 = 
	`Ãw
(
d©a
) ICMPPingFlow

140 (&
_šput_¥ecs
[
šput
], 
æowid
, 
»wr™‹n_æowid
,

141 !!
_timeouts
[1], 
	`şick_jiff›s
(è+ 
	`»Ëvªt_timeout
(_timeouts));

143  
	`¡Üe_æow
(
æow
, 
šput
, 
_m­
);

144 
	}
}

147 
	gICMPPšgRewr™”
::
	$push
(
pÜt
, 
Pack‘
 *
p_š
)

149 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

150 
şick_
 *
h
 = 
p
->
	`_h—d”
();

151 
şick_icmp_echo
 *
icmph
 = 
»š‹½»t_ÿ¡
<şick_icmp_echØ*>(
p
->
	`icmp_h—d”
());

154 ià(
h
->
_p
 !ğ
IP_PROTO_ICMP


155 || !
	`IP_FIRSTFRAG
(
h
)

156 || 
p
->
	`Œª¥Üt_Ëngth
() < 6

157 || (
icmph
->
icmp_ty³
 !ğ
ICMP_ECHO
 && icmph->icmp_ty³ !ğ
ICMP_ECHOREPLY
)) {

158 
m­pšg_ç
:

159 cÚ¡ 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
[
pÜt
];

160 ià(
is
.
kšd
 =ğ
IPRewr™”IÅut
::
i_nochªge
)

161 
	`ouut
(
is
.
fouut
).
	`push
(
p
);

163 
p
->
	`kl
();

167 
boŞ
 
echo
 = 
icmph
->
icmp_ty³
 =ğ
ICMP_ECHO
;

168 
IPFlowID
 
	`æowid
(
h
->
_¤c
, 
icmph
->
icmp_id’tif›r
 + !
echo
,

169 
h
->
_d¡
, 
icmph
->
icmp_id’tif›r
 + 
echo
);

171 
IPRewr™”EÁry
 *
m
 = 
_m­
.
	`g‘
(
æowid
);

173 ià(!
m
 && !
echo
)

174 
m­pšg_ç
;

175 ià(!
m
) {

176 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
.
	`unchecked_©
(
pÜt
);

177 
IPFlowID
 
»wr™‹n_æowid
 = IPFlowID::
	`unš™Ÿlized_t
();

178 
»suÉ
 = 
is
.
	`»wr™e_æowid
(
æowid
, 
»wr™‹n_æowid
, 
p
);

179 ià(
»suÉ
 =ğ
rw_addm­
) {

180 
»wr™‹n_æowid
.
	`£t_dpÜt
Ôewr™‹n_æowid.
	`¥Üt
() + 1);

181 
m
 = 
ICMPPšgRewr™”
::
	`add_æow
(
IP_PROTO_ICMP
, 
æowid
, 
»wr™‹n_æowid
, 
pÜt
);

183 ià(!
m
) {

184 
	`checked_ouut_push
(
»suÉ
, 
p
);

186 } ià(
_ªnos
 & 2)

187 
m
->
	`æow
()->
	`£t_»¶y_ªno
(
p
->
	`ªno_u8
(
_ªnos
 >> 2));

190 
ICMPPšgFlow
 *
mf
 = 
¡©ic_ÿ¡
<ICMPPšgFlow *>(
m
->
	`æow
());

191 
mf
->
	`­¶y
(
p
, 
m
->
	`dœeùiÚ
(), 
_ªnos
);

192 
mf
->
	`chªge_expœy_by_timeout
(
_h—p
, 
	`şick_jiff›s
(), 
_timeouts
);

194 
	`ouut
(
m
->ouut()).
	`push
(
p
);

195 
	}
}

198 
SŒšg


199 
	gICMPPšgRewr™”
::
	$dump_m­pšgs_hªdËr
(
EËm’t
 *
e
, *)

201 
ICMPPšgRewr™”
 *
rw
 = (ICMPPšgRewr™” *)
e
;

202 
SŒšgAccum
 
§
;

203 
şick_jiff›s_t
 
now
 = 
	`şick_jiff›s
();

204 
M­
::
™”©Ü
 
™”
 = 
rw
->
_m­
.
	`begš
(); i‹r.
	`live
(); ++iter) {

205 
ICMPPšgFlow
 *
f
 = 
¡©ic_ÿ¡
<ICMPPšgFlow *>(
™”
->
	`æow
());

206 
f
->
	`uÅ¬£
(
§
, 
™”
->
	`dœeùiÚ
(), 
now
);

207 
§
 << '\n';

209  
§
.
	`ke_¡ršg
();

210 
	}
}

213 
	gICMPPšgRewr™”
::
	$add_hªdËrs
()

215 
	`add_»ad_hªdËr
("bË", 
dump_m­pšgs_hªdËr
);

216 
	`add_»ad_hªdËr
("m­pšgs", 
dump_m­pšgs_hªdËr
, 0, 
HªdËr
::
h_d•»ÿ‹d
);

217 
	`add_»wr™”_hªdËrs
(
Œue
);

218 
	}
}

220 
CLICK_ENDDECLS


221 
	$ELEMENT_REQUIRES
(
IPRewr™”Ba£
)

222 
	`EXPORT_ELEMENT
(
ICMPPšgRewr™”
)

	@icmp/icmppingrewriter.hh

1 #iâdeà
CLICK_ICMPPINGREWRITER_HH


2 
	#CLICK_ICMPPINGREWRITER_HH


	)

3 
	~"–em’ts//»wr™”ba£.hh
"

4 
	~"–em’ts//rwm­pšg.hh
"

5 
	~<şickÃt/icmp.h
>

6 
CLICK_DECLS


81 şas 
	cICMPPšgRewr™”
 : 
public
 
IPRewr™”Ba£
 {…ublic:

83 şas 
	cICMPPšgFlow
 : 
public
 
IPRewr™”Flow
 {…ublic:

85 
ICMPPšgFlow
(
IPRewr™”IÅut
 *
owÃr
, cÚ¡ 
IPFlowID
 &
æowid
,

86 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
,

87 
boŞ
 
gu¬ª‹ed
, 
şick_jiff›s_t
 
expœy_j
)

88 : 
IPRewr™”Flow
(
owÃr
, 
æowid
, 
»wr™‹n_æowid
,

89 
IP_PROTO_ICMP
, 
gu¬ª‹ed
, 
expœy_j
) {

90 
	m_udp_csum_d–
 = 0;

91 
şick_upd©e_š_cksum
(&
_udp_csum_d–
, 
æowid
.
¥Üt
(), 
»wr™‹n_æowid
.sport());

94 
­¶y
(
Wr™abËPack‘
 *
p
, 
boŞ
 
dœeùiÚ
, 
ªnos
);

96 
uÅ¬£
(
SŒšgAccum
 &
§
, 
boŞ
 
dœeùiÚ
, 
şick_jiff›s_t
 
now
) const;

100 
	$ICMPPšgRewr™”
(è
CLICK_COLD
;

101 ~
	$ICMPPšgRewr™”
(è
CLICK_COLD
;

103 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "ICMPPšgRewr™”"; 
	}
}

104 *
ÿ¡
(const *);

106 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

108 
IPRewr™”EÁry
 *
g‘_’Œy
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
, 
šput
);

109 
IPRewr™”EÁry
 *
add_æow
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
,

110 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
, 
šput
);

111 
de¡roy_æow
(
IPRewr™”Flow
 *
æow
);

113 
push
(, 
Pack‘
 *);

115 
	$add_hªdËrs
(è
CLICK_COLD
;

117 
´iv©e
:

119 
SizedHashAÎoÿtÜ
<(
ICMPPšgFlow
)> 
_®loÿtÜ
;

120 
_ªnos
;

122 
SŒšg
 
	`dump_m­pšgs_hªdËr
(
EËm’t
 *, *);

124 
	}
};

127 
šlše
 

128 
	gICMPPšgRewr™”
::
	$de¡roy_æow
(
IPRewr™”Flow
 *
æow
)

130 
	`unm­_æow
(
æow
, 
_m­
);

131 
¡©ic_ÿ¡
<
ICMPPšgFlow
 *>(
æow
)->~
	`ICMPPšgFlow
();

132 
_®loÿtÜ
.
	`d—Îoÿ‹
(
æow
);

133 
	}
}

135 
	gCLICK_ENDDECLS


	@icmp/icmprewriter.cc

19 
	~<şick/cÚfig.h
>

20 
	~"icm´ewr™”.hh
"

21 
	~"–em’ts//rwm­pšg.hh
"

22 
	~<şickÃt/icmp.h
>

23 
	~<şickÃt/tı.h
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/”rÜ.hh
>

27 
CLICK_DECLS


29 
	gICMPRewr™”
::
	$ICMPRewr™”
()

31 
	}
}

33 
ICMPRewr™”
::~
	$ICMPRewr™”
()

35 
	}
}

38 
ICMPRewr™”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40 
SŒšg
 
	g¬g
;

41 
boŞ
 
	gd¡_ªno
 = 
Œue
, 
	ghas_»¶y_ªno
 = 
çl£
;

42 
	g»¶y_ªno
;

43 ià(
Args
(
cÚf
, 
this
, 
”rh
)

44 .
»ad_mp
("MAPS", 
AnyArg
(), 
¬g
)

45 .
»ad
("DST_ANNO", 
d¡_ªno
)

46 .
»ad
("REPLY_ANNO", 
AÂoArg
(1), 
»¶y_ªno
).
»ad_¡©us
(
has_»¶y_ªno
)

47 .
com¶‘e
() < 0)

50 
	g_ªnos
 = (
d¡_ªno
 ? 1 : 0è+ (
has_»¶y_ªno
 ? 2 + (
»¶y_ªno
 << 2) : 0);

52 
	gVeùÜ
<
	gSŒšg
> 
	gwÜds
;

53 
ı_¥aûvec
(
¬g
, 
wÜds
);

55 
	gi
 = 0; i < 
	gwÜds
.
size
(); i++) {

56 
SŒšg
 
	g–Šame
 = 
wÜds
[
i
];

57 
	gpÜt_off£t
 = -1;

58 
	gcŞÚ
 = 
–Šame
.
fšd_Ëá
(':');

59 ià(
	gcŞÚ
 >= 0) {

60 ià(!
IÁArg
().
·r£
(
–Šame
.
sub¡ršg
(
cŞÚ
+1), 
pÜt_off£t
)) {

61 
·r£_´obËm
:

62 
”rh
->
”rÜ
("% nÙ‡ÀIP„ewr™”", 
–Šame
.
c_¡r
());

65 
	g–Šame
 = 
wÜds
[
i
].
sub¡ršg
(0, 
cŞÚ
);

67 
EËm’t
 *
	ge
;

68 ià(!(
	ge
 = 
ı_–em’t
(
–Šame
, 
this
)))

69 
	g·r£_´obËm
;

70 
IPRewr™”Ba£
 *
	grw
;

71 ià(
	gpÜt_off£t
 >ğ0 && 
pÜt_off£t
 + 
e
->
nouuts
() >‚outputs()) {

72 
”rh
->
”rÜ
("% pÜˆoff£ˆ»quœe mÜthª %d %s", 
wÜds
[
i
].
c_¡r
(), 
nouuts
(),‚outputs() == 1 ? "output" : "outputs");

75 ià((
	grw
 = 
¡©ic_ÿ¡
<
IPRewr™”Ba£
 *>(
e
->
ÿ¡
("IPRewriterBase"))))

76 
_m­s
.
push_back
(
M­EÁry
(
rw
, 
pÜt_off£t
));

78 
	g·r£_´obËm
;

81 ià(
	g_m­s
.
size
() == 0)

82  
”rh
->
”rÜ
("no IP„ewriters supplied");

83  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

87 
	$upd©e_š_cksum
(
ušt16_t
 *
csum
, cÚ¡ ušt16_ˆ*
Şd_hw
, cÚ¡ ušt16_ˆ*
Ãw_hw
,

88 
nhw
)

90 ; 
nhw
 > 0; --nhw, ++
Şd_hw
, ++
Ãw_hw
)

91 
	`şick_upd©e_š_cksum
(
csum
, *
Şd_hw
, *
Ãw_hw
);

92 
	}
}

95 
	gICMPRewr™”
::
	$hªdË
(
Wr™abËPack‘
 *
p
)

98 
şick_icmp
 *
icmph
 = 
p
->
	`icmp_h—d”
();

99 ià(
icmph
->
icmp_ty³
 !ğ
ICMP_UNREACH


100 && 
icmph
->
icmp_ty³
 !ğ
ICMP_TIMXCEED


101 && 
icmph
->
icmp_ty³
 !ğ
ICMP_PARAMPROB


102 && 
icmph
->
icmp_ty³
 !ğ
ICMP_SOURCEQUENCH


103 && 
icmph
->
icmp_ty³
 !ğ
ICMP_REDIRECT
)

104  
unm­³d_ouut
;

107 
şick_
 *
’c_h
 = 
»š‹½»t_ÿ¡
<şick_ *>(
icmph
 + 1);

108 ià(
p
->
	`Œª¥Üt_Ëngth
(è< (è((
şick_icmp
è+ (
şick_
)))

109  
unm­³d_ouut
;

110 
ušt8_t
 *
’c_Œª¥
 = 
»š‹½»t_ÿ¡
<ušt8_ˆ*>(
’c_h
è+ (’c_h->
_hl
 << 2);

111 ià(
’c_h
->
_v
 != 4

112 || 
’c_Œª¥
 < 
»š‹½»t_ÿ¡
<
ušt8_t
 *>(
’c_h
 + 1))

113  
unm­³d_ouut
;

116 
’c_p
 = 
’c_h
->
_p
;

117 
IPFlowID
 
	`£¬ch_æowid
(
’c_h
->
_d¡
, 0,ƒnc_h->
_¤c
, 0);

118 
boŞ
 
u£_’c_Œª¥
 = 
çl£
;

119 ià(
’c_p
 =ğ
IP_PROTO_TCP


120 || 
’c_p
 =ğ
IP_PROTO_UDP


121 || 
’c_p
 =ğ
IP_PROTO_DCCP
) {

122 ià(
’c_Œª¥
 + 8 <ğ
p
->
	`’d_d©a
()

123 && 
	`IP_FIRSTFRAG
(
’c_h
)) {

124 
şick_udp
 *
’c_udph
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(
’c_Œª¥
);

125 
£¬ch_æowid
.
	`£t_¥Üt
(
’c_udph
->
uh_dpÜt
);

126 
£¬ch_æowid
.
	`£t_dpÜt
(
’c_udph
->
uh_¥Üt
);

127 
u£_’c_Œª¥
 = 
Œue
;

129 } ià(
’c_p
 =ğ
IP_PROTO_ICMP
) {

130 
şick_icmp_echo
 *
’c_icmph
 = 
»š‹½»t_ÿ¡
<şick_icmp_echØ*>(
’c_Œª¥
);

131 ià(
’c_Œª¥
 + 6 <ğ
p
->
	`’d_d©a
()

132 && 
	`IP_FIRSTFRAG
(
’c_h
)

133 && 
’c_icmph
->
icmp_ty³
 =ğ
ICMP_ECHO
) {

134 
£¬ch_æowid
.
	`£t_¥Üt
(
’c_icmph
->
icmp_id’tif›r
);

135 
u£_’c_Œª¥
 = 
Œue
;

140 
IPRewr™”EÁry
 *
’Œy
 = 0;

141 
m­id
;

142 
m­id
 = 0; m­id < 
_m­s
.
	`size
(); ++mapid)

143 ià((
’Œy
 = 
_m­s
[
m­id
].
_–t
->
	`g‘_’Œy
(
’c_p
, 
£¬ch_æowid
, 
IPRewr™”Ba£
::
g‘_’Œy_»¶y
)))

145 ià(!
’Œy
)

146  
unm­³d_ouut
;

149 
IPFlowID
 
Ãw_æowid
 = 
’Œy
->
	`»wr™‹n_æowid
();

158 
nhw
;

159 
ušt16_t
 
Şd_hw
[8], 
Ãw_hw
[8];

162 ià(
	`IPAdd»ss
(
p
->
	`_h—d”
()->
_d¡
è=ğ
£¬ch_æowid
.
	`daddr
()) {

163 
şick_
 *
h
 = 
p
->
	`_h—d”
();

164 
	`memıy
(
Şd_hw
, &
h
->
_d¡
, 4);

165 
h
->
_d¡
 = 
Ãw_æowid
.
	`daddr
();

166 
	`upd©e_š_cksum
(&
h
->
_sum
, 
Şd_hw
, 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt16_t
 *>(&h->
_d¡
), 2);

167 ià(
_ªnos
 & 1)

168 
p
->
	`£t_d¡__ªno
(
Ãw_æowid
.
	`daddr
());

170 ià(
’Œy
->
	`dœeùiÚ
(è&& (
_ªnos
 & 2))

171 
p
->
	`£t_ªno_u8
(
_ªnos
 >> 2, 
’Œy
->
	`æow
()->
	`»¶y_ªno
());

174 
	`memıy
(&
Şd_hw
[1], &
’c_h
->
_¤c
, 8);

175 
Şd_hw
[0] = 
’c_h
->
_sum
;

176 
’c_h
->
_¤c
 = 
Ãw_æowid
.
	`daddr
();

177 
’c_h
->
_d¡
 = 
Ãw_æowid
.
	`§ddr
();

178 
	`memıy
(&
Ãw_hw
[1], &
’c_h
->
_¤c
, 8);

179 
	`upd©e_š_cksum
(&
’c_h
->
_sum
, 
Şd_hw
 + 1, 
Ãw_hw
 + 1, 4);

180 
Ãw_hw
[0] = 
’c_h
->
_sum
;

181 
nhw
 = 5;

184 ià(
u£_’c_Œª¥
) {

185 ià(
’c_p
 =ğ
IP_PROTO_TCP


186 || 
’c_p
 =ğ
IP_PROTO_UDP


187 || 
’c_p
 =ğ
IP_PROTO_DCCP
) {

188 
şick_udp
 *
’c_udph
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(
’c_Œª¥
);

189 
	`memıy
(
Şd_hw
 + 
nhw
, &
’c_udph
->
uh_¥Üt
, 4);

190 
’c_udph
->
uh_¥Üt
 = 
Ãw_æowid
.
	`dpÜt
();

191 
’c_udph
->
uh_dpÜt
 = 
Ãw_æowid
.
	`¥Üt
();

192 
	`memıy
(
Ãw_hw
 + 
nhw
, &
’c_udph
->
uh_¥Üt
, 4);

193 
nhw
 += 2;

195 
ušt16_t
 *
’c_csum
 = 0;

196 ià(
’c_p
 =ğ
IP_PROTO_TCP
 && 
’c_Œª¥
 + 18 <ğ
p
->
	`’d_d©a
())

197 
’c_csum
 = &(
»š‹½»t_ÿ¡
<
şick_tı
 *>(
’c_Œª¥
)->
th_sum
);

198 ià(
’c_p
 =ğ
IP_PROTO_UDP
 && 
’c_Œª¥
 + 8 <ğ
p
->
	`’d_d©a
()

199 && 
»š‹½»t_ÿ¡
<
şick_udp
 *>(
’c_Œª¥
)->
uh_sum
 != 0)

200 
’c_csum
 = &(
»š‹½»t_ÿ¡
<
şick_udp
 *>(
’c_Œª¥
)->
uh_sum
);

201 ià(
’c_csum
) {

202 
Şd_hw
[
nhw
] = *
’c_csum
;

203 
	`upd©e_š_cksum
(
’c_csum
, 
Şd_hw
 + 1, 
Ãw_hw
 + 1, 
nhw
 - 1);

204 
Ãw_hw
[
nhw
] = *
’c_csum
;

205 
nhw
++;

208 } ià(
’c_p
 =ğ
IP_PROTO_ICMP
) {

209 
şick_icmp_echo
 *
’c_icmph
 = 
»š‹½»t_ÿ¡
<şick_icmp_echØ*>(
’c_Œª¥
);

210 
Şd_hw
[
nhw
] = 
’c_icmph
->
icmp_id’tif›r
;

211 
’c_icmph
->
icmp_id’tif›r
 = 
Ãw_hw
[
nhw
] = 
Ãw_æowid
.
	`dpÜt
();

212 
nhw
++;

213 
Şd_hw
[
nhw
] = 
’c_icmph
->
icmp_cksum
;

214 
	`şick_upd©e_š_cksum
(&
’c_icmph
->
icmp_cksum
, 
Şd_hw
[
nhw
-1], 
Ãw_hw
[nhw-1]);

215 
	`şick_upd©e_z”o_š_cksum
(&
’c_icmph
->
icmp_cksum
, 
’c_Œª¥
, 
p
->
	`’d_d©a
() -ƒnc_transp);

216 
Ãw_hw
[
nhw
] = 
’c_icmph
->
icmp_cksum
;

217 
nhw
++;

222 
	`upd©e_š_cksum
(&
icmph
->
icmp_cksum
, 
Şd_hw
, 
Ãw_hw
, 
nhw
);

224 ià(
_m­s
[
m­id
].
_pÜt_off£t
 >= 0)

225  
_m­s
[
m­id
].
_pÜt_off£t
 + 
’Œy
->
	`ouut
();

228 
	}
}

231 
	gICMPRewr™”
::
	$push
(, 
Pack‘
 *
p_š
)

233 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

234 ià(!
p
)

236 ià(
p
->
	`_h—d”
()->
_p
 !ğ
IP_PROTO_ICMP
) {

237 
p
->
	`kl
();

241 
ouut
 = 
	`hªdË
(
p
);

242 
	`checked_ouut_push
(
ouut
, 
p
);

243 
	}
}

245 
CLICK_ENDDECLS


246 
	$ELEMENT_REQUIRES
(
IPRewr™”Ba£
 
ICMPPšgRewr™”
)

247 
	`EXPORT_ELEMENT
(
ICMPRewr™”
)

	@icmp/icmprewriter.hh

1 #iâdeà
CLICK_ICMPREWRITER_HH


2 
	#CLICK_ICMPREWRITER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/udp.h
>

5 
	~<şickÃt/icmp.h
>

6 
	~"–em’ts//»wr™”ba£.hh
"

7 
CLICK_DECLS


61 şas 
	cICMPRewr™”
 : 
public
 
EËm’t
 {…ublic:

63 
	$ICMPRewr™”
(è
CLICK_COLD
;

64 ~
	$ICMPRewr™”
(è
CLICK_COLD
;

66 cÚ¡ *
	$şass_Çme
() const {  "ICMPRewriter"; }

67 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-"; 
	}
}

68 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

70 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

72 
push
(, 
Pack‘
 *);

74 
	g´Ùeùed
:

76 
	sM­EÁry
 {

77 
M­EÁry
(
IPRewr™”Ba£
 *
e
, 
po
è: 
_–t
Ó), 
_pÜt_off£t
(po) {}

78 
IPRewr™”Ba£
 *
	g_–t
;

79 
	g_pÜt_off£t
;

83 
	gunm­³d_ouut
 = -1

86 
	gVeùÜ
<
	gM­EÁry
> 
	g_m­s
;

87 
	g_ªnos
;

89 
»wr™e_·ck‘
(
Wr™abËPack‘
 *, 
şick_
 *, 
şick_udp
 *,

90 cÚ¡ 
IPFlowID
 &, 
IPRewr™”EÁry
 *);

91 
»wr™e_pšg_·ck‘
(
Wr™abËPack‘
 *, 
şick_
 *, 
şick_icmp_echo
 *,

92 cÚ¡ 
IPFlowID
 &, 
IPRewr™”EÁry
 *);

94 
hªdË
(
Wr™abËPack‘
 *
p
);

98 
	gCLICK_ENDDECLS


	@icmp/icmpsendpings.cc

19 
	~<şick/cÚfig.h
>

20 
	~"icmp£ndpšgs.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/.h
>

25 
	~<şickÃt/icmp.h
>

26 
	~<şick/·ck‘_ªno.hh
>

27 
	~<şick/š‹g”s.hh
>

28 
	~<şick/hªdËrÿÎ.hh
>

29 
	~<şick/¡¿ccum.hh
>

30 #ià
CLICK_LINUXMODULE


31 
	~<şick/cxx´Ùeù.h
>

32 
	gCLICK_CXX_PROTECT


33 
	~<lšux/vm®loc.h
>

34 
	gCLICK_CXX_UNPROTECT


35 
	~<şick/cxxuÅrÙeù.h
>

37 
CLICK_DECLS


39 
	gICMPPšgSourû
::
	$ICMPPšgSourû
()

40 : 
	`_lim™
(-1), 
	`_tim”
(
this
), 
	$_»ûiv”
(0)

42 
	}
}

44 
	gICMPPšgSourû
::~
	$ICMPPšgSourû
()

46 
	}
}

49 
ICMPPšgSourû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

51 
boŞ
 
	ghas_š‹rv®
;

52 
	g_icmp_id
 = 0;

53 
	g_š‹rv®
 = 1000;

54 
	g_d©a
 = 
SŒšg
();

55 
	g_aùive
 = 
Œue
;

56 
	g_v”bo£
 = 
Œue
;

57 
	g_¡İ
 = 
çl£
;

58 
	g_mœrÜ
 = 
çl£
;

59 ià(
Args
(
cÚf
, 
this
, 
”rh
)

60 .
»ad_mp
("SRC", 
_¤c
)

61 .
»ad_mp
("DST", 
_d¡
)

62 .
»ad
("INTERVAL", 
SecÚdsArg
(3), 
_š‹rv®
).
»ad_¡©us
(
has_š‹rv®
)

63 .
»ad
("IDENTIFIER", 
_icmp_id
)

64 .
»ad
("DATA", 
_d©a
)

65 .
»ad
("LIMIT", 
_lim™
)

66 .
»ad
("ACTIVE", 
_aùive
)

67 .
»ad
("VERBOSE", 
_v”bo£
)

68 .
»ad
("STOP", 
_¡İ
)

69 .
»ad
("MIRROR", 
_mœrÜ
)

70 .
com¶‘e
() < 0)

72 #iâdeà
__lšux__


73 
	g_icmp_id
 = 
htÚs
(
_icmp_id
);

75 ià(
	g_š‹rv®
 == 0)

76 
”rh
->
w¬nšg
("INTERVAL so smallhat it is zero");

77 ià(
ouut_is_puÎ
(0è&& 
	ghas_š‹rv®
)

78 
	g”rh
->
w¬nšg
("element is…ull, INTERVAL…arameter will be ignored");

79 ià(
ouut_is_puÎ
(0è&& 
	g_mœrÜ
)

80  
	g”rh
->
”rÜ
("MIRROR invalid on…ullƒlement");

85 
	gICMPPšgSourû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

87 
_couÁ
 = 0;

88 
_tim”
.
	`š™Ÿlize
(
this
);

89 ià(
_lim™
 !ğ0 && 
_aùive
 && 
	`ouut_is_push
(0))

90 
_tim”
.
	`scheduË_aá”_m£c
(
_š‹rv®
);

91 ià(
	`nšputs
() == 1) {

92 #ià
CLICK_LINUXMODULE


93 
_»ûiv”
 = (
Reûiv”Info
 *)
	`vm®loc
((ReceiverInfo));

95 
_»ûiv”
 = 
Ãw
 
Reûiv”Info
;

97 ià(!
_»ûiv”
)

98  
”rh
->
	`”rÜ
("out of memory!");

99 
	`mem£t
(
_»ûiv”
, 0, (
Reûiv”Info
));

102 
	}
}

105 
	gICMPPšgSourû
::
	$ş—nup
(
CËªupSge
)

107 ià(
_»ûiv”
) {

108 ià(
_v”bo£
) {

109 
P»fixE¼ÜHªdËr
 
	`³¼h
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
(), 
	`deş¬©iÚ
() + ": ");

110 
³¼h
.
	`mes§ge
("%s", 
HªdËrC®l
::
	`ÿÎ_»ad
(
this
, "summ¬y", &³¼h).
	`c_¡r
());

112 #ià
CLICK_LINUXMODULE


113 
	`vä“
(
_»ûiv”
);

115 
d–‘e
 
_»ûiv”
;

118 
	}
}

120 
Pack‘
*

121 
	gICMPPšgSourû
::
	$make_·ck‘
(
Wr™abËPack‘
 *
q
)

123 
size_t
 
hsz
 = (
şick_
è+ (
şick_icmp_echo
);

124 
boŞ
 
d©a
 = !
q
;

125 ià(!
q
)

126 
q
 = 
Pack‘
::
	`make
(
hsz
 + 
_d©a
.
	`Ëngth
());

127 ià(!
q
)

129 
	`mem£t
(
q
->
	`d©a
(), '\0', 
hsz
);

130 ià(
d©a
)

131 
	`memıy
(
q
->
	`d©a
(è+ 
hsz
, 
_d©a
.d©a(), _d©a.
	`Ëngth
());

133 
şick_
 *
n
 = 
»š‹½»t_ÿ¡
<şick_ *>(
q
->
	`d©a
());

134 
n
->
_v
 = 4;

135 
n
->
_hl
 = (
şick_
) >> 2;

136 
n
->
_Ën
 = 
	`htÚs
(
q
->
	`Ëngth
());

137 
ušt16_t
 
_id
 = (
_couÁ
 % 0xFFFF) + 1;

138 
n
->
_id
 = 
	`htÚs
(ip_id);

139 
n
->
_p
 = 
IP_PROTO_ICMP
;

140 
n
->
_‰l
 = 200;

141 
n
->
_¤c
 = 
_¤c
;

142 
n
->
_d¡
 = 
_d¡
;

143 
n
->
_sum
 = 
	`şick_š_cksum
((*ê, (
şick_
));

145 
şick_icmp_echo
 *
iı
 = (şick_icmp_echØ*è(
n
 + 1);

146 
iı
->
icmp_ty³
 = 
ICMP_ECHO
;

147 
iı
->
icmp_code
 = 0;

148 
iı
->
icmp_id’tif›r
 = 
_icmp_id
;

149 
iı
->
icmp_£qu’û
 = 
	`htÚs
(
_id
);

151 
iı
->
icmp_cksum
 = 
	`şick_š_cksum
((cÚ¡ *)iı, (
şick_icmp_£qu’ûd
è+ 
_d©a
.
	`Ëngth
());

153 
q
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(
_d¡
));

154 
q
->
	`£t__h—d”
(
n
, (
şick_
));

155 
q
->
	`time¡amp_ªno
().
	`assign_now
();

157 ià(
_»ûiv”
)

158 
_»ûiv”
->
£nd_time¡amp
[
iı
->
icmp_£qu’û
] = 
q
->
	`time¡amp_ªno
();

160  
q
;

161 
	}
}

164 
	gICMPPšgSourû
::
	$run_tim”
(
Tim”
 *)

166 ià(
_couÁ
 >ğ
_lim™
 && _limit >= 0) {

167 ià(
_¡İ
)

168 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

169 } ià(
Pack‘
 *
q
 = 
	`make_·ck‘
(0)) {

170 
	`ouut
(0).
	`push
(
q
);

171 
_couÁ
++;

172 
_tim”
.
	`»scheduË_aá”_m£c
(
_š‹rv®
);

174 
	}
}

176 
Pack‘
*

177 
	gICMPPšgSourû
::
	$puÎ
()

179 
Pack‘
 *
p
 = 0;

180 ià(
_couÁ
 < 
_lim™
 || _limit < 0) {

181 ià((
p
 = 
	`make_·ck‘
(0)))

182 
_couÁ
++;

183 } ià(
_¡İ
) {

184 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

185 
_¡İ
 = 
çl£
;

187  
p
;

188 
	}
}

191 
	gICMPPšgSourû
::
	$push
(, 
Pack‘
 *
p
)

193 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

194 cÚ¡ 
şick_icmp_echo
 *
icmph
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_icmp_echØ*>(
p
->
	`icmp_h—d”
());

195 ià(
p
->
	`has_ÃtwÜk_h—d”
(è&& 
h
->
_p
 =ğ
IP_PROTO_ICMP


196 && 
p
->
	`Œª¥Üt_Ëngth
(è>ğ()(
şick_icmp_echo
)

197 && 
icmph
->
icmp_ty³
 =ğ
ICMP_ECHOREPLY


198 && 
icmph
->
icmp_id’tif›r
 =ğ
_icmp_id
) {

199 
Time¡amp
 *
£nd_ts
 = &
_»ûiv”
->
£nd_time¡amp
[
icmph
->
icmp_£qu’û
];

201 ià(!*
£nd_ts
)

204 ià(
£nd_ts
->
	`is_Ãg©ive
()) {

205 
_»ûiv”
->
ndu¶iÿ‹
++;

206 *
£nd_ts
 = -*send_ts;

209 
ušt32_t
 
diffv®
;

210 ià(
p
->
	`time¡amp_ªno
()) {

211 
Time¡amp
 
diff
 = 
p
->
	`time¡amp_ªno
(è- *
£nd_ts
;

212 
diffv®
 = 
diff
.
	`u£cv®
();

213 ià(
diffv®
 < 
_»ûiv”
->
time_mš
 || !_»ûiv”->
Äeûived
)

214 
_»ûiv”
->
time_mš
 = 
diffv®
;

215 ià(
diffv®
 > 
_»ûiv”
->
time_max
 || !_»ûiv”->
Äeûived
)

216 
_»ûiv”
->
time_max
 = 
diffv®
;

217 
_»ûiv”
->
time_sum
 +ğ
diffv®
;

218 
_»ûiv”
->
time_sq_sum
 +ğ((
couÁ”_t
)
diffv®
) * diffval;

220 
diffv®
 = 0;

222 
_»ûiv”
->
Äeûived
++;

223 *
£nd_ts
 = -*send_ts;

225 
ušt16_t
 
»adabË_£q
 = 
	`Áohs
(
icmph
->
icmp_£qu’û
);

226 ià(
_v”bo£
)

227 
	`şick_ch©‹r
("%s: %d by‹ äom %p{_±r}: icmp_£q=%u=%uime=%d.%03d ms", 
	`deş¬©iÚ
().
	`c_¡r
(), 
	`Áohs
(
h
->
_Ën
è- (h->
_hl
 << 2è- (*
icmph
), &h->
_¤c
, 
»adabË_£q
, iph->
_‰l
, ()(
diffv®
/1000), ()(diffval % 1000));

230 ià(
_mœrÜ
) {

231 
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
();

232 ià(
q
 && q->
	`d©a
(è< q->
	`ÃtwÜk_h—d”
())

233 
q
->
	`puÎ
(q->
	`ÃtwÜk_h—d”
(è- q->
	`d©a
());

234 ià(
q
 && (
p
 = 
	`make_·ck‘
(q))) {

235 
	`ouut
(0).
	`push
(
p
);

236 ++
_couÁ
;

241 
p
->
	`kl
();

242 
	}
}

244 ’um { 
	mH_ACTIVE
, 
	mH_LIMIT
, 
	mH_INTERVAL
, 
	mH_RESET_COUNTS
, 
	mH_COUNT
, 
	mH_SUMMARY
,

245 
	mH_RTT_MIN
, 
	mH_RTT_AVG
, 
	mH_RTT_MAX
, 
	mH_SRC
, 
	mH_DST
 };

247 
SŒšg


248 
	gICMPPšgSourû
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

250 
ICMPPšgSourû
 *
ps
 = 
¡©ic_ÿ¡
<ICMPPšgSourû *>(
e
);

251 
Reûiv”Info
 *
ri
 = 
ps
->
_»ûiv”
;

252 (
ušŒ_t
)
thunk
) {

253 
H_ACTIVE
:

254  
	`SŒšg
(
ps
->
_aùive
);

255 
H_COUNT
:

256  
	`SŒšg
(
ps
->
_couÁ
);

257 
H_SRC
:

258  
	`IPAdd»ss
(
ps
->
_¤c
).
	`uÅ¬£
();

259 
H_DST
:

260  
	`IPAdd»ss
(
ps
->
_d¡
).
	`uÅ¬£
();

261 
H_SUMMARY
: {

262 
SŒšgAccum
 
§
;

263 
§
 << 
ps
->
_couÁ
 << "…acketsransmitted"

264 << ", " << (
ri
->
Äeûived
 -„i->
ndu¶iÿ‹
) << "„eceived";

265 ià(
ri
->
ndu¶iÿ‹
)

266 
§
 << ", +" << 
ri
->
ndu¶iÿ‹
 << " duplicates";

267 ià(
ps
->
_couÁ
)

268 
§
 << ", " << ()(((
ps
->
_couÁ
 - 
ri
->
Äeûived
 -„i->
ndu¶iÿ‹
) * 100) /…s->_count) << "%…acket†oss\n";

269 ià(
ri
->
Äeûived
) {

270 
couÁ”_t
 
avg
 = 
ri
->
time_sum
 /„i->
Äeûived
;

271 
couÁ”_t
 
avg_sq
 = 
ri
->
time_sq_sum
 /„i->
Äeûived
;

272 
couÁ”_t
 
¡dev
 = 
	`št_sq¹
(
avg_sq
 - 
avg
 *‡vg);

273 
§
.
	`¢´štf
(256, "¹ˆmš/avg/max/mdev = %u.%03u/%u.%03u/%u.%03u/%u.%03u\n", 
ri
->
time_mš
 / 1000,„i->time_mš % 1000, ()(
avg
 / 1000), ()×vg % 1000),„i->
time_max
 / 1000,„i->time_max % 1000, ()(
¡dev
 / 1000), ()(stdev % 1000));

275  
§
.
	`ke_¡ršg
();

277 
H_RTT_MIN
:

278  
	`ı_uÅ¬£_miüo£cÚds
(
ri
->
time_mš
);

279 
H_RTT_AVG
:

280  
	`ı_uÅ¬£_miüo£cÚds
(
ri
->
time_sum
 / (ri->
Äeûived
 ?„i->nreceived : 1));

281 
H_RTT_MAX
:

282  
	`ı_uÅ¬£_miüo£cÚds
(
ri
->
time_max
);

286 
	}
}

289 
	gICMPPšgSourû
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

291 
ICMPPšgSourû
 *
ps
 = 
¡©ic_ÿ¡
<ICMPPšgSourû *>(
e
);

292 (
ušŒ_t
)
thunk
) {

293 
H_ACTIVE
:

294 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
ps
->
_aùive
))

295  
”rh
->
	`”rÜ
("type mismatch");

296 ià(
ps
->
_aùive
 && !ps->
_tim”
.
	`scheduËd
(è&&…s->
	`ouut_is_push
(0))

297 
ps
->
_tim”
.
	`scheduË_now
();

298 ià(!
ps
->
_aùive
)

299 
ps
->
_tim”
.
	`unscheduË
();

301 
H_SRC
:

302 ià(!
	`IPAdd»ssArg
().
	`·r£
(
s
, 
ps
->
_¤c
))

303  
”rh
->
	`”rÜ
("syntaxƒrror");

305 
H_DST
:

306 ià(!
	`IPAdd»ssArg
().
	`·r£
(
s
, 
ps
->
_d¡
))

307  
”rh
->
	`”rÜ
("syntaxƒrror");

309 
H_LIMIT
:

310 ià(!
	`IÁArg
().
	`·r£
(
s
, 
ps
->
_lim™
))

311  
”rh
->
	`”rÜ
("'limit' should be integer");

312 ià((
ps
->
_couÁ
 <…s->
_lim™
 ||…s->_lim™ < 0è&&…s->
_aùive
 && !ps->
_tim”
.
	`scheduËd
(è&&…s->
	`ouut_is_push
(0))

313 
ps
->
_tim”
.
	`scheduË_aá”_m£c
Õs->
_š‹rv®
);

315 
H_INTERVAL
:

316 ià(!
	`SecÚdsArg
(3).
	`·r£_§tu¿tšg
(
s
, 
ps
->
_š‹rv®
))

317  
”rh
->
	`”rÜ
("'interval' should be‡n interval");

319 
H_RESET_COUNTS
:

320 
ps
->
_couÁ
 = 0;

321 ià(
Reûiv”Info
 *
ri
 = 
ps
->
_»ûiv”
)

322 
	`mem£t
(
ri
, 0, (
Reûiv”Info
));

323 ià(
ps
->
_couÁ
 <…s->
_lim™
 &&…s->
_aùive
 && !ps->
_tim”
.
	`scheduËd
(è&&…s->
	`ouut_is_push
(0))

324 
ps
->
_tim”
.
	`scheduË_aá”_m£c
Õs->
_š‹rv®
);

329 
	}
}

332 
	gICMPPšgSourû
::
	$add_hªdËrs
()

334 
	`add_»ad_hªdËr
("aùive", 
»ad_hªdËr
, 
H_ACTIVE
, 
HªdËr
::
CHECKBOX
);

335 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 
H_ACTIVE
);

336 
	`add_»ad_hªdËr
("¤c", 
»ad_hªdËr
, 
H_SRC
, 
HªdËr
::
CALM
);

337 
	`add_wr™e_hªdËr
("¤c", 
wr™e_hªdËr
, 
H_SRC
);

338 
	`add_»ad_hªdËr
("d¡", 
»ad_hªdËr
, 
H_DST
, 
HªdËr
::
CALM
);

339 
	`add_wr™e_hªdËr
("d¡", 
wr™e_hªdËr
, 
H_DST
);

340 
	`add_»ad_hªdËr
("couÁ", 
»ad_hªdËr
, 
H_COUNT
);

341 
	`add_wr™e_hªdËr
("lim™", 
wr™e_hªdËr
, 
H_LIMIT
, 
HªdËr
::
CALM
);

342 
	`add_wr™e_hªdËr
("š‹rv®", 
wr™e_hªdËr
, 
H_INTERVAL
);

343 
	`add_wr™e_hªdËr
("»£t_couÁs", 
wr™e_hªdËr
, 
H_RESET_COUNTS
, 
HªdËr
::
BUTTON
);

344 ià(
	`nšputs
() > 0) {

345 
	`add_»ad_hªdËr
("summ¬y", 
»ad_hªdËr
, 
H_SUMMARY
);

346 
	`add_»ad_hªdËr
("¹t_mš", 
»ad_hªdËr
, 
H_RTT_MIN
);

347 
	`add_»ad_hªdËr
("¹t_avg", 
»ad_hªdËr
, 
H_RTT_AVG
);

348 
	`add_»ad_hªdËr
("¹t_max", 
»ad_hªdËr
, 
H_RTT_MAX
);

350 
	}
}

352 
CLICK_ENDDECLS


353 
EXPORT_ELEMENT
(
ICMPPšgSourû
 ICMPPšgSourû-
ICMPS’dPšgs
)

	@icmp/icmpsendpings.hh

2 #iâdeà
CLICK_ICMPSENDPINGS_HH


3 
	#CLICK_ICMPSENDPINGS_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/tim”.hh
>

6 
	~<şick/add»ss.hh
>

7 
CLICK_DECLS


126 şas 
	cICMPPšgSourû
 : 
public
 
EËm’t
 {…ublic:

128 
	$ICMPPšgSourû
(è
CLICK_COLD
;

129 ~
	$ICMPPšgSourû
(è
CLICK_COLD
;

131 cÚ¡ *
	$şass_Çme
() const {  "ICMPPingSource"; }

132 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "0-1/1"; 
	}
}

133 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "h/a"; 
	}
}

134 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

135 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

136 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

137 
	$add_hªdËrs
(è
CLICK_COLD
;

139 
	`run_tim”
(
Tim”
 *);

140 
	`push
(, 
Pack‘
 *);

141 
Pack‘
* 
	`puÎ
();

143 
´iv©e
:

145 
š_addr
 
_¤c
;

146 
š_addr
 
_d¡
;

147 
_couÁ
;

148 
_lim™
;

149 
ušt16_t
 
_icmp_id
;

150 
ušt32_t
 
_š‹rv®
;

151 
Tim”
 
_tim”
;

152 
SŒšg
 
_d©a
;

153 
boŞ
 
_aùive
;

154 
boŞ
 
_v”bo£
;

155 
boŞ
 
_¡İ
;

156 
boŞ
 
_mœrÜ
;

158 #ià
HAVE_INT64_TYPES
 && !
CLICK_LINUXMODULE


159 
ušt64_t
 
	tcouÁ”_t
;

161 
ušt32_t
 
	tcouÁ”_t
;

163 
	sReûiv”Info
 {

164 
Äeûived
;

165 
ndu¶iÿ‹
;

166 
ušt32_t
 
time_mš
;

167 
ušt32_t
 
time_max
;

168 
couÁ”_t
 
time_sum
;

169 
couÁ”_t
 
time_sq_sum
;

170 
Time¡amp
 
£nd_time¡amp
[65536];

171 
	}
};

172 
Reûiv”Info
 *
	g_»ûiv”
;

174 
Pack‘
* 
make_·ck‘
(
Wr™abËPack‘
 *
q
);

175 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
*, *è
CLICK_COLD
;

176 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*è
CLICK_COLD
;

178 
	}
};

180 
	gCLICK_ENDDECLS


	@ip/checkipheader.cc

20 
	~<şick/cÚfig.h
>

21 
	~"checkh—d”.hh
"

22 
	~<şickÃt/.h
>

23 
	~<şick/glue.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/”rÜ.hh
>

27 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

28 
CLICK_DECLS


30 cÚ¡ * cÚ¡ 
	gCheckIPH—d”
::
»asÚ_‹xts
[
NREASONS
] = {

35 
	#IPADDR_LIST_INTERFACES
 ((*)0)

	)

36 
	#IPADDR_LIST_BADSRC
 ((*)1)

	)

37 
	#IPADDR_LIST_BADSRC_OLD
 ((*)2)

	)

39 
boŞ


40 
	gCheckIPH—d”
::
OldBadSrcArg
::
·r£
(cÚ¡ 
SŒšg
 &
¡r
, 
VeùÜ
<
IPAdd»ss
> &
»suÉ
, 
Args
 &
¬gs
)

42 ià(
IPAdd»ssArg
().
·r£
(
¡r
, 
»suÉ
, 
¬gs
)) {

43 
	g»suÉ
.
push_back
(
IPAdd»ss
(0));

44 
	g»suÉ
.
push_back
(
IPAdd»ss
(0xFFFFFFFFU));

45  
	gŒue
;

47  
	gçl£
;

50 
boŞ


51 
	gCheckIPH—d”
::
IÁ”çûsArg
::
·r£
(cÚ¡ 
SŒšg
 &
¡r
,

52 
VeùÜ
<
IPAdd»ss
> &
»suÉ_bad_¤c
,

53 
VeùÜ
<
IPAdd»ss
> &
»suÉ_good_d¡
,

54 
Args
 &
¬gs
)

56 
SŒšg
 
¬g
(
¡r
);

57 
IPAdd»ss
 
	g
, 
	gmask
;

58 
	gnwÜds
 = 0;

59 
SŒšg
 
	gwÜd
 = 
ı_shiá_¥aûvec
(
¬g
)) {

60 ++
nwÜds
;

61 ià(
IPP»fixArg
(
Œue
).
·r£
(
wÜd
, 

, 
mask
, 
¬gs
)) {

62 
	g»suÉ_bad_¤c
.
push_back
((

 & 
mask
) | ~mask);

63 
	g»suÉ_good_d¡
.
push_back
(

);

65  
	gçl£
;

67 ià(
	gnwÜds
 =ğ
»suÉ_bad_¤c
.
size
()) {

68 
»suÉ_bad_¤c
.
push_back
(
IPAdd»ss
(0));

69 
	g»suÉ_bad_¤c
.
push_back
(
IPAdd»ss
(0xFFFFFFFFU));

70  
	gŒue
;

72 
	g¬gs
.
”rÜ
("out of memory");

73  
	gçl£
;

76 
	gCheckIPH—d”
::
	$CheckIPH—d”
()

77 : 
	`_checksum
(
Œue
), 
	$_»asÚ_drİs
(0)

79 
_drİs
 = 0;

80 
	}
}

82 
	gCheckIPH—d”
::~
	$CheckIPH—d”
()

84 
d–‘e
[] 
_»asÚ_drİs
;

85 
	}
}

88 
	gCheckIPH—d”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

90 
	g_off£t
 = 0;

91 
boŞ
 
	gv”bo£
 = 
çl£
;

92 
boŞ
 
	gd‘as
 = 
çl£
;

94 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

95 .
»ad
("INTERFACES", 
IÁ”çûsArg
(), 
_bad_¤c
, 
_good_d¡
)

96 .
»ad
("BADSRC", 
_bad_¤c
)

97 .
»ad
("GOODDST", 
_good_d¡
)

98 .
»ad
("OFFSET", 
_off£t
)

99 .
»ad
("VERBOSE", 
v”bo£
)

100 .
»ad
("DETAILS", 
d‘as
)

101 .
»ad
("CHECKSUM", 
_checksum
)

102 .
cÚsume
() < 0)

105 ià(
	gcÚf
.
size
() == 0

106 || (
cÚf
.
size
(è=ğ1 && 
IÁArg
().
·r£
(cÚf[0], 
_off£t
)))

108 ià(
Args
(
cÚf
, 
this
, 
”rh
)

109 .
»ad
("BADSRC", 
OldBadSrcArg
(), 
_bad_¤c
)

110 .
»ad
("OFFSET", 
_off£t
)

111 .
com¶‘e
() < 0)

114 
	g_v”bo£
 = 
v”bo£
;

115 ià(
	gd‘as
) {

116 
	g_»asÚ_drİs
 = 
Ãw
 
©omic_ušt32_t
[
NREASONS
];

117 
	gi
 = 0; i < 
	gNREASONS
; ++i)

118 
	g_»asÚ_drİs
[
i
] = 0;

121 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


123 ià(
	g_checksum
) {

124 
	gªs
, 
	gc
, 
	go
;

125 
	gªs
 = 
Alignm’tInfo
::
qu”y
(
this
, 0, 
c
, 
o
);

126 
	go
 = (
o
 + 4 - (
_off£t
 % 4)) % 4;

127 
	g_®igÃd
 = (
ªs
 && 
c
 =ğ4 && 
o
 == 0);

128 ià(!
	g_®igÃd
)

129 
	g”rh
->
w¬nšg
("IP header unaligned, cannot use fast IP checksum");

130 ià(!
	gªs
)

131 
	g”rh
->
mes§ge
("(Try…assinghe configurationhrough `click-align'.)");

143 
Pack‘
 *

144 
	gCheckIPH—d”
::
	$drİ
(
R—sÚ
 
»asÚ
, 
Pack‘
 *
p
)

146 ià(
_drİs
 =ğ0 || 
_v”bo£
)

147 
	`şick_ch©‹r
("%s: IP h—d” check faed: %s", 
	`Çme
().
	`c_¡r
(), 
»asÚ_‹xts
[
»asÚ
]);

148 
_drİs
++;

150 ià(
_»asÚ_drİs
)

151 
_»asÚ_drİs
[
»asÚ
]++;

153 ià(
	`nouuts
() == 2)

154 
	`ouut
(1).
	`push
(
p
);

156 
p
->
	`kl
();

159 
	}
}

161 
Pack‘
 *

162 
	gCheckIPH—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

164 cÚ¡ 
şick_
 *

 = 
»š‹½»t_ÿ¡
<cÚ¡ click_ *>(
p
->
	`d©a
(è+ 
_off£t
);

165 
¶’
 = 
p
->
	`Ëngth
(è- 
_off£t
;

166 
hËn
, 
Ën
;

169 ià(()
¶’
 < ()(
şick_
))

170  
	`drİ
(
MINISCULE_PACKET
, 
p
);

172 ià(

->
_v
 != 4)

173  
	`drİ
(
BAD_VERSION
, 
p
);

175 
hËn
 = 

->
_hl
 << 2;

176 ià(
hËn
 < (
şick_
))

177  
	`drİ
(
BAD_HLEN
, 
p
);

179 
Ën
 = 
	`Áohs
(

->
_Ën
);

180 ià(
Ën
 > 
¶’
 ||†’ < 
hËn
)

181  
	`drİ
(
BAD_IP_LEN
, 
p
);

183 ià(
_checksum
) {

184 
v®
;

185 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


186 ià(
_®igÃd
)

187 
v®
 = 
	`_ç¡_csum
((*)

, ip->
_hl
);

189 
v®
 = 
	`şick_š_cksum
((cÚ¡ *)

, 
hËn
);

190 #–ià
HAVE_FAST_CHECKSUM


191 
v®
 = 
	`_ç¡_csum
((*)

, ip->
_hl
);

193 
v®
 = 
	`şick_š_cksum
((cÚ¡ *)

, 
hËn
);

195 ià(
v®
 != 0)

196  
	`drİ
(
BAD_CHECKSUM
, 
p
);

204 ià(
	`fšd
(
_bad_¤c
.
	`begš
(), _bad_¤c.
	`’d
(), 
	`IPAdd»ss
(

->
_¤c
)) < _bad_src.end()

205 && 
	`fšd
(
_good_d¡
.
	`begš
(), _good_d¡.
	`’d
(), 
	`IPAdd»ss
(

->
_d¡
)) == _good_dst.end())

206  
	`drİ
(
BAD_SADDR
, 
p
);

213 
p
->
	`£t__h—d”
(

, 
hËn
);

216 ià(
¶’
 > 
Ën
)

217 
p
->
	`ke
(
¶’
 - 
Ën
);

223 
p
->
	`£t_d¡__ªno
(

->
_d¡
);

225 (
p
);

226 
	}
}

228 
SŒšg


229 
	gCheckIPH—d”
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *)

231 
CheckIPH—d”
 *
c
 = 
»š‹½»t_ÿ¡
<CheckIPH—d” *>(
e
);

232 
SŒšgAccum
 
§
;

233 
i
 = 0; i < 
NREASONS
; i++)

234 
§
 << 
c
->
_»asÚ_drİs
[
i
] << '\t' << 
»asÚ_‹xts
[i] << '\n';

235  
§
.
	`ke_¡ršg
();

236 
	}
}

239 
	gCheckIPH—d”
::
	$add_hªdËrs
()

241 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

242 ià(
_»asÚ_drİs
)

243 
	`add_»ad_hªdËr
("drİ_d‘as", 
»ad_hªdËr
, 1);

244 
	}
}

246 
CLICK_ENDDECLS


247 
EXPORT_ELEMENT
(
CheckIPH—d”
)

	@ip/checkipheader.hh

1 #iâdeà
CLICK_CHECKIPHEADER_HH


2 
	#CLICK_CHECKIPHEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/©omic.hh
>

5 
CLICK_DECLS


6 
şass
 
	gArgs
;

107 şas 
	cCheckIPH—d”
 : 
public
 
EËm’t
 {…ublic:

109 
	$CheckIPH—d”
(è
CLICK_COLD
;

110 ~
	$CheckIPH—d”
(è
CLICK_COLD
;

112 cÚ¡ *
	$şass_Çme
() const {  "CheckIPHeader"; }

113 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

114 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

115 cÚ¡ *
	$æags
(ècÚ¡ {  "A"; 
	}
}

117 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

118 
	$add_hªdËrs
(è
CLICK_COLD
;

120 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

122 
	sOldBadSrcArg
 {

123 
boŞ
 
	`·r£
(cÚ¡ 
SŒšg
 &
¡r
, 
VeùÜ
<
IPAdd»ss
> &
»suÉ
,

124 
Args
 &
¬gs
);

125 
	}
};

127 
	sIÁ”çûsArg
 {

128 
boŞ
 
·r£
(cÚ¡ 
SŒšg
 &
¡r
, 
VeùÜ
<
IPAdd»ss
> &
»suÉ_bad_¤c
,

129 
VeùÜ
<
IPAdd»ss
> &
»suÉ_good_d¡
, 
Args
 &
¬gs
);

132 
	g´iv©e
:

134 
_off£t
;

136 
	gVeùÜ
<
	gIPAdd»ss
> 
	g_bad_¤c
;

138 
boŞ
 
	g_checksum
;

139 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


140 
boŞ
 
	g_®igÃd
;

142 
boŞ
 
	g_v”bo£
;

144 
	gVeùÜ
<
	gIPAdd»ss
> 
	g_good_d¡
;

147 
©omic_ušt32_t
 
	g_drİs
;

148 
©omic_ušt32_t
 *
	g_»asÚ_drİs
;

150 
	eR—sÚ
 {

151 
	gMINISCULE_PACKET
,

152 
	gBAD_VERSION
,

153 
	gBAD_HLEN
,

154 
	gBAD_IP_LEN
,

155 
	gBAD_CHECKSUM
,

156 
	gBAD_SADDR
,

157 
	gNREASONS


159 cÚ¡ * cÚ¡ 
	g»asÚ_‹xts
[
NREASONS
];

161 
Pack‘
 *
drİ
(
R—sÚ
, Packet *);

162 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

164 
ä›nd
 
şass
 
CheckIPH—d”2
;

166 
	}
};

168 
	gCLICK_ENDDECLS


	@ip/checkipheader2.cc

19 
	~<şick/cÚfig.h
>

20 
	~"checkh—d”2.hh
"

21 
	~<şickÃt/.h
>

22 
	~<şick/glue.hh
>

23 
	~<şick/cÚå¬£.hh
>

24 
	~<şick/”rÜ.hh
>

25 
CLICK_DECLS


27 
	gCheckIPH—d”2
::
	$CheckIPH—d”2
()

30 
_checksum
 = 
çl£
;

31 
	}
}

33 
	gCheckIPH—d”2
::~
	$CheckIPH—d”2
()

36 
	}
}

38 
CLICK_ENDDECLS


39 
	$ELEMENT_REQUIRES
(
CheckIPH—d”
)

40 
	`EXPORT_ELEMENT
(
CheckIPH—d”2
)

	@ip/checkipheader2.hh

1 #iâdeà
CLICK_CHECKIPHEADER2_HH


2 
	#CLICK_CHECKIPHEADER2_HH


	)

3 
	~"–em’ts//checkh—d”.hh
"

4 
CLICK_DECLS


22 şas 
	cCheckIPH—d”2
 : 
public
 
CheckIPH—d”
 {…ublic:

24 
CheckIPH—d”2
();

25 ~
CheckIPH—d”2
();

27 cÚ¡ *
	$şass_Çme
() const {  "CheckIPHeader2"; }

29 
	}
};

31 
	gCLICK_ENDDECLS


	@ip/decipttl.cc

19 
	~<şick/cÚfig.h
>

20 
	~"dec‰l.hh
"

21 
	~<şick/glue.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şickÃt/.h
>

24 
CLICK_DECLS


26 
	gDecIPTTL
::
	$DecIPTTL
()

27 : 
	`_aùive
(
Œue
), 
	$_muÉiÿ¡
(
Œue
)

29 
_drİs
 = 0;

30 
	}
}

32 
	gDecIPTTL
::~
	$DecIPTTL
()

34 
	}
}

37 
DecIPTTL
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39  
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad
("ACTIVE", 
_aùive
)

41 .
»ad
("MULTICAST", 
_muÉiÿ¡
).
com¶‘e
();

44 
Pack‘
 *

45 
	gDecIPTTL
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

47 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

48 ià(!
_aùive
)

49  
p
;

50 cÚ¡ 
şick_
 *
_š
 = 
p
->
	`_h—d”
();

51 ià(!
_muÉiÿ¡
 && 
	`IPAdd»ss
(
_š
->
_d¡
).
	`is_muÉiÿ¡
())

52  
p
;

54 ià(
_š
->
_‰l
 <= 1) {

55 ++
_drİs
;

56 
	`checked_ouut_push
(1, 
p
);

59 
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
();

60 ià(!
q
)

62 
şick_
 *

 = 
q
->
	`_h—d”
();

63 --

->
_‰l
;

72 
sum
 = (~
	`Áohs
(

->
_sum
) & 0xFFFF) + 0xFEFF;

73 

->
_sum
 = ~
	`htÚs
(
sum
 + (sum >> 16));

75  
q
;

77 
	}
}

80 
	gDecIPTTL
::
	$add_hªdËrs
()

82 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

83 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
 | HªdËr::
CHECKBOX
, &
_aùive
);

84 
	}
}

86 
CLICK_ENDDECLS


87 
	$EXPORT_ELEMENT
(
DecIPTTL
)

88 
	`ELEMENT_MT_SAFE
(
DecIPTTL
)

	@ip/decipttl.hh

1 #iâdeà
CLICK_DECIPTTL_HH


2 
	#CLICK_DECIPTTL_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/©omic.hh
>

6 
CLICK_DECLS


45 şas 
	cDecIPTTL
 : 
public
 
EËm’t
 {…ublic:

47 
	$DecIPTTL
(è
CLICK_COLD
;

48 ~
	$DecIPTTL
(è
CLICK_COLD
;

50 cÚ¡ *
	$şass_Çme
() const {  "DecIPTTL"; }

51 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

52 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

54 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

55 
	$add_hªdËrs
(è
CLICK_COLD
;

57 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

59 
´iv©e
:

61 
©omic_ušt32_t
 
_drİs
;

62 
boŞ
 
_aùive
;

63 
boŞ
 
_muÉiÿ¡
;

65 
	}
};

67 
	gCLICK_ENDDECLS


	@ip/directiplookup.cc

21 
	~<şick/cÚfig.h
>

22 
	~"dœeùlookup.hh
"

23 
	~<şick/add»ss.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/rou‹r.hh
>

26 
	~<şick/”rÜ.hh
>

27 
CLICK_DECLS


36 
	gDœeùIPLookup
::
TabË
::
	$š™Ÿlize
()

38 
	`as£¹
(!
_tbl_0_23
 && !
_tbl_24_31
 && !
_vpÜt
 && !
_¹abË
 && !
_¹_hashtbl


39 && !
_tbl_0_23_¶’
 && !
_tbl_24_31_¶’
);

41 
_tbl_24_31_ÿ·c™y
 = 4096;

42 
_vpÜt_ÿ·c™y
 = 1024;

43 
_¹abË_ÿ·c™y
 = 2048;

45 ià((
_tbl_0_23
 = (
ušt16_t
 *è
	`CLICK_LALLOC
(((ušt16_tè+ (
ušt8_t
)) * (1 << 24)))

46 && (
_tbl_24_31
 = (
ušt16_t
 *è
	`CLICK_LALLOC
(((ušt16_tè+ (
ušt8_t
)è* 
_tbl_24_31_ÿ·c™y
))

47 && (
_vpÜt
 = (
Vœtu®PÜt
 *è
	`CLICK_LALLOC
((Vœtu®PÜtè* 
_vpÜt_ÿ·c™y
))

48 && (
_¹abË
 = (
CË¬‹xtEÁry
 *è
	`CLICK_LALLOC
((CË¬‹xtEÁryè* 
_¹abË_ÿ·c™y
))

49 && (
_¹_hashtbl
 = (*è
	`CLICK_LALLOC
((è* 
PREF_HASHSIZE
))) {

50 
_tbl_0_23_¶’
 = (
ušt8_t
 *è(
_tbl_0_23
 + (1 << 24));

51 
_tbl_24_31_¶’
 = (
ušt8_t
 *è(
_tbl_24_31
 + 
_tbl_24_31_ÿ·c™y
);

54  -
ENOMEM
;

55 
	}
}

58 
	gDœeùIPLookup
::
TabË
::
	$ş—nup
()

60 
	`CLICK_LFREE
(
_tbl_0_23
, ((
ušt16_t
è+ (
ušt8_t
)) * (1 << 24));

61 
	`CLICK_LFREE
(
_tbl_24_31
, ((
ušt16_t
è+ (
ušt8_t
)è* 
_tbl_24_31_ÿ·c™y
);

62 
	`CLICK_LFREE
(
_vpÜt
, (
Vœtu®PÜt
è* 
_vpÜt_ÿ·c™y
);

63 
	`CLICK_LFREE
(
_¹abË
, (
CË¬‹xtEÁry
è* 
_¹abË_ÿ·c™y
);

64 
	`CLICK_LFREE
(
_¹_hashtbl
, (è* 
PREF_HASHSIZE
);

65 
_tbl_0_23
 = 
_tbl_24_31
 = 0;

66 
_vpÜt
 = 0;

67 
_¹abË
 = 0;

68 
_tbl_0_23_¶’
 = 
_tbl_24_31_¶’
 = 0;

69 
_¹_hashtbl
 = 0;

70 
	}
}

73 
šlše
 
ušt32_t


74 
	gDœeùIPLookup
::
TabË
::
	$´efix_hash
(
ušt32_t
 
´efix
, ušt32_ˆ
Ën
)

77 
ušt32_t
 
hash
 = 
´efix
 ^ (
Ën
 << 5) ^ ((prefix >> (len >> 2)) -†en);

78 
hash
 ^ğ(hash >> 23è^ ((hash >> 15è* 
Ën
è^ ((
´efix
 >> 17) * 53);

79 
hash
 -ğ(
´efix
 >> 3è^ ((hash >> 
Ën
) * 7) ^ ((hash >> 11) * 103);

80 
hash
 = (hash ^ (hash >> 17)è& (
PREF_HASHSIZE
 - 1);

82  
hash
;

83 
	}
}

86 
	gDœeùIPLookup
::
TabË
::
	$æush
()

88 
	`mem£t
(
_¹_hashtbl
, -1, (è* 
PREF_HASHSIZE
);

91 
_vpÜt_h—d
 = 0;

92 
_vpÜt
[0].
Î_´ev
 = -1;

93 
_vpÜt
[0].
Î_Ãxt
 = -1;

94 
_vpÜt
[0].
»fcouÁ
 = 1;

95 
_vpÜt
[0].
gw
 = 
	`IPAdd»ss
(0);

96 
_vpÜt
[0].
pÜt
 = 
DISCARD_PORT
;

97 
_vpÜt_size
 = 1;

98 
_vpÜt_em±y_h—d
 = -1;

101 
_¹_hashtbl
[
	`´efix_hash
(0, 0)] = 0;

102 
_¹abË
[0].
Î_´ev
 = -1;

103 
_¹abË
[0].
Î_Ãxt
 = -1;

104 
_¹abË
[0].
´efix
 = 0;

105 
_¹abË
[0].
¶’
 = 0;

106 
_¹abË
[0].
vpÜt
 = 0;

107 
_¹abË_size
 = 1;

108 
_¹_em±y_h—d
 = -1;

111 
	`mem£t
(
_tbl_0_23
, 0, ((
ušt16_t
è+ (
ušt8_t
)) * (1 << 24));

113 
_tbl_24_31_size
 = 0;

114 
_tbl_24_31_em±y_h—d
 = 0x8000;

115 
	}
}

117 
SŒšg


118 
	gDœeùIPLookup
::
TabË
::
	$dump
() const

120 
SŒšgAccum
 
§
;

121 
ušt32_t
 
i
 = 0; i < 
PREF_HASHSIZE
; i++)

122 
¹_i
 = 
_¹_hashtbl
[
i
];„t_˜>ğ0;„t_˜ğ
_¹abË
[¹_i].
Î_Ãxt
) {

123 cÚ¡ 
CË¬‹xtEÁry
 &
¹
 = 
_¹abË
[
¹_i
];

124 ià(
_vpÜt
[
¹
.
vpÜt
].
pÜt
 != -1) {

125 
IPRou‹
 
rou‹
 = 
	`IPRou‹
(
	`IPAdd»ss
(
	`htÚl
(
¹
.
´efix
)), 
IPAdd»ss
::
	`make_´efix
Ôt.
¶’
), 
_vpÜt
[¹.
vpÜt
].
gw
, _vpÜt[¹.vpÜt].
pÜt
);

126 
rou‹
.
	`uÅ¬£
(
§
, 
Œue
) << '\n';

129  
§
.
	`ke_¡ršg
();

130 
	}
}

133 
	gDœeùIPLookup
::
TabË
::
	$vpÜt_fšd
(
IPAdd»ss
 
gw
, 
št16_t
 
pÜt
)

135 
vp
 = 
_vpÜt_h—d
; v°>ğ0; v°ğ
_vpÜt
[vp].
Î_Ãxt
)

136 ià(
_vpÜt
[
vp
].
gw
 =ğgw && _vpÜt[vp].
pÜt
 ==…ort)

137  
vp
;

138 ià(
_vpÜt_em±y_h—d
 < 0 && 
_vpÜt_size
 =ğ
_vpÜt_ÿ·c™y
) {

139 ià(
_vpÜt_ÿ·c™y
 =ğ
vpÜt_ÿ·c™y_lim™
)

140  -
ENOMEM
;

141 
Vœtu®PÜt
 *
Ãw_vpÜt
 = (Vœtu®PÜˆ*è
	`CLICK_LALLOC
((Vœtu®PÜtè* 2 * 
_vpÜt_ÿ·c™y
);

142 ià(!
Ãw_vpÜt
)

143  -
ENOMEM
;

144 
	`memıy
(
Ãw_vpÜt
, 
_vpÜt
, (
Vœtu®PÜt
è* 
_vpÜt_ÿ·c™y
);

145 
	`CLICK_LFREE
(
_vpÜt
, (
Vœtu®PÜt
è* 
_vpÜt_ÿ·c™y
);

146 
_vpÜt
 = 
Ãw_vpÜt
;

147 
_vpÜt_ÿ·c™y
 *= 2;

149 ià(
_vpÜt_em±y_h—d
 < 0) {

150 
_vpÜt
[
_vpÜt_size
].
Î_Ãxt
 = 
_vpÜt_em±y_h—d
;

151 
_vpÜt_em±y_h—d
 = 
_vpÜt_size
;

152 ++
_vpÜt_size
;

154 
_vpÜt
[
_vpÜt_em±y_h—d
].
»fcouÁ
 = 0;

155  
_vpÜt_em±y_h—d
;

156 
	}
}

159 
	gDœeùIPLookup
::
TabË
::
	$vpÜt_uÄef
(
ušt16_t
 
vpÜt_i
)

161 ià(--
_vpÜt
[
vpÜt_i
].
»fcouÁ
 == 0) {

162 
št16_t
 
´ev
, 
Ãxt
;

165 
´ev
 = 
_vpÜt
[
vpÜt_i
].
Î_´ev
;

166 
Ãxt
 = 
_vpÜt
[
vpÜt_i
].
Î_Ãxt
;

167 ià(
´ev
 >= 0)

168 
_vpÜt
[
´ev
].
Î_Ãxt
 = 
Ãxt
;

170 
_vpÜt_h—d
 = 
Ãxt
;

171 ià(
Ãxt
 >= 0)

172 
_vpÜt
[
Ãxt
].
Î_´ev
 = 
´ev
;

175 
_vpÜt
[
vpÜt_i
].
Î_Ãxt
 = 
_vpÜt_em±y_h—d
;

176 
_vpÜt_em±y_h—d
 = 
vpÜt_i
;

178 
	}
}

181 
	gDœeùIPLookup
::
TabË
::
	$fšd_’Œy
(
ušt32_t
 
´efix
, ušt32_ˆ
¶’
) const

183 
hash
 = 
	`´efix_hash
(
´efix
, 
¶’
);

184 
¹_i
 = 
_¹_hashtbl
[
hash
];„t_˜>ğ0;„t_˜ğ
_¹abË
[¹_i].
Î_Ãxt
)

185 ià(
_¹abË
[
¹_i
].
´efix
 =ğ´efix && _¹abË[¹_i].
¶’
 ==…len)

186  
¹_i
;

188 
	}
}

191 
	gDœeùIPLookup
::
TabË
::
	$add_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, 
boŞ
 
®low_»¶aû
, IPRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
 *
”rh
)

193 
ušt32_t
 
´efix
 = 
	`Áohl
(
rou‹
.
addr
.
	`addr
());

194 
ušt32_t
 
¶’
 = 
rou‹
.
	`´efix_Ën
();

196 
¹_i
 = 
	`fšd_’Œy
(
´efix
, 
¶’
);

197 ià(
¹_i
 >= 0) {

200 ià((
¹_i
 !ğ0 || (¹_˜=ğ0 && 
_vpÜt
[0].
pÜt
 !ğ
DISCARD_PORT
)) &&

201 
Şd_rou‹
)

202 *
Şd_rou‹
 = 
	`IPRou‹
(
	`IPAdd»ss
(
	`htÚl
(
_¹abË
[
¹_i
].
´efix
)),

203 
IPAdd»ss
::
	`make_´efix
(
_¹abË
[
¹_i
].
¶’
),

204 
_vpÜt
[
_¹abË
[
¹_i
].
vpÜt
].
gw
,

205 
_vpÜt
[
_¹abË
[
¹_i
].
vpÜt
].
pÜt
);

206 ià(
¹_i
 == 0) {

208 ià(
_vpÜt
[0].
pÜt
 !ğ
DISCARD_PORT
 && !
®low_»¶aû
)

209  -
EEXIST
;

210 
_vpÜt
[0].
gw
 = 
rou‹
.gw;

211 
_vpÜt
[0].
pÜt
 = 
rou‹
.port;

215 ià(!
®low_»¶aû
)

216  -
EEXIST
;

217 
	`vpÜt_uÄef
(
_¹abË
[
¹_i
].
vpÜt
);

221 ià(
_¹_em±y_h—d
 < 0 && 
_¹abË_size
 =ğ
_¹abË_ÿ·c™y
) {

222 
CË¬‹xtEÁry
 *
Ãw_¹abË
 = (CË¬‹xtEÁry *è
	`CLICK_LALLOC
((CË¬‹xtEÁryè* 
_¹abË_ÿ·c™y
 * 2);

223 ià(!
Ãw_¹abË
)

224  -
ENOMEM
;

225 
	`memıy
(
Ãw_¹abË
, 
_¹abË
, (
CË¬‹xtEÁry
è* 
_¹abË_ÿ·c™y
);

226 
	`CLICK_LFREE
(
_¹abË
, (
CË¬‹xtEÁry
è* 
_¹abË_ÿ·c™y
);

227 
_¹abË
 = 
Ãw_¹abË
;

228 
_¹abË_ÿ·c™y
 *= 2;

230 ià(
_¹_em±y_h—d
 < 0) {

231 
_¹abË
[
_¹abË_size
].
Î_Ãxt
 = 
_¹_em±y_h—d
;

232 
_¹_em±y_h—d
 = 
_¹abË_size
;

233 ++
_¹abË_size
;

235 
¹_i
 = 
_¹_em±y_h—d
;

239 
vpÜt_i
 = 
	`vpÜt_fšd
(
rou‹
.
gw
,„ou‹.
pÜt
);

240 ià(
vpÜt_i
 < 0)

241  
vpÜt_i
;

244 
¡¬t
 = 
´efix
 >> 8;

245 
’d
 = 
¡¬t
 + (
¶’
 < 24 ? 1 << (24 -…len) : 1);

246 ià(
¶’
 > 24 && !(
_tbl_0_23
[
¡¬t
] & 0x8000)

247 && (
_tbl_24_31_em±y_h—d
 & 0x8000) != 0) {

248 ià(
_tbl_24_31_size
 =ğ
_tbl_24_31_ÿ·c™y


249 && 
_tbl_24_31_ÿ·c™y
 >ğ
tbl_24_31_ÿ·c™y_lim™
)

250  -
ENOMEM
;

251 ià(
_tbl_24_31_size
 =ğ
_tbl_24_31_ÿ·c™y
) {

252 
ušt16_t
 *
Ãw_tbl
 = (ušt16_ˆ*è
	`CLICK_LALLOC
(((ušt16_tè+ (
ušt8_t
)è* 2 * 
_tbl_24_31_ÿ·c™y
);

253 ià(!
Ãw_tbl
)

254  -
ENOMEM
;

255 
	`memıy
(
Ãw_tbl
, 
_tbl_24_31
, (
ušt16_t
è* 
_tbl_24_31_ÿ·c™y
);

256 
	`memıy
(
Ãw_tbl
 + 
_tbl_24_31_ÿ·c™y
, 
_tbl_24_31_¶’
, (
ušt8_t
) * _tbl_24_31_capacity);

257 
	`CLICK_LFREE
(
_tbl_24_31
, ((
ušt16_t
è+ (
ušt8_t
)è* 
_tbl_24_31_ÿ·c™y
);

258 
_tbl_24_31
 = 
Ãw_tbl
;

259 
_tbl_24_31_¶’
 = (
ušt8_t
 *è(
Ãw_tbl
 + 2 * 
_tbl_24_31_ÿ·c™y
);

260 
_tbl_24_31_ÿ·c™y
 *= 2;

262 
_tbl_24_31_em±y_h—d
 = 
_tbl_24_31_size
 >> 8;

263 
_tbl_24_31
[
_tbl_24_31_em±y_h—d
 << 8] = 0x8000;

264 
_tbl_24_31_size
 += 256;

268 ià(
¹_i
 =ğ
_¹_em±y_h—d
) {

269 
_¹_em±y_h—d
 = 
_¹abË
[
¹_i
].
Î_Ãxt
;

271 
_¹abË
[
¹_i
].
´efix
 =…refix;

272 
_¹abË
[
¹_i
].
¶’
 =…len;

275 
ušt32_t
 
hash
 = 
	`´efix_hash
(
´efix
, 
¶’
);

276 
_¹abË
[
¹_i
].
Î_´ev
 = -1;

277 
_¹abË
[
¹_i
].
Î_Ãxt
 = 
_¹_hashtbl
[
hash
];

278 ià(
_¹_hashtbl
[
hash
] >= 0)

279 
_¹abË
[
_¹_hashtbl
[
hash
]].
Î_´ev
 = 
¹_i
;

280 
_¹_hashtbl
[
hash
] = 
¹_i
;

283 ià(
vpÜt_i
 =ğ
_vpÜt_em±y_h—d
) {

284 
_vpÜt_em±y_h—d
 = 
_vpÜt
[
vpÜt_i
].
Î_Ãxt
;

285 
_vpÜt
[
vpÜt_i
].
»fcouÁ
 = 0;

286 
_vpÜt
[
vpÜt_i
].
gw
 = 
rou‹
.gw;

287 
_vpÜt
[
vpÜt_i
].
pÜt
 = 
rou‹
.port;

290 
_vpÜt
[
vpÜt_i
].
Î_´ev
 = -1;

291 
_vpÜt
[
vpÜt_i
].
Î_Ãxt
 = 
_vpÜt_h—d
;

292 ià(
_vpÜt_h—d
 >= 0)

293 
_vpÜt
[
_vpÜt_h—d
].
Î_´ev
 = 
vpÜt_i
;

294 
_vpÜt_h—d
 = 
vpÜt_i
;

296 ++
_vpÜt
[
vpÜt_i
].
»fcouÁ
;

297 
_¹abË
[
¹_i
].
vpÜt
 = 
vpÜt_i
;

299 
i
 = 
¡¬t
; i < 
’d
; i++) {

300 ià(
_tbl_0_23
[
i
] & 0x8000) {

302 
£c_i
 = (
_tbl_0_23
[
i
] & 0x7fffè<< 8, 
£c_¡¬t
, 
£c_’d
;

303 ià(
¶’
 > 24) {

304 
£c_¡¬t
 = 
´efix
 & 0xFF;

305 
£c_’d
 = 
£c_¡¬t
 + (1 << (32 - 
¶’
));

307 
£c_¡¬t
 = 0;

308 
£c_’d
 = 256;

310 
j
 = 
£c_i
 + 
£c_¡¬t
; j < sec_˜+ 
£c_’d
; j++) {

311 ià(
¶’
 > 
_tbl_24_31_¶’
[
j
]) {

312 
_tbl_24_31
[
j
] = 
vpÜt_i
;

313 
_tbl_24_31_¶’
[
j
] = 
¶’
;

314 } ià(
¶’
 < 
_tbl_24_31_¶’
[
j
]) {

316 ià(
_tbl_24_31_¶’
[
j
] > 24) {

317 
j
 |ğ0x000000fà>> (
_tbl_24_31_¶’
[j] - 24);

319 
i
 |ğ0x00fffffà>> 
_tbl_24_31_¶’
[
j
];

322 } ià(
®low_»¶aû
) {

323 
_tbl_24_31
[
j
] = 
vpÜt_i
;

326  
”rh
->
	`”rÜ
("BUG: _tbl_24_31[%08X] cŞlisiÚ", 
j
);

330 ià(
¶’
 > 
_tbl_0_23_¶’
[
i
]) {

331 ià(
¶’
 > 24) {

333 
	`as£¹
(!(
_tbl_24_31_em±y_h—d
 & 0x8000));

334 
£c_i
 = 
_tbl_24_31_em±y_h—d
 << 8;

335 
_tbl_24_31_em±y_h—d
 = 
_tbl_24_31
[
£c_i
];

336 
£c_¡¬t
 = 
´efix
 & 0xFF;

337 
£c_’d
 = 
£c_¡¬t
 + (1 << (32 - 
¶’
));

338 
j
 = 0; j < 256; j++) {

339 ià(
j
 >ğ
£c_¡¬t
 && j < 
£c_’d
) {

340 
_tbl_24_31
[
£c_i
 + 
j
] = 
vpÜt_i
;

341 
_tbl_24_31_¶’
[
£c_i
 + 
j
] = 
¶’
;

343 
_tbl_24_31
[
£c_i
 + 
j
] = 
_tbl_0_23
[
i
];

344 
_tbl_24_31_¶’
[
£c_i
 + 
j
] = 
_tbl_0_23_¶’
[
i
];

347 
_tbl_0_23
[
i
] = (
£c_i
 >> 8) | 0x8000;

349 
_tbl_0_23
[
i
] = 
vpÜt_i
;

350 
_tbl_0_23_¶’
[
i
] = 
¶’
;

352 } ià(
¶’
 < 
_tbl_0_23_¶’
[
i
]) {

354 
i
 |ğ0x00fffffà>> 
_tbl_0_23_¶’
[i];

355 } ià(
®low_»¶aû
) {

356 
_tbl_0_23
[
i
] = 
vpÜt_i
;

359  
”rh
->
	`”rÜ
("BUG: _tbl_0_23[%08X] cŞlisiÚ", 
i
);

365 
	}
}

368 
	gDœeùIPLookup
::
TabË
::
	$»move_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, IPRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
 *
”rh
)

370 
ušt32_t
 
´efix
 = 
	`Áohl
(
rou‹
.
addr
.
	`addr
());

371 
ušt32_t
 
¶’
 = 
rou‹
.
	`´efix_Ën
();

372 
¹_i
 = 
	`fšd_’Œy
(
´efix
, 
¶’
);

373 
IPRou‹
 
found_rou‹
;

375 ià(
¹_i
 < 0 || (¹_˜=ğ0 && 
_vpÜt
[0].
pÜt
 =ğ
DISCARD_PORT
))

376  -
ENOENT
;

378 
found_rou‹
 = 
	`IPRou‹
(
	`IPAdd»ss
(
	`htÚl
(
_¹abË
[
¹_i
].
´efix
)),

379 
IPAdd»ss
::
	`make_´efix
(
_¹abË
[
¹_i
].
¶’
),

380 
_vpÜt
[
_¹abË
[
¹_i
].
vpÜt
].
gw
,

381 
_vpÜt
[
_¹abË
[
¹_i
].
vpÜt
].
pÜt
);

382 ià(!
rou‹
.
	`m©ch
(
found_rou‹
))

383  -
ENOENT
;

385 ià(
Şd_rou‹
)

386 *
Şd_rou‹
 = 
found_rou‹
;

388 ià(
¶’
 == 0) {

391 ià(
¹_i
 > 0)

392  
”rh
->
	`”rÜ
("BUG: deçuÉ„ou‹„t_i=%d, should b0", 
¹_i
);

393 
_vpÜt
[0].
pÜt
 = 
DISCARD_PORT
;

395 
ušt32_t
 
¡¬t
, 
’d
, 
i
, 
j
, 
£c_i
, 
£c_¡¬t
, 
£c_’d
;

396 
Ãw’t
 = -1;

397 
Ãwmask
, 
´ev
, 
Ãxt
;

399 
	`vpÜt_uÄef
(
_¹abË
[
¹_i
].
vpÜt
);

402 
´ev
 = 
_¹abË
[
¹_i
].
Î_´ev
;

403 
Ãxt
 = 
_¹abË
[
¹_i
].
Î_Ãxt
;

404 ià(
´ev
 >= 0)

405 
_¹abË
[
´ev
].
Î_Ãxt
 = 
Ãxt
;

407 
_¹_hashtbl
[
	`´efix_hash
(
´efix
, 
¶’
)] = 
Ãxt
;

408 ià(
Ãxt
 >= 0)

409 
_¹abË
[
Ãxt
].
Î_´ev
 = 
´ev
;

412 
_¹abË
[
¹_i
].
Î_Ãxt
 = 
_¹_em±y_h—d
;

413 
_¹_em±y_h—d
 = 
¹_i
;

416 
Ãwmask
 = 
¶’
 - 1 ;‚ewmask >= 0 ;‚ewmask--)

417 ià(
Ãwmask
 == 0) {

418 
Ãw’t
 = 0;

421 
Ãw’t
 = 
	`fšd_’Œy
(
´efix
 & (0xfffffffà<< (32 - 
Ãwmask
)),

422 
Ãwmask
);

423 ià(
Ãw’t
 > 0)

428 
¡¬t
 = 
´efix
 >> 8;

429 ià(
¶’
 >= 24)

430 
’d
 = 
¡¬t
 + 1;

432 
’d
 = 
¡¬t
 + (1 << (24 - 
¶’
));

433 
i
 = 
¡¬t
; i < 
’d
; i++) {

434 ià(
_tbl_0_23
[
i
] & 0x8000) {

435 
£c_i
 = (
_tbl_0_23
[
i
] & 0x7fff) << 8;

436 ià(
¶’
 > 24) {

437 
£c_¡¬t
 = 
´efix
 & 0xFF;

438 
£c_’d
 = 
£c_¡¬t
 + (1 << (32 - 
¶’
));

440 
£c_¡¬t
 = 0;

441 
£c_’d
 = 256;

443 
j
 = 
£c_i
 + 
£c_¡¬t
; j < sec_˜+ 
£c_’d
; j++) {

444 ià(
¶’
 =ğ
_tbl_24_31_¶’
[
j
]) {

445 
_tbl_24_31
[
j
] = 
_¹abË
[
Ãw’t
].
vpÜt
;

446 
_tbl_24_31_¶’
[
j
] = 
Ãwmask
;

447 } ià(
¶’
 < 
_tbl_24_31_¶’
[
j
]) {

449 ià(
_tbl_24_31_¶’
[
j
] > 24) {

450 
j
 |ğ0x000000fà>> (
_tbl_24_31_¶’
[j] - 24);

452 
i
 |ğ0x00fffffà>> 
_tbl_24_31_¶’
[
j
];

458 
”rh
->
	`”rÜ
("BUG: _tbl_24_31[%08X] incÚsi¡’cy", 
j
);

462 
j
 = 
£c_i
 ; j < sec_i + 255; j++)

463 ià(
_tbl_24_31_¶’
[
j
] != _tbl_24_31_plen[j+1])

465 ià(
j
 =ğ
£c_i
 + 255) {

467 
_tbl_0_23
[
i
] = 
_tbl_24_31
[
£c_i
];

468 
_tbl_0_23_¶’
[
i
] = 
_tbl_24_31_¶’
[
£c_i
];

470 
_tbl_24_31
[
£c_i
] = 
_tbl_24_31_em±y_h—d
;

471 
_tbl_24_31_em±y_h—d
 = 
£c_i
 >> 8;

474 ià(
¶’
 =ğ
_tbl_0_23_¶’
[
i
]) {

475 
_tbl_0_23
[
i
] = 
_¹abË
[
Ãw’t
].
vpÜt
;

476 
_tbl_0_23_¶’
[
i
] = 
Ãwmask
;

477 } ià(
¶’
 < 
_tbl_0_23_¶’
[
i
]) {

479 
i
 |ğ0x00fffffà>> 
_tbl_0_23_¶’
[i];

485 
	}
}

490 
	gDœeùIPLookup
::
	$DœeùIPLookup
()

492 
	}
}

494 
DœeùIPLookup
::~
	$DœeùIPLookup
()

496 
	}
}

499 
DœeùIPLookup
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

501 
	gr
;

502 ià((
	gr
 = 
_t
.
š™Ÿlize
()) < 0)

503  
r
;

504 
	g_t
.
æush
();

505  
	gIPRou‹TabË
::
cÚfigu»
(
cÚf
, 
”rh
);

509 
	gDœeùIPLookup
::
	$ş—nup
(
CËªupSge
)

511 
_t
.
	`ş—nup
();

512 
	}
}

515 
	gDœeùIPLookup
::
	$push
(, 
Pack‘
 *
p
)

517 
IPAdd»ss
 
gw
;

518 
pÜt
 = 
	`lookup_rou‹
(
p
->
	`d¡__ªno
(), 
gw
);

520 ià(
pÜt
 >= 0) {

521 ià(
gw
)

522 
p
->
	`£t_d¡__ªno
(
gw
);

523 
	`ouut
(
pÜt
).
	`push
(
p
);

525 
p
->
	`kl
();

526 
	}
}

529 
	gDœeùIPLookup
::
	$lookup_rou‹
(
IPAdd»ss
 
de¡
, IPAdd»s &
gw
) const

531 
ušt32_t
 
_addr
 = 
	`Áohl
(
de¡
.
	`addr
());

532 
ušt16_t
 
vpÜt_i
 = 
_t
.
_tbl_0_23
[
_addr
 >> 8];

534 ià(
vpÜt_i
 & 0x8000)

535 
vpÜt_i
 = 
_t
.
_tbl_24_31
[((vpÜt_˜& 0x7fffè<< 8è| (
_addr
 & 0xff)];

537 
gw
 = 
_t
.
_vpÜt
[
vpÜt_i
].gw;

538  
_t
.
_vpÜt
[
vpÜt_i
].
pÜt
;

539 
	}
}

542 
	gDœeùIPLookup
::
	$add_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, 
boŞ
 
®low_»¶aû
, IPRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
 *
”rh
)

544  
_t
.
	`add_rou‹
(
rou‹
, 
®low_»¶aû
, 
Şd_rou‹
, 
”rh
);

545 
	}
}

548 
	gDœeùIPLookup
::
	$»move_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, IPRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
 *
”rh
)

550  
_t
.
	`»move_rou‹
(
rou‹
, 
Şd_rou‹
, 
”rh
);

551 
	}
}

554 
	gDœeùIPLookup
::
	$æush_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *,

555 
E¼ÜHªdËr
 *)

557 
DœeùIPLookup
 *
t
 = 
¡©ic_ÿ¡
<DœeùIPLooku°*>(
e
);

558 
t
->
_t
.
	`æush
();

560 
	}
}

562 
SŒšg


563 
	gDœeùIPLookup
::
	$dump_rou‹s
()

565  
_t
.
	`dump
();

566 
	}
}

569 
	gDœeùIPLookup
::
	$add_hªdËrs
()

571 
IPRou‹TabË
::
	`add_hªdËrs
();

572 
	`add_wr™e_hªdËr
("æush", 
æush_hªdËr
, 0, 
HªdËr
::
BUTTON
);

573 
	}
}

575 
CLICK_ENDDECLS


576 
ELEMENT_REQUIRES
(
IPRou‹TabË
 
u£¾ev–
|
bsdmoduË
)

577 
EXPORT_ELEMENT
(
DœeùIPLookup
)

	@ip/directiplookup.hh

2 #iâdeà
CLICK_DIRECTIPLOOKUP_HH


3 
	#CLICK_DIRECTIPLOOKUP_HH


	)

4 
	~"rou‹bË.hh
"

5 
CLICK_DECLS


85 
şass
 
	gRªgeIPLookup
;

87 şas 
	cDœeùIPLookup
 : 
public
 
IPRou‹TabË
 {…ublic:

89 
	$DœeùIPLookup
(è
CLICK_COLD
;

90 ~
	$DœeùIPLookup
(è
CLICK_COLD
;

92 cÚ¡ *
	$şass_Çme
() const {  "DirectIPLookup"; }

93 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

94 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

96 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

97 
	$ş—nup
(
CËªupSge
 
¡age
è
CLICK_COLD
;

98 
	$add_hªdËrs
(è
CLICK_COLD
;

100 
	`push
(
pÜt
, 
Pack‘
* 
p
);

102 
	`add_rou‹
(cÚ¡ 
IPRou‹
&, 
boŞ
, IPRou‹*, 
E¼ÜHªdËr
 *);

103 
	`»move_rou‹
(cÚ¡ 
IPRou‹
&, IPRou‹*, 
E¼ÜHªdËr
 *);

104 
	$lookup_rou‹
(
IPAdd»ss
, IPAddress&) const;

105 
SŒšg
 
	`dump_rou‹s
();

107 
	`æush_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

110 
RT_SIZE_MAX
 = 256 * 1024,

111 
tbl_24_31_ÿ·c™y_lim™
 = 32768 * 256,

112 
vpÜt_ÿ·c™y_lim™
 = 32768,

113 
PREF_HASHSIZE
 = 64 * 1024,

114 
DISCARD_PORT
 = -1

115 
	}
};

117 
	sCË¬‹xtEÁry
 {

118 
	gÎ_Ãxt
;

119 
	gÎ_´ev
;

120 
ušt32_t
 
	g´efix
;

121 
ušt16_t
 
	g¶’
;

122 
št16_t
 
	gvpÜt
;

125 
	sVœtu®PÜt
 {

126 
št16_t
 
	gÎ_Ãxt
;

127 
št16_t
 
	gÎ_´ev
;

128 
št32_t
 
	g»fcouÁ
;

129 
IPAdd»ss
 
	ggw
;

130 
št16_t
 
	gpÜt
;

131 
št16_t
 
	g·ddšg
;

134 
	sTabË
 {

136 
ušt16_t
 *
	g_tbl_0_23
;

137 
ušt16_t
 *
	g_tbl_24_31
;

138 
Vœtu®PÜt
 *
	g_vpÜt
;

141 
CË¬‹xtEÁry
 *
	g_¹abË
;

142 *
	g_¹_hashtbl
;

143 
ušt8_t
 *
	g_tbl_0_23_¶’
;

144 
ušt8_t
 *
	g_tbl_24_31_¶’
;

146 
ušt32_t
 
	g_¹abË_size
;

147 
ušt32_t
 
	g_tbl_24_31_size
;

148 
ušt32_t
 
	g_vpÜt_size
;

149 
	g_¹_em±y_h—d
;

150 
ušt16_t
 
	g_tbl_24_31_em±y_h—d
;

151 
	g_vpÜt_h—d
;

152 
	g_vpÜt_em±y_h—d
;

154 
ušt32_t
 
	g_¹abË_ÿ·c™y
;

155 
ušt32_t
 
	g_tbl_24_31_ÿ·c™y
;

156 
ušt32_t
 
	g_vpÜt_ÿ·c™y
;

158 
TabË
()

159 : 
_tbl_0_23
(0), 
_tbl_24_31
(0), 
_vpÜt
(0), 
_¹abË
(0),

160 
_¹_hashtbl
(0), 
_tbl_0_23_¶’
(0), 
_tbl_24_31_¶’
(0) {

163 ~
TabË
() {

164 
ş—nup
();

167 
š™Ÿlize
();

168 
ş—nup
();

170 
šlše
 
ušt32_t
 
´efix_hash
(uint32_t, uint32_t);

172 
fšd_’Œy
(
ušt32_t
, uint32_t) const;

173 
SŒšg
 
dump
() const;

175 
vpÜt_fšd
(
IPAdd»ss
 
gw
, 
št16_t
 
pÜt
);

176 
vpÜt_uÄef
(
ušt16_t
);

178 
add_rou‹
(cÚ¡ 
IPRou‹
&, 
boŞ
, IPRou‹*, 
E¼ÜHªdËr
 *);

179 
»move_rou‹
(cÚ¡ 
IPRou‹
&, IPRou‹*, 
E¼ÜHªdËr
 *);

180 
æush
();

184 
	g´Ùeùed
:

186 
TabË
 
_t
;

188 
ä›nd
 
şass
 
	gRªgeIPLookup
;

192 
	gCLICK_ENDDECLS


	@ip/fixipsrc.cc

18 
	~<şick/cÚfig.h
>

19 
	~"fix¤c.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şickÃt/.h
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
CLICK_DECLS


27 
	gFixIPSrc
::
	$FixIPSrc
()

29 
	}
}

31 
FixIPSrc
::~
	$FixIPSrc
()

33 
	}
}

36 
FixIPSrc
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

38 
IPAdd»ss
 
	ga
;

39 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("IPADDR", 
a
).
com¶‘e
() < 0)

41 
	g_my_
 = 
a
.
š_addr
();

45 
Wr™abËPack‘
 *

46 
	gFixIPSrc
::
	$fix_™
(
Pack‘
 *
p_š
)

48 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

49 
şick_
 *

 = 
p
->
	`_h—d”
();

50 
	`SET_FIX_IP_SRC_ANNO
(
p
, 0);

52 
	`şick_ch©‹r
("FixIPSrc changed %xo %x",

53 

->
_¤c
.
s_addr
,

54 
_my_
.
s_addr
);

56 

->
_¤c
 = 
_my_
;

57 
hËn
 = 

->
_hl
 << 2;

58 

->
_sum
 = 0;

59 

->
_sum
 = 
	`şick_š_cksum
((*), 
hËn
);

60  
p
;

61 
	}
}

63 
Pack‘
 *

64 
	gFixIPSrc
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

66 ià(
	`FIX_IP_SRC_ANNO
(
p
è&&…->
	`has_ÃtwÜk_h—d”
())

67 
p
 = 
	`fix_™
(p);

68  
p
;

69 
	}
}

71 
CLICK_ENDDECLS


72 
	$EXPORT_ELEMENT
(
FixIPSrc
)

73 
	`ELEMENT_MT_SAFE
(
FixIPSrc
)

	@ip/fixipsrc.hh

1 #iâdeà
CLICK_FIXIPSRC_HH


2 
	#CLICK_FIXIPSRC_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


29 şas 
	cFixIPSrc
 : 
public
 
EËm’t
 {

30 
š_addr
 
_my_
;

32 
	mpublic
:

33 
	$FixIPSrc
(è
CLICK_COLD
;

34 ~
	$FixIPSrc
(è
CLICK_COLD
;

36 cÚ¡ *
	$şass_Çme
() const {  "FixIPSrc"; }

37 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

38 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

40 
Wr™abËPack‘
 *
fix_™
(
Pack‘
 *);

41 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

45 
	gCLICK_ENDDECLS


	@ip/getipaddress.cc

20 
	~<şick/cÚfig.h
>

21 
	~"g‘add»ss.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şickÃt/.h
>

25 
CLICK_DECLS


27 
	gG‘IPAdd»ss
::
	$G‘IPAdd»ss
()

29 
	}
}

31 
G‘IPAdd»ss
::~
	$G‘IPAdd»ss
()

33 
	}
}

36 
G‘IPAdd»ss
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

38 
	g_off£t
 = -1;

39 
	g_ªno
 = 
Pack‘
::
d¡__ªno_off£t
;

40 
SŒšg
 
	g_wÜd
;

41 ià(
Args
(
cÚf
, 
this
, 
”rh
)

42 .
»ad_p
("OFFSET", 
_off£t
)

43 .
»ad_p
("ANNO", 
AÂoArg
(4), 
_ªno
)

44 .
»ad
("IP", 
_wÜd
)

45 .
com¶‘e
())

47 ià((
	g_off£t
 >ğ0 && 
_wÜd
è|| (
_off£t
 < 0 && !ip_word))

48  
”rh
->
”rÜ
("set one of OFFSET, IP");

49 ià(
	g_wÜd
 == "src")

50 
_off£t
 = 
off£t__¤c
;

51 ià(
	g_wÜd
 == "dst")

52 
_off£t
 = 
off£t__d¡
;

53 ià(
	g_wÜd
)

54  
	g”rh
->
”rÜ
("bad IP");

58 
Pack‘
 *

59 
	gG‘IPAdd»ss
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

61 ià(
_off£t
 >= 0)

62 
p
->
	`£t_ªno_u32
(
_ªno
, 
	`IPAdd»ss
Õ->
	`d©a
(è+ 
_off£t
).
	`addr
());

63 ià(
_off£t
 =ğ
off£t__¤c
)

64 
p
->
	`£t_ªno_u32
(
_ªno
,…->
	`_h—d”
()->
_¤c
.
s_addr
);

65 ià(
_off£t
 =ğ
off£t__d¡
)

66 
p
->
	`£t_ªno_u32
(
_ªno
,…->
	`_h—d”
()->
_d¡
.
s_addr
);

67  
p
;

68 
	}
}

70 
CLICK_ENDDECLS


71 
	$EXPORT_ELEMENT
(
G‘IPAdd»ss
)

72 
	`ELEMENT_MT_SAFE
(
G‘IPAdd»ss
)

	@ip/getipaddress.hh

1 #iâdeà
CLICK_GETIPADDRESS_HH


2 
	#CLICK_GETIPADDRESS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/add»ss.hh
>

5 
CLICK_DECLS


34 şas 
	cG‘IPAdd»ss
 : 
public
 
EËm’t
 {

37 
off£t__¤c
 = -1,

38 
	moff£t__d¡
 = -2

41 
	g_off£t
;

42 
	g_ªno
;

44 
	gpublic
:

46 
	$G‘IPAdd»ss
(è
CLICK_COLD
;

47 ~
	$G‘IPAdd»ss
(è
CLICK_COLD
;

49 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "G‘IPAdd»ss"; 
	}
}

50 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

52 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

54 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

58 
	gCLICK_ENDDECLS


	@ip/ipaddrpairrewriter.cc

19 
	~<şick/cÚfig.h
>

20 
	~"add½aœ»wr™”.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şickÃt/tı.h
>

25 
	~<şickÃt/udp.h
>

26 
CLICK_DECLS


29 
	gIPAddrPaœRewr™”
::
IPAddrPaœFlow
::
	$­¶y
(
Wr™abËPack‘
 *
p
, 
boŞ
 
dœeùiÚ
,

30 
ªnos
)

32 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

33 
şick_
 *
h
 = 
p
->
	`_h—d”
();

36 cÚ¡ 
IPFlowID
 &
»væow
 = 
_e
[!
dœeùiÚ
].
	`æowid
();

37 
h
->
_¤c
 = 
»væow
.
	`daddr
();

38 
h
->
_d¡
 = 
»væow
.
	`§ddr
();

39 ià(
ªnos
 & 1)

40 
p
->
	`£t_d¡__ªno
(
»væow
.
	`§ddr
());

41 ià(
dœeùiÚ
 && (
ªnos
 & 2))

42 
p
->
	`£t_ªno_u8
(
ªnos
 >> 2, 
_»¶y_ªno
);

43 
	`upd©e_csum
(&
h
->
_sum
, 
dœeùiÚ
, 
__csum_d–
);

46 ià(!
	`IP_FIRSTFRAG
(
h
))

48 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
 && 
p
->
	`Œª¥Üt_Ëngth
() >= 18) {

49 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

50 
	`upd©e_csum
(&
tıh
->
th_sum
, 
dœeùiÚ
, 
_udp_csum_d–
);

51 } ià(
h
->
_p
 =ğ
IP_PROTO_UDP
 && 
p
->
	`Œª¥Üt_Ëngth
() >= 8) {

52 
şick_udp
 *
udph
 = 
p
->
	`udp_h—d”
();

53 ià(
udph
->
uh_sum
)

54 
	`upd©e_csum
(&
udph
->
uh_sum
, 
dœeùiÚ
, 
_udp_csum_d–
);

56 
	}
}

59 
	gIPAddrPaœRewr™”
::
IPAddrPaœFlow
::
	$uÅ¬£
(
SŒšgAccum
 &
§
, 
boŞ
 
dœeùiÚ
,

60 
şick_jiff›s_t
 
now
) const

62 cÚ¡ 
IPFlowID
 &
æow
 = 
_e
[
dœeùiÚ
].
	`æowid
();

63 cÚ¡ 
IPFlowID
 &
»¶y_æow
 = 
_e
[!
dœeùiÚ
].
	`æowid
();

64 
§
 << '(' << 
æow
.
	`§ddr
(è<< ", " << flow.
	`daddr
() << ") => ("

65 << 
»¶y_æow
.
	`daddr
(è<< ", " <<„•ly_æow.
	`§ddr
() << ')';

66 
	`uÅ¬£_pÜts
(
§
, 
dœeùiÚ
, 
now
);

67 
	}
}

69 
	gIPAddrPaœRewr™”
::
	$IPAddrPaœRewr™”
()

71 
	}
}

73 
IPAddrPaœRewr™”
::~
	$IPAddrPaœRewr™”
()

75 
	}
}

78 
IPAddrPaœRewr™”
::
	$ÿ¡
(cÚ¡ *
n
)

80 ià(
	`¡rcmp
(
n
, "IPRewriterBase") == 0)

81  (
IPRewr™”Ba£
 *)
this
;

82 ià(
	`¡rcmp
(
n
, "IPAddrPairRewriter") == 0)

83  (
IPAddrPaœRewr™”
 *)
this
;

86 
	}
}

89 
	gIPAddrPaœRewr™”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

91 
boŞ
 
	ghas_»¶y_ªno
 = 
çl£
;

92 
	g»¶y_ªno
;

93 
	g_timeouts
[0] = 60 * 120;

95 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

96 .
»ad
("REPLY_ANNO", 
has_»¶y_ªno
, 
AÂoArg
(1), 
»¶y_ªno
)

97 .
cÚsume
() < 0)

100 
	g_ªnos
 = 1 + (
has_»¶y_ªno
 ? 2 + (
»¶y_ªno
 << 2) : 0);

101  
	gIPRewr™”Ba£
::
cÚfigu»
(
cÚf
, 
”rh
);

104 
IPRewr™”EÁry
 *

105 
	gIPAddrPaœRewr™”
::
	$g‘_’Œy
(, cÚ¡ 
IPFlowID
 &
xæowid
, 
šput
)

107 
IPFlowID
 
	`æowid
(
xæowid
.
	`§ddr
(), 0, xæowid.
	`daddr
(), 0);

108 
IPRewr™”EÁry
 *
m
 = 
_m­
.
	`g‘
(
æowid
);

109 ià(!
m
 && (è
šput
 < (è
_šput_¥ecs
.
	`size
()) {

110 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
[
šput
];

111 
IPFlowID
 
»wr™‹n_æowid
 = IPFlowID::
	`unš™Ÿlized_t
();

112 ià(
is
.
	`»wr™e_æowid
(
æowid
, 
»wr™‹n_æowid
, 0è=ğ
rw_addm­
)

113 
m
 = 
IPAddrPaœRewr™”
::
	`add_æow
(0, 
æowid
, 
»wr™‹n_æowid
, 
šput
);

115  
m
;

116 
	}
}

118 
IPRewr™”EÁry
 *

119 
	gIPAddrPaœRewr™”
::
	$add_æow
(, cÚ¡ 
IPFlowID
 &
æowid
,

120 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
, 
šput
)

122 *
d©a
;

123 ià(
»wr™‹n_æowid
.
	`¥Üt
()

124 || 
»wr™‹n_æowid
.
	`dpÜt
()

125 || !(
d©a
 = 
_®loÿtÜ
.
	`®loÿ‹
()))

128 
IPAddrPaœFlow
 *
æow
 = 
	`Ãw
(
d©a
) IPAddrPairFlow

129 (&
_šput_¥ecs
[
šput
], 
æowid
, 
»wr™‹n_æowid
,

130 !!
_timeouts
[1], 
	`şick_jiff›s
(è+ 
	`»Ëvªt_timeout
(_timeouts));

132  
	`¡Üe_æow
(
æow
, 
šput
, 
_m­
);

133 
	}
}

136 
	gIPAddrPaœRewr™”
::
	$push
(
pÜt
, 
Pack‘
 *
p_š
)

138 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

139 
şick_
 *
h
 = 
p
->
	`_h—d”
();

141 
IPFlowID
 
	`æowid
(
h
->
_¤c
, 0, iph->
_d¡
, 0);

142 
IPRewr™”EÁry
 *
m
 = 
_m­
.
	`g‘
(
æowid
);

144 ià(!
m
) {

145 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
.
	`unchecked_©
(
pÜt
);

146 
IPFlowID
 
»wr™‹n_æowid
 = IPFlowID::
	`unš™Ÿlized_t
();

147 
»suÉ
 = 
is
.
	`»wr™e_æowid
(
æowid
, 
»wr™‹n_æowid
, 
p
);

148 ià(
»suÉ
 =ğ
rw_addm­
)

149 
m
 = 
IPAddrPaœRewr™”
::
	`add_æow
(0, 
æowid
, 
»wr™‹n_æowid
, 
pÜt
);

150 ià(!
m
) {

151 
	`checked_ouut_push
(
»suÉ
, 
p
);

153 } ià(
_ªnos
 & 2)

154 
m
->
	`æow
()->
	`£t_»¶y_ªno
(
p
->
	`ªno_u8
(
_ªnos
 >> 2));

157 
IPAddrPaœFlow
 *
mf
 = 
¡©ic_ÿ¡
<IPAddrPaœFlow *>(
m
->
	`æow
());

158 
mf
->
	`­¶y
(
p
, 
m
->
	`dœeùiÚ
(), 
_ªnos
);

159 
mf
->
	`chªge_expœy_by_timeout
(
_h—p
, 
	`şick_jiff›s
(), 
_timeouts
);

160 
	`ouut
(
m
->ouut()).
	`push
(
p
);

161 
	}
}

164 
SŒšg


165 
	gIPAddrPaœRewr™”
::
	$dump_m­pšgs_hªdËr
(
EËm’t
 *
e
, *)

167 
IPAddrPaœRewr™”
 *
rw
 = (IPAddrPaœRewr™” *)
e
;

168 
şick_jiff›s_t
 
now
 = 
	`şick_jiff›s
();

169 
SŒšgAccum
 
§
;

170 
M­
::
™”©Ü
 
™”
 = 
rw
->
_m­
.
	`begš
(); i‹r.
	`live
(); iter++) {

171 
IPAddrPaœFlow
 *
f
 = 
¡©ic_ÿ¡
<IPAddrPaœFlow *>(
™”
->
	`æow
());

172 
f
->
	`uÅ¬£
(
§
, 
™”
->
	`dœeùiÚ
(), 
now
);

173 
§
 << '\n';

175  
§
.
	`ke_¡ršg
();

176 
	}
}

179 
	gIPAddrPaœRewr™”
::
	$add_hªdËrs
()

181 
	`add_»ad_hªdËr
("bË", 
dump_m­pšgs_hªdËr
);

182 
	`add_»ad_hªdËr
("m­pšgs", 
dump_m­pšgs_hªdËr
, 0, 
HªdËr
::
h_d•»ÿ‹d
);

183 
	`add_»wr™”_hªdËrs
(
Œue
);

184 
	}
}

186 
	$ELEMENT_REQUIRES
(
IPRewr™”Ba£
)

187 
	$EXPORT_ELEMENT
(
IPAddrPaœRewr™”
)

188 
CLICK_ENDDECLS


	@ip/ipaddrpairrewriter.hh

2 #iâdeà
CLICK_IPADDRPAIRREWRITER_HH


3 
	#CLICK_IPADDRPAIRREWRITER_HH


	)

4 
	~"–em’ts//»wr™”ba£.hh
"

5 
	~"–em’ts//rwm­pšg.hh
"

6 
CLICK_DECLS


117 şas 
	cIPAddrPaœRewr™”
 : 
public
 
IPRewr™”Ba£
 {…ublic:

119 şas 
	cIPAddrPaœFlow
 : 
public
 
IPRewr™”Flow
 {…ublic:

121 
IPAddrPaœFlow
(
IPRewr™”IÅut
 *
owÃr
, cÚ¡ 
IPFlowID
 &
æowid
,

122 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
,

123 
boŞ
 
gu¬ª‹ed
, 
şick_jiff›s_t
 
expœy_j
)

124 : 
IPRewr™”Flow
(
owÃr
, 
æowid
, 
»wr™‹n_æowid
,

125 0, 
gu¬ª‹ed
, 
expœy_j
) {

128 
­¶y
(
Wr™abËPack‘
 *
p
, 
boŞ
 
dœeùiÚ
, 
ªnos
);

130 
uÅ¬£
(
SŒšgAccum
 &
§
, 
boŞ
 
dœeùiÚ
, 
şick_jiff›s_t
 
now
) const;

134 
	$IPAddrPaœRewr™”
(è
CLICK_COLD
;

135 ~
	$IPAddrPaœRewr™”
(è
CLICK_COLD
;

137 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "IPAddrPaœRewr™”"; 
	}
}

138 *
ÿ¡
(const *);

140 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

143 
IPRewr™”EÁry
 *
g‘_’Œy
(
_p
, cÚ¡ 
IPFlowID
 &
xæowid
, 
šput
);

144 
IPRewr™”EÁry
 *
add_æow
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
,

145 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
, 
šput
);

146 
de¡roy_æow
(
IPRewr™”Flow
 *
æow
);

148 
push
(, 
Pack‘
 *);

150 
	$add_hªdËrs
(è
CLICK_COLD
;

152 
´iv©e
:

154 
SizedHashAÎoÿtÜ
<(
IPAddrPaœFlow
)> 
_®loÿtÜ
;

155 
_ªnos
;

157 
SŒšg
 
	`dump_m­pšgs_hªdËr
(
EËm’t
 *, *);

159 
	}
};

162 
šlše
 

163 
	gIPAddrPaœRewr™”
::
	$de¡roy_æow
(
IPRewr™”Flow
 *
æow
)

165 
	`unm­_æow
(
æow
, 
_m­
);

166 
¡©ic_ÿ¡
<
IPAddrPaœFlow
 *>(
æow
)->~
	`IPAddrPaœFlow
();

167 
_®loÿtÜ
.
	`d—Îoÿ‹
(
æow
);

168 
	}
}

170 
	gCLICK_ENDDECLS


	@ip/ipaddrrewriter.cc

19 
	~<şick/cÚfig.h
>

20 
	~"add¼ewr™”.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şickÃt/tı.h
>

25 
	~<şickÃt/udp.h
>

26 
CLICK_DECLS


29 
	gIPAddrRewr™”
::
IPAddrFlow
::
	$­¶y
(
Wr™abËPack‘
 *
p
, 
boŞ
 
dœeùiÚ
,

30 
ªnos
)

32 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

33 
şick_
 *
h
 = 
p
->
	`_h—d”
();

36 cÚ¡ 
IPFlowID
 &
»væow
 = 
_e
[!
dœeùiÚ
].
	`æowid
();

37 ià(!
dœeùiÚ
)

38 
h
->
_¤c
 = 
»væow
.
	`daddr
();

40 
h
->
_d¡
 = 
»væow
.
	`§ddr
();

41 ià(
ªnos
 & 1)

42 
p
->
	`£t_d¡__ªno
(
»væow
.
	`§ddr
());

43 ià(
ªnos
 & 2)

44 
p
->
	`£t_ªno_u8
(
ªnos
 >> 2, 
_»¶y_ªno
);

46 
	`upd©e_csum
(&
h
->
_sum
, 
dœeùiÚ
, 
__csum_d–
);

49 ià(!
	`IP_FIRSTFRAG
(
h
))

51 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
 && 
p
->
	`Œª¥Üt_Ëngth
() >= 18) {

52 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

53 
	`upd©e_csum
(&
tıh
->
th_sum
, 
dœeùiÚ
, 
_udp_csum_d–
);

54 } ià(
h
->
_p
 =ğ
IP_PROTO_UDP
 && 
p
->
	`Œª¥Üt_Ëngth
() >= 8) {

55 
şick_udp
 *
udph
 = 
p
->
	`udp_h—d”
();

56 ià(
udph
->
uh_sum
)

57 
	`upd©e_csum
(&
udph
->
uh_sum
, 
dœeùiÚ
, 
_udp_csum_d–
);

59 
	}
}

62 
	gIPAddrRewr™”
::
IPAddrFlow
::
	$uÅ¬£
(
SŒšgAccum
 &
§
, 
boŞ
 
dœeùiÚ
,

63 
şick_jiff›s_t
 
now
) const

65 
§
 << 
_e
[
dœeùiÚ
].
	`æowid
().
	`§ddr
() << " => "

66 << 
_e
[!
dœeùiÚ
].
	`æowid
().
	`daddr
();

67 
	`uÅ¬£_pÜts
(
§
, 
dœeùiÚ
, 
now
);

68 
	}
}

70 
	gIPAddrRewr™”
::
	$IPAddrRewr™”
()

72 
	}
}

74 
IPAddrRewr™”
::~
	$IPAddrRewr™”
()

76 
	}
}

79 
IPAddrRewr™”
::
	$ÿ¡
(cÚ¡ *
n
)

81 ià(
	`¡rcmp
(
n
, "IPRewriterBase") == 0)

82  (
IPRewr™”Ba£
 *)
this
;

83 ià(
	`¡rcmp
(
n
, "IPAddrRewriter") == 0)

84  (
IPAddrRewr™”
 *)
this
;

87 
	}
}

90 
	gIPAddrRewr™”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

92 
boŞ
 
	ghas_»¶y_ªno
 = 
çl£
;

93 
	g»¶y_ªno
;

94 
	g_timeouts
[0] = 60 * 120;

96 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

97 .
»ad
("REPLY_ANNO", 
has_»¶y_ªno
, 
AÂoArg
(1), 
»¶y_ªno
)

98 .
cÚsume
() < 0)

101 
	g_ªnos
 = 1 + (
has_»¶y_ªno
 ? 2 + (
»¶y_ªno
 << 2) : 0);

102  
	gIPRewr™”Ba£
::
cÚfigu»
(
cÚf
, 
”rh
);

105 
IPRewr™”EÁry
 *

106 
	gIPAddrRewr™”
::
	$g‘_’Œy
(, cÚ¡ 
IPFlowID
 &
xæowid
, 
šput
)

108 
IPFlowID
 
	`æowid
(
xæowid
.
	`§ddr
(), 0, 
	`IPAdd»ss
(), 0);

109 
IPRewr™”EÁry
 *
m
 = 
_m­
.
	`g‘
(
æowid
);

110 ià(!
m
) {

111 
IPFlowID
 
	`ræowid
(
	`IPAdd»ss
(), 0, 
xæowid
.
	`daddr
(), 0);

112 
m
 = 
_m­
.
	`g‘
(
ræowid
);

114 ià(!
m
 && (è
šput
 < (è
_šput_¥ecs
.
	`size
()) {

115 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
[
šput
];

116 
IPFlowID
 
»wr™‹n_æowid
 = IPFlowID::
	`unš™Ÿlized_t
();

117 ià(
is
.
	`»wr™e_æowid
(
æowid
, 
»wr™‹n_æowid
, 0è=ğ
rw_addm­
)

118 
m
 = 
	`add_æow
(0, 
æowid
, 
»wr™‹n_æowid
, 
šput
);

120  
m
;

121 
	}
}

123 
IPRewr™”EÁry
 *

124 
	gIPAddrRewr™”
::
	$add_æow
(, cÚ¡ 
IPFlowID
 &
æowid
,

125 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
, 
šput
)

127 *
d©a
;

128 ià(
»wr™‹n_æowid
.
	`¥Üt
()

129 || 
»wr™‹n_æowid
.
	`dpÜt
()

130 || 
»wr™‹n_æowid
.
	`daddr
()

131 || !(
d©a
 = 
_®loÿtÜ
.
	`®loÿ‹
()))

134 
IPAddrFlow
 *
æow
 = 
	`Ãw
(
d©a
) IPAddrFlow

135 (&
_šput_¥ecs
[
šput
], 
æowid
, 
»wr™‹n_æowid
,

136 !!
_timeouts
[1], 
	`şick_jiff›s
(è+ 
	`»Ëvªt_timeout
(_timeouts));

138  
	`¡Üe_æow
(
æow
, 
šput
, 
_m­
);

139 
	}
}

142 
	gIPAddrRewr™”
::
	$push
(
pÜt
, 
Pack‘
 *
p_š
)

144 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

145 
şick_
 *
h
 = 
p
->
	`_h—d”
();

147 
IPFlowID
 
	`æowid
(
h
->
_¤c
, 0, 
	`IPAdd»ss
(), 0);

148 
IPRewr™”EÁry
 *
m
 = 
_m­
.
	`g‘
(
æowid
);

150 ià(!
m
) {

151 
IPFlowID
 
ræowid
 = 
	`IPFlowID
(
	`IPAdd»ss
(), 0, 
h
->
_d¡
, 0);

152 
m
 = 
_m­
.
	`g‘
(
ræowid
);

155 ià(!
m
) {

156 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
.
	`unchecked_©
(
pÜt
);

157 
IPFlowID
 
»wr™‹n_æowid
 = IPFlowID::
	`unš™Ÿlized_t
();

158 
»suÉ
 = 
is
.
	`»wr™e_æowid
(
æowid
, 
»wr™‹n_æowid
, 
p
);

159 ià(
»suÉ
 =ğ
rw_addm­
)

160 
m
 = 
IPAddrRewr™”
::
	`add_æow
(0, 
æowid
, 
»wr™‹n_æowid
, 
pÜt
);

161 ià(!
m
) {

162 
	`checked_ouut_push
(
»suÉ
, 
p
);

164 } ià(
_ªnos
 & 2)

165 
m
->
	`æow
()->
	`£t_»¶y_ªno
(
p
->
	`ªno_u8
(
_ªnos
 >> 2));

168 
IPAddrFlow
 *
mf
 = 
¡©ic_ÿ¡
<IPAddrFlow *>(
m
->
	`æow
());

169 
mf
->
	`­¶y
(
p
, 
m
->
	`dœeùiÚ
(), 
_ªnos
);

170 
mf
->
	`chªge_expœy_by_timeout
(
_h—p
, 
	`şick_jiff›s
(), 
_timeouts
);

171 
	`ouut
(
m
->ouut()).
	`push
(
p
);

172 
	}
}

175 
SŒšg


176 
	gIPAddrRewr™”
::
	$dump_m­pšgs_hªdËr
(
EËm’t
 *
e
, *)

178 
IPAddrRewr™”
 *
rw
 = (IPAddrRewr™” *)
e
;

179 
SŒšgAccum
 
§
;

180 
şick_jiff›s_t
 
now
 = 
	`şick_jiff›s
();

181 
M­
::
™”©Ü
 
™”
 = 
rw
->
_m­
.
	`begš
(); i‹r.
	`live
(); iter++) {

182 
IPAddrFlow
 *
f
 = 
¡©ic_ÿ¡
<IPAddrFlow *>(
™”
->
	`æow
());

183 
f
->
	`uÅ¬£
(
§
, 
™”
->
	`dœeùiÚ
(), 
now
);

184 
§
 << '\n';

186  
§
.
	`ke_¡ršg
();

187 
	}
}

190 
	gIPAddrRewr™”
::
	$add_hªdËrs
()

192 
	`add_»ad_hªdËr
("bË", 
dump_m­pšgs_hªdËr
);

193 
	`add_»ad_hªdËr
("m­pšgs", 
dump_m­pšgs_hªdËr
, 0, 
HªdËr
::
h_d•»ÿ‹d
);

194 
	`add_»wr™”_hªdËrs
(
Œue
);

195 
	}
}

197 
	$ELEMENT_REQUIRES
(
IPRewr™”Ba£
)

198 
	$EXPORT_ELEMENT
(
IPAddrRewr™”
)

199 
CLICK_ENDDECLS


	@ip/ipaddrrewriter.hh

2 #iâdeà
CLICK_IPADDRREWRITER_HH


3 
	#CLICK_IPADDRREWRITER_HH


	)

4 
	~"–em’ts//»wr™”ba£.hh
"

5 
	~"–em’ts//rwm­pšg.hh
"

6 
CLICK_DECLS


116 şas 
	cIPAddrRewr™”
 : 
public
 
IPRewr™”Ba£
 {…ublic:

118 şas 
	cIPAddrFlow
 : 
public
 
IPRewr™”Flow
 {…ublic:

120 
IPAddrFlow
(
IPRewr™”IÅut
 *
owÃr
, cÚ¡ 
IPFlowID
 &
æowid
,

121 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
,

122 
boŞ
 
gu¬ª‹ed
, 
şick_jiff›s_t
 
expœy_j
)

123 : 
IPRewr™”Flow
(
owÃr
, 
æowid
, 
»wr™‹n_æowid
,

124 0, 
gu¬ª‹ed
, 
expœy_j
) {

127 
­¶y
(
Wr™abËPack‘
 *
p
, 
boŞ
 
dœeùiÚ
, 
ªnos
);

129 
uÅ¬£
(
SŒšgAccum
 &
§
, 
boŞ
 
dœeùiÚ
, 
şick_jiff›s_t
 
now
) const;

133 
	$IPAddrRewr™”
(è
CLICK_COLD
;

134 ~
	$IPAddrRewr™”
(è
CLICK_COLD
;

136 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "IPAddrRewr™”"; 
	}
}

137 *
ÿ¡
(const *);

139 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

142 
šlše
 
IPRewr™”EÁry
 *
g‘_’Œy
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
, 
šput
);

143 
IPRewr™”EÁry
 *
add_æow
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
,

144 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
, 
šput
);

145 
de¡roy_æow
(
IPRewr™”Flow
 *
æow
);

147 
push
(, 
Pack‘
 *);

149 
	$add_hªdËrs
(è
CLICK_COLD
;

151 
´Ùeùed
:

153 
SizedHashAÎoÿtÜ
<(
IPAddrFlow
)> 
_®loÿtÜ
;

154 
_ªnos
;

156 
SŒšg
 
	`dump_m­pšgs_hªdËr
(
EËm’t
 *, *);

158 
	}
};

161 
šlše
 

162 
	gIPAddrRewr™”
::
	$de¡roy_æow
(
IPRewr™”Flow
 *
æow
)

164 
	`unm­_æow
(
æow
, 
_m­
);

165 
¡©ic_ÿ¡
<
IPAddrFlow
 *>(
æow
)->~
	`IPAddrFlow
();

166 
_®loÿtÜ
.
	`d—Îoÿ‹
(
æow
);

167 
	}
}

169 
	gCLICK_ENDDECLS


	@ip/ipclassifier.cc

19 
	~<şick/cÚfig.h
>

20 
	~"şassif›r.hh
"

21 
	~<şick/glue.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/cÚå¬£.hh
>

24 
	~<şick/rou‹r.hh
>

25 
CLICK_DECLS


27 
	gIPCÏssif›r
::
	$IPCÏssif›r
()

29 
	}
}

31 
IPCÏssif›r
::~
	$IPCÏssif›r
()

33 
	}
}

36 
IPCÏssif›r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

38 ià(
	gcÚf
.
size
(è!ğ
nouuts
())

39  
”rh
->
”rÜ
("Ãed %d‡rgum’ts, oÃ…” ouuˆpÜt", 
nouuts
());

42 
	gVeùÜ
<
	gSŒšg
> 
	gÃw_cÚf
;

43 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++)

44 
	gÃw_cÚf
.
push_back
(
SŒšg
(
i
è+ " " + 
cÚf
[i]);

45 
	gr
 = 
IPF‹r
::
cÚfigu»
(
Ãw_cÚf
, 
”rh
);

46 ià(
	gr
 >ğ0 && !
rou‹r
()->
š™Ÿlized
())

47 
_z´og
.
w¬n_unu£d_ouuts
(
nouuts
(), 
”rh
);

48  
	gr
;

51 
	gIPCÏssif›r
::
	$add_hªdËrs
() {

52 
IPF‹r
::
	`add_hªdËrs
();

53 
ušŒ_t
 
i
 = 0; i !ğ(ušŒ_tè
	`nouuts
(); ++i) {

54 
	`add_»ad_hªdËr
("·‰”n" + 
	`SŒšg
(
i
), 
»ad_pos™iÚ®_hªdËr
, (*) i);

55 
	`add_wr™e_hªdËr
("·‰”n" + 
	`SŒšg
(
i
), 
»cÚfigu»_pos™iÚ®_hªdËr
, (*) i);

57 
	}
}

59 
CLICK_ENDDECLS


60 
	$ELEMENT_REQUIRES
(
IPF‹r
)

61 
	$EXPORT_ELEMENT
(
IPCÏssif›r
)

62 
	`ELEMENT_MT_SAFE
(
IPCÏssif›r
)

	@ip/ipclassifier.hh

1 #iâdeà
CLICK_IPCLASSIFIER_HH


2 
	#CLICK_IPCLASSIFIER_HH


	)

3 
	~"–em’ts//f‹r.hh
"

4 
CLICK_DECLS


238 şas 
	cIPCÏssif›r
 : 
public
 
IPF‹r
 {…ublic:

240 
	$IPCÏssif›r
(è
CLICK_COLD
;

241 ~
	$IPCÏssif›r
(è
CLICK_COLD
;

243 cÚ¡ *
	$şass_Çme
() const {  "IPClassifier"; }

244 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

246 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

247 
	$add_hªdËrs
(è
CLICK_COLD
;

249 
	}
};

251 
	gCLICK_ENDDECLS


	@ip/ipencap.cc

18 
	~<şick/cÚfig.h
>

19 
	~"’ÿp.hh
"

20 
	~<şick/Çmešfo.hh
>

21 
	~<şick/cÚå¬£.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
CLICK_DECLS


26 
	gIPEnÿp
::
	$IPEnÿp
()

28 
	}
}

30 
IPEnÿp
::~
	$IPEnÿp
()

32 
	}
}

35 
IPEnÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 
şick_
 
	gh
;

38 
mem£t
(&
h
, 0, (
şick_
));

39 
	gh
.
	g_v
 = 4;

40 
	gh
.
	g_hl
 = (
şick_
) >> 2;

41 
	gh
.
	g_‰l
 = 250;

42 
	g´Ùo
, 
	gtos
 = -1, 
	gdsı
 = -1;

43 
boŞ
 
	gû
 = 
çl£
, 
	gdf
 = false;

44 
SŒšg
 
	geù_¡r
, 
	gd¡_¡r
;

46 ià(
Args
(
cÚf
, 
this
, 
”rh
)

47 .
»ad_mp
("PROTO", 
NamedIÁArg
(
NameInfo
::
T_IP_PROTO
), 
´Ùo
)

48 .
»ad_mp
("SRC", 
h
.
_¤c
)

49 .
»ad_mp
("DST", 
AnyArg
(), 
d¡_¡r
)

50 .
»ad
("TOS", 
tos
)

51 .
»ad
("TTL", 
h
.
_‰l
)

52 .
»ad
("DSCP", 
dsı
)

53 .
»ad
("ECT", 
KeywÜdArg
(), 
eù_¡r
)

54 .
»ad
("CE", 
û
)

55 .
»ad
("DF", 
df
)

56 .
com¶‘e
() < 0)

59 ià(
	g´Ùo
 < 0 ||…roto > 255)

60  
	g”rh
->
”rÜ
("bad IP…rotocol");

61 
	gh
.
	g_p
 = 
´Ùo
;

63 
boŞ
 
	gu£_d¡_ªno
 = 
d¡_¡r
 == "DST_ANNO";

64 ià(
	gu£_d¡_ªno
)

65 
	gh
.
	g_d¡
.
	gs_addr
 = 0;

66 ià(!
IPAdd»ssArg
().
·r£
(
d¡_¡r
, 
h
.
_d¡
, 
this
))

67  
	g”rh
->
”rÜ
("DST‡rgument should be IP‡ddress or 'DST_ANNO'");

69 
	geù
 = 0;

70 ià(
	geù_¡r
) {

71 
boŞ
 
	gx
;

72 ià(
BoŞArg
().
·r£
(
eù_¡r
, 
x
))

73 
	geù
 = 
x
;

74 ià(
	geù_¡r
 == "2")

75 
eù
 = 2;

77  
	g”rh
->
”rÜ
("bad ECT v®u'%s'", 
eù_¡r
.
c_¡r
());

80 ià(
	gtos
 >ğ0 && 
dsı
 >= 0)

81  
”rh
->
”rÜ
("cannot set both TOS‡nd DSCP");

82 ià(
	gtos
 >ğ0 && (
eù
 || 
û
))

83  
”rh
->
”rÜ
("cannot set both TOS‡nd ECN bits");

84 ià(
	gtos
 >ğ256 || 
tos
 < -1)

85  
”rh
->
”rÜ
("TOSoo†arge; max 255");

86 ià(
	gdsı
 >ğ63 || 
dsı
 < -1)

87  
”rh
->
”rÜ
("DSCPoo†arge; max 63");

88 ià(
	geù
 && 
	gû
)

89  
	g”rh
->
”rÜ
("can set‡t most one ECN option");

91 ià(
	gtos
 >= 0)

92 
h
.
_tos
 = 
tos
;

93 ià(
	gdsı
 >= 0)

94 
h
.
_tos
 = (
dsı
 << 2);

95 ià(
	geù
)

96 
	gh
.
	g_tos
 |ğ(
eù
 =ğ1 ? 
IP_ECN_ECT1
 : 
IP_ECN_ECT2
);

97 ià(
	gû
)

98 
	gh
.
	g_tos
 |ğ
IP_ECN_CE
;

99 ià(
	gdf
)

100 
	gh
.
	g_off
 |ğ
htÚs
(
IP_DF
);

101 
	g_h
 = 
h
;

104 #ià
HAVE_FAST_CHECKSUM


105 
	g_h
.
	g_sum
 = 
_ç¡_csum
((*è&
_h
, (
şick_
) >> 2);

107 
	g_h
.
	g_sum
 = 
şick_š_cksum
((*è&
_h
, (
şick_
));

112 
	g_h
.
	g_Ën
 = (
u£_d¡_ªno
 ? 1 : 0);

118 
	gIPEnÿp
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

120 
_id
 = 0;

122 
	}
}

124 
šlše
 

125 
	gIPEnÿp
::
	$upd©e_cksum
(
şick_
 *

, 
off
) const

127 #ià
HAVE_INDIFFERENT_ALIGNMENT


128 
	`şick_upd©e_š_cksum
(&

->
_sum
, 0, ((
ušt16_t
 *è)[
off
/2]);

130 cÚ¡ 
ušt8_t
 *
u
 = (cÚ¡ ušt8_ˆ*è

;

131 #ià
CLICK_BYTE_ORDER
 =ğ
CLICK_BIG_ENDIAN


132 
	`şick_upd©e_š_cksum
(&

->
_sum
, 0, 
u
[
off
]*256 + u[off+1]);

134 
	`şick_upd©e_š_cksum
(&

->
_sum
, 0, 
u
[
off
] + u[off+1]*256);

137 
	}
}

139 
Pack‘
 *

140 
	gIPEnÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

142 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`push
((
şick_
));

143 ià(!
p
)  0;

145 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
p
->
	`d©a
());

146 
	`memıy
(

, &
_h
, (
şick_
));

147 ià(

->
_Ën
) {

148 

->
_d¡
 = 
p
->
	`d¡__ªno
();

149 
	`upd©e_cksum
(

, 16);

150 
	`upd©e_cksum
(

, 18);

152 
p
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(

->
_d¡
));

153 

->
_Ën
 = 
	`htÚs
(
p
->
	`Ëngth
());

154 

->
_id
 = 
	`htÚs
(
_id
.
	`ãtch_ªd_add
(1));

155 
	`upd©e_cksum
(

, 2);

156 
	`upd©e_cksum
(

, 4);

158 
p
->
	`£t__h—d”
(

, (
şick_
));

160  
p
;

161 
	}
}

163 
SŒšg


164 
	gIPEnÿp
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

166 
IPEnÿp
 *
e
 = 
¡©ic_ÿ¡
<IPEnÿ°*>(
e
);

167 (
šŒ_t
)
thunk
) {

169  
	`IPAdd»ss
(
e
->
_h
.
_¤c
).
	`uÅ¬£
();

171 ià(
e
->
_h
.
_Ën
 == 1)

174  
	`IPAdd»ss
(
e
->
_h
.
_d¡
).
	`uÅ¬£
();

178 
	}
}

181 
	gIPEnÿp
::
	$add_hªdËrs
()

183 
	`add_»ad_hªdËr
("¤c", 
»ad_hªdËr
, 0, 
HªdËr
::
CALM
);

184 
	`add_wr™e_hªdËr
("¤c", 
»cÚfigu»_keywÜd_hªdËr
, "1 SRC");

185 
	`add_»ad_hªdËr
("d¡", 
»ad_hªdËr
, 1, 
HªdËr
::
CALM
);

186 
	`add_wr™e_hªdËr
("d¡", 
»cÚfigu»_keywÜd_hªdËr
, "2 DST");

187 
	}
}

189 
CLICK_ENDDECLS


190 
	$EXPORT_ELEMENT
(
IPEnÿp
)

191 
	`ELEMENT_MT_SAFE
(
IPEnÿp
)

	@ip/ipencap.hh

1 #iâdeà
CLICK_IPENCAP_HH


2 
	#CLICK_IPENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/©omic.hh
>

6 
	~<şickÃt/.h
>

7 
CLICK_DECLS


85 şas 
	cIPEnÿp
 : 
public
 
EËm’t
 {…ublic:

87 
	$IPEnÿp
(è
CLICK_COLD
;

88 ~
	$IPEnÿp
(è
CLICK_COLD
;

90 cÚ¡ *
	$şass_Çme
() const {  "IPEncap"; }

91 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

93 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

94 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

95 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

96 
	$add_hªdËrs
(è
CLICK_COLD
;

98 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

100 
´iv©e
:

102 
şick_
 
_h
;

103 
©omic_ušt32_t
 
_id
;

105 
šlše
 
	$upd©e_cksum
(
şick_
 *, ) const;

106 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

108 
	}
};

110 
	gCLICK_ENDDECLS


	@ip/ipfieldinfo.cc

19 
	~<şick/cÚfig.h
>

20 
	~"f›ldšfo.hh
"

21 
	~<şick/š‹g”s.hh
>

22 
	~<şick/cÚå¬£.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şick/”rÜ.hh
>

25 #ià
CLICK_BSDMODULE


26 
	~<machše/¡d¬g.h
>

28 
	~<¡d¬g.h
>

30 
	gCLICK_DECLS


32 
	#BITFIELD
(
´Ùo
, 
off£t
, 
Ëngth
) \

33 (((
´Ùo
è<< 
IPF›ld
::
PROTO_SHIFT
) \

34 | ((
off£t
è<< 
IPF›ld
::
OFFSET_SHIFT
) \

35 | (((
Ëngth
è- 1è<< 
IPF›ld
::
LENGTH_SHIFT
) \

36 | 
IPF›ld
::
MARKER
)

	)

38 cÚ¡ 
	gSticNameDB
::
EÁry
 
_f›lds
[] = {

39 { "df", 
BITFIELD
(0, 6*8 + 1, 1) },

40 { "dpÜt", 
BITFIELD
(
IP_PROTO_TCP_OR_UDP
, 2*8, 16) },

41 { "dsı", 
BITFIELD
(0, 1*8, 6) },

42 { "d¡", 
BITFIELD
(0, 16*8, 32) },

43 { "eú", 
BITFIELD
(0, 1*8 + 6, 2) },

44 { "äagoff",
BITFIELD
(0, 6*8 + 3, 13) },

45 { "hl", 
BITFIELD
(0, 4, 4) },

46 { "id", 
BITFIELD
(0, 4*8, 16) },

47 { "Ën", 
BITFIELD
(0, 2*8, 16) },

48 { "mf", 
BITFIELD
(0, 6*8 + 2, 1) },

49 { "off", 
BITFIELD
(0, 6*8, 16) },

50 { "´Ùo", 
BITFIELD
(0, 9*8, 8) },

51 { "rf", 
BITFIELD
(0, 6*8, 1) },

52 { "¥Üt", 
BITFIELD
(
IP_PROTO_TCP_OR_UDP
, 0, 16) },

53 { "¤c", 
BITFIELD
(0, 12*8, 32) },

54 { "sum", 
BITFIELD
(0, 10*8, 16) },

55 { "tos", 
BITFIELD
(0, 1*8, 8) },

56 { "‰l", 
BITFIELD
(0, 8*8, 8) },

57 { "v”s", 
BITFIELD
(0, 0, 4) }

60 cÚ¡ 
	gSticNameDB
::
EÁry
 
udp_f›lds
[] = {

61 { "dpÜt", 
BITFIELD
(
IP_PROTO_UDP
, 2*8, 16) },

62 { "Ën", 
BITFIELD
(
IP_PROTO_UDP
, 4*8, 16) },

63 { "¥Üt", 
BITFIELD
(
IP_PROTO_UDP
, 0, 16) },

64 { "sum", 
BITFIELD
(
IP_PROTO_UDP
, 6*8, 16) }

67 cÚ¡ 
	gSticNameDB
::
EÁry
 
tı_f›lds
[] = {

68 { "ack", 
BITFIELD
(
IP_PROTO_TCP
, 13*8+3, 1) },

69 { "ackno", 
BITFIELD
(
IP_PROTO_TCP
, 8*8, 32) },

70 { "dpÜt", 
BITFIELD
(
IP_PROTO_TCP
, 2*8, 16) },

71 { "fš", 
BITFIELD
(
IP_PROTO_TCP
, 13*8+7, 1) },

72 { "æags", 
BITFIELD
(
IP_PROTO_TCP
, 13*8, 8) },

73 { "hl", 
BITFIELD
(
IP_PROTO_TCP
, 12*8, 4) },

74 { "psh", 
BITFIELD
(
IP_PROTO_TCP
, 13*8+4, 1) },

75 { "push", 
BITFIELD
(
IP_PROTO_TCP
, 13*8+4, 1) },

76 { "r¡", 
BITFIELD
(
IP_PROTO_TCP
, 13*8+5, 1) },

77 { "£q", 
BITFIELD
(
IP_PROTO_TCP
, 4*8, 32) },

78 { "£qno", 
BITFIELD
(
IP_PROTO_TCP
, 4*8, 32) },

79 { "¥Üt", 
BITFIELD
(
IP_PROTO_TCP
, 0, 16) },

80 { "sum", 
BITFIELD
(
IP_PROTO_TCP
, 16*8, 16) },

81 { "syn", 
BITFIELD
(
IP_PROTO_TCP
, 13*8+6, 1) },

82 { "urg", 
BITFIELD
(
IP_PROTO_TCP
, 13*8+2, 1) },

83 { "u½", 
BITFIELD
(
IP_PROTO_TCP
, 18*8, 16) },

84 { "wš", 
BITFIELD
(
IP_PROTO_TCP
, 14*8, 16) }

87 cÚ¡ 
	gSticNameDB
::
EÁry
 
icmp_f›lds
[] = {

88 { "code", 
BITFIELD
(
IP_PROTO_ICMP
, 1*8, 8) },

89 { "sum", 
BITFIELD
(
IP_PROTO_ICMP
, 2*8, 16) },

90 { "ty³", 
BITFIELD
(
IP_PROTO_ICMP
, 0*8, 8) }

93 cÚ¡ 
	gSticNameDB
::
EÁry
 
tı_Ü_udp_f›lds
[] = {

94 { "dpÜt", 
BITFIELD
(
IP_PROTO_TCP_OR_UDP
, 2*8, 16) },

95 { "¥Üt", 
BITFIELD
(
IP_PROTO_TCP_OR_UDP
, 0, 16) }

99 
	gIPF›ld
::
	$IPF›ld
(
´Ùo
, 
b™_off£t
, 
b™_Ëngth
)

101 ià(
´Ùo
 >ğ0 &&…rÙØ<ğ
MAX_PROTO
 && 
b™_off£t
 >ğ0 && 
b™_Ëngth
 >= 0) {

102 ià(
b™_off£t
 <ğ
MAX_OFFSET
 && 
b™_Ëngth
 <ğ
MAX_LENGTH
 + 1)

103 
_v®
 = (
´Ùo
 << 
PROTO_SHIFT
è| (
b™_off£t
 << 
OFFSET_SHIFT
è| ((
b™_Ëngth
 - 1è<< 
LENGTH_SHIFT
è| 
MARKER
;

104 ià((
b™_off£t
 & 7è=ğ0 && (
b™_Ëngth
 & 7è=ğ0 && b™_Ëngth <ğ(
MAX_LENGTH
 + 1) << 3)

105 
_v®
 = (
´Ùo
 << 
PROTO_SHIFT
è| 
BYTES
 | ((
b™_off£t
 >> 3è<< 
OFFSET_SHIFT
è| (((
b™_Ëngth
 >> 3è- 1è<< 
LENGTH_SHIFT
è| 
MARKER
;

107 
_v®
 = -1;

109 
_v®
 = -1;

110 
	}
}

112 
NameDB
 *
	gdbs
[5];

115 
	gIPF›ldInfo
::
	$¡©ic_š™Ÿlize
()

117 
dbs
[0] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_IP_FIELDNAME
, 
	`SŒšg
(), 
_f›lds
, (ip_fields) / (ip_fields[0]));

118 
dbs
[1] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_ICMP_FIELDNAME
, 
	`SŒšg
(), 
icmp_f›lds
, (icmp_fields) / (icmp_fields[0]));

119 
dbs
[2] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_TCP_FIELDNAME
, 
	`SŒšg
(), 
tı_f›lds
, (tcp_fields) / (tcp_fields[0]));

120 
dbs
[3] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_UDP_FIELDNAME
, 
	`SŒšg
(), 
udp_f›lds
, (udp_fields) / (udp_fields[0]));

121 
dbs
[4] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_IP_FIELDNAME
 + 
IP_PROTO_TCP_OR_UDP
, 
	`SŒšg
(), 
tı_Ü_udp_f›lds
, (tcp_or_udp_fields) / (tcp_or_udp_fields[0]));

122 
i
 = 0; i < 5; i++)

123 ià(
dbs
[
i
])

124 
NameInfo
::
	`š¡®ldb
(
dbs
[
i
], 0);

125 
	}
}

128 
	gIPF›ldInfo
::
	$¡©ic_ş—nup
()

130 
i
 = 0; i < 5; i++) {

131 
d–‘e
 
dbs
[
i
];

132 
dbs
[
i
] = 0;

134 
	}
}

137 
	$ı_sÿnf
(cÚ¡ *
begš
, cÚ¡ *
’d
, cÚ¡ *
fÜm©
, ...)

139 cÚ¡ *
s
, *
ss
;

140 
boŞ
 
mu¡_¥aû
 = 
çl£
;

141 
ušt32_t
 
d–im™”s
[8];

142 
boŞ
 
know_d–im™”s
 = 
çl£
;

144 
va_li¡
 
v®
;

145 
	`va_¡¬t
(
v®
, 
fÜm©
);

147 
s
 = 
begš
; *
fÜm©
; format++)

148 ià(*
fÜm©
 == ' ') {

149 ià(
mu¡_¥aû
 && 
fÜm©
[1] !ğ'%' && (
s
 =ğ
’d
 || !
	`is¥aû
(() *s)))

150 
kl
;

151 
s
 < 
’d
 && 
	`is¥aû
(() *s))

152 
s
++;

153 
mu¡_¥aû
 = 
çl£
;

154 } ià(*
fÜm©
 == '%') {

155 
fÜm©
++;

156 *
fÜm©
) {

158 
ušt32_t
 *
d
 = 
	`va_¬g
(
v®
, uint32_t *);

159 ià((
ss
 = 
	`ı_š‹g”
(
s
, 
’d
, 0, 
d
)) == s)

160 
kl
;

161 
s
 = 
ss
;

162 
mu¡_¥aû
 = 
çl£
;

166 
ušt32_t
 
Çm‘y³
 = 
	`va_¬g
(
v®
, uint32_t);

167 
EËm’t
 *
–t
 = 
	`va_¬g
(
v®
, Element *);

168 cÚ¡ *
w
 = 
s
;

169 
s
 < 
’d
 && !
	`is¥aû
((è*sè&& (!
know_d–im™”s
 || !(
d–im™”s
[(() *s) >> 5] & (1 << ((() *s) % 32)))))

170 
s
++;

171 
ušt32_t
 *
¡Üe
 = 
	`va_¬g
(
v®
, uint32_t *);

172 ià(
w
 =ğ
s
 || !
NameInfo
::
	`qu”y
(
Çm‘y³
, 
–t
, 
	`SŒšg
(w, s), 
¡Üe
, (*store)))

173 
kl
;

174 
mu¡_¥aû
 = 
çl£
;

178 cÚ¡ *
d–im
 = 
	`va_¬g
(
v®
, const *);

179 ià(!
know_d–im™”s
)

180 
	`mem£t
(
d–im™”s
, 0, (delimiters));

181 ; *
d–im
; delim++)

182 
d–im™”s
[((è*
d–im
) >> 5] |= (1 << ((() *delim) % 32));

183 
know_d–im™”s
 = 
Œue
;

187 ià(
s
 !ğ
’d
 && (
	`i§Êum
(() *s) || *s == '_'))

188 
kl
;

191 
nÜm®
;

194 
nÜm®
:

195 ià(
s
 =ğ
’d
 || * !ğ*
fÜm©
)

196 
kl
;

197 
s
++;

198 
mu¡_¥aû
 = 
Œue
;

201 
	`va_’d
(
v®
);

202  
s
;

204 
kl
:

205 
	`va_’d
(
v®
);

207 
	}
}

209 cÚ¡ * cÚ¡ 
	gı__f›ld_mes§ges
[] = {

216 
	$ı__f›ld_h–³r
(cÚ¡ *
begš
, 
which
, 
E¼ÜHªdËr
 *
”rh
)

218 ià(
”rh
)

219 
”rh
->
	`”rÜ
(
ı__f›ld_mes§ges
[
which
]);

220  
begš
;

221 
	}
}

224 
	gIPF›ld
::
	$·r£
(cÚ¡ *
begš
, cÚ¡ *
’d
, 
´Ùo
, 
IPF›ld
 *
»suÉ
, 
E¼ÜHªdËr
 *
”rh
, 
EËm’t
 *
–t
)

227 
št32_t
 
h—d”
 = -1;

228 cÚ¡ *
ehdr
;

229 ià((
ehdr
 = 
	`ı_sÿnf
(
begš
, 
’d
, "…rÙØ%u", &
h—d”
)))

231 ià((
ehdr
 = 
	`ı_sÿnf
(
begš
, 
’d
, "ip%B")))

232 
h—d”
 = 0;

233 ià((
ehdr
 = 
	`ı_sÿnf
(
begš
, 
’d
, "%N", 
NameInfo
::
T_IP_PROTO
, 
–t
, &
h—d”
)))

235 ià((
h—d”
 = 
´Ùo
) < 0)

236  
	`ı__f›ld_h–³r
(
begš
, 0, 
”rh
);

239 
IPF›ld
 
	`f›ld
(-1);

240 cÚ¡ *
’am
;

241 ià((
’am
 = 
	`ı_sÿnf
(
ehdr
, 
’d
, " %D%N", "/[{&", 
NameInfo
::
T_IP_FIELDNAME
 + 
h—d”
, 
–t
, &
f›ld
)))

244 
’am
 = 
ehdr
;

247 
št32_t
 
off£t
 = -1, 
Ëngth
 = -1;

248 cÚ¡ *
–im
;

249 ià((
–im
 = 
	`ı_sÿnf
(
’am
, 
’d
, " [ %u ]", &
off£t
)))

250 
off£t
 *ğ8, 
Ëngth
 = 8;

251 ià((
–im
 = 
	`ı_sÿnf
(
’am
, 
’d
, " [ %u : %u ]", &
off£t
, &
Ëngth
)))

252 
off£t
 *ğ8, 
Ëngth
 *= 8;

253 ià((
–im
 = 
	`ı_sÿnf
(
’am
, 
’d
, " [ %u - %u ]", &
off£t
, &
Ëngth
)))

254 
off£t
 *ğ8, 
Ëngth
 = (length - offset + 1) * 8;

255 ià((
–im
 = 
	`ı_sÿnf
(
’am
, 
’d
, " { %u }", &
off£t
)))

256 
Ëngth
 = 1;

257 ià((
–im
 = 
	`ı_sÿnf
(
’am
, 
’d
, " { %u : %u }", &
off£t
, &
Ëngth
)))

259 ià((
–im
 = 
	`ı_sÿnf
(
’am
, 
’d
, " { %u - %u }", &
off£t
, &
Ëngth
)))

260 
Ëngth
 =†’gth - 
off£t
 + 1;

261 ià(!
f›ld
.
	`ok
()) {

262 
	`şick_ch©‹r
("%.*s", ()(
’d
 - 
’am
),ƒnam);

263  
	`ı__f›ld_h–³r
(
begš
, 0, 
”rh
);}

265 
–im
 = 
’am
;

266 ià(
off£t
 >ğ0 && 
Ëngth
 <= 0)

267  
	`ı__f›ld_h–³r
(
begš
, 1, 
”rh
);

268 ià(
f›ld
.
	`ok
(è&& (
off£t
 >ğf›ld.
	`b™_Ëngth
(è|| off£ˆ+ 
Ëngth
 > field.bit_length()))

269  
	`ı__f›ld_h–³r
(
begš
, 1, 
”rh
);

270 ià(
f›ld
.
	`ok
(è&& 
off£t
 >= 0)

271 
f›ld
 = 
	`IPF›ld
(f›ld.
	`´Ùo
(), f›ld.
	`b™_off£t
(è+ 
off£t
, 
Ëngth
);

272 ià(
off£t
 >= 0)

273 
f›ld
 = 
	`IPF›ld
(
h—d”
, 
off£t
, 
Ëngth
);

274 ià(!
f›ld
.
	`ok
())

275  
	`ı__f›ld_h–³r
(
begš
, 1, 
”rh
);

278 cÚ¡ *
•fx
, *
emask
;

279 ià((
•fx
 = 
	`ı_sÿnf
(
–im
, 
’d
, " / %u", &
Ëngth
))) {

280 ià(
Ëngth
 > 
f›ld
.
	`b™_Ëngth
())

281  
	`ı__f›ld_h–³r
(
begš
, 2, 
”rh
);

282 
f›ld
 = 
	`IPF›ld
(f›ld.
	`´Ùo
(), f›ld.
	`b™_off£t
(), 
Ëngth
);

284 
•fx
 = 
–im
;

285 ià((
emask
 = 
	`ı_sÿnf
(
•fx
, 
’d
, " & %u", &
Ëngth
))) {

286 
off£t
 = 
	`ffs_lsb
((
ušt32_t
è
Ëngth
) - 1;

287 
msb
 = 
	`ffs_lsb
((
ušt32_t
è
Ëngth
 + (1 << 
off£t
)) - 1;

288 ià(
Ëngth
 =ğ0 || (Ö’gth + (1 << 
off£t
)è& (Ëngth + (1 << off£tè- 1)è!ğ0 || 
msb
 > 
f›ld
.
	`b™_Ëngth
())

289  
	`ı__f›ld_h–³r
(
begš
, 2, 
”rh
);

290 
f›ld
 = 
	`IPF›ld
(f›ld.
	`´Ùo
(), f›ld.
	`b™_off£t
(è+ f›ld.
	`b™_Ëngth
(è- 
msb
, msb - 
off£t
);

292 
emask
 = 
•fx
;

294 *
»suÉ
 = 
f›ld
;

295  
emask
;

296 
	}
}

298 
SŒšg


299 
	gIPF›ld
::
	$uÅ¬£
(
EËm’t
 *
–t
, 
boŞ
 
tıdump_ruËs
)

301 ià(!
	`ok
())

302  
SŒšg
::
	`make_¡abË
("<bad>");

304 
SŒšgAccum
 
§
;

305 
SŒšg
 
s
;

306 
št32_t
 
v®
 = 
	`´Ùo
();

307 ià(
v®
 == 0)

308 
§
 << "ip";

309 ià((
s
 = 
NameInfo
::
	`»vqu”y
(NameInfo::
T_IP_PROTO
, 
–t
, &
v®
, 4)))

310 
§
 << 
s
;

312 
§
 << "…rÙØ" << 
	`´Ùo
();

314 ià((
s
 = 
NameInfo
::
	`»vqu”y
(NameInfo::
T_IP_FIELDNAME
 + 
	`´Ùo
(), 
–t
, &
_v®
, 4))) {

315 
§
 << ' ' << 
s
;

316  
§
.
	`ke_¡ršg
();

319 
bo
 = 
	`b™_off£t
(), 
bl
 = 
	`b™_Ëngth
();

321 
cÚš”
 = 8; cÚš” < 64 && !
tıdump_ruËs
; container *= 2)

322 ià(
bo
 / 
cÚš”
 =ğ(bØ+ 
bl
 - 1) / container) {

323 
IPF›ld
 
	`x
(
	`´Ùo
(), 
bo
 & ~(
cÚš”
 - 1), container);

324 ià((
s
 = 
NameInfo
::
	`»vqu”y
(NameInfo::
T_IP_FIELDNAME
 + 
	`´Ùo
(), 
–t
, &
x
, 4))) {

325 
§
 << ' ' << 
s
;

326 
bo
 &ğ
cÚš”
 - 1;

327 ià(
bo
 == 0) {

328 
§
 << '/' << 
bl
;

329  
§
.
	`ke_¡ršg
();

335 
ušt32_t
 
maskv®
 = 0;

336 ià(
tıdump_ruËs
 && (
bo
 % 8 !ğ0 || 
bl
 % 8 != 0)

337 && 
bl
 / 32 =ğ(
bo
 + bl - 1) / 32) {

338 
maskv®
 = ((1 << 
bl
è- 1è<< (7 - (
bo
 + bl - 1) % 8);

339 
bl
 = (
bo
 % 8 + bl + 7) & ~7;

340 
bo
 &= ~7;

343 ià(
bo
 % 8 =ğ0 && 
bl
 == 8)

344 
§
 << '[' << (
bo
 / 8) << ']';

345 ià(
bo
 % 8 =ğ0 && 
bl
 % 8 == 0)

346 
§
 << '[' << (
bo
 / 8è<< ':' << (
bl
 / 8) << ']';

347 ià(
bl
 == 1)

348 
§
 << '{' << 
bo
 << '}';

350 
§
 << '{' << 
bo
 << ':' << 
bl
 << '}';

351 ià(
maskv®
)

352 
§
 << " & " << 
maskv®
;

353  
§
.
	`ke_¡ršg
();

354 
	}
}

356 
CLICK_ENDDECLS


357 
EXPORT_ELEMENT
(
IPF›ldInfo
)

	@ip/ipfieldinfo.hh

1 #iâdeà
CLICK_IPFIELDINFO_HH


2 
	#CLICK_IPFIELDINFO_HH


	)

3 
	~<şick/Çmešfo.hh
>

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


7 şas 
	cIPF›ld
 { 
	mpublic
:

9 
	$IPF›ld
(è: 
	`_v®
(-1) { }

10 
	$IPF›ld
(
št32_t
 
f
è: 
	$_v®
(
f
è{ 
	}
}

11 
IPF›ld
(
´Ùo
, 
b™_off£t
, 
b™_Ëngth
);

13 
šlše
 
boŞ
 
	$ok
(ècÚ¡ {  
_v®
 >ğ0; 
	}
}

14 
šlše
 
št32_t
 
	$v®ue
(ècÚ¡ {  
_v®
; 
	}
}

16 
šlše
 
	$´Ùo
(ècÚ¡ {  (
_v®
 & 
PROTO_MASK
è>> 
PROTO_SHIFT
; 
	}
}

18 
šlše
 
	$b™_off£t
() const;

19 
šlše
 
	$b™_Ëngth
() const;

21 
šlše
 
	$by‹_off£t
() const;

22 
šlše
 
	$by‹_Ëngth
() const;

25 
PROTO_SHIFT
 = 20,

26 
MAX_PROTO
 = 0x1FF,

27 
PROTO_MASK
 = 
MAX_PROTO
 << 
PROTO_SHIFT
,

29 
OFFSET_SHIFT
 = 6,

30 
MAX_OFFSET
 = 0x1FFF,

31 
OFFSET_MASK
 = 
MAX_OFFSET
 << 
OFFSET_SHIFT
,

33 
LENGTH_SHIFT
 = 0,

34 
MAX_LENGTH
 = 0x3F,

35 
LENGTH_MASK
 = 
MAX_LENGTH
 << 
LENGTH_SHIFT
,

37 
BYTES
 = 0x00080000,

38 
MARKER
 = 0x40000000

39 
	}
};

42 
	gF_IP_TOS
 = (8 << 
OFFSET_SHIFT
è| (7 << 
LENGTH_SHIFT
),

43 
	gF_ICMP_TYPE
 = (
IP_PROTO_ICMP
 << 
PROTO_SHIFT
è| (7 << 
LENGTH_SHIFT
)

46 cÚ¡ *
·r£
(cÚ¡ *
begš
, cÚ¡ *
’d
, 
´Ùo
, 
IPF›ld
 *
»suÉ
, 
E¼ÜHªdËr
 *
”rh
, 
EËm’t
 *
–t
 = 0);

47 
SŒšg
 
uÅ¬£
(
EËm’t
 *
–t
 = 0, 
boŞ
 
tıdump_ruËs
 = 
çl£
);

49 
	g´iv©e
:

51 
št32_t
 
_v®
;

55 şas 
	cIPF›ldInfo
 : 
public
 
EËm’t
 {…ublic:

57 
	$IPF›ldInfo
() { }

59 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "IPF›ldInfo"; 
	}
}

61 
¡©ic_š™Ÿlize
();

62 
¡©ic_ş—nup
();

67 
šlše
 

68 
	gIPF›ld
::
	$b™_off£t
() const

70 
v
 = (
_v®
 & 
OFFSET_MASK
è>> 
OFFSET_SHIFT
;

71  (
_v®
 & 
BYTES
 ? 
v
 << 3 : v);

72 
	}
}

74 
šlše
 

75 
	gIPF›ld
::
	$by‹_off£t
() const

77 
v
 = (
_v®
 & 
OFFSET_MASK
è>> 
OFFSET_SHIFT
;

78  (
_v®
 & 
BYTES
 ? 
v
 : v >> 3);

79 
	}
}

81 
šlše
 

82 
	gIPF›ld
::
	$b™_Ëngth
() const

84 
l
 = ((
_v®
 & 
LENGTH_MASK
è>> 
LENGTH_SHIFT
) + 1;

85  (
_v®
 & 
BYTES
 ? 
l
 << 3 :†);

86 
	}
}

88 
šlše
 

89 
	gIPF›ld
::
	$by‹_Ëngth
() const

91 
l
 = ((
_v®
 & 
LENGTH_MASK
è>> 
LENGTH_SHIFT
) + 1;

92  (
_v®
 & 
BYTES
 ? 
l
 :† >> 3);

93 
	}
}

95 
	gCLICK_ENDDECLS


	@ip/ipfilter.cc

20 
	~<şick/cÚfig.h
>

21 
	~"f‹r.hh
"

22 
	~<şick/glue.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şickÃt/.h
>

27 
	~<şickÃt/tı.h
>

28 
	~<şickÃt/icmp.h
>

29 
	~<şick/š‹g”s.hh
>

30 
	~<şick/‘h”add»ss.hh
>

31 
	~<şick/Çmešfo.hh
>

32 
CLICK_DECLS


34 cÚ¡ 
	gSticNameDB
::
EÁry
 
ty³_’Œ›s
[] = {

35 { "û", 
IPF‹r
::
TYPE_IPCE
 },

36 { "de¡", 
IPF‹r
::
TYPE_SYNTAX
 },

37 { "dsı", 
IPF‹r
::
FIELD_DSCP
 },

38 { "d¡", 
IPF‹r
::
TYPE_SYNTAX
 },

39 { "eù", 
IPF‹r
::
TYPE_IPECT
 },

40 { "‘h”", 
IPF‹r
::
TYPE_SYNTAX
 },

41 { "äag", 
IPF‹r
::
TYPE_IPFRAG
 },

42 { "hl", 
IPF‹r
::
FIELD_HL
 },

43 { "ho¡", 
IPF‹r
::
TYPE_HOST
 },

44 { "id", 
IPF‹r
::
FIELD_ID
 },

45 { "", 
IPF‹r
::
TYPE_SYNTAX
 },

46 { "Ën", 
IPF‹r
::
FIELD_IPLEN
 },

47 { "Ãt", 
IPF‹r
::
TYPE_NET
 },

48 { "nÙ", 
IPF‹r
::
TYPE_SYNTAX
 },

49 { "İt", 
IPF‹r
::
TYPE_TCPOPT
 },

50 { "pÜt", 
IPF‹r
::
TYPE_PORT
 },

51 { "´Ùo", 
IPF‹r
::
TYPE_PROTO
 },

52 { "¤c", 
IPF‹r
::
TYPE_SYNTAX
 },

53 { "tos", 
IPF‹r
::
FIELD_TOS
 },

54 { "‰l", 
IPF‹r
::
FIELD_TTL
 },

55 { "ty³", 
IPF‹r
::
FIELD_ICMP_TYPE
 },

56 { "unäag", 
IPF‹r
::
TYPE_IPUNFRAG
 },

57 { "v”s", 
IPF‹r
::
FIELD_VERSION
 },

58 { "wš", 
IPF‹r
::
FIELD_TCP_WIN
 }

61 cÚ¡ 
	gSticNameDB
::
EÁry
 
tı_İt_’Œ›s
[] = {

62 { "ack", 
TH_ACK
 },

63 { "fš", 
TH_FIN
 },

64 { "psh", 
TH_PUSH
 },

65 { "r¡", 
TH_RST
 },

66 { "syn", 
TH_SYN
 },

67 { "urg", 
TH_URG
 }

70 cÚ¡ 
ušt32_t
 
	gdb2ty³
[] = {

71 
IPF‹r
::
TYPE_PROTO
, IPF‹r::
TYPE_PORT
, IPFilter::TYPE_PORT,

72 
IPF‹r
::
TYPE_TCPOPT
, IPF‹r::
FIELD_ICMP_TYPE


75 
SŒšg


76 
	$uÅ¬£_wÜd
(
ty³
, 
´Ùo
, cÚ¡ 
SŒšg
 &
wÜd
)

78 
SŒšg
 
Š
 = 
IPF‹r
::
Prim™ive
::
	`uÅ¬£_ty³
(0, 
ty³
);

79 
SŒšg
 
Œ
 = 
IPF‹r
::
Prim™ive
::
	`uÅ¬£_Œª¥_´Ùo
(
´Ùo
);

80 ià(
Š
)

81 
Š
 += " ";

82 ià(
Œ
 || (
wÜd
 && 
Š
))

83 
Œ
 += " ";

84  
Š
 + 
Œ
 + 
wÜd
;

85 
	}
}

88 
	gIPF‹r
::
	$lookup
(
SŒšg
 
wÜd
, 
ty³
, 
´Ùo
, 
ušt32_t
 &
d©a
,

89 cÚ¡ 
EËm’t
 *
cÚ‹xt
, 
E¼ÜHªdËr
 *
”rh
)

92 ià(
ty³
 =ğ0 ||y³ =ğ
TYPE_TYPE
)

93 ià(
NameInfo
::
	`qu”y
(NameInfo::
T_IPFILTER_TYPE
, 
cÚ‹xt
, 
wÜd
, &
d©a
, (
ušt32_t
)))

94  (
d©a
 =ğ
TYPE_SYNTAX
 ? -1 : 
TYPE_TYPE
);

97 
gÙ
[5];

98 
št32_t
 
v®
[5];

99 
gÙ
[0] = 
NameInfo
::
	`qu”y
(NameInfo::
T_IP_PROTO
, 
cÚ‹xt
, 
wÜd
, &
v®
[0], (
ušt32_t
));

100 
gÙ
[1] = 
NameInfo
::
	`qu”y
(NameInfo::
T_TCP_PORT
, 
cÚ‹xt
, 
wÜd
, &
v®
[1], (
ušt32_t
));

101 
gÙ
[2] = 
NameInfo
::
	`qu”y
(NameInfo::
T_UDP_PORT
, 
cÚ‹xt
, 
wÜd
, &
v®
[2], (
ušt32_t
));

102 
gÙ
[3] = 
NameInfo
::
	`qu”y
(NameInfo::
T_TCP_OPT
, 
cÚ‹xt
, 
wÜd
, &
v®
[3], (
ušt32_t
));

103 
gÙ
[4] = 
NameInfo
::
	`qu”y
(NameInfo::
T_ICMP_TYPE
, 
cÚ‹xt
, 
wÜd
, &
v®
[4], (
ušt32_t
));

106 ià(!
gÙ
[0] && !got[1] && !got[2] && !got[3] && !got[4])

110 
tgÙ
[5];

111 
tgÙ
[0] = 
gÙ
[0] && (
ty³
 =ğ0 ||y³ =ğ
TYPE_PROTO
);

112 
tgÙ
[1] = 
gÙ
[1] && (
ty³
 =ğ0 ||y³ =ğ
TYPE_PORT
)

113 && (
´Ùo
 =ğ
UNKNOWN
 ||…rÙØ=ğ
IP_PROTO_TCP
 ||…rÙØ=ğ
IP_PROTO_TCP_OR_UDP
);

114 
tgÙ
[2] = 
gÙ
[2] && (
ty³
 =ğ0 ||y³ =ğ
TYPE_PORT
)

115 && (
´Ùo
 =ğ
UNKNOWN
 ||…rÙØ=ğ
IP_PROTO_UDP
 ||…rÙØ=ğ
IP_PROTO_TCP_OR_UDP
);

116 
tgÙ
[3] = 
gÙ
[3] && (
ty³
 =ğ0 ||y³ =ğ
TYPE_TCPOPT
)

117 && (
´Ùo
 =ğ
UNKNOWN
 ||…rÙØ=ğ
IP_PROTO_TCP
 ||…rÙØ=ğ
IP_PROTO_TCP_OR_UDP
);

118 
tgÙ
[4] = 
gÙ
[4] && (
ty³
 =ğ0 ||y³ =ğ
FIELD_ICMP_TYPE
)

119 && (
´Ùo
 =ğ
UNKNOWN
 ||…rÙØ=ğ
IP_PROTO_ICMP
);

122 ià(
tgÙ
[1] &&gÙ[2] && 
v®
[1] == val[2])

123 
tgÙ
[2] = 
çl£
;

126 
ngÙ
 = 
tgÙ
[0] +got[1] +got[2] +got[3] +got[4];

127 ià(
ngÙ
 == 1) {

128 
i
 = 0; i < 5; i++)

129 ià(
tgÙ
[
i
]) {

130 
d©a
 = 
v®
[
i
];

131  
db2ty³
[
i
];

134 
SŒšgAccum
 
§
;

135 
i
 = 0; i < 5; i++)

136 ià(
gÙ
[
i
]) {

137 ià(
§
)

138 
§
 << ", ";

139 
§
 << '\'' << 
	`uÅ¬£_wÜd
(
db2ty³
[
i
], 
´Ùo
, 
wÜd
) << '\'';

141 ià(
”rh
)

142 
”rh
->
	`”rÜ
("%<%s%> i %s;ry %s", 
	`uÅ¬£_wÜd
(
ty³
, 
´Ùo
, 
wÜd
).
	`c_¡r
(), (
ngÙ
 > 1 ? "ambiguous" : "m—nšgËss"), 
§
.c_str());

144 
	}
}

146 
NameDB
 *
	gdbs
[2];

149 
	gIPF‹r
::
	$¡©ic_š™Ÿlize
()

151 
dbs
[0] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_IPFILTER_TYPE
, 
	`SŒšg
(), 
ty³_’Œ›s
, (type_entries) / (type_entries[0]));

152 
dbs
[1] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_TCP_OPT
, 
	`SŒšg
(), 
tı_İt_’Œ›s
, (tcp_opt_entries) / (tcp_opt_entries[0]));

153 
NameInfo
::
	`š¡®ldb
(
dbs
[0], 0);

154 
NameInfo
::
	`š¡®ldb
(
dbs
[1], 0);

155 
	}
}

158 
	gIPF‹r
::
	$¡©ic_ş—nup
()

160 
d–‘e
 
dbs
[0];

161 
d–‘e
 
dbs
[1];

162 
	}
}

165 
	gIPF‹r
::
	$IPF‹r
()

167 
	}
}

169 
IPF‹r
::~
	$IPF‹r
()

171 
	}
}

178 
IPF‹r
::
Prim™ive
::
	$ş—r
()

180 
_ty³
 = 
_¤cd¡
 = 0;

181 
_Œª¥_´Ùo
 = 
UNKNOWN
;

182 
_d©a
 = 0;

183 
_İ
 = 
OP_EQ
;

184 
_İ_Ãg©ed
 = 
çl£
;

185 
	}
}

188 
	gIPF‹r
::
Prim™ive
::
	$£t_ty³
(
x
, 
E¼ÜHªdËr
 *
”rh
)

190 ià(
_ty³
)

191 
”rh
->
	`”rÜ
("type specifiedwice");

192 
_ty³
 = 
x
;

193 
	}
}

196 
	gIPF‹r
::
Prim™ive
::
	$£t_¤cd¡
(
x
, 
E¼ÜHªdËr
 *
”rh
)

198 ià(
_¤cd¡
)

199 
”rh
->
	`”rÜ
("%<src%> or %<dst%> specifiedwice");

200 
_¤cd¡
 = 
x
;

201 
	}
}

204 
	gIPF‹r
::
Prim™ive
::
	$£t_Œª¥_´Ùo
(
x
, 
E¼ÜHªdËr
 *
”rh
)

206 ià(
_Œª¥_´Ùo
 !ğ
UNKNOWN
 && _Œª¥_´ÙØ!ğ
x
)

207 
”rh
->
	`”rÜ
("transport…rotocol specifiedwice");

208 
_Œª¥_´Ùo
 = 
x
;

209 
	}
}

212 
	gIPF‹r
::
Prim™ive
::
	$£t_mask
(
ušt32_t
 
fuÎ_mask
, 
shiá
, ušt32_ˆ
´ovided_mask
, 
E¼ÜHªdËr
 *
”rh
)

214 
ušt32_t
 
d©a
 = 
_u
.
u
;

215 
ušt32_t
 
this_mask
 = (
´ovided_mask
 ?…rovided_mask : 
fuÎ_mask
);

216 ià((
this_mask
 & 
fuÎ_mask
) !=his_mask)

217  
”rh
->
	`”rÜ
("%<%s%>: mask ouˆoà¿nge, bound 0x%X", 
	`uÅ¬£_ty³
().
	`c_¡r
(), 
fuÎ_mask
);

219 ià(
_İ
 =ğ
OP_GT
 || _İ =ğ
OP_LT
) {

221 ià((
_İ
 =ğ
OP_LT
 && (
d©a
 =ğ0 || d©¨> 
this_mask
))

222 || (
_İ
 =ğ
OP_GT
 && 
d©a
 >ğ
this_mask
)) {

223 
boŞ
 
wl_be
 = (
_İ
 =ğ
OP_LT
 && 
d©a
 > 
this_mask
 ? !
_İ_Ãg©ed
 : _op_negated);

224 
”rh
->
	`w¬nšg
("»ÏtiÚ %<% %u%> i ®way % Ôªg0-%u)", 
	`uÅ¬£_İ
().
	`c_¡r
(), 
d©a
, (
wl_be
 ? "Œue" : "çl£"), 
this_mask
);

225 
_u
.
u
 = 
_mask
.u = 0;

226 
_İ_Ãg©ed
 = !
wl_be
;

227 
_İ
 = 
OP_EQ
;

232 ià(
_İ
 =ğ
OP_LT
) {

233 
_u
.
u
--;

234 
_İ_Ãg©ed
 = !_op_negated;

235 
_İ
 = 
OP_GT
;

238 
_u
.
u
 = (_u.u << 
shiá
) | ((1 << shift) - 1);

239 
_mask
.
u
 = (
this_mask
 << 
shiá
) | ((1 << shift) - 1);

244 ià((
_u
.
u
 & 
_mask
.u) != _u.u) {

245 
ušt32_t
 
fuÎ_mask_u
 = (
fuÎ_mask
 << 
shiá
) | ((1 << shift) - 1);

246 
ušt32_t
 
missšg_b™s
 = (
_u
.
u
 & 
_mask
.uè^ (_u.u & 
fuÎ_mask_u
);

247 
ušt32_t
 
add_mask
 = 0xFFFFFFFFU >> 
	`ffs_msb
(
missšg_b™s
);

248 
_u
.
u
 = (_u.u | 
add_mask
è& 
_mask
.u;

253 ià(
d©a
 > 
fuÎ_mask
)

254  
”rh
->
	`”rÜ
("%<%s%>: ouˆoà¿nge, bound %u", 
	`uÅ¬£_ty³
().
	`c_¡r
(), 
fuÎ_mask
);

256 
_u
.
u
 = 
d©a
 << 
shiá
;

257 
_mask
.
u
 = 
this_mask
 << 
shiá
;

259 
	}
}

261 
SŒšg


262 
	gIPF‹r
::
Prim™ive
::
	$uÅ¬£_ty³
(
¤cd¡
, 
ty³
)

264 
SŒšgAccum
 
§
;

266 
¤cd¡
) {

267 
SD_SRC
: 
§
 << "src "; ;

268 
SD_DST
: 
§
 << "dst "; ;

269 
SD_OR
: 
§
 << "src or dst "; ;

270 
SD_AND
: 
§
 << "src‡nd dst "; ;

273 
ty³
) {

274 
TYPE_NONE
: 
§
 << "<none>"; ;

275 
TYPE_HOST
: 
§
 << "ip host"; ;

276 
TYPE_PROTO
: 
§
 << "proto"; ;

277 
TYPE_ETHER
: 
§
 << "ether host"; ;

278 
TYPE_IPFRAG
: 
§
 << "ip frag"; ;

279 
TYPE_PORT
: 
§
 << "port"; ;

280 
TYPE_TCPOPT
: 
§
 << "tcp opt"; ;

281 
TYPE_NET
: 
§
 << "ip‚et"; ;

282 
TYPE_IPUNFRAG
: 
§
 << "ip unfrag"; ;

283 
TYPE_IPECT
: 
§
 << "ipƒct"; ;

284 
TYPE_IPCE
: 
§
 << "ip ce"; ;

286 ià(
ty³
 & 
TYPE_FIELD
) {

287 
ty³
) {

288 
FIELD_IPLEN
: 
§
 << "ip†en"; ;

289 
FIELD_ID
: 
§
 << "ip id"; ;

290 
FIELD_VERSION
: 
§
 << "ip vers"; ;

291 
FIELD_HL
: 
§
 << "ip hl"; ;

292 
FIELD_TOS
: 
§
 << "ipos"; ;

293 
FIELD_DSCP
: 
§
 << "ip dscp"; ;

294 
FIELD_TTL
: 
§
 << "iptl"; ;

295 
FIELD_TCP_WIN
: 
§
 << "tcp win"; ;

296 
FIELD_ICMP_TYPE
: 
§
 << "icmpype"; ;

298 ià(
ty³
 & 
FIELD_PROTO_MASK
)

299 
§
 << 
	`uÅ¬£_Œª¥_´Ùo
((
ty³
 & 
FIELD_PROTO_MASK
è>> 
FIELD_PROTO_SHIFT
);

301 
§
 << "ip";

302 
§
 << "[...]";

306 
§
 << "<unknowÀty³ " << 
ty³
 << ">";

310  
§
.
	`ke_¡ršg
();

311 
	}
}

313 
SŒšg


314 
	gIPF‹r
::
Prim™ive
::
	$uÅ¬£_Œª¥_´Ùo
(
Œª¥_´Ùo
)

316 
Œª¥_´Ùo
) {

317 
UNKNOWN
:  "";

318 
IP_PROTO_ICMP
:  "icmp";

319 
IP_PROTO_IGMP
:  "igmp";

320 
IP_PROTO_IPIP
:  "ipip";

321 
IP_PROTO_TCP
:  "tcp";

322 
IP_PROTO_UDP
:  "udp";

323 
IP_PROTO_TCP_OR_UDP
:  "tcpudp";

324 
IP_PROTO_TRANSP
:  "transp";

325 :  "…rÙØ" + 
	`SŒšg
(
Œª¥_´Ùo
);

327 
	}
}

329 
SŒšg


330 
	gIPF‹r
::
Prim™ive
::
	$uÅ¬£_ty³
() const

332  
	`uÅ¬£_ty³
(
_¤cd¡
, 
_ty³
);

333 
	}
}

335 
SŒšg


336 
	gIPF‹r
::
Prim™ive
::
	$uÅ¬£_İ
() const

338 ià(
_İ
 =ğ
OP_GT
)

339  (
_İ_Ãg©ed
 ? "<=" : ">");

340 ià(
_İ
 =ğ
OP_LT
)

341  (
_İ_Ãg©ed
 ? ">=" : "<");

343  (
_İ_Ãg©ed
 ? "!=" : "=");

344 
	}
}

347 
	gIPF‹r
::
Prim™ive
::
	$sim¶e_Ãg©e
()

349 
	`as£¹
(
	`Ãg©iÚ_is_sim¶e
());

350 
_İ_Ãg©ed
 = !_op_negated;

351 ià(
_ty³
 =ğ
TYPE_PROTO
 && 
_mask
.
u
 == 0xFF)

352 
_Œª¥_´Ùo
 = (
_İ_Ãg©ed
 ? 
UNKNOWN
 : 
_u
.
i
);

353 
	}
}

356 
	gIPF‹r
::
Prim™ive
::
	$ty³_”rÜ
(
E¼ÜHªdËr
 *
”rh
, cÚ¡ *
msg
) const

358  
”rh
->
	`”rÜ
("%<%s%>: %s", 
	`uÅ¬£_ty³
().
	`c_¡r
(), 
msg
);

359 
	}
}

362 
	gIPF‹r
::
Prim™ive
::
	$check
(cÚ¡ 
Prim™ive
 &
´ev_´im
, 
h—d”
,

363 
mask_dt
, cÚ¡ 
Prim™iveD©a
 &
mask
,

364 
E¼ÜHªdËr
 *
”rh
)

366 
Şd_¤cd¡
 = 
_¤cd¡
;

369 ià(
_ty³
 < 0)

373 ià(!
_ty³
) {

375 
»Œy
:

376 
_d©a
) {

378 
TYPE_HOST
:

379 
TYPE_NET
:

380 
TYPE_TCPOPT
:

381 
TYPE_ETHER
:

382 
_ty³
 = 
_d©a
;

383 ià(!
_¤cd¡
)

384 
_¤cd¡
 = 
´ev_´im
._srcdst;

387 
TYPE_PROTO
:

388 
_ty³
 = 
TYPE_PROTO
;

391 
TYPE_PORT
:

392 
_ty³
 = 
TYPE_PORT
;

393 ià(!
_¤cd¡
)

394 
_¤cd¡
 = 
´ev_´im
._srcdst;

395 ià(
_Œª¥_´Ùo
 =ğ
UNKNOWN
)

396 
_Œª¥_´Ùo
 = 
´ev_´im
._transp_proto;

399 
TYPE_INT
:

400 ià(!(
´ev_´im
.
_ty³
 & 
TYPE_FIELD
)

401 && 
´ev_´im
.
_ty³
 !ğ
TYPE_PROTO


402 && 
´ev_´im
.
_ty³
 !ğ
TYPE_PORT
)

403  
”rh
->
	`”rÜ
("specify header field or %<port%>");

404 
_d©a
 = 
´ev_´im
.
_ty³
;

405 
»Œy
;

407 
TYPE_NONE
:

408 ià(
_Œª¥_´Ùo
 !ğ
UNKNOWN
)

409 
_ty³
 = 
TYPE_PROTO
;

411  
”rh
->
	`”rÜ
("partial directive");

415 ià(
_d©a
 & 
TYPE_FIELD
) {

416 
_ty³
 = 
_d©a
;

417 ià((
_ty³
 & 
FIELD_PROTO_MASK
è&& 
_Œª¥_´Ùo
 =ğ
UNKNOWN
)

418 
_Œª¥_´Ùo
 = (
_ty³
 & 
FIELD_PROTO_MASK
è>> 
FIELD_PROTO_SHIFT
;

420  
”rh
->
	`”rÜ
("unknowÀty³ %<%s%>", 
	`uÅ¬£_ty³
(0, 
_d©a
).
	`c_¡r
());

427 ià(
h—d”
 =ğ0 && 
_d©a
 =ğ
TYPE_ETHER
)

428 
h—d”
 = 'e';

429 ià(
h—d”
 == 0)

430 
h—d”
 = 'i';

431 ià(
h—d”
 =ğ'e' && 
_ty³
 =ğ
TYPE_HOST
)

432 
_ty³
 = 
TYPE_ETHER
;

435 
_ty³
) {

437 
TYPE_HOST
:

438 ià(
h—d”
 !ğ'i' || 
_d©a
 !ğ
TYPE_HOST
)

439  
	`ty³_”rÜ
(
”rh
, "address missing");

440 ià(
_İ
 !ğ
OP_EQ
)

441 
İ”©Ü_nÙ_suµÜ‹d
;

442 
_mask
.
u
 = 0xFFFFFFFFU;

443 
£t_ho¡_mask
;

445 
TYPE_NET
:

446 ià(
h—d”
 !ğ'i' || 
_d©a
 !ğ
TYPE_NET
)

447  
	`ty³_”rÜ
(
”rh
, "address missing");

448 ià(
_İ
 !ğ
OP_EQ
)

449 
İ”©Ü_nÙ_suµÜ‹d
;

450 
_ty³
 = 
TYPE_HOST
;

451 
£t_ho¡_mask
:

452 ià(
mask_dt
 && mask_dˆ!ğ
TYPE_INT
 && mask_dˆ!ğ
TYPE_HOST
)

453 
bad_mask
;

454 ià(
mask_dt
)

455 
_mask
.
u
 = 
mask
.u;

458 
TYPE_ETHER
:

459 ià(
h—d”
 !ğ'e' || 
_d©a
 !ğ
TYPE_ETHER
)

460  
	`ty³_”rÜ
(
”rh
, "address missing");

461 ià(
_İ
 !ğ
OP_EQ
)

462 
İ”©Ü_nÙ_suµÜ‹d
;

463 
	`mem£t
(
_mask
.
c
, 0xFF, 6);

464 
	`mem£t
(
_mask
.
c
 + 6, 0, 2);

465 ià(
mask_dt
 && mask_dˆ!ğ
TYPE_ETHER
)

466 
bad_mask
;

467 ià(
mask_dt
)

468 
	`memıy
(
_mask
.
c
, 
mask
.c, 6);

471 
TYPE_PROTO
:

472 ià(
h—d”
 != 'i')

473 
_Úly
;

474 ià(
_d©a
 =ğ
TYPE_INT
 || _d©¨=ğ
TYPE_PROTO
) {

475 ià(
_Œª¥_´Ùo
 !ğ
UNKNOWN
 && _Œª¥_´ÙØ!ğ
_u
.
i
)

476  
	`ty³_”rÜ
(
”rh
, "specifiedwice");

477 
_d©a
 = 
TYPE_NONE
;

479 
_u
.
i
 = 
_Œª¥_´Ùo
;

480 
_Œª¥_´Ùo
 = 
UNKNOWN
;

481 ià(
_d©a
 !ğ
TYPE_NONE
 || 
_u
.
i
 =ğ
UNKNOWN
)

482 
v®ue_missšg
;

483 ià(
_u
.
i
 >= 256) {

484 ià(
_İ
 !ğ
OP_EQ
 || 
mask_dt
)

485  
”rh
->
	`”rÜ
("%<%s%>: o³¿tÜ o¸mask‚Ù suµÜ‹d", 
	`uÅ¬£_Œª¥_´Ùo
(
_u
.
i
).
	`c_¡r
());

486 
_mask
.
u
 = 0xFF;

487 } ià(
mask_dt
 && mask_dˆ!ğ
TYPE_INT
)

488 
bad_mask
;

489 ià(
	`£t_mask
(0xFF, 0, 
mask_dt
 ? 
mask
.
u
 : 0, 
”rh
) < 0)

491 ià(
_İ
 =ğ
OP_EQ
 && 
_mask
.
u
 =ğ0xFF && !
_İ_Ãg©ed
)

492 
_Œª¥_´Ùo
 = 
_u
.
i
;

495 
TYPE_PORT
:

496 ià(
h—d”
 != 'i')

497 
_Úly
;

498 ià(
_d©a
 =ğ
TYPE_INT
)

499 
_d©a
 = 
TYPE_PORT
;

500 ià(
_d©a
 !ğ
TYPE_PORT
)

501 
v®ue_missšg
;

502 ià(
_Œª¥_´Ùo
 =ğ
UNKNOWN
)

503 
_Œª¥_´Ùo
 = 
IP_PROTO_TCP_OR_UDP
;

504 ià(
_Œª¥_´Ùo
 !ğ
IP_PROTO_TCP
 && _Œª¥_´ÙØ!ğ
IP_PROTO_UDP


505 && 
_Œª¥_´Ùo
 !ğ
IP_PROTO_TCP_OR_UDP


506 && 
_Œª¥_´Ùo
 !ğ
IP_PROTO_DCCP
)

507  
”rh
->
	`”rÜ
("%<pÜt%>: bad…rÙocŞ %d", 
_Œª¥_´Ùo
);

508 ià(
mask_dt
 && mask_dˆ!ğ
TYPE_INT
)

509 
bad_mask
;

510 ià(
	`£t_mask
(0xFFFF, 0, 
mask_dt
 ? 
mask
.
u
 : 0, 
”rh
) < 0)

514 
TYPE_TCPOPT
:

515 ià(
h—d”
 != 'i')

516 
_Úly
;

517 ià(
_d©a
 =ğ
TYPE_INT
)

518 
_d©a
 = 
TYPE_TCPOPT
;

519 ià(
_d©a
 !ğ
TYPE_TCPOPT
)

520 
v®ue_missšg
;

521 ià(
_Œª¥_´Ùo
 =ğ
UNKNOWN
)

522 
_Œª¥_´Ùo
 = 
IP_PROTO_TCP
;

523 ià(
_Œª¥_´Ùo
 !ğ
IP_PROTO_TCP
)

524  
”rh
->
	`”rÜ
("%<tı o±%>: bad…rÙocŞ %d", 
_Œª¥_´Ùo
);

525 ià(
_İ
 !ğ
OP_EQ
 || 
_İ_Ãg©ed
 || 
mask_dt
)

526  
	`ty³_”rÜ
(
”rh
, "operator or mask‚ot supported");

527 ià(
_u
.
i
 < 0 || _u.i > 255)

528  
”rh
->
	`”rÜ
("%<tı o±%>: v®u%d ouˆoà¿nge", 
_u
.
i
);

529 
_mask
.
i
 = 
_u
.i;

532 
TYPE_IPECT
:

533 ià(
h—d”
 != 'i')

534 
_Úly
;

535 ià(
_d©a
 !ğ
TYPE_NONE
 && _d©¨!ğ
TYPE_INT
)

536 
v®ue_missšg
;

537 ià(
_d©a
 =ğ
TYPE_NONE
) {

538 
_mask
.
u
 = 
IP_ECNMASK
;

539 
_u
.
u
 = 0;

540 
_İ_Ãg©ed
 = 
Œue
;

541 } ià(
mask_dt
 && mask_dˆ!ğ
TYPE_INT
)

542 
bad_mask
;

543 ià(
	`£t_mask
(0x3, 0, 
mask_dt
 ? 
mask
.
u
 : 0, 
”rh
) < 0)

545 
_ty³
 = 
FIELD_TOS
;

548 
TYPE_IPCE
:

549 ià(
h—d”
 != 'i')

550 
_Úly
;

551 ià(
_d©a
 !ğ
TYPE_NONE
 || 
mask_dt
)

552 
v®ue_nÙ_suµÜ‹d
;

553 
_mask
.
u
 = 
IP_ECNMASK
;

554 
_u
.
u
 = 
IP_ECN_CE
;

555 
_ty³
 = 
FIELD_TOS
;

558 
TYPE_IPFRAG
:

559 ià(
h—d”
 != 'i')

560 
_Úly
;

561 ià(
_d©a
 !ğ
TYPE_NONE
 || 
mask_dt
)

562 
v®ue_nÙ_suµÜ‹d
;

563 
_mask
.
u
 = 1;

566 
TYPE_IPUNFRAG
:

567 ià(
h—d”
 != 'i')

568 
_Úly
;

569 ià(
_d©a
 !ğ
TYPE_NONE
 || 
mask_dt
)

570 
v®ue_nÙ_suµÜ‹d
;

571 
_İ_Ãg©ed
 = 
Œue
;

572 
_mask
.
u
 = 1;

573 
_ty³
 = 
TYPE_IPFRAG
;

577 ià(
_ty³
 & 
TYPE_FIELD
) {

578 ià(
h—d”
 != 'i')

579 
_Úly
;

580 ià(
_d©a
 !ğ
TYPE_INT
 && _d©¨!ğ
_ty³
)

581 
v®ue_missšg
;

582 ià(
mask_dt
 && mask_dˆ!ğ
TYPE_INT
 && mask_dˆ!ğ
_ty³
)

583 
bad_mask
;

584 
nb™s
 = ((
_ty³
 & 
FIELD_LENGTH_MASK
è>> 
FIELD_LENGTH_SHIFT
) + 1;

585 
ušt32_t
 
xmask
 = (
nb™s
 == 32 ? 0xFFFFFFFFU : (1 <<‚bits) - 1);

586 ià(
	`£t_mask
(
xmask
, 0, 
mask_dt
 ? 
mask
.
u
 : 0, 
”rh
) < 0)

591 
v®ue_missšg
:

592  
	`ty³_”rÜ
(
”rh
, "value missing");

593 
bad_mask
:

594  
	`ty³_”rÜ
(
”rh
, "bad mask");

595 
v®ue_nÙ_suµÜ‹d
:

596  
	`ty³_”rÜ
(
”rh
, "value‚ot supported");

597 
İ”©Ü_nÙ_suµÜ‹d
:

598  
	`ty³_”rÜ
(
”rh
, "operator‚ot supported");

599 
_Úly
:

600  
	`ty³_”rÜ
(
”rh
, "ip only");

605 ià(
_ty³
 =ğ
TYPE_HOST
 || _ty³ =ğ
TYPE_PORT
 || _ty³ =ğ
TYPE_ETHER
) {

606 ià(
_¤cd¡
 == 0)

607 
_¤cd¡
 = 
SD_OR
;

608 } ià(
Şd_¤cd¡
)

609 
”rh
->
	`w¬nšg
("%<%s%>: %<¤c%> o¸%<d¡%> ignÜed", 
	`uÅ¬£_ty³
().
	`c_¡r
());

612 
	}
}

615 
add_ex´s_fÜ_´Ùo
(
št32_t
 
´Ùo
, iÁ32_ˆ
mask
, 
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 &
p
, 
VeùÜ
<> &
Œ“
)

617 ià(
	gmask
 =ğ0xFF && 
´Ùo
 =ğ
IP_PROTO_TCP_OR_UDP
) {

618 
p
.
¡¬t_subŒ“
(
Œ“
);

619 
	gp
.
add_š¢
(
Œ“
, 
IPF‹r
::
off£t_Ãt
 + 8, 
htÚl
(
IP_PROTO_TCP
 << 16), htonl(0x00FF0000));

620 
	gp
.
add_š¢
(
Œ“
, 
IPF‹r
::
off£t_Ãt
 + 8, 
htÚl
(
IP_PROTO_UDP
 << 16), htonl(0x00FF0000));

621 
	gp
.
fšish_subŒ“
(
Œ“
, 
CÏssifiÿtiÚ
::
c_Ü
);

622 } ià(
	gmask
 =ğ0xFF && 
´Ùo
 >= 256)

625 
	gp
.
add_š¢
(
Œ“
, 
IPF‹r
::
off£t_Ãt
 + 8, 
htÚl
(
´Ùo
 << 16), htÚl(
mask
 << 16));

629 
	gIPF‹r
::
Prim™ive
::
add_com·risÚ_ex´s
(
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 &
p
, 
VeùÜ
<> &
Œ“
, 
off£t
, 
shiá
, 
boŞ
 
sw­³d
, boŞ 
İ_Ãg©e
) const

631 
as£¹
(
_İ
 =ğ
IPF‹r
::
OP_EQ
 || _İ =ğIPF‹r::
OP_GT
);

633 
ušt32_t
 
	gmask
 = 
_mask
.
u
;

634 
ušt32_t
 
	gu
 = 
_u
.
u
 & 
mask
;

635 ià(
	gsw­³d
) {

636 
	gmask
 = 
Áohl
(
mask
);

637 
	gu
 = 
Áohl
(
u
);

640 ià(
	g_İ
 =ğ
IPF‹r
::
OP_EQ
) {

641 
p
.
add_š¢
(
Œ“
, 
off£t
, 
htÚl
(
u
 << 
shiá
), htÚl(
mask
 << shift));

642 ià(
	g_İ_Ãg©ed
 && 
	gİ_Ãg©e
)

643 
	gp
.
Ãg©e_subŒ“
(
Œ“
, 
Œue
);

661 
	ghigh_b™_»cÜd
 = 0;

662 
	gcouÁ
 = 0;

664 
	gu
 < 
	gmask
) {

665 
	ghigh_b™
 = (
u
 > (
mask
 >> 1));

666 
	gfœ¡_difã»Á_b™
 = 33 - 
ffs_msb
(
high_b™
 ? ~(
u
+1è& 
mask
 : u);

667 
ušt32_t
 
	guµ”_mask
;

668 ià(
	gfœ¡_difã»Á_b™
 == 33)

669 
uµ”_mask
 = 
mask
;

671 
	guµ”_mask
 = 
mask
 & ~((1 << 
fœ¡_difã»Á_b™
) - 1);

672 
ušt32_t
 
	guµ”_u
 = (
high_b™
 ? 0xFFFFFFFF & 
uµ”_mask
 : 0);

674 
	gp
.
¡¬t_subŒ“
(
Œ“
);

675 
	gp
.
add_š¢
(
Œ“
, 
off£t
, 
htÚl
(
uµ”_u
 << 
shiá
), htÚl(
uµ”_mask
 << shift));

676 ià(!
	ghigh_b™
)

677 
	gp
.
Ãg©e_subŒ“
(
Œ“
, 
Œue
);

678 
	ghigh_b™_»cÜd
 = (
high_b™_»cÜd
 << 1è| 
high_b™
;

679 
	gcouÁ
++;

681 
	gmask
 &ğ~
uµ”_mask
;

682 
	gu
 &ğ
mask
;

685 
	gcouÁ
 > 0) {

686 
	gp
.
fšish_subŒ“
(
Œ“
, (
high_b™_»cÜd
 & 1 ? 
CÏssifiÿtiÚ
::
c_ªd
 : CÏssifiÿtiÚ::
c_Ü
));

687 
	ghigh_b™_»cÜd
 >>= 1;

688 
	gcouÁ
--;

691 ià(
	g_İ_Ãg©ed
 && 
	gİ_Ãg©e
)

692 
	gp
.
Ãg©e_subŒ“
(
Œ“
, 
Œue
);

696 
	gIPF‹r
::
Prim™ive
::
compe
(
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 &
p
, 
VeùÜ
<> &
Œ“
) const

698 
	gp
.
¡¬t_subŒ“
(
Œ“
);

701 ià(
	g_Œª¥_´Ùo
 !ğ
UNKNOWN
)

702 
add_ex´s_fÜ_´Ùo
(
_Œª¥_´Ùo
, 0xFF, 
p
, 
Œ“
);

705 ià(
	g_ty³
 =ğ
TYPE_PORT
 || 
_ty³
 =ğ
TYPE_TCPOPT
 || ((_ty³ & 
TYPE_FIELD
è&& (_ty³ & 
FIELD_PROTO_MASK
)))

706 
p
.
add_š¢
(
Œ“
, 
off£t_Ãt
 + 4, 0, 
htÚl
(0x00001FFF));

709 
	g_ty³
) {

711 
	gTYPE_HOST
:

712 
p
.
¡¬t_subŒ“
(
Œ“
);

713 ià(
	g_¤cd¡
 =ğ
SD_SRC
 || 
_¤cd¡
 =ğ
SD_AND
 || _¤cd¡ =ğ
SD_OR
)

714 
add_com·risÚ_ex´s
(
p
, 
Œ“
, 
off£t_Ãt
 + 12, 0, 
Œue
, 
çl£
);

715 ià(
	g_¤cd¡
 =ğ
SD_DST
 || 
_¤cd¡
 =ğ
SD_AND
 || _¤cd¡ =ğ
SD_OR
)

716 
add_com·risÚ_ex´s
(
p
, 
Œ“
, 
off£t_Ãt
 + 16, 0, 
Œue
, 
çl£
);

717 
	gfšish_¤cd¡
:

718 
p
.
fšish_subŒ“
(
Œ“
, (
_¤cd¡
 =ğ
SD_OR
 ? 
CÏssifiÿtiÚ
::
c_Ü
 : CÏssifiÿtiÚ::
c_ªd
));

719 ià(
	g_İ_Ãg©ed
)

720 
	gp
.
Ãg©e_subŒ“
(
Œ“
, 
Œue
);

723 
	gTYPE_ETHER
: {

724 
p
.
¡¬t_subŒ“
(
Œ“
);

725 
Prim™ive
 
cİy
(*
this
);

726 ià(
	g_¤cd¡
 =ğ
SD_SRC
 || 
_¤cd¡
 =ğ
SD_AND
 || _¤cd¡ =ğ
SD_OR
) {

727 
p
.
¡¬t_subŒ“
(
Œ“
);

728 
memıy
(
cİy
.
_u
.
c
, _u.c, 4);

729 
memıy
(
cİy
.
_mask
.
c
, _mask.c, 4);

730 
	gcİy
.
add_com·risÚ_ex´s
(
p
, 
Œ“
, 
off£t_mac
 + 8, 0, 
Œue
, 
çl£
);

731 
	gcİy
.
	g_u
.
	gu
 = 
cİy
.
_mask
.
u
 = 0;

732 
memıy
(
cİy
.
_u
.
c
, _u.c + 4, 2);

733 
memıy
(
cİy
.
_mask
.
c
, _mask.c + 4, 2);

734 
	gcİy
.
add_com·risÚ_ex´s
(
p
, 
Œ“
, 
off£t_mac
 + 12, 0, 
Œue
, 
çl£
);

735 
	gp
.
fšish_subŒ“
(
Œ“
, 
CÏssifiÿtiÚ
::
c_ªd
);

737 ià(
	g_¤cd¡
 =ğ
SD_DST
 || 
_¤cd¡
 =ğ
SD_AND
 || _¤cd¡ =ğ
SD_OR
) {

738 
p
.
¡¬t_subŒ“
(
Œ“
);

739 
	gcİy
.
	g_u
.
	gu
 = 
cİy
.
_mask
.
u
 = 0;

740 
memıy
(
cİy
.
_u
.
c
 + 2, _u.c, 2);

741 
memıy
(
cİy
.
_mask
.
c
 + 2, _mask.c, 2);

742 
	gcİy
.
add_com·risÚ_ex´s
(
p
, 
Œ“
, 
off£t_mac
, 0, 
Œue
, 
çl£
);

743 
memıy
(
cİy
.
_u
.
c
, _u.c + 2, 4);

744 
memıy
(
cİy
.
_mask
.
c
, _mask.c + 2, 4);

745 
	gcİy
.
add_com·risÚ_ex´s
(
p
, 
Œ“
, 
off£t_mac
 + 4, 0, 
Œue
, 
çl£
);

746 
	gp
.
fšish_subŒ“
(
Œ“
, 
CÏssifiÿtiÚ
::
c_ªd
);

748 
	gfšish_¤cd¡
;

751 
	gTYPE_PROTO
:

752 ià(
_Œª¥_´Ùo
 < 256)

753 
add_com·risÚ_ex´s
(
p
, 
Œ“
, 
off£t_Ãt
 + 8, 16, 
çl£
, 
Œue
);

756 
	gTYPE_IPFRAG
:

757 
p
.
add_š¢
(
Œ“
, 
off£t_Ãt
 + 4, 0, 
htÚl
(0x00003FFF));

758 ià(!
	g_İ_Ãg©ed
)

759 
	gp
.
Ãg©e_subŒ“
(
Œ“
, 
Œue
);

762 
	gTYPE_PORT
:

763 
p
.
¡¬t_subŒ“
(
Œ“
);

764 ià(
	g_¤cd¡
 =ğ
SD_SRC
 || 
_¤cd¡
 =ğ
SD_AND
 || _¤cd¡ =ğ
SD_OR
)

765 
add_com·risÚ_ex´s
(
p
, 
Œ“
, 
off£t_Œª¥
, 16, 
çl£
, false);

766 ià(
	g_¤cd¡
 =ğ
SD_DST
 || 
_¤cd¡
 =ğ
SD_AND
 || _¤cd¡ =ğ
SD_OR
)

767 
add_com·risÚ_ex´s
(
p
, 
Œ“
, 
off£t_Œª¥
, 0, 
çl£
, false);

768 
	gfšish_¤cd¡
;

770 
	gTYPE_TCPOPT
:

771 
p
.
add_š¢
(
Œ“
, 
off£t_Œª¥
 + 12, 
htÚl
(
_u
.
u
 << 16), htÚl(
_mask
.u << 16));

775 ià(
_ty³
 & 
TYPE_FIELD
) {

776 
off£t
 = (
_ty³
 & 
FIELD_OFFSET_MASK
è>> 
FIELD_OFFSET_SHIFT
;

777 
	gËngth
 = ((
_ty³
 & 
FIELD_LENGTH_MASK
è>> 
FIELD_LENGTH_SHIFT
) + 1;

778 
	gwÜd_off£t
 = (
off£t
 >> 3è& ~3, 
	gb™_off£t
 = offset & 0x1F;

779 
	gba£_off£t
 = (
_ty³
 & 
FIELD_PROTO_MASK
 ? 
off£t_Œª¥
 : 
off£t_Ãt
);

780 
add_com·risÚ_ex´s
(
p
, 
Œ“
, 
ba£_off£t
 + 
wÜd_off£t
, 32 - (
b™_off£t
 + 
Ëngth
), 
çl£
, 
Œue
);

782 
as£¹
(0);

787 
	gp
.
fšish_subŒ“
(
Œ“
, 
CÏssifiÿtiÚ
::
c_ªd
);

792 
£·¿‹_‹xt
(cÚ¡ 
SŒšg
 &
‹xt
, 
VeùÜ
<SŒšg> &
wÜds
)

794 cÚ¡ * 
	gs
 = 
‹xt
.
d©a
();

795 
	gËn
 = 
‹xt
.
Ëngth
();

796 
	gpos
 = 0;

797 
	gpos
 < 
	gËn
) {

798 
	gpos
 < 
	gËn
 && 
is¥aû
((è
s
[
pos
]))

799 
	gpos
++;

800 
	gs
[
pos
]) {

803 ià(
pos
 < 
Ën
 - 1 && 
s
[pos+1] == s[pos])

804 
two_ch¬
;

805 
	gÚe_ch¬
;

808 ià(
pos
 < 
Ën
 - 1 && 
s
[pos+1] == '=')

809 
two_ch¬
;

810 
	gÚe_ch¬
;

814 
Úe_ch¬
:

815 
wÜds
.
push_back
(
‹xt
.
sub¡ršg
(
pos
, 1));

816 
	gpos
++;

819 
	gtwo_ch¬
:

820 
wÜds
.
push_back
(
‹xt
.
sub¡ršg
(
pos
, 2));

821 
	gpos
 += 2;

825 
fœ¡
 = 
pos
;

826 
	gpos
 < 
	gËn
 && (
i§Êum
((è
s
[
pos
]è|| 
	gs
[pos] == '-' || s[pos] == '.' || s[pos] == '/' || s[pos] == '@' || s[pos] == '_' || s[pos] == ':'))

827 
pos
++;

828 ià(
	gpos
 =ğ
fœ¡
)

829 
pos
++;

830 
	gwÜds
.
push_back
(
‹xt
.
sub¡ršg
(
fœ¡
, 
pos
 - first));

858 
	gIPF‹r
::
P¬£r
::
	$·r£_ex´_™”©ive
(
pos
)

860 
VeùÜ
<
·r£_¡©e
> 
¡k
;

861 
¡k
.
	`push_back
(
	`·r£_¡©e
(
s_ex´0
));

863 
¡k
.
	`size
()) {

864 
·r£_¡©e
 &
ps
 = 
¡k
.
	`back
();

865 
Ãw_¡©e
 = -1;

867 
ps
.
¡©e
) {

868 
s_ex´0
:

869 
_´og
.
	`¡¬t_subŒ“
(
_Œ“
);

870 
ps
.
¡©e
 = 
s_ex´1
;

871 
Ãw_¡©e
 = 
s_Üex´0
;

873 
s_ex´1
:

874 ià(
pos
 >ğ
_wÜds
.
	`size
() || _words[pos] != "?")

875 
fšish_ex´
;

876 ++
pos
;

877 
ps
.
¡©e
 = 
s_ex´2
;

878 
Ãw_¡©e
 = 
s_ex´0
;

880 
s_ex´2
:

881 ià(
pos
 =ğ
ps
.
Ï¡_pos
 ||…o >ğ
_wÜds
.
	`size
() || _words[pos] != ":") {

882 
_”rh
->
	`”rÜ
("missing %<:%> inernaryƒxpression");

883 
fšish_ex´
;

885 ++
pos
;

886 
ps
.
¡©e
 = 
s_ex´1
;

887 
Ãw_¡©e
 = 
s_Üex´0
;

889 
fšish_ex´
:

890 
_´og
.
	`fšish_subŒ“
(
_Œ“
, 
CÏssifiÿtiÚ
::
c_‹º¬y
);

893 
s_Üex´0
:

894 
_´og
.
	`¡¬t_subŒ“
(
_Œ“
);

895 
ps
.
¡©e
 = 
s_Üex´1
;

896 
Ãw_¡©e
 = 
s_‹rm0
;

898 
s_Üex´1
:

899 ià(
pos
 >ğ
_wÜds
.
	`size
() || (_words[pos] != "or" && _words[pos] != "||"))

900 
fšish_Üex´
;

901 ++
pos
;

902 
Ãw_¡©e
 = 
s_‹rm0
;

904 
fšish_Üex´
:

905 
_´og
.
	`fšish_subŒ“
(
_Œ“
, 
CÏssifiÿtiÚ
::
c_Ü
);

908 
s_‹rm0
:

909 
_´og
.
	`¡¬t_subŒ“
(
_Œ“
);

910 
ps
.
¡©e
 = 
s_‹rm1
;

911 
Ãw_¡©e
 = 
s_çùÜ0
;

913 
s_‹rm1
:

914 
s_‹rm2
:

915 ià(
pos
 =ğ
ps
.
Ï¡_pos
) {

916 ià(
ps
.
¡©e
 =ğ
s_‹rm1
)

917 
_”rh
->
	`”rÜ
("missingƒxpression");

918 
fšish_‹rm
;

920 ià(
pos
 < 
_wÜds
.
	`size
() && (_words[pos] == "and" || _words[pos] == "&&")) {

921 
ps
.
¡©e
 = 
s_‹rm1
;

922 ++
pos
;

924 
ps
.
¡©e
 = 
s_‹rm2
;

925 
Ãw_¡©e
 = 
s_çùÜ0
;

927 
fšish_‹rm
:

928 
_´og
.
	`fšish_subŒ“
(
_Œ“
, 
CÏssifiÿtiÚ
::
c_ªd
);

931 
s_çùÜ0
:

932 
s_çùÜ0_Ãg
:

933 ià(
pos
 < 
_wÜds
.
	`size
() && (_words[pos] == "not" || _words[pos] == "!")) {

934 
ps
.
¡©e
 +ğ(
s_çùÜ1
 - 
s_çùÜ0
);

935 
Ãw_¡©e
 = (
ps
.
¡©e
 =ğ
s_çùÜ1
 ? 
s_çùÜ0_Ãg
 : 
s_çùÜ0
);

936 ++
pos
;

937 } ià(
pos
 < 
_wÜds
.
	`size
() && _words[pos] == "(") {

938 
ps
.
¡©e
 +ğ(
s_çùÜ2
 - 
s_çùÜ0
);

939 
Ãw_¡©e
 = 
s_ex´0
;

940 ++
pos
;

942 
pos
 = 
	`·r£_‹¡
Õos, 
ps
.
¡©e
 =ğ
s_çùÜ0_Ãg
);

944 
s_çùÜ1
:

945 
s_çùÜ1_Ãg
:

946 ià(
pos
 =ğ
ps
.
Ï¡_pos
)

947 
_”rh
->
	`”rÜ
("missšgƒx´essiÚ‡á” %<%s%>", 
_wÜds
[
pos
 - 1].
	`c_¡r
());

949 
s_çùÜ2
:

950 
s_çùÜ2_Ãg
:

951 ià(
pos
 =ğ
ps
.
Ï¡_pos
)

952 
_”rh
->
	`”rÜ
("missingƒxpression‡fter %<(%>");

953 ià(
pos
 < 
_wÜds
.
	`size
() && _words[pos] == ")")

954 ++
pos
;

955 ià(
pos
 !ğ
ps
.
Ï¡_pos
)

956 
_”rh
->
	`”rÜ
("missing %<)%>");

957 ià(
ps
.
¡©e
 =ğ
s_çùÜ2_Ãg
)

958 
_´og
.
	`Ãg©e_subŒ“
(
_Œ“
);

962 ià(
Ãw_¡©e
 >= 0) {

963 
ps
.
Ï¡_pos
 = 
pos
;

964 
¡k
.
	`push_back
(
	`·r£_¡©e
(
Ãw_¡©e
));

966 
¡k
.
	`pİ_back
();

969  
pos
;

970 
	}
}

973 
·r£_b¿ck‘s
(
IPF‹r
::
Prim™ive
& 
´im
, cÚ¡ 
VeùÜ
<
SŒšg
>& 
wÜds
, 
pos
,

974 
E¼ÜHªdËr
* 
”rh
)

976 
	gfœ¡_pos
 = 
pos
 + 1;

977 
SŒšg
 
	gcombš©iÚ
;

978 
	gpos
++;…o < 
	gwÜds
.
size
(è&& wÜds[
pos
] != "]";…os++)

979 
	gcombš©iÚ
 +ğ
wÜds
[
pos
];

980 ià(
	gpos
 >ğ
wÜds
.
size
()) {

981 
”rh
->
”rÜ
("missing %<]%>");

982  
	gfœ¡_pos
;

984 
	gpos
++;

987 
	gf›ldpos
, 
	gËn
 = 1;

988 cÚ¡ * 
	gcŞÚ
 = 
fšd
(
combš©iÚ
.
begš
(), combš©iÚ.
’d
(), ':');

989 cÚ¡ * 
	gcomma
 = 
fšd
(
combš©iÚ
.
begš
(), combš©iÚ.
’d
(), ',');

990 ià(
	gcŞÚ
 < 
	gcombš©iÚ
.
’d
() - 1) {

991 ià(
ı_š‹g”
(
combš©iÚ
.
begš
(), 
cŞÚ
, 0, &
f›ldpos
) == colon

992 && 
ı_š‹g”
(
cŞÚ
 + 1, 
combš©iÚ
.
’d
(), 0, &
Ën
) == combination.end())

993 
nÚ_syÁax_”rÜ
;

994 } ià(
	gcomma
 < 
	gcombš©iÚ
.
’d
() - 1) {

995 
	gpos2
;

996 ià(
ı_š‹g”
(
combš©iÚ
.
begš
(), 
comma
, 0, &
f›ldpos
) == comma

997 && 
ı_š‹g”
(
comma
 + 1, 
combš©iÚ
.
’d
(), 0, &
pos2
) == combination.end()) {

998 
Ën
 = 
pos2
 - 
f›ldpos
 + 1;

999 
	gnÚ_syÁax_”rÜ
;

1001 } ià(
IÁArg
().
·r£
(
combš©iÚ
, 
f›ldpos
))

1002 
	gnÚ_syÁax_”rÜ
;

1003 
	g”rh
->
”rÜ
("syntaxƒrror‡fter %<[%>,ƒxpected %<[POS]%> or %<[POS:LEN]%>");

1004  
	gpos
;

1006 
	gnÚ_syÁax_”rÜ
:

1007 
muÉl›r
 = 8;

1008 
	gf›ldpos
 *ğ
muÉl›r
, 
	gËn
 *= multiplier;

1009 ià(
	gËn
 < 1 ||†en > 32)

1010 
	g”rh
->
”rÜ
("LEN in %<[POS:LEN]%> out of„ange, should be between 1‡nd 4");

1011 ià((
	gf›ldpos
 & ~31è!ğ((
f›ldpos
 + 
Ën
 - 1) & ~31))

1012 
”rh
->
”rÜ
("f›ld [%d:%d] dÛ nÙ f™ iÀ¨sšgË wÜd", 
f›ldpos
/
muÉl›r
, 
Ën
/multiplier);

1014 
	gŒª¥
 = 
´im
.
_Œª¥_´Ùo
;

1015 ià(
	gŒª¥
 =ğ
IPF‹r
::
UNKNOWN
)

1016 
Œª¥
 = 0;

1017 
	g´im
.
£t_ty³
(
IPF‹r
::
TYPE_FIELD


1018 | (
Œª¥
 << 
IPF‹r
::
FIELD_PROTO_SHIFT
)

1019 | (
f›ldpos
 << 
IPF‹r
::
FIELD_OFFSET_SHIFT
)

1020 | ((
Ën
 - 1è<< 
IPF‹r
::
FIELD_LENGTH_SHIFT
), 
”rh
);

1022  
	gpos
;

1026 
	gIPF‹r
::
P¬£r
::
	$·r£_‹¡
(
pos
, 
boŞ
 
Ãg©ed
)

1028 ià(
pos
 >ğ
_wÜds
.
	`size
())

1029  
pos
;

1030 
SŒšg
 
fœ¡_wÜd
 = 
_wÜds
[
pos
];

1031 ià(
fœ¡_wÜd
 == ")" || first_word == "||" || first_word == "or"

1032 || 
fœ¡_wÜd
 == "?" || first_word == ":")

1033  
pos
;

1036 ià(
fœ¡_wÜd
 == "true") {

1037 
_´og
.
	`add_š¢
(
_Œ“
, 0, 0, 0);

1038 ià(
Ãg©ed
)

1039 
_´og
.
	`Ãg©e_subŒ“
(
_Œ“
);

1040  
pos
 + 1;

1042 ià(
fœ¡_wÜd
 == "false") {

1043 
_´og
.
	`add_š¢
(
_Œ“
, 0, 0, 0);

1044 ià(!
Ãg©ed
)

1045 
_´og
.
	`Ãg©e_subŒ“
(
_Œ“
);

1046  
pos
 + 1;

1052 
fœ¡_pos
 = 
pos
;

1053 
Prim™ive
 
´im
;

1054 
h—d”
 = 0;

1057 ; 
pos
 < 
_wÜds
.
	`size
();…os++) {

1058 
SŒšg
 
wd
 = 
_wÜds
[
pos
];

1059 
ušt32_t
 
wd©a
;

1060 
wt
 = 
	`lookup
(
wd
, 0, 
UNKNOWN
, 
wd©a
, 
_cÚ‹xt
, 0);

1062 ià(
wt
 >ğ0 && wˆ=ğ
TYPE_TYPE
) {

1063 
´im
.
	`£t_ty³
(
wd©a
, 
_”rh
);

1064 ià((
wd©a
 & 
TYPE_FIELD
è&& (wd©¨& 
FIELD_PROTO_MASK
))

1065 
´im
.
	`£t_Œª¥_´Ùo
((
wd©a
 & 
FIELD_PROTO_MASK
è>> 
FIELD_PROTO_SHIFT
, 
_”rh
);

1067 } ià(
wt
 >ğ0 && wˆ=ğ
TYPE_PROTO
)

1068 
´im
.
	`£t_Œª¥_´Ùo
(
wd©a
, 
_”rh
);

1070 ià(
wt
 != -1)

1073 ià(
wd
 == "src") {

1074 ià(
pos
 < 
_wÜds
.
	`size
() - 2 && (_words[pos+2] == "dst" || _words[pos+2] == "dest")) {

1075 ià(
_wÜds
[
pos
+1] == "and" || _words[pos+1] == "&&") {

1076 
´im
.
	`£t_¤cd¡
(
SD_AND
, 
_”rh
);

1077 
pos
 += 2;

1078 } ià(
_wÜds
[
pos
+1] == "or" || _words[pos+1] == "||") {

1079 
´im
.
	`£t_¤cd¡
(
SD_OR
, 
_”rh
);

1080 
pos
 += 2;

1082 
´im
.
	`£t_¤cd¡
(
SD_SRC
, 
_”rh
);

1084 
´im
.
	`£t_¤cd¡
(
SD_SRC
, 
_”rh
);

1085 } ià(
wd
 == "dst" || wd == "dest")

1086 
´im
.
	`£t_¤cd¡
(
SD_DST
, 
_”rh
);

1088 ià(
wd
 == "ip" || wd == "ether") {

1089 ià(
h—d”
)

1091 
h—d”
 = 
wd
[0];

1093 } ià(
wd
 == "not" || wd == "!")

1094 
Ãg©ed
 = !negated;

1101 ià(
pos
 !ğ
fœ¡_pos
)

1102 
_´ev_´im
.
	`ş—r
();

1103 ià(
_´ev_´im
.
_d©a
 =ğ
TYPE_ETHER
)

1104 
h—d”
 = 'e';

1107 
SŒšg
 
wd
 = (
pos
 >ğ
_wÜds
.
	`size
(è- 1 ? 
	`SŒšg
() : _words[pos]);

1108 ià(
wd
 =ğ"[" && 
pos
 > 
fœ¡_pos
 && 
´im
.
_ty³
 =ğ
TYPE_NONE
) {

1109 
pos
 = 
	`·r£_b¿ck‘s
(
´im
, 
_wÜds
,…os, 
_”rh
);

1110 
wd
 = (
pos
 >ğ
_wÜds
.
	`size
(è- 1 ? 
	`SŒšg
() : _words[pos]);

1114 
mask_dt
 = 0;

1115 
Prim™iveD©a
 
´ovided_mask
;

1116 ià(
wd
 =ğ"&" && 
pos
 < 
_wÜds
.
	`size
() - 1) {

1117 ià(
	`IÁArg
().
	`·r£
(
_wÜds
[
pos
 + 1], 
´ovided_mask
.
u
)) {

1118 
mask_dt
 = 
TYPE_INT
;

1119 
pos
 += 2;

1120 } ià(
h—d”
 !ğ'e' && 
	`IPAdd»ssArg
().
	`·r£
(
_wÜds
[
pos
 + 1], 
´ovided_mask
.
4
, 
_cÚ‹xt
)) {

1121 
mask_dt
 = 
TYPE_HOST
;

1122 
pos
 += 2;

1123 } ià(
h—d”
 !ğ'i' && 
	`Eth”Add»ssArg
().
	`·r£
(
_wÜds
[
pos
 + 1], 
´ovided_mask
.
c
, 
_cÚ‹xt
)) {

1124 
mask_dt
 = 
TYPE_ETHER
;

1125 
pos
 += 2;

1127 ià(
mask_dt
 && mask_dˆ!ğ
TYPE_ETHER
 && !
´ovided_mask
.
u
) {

1128 
_”rh
->
	`”rÜ
("zero mask ignored");

1129 
mask_dt
 = 0;

1131 
wd
 = (
pos
 >ğ
_wÜds
.
	`size
(è- 1 ? 
	`SŒšg
() : _words[pos]);

1135 
pos
++;

1136 ià(
wd
 == "=" || wd == "==")

1138 ià(
wd
 == "!=")

1139 
´im
.
_İ_Ãg©ed
 = 
Œue
;

1140 ià(
wd
 == ">")

1141 
´im
.
_İ
 = 
OP_GT
;

1142 ià(
wd
 == "<")

1143 
´im
.
_İ
 = 
OP_LT
;

1144 ià(
wd
 == ">=") {

1145 
´im
.
_İ
 = 
OP_LT
;

1146 
´im
.
_İ_Ãg©ed
 = 
Œue
;

1147 } ià(
wd
 == "<=") {

1148 
´im
.
_İ
 = 
OP_GT
;

1149 
´im
.
_İ_Ãg©ed
 = 
Œue
;

1151 
pos
--;

1154 ià(
pos
 < 
_wÜds
.
	`size
()) {

1155 
wd
 = 
_wÜds
[
pos
];

1156 
ušt32_t
 
wd©a
;

1157 
wt
 = 
	`lookup
(
wd
, 
´im
.
_ty³
,…rim.
_Œª¥_´Ùo
, 
wd©a
, 
_cÚ‹xt
, 
_”rh
);

1158 
pos
++;

1160 ià(
wt
 == -2)

1162 
´im
.
_ty³
 = -2;

1164 ià(
wt
 !ğ-1 && wˆ!ğ
TYPE_TYPE
) {

1165 
´im
.
_d©a
 = 
wt
;

1166 
´im
.
_u
.
u
 = 
wd©a
;

1168 } ià(
	`IÁArg
().
	`·r£
(
wd
, 
´im
.
_u
.
i
))

1169 
´im
.
_d©a
 = 
TYPE_INT
;

1171 ià(
h—d”
 !ğ'e' && 
	`IPAdd»ssArg
().
	`·r£
(
wd
, 
´im
.
_u
.
4
, 
_cÚ‹xt
)) {

1172 ià(
pos
 < 
_wÜds
.
	`size
() - 1 && _words[pos] == "mask"

1173 && 
	`IPAdd»ssArg
().
	`·r£
(
_wÜds
[
pos
+1], 
´im
.
_mask
.
4
, 
_cÚ‹xt
)) {

1174 
pos
 += 2;

1175 
´im
.
_d©a
 = 
TYPE_NET
;

1176 } ià(
´im
.
_ty³
 =ğ
TYPE_NET
 && 
	`IPP»fixArg
().
	`·r£
(
wd
,…rim.
_u
.
4
,…rim.
_mask
.4, 
_cÚ‹xt
))

1177 
´im
.
_d©a
 = 
TYPE_NET
;

1179 
´im
.
_d©a
 = 
TYPE_HOST
;

1181 } ià(
h—d”
 !ğ'e' && 
	`IPP»fixArg
().
	`·r£
(
wd
, 
´im
.
_u
.
4
,…rim.
_mask
.4, 
_cÚ‹xt
))

1182 
´im
.
_d©a
 = 
TYPE_NET
;

1184 ià(
h—d”
 !ğ'i' && 
	`Eth”Add»ssArg
().
	`·r£
(
wd
, 
´im
.
_u
.
c
, 
_cÚ‹xt
))

1185 
´im
.
_d©a
 = 
TYPE_ETHER
;

1188 ià(
´im
.
_İ
 !ğ
OP_EQ
 ||…rim.
_İ_Ãg©ed
)

1189 
_”rh
->
	`”rÜ
("dªglšg o³¿tÜ‚—¸%<%s%>", 
wd
.
	`c_¡r
());

1190 
pos
--;

1194 ià(
pos
 =ğ
fœ¡_pos
) {

1195 
_”rh
->
	`”rÜ
("em±y”m‚—¸%<%s%>", 
wd
.
	`c_¡r
());

1196  
pos
;

1200 ià(
´im
.
	`check
(
_´ev_´im
, 
h—d”
, 
mask_dt
, 
´ovided_mask
, 
_”rh
) >= 0) {

1201 
´im
.
	`compe
(
_´og
, 
_Œ“
);

1202 ià(
Ãg©ed
)

1203 
_´og
.
	`Ãg©e_subŒ“
(
_Œ“
);

1204 
_´ev_´im
 = 
´im
;

1207  
pos
;

1208 
	}
}

1211 
	gIPF‹r
::
·r£_´og¿m
(
CÏssifiÿtiÚ
::
WÜdwi£
::
Com´es£dProg¿m
 &
z´og
,

1212 cÚ¡ 
VeùÜ
<
SŒšg
> &
cÚf
, 
nouuts
,

1213 cÚ¡ 
EËm’t
 *
cÚ‹xt
, 
E¼ÜHªdËr
 *
”rh
)

1215 
	gVeùÜ
<
	gCÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
> 
´ogs
;

1220 
	g¬gno
 = 0;‡rgnØ< 
	gcÚf
.
size
();‡rgno++) {

1221 
	gVeùÜ
<
	gSŒšg
> 
	gwÜds
;

1222 
£·¿‹_‹xt
(
ı_unquÙe
(
cÚf
[
¬gno
]), 
wÜds
);

1224 ià(
	gwÜds
.
size
() == 0) {

1225 
”rh
->
”rÜ
("em±y…©‹º %d", 
¬gno
);

1229 
P»fixE¼ÜHªdËr
 
û¼h
(
”rh
, "·‰”À" + 
SŒšg
(
¬gno
) + ": ");

1232 
	g¦Ù
 = -
CÏssifiÿtiÚ
::
j_Ãv”
;

1234 
SŒšg
 
	g¦Ùwd
 = 
wÜds
[0];

1235 ià(
	g¦Ùwd
 == "allow") {

1236 
¦Ù
 = 0;

1237 ià(
	gnouuts
 == 0)

1238 
û¼h
.
”rÜ
("%<allow%> is meaningless,ƒlement has zero outputs");

1239 } ià(
	g¦Ùwd
 =ğ"d’y" || 
¦Ùwd
 == "drop")

1241 ià(
IÁArg
().
·r£
(
¦Ùwd
, 
¦Ù
)) {

1242 ià(
	g¦Ù
 < 0 || slÙ >ğ
nouuts
) {

1243 
û¼h
.
”rÜ
("¦Ù %<%d%> ouˆoà¿nge", 
¦Ù
);

1244 
	g¦Ù
 = -
CÏssifiÿtiÚ
::
j_Ãv”
;

1247 
	gû¼h
.
”rÜ
("unknowÀ¦Ù ID %<%s%>", 
¦Ùwd
.
c_¡r
());

1250 
	g´ogs
.
push_back
(
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
());

1251 
	gCÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
& 
´og
 = 
´ogs
.
back
();

1252 
	gVeùÜ
<> 
	gŒ“
 = 
´og
.
š™_subŒ“
();

1253 
	g´og
.
¡¬t_subŒ“
(
Œ“
);

1256 ià(
	gwÜds
.
size
() == 1

1257 || (
wÜds
.
size
() == 2

1258 && (
wÜds
[1] == "-" || words[1] == "any" || words[1] == "all")))

1259 
´og
.
add_š¢
(
Œ“
, 0, 0, 0);

1261 
P¬£r
 
·r£r
(
wÜds
, 
Œ“
, 
´og
, 
cÚ‹xt
, &
û¼h
);

1262 
	gpos
 = 
·r£r
.
·r£_ex´_™”©ive
(1);

1263 ià(
	gpos
 < 
	gwÜds
.
size
())

1264 
	gû¼h
.
”rÜ
("g¬bagaá”ƒx´essiÚ‡ˆ%<%s%>", 
wÜds
[
pos
].
c_¡r
());

1267 
	g´og
.
fšish_subŒ“
(
Œ“
, 
CÏssifiÿtiÚ
::
c_ªd
,

1268 -
¦Ù
, 
CÏssifiÿtiÚ
::
j_çu»
);

1271 cÚ¡ 
	goff£t_m­
[] = { 
off£t_Ãt
 + 8, offset_net + 3 };

1273 
	gm”ge_¡•
 = 1; m”ge_¡• < 
	g´ogs
.
size
(); merge_step *= 2)

1274 
i
 = 0; 
	gi
 + 
	gm”ge_¡•
 < 
	g´ogs
.
size
(); i +ğ2 * 
m”ge_¡•
) {

1275 
´ogs
[
i
].
add_Ü_´og¿m
Õrogs[˜+ 
m”ge_¡•
]);

1276 
	g´ogs
[
i
].
İtimize
(
off£t_m­
, off£t_m­ + 2, 
CÏssifiÿtiÚ
::
off£t_max
);

1279 ià(
	g´ogs
.
em±y
())

1280 
	g´ogs
.
push_back
(
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
());

1281 ià(
	g´ogs
.
size
() == 1)

1282 
´ogs
[0].
İtimize
(
off£t_m­
, off£t_m­ + 2, 
CÏssifiÿtiÚ
::
off£t_max
);

1284 
	g´ogs
[0].
£t_çu»
(
CÏssifiÿtiÚ
::
j_Ãv”
);

1288 
	g´ogs
[0].
bubbË_sÜt_ªd_ex´s
(
off£t_m­
, off£t_m­ + 2, 
CÏssifiÿtiÚ
::
off£t_max
);

1289 
	gz´og
.
compe
(
´ogs
[0], 
PERFORM_BINARY_SEARCH
, 
MIN_BINARY_SEARCH
);

1295 
	gIPF‹r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

1297 
IPF‹rProg¿m
 
	gz´og
;

1298 
·r£_´og¿m
(
z´og
, 
cÚf
, 
nouuts
(), 
this
, 
”rh
);

1299 ià(!
	g”rh
->
Ã¼Üs
()) {

1300 
	g_z´og
 = 
z´og
;

1306 
SŒšg


1307 
	gIPF‹r
::
	$´og¿m_¡ršg
(
EËm’t
 *
e
, *)

1309 
IPF‹r
 *
f
 = 
¡©ic_ÿ¡
<IPF‹¸*>(
e
);

1310  
f
->
_z´og
.
	`uÅ¬£
();

1311 
	}
}

1314 
	gIPF‹r
::
	$add_hªdËrs
()

1316 
	`add_»ad_hªdËr
("´og¿m", 
´og¿m_¡ršg
);

1317 
	}
}

1325 
	gIPF‹r
::
	$Ëngth_checked_m©ch
(cÚ¡ 
IPF‹rProg¿m
 &
z´og
, cÚ¡ 
Pack‘
 *
p
,

1326 
·ck‘_Ëngth
)

1328 cÚ¡ *
Ãth_d©a
 = 
p
->
	`ÃtwÜk_h—d”
();

1329 cÚ¡ *
Œª¥h_d©a
 = 
p
->
	`Œª¥Üt_h—d”
();

1330 cÚ¡ 
ušt32_t
 *
´
 = 
z´og
.
	`begš
();

1331 cÚ¡ 
ušt32_t
 *
µ
;

1332 
ušt32_t
 
d©a
 = 0;

1335 
off
 = (
št16_t
è
´
[0];

1336 ià(
off
 + 4 > 
·ck‘_Ëngth
)

1337 
check_Ëngth
;

1339 
Ëngth_ok
:

1340 ià(
off
 >ğ
off£t_Œª¥
)

1341 
d©a
 = *(cÚ¡ 
ušt32_t
 *)(
Œª¥h_d©a
 + 
off
 - 
off£t_Œª¥
);

1342 ià(
off
 >ğ
off£t_Ãt
)

1343 
d©a
 = *(cÚ¡ 
ušt32_t
 *)(
Ãth_d©a
 + 
off
 - 
off£t_Ãt
);

1345 
d©a
 = *(cÚ¡ 
ušt32_t
 *)(
p
->
	`mac_h—d”
(è- 2 + 
off
);

1346 
d©a
 &ğ
´
[3];

1347 
off
 = 
´
[0] >> 17;

1348 
µ
 = 
´
 + 4;

1349 ià(!
PERFORM_BINARY_SEARCH
 || 
off
 < 
MIN_BINARY_SEARCH
) {

1350 ; 
off
; --off, ++
µ
)

1351 ià(*
µ
 =ğ
d©a
) {

1352 
off
 = 
´
[2];

1353 
gÙ™
;

1356 cÚ¡ 
ušt32_t
 *
px
 = 
µ
 + 
off
;

1357 
µ
 < 
px
) {

1358 cÚ¡ 
ušt32_t
 *
pm
 = 
µ
 + (
px
 -…p) / 2;

1359 ià(*
pm
 =ğ
d©a
) {

1360 
off
 = 
´
[2];

1361 
gÙ™
;

1362 } ià(*
pm
 < 
d©a
)

1363 
µ
 = 
pm
 + 1;

1365 
px
 = 
pm
;

1368 
off
 = 
´
[1];

1369 
gÙ™
:

1370 ià(
off
 <= 0)

1371  -
off
;

1372 
´
 +ğ
off
;

1375 
check_Ëngth
:

1376 ià(
off
 < 
·ck‘_Ëngth
) {

1377 
avaabË
 = 
·ck‘_Ëngth
 - 
off
;

1378 cÚ¡ 
ušt8_t
 *
c
 = (cÚ¡ ušt8_ˆ*è&
´
[3];

1379 ià(!(
c
[3]

1380 || (
c
[2] && 
avaabË
 <= 2)

1381 || (
c
[1] && 
avaabË
 == 1)))

1382 
Ëngth_ok
;

1384 
off
 = 
´
[1 + ((pr[0] & 0x10000) != 0)];

1385 
gÙ™
;

1387 
	}
}

1390 
	gIPF‹r
::
	$push
(, 
Pack‘
 *
p
)

1392 
	`checked_ouut_push
(
	`m©ch
(
_z´og
, 
p
),…);

1393 
	}
}

1395 
CLICK_ENDDECLS


1396 
	$ELEMENT_REQUIRES
(
CÏssifiÿtiÚ
)

1397 
	`EXPORT_ELEMENT
(
IPF‹r
)

	@ip/ipfilter.hh

1 #iâdeà
CLICK_IPFILTER_HH


2 
	#CLICK_IPFILTER_HH


	)

3 
	~"–em’ts/¡ªd¬d/şassifiÿtiÚ.hh
"

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


110 şas 
	cIPF‹r
 : 
public
 
EËm’t
 {…ublic:

112 
	$IPF‹r
(è
CLICK_COLD
;

113 ~
	$IPF‹r
(è
CLICK_COLD
;

115 
	`¡©ic_š™Ÿlize
();

116 
	`¡©ic_ş—nup
();

118 cÚ¡ *
	$şass_Çme
() const {  "IPFilter"; }

119 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

120 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

122 cÚ¡ *
	$æags
(ècÚ¡ {  ""; 
	}
}

123 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

125 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

126 
	$add_hªdËrs
(è
CLICK_COLD
;

128 
	`push
(
pÜt
, 
Pack‘
 *);

130 
CÏssifiÿtiÚ
::
	tWÜdwi£
::
	tCom´es£dProg¿m
 
	tIPF‹rProg¿m
;

131 
	`·r£_´og¿m
(
IPF‹rProg¿m
 &
z´og
,

132 cÚ¡ 
VeùÜ
<
SŒšg
> &
cÚf
, 
nouuts
,

133 cÚ¡ 
EËm’t
 *
cÚ‹xt
, 
E¼ÜHªdËr
 *
”rh
);

134 
šlše
 
	`m©ch
(cÚ¡ 
IPF‹rProg¿m
 &
z´og
, cÚ¡ 
Pack‘
 *
p
);

137 
TYPE_NONE
 = 0,

138 
TYPE_TYPE
 = 1,

139 
TYPE_SYNTAX
 = 2,

140 
TYPE_INT
 = 3,

142 
TYPE_HOST
 = 10,

143 
TYPE_PROTO
 = 11,

144 
TYPE_IPFRAG
 = 12,

145 
TYPE_PORT
 = 13,

146 
TYPE_TCPOPT
 = 14,

147 
TYPE_ETHER
 = 15,

149 
TYPE_NET
 = 30,

150 
TYPE_IPUNFRAG
 = 31,

151 
TYPE_IPECT
 = 32,

152 
TYPE_IPCE
 = 33,

154 
TYPE_FIELD
 = 0x40000000,

160 
FIELD_PROTO_SHIFT
 = 21,

161 
FIELD_PROTO_MASK
 = (0x1FF << 
FIELD_PROTO_SHIFT
),

162 
FIELD_OFFSET_SHIFT
 = 5,

163 
FIELD_OFFSET_MASK
 = (0xFFFF << 
FIELD_OFFSET_SHIFT
),

164 
FIELD_LENGTH_SHIFT
 = 0,

165 
FIELD_LENGTH_MASK
 = (0x1F << 
FIELD_LENGTH_SHIFT
),

166 
FIELD_CSUM
 = (
TYPE_FIELD
 | ((10*8è<< 
FIELD_OFFSET_SHIFT
) | 15),

167 
FIELD_IPLEN
 = (
TYPE_FIELD
 | ((2*8è<< 
FIELD_OFFSET_SHIFT
) | 15),

168 
FIELD_ID
 = (
TYPE_FIELD
 | ((4*8è<< 
FIELD_OFFSET_SHIFT
) | 15),

169 
FIELD_VERSION
 = (
TYPE_FIELD
 | (0 << 
FIELD_OFFSET_SHIFT
) | 3),

170 
FIELD_HL
 = (
TYPE_FIELD
 | (4 << 
FIELD_OFFSET_SHIFT
) | 3),

171 
FIELD_TOS
 = (
TYPE_FIELD
 | ((1*8è<< 
FIELD_OFFSET_SHIFT
) | 7),

172 
FIELD_DSCP
 = (
TYPE_FIELD
 | ((1*8è<< 
FIELD_OFFSET_SHIFT
) | 5),

173 
FIELD_TTL
 = (
TYPE_FIELD
 | ((8*8è<< 
FIELD_OFFSET_SHIFT
) | 7),

174 
FIELD_TCP_WIN
 = (
TYPE_FIELD
 | (
IP_PROTO_TCP
 << 
FIELD_PROTO_SHIFT
è| ((14*8è<< 
FIELD_OFFSET_SHIFT
) | 15),

175 
FIELD_ICMP_TYPE
 = (
TYPE_FIELD
 | (
IP_PROTO_ICMP
 << 
FIELD_PROTO_SHIFT
è| (0 << 
FIELD_OFFSET_SHIFT
) | 7)

176 
	}
};

179 
	gUNKNOWN
 = -1000

183 
	gSD_SRC
 = 1, 
	gSD_DST
 = 2, 
	gSD_AND
 = 3, 
	gSD_OR
 = 4

187 
	gOP_EQ
 = 0, 
	gOP_GT
 = 1, 
	gOP_LT
 = 2

192 
	goff£t_mac
 = 0,

193 
	goff£t_Ãt
 = 256,

194 
	goff£t_Œª¥
 = 512

198 
	gPERFORM_BINARY_SEARCH
 = 1,

199 
	gMIN_BINARY_SEARCH
 = 7

202 
	uPrim™iveD©a
 {

203 
ušt32_t
 
	gu
;

204 
št32_t
 
	gi
;

205 
š_addr
 
	g4
;

206 
	gc
[8];

209 
	sPrim™ive
 {

211 
	g_ty³
;

212 
	g_d©a
;

214 
	g_İ
;

215 
boŞ
 
	g_İ_Ãg©ed
;

217 
	g_¤cd¡
;

218 
	g_Œª¥_´Ùo
;

220 
Prim™iveD©a
 
	g_u
;

221 
Prim™iveD©a
 
	g_mask
;

223 
Prim™ive
(è{ 
ş—r
(); }

225 
ş—r
();

226 
£t_ty³
(, 
E¼ÜHªdËr
 *);

227 
£t_¤cd¡
(, 
E¼ÜHªdËr
 *);

228 
£t_Œª¥_´Ùo
(, 
E¼ÜHªdËr
 *);

230 
£t_mask
(
ušt32_t
 
fuÎ_mask
, 
shiá
, ušt32_ˆ
´ovided_mask
,

231 
E¼ÜHªdËr
 *
”rh
);

232 
check
(cÚ¡ 
Prim™ive
 &
´ev_´im
, 
Ëv–
,

233 
mask_dt
, cÚ¡ 
Prim™iveD©a
 &
mask
,

234 
E¼ÜHªdËr
 *
”rh
);

235 
compe
(
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 &
p
, 
VeùÜ
<> &
Œ“
) const;

237 
boŞ
 
has_Œª¥_´Ùo
() const;

238 
boŞ
 
Ãg©iÚ_is_sim¶e
() const;

239 
sim¶e_Ãg©e
();

241 
SŒšg
 
uÅ¬£_ty³
() const;

242 
SŒšg
 
uÅ¬£_İ
() const;

243 
SŒšg
 
uÅ¬£_ty³
(
¤cd¡
, 
ty³
);

244 
SŒšg
 
uÅ¬£_Œª¥_´Ùo
(
Œª¥_´Ùo
);

246 
	g´iv©e
:

248 
ty³_”rÜ
(
E¼ÜHªdËr
 *
”rh
, cÚ¡ *
msg
) const;

249 
add_com·risÚ_ex´s
(
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 &
p
, 
VeùÜ
<> &
Œ“
, 
off£t
, 
shiá
, 
boŞ
 
sw­³d
, boŞ 
İ_Ãg©e
) const;

253 
	g´Ùeùed
:

255 
IPF‹rProg¿m
 
_z´og
;

257 
	g´iv©e
:

259 
lookup
(
SŒšg
 
wÜd
, 
ty³
, 
Œª¥_´Ùo
, 
ušt32_t
 &
d©a
,

260 cÚ¡ 
EËm’t
 *
cÚ‹xt
, 
E¼ÜHªdËr
 *
”rh
);

262 
	sP¬£r
 {

263 cÚ¡ 
	gVeùÜ
<
	gSŒšg
> &
	g_wÜds
;

264 
	gVeùÜ
<> &
	g_Œ“
;

265 
	gCÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 &
_´og
;

266 cÚ¡ 
EËm’t
 *
	g_cÚ‹xt
;

267 
E¼ÜHªdËr
 *
	g_”rh
;

268 
Prim™ive
 
	g_´ev_´im
;

270 
P¬£r
(cÚ¡ 
VeùÜ
<
SŒšg
> &
wÜds
, VeùÜ<> &
Œ“
,

271 
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 &
´og
,

272 cÚ¡ 
EËm’t
 *
cÚ‹xt
, 
E¼ÜHªdËr
 *
”rh
)

273 : 
_wÜds
(
wÜds
), 
_Œ“
(
Œ“
), 
_´og
(
´og
), 
_cÚ‹xt
(
cÚ‹xt
),

274 
_”rh
(
”rh
) {

277 
	s·r£_¡©e
 {

278 
	g¡©e
;

279 
	gÏ¡_pos
;

280 
·r£_¡©e
(
s
)

281 : 
¡©e
(
s
) {

285 
	gs_ex´0
, 
	gs_ex´1
, 
	gs_ex´2
,

286 
	gs_Üex´0
, 
	gs_Üex´1
,

287 
	gs_‹rm0
, 
	gs_‹rm1
, 
	gs_‹rm2
,

288 
	gs_çùÜ0
, 
	gs_çùÜ1
, 
	gs_çùÜ2
,

289 
	gs_çùÜ0_Ãg
, 
	gs_çùÜ1_Ãg
, 
	gs_çùÜ2_Ãg


291 
·r£_¦Ù
(
ouut
, 
pos
);

292 
·r£_ex´_™”©ive
(
pos
);

293 
·r£_‹¡
(
pos
, 
boŞ
 
Ãg©ed
);

296 
Ëngth_checked_m©ch
(cÚ¡ 
IPF‹rProg¿m
 &
z´og
,

297 cÚ¡ 
Pack‘
 *
p
, 
·ck‘_Ëngth
);

299 
SŒšg
 
´og¿m_¡ršg
(
EËm’t
 *
e
, *
u£r_d©a
);

304 
šlše
 
boŞ


305 
	gIPF‹r
::
Prim™ive
::
	$has_Œª¥_´Ùo
() const

307  
_Œª¥_´Ùo
 >= 0;

308 
	}
}

310 
šlše
 
boŞ


311 
	gIPF‹r
::
Prim™ive
::
	$Ãg©iÚ_is_sim¶e
() const

313 ià(
_ty³
 =ğ
TYPE_PROTO
)

314  
Œue
;

315 ià(
_Œª¥_´Ùo
 >= 0)

316  
çl£
;

318  
_ty³
 =ğ
TYPE_HOST
 || (_ty³ & 
TYPE_FIELD
è|| _ty³ =ğ
TYPE_IPFRAG
;

319 
	}
}

321 
šlše
 

322 
	gIPF‹r
::
	$m©ch
(cÚ¡ 
IPF‹rProg¿m
 &
z´og
, cÚ¡ 
Pack‘
 *
p
)

324 
·ck‘_Ëngth
 = 
p
->
	`ÃtwÜk_Ëngth
(),

325 
ÃtwÜk_h—d”_Ëngth
 = 
p
->
	`ÃtwÜk_h—d”_Ëngth
();

326 ià(
·ck‘_Ëngth
 > 
ÃtwÜk_h—d”_Ëngth
)

327 
·ck‘_Ëngth
 +ğ
off£t_Œª¥
 - 
ÃtwÜk_h—d”_Ëngth
;

329 
·ck‘_Ëngth
 +ğ
off£t_Ãt
;

331 ià(
z´og
.
	`ouut_ev”ythšg
() >= 0)

332  
z´og
.
	`ouut_ev”ythšg
();

333 ià(
·ck‘_Ëngth
 < (è
z´og
.
	`§ã_Ëngth
())

335  
	`Ëngth_checked_m©ch
(
z´og
, 
p
, 
·ck‘_Ëngth
);

337 cÚ¡ *
Ãth_d©a
 = 
p
->
	`ÃtwÜk_h—d”
();

338 cÚ¡ *
Œª¥h_d©a
 = 
p
->
	`Œª¥Üt_h—d”
();

340 cÚ¡ 
ušt32_t
 *
´
 = 
z´og
.
	`begš
();

341 cÚ¡ 
ušt32_t
 *
µ
;

342 
ušt32_t
 
d©a
;

344 
off
 = (
št16_t
è
´
[0];

345 ià(
off
 >ğ
off£t_Œª¥
)

346 
d©a
 = *(cÚ¡ 
ušt32_t
 *)(
Œª¥h_d©a
 + 
off
 - 
off£t_Œª¥
);

347 ià(
off
 >ğ
off£t_Ãt
)

348 
d©a
 = *(cÚ¡ 
ušt32_t
 *)(
Ãth_d©a
 + 
off
 - 
off£t_Ãt
);

350 
d©a
 = *(cÚ¡ 
ušt32_t
 *)(
p
->
	`mac_h—d”
(è- 2 + 
off
);

351 
d©a
 &ğ
´
[3];

352 
off
 = 
´
[0] >> 17;

353 
µ
 = 
´
 + 4;

354 ià(!
PERFORM_BINARY_SEARCH
 || 
off
 < 
MIN_BINARY_SEARCH
) {

355 ; 
off
; --off, ++
µ
)

356 ià(*
µ
 =ğ
d©a
) {

357 
off
 = 
´
[2];

358 
gÙ™
;

361 cÚ¡ 
ušt32_t
 *
px
 = 
µ
 + 
off
;

362 
µ
 < 
px
) {

363 cÚ¡ 
ušt32_t
 *
pm
 = 
µ
 + (
px
 -…p) / 2;

364 ià(*
pm
 =ğ
d©a
) {

365 
off
 = 
´
[2];

366 
gÙ™
;

367 } ià(*
pm
 < 
d©a
)

368 
µ
 = 
pm
 + 1;

370 
px
 = 
pm
;

373 
off
 = 
´
[1];

374 
gÙ™
:

375 ià(
off
 <= 0)

376  -
off
;

377 
´
 +ğ
off
;

379 
	}
}

381 
	gCLICK_ENDDECLS


	@ip/ipfragmenter.cc

20 
	~<şick/cÚfig.h
>

21 
	~"äagm’‹r.hh
"

22 
	~<şickÃt/.h
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/glue.hh
>

26 
CLICK_DECLS


28 
	gIPF¿gm’‹r
::
	$IPF¿gm’‹r
()

29 : 
	`_hÚÜ_df
(
Œue
), 
	`_v”bo£
(
çl£
), 
	$_mtu
(0)

31 
_äagm’ts
 = 0;

32 
_drİs
 = 0;

33 
	}
}

35 
	gIPF¿gm’‹r
::~
	$IPF¿gm’‹r
()

37 
	}
}

41 
IPF¿gm’‹r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

43 
	g_h—droom
 = 
Pack‘
::
deçuÉ_h—droom
;

44 ià(
Args
(
cÚf
, 
this
, 
”rh
)

45 .
»ad_mp
("MTU", 
_mtu
)

46 .
»ad_p
("HONOR_DF", 
_hÚÜ_df
)

47 .
»ad_p
("VERBOSE", 
_v”bo£
)

48 .
»ad
("HEADROOM", 
_h—droom
)

49 .
com¶‘e
() < 0)

51 ià(
	g_mtu
 < 8)

52  
	g”rh
->
”rÜ
("MTU must be‡t†east 8");

57 
	gIPF¿gm’‹r
::
	$İtcİy
(cÚ¡ 
şick_
 *
1
, click_ *
2
)

59 cÚ¡ 
ušt8_t
* 
oš
 = (cÚ¡ ušt8_t*è(
1
 + 1);

60 cÚ¡ 
ušt8_t
* 
oš_’d
 = 
oš
 + (
1
->
_hl
 << 2è- (
şick_
);

61 
ušt8_t
 *
oout
 = (ušt8_ˆ*è(
2
 + 1);

62 
ouos
 = 0;

64 
oš
 < 
oš_’d
)

65 ià(*
oš
 =ğ
IPOPT_NOP
)

66 ++
oš
;

67 ià(*
oš
 =ğ
IPOPT_EOL


68 || 
oš
 + 1 =ğ
oš_’d


69 || 
oš
[1] < 2

70 || 
oš
 + oš[1] > 
oš_’d
)

73 ià(*
oš
 & 0x80) {

74 ià(
2
)

75 
	`memıy
(
oout
 + 
ouos
, 
oš
, oin[1]);

76 
ouos
 +ğ
oš
[1];

78 
oš
 += oin[1];

81 ; (
ouos
 & 3) != 0; outpos++)

82 ià(
2
)

83 
oout
[
ouos
] = 
IPOPT_EOL
;

85  
ouos
;

86 
	}
}

89 
	gIPF¿gm’‹r
::
	$äagm’t
(
Pack‘
 *
p_š
)

91 cÚ¡ 
şick_
 *
_š
 = 
p_š
->
	`_h—d”
();

92 
hËn
 = 
_š
->
_hl
 << 2;

93 
fœ¡_dËn
 = (
_mtu
 - 
hËn
) & ~7;

94 
š_dËn
 = 
	`Áohs
(
_š
->
_Ën
è- 
hËn
;

96 ià(((
_š
->
_off
 & 
	`htÚs
(
IP_DF
)è&& 
_hÚÜ_df
è|| 
fœ¡_dËn
 < 8) {

97 ià(
_v”bo£
 || 
_drİs
 < 5)

98 
	`şick_ch©‹r
("IPF¿gm’‹r(%dèDF %p{_±r} %p{_±r}†’=%d", 
_mtu
, &
_š
->
_¤c
, &_š->
_d¡
, 
p_š
->
	`Ëngth
());

99 
_drİs
++;

100 
	`checked_ouut_push
(1, 
p_š
);

105 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

106 ià(!
p
)

108 
şick_
 *

 = 
p
->
	`_h—d”
();

112 ià(

->
_off
 & 
	`htÚs
(
IP_DF
)) {

113 

->
_id
 = 
	`şick_¿ndom
();

114 

->
_off
 &ğ~
	`htÚs
(
IP_DF
);

116 
boŞ
 
had_mf
 = (

->
_off
 & 
	`htÚs
(
IP_MF
)) != 0;

117 

->
_Ën
 = 
	`htÚs
(
hËn
 + 
fœ¡_dËn
);

118 

->
_off
 |ğ
	`htÚs
(
IP_MF
);

119 

->
_sum
 = 0;

120 

->
_sum
 = 
	`şick_š_cksum
((cÚ¡ *), 
hËn
);

121 
Pack‘
 *
fœ¡_äagm’t
 = 
p
->
	`şÚe
();

122 
fœ¡_äagm’t
->
	`ke
(
p
->
	`Ëngth
(è-…->
	`ÃtwÜk_h—d”_off£t
(è- 
hËn
 - 
fœ¡_dËn
);

123 
	`ouut
(0).
	`push
(
fœ¡_äagm’t
);

124 
_äagm’ts
++;

127 
out_hËn
 = (
şick_
è+ 
	`İtcİy
(

, 0);

129 
off
 = 
fœ¡_dËn
; ofà< 
š_dËn
; ) {

131 
out_dËn
 = (
_mtu
 - 
out_hËn
) & ~7;

132 ià(
out_dËn
 + 
off
 > 
š_dËn
)

133 
out_dËn
 = 
š_dËn
 - 
off
;

135 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(
_h—droom
, 0, 
out_hËn
 + 
out_dËn
, 0);

136 ià(
q
) {

137 
q
->
	`£t_ÃtwÜk_h—d”
(q->
	`d©a
(), 
out_hËn
);

138 
şick_
 *
q
 = 
q
->
	`_h—d”
();

140 
	`memıy
(
q
, 

, (
şick_
));

141 
	`İtcİy
(

, 
q
);

142 
	`memıy
(
q
->
	`Œª¥Üt_h—d”
(), 
p
->Œª¥Üt_h—d”(è+ 
off
, 
out_dËn
);

144 
q
->
_hl
 = 
out_hËn
 >> 2;

145 
q
->
_off
 = 
	`htÚs
(
	`Áohs
(

->_offè+ (
off
 >> 3));

146 ià(
out_dËn
 + 
off
 >ğ
š_dËn
 && !
had_mf
)

147 
q
->
_off
 &ğ~
	`htÚs
(
IP_MF
);

148 
q
->
_Ën
 = 
	`htÚs
(
out_hËn
 + 
out_dËn
);

149 
q
->
_sum
 = 0;

150 
q
->
_sum
 = 
	`şick_š_cksum
((cÚ¡ *)q, 
out_hËn
);

152 
q
->
	`cİy_ªnÙ©iÚs
(
p
);

154 
	`ouut
(0).
	`push
(
q
);

155 
_äagm’ts
++;

158 
off
 +ğ
out_dËn
;

161 
p
->
	`kl
();

162 
	}
}

165 
	gIPF¿gm’‹r
::
	$push
(, 
Pack‘
 *
p
)

167 ià(
p
->
	`ÃtwÜk_Ëngth
(è<ğ(è
_mtu
)

168 
	`ouut
(0).
	`push
(
p
);

170 
	`äagm’t
(
p
);

171 
	}
}

174 
	gIPF¿gm’‹r
::
	$add_hªdËrs
()

176 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

177 
	`add_d©a_hªdËrs
("äagm’ts", 
HªdËr
::
OP_READ
, &
_äagm’ts
);

178 
	}
}

180 
CLICK_ENDDECLS


181 
	$EXPORT_ELEMENT
(
IPF¿gm’‹r
)

182 
	`ELEMENT_MT_SAFE
(
IPF¿gm’‹r
)

	@ip/ipfragmenter.hh

1 #iâdeà
CLICK_IPFRAGMENTER_HH


2 
	#CLICK_IPFRAGMENTER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/©omic.hh
>

6 
CLICK_DECLS


58 şas 
	cIPF¿gm’‹r
 : 
public
 
EËm’t
 {…ublic:

60 
	$IPF¿gm’‹r
(è
CLICK_COLD
;

61 ~
	$IPF¿gm’‹r
(è
CLICK_COLD
;

63 cÚ¡ *
	$şass_Çme
() const {  "IPFragmenter"; }

64 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

65 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

66 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

68 
ušt32_t
 
	$drİs
(ècÚ¡ {  
_drİs
; 
	}
}

69 
ušt32_t
 
	$äagm’ts
(ècÚ¡ {  
_äagm’ts
; 
	}
}

71 
	$add_hªdËrs
(è
CLICK_COLD
;

73 
	`push
(, 
Pack‘
 *);

75 
´iv©e
:

77 
boŞ
 
_hÚÜ_df
;

78 
boŞ
 
_v”bo£
;

79 
_mtu
;

80 
_h—droom
;

81 
©omic_ušt32_t
 
_drİs
;

82 
©omic_ušt32_t
 
_äagm’ts
;

84 
	`äagm’t
(
Pack‘
 *);

85 
	`İtcİy
(cÚ¡ 
şick_
 *
1
, click_ *
2
);

87 
	}
};

89 
	gCLICK_ENDDECLS


	@ip/ipgwoptions.cc

20 
	~<şick/cÚfig.h
>

21 
	~"gwİtiÚs.hh
"

22 
	~<şickÃt/.h
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/glue.hh
>

26 
	~<şick/·ck‘_ªno.hh
>

27 
CLICK_DECLS


29 
	gIPGWO±iÚs
::
	$IPGWO±iÚs
()

31 
_drİs
 = 0;

32 
	}
}

34 
	gIPGWO±iÚs
::~
	$IPGWO±iÚs
()

36 
	}
}

39 
IPGWO±iÚs
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41 ià(
Args
(
cÚf
, 
this
, 
”rh
)

42 .
»ad_mp
("MYADDR", 
_´eã¼ed_addr
)

43 .
»ad_p
("OTHERADDRS", 
_my_addrs
)

44 .
com¶‘e
() < 0)

46 
	g_my_addrs
.
push_back
(
_´eã¼ed_addr
);

50 
Pack‘
 *

51 
	gIPGWO±iÚs
::
	$hªdË_İtiÚs
(
Pack‘
 *
p
)

53 
Wr™abËPack‘
 *
wp
 = 0;

54 cÚ¡ 
ušt8_t
 *
ß
 = 
p
->
	`ÃtwÜk_h—d”
();

55 
hËn
 = 
p
->
	`ÃtwÜk_h—d”_Ëngth
();

57 
oi
;

58 
oi
 = (
şick_
); o˜< 
hËn
; ) {

60 
ty³
 = 
ß
[
oi
];

61 ià(
ty³
 =ğ
IPOPT_NOP
) {

62 
oi
++;

64 } ià(
ty³
 =ğ
IPOPT_EOL
)

69 
xËn
 = 
ß
[
oi
 + 1];

70 ià(
xËn
 < 2 || 
oi
 + xËÀ> 
hËn
) {

72 
oi
++;

73 
£nd_”rÜ
;

74 } ià(
ty³
 !ğ
IPOPT_RR
 &&y³ !ğ
IPOPT_TS
) {

76 
oi
 +ğ
xËn
;

81 ià(!
wp
) {

82 ià(!(
wp
 = 
p
->
	`uniqueify
()))

84 
ß
 = 
wp
->
	`ÃtwÜk_h—d”
();

86 
ušt8_t
 *
wß
 = 
wp
->
	`ÃtwÜk_h—d”
();

88 if(
ty³
 =ğ
IPOPT_RR
){

93 
p
 = 
ß
[
oi
+2] - 1;

94 ià(
p
 >ğ3 &&… + 4 <ğ
xËn
) {

95 
	`memıy
(
wß
 + 
oi
 + 
p
, &
_´eã¼ed_addr
, 4);

96 
wß
[
oi
+2] += 4;

97 } ià(
p
 !ğ
xËn
) {

98 
oi
 += 2;

99 
£nd_”rÜ
;

101 } if(
ty³
 =ğ
IPOPT_TS
){

107 
p
 = 
ß
[
oi
+2] - 1;

108 
oæw
 = 
ß
[
oi
+3] >> 4;

109 
æg
 = 
ß
[
oi
+3] & 0xf;

110 
boŞ
 
ov”æowed
 = 0;

112 
Time¡amp
 
now
 = Time¡amp::
	`now
();

113 
ms
 = 
	`htÚl
((
now
.
	`£c
(è% 86400)*1000 +‚ow.
	`m£c
());

115 if(
p
 < 4){

116 
oi
 += 2;

117 
£nd_”rÜ
;

118 } if(
æg
 == 0){

120 if(
p
+4 <ğ
xËn
){

121 
	`memıy
(
wß
 + 
oi
 + 
p
, &
ms
, 4);

122 
wß
[
oi
+2] += 4;

124 
ov”æowed
 = 1;

125 } if(
æg
 == 1){

127 if(
p
+8 <ğ
xËn
){

128 
	`memıy
(
wß
 + 
oi
 + 
p
, &
_´eã¼ed_addr
, 4);

129 
	`memıy
(
wß
 + 
oi
 + 
p
 + 4, &
ms
, 4);

130 
wß
[
oi
+2] += 8;

132 
ov”æowed
 = 1;

133 } ià(
æg
 =ğ3 && 
p
 + 8 <ğ
xËn
) {

134 
addr
;

135 
	`memıy
(&
addr
, 
ß
 + 
oi
 + 
p
, 4);

137 ià(
	`fšd
(
_my_addrs
.
	`begš
(), _my_addrs.
	`’d
(), 
	`IPAdd»ss
(
addr
)) < _my_addrs.end()) {

138 
	`memıy
(
wß
 + 
oi
 + 
p
 + 4, &
ms
, 4);

139 
wß
[
oi
+2] += 8;

142 
oi
 += 3;

143 
£nd_”rÜ
;

145 ià(
ov”æowed
) {

146 ià(
oæw
 < 15)

147 
wß
[
oi
+3] = ((
oæw
 + 1è<< 4è| 
æg
;

149 
oi
 += 3;

150 
£nd_”rÜ
;

155 
oi
 +ğ
xËn
;

158 ià(
wp
) {

159 
şick_
 *
h
 = 
wp
->
	`_h—d”
();

160 
h
->
_sum
 = 0;

161 
h
->
_sum
 = 
	`şick_š_cksum
(
p
->
	`ÃtwÜk_h—d”
(), 
hËn
);

164  (
wp
 ? w°: 
p
);

166 
£nd_”rÜ
:

167 
_drİs
++;

168 
	`SET_ICMP_PARAMPROB_ANNO
(
p
, 
oi
);

169 
	`checked_ouut_push
(1, 
p
);

171 
	}
}

173 
Pack‘
 *

174 
	gIPGWO±iÚs
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

176 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

177 cÚ¡ 
şick_
 *

 = 
p
->
	`_h—d”
();

178 
hËn
 = 

->
_hl
 << 2;

179 ià(
hËn
 <ğ(
şick_
è|| (
p
 = 
	`hªdË_İtiÚs
(p)))

180 (
p
);

182 
	}
}

185 
	gIPGWO±iÚs
::
	$add_hªdËrs
()

187 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

188 
	}
}

190 
CLICK_ENDDECLS


191 
	$EXPORT_ELEMENT
(
IPGWO±iÚs
)

192 
	`ELEMENT_MT_SAFE
(
IPGWO±iÚs
)

	@ip/ipgwoptions.hh

1 #iâdeà
CLICK_IPGWOPTIONS_HH


2 
	#CLICK_IPGWOPTIONS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/©omic.hh
>

6 
CLICK_DECLS


36 şas 
	cIPGWO±iÚs
 : 
public
 
EËm’t
 {…ublic:

38 
	$IPGWO±iÚs
(è
CLICK_COLD
;

39 ~
	$IPGWO±iÚs
(è
CLICK_COLD
;

41 cÚ¡ *
	$şass_Çme
() const {  "IPGWOptions"; }

42 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

43 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

44 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

45 
	$add_hªdËrs
(è
CLICK_COLD
;

47 
ušt32_t
 
	$drİs
(ècÚ¡ {  
_drİs
; 
	}
}

49 
Pack‘
 *
hªdË_İtiÚs
(Packet *);

50 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

52 
	g´iv©e
:

54 
©omic_ušt32_t
 
_drİs
;

55 
š_addr
 
	g_´eã¼ed_addr
;

56 
	gVeùÜ
<
	gIPAdd»ss
> 
	g_my_addrs
;

60 
	gCLICK_ENDDECLS


	@ip/ipinputcombo.cc

18 
	~<şick/cÚfig.h
>

19 
	~"šputcombo.hh
"

20 
	~<şickÃt/.h
>

21 
	~<şick/glue.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

26 
	~"–em’ts//checkh—d”.hh
"

27 
CLICK_DECLS


29 
	gIPIÅutCombo
::
	$IPIÅutCombo
()

31 
_drİs
 = 0;

32 
	}
}

34 
	gIPIÅutCombo
::~
	$IPIÅutCombo
()

36 
	}
}

39 
IPIÅutCombo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41 ià(
Args
(
cÚf
, 
this
, 
”rh
)

42 .
»ad_mp
("COLOR", 
_cŞÜ
)

43 .
»ad_p
("BADSRC*", 
CheckIPH—d”
::
OldBadSrcArg
(), 
_bad_¤c
)

44 .
»ad
("INTERFACES", 
CheckIPH—d”
::
IÁ”çûsArg
(), 
_bad_¤c
, 
_good_d¡
)

45 .
»ad
("BADSRC", 
_bad_¤c
)

46 .
»ad
("GOODDST", 
_good_d¡
)

47 .
com¶‘e
() < 0)

50 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


53 
	gªs
, 
	gc
, 
	go
;

54 
	gªs
 = 
Alignm’tInfo
::
qu”y
(
this
, 0, 
c
, 
o
);

55 
	g_®igÃd
 = (
ªs
 && 
c
 =ğ4 && 
o
 == 2);

56 ià(!
	g_®igÃd
)

57 
	g”rh
->
w¬nšg
("IP header unaligned, cannot use fast IP checksum");

58 ià(!
	gªs
)

59 
	g”rh
->
mes§ge
("(Try…assinghe configurationhrough `click-align'.)");

66 
šlše
 
Pack‘
 *

67 
	gIPIÅutCombo
::
	$smaùiÚ
(
Pack‘
 *
p
)

71 
	`SET_PAINT_ANNO
(
p
, 
_cŞÜ
);

74 
p
->
	`puÎ
(14);

77 cÚ¡ 
şick_
 *

 = 
»š‹½»t_ÿ¡
<cÚ¡ click_ *>(
p
->
	`d©a
());

78 
hËn
, 
Ën
;

80 if(
p
->
	`Ëngth
(è< (
şick_
))

81 
bad
;

83 if(

->
_v
 != 4)

84 
bad
;

86 
hËn
 = 

->
_hl
 << 2;

87 ià(
hËn
 < (
şick_
))

88 
bad
;

90 
Ën
 = 
	`Áohs
(

->
_Ën
);

91 ià(
Ën
 > 
p
->
	`Ëngth
(è||†’ < 
hËn
)

92 
bad
;

94 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


95 ià(
_®igÃd
) {

96 ià(
	`_ç¡_csum
((*)

, ip->
_hl
) != 0)

97 
bad
;

99 ià(
	`şick_š_cksum
((*)

, 
hËn
) != 0)

100 
bad
;

102 #–ià
HAVE_FAST_CHECKSUM


103 ià(
	`_ç¡_csum
((*)

, ip->
_hl
) != 0)

104 
bad
;

106 ià(
	`şick_š_cksum
((*)

, 
hËn
) != 0)

107 
bad
;

115 ià(
	`fšd
(
_bad_¤c
.
	`begš
(), _bad_¤c.
	`’d
(), 
	`IPAdd»ss
(

->
_¤c
)) < _bad_src.end()

116 && 
	`fšd
(
_good_d¡
.
	`begš
(), _good_d¡.
	`’d
(), 
	`IPAdd»ss
(

->
_d¡
)) == _good_dst.end())

117 
bad
;

124 
p
->
	`£t__h—d”
(

, 
hËn
);

127 ià(
p
->
	`Ëngth
(è> 
Ën
)

128 
p
->
	`ke
Õ->
	`Ëngth
(è- 
Ën
);

131 
p
->
	`£t_d¡__ªno
(

->
_d¡
);

133 (
p
);

135 
bad
:

136 if(
_drİs
 == 0)

137 
	`şick_ch©‹r
("IP checksum failed");

138 
p
->
	`kl
();

139 
_drİs
++;

141 
	}
}

144 
	gIPIÅutCombo
::
	$push
(, 
Pack‘
 *
p
)

146 if((
p
 = 
	`smaùiÚ
(p)) != 0)

147 
	`ouut
(0).
	`push
(
p
);

148 
	}
}

150 
Pack‘
 *

151 
	gIPIÅutCombo
::
	$puÎ
()

153 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

154 if(
p
)

155 
p
 = 
	`smaùiÚ
(p);

156 (
p
);

157 
	}
}

160 
	gIPIÅutCombo
::
	$add_hªdËrs
()

162 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

163 
	}
}

165 
CLICK_ENDDECLS


166 
	$ELEMENT_REQUIRES
(
CheckIPH—d”
)

167 
	$EXPORT_ELEMENT
(
IPIÅutCombo
)

168 
	`ELEMENT_MT_SAFE
(
IPIÅutCombo
)

	@ip/ipinputcombo.hh

1 #iâdeà
CLICK_IPINPUTCOMBO_HH


2 
	#CLICK_IPINPUTCOMBO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/©omic.hh
>

5 
CLICK_DECLS


35 şas 
	cIPIÅutCombo
 : 
public
 
EËm’t
 {

37 
©omic_ušt32_t
 
_drİs
;

38 
	m_cŞÜ
;

40 
	mVeùÜ
<
	mIPAdd»ss
> 
	m_bad_¤c
;

41 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


42 
boŞ
 
	m_®igÃd
;

44 
	mVeùÜ
<
	mIPAdd»ss
> 
	m_good_d¡
;

46 
	mpublic
:

48 
	$IPIÅutCombo
(è
CLICK_COLD
;

49 ~
	$IPIÅutCombo
(è
CLICK_COLD
;

51 cÚ¡ *
	$şass_Çme
() const {  "IPInputCombo"; }

52 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

53 cÚ¡ *
	$æags
(ècÚ¡ {  "A"; 
	}
}

55 
ušt32_t
 
	$drİs
(ècÚ¡ {  
_drİs
; 
	}
}

56 
	$add_hªdËrs
(è
CLICK_COLD
;

57 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

59 
šlše
 
Pack‘
 *
	`smaùiÚ
(Packet *);

60 
	`push
(, 
Pack‘
 *
p
);

61 
Pack‘
 *
	`puÎ
();

63 
	}
};

65 
	gCLICK_ENDDECLS


	@ip/ipmirror.cc

18 
	~<şick/cÚfig.h
>

19 
	~"mœrÜ.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şickÃt/.h
>

22 
	~<şickÃt/udp.h
>

23 
	~<şickÃt/tı.h
>

24 
CLICK_DECLS


26 
	gIPMœrÜ
::
	$IPMœrÜ
()

28 
	}
}

30 
IPMœrÜ
::~
	$IPMœrÜ
()

32 
	}
}

35 
IPMœrÜ
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 
	g_d¡_ªno
 = 
Œue
;

38  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("DST_ANNO", 
_d¡_ªno
).
com¶‘e
();

41 
Pack‘
 *

42 
	gIPMœrÜ
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

44 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

47 
şick_
 *
h
 = 
p
->
	`_h—d”
();

48 
š_addr
 
tm·
 = 
h
->
_¤c
;

49 
h
->
_¤c
 = iph->
_d¡
;

50 
h
->
_d¡
 = 
tm·
;

51 ià(
_d¡_ªno
)

52 
p
->
	`£t_d¡__ªno
(
tm·
);

55 ià((
h
->
_p
 =ğ
IP_PROTO_TCP
 || iph->_°=ğ
IP_PROTO_UDP
è&& 
	`IP_FIRSTFRAG
(hè&& ()
p
->
	`Ëngth
(è>ğp->
	`Œª¥Üt_h—d”_off£t
() + 8) {

56 
şick_udp
 *
udph
 = 
p
->
	`udp_h—d”
();

57 
ušt16_t
 
tmµ
 = 
udph
->
uh_¥Üt
;

58 
udph
->
uh_¥Üt
 = udph->
uh_dpÜt
;

59 
udph
->
uh_dpÜt
 = 
tmµ
;

60 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
) {

61 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

62 
ušt32_t
 
£qn
 = 
tıh
->
th_£q
;

63 
tıh
->
th_£q
 =ıh->
th_ack
;

64 
tıh
->
th_ack
 = 
£qn
;

68  
p
;

69 
	}
}

71 
CLICK_ENDDECLS


72 
	$EXPORT_ELEMENT
(
IPMœrÜ
)

73 
	`ELEMENT_MT_SAFE
(
IPMœrÜ
)

	@ip/ipmirror.hh

1 #iâdeà
CLICK_IPMIRROR_HH


2 
	#CLICK_IPMIRROR_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


32 şas 
	cIPMœrÜ
 : 
public
 
EËm’t
 {…ublic:

34 
	$IPMœrÜ
(è
CLICK_COLD
;

35 ~
	$IPMœrÜ
(è
CLICK_COLD
;

37 cÚ¡ *
	$şass_Çme
() const {  "IPMirror"; }

38 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

40 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

41 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

43 
	g´iv©e
:

45 
boŞ
 
_d¡_ªno
;

49 
	gCLICK_ENDDECLS


	@ip/ipnameinfo.cc

18 
	~<şick/cÚfig.h
>

19 
	~"Çmešfo.hh
"

20 
	~<şick/Çmešfo.hh
>

21 
	~<şick/cÚå¬£.hh
>

22 
	~<şickÃt/.h
>

23 
	~<şickÃt/icmp.h
>

24 
	~<şickÃt/tı.h
>

25 
	~<şickÃt/udp.h
>

26 #ià
CLICK_USERLEVEL
 && 
HAVE_NETDB_H


27 
	~<Ãtdb.h
>

28 
	~<şick/u£ruts.hh
>

29 #iâdeà
_PATH_PROTOCOLS


30 
	#_PATH_PROTOCOLS
 "/‘c/´ÙocŞs"

	)

32 #iâdeà
_PATH_SERVICES


33 
	#_PATH_SERVICES
 "/‘c/£rviûs"

	)

36 
CLICK_DECLS


38 cÚ¡ 
	gSticNameDB
::
EÁry
 
_´Ùos
[] = {

39 { "dcı", 
IP_PROTO_DCCP
 },

40 { "g»", 
IP_PROTO_GRE
 },

41 { "icmp", 
IP_PROTO_ICMP
 },

42 { "igmp", 
IP_PROTO_IGMP
 },

43 { "", 
IP_PROTO_IPIP
 },

44 { "·ylßd", 
IP_PROTO_PAYLOAD
 },

45 { "sùp", 
IP_PROTO_SCTP
 },

46 { "tı", 
IP_PROTO_TCP
 },

47 { "tıudp", 
IP_PROTO_TCP_OR_UDP
 },

48 { "Œª¥", 
IP_PROTO_TRANSP
 },

49 { "udp", 
IP_PROTO_UDP
 }

52 cÚ¡ 
	gSticNameDB
::
EÁry
 
icmp_ty³s
[] = {

53 { "echo", 
ICMP_ECHO
 },

54 { "echo-»¶y", 
ICMP_ECHOREPLY
 },

55 { "šfÜeq", 
ICMP_IREQ
 },

56 { "šfÜeq-»¶y", 
ICMP_IREQREPLY
 },

57 { "mask»q", 
ICMP_MASKREQ
 },

58 { "mask»q-»¶y", 
ICMP_MASKREQREPLY
 },

59 { "·¿m‘”´obËm", 
ICMP_PARAMPROB
 },

60 { "»dœeù", 
ICMP_REDIRECT
 },

61 { "rou‹¿dv”t", 
ICMP_ROUTERADVERT
 },

62 { "rou‹rsŞic™", 
ICMP_ROUTERSOLICIT
 },

63 { "sourûqu’ch", 
ICMP_SOURCEQUENCH
 },

64 { "tim“xûeded", 
ICMP_TIMXCEED
 },

65 { "time¡amp", 
ICMP_TSTAMP
 },

66 { "time¡amp-»¶y", 
ICMP_TSTAMPREPLY
 },

67 { "uÄ—chabË", 
ICMP_UNREACH
 },

70 cÚ¡ 
	gSticNameDB
::
EÁry
 
icmp_uÄ—ch_codes
[] = {

71 { "f‹½rohib™ed", 
ICMP_UNREACH_FILTER_PROHIB
 },

72 { "ho¡", 
ICMP_UNREACH_HOST
 },

73 { "ho¡´eûd’û", 
ICMP_UNREACH_HOST_PRECEDENCE
 },

74 { "ho¡´ohib™ed", 
ICMP_UNREACH_HOST_PROHIB
 },

75 { "ho¡unknown", 
ICMP_UNREACH_HOST_UNKNOWN
 },

76 { "isŞ©ed", 
ICMP_UNREACH_ISOLATED
 },

77 { "Ãedäag", 
ICMP_UNREACH_NEEDFRAG
 },

78 { "Ãt", 
ICMP_UNREACH_NET
 },

79 { "Ãrohib™ed", 
ICMP_UNREACH_NET_PROHIB
 },

80 { "Ãtunknown", 
ICMP_UNREACH_NET_UNKNOWN
 },

81 { "pÜt", 
ICMP_UNREACH_PORT
 },

82 { "´eûd’ûcutoff", 
ICMP_UNREACH_PRECEDENCE_CUTOFF
 },

83 { "´ÙocŞ", 
ICMP_UNREACH_PROTOCOL
 },

84 { "¤üou‹ç", 
ICMP_UNREACH_SRCFAIL
 },

85 { "tosho¡", 
ICMP_UNREACH_TOSHOST
 },

86 { "to¢‘", 
ICMP_UNREACH_TOSNET
 }

89 cÚ¡ 
	gSticNameDB
::
EÁry
 
icmp_»dœeù_codes
[] = {

90 { "ho¡", 
ICMP_REDIRECT_HOST
 },

91 { "Ãt", 
ICMP_REDIRECT_NET
 },

92 { "tosho¡", 
ICMP_REDIRECT_TOSHOST
 },

93 { "to¢‘", 
ICMP_REDIRECT_TOSNET
 }

96 cÚ¡ 
	gSticNameDB
::
EÁry
 
icmp_timxûed_codes
[] = {

97 { "»as£mbly", 
ICMP_TIMXCEED_REASSEMBLY
 },

98 { "Œªs™", 
ICMP_TIMXCEED_TRANSIT
 }

101 cÚ¡ 
	gSticNameDB
::
EÁry
 
icmp_·¿m´ob_codes
[] = {

102 { "”rÜ©±r", 
ICMP_PARAMPROB_ERRATPTR
 },

103 { "Ëngth", 
ICMP_PARAMPROB_LENGTH
 },

104 { "missšgİt", 
ICMP_PARAMPROB_OPTABSENT
 }

107 cÚ¡ 
	gSticNameDB
::
EÁry
 
known_pÜts
[] = {

144 
	gÇme¥aû
 {

146 #ià
CLICK_USERLEVEL
 && 
HAVE_NETDB_H


147 şas 
	cS”viûsNameDB
 : 
public
 
NameDB
 {…ublic:

148 
S”viûsNameDB
(
ušt32_t
 
ty³
, S”viûsNameDB *
Ùh”
);

149 ~
S”viûsNameDB
();

150 
boŞ
 
qu”y
(cÚ¡ 
SŒšg
 &
Çme
, *
v®ue
, 
size_t
 
vsize
);

151 
	g´iv©e
:

152 
DyÇmicNameDB
 *
_db
;

153 
boŞ
 
	g_»ad_db
;

154 
S”viûsNameDB
 *
	g_Ãxt
;

155 
S”viûsNameDB
 *
	g_´ev
;

156 
»ad_£rviûs
();

159 
	gS”viûsNameDB
::
	$S”viûsNameDB
(
ušt32_t
 
ty³
, 
S”viûsNameDB
 *
Ùh”
)

160 : 
	`NameDB
(
ty³
, 
	`SŒšg
(), 4), 
	`_db
(0), 
	$_»ad_db
(
çl£
)

162 ià(
Ùh”
) {

163 
_Ãxt
 = 
Ùh”
;

164 
_´ev
 = 
Ùh”
->_prev;

165 
Ùh”
->
_´ev
 = _´ev->
_Ãxt
 = 
this
;

167 
_Ãxt
 = 
_´ev
 = 
this
;

168 
	}
}

170 
	gS”viûsNameDB
::~
	$S”viûsNameDB
()

172 
_Ãxt
->
_´ev
 = _prev;

173 
_´ev
->
_Ãxt
 = _next;

174 
d–‘e
 
_db
;

175 
	}
}

178 
	gS”viûsNameDB
::
	$»ad_£rviûs
()

185 ià(
	`ty³
(è=ğ
NameInfo
::
T_IP_PROTO
) {

186 ià(!
_db
)

187 
_db
 = 
Ãw
 
	`DyÇmicNameDB
(
	`ty³
(), 
	`SŒšg
(), 4);

188 
´ÙÛÁ
 *
p
 = 
	`g‘´ÙÛÁ
()) {

189 
ušt32_t
 
´Ùo
 = 
p
->
p_´Ùo
;

190 
_db
->
	`defše
(
p
->
p_Çme
, &
´Ùo
, 4);

191 cÚ¡ **
a
 = (cÚ¡ **è
p
->
p_®Ÿ£s
;‡ && *a;‡++)

192 
_db
->
	`defše
(*
a
, &
´Ùo
, 4);

195 
£rv’t
 *
s
 = 
	`g‘£rv’t
()) {

196 
ušt32_t
 
pÜt
 = 
	`Áohs
(
s
->
s_pÜt
), 
±y³
;

197 ià(!
NameInfo
::
	`qu”y_št
(NameInfo::
T_IP_PROTO
, 0, 
s
->
s_´Ùo
, &
±y³
))

199 
±y³
 +ğ
NameInfo
::
T_IP_PORT
;

200 
S”viûsNameDB
 *
db
;

201 
db
 = 
_Ãxt
; db->
	`ty³
(è!ğ
±y³
 && db !ğ
this
; db = db->_next)

203 ià(
db
->
	`ty³
(è!ğ
±y³
)

205 ià(!
db
->
_db
)

206 
db
->
_db
 = 
Ãw
 
	`DyÇmicNameDB
(
	`ty³
(), 
	`SŒšg
(), 4);

207 
db
->
_db
->
	`defše
(
s
->
s_Çme
, &
pÜt
, 4);

208 cÚ¡ **
a
 = (cÚ¡ **è
s
->
s_®Ÿ£s
;‡ && *a;‡++)

209 
db
->
_db
->
	`defše
(*
a
, &
pÜt
, 4);

214 
boŞ
 
´Ùo
 = (
	`ty³
(è=ğ
NameInfo
::
T_IP_PROTO
);

215 
SŒšg
 
‹xt
 = 
	`fe_¡ršg
(
´Ùo
 ? 
_PATH_PROTOCOLS
 : 
_PATH_SERVICES
);

216 ià(!
‹xt
)

219 
VeùÜ
<
SŒšg
> 
Çmes
;

220 cÚ¡ *
s
 = 
‹xt
.
	`begš
(), *
’d
 =ext.
	`’d
();

221 
s
 < 
’d
) {

222 cÚ¡ *
eŞ
 = 
s
;

223 
eŞ
 < 
’d
 && *eol != '#' && *eol != '\r' && *eol != '\n')

224 
eŞ
++;

227 cÚ¡ *
bn
, *
’
;

228 
bn
 = 
s
; bÀ< 
eŞ
 && 
	`is¥aû
(() *bn); bn++)

230 
’
 = 
bn
;ƒÀ< 
eŞ
 && !
	`is¥aû
(() *en);ƒn++)

234 cÚ¡ *
bt
, *
‘
;

235 
ušt32_t
 
²um
 = 0;

236 
ušt32_t
 
±y³
;

237 
Çmes_pos
;

238 
S”viûsNameDB
 *
db
;

239 
bt
 = 
’
; bˆ< 
eŞ
 && 
	`is¥aû
(() *bt); bt++)

241 
‘
 = 
bt
;ƒˆ< 
eŞ
 && 
	`isdig™
((è*‘è&& 
²um
 < 65536;ƒt++)

242 
²um
 = 10*²um + *
‘
 - '0';

243 ià(
‘
 =ğ
bt
 || 
²um
 >ğ(
´Ùo
 ? 256 : 65536))

244 
sk_to_eŞ
;

245 ià(
´Ùo
)

246 
±y³
 = 
NameInfo
::
T_IP_PROTO
;

248 ià(
‘
 >ğ
eŞ
 || (*et != '/' && *et != ','))

249 
sk_to_eŞ
;

250 
bt
 = 
‘
 =ƒˆ+ 1;ƒˆ< 
eŞ
 && !
	`is¥aû
(() *et);ƒt++)

252 ià(!
NameInfo
::
	`qu”y_št
(NameInfo::
T_IP_PROTO
, 0, 
‹xt
.
	`sub¡ršg
(
bt
, 
‘
), &
±y³
))

253 
sk_to_eŞ
;

254 
±y³
 +ğ
NameInfo
::
T_IP_PORT
;

258 
db
 = 
_Ãxt
; db->
	`ty³
(è!ğ
±y³
 && db !ğ
this
; db = db->_next)

260 ià(
db
->
	`ty³
(è!ğ
±y³
)

261 
sk_to_eŞ
;

264 ià(!
db
->
_db
)

265 
db
->
_db
 = 
Ãw
 
	`DyÇmicNameDB
(
±y³
, "", 4);

269 
Çmes_pos
 = 0;

271 ià(
Çmes_pos
 < 
Çmes
.
	`size
()

272 && !
Çmes
[
Çmes_pos
].
	`equ®s
(
bn
, 
’
 - bn))

273 
Çmes
.
	`”a£
Òames.
	`begš
(è+ 
Çmes_pos
,‚ames.
	`’d
());

276 ià(
Çmes_pos
 >ğ
Çmes
.
	`size
())

277 
Çmes
.
	`push_back
(
	`SŒšg
(
bn
, 
’
));

278 ++
Çmes_pos
;

281 
bn
 = 
‘
; bÀ< 
eŞ
 && 
	`is¥aû
(() *bn); bn++)

283 
’
 = 
bn
;ƒÀ< 
eŞ
 && !
	`is¥aû
(() *en);ƒn++)

285 
‘
 = 
’
;

286 } 
bn
 !ğ
’
);

289 
SŒšg
 *
n
 = 
Çmes
.
	`begš
();‚ !ğÇmes.begš(è+ 
Çmes_pos
; ++n)

290 
db
->
_db
->
	`defše
(*
n
, &
²um
, 4);

292 
sk_to_eŞ
:

293 
s
 = 
eŞ
;

294 
s
 < 
’d
 && *s != '\r' && *s != '\n')

295 
s
++;

296 
s
 < 
’d
 && (*s == '\r' || *s == '\n'))

297 
s
++;

302 
S”viûsNameDB
 *
db
 = 
this
;

304 
db
->
_»ad_db
 = 
Œue
;

305 
db
 = db->
_Ãxt
;

306 } 
db
 !ğ
this
);

307 
	}
}

309 
boŞ


310 
	gS”viûsNameDB
::
	$qu”y
(cÚ¡ 
SŒšg
 &
Çme
, *
v®ue
, 
size_t
 
vsize
)

312 
	`as£¹
(
vsize
 == 4);

315 
št32_t
 
ü­
;

316 ià(
	`IÁArg
().
	`·r£
(
Çme
, 
ü­
))

317  
çl£
;

319 ià(!
_»ad_db
)

320 
	`»ad_£rviûs
();

322 ià(
	`ty³
(è=ğ
NameInfo
::
T_IP_PROTO
) {

323 ià(!
_db
) {

324 ià(cÚ¡ 
´ÙÛÁ
 *
´Ùo
 = 
	`g‘´ÙobyÇme
(
Çme
.
	`c_¡r
())) {

325 *
»š‹½»t_ÿ¡
<
ušt32_t
*>(
v®ue
èğ
´Ùo
->
p_´Ùo
;

326  
Œue
;

328 } ià(
_db
->
	`qu”y
(
Çme
, 
v®ue
, 
vsize
))

329  
Œue
;

332 ià(
	`ty³
(è>ğ
NameInfo
::
T_IP_PORT
 &&ype() < NameInfo::T_IP_PORT + 256) {

333 ià(!
_db
) {

334 
´Ùo
 = 
	`ty³
(è- 
NameInfo
::
T_IP_PORT
;

335 cÚ¡ *
´Ùo_Çme
;

336 ià(
´Ùo
 =ğ
IP_PROTO_TCP
)

337 
´Ùo_Çme
 = "tcp";

338 ià(
´Ùo
 =ğ
IP_PROTO_UDP
)

339 
´Ùo_Çme
 = "udp";

340 ià(cÚ¡ 
´ÙÛÁ
 *
³
 = 
	`g‘´Ùobynumb”
(
´Ùo
))

341 
´Ùo_Çme
 = 
³
->
p_Çme
;

343  
çl£
;

344 ià(cÚ¡ 
£rv’t
 *
¤v
 = 
	`g‘£rvbyÇme
(
Çme
.
	`c_¡r
(), 
´Ùo_Çme
)) {

345 *
»š‹½»t_ÿ¡
<
ušt32_t
*>(
v®ue
èğ
	`Áohs
(
¤v
->
s_pÜt
);

346  
Œue
;

348 } ià(
_db
->
	`qu”y
(
Çme
, 
v®ue
, 
vsize
))

349  
Œue
;

352  
çl£
;

353 
	}
}

359 
NameDB
 *
	gdbs
[13];

362 
	gIPNameInfo
::
	$¡©ic_š™Ÿlize
()

364 #ià
CLICK_USERLEVEL
 && 
HAVE_NETDB_H


365 
dbs
[0] = 
Ãw
 
	`S”viûsNameDB
(
NameInfo
::
T_IP_PROTO
, 0);

367 
dbs
[1] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_IP_PROTO
, 
	`SŒšg
(), 
_´Ùos
, (ip_protos) / (ip_protos[0]));

368 
dbs
[2] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_ICMP_TYPE
, 
	`SŒšg
(), 
icmp_ty³s
, (icmp_types) / (icmp_types[0]));

369 
dbs
[3] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_ICMP_CODE
 + 
ICMP_UNREACH
, 
	`SŒšg
(), 
icmp_uÄ—ch_codes
, (icmp_unreach_codes) / (icmp_unreach_codes[0]));

370 
dbs
[4] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_ICMP_CODE
 + 
ICMP_REDIRECT
, 
	`SŒšg
(), 
icmp_»dœeù_codes
, (icmp_redirect_codes) / (icmp_redirect_codes[0]));

371 
dbs
[5] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_ICMP_CODE
 + 
ICMP_TIMXCEED
, 
	`SŒšg
(), 
icmp_timxûed_codes
, (icmp_timxceed_codes) / (icmp_timxceed_codes[0]));

372 
dbs
[6] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_ICMP_CODE
 + 
ICMP_PARAMPROB
, 
	`SŒšg
(), 
icmp_·¿m´ob_codes
, (icmp_paramprob_codes) / (icmp_paramprob_codes[0]));

373 #ià
CLICK_USERLEVEL
 && 
HAVE_NETDB_H


374 
S”viûsNameDB
 *
pÜtdb
;

375 
dbs
[7] = 
pÜtdb
 = 
Ãw
 
	`S”viûsNameDB
(
NameInfo
::
T_TCP_PORT
, 0);

376 
dbs
[8] = 
Ãw
 
	`S”viûsNameDB
(
NameInfo
::
T_UDP_PORT
, 
pÜtdb
);

377 
dbs
[9] = 
Ãw
 
	`S”viûsNameDB
(
NameInfo
::
T_IP_PORT
 + 
IP_PROTO_SCTP
, 
pÜtdb
);

378 
dbs
[10] = 
Ãw
 
	`S”viûsNameDB
(
NameInfo
::
T_IP_PORT
 + 
IP_PROTO_DCCP
, 
pÜtdb
);

380 
dbs
[11] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_TCP_PORT
, 
	`SŒšg
(), 
known_pÜts
, (known_ports) / (known_ports[0]));

381 
dbs
[12] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_UDP_PORT
, 
	`SŒšg
(), 
known_pÜts
, (known_ports) / (known_ports[0]));

382 
i
 = 0; i < 13; i++)

383 ià(
dbs
[
i
])

384 
NameInfo
::
	`š¡®ldb
(
dbs
[
i
], 0);

385 
	}
}

388 
	gIPNameInfo
::
	$¡©ic_ş—nup
()

390 
i
 = 0; i < 13; i++)

391 ià(
dbs
[
i
]) {

392 
d–‘e
 
dbs
[
i
];

393 
dbs
[
i
] = 0;

395 
	}
}

397 
CLICK_ENDDECLS


398 
EXPORT_ELEMENT
(
IPNameInfo
)

	@ip/ipnameinfo.hh

1 #iâdeà
CLICK_IPNAMEINFO_HH


2 
	#CLICK_IPNAMEINFO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


48 şas 
	cIPNameInfo
 : 
public
 
EËm’t
 {…ublic:

50 cÚ¡ *
	$şass_Çme
() const {  "IPNameInfo"; }

52 
	`¡©ic_š™Ÿlize
();

53 
	`¡©ic_ş—nup
();

55 
	}
};

57 
	gCLICK_ENDDECLS


	@ip/ipoutputcombo.cc

18 
	~<şick/cÚfig.h
>

19 
	~"ouutcombo.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
CLICK_DECLS


26 
	gIPOuutCombo
::
	$IPOuutCombo
()

28 
	}
}

30 
IPOuutCombo
::~
	$IPOuutCombo
()

32 
	}
}

35 
IPOuutCombo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37  
Args
(
cÚf
, 
this
, 
”rh
)

38 .
»ad_mp
("COLOR", 
_cŞÜ
)

39 .
»ad_mp
("IPADDR", 
_my_
)

40 .
»ad_mp
("MTU", 
_mtu
).
com¶‘e
();

44 
	gIPOuutCombo
::
	$push
(, 
Pack‘
 *
p_š
)

46 
do_cksum
 = 0;

47 
´obËm_off£t
 = -1;

50 ià(
p_š
->
	`·ck‘_ty³_ªno
(è=ğ
Pack‘
::
BROADCAST
 ||…_š->·ck‘_ty³_ªno(è=ğPack‘::
MULTICAST
) {

51 
p_š
->
	`kl
();

56 ià(
	`PAINT_ANNO
(
p_š
è=ğ
_cŞÜ
)

57 
	`ouut
(1).
	`push
(
p_š
->
	`şÚe
());

60 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

61 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

62 
şick_
 *

 = 
p
->
	`_h—d”
();

63 
hËn
 = (

->
_hl
 << 2);

65 ià(
hËn
 > (
şick_
)) {

66 
ušt8_t
 *
wß
 = 
p
->
	`ÃtwÜk_h—d”
();

67 
hËn
 = 
p
->
	`ÃtwÜk_h—d”_Ëngth
();

69 
oi
;

70 
oi
 = (
şick_
); o˜< 
hËn
; ) {

72 
ty³
 = 
wß
[
oi
];

73 ià(
ty³
 =ğ
IPOPT_NOP
) {

74 
oi
++;

76 } ià(
ty³
 =ğ
IPOPT_EOL
)

81 
xËn
 = 
wß
[
oi
 + 1];

82 ià(
xËn
 < 2 || 
oi
 + xËÀ> 
hËn
) {

84 
´obËm_off£t
 = 
oi
 + 1;

85 
gw_£nd_”rÜ
;

86 } ià(
ty³
 !ğ
IPOPT_RR
 &&y³ !ğ
IPOPT_TS
) {

88 
oi
 +ğ
xËn
;

94 if(
ty³
 =ğ
IPOPT_RR
){

99 
p
 = 
wß
[
oi
+2] - 1;

100 ià(
p
 >ğ3 &&… + 4 <ğ
xËn
) {

101 
	`memıy
(
wß
 + 
oi
 + 
p
, &
_my_
, 4);

102 
wß
[
oi
+2] += 4;

103 
do_cksum
 = 1;

104 } ià(
p
 !ğ
xËn
) {

105 
´obËm_off£t
 = 
oi
 + 2;

106 
gw_£nd_”rÜ
;

108 } if(
ty³
 =ğ
IPOPT_TS
){

114 
p
 = 
wß
[
oi
+2] - 1;

115 
oæw
 = 
wß
[
oi
+3] >> 4;

116 
æg
 = 
wß
[
oi
+3] & 0xf;

117 
boŞ
 
ov”æowed
 = 0;

119 
Time¡amp
 
now
 = Time¡amp::
	`now
();

120 
ms
 = 
	`htÚl
((
now
.
	`£c
(è% 86400)*1000 +‚ow.
	`m£c
());

122 if(
p
 < 4){

123 
´obËm_off£t
 = 
oi
 + 2;

124 
gw_£nd_”rÜ
;

125 } if(
æg
 == 0){

127 if(
p
+4 <ğ
xËn
){

128 
	`memıy
(
wß
 + 
oi
 + 
p
, &
ms
, 4);

129 
wß
[
oi
+2] += 4;

130 
do_cksum
 = 1;

132 
ov”æowed
 = 1;

133 } if(
æg
 == 1){

135 if(
p
+8 <ğ
xËn
){

136 
	`memıy
(
wß
 + 
oi
 + 
p
, &
_my_
, 4);

137 
	`memıy
(
wß
 + 
oi
 + 
p
 + 4, &
ms
, 4);

138 
wß
[
oi
+2] += 8;

139 
do_cksum
 = 1;

141 
ov”æowed
 = 1;

142 } ià(
æg
 =ğ3 && 
p
 + 8 <ğ
xËn
) {

144 ià(
	`memcmp
(
wß
 + 
oi
 + 
p
, &
_my_
, 4) == 0) {

145 
	`memıy
(
wß
 + 
oi
 + 
p
 + 4, &
ms
, 4);

146 
wß
[
oi
+2] += 8;

147 
do_cksum
 = 1;

150 
´obËm_off£t
 = 
oi
 + 3;

151 
gw_£nd_”rÜ
;

153 ià(
ov”æowed
) {

154 ià(
oæw
 < 15) {

155 
wß
[
oi
+3] = ((
oæw
 + 1è<< 4è| 
æg
;

156 
do_cksum
 = 1;

158 
´obËm_off£t
 = 
oi
 + 3;

159 
gw_£nd_”rÜ
;

164 
oi
 +ğ
xËn
;

169 ià(
	`FIX_IP_SRC_ANNO
(
p
)) {

170 
	`SET_FIX_IP_SRC_ANNO
(
p
, 0);

171 

->
_¤c
 = 
_my_
;

172 
do_cksum
 = 1;

176 ià(
do_cksum
) {

177 

->
_sum
 = 0;

178 

->
_sum
 = 
	`şick_š_cksum
(
p
->
	`d©a
(), 
hËn
);

182 ià(

->
_‰l
 <= 1) {

183 
	`ouut
(3).
	`push
(
p
);

186 

->
_‰l
--;

189 
sum
 = (~
	`Áohs
(

->
_sum
) & 0xFFFF) + 0xFEFF;

190 

->
_sum
 = ~
	`htÚs
(
sum
 + (sum >> 16));

194 ià(
p
->
	`Ëngth
(è> 
_mtu
) {

195 
	`ouut
(4).
	`push
(
p
);

199 
	`ouut
(0).
	`push
(
p
);

202 
gw_£nd_”rÜ
:

203 
	`SET_ICMP_PARAMPROB_ANNO
(
p
, 
´obËm_off£t
);

204 
	`ouut
(2).
	`push
(
p
);

205 
	}
}

207 
CLICK_ENDDECLS


208 
	$EXPORT_ELEMENT
(
IPOuutCombo
)

209 
	`ELEMENT_MT_SAFE
(
IPOuutCombo
)

	@ip/ipoutputcombo.hh

1 #iâdeà
CLICK_IPOUTPUTCOMBO_HH


2 
	#CLICK_IPOUTPUTCOMBO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şickÃt/.h
>

6 
CLICK_DECLS


43 şas 
	cIPOuutCombo
 : 
public
 
EËm’t
 {

45 
public
:

47 
	$IPOuutCombo
(è
CLICK_COLD
;

48 ~
	$IPOuutCombo
(è
CLICK_COLD
;

50 cÚ¡ *
	$şass_Çme
() const {  "IPOutputCombo"; }

51 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/5"; 
	}
}

52 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

54 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

56 
push
(, 
Pack‘
 *);

58 
	g´iv©e
:

60 
_cŞÜ
;

61 
š_addr
 
	g_my_
;

62 
	g_mtu
;

66 
	gCLICK_ENDDECLS


	@ip/ipprint.cc

19 
	~<şick/cÚfig.h
>

20 
	~"´št.hh
"

21 
	~<şick/glue.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/·ck‘_ªno.hh
>

26 
	~<şick/rou‹r.hh
>

27 
	~<şick/Çmešfo.hh
>

29 
	~<şickÃt/.h
>

30 
	~<şickÃt/icmp.h
>

31 
	~<şickÃt/tı.h
>

32 
	~<şickÃt/udp.h
>

34 #ià
CLICK_USERLEVEL


35 
	~<¡dio.h
>

38 
CLICK_DECLS


40 
	gIPPršt
::
	$IPPršt
()

42 #ià
CLICK_USERLEVEL


43 
_outfe
 = 0;

45 
	}
}

47 
	gIPPršt
::~
	$IPPršt
()

49 
	}
}

52 
IPPršt
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

54 
	g_by‹s
 = 1500;

55 
SŒšg
 
	gcÚ‹Ás
 = "no";

56 
SŒšg
 
	g·ylßd
 = "no";

57 
	g_Ïb–
 = "";

58 
	g_sw­
 = 
Œue
;

59 
	g_·ylßd
 = 
çl£
;

60 
	g_aùive
 = 
Œue
;

61 
boŞ
 
	g´št_id
 = 
çl£
;

62 
boŞ
 
	g´št_time
 = 
Œue
;

63 
boŞ
 
	g´št_·št
 = 
çl£
;

64 
boŞ
 
	g´št_tos
 = 
çl£
;

65 
boŞ
 
	g´št_‰l
 = 
çl£
;

66 
boŞ
 
	g´št_Ën
 = 
çl£
;

67 
boŞ
 
	g´št_agg»g©e
 = 
çl£
;

68 
boŞ
 
	gbcÚ‹Ás
;

69 
SŒšg
 
	gchªÃl
;

71 ià(
Args
(
cÚf
, 
this
, 
”rh
)

72 .
»ad_p
("LABEL", 
_Ïb–
)

73 .
»ad
("CONTENTS", 
WÜdArg
(), 
cÚ‹Ás
)

74 .
»ad
("PAYLOAD", 
WÜdArg
(), 
·ylßd
)

75 .
»ad
("MAXLENGTH", 
_by‹s
)

76 .
»ad
("NBYTES", 
_by‹s
)

77 .
»ad
("ID", 
´št_id
)

78 .
»ad
("TIMESTAMP", 
´št_time
)

79 .
»ad
("PAINT", 
´št_·št
)

80 .
»ad
("TOS", 
´št_tos
)

81 .
»ad
("TTL", 
´št_‰l
)

82 .
»ad
("SWAP", 
_sw­
)

83 .
»ad
("LENGTH", 
´št_Ën
)

84 .
»ad
("AGGREGATE", 
´št_agg»g©e
)

85 .
»ad
("ACTIVE", 
_aùive
)

86 #ià
CLICK_USERLEVEL


87 .
»ad
("OUTFILE", 
F’ameArg
(), 
_outf’ame
)

89 .
»ad
("CHANNEL", 
WÜdArg
(), 
chªÃl
)

90 .
com¶‘e
() < 0)

93 ià(
BoŞArg
().
·r£
(
cÚ‹Ás
, 
bcÚ‹Ás
))

94 
	g_cÚ‹Ás
 = 
bcÚ‹Ás
;

95 ià((
	gcÚ‹Ás
 = 
cÚ‹Ás
.
uµ”
()), contents == "NONE")

96 
_cÚ‹Ás
 = 0;

97 ià(
	gcÚ‹Ás
 == "HEX")

98 
_cÚ‹Ás
 = 1;

99 ià(
	gcÚ‹Ás
 == "ASCII")

100 
_cÚ‹Ás
 = 2;

102  
	g”rh
->
”rÜ
("bad cÚ‹Á v®u'%s'; should b'NONE', 'HEX', o¸'ASCII'", 
cÚ‹Ás
.
c_¡r
());

104 
	g·ylßdv
;

105 
	g·ylßd
 = 
·ylßd
.
uµ”
();

106 ià(
	g·ylßd
 =ğ"NO" || 
·ylßd
 == "FALSE")

107 
·ylßdv
 = 0;

108 ià(
	g·ylßd
 =ğ"YES" || 
·ylßd
 == "TRUE" ||…ayload == "HEX")

109 
·ylßdv
 = 1;

110 ià(
	g·ylßd
 == "ASCII")

111 
·ylßdv
 = 2;

113  
	g”rh
->
”rÜ
("bad…aylßd v®u'%s'; should b'çl£', 'hex', o¸'ascii'", 
cÚ‹Ás
.
c_¡r
());

115 ià(
	g·ylßdv
 > 0 && 
	g_cÚ‹Ás
 > 0)

116  
	g”rh
->
”rÜ
("specify‡t most one of PAYLOAD‡nd CONTENTS");

117 ià(
	g·ylßdv
 > 0)

118 
	g_cÚ‹Ás
 = 
·ylßdv
, 
	g_·ylßd
 = 
Œue
;

120 
	g_´št_id
 = 
´št_id
;

121 
	g_´št_time¡amp
 = 
´št_time
;

122 
	g_´št_·št
 = 
´št_·št
;

123 
	g_´št_tos
 = 
´št_tos
;

124 
	g_´št_‰l
 = 
´št_‰l
;

125 
	g_´št_Ën
 = 
´št_Ën
;

126 
	g_´št_agg»g©e
 = 
´št_agg»g©e
;

127 
	g_”rh
 = 
rou‹r
()->
ch©‹r_chªÃl
(
chªÃl
);

132 
	gIPPršt
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

134 #ià
CLICK_USERLEVEL


135 ià(
_outf’ame
) {

136 
_outfe
 = 
	`fİ’
(
_outf’ame
.
	`c_¡r
(), "wb");

137 ià(!
_outfe
)

138  
”rh
->
	`”rÜ
("%s: %s", 
_outf’ame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

141 (è
”rh
;

144 
	}
}

147 
	gIPPršt
::
	$ş—nup
(
CËªupSge
)

149 #ià
CLICK_USERLEVEL


150 ià(
_outfe
)

151 
	`fşo£
(
_outfe
);

152 
_outfe
 = 0;

154 
	}
}

156 
	gSŒšgAccum
 &

157 
	gIPPršt
::
	$add»ss_·œ
(
SŒšgAccum
 &
§
, cÚ¡ 
şick_
 *
h
)

159 
§
 << 
	`IPAdd»ss
(
h
->
_¤c
è<< " > " << IPAdd»ss(h->
_d¡
);

160  
§
;

161 
	}
}

164 
	gIPPršt
::
	$tı_lše
(
SŒšgAccum
 &
§
, cÚ¡ 
Pack‘
 *
p
, 
Œª¥Üt_Ëngth
) const

166 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

167 cÚ¡ 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

168 
_Ën
, 
£qËn
;

169 
ušt32_t
 
£q
;

171 ià(
Œª¥Üt_Ëngth
 < 4 || !
	`IP_FIRSTFRAG
(
h
)) {

172 
	`add»ss_·œ
(
§
, 
h
è<< (
	`IP_FIRSTFRAG
(iph) ? ":runcated-tcp" : ":cp");

176 
§
 << 
	`IPAdd»ss
(
h
->
_¤c
è<< '.' << 
	`Áohs
(
tıh
->
th_¥Üt
) << " > "

177 << 
	`IPAdd»ss
(
h
->
_d¡
è<< '.' << 
	`Áohs
(
tıh
->
th_dpÜt
) << ": ";

179 ià(
Œª¥Üt_Ëngth
 < 14)

180 
Œunÿ‹d_tı
;

182 
_Ën
 = 
	`Áohs
(
h
->ip_len);

183 
£qËn
 = 
_Ën
 - (
h
->
_hl
 << 2è- (
tıh
->
th_off
 << 2);

184 ià(
tıh
->
th_æags
 & 
TH_SYN
)

185 
§
 << 'S', 
£qËn
++;

186 ià(
tıh
->
th_æags
 & 
TH_FIN
)

187 
§
 << 'F', 
£qËn
++;

188 ià(
tıh
->
th_æags
 & 
TH_RST
)

189 
§
 << 'R';

190 ià(
tıh
->
th_æags
 & 
TH_PUSH
)

191 
§
 << 'P';

192 ià(!(
tıh
->
th_æags
 & (
TH_SYN
 | 
TH_FIN
 | 
TH_RST
 | 
TH_PUSH
)))

193 
§
 << '.';

195 
£q
 = 
	`Áohl
(
tıh
->
th_£q
);

196 
§
 << ' ' << 
£q
 << ':' << (£q + 
£qËn
)

197 << '(' << 
£qËn
 << ',' << 
p
->
	`Ëngth
(è<< ',' << 
_Ën
 << ')';

198 ià(
tıh
->
th_æags
 & 
TH_ACK
)

199 
§
 << "‡ck " << 
	`Áohl
(
tıh
->
th_ack
);

201 ià(
Œª¥Üt_Ëngth
 < 16)

202 
Œunÿ‹d_tı
;

204 
§
 << " wš " << 
	`Áohs
(
tıh
->
th_wš
);

207 
Œunÿ‹d_tı
:

208 
§
 << "truncated-tcp";

209 
	}
}

212 
	gIPPršt
::
	$udp_lše
(
SŒšgAccum
 &
§
, cÚ¡ 
Pack‘
 *
p
, 
Œª¥Üt_Ëngth
) const

214 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

215 cÚ¡ 
şick_udp
 *
udph
 = 
p
->
	`udp_h—d”
();

217 ià(
Œª¥Üt_Ëngth
 < 4 || !
	`IP_FIRSTFRAG
(
h
)) {

218 
	`add»ss_·œ
(
§
, 
h
è<< (
	`IP_FIRSTFRAG
(iph) ? ":runcated-udp" : ": udp");

222 
§
 << 
	`IPAdd»ss
(
h
->
_¤c
è<< '.' << 
	`Áohs
(
udph
->
uh_¥Üt
) << " > "

223 << 
	`IPAdd»ss
(
h
->
_d¡
è<< '.' << 
	`Áohs
(
udph
->
uh_dpÜt
) << ": ";

225 ià(
Œª¥Üt_Ëngth
 < 8)

226 
Œunÿ‹d_udp
;

228 
§
 << "ud°" << 
	`Áohs
(
udph
->
uh_uËn
);

231 
Œunÿ‹d_udp
:

232 
§
 << "truncated-udp";

233 
	}
}

235 
SŒšg


236 
	$uÅ¬£_´Ùo
(
_p
, 
boŞ
 
´•’d
)

238 ià(
SŒšg
 
s
 = 
NameInfo
::
	`»vqu”y_št
(NameInfo::
T_IP_PROTO
, 0, 
_p
))

239  
s
;

240 ià(
´•’d
)

241  
SŒšg
::
	`make_¡abË
("´ÙocŞ ", 9è+ 
	`SŒšg
(
_p
);

243  
	`SŒšg
(
_p
);

244 
	}
}

247 
	gIPPršt
::
	$icmp_lše
(
SŒšgAccum
 &
§
, cÚ¡ 
Pack‘
 *
p
, 
Œª¥Üt_Ëngth
) const

249 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

250 cÚ¡ 
şick_icmp
 *
icmph
 = 
p
->
	`icmp_h—d”
();

251 
	`add»ss_·œ
(
§
, 
h
) << ": ";

253 ià(!
	`IP_FIRSTFRAG
(
h
)) {

254 
§
 << "icmp";

256 } ià(
Œª¥Üt_Ëngth
 < 2)

257 
Œunÿ‹d_icmp
;

259 
icmph
->
icmp_ty³
) {

261 
ICMP_ECHOREPLY
:

262 
§
 << "icmpƒcho-reply ";

263 
icmp_echo
;

264 
ICMP_ECHO
:

265 
§
 << "icmpƒcho ";

267 
icmp_echo
: {

268 ià(
Œª¥Üt_Ëngth
 < 8)

269 
Œunÿ‹d_icmp
;

270 cÚ¡ 
şick_icmp_£qu’ûd
 *
£qh
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_icmp_£qu’ûd *>(
icmph
);

271 
	#sw­™
(
x
è(
_sw­
 ? ((((xè& 0xffè<< 8è| ((xè>> 8)è: (x))

	)

272 
§
 << '(' << 
	`sw­™
(
£qh
->
icmp_id’tif›r
è<< ", " << sw­™(£qh->
icmp_£qu’û
) << ')';

276 
ICMP_UNREACH
: {

277 
SŒšg
 
code
 = 
NameInfo
::
	`»vqu”y_št
(NameInfo::
T_ICMP_CODE
 + 
icmph
->
icmp_ty³
, 
this
, icmph->
icmp_code
);

278 ià(!
code
)

279 
code
 = "cod" + 
	`SŒšg
((è
icmph
->
icmp_code
);

281 cÚ¡ 
şick_
 *
eh
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_ *>(
icmph
 + 1);

282 
eh_Ën
 = 
Œª¥Üt_Ëngth
 - (
şick_icmp
);

283 ià(
eh_Ën
 < (è(
şick_
)) {

284 
§
 << "icm°uÄ—chabË " << 
code
 << ' ';

285 
Œunÿ‹d_icmp
;

288 cÚ¡ 
şick_udp
 *
eudph
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_ud°*>Ôeš‹½»t_ÿ¡<cÚ¡ 
ušt8_t
 *>(
eh
è+ (eh->
_hl
 << 2));

289 
eudph_Ën
 = 
eh_Ën
 - (
eh
->
_hl
 << 2);

291 
§
 << "icm°" << 
	`IPAdd»ss
(
eh
->
_d¡
è<< " uÄ—chabË " << 
code
;

292 
icmph
->
icmp_code
) {

293 
ICMP_UNREACH_PROTOCOL
:

294 
§
 << ' ' << 
	`uÅ¬£_´Ùo
(
eh
->
_p
, 
çl£
);

296 
ICMP_UNREACH_PORT
:

297 
§
 << ' ' << 
	`uÅ¬£_´Ùo
(
eh
->
_p
, 
Œue
);

298 ià(
eudph_Ën
 < 4)

299 
Œunÿ‹d_icmp
;

300 
§
 << '/' << 
	`Áohs
(
eudph
->
uh_dpÜt
);

302 
ICMP_UNREACH_NEEDFRAG
: {

303 cÚ¡ 
şick_icmp_Ãedäag
 *
nfh
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_icmp_Ãedäag *>(
icmph
);

304 ià(
nfh
->
icmp_Ãxtmtu
)

305 
§
 << " (mtu " << 
	`Áohs
(
nfh
->
icmp_Ãxtmtu
) << ')';

313 
§
 << "icmp ";

314 ià(
SŒšg
 
s
 = 
NameInfo
::
	`»vqu”y_št
(NameInfo::
T_ICMP_TYPE
, 
this
, 
icmph
->
icmp_ty³
))

315 
§
 << 
s
;

317 
§
 << "ty³ " << ()
icmph
->
icmp_ty³
;

318 ià(
SŒšg
 
s
 = 
NameInfo
::
	`»vqu”y_št
(NameInfo::
T_ICMP_CODE
 + 
icmph
->
icmp_ty³
, 
this
, icmph->
icmp_code
))

319 
§
 << ' ' << 
s
;

320 ià(
icmph
->
icmp_code
)

321 
§
 << " cod" << ()
icmph
->
icmp_code
;

326 
Œunÿ‹d_icmp
:

327 
§
 << "truncated-icmp";

328 
	}
}

330 
Pack‘
 *

331 
	gIPPršt
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

333 ià(!
_aùive
 || !
p
->
	`has_ÃtwÜk_h—d”
())

334  
p
;

336 
SŒšgAccum
 
§
;

338 ià(
_Ïb–
)

339 
§
 << 
_Ïb–
 << ": ";

340 ià(
_´št_time¡amp
)

341 
§
 << 
p
->
	`time¡amp_ªno
() << ": ";

342 ià(
_´št_agg»g©e
)

343 
§
 << '#' << 
	`AGGREGATE_ANNO
(
p
);

344 ià(
_´št_·št
)

345 
§
 << (
_´št_agg»g©e
 ? "." : "·šˆ"è<< ()
	`PAINT_ANNO
(
p
);

346 ià(
_´št_agg»g©e
 || 
_´št_·št
)

347 
§
 << ": ";

349 ià(
p
->
	`ÃtwÜk_Ëngth
(è< (è(
şick_
))

350 
§
 << "truncated-ip";

352 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

353 
_Ën
 = 
	`Áohs
(
h
->ip_len);

354 
·ylßd_Ën
 = 
_Ën
 - (
h
->
_hl
 << 2);

355 
Œª¥Üt_Ëngth
 = 
p
->
	`Œª¥Üt_Ëngth
();

356 ià(
Œª¥Üt_Ëngth
 > 
·ylßd_Ën
)

357 
Œª¥Üt_Ëngth
 = 
·ylßd_Ën
;

359 ià(
_´št_id
)

360 
§
 << "id " << 
	`Áohs
(
h
->
_id
) << ' ';

361 ià(
_´št_‰l
)

362 
§
 << "‰È" << ()
h
->
_‰l
 << ' ';

363 ià(
_´št_tos
)

364 
§
 << "to " << ()
h
->
_tos
 << ' ';

365 ià(
_´št_Ën
)

366 
§
 << "Ëngth " << 
_Ën
 << ' ';

368 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
)

369 
	`tı_lše
(
§
, 
p
, 
Œª¥Üt_Ëngth
);

370 ià(
h
->
_p
 =ğ
IP_PROTO_UDP
)

371 
	`udp_lše
(
§
, 
p
, 
Œª¥Üt_Ëngth
);

372 ià(
h
->
_p
 =ğ
IP_PROTO_ICMP
)

373 
	`icmp_lše
(
§
, 
p
, 
Œª¥Üt_Ëngth
);

375 
§
 << 
	`IPAdd»ss
(
h
->
_¤c
è<< " > " << IPAdd»ss(h->
_d¡
è<< ": ip-´Ùo-" << ()h->
_p
;

378 ià(
	`IP_ISFRAG
(
h
))

379 
§
 << " (äag " << 
	`Áohs
(
h
->
_id
è<< ':' << 
·ylßd_Ën
 << '@'

380 << ((
	`Áohs
(
h
->
_off
è& 
IP_OFFMASK
) << 3)

381 << ((
h
->
_off
 & 
	`htÚs
(
IP_MF
)) ? "+" : "") << ')';

384 ià(
_cÚ‹Ás
 > 0) {

385 cÚ¡ 
ušt8_t
 *
d©a
;

386 ià(
_·ylßd
) {

387 ià(
	`IP_FIRSTFRAG
(
h
è&& iph->
_p
 =ğ
IP_PROTO_TCP
)

388 
d©a
 = 
p
->
	`Œª¥Üt_h—d”
(è+ (p->
	`tı_h—d”
()->
th_off
 << 2);

389 ià(
	`IP_FIRSTFRAG
(
h
è&& iph->
_p
 =ğ
IP_PROTO_UDP
)

390 
d©a
 = 
p
->
	`Œª¥Üt_h—d”
(è+ (
şick_udp
);

392 
d©a
 = 
p
->
	`Œª¥Üt_h—d”
();

394 
d©a
 = 
p
->
	`d©a
();

396 
by‹s
 = 
_by‹s
;

397 ià(
d©a
 >ğ
p
->
	`’d_d©a
())

398 
by‹s
 = 0;

399 ià(
by‹s
 < 0 || (è(
p
->
	`’d_d©a
(è- 
d©a
) < bytes)

400 
by‹s
 = 
p
->
	`’d_d©a
(è- 
d©a
;

401 
amt
 = 3*
by‹s
 + (bytes/4+1) + 3*(bytes/24+1) + 1;

403 *
buf
 = 
§
.
	`»£rve
(
amt
);

404 *
Üig_buf
 = 
buf
;

406 ià(
buf
 && 
_cÚ‹Ás
 == 1) {

407 
i
 = 0; i < 
by‹s
; i++, 
d©a
++) {

408 ià((
i
 % 24) == 0) {

409 *
buf
++ = '\n'; *buf++ = ' '; *buf++ = ' ';

410 } ià((
i
 % 4) == 0)

411 *
buf
++ = ' ';

412 
	`¥rštf
(
buf
, "%02x", *
d©a
 & 0xff);

413 
buf
 += 2;

415 } ià(
buf
 && 
_cÚ‹Ás
 == 2) {

416 
i
 = 0; i < 
by‹s
; i++, 
d©a
++) {

417 ià((
i
 % 48) == 0) {

418 *
buf
++ = '\n'; *buf++ = ' '; *buf++ = ' ';

419 } ià((
i
 % 8) == 0)

420 *
buf
++ = ' ';

421 ià(*
d©a
 < 32 || *data > 126)

422 *
buf
++ = '.';

424 *
buf
++ = *
d©a
;

428 ià(
Üig_buf
) {

429 
	`as£¹
(
buf
 <ğ
Üig_buf
 + 
amt
);

430 
§
.
	`adju¡_Ëngth
(
buf
 - 
Üig_buf
);

435 #ià
CLICK_USERLEVEL


436 ià(
_outfe
) {

437 
§
 << '\n';

438 
	`ignÜe_»suÉ
(
	`fwr™e
(
§
.
	`d©a
(), 1, sa.
	`Ëngth
(), 
_outfe
));

441 
_”rh
->
	`mes§ge
("%s", 
§
.
	`c_¡r
());

443  
p
;

444 
	}
}

447 
	gIPPršt
::
	$add_hªdËrs
()

449 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
 | HªdËr::
CHECKBOX
 | HªdËr::
CALM
, &
_aùive
);

450 
	}
}

452 
CLICK_ENDDECLS


453 
EXPORT_ELEMENT
(
IPPršt
)

	@ip/ipprint.hh

1 #iâdeà
CLICK_IPPRINT_HH


2 
	#CLICK_IPPRINT_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


99 şas 
	cIPPršt
 : 
public
 
EËm’t
 {…ublic:

101 
	$IPPršt
(è
CLICK_COLD
;

102 ~
	$IPPršt
(è
CLICK_COLD
;

104 cÚ¡ *
	$şass_Çme
() const {  "IPPrint"; }

105 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

107 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

108 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

109 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

110 
	$add_hªdËrs
(è
CLICK_COLD
;

112 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

114 
´iv©e
:

116 
boŞ
 
_sw­
;

117 
boŞ
 
_aùive
;

118 
SŒšg
 
_Ïb–
;

119 
_by‹s
;

120 
boŞ
 
_´št_id
 : 1;

121 
boŞ
 
_´št_time¡amp
 : 1;

122 
boŞ
 
_´št_·št
 : 1;

123 
boŞ
 
_´št_tos
 : 1;

124 
boŞ
 
_´št_‰l
 : 1;

125 
boŞ
 
_´št_Ën
 : 1;

126 
boŞ
 
_´št_agg»g©e
 : 1;

127 
boŞ
 
_·ylßd
 : 1;

128 
_cÚ‹Ás
 : 2;

130 #ià
CLICK_USERLEVEL


131 
SŒšg
 
_outf’ame
;

132 
FILE
 *
_outfe
;

134 
E¼ÜHªdËr
 *
_”rh
;

136 
SŒšgAccum
 &
	`add»ss_·œ
(SŒšgAccum &
§
, cÚ¡ 
şick_
 *
h
);

137 
	$tı_lše
(
SŒšgAccum
 &, cÚ¡ 
Pack‘
 *, 
Œª¥Üt_Ën
) const;

138 
	$udp_lše
(
SŒšgAccum
 &, cÚ¡ 
Pack‘
 *, 
Œª¥Üt_Ën
) const;

139 
	$icmp_lše
(
SŒšgAccum
 &, cÚ¡ 
Pack‘
 *, 
Œª¥Üt_Ën
) const;

141 
	}
};

143 
	gCLICK_ENDDECLS


	@ip/ipratemon.cc

20 
	~<şick/cÚfig.h
>

21 
	~"¿‹mÚ.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/glue.hh
>

26 
	~<şick/sync.hh
>

27 
	~<şick/Î½c.h
>

28 
CLICK_DECLS


30 
	gIPR©eMÚ™Ü
::
	$IPR©eMÚ™Ü
()

31 : 
	`_couÁ_·ck‘s
(
Œue
), 
	`_ªno_·ck‘s
(true),

32 
	`_th»sh
(1), 
	`_memmax
(0), 
	`_¿tio
(1),

33 
	`_lock
(0), 
	`_ba£
(0), 
	`_®loûd_mem
(0), 
	`_fœ¡
(0),

34 
	`_Ï¡
(0), 
	$_´ev_d–‘ed
(0)

36 
	}
}

38 
	gIPR©eMÚ™Ü
::~
	$IPR©eMÚ™Ü
()

40 
	}
}

43 
IPR©eMÚ™Ü
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

45 
SŒšg
 
	gcouÁ_wh©
;

46 
	g_memmax
 = 0;

47 
	g_ªno_·ck‘s
 = 
Œue
;

48 ià(
Args
(
cÚf
, 
this
, 
”rh
)

49 .
»ad_mp
("TYPE", 
WÜdArg
(), 
couÁ_wh©
)

50 .
»ad_mp
("RATIO", 
FixedPoštArg
(16), 
_¿tio
)

51 .
»ad_mp
("THRESH", 
_th»sh
)

52 .
»ad_p
("MEMORY", 
_memmax
)

53 .
»ad_p
("ANNO", 
_ªno_·ck‘s
)

54 .
com¶‘e
() < 0)

56 ià(
	gcouÁ_wh©
.
uµ”
() == "PACKETS")

57 
_couÁ_·ck‘s
 = 
Œue
;

58 ià(
	gcouÁ_wh©
.
uµ”
() == "BYTES")

59 
_couÁ_·ck‘s
 = 
çl£
;

61  
	g”rh
->
”rÜ
("monitorype should be \"PACKETS\" or \"BYTES\"");

63 ià(
	g_memmax
 && _memmax < 
	gMEMMAX_MIN
)

64 
	g_memmax
 = 
MEMMAX_MIN
;

65 
	g_memmax
 *= 1024;

67 ià(
	g_¿tio
 > 0x10000)

68  
	g”rh
->
”rÜ
("ratio must be between 0‡nd 1");

71 
	g_th»sh
 = (
_th»sh
 * 
_¿tio
) >> 16;

77 
	gIPR©eMÚ™Ü
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

79 
	`£t_»£‰ime
();

81 
_lock
 = 
Ãw
 
	`Spšlock
();

82 ià(!
_lock
)

83  
”rh
->
	`”rÜ
("cannot create spinlock.");

86 
_ba£
 = 
Ãw
 
	`Sts
(
this
);

87 ià(!
_ba£
)

88  
”rh
->
	`”rÜ
("cannot‡llocate data structure.");

89 
_fœ¡
 = 
_Ï¡
 = 
_ba£
;

91 
	}
}

94 
	gIPR©eMÚ™Ü
::
	$ş—nup
(
CËªupSge
)

96 
d–‘e
 
_ba£
;

97 
d–‘e
 
_lock
;

98 
_ba£
 = 0;

99 
_lock
 = 0;

100 
	}
}

103 
	gIPR©eMÚ™Ü
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

106 
boŞ
 
ewma
 = ((è((
	`şick_¿ndom
(è>> 5è& 0xffffè<ğ
_¿tio
);

107 
_lock
->
	`acquœe
();

108 
	`upd©e_¿‹s
(
p
, 
pÜt
 =ğ0, 
ewma
);

109 
_lock
->
	`»Ëa£
();

110 
	`ouut
(
pÜt
).
	`push
(
p
);

111 
	}
}

113 
Pack‘
 *

114 
	gIPR©eMÚ™Ü
::
	$puÎ
(
pÜt
)

116 
Pack‘
 *
p
 = 
	`šput
(
pÜt
).
	`puÎ
();

117 ià(
p
) {

118 
boŞ
 
ewma
 = ((è((
	`şick_¿ndom
(è>> 5è& 0xffffè<ğ
_¿tio
);

119 
_lock
->
	`acquœe
();

120 
	`upd©e_¿‹s
(
p
, 
pÜt
 =ğ0, 
ewma
);

121 
_lock
->
	`»Ëa£
();

123  
p
;

124 
	}
}

127 
	gIPR©eMÚ™Ü
::
CouÁ”
*

128 
IPR©eMÚ™Ü
::
	$make_couÁ”
(
Sts
 *
s
, 
šdex
, 
MyEWMA
 *
¿‹
)

130 
CouÁ”
 *
c
 = 
NULL
;

135 ià(
_memmax
 && (
_®loûd_mem
 + (
CouÁ”
) > _memmax))

136  
NULL
;

137 ià(
¿‹
)

138 
c
 = 
s
->
couÁ”
[
šdex
] = 
Ãw
 
	`CouÁ”
(*
¿‹
);

140 
c
 = 
s
->
couÁ”
[
šdex
] = 
Ãw
 
CouÁ”
;

141 ià(!
c
)

142  
NULL
;

143 
_®loûd_mem
 +ğ(
CouÁ”
);

145  
c
;

146 
	}
}

149 
	gIPR©eMÚ™Ü
::
	$fÜûd_fŞd
()

151 
	#FOLD_INCREASE_FACTOR
 5.0

152 

	)

153 
³rc
 = (è(((è
_th»sh
è/ 
FOLD_INCREASE_FACTOR
);

154 
th»sh
 = 
_th»sh
; 
_®loûd_mem
 > 
_memmax
;h»sh +ğ
³rc
)

155 
	`fŞd
(
th»sh
);

156 
	}
}

171 
	#FOLD_FACTOR
 0.9

	)

173 
	gIPR©eMÚ™Ü
::
	$fŞd
(
th»sh
)

175 
fÜw¬d
 = (è
	`şick_¿ndom
(0, 1);

176 
_´ev_d–‘ed
 = 
_Ãxt_d–‘ed
 = 0;

177 
Sts
 *
s
 = (
fÜw¬d
 ? 
_fœ¡
 : 
_Ï¡
);

180 
memmax
;

181 ià(!(
memmax
 = 
_memmax
))

182 
memmax
 = (è(((è
_®loûd_mem
è* 
FOLD_FACTOR
);

185 
¡¬t
:

187 ià(!
s
->
_·»Á
)

192 
s
->
_·»Á
->
fwd_ªd_»v_¿‹
.
	`upd©e
(0);

193 ià(
s
->
_·»Á
->
fwd_ªd_»v_¿‹
.
	`sÿËd_av”age
(0è< 
th»sh
) {

194 ià(
s
->
_·»Á
->
fwd_ªd_»v_¿‹
.
	`sÿËd_av”age
(1è< 
th»sh
) {

195 
d–‘e
 
s
;

196 ià((
_®loûd_mem
 < 
memmax
) ||

197 !(
s
 = (
fÜw¬d
 ? 
_Ãxt_d–‘ed
 : 
_´ev_d–‘ed
)))

199 
¡¬t
;

202 } (
s
 = (
fÜw¬d
 ? s->
_Ãxt
 : s->
_´ev
)));

203 
	}
}

207 
	gIPR©eMÚ™Ü
::
	$show_ag–i¡
()

209 
	`şick_ch©‹r
("\n----------------");

210 
	`şick_ch©‹r
("_ba£ = %p, _fœ¡: %p, _Ï¡ = %p\n", 
_ba£
, 
_fœ¡
, 
_Ï¡
);

211 
Sts
 *
r
 = 
_fœ¡
;„;„ =„->
_Ãxt
)

212 
	`şick_ch©‹r
("¸ğ%p,„->_´ev = %p,„->_Ãxˆğ%p", 
r
,„->
_´ev
,„->
_Ãxt
);

213 
	}
}

219 
	gIPR©eMÚ™Ü
::
Sts
::
	$Sts
(
IPR©eMÚ™Ü
 *
m
)

221 
_rm
 = 
m
;

222 
_rm
->
	`upd©e_®loûd_mem
((*
this
));

223 
_·»Á
 = 0;

224 
_Ãxt
 = 
_´ev
 = 0;

226 
i
 = 0; i < 
MAX_COUNTERS
; i++)

227 
couÁ”
[
i
] = 0;

228 
	}
}

239 
	gIPR©eMÚ™Ü
::
Sts
::~
	$Sts
()

241 
i
 = 0; i < 
MAX_COUNTERS
; i++) {

242 ià(
couÁ”
[
i
]) {

243 
d–‘e
 
couÁ”
[
i
]->
Ãxt_Ëv–
;

244 
d–‘e
 
couÁ”
[
i
];

245 
_rm
->
	`upd©e_®loûd_mem
(-(
CouÁ”
));

246 
couÁ”
[
i
] = 0;

252 ià(
this
->
_´ev
) {

253 
this
->
_´ev
->
_Ãxt
 =his->_next;

254 
_rm
->
	`£t_´ev
(
this
->
_´ev
);

256 
_rm
->
	`£t_fœ¡
(
this
->
_Ãxt
);

257 if(
this
->
_Ãxt
)

258 
this
->
_Ãxt
->
_´ev
 = 0;

259 
_rm
->
	`£t_´ev
(0);

263 ià(
this
->
_Ãxt
) {

264 
this
->
_Ãxt
->
_´ev
 =his->_prev;

265 
_rm
->
	`£t_Ãxt
(
this
->
_Ãxt
);

267 
_rm
->
	`£t_Ï¡
(
this
->
_´ev
);

268 if(
this
->
_´ev
)

269 
this
->
_´ev
->
_Ãxt
 = 0;

270 
_rm
->
	`£t_Ãxt
(0);

274 ià(
this
->
_·»Á
)

275 
this
->
_·»Á
->
Ãxt_Ëv–
 = 0;

277 
_rm
->
	`upd©e_®loûd_mem
(-(*
this
));

278 
	}
}

283 
SŒšg


284 
	gIPR©eMÚ™Ü
::
	$´št
(
Sts
 *
s
, 
SŒšg
 

)

286 
SŒšg
 
»t
 = "";

287 
i
 = 0; i < 
Sts
::
MAX_COUNTERS
; i++) {

288 
CouÁ”
 *
c
;

289 ià(!(
c
 = 
s
->
couÁ”
[
i
]))

292 ià(
c
->
fwd_ªd_»v_¿‹
.
	`sÿËd_av”age
(1) > 0 ||

293 
c
->
fwd_ªd_»v_¿‹
.
	`sÿËd_av”age
(0) > 0) {

294 
SŒšg
 
this_
;

295 ià(

)

296 
this_
 = 

 + "." + 
	`SŒšg
(
i
);

298 
this_
 = 
	`SŒšg
(
i
);

299 
»t
 +ğ
this_
;

301 
c
->
fwd_ªd_»v_¿‹
.
	`upd©e
(0);

302 
»t
 += "\t";

303 
»t
 +ğ
c
->
fwd_ªd_»v_¿‹
.
	`uÅ¬£_¿‹
(0);

304 
»t
 += "\t";

305 
»t
 +ğ
c
->
fwd_ªd_»v_¿‹
.
	`uÅ¬£_¿‹
(1);

307 
»t
 += "\n";

308 ià(
c
->
Ãxt_Ëv–
)

309 
»t
 +ğ
	`´št
(
c
->
Ãxt_Ëv–
, "\t" + 
this_
);

312  
»t
;

313 
	}
}

316 
SŒšg


317 
	gIPR©eMÚ™Ü
::
	$look_»ad_hªdËr
(
EËm’t
 *
e
, *)

319 
IPR©eMÚ™Ü
 *
me
 = (IPR©eMÚ™Ü*è
e
;

321 
SŒšg
 
»t
 = 
	`SŒšg
(
EWMAP¬am‘”s
::
	`•och
(è- 
me
->
_»£‰ime
) + "\n";

323 ià(
me
->
_lock
->
	`©‹m±
()) {

324 
»t
 =„‘ + 
me
->
	`´št
(me->
_ba£
);

325 
me
->
_lock
->
	`»Ëa£
();

326  
»t
;

328  
»t
 + "unavailable\n";

330 
	}
}

333 
	gIPR©eMÚ™Ü
::
»£t_wr™e_hªdËr


334 (cÚ¡ 
SŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *)

336 
IPR©eMÚ™Ü
* 
	gme
 = (IPR©eMÚ™Ü *è
e
;

338 
	gme
->
	g_lock
->
acquœe
();

339 
	gi
 = 0; i < 
	gSts
::
MAX_COUNTERS
; i++) {

340 ià(
	gme
->
	g_ba£
->
	gcouÁ”
[
i
]) {

341 ià(
	gme
->
	g_ba£
->
	gcouÁ”
[
i
]->
	gÃxt_Ëv–
)

342 
d–‘e
 
	gme
->
	g_ba£
->
	gcouÁ”
[
i
]->
	gÃxt_Ëv–
;

343 
d–‘e
 
	gme
->
	g_ba£
->
	gcouÁ”
[
i
];

344 
	gme
->
	g_ba£
->
	gcouÁ”
[
i
] = 0;

347 
	gme
->
£t_»£‰ime
();

348 
	gme
->
	g_lock
->
»Ëa£
();

355 
	gIPR©eMÚ™Ü
::
memmax_wr™e_hªdËr


356 (cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

358 
	gVeùÜ
<
	gSŒšg
> 
	g¬gs
;

359 
ı_¬gvec
(
cÚf
, 
¬gs
);

360 
IPR©eMÚ™Ü
* 
	gme
 = (IPR©eMÚ™Ü *è
e
;

362 ià(
	g¬gs
.
size
() != 1) {

363 
”rh
->
”rÜ
("expecting 1 integer");

366 
	gmemmax
;

367 ià(!
IÁArg
().
·r£
(
¬gs
[0], 
memmax
)) {

368 
	g”rh
->
”rÜ
("not‡n integer");

372 ià(
	gmemmax
 && memmax < ()
	gMEMMAX_MIN
)

373 
	gmemmax
 = 
MEMMAX_MIN
;

375 
	gme
->
	g_lock
->
acquœe
();

376 
	gme
->
	g_memmax
 = 
memmax
 * 1024;

379 ià(
	gme
->
	g_memmax
 && me->
	g_®loûd_mem
 > me->_memmax)

380 
	gme
->
fÜûd_fŞd
();

381 
	gme
->
	g_lock
->
»Ëa£
();

388 
	gIPR©eMÚ™Ü
::
ªno_Ëv–_wr™e_hªdËr


389 (cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

391 
	gVeùÜ
<
	gSŒšg
> 
	g¬gs
;

392 
ı_¬gvec
(
cÚf
, 
¬gs
);

393 
IPR©eMÚ™Ü
* 
	gme
 = (IPR©eMÚ™Ü *è
e
;

394 
IPAdd»ss
 
	ga
;

395 
	gËv–
, 
	gwh’
;

397 ià(
	g¬gs
.
size
() != 3) {

398 
”rh
->
”rÜ
("expecting 3‡rguments");

402 ià(!
IPAdd»ssArg
().
·r£
(
¬gs
[0], 
a
)) {

403 
	g”rh
->
”rÜ
("not‡n IP‡ddress");

406 ià(!
IÁArg
().
·r£
(
¬gs
[1], 
Ëv–
è|| !(
	gËv–
 >= 0 &&†evel < 4)) {

407 
”rh
->
”rÜ
("2nd‡rgument specifies‡†evel, between 0‡nd 3,o‡nnotate");

410 ià(!
IÁArg
().
·r£
(
¬gs
[2], 
wh’
è|| 
	gwh’
 < 1) {

411 
	g”rh
->
”rÜ
("3rd‡rgument specifies whenhis„uleƒxpires, must be > 0");

415 
	gwh’
 *ğ
EWMAP¬am‘”s
::
•och_äequ’cy
();

416 
	gwh’
 +ğ
EWMAP¬am‘”s
::
•och
();

418 
	gme
->
	g_lock
->
acquœe
();

419 
	gaddr
 = 
a
.
addr
();

420 
	gme
->
£t_ªno_Ëv–
(
addr
, 
¡©ic_ÿ¡
<>(
Ëv–
),

421 
¡©ic_ÿ¡
<>(
wh’
));

422 
	gme
->
	g_lock
->
»Ëa£
();

428 
	gIPR©eMÚ™Ü
::
	$add_hªdËrs
()

430 
	`add_d©a_hªdËrs
("th»sh", 
HªdËr
::
OP_READ
, &
_th»sh
);

431 
	`add_»ad_hªdËr
("look", 
look_»ad_hªdËr
);

432 
	`add_d©a_hªdËrs
("mem", 
HªdËr
::
OP_READ
, &
_®loûd_mem
);

433 
	`add_d©a_hªdËrs
("memmax", 
HªdËr
::
OP_READ
, &
_memmax
);

435 
	`add_wr™e_hªdËr
("ªno_Ëv–", 
ªno_Ëv–_wr™e_hªdËr
);

436 
	`add_wr™e_hªdËr
("»£t", 
»£t_wr™e_hªdËr
, 0, 
HªdËr
::
BUTTON
);

437 
	`add_wr™e_hªdËr
("memmax", 
memmax_wr™e_hªdËr
);

438 
	}
}

441 
	gIPR©eMÚ™Ü
::
	$Î½c
(
commªd
, *
d©a
)

443 ià(
commªd
 =ğ
CLICK_LLRPC_IPRATEMON_LEVEL_FWD_AVG


444 || 
commªd
 =ğ
CLICK_LLRPC_IPRATEMON_LEVEL_REV_AVG
) {

458 
which
 = (
commªd
 =ğ
CLICK_LLRPC_IPRATEMON_LEVEL_FWD_AVG
 ? 0 : 1);

459 *
ud©a
 = (*)
d©a
;

460 
Ëv–
, 
addr
;

461 ià(
	`CLICK_LLRPC_GET
(
Ëv–
, 
ud©a
) < 0)

462  -
EFAULT
;

463 ià(
	`CLICK_LLRPC_GET
(
addr
, 
ud©a
 + 1) < 0)

464  -
EFAULT
;

465 ià(
Ëv–
 > 3)

466  -
EINVAL
;

468 
av”ages
[256];

470 
_lock
->
	`acquœe
();

473 
Sts
 *
s
 = 
_ba£
;

474 
addr
 = 
	`Áohl
(ipaddr);

475 
b™shiá
 = 24; b™shiá > 0 && 
Ëv–
 > 0; bitshift -= 8,†evel--) {

476 
b
 = (
addr
 >> 
b™shiá
) & 255;

477 ià(!
s
->
couÁ”
[
b
] || !s->couÁ”[b]->
Ãxt_Ëv–
) {

478 
_lock
->
	`»Ëa£
();

479  -
EAGAIN
;

481 
s
 = s->
couÁ”
[
b
]->
Ãxt_Ëv–
;

484 
äeq
 = 
EWMAP¬am‘”s
::
	`•och_äequ’cy
();

486 
i
 = 0; i < 256; i++) {

487 ià(
s
->
couÁ”
[
i
]) {

488 
s
->
couÁ”
[
i
]->
fwd_ªd_»v_¿‹
.
	`upd©e
(0);

489 
av”ages
[
i
] =

490 (
s
->
couÁ”
[
i
]->
fwd_ªd_»v_¿‹
.
	`sÿËd_av”age
(
which
è* 
äeq
è>> 
sÿË
;

493 
av”ages
[
i
] = -1;

496 
_lock
->
	`»Ëa£
();

498  
	`CLICK_LLRPC_PUT_DATA
(
d©a
, 
av”ages
, (averages));

502 ià(
commªd
 =ğ
CLICK_LLRPC_IPRATEMON_FWD_N_REV_AVG
) {

512 *
ud©a
 = (*)
d©a
;

513 
addr
;

514 ià(
	`CLICK_LLRPC_GET
(
addr
, 
ud©a
) < 0)

515  -
EFAULT
;

517 
av”ages
[9];

518 
n
 = 0;

520 
_lock
->
	`acquœe
();

523 
Sts
 *
s
 = 
_ba£
;

524 
addr
 = 
	`Áohl
(ipaddr);

525 
b™shiá
 = 24; bitshift >= 0; bitshift -= 8) {

526 
b
 = (
addr
 >> 
b™shiá
) & 255;

527 ià(!
s
->
couÁ”
[
b
])

530 
äeq
 = 
EWMAP¬am‘”s
::
	`•och_äequ’cy
();

531 
s
->
couÁ”
[
b
]->
fwd_ªd_»v_¿‹
.
	`upd©e
(0);

532 
av”ages
[
n
*2+1] =

533 (
s
->
couÁ”
[
b
]->
fwd_ªd_»v_¿‹
.
	`sÿËd_av”age
(0è* 
äeq
è>> 
sÿË
;

534 
av”ages
[
n
*2+2] =

535 (
s
->
couÁ”
[
b
]->
fwd_ªd_»v_¿‹
.
	`sÿËd_av”age
(1è* 
äeq
è>> 
sÿË
;

536 
n
++;

538 ià(!
s
->
couÁ”
[
b
]->
Ãxt_Ëv–
)

540 
s
 = s->
couÁ”
[
b
]->
Ãxt_Ëv–
;

543 
_lock
->
	`»Ëa£
();

545 
av”ages
[0] = 
n
;

546  
	`CLICK_LLRPC_PUT_DATA
(
d©a
, 
av”ages
, (averages));

549 ià(
commªd
 =ğ
CLICK_LLRPC_IPRATEMON_SET_ANNO_LEVEL
) {

557 *
ud©a
 = (*)
d©a
;

558 
addr
, 
Ëv–
, 
wh’
;

560 ià(
	`CLICK_LLRPC_GET
(
addr
, 
ud©a
) < 0)

561  -
EFAULT
;

563 ià(
	`CLICK_LLRPC_GET
(
Ëv–
, 
ud©a
+1) < 0 ||†evel > 3)

564  -
EFAULT
;

566 ià(
	`CLICK_LLRPC_GET
(
wh’
, 
ud©a
+2) < 0 || when < 1)

567  -
EFAULT
;

569 
wh’
 *ğ
EWMAP¬am‘”s
::
	`•och_äequ’cy
();

570 
wh’
 +ğ
EWMAP¬am‘”s
::
	`•och
();

572 
_lock
->
	`acquœe
();

573 
	`£t_ªno_Ëv–
(
addr
, 
¡©ic_ÿ¡
<>(
Ëv–
),

574 
¡©ic_ÿ¡
<>(
wh’
));

575 
_lock
->
	`»Ëa£
();

580  
EËm’t
::
	`Î½c
(
commªd
, 
d©a
);

581 
	}
}

583 
	$EXPORT_ELEMENT
(
IPR©eMÚ™Ü
)

584 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

585 
CLICK_ENDDECLS


	@ip/ipratemon.hh

1 #iâdeà
CLICK_IPRATEMON_HH


2 
	#CLICK_IPRATEMON_HH


	)

3 
	~<şick/glue.hh
>

4 
	~<şickÃt/.h
>

5 
	~<şick/–em’t.hh
>

6 
	~<şick/ewma.hh
>

7 
	~<şick/veùÜ.hh
>

8 
	~<şick/·ck‘_ªno.hh
>

9 
CLICK_DECLS


68 
şass
 
	gSpšlock
;

70 şas 
	cIPR©eMÚ™Ü
 : 
public
 
EËm’t
 {

71 
public
:

74 
¡ab™y_shiá
 = 5,

75 
	msÿË
 = 10

78 
	gEWMAP¬am‘”s
 : 
public
 
FixedEWMAXP¬am‘”s
<
¡ab™y_shiá
, 
	gsÿË
> {

80 
	g¿‹_couÁ
 = 2

83 
•och
() {

84  
şick_jiff›s
() >> 3;

87 
•och_äequ’cy
() {

88  
	gCLICK_HZ
 >> 3;

93 
	$IPR©eMÚ™Ü
(è
CLICK_COLD
;

94 ~
	$IPR©eMÚ™Ü
(è
CLICK_COLD
;

96 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "IPR©eMÚ™Ü"; 
	}
}

97 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1-2/1-2"; 
	}
}

99 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

100 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

101 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

103 
	$£t_»£‰ime
() {

104 
_»£‰ime
 = 
EWMAP¬am‘”s
::
	`•och
();

105 
	}
}

106 
£t_ªno_Ëv–
(
addr
, 
Ëv–
, 
wh’
);

108 
push
(
pÜt
, 
Pack‘
 *
p
);

109 
Pack‘
 *
puÎ
(
pÜt
);

111 
Î½c
(, *);

113 
	gR©eEWMAX
<
	tEWMAP¬am‘”s
> 
	tMyEWMA
;

114 
	gSts
; 
	gCouÁ”
;

116 
	sCouÁ”
 {

119 
MyEWMA
 
	gfwd_ªd_»v_¿‹
;

120 
Sts
 *
	gÃxt_Ëv–
;

121 
	gªno_this
;

122 
CouÁ”
()

123 : 
Ãxt_Ëv–
(0), 
ªno_this
(0) {

125 
CouÁ”
(cÚ¡ 
MyEWMA
 &
ewma
)

126 : 
fwd_ªd_»v_¿‹
(
ewma
), 
Ãxt_Ëv–
(0), 
ªno_this
(0) {

130 
	sSts
 {

132 ’um { 
	gMAX_COUNTERS
 = 256 };

134 
CouÁ”
 *
	g_·»Á
;

135 
Sts
 *
	g_´ev
, *
	g_Ãxt
;

137 
CouÁ”
* 
	gcouÁ”
[
MAX_COUNTERS
];

138 
Sts
(
IPR©eMÚ™Ü
 *
m
);

139 ~
Sts
(è
	gCLICK_COLD
;

141 
	g´iv©e
:

142 
IPR©eMÚ™Ü
 *
_rm
;

145 
	g´Ùeùed
:

148 
ä›nd
 
Sts
;

149 
	$£t_´ev
(
Sts
 *
s
è{ 
_´ev_d–‘ed
 = s; 
	}
}

150 
	$£t_Ãxt
(
Sts
 *
s
è{ 
_Ãxt_d–‘ed
 = s; 
	}
}

151 
	$£t_fœ¡
(
Sts
 *
s
è{ 
_fœ¡
 = s; 
	}
}

152 
	$£t_Ï¡
(
Sts
 *
s
è{ 
_Ï¡
 = s; 
	}
}

153 
	$upd©e_®loûd_mem
(
ssize_t
 
m
è{ 
_®loûd_mem
 +ğm; 
	}
}

155 
	g´iv©e
:

157 ’um { 
MAX_SHIFT
 = 24, 
	gPERIODIC_FOLD_INIT
 = 8192, 
	gMEMMAX_MIN
 = 100 };

160 
boŞ
 
	g_couÁ_·ck‘s
;

161 
boŞ
 
	g_ªno_·ck‘s
;

162 
	g_th»sh
;

163 
size_t
 
	g_memmax
;

164 
	g_¿tio
;

165 
Spšlock
* 
	g_lock
;

167 
Sts
 *
	g_ba£
;

168 
	g_»£‰ime
;

169 
size_t
 
	g_®loûd_mem
;

170 
Sts
 *
	g_fœ¡
, *
	g_Ï¡
;

172 
Sts
 *
	g_´ev_d–‘ed
, *
	g_Ãxt_d–‘ed
;

174 
upd©e_¿‹s
(
Pack‘
 *, 
boŞ
, bool);

175 
upd©e
(, , 
Pack‘
 *, 
boŞ
, bool);

176 
fÜûd_fŞd
();

177 
fŞd
();

178 
CouÁ”
 *
make_couÁ”
(
Sts
 *, , 
MyEWMA
 *);

180 
show_ag–i¡
();

182 
SŒšg
 
´št
(
Sts
 *
s
, SŒšg 

 = "");

184 
	$add_hªdËrs
(è
CLICK_COLD
;

185 
SŒšg
 
	$look_»ad_hªdËr
(
EËm’t
 *
e
, *è
CLICK_COLD
;

186 
SŒšg
 
	$wh©_»ad_hªdËr
(
EËm’t
 *
e
, *è
CLICK_COLD
;

187 
»£t_wr™e_hªdËr


188 (cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

189 
memmax_wr™e_hªdËr


190 (cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

191 
ªno_Ëv–_wr™e_hªdËr


192 (cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

193 
	}
};

195 
šlše
 

196 
	gIPR©eMÚ™Ü
::
	$£t_ªno_Ëv–
(
addr
, 
Ëv–
, 
wh’
)

198 
Sts
 *
s
 = 
_ba£
;

199 
CouÁ”
 *
c
 = 0;

200 
b™shiá
;

202 
addr
 = 
	`Áohl
(addr);

205 
b™shiá
 = 24; bitshift >= 0; bitshift -= 8) {

206 
by‹
 = (
addr
 >> 
b™shiá
) & 255;

208 ià(!(
c
 = 
s
->
couÁ”
[
by‹
]))

211 ià(
Ëv–
 == 0) {

212 
c
->
ªno_this
 = 
wh’
;

213 
d–‘e
 
c
->
Ãxt_Ëv–
;

214 
c
->
Ãxt_Ëv–
 = 0;

218 ià(!
c
->
Ãxt_Ëv–
)

221 
s
 = 
c
->
Ãxt_Ëv–
;

222 
Ëv–
--;

224 
	}
}

229 
šlše
 

230 
	gIPR©eMÚ™Ü
::
	$upd©e
(
addr
, 
v®
, 
Pack‘
 *
p
,

231 
boŞ
 
fÜw¬d
, boŞ 
upd©e_ewma
)

233 
Sts
 *
s
 = 
_ba£
;

234 
CouÁ”
 *
c
 = 0;

235 
now
 = 
EWMAP¬am‘”s
::
	`•och
();

236 
´ev_fŞd_time
 = 
now
;

239 
addr
 = 
	`Áohl
(addr);

241 
b™shiá
;

242 
b™shiá
 = 24; bitshift >= 0; bitshift -= 8) {

243 
by‹
 = (
addr
 >> 
b™shiá
) & 255;

246 ià(!(
c
 = 
s
->
couÁ”
[
by‹
]))

247 ià(!(
c
 = 
	`make_couÁ”
(
s
, 
by‹
, 
NULL
)))

252 if(
upd©e_ewma
) {

253 ià(
fÜw¬d
)

254 
c
->
fwd_ªd_»v_¿‹
.
	`upd©e
(
v®
,0);

256 
c
->
fwd_ªd_»v_¿‹
.
	`upd©e
(
v®
,1);

260 ià(!
c
->
Ãxt_Ëv–
)

262 
s
 = 
c
->
Ãxt_Ëv–
;

265 
fwd_¿‹
 = 
c
->
fwd_ªd_»v_¿‹
.
	`sÿËd_av”age
(0);

266 
»v_¿‹
 = 
c
->
fwd_ªd_»v_¿‹
.
	`sÿËd_av”age
(1);

267 
äeq
 = 
EWMAP¬am‘”s
::
	`•och_äequ’cy
();

268 
fwd_¿‹
 = (fwd_¿‹ * 
äeq
è>> 
sÿË
;

269 
»v_¿‹
 = (»v_¿‹ * 
äeq
è>> 
sÿË
;

271 ià(
_ªno_·ck‘s
) {

273 
	`SET_FWD_RATE_ANNO
(
p
, 
fwd_¿‹
);

274 
	`SET_REV_RATE_ANNO
(
p
, 
»v_¿‹
);

286 ià(
c
->
ªno_this
 < 
now
 &&

287 (
fwd_¿‹
 >ğ
_th»sh
 || 
»v_¿‹
 >= _thresh) &&

288 ((
b™shiá
 > 0) &&

289 (!
_memmax
 || (
_®loûd_mem
+(
CouÁ”
)+(
Sts
)) <= _memmax)))

291 
b™shiá
 -= 8;

292 
Ãxt_by‹
 = (
addr
 >> 
b™shiá
) & 255;

293 ià(!(
c
->
Ãxt_Ëv–
 = 
Ãw
 
	`Sts
(
this
)) ||

294 !
	`make_couÁ”
(
c
->
Ãxt_Ëv–
, 
Ãxt_by‹
, &c->
fwd_ªd_»v_¿‹
))

296 if(
c
->
Ãxt_Ëv–
) {

297 
d–‘e
 
c
->
Ãxt_Ëv–
;

298 
c
->
Ãxt_Ëv–
 = 0;

304 
c
->
Ãxt_Ëv–
->
_·»Á
 = c;

307 
_Ï¡
->
_Ãxt
 = 
c
->
Ãxt_Ëv–
;

308 
c
->
Ãxt_Ëv–
->
_Ãxt
 = 0;

309 
c
->
Ãxt_Ëv–
->
_´ev
 = 
_Ï¡
;

310 
_Ï¡
 = 
c
->
Ãxt_Ëv–
;

313 if(
now
 - 
´ev_fŞd_time
 >ğ
EWMAP¬am‘”s
::
	`•och_äequ’cy
()) {

314 
	`fŞd
(
_th»sh
);

315 
´ev_fŞd_time
 = 
now
;

317 
	}
}

322 
šlše
 

323 
	gIPR©eMÚ™Ü
::
	$upd©e_¿‹s
(
Pack‘
 *
p
, 
boŞ
 
fÜw¬d
, boŞ 
upd©e_ewma
)

325 cÚ¡ 
şick_
 *

 = 
p
->
	`_h—d”
();

326 
v®
 = 
_couÁ_·ck‘s
 ? 1 : 
	`Áohs
(

->
_Ën
);

328 ià(
fÜw¬d
)

329 
	`upd©e
(

->
_¤c
.
s_addr
, 
v®
, 
p
, 
Œue
, 
upd©e_ewma
);

331 
	`upd©e
(

->
_d¡
.
s_addr
, 
v®
, 
p
, 
çl£
, 
upd©e_ewma
);

332 
	}
}

334 
	gCLICK_ENDDECLS


	@ip/ipreassembler.cc

22 
	~<şick/cÚfig.h
>

23 
	~"»as£mbËr.hh
"

24 
	~<şick/add»ss.hh
>

25 
	~<şick/¬gs.hh
>

26 
	~<şick/b™veùÜ.hh
>

27 
	~<şick/”rÜ.hh
>

28 
	~<şick/glue.hh
>

29 
	~<şick/·ck‘_ªno.hh
>

30 
	~<şick/¡¿ccum.hh
>

31 
	~<şick/æowid.hh
>

32 
	gCLICK_DECLS


34 
	#PACKET_CHUNK
(
p
è(*((
ChunkLšk
 *)(Õ)->
	`ªno_u8
(è+ 
IPREASSEMBLER_ANNO_OFFSET
)))

	)

35 
	#PACKET_DLEN
(
p
è(Õ)->
	`Œª¥Üt_Ëngth
())

	)

36 
	#IP_BYTE_OFF
(
h
è((
	`Áohs
((h)->
_off
è& 
IP_OFFMASK
è<< 3)

	)

38 
	gIPR—s£mbËr
::
	$IPR—s£mbËr
()

39 : 
	`_¡©_äags_£’
(0), 
	`_¡©_good_as£m
(0), 
	`_¡©_çed_as£m
(0), 
	$_¡©_bad_pkts
(0)

41 
i
 = 0; i < 
NMAP
; i++)

42 
_m­
[
i
] = 0;

43 
	`¡©ic_as£¹
(
IPREASSEMBLER_ANNO_OFFSET
 + 
IPREASSEMBLER_ANNO_SIZE
 <ğ
Pack‘
::
ªno_size
, "annooo big");

44 
	`¡©ic_as£¹
((
ChunkLšk
è=ğ
IPREASSEMBLER_ANNO_SIZE
, "sizeof(ChunkLink) isƒxpectedoƒqual IPREASSEMBLER_ANNO_SIZE.");

45 
	}
}

47 
	gIPR—s£mbËr
::~
	$IPR—s£mbËr
()

49 
	}
}

52 
IPR—s£mbËr
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

54 
	g_mem_high_th»sh
 = 256 * 1024;

55 
	gmtu_ªno
 = -1;

56 ià(
Args
(
cÚf
, 
this
, 
”rh
)

57 .
»ad
("HIMEM", 
_mem_high_th»sh
)

58 .
»ad
("MAX_MTU_ANNO", 
AÂoArg
(2), 
mtu_ªno
)

59 .
com¶‘e
() < 0)

61 
	g_mtu_ªno
 = 
mtu_ªno
;

62 
	g_mem_low_th»sh
 = (
_mem_high_th»sh
 >> 2) * 3;

67 
	gIPR—s£mbËr
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

69 
_mem_u£d
 = 0;

70 
_»­_time
 = 0;

72 
	}
}

75 
	gIPR—s£mbËr
::
	$ş—nup
(
CËªupSge
)

77 
i
 = 0; i < 
NMAP
; i++)

78 
_m­
[
i
]) {

79 
Wr™abËPack‘
 *
Ãxt
 = (Wr™abËPack‘ *)(
_m­
[
i
]->
	`Ãxt
());

80 
_m­
[
i
]->
	`kl
();

81 
_m­
[
i
] = 
Ãxt
;

83 
	}
}

86 
	gIPR—s£mbËr
::
	$check_”rÜ
(
E¼ÜHªdËr
 *
”rh
, 
buck‘
, cÚ¡ 
Pack‘
 *
p
, cÚ¡ *
fÜm©
, ...)

88 
va_li¡
 
v®
;

89 
	`va_¡¬t
(
v®
, 
fÜm©
);

90 
SŒšgAccum
 
§
;

91 
§
 << "buck " << 
buck‘
 << ": ";

92 ià(
p
->
	`has_ÃtwÜk_h—d”
()) {

93 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

94 
§
 << 
h
->
_¤c
 << " > " << iph->
_d¡
 << " [" << 
	`Áohs
(h->
_id
è<< ':' << 
	`PACKET_DLEN
(
p
è<< ((h->
_off
 & 
	`htÚs
(
IP_MF
)) ? "+]: " : "]: ");

96 
§
 << 
fÜm©
;

97 
”rh
->
	`xmes§ge
(
E¼ÜHªdËr
::
e_”rÜ
, 
§
.
	`c_¡r
(), 
v®
);

98 
	`va_’d
(
v®
);

99 
	}
}

102 
	gIPR—s£mbËr
::
	$check
(
E¼ÜHªdËr
 *
”rh
)

104 ià(!
”rh
)

105 
”rh
 = 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
();

106 
ušt32_t
 
mem_u£d
 = 0;

107 
b
 = 0; b < 
NMAP
; b++)

108 
Wr™abËPack‘
 *
q
 = 
_m­
[
b
]; q; q = (Wr™abËPack‘ *)(q->
	`Ãxt
()))

109 ià(
q
->
	`has_ÃtwÜk_h—d”
()) {

110 cÚ¡ 
şick_
 *
q
 = 
q
->
	`_h—d”
();

111 ià(
	`buck‘no
(
q
è!ğ
b
)

112 
	`check_”rÜ
(
”rh
, 
b
, 
q
, "in wrong bucket");

113 
mem_u£d
 +ğ
IPH_MEM_USED
 + 
q
->
	`Œª¥Üt_Ëngth
();

114 
ChunkLšk
 *
chunk
 = &
	`PACKET_CHUNK
(
q
);

115 
off
 = 0;

116 #ià
VERBOSE_DEBUG


117 
	`check_”rÜ
(
”rh
, 
b
, 
q
, "");

118 
SŒšgAccum
 
§
;

119 
chunk
 && (!
off
 || ofà< 
q
->
	`Œª¥Üt_Ëngth
())) {

120 
§
 << " (" << 
chunk
->
off
 << ',' << chunk->
Ï¡off
 << ')';

121 
off
 = 
chunk
->
Ï¡off
;

122 
chunk
 = 
	`Ãxt_chunk
(
q
, chunk);

124 
”rh
->
	`mes§ge
(" %s", 
§
.
	`c_¡r
());

125 
chunk
 = &
	`PACKET_CHUNK
(
q
);

126 
off
 = 0;

128 
chunk
) {

129 ià(
chunk
->
off
 >ğchunk->
Ï¡off


130 || 
chunk
->
Ï¡off
 > 
q
->
	`Œª¥Üt_Ëngth
()

131 || (
off
 !ğ0 && 
chunk
->off < off + 8)) {

132 
	`check_”rÜ
(
”rh
, 
b
, 
q
, "bad chunk (%d, %dè© %d", 
chunk
->
off
, chunk->
Ï¡off
, off);

135 
off
 = 
chunk
->
Ï¡off
;

136 
chunk
 = 
	`Ãxt_chunk
(
q
, chunk);

139 
”rh
->
	`”rÜ
("buck %d: missšg IP h—d”", 
b
);

140 ià(
mem_u£d
 !ğ
_mem_u£d
)

141 
”rh
->
	`”rÜ
("bad mem_u£d: hav%u, cÏim %u", 
mem_u£d
, 
_mem_u£d
);

143 
	}
}

145 
SŒšg


146 
	gIPR—s£mbËr
::
	$debug_dump
(
EËm’t
 *
e
, *)

148 
IPR—s£mbËr
 *
r
 = (IPR—s£mbË¸*è
e
;

149 
r
->
	`check
();

150 
SŒšgAccum
 
§
;

151 
§
 <<

152 "äag £’Ù®: " << 
r
->
_¡©_äags_£’
 << "\n"

153 "good„—s£mbl›s: " << 
r
->
_¡©_good_as£m
 << "\n"

154 "çed„—s£mbl›s: " << 
r
->
_¡©_çed_as£m
 << "\n"

155 "bad f¿gm’t £’: " << 
r
->
_¡©_bad_pkts
 << "\n"

157 
b
 = 0; b < 
NMAP
; b++)

158 
Wr™abËPack‘
 *
q
 = 
r
->
_m­
[
b
]; q; q = (Wr™abËPack‘ *)(q->
	`Ãxt
()))

159 ià(cÚ¡ 
şick_
 *
q
 = 
q
->
	`_h—d”
()) {

160 
§
 << ' ' << 
	`IPFlowID
(
q
è<< ' ' << 
	`Áohs
(q->
_id
);

161 
ChunkLšk
 *
chunk
 = &
	`PACKET_CHUNK
(
q
);

162 
chunk
 &&

163 (
chunk
->
Ï¡off
 > chunk->
off
) &&

164 (
chunk
->
Ï¡off
 <ğ
q
->
	`Œª¥Üt_Ëngth
())) {

165 
§
 << " (" << 
chunk
->
off
 << ',' << chunk->
Ï¡off
 << ')';

166 
chunk
 = 
	`Ãxt_chunk
(
q
, chunk);

168 
§
 << '\n';

170  
§
.
	`ke_¡ršg
();

171 
	}
}

173 
Wr™abËPack‘
 *

174 
	gIPR—s£mbËr
::
	$fšd_queue
(
Pack‘
 *
p
, 
Wr™abËPack‘
 ***
¡Üe_µ»v
)

176 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

177 
buck‘
 = 
	`buck‘no
(
h
);

178 
Wr™abËPack‘
 **
µ»v
 = &
_m­
[
buck‘
];

179 
Wr™abËPack‘
 *
q
;

180 
q
 = *
µ»v
; q;…´ev = (
Wr™abËPack‘
 **)&q->
	`Ãxt
(), q = *pprev) {

181 cÚ¡ 
şick_
 *
qh
 = 
q
->
	`_h—d”
();

182 ià(
	`§me_£gm’t
(
h
, 
qh
)) {

183 *
¡Üe_µ»v
 = 
µ»v
;

184  
q
;

187 *
¡Üe_µ»v
 = &
_m­
[
buck‘
];

189 
	}
}

191 
Pack‘
 *

192 
	gIPR—s£mbËr
::
	$em™_whŞe_·ck‘
(
Wr™abËPack‘
 *
q
, Wr™abËPack‘ **
q_µ»v
,

193 
Pack‘
 *
p_š
)

195 ++
_¡©_good_as£m
;

196 *
q_µ»v
 = (
Wr™abËPack‘
 *)
q
->
	`Ãxt
();

198 
şick_
 *
q_h
 = 
q
->
	`_h—d”
();

199 
q_h
->
_Ën
 = 
	`htÚs
(
q
->
	`ÃtwÜk_Ëngth
());

200 
q_h
->
_sum
 = 0;

201 
q_h
->
_sum
 = 
	`şick_š_cksum
((cÚ¡ *)q_h, q_h->
_hl
 << 2);

204 
	`mem£t
(&
	`PACKET_CHUNK
(
q
), 0, (
ChunkLšk
));

205 
q
->
	`£t_time¡amp_ªno
(
p_š
->
	`time¡amp_ªno
());

206 
q
->
	`£t_Ãxt
(0);

208 
p_š
->
	`kl
();

209 
_mem_u£d
 -ğ
IPH_MEM_USED
 + 
q
->
	`Œª¥Üt_Ëngth
();

210  
q
;

211 
	}
}

214 
	gIPR—s£mbËr
::
	$make_queue
(
Pack‘
 *
p
, 
Wr™abËPack‘
 **
q_µ»v
)

216 
p_off
 = 
	`IP_BYTE_OFF
(
p
->
	`_h—d”
());

217 
p_Ï¡off
 = 
p_off
 + 
	`PACKET_DLEN
(
p
);

218 
Wr™abËPack‘
 *
q
;

220 ià(
p_off
 == 0) {

221 
q
 = 
p
->
	`uniqueify
();

222 ià(!
q
) {

223 
	`şick_ch©‹r
("out of memory");

227 
q
 = 
Pack‘
::
	`make
(
p
->
	`h—droom
(è+…->
	`_h—d”_off£t
(), 0, 20 + 
p_Ï¡off
, 0);

228 ià(!
q
) {

229 
p
->
	`kl
();

230 
	`şick_ch©‹r
("out of memory");

233 
q
->
	`£t__h—d”
((
şick_
 *)q->
	`d©a
(), 20);

234 
	`memıy
(
q
->
	`_h—d”
(), 
p
->ip_header(), 20);

236 
	`memıy
(
q
->
	`Œª¥Üt_h—d”
(è+ 
p_off
, 
p
->Œª¥Üt_h—d”(), 
	`PACKET_DLEN
(p));

237 
p
->
	`kl
();

240 
_mem_u£d
 +ğ
IPH_MEM_USED
 + 
p_Ï¡off
;

242 
şick_
 *
q_h
 = 
q
->
	`_h—d”
();

243 
q_h
->
_off
 = (q_h->_ofà& ~
	`htÚs
(
IP_OFFMASK
));

245 ià(
_mtu_ªno
 >= 0)

246 
q
->
	`£t_ªno_u16
(
_mtu_ªno
, q->
	`ÃtwÜk_Ëngth
());

248 
	`PACKET_CHUNK
(
q
).
off
 = 
p_off
;

249 
	`PACKET_CHUNK
(
q
).
Ï¡off
 = 
p_Ï¡off
;

252 
q
->
	`£t_Ãxt
(*
q_µ»v
);

253 *
q_µ»v
 = 
q
;

255 
	`check
();

256 
	}
}

258 
	gIPR—s£mbËr
::
ChunkLšk
 *

259 
IPR—s£mbËr
::
	$Ãxt_chunk
(
Wr™abËPack‘
 *
q
, 
ChunkLšk
 *
chunk
)

261 ià(
chunk
->
Ï¡off
 >ğ
q
->
	`Œª¥Üt_Ëngth
())

264  (
ChunkLšk
 *)(
q
->
	`Œª¥Üt_h—d”
(è+ 
chunk
->
Ï¡off
);

265 
	}
}

267 
Pack‘
 *

268 
	gIPR—s£mbËr
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

271 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

272 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

273 ià(!
	`IP_ISFRAG
(
h
))

274  
p
;

276 ++
_¡©_äags_£’
;

279 
now
 = 
p
->
	`time¡amp_ªno
().
	`£c
();

280 ià(!
now
) {

281 
p
->
	`time¡amp_ªno
().
	`assign_now
();

282 
now
 = 
p
->
	`time¡amp_ªno
().
	`£c
();

284 ià(
now
 >ğ
_»­_time
)

285 
	`»­
(
now
);

288 
p_off
 = 
	`IP_BYTE_OFF
(
h
);

289 
p_Ï¡off
 = 
p_off
 + 
	`Áohs
(
h
->
_Ën
è- (h->
_hl
 << 2);

293 ià(
p_Ï¡off
 > 0xFFFF ||…_Ï¡ofà<ğ
p_off


294 || ((
p_Ï¡off
 & 7è!ğ0 && (
h
->
_off
 & 
	`htÚs
(
IP_MF
)) != 0)

295 || 
	`PACKET_DLEN
(
p
è< 
p_Ï¡off
 - 
p_off
) {

296 
p
->
	`kl
();

297 ++
_¡©_bad_pkts
;

300 
p
->
	`ke
(
	`PACKET_DLEN
Õè- (
p_Ï¡off
 - 
p_off
));

305 ià(
_mem_u£d
 > 
_mem_high_th»sh
)

306 
	`»­_ov”fuÎ
(
now
);

309 
Wr™abËPack‘
 **
q_µ»v
;

310 
Wr™abËPack‘
 *
q
 = 
	`fšd_queue
(
p
, &
q_µ»v
);

311 ià(!
q
) {

312 
	`make_queue
(
p
, 
q_µ»v
);

315 
Wr™abËPack‘
 *
q_buck‘_Ãxt
 = (Wr™abËPack‘ *)(
q
->
	`Ãxt
());

317 ià(
_mtu_ªno
 >ğ0 && 
q
->
	`ªno_u16
(_mtu_ªnoè< 
p
->
	`ÃtwÜk_Ëngth
())

318 
q
->
	`£t_ªno_u16
(
_mtu_ªno
, 
p
->
	`ÃtwÜk_Ëngth
());

321 ià(
p_Ï¡off
 > 
q
->
	`Œª¥Üt_Ëngth
()) {

323 ià(!(
q
->
	`_h—d”
()->
_off
 & 
	`htÚs
(
IP_MF
))) {

324 
p
->
	`kl
();

331 
Şd_Œª¥Üt_Ëngth
 = 
q
->
	`Œª¥Üt_Ëngth
();

332 
	`as£¹
((
Şd_Œª¥Üt_Ëngth
 & 7) == 0);

333 
wªt_¥aû
 = 
p_Ï¡off
 - 
Şd_Œª¥Üt_Ëngth
 + 8;

334 ià(
h
->
_off
 & 
	`htÚs
(
IP_MF
))

335 
wªt_¥aû
 +ğ(
p_Ï¡off
 - 
p_off
);

337 ià(!(
q
 = q->
	`put
(
wªt_¥aû
))) {

338 
	`şick_ch©‹r
("out of memory");

339 *
q_µ»v
 = 
q_buck‘_Ãxt
;

340 
_mem_u£d
 -ğ
IPH_MEM_USED
 + 
Şd_Œª¥Üt_Ëngth
;

341 
p
->
	`kl
();

345 
q
->
	`ke
(q->
	`Œª¥Üt_Ëngth
(è- 
p_Ï¡off
);

347 *
q_µ»v
 = 
q
;

348 
ChunkLšk
 *
Ï¡_chunk
 = (ChunkLšk *)(
q
->
	`Œª¥Üt_h—d”
(è+ 
Şd_Œª¥Üt_Ëngth
);

349 
Ï¡_chunk
->
off
 =†a¡_chunk->
Ï¡off
 = 
p_Ï¡off
;

350 
_mem_u£d
 +ğ
p_Ï¡off
 - 
Şd_Œª¥Üt_Ëngth
;

354 
ChunkLšk
 *
chunk
 = &
	`PACKET_CHUNK
(
q
);

355 
chunk
->
Ï¡off
 < 
p_off
)

356 
chunk
 = 
	`Ãxt_chunk
(
q
, chunk);

357 
ChunkLšk
 *
Ï¡
 = 
chunk
;

358 
Ï¡
 &&†a¡->
Ï¡off
 < 
p_Ï¡off
)

359 
Ï¡
 = 
	`Ãxt_chunk
(
q
,†ast);

362 
	`as£¹
(
chunk
 && 
Ï¡
);

363 ià(
p_Ï¡off
 < 
Ï¡
->
off
) {

364 
ChunkLšk
 *
Ãw_chunk
 = (ChunkLšk *)(
q
->
	`Œª¥Üt_h—d”
(è+ 
p_Ï¡off
);

365 *
Ãw_chunk
 = *
Ï¡
;

366 
chunk
->
Ï¡off
 = 
p_Ï¡off
;

368 
chunk
->
Ï¡off
 = 
Ï¡
->lastoff;

369 ià(
p_off
 < 
chunk
->
off
)

370 
chunk
->
off
 = 
p_off
;

373 
	`memıy
(
q
->
	`Œª¥Üt_h—d”
(è+ 
p_off
, 
p
->Œª¥Üt_h—d”(), 
p_Ï¡off
 -…_off);

376 ià(
p_off
 == 0) {

377 
ušt16_t
 
Şd__off
 = 
q
->
	`_h—d”
()->
_off
;

378 
h—d”_d–
 = 
p
->
	`_h—d”_off£t
(è- 
q
->ip_header_offset();

379 ià(
h—d”_d–
 > 0)

380 
q
 = q->
	`push
(
h—d”_d–
);

381 ià(
h—d”_d–
 < 0)

382 
q
->
	`puÎ
(-
h—d”_d–
);

383 
q
->
	`£t__h—d”
((
şick_
 *)(q->
	`d©a
(è+ 
p
->
	`_h—d”_off£t
()),…->
	`_h—d”_Ëngth
());

384 ià(
p
->
	`has_mac_h—d”
())

385 
q
->
	`£t_mac_h—d”
((q->
	`d©a
(è+ 
p
->
	`mac_h—d”_off£t
()),…->
	`mac_h—d”_Ëngth
());

386 
	`memıy
(
q
->
	`d©a
(), 
p
->d©a(),…->
	`_h—d”_off£t
(è+…->
	`_h—d”_Ëngth
());

387 
q
->
	`_h—d”
()->
_off
 = 
Şd__off
;

388 
ChunkLšk
 
Şd_chunk
 = 
	`PACKET_CHUNK
(
q
);

389 ià(
_mtu_ªno
 >= 0) {

390 
ušt16_t
 
Şd_mtu
 = 
q
->
	`ªno_u16
(
_mtu_ªno
);

391 
q
->
	`cİy_ªnÙ©iÚs
(
p
);

392 
q
->
	`£t_ªno_u16
(
_mtu_ªno
, 
Şd_mtu
);

394 
q
->
	`cİy_ªnÙ©iÚs
(
p
);

396 
	`PACKET_CHUNK
(
q
èğ
Şd_chunk
;

400 ià(!(
h
->
_off
 & 
	`htÚs
(
IP_MF
)))

401 
q
->
	`_h—d”
()->
_off
 &ğ~
	`htÚs
(
IP_MF
);

404 ià((
q
->
	`_h—d”
()->
_off
 & 
	`htÚs
(
IP_MF
)) == 0

405 && 
	`PACKET_CHUNK
(
q
).
off
 == 0

406 && 
	`PACKET_CHUNK
(
q
).
Ï¡off
 =ğq->
	`Œª¥Üt_Ëngth
())

407  
	`em™_whŞe_·ck‘
(
q
, 
q_µ»v
, 
p
);

411 
p
->
	`kl
();

413 
	}
}

416 
	gIPR—s£mbËr
::
	$»­_ov”fuÎ
(
now
)

418 
	`check
();

422 
d–
 = 10; delta >= 0; delta -= 5)

423 
buck‘
 = 0; buck‘ < 
NMAP
; bucket++) {

424 
Wr™abËPack‘
 **
µ»v
 = &
_m­
[
buck‘
];

425 
Wr™abËPack‘
 *
q
 = *
µ»v
; q; q = *pprev)

426 ià(!
d–
 || 
q
->
	`time¡amp_ªno
().
	`£c
(è< 
now
 - delta) {

427 *
µ»v
 = (
Wr™abËPack‘
 *)
q
->
	`Ãxt
();

428 
_mem_u£d
 -ğ
IPH_MEM_USED
 + 
q
->
	`Œª¥Üt_Ëngth
();

429 
q
->
	`£t_Ãxt
(0);

430 
	`checked_ouut_push
(1, 
q
);

431 ++
_¡©_çed_as£m
;

432 ià(
_mem_u£d
 <ğ
_mem_low_th»sh
)

435 
µ»v
 = (
Wr™abËPack‘
 **)&
q
->
	`Ãxt
();

438 
	`şick_ch©‹r
("IPReassembler: cannot freeƒnough memory!");

439 
	}
}

442 
	gIPR—s£mbËr
::
	$»­
(
now
)

446 
kl_time
 = 
now
 - 
REAP_TIMEOUT
;

448 
i
 = 0; i < 
NMAP
; i++) {

449 
Wr™abËPack‘
 **
q_µ»v
 = &
_m­
[
i
];

450 
Wr™abËPack‘
 *
q
 = *
q_µ»v
; q; ) {

451 ià(
q
->
	`time¡amp_ªno
().
	`£c
(è< 
kl_time
) {

452 *
q_µ»v
 = (
Wr™abËPack‘
 *)
q
->
	`Ãxt
();

453 
q
->
	`£t_Ãxt
(0);

454 
_mem_u£d
 -ğ
IPH_MEM_USED
 + 
q
->
	`Œª¥Üt_Ëngth
();

455 
	`checked_ouut_push
(1, 
q
);

457 
q_µ»v
 = (
Wr™abËPack‘
 **)&
q
->
	`Ãxt
();

458 
q
 = *
q_µ»v
;

462 
_»­_time
 = 
now
 + 
REAP_INTERVAL
;

463 
	}
}

466 
	gIPR—s£mbËr
::
	$add_hªdËrs
()

468 
	`add_»ad_hªdËr
("dump", 
debug_dump
);

469 
	}
}

471 
CLICK_ENDDECLS


472 
EXPORT_ELEMENT
(
IPR—s£mbËr
)

	@ip/ipreassembler.hh

2 #iâdeà
CLICK_IPREASSEMBLER_HH


3 
	#CLICK_IPREASSEMBLER_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/glue.hh
>

6 
	~<şickÃt/.h
>

7 
	~<şick/tim”.hh
>

8 
CLICK_DECLS


65 şas 
	cIPR—s£mbËr
 : 
public
 
EËm’t
 {…ublic:

67 
	$IPR—s£mbËr
(è
CLICK_COLD
;

68 ~
	$IPR—s£mbËr
(è
CLICK_COLD
;

70 cÚ¡ *
	$şass_Çme
() const {  "IPReassembler"; }

71 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

72 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

74 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

75 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

76 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

78 
	`check
(
E¼ÜHªdËr
 * = 0);

80 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

82 
	$add_hªdËrs
(è
CLICK_COLD
;

84 
	sChunkLšk
 {

85 
ušt16_t
 
off
;

86 
ušt16_t
 
Ï¡off
;

87 
	}
};

89 
	g´iv©e
:

91 ’um { 
REAP_TIMEOUT
 = 30,

92 
	gREAP_INTERVAL
 = 10,

93 
	gIPH_MEM_USED
 = 40 };

95 ’um { 
	gNMAP
 = 256 };

96 
Wr™abËPack‘
 *
	g_m­
[
NMAP
];

98 
	g_»­_time
;

100 
ušt32_t
 
	g_¡©_äags_£’
;

101 
ušt32_t
 
	g_¡©_good_as£m
;

102 
ušt32_t
 
	g_¡©_çed_as£m
;

103 
ušt32_t
 
	g_¡©_bad_pkts
;

105 
ušt32_t
 
	g_mem_u£d
;

106 
ušt32_t
 
	g_mem_high_th»sh
;

107 
ušt32_t
 
	g_mem_low_th»sh
;

108 
št8_t
 
	g_mtu_ªno
;

110 
šlše
 
buck‘no
(cÚ¡ 
şick_
 *);

111 
šlše
 
boŞ
 
§me_£gm’t
(cÚ¡ 
şick_
 *, const click_ip *);

112 
SŒšg
 
debug_dump
(
EËm’t
 *
e
, *);

114 
Wr™abËPack‘
 *
fšd_queue
(
Pack‘
 *, WritablePacket ***);

115 
make_queue
(
Pack‘
 *, 
Wr™abËPack‘
 **);

116 
ChunkLšk
 *
Ãxt_chunk
(
Wr™abËPack‘
 *, ChunkLink *);

117 
Pack‘
 *
em™_whŞe_·ck‘
(
Wr™abËPack‘
 *, WritablePacket **, Packet *);

118 
»­_ov”fuÎ
();

119 
»­
();

120 
check_”rÜ
(
E¼ÜHªdËr
 *, , cÚ¡ 
Pack‘
 *, const *, ...);

125 
šlše
 

126 
	gIPR—s£mbËr
::
	$buck‘no
(cÚ¡ 
şick_
 *
h
)

128  (
h
->
_id
 % 
NMAP
);

129 
	}
}

131 
šlše
 
boŞ


132 
	gIPR—s£mbËr
::
	$§me_£gm’t
(cÚ¡ 
şick_
 *
h
, cÚ¡ click_ *
h2
)

134  
h
->
_id
 =ğ
h2
->_id && h->
_p
 == h2->ip_p

135 && 
h
->
_¤c
.
s_addr
 =ğ
h2
->ip_src.s_addr

136 && 
h
->
_d¡
.
s_addr
 =ğ
h2
->ip_dst.s_addr;

137 
	}
}

139 
	gCLICK_ENDDECLS


	@ip/iprewriterbase.cc

22 
	~<şick/cÚfig.h
>

23 
	~"»wr™”ba£.hh
"

24 
	~"–em’ts//rw·‰”ns.hh
"

25 
	~"–em’ts//rwm­pšg.hh
"

26 
	~"–em’ts//rw·‰”n.hh
"

27 
	~<şickÃt/.h
>

28 
	~<şickÃt/tı.h
>

29 
	~<şickÃt/udp.h
>

30 
	~<şick/Î½c.h
>

31 
	~<şick/¬gs.hh
>

32 
	~<şick/¡¿ccum.hh
>

33 
	~<şick/”rÜ.hh
>

34 
	~<şick/®gÜ™hm.hh
>

35 
	~<şick/h—p.hh
>

37 #ifdeà
CLICK_LINUXMODULE


38 
	~<şick/cxx´Ùeù.h
>

39 
	gCLICK_CXX_PROTECT


40 #ià
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2, 6, 0)

41 
	~<asm/soáœq.h
>

43 
	~<Ãt/sock.h
>

44 
	gCLICK_CXX_UNPROTECT


45 
	~<şick/cxxuÅrÙeù.h
>

48 
CLICK_DECLS


55 
	gIPM­³r
::
	$nÙify_»wr™”
(
IPRewr™”Ba£
 *, 
IPRewr™”IÅut
 *, 
E¼ÜHªdËr
 *)

57 
	}
}

60 
	gIPM­³r
::
	$»wr™e_æowid
(
IPRewr™”IÅut
 *, cÚ¡ 
IPFlowID
 &, IPFlowID &,

61 
Pack‘
 *, )

63  
IPRewr™”Ba£
::
rw_drİ
;

64 
	}
}

70 
	gIPRewr™”Ba£
::
	$IPRewr™”Ba£
()

71 : 
	`_m­
(0), 
	`_h—p
(
Ãw
 
IPRewr™”H—p
), 
	$_gc_tim”
(
gc_tim”_hook
, 
this
)

73 
_timeouts
[0] = 
deçuÉ_timeout
;

74 
_timeouts
[1] = 
deçuÉ_gu¬ª‹e
;

75 
_gc_š‹rv®_£c
 = 
deçuÉ_gc_š‹rv®
;

76 
	}
}

78 
	gIPRewr™”Ba£
::~
	$IPRewr™”Ba£
()

80 ià(
_h—p
)

81 
_h—p
->
	`unu£
();

82 
	}
}

86 
	gIPRewr™”Ba£
::
	$·r£_šput_¥ec
(cÚ¡ 
SŒšg
 &
lše
, 
IPRewr™”IÅut
 &
is
,

87 
šput_numb”
, 
E¼ÜHªdËr
 *
”rh
)

89 
P»fixE¼ÜHªdËr
 
	`û¼h
(
”rh
, "špuˆ¥eø" + 
	`SŒšg
(
šput_numb”
) + ": ");

90 
SŒšg
 
wÜd
, 
»¡
;

91 ià(!
	`ı_wÜd
(
lše
, &
wÜd
, &
»¡
))

92  
û¼h
.
	`”rÜ
("empty‡rgument");

93 
	`ı_—t_¥aû
(
»¡
);

95 
is
.
kšd
 = 
IPRewr™”IÅut
::
i_drİ
;

96 
is
.
owÃr
 = 
this
;

97 
is
.
owÃr_šput
 = 
šput_numb”
;

98 
is
.
»¶y_–em’t
 = 
this
;

100 ià(
wÜd
 == "pass" || word == "passthrough" || word == "nochange") {

101 
št32_t
 
ouŠum
 = 0;

102 ià(
»¡
 && !
	`IÁArg
().
	`·r£
Ôe¡, 
ouŠum
))

103  
û¼h
.
	`”rÜ
("syntaxƒrror,ƒxpected %<nochange [OUTPUT]%>");

104 ià((è
ouŠum
 >ğ(è
	`nouuts
())

105  
û¼h
.
	`”rÜ
("output…ort out of„ange");

106 
is
.
kšd
 = 
IPRewr™”IÅut
::
i_nochªge
;

107 
is
.
fouut
 = 
ouŠum
;

109 } ià(
wÜd
 == "keep") {

110 
VeùÜ
<
SŒšg
> 
wÜds
;

111 
	`ı_¥aûvec
(
»¡
, 
wÜds
);

112 ià(!
IPRewr™”P©‹º
::
	`·r£_pÜts
(
wÜds
, &
is
, 
this
, &
û¼h
))

114 ià((è
is
.
fouut
 >ğ(è
	`nouuts
()

115 || (è
is
.
rouut
 >ğ(èis.
»¶y_–em’t
->
	`nouuts
())

116  
û¼h
.
	`”rÜ
("output…ort out of„ange");

117 
is
.
kšd
 = 
IPRewr™”IÅut
::
i_k“p
;

119 } ià(
wÜd
 == "drop" || word == "discard") {

120 ià(
»¡
)

121  
û¼h
.
	`”rÜ
("syÁaxƒ¼Ü,ƒx³ùed %<%s%>", 
wÜd
.
	`c_¡r
());

123 } ià(
wÜd
 == "pattern" || word == "xpattern") {

124 ià(!
IPRewr™”P©‹º
::
	`·r£_w™h_pÜts
(
»¡
, &
is
, 
this
, &
û¼h
))

126 ià((è
is
.
fouut
 >ğ(è
	`nouuts
()

127 || (è
is
.
rouut
 >ğ(èis.
»¶y_–em’t
->
	`nouuts
())

128  
û¼h
.
	`”rÜ
("output…ort out of„ange");

129 
is
.
u
.
·‰”n
->
	`u£
();

130 
is
.
kšd
 = 
IPRewr™”IÅut
::
i_·‰”n
;

132 } ià(
EËm’t
 *
e
 = 
	`ı_–em’t
(
wÜd
, 
this
, 0)) {

133 
IPM­³r
 *
m­³r
 = (IPM­³¸*)
e
->
	`ÿ¡
("IPMapper");

134 ià(
»¡
)

135  
û¼h
.
	`”rÜ
("syntaxƒrror,ƒxpectedƒlement‚ame");

136 ià(!
m­³r
)

137  
û¼h
.
	`”rÜ
("element is‚ot‡n IPMapper");

139 
is
.
kšd
 = 
IPRewr™”IÅut
::
i_m­³r
;

140 
is
.
u
.
m­³r
 = mapper;

144  
û¼h
.
	`”rÜ
("unknown specification");

147 
	}
}

150 
	gIPRewr™”Ba£
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

152 
SŒšg
 
	gÿ·c™y_wÜd
;

154 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

155 .
»ad
("CAPACITY", 
AnyArg
(), 
ÿ·c™y_wÜd
)

156 .
»ad
("MAPPING_CAPACITY", 
AnyArg
(), 
ÿ·c™y_wÜd
)

157 .
»ad
("TIMEOUT", 
SecÚdsArg
(), 
_timeouts
[0])

158 .
»ad
("GUARANTEE", 
SecÚdsArg
(), 
_timeouts
[1])

159 .
»ad
("REAP_INTERVAL", 
SecÚdsArg
(), 
_gc_š‹rv®_£c
)

160 .
»ad
("REAP_TIME", 
Args
::
d•»ÿ‹d
, 
SecÚdsArg
(), 
_gc_š‹rv®_£c
)

161 .
cÚsume
() < 0)

164 ià(
	gÿ·c™y_wÜd
) {

165 
EËm’t
 *
	ge
;

166 
IPRewr™”Ba£
 *
	grwb
;

167 ià(
IÁArg
().
·r£
(
ÿ·c™y_wÜd
, 
_h—p
->
_ÿ·c™y
))

169 ià((
	ge
 = 
ı_–em’t
(
ÿ·c™y_wÜd
, 
this
))

170 && (
	grwb
 = (
IPRewr™”Ba£
 *è
e
->
ÿ¡
("IPRewriterBase"))) {

171 
rwb
->
_h—p
->
u£
();

172 
	g_h—p
->
unu£
();

173 
	g_h—p
 = 
rwb
->
_h—p
;

175  
	g”rh
->
”rÜ
("bad MAPPING_CAPACITY");

178 ià(
	gcÚf
.
size
(è!ğ
nšputs
())

179  
”rh
->
”rÜ
("Ãed %d‡rgum’ts, oÃ…” iÅuˆpÜt", 
nšputs
());

181 
	g_timeouts
[0] *ğ
CLICK_HZ
;

182 
	g_timeouts
[1] *ğ
CLICK_HZ
;

184 
	gi
 = 0; i < 
	gcÚf
.
size
(); ++i) {

185 
IPRewr™”IÅut
 
	gis
;

186 ià(
·r£_šput_¥ec
(
cÚf
[
i
], 
is
, i, 
”rh
) >= 0)

187 
_šput_¥ecs
.
push_back
(
is
);

190  
	g_šput_¥ecs
.
size
(è=ğ
nšputs
() ? 0 : -1;

194 
	gIPRewr™”Ba£
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

196 
i
 = 0; i < 
_šput_¥ecs
.
	`size
(); ++i) {

197 
P»fixE¼ÜHªdËr
 
	`û¼h
(
”rh
, "špuˆ¥eø" + 
	`SŒšg
(
i
) + ": ");

198 ià(
_šput_¥ecs
[
i
].
»¶y_–em’t
->
_h—p
 != _heap)

199 
û¼h
.
	`”rÜ
("»¶yƒËm’ˆ%<%s%> mu¡ sh¬thi MAPPING_CAPACITY", 
i
, 
_šput_¥ecs
[i].
»¶y_–em’t
->
	`Çme
().
	`c_¡r
());

200 ià(
_šput_¥ecs
[
i
].
kšd
 =ğ
IPRewr™”IÅut
::
i_m­³r
)

201 
_šput_¥ecs
[
i
].
u
.
m­³r
->
	`nÙify_»wr™”
(
this
, &_šput_¥ecs[i], &
û¼h
);

203 
_gc_tim”
.
	`š™Ÿlize
(
this
);

204 ià(
_gc_š‹rv®_£c
)

205 
_gc_tim”
.
	`scheduË_aá”_£c
(
_gc_š‹rv®_£c
);

206  
”rh
->
	`Ã¼Üs
() ? -1 : 0;

207 
	}
}

210 
	gIPRewr™”Ba£
::
	$ş—nup
(
CËªupSge
)

212 
	`shršk_h—p
(
Œue
);

213 
i
 = 0; i < 
_šput_¥ecs
.
	`size
(); ++i)

214 ià(
_šput_¥ecs
[
i
].
kšd
 =ğ
IPRewr™”IÅut
::
i_·‰”n
)

215 
_šput_¥ecs
[
i
].
u
.
·‰”n
->
	`unu£
();

216 
_šput_¥ecs
.
	`ş—r
();

217 
	}
}

219 
IPRewr™”EÁry
 *

220 
	gIPRewr™”Ba£
::
	$g‘_’Œy
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
, 
šput
)

222 
IPRewr™”EÁry
 *
m
 = 
_m­
.
	`g‘
(
æowid
);

223 ià(
m
 && 
_p
 && m->
	`æow
()->
	`_p
() && m->flow()->ip_p() != ip_p)

225 ià(!
m
 && (è
šput
 < (è
_šput_¥ecs
.
	`size
()) {

226 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
[
šput
];

227 
IPFlowID
 
»wr™‹n_æowid
 = IPFlowID::
	`unš™Ÿlized_t
();

228 ià(
is
.
	`»wr™e_æowid
(
æowid
, 
»wr™‹n_æowid
, 0è=ğ
rw_addm­
)

229 
m
 = 
	`add_æow
(
_p
, 
æowid
, 
»wr™‹n_æowid
, 
šput
);

231  
m
;

232 
	}
}

234 
IPRewr™”EÁry
 *

235 
	gIPRewr™”Ba£
::
	$¡Üe_æow
(
IPRewr™”Flow
 *
æow
, 
šput
,

236 
M­
 &
m­
, M­ *
»¶y_m­_±r
)

238 
IPRewr™”Ba£
 *
»¶y_–em’t
 = 
_šput_¥ecs
[
šput
].reply_element;

239 ià((è
æow
->
	`’Œy
(
çl£
).
	`ouut
(è>ğ(è
	`nouuts
()

240 || (è
æow
->
	`’Œy
(
Œue
).
	`ouut
(è>ğ(è
»¶y_–em’t
->
	`nouuts
()) {

241 
æow
->
	`owÃr
()->
owÃr
->
	`de¡roy_æow
(flow);

245 
IPRewr™”EÁry
 *
Şd
 = 
m­
.
	`£t
(&
æow
->
	`’Œy
(
çl£
));

246 
	`as£¹
(!
Şd
);

248 ià(!
»¶y_m­_±r
)

249 
»¶y_m­_±r
 = &
»¶y_–em’t
->
_m­
;

250 
Şd
 = 
»¶y_m­_±r
->
	`£t
(&
æow
->
	`’Œy
(
Œue
));

251 ià(
	`uÆik–y
(
Şd
)) {

252 ià(
	`lik–y
(
Şd
->
	`æow
(è!ğ
æow
))

253 
Şd
->
	`æow
()->
	`de¡roy
(
_h—p
);

256 
VeùÜ
<
IPRewr™”Flow
 *> &
myh—p
 = 
_h—p
->
_h—ps
[
æow
->
	`gu¬ª‹ed
()];

257 
myh—p
.
	`push_back
(
æow
);

258 
	`push_h—p
(
myh—p
.
	`begš
(), myh—p.
	`’d
(),

259 
IPRewr™”Flow
::
	`h—p_Ëss
(), IPRewr™”Flow::
	`h—p_¶aû
());

260 ++
_šput_¥ecs
[
šput
].
couÁ
;

262 ià(
	`uÆik–y
(
_h—p
->
	`size
(è> _h—p->
	`ÿ·c™y
())) {

268 
şick_jiff›s_t
 
now_j
 = 
	`şick_jiff›s
();

269 
	`as£¹
(
	`şick_jiff›s_Ëss
(
now_j
, 
æow
->
	`expœy
())

270 && 
_h—p
->
	`size
(è=ğ_h—p->
	`ÿ·c™y
() + 1);

271 ià(
	`shršk_h—p_fÜ_Ãw_æow
(
æow
, 
now_j
)) {

272 ++
_šput_¥ecs
[
šput
].
çu»s
;

277 ià(
m­
.
	`unb®ªûd
())

278 
m­
.
	`»hash
(m­.
	`buck‘_couÁ
() + 1);

279 ià(
»¶y_m­_±r
 !ğ&
m­
 &&„•ly_m­_±r->
	`unb®ªûd
())

280 
»¶y_m­_±r
->
	`»hash
Ô•ly_m­_±r->
	`buck‘_couÁ
() + 1);

281  &
æow
->
	`’Œy
(
çl£
);

282 
	}
}

285 
	gIPRewr™”Ba£
::
	$shiá_h—p_be¡_effÜt
(
şick_jiff›s_t
 
now_j
)

288 
VeùÜ
<
IPRewr™”Flow
 *> &
gu¬ª‹ed_h—p
 = 
_h—p
->
_h—ps
[1];

289 
gu¬ª‹ed_h—p
.
	`size
(è&& gu¬ª‹ed_h—p[0]->
	`expœed
(
now_j
)) {

290 
IPRewr™”Flow
 *
mf
 = 
gu¬ª‹ed_h—p
[0];

291 
şick_jiff›s_t
 
Ãw_expœy
 = 
mf
->
	`owÃr
()->
owÃr
->
	`be¡_effÜt_expœy
(mf);

292 
mf
->
	`chªge_expœy
(
_h—p
, 
çl£
, 
Ãw_expœy
);

294 
	}
}

296 
boŞ


297 
	gIPRewr™”Ba£
::
	$shršk_h—p_fÜ_Ãw_æow
(
IPRewr™”Flow
 *
æow
,

298 
şick_jiff›s_t
 
now_j
)

300 
	`shiá_h—p_be¡_effÜt
(
now_j
);

305 
IPRewr™”Flow
 *
d—df
;

306 ià(
_h—p
->
_h—ps
[0].
	`em±y
()) {

307 
	`as£¹
(
æow
->
	`gu¬ª‹ed
());

308 
d—df
 = 
æow
;

310 
d—df
 = 
_h—p
->
_h—ps
[0][0];

311 
d—df
->
	`de¡roy
(
_h—p
);

312  
d—df
 =ğ
æow
;

313 
	}
}

316 
	gIPRewr™”Ba£
::
	$shršk_h—p
(
boŞ
 
ş—r_®l
)

318 
şick_jiff›s_t
 
now_j
 = 
	`şick_jiff›s
();

319 
	`shiá_h—p_be¡_effÜt
(
now_j
);

320 
VeùÜ
<
IPRewr™”Flow
 *> &
be¡_effÜt_h—p
 = 
_h—p
->
_h—ps
[0];

321 
be¡_effÜt_h—p
.
	`size
(è&& be¡_effÜt_h—p[0]->
	`expœed
(
now_j
))

322 
be¡_effÜt_h—p
[0]->
	`de¡roy
(
_h—p
);

324 
št32_t
 
ÿ·c™y
 = 
ş—r_®l
 ? 0 : 
_h—p
->
_ÿ·c™y
;

325 
_h—p
->
	`size
(è> 
ÿ·c™y
) {

326 
IPRewr™”Flow
 *
d—df
 = 
_h—p
->
_h—ps
[_h—p->_h—ps[0].
	`em±y
()][0];

327 
d—df
->
	`de¡roy
(
_h—p
);

329 
	}
}

332 
	gIPRewr™”Ba£
::
	$gc_tim”_hook
(
Tim”
 *
t
, *
u£r_d©a
)

334 
IPRewr™”Ba£
 *
rw
 = 
¡©ic_ÿ¡
<IPRewr™”Ba£ *>(
u£r_d©a
);

335 
rw
->
	`shršk_h—p
(
çl£
);

336 ià(
rw
->
_gc_š‹rv®_£c
)

337 
t
->
	`»scheduË_aá”_£c
(
rw
->
_gc_š‹rv®_£c
);

338 
	}
}

340 
SŒšg


341 
	gIPRewr™”Ba£
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
)

343 
IPRewr™”Ba£
 *
rw
 = 
¡©ic_ÿ¡
<IPRewr™”Ba£ *>(
e
);

344 
šŒ_t
 
wh©
 = 
»š‹½»t_ÿ¡
<šŒ_t>(
u£r_d©a
);

345 
SŒšgAccum
 
§
;

347 
wh©
) {

348 
h_nm­pšgs
: {

349 
ušt32_t
 
couÁ
 = 0;

350 
i
 = 0; i < 
rw
->
_šput_¥ecs
.
	`size
(); ++i)

351 
couÁ
 +ğ
rw
->
_šput_¥ecs
[
i
].count;

352 
§
 << 
couÁ
;

355 
h_m­pšg_çu»s
: {

356 
ušt32_t
 
couÁ
 = 0;

357 
i
 = 0; i < 
rw
->
_šput_¥ecs
.
	`size
(); ++i)

358 
couÁ
 +ğ
rw
->
_šput_¥ecs
[
i
].
çu»s
;

359 
§
 << 
couÁ
;

362 
h_size
:

363 
§
 << 
rw
->
_h—p
->
	`size
();

365 
h_ÿ·c™y
:

366 
§
 << 
rw
->
_h—p
->
_ÿ·c™y
;

369 
i
 = 0; i < 
rw
->
_šput_¥ecs
.
	`size
(); ++i) {

370 ià(
wh©
 !ğ
h_·‰”ns
 && wh© !ğ
i
)

372 
rw
->
_šput_¥ecs
[
i
].
kšd
) {

373 
IPRewr™”IÅut
::
i_drİ
:

374 
§
 << "<drop>";

376 
IPRewr™”IÅut
::
i_nochªge
:

377 
§
 << "<nochange>";

379 
IPRewr™”IÅut
::
i_k“p
:

380 
§
 << "<keep>";

382 
IPRewr™”IÅut
::
i_·‰”n
:

383 
§
 << 
rw
->
_šput_¥ecs
[
i
].
u
.
·‰”n
->
	`uÅ¬£
();

385 
IPRewr™”IÅut
::
i_m­³r
:

386 
§
 << "<mapper>";

389 ià(
rw
->
_šput_¥ecs
[
i
].
couÁ
)

390 
§
 << " [" << 
rw
->
_šput_¥ecs
[
i
].
couÁ
 << ']';

391 
§
 << '\n';

395  
§
.
	`ke_¡ršg
();

396 
	}
}

399 
	gIPRewr™”Ba£
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
u£r_d©a
, 
E¼ÜHªdËr
 *
”rh
)

401 
IPRewr™”Ba£
 *
rw
 = 
¡©ic_ÿ¡
<IPRewr™”Ba£ *>(
e
);

402 
šŒ_t
 
wh©
 = 
»š‹½»t_ÿ¡
<šŒ_t>(
u£r_d©a
);

403 ià(
wh©
 =ğ
h_ÿ·c™y
) {

404 ià(
	`Args
(
e
, 
”rh
).
	`push_back_wÜds
(
¡r
)

405 .
	`»ad_mp
("CAPACITY", 
rw
->
_h—p
->
_ÿ·c™y
)

406 .
	`com¶‘e
() < 0)

408 
rw
->
	`shršk_h—p
(
çl£
);

410 } ià(
wh©
 =ğ
h_ş—r
) {

411 
rw
->
	`shršk_h—p
(
Œue
);

415 
	}
}

418 
	gIPRewr™”Ba£
::
	$·‰”n_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
u£r_d©a
, 
E¼ÜHªdËr
 *
”rh
)

420 
IPRewr™”Ba£
 *
rw
 = 
¡©ic_ÿ¡
<IPRewr™”Ba£ *>(
e
);

421 
šŒ_t
 
wh©
 = 
»š‹½»t_ÿ¡
<šŒ_t>(
u£r_d©a
);

422 
IPRewr™”IÅut
 
is
;

423 
r
 = 
rw
->
	`·r£_šput_¥ec
(
¡r
, 
is
, 
wh©
, 
”rh
);

424 ià(
r
 >= 0) {

425 
IPRewr™”IÅut
 *
¥ec
 = &
rw
->
_šput_¥ecs
[
wh©
];

428 
which_h—p
 = 0; which_heap < 2; ++which_heap) {

429 
VeùÜ
<
IPRewr™”Flow
 *> &
myh—p
 = 
rw
->
_h—p
->
_h—ps
[
which_h—p
];

430 
i
 = 
myh—p
.
	`size
() - 1; i >= 0; --i)

431 ià(
myh—p
[
i
]->
	`owÃr
(è=ğ
¥ec
) {

432 
myh—p
[
i
]->
	`de¡roy
(
rw
->
_h—p
);

433 ià(
i
 < 
myh—p
.
	`size
())

434 ++
i
;

439 ià(
¥ec
->
kšd
 =ğ
IPRewr™”IÅut
::
i_·‰”n
)

440 
¥ec
->
u
.
·‰”n
->
	`unu£
();

441 *
¥ec
 = 
is
;

444 
	}
}

447 
	gIPRewr™”Ba£
::
	$add_»wr™”_hªdËrs
(
boŞ
 
wr™abË_·‰”ns
)

449 
	`add_»ad_hªdËr
("bË_size", 
»ad_hªdËr
, 
h_nm­pšgs
);

450 
	`add_»ad_hªdËr
("nm­pšgs", 
»ad_hªdËr
, 
h_nm­pšgs
, 
HªdËr
::
h_d•»ÿ‹d
);

451 
	`add_»ad_hªdËr
("m­pšg_çu»s", 
»ad_hªdËr
, 
h_m­pšg_çu»s
);

452 
	`add_»ad_hªdËr
("·‰”ns", 
»ad_hªdËr
, 
h_·‰”ns
);

453 
	`add_»ad_hªdËr
("size", 
»ad_hªdËr
, 
h_size
);

454 
	`add_»ad_hªdËr
("ÿ·c™y", 
»ad_hªdËr
, 
h_ÿ·c™y
);

455 
	`add_wr™e_hªdËr
("ÿ·c™y", 
wr™e_hªdËr
, 
h_ÿ·c™y
);

456 
	`add_wr™e_hªdËr
("ş—r", 
wr™e_hªdËr
, 
h_ş—r
);

457 
i
 = 0; i < 
	`nšputs
(); ++i) {

458 
SŒšg
 
Çme
 = "·‰”n" + 
	`SŒšg
(
i
);

459 
	`add_»ad_hªdËr
(
Çme
, 
»ad_hªdËr
, 
i
);

460 ià(
wr™abË_·‰”ns
)

461 
	`add_wr™e_hªdËr
(
Çme
, 
·‰”n_wr™e_hªdËr
, 
i
);

463 
	}
}

466 
	gIPRewr™”Ba£
::
	$Î½c
(
commªd
, *
d©a
)

468 ià(
commªd
 =ğ
CLICK_LLRPC_IPREWRITER_MAP_TCP
) {

475 
IPFlowID
 *
v®
 = 
»š‹½»t_ÿ¡
<IPFlowID *>(
d©a
);

476 
IPRewr™”EÁry
 *
m
 = 
	`g‘_’Œy
(
IP_PROTO_TCP
, *
v®
, -1);

477 ià(!
m
)

478  -
EAGAIN
;

479 *
v®
 = 
m
->
	`»wr™‹n_æowid
();

482 } ià(
commªd
 =ğ
CLICK_LLRPC_IPREWRITER_MAP_UDP
) {

489 
IPFlowID
 *
v®
 = 
»š‹½»t_ÿ¡
<IPFlowID *>(
d©a
);

490 
IPRewr™”EÁry
 *
m
 = 
	`g‘_’Œy
(
IP_PROTO_UDP
, *
v®
, -1);

491 ià(!
m
)

492  -
EAGAIN
;

493 *
v®
 = 
m
->
	`»wr™‹n_æowid
();

497  
EËm’t
::
	`Î½c
(
commªd
, 
d©a
);

498 
	}
}

500 
	$ELEMENT_REQUIRES
(
IPRewr™”M­pšg
 
IPRewr™”P©‹º
)

501 
	$ELEMENT_PROVIDES
(
IPRewr™”Ba£
)

502 
CLICK_ENDDECLS


	@ip/iprewriterbase.hh

2 #iâdeà
CLICK_IPREWRITERBASE_HH


3 
	#CLICK_IPREWRITERBASE_HH


	)

4 
	~<şick/tim”.hh
>

5 
	~"–em’ts//rwm­pšg.hh
"

6 
	~<şick/b™veùÜ.hh
>

7 
CLICK_DECLS


8 
şass
 
	gIPM­³r
;

9 
şass
 
	gIPRewr™”P©‹º
;

11 şas 
	cIPRewr™”IÅut
 { 
	mpublic
:

13 
i_drİ
, 
	mi_nochªge
, 
	mi_k“p
, 
	mi_·‰”n
, 
	mi_m­³r


15 
IPRewr™”Ba£
 *
	gowÃr
;

16 
	gowÃr_šput
;

17 
	gkšd
;

18 
	gfouut
;

19 
IPRewr™”Ba£
 *
	g»¶y_–em’t
;

20 
	grouut
;

21 
ušt32_t
 
	gcouÁ
;

22 
ušt32_t
 
	gçu»s
;

24 
IPRewr™”P©‹º
 *
	g·‰”n
;

25 
IPM­³r
 *
	gm­³r
;

26 } 
	gu
;

28 
	$IPRewr™”IÅut
()

29 : 
	`kšd
(
i_drİ
), 
	`fouut
(-1), 
	`rouut
(-1), 
	`couÁ
(0), 
	$çu»s
(0) {

30 
u
.
·‰”n
 = 0;

31 
	}
}

34 
	gm­id_deçuÉ
 = 0, 
	gm­id_»wr™”_udp
 = 1

37 
šlše
 
»wr™e_æowid
(cÚ¡ 
IPFlowID
 &
æowid
,

38 
IPFlowID
 &
»wr™‹n_æowid
,

39 
Pack‘
 *
p
, 
m­id
 = 
m­id_deçuÉ
);

42 şas 
	cIPRewr™”H—p
 { 
	mpublic
:

44 
	$IPRewr™”H—p
()

45 : 
	`_ÿ·c™y
(0x7FFFFFFF), 
	$_u£_couÁ
(1) {

47 ~
	$IPRewr™”H—p
() {

48 
	`as£¹
(
	`size
() == 0);

49 
	}
}

51 
	$u£
() {

52 ++
_u£_couÁ
;

53 
	}
}

54 
	$unu£
() {

55 
	`as£¹
(
_u£_couÁ
 > 0);

56 ià(--
_u£_couÁ
 == 0)

57 
d–‘e
 
this
;

58 
	}
}

60 
	gVeùÜ
<
	gIPRewr™”Flow
 *>::
size_ty³
 
	$size
() const {

61  
_h—ps
[0].
	`size
() + _heaps[1].size();

62 
	}
}

63 
št32_t
 
	$ÿ·c™y
() const {

64  
_ÿ·c™y
;

65 
	}
}

67 
	g´iv©e
:

70 
h_be¡_effÜt
 = 0, 
	gh_gu¬ª‹e
 = 1

72 
	gVeùÜ
<
	gIPRewr™”Flow
 *> 
	g_h—ps
[2];

73 
št32_t
 
	g_ÿ·c™y
;

74 
ušt32_t
 
	g_u£_couÁ
;

76 
ä›nd
 
şass
 
	gIPRewr™”Ba£
;

77 
ä›nd
 
şass
 
	gIPRewr™”Flow
;

81 şas 
	cIPRewr™”Ba£
 : 
public
 
EËm’t
 {…ublic:

83 
HashCÚš”
<
	tIPRewr™”EÁry
> 
	tM­
;

85 
	mrw_drİ
 = -1, 
	mrw_addm­
 = -2

88 
	$IPRewr™”Ba£
(è
CLICK_COLD
;

89 ~
	$IPRewr™”Ba£
(è
CLICK_COLD
;

91 
	eCÚfigu»Pha£
 {

92 
CONFIGURE_PHASE_PATTERNS
 = 
CONFIGURE_PHASE_INFO
,

93 
CONFIGURE_PHASE_REWRITER
 = 
CONFIGURE_PHASE_DEFAULT
,

94 
CONFIGURE_PHASE_MAPPER
 = 
CONFIGURE_PHASE_REWRITER
 - 1,

95 
CONFIGURE_PHASE_USER
 = 
CONFIGURE_PHASE_REWRITER
 + 1

96 
	}
};

98 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1-/1-"; 
	}
}

99 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

101 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_REWRITER
; 
	}
}

102 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

103 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

104 
	`add_»wr™”_hªdËrs
(
boŞ
 
wr™abË_·‰”ns
);

105 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

107 cÚ¡ 
IPRewr™”H—p
 *
	$æow_h—p
() const {

108  
_h—p
;

109 
	}
}

110 
IPRewr™”Ba£
 *
	$»¶y_–em’t
(
šput
) const {

111  
_šput_¥ecs
[
šput
].
»¶y_–em’t
;

112 
	}
}

113 
vœtu®
 
	gHashCÚš”
<
	gIPRewr™”EÁry
> *
	$g‘_m­
(
m­id
) {

114  
	`lik–y
(
m­id
 =ğ
IPRewr™”IÅut
::
m­id_deçuÉ
è? &
_m­
 : 0;

115 
	}
}

118 
	gg‘_’Œy_check
 = -1, 
	gg‘_’Œy_»¶y
 = -2

120 
vœtu®
 
IPRewr™”EÁry
 *
g‘_’Œy
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
,

121 
šput
);

122 
vœtu®
 
IPRewr™”EÁry
 *
add_æow
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
,

123 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
,

124 
šput
) = 0;

125 
vœtu®
 
de¡roy_æow
(
IPRewr™”Flow
 *
æow
) = 0;

126 
vœtu®
 
şick_jiff›s_t
 
	$be¡_effÜt_expœy
(cÚ¡ 
IPRewr™”Flow
 *
æow
) {

127  
æow
->
	`expœy
(è+ 
_timeouts
[0] - _timeouts[1];

128 
	}
}

130 
Î½c
(
commªd
, *
d©a
);

132 
	g´Ùeùed
:

134 
M­
 
_m­
;

136 
	gVeùÜ
<
	gIPRewr™”IÅut
> 
	g_šput_¥ecs
;

138 
IPRewr™”H—p
 *
	g_h—p
;

139 
ušt32_t
 
	g_timeouts
[2];

140 
ušt32_t
 
	g_gc_š‹rv®_£c
;

141 
Tim”
 
	g_gc_tim”
;

144 
	gdeçuÉ_timeout
 = 300,

145 
	gdeçuÉ_gu¬ª‹e
 = 5,

146 
	gdeçuÉ_gc_š‹rv®
 = 60 * 15

149 
ušt32_t
 
	$»Ëvªt_timeout
(cÚ¡ 
ušt32_t
 
timeouts
[2]) {

150  
timeouts
[1] ?imeouts[1] :imeouts[0];

151 
	}
}

153 
IPRewr™”EÁry
 *
¡Üe_æow
(
IPRewr™”Flow
 *
æow
, 
šput
,

154 
M­
 &
m­
, M­ *
»¶y_m­_±r
 = 0);

155 
šlše
 
unm­_æow
(
IPRewr™”Flow
 *
æow
,

156 
M­
 &
m­
, M­ *
»¶y_m­_±r
 = 0);

158 
gc_tim”_hook
(
Tim”
 *
t
, *
u£r_d©a
);

160 
·r£_šput_¥ec
(cÚ¡ 
SŒšg
 &
¡r
, 
IPRewr™”IÅut
 &
is
,

161 
šput_numb”
, 
E¼ÜHªdËr
 *
”rh
);

164 
	gh_nm­pšgs
 = -1, 
	gh_m­pšg_çu»s
 = -2, 
	gh_·‰”ns
 = -3,

165 
	gh_size
 = -4, 
	gh_ÿ·c™y
 = -5, 
	gh_ş—r
 = -6

167 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
è
CLICK_COLD
;

168 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
u£r_d©a
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

169 
	$·‰”n_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
u£r_d©a
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

171 
ä›nd
 
IPRewr™”IÅut
::
	`»wr™e_æowid
(cÚ¡ 
IPFlowID
 &
æowid
,

172 
IPFlowID
 &
»wr™‹n_æowid
, 
Pack‘
 *
p
, 
m­id
);

174 
´iv©e
:

176 
	`shiá_h—p_be¡_effÜt
(
şick_jiff›s_t
 
now_j
);

177 
boŞ
 
	`shršk_h—p_fÜ_Ãw_æow
(
IPRewr™”Flow
 *
æow
, 
şick_jiff›s_t
 
now_j
);

178 
	`shršk_h—p
(
boŞ
 
ş—r_®l
);

180 
ä›nd
 
şass
 
IPRewr™”Flow
;

182 
	}
};

185 şas 
	cIPM­³r
 { 
	mpublic
:

187 
	$IPM­³r
() { }

188 
vœtu®
 ~
	$IPM­³r
(è{ 
	}
}

190 
vœtu®
 
nÙify_»wr™”
(
IPRewr™”Ba£
 *
u£r
, 
IPRewr™”IÅut
 *
šput
,

191 
E¼ÜHªdËr
 *
”rh
);

192 
vœtu®
 
»wr™e_æowid
(
IPRewr™”IÅut
 *
šput
,

193 cÚ¡ 
IPFlowID
 &
æowid
,

194 
IPFlowID
 &
»wr™‹n_æowid
,

195 
Pack‘
 *
p
, 
m­id
);

200 
šlše
 

201 
	gIPRewr™”IÅut
::
	$»wr™e_æowid
(cÚ¡ 
IPFlowID
 &
æowid
,

202 
IPFlowID
 &
»wr™‹n_æowid
,

203 
Pack‘
 *
p
, 
m­id
)

205 
i
;

206 
kšd
) {

207 
i_nochªge
:

208  
fouut
;

209 
i_k“p
:

210 
»wr™‹n_æowid
 = 
æowid
;

211  
IPRewr™”Ba£
::
rw_addm­
;

212 
i_·‰”n
: {

213 
HashCÚš”
<
IPRewr™”EÁry
> *
»¶y_m­
;

214 ià(
	`lik–y
(
m­id
 =ğ
m­id_deçuÉ
))

215 
»¶y_m­
 = &
»¶y_–em’t
->
_m­
;

217 
»¶y_m­
 = 
»¶y_–em’t
->
	`g‘_m­
(
m­id
);

218 
i
 = 
u
.
·‰”n
->
	`»wr™e_æowid
(
æowid
, 
»wr™‹n_æowid
, *
»¶y_m­
);

219 
check_fÜ_çu»
;

221 
i_m­³r
:

222 
i
 = 
u
.
m­³r
->
	`»wr™e_æowid
(
this
, 
æowid
, 
»wr™‹n_æowid
, 
p
, 
m­id
);

223 
check_fÜ_çu»
;

224 
check_fÜ_çu»
:

225 ià(
i
 =ğ
IPRewr™”Ba£
::
rw_drİ
)

226 ++
çu»s
;

227  
i
;

229  
IPRewr™”Ba£
::
rw_drİ
;

231 
	}
}

233 
šlše
 

234 
	gIPRewr™”Ba£
::
	$unm­_æow
(
IPRewr™”Flow
 *
æow
, 
M­
 &
m­
,

235 
M­
 *
»¶y_m­_±r
)

238 ià(!
»¶y_m­_±r
)

239 
»¶y_m­_±r
 = &
æow
->
	`owÃr
()->
»¶y_–em’t
->
_m­
;

240 
M­
::
™”©Ü
 
™
 = 
m­
.
	`fšd
(
æow
->
	`’Œy
(0).
	`hashkey
());

241 ià(
™
.
	`g‘
(è=ğ&
æow
->
	`’Œy
(0))

242 
m­
.
	`”a£
(
™
);

243 
™
 = 
»¶y_m­_±r
->
	`fšd
(
æow
->
	`’Œy
(1).
	`hashkey
());

244 ià(
™
.
	`g‘
(è=ğ&
æow
->
	`’Œy
(1))

245 
»¶y_m­_±r
->
	`”a£
(
™
);

246 
	}
}

248 
	gCLICK_ENDDECLS


	@ip/iproutetable.cc

21 
	~<şick/cÚfig.h
>

22 
	~<şick/add»ss.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/glue.hh
>

26 
	~<şick/¡¿ccum.hh
>

27 
	~<şick/rou‹r.hh
>

28 
	~"rou‹bË.hh
"

29 
CLICK_DECLS


31 
boŞ


32 
	$ı__rou‹
(
SŒšg
 
s
, 
IPRou‹
 *
r_¡Üe
, 
boŞ
 
»move_rou‹
, 
EËm’t
 *
cÚ‹xt
)

34 
IPRou‹
 
r
;

35 ià(!
	`IPP»fixArg
(
Œue
).
	`·r£
(
	`ı_shiá_¥aûvec
(
s
), 
r
.
addr
,„.
mask
, 
cÚ‹xt
))

36  
çl£
;

37 
r
.
addr
 &ğr.
mask
;

39 
SŒšg
 
wÜd
 = 
	`ı_shiá_¥aûvec
(
s
);

40 ià(
wÜd
 == "-")

42 ià(
	`IPAdd»ssArg
().
	`·r£
(
wÜd
, 
r
.
gw
, 
cÚ‹xt
))

45 
two_wÜds
;

47 
wÜd
 = 
	`ı_shiá_¥aûvec
(
s
);

48 
two_wÜds
:

49 ià(
	`IÁArg
().
	`·r£
(
wÜd
, 
r
.
pÜt
è|| (!wÜd && 
»move_rou‹
))

50 ià(!
	`ı_shiá_¥aûvec
(
s
)) {

51 *
r_¡Üe
 = 
r
;

52  
Œue
;

55  
çl£
;

56 
	}
}

58 
	gSŒšgAccum
&

59 
	gIPRou‹
::
	$uÅ¬£
(
SŒšgAccum
& 
§
, 
boŞ
 
bs
) const

61 
l
 = 
§
.
	`Ëngth
();

62 
b
 = (
bs
 ? '\t' : ' ');

63 
§
 << 
addr
.
	`uÅ¬£_w™h_mask
(
mask
è<< 
b
;

64 ià(
§
.
	`Ëngth
(è< 
l
 + 17 && 
bs
)

65 
§
 << '\t';

66 
l
 = 
§
.
	`Ëngth
();

67 ià(
gw
)

68 
§
 << 
gw
 << 
b
;

70 
§
 << '-' << 
b
;

71 ià(
§
.
	`Ëngth
(è< 
l
 + 9 && 
bs
)

72 
§
 << '\t';

73 ià(!
	`»®
())

74 
§
 << "-1";

76 
§
 << 
pÜt
;

77  
§
;

78 
	}
}

80 
SŒšg


81 
	gIPRou‹
::
	$uÅ¬£
() const

83 
SŒšgAccum
 
§
;

84 
§
 << *
this
;

85  
§
.
	`ke_¡ršg
();

86 
	}
}

90 
	gIPRou‹TabË
::
	$ÿ¡
(cÚ¡ *
Çme
)

92 ià(
	`¡rcmp
(
Çme
, "IPRouteTable") == 0)

93  (*)
this
;

95  
EËm’t
::
	`ÿ¡
(
Çme
);

96 
	}
}

99 
	gIPRou‹TabË
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

101 
	gr
 = 0, 
	gr1
, 
	g“xi¡
 = 0;

102 
IPRou‹
 
	grou‹
;

103 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

104 ià(!
ı__rou‹
(
cÚf
[
i
], &
rou‹
, 
çl£
, 
this
)) {

105 
	g”rh
->
”rÜ
("¬gum’ˆ%d should b%<ADDR/MASK [GATEWAY] OUTPUT%>", 
i
+1);

106 
	gr
 = -
EINVAL
;

107 } ià(
	grou‹
.
	gpÜt
 < 0 ||„ou‹.pÜˆ>ğ
nouuts
()) {

108 
”rh
->
”rÜ
("¬gum’ˆ%d bad OUTPUT", 
i
+1);

109 
	gr
 = -
EINVAL
;

110 } ià((
	gr1
 = 
add_rou‹
(
rou‹
, 
çl£
, 0, 
”rh
)) < 0) {

111 ià(
	gr1
 =ğ-
EEXIST
)

112 ++
“xi¡
;

114 
	gr
 = 
r1
;

117 ià(
	g“xi¡
)

118 
	g”rh
->
w¬nšg
("%d % »¶aûd by†©” v”siÚs", 
“xi¡
,ƒexist > 1 ? "routes" : "route");

119  
	gr
;

123 
	gIPRou‹TabË
::
	$add_rou‹
(cÚ¡ 
IPRou‹
&, 
boŞ
, IPRou‹*, 
E¼ÜHªdËr
 *
”rh
)

126  
”rh
->
	`”rÜ
("cannot‡dd„outesohis„outingable");

127 
	}
}

130 
	gIPRou‹TabË
::
	$»move_rou‹
(cÚ¡ 
IPRou‹
&, IPRou‹*, 
E¼ÜHªdËr
 *
”rh
)

133  
”rh
->
	`”rÜ
("cannot delete„outes fromhis„outingable");

134 
	}
}

137 
	gIPRou‹TabË
::
	$lookup_rou‹
(
IPAdd»ss
, IPAddress&) const

140 
	}
}

142 
SŒšg


143 
	gIPRou‹TabË
::
	$dump_rou‹s
()

145  
	`SŒšg
();

146 
	}
}

150 
	gIPRou‹TabË
::
	$push
(, 
Pack‘
 *
p
)

152 
IPAdd»ss
 
gw
;

153 
pÜt
 = 
	`lookup_rou‹
(
p
->
	`d¡__ªno
(), 
gw
);

154 ià(
pÜt
 >= 0) {

155 
	`as£¹
(
pÜt
 < 
	`nouuts
());

156 ià(
gw
)

157 
p
->
	`£t_d¡__ªno
(
gw
);

158 
	`ouut
(
pÜt
).
	`push
(
p
);

160 
com¶ašed
 = 0;

161 ià(++
com¶ašed
 <= 5)

162 
	`şick_ch©‹r
("IPRou‹TabË:‚Ørou‹ fÜ %s", 
p
->
	`d¡__ªno
().
	`uÅ¬£
().
	`c_¡r
());

163 
p
->
	`kl
();

165 
	}
}

169 
	gIPRou‹TabË
::
run_commªd
(
commªd
, cÚ¡ 
SŒšg
 &
¡r
, 
VeùÜ
<
IPRou‹
>* 
Şd_rou‹s
, 
E¼ÜHªdËr
 *
”rh
)

171 
IPRou‹
 
	grou‹
, 
	gŞd_rou‹
;

172 ià(!
ı__rou‹
(
¡r
, &
rou‹
, 
commªd
 =ğ
CMD_REMOVE
, 
this
))

173  
	g”rh
->
”rÜ
("ex³ùed %<ADDR/MASK [GATEWAY%s%>", (
commªd
 =ğ
CMD_REMOVE
 ? " OUTPUT]" : "] OUTPUT"));

174 ià(
	grou‹
.
	gpÜt
 < (
	gcommªd
 =ğ
CMD_REMOVE
 ? -1 : 0)

175 || 
rou‹
.
pÜt
 >ğ
nouuts
())

176  
”rh
->
”rÜ
("bad OUTPUT");

178 
	gr
, 
	gbefÜe
 = 
”rh
->
Ã¼Üs
();

179 ià(
	gcommªd
 =ğ
CMD_ADD
)

180 
r
 = 
add_rou‹
(
rou‹
, 
çl£
, &
Şd_rou‹
, 
”rh
);

181 ià(
	gcommªd
 =ğ
CMD_SET
)

182 
r
 = 
add_rou‹
(
rou‹
, 
Œue
, &
Şd_rou‹
, 
”rh
);

184 
	gr
 = 
»move_rou‹
(
rou‹
, &
Şd_rou‹
, 
”rh
);

187 ià(
	gr
 >ğ0 && 
Şd_rou‹s
) {

188 ià(
Şd_rou‹
.
pÜt
 < 0) {

189 
Şd_rou‹
 = 
rou‹
;

190 
	gŞd_rou‹
.
	gexŒa
 = 
CMD_ADD
;

192 
	gŞd_rou‹
.
	gexŒa
 = 
commªd
;

193 
	gŞd_rou‹s
->
push_back
(
Şd_rou‹
);

197 ià(
	gr
 =ğ-
EEXIST
 && 
”rh
->
Ã¼Üs
(è=ğ
befÜe
)

198 
”rh
->
”rÜ
("cÚæiù w™hƒxi¡šg„ou‹ %<%s%>", 
Şd_rou‹
.
uÅ¬£
().
c_¡r
());

199 ià(
	gr
 =ğ-
ENOENT
 && 
”rh
->
Ã¼Üs
(è=ğ
befÜe
)

200 
”rh
->
”rÜ
("rou‹ %<%s%>‚Ù found", 
rou‹
.
uÅ¬£
().
c_¡r
());

201 ià(
	gr
 =ğ-
ENOMEM
 && 
”rh
->
Ã¼Üs
(è=ğ
befÜe
)

202 
”rh
->
”rÜ
("nØmemÜyØ¡Ürou‹ %<%s%>", 
rou‹
.
uÅ¬£
().
c_¡r
());

203  
	gr
;

208 
	gIPRou‹TabË
::
	$add_rou‹_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

210 
IPRou‹TabË
 *
bË
 = 
¡©ic_ÿ¡
<IPRou‹TabË *>(
e
);

211  
bË
->
	`run_commªd
((
thunk
 ? 
CMD_SET
 : 
CMD_ADD
), 
cÚf
, 0, 
”rh
);

212 
	}
}

215 
	gIPRou‹TabË
::
	$»move_rou‹_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

217 
IPRou‹TabË
 *
bË
 = 
¡©ic_ÿ¡
<IPRou‹TabË *>(
e
);

218  
bË
->
	`run_commªd
(
CMD_REMOVE
, 
cÚf
, 0, 
”rh
);

219 
	}
}

222 
	gIPRou‹TabË
::
	$ù¾_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf_š
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

224 
IPRou‹TabË
 *
bË
 = 
¡©ic_ÿ¡
<IPRou‹TabË *>(
e
);

225 
SŒšg
 
cÚf
 = 
	`ı_uncomm’t
(
cÚf_š
);

226 cÚ¡ * 
s
 = 
cÚf
.
	`begš
(), *
’d
 = cÚf.
	`’d
();

228 
VeùÜ
<
IPRou‹
> 
Şd_rou‹s
;

229 
r
 = 0;

231 
s
 < 
’d
) {

232 cÚ¡ * 
Æ
 = 
	`fšd
(
s
, 
’d
, '\n');

233 
SŒšg
 
lše
 = 
cÚf
.
	`sub¡ršg
(
s
, 
Æ
);

235 
SŒšg
 
fœ¡_wÜd
 = 
	`ı_shiá_¥aûvec
(
lše
);

236 
commªd
;

237 ià(
fœ¡_wÜd
 == "add")

238 
commªd
 = 
CMD_ADD
;

239 ià(
fœ¡_wÜd
 == "remove")

240 
commªd
 = 
CMD_REMOVE
;

241 ià(
fœ¡_wÜd
 == "set")

242 
commªd
 = 
CMD_SET
;

243 ià(!
fœ¡_wÜd
)

246 
r
 = 
”rh
->
	`”rÜ
("bad commªd %<%#s%>", 
fœ¡_wÜd
.
	`c_¡r
());

247 
rŞlback
;

250 ià((
r
 = 
bË
->
	`run_commªd
(
commªd
, 
lše
, &
Şd_rou‹s
, 
”rh
)) < 0)

251 
rŞlback
;

253 
s
 = 
Æ
 + 1;

257 
rŞlback
:

258 
Şd_rou‹s
.
	`size
()) {

259 cÚ¡ 
IPRou‹
& 
¹
 = 
Şd_rou‹s
.
	`back
();

260 ià(
¹
.
exŒa
 =ğ
CMD_REMOVE
)

261 
bË
->
	`add_rou‹
(
¹
, 
çl£
, 0, 
”rh
);

262 ià(
¹
.
exŒa
 =ğ
CMD_ADD
)

263 
bË
->
	`»move_rou‹
(
¹
, 0, 
”rh
);

265 
bË
->
	`add_rou‹
(
¹
, 
Œue
, 0, 
”rh
);

266 
Şd_rou‹s
.
	`pİ_back
();

268  
r
;

269 
	}
}

271 
SŒšg


272 
	gIPRou‹TabË
::
	$bË_hªdËr
(
EËm’t
 *
e
, *)

274 
IPRou‹TabË
 *
r
 = 
¡©ic_ÿ¡
<IPRou‹TabË*>(
e
);

275  
r
->
	`dump_rou‹s
();

276 
	}
}

279 
	gIPRou‹TabË
::
	$lookup_hªdËr
(, 
SŒšg
& 
s
, 
EËm’t
* 
e
, cÚ¡ 
HªdËr
*, 
E¼ÜHªdËr
* 
”rh
)

281 
IPRou‹TabË
 *
bË
 = 
¡©ic_ÿ¡
<IPRou‹TabË*>(
e
);

282 
IPAdd»ss
 
a
;

283 ià(
	`IPAdd»ssArg
().
	`·r£
(
s
, 
a
, 
bË
)) {

284 
IPAdd»ss
 
gw
;

285 
pÜt
 = 
bË
->
	`lookup_rou‹
(
a
, 
gw
);

286 ià(
gw
)

287 
s
 = 
	`SŒšg
(
pÜt
è+ " " + 
gw
.
	`uÅ¬£
();

289 
s
 = 
	`SŒšg
(
pÜt
);

292  
”rh
->
	`”rÜ
("expected IP‡ddress");

293 
	}
}

296 
	gIPRou‹TabË
::
	$add_hªdËrs
()

298 
	`add_wr™e_hªdËr
("add", 
add_rou‹_hªdËr
, 0);

299 
	`add_wr™e_hªdËr
("£t", 
add_rou‹_hªdËr
, 1);

300 
	`add_wr™e_hªdËr
("»move", 
»move_rou‹_hªdËr
);

301 
	`add_wr™e_hªdËr
("ù¾", 
ù¾_hªdËr
);

302 
	`add_»ad_hªdËr
("bË", 
bË_hªdËr
, 0, 
HªdËr
::
f_ex³nsive
);

303 
	`£t_hªdËr
("lookup", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
lookup_hªdËr
);

304 
	}
}

306 
CLICK_ENDDECLS


307 
ELEMENT_PROVIDES
(
IPRou‹TabË
)

	@ip/iproutetable.hh

2 #iâdeà
CLICK_IPROUTETABLE_HH


3 
	#CLICK_IPROUTETABLE_HH


	)

4 
	~<şick/glue.hh
>

5 
	~<şick/–em’t.hh
>

6 
CLICK_DECLS


163 
	sIPRou‹
 {

164 
IPAdd»ss
 
	maddr
;

165 
IPAdd»ss
 
	mmask
;

166 
IPAdd»ss
 
	mgw
;

167 
št32_t
 
	mpÜt
;

168 
št32_t
 
	mexŒa
;

170 
IPRou‹
(è: 
pÜt
(-1) { }

171 
IPRou‹
(
IPAdd»ss
 
a
, IPAdd»s 
m
, IPAdd»s 
g
, 
p
)

172 : 
addr
(
a
), 
mask
(
m
), 
gw
(
g
), 
pÜt
(
p
) { }

174 
šlše
 
boŞ
 
»®
(ècÚ¡ {  
	mpÜt
 > (
	mšt32_t
) -0x80000000; }

175 
šlše
 
kl
(è{ 
	maddr
 = 0; 
	mmask
 = 0xFFFFFFFFU; 
	mpÜt
 = -0x80000000; }

176 
šlše
 
boŞ
 
cÚšs
(
IPAdd»ss
 
a
) const;

177 
šlše
 
boŞ
 
cÚšs
(cÚ¡ 
IPRou‹
& 
r
) const;

178 
šlše
 
boŞ
 
mask_as_¥ecific
(
IPAdd»ss
 
m
) const;

179 
šlše
 
boŞ
 
mask_as_¥ecific
(cÚ¡ 
IPRou‹
& 
r
) const;

180 
šlše
 
boŞ
 
m©ch
(cÚ¡ 
IPRou‹
& 
r
) const;

181 
´efix_Ën
(ècÚ¡ {  
	mmask
.
mask_to_´efix_Ën
(); }

183 
	mSŒšgAccum
 &
uÅ¬£
(
SŒšgAccum
&, 
boŞ
 
bs
) const;

184 
SŒšg
 
uÅ¬£
() const;

185 
SŒšg
 
uÅ¬£_addr
(ècÚ¡ {  
	maddr
.
uÅ¬£_w™h_mask
(
mask
); }

188 şas 
	cIPRou‹TabË
 : 
public
 
EËm’t
 {…ublic:

190 * 
ÿ¡
(const *);

191 
cÚfigu»
(
VeùÜ
<
SŒšg
>&, 
E¼ÜHªdËr
*è
	mCLICK_COLD
;

192 
	$add_hªdËrs
(è
CLICK_COLD
;

194 
vœtu®
 
	`add_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, 
boŞ
 
®low_»¶aû
, IPRou‹* 
»¶aûd_rou‹
, 
E¼ÜHªdËr
* 
”rh
);

195 
vœtu®
 
	`»move_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, IPRou‹* 
»moved_rou‹
, 
E¼ÜHªdËr
* 
”rh
);

196 
vœtu®
 
	$lookup_rou‹
(
IPAdd»ss
 
addr
, IPAdd»ss& 
gw
) const = 0;

197 
vœtu®
 
SŒšg
 
	`dump_rou‹s
();

199 
	`push
(
pÜt
, 
Pack‘
* 
p
);

201 
	`add_rou‹_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

202 
	`»move_rou‹_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

203 
	`ù¾_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

204 
	`lookup_hªdËr
(
İ”©iÚ
, 
SŒšg
&, 
EËm’t
*, cÚ¡ 
HªdËr
*, 
E¼ÜHªdËr
*);

205 
SŒšg
 
	`bË_hªdËr
(
EËm’t
*, *);

207 
´iv©e
:

209 ’um { 
CMD_ADD
, 
CMD_SET
, 
CMD_REMOVE
 };

210 
	`run_commªd
(
commªd
, cÚ¡ 
SŒšg
 &, 
VeùÜ
<
IPRou‹
>* 
Şd_rou‹s
, 
E¼ÜHªdËr
*);

212 
	}
};

214 
šlše
 
	gSŒšgAccum
&

215 
	gİ”©Ü
<<(
	gSŒšgAccum
& 
	g§
, cÚ¡ 
	gIPRou‹
& 
	grou‹
)

217  
	grou‹
.
uÅ¬£
(
§
, 
çl£
);

220 
šlše
 
boŞ


221 
	gIPRou‹
::
	$cÚšs
(
IPAdd»ss
 
a
) const

223  
a
.
	`m©ches_´efix
(
addr
, 
mask
);

224 
	}
}

226 
šlše
 
boŞ


227 
	gIPRou‹
::
	$cÚšs
(cÚ¡ 
IPRou‹
& 
r
) const

229  
r
.
addr
.
	`m©ches_´efix
×ddr, 
mask
è&&„.mask.
	`mask_as_¥ecific
(mask);

230 
	}
}

232 
šlše
 
boŞ


233 
	gIPRou‹
::
	$mask_as_¥ecific
(
IPAdd»ss
 
m
) const

235  
mask
.
	`mask_as_¥ecific
(
m
);

236 
	}
}

238 
šlše
 
boŞ


239 
	gIPRou‹
::
	$mask_as_¥ecific
(cÚ¡ 
IPRou‹
& 
r
) const

241  
mask
.
	`mask_as_¥ecific
(
r
.mask);

242 
	}
}

244 
šlše
 
boŞ


245 
	gIPRou‹
::
	$m©ch
(cÚ¡ 
IPRou‹
& 
r
) const

247  
addr
 =ğ
r
.add¸&& 
mask
 ==„.mask

248 && (
pÜt
 < 0 || (
gw
 =ğ
r
.gw &&…ort ==„.port));

249 
	}
}

251 
	gCLICK_ENDDECLS


	@ip/iprwmapping.cc

22 
	~<şick/cÚfig.h
>

23 
	~"rwm­pšg.hh
"

24 
	~"»wr™”ba£.hh
"

25 
	~<şickÃt/.h
>

26 
	~<şickÃt/tı.h
>

27 
	~<şickÃt/udp.h
>

28 
	~<şick/cÚå¬£.hh
>

29 
	~<şick/¡¿ccum.hh
>

30 
	~<şick/”rÜ.hh
>

31 
	~<şick/®gÜ™hm.hh
>

32 
	~<şick/h—p.hh
>

33 
CLICK_DECLS


35 
	gIPRewr™”Flow
::
	$IPRewr™”Flow
(
IPRewr™”IÅut
 *
owÃr
, cÚ¡ 
IPFlowID
 &
æowid
,

36 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
,

37 
ušt8_t
 
_p
, 
boŞ
 
gu¬ª‹ed
,

38 
şick_jiff›s_t
 
expœy_j
)

39 : 
	`_expœy_j
(
expœy_j
), 
	`__p
(
_p
), 
	`_tæags
(0),

40 
	`_gu¬ª‹ed
(
gu¬ª‹ed
), 
	`_»¶y_ªno
(0),

41 
	$_owÃr
(
owÃr
)

43 
_e
[0].
	`š™Ÿlize
(
æowid
, 
owÃr
->
fouut
, 
çl£
);

44 
_e
[1].
	`š™Ÿlize
(
»wr™‹n_æowid
.
	`»v”£
(), 
owÃr
->
rouut
, 
Œue
);

47 cÚ¡ 
ušt16_t
 *
swÜds
 = 
»š‹½»t_ÿ¡
<cÚ¡ ušt16_ˆ*>(&
æowid
);

48 cÚ¡ 
ušt16_t
 *
dwÜds
 = 
»š‹½»t_ÿ¡
<cÚ¡ ušt16_ˆ*>(&
»wr™‹n_æowid
);

49 
__csum_d–
 = 0;

50 
i
 = 0; i < 4; ++i)

51 
	`şick_upd©e_š_cksum
(&
__csum_d–
, 
swÜds
[
i
], 
dwÜds
[i]);

52 
_udp_csum_d–
 = 
__csum_d–
;

53 
i
 = 4; i < 6; ++i)

54 
	`şick_upd©e_š_cksum
(&
_udp_csum_d–
, 
swÜds
[
i
], 
dwÜds
[i]);

55 
	}
}

58 
	gIPRewr™”Flow
::
	$­¶y
(
Wr™abËPack‘
 *
p
, 
boŞ
 
dœeùiÚ
, 
ªnos
)

60 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

61 
şick_
 *
h
 = 
p
->
	`_h—d”
();

64 cÚ¡ 
IPFlowID
 &
»væow
 = 
_e
[!
dœeùiÚ
].
	`hashkey
();

65 
h
->
_¤c
 = 
»væow
.
	`daddr
();

66 
h
->
_d¡
 = 
»væow
.
	`§ddr
();

67 ià(
ªnos
 & 1)

68 
p
->
	`£t_d¡__ªno
(
»væow
.
	`§ddr
());

69 ià(
dœeùiÚ
 && (
ªnos
 & 2))

70 
p
->
	`£t_ªno_u8
(
ªnos
 >> 2, 
_»¶y_ªno
);

71 
	`upd©e_csum
(&
h
->
_sum
, 
dœeùiÚ
, 
__csum_d–
);

74 ià(!
	`IP_FIRSTFRAG
(
h
))

78 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
 && 
p
->
	`Œª¥Üt_Ëngth
() >= 18) {

79 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

80 
tıh
->
th_¥Üt
 = 
»væow
.
	`dpÜt
();

81 
tıh
->
th_dpÜt
 = 
»væow
.
	`¥Üt
();

82 
	`upd©e_csum
(&
tıh
->
th_sum
, 
dœeùiÚ
, 
_udp_csum_d–
);

83 } ià(
h
->
_p
 =ğ
IP_PROTO_UDP
) {

84 
şick_udp
 *
udph
 = 
p
->
	`udp_h—d”
();

85 
udph
->
uh_¥Üt
 = 
»væow
.
	`dpÜt
();

86 
udph
->
uh_dpÜt
 = 
»væow
.
	`¥Üt
();

87 ià(
udph
->
uh_sum
)

88 
	`upd©e_csum
(&
udph
->
uh_sum
, 
dœeùiÚ
, 
_udp_csum_d–
);

90 
	}
}

93 
	gIPRewr™”Flow
::
	$chªge_expœy
(
IPRewr™”H—p
 *
h
, 
boŞ
 
gu¬ª‹ed
,

94 
şick_jiff›s_t
 
expœy_j
)

96 
VeùÜ
<
IPRewr™”Flow
 *> &
cu¼’t_h—p
 = 
h
->
_h—ps
[
_gu¬ª‹ed
];

97 
	`as£¹
(
cu¼’t_h—p
[
_¶aû
] =ğ
this
);

98 
_expœy_j
 = 
expœy_j
;

99 ià(
_gu¬ª‹ed
 !ğ
gu¬ª‹ed
) {

100 
	`»move_h—p
(
cu¼’t_h—p
.
	`begš
(), cu¼’t_h—p.
	`’d
(),

101 
cu¼’t_h—p
.
	`begš
(è+ 
_¶aû
,

102 
	`h—p_Ëss
(), 
	`h—p_¶aû
());

103 
cu¼’t_h—p
.
	`pİ_back
();

104 
_gu¬ª‹ed
 = 
gu¬ª‹ed
;

105 
VeùÜ
<
IPRewr™”Flow
 *> &
Ãw_h—p
 = 
h
->
_h—ps
[
_gu¬ª‹ed
];

106 
Ãw_h—p
.
	`push_back
(
this
);

107 
	`push_h—p
(
Ãw_h—p
.
	`begš
(),‚ew_h—p.
	`’d
(),

108 
	`h—p_Ëss
(), 
	`h—p_¶aû
());

110 
	`chªge_h—p
(
cu¼’t_h—p
.
	`begš
(), cu¼’t_h—p.
	`’d
(),

111 
cu¼’t_h—p
.
	`begš
(è+ 
_¶aû
,

112 
	`h—p_Ëss
(), 
	`h—p_¶aû
());

113 
	}
}

116 
	gIPRewr™”Flow
::
	$de¡roy
(
IPRewr™”H—p
 *
h—p
)

118 
VeùÜ
<
IPRewr™”Flow
 *> &
myh—p
 = 
h—p
->
_h—ps
[
_gu¬ª‹ed
];

119 
	`»move_h—p
(
myh—p
.
	`begš
(), myh—p.
	`’d
(), myh—p.begš(è+ 
_¶aû
,

120 
	`h—p_Ëss
(), 
	`h—p_¶aû
());

121 
myh—p
.
	`pİ_back
();

122 --
_owÃr
->
couÁ
;

123 
_owÃr
->
owÃr
->
	`de¡roy_æow
(
this
);

124 
	}
}

127 
	gIPRewr™”Flow
::
	$uÅ¬£_pÜts
(
SŒšgAccum
 &
§
, 
boŞ
 
dœeùiÚ
,

128 
şick_jiff›s_t
 
now
) const

130 
IPRewr™”Ba£
 *
my_e
 = 
_owÃr
->
owÃr
, *
»¶y_e
 = _owÃr->
»¶y_–em’t
;

132 
§
 << " [";

133 ià(!
dœeùiÚ
)

134 
§
 << '*';

135 ià(
my_e
 !ğ
»¶y_e
)

136 
§
 << 
my_e
->
	`Çme
() << ':';

137 
§
 << 
_e
[
çl£
].
	`ouut
() << ' ';

138 ià(
dœeùiÚ
)

139 
§
 << '*';

140 ià(
my_e
 !ğ
»¶y_e
)

141 
§
 << 
»¶y_e
->
	`Çme
() << ':';

142 
şick_jiff›s_t
 
expœy_j
 = 
_expœy_j
;

143 ià(
_gu¬ª‹ed
)

144 
expœy_j
 = 
my_e
->
	`be¡_effÜt_expœy
(
this
);

145 
§
 << 
_e
[
Œue
].
	`ouut
(è<< "] i" << 
_owÃr
->
owÃr_šput
 << "ƒxp"

146 << (
expœy_j
 + (
CLICK_HZ
 / 2è- 
now
) / CLICK_HZ;

148 
§
 << " [";

149 ià(
dœeùiÚ
 && 
my_e
 !ğ
»¶y_e
)

150 
§
 << 
my_e
->
	`Çme
() << ':';

151 
§
 << 
_owÃr
->
owÃr_šput
 << (
dœeùiÚ
 ? " R]" : " F]");

153 
	}
}

156 
	gIPRewr™”Flow
::
	$uÅ¬£
(
SŒšgAccum
 &
§
, 
boŞ
 
dœeùiÚ
,

157 
şick_jiff›s_t
 
now
) const

159 
§
 << 
_e
[
dœeùiÚ
].
	`æowid
(è<< " => " << _e[dœeùiÚ].
	`»wr™‹n_æowid
();

160 
	`uÅ¬£_pÜts
(
§
, 
dœeùiÚ
, 
now
);

161 
	}
}

163 
CLICK_ENDDECLS


164 
	$ELEMENT_REQUIRES
(
IPRewr™”P©‹º
)

165 
	`ELEMENT_PROVIDES
(
IPRewr™”M­pšg
)

	@ip/iprwmapping.hh

2 #iâdeà
CLICK_IPRW_MAPPING_HH


3 
	#CLICK_IPRW_MAPPING_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/tim”.hh
>

6 
	~<şick/hashbË.hh
>

7 
	~<şick/æowid.hh
>

8 
	~<şickÃt/.h
>

9 
	~"rw·‰”n.hh
"

10 
CLICK_DECLS


11 
şass
 
	gIPRewr™”Ba£
;

12 
şass
 
	gIPRewr™”Flow
;

13 
şass
 
	gIPRewr™”H—p
;

14 
şass
 
	gIPRewr™”IÅut
;

16 şas 
	cIPRewr™”EÁry
 { 
	mpublic
:

18 
IPFlowID
 
	tkey_ty³
;

19 cÚ¡ 
	tIPFlowID
 &
	tkey_cÚ¡_»ã»nû
;

21 
	$IPRewr™”EÁry
() {

24 
	$š™Ÿlize
(cÚ¡ 
IPFlowID
 &
æowid
, 
ušt32_t
 
ouut
, 
boŞ
 
dœeùiÚ
) {

25 
	`as£¹
(
ouut
 <= 0xFFFFFF);

26 
_æowid
 = 
æowid
;

27 
_ouut
 = 
ouut
;

28 
_dœeùiÚ
 = 
dœeùiÚ
;

29 
_hashÃxt
 = 0;

30 
	}
}

32 cÚ¡ 
	gIPFlowID
 &
	$æowid
() const {

33  
_æowid
;

34 
	}
}

35 
šlše
 
IPFlowID
 
	$»wr™‹n_æowid
() const;

37 
boŞ
 
	$dœeùiÚ
() const {

38  
_dœeùiÚ
;

39 
	}
}

41 
	$ouut
() const {

42  
_ouut
;

43 
	}
}

45 
IPRewr™”Flow
 *
	$æow
() {

46  
»š‹½»t_ÿ¡
<
IPRewr™”Flow
 *>(
this
 - 
_dœeùiÚ
);

47 
	}
}

48 cÚ¡ 
IPRewr™”Flow
 *
	$æow
() const {

49  
»š‹½»t_ÿ¡
<cÚ¡ 
IPRewr™”Flow
 *>(
this
 - 
_dœeùiÚ
);

50 
	}
}

52 
key_cÚ¡_»ã»nû
 
	$hashkey
() const {

53  
_æowid
;

54 
	}
}

56 
	g´iv©e
:

58 
IPFlowID
 
_æowid
;

59 
ušt32_t
 
	g_ouut
 : 24;

60 
ušt8_t
 
	g_dœeùiÚ
;

61 
IPRewr™”EÁry
 *
	g_hashÃxt
;

63 
ä›nd
 
şass
 
	gHashCÚš”_ad­‹r
<
	gIPRewr™”EÁry
>;

68 şas 
	cIPRewr™”Flow
 { 
	mpublic
:

70 
IPRewr™”Flow
(
IPRewr™”IÅut
 *
owÃr
, cÚ¡ 
IPFlowID
 &
æowid
,

71 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
,

72 
ušt8_t
 
_p
, 
boŞ
 
gu¬ª‹ed
, 
şick_jiff›s_t
 
expœy_j
);

74 
	mIPRewr™”EÁry
 &
	$’Œy
(
boŞ
 
dœeùiÚ
) {

75  
_e
[
dœeùiÚ
];

77 cÚ¡ 
IPRewr™”EÁry
 &
	$’Œy
(
boŞ
 
dœeùiÚ
) const {

78  
_e
[
dœeùiÚ
];

79 
	}
}

83 
şick_jiff›s_t
 
	$expœy
() const {

84  
_expœy_j
;

85 
	}
}

89 
boŞ
 
	$expœed
(
şick_jiff›s_t
 
now_j
) const {

90  !
	`şick_jiff›s_Ëss
(
now_j
, 
_expœy_j
);

91 
	}
}

94 
boŞ
 
	$gu¬ª‹ed
() const {

95  
_gu¬ª‹ed
;

96 
	}
}

102 
chªge_expœy
(
IPRewr™”H—p
 *
h
, 
boŞ
 
gu¬ª‹ed
,

103 
şick_jiff›s_t
 
expœy_j
);

114 
	$chªge_expœy_by_timeout
(
IPRewr™”H—p
 *
h
, 
şick_jiff›s_t
 
now_j
,

115 cÚ¡ 
ušt32_t
 
timeouts
[2]) {

116 
ušt32_t
 
timeout
 = 
timeouts
[1] ?imeouts[1] :imeouts[0];

117 
	`chªge_expœy
(
h
, !!
timeouts
[1], 
now_j
 + 
timeout
);

118 
	}
}

120 
ušt8_t
 
	$_p
() const {

121  
__p
;

122 
	}
}

124 
IPRewr™”IÅut
 *
	$owÃr
() const {

125  
_owÃr
;

126 
	}
}

128 
ušt8_t
 
	$»¶y_ªno
() const {

129  
_»¶y_ªno
;

130 
	}
}

131 
	$£t_»¶y_ªno
(
ušt8_t
 
»¶y_ªno
) {

132 
_»¶y_ªno
 = 
»¶y_ªno
;

133 
	}
}

135 
šlše
 
upd©e_csum
(
ušt16_t
 *
csum
, 
boŞ
 
dœeùiÚ
,

136 
ušt16_t
 
csum_d–
);

138 
­¶y
(
Wr™abËPack‘
 *
p
, 
boŞ
 
dœeùiÚ
, 
ªnos
);

140 
	$uÅ¬£
(
SŒšgAccum
 &
§
, 
boŞ
 
dœeùiÚ
, 
şick_jiff›s_t
 
now
) const;

141 
	$uÅ¬£_pÜts
(
SŒšgAccum
 &
§
, 
boŞ
 
dœeùiÚ
, 
şick_jiff›s_t
 
now
) const;

143 
	sh—p_Ëss
 {

144 
šlše
 
boŞ
 
	`İ”©Ü
()(
IPRewr™”Flow
 *
a
, IPRewr™”Flow *
b
) {

145  
	`şick_jiff›s_Ëss
(
a
->
	`expœy
(), 
b
->expiry());

147 
	}
};

148 
	sh—p_¶aû
 {

149 
šlše
 
İ”©Ü
()(
IPRewr™”Flow
 **
	gbegš
, IPRewr™”Flow **
	g™
) {

150 (*
	g™
)->
	g_¶aû
 = 
™
 - 
begš
;

154 
	g´Ùeùed
:

156 
IPRewr™”EÁry
 
_e
[2];

157 
ušt16_t
 
	g__csum_d–
;

158 
ušt16_t
 
	g_udp_csum_d–
;

159 
şick_jiff›s_t
 
	g_expœy_j
;

160 
size_t
 
	g_¶aû
 : 32;

161 
ušt8_t
 
	g__p
;

162 
ušt8_t
 
	g_tæags
;

163 
boŞ
 
	g_gu¬ª‹ed
;

164 
ušt8_t
 
	g_»¶y_ªno
;

165 
IPRewr™”IÅut
 *
	g_owÃr
;

167 
ä›nd
 
şass
 
	gIPRewr™”Ba£
;

168 
ä›nd
 
şass
 
	gIPRewr™”EÁry
;

170 
	g´iv©e
:

172 
de¡roy
(
IPRewr™”H—p
 *
h—p
);

177 
šlše
 
IPFlowID


178 
	gIPRewr™”EÁry
::
	$»wr™‹n_æowid
() const

180  (
this
 + (
_dœeùiÚ
 ? -1 : 1))->
_æowid
.
	`»v”£
();

181 
	}
}

183 
šlše
 

184 
	gIPRewr™”Flow
::
	$upd©e_csum
(
ušt16_t
 *
csum
, 
boŞ
 
dœeùiÚ
, ušt16_ˆ
csum_d–
)

186 ià(
csum_d–
)

187 
	`şick_upd©e_š_cksum
(
csum
, 0, 
dœeùiÚ
 ? 
csum_d–
 : ~csum_delta);

188 
	}
}

190 
	gCLICK_ENDDECLS


	@ip/iprwpattern.cc

22 
	~<şick/cÚfig.h
>

23 
	~"rw·‰”n.hh
"

24 
	~"–em’ts//rwm­pšg.hh
"

25 
	~"–em’ts//rw·‰”ns.hh
"

26 
	~<şickÃt/.h
>

27 
	~<şickÃt/tı.h
>

28 
	~<şickÃt/udp.h
>

29 
	~<şick/cÚå¬£.hh
>

30 
	~<şick/®gÜ™hm.hh
>

31 
	~<şick/rou‹r.hh
>

32 
	~<şick/Çmešfo.hh
>

33 
	~<şick/¡¿ccum.hh
>

34 
	~<şick/”rÜ.hh
>

35 
CLICK_DECLS


37 
	gIPRewr™”P©‹º
::
	$IPRewr™”P©‹º
(cÚ¡ 
IPAdd»ss
 &
§ddr
, 
¥Üt
,

38 cÚ¡ 
IPAdd»ss
 &
daddr
, 
dpÜt
,

39 
boŞ
 
is_Ç±
, boŞ 
£qu’tŸl
, boŞ 
§me_fœ¡
,

40 
ušt32_t
 
v¬ŸtiÚ_tİ
)

41 : 
	`_§ddr
(
§ddr
), 
	`_¥Üt
(
¥Üt
), 
	`_daddr
(
daddr
), 
	`_dpÜt
(
dpÜt
),

42 
	`_v¬ŸtiÚ_tİ
(
v¬ŸtiÚ_tİ
), 
	`_Ãxt_v¬ŸtiÚ
(0), 
	`_is_Ç±
(
is_Ç±
),

43 
	`_£qu’tŸl
(
£qu’tŸl
), 
	`_§me_fœ¡
(
§me_fœ¡
), 
	$_»fcouÁ
(0)

45 
	}
}

47 
	gÇme¥aû
 {

48 ’um { 
	gPE_SYNTAX
, 
	gPE_NOPATTERN
, 
	gPE_SADDR
, 
	gPE_SPORT
, 
	gPE_DADDR
, 
	gPE_DPORT
 };

49 cÚ¡ * cÚ¡ 
	g³_mes§ges
[] = {

57 
šlše
 
boŞ


58 
·‰”n_”rÜ
(
wh©
, 
E¼ÜHªdËr
* 
”rh
)

60  
	g”rh
->
”rÜ
(
³_mes§ges
[
wh©
]), 
	gçl£
;

63 
boŞ


64 
_add»ss_v¬ŸtiÚ
(cÚ¡ 
SŒšg
 &
¡r
, 
IPAdd»ss
 *
addr
, 
št32_t
 *
v¬ŸtiÚ
,

65 
boŞ
 *
£qu’tŸl
, boŞ *
§me_fœ¡
, 
EËm’t
 *
cÚ‹xt
)

67 cÚ¡ *
	g’d
 = 
¡r
.
’d
();

68 ià(
	g’d
 > 
	g¡r
.
begš
() &&ƒnd[-1] == '#')

69 *
£qu’tŸl
 = 
Œue
, *
	g§me_fœ¡
 = 
çl£
, --
	g’d
;

70 ià(
	g’d
 > 
	g¡r
.
begš
() &&ƒnd[-1] == '?')

71 *
§me_fœ¡
 = 
çl£
, --
	g’d
;

72 cÚ¡ *
	gdash
 = 
fšd
(
¡r
.
begš
(), 
’d
, '-');

73 
IPAdd»ss
 
	gaddr2
;

75 ià(
	gdash
 !ğ
’d


76 && 
IPAdd»ssArg
().
·r£
(
¡r
.
sub¡ršg
(¡r.
begš
(), 
dash
), *
addr
, 
cÚ‹xt
)

77 && 
IPAdd»ssArg
().
·r£
(
¡r
.
sub¡ršg
(
dash
 + 1, 
’d
), 
addr2
, 
cÚ‹xt
)

78 && 
Áohl
(
addr2
.
addr
()) >=‚tohl(addr->addr())) {

79 *
v¬ŸtiÚ
 = 
Áohl
(
addr2
.
addr
()) -‚tohl(addr->addr());

80  
	gŒue
;

81 } ià(
	gdash
 =ğ
’d


82 && 
IPP»fixArg
(
Œue
).
·r£
(
¡r
.
sub¡ršg
(¡r.
begš
(), 
’d
), *
addr
, 
addr2
, 
cÚ‹xt
)

83 && *
	gaddr
 && 
	gaddr2
 &&‡ddr2.
mask_to_´efix_Ën
() >= 0) {

84 ià(
addr2
.
addr
() == 0xFFFFFFFFU)

85 *
v¬ŸtiÚ
 = 0;

86 ià(
	gaddr2
.
addr
(è=ğ
htÚl
(0xFFFFFFFEU)) {

87 *
addr
 &ğ
addr2
;

88 *
	gv¬ŸtiÚ
 = 1;

91 *
	gaddr
 = (*
addr
 & 
addr2
è| 
IPAdd»ss
(
htÚl
(1));

92 *
	gv¬ŸtiÚ
 = ~
Áohl
(
addr2
.
addr
()) - 2;

94  
	gŒue
;

96  
	gçl£
;

99 
boŞ


100 
pÜt_v¬ŸtiÚ
(cÚ¡ 
SŒšg
 &
¡r
, 
št32_t
 *
pÜt
, iÁ32_ˆ*
v¬ŸtiÚ
,

101 
boŞ
 *
£qu’tŸl
, boŞ *
§me_fœ¡
)

103 cÚ¡ *
	g’d
 = 
¡r
.
’d
();

104 ià(
	g’d
 > 
	g¡r
.
begš
() &&ƒnd[-1] == '#')

105 *
£qu’tŸl
 = 
Œue
, *
	g§me_fœ¡
 = 
çl£
, --
	g’d
;

106 ià(
	g’d
 > 
	g¡r
.
begš
() &&ƒnd[-1] == '?')

107 *
§me_fœ¡
 = 
çl£
, --
	g’d
;

108 cÚ¡ *
	gdash
 = 
fšd
(
¡r
.
begš
(), 
’d
, '-');

109 
št32_t
 
	gpÜt2
 = 0;

111 ià(
IÁArg
().
·r£
(
¡r
.
sub¡ršg
(¡r.
begš
(), 
dash
), *
pÜt
)

112 && 
IÁArg
().
·r£
(
¡r
.
sub¡ršg
(
dash
 + 1, 
’d
), 
pÜt2
)

113 && *
	gpÜt
 >ğ0 && 
pÜt2
 >ğ*
pÜt
 &&…ort2 < 65536) {

114 *
v¬ŸtiÚ
 = 
pÜt2
 - *
pÜt
;

115  
	gŒue
;

117  
	gçl£
;

121 
boŞ


122 
	gIPRewr™”P©‹º
::
·r£
(cÚ¡ 
VeùÜ
<
SŒšg
> &
wÜds
,

123 
IPRewr™”P©‹º
 **
p¡Üe
,

124 
EËm’t
 *
cÚ‹xt
, 
E¼ÜHªdËr
 *
”rh
)

126 ià(
	gwÜds
.
size
() < 1 || words.size() > 4)

127  
·‰”n_”rÜ
(
PE_SYNTAX
, 
”rh
);

129 ià(
	gwÜds
.
size
() == 1) {

130 
št32_t
 
x
;

131 
	gVeùÜ
<
	gIPRewr™”P©‹º
 *> *
	g·‰”ns
 =

132 
¡©ic_ÿ¡
<
VeùÜ
<
IPRewr™”P©‹º
 *> *>(
cÚ‹xt
->
rou‹r
()->
©chm’t
("IPRewriterPatterns"));

133 ià(
	gNameInfo
::
qu”y_št
(
NameInfo
::
T_IPREWRITER_PATTERN
, 
cÚ‹xt
,

134 
wÜds
[0], &
x
)

135 && 
	g·‰”ns
 && 
	gx
 >ğ0 && 
x
 < 
·‰”ns
->
size
()) {

136 *
p¡Üe
 = (*
·‰”ns
)[
x
];

137  
	gŒue
;

139 
	g”rh
->
”rÜ
("nØsuch…©‹º %<%s%>", 
wÜds
[0].
c_¡r
());

140  
	gçl£
;

144 
IPAdd»ss
 
	g§ddr
, 
	gdaddr
;

145 
št32_t
 
	g¥Üt
 = 0, 
	gdpÜt
 = 0, 
	gv¬ŸtiÚ
 = 0;

146 
boŞ
 
	g£qu’tŸl
 = 
çl£
, 
	g§me_fœ¡
 = 
Œue
;

149 
	gi
 = 0;

150 ià(!(
	gwÜds
[
i
].
equ®s
("-", 1)

151 || 
IPAdd»ssArg
().
·r£
(
wÜds
[
i
], 
§ddr
, 
cÚ‹xt
)

152 || 
_add»ss_v¬ŸtiÚ
(
wÜds
[
i
], &
§ddr
, &
v¬ŸtiÚ
,

153 &
£qu’tŸl
, &
§me_fœ¡
, 
cÚ‹xt
)))

154  
·‰”n_”rÜ
(
PE_SADDR
, 
”rh
);

157 ià(
	gwÜds
.
size
() >= 3) {

158 
i
 = 
wÜds
.
size
() == 3 ? 2 : 1;

159 ià(!(
	gwÜds
[
i
].
equ®s
("-", 1)

160 || (
IÁArg
().
·r£
(
wÜds
[
i
], 
¥Üt
è&& 
	g¥Üt
 > 0 && sport < 65536)

161 || 
pÜt_v¬ŸtiÚ
(
wÜds
[
i
], &
¥Üt
, &
v¬ŸtiÚ
,

162 &
£qu’tŸl
, &
§me_fœ¡
)))

163  
·‰”n_”rÜ
(
PE_SPORT
, 
”rh
);

164 
	gi
 = 
wÜds
.
size
() == 3 ? 0 : 1;

168 ++
	gi
;

169 ià(!(
	gwÜds
[
i
].
equ®s
("-", 1)

170 || 
IPAdd»ssArg
().
·r£
(
wÜds
[
i
], 
daddr
, 
cÚ‹xt
)))

171  
·‰”n_”rÜ
(
PE_DADDR
, 
”rh
);

174 ià(
	gwÜds
.
size
() == 4) {

175 ++
i
;

176 ià(!(
	gwÜds
[
i
].
equ®s
("-", 1)

177 || (
IÁArg
().
·r£
(
wÜds
[
i
], 
dpÜt
è&& 
	gdpÜt
 > 0 && dport < 65536)))

178  
·‰”n_”rÜ
(
PE_DPORT
, 
”rh
);

181 *
	gp¡Üe
 = 
Ãw
 
IPRewr™”P©‹º
(
§ddr
, 
htÚs
(
¥Üt
), 
daddr
, htÚs(
dpÜt
),

182 
wÜds
.
size
() >= 3,

183 
£qu’tŸl
, 
§me_fœ¡
, 
v¬ŸtiÚ
);

184  
	gŒue
;

187 
boŞ


188 
	gIPRewr™”P©‹º
::
·r£_pÜts
(cÚ¡ 
VeùÜ
<
SŒšg
> &
wÜds
,

189 
IPRewr™”IÅut
 *
šput
,

190 
EËm’t
 *, 
E¼ÜHªdËr
 *
”rh
)

192 ià(!(
	gwÜds
.
size
() == 2

193 && 
IÁArg
().
·r£
(
wÜds
[0], 
šput
->
fouut
)))

194  
	g”rh
->
”rÜ
("bad fÜw¬d…Üt"), 
	gçl£
;

195 ià(
IÁArg
().
·r£
(
wÜds
[1], 
šput
->
rouut
))

196  
	gŒue
;

198  
	g”rh
->
”rÜ
("bad„•ly…Üt"), 
	gçl£
;

201 
boŞ


202 
	gIPRewr™”P©‹º
::
	$·r£_w™h_pÜts
(cÚ¡ 
SŒšg
 &
cÚf
, 
IPRewr™”IÅut
 *
šput
,

203 
EËm’t
 *
e
, 
E¼ÜHªdËr
 *
”rh
)

205 
VeùÜ
<
SŒšg
> 
wÜds
, 
pÜt_wÜds
;

206 
	`ı_¥aûvec
(
cÚf
, 
wÜds
);

208 ià(
wÜds
.
	`size
() <= 2)

209  
	`·‰”n_”rÜ
(
PE_SYNTAX
, 
”rh
);

211 
pÜt_wÜds
.
	`push_back
(
wÜds
[wÜds.
	`size
() - 2]);

212 
pÜt_wÜds
.
	`push_back
(
wÜds
[wÜds.
	`size
() - 1]);

213 
wÜds
.
	`»size
(wÜds.
	`size
() - 2);

215  
	`·r£
(
wÜds
, &
šput
->
u
.
·‰”n
, 
e
, 
”rh
)

216 && 
	`·r£_pÜts
(
pÜt_wÜds
, 
šput
, 
e
, 
”rh
);

217 
	}
}

220 
	gIPRewr™”P©‹º
::
»wr™e_æowid
(cÚ¡ 
IPFlowID
 &
æowid
,

221 
IPFlowID
 &
»wr™‹n_æowid
,

222 cÚ¡ 
HashCÚš”
<
IPRewr™”EÁry
> &
»¶y_m­
)

224 
	g»wr™‹n_æowid
 = 
æowid
;

225 ià(
	g_§ddr
)

226 
	g»wr™‹n_æowid
.
£t_§ddr
(
_§ddr
);

227 ià(
	g_¥Üt
)

228 
	g»wr™‹n_æowid
.
£t_¥Üt
(
_¥Üt
);

229 ià(
	g_daddr
)

230 
	g»wr™‹n_æowid
.
£t_daddr
(
_daddr
);

231 ià(
	g_dpÜt
)

232 
	g»wr™‹n_æowid
.
£t_dpÜt
(
_dpÜt
);

234 ià(
	g_v¬ŸtiÚ_tİ
) {

235 
IPFlowID
 
	glookup
 = 
»wr™‹n_æowid
.
»v”£
();

236 
ušt32_t
 
	gba£
 = (
_is_Ç±
 ? 
Áohs
(
_¥Üt
è: 
Áohl
(
_§ddr
.
addr
()));

238 
ušt32_t
 
	gv®
;

239 ià(
	g_§me_fœ¡


240 && (
	gv®
 = 
Áohs
(
æowid
.
¥Üt
()è- 
ba£
è<ğ
_v¬ŸtiÚ_tİ
) {

241 
lookup
.
£t_dpÜt
(
æowid
.
¥Üt
());

242 ià(!
	g»¶y_m­
.
fšd
(
lookup
))

243 
	gfound_v¬ŸtiÚ
;

246 ià(
	g_£qu’tŸl
)

247 
	gv®
 = (
_Ãxt_v¬ŸtiÚ
 > 
_v¬ŸtiÚ_tİ
 ? 0 : _next_variation);

249 
	gv®
 = 
şick_¿ndom
(0, 
_v¬ŸtiÚ_tİ
);

251 
ušt32_t
 
	gcouÁ
 = 0; couÁ <ğ
_v¬ŸtiÚ_tİ
;

252 ++
	gcouÁ
, 
	gv®
 = (
v®
 =ğ
_v¬ŸtiÚ_tİ
 ? 0 : val + 1)) {

253 ià(
_is_Ç±
)

254 
lookup
.
£t_dpÜt
(
htÚs
(
ba£
 + 
v®
));

256 
	glookup
.
£t_daddr
(
htÚl
(
ba£
 + 
v®
));

257 ià(!
	g»¶y_m­
.
fšd
(
lookup
))

258 
	gfound_v¬ŸtiÚ
;

261  
	gIPRewr™”Ba£
::
rw_drİ
;

263 
	gfound_v¬ŸtiÚ
:

264 ià(
_is_Ç±
)

265 
»wr™‹n_æowid
.
£t_¥Üt
(
lookup
.
dpÜt
());

267 
	g»wr™‹n_æowid
.
£t_§ddr
(
lookup
.
daddr
());

268 
	g_Ãxt_v¬ŸtiÚ
 = 
v®
 + 1;

271  
	gIPRewr™”Ba£
::
rw_addm­
;

274 
SŒšg


275 
	gIPRewr™”P©‹º
::
	$uÅ¬£
() const

277 
SŒšgAccum
 
§
;

278 ià(!
_is_Ç±
 && 
_v¬ŸtiÚ_tİ
)

279 
§
 << 
_§ddr
 << '-'

280 << 
	`IPAdd»ss
(
	`htÚl
(
	`Áohl
(
_§ddr
.
	`addr
()è+ 
_v¬ŸtiÚ_tİ
));

281 ià(
_§ddr
)

282 
§
 << 
_§ddr
;

284 
§
 << '-';

286 ià(!
_is_Ç±
)

288 ià(!
_¥Üt
)

289 
§
 << " -";

290 ià(
_v¬ŸtiÚ_tİ
)

291 
§
 << ' ' << 
	`Áohs
(
_¥Üt
è<< '-' << (Áohs(_¥Ütè+ 
_v¬ŸtiÚ_tİ
);

293 
§
 << ' ' << 
	`Áohs
(
_¥Üt
);

295 ià(
_daddr
)

296 
§
 << ' ' << 
_daddr
;

298 
§
 << " -";

300 ià(!
_is_Ç±
)

302 ià(!
_dpÜt
)

303 
§
 << " -";

305 
§
 << ' ' << 
	`Áohs
(
_dpÜt
);

307  
§
.
	`ke_¡ršg
();

308 
	}
}

310 
CLICK_ENDDECLS


311 
	$ELEMENT_REQUIRES
(
IPRewr™”M­pšg
)

312 
	`ELEMENT_PROVIDES
(
IPRewr™”P©‹º
)

	@ip/iprwpattern.hh

2 #iâdeà
CLICK_IPRW_PATTERN_HH


3 
	#CLICK_IPRW_PATTERN_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/hashcÚš”.hh
>

6 
	~<şick/æowid.hh
>

7 
CLICK_DECLS


8 
şass
 
	gIPRewr™”Flow
;

9 
şass
 
	gIPRewr™”EÁry
;

10 
şass
 
	gIPRewr™”IÅut
;

12 şas 
	cIPRewr™”P©‹º
 { 
	mpublic
:

14 
IPRewr™”P©‹º
(cÚ¡ 
IPAdd»ss
 &
§ddr
, 
¥Üt
,

15 cÚ¡ 
IPAdd»ss
 &
daddr
, 
dpÜt
,

16 
boŞ
 
is_Ç±
, boŞ 
£qu’tŸl
, boŞ 
§me_fœ¡
,

17 
ušt32_t
 
v¬ŸtiÚ
);

18 
boŞ
 
·r£
(cÚ¡ 
VeùÜ
<
SŒšg
> &
wÜds
, 
IPRewr™”P©‹º
 **
»suÉ
,

19 
EËm’t
 *
cÚ‹xt
, 
E¼ÜHªdËr
 *
”rh
);

20 
boŞ
 
·r£_pÜts
(cÚ¡ 
VeùÜ
<
SŒšg
> &
wÜds
, 
IPRewr™”IÅut
 *
šput
,

21 
EËm’t
 *
mod–
, 
E¼ÜHªdËr
 *
”rh
);

22 
boŞ
 
·r£_w™h_pÜts
(cÚ¡ 
SŒšg
 &
¡r
, 
IPRewr™”IÅut
 *
šput
,

23 
EËm’t
 *
cÚ‹xt
, 
E¼ÜHªdËr
 *
”rh
);

25 
	$u£
() {

26 
_»fcouÁ
++;

28 
	$unu£
() {

29 ià(--
_»fcouÁ
 <= 0)

30 
d–‘e
 
this
;

31 
	}
}

33 
İ”©Ü
 
	$boŞ
() const {

34  
_§ddr
 || 
_¥Üt
 || 
_daddr
 || 
_dpÜt
;

35 
	}
}

36 
IPAdd»ss
 
	$daddr
() const {

37  
_daddr
;

38 
	}
}

40 
»wr™e_æowid
(cÚ¡ 
IPFlowID
 &
æowid
, IPFlowID &
»wr™‹n_æowid
,

41 cÚ¡ 
HashCÚš”
<
IPRewr™”EÁry
> &
»¶y_m­
);

43 
SŒšg
 
	$uÅ¬£
() const;

45 
´iv©e
:

47 
IPAdd»ss
 
_§ddr
;

48 
_¥Üt
;

49 
IPAdd»ss
 
_daddr
;

50 
_dpÜt
;

52 
ušt32_t
 
_v¬ŸtiÚ_tİ
;

53 
ušt32_t
 
_Ãxt_v¬ŸtiÚ
;

55 
boŞ
 
_is_Ç±
;

56 
boŞ
 
_£qu’tŸl
;

57 
boŞ
 
_§me_fœ¡
;

59 
_»fcouÁ
;

61 
	`IPRewr™”P©‹º
(cÚ¡ 
IPRewr™”P©‹º
&);

62 
IPRewr™”P©‹º
& 
İ”©Ü
=(const IPRewriterPattern&);

64 
	}
};

66 
	gCLICK_ENDDECLS


	@ip/iprwpatterns.cc

19 
	~<şick/cÚfig.h
>

20 
	~"rw·‰”ns.hh
"

21 
	~"–em’ts//rw·‰”n.hh
"

22 
	~<şick/cÚå¬£.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/Çmešfo.hh
>

26 
CLICK_DECLS


28 
	gIPRewr™”P©‹ºs
::
	$IPRewr™”P©‹ºs
()

30 
	}
}

32 
IPRewr™”P©‹ºs
::~
	$IPRewr™”P©‹ºs
()

34 
	}
}

37 
IPRewr™”P©‹ºs
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39 *&
	g·‰”ns_©chm’t
 = 
rou‹r
()->
fÜû_©chm’t
("IPRewriterPatterns");

40 ià(!
	g·‰”ns_©chm’t
)

41 
	g·‰”ns_©chm’t
 = 
Ãw
 
VeùÜ
<
IPRewr™”P©‹º
 *>;

42 
	gVeùÜ
<
	gIPRewr™”P©‹º
 *> *
	g·‰”ns
 =

43 
¡©ic_ÿ¡
<
VeùÜ
<
IPRewr™”P©‹º
 *> *>(
·‰”ns_©chm’t
);

45 
	gi
 = 0; i < 
	gcÚf
.
size
(); ++i) {

46 
SŒšg
 
	gÇme
 = 
ı_shiá_¥aûvec
(
cÚf
[
i
]);

47 ià(!
	gÇme
)

50 
št32_t
 
	gx
;

51 ià(
	gNameInfo
::
qu”y_št
(
NameInfo
::
T_IPREWRITER_PATTERN
, 
this
,

52 
Çme
, &
x
)) {

53 
	g”rh
->
”rÜ
("·‰”À%<%s%>‡Ì—dy defšed", 
Çme
.
c_¡r
());

57 
	gVeùÜ
<
	gSŒšg
> 
	gwÜds
;

58 
ı_¥aûvec
(
cÚf
[
i
], 
wÜds
);

59 
IPRewr™”P©‹º
 *
	gp
;

60 ià(!
	gIPRewr™”P©‹º
::
·r£
(
wÜds
, &
p
, 
this
, 
”rh
))

63 
	gp
->
u£
();

64 
	g·‰”ns
->
push_back
(
p
);

65 
	gNameInfo
::
defše_št
(
NameInfo
::
T_IPREWRITER_PATTERN
, 
this
,

66 
Çme
, 
·‰”ns
->
size
() - 1);

69  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

73 
	gIPRewr™”P©‹ºs
::
	$ş—nup
(
CËªupSge
)

75 *&
·‰”ns_©chm’t
 = 
	`rou‹r
()->
	`fÜû_©chm’t
("IPRewriterPatterns");

76 ià(
·‰”ns_©chm’t
) {

77 
VeùÜ
<
IPRewr™”P©‹º
 *> *
·‰”ns
 =

78 
¡©ic_ÿ¡
<
VeùÜ
<
IPRewr™”P©‹º
 *> *>(
·‰”ns_©chm’t
);

79 
i
 = 0; i < 
·‰”ns
->
	`size
(); ++i)

80 (*
·‰”ns
)[
i
]->
	`unu£
();

81 
d–‘e
 
·‰”ns
;

82 
·‰”ns_©chm’t
 = 0;

84 
	}
}

86 
CLICK_ENDDECLS


87 
	$ELEMENT_REQUIRES
(
IPRewr™”P©‹º
)

88 
	`EXPORT_ELEMENT
(
IPRewr™”P©‹ºs
)

	@ip/iprwpatterns.hh

1 #iâdeà
CLICK_IPRWPATTERNS_HH


2 
	#CLICK_IPRWPATTERNS_HH


	)

3 
	~"–em’ts//»wr™”ba£.hh
"

4 
	~<şick/hashbË.hh
>

5 
CLICK_DECLS


22 şas 
	cIPRewr™”P©‹ºs
 : 
public
 
EËm’t
 {…ublic:

24 
	$IPRewr™”P©‹ºs
(è
CLICK_COLD
;

25 ~
	$IPRewr™”P©‹ºs
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "IPRewriterPatterns"; }

29 
	$cÚfigu»_pha£
(ècÚ¡ {  
IPRewr™”Ba£
::
CONFIGURE_PHASE_PATTERNS
; 
	}
}

30 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

31 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

33 
	}
};

35 
	gCLICK_ENDDECLS


	@ip/lineariplookup.cc

21 
	~<şick/cÚfig.h
>

22 
	~"lš—rlookup.hh
"

23 
	~<şick/add»ss.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/”rÜ.hh
>

26 
CLICK_DECLS


28 
	gLš—rIPLookup
::
	$Lš—rIPLookup
()

29 : 
	`_z”o_rou‹
(-1)

31 
	}
}

33 
Lš—rIPLookup
::~
	$Lš—rIPLookup
()

35 
	}
}

38 
Lš—rIPLookup
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

40 
_Ï¡_addr
 = 
	`IPAdd»ss
();

41 #ifdeà
IP_RT_CACHE2


42 
_Ï¡_addr2
 = 
_Ï¡_addr
;

45 
	}
}

47 
boŞ


48 
	gLš—rIPLookup
::
	$check
() const

50 
boŞ
 
ok
 = 
Œue
;

54 
i
 = 0; i < 
_t
.
	`size
(); i++) {

55 ià(!
_t
[
i
].
	`»®
())

57 
j
 = 
i
 + 1; j < 
_t
[i].
exŒa
 && j < _t.
	`size
(); j++)

58 ià(
_t
[
i
].
	`cÚšs
(_t[
j
]è&& _t[j].
	`»®
()) {

59 
	`şick_ch©‹r
("%s: bad‚exˆpoš‹rs:„ou‹ %s, %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_t
[
i
].
	`uÅ¬£_addr
().c_¡r(), _t[
j
].unparse_addr().c_str());

60 
ok
 = 
çl£
;

64 
j
 = 
_t
[
i
].
exŒa
;

65 ià(
j
 < 
_t
.
	`size
())

66 ià(!
_t
[
i
].
	`cÚšs
(_t[
j
]è&& _t[j].
	`»®
()) {

67 
	`şick_ch©‹r
("%s: bad‚exˆpoš‹rs':„ou‹ %s, %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_t
[
i
].
	`uÅ¬£_addr
().c_¡r(), _t[
j
].unparse_addr().c_str());

68 
ok
 = 
çl£
;

74 
i
 = 0; i < 
_t
.
	`size
(); i++)

75 
j
 = 
i
 + 1; j < 
_t
.
	`size
(); j++)

76 ià(
_t
[
i
].
addr
 =ğ_t[
j
].add¸&& _t[i].
mask
 =ğ_t[j].mask && _t[i].
	`»®
() && _t[j].real()) {

77 
	`şick_ch©‹r
("%s: du¶iÿ‹„ou‹ fÜ %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_t
[
i
].
	`uÅ¬£_addr
().c_str());

78 
ok
 = 
çl£
;

82 ià(
_Ï¡_addr
 && 
	`lookup_’Œy
(_Ï¡_addrè!ğ
_Ï¡_’Œy
) {

83 
	`şick_ch©‹r
("%s: bad cach’Œy fÜ %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_Ï¡_addr
.
	`uÅ¬£
().c_str());

84 
ok
 = 
çl£
;

86 #ifdeà
IP_RT_CACHE2


87 ià(
_Ï¡_addr2
 && 
	`lookup_’Œy
(_Ï¡_addr2è!ğ
_Ï¡_’Œy2
) {

88 
	`şick_ch©‹r
("%s: bad cach’Œy fÜ %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_Ï¡_addr2
.
	`uÅ¬£
().c_str());

89 
ok
 = 
çl£
;

93  
ok
;

94 
	}
}

97 
	gLš—rIPLookup
::
	$add_rou‹
(cÚ¡ 
IPRou‹
 &
r
, 
boŞ
 
®low_»¶aû
, IPRou‹* 
»¶aûd
, 
E¼ÜHªdËr
 *)

100 
found
 = 
_t
.
	`size
();

101 
i
 = 0; i < 
_t
.
	`size
(); i++)

102 ià(!
_t
[
i
].
	`»®
()) {

103 ià(
found
 =ğ
_t
.
	`size
())

104 
found
 = 
i
;

105 } ià(
_t
[
i
].
addr
 =ğ
r
.add¸&& _t[i].
mask
 ==„.mask) {

106 ià(
»¶aûd
)

107 *
»¶aûd
 = 
_t
[
i
];

108 ià(!
®low_»¶aû
)

109  -
EEXIST
;

110 
_t
[
i
].
gw
 = 
r
.gw;

111 
_t
[
i
].
pÜt
 = 
r
.port;

112 
	`check
();

117 ià(
found
 =ğ
_t
.
	`size
())

118 
_t
.
	`push_back
(
r
);

120 
_t
[
found
] = 
r
;

123 
_t
[
found
].
exŒa
 = 0x7FFFFFFF;

124 
i
 = 
found
 - 1; i >= 0; i--)

125 ià(
_t
[
i
].
	`cÚšs
(
r
è&& _t[i].
exŒa
 > 
found
)

126 
_t
[
i
].
exŒa
 = 
found
;

127 
i
 = 
found
 + 1; i < 
_t
.
	`size
(); i++)

128 ià(
r
.
	`cÚšs
(
_t
[
i
]è&& _t[i].
	`»®
()) {

129 
_t
[
found
].
exŒa
 = 
i
;

134 ià(!
r
.
addr
 &&„.
mask
.
	`addr
() == 0xFFFFFFFFU)

135 
_z”o_rou‹
 = 
found
;

138 
_Ï¡_addr
 = 
	`IPAdd»ss
();

139 #ifdeà
IP_RT_CACHE2


140 
_Ï¡_addr2
 = 
	`IPAdd»ss
();

143 
	`check
();

145 
	}
}

148 
	gLš—rIPLookup
::
	$»move_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, IPRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
 *
”rh
)

150 
i
 = 0; i < 
_t
.
	`size
(); i++)

151 ià(
rou‹
.
	`m©ch
(
_t
[
i
])) {

152 ià(
Şd_rou‹
)

153 *
Şd_rou‹
 = 
_t
[
i
];

154 
_t
[
i
].
	`kl
();

157 ià(
i
 =ğ
_z”o_rou‹
)

158 
_z”o_rou‹
 = -1;

159 ià(
i
 < 
_z”o_rou‹
) {

160 
IPRou‹
 
	`z”o
(
_t
[
_z”o_rou‹
]);

161 
_t
[
_z”o_rou‹
].
	`kl
();

162 
r
 = 
	`add_rou‹
(
z”o
, 
çl£
, 0, 
”rh
);

163 
	`as£¹
(
r
 >= 0);

164 (è
r
;

168 
_Ï¡_addr
 = 
	`IPAdd»ss
();

169 #ifdeà
IP_RT_CACHE2


170 
_Ï¡_addr2
 = 
	`IPAdd»ss
();

172 
	`check
();

175  -
ENOENT
;

176 
	}
}

179 
	gLš—rIPLookup
::
	$lookup_’Œy
(
IPAdd»ss
 
a
) const

181 
i
 = 0; i < 
_t
.
	`size
(); i++)

182 ià(
_t
[
i
].
	`cÚšs
(
a
)) {

183 
found
 = 
i
;

184 
j
 = 
_t
[
i
].
exŒa
; j < _t.
	`size
(); j++)

185 ià(
_t
[
j
].
	`cÚšs
(
a
è&& _t[j].
	`mask_as_¥ecific
(_t[
found
].
mask
))

186 
found
 = 
j
;

187  
found
;

190 
	}
}

193 
	gLš—rIPLookup
::
	$lookup_rou‹
(
IPAdd»ss
 
a
, IPAdd»s &
gw
) const

195 
ei
 = 
	`lookup_’Œy
(
a
);

196 ià(
ei
 >= 0) {

197 
gw
 = 
_t
[
ei
].gw;

198  
_t
[
ei
].
pÜt
;

201 
	}
}

203 
SŒšg


204 
	gLš—rIPLookup
::
	$dump_rou‹s
()

206 
SŒšgAccum
 
§
;

207 
i
 = 0; i < 
_t
.
	`size
(); i++)

208 ià(
_t
[
i
].
	`»®
())

209 
_t
[
i
].
	`uÅ¬£
(
§
, 
Œue
) << '\n';

210  
§
.
	`ke_¡ršg
();

211 
	}
}

214 
	gLš—rIPLookup
::
	$push
(, 
Pack‘
 *
p
)

216 
	#EXCHANGE
(
a
,
b
,
t
è{ =‡;‡ = b; b =; }

	)

217 
IPAdd»ss
 
a
 = 
p
->
	`d¡__ªno
();

218 
ei
 = -1;

220 ià(
a
 &&‡ =ğ
_Ï¡_addr
)

221 
ei
 = 
_Ï¡_’Œy
;

222 #ifdeà
IP_RT_CACHE2


223 ià(
a
 &&‡ =ğ
_Ï¡_addr2
)

224 
ei
 = 
_Ï¡_’Œy2
;

226 ià((
ei
 = 
	`lookup_’Œy
(
a
)) >= 0) {

227 #ifdeà
IP_RT_CACHE2


228 
_Ï¡_addr2
 = 
_Ï¡_addr
;

229 
_Ï¡_’Œy2
 = 
_Ï¡_’Œy
;

231 
_Ï¡_addr
 = 
a
;

232 
_Ï¡_’Œy
 = 
ei
;

234 
com¶ašed
 = 0;

235 ià(++
com¶ašed
 <= 5)

236 
	`şick_ch©‹r
("Lš—rIPLookup:‚Ørou‹ fÜ %s", 
a
.
	`uÅ¬£
().
	`c_¡r
());

237 
p
->
	`kl
();

241 cÚ¡ 
IPRou‹
 &
e
 = 
_t
[
ei
];

242 ià(
e
.
gw
)

243 
p
->
	`£t_d¡__ªno
(
e
.
gw
);

244 
	`ouut
(
e
.
pÜt
).
	`push
(
p
);

245 
	}
}

247 
CLICK_ENDDECLS


248 
	$ELEMENT_REQUIRES
(
IPRou‹TabË
)

249 
	`EXPORT_ELEMENT
(
Lš—rIPLookup
)

	@ip/lineariplookup.hh

2 #iâdeà
CLICK_LINEARIPLOOKUP_HH


3 
	#CLICK_LINEARIPLOOKUP_HH


	)

4 
	~"rou‹bË.hh
"

5 
	gCLICK_DECLS


80 
	#IP_RT_CACHE2
 1

	)

82 şas 
	cLš—rIPLookup
 : 
public
 
IPRou‹TabË
 {…ublic:

84 
	$Lš—rIPLookup
(è
CLICK_COLD
;

85 ~
	$Lš—rIPLookup
(è
CLICK_COLD
;

87 cÚ¡ *
	$şass_Çme
() const {  "LinearIPLookup"; }

88 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

89 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

91 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

93 
	`push
(
pÜt
, 
Pack‘
 *
p
);

95 
	`add_rou‹
(cÚ¡ 
IPRou‹
&, 
boŞ
, IPRou‹*, 
E¼ÜHªdËr
 *);

96 
	`»move_rou‹
(cÚ¡ 
IPRou‹
&, IPRou‹*, 
E¼ÜHªdËr
 *);

97 
	$lookup_rou‹
(
IPAdd»ss
, IPAddress&) const;

98 
SŒšg
 
	`dump_rou‹s
();

100 
boŞ
 
	$check
() const;

102 
´Ùeùed
:

104 
VeùÜ
<
IPRou‹
> 
_t
;

105 
_z”o_rou‹
;

107 
IPAdd»ss
 
_Ï¡_addr
;

108 
_Ï¡_’Œy
;

110 #ifdeà
IP_RT_CACHE2


111 
IPAdd»ss
 
_Ï¡_addr2
;

112 
_Ï¡_’Œy2
;

115 
	$lookup_’Œy
(
IPAdd»ss
) const;

117 
	}
};

119 
	gCLICK_ENDDECLS


	@ip/lookupiproute.cc

21 
	~<şick/cÚfig.h
>

22 
	~"lookuprou‹.hh
"

23 
	~<şick/add»ss.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/rou‹r.hh
>

27 
CLICK_DECLS


29 
	gSticIPLookup
::
	$SticIPLookup
()

31 
	}
}

33 
SticIPLookup
::~
	$SticIPLookup
()

35 
	}
}

38 
SticIPLookup
::
	$add_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, 
boŞ
 
£t
, IPRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
 *
”rh
)

40 ià(
	`rou‹r
()->
	`š™Ÿlized
())

41  
”rh
->
	`”rÜ
("can't‡dd„outes dynamically");

43  
Lš—rIPLookup
::
	`add_rou‹
(
rou‹
, 
£t
, 
Şd_rou‹
, 
”rh
);

44 
	}
}

47 
	gSticIPLookup
::
	$»move_rou‹
(cÚ¡ 
IPRou‹
& 
r
, IPRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
 *
”rh
)

49 ià(
	`rou‹r
()->
	`š™Ÿlized
())

50  
”rh
->
	`”rÜ
("can't„emove„outes dynamically");

52  
Lš—rIPLookup
::
	`»move_rou‹
(
r
, 
Şd_rou‹
, 
”rh
);

53 
	}
}

56 
	gSticIPLookup
::
	$add_hªdËrs
()

58 
	`add_»ad_hªdËr
("bË", 
bË_hªdËr
);

59 
	`£t_hªdËr
("lookup", 
HªdËr
::
OP_READ
 | HªdËr::
READ_PARAM
, 
lookup_hªdËr
);

60 
	}
}

62 
CLICK_ENDDECLS


63 
	$ELEMENT_REQUIRES
(
Lš—rIPLookup
)

64 
	`EXPORT_ELEMENT
(
SticIPLookup
)

	@ip/lookupiproute.hh

2 #iâdeà
CLICK_STATICIPLOOKUP_HH


3 
	#CLICK_STATICIPLOOKUP_HH


	)

4 
	~"lš—rlookup.hh
"

5 
CLICK_DECLS


37 şas 
	cSticIPLookup
 : 
public
 
Lš—rIPLookup
 {…ublic:

39 
	$SticIPLookup
(è
CLICK_COLD
;

40 ~
	$SticIPLookup
(è
CLICK_COLD
;

42 cÚ¡ *
	$şass_Çme
() const {  "StaticIPLookup"; }

43 
	$add_hªdËrs
(è
CLICK_COLD
;

45 
	`add_rou‹
(cÚ¡ 
IPRou‹
&, 
boŞ
, IPRou‹*, 
E¼ÜHªdËr
 *);

46 
	`»move_rou‹
(cÚ¡ 
IPRou‹
&, IPRou‹*, 
E¼ÜHªdËr
 *);

48 
	}
};

50 
	gCLICK_ENDDECLS


	@ip/lookupiproutelinux.cc

22 
	~<şick/cÚfig.h
>

23 
	~"lookuprou‹lšux.hh
"

24 
	~<şick/add»ss.hh
>

25 
	~<şick/cÚå¬£.hh
>

26 
	~<şick/”rÜ.hh
>

27 
	~<şick/glue.hh
>

29 #ifdeà
CLICK_LINUXMODULE


30 
	~<şick/cxx´Ùeù.h
>

31 
	gCLICK_CXX_PROTECT


32 
	~<lšux/Ãtdeviû.h
>

33 
	~<lšux/.h
>

34 
	~<Ãt/rou‹.h
>

35 
	gCLICK_CXX_UNPROTECT


36 
	~<şick/cxxuÅrÙeù.h
>

39 
CLICK_DECLS


41 
	gLšuxIPLookup
::
	$LšuxIPLookup
()

43 
_nout
 = 0;

44 #ifdeà
CLICK_LINUXMODULE


45 
_out2dev
 = 0;

47 
	}
}

49 
	gLšuxIPLookup
::~
	$LšuxIPLookup
()

51 #ifdeà
CLICK_LINUXMODULE


52 if(
_out2dev
)

53 
d–‘e
[] 
_out2dev
;

55 
	}
}

58 
	gLšuxIPLookup
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

60 
	g_out2devÇme
 = 
cÚf
;

61 
	g_nout
 = 
_out2devÇme
.
size
();

62 ià(
nouuts
(è< 
	g_nout
 ||‚outputs() > _nout + 1)

63  
	g”rh
->
”rÜ
("Ãed %d o¸%d ouuˆpÜts", 
_nout
, _nout + 1);

68 
	gLšuxIPLookup
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

70 if(
	`š™_rou‹s
(
”rh
) < 0)

74 
	}
}

76 #ifdeà
CLICK_LINUXMODULE


79 
	gLšuxIPLookup
::
	$š™_rou‹s
(
E¼ÜHªdËr
 *
”rh
)

81 ià(
_out2dev
)

82 
d–‘e
[] 
_out2dev
;

83 
_out2dev
 = 
Ãw
 
Ãt_deviû
 * [
_nout
];

84 
_out2dev
[0] = 0;

85 
i
;

86 
i
 = 0; i < 
_nout
; i++){

87 
Ãt_deviû
 *
dev
 = 
AnyDeviû
::
	`g‘_by_Çme
(
_out2devÇme
[
i
].
	`c_¡r
());

88 ià(
dev
 == 0)

89  
”rh
->
	`”rÜ
("CªnÙ fšd deviû %s", 
_out2devÇme
[
i
].
	`c_¡r
());

90 
_out2dev
[
i
] = 
dev
;

93 
	}
}

95 
boŞ


96 
	gLšuxIPLookup
::
	$lookup
(
IPAdd»ss
 
a
, IPAdd»s &
gw
, &
ifi
)

98 
¹abË
 *
¹
 = 0;

100 ià(
	`_rou‹_ouut
(&
¹
,

101 
a
.
	`addr
(),

105 
gw
 = 
	`IPAdd»ss
(
¹
->
¹_g©eway
);

106 
ifi
 = -1;

107 
Ãt_deviû
 *
dev
 = 
¹
->
u
.
d¡
.dev;

108 
i
;

109 
i
 = 0; i < 
_nout
; i++){

110 if(
_out2dev
[
i
] =ğ
dev
)

111 
ifi
 = 
i
;

113 if(
ifi
 == -1)

114 
	`şick_ch©‹r
("LšuxIPLookup: unknowÀdev %x", 
dev
);

115 
	`_¹_put
(
¹
);

116 (
Œue
);

118 (
çl£
);

119 
	}
}

124 
	gLšuxIPLookup
::
	$š™_rou‹s
(
E¼ÜHªdËr
 *
”rh
)

126 
_t
.
	`ş—r
();

128 
FILE
 *
å
;

129 
buf
[200];

130 
å
 = 
	`fİ’
("/proc/net/route", "r");

131 if(
å
 == 0)

132  
”rh
->
	`”rÜ
("cannot open /proc/net/route");

133 
	`fg‘s
(
buf
, (buf), 
å
)){

134 
devÇme
[200];

135 
d¡
, 
gw
, 
mask
;

137 if(
	`ssÿnf
(
buf
, "%s%x%x%*s%*s%*s%*s%x",

138 
devÇme
,

139 &
d¡
,

140 &
gw
,

141 &
mask
) == 4){

142 
i
;

143 
i
 = 0; i < 
_nout
; i++)

144 if(
_out2devÇme
[
i
] =ğ
devÇme
)

146 if(
i
 < 
_nout
){

147 
_t
.
	`add
(
d¡
, 
mask
, 
gw
, 
i
);

149 
	`şick_ch©‹r
("LšuxIPLookup:‚ØouuˆfÜ dev %s", 
devÇme
);

154 
	`fşo£
(
å
);

156 
	}
}

158 
boŞ


159 
	gLšuxIPLookup
::
	$lookup
(
IPAdd»ss
 
a
, IPAdd»s &
gw
, &
ifi
)

161  
_t
.
	`lookup
(
a
, 
gw
, 
ifi
);

162 
	}
}

167 
	gLšuxIPLookup
::
	$push
(, 
Pack‘
 *
p
)

169 
IPAdd»ss
 
a
 = 
p
->
	`d¡__ªno
();

170 
IPAdd»ss
 
gw
;

171 
ifi
 = -1;

173 ià(
	`lookup
(
a
, 
gw
, 
ifi
è=ğ
Œue
){

174 
	`şick_ch©‹r
("routed %xo %x %d",

175 
a
.
	`addr
(),

176 
gw
.
	`addr
(),

177 
ifi
);

178 if(
gw
.
	`addr
() != 0)

179 
p
->
	`£t_d¡__ªno
(
gw
);

180 
	`ouut
(
ifi
).
	`push
(
p
);

182 
	`şick_ch©‹r
("LšuxIPLookup:‚Øgw fÜ %x", 
a
.
	`addr
());

183 
	`checked_ouut_push
(
_nout
, 
p
);

185 
	}
}

187 
CLICK_ENDDECLS


188 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

189 
	`EXPORT_ELEMENT
(
LšuxIPLookup
)

	@ip/lookupiproutelinux.hh

1 #iâdeà
CLICK_LINUXIPLOOKUP_HH


2 
	#CLICK_LINUXIPLOOKUP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/bË.hh
>

5 
CLICK_DECLS


40 şas 
	cLšuxIPLookup
 : 
public
 
EËm’t
 {

41 
public
:

42 
	$LšuxIPLookup
(è
CLICK_COLD
;

43 ~
	$LšuxIPLookup
(è
CLICK_COLD
;

45 cÚ¡ *
	$şass_Çme
() const {  "LinuxIPLookup"; }

46 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-"; 
	}
}

47 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

48 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

50 
	`push
(, 
Pack‘
 *);

52 
´iv©e
:

53 
_nout
;

54 
VeùÜ
<
SŒšg
> 
_out2devÇme
;

56 
	`š™_rou‹s
(
E¼ÜHªdËr
 *);

57 
boŞ
 
	`lookup
(
IPAdd»ss
, IPAddress &, &);

59 #ifdeà
CLICK_LINUXMODULE


60 
Ãt_deviû
 **
_out2dev
;

62 
IPTabË
 
_t
;

64 
	}
};

66 
	gCLICK_ENDDECLS


	@ip/lookupiproutemp.cc

19 
	~<şick/cÚfig.h
>

20 
	~"lookuprou‹mp.hh
"

21 
	~<şick/add»ss.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/glue.hh
>

26 #ifdeà
CLICK_LINUXMODULE


27 
	~<şick/cxx´Ùeù.h
>

28 
	gCLICK_CXX_PROTECT


29 
	~<lšux/sched.h
>

30 
	gCLICK_CXX_UNPROTECT


31 
	~<şick/cxxuÅrÙeù.h
>

34 
CLICK_DECLS


36 
	gLookupIPRou‹MP
::
	$LookupIPRou‹MP
()

38 #ià
HAVE_USER_MULTITHREAD


39 
_ÿche
 = 0;

41 
	}
}

43 
	gLookupIPRou‹MP
::~
	$LookupIPRou‹MP
()

45 
	}
}

48 
LookupIPRou‹MP
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

50 
	gmaxout
 = -1;

51 
	g_t
.
ş—r
();

53 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

54 
IPAdd»ss
 
	gd¡
, 
	gmask
, 
	ggw
;

55 
št32_t
 
	gouut_num
;

56 
boŞ
 
	gok
 = 
çl£
;

58 
	gVeùÜ
<
	gSŒšg
> 
	gwÜds
;

59 
ı_¥aûvec
(
cÚf
[
i
], 
wÜds
);

61 ià((
	gwÜds
.
size
(è=ğ2 || 
wÜds
.size() == 3)

62 && 
IPP»fixArg
(
Œue
).
·r£
(
wÜds
[0], 
d¡
, 
mask
, 
this
)

63 && 
IÁArg
().
·r£
(
wÜds
.
back
(), 
ouut_num
)) {

64 ià(
	gwÜds
.
size
() == 3)

65 
ok
 = 
IPAdd»ssArg
().
·r£
(
wÜds
[1], 
gw
, 
this
);

67 
	gok
 = 
Œue
;

70 ià(
	gok
 && 
	gouut_num
 >= 0) {

71 
_t
.
add
(
d¡
, 
mask
, 
gw
, 
ouut_num
);

72 ià(
	gouut_num
 > 
	gmaxout
)

73 
	gmaxout
 = 
ouut_num
;

75 
	g”rh
->
”rÜ
("¬gum’ˆ%d should b`DADDR/MASK [GATEWAY] OUTPUT'", 
i
+1);

77 ià(
	g”rh
->
Ã¼Üs
())

79 ià(
	gmaxout
 < 0)

80 
	g”rh
->
w¬nšg
("no„outes");

81 ià(
	gmaxout
 >ğ
nouuts
())

82  
”rh
->
”rÜ
("Ãed %d o¸mÜouuˆpÜts", 
maxout
 + 1);

88 
	gLookupIPRou‹MP
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

90 #ià
HAVE_USER_MULTITHREAD


91 
_ÿche
 = (
ÿche_’Œy
*)
	`m®loc
((*_ÿcheè* 
	`şick_max_ıu_ids
());

94 
	`şick_ch©‹r
("LookupIPRouteMP‡lignment: %p, %p",

95 &(
_ÿche
[0].
_Ï¡_addr_1
), &(_cache[1]._last_addr_1));

96 
i
=0; i<
	`şick_max_ıu_ids
(); i++) {

97 
_ÿche
[
i
].
_Ï¡_addr_1
 = 
	`IPAdd»ss
();

98 
_ÿche
[
i
].
_Ï¡_addr_2
 = 
	`IPAdd»ss
();

101 
	}
}

104 
	gLookupIPRou‹MP
::
	$ş—nup
(
CËªupSge
)

106 #ià
HAVE_USER_MULTITHREAD


107 
	`ä“
(
_ÿche
);

109 
	}
}

112 
	gLookupIPRou‹MP
::
	$push
(, 
Pack‘
 *
p
)

114 
IPAdd»ss
 
a
 = 
p
->
	`d¡__ªno
();

115 
IPAdd»ss
 
gw
;

116 
ifi
 = -1;

117 
ÿche_’Œy
 *
e
 = &
_ÿche
[
	`şick_cu¼’t_ıu_id
()];

119 ià(
a
) {

120 ià(
a
 =ğ
e
->
_Ï¡_addr_1
) {

121 ià(
e
->
_Ï¡_gw_1
)

122 
p
->
	`£t_d¡__ªno
(
e
->
_Ï¡_gw_1
);

123 
	`ouut
(
e
->
_Ï¡_ouut_1
).
	`push
(
p
);

126 ià(
a
 =ğ
e
->
_Ï¡_addr_2
) {

127 ià(
e
->
_Ï¡_gw_2
)

128 
p
->
	`£t_d¡__ªno
(
e
->
_Ï¡_gw_2
);

129 
	`ouut
(
e
->
_Ï¡_ouut_2
).
	`push
(
p
);

134 ià(
_t
.
	`lookup
(
a
, 
gw
, 
ifi
)) {

135 
e
->
_Ï¡_addr_2
 =ƒ->
_Ï¡_addr_1
;

136 
e
->
_Ï¡_gw_2
 =ƒ->
_Ï¡_gw_1
;

137 
e
->
_Ï¡_ouut_2
 =ƒ->
_Ï¡_ouut_1
;

138 
e
->
_Ï¡_addr_1
 = 
a
;

139 
e
->
_Ï¡_gw_1
 = 
gw
;

140 
e
->
_Ï¡_ouut_1
 = 
ifi
;

141 ià(
gw
)

142 
p
->
	`£t_d¡__ªno
(
gw
);

143 
	`ouut
(
ifi
).
	`push
(
p
);

145 
	`şick_ch©‹r
("LookupIPRou‹MP:‚Øgw fÜ %x", 
a
.
	`addr
());

146 
p
->
	`kl
();

148 
	}
}

150 
CLICK_ENDDECLS


151 
EXPORT_ELEMENT
(
LookupIPRou‹MP
)

	@ip/lookupiproutemp.hh

1 #iâdeà
LOOKUPIPROUTEMP_HH


2 
	#LOOKUPIPROUTEMP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/bË.hh
>

5 
CLICK_DECLS


21 şas 
	cLookupIPRou‹MP
 : 
public
 
EËm’t
 {

22 
	sÿche_’Œy
 {

23 
IPAdd»ss
 
_Ï¡_addr_1
;

24 
IPAdd»ss
 
	m_Ï¡_gw_1
;

25 
	m_Ï¡_ouut_1
;

26 
IPAdd»ss
 
	m_Ï¡_addr_2
;

27 
IPAdd»ss
 
	m_Ï¡_gw_2
;

28 
	m_Ï¡_ouut_2
;

29 } 
__©Œibu‹__
((
®igÃd
(64)));

31 #ià
CLICK_USERLEVEL
 && 
HAVE_MULTITHREAD


32 
ÿche_’Œy
 *
	g_ÿche
;

34 
ÿche_’Œy
 
	g_ÿche
[
CLICK_CPU_MAX
];

37 
IPTabË
 
	g_t
;

39 
	gpublic
:

40 
	$LookupIPRou‹MP
(è
CLICK_COLD
;

41 ~
	$LookupIPRou‹MP
(è
CLICK_COLD
;

43 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "LookupIPRou‹MP"; 
	}
}

44 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

46 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

47 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

48 
	$ş—nup
(
CËªupSge
 
¡age
è
CLICK_COLD
;

50 
	`push
(
pÜt
, 
Pack‘
 *
p
);

51 
	}
};

53 
	gCLICK_ENDDECLS


	@ip/markipce.cc

18 
	~<şick/cÚfig.h
>

19 
	~"m¬kû.hh
"

20 
	~<şickÃt/.h
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gM¬kIPCE
::
	$M¬kIPCE
()

27 
_drİs
 = 0;

28 
	}
}

30 
	gM¬kIPCE
::~
	$M¬kIPCE
()

32 
	}
}

35 
M¬kIPCE
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 
	g_fÜû
 = 
çl£
;

38  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("FORCE", 
_fÜû
).
com¶‘e
();

41 
Pack‘
 *

42 
	gM¬kIPCE
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

44 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

45 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

46 ià((
h
->
_tos
 & 
IP_ECNMASK
è=ğ
IP_ECN_NOT_ECT
 && !
_fÜû
) {

47 
p
->
	`kl
();

49 } ià((
h
->
_tos
 & 
IP_ECNMASK
è=ğ
IP_ECN_CE
)

50  
p
;

52 
Wr™abËPack‘
 *
q
;

53 ià(!(
q
 = 
p
->
	`uniqueify
()))

56 
şick_
 *
q_h
 = 
q
->
	`_h—d”
();

57 
ušt16_t
 
Şd_hw
 = *(ušt16_ˆ*è
q_h
;

58 
q_h
->
_tos
 |ğ
IP_ECN_CE
;

59 
	`şick_upd©e_š_cksum
(&
q_h
->
_sum
, 
Şd_hw
, *(
ušt16_t
 *) q_iph);

61  
q
;

62 
	}
}

65 
	gM¬kIPCE
::
	$add_hªdËrs
()

67 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

68 
	}
}

70 
CLICK_ENDDECLS


71 
	$EXPORT_ELEMENT
(
M¬kIPCE
)

72 
	`ELEMENT_MT_SAFE
(
M¬kIPCE
)

	@ip/markipce.hh

1 #iâdeà
CLICK_MARKIPCE_HH


2 
	#CLICK_MARKIPCE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/©omic.hh
>

5 
CLICK_DECLS


23 şas 
	cM¬kIPCE
 : 
public
 
EËm’t
 {…ublic:

25 
	$M¬kIPCE
(è
CLICK_COLD
;

26 ~
	$M¬kIPCE
(è
CLICK_COLD
;

28 cÚ¡ *
	$şass_Çme
() const {  "MarkIPCE"; }

29 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

31 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

32 
	$add_hªdËrs
(è
CLICK_COLD
;

34 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

36 
´iv©e
:

38 
boŞ
 
_fÜû
;

39 
©omic_ušt32_t
 
_drİs
;

41 
	}
};

43 
	gCLICK_ENDDECLS


	@ip/markipheader.cc

18 
	~<şick/cÚfig.h
>

19 
	~"m¬kh—d”.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şickÃt/.h
>

22 
CLICK_DECLS


24 
	gM¬kIPH—d”
::
	$M¬kIPH—d”
()

26 
	}
}

28 
M¬kIPH—d”
::~
	$M¬kIPH—d”
()

30 
	}
}

33 
M¬kIPH—d”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

35 
	g_off£t
 = 0;

36  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("OFFSET", 
_off£t
).
com¶‘e
();

39 
Pack‘
 *

40 
	gM¬kIPH—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

42 cÚ¡ 
şick_
 *

 = 
»š‹½»t_ÿ¡
<cÚ¡ click_ *>(
p
->
	`d©a
(è+ 
_off£t
);

43 
p
->
	`£t__h—d”
(

, ip->
_hl
 << 2);

44  
p
;

45 
	}
}

47 
CLICK_ENDDECLS


48 
	$EXPORT_ELEMENT
(
M¬kIPH—d”
)

49 
	`ELEMENT_MT_SAFE
(
M¬kIPH—d”
)

	@ip/markipheader.hh

1 #iâdeà
CLICK_MARKIPHEADER_HH


2 
	#CLICK_MARKIPHEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


22 şas 
	cM¬kIPH—d”
 : 
public
 
EËm’t
 {

24 
_off£t
;

26 
	mpublic
:

28 
	$M¬kIPH—d”
(è
CLICK_COLD
;

29 ~
	$M¬kIPH—d”
(è
CLICK_COLD
;

31 cÚ¡ *
	$şass_Çme
() const {  "MarkIPHeader"; }

32 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

33 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

35 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

39 
	gCLICK_ENDDECLS


	@ip/radixiplookup.cc

22 
	~<şick/cÚfig.h
>

23 
	~<şick/add»ss.hh
>

24 
	~<şick/cÚå¬£.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/glue.hh
>

27 
	~<şick/¡¿ccum.hh
>

28 
	~"¿dixlookup.hh
"

29 
CLICK_DECLS


31 şas 
	cRadixIPLookup
::
Radix
 { 
public
:

33 
Radix
 *
make_¿dix
(
Ëv–
);

34 
ä“_¿dix
(
Radix
 *
r
, 
Ëv–
);

36 
chªge
(
ušt32_t
 
addr
, ušt32_ˆ
mask
, 
key
, 
boŞ
 
£t
, 
Ëv–
);

39 
šlše
 
	$lookup
(cÚ¡ 
Radix
 *
r
, 
cur
, 
ušt32_t
 
addr
, 
Ëv–
) {

40 
r
) {

41 
i1
 = (
addr
 >> 
_b™shiá
[
Ëv–
]è& (
_nbuck‘s
[level] - 1);

42 cÚ¡ 
Chd
 &
c
 = 
r
->
_chd»n
[
i1
];

43 ià(
c
.
key
)

44 
cur
 = 
c
.
key
;

45 
r
 = 
c
.
chd
;

46 
Ëv–
++;

48  
cur
;

51 
´iv©e
:

54 
	sChd
 {

55 
key
;

56 
Radix
 *
chd
;

57 
	}
} 
	g_chd»n
[0];

59 
	$Radix
(è{ 
	}
}

60 ~
	$Radix
(è{ 
	}
}

62 & 
	$key_fÜ
(
i
, 
Ëv–
) {

63 
n
 = 
_nbuck‘s
[
Ëv–
];

64 
	`as£¹
(
i
 >ğ2 && i < 
n
 * 2);

65 ià(
i
 >ğ
n
)

66  
_chd»n
[
i
 - 
n
].
key
;

68 *
x
 = 
»š‹½»t_ÿ¡
<*>(
_chd»n
 + 
n
);

69  
x
[
i
 - 2];

71 
	}
}

73 cÚ¡ 
	g_b™shiá
 [5];

74 cÚ¡ 
	g_nbuck‘s
 [5];

76 
ä›nd
 
şass
 
	gRadixIPLookup
;

80 cÚ¡ 
	gRadixIPLookup
::
Radix
::
_b™shiá
 [5] = {16, 12, 8, 4, 0};

85 cÚ¡ 
	gRadixIPLookup
::
Radix
::
_nbuck‘s
 [5] = {65536, 16, 16, 16, 16};

88 
	gRadixIPLookup
::
	$fšd_lookup_key
(
IPAdd»ss
 
gw
, 
št32_t
 
pÜt
) {

89 
i
=0; i < 
_lookup
.
	`size
(); i++) {

90 if(
_lookup
[
i
].
gw
 == gw &&

91 
_lookup
[
i
].
pÜt
 ==…ort)

92  (
i
 + 1);

95 
	}
}

97 
	gRadixIPLookup
::
Radix
*

98 
RadixIPLookup
::
Radix
::
	$make_¿dix
(
Ëv–
)

100 
n
 = 
_nbuck‘s
[
Ëv–
];

101 ià(
Radix
* 
r
 = (Radix*è
Ãw
 [(Radixè+ 
n
 * (
Chd
) + (n - 2) * ()]) {

102 
	`mem£t
(
r
->
_chd»n
, 0, 
n
 * (
Chd
) + (n - 2) * ());

103  
r
;

106 
	}
}

109 
	gRadixIPLookup
::
Radix
::
	$ä“_¿dix
(
Radix
* 
r
, 
Ëv–
)

111 
n
 = 
_nbuck‘s
[
Ëv–
];

112 
i
 = 0; i < 
n
; i++)

113 ià(
r
->
_chd»n
[
i
].
chd
)

114 
	`ä“_¿dix
(
r
->
_chd»n
[
i
].
chd
, 
Ëv–
+1);

115 
d–‘e
[] (*)
r
;

116 
	}
}

119 
	gRadixIPLookup
::
Radix
::
	$chªge
(
ušt32_t
 
addr
, ušt32_ˆ
mask
, 
key
, 
boŞ
 
£t
, 
Ëv–
)

121 
shiá
 = 
_b™shiá
[
Ëv–
];

122 
n
 = 
_nbuck‘s
[
Ëv–
];

123 
i1
 = (
addr
 >> 
shiá
è& (
n
 - 1);

126 ià(
mask
 & ((1U << 
shiá
) - 1)) {

127 ià(!
_chd»n
[
i1
].
chd


128 && (
_chd»n
[
i1
].
chd
 = 
	`make_¿dix
(
Ëv–
 + 1))) {

131 ià(
_chd»n
[
i1
].
chd
)

132  
_chd»n
[
i1
].
chd
->
	`chªge
(
addr
, 
mask
, 
key
, 
£t
, 
Ëv–
+1);

138 
i1
 = 
n
 + i1;

139 
nmasked
 = 
n
 - ((
mask
 >> 
shiá
) & (n - 1));

140 
x
 = 
nmasked
; x > 1; x /= 2)

141 
i1
 /= 2;

142 
»¶aû_key
 = 
	`key_fÜ
(
i1
, 
Ëv–
), 
´ev_key
 =„eplace_key;

143 ià(
´ev_key
 && 
i1
 > 3 && 
	`key_fÜ
(i1 / 2, 
Ëv–
) ==…rev_key)

144 
´ev_key
 = 0;

147 ià(!
key
 && 
i1
 > 3)

148 
key
 = (
	`key_fÜ
(
i1
 / 2, 
Ëv–
));

150 ià(
´ev_key
 !ğ
key
 && (!´ev_key || 
£t
)) {

151 
nmasked
 = 1; 
i1
 < 
n
 * 2; i1 *= 2,‚masked *= 2)

152 
x
 = 
i1
; x < i1 + 
nmasked
; ++x) {

153 ià(
	`key_fÜ
(
x
, 
Ëv–
è=ğ
»¶aû_key
) {

154 
	`key_fÜ
(
x
, 
Ëv–
èğ
key
;

159  
´ev_key
;

160 
	}
}

163 
	gRadixIPLookup
::
	$RadixIPLookup
()

164 : 
	`_vä“
(-1), 
	`_deçuÉ_key
(0), 
	`_¿dix
(
Radix
::
	$make_¿dix
(0))

166 
	}
}

168 
RadixIPLookup
::~
	$RadixIPLookup
()

170 
	}
}

174 
RadixIPLookup
::
	$ş—nup
(
CËªupSge
)

176 
Ëv–
 = 0;

177 
_v
.
	`ş—r
();

178 
Radix
::
	`ä“_¿dix
(
_¿dix
, 
Ëv–
);

179 
_¿dix
 = 0;

180 
	}
}

183 
	gRadixIPLookup
::
	$add_hªdËrs
()

185 
IPRou‹TabË
::
	`add_hªdËrs
();

186 
	`add_wr™e_hªdËr
("æush", 
æush_hªdËr
, 0, 
HªdËr
::
BUTTON
);

187 
	}
}

189 
SŒšg


190 
	gRadixIPLookup
::
	$dump_rou‹s
()

192 
SŒšgAccum
 
§
;

193 
j
 = 
_vä“
; j >ğ0; j = 
_v
[j].
exŒa
)

194 
_v
[
j
].
	`kl
();

195 
i
 = 0; i < 
_v
.
	`size
(); i++)

196 ià(
_v
[
i
].
	`»®
())

197 
_v
[
i
].
	`uÅ¬£
(
§
, 
Œue
) << '\n';

198  
§
.
	`ke_¡ršg
();

199 
	}
}

203 
	gRadixIPLookup
::
	$add_rou‹
(cÚ¡ 
IPRou‹
 &
rou‹
, 
boŞ
 
£t
, IPRou‹ *
Şd_rou‹
, 
E¼ÜHªdËr
 *)

205 
found
 = (
_vä“
 < 0 ? 
_v
.
	`size
(è: _vä“), 
Ï¡_key
;

206 
lookup_key
 = 
	`fšd_lookup_key
(
rou‹
.
gw
,„ou‹.
pÜt
);

207 if(!
lookup_key
)

208 
lookup_key
 = 
_lookup
.
	`size
() + 1;

210 ià(
rou‹
.
mask
) {

211 
ušt32_t
 
addr
 = 
	`Áohl
(
rou‹
.addr.
	`addr
());

212 
ušt32_t
 
mask
 = 
	`Áohl
(
rou‹
.mask.
	`addr
());

213 
Ëv–
 = 0;

214 
Ï¡_key
 = 
_¿dix
->
	`chªge
(
addr
, 
mask
, 
	`combše_key
(
found
 + 1, 
lookup_key
), 
£t
, 
Ëv–
);

216 
Ï¡_key
 = 
	`g‘_key
(last_key);

218 
Ï¡_key
 = 
	`g‘_key
(
_deçuÉ_key
);

219 ià(!
Ï¡_key
 || 
£t
)

220 
_deçuÉ_key
 = 
	`combše_key
(
found
 + 1, 
lookup_key
);

223 ià(
Ï¡_key
 && 
Şd_rou‹
)

224 *
Şd_rou‹
 = 
_v
[
Ï¡_key
 - 1];

225 ià(
Ï¡_key
 && !
£t
)

226  -
EEXIST
;

228 ià(
lookup_key
 =ğ(
_lookup
.
	`size
() + 1)) {

229 
GWPÜt
 
gw_pÜt
 = {
rou‹
.
gw
,„ou‹.
pÜt
};

230 
_lookup
.
	`push_back
(
gw_pÜt
);

233 ià(
found
 =ğ
_v
.
	`size
())

234 
_v
.
	`push_back
(
rou‹
);

236 
_vä“
 = 
_v
[
found
].
exŒa
;

237 
_v
[
found
] = 
rou‹
;

239 
_v
[
found
].
exŒa
 = -1;

241 ià(
Ï¡_key
) {

242 
_v
[
Ï¡_key
 - 1].
exŒa
 = 
_vä“
;

243 
_vä“
 = 
Ï¡_key
 - 1;

247 
	}
}

250 
	gRadixIPLookup
::
	$»move_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, IPRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
*)

252 
Ï¡_key
;

253 ià(
rou‹
.
mask
) {

254 
ušt32_t
 
addr
 = 
	`Áohl
(
rou‹
.addr.
	`addr
());

255 
ušt32_t
 
mask
 = 
	`Áohl
(
rou‹
.mask.
	`addr
());

256 
Ëv–
 = 0;

258 
Ï¡_key
 = 
	`g‘_key
(
_¿dix
->
	`chªge
(
addr
, 
mask
, 0, 
çl£
, 
Ëv–
));

260 
Ï¡_key
 = 
	`g‘_key
(
_deçuÉ_key
);

262 ià(
Ï¡_key
 && 
Şd_rou‹
)

263 *
Şd_rou‹
 = 
_v
[
Ï¡_key
 - 1];

264 ià(!
Ï¡_key
 || !
rou‹
.
	`m©ch
(
_v
[last_key - 1]))

265  -
ENOENT
;

266 
_v
[
Ï¡_key
 - 1].
exŒa
 = 
_vä“
;

267 
_vä“
 = 
Ï¡_key
 - 1;

269 ià(
rou‹
.
mask
) {

270 
ušt32_t
 
addr
 = 
	`Áohl
(
rou‹
.addr.
	`addr
());

271 
ušt32_t
 
mask
 = 
	`Áohl
(
rou‹
.mask.
	`addr
());

272 
Ëv–
 = 0;

273 (è
_¿dix
->
	`chªge
(
addr
, 
mask
, 0, 
Œue
, 
Ëv–
);

275 
_deçuÉ_key
 = 0;

277 
	}
}

280 
	gRadixIPLookup
::
	$lookup_rou‹
(
IPAdd»ss
 
addr
, IPAdd»s &
gw
) const

282 
Ëv–
 = 0;

283 
key
 = 
Radix
::
	`lookup
(
_¿dix
, 
_deçuÉ_key
, 
	`Áohl
(
addr
.
	`addr
()), 
Ëv–
);

284 
lookup_key
 = 
	`g‘_lookup_key
(
key
);

285 ià(
lookup_key
) {

286 
gw
 = 
_lookup
[
lookup_key
 - 1].gw;

287  
_lookup
[
lookup_key
 - 1].
pÜt
;

289 
gw
 = 0;

292 
	}
}

295 
	gRadixIPLookup
::
	$æush_bË
()

297 
Ëv–
 = 0;

298 
_v
.
	`ş—r
();

299 
Radix
::
	`ä“_¿dix
(
_¿dix
, 
Ëv–
);

300 
_¿dix
 = 
Radix
::
	`make_¿dix
(0);

301 
_vä“
 = -1;

302 
_deçuÉ_key
 = 0;

303 
	}
}

306 
	gRadixIPLookup
::
	$æush_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

308 
RadixIPLookup
 *
t
 = 
¡©ic_ÿ¡
<RadixIPLooku°*>(
e
);

309 
t
->
	`æush_bË
();

311 
	}
}

313 
CLICK_ENDDECLS


314 
	$ELEMENT_REQUIRES
(
IPRou‹TabË
)

315 
	`EXPORT_ELEMENT
(
RadixIPLookup
)

	@ip/radixiplookup.hh

2 #iâdeà
CLICK_RADIXIPLOOKUP_HH


3 
	#CLICK_RADIXIPLOOKUP_HH


	)

4 
	~<şick/glue.hh
>

5 
	~<şick/–em’t.hh
>

6 
	~"rou‹bË.hh
"

7 
CLICK_DECLS


72 şas 
	cRadixIPLookup
 : 
public
 
IPRou‹TabË
 {…ublic:

74 
	$RadixIPLookup
(è
CLICK_COLD
;

75 ~
	$RadixIPLookup
(è
CLICK_COLD
;

77 cÚ¡ *
	$şass_Çme
() const {  "RadixIPLookup"; }

78 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

79 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

82 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

83 
	$add_hªdËrs
(è
CLICK_COLD
;

85 
	`add_rou‹
(cÚ¡ 
IPRou‹
&, 
boŞ
, IPRou‹*, 
E¼ÜHªdËr
 *);

86 
	`»move_rou‹
(cÚ¡ 
IPRou‹
&, IPRou‹*, 
E¼ÜHªdËr
 *);

87 
	$lookup_rou‹
(
IPAdd»ss
, IPAddress&) const;

88 
	`fšd_lookup_key
(
IPAdd»ss
 
gw
, 
pÜt
);

89 
SŒšg
 
	`dump_rou‹s
();

91 
´iv©e
:

92 
	sGWPÜt
 {

93 
IPAdd»ss
 
gw
;

94 
št32_t
 
pÜt
;

95 
	}
};

98 
šlše
 
št32_t
 
	$combše_key
(
št32_t
 
key
, iÁ32_ˆ
lookup_key
) {

99 
	`as£¹
(
lookup_key
 <= 0xff);

100 
	`as£¹
(
key
 <= 0x00ffffff);

101  ((
lookup_key
è<< 24 | 
key
);

102 
	}
}

104 
šlše
 
št32_t
 
	$g‘_key
(
št32_t
 
comb
) {

105  (
comb
 & 0x00ffffff);

106 
	}
}

108 
šlše
 
št32_t
 
	$g‘_lookup_key
(
št32_t
 
comb
) {

109  ((
comb
 & 0xff000000) >> 24);

110 
	}
}

112 
æush_bË
();

114 
æush_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

116 
şass
 
	gRadix
;

119 
	gVeùÜ
<
	gIPRou‹
> 
	g_v
;

120 
	g_vä“
;

123 
	gVeùÜ
<
	gGWPÜt
> 
	g_lookup
;

125 
	g_deçuÉ_key
;

126 
Radix
 *
	g_¿dix
;

131 
	gCLICK_ENDDECLS


	@ip/rangeiplookup.cc

21 
	~<şick/cÚfig.h
>

22 
	~"¿ngelookup.hh
"

23 
	~<şick/add»ss.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/rou‹r.hh
>

26 
	~<şick/”rÜ.hh
>

27 
CLICK_DECLS


29 
	gRªgeIPLookup
::
	$RªgeIPLookup
()

30 : 
	`_¿nge_ba£
((
ušt32_t
 *è
	`CLICK_LALLOC
((1 << 
KICKSTART_BITS
) * (uint32_t))),

31 
	`_¿nge_Ën
((
ušt32_t
 *è
	`CLICK_LALLOC
((1 << 
KICKSTART_BITS
) * (uint32_t))),

32 
	`_¿nge_t
((
ušt32_t
 *è
	`CLICK_LALLOC
(
RANGES_MAX
 * (uint32_t))),

33 
	$_aùive
(
çl£
)

35 
	}
}

37 
	gRªgeIPLookup
::~
	$RªgeIPLookup
()

39 
	`CLICK_LFREE
(
_¿nge_ba£
, (1 << 
KICKSTART_BITS
è* (
ušt32_t
));

40 
	`CLICK_LFREE
(
_¿nge_Ën
, (1 << 
KICKSTART_BITS
è* (
ušt32_t
));

41 
	`CLICK_LFREE
(
_¿nge_t
, 
RANGES_MAX
 * (
ušt32_t
));

42 
	}
}

45 
	gRªgeIPLookup
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

47 
	gr
;

48 ià((
	gr
 = 
_h–³r
.
š™Ÿlize
()) < 0)

49  
r
;

50 
æush_bË
();

51  
	gIPRou‹TabË
::
cÚfigu»
(
cÚf
, 
”rh
);

55 
	gRªgeIPLookup
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

57 
	`ex·nd
();

58 
_aùive
 = 
Œue
;

60 
	}
}

63 
	gRªgeIPLookup
::
	$ş—nup
(
CËªupSge
)

65 
_h–³r
.
	`ş—nup
();

66 
	}
}

69 
	gRªgeIPLookup
::
	$push
(, 
Pack‘
 *
p
)

71 
IPAdd»ss
 
gw
;

72 
pÜt
 = 
	`lookup_rou‹
(
p
->
	`d¡__ªno
(), 
gw
);

74 #ifdeà
RANGEIPLOOKUP_VERBOSE


76 
IPAdd»ss
 
gw1
;

77 
pÜt1
 = 
_h–³r
.
	`lookup_rou‹
(
p
->
	`d¡__ªno
(), 
gw1
);

78 ià(
pÜt
 !ğ
pÜt1
 || 
gw
 !ğ
gw1
)

79 
	`şick_ch©‹r
("RangeIPLookup: consistency check failed!");

82 ià(
pÜt
 >= 0) {

83 ià(
gw
)

84 
p
->
	`£t_d¡__ªno
(
gw
);

85 
	`ouut
(
pÜt
).
	`push
(
p
);

87 
p
->
	`kl
();

88 
	}
}

91 
	gRªgeIPLookup
::
	$lookup_rou‹
(
IPAdd»ss
 
de¡
, IPAdd»s &
gw
) const

93 
ušt32_t
 
_addr
 = 
	`Áohl
(
de¡
.
	`addr
());

94 
ušt32_t
 
low”bound
, 
uµ”bound
, 
middË
;

95 
ušt32_t
 
i
 = 
_addr
 >> 
RANGE_SHIFT
;

96 
ušt16_t
 
vpÜt_i
;

98 
low”bound
 = 
_¿nge_ba£
[
i
];

99 
uµ”bound
 = 
low”bound
 + 
_¿nge_Ën
[
i
];

100 
i
 = 
_addr
 & 
RANGE_MASK
;

103 
uµ”bound
 > 
low”bound
) {

104 
middË
 = (
uµ”bound
 + 
low”bound
) >> 1;

105 ià(
i
 < (
_¿nge_t
[
middË
] & 
RANGE_MASK
))

106 
uµ”bound
 = 
middË
;

107 ià(
i
 < (
_¿nge_t
[
middË
 + 1] & 
RANGE_MASK
)) {

108 
low”bound
 = 
middË
;

111 
low”bound
 = 
middË
 + 1;

115 
vpÜt_i
 = 
_¿nge_t
[
low”bound
] >> 
RANGE_SHIFT
;

116 
gw
 = 
_h–³r
.
_vpÜt
[
vpÜt_i
].gw;

117  
_h–³r
.
_vpÜt
[
vpÜt_i
].
pÜt
;

118 
	}
}

121 
	gRªgeIPLookup
::
	$add_hªdËrs
()

123 
IPRou‹TabË
::
	`add_hªdËrs
();

124 
	`add_wr™e_hªdËr
("æush", 
æush_hªdËr
, 0, 
HªdËr
::
BUTTON
);

125 
	}
}

128 
	gRªgeIPLookup
::
	$add_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, 
boŞ
 
®low_»¶aû
, IPRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
 *
”rh
)

130 
”rÜ
 = 
_h–³r
.
	`add_rou‹
(
rou‹
, 
®low_»¶aû
, 
Şd_rou‹
, 
”rh
);

131 ià(
”rÜ
 =ğ0 && 
_aùive
)

132 
	`ex·nd
();

133  
”rÜ
;

134 
	}
}

137 
	gRªgeIPLookup
::
	$»move_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, IPRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
 *
”rh
)

139 
”rÜ
 = 
_h–³r
.
	`»move_rou‹
(
rou‹
, 
Şd_rou‹
, 
”rh
);

140 ià(
”rÜ
 =ğ0 && 
_aùive
)

141 
	`ex·nd
();

142  
”rÜ
;

143 
	}
}

154 
	gRªgeIPLookup
::
	$ex·nd
()

156 
ušt32_t
 
¿nge_t_šdex
 = 0;

157 
ušt32_t
 
tbl_0_23_šdex
 = 0;

158 
ušt32_t
 
¿nge_ba£
;

159 
ušt32_t
 
¿nge_Ën
;

161 
¿nge_ba£
 = 0;„ªge_ba£ < (1 << 
KICKSTART_BITS
);„ange_base++) {

162 
ušt16_t
 
vpÜt_i
, 
vpÜt_i1
;

164 
vpÜt_i
 = 0xffff;

165 
_¿nge_ba£
[
¿nge_ba£
] = 
¿nge_t_šdex
;

167 
¿nge_Ën
 = 0;

168 
tbl_0_23_šdex
 < ((
¿nge_ba£
 + 1è<< (24 - 
KICKSTART_BITS
));

169 
tbl_0_23_šdex
++) {

170 ià(
_h–³r
.
_tbl_0_23
[
tbl_0_23_šdex
] & 0x8000) {

171 
ušt32_t
 
tbl_24_31_šdex
, 
j
;

172 
tbl_24_31_šdex
 =

173 (
_h–³r
.
_tbl_0_23
[
tbl_0_23_šdex
] & 0x7fff) << 8;

174 
j
 = 0; j < 256; j++) {

175 
vpÜt_i1
 = 
_h–³r
.
_tbl_24_31
[
tbl_24_31_šdex
 + 
j
];

176 ià(
vpÜt_i
 !ğ
vpÜt_i1
) {

177 
vpÜt_i
 = 
vpÜt_i1
;

178 
_¿nge_t
[
¿nge_t_šdex
] =

179 
vpÜt_i
 << (32 - 
KICKSTART_BITS
) |

180 (((
tbl_0_23_šdex
 << 8è+ 
j
) &

181 (0xfffffffà>> 
KICKSTART_BITS
));

182 
¿nge_t_šdex
++;

183 
¿nge_Ën
++;

187 
vpÜt_i1
 = 
_h–³r
.
_tbl_0_23
[
tbl_0_23_šdex
];

188 ià(
vpÜt_i
 !ğ
vpÜt_i1
) {

189 
vpÜt_i
 = 
vpÜt_i1
;

190 
_¿nge_t
[
¿nge_t_šdex
] =

191 
vpÜt_i
 << (32 - 
KICKSTART_BITS
) |

192 ((
tbl_0_23_šdex
 << 8) &

193 (0xfffffffà>> 
KICKSTART_BITS
));

194 
¿nge_t_šdex
++;

195 
¿nge_Ën
++;

199 
_¿nge_Ën
[
¿nge_ba£
] = 
¿nge_Ën
 - 1;

202 #ifdeà
RANGEIPLOOKUP_VERBOSE


203 
	`şick_ch©‹r
("Rangeƒxpansion done: %d„anges using %d + %d bytes",

204 
¿nge_t_šdex
, (
_¿nge_ba£
è+ (
_¿nge_Ën
),

205 
¿nge_t_šdex
 * (
ušt32_t
));

207 
	}
}

210 
	gRªgeIPLookup
::
	$æush_bË
()

212 
_h–³r
.
	`æush
();

213 
	`mem£t
(
_¿nge_ba£
, 0, (1 << 
KICKSTART_BITS
) * (*_range_base));

214 
	`mem£t
(
_¿nge_Ën
, 0, (1 << 
KICKSTART_BITS
) * (*_range_len));

215 
	`mem£t
(
_¿nge_t
, 0, 
RANGES_MAX
 * (*_range_t));

216 
	}
}

219 
	gRªgeIPLookup
::
	$æush_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *,

220 
E¼ÜHªdËr
 *)

222 
RªgeIPLookup
 *
t
 = 
¡©ic_ÿ¡
<RªgeIPLooku°*>(
e
);

223 
t
->
	`æush_bË
();

225 
	}
}

227 
SŒšg


228 
	gRªgeIPLookup
::
	$dump_rou‹s
()

230  
_h–³r
.
	`dump
();

231 
	}
}

233 
CLICK_ENDDECLS


234 
	$ELEMENT_REQUIRES
(
DœeùIPLookup
)

235 
	`EXPORT_ELEMENT
(
RªgeIPLookup
)

	@ip/rangeiplookup.hh

2 #iâdeà
CLICK_RANGEIPLOOKUP_HH


3 
	#CLICK_RANGEIPLOOKUP_HH


	)

4 
	~"rou‹bË.hh
"

5 
	~"dœeùlookup.hh
"

6 
CLICK_DECLS


83 şas 
	cRªgeIPLookup
 : 
public
 
IPRou‹TabË
 {…ublic:

85 
	$RªgeIPLookup
(è
CLICK_COLD
;

86 ~
	$RªgeIPLookup
(è
CLICK_COLD
;

88 cÚ¡ *
	$şass_Çme
() const {  "RangeIPLookup"; }

89 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

90 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

92 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

93 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

94 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

95 
	$add_hªdËrs
(è
CLICK_COLD
;

96 
	`push
(
pÜt
, 
Pack‘
* 
p
);

98 
	`add_rou‹
(cÚ¡ 
IPRou‹
&, 
boŞ
, IPRou‹*, 
E¼ÜHªdËr
 *);

99 
	`»move_rou‹
(cÚ¡ 
IPRou‹
&, IPRou‹*, 
E¼ÜHªdËr
 *);

100 
	$lookup_rou‹
(
IPAdd»ss
, IPAddress&) const;

101 
SŒšg
 
	`dump_rou‹s
();

103 
	`æush_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

105 
´Ùeùed
:

107 
	`æush_bË
();

108 
	`ex·nd
();

110 ’um { 
KICKSTART_BITS
 = 12 
	}
};

111 ’um { 
	gRANGES_MAX
 = 256 * 1024 };

112 ’um { 
	gRANGE_MASK
 = 0xfffffffà>> 
KICKSTART_BITS
 };

113 ’um { 
	gRANGE_SHIFT
 = 32 - 
KICKSTART_BITS
 };

115 
ušt32_t
 *
	g_¿nge_ba£
;

116 
ušt32_t
 *
	g_¿nge_Ën
;

117 
ušt32_t
 *
	g_¿nge_t
;

118 
boŞ
 
	g_aùive
;

120 
	gDœeùIPLookup
::
TabË
 
_h–³r
;

124 
	gCLICK_ENDDECLS


	@ip/rfc2507c.cc

18 
	~<şick/cÚfig.h
>

19 
	~"rfc2507c.hh
"

20 
CLICK_DECLS


22 
	gRFC2507c
::
	$RFC2507c
()

24 
	}
}

26 
RFC2507c
::~
	$RFC2507c
()

28 
	}
}

30 
šlše


31 
RFC2507c
::
tı
::
İ”©Ü
 
	$IPFlowID
() const

33  
	`IPFlowID
(
_
.
_¤c
, 
_tı
.
th_¥Üt
, _.
_d¡
, _tı.
th_dpÜt
);

34 
	}
}

40 
Wr™abËPack‘
 *

41 
	gRFC2507c
::
	$make_Ùh”
(
Pack‘
 *
p
)

43 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(
p
->
	`Ëngth
() + 1);

44 
q
->
	`d©a
()[0] = 
PT_OTHER
;

45 
	`memıy
(
q
->
	`d©a
(è+ 1, 
p
->d©a(),…->
	`Ëngth
());

46  
q
;

47 
	}
}

54 
Wr™abËPack‘
 *

55 
	gRFC2507c
::
	$make_fuÎ
(
cid
, 
Pack‘
 *
p
)

57 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(
p
->
	`Ëngth
() + 2);

58 
q
->
	`d©a
()[0] = 
PT_FULL_HEADER
;

59 
q
->
	`d©a
()[1] = 
cid
;

60 
	`memıy
(
q
->
	`d©a
(è+ 2, 
p
->d©a(),…->
	`Ëngth
());

62 (
q
);

63 
	}
}

72 
	gRFC2507c
::
	$’code16
(
o
, 
n
, *
p
, &
i
)

74 (
	`’codeX
(
	`Áohs
(
o
),‚tohs(
n
), 
p
, 
i
));

75 
	}
}

78 
	gRFC2507c
::
	$’code32
(
o
, 
n
, *
p
, &
i
)

80 (
	`’codeX
(
	`Áohl
(
o
),‚tohl(
n
), 
p
, 
i
));

81 
	}
}

84 
	gRFC2507c
::
	$’codeX
(
o
, 
n
, *
p
, &
i
)

86 if(
o
 =ğ
n
)

88 if(
n
 < 
o
)

90 if(
n
 - 
o
 < 256){

91 
p
[
i
++] = 
n
 - 
o
;

94 if(
n
 - 
o
 < 65536){

95 
p
[
i
++] = 0;

96 
p
[
i
++] = (
n
 - 
o
) >> 8;

97 
p
[
i
++] = 
n
 - 
o
;

101 
	}
}

103 
Pack‘
 *

104 
	gRFC2507c
::
	$make_com´es£d
(
cid
, 
Pack‘
 *
p
)

106 
æags
 = 0;

107 
æ’
 = 0;

108 
fbuf
[512];

109 cÚ¡ 
şick_
 *
p
 = 
p
->
	`_h—d”
();

110 cÚ¡ 
şick_tı
 *
tıp
 = 
p
->
	`tı_h—d”
();

111 
x
;

112 
tı
 *
ùx
 = &
_ccbs
[
cid
].
_cÚ‹xt
;

114 if(
p
->
_v
 !ğ
ùx
->
_
.ip_v ||

115 
p
->
_hl
 !ğ
ùx
->
_
.ip_hl ||

116 
p
->
_tos
 !ğ
ùx
->
_
.ip_tos ||

117 (
p
->
_off
 & 
	`htÚs
(
IP_DF
)è!ğ(
ùx
->
_
.ip_off & htons(IP_DF)) ||

118 
p
->
_‰l
 !ğ
ùx
->
_
.ip_ttl ||

119 
tıp
->
th_off
 !ğ
ùx
->
_tı
.th_off){

120 
	`şick_ch©‹r
("full1");

121  
	`make_fuÎ
(
cid
, 
p
);

124 
x
 = 
	`’code16
(
ùx
->
_tı
.
th_u½
, 
tıp
->th_u½, 
fbuf
, 
æ’
);

125 if(
x
 < 0){

126 
	`şick_ch©‹r
("full urp");

127  
	`make_fuÎ
(
cid
, 
p
);

129 if(
x
)

130 
æags
 |= 1;

132 
x
 = 
	`’code16
(
ùx
->
_tı
.
th_wš
, 
tıp
->th_wš, 
fbuf
, 
æ’
);

133 if(
x
 < 0){

134 
	`şick_ch©‹r
("full win");

135  
	`make_fuÎ
(
cid
, 
p
);

137 if(
x
)

138 
æags
 |= (1 << 1);

140 
x
 = 
	`’code32
(
ùx
->
_tı
.
th_ack
, 
tıp
->th_ack, 
fbuf
, 
æ’
);

141 if(
x
 < 0){

142 
	`şick_ch©‹r
("full‡ck");

143  
	`make_fuÎ
(
cid
, 
p
);

145 if(
x
)

146 
æags
 |= (1 << 2);

148 
x
 = 
	`’code32
(
ùx
->
_tı
.
th_£q
, 
tıp
->th_£q, 
fbuf
, 
æ’
);

149 if(
x
 < 0){

150 
	`şick_ch©‹r
("full seq");

151  
	`make_fuÎ
(
cid
, 
p
);

153 if(
x
)

154 
æags
 |= (1 << 3);

156 if(
	`Áohs
(
p
->
_id
è!ğÁohs(
ùx
->
_
.ip_id) + 1){

157 
x
 = 
	`’code16
(
ùx
->
_
.
_id
, 
p
->_id, 
fbuf
, 
æ’
);

158 if(
x
 < 0){

159 
	`şick_ch©‹r
("full id");

160  
	`make_fuÎ
(
cid
, 
p
);

162 if(
x
)

163 
æags
 |= (1 << 5);

166 if(
tıp
->
th_æags
 & 
TH_PUSH
)

167 
æags
 |= (1 << 4);

169 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(
p
->
	`Ëngth
(è- (
şick_
)

170 - (
şick_tı
è+ 5 + 
æ’
);

171 
q
->
	`d©a
()[0] = 
PT_COMPRESSED_TCP
;

172 
q
->
	`d©a
()[1] = 
cid
;

173 
q
->
	`d©a
()[2] = 
æags
;

174 
	`memıy
(
q
->
	`d©a
(è+ 3, &
tıp
->
th_sum
, 2);

175 
	`memıy
(
q
->
	`d©a
(è+ 5, 
fbuf
, 
æ’
);

176 
	`memıy
(
q
->
	`d©a
(è+ 5 + 
æ’
,

177 
p
->
	`d©a
(è+ (
şick_
è+ (
şick_tı
),

178 
p
->
	`Ëngth
(è- (
şick_
è- (
şick_tı
));

179 (
q
);

180 
	}
}

188 
	gRFC2507c
::
	$make_key
(cÚ¡ 
tı
 &
äom
, tı &
to
)

190 
to
 = 
äom
;

191 
to
.
_
.
_tos
 = 0;

192 
to
.
_
.
_id
 = 0;

193 
to
.
_
.
_Ën
 = 0;

194 
to
.
_
.
_off
 = 0;

195 
to
.
_
.
_‰l
 = 0;

196 
to
.
_
.
_sum
 = 0;

197 
to
.
_tı
.
th_£q
 = 0;

198 
to
.
_tı
.
th_ack
 = 0;

199 
to
.
_tı
.
th_æags2
 = 0;

200 
to
.
_tı
.
th_off
 = 0;

201 
to
.
_tı
.
th_æags
 = 0;

202 
to
.
_tı
.
th_wš
 = 0;

203 
to
.
_tı
.
th_sum
 = 0;

204 
to
.
_tı
.
th_u½
 = 0;

205 
	}
}

207 
Pack‘
 *

208 
	gRFC2507c
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

210 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
(è&&…->
	`ÃtwÜk_h—d”_off£t
() == 0);

211 cÚ¡ 
şick_
 *
p
 = 
p
->
	`_h—d”
();

212 cÚ¡ 
şick_tı
 *
tıp
 = 
p
->
	`tı_h—d”
();

213 
cid
;

214 
Pack‘
 *
q
 = 0;

216 if(
p
->
_hl
 != 5 ||

217 
p
->
_v
 != 4 ||

218 (
p
->
_off
 & 
	`htÚs
(
IP_OFFMASK
 | 
IP_MF
)) != 0 ||

219 
p
->
_p
 !ğ
IPPROTO_TCP
 ||

220 (
tıp
->
th_æags
 & (
TH_FIN
|
TH_SYN
|
TH_RST
|
TH_ACK
)) != TH_ACK){

222 
	`şick_ch©‹r
("cannot compress…acket");

223 
q
 = 
	`make_Ùh”
(
p
);

225 
IPFlowID
 
	`key
(
p
);

226 
tı
 
ti
;

227 
ti
.
_
 = *
p
;

228 
ti
.
_tı
 = *
tıp
;

229 if((
cid
 = 
_m­
.
	`g‘
(
key
))){

230 
q
 = 
	`make_com´es£d
(
cid
, 
p
);

231 
_ccbs
[
cid
].
_cÚ‹xt
 = 
ti
;

235 
cid
 = 
	`şick_¿ndom
(1, 
TCP_SPACE
 - 1);

238 
IPFlowID
 
	`okey
(
_ccbs
[
cid
].
_cÚ‹xt
);

239 
HashTabË
<
IPFlowID
, >::
™”©Ü
 
™
 = 
_m­
.
	`fšd
(
okey
);

240 if(
™
 !ğ
_m­
.
	`’d
(è&& it.
	`v®ue
()){

241 
™
.
	`v®ue
() = 0;

244 
_m­
.
	`£t
(
key
, 
cid
);

245 
	`şick_ch©‹r
("sport %d dport %d‡dded cid %d",

246 
	`Áohs
(
key
.
	`¥Üt
()),

247 
	`Áohs
(
key
.
	`dpÜt
()),

248 
cid
);

250 
q
 = 
	`make_fuÎ
(
cid
, 
p
);

251 
_ccbs
[
cid
].
_cÚ‹xt
 = 
ti
;

255 
p
->
	`kl
();

256 (
q
);

257 
	}
}

259 
	$EXPORT_ELEMENT
(
RFC2507c
)

260 
CLICK_ENDDECLS


	@ip/rfc2507c.hh

1 #iâdeà
CLICK_RFC2507C_HH


2 
	#CLICK_RFC2507C_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/hashbË.hh
>

5 
	~<şick/glue.hh
>

6 
	~<şick/æowid.hh
>

7 
	~<şickÃt/.h
>

8 
	~<şickÃt/tı.h
>

9 
CLICK_DECLS


30 şas 
	cRFC2507c
 : 
public
 
EËm’t
 {

31 
public
:

34 
	stı
 {

35 
şick_
 
_
;

36 
şick_tı
 
	m_tı
;

37 
İ”©Ü
 
boŞ
(ècÚ¡ { (
	m_
.
	m_¤c
.
	ms_addr
 != 0); }

38 
tı
(è{ 
	m_
.
	m_¤c
.
	ms_addr
 = 0; }

39 
İ”©Ü
 
IPFlowID
() const;

42 
RFC2507c
();

43 ~
RFC2507c
();

45 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "RFC2507Comp"; 
	}
}

46 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

48 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

50 
	g´iv©e
:

52 ’um { 
TCP_SPACE
 = 15 };

55 ’um { 
	gPT_OTHER
 = 0,

56 
	gPT_FULL_HEADER
 = 1,

57 
	gPT_COMPRESSED_TCP
 = 2 };

60 
	sccb
 {

61 
tı
 
	g_cÚ‹xt
;

63 
ccb
 
	g_ccbs
[
TCP_SPACE
];

66 
	gHashTabË
<
	gIPFlowID
, > 
	g_m­
;

68 
make_key
(cÚ¡ 
tı
 &
äom
, tı &
to
);

69 
Wr™abËPack‘
 *
make_Ùh”
(
Pack‘
 *
p
);

70 
Wr™abËPack‘
 *
make_fuÎ
(
cid
, 
Pack‘
 *
p
);

71 
’code16
(
o
, 
n
, *
p
, &
i
);

72 
’code32
(
o
, 
n
, *
p
, &
i
);

73 
’codeX
(
o
, 
n
, *
p
, &
i
);

74 
Pack‘
 *
make_com´es£d
(
cid
, Pack‘ *
p
);

77 
	gCLICK_ENDDECLS


	@ip/rfc2507d.cc

18 
	~<şick/cÚfig.h
>

19 
	~"rfc2507d.hh
"

20 
	~<şick/glue.hh
>

21 
CLICK_DECLS


23 
	gRFC2507d
::
	$RFC2507d
()

25 
	}
}

27 
RFC2507d
::~
	$RFC2507d
()

29 
	}
}

32 
RFC2507d
::
	$decode
(cÚ¡ 
u_ch¬
 * &
š
, &
x
)

34 
x
 = 
	`Áohs
(x);

35 if(
š
[0] != 0){

36 
x
 +ğ*
š
;

37 
š
++;

39 
š
++;

40 
x
 +ğ(*
š
 << 8);

41 
š
++;

42 
x
 +ğ*
š
;

43 
š
++;

45 
x
 = 
	`htÚs
(x);

46 
	}
}

49 
	gRFC2507d
::
	$decode
(cÚ¡ 
u_ch¬
 * &
š
, &
x
)

51 
x
 = 
	`Áohl
(x);

52 if(
š
[0] != 0){

53 
x
 +ğ*
š
;

54 
š
++;

56 
š
++;

57 
x
 +ğ(*
š
 << 8);

58 
š
++;

59 
x
 +ğ*
š
;

60 
š
++;

62 
x
 = 
	`htÚl
(x);

63 
	}
}

66 
Pack‘
 *

67 
	gRFC2507d
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

69 
Wr™abËPack‘
 *
q
 = 0;

71 if(
p
->
	`Ëngth
() < 2)

72 
out
;

74 ià(
p
->
	`d©a
()[0] =ğ
PT_OTHER
) {

75 
q
 = 
Pack‘
::
	`make
(
p
->
	`Ëngth
() - 1);

76 
	`memıy
(
q
->
	`d©a
(), 
p
->d©a(è+ 1,…->
	`Ëngth
() - 1);

77 } ià(
p
->
	`d©a
()[0] =ğ
PT_FULL_HEADER
) {

78 
	`şick_ch©‹r
("2507d: got full header\n");

79 
cid
 = 
p
->
	`d©a
()[1] & 0xff;

80 if(
cid
 <ğ0 || cid >ğ
TCP_SPACE
)

81 
out
;

82 
tı
 *
ùx
 = &
_ccbs
[
cid
].
_cÚ‹xt
;

83 
	`memıy
(&(
ùx
->
_
), 
p
->
	`d©a
(è+ 2, (
şick_
));

84 
	`memıy
(&(
ùx
->
_tı
), 
p
->
	`d©a
(è+ 2 + (
şick_
),

85 (
şick_tı
));

86 
q
 = 
Pack‘
::
	`make
(
p
->
	`Ëngth
() - 2);

87 
	`memıy
(
q
->
	`d©a
(), 
p
->d©a(è+ 2,…->
	`Ëngth
() - 2);

88 } ià(
p
->
	`d©a
()[0] =ğ
PT_COMPRESSED_TCP
) {

89 
cid
 = 
p
->
	`d©a
()[1] & 0xff;

90 if(
cid
 <ğ0 || cid >ğ
TCP_SPACE
)

91 
out
;

93 
tı
 *
ùx
 = &
_ccbs
[
cid
].
_cÚ‹xt
;

94 
æags
 = 
p
->
	`d©a
()[2];

95 
	`memıy
(&(
ùx
->
_tı
.
th_sum
), 
p
->
	`d©a
() + 3, 2);

96 cÚ¡ 
u_ch¬
 *
š
 = 
p
->
	`d©a
() + 5;

98 if(
æags
 & (1 << 4))

99 
ùx
->
_tı
.
th_æags
 |ğ
TH_PUSH
;

101 
ùx
->
_tı
.
th_æags
 &ğ~
TH_PUSH
;

103 if(
æags
 & 1){

104 
ùx
->
_tı
.
th_æags
 |ğ
TH_URG
;

105 
	`decode
(
š
, 
ùx
->
_tı
.
th_u½
);

107 
ùx
->
_tı
.
th_æags
 &ğ~
TH_URG
;

110 if(
æags
 & (1 << 1)){

111 
	`decode
(
š
, 
ùx
->
_tı
.
th_wš
);

114 if(
æags
 & (1 << 2)){

115 
	`decode
(
š
, 
ùx
->
_tı
.
th_ack
);

118 if(
æags
 & (1 << 3)){

119 
	`decode
(
š
, 
ùx
->
_tı
.
th_£q
);

122 if(
æags
 & (1 << 5)){

123 
	`decode
(
š
, 
ùx
->
_
.
_id
);

125 
ùx
->
_
.
_id
 = 
	`htÚs
(
	`Áohs
(ctx->_ip.ip_id) + 1);

128 
Ën
 = 
p
->
	`Ëngth
(è- (
š
 -…->
	`d©a
());

129 
Ën
 +ğ(
şick_
è+ (
şick_tı
);

130 
ùx
->
_
.
_Ën
 = 
	`htÚs
(
Ën
);

132 
ùx
->
_
.
_sum
 = 0;

133 
ùx
->
_
.
_sum
 = 
	`şick_š_cksum
((*è&(ùx->_), (
şick_
));

135 
q
 = 
Pack‘
::
	`make
(
Ën
);

136 
	`memıy
(
q
->
	`d©a
(), &(
ùx
->
_
), (
şick_
));

137 
	`memıy
(
q
->
	`d©a
(è+ (
şick_
),

138 &(
ùx
->
_tı
),

139 (
şick_tı
));

140 
	`memıy
(
q
->
	`d©a
(è+ (
şick_
è+ (
şick_tı
),

141 
š
,

142 
p
->
	`Ëngth
(è- (
š
 -…->
	`d©a
()));

144 
out
;

147 
out
:

148 if(
q
){

149 
şick_
 
h
;

150 
şick_tı
 
tıh
;

151 
	`memıy
(&
h
, 
q
->
	`d©a
(), (iph));

152 
	`memıy
(&
tıh
, 
q
->
	`d©a
(è+ (
şick_
), (tcph));

153 
	`şick_ch©‹r
("seq %d†en %d",

154 ()
	`Áohl
(
tıh
.
th_£q
),

155 ()(
q
->
	`Ëngth
(è- (
tıh
è- (
h
)));

158 *
p
 = 
Ãw
 [
q
->
	`Ëngth
()];

159 
	`memıy
(
p
, 
q
->
	`d©a
(), q->
	`Ëngth
());

162 
şick_
 *
p
 = 
»š‹½»t_ÿ¡
<şick_ *>(
p
);

163 
hËn
 = 
p
->
_hl
 << 2;

164 if(
	`şick_š_cksum
((*)
p
, 
hËn
) != 0){

165 
	`şick_ch©‹r
(" ip cksum failed");

169 
Ën
 = 
	`Áohs
(
p
->
_Ën
);

171 
	`mem£t
(
p
, '\0', 9);

172 
p
->
_sum
 = 
	`htÚs
(
Ën
 - (
şick_
));

173 if(
	`şick_š_cksum
((*)
p
, 
Ën
) != 0){

174 
	`şick_ch©‹r
("cp cksum failed");

177 
d–‘e
 [] 
p
;

180 if(
q
 == 0)

181 
	`şick_ch©‹r
("RFC2507d:‚o q");

182 
p
->
	`kl
();

183 (
q
);

184 
	}
}

186 
CLICK_ENDDECLS


187 
EXPORT_ELEMENT
(
RFC2507d
)

	@ip/rfc2507d.hh

1 #iâdeà
CLICK_RFC2507D_HH


2 
	#CLICK_RFC2507D_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şickÃt/.h
>

6 
	~<şickÃt/tı.h
>

7 
CLICK_DECLS


23 şas 
	cRFC2507d
 : 
public
 
EËm’t
 {

24 
public
:

27 
	stı
 {

28 
şick_
 
_
;

29 
şick_tı
 
	m_tı
;

30 
İ”©Ü
 
boŞ
(ècÚ¡ { (
	m_
.
	m_¤c
.
	ms_addr
 != 0); }

31 
tı
(è{ 
	m_
.
	m_¤c
.
	ms_addr
 = 0; }

34 
RFC2507d
();

35 ~
RFC2507d
();

37 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "RFC2507Decomp"; 
	}
}

38 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

40 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

42 
	g´iv©e
:

44 ’um { 
TCP_SPACE
 = 15 };

47 ’um { 
	gPT_OTHER
 = 0,

48 
	gPT_FULL_HEADER
 = 1,

49 
	gPT_COMPRESSED_TCP
 = 2 };

52 
	sccb
 {

53 
tı
 
	g_cÚ‹xt
;

55 
ccb
 
	g_ccbs
[
TCP_SPACE
];

57 
decode
(cÚ¡ 
u_ch¬
 * &
š
, &);

58 
decode
(cÚ¡ 
u_ch¬
 * &
š
, &);

61 
	gCLICK_ENDDECLS


	@ip/ripsend.cc

18 
	~<şick/cÚfig.h
>

19 
	~"r£nd.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şickÃt/.h
>

23 
	~<şickÃt/udp.h
>

24 
CLICK_DECLS


26 
	gRIPS’d
::
	$RIPS’d
()

27 : 
	$_tim”
(
this
)

29 
	}
}

31 
RIPS’d
::~
	$RIPS’d
()

33 
	}
}

36 
RIPS’d
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

38  
Args
(
cÚf
, 
this
, 
”rh
)

39 .
»ad_mp
("SRC", 
_¤c
)

40 .
»ad_mp
("DST", 
_d¡
)

41 .
»ad_mp
("PREFIX", 
IPP»fixArg
(), 
_wh©
, 
_mask
)

42 .
»ad_mp
("METRIC", 
_m‘ric
).
com¶‘e
();

46 
	gRIPS’d
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

48 
_tim”
.
	`š™Ÿlize
(
this
);

49 
_tim”
.
	`scheduË_aá”_m£c
(3 * 1000);

51 
	}
}

54 
	gRIPS’d
::
	$run_tim”
(
Tim”
 *)

56 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
((
şick_
è+ (
şick_udp
) + 24);

57 
	`mem£t
(
p
->
	`d©a
(), '\0',…->
	`Ëngth
());

60 
şick_
 *
p
 = 
»š‹½»t_ÿ¡
<şick_ *>(
p
->
	`d©a
());

61 
p
->
_Ën
 = 
	`htÚs
(
p
->
	`Ëngth
() - (*ipp));

62 
p
->
_p
 = 
IPPROTO_UDP
;

63 
p
->
_¤c
 = 
_¤c
.
	`š_addr
();

64 
p
->
_d¡
 = 
_d¡
.
	`š_addr
();

67 
şick_udp
 *
udµ
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(
p
 + 1);

68 *
r
 = (*è(
udµ
 + 1);

69 
r
[0] = 
	`htÚl
((2 << 24) | (2 << 16) | 0);

70 
r
[1] = 
	`htÚl
((2 << 16) | 0);

71 
r
[2] = 
_wh©
.
	`addr
();

72 
r
[3] = 
_mask
.
	`addr
();

73 
r
[4] = 
_¤c
.
	`addr
();

74 
r
[5] = 
	`htÚl
(
_m‘ric
);

77 
udµ
->
uh_¥Üt
 = 
	`htÚs
(520);

78 
udµ
->
uh_dpÜt
 = 
	`htÚs
(520);

79 
udµ
->
uh_uËn
 = 
	`htÚs
(
p
->
	`Ëngth
(è- (*
p
));

80 
udµ
->
uh_sum
 = 
	`şick_š_cksum
(
p
->
	`d©a
(),…->
	`Ëngth
());

83 
p
->
_Ën
 = 
	`htÚs
(
p
->
	`Ëngth
());

84 
p
->
_hl
 = (
şick_
) >> 2;

85 
p
->
_v
 = 4;

86 
p
->
_‰l
 = 200;

87 
p
->
_sum
 = 
	`şick_š_cksum
((*) ipp, (*ipp));

89 
p
->
	`£t__h—d”
(
p
, (
şick_
));

91 
	`ouut
(0).
	`push
(
p
);

93 
_tim”
.
	`scheduË_aá”_m£c
(30 * 1000);

94 
	}
}

96 
CLICK_ENDDECLS


97 
EXPORT_ELEMENT
(
RIPS’d
)

	@ip/ripsend.hh

1 #iâdeà
CLICK_RIPSEND_HH


2 
	#CLICK_RIPSEND_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tim”.hh
>

5 
	~<şick/add»ss.hh
>

6 
CLICK_DECLS


28 şas 
	cRIPS’d
 : 
public
 
EËm’t
 {

30 
IPAdd»ss
 
_¤c
;

31 
IPAdd»ss
 
	m_d¡
;

32 
IPAdd»ss
 
	m_wh©
;

33 
IPAdd»ss
 
	m_mask
;

34 
	m_m‘ric
;

36 
Tim”
 
	m_tim”
;

38 
	mpublic
:

40 
	$RIPS’d
(è
CLICK_COLD
;

41 ~
	$RIPS’d
(è
CLICK_COLD
;

43 cÚ¡ *
	$şass_Çme
() const {  "RIPSend"; }

44 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

45 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

47 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

48 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

50 
	`run_tim”
(
Tim”
 *);

52 
	}
};

54 
	gCLICK_ENDDECLS


	@ip/rripmapper.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¼m­³r.hh
"

21 
	~"–em’ts//rw·‰”n.hh
"

22 
	~<şick/cÚå¬£.hh
>

23 
	~<şick/”rÜ.hh
>

24 
CLICK_DECLS


26 
	gRoundRobšIPM­³r
::
	$RoundRobšIPM­³r
()

28 
	}
}

30 
RoundRobšIPM­³r
::~
	$RoundRobšIPM­³r
()

32 
	}
}

35 
RoundRobšIPM­³r
::
	$ÿ¡
(cÚ¡ *
Çme
)

37 ià(
Çme
 && 
	`¡rcmp
("RoundRobinIPMapper",‚ame) == 0)

38  (
EËm’t
 *)
this
;

39 ià(
Çme
 && 
	`¡rcmp
("IPMapper",‚ame) == 0)

40  (
IPM­³r
 *)
this
;

43 
	}
}

46 
	gRoundRobšIPM­³r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

48 ià(
	gcÚf
.
size
() == 0)

49  
”rh
->
”rÜ
("no…atterns given");

50 ià(
	gcÚf
.
size
() == 1)

51 
”rh
->
w¬nšg
("only one…attern given");

53 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

54 
IPRewr™”IÅut
 
	gis
;

55 
	gis
.
	gkšd
 = 
IPRewr™”IÅut
::
i_·‰”n
;

56 ià(
	gIPRewr™”P©‹º
::
·r£_w™h_pÜts
(
cÚf
[
i
], &
is
, 
this
, 
”rh
)) {

57 
	gis
.
	gu
.
	g·‰”n
->
u£
();

58 
	g_is
.
push_back
(
is
);

62 
	g_Ï¡_·‰”n
 = 0;

63  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

67 
	gRoundRobšIPM­³r
::
	$ş—nup
(
CËªupSge
)

69 
i
 = 0; i < 
_is
.
	`size
(); i++)

70 
_is
[
i
].
u
.
·‰”n
->
	`unu£
();

71 
	}
}

74 
	gRoundRobšIPM­³r
::
	$nÙify_»wr™”
(
IPRewr™”Ba£
 *
u£r
,

75 
IPRewr™”IÅut
 *
šput
, 
E¼ÜHªdËr
 *
”rh
)

77 
i
 = 0; i < 
_is
.
	`size
(); i++) {

78 ià(
_is
[
i
].
fouut
 >ğ
u£r
->
	`nouuts
()

79 || 
_is
[
i
].
rouut
 >ğ
šput
->
»¶y_–em’t
->
	`nouuts
())

80 
”rh
->
	`”rÜ
("ouuˆpÜˆouˆoà¿ngš % ·‰”À%d", 
	`deş¬©iÚ
().
	`c_¡r
(), 
i
);

82 
	}
}

85 
	gRoundRobšIPM­³r
::
	$»wr™e_æowid
(
IPRewr™”IÅut
 *
šput
,

86 cÚ¡ 
IPFlowID
 &
æowid
,

87 
IPFlowID
 &
»wr™‹n_æowid
,

88 
Pack‘
 *
p
, 
m­id
)

90 
i
 = 0; i < 
_is
.
	`size
(); ++i) {

91 
IPRewr™”IÅut
 &
is
 = 
_is
[
_Ï¡_·‰”n
];

92 ++
_Ï¡_·‰”n
;

93 ià(
_Ï¡_·‰”n
 =ğ
_is
.
	`size
())

94 
_Ï¡_·‰”n
 = 0;

95 
is
.
»¶y_–em’t
 = 
šput
->reply_element;

96 
»suÉ
 = 
is
.
	`»wr™e_æowid
(
æowid
, 
»wr™‹n_æowid
, 
p
, 
m­id
);

97 ià(
»suÉ
 !ğ
IPRewr™”Ba£
::
rw_drİ


98 || 
is
.
kšd
 =ğ
IPRewr™”IÅut
::
i_drİ
) {

99 
šput
->
fouut
 = 
is
.foutput;

100 
šput
->
rouut
 = 
is
.routput;

101  
»suÉ
;

104  
IPRewr™”Ba£
::
rw_drİ
;

105 
	}
}

107 
CLICK_ENDDECLS


108 
	$ELEMENT_REQUIRES
(
IPRewr™”Ba£
)

109 
	`EXPORT_ELEMENT
(
RoundRobšIPM­³r
)

	@ip/rripmapper.hh

1 #iâdeà
CLICK_RRIPMAPPER_HH


2 
	#CLICK_RRIPMAPPER_HH


	)

3 
	~"–em’ts//»wr™”ba£.hh
"

4 
CLICK_DECLS


22 
şass
 
	gRoundRobšIPM­³r
 : 
public
 
EËm’t
,…ubliø
	gIPM­³r
 { 
	gpublic
:

24 
RoundRobšIPM­³r
(è
CLICK_COLD
;

25 ~
RoundRobšIPM­³r
(è
	gCLICK_COLD
;

27 cÚ¡ *
şass_Çme
() const {  "RoundRobinIPMapper"; }

28 *
ÿ¡
(const *);

30 
cÚfigu»_pha£
(ècÚ¡ {  
	gIPRewr™”Ba£
::
CONFIGURE_PHASE_MAPPER
;}

31 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

32 
ş—nup
(
CËªupSge
è
	gCLICK_COLD
;

34 
nÙify_»wr™”
(
IPRewr™”Ba£
 *
u£r
, 
IPRewr™”IÅut
 *
šput
,

35 
E¼ÜHªdËr
 *
”rh
);

36 
»wr™e_æowid
(
IPRewr™”IÅut
 *
šput
,

37 cÚ¡ 
IPFlowID
 &
æowid
, IPFlowID &
»wr™‹n_æowid
,

38 
Pack‘
 *
p
, 
m­id
);

40 
	g´iv©e
:

42 
VeùÜ
<
IPRewr™”IÅut
> 
_is
;

43 
	g_Ï¡_·‰”n
;

47 
	gCLICK_ENDDECLS


	@ip/setipaddress.cc

20 
	~<şick/cÚfig.h
>

21 
	~"£tadd»ss.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
CLICK_DECLS


26 
	gS‘IPAdd»ss
::
	$S‘IPAdd»ss
()

28 
	}
}

30 
S‘IPAdd»ss
::~
	$S‘IPAdd»ss
()

32 
	}
}

35 
S‘IPAdd»ss
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 
	gªno
 = 0;

38 ià(
Args
(
cÚf
, 
this
, 
”rh
)

39 .
»ad_mp
("IPADDR", 
_
)

40 .
»ad
("ANNO", 
AÂoArg
(4), 
ªno
)

41 .
com¶‘e
() < 0)

43 
	g_ªno
 = 
ªno
;

47 
Pack‘
 *

48 
	gS‘IPAdd»ss
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

50 
p
->
	`£t_ªno_u32
(
_ªno
, 
_
.
	`addr
());

51  
p
;

52 
	}
}

55 
	gS‘IPAdd»ss
::
	$add_hªdËrs
()

57 
	`add_d©a_hªdËrs
("addr", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_
);

58 
	}
}

60 
CLICK_ENDDECLS


61 
	$EXPORT_ELEMENT
(
S‘IPAdd»ss
)

62 
	`ELEMENT_MT_SAFE
(
S‘IPAdd»ss
)

	@ip/setipaddress.hh

1 #iâdeà
CLICK_SETIPADDRESS_HH


2 
	#CLICK_SETIPADDRESS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/add»ss.hh
>

5 
CLICK_DECLS


23 şas 
	cS‘IPAdd»ss
 : 
public
 
EËm’t
 {

25 
IPAdd»ss
 
_
;

26 
	m_ªno
;

28 
	mpublic
:

30 
	$S‘IPAdd»ss
(è
CLICK_COLD
;

31 ~
	$S‘IPAdd»ss
(è
CLICK_COLD
;

33 cÚ¡ *
	$şass_Çme
() const {  "SetIPAddress"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

36 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

37 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

38 
	$add_hªdËrs
(è
CLICK_COLD
;

40 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

42 
	}
};

44 
	gCLICK_ENDDECLS


	@ip/setipchecksum.cc

19 
	~<şick/cÚfig.h
>

20 
	~"£tchecksum.hh
"

21 
	~<şick/glue.hh
>

22 
	~<şickÃt/.h
>

23 
CLICK_DECLS


25 
	gS‘IPChecksum
::
	$S‘IPChecksum
()

26 : 
	$_drİs
(0)

28 
	}
}

30 
S‘IPChecksum
::~
	$S‘IPChecksum
()

32 
	}
}

34 
Pack‘
 *

35 
S‘IPChecksum
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

37 ià(
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
()) {

38 *
nh_d©a
 = (
p
->
	`has_ÃtwÜk_h—d”
(è?…->
	`ÃtwÜk_h—d”
(è:…->
	`d©a
());

39 
şick_
 *
h
 = 
»š‹½»t_ÿ¡
<şick_ *>(
nh_d©a
);

40 
¶’
 = 
p
->
	`’d_d©a
(è- 
nh_d©a
, 
hËn
;

42 ià(
	`lik–y
(
¶’
 >ğ(
şick_
))

43 && 
	`lik–y
((
hËn
 = 
h
->
_hl
 << 2è>ğ(
şick_
))

44 && 
	`lik–y
(
hËn
 <ğ
¶’
)) {

45 
h
->
_sum
 = 0;

46 
h
->
_sum
 = 
	`şick_š_cksum
((*èh, 
hËn
);

47  
p
;

50 ià(++
_drİs
 == 1)

51 
	`şick_ch©‹r
("SetIPChecksum: bad input…acket");

52 
p
->
	`kl
();

55 
	}
}

58 
	gS‘IPChecksum
::
	$add_hªdËrs
()

60 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

61 
	}
}

63 
CLICK_ENDDECLS


64 
	$EXPORT_ELEMENT
(
S‘IPChecksum
)

65 
	`ELEMENT_MT_SAFE
(
S‘IPChecksum
)

	@ip/setipchecksum.hh

1 #iâdeà
CLICK_SETIPCHECKSUM_HH


2 
	#CLICK_SETIPCHECKSUM_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


22 şas 
	cS‘IPChecksum
 : 
public
 
EËm’t
 {…ublic:

24 
	$S‘IPChecksum
(è
CLICK_COLD
;

25 ~
	$S‘IPChecksum
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "SetIPChecksum"; }

28 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

29 
	$add_hªdËrs
(è
CLICK_COLD
;

31 
Pack‘
 *
	`sim¶e_aùiÚ
(Pack‘ *
p
);

33 
´iv©e
:

35 
_drİs
;

37 
	}
};

39 
	gCLICK_ENDDECLS


	@ip/setipdscp.cc

18 
	~<şick/cÚfig.h
>

19 
	~"£tdsı.hh
"

20 
	~<şickÃt/.h
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gS‘IPDSCP
::
	$S‘IPDSCP
()

27 
	}
}

29 
S‘IPDSCP
::~
	$S‘IPDSCP
()

31 
	}
}

34 
S‘IPDSCP
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
	gdsı_v®
;

37 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("DSCP", 
dsı_v®
).
com¶‘e
() < 0)

39 ià(
	gdsı_v®
 > 0x3F)

40  
	g”rh
->
”rÜ
("diffserv code…oint out of„ange");

42 
	g_dsı
 = (
dsı_v®
 << 2);

46 
šlše
 
Pack‘
 *

47 
	gS‘IPDSCP
::
	$smaùiÚ
(
Pack‘
 *
p
)

49 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

50 
Wr™abËPack‘
 *
q
;

51 ià(!(
q
 = 
p
->
	`uniqueify
()))

53 
şick_
 *

 = 
q
->
	`_h—d”
();

54 
ušt16_t
 
Şd_hw
 = (
»š‹½»t_ÿ¡
<ušt16_ˆ*>(

))[0];

55 

->
_tos
 = (->_to & 0x3è| 
_dsı
;

56 
	`şick_upd©e_š_cksum
(&

->
_sum
, 
Şd_hw
, 
»š‹½»t_ÿ¡
<
ušt16_t
 *>(ip)[0]);

57  
q
;

58 
	}
}

61 
	gS‘IPDSCP
::
	$push
(, 
Pack‘
 *
p
)

63 ià((
p
 = 
	`smaùiÚ
(p)) != 0)

64 
	`ouut
(0).
	`push
(
p
);

65 
	}
}

67 
Pack‘
 *

68 
	gS‘IPDSCP
::
	$puÎ
()

70 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

71 ià(
p
)

72 
p
 = 
	`smaùiÚ
(p);

73  
p
;

74 
	}
}

77 
	gS‘IPDSCP
::
	$add_hªdËrs
()

79 
	`add_»ad_hªdËr
("dsı", 
»ad_keywÜd_hªdËr
, "0 DSCP", 
HªdËr
::
CALM
);

80 
	`add_wr™e_hªdËr
("dsı", 
»cÚfigu»_keywÜd_hªdËr
, "0 DSCP");

81 
	}
}

83 
CLICK_ENDDECLS


84 
	$EXPORT_ELEMENT
(
S‘IPDSCP
)

85 
	`ELEMENT_MT_SAFE
(
S‘IPDSCP
)

	@ip/setipdscp.hh

1 #iâdeà
CLICK_SETIPDSCP_HH


2 
	#CLICK_SETIPDSCP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


21 şas 
	cS‘IPDSCP
 : 
public
 
EËm’t
 {…ublic:

23 
	$S‘IPDSCP
(è
CLICK_COLD
;

24 ~
	$S‘IPDSCP
(è
CLICK_COLD
;

26 cÚ¡ *
	$şass_Çme
() const {  "SetIPDSCP"; }

27 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

29 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

30 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

31 
	$add_hªdËrs
(è
CLICK_COLD
;

33 
šlše
 
Pack‘
 *
	`smaùiÚ
(Packet *);

34 
	`push
(, 
Pack‘
 *
p
);

35 
Pack‘
 *
	`puÎ
();

37 
´iv©e
:

39 
_dsı
;

41 
	}
};

43 
	gCLICK_ENDDECLS


	@ip/setipecn.cc

18 
	~<şick/cÚfig.h
>

19 
	~"£teú.hh
"

20 
	~<şickÃt/.h
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gS‘IPECN
::
	$S‘IPECN
()

27 
	}
}

29 
S‘IPECN
::~
	$S‘IPECN
()

31 
	}
}

34 
S‘IPECN
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
SŒšg
 
	geú
;

37 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("ECN", 
AnyArg
(), 
eú
).
com¶‘e
() < 0)

39 ià(
	geú
.
Ëngth
(è=ğ1 && 
eú
[0] >= '0' &&ƒcn[0] <= '3')

40 
_eú
 = 
eú
[0] - '0';

41 ià(
	geú
.
equ®s
("no", 2) ||ƒcn.equals("-", 1))

42 
	g_eú
 = 
IP_ECN_NOT_ECT
;

43 ià(
	geú
.
equ®s
("ect1", 4) ||ƒcn.equals("ECT(1)", 6))

44 
	g_eú
 = 
IP_ECN_ECT1
;

45 ià(
	geú
.
equ®s
("ect2", 4) ||ƒcn.equals("ECT(0)", 6))

46 
	g_eú
 = 
IP_ECN_ECT2
;

47 ià(
	geú
.
equ®s
("ce", 2) ||ƒcn.equals("CE", 2))

48 
	g_eú
 = 
IP_ECN_CE
;

50  
	g”rh
->
”rÜ
("bad ECN‡rgument");

54 
Pack‘
 *

55 
	gS‘IPECN
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

57 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

58 
Wr™abËPack‘
 *
q
;

59 ià(!(
q
 = 
p
->
	`uniqueify
()))

61 
şick_
 *

 = 
q
->
	`_h—d”
();

62 
ušt16_t
 
Şd_hw
 = (
»š‹½»t_ÿ¡
<ušt16_ˆ*>(

))[0];

63 

->
_tos
 = (->_to & 
IP_DSCPMASK
è| 
_eú
;

64 
	`şick_upd©e_š_cksum
(&

->
_sum
, 
Şd_hw
, 
»š‹½»t_ÿ¡
<
ušt16_t
 *>(ip)[0]);

65  
q
;

66 
	}
}

69 
	gS‘IPECN
::
	$add_hªdËrs
()

71 
	`add_»ad_hªdËr
("eú", 
»ad_keywÜd_hªdËr
, "0 ECN", 
HªdËr
::
CALM
);

72 
	`add_wr™e_hªdËr
("eú", 
»cÚfigu»_keywÜd_hªdËr
, "0 ECN");

73 
	}
}

75 
CLICK_ENDDECLS


76 
	$EXPORT_ELEMENT
(
S‘IPECN
)

77 
	`ELEMENT_MT_SAFE
(
S‘IPECN
)

	@ip/setipecn.hh

1 #iâdeà
CLICK_SETIPECN_HH


2 
	#CLICK_SETIPECN_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


22 şas 
	cS‘IPECN
 : 
public
 
EËm’t
 {…ublic:

24 
	$S‘IPECN
(è
CLICK_COLD
;

25 ~
	$S‘IPECN
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "SetIPECN"; }

28 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

30 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

31 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

32 
	$add_hªdËrs
(è
CLICK_COLD
;

34 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

36 
´iv©e
:

38 
_eú
;

40 
	}
};

42 
	gCLICK_ENDDECLS


	@ip/setrandipaddress.cc

19 
	~<şick/cÚfig.h
>

20 
	~"£Œªdadd»ss.hh
"

21 
	~<şick/¬gs.hh
>

22 
CLICK_DECLS


24 
	gS‘RªdIPAdd»ss
::
	$S‘RªdIPAdd»ss
()

26 
_max
 = -1;

27 
_addrs
 = 0;

28 
	}
}

30 
	gS‘RªdIPAdd»ss
::~
	$S‘RªdIPAdd»ss
()

32 
	}
}

35 
S‘RªdIPAdd»ss
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 
	g_max
 = -1;

38 
	g»t
 = 
Args
(
cÚf
, 
this
, 
”rh
)

39 .
»ad_mp
("PREFIX", 
IPP»fixArg
(
Œue
), 
_
, 
_mask
)

40 .
»ad_p
("LIMIT", 
_max
).
com¶‘e
();

42 if(
	g_max
 >= 0){

43 
_addrs
 = 
Ãw
 
IPAdd»ss
 [
_max
] ();

45 
	gi
;

46 
	gi
 = 0; i < 
	g_max
; i++)

47 
	g_addrs
[
i
] = 
pick
();

50 (
	g»t
);

53 
IPAdd»ss


54 
	gS‘RªdIPAdd»ss
::
	$pick
()

56 
ušt32_t
 
x
;

57 
ušt32_t
 
mask
 = (ušt32_tè
_mask
;

59 
x
 = (
	`şick_¿ndom
(è& ~
mask
è| ((
ušt32_t
)
_
 & mask);

61 (
	`IPAdd»ss
(
x
));

62 
	}
}

64 
Pack‘
 *

65 
	gS‘RªdIPAdd»ss
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

67 
IPAdd»ss
 
a
;

69 if(
_addrs
 && 
_max
 > 0){

70 
a
 = 
_addrs
[
	`şick_¿ndom
(0, 
_max
 - 1)];

72 
a
 = 
	`pick
();

75 
p
->
	`£t_d¡__ªno
(
a
);

77  
p
;

78 
	}
}

80 
CLICK_ENDDECLS


81 
	$EXPORT_ELEMENT
(
S‘RªdIPAdd»ss
)

82 
	`ELEMENT_MT_SAFE
(
S‘RªdIPAdd»ss
)

	@ip/setrandipaddress.hh

1 #iâdeà
S‘RªdIPAdd»ss_hh


2 
	#S‘RªdIPAdd»ss_hh


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/add»ss.hh
>

5 
CLICK_DECLS


21 şas 
	cS‘RªdIPAdd»ss
 : 
public
 
EËm’t
 {

23 
IPAdd»ss
 
_
;

24 
IPAdd»ss
 
	m_mask
;

25 
	m_max
;

26 
IPAdd»ss
 *
	m_addrs
;

28 
	mpublic
:

30 
	$S‘RªdIPAdd»ss
(è
CLICK_COLD
;

31 ~
	$S‘RªdIPAdd»ss
(è
CLICK_COLD
;

33 cÚ¡ *
	$şass_Çme
() const {  "SetRandIPAddress"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

36 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

38 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

39 
IPAdd»ss
 
pick
();

42 
	gCLICK_ENDDECLS


	@ip/siphmapper.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 #ià
CLICK_BSDMODULE


24 
	~<sys/lim™s.h
>

26 
	~"–em’ts//rw·‰”n.hh
"

27 
	~"shm­³r.hh
"

28 
CLICK_DECLS


30 
	gSourûIPHashM­³r
::
	$SourûIPHashM­³r
()

31 : 
	$_hash”
 (
NULL
)

33 
	}
}

35 
SourûIPHashM­³r
::~
	$SourûIPHashM­³r
()

37 
	}
}

40 
SourûIPHashM­³r
::
	$ÿ¡
(cÚ¡ *
Çme
)

42 ià(
Çme
 && 
	`¡rcmp
("SourceIPHashMapper",‚ame) == 0)

43  (
EËm’t
 *)
this
;

44 ià(
Çme
 && 
	`¡rcmp
("IPMapper",‚ame) == 0)

45  (
IPM­³r
 *)
this
;

48 
	}
}

51 
	gSourûIPHashM­³r
::
	$·r£_£rv”
(cÚ¡ 
SŒšg
 &
cÚf
, 
IPRewr™”IÅut
 *
šput
,

52 *
id_¡Üe
, 
EËm’t
 *
e
,

53 
E¼ÜHªdËr
 *
”rh
)

55 
VeùÜ
<
SŒšg
> 
wÜds
;

56 
	`ı_¥aûvec
(
cÚf
, 
wÜds
);

57 
št32_t
 
id
;

59 ià(
wÜds
.
	`size
 () <= 1

60 || !
	`IÁArg
().
	`·r£
(
wÜds
[wÜds.
	`size
(è- 1], 
id
)

61 || 
id
 < 0)

62  
”rh
->
	`”rÜ
("bad server ID in…attern spec");

63 
wÜds
.
	`»size
(wÜds.
	`size
() - 1);

64 *
id_¡Üe
 = 
id
;

65  
IPRewr™”P©‹º
::
	`·r£_w™h_pÜts
(
	`ı_un¥aûvec
(
wÜds
), 
šput
,

66 
e
, 
”rh
) ? 0 : -1;

67 
	}
}

70 
	gSourûIPHashM­³r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

72 ià(
	gcÚf
.
size
 () == 0)

73  
”rh
->
”rÜ
 ("no hash seed given");

74 ià(
	gcÚf
.
size
() == 1)

75  
”rh
->
”rÜ
("no…atterns given");

76 ià(
	gcÚf
.
size
() == 2)

77 
”rh
->
w¬nšg
("only one…attern given");

79 
	gÂodes
;

80 
št32_t
 
	g£ed
;

81 
	gVeùÜ
<
	gSŒšg
> 
	g·¿ms
;

82 
ı_¥aûvec
 (
cÚf
[0], 
·¿ms
);

83 ià(
	g·¿ms
.
size
 () != 2)

84  
”rh
->
”rÜ
("requires 2 config…arams:‚umnodes seed");

85 ià(!
IÁArg
().
·r£
(
·¿ms
[0], 
Âodes
è|| 
	gÂodes
 <= 0)

86  
”rh
->
”rÜ
("number of‚odes must be‡n integer");

87 ià(!
IÁArg
().
·r£
(
·¿ms
[1], 
£ed
))

88  
	g”rh
->
”rÜ
("hash seed must be‡n integer");

90 
	gidp
 = 0;

91 *
	gids
 = 
Ãw
 [
cÚf
.
size
 ()];

93 
	gi
 = 1; i < 
	gcÚf
.
size
(); i++) {

94 
IPRewr™”IÅut
 
	gis
;

95 
	gis
.
	gkšd
 = 
IPRewr™”IÅut
::
i_·‰”n
;

96 
	gid
;

97 ià(
·r£_£rv”
(
cÚf
[
i
], &
is
, &
id
, 
this
, 
”rh
) >= 0) {

98 
is
.
u
.
·‰”n
->
u£
();

99 
	g_is
.
push_back
(
is
);

100 
	gids
[
idp
++] = 
id
;

104 ià(
	g_hash”
)

105 
d–‘e
 (
_hash”
);

106 
	g_hash”
 = 
Ãw
 
chash_t
<> (
idp
, 
	gids
, 
	gÂodes
, 
	g£ed
);

108 
	gd–‘e
 [] 
	gids
;

109  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

113 
	gSourûIPHashM­³r
::
	$ş—nup
(
CËªupSge
)

115 
i
 = 0; i < 
_is
.
	`size
(); i++)

116 
_is
[
i
].
u
.
·‰”n
->
	`unu£
();

117 
d–‘e
 
_hash”
;

118 
	}
}

121 
	gSourûIPHashM­³r
::
	$nÙify_»wr™”
(
IPRewr™”Ba£
 *
u£r
,

122 
IPRewr™”IÅut
 *
šput
, 
E¼ÜHªdËr
 *
”rh
)

124 
i
 = 0; i < 
_is
.
	`size
(); i++) {

125 ià(
_is
[
i
].
fouut
 >ğ
u£r
->
	`nouuts
()

126 || 
_is
[
i
].
rouut
 >ğ
šput
->
»¶y_–em’t
->
	`nouuts
())

127 
”rh
->
	`”rÜ
("ouuˆpÜˆouˆoà¿ngš % ·‰”À%d", 
	`deş¬©iÚ
().
	`c_¡r
(), 
i
);

129 
	}
}

132 
	gSourûIPHashM­³r
::
	$»wr™e_æowid
(
IPRewr™”IÅut
 *
šput
,

133 cÚ¡ 
IPFlowID
 &
æowid
,

134 
IPFlowID
 &
»wr™‹n_æowid
,

135 
Pack‘
 *
p
, 
m­id
)

137 cÚ¡ 
š_addr
 
¤c
 = 
æowid
.
	`§ddr
();

138 
tmp
, 
t2
;

139 
	`memıy
 (&
tmp
, &
¤c
,  (tmp));

140 
t2
 = 
tmp
 & 0xff;

145 
tmp
 *ğ((
t2
 << 24) | 0x1);

146 
tmp
 =m°% 
INT_MAX
;

148 
v
 = 
_hash”
->
	`hash2šd
 (
tmp
);

149 
_is
[
v
].
»¶y_–em’t
 = 
šput
->reply_element;

150 
šput
->
fouut
 = 
_is
[
v
].foutput;

151 
šput
->
rouut
 = 
_is
[
v
].routput;

152  
_is
[
v
].
	`»wr™e_æowid
(
æowid
, 
»wr™‹n_æowid
, 
p
, 
m­id
);

153 
	}
}

155 
CLICK_ENDDECLS


156 
	$ELEMENT_REQUIRES
(
IPRewr™”Ba£
)

157 
	`EXPORT_ELEMENT
(
SourûIPHashM­³r
)

	@ip/siphmapper.hh

1 #iâdeà
CLICK_SOURCEIPMAPPER_HH


2 
	#CLICK_SOURCEIPMAPPER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/æowid.hh
>

5 
	~<şickÃt/.h
>

6 
	~"–em’ts//»wr™”ba£.hh
"

7 
	~<şick/glue.hh
>

8 
CLICK_DECLS


33 
	g‹m¶©e
<
şass
 
	gC
, cÏs 
	gK
, 
K
 C::*
key
> 

34 
	$jvcomp
 (cÚ¡ *
a
, cÚ¡ *
b
, *)

36 cÚ¡ 
C
 *
ÿ
 = 
¡©ic_ÿ¡
<cÚ¡ C *> (
a
);

37 cÚ¡ 
C
 *
cb
 = 
¡©ic_ÿ¡
<cÚ¡ C *> (
b
);

38  (
ÿ
->*
key
 - 
cb
->*key);

39 
	}
}

41 
	g‹m¶©e
<
şass
 
	gC
, cÏs 
	gK
, 
K
 C::*
key
>

42 şas 
	cjvŒ“_t


44 
public
:

45 
	$jvŒ“_t
 (
sz
, 
C
 *
¬r
)

46 : 
	`num
 (
sz
), 
	$Œ“
 (
Ãw
 
C
[
sz
])

48 
	`şick_qsÜt
 ((*)
¬r
, 
sz
,  (
C
), 
jvcomp
<C,
K
,
key
>);

50 
n
 = 
	`Ãxt2pow
 (
sz
);

51 
h
 = 
n
 - 1;

55 
f
 = 2*((
sz
+1)/2è- 2*((
h
 - sz)/ 2) + 1;

57 
s
,
d
;

58 
d
 = 
n
;

59 
s
 = 
d
 >> 1;

61 
to
 = 0;

62 
s
 > 0 && 
to
 < 
sz
) {

63 
x
 = 
s
; x < 
n
 && 
to
 < 
sz
; x +ğ
d
) {

64 
äom
 = (
x
 < 
f
) ? x : (x + f - 1)/2;

65 
Œ“
[
to
++] = 
¬r
[--
äom
];

67 
d
 = 
s
;

68 
s
 = s >> 1;

74 
	$Ãxt2pow
 (
i
)

76 
tmp
 = 
i
;

77 
p
 = 1;

78 (
tmp
 = (tm°>> 1)è> 0è
p
++;

79 
r
 = 1;

80 
i
 = 0; i < 
p
; i++è
r
 =„ << 1;

81  
r
;

82 
	}
}

84 ~
	$jvŒ“_t
 (è{ 
d–‘e
 [] 
Œ“
; 
	}
}

87 
C
 *
	$£¬ch
 (
K
 
k
) const

89 
i
 = 0;

90 
C
 *
»t
 = 
NULL
;

91 
C
 *
cu¼
;

92 
K
 
tkv
;

93 
i
 < 
num
) {

94 
cu¼
 = 
Œ“
 + 
i
;

95 
tkv
 = 
cu¼
->*
key
;

96 ià(
k
 =ğ
tkv
) {

97  
cu¼
;

98 } ià(
k
 > 
tkv
) {

99 
i
 = 2*i + 2;

101 
i
 = 2*i + 1;

102 
»t
 = 
cu¼
;

105  
»t
 ?„‘ : 
Œ“
;

106 
	}
}

107 
	g´iv©e
:

108 
num
;

109 
C
 *
	gŒ“
;

112 
	g‹m¶©e
<
şass
 
	gK
>

113 şas 
	cchash_node_t
 {

114 
	mpublic
:

115 
	$chash_node_t
 () {}

116 
	$chash_node_t
 (
K
 
k
, 
v
è: 
	`key
 (k), 
	`v®
 (v), 
	$šdex
 (0è{
	}
}

117 
K
 
	gkey
;

118 
	gv®
;

119 
	gšdex
;

125 
	g‹m¶©e
<
şass
 
	gK
>

126 şas 
	cchash_t
 {

127 
	mpublic
:

128 
	$chash_t
 (
size_t
 
ns
, *
ids
, size_ˆ
Â
, 
£ed
 = 0x1)

129 : 
	`num_£rv”s
 (
ns
), 
	$num_nodes
 (
Â
)

131 
	`şick_¤ªdom
(
£ed
);

133 
max_£rv”s
 = -1;

134 
size_t
 
i
 = 0; i < 
num_£rv”s
; i++)

135 ià(
ids
[
i
] > 
max_£rv”s
)

136 
max_£rv”s
 = 
ids
[
i
];

137 
max_£rv”s
++;

140 *
£rvm­
 = 
Ãw
 [
max_£rv”s
];

141 
	`mem£t
 (
£rvm­
, 0, 
max_£rv”s
);

142 
size_t
 
i
 = 0; i < 
num_£rv”s
; i++)

143 
£rvm­
[
ids
[
i
]] = 1;

145 
n
 = 
num_£rv”s
 * 
num_nodes
;

146 
chash_node_t
<
K
> *
š
 = 
Ãw
 chash_node_t<K> [
n
];

147 
p
 = 0;

148 
šdex
 = -1;

149 
i
 = 0; i < 
max_£rv”s
; i++) {

150 
boŞ
 
šc
 = 
çl£
;

151 
j
 = 0; j < 
num_nodes
; j++) {

152 
tmp
 = 
	`şick_¿ndom
();

153 ià(
£rvm­
[
i
]) {

154 ià(!
šc
) {

155 
šc
 = 
Œue
;

156 
šdex
 ++;

158 
K
 
ktmp
 = 
¡©ic_ÿ¡
<K> (
tmp
);

159 
š
[
p
].
key
 = 
ktmp
;

160 
š
[
p
].
v®
 = 
i
;

161 
š
[
p
++].
šdex
 = index;

165 
Œ“
 = 
Ãw
 
jvŒ“_t
<
chash_node_t
<
K
>, K, &chash_node_t<K>::
key
> (
n
, 
š
);

167 
d–‘e
 [] 
š
;

168 
d–‘e
 [] 
£rvm­
;

171 
	$hash
 (
K
 
k
ècÚ¡ {  
Œ“
->
	`£¬ch
 (k)->
v®
; 
	}
}

172 
	$hash2šd
 (
K
 
k
ècÚ¡ {  
Œ“
->
	`£¬ch
 (k)->
šdex
; 
	}
}

174 ~
	$chash_t
 ()

176 
d–‘e
 
Œ“
;

177 
	}
}

179 
	g´iv©e
:

180 
size_t
 
num_£rv”s
, 
	gnum_nodes
;

181 
	gjvŒ“_t
<
	gchash_node_t
<
	gK
>, K, &chash_node_t<K>::
key
> *
Œ“
;

185 
şass
 
	gSourûIPHashM­³r
 : 
public
 
EËm’t
,…ubliø
	gIPM­³r
 { 
	gpublic
:

187 
SourûIPHashM­³r
(è
CLICK_COLD
;

188 ~
SourûIPHashM­³r
(è
	gCLICK_COLD
;

190 cÚ¡ *
şass_Çme
() const {  "SourceIPHashMapper"; }

191 *
ÿ¡
(const *);

193 
cÚfigu»_pha£
(ècÚ¡ {  
	gIPRewr™”Ba£
::
CONFIGURE_PHASE_MAPPER
;}

194 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

195 
ş—nup
(
CËªupSge
è
	gCLICK_COLD
;

197 
nÙify_»wr™”
(
IPRewr™”Ba£
 *
u£r
, 
IPRewr™”IÅut
 *
šput
,

198 
E¼ÜHªdËr
 *
”rh
);

199 
»wr™e_æowid
(
IPRewr™”IÅut
 *
šput
,

200 cÚ¡ 
IPFlowID
 &
æowid
, IPFlowID &
»wr™‹n_æowid
,

201 
Pack‘
 *
p
, 
m­id
);

203 
	g´Ùeùed
:

204 
·r£_£rv”
(cÚ¡ 
SŒšg
 &
cÚf
, 
IPRewr™”IÅut
 *
šput
,

205 *
id_¡Üe
, 
EËm’t
 *
e
, 
E¼ÜHªdËr
 *
”rh
);

207 
	g´iv©e
:

209 
VeùÜ
<
IPRewr™”IÅut
> 
_is
;

210 
	gchash_t
<> *
	g_hash”
;

213 
	gCLICK_ENDDECLS


	@ip/sortediplookup.cc

21 
	~<şick/cÚfig.h
>

22 
	~"sÜ‹dlookup.hh
"

23 
	~<şick/add»ss.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/”rÜ.hh
>

26 
CLICK_DECLS


28 
	gSÜ‹dIPLookup
::
	$SÜ‹dIPLookup
()

30 
	}
}

32 
SÜ‹dIPLookup
::~
	$SÜ‹dIPLookup
()

34 
	}
}

37 
SÜ‹dIPLookup
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39 
	g”rh
->
w¬nšg
("SortedIPLookup is deprecated; use LinearIPLookup or RadixIPLookup instead");

40  
	gLš—rIPLookup
::
cÚfigu»
(
cÚf
, 
”rh
);

43 
boŞ


44 
	gSÜ‹dIPLookup
::
	$check
() const

46 
boŞ
 
ok
 = 
Lš—rIPLookup
::
	`check
();

49 
i
 = 0; i < 
_t
.
	`size
(); i++)

50 ià(
_t
[
i
].
exŒa
 < _t.
	`size
()) {

51 
	`şick_ch©‹r
("%s:„ou‹ % ha ¨nÚŒivŸÈÃxt", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_t
[
i
].
	`uÅ¬£_addr
().c_str());

52 
ok
 = 
çl£
;

55  
ok
;

56 
	}
}

59 
	gSÜ‹dIPLookup
::
	$sÜt_bË
()

62 ià(
_t
.
	`size
() == 0)

66 
VeùÜ
<> 
	`d•
(
_t
.
	`size
(), 0);

67 
nuÄ—l
 = 0;

68 
i
 = 0; i < 
_t
.
	`size
(); i++) {

69 ià(!
_t
[
i
].
	`»®
())

70 
d•
[
i
]++, 
nuÄ—l
++;

72 
j
 = 0; j < 
_t
.
	`size
(); j++)

73 ià(
_t
[
j
].
	`cÚšs
(_t[
i
]) && i != j)

74 
d•
[
j
]++;

78 
VeùÜ
<> 
³rmu‹
;

79 
fœ¡
 = 0, 
qpos
 = 0;

80 
³rmu‹
.
	`size
(è< 
_t
.size(è- 
nuÄ—l
) {

83 ; 
fœ¡
 < 
_t
.
	`size
(è&& 
d•
[first] != 0; first++)

85 
	`as£¹
(
fœ¡
 < 
_t
.
	`size
());

88 
³rmu‹
.
	`push_back
(
fœ¡
);

91 ; 
qpos
 < 
³rmu‹
.
	`size
(); qpos++) {

92 
which
 = 
³rmu‹
[
qpos
];

93 
d•
[
which
] = -1;

94 
i
 = 0; i < 
_t
.
	`size
(); i++)

95 ià(
d•
[
i
] > 0 && 
_t
[i].
	`cÚšs
(_t[
which
]è&& _t[i].
	`»®
()) {

96 ià(!--
d•
[
i
])

97 
³rmu‹
.
	`push_back
(
i
);

104 
VeùÜ
<
IPRou‹
> 
	`Á
(
_t
);

105 
i
 = 0; i < 
³rmu‹
.
	`size
(); i++) {

106 ià(
³rmu‹
[
i
] != i)

107 
Á
[
i
] = 
_t
[
³rmu‹
[i]];

108 
Á
[
i
].
exŒa
 = 0x7FFFFFFF;

110 
_t
.
	`sw­
(
Á
);

111 
_t
.
	`»size
(
³rmu‹
.
	`size
());

112 
_z”o_rou‹
 = -1;

114 
	`check
();

115 
	}
}

118 
	gSÜ‹dIPLookup
::
	$add_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, 
boŞ
 
£t
, IPRou‹* 
Şd
, 
E¼ÜHªdËr
 *
”rh
)

120 
r
;

121 ià((
r
 = 
Lš—rIPLookup
::
	`add_rou‹
(
rou‹
, 
£t
, 
Şd
, 
”rh
)) < 0)

122  
r
;

123 
	`sÜt_bË
();

125 
	}
}

128 
	gSÜ‹dIPLookup
::
	$»move_rou‹
(cÚ¡ 
IPRou‹
& 
rou‹
, IPRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
 *
”rh
)

130 
r
;

131 ià((
r
 = 
Lš—rIPLookup
::
	`»move_rou‹
(
rou‹
, 
Şd_rou‹
, 
”rh
)) < 0)

132  
r
;

133 
	`sÜt_bË
();

135 
	}
}

142 
šlše
 

143 
	gSÜ‹dIPLookup
::
	$lookup_’Œy
(
IPAdd»ss
 
a
) const

145 
i
 = 0; i < 
_t
.
	`size
(); i++)

146 ià(
_t
[
i
].
	`cÚšs
(
a
))

147  
i
;

149 
	}
}

152 
	gSÜ‹dIPLookup
::
	$push
(, 
Pack‘
 *
p
)

154 
	#EXCHANGE
(
a
,
b
,
t
è{ =‡;‡ = b; b =; }

	)

155 
IPAdd»ss
 
a
 = 
p
->
	`d¡__ªno
();

156 
ei
 = -1;

158 ià(
a
 &&‡ =ğ
_Ï¡_addr
)

159 
ei
 = 
_Ï¡_’Œy
;

160 #ifdeà
IP_RT_CACHE2


161 ià(
a
 &&‡ =ğ
_Ï¡_addr2
)

162 
ei
 = 
_Ï¡_’Œy2
;

164 ià((
ei
 = 
	`lookup_’Œy
(
a
)) >= 0) {

165 #ifdeà
IP_RT_CACHE2


166 
_Ï¡_addr2
 = 
_Ï¡_addr
;

167 
_Ï¡_’Œy2
 = 
_Ï¡_’Œy
;

169 
_Ï¡_addr
 = 
a
;

170 
_Ï¡_’Œy
 = 
ei
;

172 
	`şick_ch©‹r
("SÜ‹dIPLookup:‚Øgw fÜ %x", 
a
.
	`addr
());

173 
p
->
	`kl
();

177 cÚ¡ 
IPRou‹
 &
e
 = 
_t
[
ei
];

178 ià(
e
.
gw
)

179 
p
->
	`£t_d¡__ªno
(
e
.
gw
);

180 
	`ouut
(
e
.
pÜt
).
	`push
(
p
);

181 
	}
}

183 
CLICK_ENDDECLS


184 
	$ELEMENT_REQUIRES
(
Lš—rIPLookup
)

185 
	`EXPORT_ELEMENT
(
SÜ‹dIPLookup
)

	@ip/sortediplookup.hh

2 #iâdeà
CLICK_SORTEDIPLOOKUP_HH


3 
	#CLICK_SORTEDIPLOOKUP_HH


	)

4 
	~"lš—rlookup.hh
"

5 
CLICK_DECLS


26 şas 
	cSÜ‹dIPLookup
 : 
public
 
Lš—rIPLookup
 {…ublic:

28 
	$SÜ‹dIPLookup
(è
CLICK_COLD
;

29 ~
	$SÜ‹dIPLookup
(è
CLICK_COLD
;

31 cÚ¡ *
	$şass_Çme
() const {  "SortedIPLookup"; }

32 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

34 
	`push
(
pÜt
, 
Pack‘
 *
p
);

36 
	`add_rou‹
(cÚ¡ 
IPRou‹
&, 
boŞ
, IPRou‹*, 
E¼ÜHªdËr
 *);

37 
	`»move_rou‹
(cÚ¡ 
IPRou‹
&, IPRou‹*, 
E¼ÜHªdËr
 *);

39 
boŞ
 
	$check
() const;

41 
´Ùeùed
:

43 
šlše
 
	$lookup_’Œy
(
IPAdd»ss
) const;

44 
	`sÜt_bË
();

46 
	}
};

48 
	gCLICK_ENDDECLS


	@ip/storeipaddress.cc

20 
	~<şick/cÚfig.h
>

21 
	~"¡Üeadd»ss.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şickÃt/.h
>

25 
	~<şickÃt/tı.h
>

26 
	~<şickÃt/udp.h
>

27 
CLICK_DECLS


29 
	gStÜeIPAdd»ss
::
	$StÜeIPAdd»ss
()

31 
	}
}

33 
StÜeIPAdd»ss
::~
	$StÜeIPAdd»ss
()

35 
	}
}

38 
StÜeIPAdd»ss
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40 
SŒšg
 
	goff£t
;

41 
	gr
;

42 
	g_u£_add»ss
 = 
cÚf
.
size
() > 1;

43 ià(!
	g_u£_add»ss
)

44 
	gr
 = 
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("OFFSET", 
WÜdArg
(), 
off£t
).
com¶‘e
();

46 
	gr
 = 
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("ADDR", 
_add»ss
)

47 .
»ad_mp
("OFFSET", 
WÜdArg
(), 
off£t
).
com¶‘e
();

48 ià(
	gr
 < 0)

49  
	gr
;

50 ià(
	goff£t
.
low”
() == "src")

51 
_off£t
 = -12;

52 ià(
	goff£t
.
low”
() == "dst")

53 
_off£t
 = -16;

54 ià(!
IÁArg
().
·r£
(
off£t
, 
_off£t
è|| 
	g_off£t
 < 0)

55  
	g”rh
->
”rÜ
("type mismatch: OFFSET„equires integer");

59 
Pack‘
 *

60 
	gStÜeIPAdd»ss
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

63 
IPAdd»ss
 
a
 = (
_u£_add»ss
 ? 
_add»ss
 : 
p
->
	`d¡__ªno
());

64 ià((
a
 || 
_u£_add»ss
è&& (
ušt32_t
è
_off£t
 + 4 <ğ
p
->
	`Ëngth
()) {

65 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
()) {

66 
	`memıy
(
q
->
	`d©a
(è+ 
_off£t
, &
a
, 4);

67  
q
;

71 } ià(
_off£t
 >ğ-16 && 
p
->
	`has_ÃtwÜk_h—d”
()

72 && 
p
->
	`_h—d”_Ëngth
(è>ğ(
şick_
)) {

75 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
()) {

76 
ušt16_t
 *
x
 = 
»š‹½»t_ÿ¡
<ušt16_ˆ*>(
q
->
	`ÃtwÜk_h—d”
(è- 
_off£t
);

77 
ušt32_t
 
Şd_hw
 = (ušt32_tè
x
[0] + x[1];

78 
Şd_hw
 += (old_hw >> 16);

80 
	`memıy
(
x
, &
a
, 4);

82 
ušt32_t
 
Ãw_hw
 = (ušt32_tè
x
[0] + x[1];

83 
Ãw_hw
 += (new_hw >> 16);

84 
şick_
 *
h
 = 
q
->
	`_h—d”
();

85 
	`şick_upd©e_š_cksum
(&
h
->
_sum
, 
Şd_hw
, 
Ãw_hw
);

86 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
 && 
	`IP_FIRSTFRAG
(iph)

87 && 
q
->
	`Œª¥Üt_Ëngth
(è>ğ(è(
şick_tı
))

88 
	`şick_upd©e_š_cksum
(&
q
->
	`tı_h—d”
()->
th_sum
, 
Şd_hw
, 
Ãw_hw
);

89 ià(
h
->
_p
 =ğ
IP_PROTO_UDP
 && 
	`IP_FIRSTFRAG
(iph)

90 && 
q
->
	`Œª¥Üt_Ëngth
(è>ğ(è(
şick_udp
)

91 && 
q
->
	`udp_h—d”
()->
uh_sum
)

92 
	`şick_upd©e_š_cksum
(&
q
->
	`udp_h—d”
()->
uh_sum
, 
Şd_hw
, 
Ãw_hw
);

94  
q
;

99 
	`checked_ouut_push
(1, 
p
);

102 
	}
}

104 
CLICK_ENDDECLS


105 
	$EXPORT_ELEMENT
(
StÜeIPAdd»ss
)

106 
	`ELEMENT_MT_SAFE
(
StÜeIPAdd»ss
)

	@ip/storeipaddress.hh

1 #iâdeà
CLICK_STOREIPADDRESS_HH


2 
	#CLICK_STOREIPADDRESS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/add»ss.hh
>

5 
CLICK_DECLS


54 şas 
	cStÜeIPAdd»ss
 : 
public
 
EËm’t
 {…ublic:

56 
	$StÜeIPAdd»ss
(è
CLICK_COLD
;

57 ~
	$StÜeIPAdd»ss
(è
CLICK_COLD
;

59 cÚ¡ *
	$şass_Çme
() const {  "StoreIPAddress"; }

60 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

61 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

63 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

65 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

67 
	g´iv©e
:

69 
_off£t
;

70 
IPAdd»ss
 
	g_add»ss
;

71 
boŞ
 
	g_u£_add»ss
;

75 
	gCLICK_ENDDECLS


	@ip/stripipheader.cc

18 
	~<şick/cÚfig.h
>

19 
	~"¡rh—d”.hh
"

20 
	~<şickÃt/.h
>

21 
CLICK_DECLS


23 
	gSŒIPH—d”
::
	$SŒIPH—d”
()

25 
	}
}

27 
SŒIPH—d”
::~
	$SŒIPH—d”
()

29 
	}
}

31 
Pack‘
 *

32 
SŒIPH—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

34 
p
->
	`puÎ
Õ->
	`Œª¥Üt_h—d”_off£t
());

35  
p
;

36 
	}
}

38 
CLICK_ENDDECLS


39 
	$EXPORT_ELEMENT
(
SŒIPH—d”
)

40 
	`ELEMENT_MT_SAFE
(
SŒIPH—d”
)

	@ip/stripipheader.hh

1 #iâdeà
CLICK_STRIPIPHEADER_HH


2 
	#CLICK_STRIPIPHEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


25 şas 
	cSŒIPH—d”
 : 
public
 
EËm’t
 {…ublic:

27 
	$SŒIPH—d”
(è
CLICK_COLD
;

28 ~
	$SŒIPH—d”
(è
CLICK_COLD
;

30 cÚ¡ *
	$şass_Çme
() const {  "StripIPHeader"; }

31 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

33 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

37 
	gCLICK_ENDDECLS


	@ip/truncateippayload.cc

19 
	~<şick/cÚfig.h
>

20 
	~"Œunÿ‹·ylßd.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
	~<şickÃt/tı.h
>

26 
	~<şickÃt/udp.h
>

27 
	~<şickÃt/icmp.h
>

28 
CLICK_DECLS


30 
	gTrunÿ‹IPPaylßd
::
	$Trunÿ‹IPPaylßd
()

32 
	}
}

34 
Trunÿ‹IPPaylßd
::~
	$Trunÿ‹IPPaylßd
()

36 
	}
}

39 
Trunÿ‹IPPaylßd
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41 
ušt16_t
 
	gnby‹s
 = 0;

42 
boŞ
 
	gŒª¥Üt
 = 
Œue
;

43 
boŞ
 
	gexŒa_Ëngth
 = 
Œue
;

44 ià(
Args
(
cÚf
, 
this
, 
”rh
)

45 .
»ad_p
("LENGTH", 
nby‹s
)

46 .
»ad_p
("TRANSPORT", 
Œª¥Üt
)

47 .
»ad
("EXTRA_LENGTH", 
exŒa_Ëngth
).
com¶‘e
() < 0)

49 
	g_nby‹s
 = (
nby‹s
 << 2è+ 
Œª¥Üt
 + (
exŒa_Ëngth
 << 1);

53 
Pack‘
 *

54 
	gTrunÿ‹IPPaylßd
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

56 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

57 
nby‹s
 = 
_nby‹s
 >> 2;

59 ià(!
p
->
	`has_ÃtwÜk_h—d”
()) {

60 ià(
p
->
	`Ëngth
(è<ğ
nby‹s
)

61  
p
;

62 
nby‹s
 = 
p
->
	`Ëngth
() -‚bytes;

63 
ke
;

64 } ià(
h
->
_hl
 < ((
şick_
) >> 2))

66 
nby‹s
 +ğ(
şick_
);

68 
nby‹s
 +ğ
h
->
_hl
 << 2;

69 ià((
_nby‹s
 & 1è&& 
p
->
	`ÃtwÜk_Ëngth
() >= 10)

70 
h
->
_p
) {

71 
IP_PROTO_TCP
:

72 ià(
p
->
	`Œª¥Üt_Ëngth
() >= 12

73 && 
p
->
	`tı_h—d”
()->
th_off
 >ğ((
şick_tı
) >> 2))

74 
nby‹s
 +ğ
p
->
	`tı_h—d”
()->
th_off
 << 2;

76 
nby‹s
 +ğ(
şick_tı
);

78 
IP_PROTO_UDP
:

79 
nby‹s
 +ğ(
şick_udp
);

81 
IP_PROTO_ICMP
:

82 ià(
p
->
	`Œª¥Üt_Ëngth
() >= 8)

83 
nby‹s
 +ğ
	`şick_icmp_hl
(
p
->
	`icmp_h—d”
()->
icmp_ty³
);

88 ià(
p
->
	`ÃtwÜk_Ëngth
(è<ğ(è
nby‹s
)

89  
p
;

90 
nby‹s
 = 
p
->
	`ÃtwÜk_Ëngth
() -‚bytes;

92 
ke
:

93 ià(
_nby‹s
 & 2)

94 
	`SET_EXTRA_LENGTH_ANNO
(
p
, 
	`EXTRA_LENGTH_ANNO
Õè+ 
nby‹s
);

95 
p
->
	`ke
(
nby‹s
);

96  
p
;

97 
	}
}

99 
CLICK_ENDDECLS


100 
	$EXPORT_ELEMENT
(
Trunÿ‹IPPaylßd
)

101 
	`ELEMENT_MT_SAFE
(
Trunÿ‹IPPaylßd
)

	@ip/truncateippayload.hh

2 #iâdeà
CLICK_TRUNCATEIPPAYLOAD_HH


3 
	#CLICK_TRUNCATEIPPAYLOAD_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


30 şas 
	cTrunÿ‹IPPaylßd
 : 
public
 
EËm’t
 {…ublic:

32 
	$Trunÿ‹IPPaylßd
(è
CLICK_COLD
;

33 ~
	$Trunÿ‹IPPaylßd
(è
CLICK_COLD
;

35 cÚ¡ *
	$şass_Çme
() const {  "TruncateIPPayload"; }

36 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

38 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

40 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

42 
	g´iv©e
:

44 
_nby‹s
;

48 
	gCLICK_ENDDECLS


	@ip/unstripipheader.cc

18 
	~<şick/cÚfig.h
>

19 
	~"un¡rh—d”.hh
"

20 
	~<şickÃt/.h
>

21 
CLICK_DECLS


23 
	gUn¡rIPH—d”
::
	$Un¡rIPH—d”
()

25 
	}
}

27 
Un¡rIPH—d”
::~
	$Un¡rIPH—d”
()

29 
	}
}

31 
Pack‘
 *

32 
Un¡rIPH—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

34 
	`as£¹
(
p
->
	`ÃtwÜk_h—d”
());

35 
±rdiff_t
 
off£t
 = 
p
->
	`ÃtwÜk_h—d”
(è-…->
	`d©a
();

36 ià(
off£t
 < 0)

37 
p
 =…->
	`push
(-
off£t
);

38  
p
;

39 
	}
}

41 
CLICK_ENDDECLS


42 
	$EXPORT_ELEMENT
(
Un¡rIPH—d”
)

43 
	`ELEMENT_MT_SAFE
(
Un¡rIPH—d”
)

	@ip/unstripipheader.hh

1 #iâdeà
CLICK_UNSTRIPIPHEADER_HH


2 
	#CLICK_UNSTRIPIPHEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


19 şas 
	cUn¡rIPH—d”
 : 
public
 
EËm’t
 {…ublic:

21 
	$Un¡rIPH—d”
(è
CLICK_COLD
;

22 ~
	$Un¡rIPH—d”
(è
CLICK_COLD
;

24 cÚ¡ *
	$şass_Çme
() const {  "UnstripIPHeader"; }

25 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

27 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

31 
	gCLICK_ENDDECLS


	@ip6/addresstranslator.cc

16 
	~<şick/cÚfig.h
>

17 
	~"add»s¡¿n¦©Ü.hh
"

18 
	~<şick/¬gs.hh
>

19 
	~<şick/”rÜ.hh
>

20 
	~<şickÃt/.h
>

21 
	~<şickÃt/6.h
>

22 
	~<şickÃt/icmp.h
>

23 
	~<şickÃt/icmp6.h
>

24 
	~<şickÃt/tı.h
>

25 
	~<şickÃt/udp.h
>

26 
CLICK_DECLS


28 
	gAdd»ssT¿n¦©Ü
::
	$Add»ssT¿n¦©Ü
()

29 : 
	`_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
(0),

30 
	`_š_m­
(0), 
	`_out_m­
(0), 
	`_rov”
(0), 
	`_rov”2
(0), 
	$_nm­pšgs
(0)

36 
	}
}

39 
	gAdd»ssT¿n¦©Ü
::~
	$Add»ssT¿n¦©Ü
()

41 
	}
}

43 
Add»ssT¿n¦©Ü
::
M­pšg
::
	$M­pšg
()

44 : 
	`_´ev
(0), 
	`_Ãxt
(0), 
	$_ä“_Ãxt
(0)

46 
	}
}

49 
	gAdd»ssT¿n¦©Ü
::
	$ş—nup
(
CËªupSge
)

51 ià(
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
==0)

53 
	`ş—n_m­
(
_š_m­
, 1);

54 
	`ş—n_m­
(
_out_m­
, 0);

58 
	`ş—n_m­
(
_š_m­
, 0);

59 
	`ş—n_m­
(
_out_m­
, 1);

61 
	}
}

64 
	gAdd»ssT¿n¦©Ü
::
	$m­pšg_ä“d
(
M­pšg
 *
m
, 
boŞ
 
majÜ_m­
)

66 ià(
majÜ_m­
)

68 ià(
_rov”
 =ğ
m
) {

69 
_rov”
 = 
m
->
	`g‘_Ãxt
();

70 ià(
_rov”
 =ğ
m
)

71 
_rov”
 = 0;

74 
_nm­pšgs
--;

75 ià(
_nm­pšgs
) {

76 
M­pšg
 * 
m_´ev
 = 
m
->
	`ä“_Ãxt
();

77 
m_´ev
->
	`£t_Ãxt
(
m
->
	`g‘_Ãxt
());

83 if(
_rov”2
 =ğ
m
) {

84 
_rov”2
 = 
m
->
	`g‘_Ãxt
();

85 ià(
_rov”2
 =ğ
m
)

86 
_rov”2
 = 0;

88 
_nm­pšgs2
--;

89 ià(
_nm­pšgs2
) {

90 
M­pšg
 * 
m_´ev
 = 
m
->
	`ä“_Ãxt
();

91 
m_´ev
->
	`£t_Ãxt
(
m
->
	`g‘_Ãxt
());

94 
	}
}

97 
	gAdd»ssT¿n¦©Ü
::
	$ş—n_m­
(
M­6
 &
bË
, 
boŞ
 
majÜ_m­
)

100 
M­pšg
 *
to_ä“
=0;

101 
M­6
::
™”©Ü
 
™”
 = 
bË
.
	`begš
(); i‹r.
	`live
(); iter++) {

102 
M­pšg
 *
m
 = 
™”
.
	`v®ue
();

103 
m
->
	`£t_ä“_Ãxt
(
to_ä“
);

104 
to_ä“
 = 
m
;

107 
to_ä“
) {

108 
M­pšg
 *
Ãxt
 = 
to_ä“
->
	`ä“_Ãxt
();

109 
	`m­pšg_ä“d
(
to_ä“
, 
majÜ_m­
);

110 
d–‘e
 
to_ä“
;

111 
to_ä“
 = 
Ãxt
;

113 
bË
.
	`ş—r
();

114 
	}
}

117 
	gAdd»ssT¿n¦©Ü
::
	$fšd_mpÜt
( )

119 ià(
_mpÜ
 =ğ
_mpÜth
 || !
_rov”
)

120  
_mpÜ
;

122 
M­pšg
 * 
r
 = 
_rov”
;

123 
M­pšg
 * 
r2
 = 
_rov”2
;

124 
this_mpÜt
 = 
r
->
	`¥Üt
();

128 
M­pšg
 *
Ãxt
 = 
r
->
	`g‘_Ãxt
();

129 
M­pšg
 *
Ãxt2
 = 
r2
->
	`g‘_Ãxt
();

130 
Ãxt_mpÜt
 = 
Ãxt
->
	`¥Üt
();

131 ià(
Ãxt_mpÜt
 > 
this_mpÜt
 +1)

133 
found
;

135 ià(
Ãxt_mpÜt
 <ğ
this_mpÜt
) {

136 ià(
this_mpÜt
 < 
_mpÜth
)

138 
found
;

140 ià(
Ãxt_mpÜt
 > 
_mpÜ
) {

141 
this_mpÜt
 = 
_mpÜ
 -1;

142 
found
;

145 
r
 = 
Ãxt
;

146 
r2
=
Ãxt2
;

147 
this_mpÜt
 = 
Ãxt_mpÜt
;

148 } 
r
!=
_rov”
);

152 
found
:

153 
_rov”
 = 
r
;

154 
_rov”2
 = 
r2
;

155  
this_mpÜt
+1;

157 
	}
}

161 
	gAdd»ssT¿n¦©Ü
::
	$add_m­
(
IP6Add»ss
 &
mai
, 
boŞ
 
bšdšg
)

163 
EÁryM­
 
e
;

165 ià(
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
 ==0)

167 
e
.
_mai
 = 
mai
;

171 
e
.
_Ÿi
 = 
mai
;

173 
e
.
_bšdšg
 = 
bšdšg
;

174 
e
.
_¡©ic
 = 
çl£
;

175 
_v
.
	`push_back
(
e
);

176 
	}
}

180 
	gAdd»ssT¿n¦©Ü
::
	$add_m­
(
IP6Add»ss
 &
Ÿi
, 
i
, IP6Add»s &
mai
, 
mpi
, IP6Add»s &
—
, 
•
, 
boŞ
 
bšdšg
)

182 
EÁryM­
 
e
;

183 ià(
_¡©ic_m­pšg
[0])

184 
e
.
_Ÿi
 = 
Ÿi
;

185 ià(
_¡©ic_m­pšg
[1])

186 
e
.
_i
 = 
i
;

187 ià(
_¡©ic_m­pšg
[2])

188 
e
.
_mai
 = 
mai
;

190 ià(
_¡©ic_m­pšg
[3])

191 
e
.
_mpi
 = 
mpi
;

192 ià(
_¡©ic_m­pšg
[4])

193 
e
.
_—
 = 
—
;

194 ià(
_¡©ic_m­pšg
[5])

195 
e
.
_•
 = 
•
;

197 
e
.
_bšdšg
 = 
bšdšg
;

198 
e
.
_¡©ic
 = 
Œue
;

199 
_v
.
	`push_back
(
e
);

200 
	}
}

203 
	gAdd»ssT¿n¦©Ü
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

205 
	g_v
.
ş—r
();

206 
	gs
 = 0;

207 
IP6Add»ss
 
	gŸ
, 
	gma
, 
	g—
;

208 
	g
, 
	gmp
, 
	g•
 = 0;

212 ià(!
IÁArg
().
·r£
(
cÚf
[0], 
_numb”_of_sm­
))

213  
	g”rh
->
”rÜ
("argument %d should be : integer", 0);

215 ià(
	g_numb”_of_sm­
==0)

216 
s
 = 1;

221 
	gs
 = 
_numb”_of_sm­
+2;

222 ià(!
BoŞArg
().
·r£
(
cÚf
[1], 
_¡©ic_pÜtm­pšg
))

223 
	g”rh
->
”rÜ
("argument %d should be : bool", 2);

225 
	g_¡©ic_m­pšg
[0] = 1;

226 
	g_¡©ic_m­pšg
[1] = 0;

227 
	g_¡©ic_m­pšg
[2] = 1;

228 
	g_¡©ic_m­pšg
[3] = 0;

229 
	g_¡©ic_m­pšg
[4] = 0;

230 
	g_¡©ic_m­pšg
[5] = 0;

232 ià(
	g_¡©ic_pÜtm­pšg
)

234 
	g_¡©ic_m­pšg
[1] = 1;

235 
	g_¡©ic_m­pšg
[3] = 1;

238 
	gi
 = 0; i<
	g_numb”_of_sm­
; i++)

240 
	gVeùÜ
<
	gSŒšg
> 
	gwÜds0
;

241 
ı_¥aûvec
(
cÚf
[2+
i
], 
wÜds0
);

242 
	gj
 = 0;

243 ià(
	g_¡©ic_m­pšg
[0] ==1)

244 
ı_6_add»ss
(
wÜds0
[
j
],(*)&
Ÿ
);

245 ià(
	g_¡©ic_m­pšg
[1] ==1)

246 
IÁArg
().
·r£
(
wÜds0
[++
j
], 

);

247 ià(
	g_¡©ic_m­pšg
[2] ==1)

248 
ı_6_add»ss
(
wÜds0
[++
j
],(*)&
ma
);

249 ià(
	g_¡©ic_m­pšg
[3] ==1)

250 
IÁArg
().
·r£
(
wÜds0
[++
j
], 
mp
);

251 
add_m­
(
Ÿ
, 

, 
ma
, 
mp
, 
—
, 
•
, 1);

257 ià(!
BoŞArg
().
·r£
(
cÚf
[
s
], 
_dyÇmic_m­pšg
))

258 
	g”rh
->
”rÜ
("¬gum’ˆ%d should b: boŞ", 
s
);

260 ià(!
	g_dyÇmic_m­pšg
)

261  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

263 ià(!
BoŞArg
().
·r£
(
cÚf
[
s
+1], 
_dyÇmic_pÜtm­pšg
))

264 
	g”rh
->
”rÜ
("¬gum’ˆ%d should b: boŞ", 
s
+1);

266 ià(!
BoŞArg
().
·r£
(
cÚf
[
s
+2], 
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
))

267 
	g”rh
->
”rÜ
("¬gum’ˆ%d should b: boŞ", 
s
+2);

274 ià(!
	g_dyÇmic_pÜtm­pšg
)

276 
IP6Add»ss
 
	ga6
;

277 
	gi
 =3; i<(
	gcÚf
.
size
()-
	gs
); i++)

279 ià(
ı_6_add»ss
(
cÚf
[
s
+
i
], (*)&
a6
))

280 
add_m­
(
a6
, 0);

282 
	g”rh
->
”rÜ
("¬gum’ˆ%d should b: <IP6Add»ss>", 
i
);

284  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

290 
	gi
 = 3;

291 
	gVeùÜ
<
	gSŒšg
> 
	gwÜds1
;

292 
IP6Add»ss
 
	ga6
;

293 
	gpÜt_¡¬t
, 
	gpÜt_’d
;

294 
ı_¥aûvec
(
cÚf
[
s
+
i
], 
wÜds1
);

297 ià(
ı_6_add»ss
(
wÜds1
[0], (*)&
a6
è&& 
IÁArg
().
·r£
(wÜds1[1], 
pÜt_¡¬t
è&& IÁArg().·r£(wÜds1[2], 
pÜt_’d
))

299 
	g_maddr
 = 
a6
;

300 
	g_mpÜ
 = 
pÜt_¡¬t
;

301 
	g_mpÜth
 = 
pÜt_’d
;

304 
	g”rh
->
”rÜ
("¬gum’ˆ%d should b: <IP6Add»ss> <unsigÃd ch¬> <unsigÃd ch¬>", 
i
);

307  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

310 
boŞ


311 
	gAdd»ssT¿n¦©Ü
::
	$lookup
(
IP6Add»ss
 &
Ÿi
, &
i
, IP6Add»s &
mai
, &
mpi
, IP6Add»s &
—
, &
•
, 
boŞ
 
lookup_dœeùiÚ
)

314 ià(Ğ
_numb”_of_sm­
 >0 ) || (!
_dyÇmic_pÜtm­pšg
))

317 
i
=0; i<
_v
.
	`size
(); i++)

319 
boŞ
 
m©ch
 = 
Œue
;

320 ià(
_v
[
i
].
_¡©ic
)

323 ià(
_¡©ic_m­pšg
[0] && (
lookup_dœeùiÚ
 ==
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
))

324 
m©ch
 = m©ch && (
_v
[
i
].
_Ÿi
 =ğ
Ÿi
);

325 ià(
_¡©ic_m­pšg
[1] && (
lookup_dœeùiÚ
 ==
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
))

326 
m©ch
 = m©ch && (
_v
[
i
].
_i
 =ğ
i
);

327 ià(
_¡©ic_m­pšg
[0] && (
lookup_dœeùiÚ
 !ğ
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
))

328 
m©ch
 = m©ch && (
_v
[
i
].
_mai
 =ğ
mai
);

329 ià(
_¡©ic_m­pšg
[1] && (
lookup_dœeùiÚ
 !ğ
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
))

330 
m©ch
 = m©ch && (
_v
[
i
].
_mpi
 =ğ
mpi
);

332 ià(
m©ch
)

334 ià(
_¡©ic_m­pšg
[2] && (
lookup_dœeùiÚ
 =ğ
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
))

335 
mai
 = 
_v
[
i
].
_mai
;

336 ià(
_¡©ic_m­pšg
[2] && (
lookup_dœeùiÚ
 !ğ
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
))

337 
Ÿi
 = 
_v
[
i
].
_Ÿi
;

338 ià(
lookup_dœeùiÚ
 =ğ
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
)

339 
mai
 = 
Ÿi
;

340 ià(
lookup_dœeùiÚ
 !ğ
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
)

341 
Ÿi
 = 
_v
[
i
].
_Ÿi
;

343 ià(
_¡©ic_m­pšg
[3])

344 
mpi
 = 
_v
[
i
].
_mpi
;

345 ià(
lookup_dœeùiÚ
 =ğ
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
)

346 
mpi
 = 
i
;

347 ià(
lookup_dœeùiÚ
 !=
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
)

348 
i
 = 
mpi
;

349  (
Œue
);

353 ià(
_v
[
i
].
_bšdšg
)

355 ià(
lookup_dœeùiÚ
 ==0)

356 
m©ch
 = (
_v
[
i
].
_Ÿi
 =ğ
Ÿi
);

358 
m©ch
 = (
_v
[
i
].
_mai
 =ğ
mai
);

359 ià(
m©ch
)

361 ià(
lookup_dœeùiÚ
==0)

363 
mai
 = 
_v
[
i
].
_mai
;

364 
mpi
 = 
i
;

368 
Ÿi
 = 
_v
[
i
].
_Ÿi
;

369 
i
 = 
mpi
;

371  (
Œue
);

377 ià(!
_dyÇmic_m­pšg
)

378  
çl£
;

379 ià(
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
 !ğ
lookup_dœeùiÚ
)

380  
çl£
;

382 ià(!
_dyÇmic_pÜtm­pšg
)

385 
i
=0; i<
_v
.
	`size
(); i++) {

386 ià((
_v
[
i
].
_bšdšg
 =ğ
çl£
 ) && ((!_v[i].
_¡©ic
)))

388 ià(
lookup_dœeùiÚ
 == 0)

390 
_v
[
i
].
_Ÿi
 = 
Ÿi
;

391 
mai
 = 
_v
[
i
].
_mai
;

392 
mpi
 = 
i
;

396 
_v
[
i
].
_mai
 = 
mai
;

397 
Ÿi
 = 
_v
[
i
].
_Ÿi
;

398 
i
 = 
mpi
;

401 
_v
[
i
].
_bšdšg
 = 
Œue
;

405  (
Œue
);

410  
çl£
;

415 
IP6FlowID
 
fd
;

417 ià(
lookup_dœeùiÚ
 ==0)

419 
fd
 = 
	`IP6FlowID
(
Ÿi
, 
i
, 
—
, 
•
);

420 
M­pšg
 *
m
 = 
_out_m­
.
	`fšd
(
fd
);

421 ià(
m
) {

422 
mai
 = 
m
->
	`æow_id
().
	`§ddr
();

423 
mpi
 = 
m
->
	`æow_id
().
	`¥Üt
();

424  
Œue
;

429 
fd
 = 
	`IP6FlowID
(
—
, 
•
, 
mai
, 
mpi
);

430 
M­pšg
 *
m
 = 
_š_m­
.
	`fšd
(
fd
);

431 ià(
m
) {

432 
Ÿi
 = 
m
->
	`æow_id
().
	`daddr
();

433 
i
 = 
m
->
	`æow_id
().
	`dpÜt
();

434  
Œue
;

439 ià(
lookup_dœeùiÚ
 !ğ
_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
 )

440  
çl£
;

446 
Ãw_mpÜt
 = 0;

447 
Ãw_mpÜt
 = 
	`fšd_mpÜt
();

450 ià(!
Ãw_mpÜt
) {

451 
	`şick_ch©‹r
("AddressTranslator„an out of…orts");

452  
çl£
;

455 ià(
lookup_dœeùiÚ
 == 0)

457 
mpi
 = 
Ãw_mpÜt
;

458 
mai
 = 
_maddr
;

462 
i
 = 
Ãw_mpÜt
;

463 
Ÿi
 = 
_maddr
;

466 
IP6FlowID
 
Üig_out_æow
 = 
	`IP6FlowID
(
Ÿi
, 
i
, 
—
, 
•
);

467 
IP6FlowID
 
Üig_š_æow
 = 
	`IP6FlowID
(
—
, 
•
, 
mai
, 
mpi
);

468 
IP6FlowID
 
Ãw_out_æow
 = 
	`IP6FlowID
(
mai
, 
mpi
, 
—
, 
•
);

469 
IP6FlowID
 
Ãw_š_æow
 = 
	`IP6FlowID
(
—
, 
•
, 
Ÿi
, 
i
);

470 
M­pšg
 *
out_m­pšg
 = 
Ãw
 Mapping;

471 
out_m­pšg
->
	`š™Ÿlize
(
Ãw_out_æow
);

472 
M­pšg
 *
š_m­pšg
 = 
Ãw
 Mapping;

473 
š_m­pšg
->
	`š™Ÿlize
(
Ãw_š_æow
);

474 ià(
lookup_dœeùiÚ
 == 0)

476 ià(
mpi
==
_mpÜ
)

478 
_rov”
 = 
out_m­pšg
;

479 
_rov”
->
	`£t_Ãxt
(_rover);

480 
_rov”2
ğ
š_m­pšg
;

481 
_rov”2
->
	`£t_Ãxt
(_rover2);

485 
out_m­pšg
->
	`£t_Ãxt
(
_rov”
->
	`g‘_Ãxt
());

486 
_rov”
->
	`£t_Ãxt
(
out_m­pšg
);

487 
_rov”
 = 
out_m­pšg
;

488 
š_m­pšg
->
	`£t_Ãxt
(
_rov”2
->
	`g‘_Ãxt
());

489 
_rov”2
->
	`£t_Ãxt
(
š_m­pšg
);

490 
_rov”2
 = 
š_m­pšg
;

495 ià(
i
 =ğ
_mpÜ
)

497 
_rov”
 = 
š_m­pšg
;

498 
_rov”
->
	`£t_Ãxt
(_rover);

499 
_rov”2
 = 
out_m­pšg
;

500 
_rov”2
->
	`£t_Ãxt
(_rover2);

504 
š_m­pšg
->
	`£t_Ãxt
(
_rov”
->
	`g‘_Ãxt
());

505 
_rov”
->
	`£t_Ãxt
(
š_m­pšg
);

506 
_rov”
 = 
š_m­pšg
;

507 
out_m­pšg
->
	`£t_Ãxt
(
_rov”2
->
	`g‘_Ãxt
());

508 
_rov”2
->
	`£t_Ãxt
(
out_m­pšg
);

509 
_rov”2
 = 
out_m­pšg
;

513 
_out_m­
.
	`š£¹
(
Üig_out_æow
, 
out_m­pšg
);

514 
_š_m­
.
	`š£¹
(
Üig_š_æow
, 
š_m­pšg
);

515 
_nm­pšgs
++;

516 
_nm­pšgs2
++;

517  
Œue
;

519 
	}
}

523 
	gAdd»ssT¿n¦©Ü
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

525 ià(
pÜt
 == 0)

526 
	`hªdË_outw¬d
(
p
);

528 
	`hªdË_šw¬d
(
p
);

529 
	}
}

534 
	gAdd»ssT¿n¦©Ü
::
	$hªdË_outw¬d
(
Pack‘
 *
p
)

536 
şick_6
 *
6
 = (şick_6 *)
p
->
	`d©a
();

537 *
¡¬t
 = (*)
p
->
	`d©a
();

538 
IP6Add»ss
 
6_¤c
 = 
	`IP6Add»ss
(
6
->ip6_src);

539 
IP6Add»ss
 
6_m¤c
;

540 
IP6Add»ss
 
6_d¡
 = 
	`IP6Add»ss
(
6
->ip6_dst);

541 
ušt16_t
 
¥Üt
;

542 
ušt16_t
 
dpÜt
;

543 
ušt16_t
 
mpÜt
;

545 
Wr™abËPack‘
 *
q
ğ
Pack‘
::
	`make
(
p
->
	`Ëngth
());

546 ià(
q
==0) {

547 
	`şick_ch©‹r
("can‚ot make…acket!");

548 
	`as£¹
(0);

554 *
¡¬t_Ãw
 = (*)
q
->
	`d©a
();

555 
	`mem£t
(
q
->
	`d©a
(), '\0', q->
	`Ëngth
());

556 
	`memıy
(
¡¬t_Ãw
, 
¡¬t
, 
p
->
	`Ëngth
());

557 
şick_6
 *
6_Ãw
 = (şick_6 * )
q
->
	`d©a
();

559 ià(
6_Ãw
->
6_nxt
 ==0x3a)

562 * 
icmp6_¡¬t
 = (*)(
6_Ãw
 +1);

563 ià(
	`lookup
(
6_¤c
, 
dpÜt
, 
6_m¤c
, 
mpÜt
, 
6_d¡
, 
¥Üt
, 0))

566 
6_Ãw
->
6_¤c
 = 
6_m¤c
;

567 
icmp6_¡¬t
[0]) {

572 
şick_icmp6_echo
 * 
icmp6
 = (şick_icmp6_echØ*è(
6_Ãw
+1);

573 
icmp6
->
icmp6_cksum
=0;

574 
icmp6
->
icmp6_cksum
ğ
	`htÚs
(
	`š6_ç¡_cksum
(&
6_Ãw
->
6_¤c
, &6_Ãw->
6_d¡
, ip6_Ãw->
6_¶’
, 0x3a, 0, (*)icmp6, ip6_new->ip6_plen));

578 
şick_icmp6_pk‰oobig
 * 
icmp6
 = (şick_icmp6_pk‰oobig *)(
6_Ãw
 +1);

579 
icmp6
->
icmp6_cksum
=0;

580 
icmp6
->
icmp6_cksum
ğ
	`htÚs
(
	`š6_ç¡_cksum
(&
6_Ãw
->
6_¤c
, &6_Ãw->
6_d¡
, ip6_Ãw->
6_¶’
, 0x3a, 0, (*)icmp6, ip6_new->ip6_plen));

584 
şick_icmp6_·¿m´ob
 * 
icmp6
 = (şick_icmp6_·¿m´ob *)(
6_Ãw
 +1);

585 
icmp6
->
icmp6_cksum
=0;

586 
icmp6
->
icmp6_cksum
ğ
	`htÚs
(
	`š6_ç¡_cksum
(&
6_Ãw
->
6_¤c
, &6_Ãw->
6_d¡
, ip6_Ãw->
6_¶’
, 0x3a, 0, (*)icmp6, ip6_new->ip6_plen));

592 
p
->
	`kl
();

593 
	`ouut
(0).
	`push
(
q
);

598 
p
->
	`kl
();

603 ià(
6_Ãw
->
6_nxt
 ==0x6)

605 
şick_tı
 *
tı_Ãw
 = (şick_tı *)(
6_Ãw
+1);

606 
¥Üt
 = 
	`Áohs
(
tı_Ãw
->
th_¥Üt
);

607 
dpÜt
 = 
	`Áohs
(
tı_Ãw
->
th_dpÜt
);

609 ià(
	`lookup
(
6_¤c
, 
¥Üt
, 
6_m¤c
, 
mpÜt
, 
6_d¡
, 
dpÜt
, 0))

611 
6_Ãw
->
6_¤c
 = 
6_m¤c
;

612 
tı_Ãw
->
th_¥Üt
 = 
	`htÚs
(
mpÜt
);

614 
tı_Ãw
->
th_sum
 = 0;

615 
tı_Ãw
->
th_sum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6_Ãw
->
6_¤c
, &6_Ãw->
6_d¡
, ip6_Ãw->
6_¶’
, ip6_Ãw->
6_nxt
,cp_new->th_sum, (*)tcp_new, ip6_new->ip6_plen));

616 
p
->
	`kl
();

617 
	`ouut
(0).
	`push
(
q
);

622 
p
->
	`kl
();

626 ià(
6_Ãw
->
6_nxt
 ==0x11)

628 
şick_udp
 *
udp_Ãw
 = (şick_ud°*)(
6_Ãw
+1);

629 
¥Üt
 = 
	`Áohs
(
udp_Ãw
->
uh_¥Üt
);

630 
dpÜt
 = 
	`Áohs
(
udp_Ãw
->
uh_dpÜt
);

632 ià(
	`lookup
(
6_¤c
, 
¥Üt
, 
6_m¤c
, 
mpÜt
, 
6_d¡
, 
dpÜt
, 0))

634 
6_Ãw
->
6_¤c
 = 
6_m¤c
;

635 
udp_Ãw
->
uh_¥Üt
 = 
	`htÚs
(
mpÜt
);

637 
udp_Ãw
->
uh_sum
 = 0;

638 
udp_Ãw
->
uh_sum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6_Ãw
->
6_¤c
, &6_Ãw->
6_d¡
, ip6_Ãw->
6_¶’
, ip6_Ãw->
6_nxt
, udp_new->uh_sum, (*)udp_new, ip6_new->ip6_plen));

639 
p
->
	`kl
();

640 
	`ouut
(0).
	`push
(
q
);

645 
p
->
	`kl
();

651 
	`şick_ch©‹r
(" discardhe…acket,…rotocol unrecognized");

652 
p
->
	`kl
();

655 
	}
}

658 
	gAdd»ssT¿n¦©Ü
::
	$hªdË_šw¬d
(
Pack‘
 *
p
)

660 
şick_6
 *
6
 = (şick_6 *)
p
->
	`d©a
();

661 *
¡¬t
 = (*)
p
->
	`d©a
();

662 
IP6Add»ss
 
6_¤c
 = 
	`IP6Add»ss
(
6
->ip6_src);

663 
IP6Add»ss
 
6_md¡
 = 
	`IP6Add»ss
(
6
->
6_d¡
);

664 
IP6Add»ss
 
6_d¡
 ;

665 
ušt16_t
 
¥Üt
;

666 
ušt16_t
 
mpÜt
;

667 
ušt16_t
 
dpÜt
;

670 
Wr™abËPack‘
 *
q
ğ
Pack‘
::
	`make
(
p
->
	`Ëngth
());

671 ià(
q
==0) {

672 
	`şick_ch©‹r
("can‚ot make…acket!");

673 
	`as£¹
(0);

679 *
¡¬t_Ãw
 = (*)
q
->
	`d©a
();

680 
	`mem£t
(
q
->
	`d©a
(), '\0', q->
	`Ëngth
());

681 
	`memıy
(
¡¬t_Ãw
, 
¡¬t
, 
p
->
	`Ëngth
());

682 
şick_6
 *
6_Ãw
 = (şick_6 * )
q
->
	`d©a
();

684 ià(
6_Ãw
->
6_nxt
 ==0x3a)

687 * 
icmp6_¡¬t
 = (*)(
6_Ãw
 +1);

690 ià(
	`lookup
(
6_d¡
, 
dpÜt
, 
6_md¡
, 
mpÜt
, 
6_¤c
, 
¥Üt
, 1))

692 
6_Ãw
->
6_d¡
 = ip6_dst;

693 
icmp6_¡¬t
[0]) {

698 
şick_icmp6_echo
 * 
icmp6
 = (şick_icmp6_echØ*)(
6_Ãw
 +1);

699 
icmp6
->
icmp6_cksum
 = 0;

700 
icmp6
->
icmp6_cksum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6_Ãw
->
6_¤c
, &6_Ãw->
6_d¡
, ip6_Ãw->
6_¶’
, 0x3a, 0, (*)icmp6, ip6_new->ip6_plen));

704 
şick_icmp6_pk‰oobig
 * 
icmp6
 = (şick_icmp6_pk‰oobig *)(
6_Ãw
 +1);

705 
icmp6
->
icmp6_cksum
 = 0;

706 
icmp6
->
icmp6_cksum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6_Ãw
->
6_¤c
, &6_Ãw->
6_d¡
, ip6_Ãw->
6_¶’
, 0x3a, 0, (*)icmp6, ip6_new->ip6_plen));

710 
şick_icmp6_·¿m´ob
 * 
icmp6
 = (şick_icmp6_·¿m´ob *)(
6_Ãw
 +1);

711 
icmp6
->
icmp6_cksum
 = 0;

712 
icmp6
->
icmp6_cksum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6_Ãw
->
6_¤c
, &6_Ãw->
6_d¡
, ip6_Ãw->
6_¶’
, 0x3a, 0, (*)icmp6, ip6_new->ip6_plen));

718 
p
->
	`kl
();

719 
	`ouut
(1).
	`push
(
q
);

724 
p
->
	`kl
();

729 ià(
6_Ãw
->
6_nxt
 ==0x6)

731 
şick_tı
 *
tı_Ãw
 = (şick_tı *)(
6_Ãw
+1);

732 
¥Üt
 = 
	`Áohs
(
tı_Ãw
->
th_¥Üt
);

733 
mpÜt
 = 
	`Áohs
(
tı_Ãw
->
th_dpÜt
);

734 ià(
	`lookup
(
6_d¡
, 
dpÜt
,
6_md¡
, 
mpÜt
, 
6_¤c
, 
¥Üt
, 1))

736 
6_Ãw
->
6_d¡
 = ip6_dst;

737 
tı_Ãw
->
th_dpÜt
 = 
	`htÚs
(
dpÜt
);

739 
tı_Ãw
->
th_sum
 = 0;

740 
tı_Ãw
->
th_sum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6_Ãw
->
6_¤c
, &6_Ãw->
6_d¡
, ip6_Ãw->
6_¶’
, ip6_Ãw->
6_nxt
,cp_new->th_sum, (*)tcp_new, ip6_new->ip6_plen));

743 
p
->
	`kl
();

744 
	`ouut
(1).
	`push
(
q
);

749 
p
->
	`kl
();

754 ià(
6_Ãw
->
6_nxt
 ==0x11)

756 
şick_udp
 *
udp_Ãw
 = (şick_ud°*)(
6_Ãw
+1);

757 
¥Üt
 = 
	`Áohs
(
udp_Ãw
->
uh_¥Üt
);

758 
mpÜt
 = 
	`Áohs
(
udp_Ãw
->
uh_dpÜt
);

759 ià(
	`lookup
(
6_d¡
, 
dpÜt
,
6_md¡
, 
mpÜt
, 
6_¤c
, 
¥Üt
, 1))

761 
6_Ãw
->
6_d¡
 = ip6_dst;

762 
udp_Ãw
->
uh_dpÜt
 = 
	`htÚs
(
dpÜt
);

764 
udp_Ãw
->
uh_sum
 = 0;

765 
udp_Ãw
->
uh_sum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6_Ãw
->
6_¤c
, &6_Ãw->
6_d¡
, ip6_Ãw->
6_¶’
, ip6_Ãw->
6_nxt
, udp_new->uh_sum, (*)udp_new, ip6_new->ip6_plen));

767 
p
->
	`kl
();

768 
	`ouut
(1).
	`push
(
q
);

773 
p
->
	`kl
();

779 
	`şick_ch©‹r
(" discardhe…acket,…rotocol unrecognized");

780 
p
->
	`kl
();

782 
	}
}

784 
	$EXPORT_ELEMENT
(
Add»ssT¿n¦©Ü
)

785 
CLICK_ENDDECLS


	@ip6/addresstranslator.hh

1 #iâdeà
CLICK_ADDRESSTRANSLATOR_HH


2 
	#CLICK_ADDRESSTRANSLATOR_HH


	)

3 
	~<şick/6add»ss.hh
>

4 
	~<şick/add»ss.hh
>

5 
	~<şick/veùÜ.hh
>

6 
	~<şick/–em’t.hh
>

7 
	~<şick/bighashm­.hh
>

8 
	~<şick/6æowid.hh
>

9 
CLICK_DECLS


68 şas 
	cAdd»ssT¿n¦©Ü
 : 
public
 
EËm’t
 {

70 
public
:

72 
şass
 
M­pšg
;

74 
	$Add»ssT¿n¦©Ü
(è
CLICK_COLD
;

75 ~
	$Add»ssT¿n¦©Ü
(è
CLICK_COLD
;

77 cÚ¡ *
	$şass_Çme
() const {  "AddressTranslator"; }

78 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/2"; 
	}
}

79 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

80 
push
(
pÜt
, 
Pack‘
 *
p
);

81 
add_m­
(
IP6Add»ss
 &
mai
, 
boŞ
 
bšdšg
);

82 
add_m­
(
IP6Add»ss
 &
Ÿi
, 
i
, IP6Add»s &
mai
, 
mpi
, IP6Add»s &
—
, 
•
, 
boŞ
 
bšdšg
);

83 
hªdË_outw¬d
(
Pack‘
 *
p
);

84 
hªdË_šw¬d
(
Pack‘
 *
p
);

86 
boŞ
 
lookup
(
IP6Add»ss
 &, &, IP6Address &, &, IP6Address &, &, bool);

87 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

89 
´Ùeùed
:

91 
	sEÁryM­
 {

92 
IP6Add»ss
 
_Ÿi
;

93 
_i
;

94 
IP6Add»ss
 
_mai
;

95 
_mpi
;

96 
IP6Add»ss
 
_—
;

97 
_•
;

103 
boŞ
 
_bšdšg
;

104 
boŞ
 
_¡©ic
;

105 
	}
};

106 
	gVeùÜ
<
	gEÁryM­
> 
	g_v
;

109 
	g_numb”_of_sm­
;

110 
boŞ
 
	g_¡©ic_pÜtm­pšg
;

111 
boŞ
 
	g_dyÇmic_m­pšg
;

112 
boŞ
 
	g_dyÇmic_pÜtm­pšg
;

113 
boŞ
 
	g_dyÇmic_m­pšg_®loÿtiÚ_dœeùiÚ
;

118 
boŞ
 
	g_¡©ic_m­pšg
[6];

122 
	gHashM­
<
	tIP6FlowID
, 
	tM­pšg
 *> 
	tM­6
;

123 
ş—n_m­
(
M­6
 &, 
boŞ
);

124 
fšd_mpÜt
( );

125 
m­pšg_ä“d
(
M­pšg
 *, 
boŞ
);

127 
M­6
 
	g_š_m­
;

128 
M­6
 
	g_out_m­
;

129 
IP6Add»ss
 
	g_maddr
;

130 
	g_mpÜ
, 
	g_mpÜth
;

131 
M­pšg
 *
	g_rov”
;

132 
M­pšg
 *
	g_rov”2
;

133 
	g_nm­pšgs
;

134 
	g_nm­pšgs2
;

138 şas 
	cAdd»ssT¿n¦©Ü
::
M­pšg
 {

140 
public
:

142 
	$M­pšg
(è
CLICK_COLD
;

143 
	$š™Ÿlize
(cÚ¡ 
IP6FlowID
 & 
Ãw_æow
è{ 
_m­to
 =‚ew_flow; }

144 cÚ¡ 
IP6FlowID
 &
	$æow_id
(ècÚ¡ {  
_m­to
; 
	}
}

145 
	$¥Üt
(ècÚ¡ {  
_m­to
.
	`¥Üt
(); 
	}
}

146 
	$dpÜt
(ècÚ¡ {  
_m­to
.
	`dpÜt
(); 
	}
}

148 
M­pšg
 * 
	$g‘_Ãxt
(è{  
_Ãxt
; 
	}
}

149 
M­pšg
 * 
	$g‘_´ev
(è{  
_´ev
; 
	}
}

150 
	$£t_Ãxt
(
M­pšg
 * 
Ãxt
è{ 
_Ãxt
 =‚ext; 
	}
}

151 
	$£t_´ev
(
M­pšg
 * 
´ev
è{ 
_´ev
 =…»v; 
	}
}

152 
M­pšg
 *
	$ä“_Ãxt
(ècÚ¡ {  
_ä“_Ãxt
; 
	}
}

153 
	$£t_ä“_Ãxt
(
M­pšg
 *
m
è{
_ä“_Ãxt
 = m;
	}
}

156 
	g´Ùeùed
:

158 
IP6FlowID
 
_m­to
;

159 
M­pšg
 *
	g_´ev
;

160 
M­pšg
 *
	g_Ãxt
;

161 
M­pšg
 *
	g_ä“_Ãxt
;

163 
ä›nd
 
şass
 
	gAdd»ssT¿n¦©Ü
;

166 
	gCLICK_ENDDECLS


	@ip6/checkip6header.cc

19 
	~<şick/cÚfig.h
>

20 
	~"check6h—d”.hh
"

21 
	~<şickÃt/6.h
>

22 
	~<şick/6add»ss.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

27 
CLICK_DECLS


29 
	gCheckIP6H—d”
::
	$CheckIP6H—d”
()

30 : 
	`_bad_¤c
(0), 
	$_drİs
(0)

32 
	}
}

34 
	gCheckIP6H—d”
::~
	$CheckIP6H—d”
()

36 
d–‘e
[] 
_bad_¤c
;

37 
	}
}

40 
	gCheckIP6H—d”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

42 
SŒšg
 
	gbadaddrs
 = SŒšg::
make_em±y
();

43 
	g_off£t
 = 0;

44 
	gVeùÜ
<
	gSŒšg
> 
	gs
;

46 
	gs
.
push_back
("ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff");

48 ià(
Args
(
cÚf
, 
this
, 
”rh
)

49 .
»ad_p
("BADADDRS", 
badaddrs
)

50 .
»ad_p
("OFFSET", 
_off£t
)

51 .
com¶‘e
() < 0)

54 ià(
	gbadaddrs
) {

55 
	gVeùÜ
<
	gSŒšg
> 
	gwÜds
;

56 
ı_¥aûvec
(
badaddrs
, 
wÜds
);

57 
IP6Add»ss
 
	ga
;

58 
	gj
 = 0; j < 
	gwÜds
.
size
(); j++) {

59 ià(!
ı_6_add»ss
(
wÜds
[
j
], (*)&
a
)) {

60  
	g”rh
->
”rÜ
("expects IP6ADDRESS -a ");

62 
	gj
 = 0; j < 
	gs
.
size
(); j++) {

63 
IP6Add»ss
 
	gb
 = IP6Add»ss(
s
[
j
]);

64 ià(
	gb
 =ğ
a
)

65 
»³©
;

67 
	gs
.
push_back
(
a
.
s
());

68 
	g»³©
: ;

72 
	g_n_bad_¤c
 = 
s
.
size
();

73 
	g_bad_¤c
 = 
Ãw
 
IP6Add»ss
 [
_n_bad_¤c
];

75 
	gi
 = 0; i<
	g_n_bad_¤c
; i++) {

76 
	g_bad_¤c
[
i
]ğ
IP6Add»ss
(
s
[i]);

83 
	gCheckIP6H—d”
::
	$drİ_™
(
Pack‘
 *
p
)

85 ià(
_drİs
 == 0)

86 
	`şick_ch©‹r
("IP6 header check failed");

87 
_drİs
++;

89 ià(
	`nouuts
() == 2)

90 
	`ouut
(1).
	`push
(
p
);

92 
p
->
	`kl
();

93 
	}
}

95 
Pack‘
 *

96 
	gCheckIP6H—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

98 cÚ¡ 
şick_6
 *

 = 
»š‹½»t_ÿ¡
 <cÚ¡ click_6 *>Ğ
p
->
	`d©a
(è+ 
_off£t
);

99 
¶’
 = 
p
->
	`Ëngth
(è- 
_off£t
;

100 
şass
 
IP6Add»ss
 
¤c
;

104 if(()
¶’
 < ()(
şick_6
))

105 
bad
;

108 if(

->
6_v
 != 6)

109 
bad
;

112 if(
	`Áohs
(

->
6_¶’
è> (
¶’
-40))

113 
bad
;

120 
¤c
=

->
6_¤c
;

121 
i
 = 0; i < 
_n_bad_¤c
; i++) {

122 if(
¤c
 =ğ
_bad_¤c
[
i
])

123 
bad
;

133 
p
->
	`£t_6_h—d”
(

);

136 if(
	`Áohs
(

->
6_¶’
è< (
¶’
-40))

137 
p
->
	`ke
(
¶’
 - 40 - 

->
6_¶’
);

138 (
p
);

140 
bad
:

141 
	`drİ_™
(
p
);

143 
	}
}

146 
SŒšg


147 
	$CheckIP6H—d”_»ad_drİs
(
EËm’t
 *
xf
, *)

149 
CheckIP6H—d”
 *
f
 = (CheckIP6H—d” *)
xf
;

150  
	`SŒšg
(
f
->
	`drİs
());

151 
	}
}

154 
	gCheckIP6H—d”
::
	$add_hªdËrs
()

156 
	`add_»ad_hªdËr
("drİs", 
CheckIP6H—d”_»ad_drİs
);

157 
	}
}

159 
CLICK_ENDDECLS


160 
EXPORT_ELEMENT
(
CheckIP6H—d”
)

	@ip6/checkip6header.hh

1 #iâdeà
CLICK_CHECKIP6HEADER_HH


2 
	#CLICK_CHECKIP6HEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


40 şas 
	cCheckIP6H—d”
 : 
public
 
EËm’t
 {

42 
_off£t
;

44 
	m_n_bad_¤c
;

45 
IP6Add»ss
 *
	m_bad_¤c
;

46 #ifdeà
CLICK_LINUXMODULE


47 
boŞ
 
	m_®igÃd
;

49 
	m_drİs
;

51 
	mpublic
:

53 
CheckIP6H—d”
();

54 ~
CheckIP6H—d”
();

56 cÚ¡ *
	$şass_Çme
() const {  "CheckIP6Header"; }

57 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

58 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

60 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

62 
	$drİs
(ècÚ¡ {  
_drİs
; 
	}
}

65 
	$add_hªdËrs
(è
CLICK_COLD
;

67 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

68 
	`drİ_™
(
Pack‘
 *);

71 
	}
};

73 
	gCLICK_ENDDECLS


	@ip6/decip6hlim.cc

18 
	~<şick/cÚfig.h
>

19 
	~"dec6hlim.hh
"

20 
	~<şickÃt/6.h
>

21 
	~<şick/glue.hh
>

22 
CLICK_DECLS


24 
	gDecIP6HLIM
::
	$DecIP6HLIM
()

25 : 
	$_drİs
(0)

27 
	}
}

29 
DecIP6HLIM
::~
	$DecIP6HLIM
()

31 
	}
}

34 
DecIP6HLIM
::
	$drİ_™
(
Pack‘
 *
p
)

36 
_drİs
++;

37 ià(
	`nouuts
() == 2)

38 
	`ouut
(1).
	`push
(
p
);

40 
p
->
	`kl
();

41 
	}
}

43 
šlše
 
Pack‘
 *

44 
	gDecIP6HLIM
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

46 
	`as£¹
(
p_š
->
	`has_ÃtwÜk_h—d”
());

47 cÚ¡ 
şick_6
 *
_š
 = 
p_š
->
	`6_h—d”
();

49 ià(
_š
->
6_hlim
 <= 1) {

50 
	`drİ_™
(
p_š
);

53 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

54 
şick_6
 *

 = 
p
->
	`6_h—d”
();

55 

->
6_hlim
--;

56  
p
;

58 
	}
}

60 
SŒšg


61 
	$DecIP6HLIM_»ad_drİs
(
EËm’t
 *
xf
, *)

63 
DecIP6HLIM
 *
f
 = (DecIP6HLIM *)
xf
;

64  
	`SŒšg
(
f
->
	`drİs
());

65 
	}
}

68 
	gDecIP6HLIM
::
	$add_hªdËrs
()

70 
	`add_»ad_hªdËr
("drİs", 
DecIP6HLIM_»ad_drİs
);

71 
	}
}

73 
CLICK_ENDDECLS


74 
EXPORT_ELEMENT
(
DecIP6HLIM
)

	@ip6/decip6hlim.hh

1 #iâdeà
CLICK_DECIP6HLIM_HH


2 
	#CLICK_DECIP6HLIM_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


31 şas 
	cDecIP6HLIM
 : 
public
 
EËm’t
 {

33 
_drİs
;

35 
	mpublic
:

37 
DecIP6HLIM
();

38 ~
DecIP6HLIM
();

40 cÚ¡ *
	$şass_Çme
() const {  "DecIP6HLIM"; }

41 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

42 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

44 
	$drİs
(è{  
_drİs
; 
	}
}

46 
	$add_hªdËrs
(è
CLICK_COLD
;

48 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

49 
	`drİ_™
(
Pack‘
 *);

51 
	}
};

53 
	gCLICK_ENDDECLS


	@ip6/getip6address.cc

19 
	~<şick/cÚfig.h
>

20 
	~"g‘6add»ss.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şickÃt/6.h
>

24 
CLICK_DECLS


26 
	gG‘IP6Add»ss
::
	$G‘IP6Add»ss
()

28 
	}
}

30 
G‘IP6Add»ss
::~
	$G‘IP6Add»ss
()

32 
	}
}

36 
G‘IP6Add»ss
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

38  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("OFFSET", 
_off£t
).
com¶‘e
();

41 
Pack‘
 *

42 
	gG‘IP6Add»ss
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

45 
IP6Add»ss
 
d¡
=
	`IP6Add»ss
((*)(
p
->
	`d©a
()+ 
_off£t
));

46 
	`SET_DST_IP6_ANNO
(
p
, 
d¡
);

47  
p
;

48 
	}
}

50 
CLICK_ENDDECLS


51 
EXPORT_ELEMENT
(
G‘IP6Add»ss
)

	@ip6/getip6address.hh

1 #iâdeà
CLICK_GETIP6ADDRESS_HH


2 
	#CLICK_GETIP6ADDRESS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/6add»ss.hh
>

5 
CLICK_DECLS


25 şas 
	cG‘IP6Add»ss
 : 
public
 
EËm’t
 {

27 
_off£t
;

29 
	mpublic
:

31 
G‘IP6Add»ss
();

32 ~
G‘IP6Add»ss
();

34 cÚ¡ *
	$şass_Çme
() const {  "GetIP6Address"; }

35 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

37 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

39 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

43 
	gCLICK_ENDDECLS


	@ip6/icmp6error.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şickÃt/icmp6.h
>

20 
	~<şickÃt/6.h
>

21 
	~<şickÃt/.h
>

22 
	~"icmp6”rÜ.hh
"

23 
	~<şick/6add»ss.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/glue.hh
>

27 
	~<şick/·ck‘_ªno.hh
>

28 
CLICK_DECLS


30 
	gICMP6E¼Ü
::
	$ICMP6E¼Ü
()

32 
_code
 = 
_ty³
 = -1;

33 
	}
}

35 
	gICMP6E¼Ü
::~
	$ICMP6E¼Ü
()

37 
	}
}

40 
ICMP6E¼Ü
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

42  
Args
(
cÚf
, 
this
, 
”rh
)

43 .
»ad_mp
("SRC", 
_¤c_
)

44 .
»ad_mp
("TYPE", 
_ty³
)

45 .
»ad_mp
("CODE", 
_code
)

46 .
com¶‘e
();

49 
boŞ


50 
	gICMP6E¼Ü
::
	$is_”rÜ_ty³
(
ty³
)

52  (
ty³
 =ğ
ICMP6_UNREACH


53 || 
ty³
 =ğ
ICMP6_PKTTOOBIG


54 || 
ty³
 =ğ
ICMP6_TIMXCEED


55 || 
ty³
 =ğ
ICMP6_PARAMPROB
);

56 
	}
}

58 
boŞ


59 
	gICMP6E¼Ü
::
	$is_»dœeù_ty³
(
ty³
)

61  (
ty³
 =ğ
ICMP6_REDIRECT
);

62 
	}
}

65 
	gICMP6E¼Ü
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

67 ià(
_ty³
 < 0 || 
_code
 < 0 || (
_¤c_
 =ğ
	`IP6Add»ss
()))

68  
”rh
->
	`”rÜ
("not configured -a");

69 ià(!
	`is_”rÜ_ty³
(
_ty³
è&& !
	`is_»dœeù_ty³
(_type))

70  
”rh
->
	`”rÜ
("ICMP6y³ %d i nÙ‡À”rÜ o¸»dœeùy³", 
_ty³
);

72 
	}
}

80 
boŞ


81 
	gICMP6E¼Ü
::
	$uniÿ¡
(cÚ¡ 
IP6Add»ss
 &
¯
)

83 cÚ¡ *
a
 = 
¯
.
	`d©a
();

84 ià(
a
[0]== 0xff)

87 
	}
}

95 
boŞ


96 
	gICMP6E¼Ü
::
	$v®id_sourû
(cÚ¡ 
IP6Add»ss
 &
¯
)

103 if(
	`uniÿ¡
(
¯
) == 0)

113 if(
¯
 =ğ
	`IP6Add»ss
("::1"))

117 
	}
}

124 
boŞ


125 
	gICMP6E¼Ü
::
	$has_rou‹_İt
(cÚ¡ 
şick_6
 *)

128 
	}
}

131 
Pack‘
 *

132 
	gICMP6E¼Ü
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

134 
Wr™abËPack‘
 *
q
 = 0;

135 cÚ¡ 
şick_6
 *
p
 = 
p
->
	`6_h—d”
();

136 
şick_6
 *
n
;

137 
şick_icmp6
 *
iı
;

138 
xËn
;

141 ià(!
p
->
	`has_ÃtwÜk_h—d”
())

142 
out
;

148 if(
p
->
6_nxt
 =ğ
IP_PROTO_ICMP6
) {

149 
iı
 = (
şick_icmp6
 *è((*)
p
);

150 ifĞ
	`is_”rÜ_ty³
(
iı
->
icmp6_ty³
))

151 
out
;

155 if(
	`uniÿ¡
(
	`IP6Add»ss
(
p
->
6_d¡
)) == 0)

156 
out
;

159 ià(
p
->
	`·ck‘_ty³_ªno
(è=ğ
Pack‘
::
BROADCAST
 ||…->·ck‘_ty³_ªno(è=ğPack‘::
MULTICAST
)

160 
out
;

165 
xËn
 = 
p
->
	`Ëngth
();

166 ià(
xËn
 > 568)

167 
xËn
 = 568;

169 ià(
_ty³
 !ğ
ICMP6_REDIRECT
)

170 
q
 = 
Pack‘
::
	`make
((
şick_6
è+ (
şick_icmp6
è+ 
xËn
);

172 
q
 = 
Pack‘
::
	`make
((
şick_6
è+ (
şick_icmp6_»dœeù
è+ 
xËn
);

175 
	`mem£t
(
q
->
	`d©a
(), '\0', q->
	`Ëngth
());

178 
n
 = (
şick_6
 *è
q
->
	`d©a
();

179 
n
->
6_æow
 = 0;

180 
n
->
6_v
 = 6;

181 
n
->
6_¶’
 = 
	`htÚs
(
q
->
	`Ëngth
()-40);

182 
n
->
6_nxt
 = 
IP_PROTO_ICMP6
;

183 
n
->
6_hlim
 = 0xff;

184 
n
->
6_¤c
 = 
_¤c_
;

185 
n
->
6_d¡
 = 
p
->
6_¤c
;

188 
iı
 = (
şick_icmp6
 *è(
n
 + 1);

189 
iı
->
icmp6_ty³
 = 
_ty³
;

190 
iı
->
icmp6_code
 = 
_code
;

193 if(
_ty³
 =ğ
ICMP6_PKTTOOBIG
 && 
_code
 == 0){

195 ((
şick_icmp6_pk‰oobig
 *)
iı
)->
icmp6_mtusize
 = 1500;

198 if(
_ty³
 =ğ4 && 
_code
 == 0){

200 ((
şick_icmp6_·¿m´ob
 *è
iı
)->
icmp6_poš‹r
 = 
	`ICMP_PARAMPROB_ANNO
(
p
);

205 ià(
_ty³
 =ğ
ICMP6_REDIRECT
 && 
_code
 == 0) {

206 
şick_icmp6_»dœeù
 *
iır
 = (şick_icmp6_»dœeù *è(
n
 + 1);

207 
iır
->
icmp6_rg‘
 = 
	`DST_IP6_ANNO
(
p
);

208 
iır
->
icmp6_d¡
 = 
p
->
6_d¡
;

209 
	`memıy
((*)(
iır
 + 1), 
p
->
	`d©a
(), 
xËn
);

211 
	`memıy
((*)(
iı
 + 1), 
p
->
	`d©a
(), 
xËn
);

213 
iı
->
icmp6_cksum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
n
->
6_¤c
, &n->
6_d¡
,‚->
6_¶’
,‚->
6_nxt
, 0, (*)icp,‚ip->ip6_plen));

215 
	`SET_DST_IP6_ANNO
(
q
, 
	`IP6Add»ss
(
n
->
6_d¡
));

216 
	`SET_FIX_IP_SRC_ANNO
(
q
, 1);

217 
q
->
	`£t_6_h—d”
(
n
, (
şick_6
));

219 
out
:

220 
p
->
	`kl
();

221 (
q
);

222 
	}
}

224 
CLICK_ENDDECLS


225 
EXPORT_ELEMENT
(
ICMP6E¼Ü
)

	@ip6/icmp6error.hh

1 #iâdeà
CLICK_ICMP6ERROR_HH


2 
	#CLICK_ICMP6ERROR_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/6add»ss.hh
>

5 
CLICK_DECLS


52 şas 
	cICMP6E¼Ü
 : 
public
 
EËm’t
 {

53 
public
:

54 
ICMP6E¼Ü
();

55 ~
ICMP6E¼Ü
();

57 cÚ¡ *
	$şass_Çme
() const {  "ICMP6Error"; }

58 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

59 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

60 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

62 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

64 
´iv©e
:

66 
IP6Add»ss
 
_¤c_
;

67 
_ty³
;

68 
_code
;

70 
boŞ
 
	`is_”rÜ_ty³
();

71 
boŞ
 
	`is_»dœeù_ty³
();

72 
boŞ
 
	`uniÿ¡
(cÚ¡ 
IP6Add»ss
 &
¯
);

73 
boŞ
 
	`v®id_sourû
(cÚ¡ 
IP6Add»ss
 &
¯
);

74 
boŞ
 
	`has_rou‹_İt
(cÚ¡ 
şick_6
 *

);

76 
	}
};

78 
	gCLICK_ENDDECLS


	@ip6/ip6encap.cc

18 
	~<şick/cÚfig.h
>

19 
	~"6’ÿp.hh
"

20 
	~<şick/Çmešfo.hh
>

21 
	~<şick/cÚå¬£.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
CLICK_DECLS


26 
	gIP6Enÿp
::
	$IP6Enÿp
()

28 
_u£_d¡_ªno
 = 
çl£
;

29 
	}
}

31 
	gIP6Enÿp
::~
	$IP6Enÿp
()

33 
	}
}

36 
IP6Enÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

38 
IP6Add»ss
 
	g¤c
;

39 
SŒšg
 
	gd¡_¡r
;

40 
ušt32_t
 
	gæow
 = 0;

41 
	g´Ùo
;

42 
ušt8_t
 
	ghlim
 = 250;

43 
ušt8_t
 
	g_şass
 = 0;

45 
mem£t
(&
_h6
, 0, (
şick_6
));

47 ià(
Args
(
cÚf
, 
this
, 
”rh
)

48 .
»ad_mp
("PROTO", 
NamedIÁArg
(
NameInfo
::
T_IP_PROTO
), 
´Ùo
)

49 .
»ad_mp
("SRC", 
¤c
)

50 .
»ad_mp
("DST", 
AnyArg
(), 
d¡_¡r
)

51 .
»ad
("HLIM", 
hlim
)

52 .
»ad
("CLASS", 
_şass
)

53 .
com¶‘e
() < 0)

56 ià(
	g´Ùo
 < 0 ||…roto > 255)

57  
	g”rh
->
”rÜ
("bad IP…rotocol");

59 
	g_u£_d¡_ªno
 = 
d¡_¡r
 == "DST_ANNO";

60 ià(
	g_u£_d¡_ªno
)

61 
mem£t
(&
_h6
.
6_d¡
.
s6_addr
, 0, (_iph6.ip6_dst.s6_addr));

62 ià(!
ı_6_add»ss
(
d¡_¡r
, 
_h6
.
6_d¡
.
s6_addr
, 
this
))

63  
	g”rh
->
”rÜ
("DST‡rgument should be IP‡ddress or 'DST_ANNO'");

65 
	g_h6
.
	g6_æow
 = 
htÚl
((6 << 
IP6_V_SHIFT
è| (
_şass
 << 
IP6_CLASS_SHIFT
è| 
æow
);

66 
	g_h6
.
	g6_¶’
 = 0;

67 
	g_h6
.
	g6_nxt
 = 
´Ùo
;

68 
	g_h6
.
	g6_hlim
 = 
hlim
;

69 
	g_h6
.
	g6_¤c
 = 
¤c
;

74 
Pack‘
 *

75 
	gIP6Enÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

77 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`push
((
şick_6
));

78 ià(!
p
)

80 cÚ¡ 
IP6Add»ss
 &
a
 = 
	`DST_IP6_ANNO
(
p
);

82 
şick_6
 *
6
 = 
»š‹½»t_ÿ¡
<şick_6 *>(
p
->
	`d©a
());

84 
	`memıy
(
6
, &
_h6
, (
şick_6
));

85 ià(
_u£_d¡_ªno
 && 
a
)

86 
6
->
6_d¡
 = 
a
;

88 
	`SET_DST_IP6_ANNO
(
p
, 
6
->
6_d¡
);

90 
6
->
6_¶’
 = 
	`htÚs
(
p
->
	`Ëngth
(è- (
şick_6
));

91 
p
->
	`£t_6_h—d”
(
6
, (
şick_6
));

93  
p
;

94 
	}
}

96 
SŒšg


97 
	gIP6Enÿp
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

99 
IP6Enÿp
 *
6e
 = 
¡©ic_ÿ¡
<IP6Enÿ°*>(
e
);

101 (
šŒ_t
)
thunk
) {

103  
	`IP6Add»ss
(
6e
->
_h6
.
6_¤c
).
	`uÅ¬£
();

105 ià(
6e
->
_u£_d¡_ªno
)

108  
	`IP6Add»ss
(
6e
->
_h6
.
6_d¡
).
	`uÅ¬£
();

112 
	}
}

115 
	gIP6Enÿp
::
	$add_hªdËrs
()

117 
	`add_»ad_hªdËr
("¤c", 
»ad_hªdËr
, 0, 
HªdËr
::
CALM
);

118 
	`add_wr™e_hªdËr
("¤c", 
»cÚfigu»_keywÜd_hªdËr
, "1 SRC");

119 
	`add_»ad_hªdËr
("d¡", 
»ad_hªdËr
, 1, 
HªdËr
::
CALM
);

120 
	`add_wr™e_hªdËr
("d¡", 
»cÚfigu»_keywÜd_hªdËr
, "2 DST");

121 
	}
}

123 
CLICK_ENDDECLS


124 
	$EXPORT_ELEMENT
(
IP6Enÿp
)

125 
	`ELEMENT_MT_SAFE
(
IP6Enÿp
)

	@ip6/ip6encap.hh

1 #iâdeà
CLICK_IP6ENCAP_HH


2 
	#CLICK_IP6ENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/©omic.hh
>

6 
	~<şickÃt/6.h
>

7 
	~<şick/6add»ss.hh
>

9 
CLICK_DECLS


60 şas 
	cIP6Enÿp
 : 
public
 
EËm’t
 {…ublic:

62 
IP6Enÿp
();

63 ~
IP6Enÿp
();

65 cÚ¡ *
	$şass_Çme
() const {  "IP6Encap"; }

66 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

68 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

69 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

70 
	$add_hªdËrs
(è
CLICK_COLD
;

72 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

74 
´iv©e
:

76 
şick_6
 
_h6
;

77 
boŞ
 
_u£_d¡_ªno
;

79 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

81 
	}
};

83 
	gCLICK_ENDDECLS


	@ip6/ip6fragmenter.cc

18 
	~<şick/cÚfig.h
>

19 
	~"6äagm’‹r.hh
"

20 
	~<şickÃt/6.h
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
CLICK_DECLS


26 
	gIP6F¿gm’‹r
::
	$IP6F¿gm’‹r
()

27 : 
	$_drİs
(0)

29 
_äagm’ts
 = 0;

30 
_mtu
 = 0;

31 
	}
}

33 
	gIP6F¿gm’‹r
::~
	$IP6F¿gm’‹r
()

35 
	}
}

39 
IP6F¿gm’‹r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("MTU", 
_mtu
).
com¶‘e
();

82 
	gIP6F¿gm’‹r
::
	$äagm’t
(
Pack‘
 *)

83 { 
	}
}

106 
SŒšg


107 
	$IP6F¿gm’‹r_»ad_drİs
(
EËm’t
 *
xf
, *)

109 
IP6F¿gm’‹r
 *
f
 = (IP6F¿gm’‹¸*)
xf
;

110  
	`SŒšg
(
f
->
	`drİs
());

111 
	}
}

113 
SŒšg


114 
	$IP6F¿gm’‹r_»ad_äagm’ts
(
EËm’t
 *
xf
, *)

116 
IP6F¿gm’‹r
 *
f
 = (IP6F¿gm’‹¸*)
xf
;

117  
	`SŒšg
(
f
->
	`äagm’ts
());

118 
	}
}

121 
	gIP6F¿gm’‹r
::
	$add_hªdËrs
()

123 
	`add_»ad_hªdËr
("drİs", 
IP6F¿gm’‹r_»ad_drİs
, 0);

124 
	`add_»ad_hªdËr
("äagm’ts", 
IP6F¿gm’‹r_»ad_äagm’ts
, 0);

125 
	}
}

129 
	gIP6F¿gm’‹r
::
	$push
(, 
Pack‘
 *
p
)

132 ià(
p
->
	`Ëngth
(è<ğ
_mtu
)

135 
	`ouut
(0).
	`push
(
p
);

142 
	}
}

144 
CLICK_ENDDECLS


145 
EXPORT_ELEMENT
(
IP6F¿gm’‹r
)

	@ip6/ip6fragmenter.hh

1 #iâdeà
CLICK_IP6FRAGMENTER_HH


2 
	#CLICK_IP6FRAGMENTER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


35 şas 
	cIP6F¿gm’‹r
 : 
public
 
EËm’t
 {

37 
_mtu
;

38 
	m_drİs
;

39 
	m_äagm’ts
;

41 
äagm’t
(
Pack‘
 *);

44 
	mpublic
:

46 
IP6F¿gm’‹r
();

47 ~
IP6F¿gm’‹r
();

49 cÚ¡ *
	$şass_Çme
() const {  "IP6Fragmenter"; }

50 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

51 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

52 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

54 
	$drİs
(ècÚ¡ {  
_drİs
; 
	}
}

55 
	$äagm’ts
(ècÚ¡ {  
_äagm’ts
; 
	}
}

57 
	$add_hªdËrs
(è
CLICK_COLD
;

59 
	`push
(, 
Pack‘
 *
p
);

62 
	}
};

64 
	gCLICK_ENDDECLS


	@ip6/ip6mirror.cc

18 
	~<şick/cÚfig.h
>

19 
	~"6mœrÜ.hh
"

20 
	~<şickÃt/.h
>

21 
	~<şickÃt/6.h
>

22 
	~<şickÃt/udp.h
>

23 
CLICK_DECLS


25 
	gIP6MœrÜ
::
	$IP6MœrÜ
()

27 
	}
}

29 
IP6MœrÜ
::~
	$IP6MœrÜ
()

31 
	}
}

33 
Pack‘
 *

34 
IP6MœrÜ
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

36 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

39 
şick_6
 *
h
 = 
p
->
	`6_h—d”
();

40 
š6_addr
 
tm·
 = 
h
->
6_¤c
;

41 
h
->
6_¤c
 = iph->
6_d¡
;

42 
h
->
6_d¡
 = 
tm·
;

45 ià((
h
->
6_nxt
 =ğ
IP_PROTO_TCP
 || iph->6_nxˆ=ğ
IP_PROTO_UDP
è&& 
p
->
	`Ëngth
(è>ğ(
ušt32_t
)Õ->
	`Œª¥Üt_h—d”_off£t
() + 8)) {

46 
şick_udp
 *
udph
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(
p
->
	`Œª¥Üt_h—d”
());

47 
ušt16_t
 
tmµ
 = 
udph
->
uh_¥Üt
;

48 
udph
->
uh_¥Üt
 = udph->
uh_dpÜt
;

49 
udph
->
uh_dpÜt
 = 
tmµ
;

52  
p
;

53 
	}
}

55 
CLICK_ENDDECLS


56 
	$EXPORT_ELEMENT
(
IP6MœrÜ
)

57 
	`ELEMENT_MT_SAFE
(
IP6MœrÜ
)

	@ip6/ip6mirror.hh

1 #iâdeà
CLICK_IP6MIRROR_HH


2 
	#CLICK_IP6MIRROR_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


27 şas 
	cIP6MœrÜ
 : 
public
 
EËm’t
 {

29 
public
:

31 
IP6MœrÜ
();

32 ~
IP6MœrÜ
();

34 cÚ¡ *
	$şass_Çme
() const {  "IP6Mirror"; }

35 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

37 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

41 
	gCLICK_ENDDECLS


	@ip6/ip6print.cc

6 
	~<şick/cÚfig.h
>

7 
	~"6´št.hh
"

8 
	~<şick/glue.hh
>

9 
	~<şick/¬gs.hh
>

10 
	~<şick/”rÜ.hh
>

11 
	~<şick/¡¿ccum.hh
>

12 
	~<şick/·ck‘_ªno.hh
>

13 
	~<şick/6add»ss.hh
>

14 #ià
CLICK_USERLEVEL


15 
	~<¡dio.h
>

17 
CLICK_DECLS


19 
	gIP6Pršt
::
	$IP6Pršt
()

21 
	}
}

23 
IP6Pršt
::~
	$IP6Pršt
()

25 
	}
}

28 
IP6Pršt
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

30 
	g_by‹s
 = 1500;

31 
	g_Ïb–
 = "";

32 
	g_cÚ‹Ás
 = 
çl£
;

34 ià(
Args
(
cÚf
, 
this
, 
”rh
)

35 .
»ad_p
("LABEL", 
_Ïb–
)

36 .
»ad
("CONTENTS", 
_cÚ‹Ás
)

37 .
»ad
("NBYTES", 
_by‹s
)

38 .
com¶‘e
() < 0)

43 
Pack‘
 *

44 
	gIP6Pršt
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

46 
SŒšg
 
s
 = "";

47 cÚ¡ 
şick_6
 *
h
 = (şick_6*è
p
->
	`_h—d”
();

49 
SŒšgAccum
 
§
;

50 ià(
_Ïb–
)

51 
§
 << 
_Ïb–
 << ": ";

52 
§
 << 
»š‹½»t_ÿ¡
<cÚ¡ 
IP6Add»ss
 &>(
h
->
6_¤c
)

54 << 
»š‹½»t_ÿ¡
<cÚ¡ 
IP6Add»ss
 &>(
h
->
6_d¡
)

55 << "…ËÀ" << 
	`Áohs
(
h
->
6_¶’
)

56 << ",‚exˆ" << ()
h
->
6_nxt


57 << ", hlim " << ()
h
->
6_hlim
 << "\n";

58 cÚ¡ *
d©a
 = 
p
->
	`d©a
();

59 ià(
_cÚ‹Ás
) {

60 
amt
 = 3*
_by‹s
 + (_bytes/4+1) + 3*(_bytes/24+1) + 1;

62 
§
 << " ";

63 *
buf
 = 
§
.
	`»£rve
(
amt
);

64 *
Üig_buf
 = 
buf
;

66 ià(
buf
) {

67 
i
 = 0; i < 
_by‹s
 && i < 
p
->
	`Ëngth
(); i++) {

68 
	`¥rštf
(
buf
, "%02x", 
d©a
[
i
] & 0xff);

69 
buf
 += 2;

70 ià((
i
 % 24) == 23) {

71 *
buf
++ = '\n'; *buf++ = ' '; *buf++ = ' ';

72 } ià((
i
 % 4) == 3)

73 *
buf
++ = ' ';

76 ià(
Üig_buf
) {

77 
	`as£¹
(
buf
 <ğ
Üig_buf
 + 
amt
);

78 
§
.
	`adju¡_Ëngth
(
buf
 - 
Üig_buf
);

81 
	`şick_ch©‹r
("%s", 
§
.
	`c_¡r
());

82  
p
;

83 
	}
}

85 
CLICK_ENDDECLS


86 
EXPORT_ELEMENT
(
IP6Pršt
)

	@ip6/ip6print.hh

1 #iâdeà
CLICK_IP6PRINT_HH


2 
	#CLICK_IP6PRINT_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/¡ršg.hh
>

5 
CLICK_DECLS


28 şas 
	cIP6Pršt
 : 
public
 
EËm’t
 {…ublic:

30 
IP6Pršt
();

31 ~
IP6Pršt
();

33 cÚ¡ *
	$şass_Çme
() const {  "IP6Print"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

36 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

38 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

40 
	g´iv©e
:

42 
SŒšg
 
_Ïb–
;

43 
	g_by‹s
;

44 
boŞ
 
	g_cÚ‹Ás
;

47 
	gCLICK_ENDDECLS


	@ip6/ip6routetable.cc

22 
	~<şick/cÚfig.h
>

23 
	~<şick/6add»ss.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/glue.hh
>

27 
	~"6rou‹bË.hh
"

28 
CLICK_DECLS


31 
	gIP6Rou‹TabË
::
	$ÿ¡
(cÚ¡ *
Çme
)

33 ià(
	`¡rcmp
(
Çme
, "IPRouteTable") == 0)

34  (*)
this
;

36  
EËm’t
::
	`ÿ¡
(
Çme
);

37 
	}
}

40 
	gIP6Rou‹TabË
::
	$add_rou‹
(
IP6Add»ss
, IP6Address, IP6Address,

41 , 
E¼ÜHªdËr
 *
”rh
)

44  
”rh
->
	`”rÜ
("cannot‡dd„outesohis„outingable");

45 
	}
}

48 
	gIP6Rou‹TabË
::
	$»move_rou‹
(
IP6Add»ss
, IP6Add»ss, 
E¼ÜHªdËr
 *
”rh
)

51  
”rh
->
	`”rÜ
("cannot delete„outes fromhis„outingable");

52 
	}
}

54 
SŒšg


55 
	gIP6Rou‹TabË
::
	$dump_rou‹s
()

57  
	`SŒšg
();

58 
	}
}

61 
	gIP6Rou‹TabË
::
	$add_rou‹_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

63 
IP6Rou‹TabË
 *
r
 = 
¡©ic_ÿ¡
<IP6Rou‹TabË *>(
e
);

65 
VeùÜ
<
SŒšg
> 
wÜds
;

66 
	`ı_¥aûvec
(
cÚf
, 
wÜds
);

68 
IP6Add»ss
 
d¡
, 
mask
, 
gw
;

69 
pÜt
, 
ok
;

71 ià(
wÜds
.
	`size
() == 2)

72 
ok
 = 
	`Args
(
wÜds
, 
r
, 
”rh
)

73 .
	`»ad_mp
("PREFIX", 
	`IP6P»fixArg
(
Œue
), 
d¡
, 
mask
)

74 .
	`»ad_mp
("PORT", 
pÜt
)

75 .
	`com¶‘e
();

77 
ok
 = 
	`Args
(
wÜds
, 
r
, 
”rh
)

78 .
	`»ad_mp
("PREFIX", 
	`IP6P»fixArg
(
Œue
), 
d¡
, 
mask
)

79 .
	`»ad_mp
("GATEWAY", 
gw
)

80 .
	`»ad_mp
("PORT", 
pÜt
)

81 .
	`com¶‘e
();

83 ià(
ok
 >ğ0 && (
pÜt
 < 0 ||…Üˆ>ğ
r
->
	`nouuts
()))

84 
ok
 = 
”rh
->
	`”rÜ
("output…ort out of„ange");

85 ià(
ok
 >= 0)

86 
ok
 = 
r
->
	`add_rou‹
(
d¡
, 
mask
, 
gw
, 
pÜt
, 
”rh
);

87  
ok
;

88 
	}
}

91 
	gIP6Rou‹TabË
::
	$»move_rou‹_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

93 
IP6Rou‹TabË
 *
r
 = 
¡©ic_ÿ¡
<IP6Rou‹TabË *>(
e
);

95 
VeùÜ
<
SŒšg
> 
wÜds
;

96 
	`ı_¥aûvec
(
cÚf
, 
wÜds
);

98 
IP6Add»ss
 
a
, 
mask
;

99 
ok
 = 0;

101 
ok
 = 
	`Args
(
wÜds
, 
r
, 
”rh
)

102 .
	`»ad_mp
("PREFIX", 
	`IP6P»fixArg
(
Œue
), 
a
, 
mask
)

103 .
	`com¶‘e
();

105 ià(
ok
 >= 0)

106 
ok
 = 
r
->
	`»move_rou‹
(
a
, 
mask
, 
”rh
);

107  
ok
;

108 
	}
}

111 
	gIP6Rou‹TabË
::
	$ù¾_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf_š
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

113 
SŒšg
 
cÚf
 = 
cÚf_š
;

114 
SŒšg
 
fœ¡_wÜd
 = 
	`ı_shiá_¥aûvec
(
cÚf
);

115 ià(
fœ¡_wÜd
 == "add")

116  
	`add_rou‹_hªdËr
(
cÚf
, 
e
, 
thunk
, 
”rh
);

117 ià(
fœ¡_wÜd
 == "remove")

118  
	`»move_rou‹_hªdËr
(
cÚf
, 
e
, 
thunk
, 
”rh
);

120  
”rh
->
	`”rÜ
("bad command, should be `add' or `remove'");

121 
	}
}

123 
SŒšg


124 
	gIP6Rou‹TabË
::
	$bË_hªdËr
(
EËm’t
 *
e
, *)

126 
IP6Rou‹TabË
 *
r
 = 
¡©ic_ÿ¡
<IP6Rou‹TabË*>(
e
);

127  
r
->
	`dump_rou‹s
();

128 
	}
}

130 
CLICK_ENDDECLS


131 
ELEMENT_PROVIDES
(
IP6Rou‹TabË
)

	@ip6/ip6routetable.hh

2 #iâdeà
CLICK_IP6ROUTETABLE_HH


3 
	#CLICK_IP6ROUTETABLE_HH


	)

4 
	~<şick/glue.hh
>

5 
	~<şick/–em’t.hh
>

6 
CLICK_DECLS


8 şas 
	cIP6Rou‹TabË
 : 
public
 
EËm’t
 {…ublic:

10 * 
ÿ¡
(const *);

12 
vœtu®
 
add_rou‹
(
IP6Add»ss
, IP6Add»ss, IP6Add»ss, , 
E¼ÜHªdËr
 *);

13 
vœtu®
 
»move_rou‹
(
IP6Add»ss
, IP6Add»ss, 
E¼ÜHªdËr
 *);

14 
vœtu®
 
SŒšg
 
dump_rou‹s
();

16 
add_rou‹_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

17 
»move_rou‹_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

18 
ù¾_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

19 
SŒšg
 
bË_hªdËr
(
EËm’t
*, *);

23 
	gCLICK_ENDDECLS


	@ip6/lookupip6route.cc

19 
	~<şick/cÚfig.h
>

20 
	~"lookup6rou‹.hh
"

21 
	~<şick/6add»ss.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
CLICK_DECLS


26 
	gLookupIP6Rou‹
::
	$LookupIP6Rou‹
()

28 
	}
}

30 
LookupIP6Rou‹
::~
	$LookupIP6Rou‹
()

32 
	}
}

35 
LookupIP6Rou‹
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 
	gmaxout
 = -1;

38 
	g_t
.
ş—r
();

40 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

41 
IP6Add»ss
 
	gd¡
, 
	gmask
, 
	ggw
;

42 
	gouut_num
;

43 
boŞ
 
	gok
 = 
çl£
;

45 
	gVeùÜ
<
	gSŒšg
> 
	gwÜds
;

46 
ı_¥aûvec
(
cÚf
[
i
], 
wÜds
);

48 ià((
	gwÜds
.
size
()==2 || 
wÜds
.size()==3 )

49 && 
ı_6_´efix
(
wÜds
[0], (*)&
d¡
, (*)&
mask
, 
Œue
, 
this
)

50 && 
IÁArg
().
·r£
(
wÜds
.
back
(), 
ouut_num
))

52 ià(
	gwÜds
.
size
()==3)

53 
ok
 = 
ı_6_add»ss
(
wÜds
[1], (*)&
gw
, 
this
);

55 
	ggw
 = 
IP6Add»ss
("::0");

56 
	gok
 = 
Œue
;

60 ià(
	gok
 && 
	gouut_num
>=0) {

61 
_t
.
add
(
d¡
, 
mask
, 
gw
, 
ouut_num
);

62 ifĞ
	gouut_num
 > 
	gmaxout
)

63 
	gmaxout
 = 
ouut_num
;

65 
	g”rh
->
”rÜ
("¬gum’ˆ%d should bDADDR/MASK [GW] OUTPUT", 
i
+1);

70 ià(
	g”rh
->
Ã¼Üs
())

72 ià(
	gmaxout
 <0)

73 
	g”rh
->
w¬nšg
("no„outes");

75 ià(
	gmaxout
 >ğ
nouuts
())

76  
”rh
->
”rÜ
("Ãed %d o¸mÜouuˆpÜts", 
maxout
 + 1);

82 
	gLookupIP6Rou‹
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

84 
_Ï¡_addr
 = 
	`IP6Add»ss
();

85 #ifdeà
IP_RT_CACHE2


86 
_Ï¡_addr2
 = 
_Ï¡_addr
;

89 
	}
}

92 
	gLookupIP6Rou‹
::
	$push
(, 
Pack‘
 *
p
)

94 
IP6Add»ss
 
a
 = 
	`DST_IP6_ANNO
(
p
);

95 
IP6Add»ss
 
gw
;

96 
ifi
 = -1;

98 ià(
a
) {

99 ià(
a
 =ğ
_Ï¡_addr
 ) {

100 ià(
_Ï¡_gw
)

102 
	`SET_DST_IP6_ANNO
(
p
, 
_Ï¡_gw
);

104 
	`ouut
(
_Ï¡_ouut
).
	`push
(
p
);

107 #ifdeà
IP_RT_CACHE2


108 ià(
a
 =ğ
_Ï¡_addr2
) {

110 
IP6add»ss
 
tm·
;

111 
tmpi
;

112 
	`EXCHANGE
(
_Ï¡_addr
, 
_Ï¡_addr2
, 
tm·
);

113 
	`EXCHANGE
(
_Ï¡_gw
, 
_Ï¡_gw2
, 
tm·
);

114 
	`EXCHANGE
(
_Ï¡_ouut
, 
_Ï¡_ouut2
, 
tmpi
);

116 ià(
_Ï¡_gw2
) {

117 
	`SET_DST_IP6_ANNO
(
p
, 
_Ï¡_gw2
);

119 
	`ouut
(
_Ï¡_ouut2
).
	`push
(
p
);

126 ià(
_t
.
	`lookup
(
a
, 
gw
, 
ifi
)) {

127 #ifdeà
IP_RT_CACHE2


128 
_Ï¡_addr2
 = 
_Ï¡_addr
;

129 
_Ï¡_gw2
 = 
_Ï¡_gw
;

130 
_Ï¡_ouut2
 = 
_Ï¡_ouut
;

133 
_Ï¡_addr
 = 
a
;

134 
_Ï¡_gw
 = 
gw
;

135 
_Ï¡_ouut
 = 
ifi
;

136 ià(
gw
 !ğ
	`IP6Add»ss
("::0")) {

137 
	`SET_DST_IP6_ANNO
(
p
, 
	`IP6Add»ss
(
gw
));

139 
	`ouut
(
ifi
).
	`push
(
p
);

142 
p
->
	`kl
();

144 
	}
}

147 
	gLookupIP6Rou‹
::
	$add_rou‹
(
IP6Add»ss
 
addr
, IP6Add»s 
mask
, IP6Add»s 
gw
,

148 
ouut
, 
E¼ÜHªdËr
 *
”rh
)

150 ià(
ouut
 < 0 && ouuˆ>ğ
	`nouuts
())

151  
”rh
->
	`”rÜ
("port‚umber out of„ange");

153 
_t
.
	`add
(
addr
, 
mask
, 
gw
, 
ouut
);

155 
	}
}

158 
	gLookupIP6Rou‹
::
	$»move_rou‹
(
IP6Add»ss
 
addr
, IP6Add»s 
mask
,

159 
E¼ÜHªdËr
 *)

161 
_t
.
	`d–
(
addr
, 
mask
);

163 
	}
}

166 
	gLookupIP6Rou‹
::
	$add_hªdËrs
()

168 
	`add_wr™e_hªdËr
("add", 
add_rou‹_hªdËr
, 0);

169 
	`add_wr™e_hªdËr
("»move", 
»move_rou‹_hªdËr
, 0);

170 
	`add_wr™e_hªdËr
("ù¾", 
ù¾_hªdËr
, 0);

171 
	`add_»ad_hªdËr
("bË", 
bË_hªdËr
, 0);

172 
	}
}

174 
CLICK_ENDDECLS


175 
EXPORT_ELEMENT
(
LookupIP6Rou‹
)

	@ip6/lookupip6route.hh

1 #iâdeà
CLICK_LOOKUPIP6ROUTE_HH


2 
	#CLICK_LOOKUPIP6ROUTE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/6bË.hh
>

5 
	~"6rou‹bË.hh
"

6 
CLICK_DECLS


42 şas 
	cLookupIP6Rou‹
 : 
public
 
IP6Rou‹TabË
 {

43 
public
:

44 
LookupIP6Rou‹
();

45 ~
LookupIP6Rou‹
();

47 cÚ¡ *
	$şass_Çme
() const {  "LookupIP6Route"; }

48 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

49 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

51 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

52 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

53 
	$add_hªdËrs
(è
CLICK_COLD
;

55 
	`push
(
pÜt
, 
Pack‘
 *
p
);

57 
	`add_rou‹
(
IP6Add»ss
, IP6Add»ss, IP6Add»ss, , 
E¼ÜHªdËr
 *);

58 
	`»move_rou‹
(
IP6Add»ss
, IP6Add»ss, 
E¼ÜHªdËr
 *);

59 
SŒšg
 
	$dump_rou‹s
(è{  
_t
.
	`dump
(); 
	}
};

61 
	g´iv©e
:

63 
IP6TabË
 
_t
;

65 
IP6Add»ss
 
	g_Ï¡_addr
;

66 
IP6Add»ss
 
	g_Ï¡_gw
;

67 
	g_Ï¡_ouut
;

69 #ifdeà
IP_RT_CACHE2


70 
IPAdd»ss
 
	g_Ï¡_addr2
;

71 
IPAdd»ss
 
	g_Ï¡_gw2
;

72 
	g_Ï¡_ouut2
;

77 
	gCLICK_ENDDECLS


	@ip6/markip6header.cc

18 
	~<şick/cÚfig.h
>

19 
	~"m¬k6h—d”.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şickÃt/6.h
>

22 
CLICK_DECLS


24 
	gM¬kIP6H—d”
::
	$M¬kIP6H—d”
()

26 
	}
}

28 
M¬kIP6H—d”
::~
	$M¬kIP6H—d”
()

30 
	}
}

33 
M¬kIP6H—d”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

35 
	g_off£t
 = 0;

36  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("OFFSET", 
_off£t
).
com¶‘e
();

39 
Pack‘
 *

40 
	gM¬kIP6H—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

42 cÚ¡ 
şick_6
 *
6
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_6 *>(
p
->
	`d©a
(è+ 
_off£t
);

43 
p
->
	`£t_6_h—d”
(
6
, 10 << 2);

44  
p
;

45 
	}
}

47 
CLICK_ENDDECLS


48 
EXPORT_ELEMENT
(
M¬kIP6H—d”
)

	@ip6/markip6header.hh

1 #iâdeà
CLICK_MARKIP6HEADER_HH


2 
	#CLICK_MARKIP6HEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


20 şas 
	cM¬kIP6H—d”
 : 
public
 
EËm’t
 {

22 
_off£t
;

24 
	mpublic
:

26 
M¬kIP6H—d”
();

27 ~
M¬kIP6H—d”
();

29 cÚ¡ *
	$şass_Çme
() const {  "MarkIP6Header"; }

30 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

31 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

33 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

37 
	gCLICK_ENDDECLS


	@ip6/protocoltranslator46.cc

18 
	~<şick/cÚfig.h
>

19 
	~"´ÙocŞŒª¦©Ü46.hh
"

20 
	~<şick/cÚå¬£.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şickÃt/.h
>

23 
	~<şickÃt/6.h
>

24 
	~<şickÃt/icmp.h
>

25 
	~<şickÃt/icmp6.h
>

26 
	~<şickÃt/tı.h
>

27 
	~<şickÃt/udp.h
>

28 
CLICK_DECLS


30 
	gPrÙocŞT¿n¦©Ü46
::
	$PrÙocŞT¿n¦©Ü46
()

32 
	}
}

35 
PrÙocŞT¿n¦©Ü46
::~
	$PrÙocŞT¿n¦©Ü46
()

37 
	}
}

41 
Pack‘
 *

42 
PrÙocŞT¿n¦©Ü46
::
	$make_Œª¦©e46
(
IP6Add»ss
 
¤c
,

43 
IP6Add»ss
 
d¡
,

44 
şick_
 * 

,

45 *
a
)

48 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((
şick_6
)-(
şick_
)+
	`Áohs
(

->
_Ën
));

50 ià(
q
==0) {

51 
	`şick_ch©‹r
("can‚ot make…acket!");

52 
	`as£¹
(0);

55 
	`mem£t
(
q
->
	`d©a
(), '\0', q->
	`Ëngth
());

56 
şick_6
 *
6
=(şick_6 *)
q
->
	`d©a
();

57 
şick_tı
 *
tı
 = (şick_tı *)(
6
+1);

58 
şick_udp
 *
udp
 = (şick_ud°*)(
6
+1);

61 
6
->
6_æow
 = 0;

62 
6
->
6_v
 = 6;

63 
6
->
6_¶’
 = 
	`htÚs
(
	`Áohs
(

->
_Ën
)-(
şick_
));

64 
6
->
6_hlim
 = 

->
_‰l
 + 0x40-0xff;

65 
6
->
6_¤c
 = 
¤c
;

66 
6
->
6_d¡
 = 
d¡
;

67 
	`memıy
((*)
tı
, 
a
, 
	`Áohs
(
6
->
6_¶’
));

69 ià(

->
_p
 == 6)

71 
6
->
6_nxt
 = 

->
_p
;

72 
tı
->
th_sum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6
->
6_¤c
, &6->
6_d¡
, ip6->
6_¶’
, ip6->
6_nxt
,ı->th_sum, 
a
, ip6->ip6_plen));

75 ià(

->
_p
 == 17)

77 
6
->
6_nxt
 = 

->
_p
;

78 
udp
->
uh_sum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6
->
6_¤c
, &6->
6_d¡
, ip6->
6_¶’
, ip6->
6_nxt
, udp->uh_sum, 
a
, ip6->ip6_plen));

81 ià(

->
_p
 == 1)

83 
6
->
6_nxt
=0x3a;

92  
q
;

94 
	}
}

97 
Pack‘
 *

98 
	gPrÙocŞT¿n¦©Ü46
::
	$make_icmp_Œª¦©e46
(
IP6Add»ss
 
6_¤c
,

99 
IP6Add»ss
 
6_d¡
,

100 *
a
,

101 
·ylßd_Ëngth
)

103 
şick_
 *

=0;

104 *
6
=0;

105 
icmp_ty³
 = 
a
[0];

106 
icmp_code
 = 
a
[1];

107 
icmp_poš‹r
 = 
a
[4];

109 
icmp6_code
 = 0;

110 
icmp6_Ëngth
;

112 
Wr™abËPack‘
 *
q2
 = 0;

114 
icmp_ty³
) {

115 (
ICMP_ECHO
): ;

116 (
ICMP_ECHOREPLY
): {

117 
şick_icmp_echo
 *
icmp
 = (şick_icmp_echØ*)
a
;

118 

 = (
şick_
 *)(
icmp
+1);

119 
icmp6_Ëngth
 = 
·ylßd_Ëngth
-(
şick_icmp_echo
)+(
şick_icmp6_echo
);

120 
q2
=
Pack‘
::
	`make
(
icmp6_Ëngth
);

121 
	`mem£t
(
q2
->
	`d©a
(), '\0', q2->
	`Ëngth
());

122 
şick_icmp6_echo
 *
icmp6
 = (şick_icmp6_echØ*)
q2
->
	`d©a
();

123 
6
=(*)(
icmp6
+1);

125 ià(
icmp_ty³
 =ğ
ICMP_ECHO
 ) {

126 
icmp6
->
icmp6_ty³
 = 
ICMP6_ECHO
;

128 ià(
icmp_ty³
 =ğ
ICMP_ECHOREPLY
 ) {

129 
icmp6
->
icmp6_ty³
 = 
ICMP6_ECHOREPLY
;

131 
icmp6
->
icmp6_id’tif›r
 = 
icmp
->
icmp_id’tif›r
;

132 
icmp6
->
icmp6_£qu’û
 = 
icmp
->
icmp_£qu’û
;

133 
	`memıy
(
6
, (*)

, 
icmp6_Ëngth
);

134 
icmp
->
icmp_cksum
 = 0;

135 
icmp6
->
icmp6_cksum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6_¤c
.
	`š6_addr
(), &
6_d¡
.š6_addr(), htÚs(
icmp6_Ëngth
), 0x3a, 0, (*)icmp6, htons(icmp6_length)));

140 (
ICMP_UNREACH
): {

141 
şick_icmp_uÄ—ch
 *
icmp
 = (şick_icmp_uÄ—ch *)
a
;

142 

 = (
şick_
 *)(
icmp
+1);

144 ià(
icmp_code
 == 2 || icmp_code ==4) {

145 
icmp_code
) {

147 
icmp6_Ëngth
 = 
·ylßd_Ëngth
-(
şick_icmp_uÄ—ch
)+(
şick_icmp6_·¿m´ob
);

148 
q2
=
Pack‘
::
	`make
(
icmp6_Ëngth
);

149 
	`mem£t
(
q2
->
	`d©a
(), '\0', q2->
	`Ëngth
());

150 
şick_icmp6_·¿m´ob
 *
icmp6
 = (şick_icmp6_·¿m´ob *)
q2
->
	`d©a
();

151 
6
=(*)(
icmp6
+1);

152 
icmp6
->
icmp6_ty³
 = 
ICMP6_PARAMPROB
;

153 
icmp6
->
icmp6_code
 = 1;

154 
icmp6
->
icmp6_poš‹r
 = 6;

155 
	`memıy
(
6
, (*)

, 
icmp6_Ëngth
);

156 
icmp
->
icmp_cksum
 = 0;

157 
icmp6
->
icmp6_cksum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6_¤c
.
	`š6_addr
(), &
6_d¡
.š6_addr(), htÚs(
icmp6_Ëngth
), 0x3a, 0, (*)icmp6, htons(icmp6_length)));

162 
icmp6_Ëngth
 = 
·ylßd_Ëngth
-(
şick_icmp_uÄ—ch
)+(
şick_icmp6_pk‰oobig
);

163 
q2
=
Pack‘
::
	`make
(
icmp6_Ëngth
);

164 
	`mem£t
(
q2
->
	`d©a
(), '\0', q2->
	`Ëngth
());

165 
şick_icmp6_pk‰oobig
 *
icmp6
 = (şick_icmp6_pk‰oobig *)
q2
->
	`d©a
();

166 
6
=(*)(
icmp6
+1);

167 
icmp6
->
icmp6_ty³
 = 
ICMP6_PKTTOOBIG
;

168 
icmp6
->
icmp6_code
 = 0;

172 
	`memıy
(
6
, (*)

, 
icmp6_Ëngth
);

173 
icmp
->
icmp_cksum
 = 0;

174 
icmp6
->
icmp6_cksum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6_¤c
.
	`š6_addr
(), &
6_d¡
.š6_addr(), htÚs(
icmp6_Ëngth
), 0x3a, 0, (*)icmp6, htons(icmp6_length)));

182 
icmp_code
) {

190 
icmp6_code
 = 0;

194 
icmp6_code
 = 4;

198 
icmp6_code
 = 2;

203 
icmp6_code
 = 1;

209 
icmp6_Ëngth
 = 
·ylßd_Ëngth
-(
şick_icmp_uÄ—ch
)+(
şick_icmp6_uÄ—ch
);

210 
q2
=
Pack‘
::
	`make
(
icmp6_Ëngth
);

211 
	`mem£t
(
q2
->
	`d©a
(), '\0', q2->
	`Ëngth
());

212 
şick_icmp6_uÄ—ch
 *
icmp6
 = (şick_icmp6_uÄ—ch *)
q2
->
	`d©a
();

213 
6
=(*)(
icmp6
+1);

214 
icmp6
->
icmp6_ty³
 = 
ICMP6_UNREACH
;

215 
icmp6
->
icmp6_code
 = icmp6_code;

216 
	`memıy
(
6
, (*)

, 
icmp6_Ëngth
);

217 
icmp
->
icmp_cksum
 = 0;

218 
icmp6
->
icmp6_cksum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6_¤c
.
	`š6_addr
(), &
6_d¡
.š6_addr(), htÚs(
icmp6_Ëngth
), 0x3a, 0, (*)icmp6, htons(icmp6_length)));

223 (
ICMP_TIMXCEED
) : {

224 
şick_icmp_timxûed
 *
icmp
 = (şick_icmp_timxûed *)
a
;

225 

 = (
şick_
 *)(
icmp
+1);

226 
icmp6_Ëngth
 = 
·ylßd_Ëngth
-(
şick_icmp_timxûed
)+(
şick_icmp6_timxûed
);

227 
q2
=
Pack‘
::
	`make
(
icmp6_Ëngth
);

228 
	`mem£t
(
q2
->
	`d©a
(), '\0', q2->
	`Ëngth
());

229 
şick_icmp6_timxûed
 *
icmp6
 = (şick_icmp6_timxûed *)
q2
->
	`d©a
();

230 
6
=(*)(
icmp6
+1);

231 
icmp6
->
icmp6_ty³
=
ICMP6_TIMXCEED
;

232 
icmp6
->
icmp6_code
 = 
icmp_code
;

233 
	`memıy
(
6
, (*)

, 
icmp6_Ëngth
);

234 
icmp
->
icmp_cksum
 = 0;

235 
icmp6
->
icmp6_cksum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6_¤c
.
	`š6_addr
(), &
6_d¡
.š6_addr(), htÚs(
icmp6_Ëngth
), 0x3a, 0, (*)icmp6, htons(icmp6_length)));

239 (
ICMP_PARAMPROB
): {

240 
şick_icmp_·¿m´ob
 *
icmp
 = (şick_icmp_·¿m´ob *)
a
;

241 

 = (
şick_
 *)(
icmp
+1);

242 
icmp6_Ëngth
 = 
·ylßd_Ëngth
-(
şick_icmp_·¿m´ob
)+(
şick_icmp6_·¿m´ob
);

243 
q2
=
Pack‘
::
	`make
(
icmp6_Ëngth
);

244 
	`mem£t
(
q2
->
	`d©a
(), '\0', q2->
	`Ëngth
());

245 
şick_icmp6_·¿m´ob
 *
icmp6
 = (şick_icmp6_·¿m´ob *)
q2
->
	`d©a
();

246 
6
=(*)(
icmp6
+1);

247 
icmp6
->
icmp6_ty³
=
ICMP6_PARAMPROB
;

249 
icmp_poš‹r
) {

250 0 : 
icmp6
->
icmp6_poš‹r
 = 0; ;

251 2 : 
icmp6
->
icmp6_poš‹r
 = 4; ;

252 8 : 
icmp6
->
icmp6_poš‹r
 = 7; ;

253 9 : 
icmp6
->
icmp6_poš‹r
 = 6; ;

254 12 : 
icmp6
->
icmp6_poš‹r
 = 8; ;

255 16 : 
icmp6
->
icmp6_poš‹r
 = 24; ;

256  : 
icmp6
->
icmp6_poš‹r
 = -1; ;

258 
	`memıy
(
6
, (*)

, 
icmp6_Ëngth
);

259 
icmp
->
icmp_cksum
 = 0;

260 
icmp6
->
icmp6_cksum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6_¤c
.
	`š6_addr
(), &
6_d¡
.š6_addr(), htÚs(
icmp6_Ëngth
), 0x3a, 0, (*)icmp6, htons(icmp6_length)));

268  
q2
;

270 
	}
}

274 
	gPrÙocŞT¿n¦©Ü46
::
	$push
(, 
Pack‘
 *
p
)

276 
	`hªdË_4
(
p
);

277 
	}
}

281 
	gPrÙocŞT¿n¦©Ü46
::
	$hªdË_4
(
Pack‘
 *
p
)

283 
şick_
 *

 = (şick_ *)
p
->
	`d©a
();

285 
IP6Add»ss
 
6a_¤c
 = 
	`IP6Add»ss
(
	`IPAdd»ss
(

->
_¤c
));

286 
IP6Add»ss
 
6a_d¡
 = 
	`IP6Add»ss
(
	`IPAdd»ss
(

->
_d¡
));

288 *
¡¬t_of_p
 = (*)(

+1);

289 
Pack‘
 *
q
 = 0;

290 
q
=
	`make_Œª¦©e46
(
6a_¤c
, 
6a_d¡
, 

, 
¡¬t_of_p
);

292 ià(

->
_p
 == 1)

294 
şick_6
 * 
6
 = (şick_6 *)
q
->
	`d©a
();

295 * 
icmp
 = (*)(
6
+1);

296 
Pack‘
 *
q2
 = 0;

297 
q2
 = 
	`make_icmp_Œª¦©e46
(
6a_¤c
, 
6a_d¡
, 
icmp
, (
q
->
	`Ëngth
(è- (
şick_6
)));

298 
Wr™abËPack‘
 *
q3
 = 
Pack‘
::
	`make
((
şick_6
)+
q2
->
	`Ëngth
());

299 
	`mem£t
(
q3
->
	`d©a
(), '\0', q3->
	`Ëngth
());

300 
şick_6
 *
¡¬t_of_q3
 = (şick_6 *)
q3
->
	`d©a
();

301 
	`memıy
(
¡¬t_of_q3
, 
q
->
	`d©a
(), (
şick_6
));

302 *
¡¬t_of_icmp6
 = (*)(
¡¬t_of_q3
+1);

303 
	`memıy
(
¡¬t_of_icmp6
, 
q2
->
	`d©a
(), q2->
	`Ëngth
());

304 
şick_6
 * 
62
=(şick_6 *)
q3
->
	`d©a
();

305 
62
->
6_¶’
 = 
	`htÚs
(
q3
->
	`Ëngth
()-(
şick_6
));

307 
p
->
	`kl
();

308 
q
->
	`kl
();

309 
q2
->
	`kl
();

310 
	`ouut
(0).
	`push
(
q3
);

314 
p
->
	`kl
();

315 
	`ouut
(0).
	`push
(
q
);

318 
	}
}

320 
CLICK_ENDDECLS


321 
EXPORT_ELEMENT
(
PrÙocŞT¿n¦©Ü46
)

	@ip6/protocoltranslator46.hh

1 #iâdeà
CLICK_PROTOCOLTRANSLATOR46_HH


2 
	#CLICK_PROTOCOLTRANSLATOR46_HH


	)

3 
	~<şick/6add»ss.hh
>

4 
	~<şick/add»ss.hh
>

5 
	~<şick/veùÜ.hh
>

6 
	~<şick/–em’t.hh
>

7 
CLICK_DECLS


29 şas 
	cPrÙocŞT¿n¦©Ü46
 : 
public
 
EËm’t
 {

32 
public
:

34 
PrÙocŞT¿n¦©Ü46
();

35 ~
PrÙocŞT¿n¦©Ü46
();

37 cÚ¡ *
	$şass_Çme
() const {  "ProtocolTranslator46"; }

38 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

39 
push
(
pÜt
, 
Pack‘
 *
p
);

40 
hªdË_4
(
Pack‘
 *);

42 
	g´iv©e
:

44 
Pack‘
 * 
make_icmp_Œª¦©e46
(
IP6Add»ss
 
6_¤c
,

45 
IP6Add»ss
 
6_d¡
,

46 *
a
,

47 
·ylßd_Ëngth
);

49 
Pack‘
 * 
make_Œª¦©e46
(
IP6Add»ss
 
¤c
,

50 
IP6Add»ss
 
d¡
,

51 
şick_
 * 

,

52 *
a
);

56 
	gCLICK_ENDDECLS


	@ip6/protocoltranslator64.cc

19 
	~<şick/cÚfig.h
>

20 
	~"´ÙocŞŒª¦©Ü64.hh
"

21 
	~<şick/cÚå¬£.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şickÃt/.h
>

24 
	~<şickÃt/6.h
>

25 
	~<şickÃt/icmp.h
>

26 
	~<şickÃt/icmp6.h
>

27 
	~<şickÃt/tı.h
>

28 
	~<şickÃt/udp.h
>

29 
CLICK_DECLS


31 
	gPrÙocŞT¿n¦©Ü64
::
	$PrÙocŞT¿n¦©Ü64
()

33 
	}
}

36 
PrÙocŞT¿n¦©Ü64
::~
	$PrÙocŞT¿n¦©Ü64
()

38 
	}
}

42 
Pack‘
 *

43 
PrÙocŞT¿n¦©Ü64
::
	$make_Œª¦©e64
(
IPAdd»ss
 
¤c
,

44 
IPAdd»ss
 
d¡
,

45 
şick_6
 * 
6
,

46 *
a
)

48 
şick_
 *

;

49 
şick_tı
 *
tı
;

50 
şick_udp
 *
udp
;

51 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((*

è+ 
	`Áohs
(
6
->
6_¶’
));

53 ià(
q
==0) {

54 
	`şick_ch©‹r
("can‚ot make…acket!");

55 
	`as£¹
(0);

58 
	`mem£t
(
q
->
	`d©a
(), '\0', q->
	`Ëngth
());

59 

 = (
şick_
 *)
q
->
	`d©a
();

60 
tı
 = (
şick_tı
 *)(

+1);

61 
udp
 = (
şick_udp
 *)(

+1);

64 

->
_v
 = 4;

65 

->
_hl
 =5;

66 

->
_tos
 =0;

67 

->
_Ën
 = 
	`htÚs
((*è+ 
	`Áohs
(
6
->
6_¶’
));

69 

->
_id
 = 
	`htÚs
(0);

76 

->
_off
 = 
	`htÚs
(
IP_DF
);

80 

->
_‰l
 = 
6
->
6_hlim
;

84 

->
_¤c
 = 
¤c
.
	`š_addr
();

85 

->
_d¡
 = 
d¡
.
	`š_addr
();

88 
	`memıy
((*)
tı
, 
a
, 
	`Áohs
(
6
->
6_¶’
));

94 ià(
6
->
6_nxt
 == 6)

96 

->
_p
 = 
6
->
6_nxt
;

99 

->
_sum
 = 0;

100 
tı
->
th_sum
 = 0;

102 
ušt16_t
 
’
 = 
	`Áohs
(
6
->
6_¶’
);

103 
ušt16_t
 
csum
 = 
	`şick_š_cksum
((*è
tı
, 
’
);

104 
tı
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
’
);

105 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

109 ià(
6
->
6_nxt
 ==17)

111 

->
_p
 = 
6
->
6_nxt
;

114 

->
_sum
=0;

115 
udp
->
uh_sum
 = 0;

117 
ušt16_t
 
’
 = 
	`Áohs
(
6
->
6_¶’
);

118 
ušt16_t
 
csum
 = 
	`şick_š_cksum
((*è
udp
, 
’
);

119 
udp
->
uh_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
’
);

120 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

124 ià(
6
->
6_nxt
== 58)

126 

->
_p
 = 1;

134  
q
;

136 
	}
}

139 
Pack‘
 *

140 
	gPrÙocŞT¿n¦©Ü64
::
	$make_icmp_Œª¦©e64
(*
a
,

141 
·ylßd_Ëngth
)

144 
şick_6
 *
6
=0;

145 *

=0;

146 
icmp6_ty³
ğ
a
[0];

147 
icmp6_code
ğ
a
[1];

148 
icmp_Ëngth
;

149 
Wr™abËPack‘
 *
q2
 = 0;

152 
icmp6_ty³
) {

153 
ICMP6_ECHO
: ;

154 
ICMP6_ECHOREPLY
 : {

155 
icmp_Ëngth
 = 
·ylßd_Ëngth
 -(
şick_icmp6_echo
è+ (
şick_icmp_echo
);

156 
şick_icmp6_echo
 *
icmp6
 = (şick_icmp6_echØ*)
a
;

157 
6
 = (
şick_6
 *)(
icmp6
+1);

159 
q2
 = 
Pack‘
::
	`make
(
icmp_Ëngth
);

160 
	`mem£t
(
q2
->
	`d©a
(), '\0', q2->
	`Ëngth
());

161 
şick_icmp_echo
 *
icmp
 = (şick_icmp_echØ*)
q2
->
	`d©a
();

162 

 = (*)(
icmp
+1);

164 ià(
icmp6_ty³
 =ğ
ICMP6_ECHO
 ) {

165 
icmp
->
icmp_ty³
 = 
ICMP_ECHO
;

167 ià(
icmp6_ty³
 =ğ
ICMP6_ECHOREPLY
 ) {

168 
icmp
->
icmp_ty³
 = 
ICMP_ECHOREPLY
;

171 
icmp
->
icmp_id’tif›r
 = (
icmp6
->
icmp6_id’tif›r
);

172 
icmp
->
icmp_£qu’û
 = (
icmp6
->
icmp6_£qu’û
);

173 
	`memıy
(

, 
6
, (
·ylßd_Ëngth
 - (
şick_icmp6_echo
)));

174 
icmp
->
icmp_cksum
 = 
	`şick_š_cksum
((*)icmp, 
icmp_Ëngth
);

179 
ICMP6_UNREACH
 : {

181 
icmp_Ëngth
 = 
·ylßd_Ëngth
-(
şick_icmp6_uÄ—ch
)+(
şick_icmp_uÄ—ch
);

182 
şick_icmp6_uÄ—ch
 *
icmp6
 = (şick_icmp6_uÄ—ch *)
a
;

183 
6
 = (
şick_6
 *)(
icmp6
+1);

184 
q2
 = 
Pack‘
::
	`make
(
icmp_Ëngth
);

185 
	`mem£t
(
q2
->
	`d©a
(), '\0', q2->
	`Ëngth
());

186 
şick_icmp_uÄ—ch
 *
icmp
 = (şick_icmp_uÄ—ch *)
q2
->
	`d©a
();

187 

 = (*)(
icmp
+1);

188 
icmp
->
icmp_ty³
 = 
ICMP_UNREACH
;

190 
icmp6_code
) {

191 0: 
icmp
->
icmp_code
 =0; ;

192 1: 
icmp
->
icmp_code
 =10; ;

193 2: 
icmp
->
icmp_code
 =5; ;

194 3: 
icmp
->
icmp_code
 =1; ;

195 4: 
icmp
->
icmp_code
 =3; ;

198 
	`memıy
(

, 
6
, (
·ylßd_Ëngth
 - (
şick_icmp6_uÄ—ch
)));

199 
icmp
->
icmp_cksum
 = 
	`şick_š_cksum
((*)icmp, 
icmp_Ëngth
);

204 
ICMP6_PKTTOOBIG
 : {

205 
icmp_Ëngth
 = 
·ylßd_Ëngth
-(
şick_icmp6_pk‰oobig
)+(
şick_icmp_uÄ—ch
);

206 
şick_icmp6_pk‰oobig
 *
icmp6
 = (şick_icmp6_pk‰oobig*)
a
;

207 
6
 = (
şick_6
 *)(
icmp6
+1);

208 
q2
 = 
Pack‘
::
	`make
(
icmp_Ëngth
);

209 
	`mem£t
(
q2
->
	`d©a
(), '\0', q2->
	`Ëngth
());

210 
şick_icmp_uÄ—ch
 *
icmp
 = (şick_icmp_uÄ—ch *)
q2
->
	`d©a
();

211 

 = (*)(
icmp
+1);

212 
icmp
->
icmp_ty³
 = 
ICMP_UNREACH
;

213 
icmp
->
icmp_code
 = 4;

214 
	`memıy
(

, 
6
, (
·ylßd_Ëngth
 - (
şick_icmp6_pk‰oobig
)));

215 
icmp
->
icmp_cksum
 = 
	`şick_š_cksum
((*)icmp, 
icmp_Ëngth
);

219 
ICMP6_TIMXCEED
 : {

220 
icmp_Ëngth
 = 
·ylßd_Ëngth
-(
şick_icmp6_timxûed
)+(
şick_icmp_timxûed
);

221 
şick_icmp6_timxûed
 *
icmp6
 = (şick_icmp6_timxûed *)
a
;

222 
6
 = (
şick_6
 *)(
icmp6
+1);

223 
q2
 = 
Pack‘
::
	`make
(
icmp_Ëngth
);

224 
	`mem£t
(
q2
->
	`d©a
(), '\0', q2->
	`Ëngth
());

225 
şick_icmp_timxûed
 *
icmp
 = (şick_icmp_timxûed *)
q2
->
	`d©a
();

226 

 = (*)(
icmp
+1);

227 
icmp
->
icmp_ty³
 =
ICMP_TIMXCEED
;

228 
icmp
->
icmp_code
 = 
icmp6_code
;

229 
	`memıy
(

, 
6
, (
·ylßd_Ëngth
 - (
şick_icmp6_timxûed
)));

230 
icmp
->
icmp_cksum
 = 
	`şick_š_cksum
((*)icmp, 
icmp_Ëngth
);

234 
ICMP6_PARAMPROB
 : {

236 
şick_icmp6_·¿m´ob
 *
icmp6
 = (şick_icmp6_·¿m´ob *)
a
;

237 
6
=(
şick_6
 *)(
icmp6
+1);

238 ià(
icmp6_code
 ==2 || icmp6_code ==0)

240 
icmp_Ëngth
 = 
·ylßd_Ëngth
-(
şick_icmp6_·¿m´ob
)+(
şick_icmp_·¿m´ob
);

241 
q2
 = 
Pack‘
::
	`make
(
icmp_Ëngth
);

242 
	`mem£t
(
q2
->
	`d©a
(), '\0', q2->
	`Ëngth
());

243 
şick_icmp_·¿m´ob
 *
icmp
 = (şick_icmp_·¿m´ob *)
q2
->
	`d©a
();

244 

 = (*)(
icmp
 +1);

245 
icmp
->
icmp_ty³
 = 
ICMP_PARAMPROB
;

246 
icmp
->
icmp_code
 = 0;

247 ià(
icmp6_code
 ==2) {

248 
icmp
->
icmp_poš‹r
 = -1;

250 if(
icmp6_code
 ==0)

252 
	`Áohl
(
icmp6
->
icmp6_poš‹r
)) {

253 0 : 
icmp
->
icmp_poš‹r
 = 0; ;

254 4 : 
icmp
->
icmp_poš‹r
 = 2; ;

255 7 : 
icmp
->
icmp_poš‹r
 = 8; ;

256 6 : 
icmp
->
icmp_poš‹r
 = 9; ;

257 8 : 
icmp
->
icmp_poš‹r
 = 12; ;

258 24: 
icmp
->
icmp_poš‹r
 = -1; ;

263 
	`memıy
(

, 
6
, (
·ylßd_Ëngth
 - (
şick_icmp6_·¿m´ob
)));

264 
icmp
->
icmp_cksum
 = 
	`şick_š_cksum
((*)icmp, 
icmp_Ëngth
);

267 ià(
icmp6_code
 ==1)

269 
icmp_Ëngth
 = 
·ylßd_Ëngth
-(
şick_icmp6_·¿m´ob
)+(
şick_icmp_uÄ—ch
);

270 
q2
 = 
Pack‘
::
	`make
(
icmp_Ëngth
);

271 
	`mem£t
(
q2
->
	`d©a
(), '\0', q2->
	`Ëngth
());

272 
şick_icmp_uÄ—ch
 *
icmp
 = (şick_icmp_uÄ—ch *)
q2
->
	`d©a
();

274 

 = (*)(
icmp
 +1);

275 
icmp
->
icmp_ty³
 = 
ICMP_UNREACH
;

276 
icmp
->
icmp_code
 = 2;

277 
	`memıy
(

, 
6
, (
·ylßd_Ëngth
 - (
şick_icmp6_·¿m´ob
)));

278 
icmp
->
icmp_cksum
 = 
	`şick_š_cksum
((*)icmp, 
icmp_Ëngth
);

286  
q2
;

287 
	}
}

293 
	gPrÙocŞT¿n¦©Ü64
::
	$push
(, 
Pack‘
 *
p
)

295 
	`hªdË_6
(
p
);

296 
	}
}

300 
	gPrÙocŞT¿n¦©Ü64
::
	$hªdË_6
(
Pack‘
 *
p
)

302 
şick_6
 *
6
 = (şick_6 *è
p
->
	`d©a
();

303 
IP6Add»ss
 
6_d¡
 = 
	`IP6Add»ss
(
6
->ip6_dst);

304 
IP6Add»ss
 
6_¤c
 = 
	`IP6Add»ss
(
6
->ip6_src);

306 
IPAdd»ss
 
a_d¡
 = 
6_d¡
.
	`4_add»ss
(), 
a_¤c
 = 
6_¤c
.ip4_address();

307 ià(
a_d¡
 && 
a_¤c
)

311 * 
¡¬t_of_p
ğ(*)(
6
+1);

312 
Pack‘
 *
q
 = 0;

313 
q
 = 
	`make_Œª¦©e64
(
a_¤c
, 
a_d¡
, 
6
, 
¡¬t_of_p
);

316 ià(
6
->
6_nxt
 == 0x3a)

318 
şick_
 * 
4
ğ(şick_ *)
q
->
	`d©a
();

319 * 
icmp6
 = (*)(
4
+1);

321 
Pack‘
 *
q2
 = 0;

322 
q2
 = 
	`make_icmp_Œª¦©e64
(
icmp6
, (
q
->
	`Ëngth
()-(
şick_
)));

323 
Wr™abËPack‘
 *
q3
=
Pack‘
::
	`make
((
şick_
)+
q2
->
	`Ëngth
());

324 
	`mem£t
(
q3
->
	`d©a
(), '\0', q3->
	`Ëngth
());

325 
şick_
 *

 = (şick_ *)
q3
->
	`d©a
();

326 
	`memıy
(

, 
q
->
	`d©a
(), (
şick_
));

327 *
¡¬t_of_icmp
 = (*)(

+1);

328 
	`memıy
(
¡¬t_of_icmp
, 
q2
->
	`d©a
(), q2->
	`Ëngth
());

329 

->
_Ën
 = 
	`htÚs
(
q3
->
	`Ëngth
());

330 

->
_sum
=0;

331 

->
_sum
 = 
	`şick_š_cksum
((*), 
q3
->
	`Ëngth
());

333 
p
->
	`kl
();

334 
q
->
	`kl
();

335 
q2
->
	`kl
();

336 
	`ouut
(0).
	`push
(
q3
);

340 
p
->
	`kl
();

341 
	`ouut
(0).
	`push
(
q
);

347 
p
->
	`kl
();

350 
	}
}

352 
CLICK_ENDDECLS


353 
EXPORT_ELEMENT
(
PrÙocŞT¿n¦©Ü64
)

	@ip6/protocoltranslator64.hh

1 #iâdeà
CLICK_PROTOCOLTRANSLATOR64_HH


2 
	#CLICK_PROTOCOLTRANSLATOR64_HH


	)

3 
	~<şick/6add»ss.hh
>

4 
	~<şick/add»ss.hh
>

5 
	~<şick/veùÜ.hh
>

6 
	~<şick/–em’t.hh
>

7 
CLICK_DECLS


28 şas 
	cPrÙocŞT¿n¦©Ü64
 : 
public
 
EËm’t
 {

31 
public
:

33 
PrÙocŞT¿n¦©Ü64
();

34 ~
PrÙocŞT¿n¦©Ü64
();

36 cÚ¡ *
	$şass_Çme
() const {  "ProtocolTranslator64"; }

37 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

38 
push
(
pÜt
, 
Pack‘
 *
p
);

39 
hªdË_6
(
Pack‘
 *);

41 
	g´iv©e
:

43 
Pack‘
 * 
make_icmp_Œª¦©e64
(*
a
,

44 
·ylßd_Ëngth
);

46 
Pack‘
 * 
make_Œª¦©e64
(
IPAdd»ss
 
¤c
,

47 
IPAdd»ss
 
d¡
,

48 
şick_6
 * 
6
,

49 *
a
);

55 
	gCLICK_ENDDECLS


	@ip6/setip6address.cc

19 
	~<şick/cÚfig.h
>

20 
	~"£t6add»ss.hh
"

21 
	~<şick/¬gs.hh
>

22 
CLICK_DECLS


24 
	gS‘IP6Add»ss
::
	$S‘IP6Add»ss
()

26 
	}
}

28 
S‘IP6Add»ss
::~
	$S‘IP6Add»ss
()

30 
	}
}

33 
S‘IP6Add»ss
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

35  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("IPADDR", 
_6
).
com¶‘e
();

38 
Pack‘
 *

39 
	gS‘IP6Add»ss
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

41 
	`SET_DST_IP6_ANNO
(
p
, 
_6
);

42  
p
;

43 
	}
}

45 
CLICK_ENDDECLS


46 
EXPORT_ELEMENT
(
S‘IP6Add»ss
)

	@ip6/setip6address.hh

1 #iâdeà
SETIP6ADDRESS_HH


2 
	#SETIP6ADDRESS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/6add»ss.hh
>

5 
CLICK_DECLS


19 şas 
	cS‘IP6Add»ss
 : 
public
 
EËm’t
 {

21 
IP6Add»ss
 
_6
;

23 
	mpublic
:

25 
S‘IP6Add»ss
();

26 ~
S‘IP6Add»ss
();

28 cÚ¡ *
	$şass_Çme
() const {  "SetIP6Address"; }

29 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

31 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

33 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

37 
	gCLICK_ENDDECLS


	@ip6/setip6dscp.cc

18 
	~<şick/cÚfig.h
>

19 
	~"£t6dsı.hh
"

20 
	~<şickÃt/6.h
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gS‘IP6DSCP
::
	$S‘IP6DSCP
()

27 
	}
}

29 
S‘IP6DSCP
::~
	$S‘IP6DSCP
()

31 
	}
}

34 
S‘IP6DSCP
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
	gdsı_v®
;

37 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("DSCP", 
dsı_v®
).
com¶‘e
() < 0)

39 ià(
	gdsı_v®
 > 0x3F)

40  
	g”rh
->
”rÜ
("diffserv code…oint out of„ange");

43 
	g_dsı
 = 
htÚl
(
dsı_v®
 << 
IP6_DSCP_SHIFT
);

48 
šlše
 
Pack‘
 *

49 
	gS‘IP6DSCP
::
	$smaùiÚ
(
Pack‘
 *
p_š
)

51 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

52 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

53 
şick_6
 *
6
 = 
p
->
	`6_h—d”
();

54 
6
->
6_æow
 = (6->6_æow & 
	`htÚl
(~
IP6_DSCP_MASK
)è| 
_dsı
;

55  
p
;

56 
	}
}

59 
	gS‘IP6DSCP
::
	$push
(, 
Pack‘
 *
p
)

61 ià((
p
 = 
	`smaùiÚ
(p)) != 0)

62 
	`ouut
(0).
	`push
(
p
);

63 
	}
}

65 
Pack‘
 *

66 
	gS‘IP6DSCP
::
	$puÎ
()

68 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

69 ià(
p
)

70 
p
 = 
	`smaùiÚ
(p);

71  
p
;

72 
	}
}

75 
	gS‘IP6DSCP
::
	$add_hªdËrs
()

77 
	`add_»ad_hªdËr
("dsı", 
»ad_keywÜd_hªdËr
, "0 DSCP", 
HªdËr
::
CALM
);

78 
	`add_wr™e_hªdËr
("dsı", 
»cÚfigu»_keywÜd_hªdËr
, "0 DSCP");

79 
	}
}

81 
CLICK_ENDDECLS


82 
	$EXPORT_ELEMENT
(
S‘IP6DSCP
)

83 
	`ELEMENT_MT_SAFE
(
S‘IP6DSCP
)

	@ip6/setip6dscp.hh

1 #iâdeà
CLICK_SETIP6DSCP_HH


2 
	#CLICK_SETIP6DSCP_HH


	)

16 
	~<şick/–em’t.hh
>

17 
	~<şick/glue.hh
>

18 
	~<şickÃt/6.h
>

19 
CLICK_DECLS


21 şas 
	cS‘IP6DSCP
 : 
public
 
EËm’t
 {…ublic:

23 
S‘IP6DSCP
();

24 ~
S‘IP6DSCP
();

26 cÚ¡ *
	$şass_Çme
() const {  "SetIP6DSCP"; }

27 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

29 
ušt8_t
 
	$dsı
(ècÚ¡ {  
	`Áohl
(
_dsı
è>> 
IP6_DSCP_SHIFT
; 
	}
}

31 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

32 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

33 
	$add_hªdËrs
(è
CLICK_COLD
;

35 
šlše
 
Pack‘
 *
	`smaùiÚ
(Pack‘ *
p
);

36 
	`push
(
pÜt
, 
Pack‘
 *
p
);

37 
Pack‘
 *
	`puÎ
(
pÜt
);

39 
´iv©e
:

41 
ušt32_t
 
_dsı
;

43 
	}
};

45 
	gCLICK_ENDDECLS


	@ipsec/aes.cc

22 
	~<şick/cÚfig.h
>

23 #iâdeà
HAVE_IPSEC


26 
	~"«s.hh
"

27 
	~"e¥.hh
"

28 
	~<şick/add»ss.hh
>

29 
	~<şick/¬gs.hh
>

30 
	~<şick/”rÜ.hh
>

31 
	~<şick/glue.hh
>

32 
	~<şick/·ck‘_ªno.hh
>

33 
	~"§d©©u¶e.hh
"

35 
CLICK_DECLS


37 
	gAes
::
	$Aes
()

38 : 
	$_İ
(0)

40 
	}
}

42 
Aes
::~
	$Aes
()

44 
	}
}

46 
Aes
::
	$Aes
(
deüy±
)

48 
_İ
 = 
deüy±
;

49 
	}
}

52 
	gAes
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

54 
	gdec_št
;

55 
	g_ignÜe
 = 12;

57 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("ENCRYPT", 
dec_št
).
com¶‘e
() < 0)

59 
	g_İ
 = 
dec_št
;

64 
	gAes
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

67 
	}
}

69 
Pack‘
 *

70 
	gAes
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

73 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

74 
hŞd
[8];

75 
e¥_Ãw
 *
e¥
 = (e¥_Ãw *)
p
->
	`d©a
();

76 
SAD©aTu¶e
 * 
§_d©a
;

77 
iv
[8];

78 *
ivp
 = 
e¥
->
e¥_iv
;

79 * 
id©
 = 
p
->
	`d©a
(è+ (
e¥_Ãw
);

80 
¶’
 = 
p
->
	`Ëngth
(è- (
e¥_Ãw
è- 
_ignÜe
;

81 
i
;

87 ià((
¶’
 % 16) != 0) {…len += 8; }

88 
i
 = 
¶’
;

90 
§_d©a
 =(
SAD©aTu¶e
 *)
	`IPSEC_SA_DATA_REFERENCE_ANNO
(
p
);

92 ià(
_İ
 =ğ
AES_DECRYPT
) {

93 
	`memıy
(
iv
, 
ivp
, 8);

94 if(
§_d©a
==
NULL
) {

95 
	`şick_ch©‹r
("AES: No SADataTuple„eference‡nnotation. check man…age\n");

96 
p
->
	`kl
();

100 
	`AES_£t_deüy±_key
((cÚ¡ *)&
§_d©a
->
Enüy±iÚ_key
, 128, &
_key
);

102 if(
§_d©a
==
NULL
) {

103 
	`şick_ch©‹r
("AES: No SADataTuple‡nnotation. This module is‚ot…roperly…laced check man…age\n");

104 
p
->
	`kl
();

107 
	`AES_£t_’üy±_key
((cÚ¡ *)&
§_d©a
->
Enüy±iÚ_key
, 128,&
_key
);

110 #ifdeà
DEBUG


111 
	`şick_ch©‹r
("Key: %x%x%x%x%x%x%x%x",
§_d©a
->
Enüy±iÚ_key
[0], sa_data->Encryption_key[1], sa_data->Encryption_key[2], sa_data->Encryption_key[3],sa_data->Encryption_key[4], sa_data->Encryption_key[5], sa_data->Encryption_key[6], sa_data->Encryption_key[7]);

115 
¶’
 > 0) {

117 if(
_İ
 =ğ
AES_DECRYPT
) {

118 
	`memıy
(
hŞd
, 
id©
, 8);

119 
	`AES_deüy±
((cÚ¡ *)
id©
, (*)id©, (cÚ¡ 
AES_KEY
 *)&
_key
);

121 
i
 = 0; i < 8; i++)

122 
id©
[
i
] ^ğ
ivp
[i];

123 
	`memıy
(
ivp
, 
hŞd
, 8);

126 
i
 = 0; i < 8; i++)

127 
id©
[
i
] ^ğ
ivp
[i];

128 
	`AES_’üy±
((cÚ¡ *)
id©
, (*)id©,&
_key
);

129 
ivp
 = 
id©
;

131 
id©
 += 16;

132 
¶’
 -= 16;

134 ià(
_İ
 =ğ
AES_DECRYPT
)

135 
	`memıy
(
ivp
, 
iv
, 8);

137 (
p
);

138 
	}
}

142 cÚ¡ 
	gTe0
[256] = {

208 cÚ¡ 
	gTe1
[256] = {

274 cÚ¡ 
	gTe2
[256] = {

340 cÚ¡ 
	gTe3
[256] = {

406 cÚ¡ 
	gTe4
[256] = {

473 cÚ¡ 
	gTd0
[256] = {

539 cÚ¡ 
	gTd1
[256] = {

605 cÚ¡ 
	gTd2
[256] = {

671 cÚ¡ 
	gTd3
[256] = {

738 cÚ¡ 
	gTd4
[256] = {

805 cÚ¡ 
	grcÚ
[] = {

814 
	gAes
::
	$AES_£t_’üy±_key
(cÚ¡ *
u£rKey
, cÚ¡ 
b™s
,

815 
AES_KEY
 *
key
)

818 *
rk
;

819 
i
 = 0;

820 
‹mp
;

822 ià(!
u£rKey
 || !
key
)

824 ià(
b™s
 != 128 && bits != 192 && bits != 256)

827 
rk
 = 
key
->
rd_key
;

829 ià(
b™s
==128)

830 
key
->
rounds
 = 10;

831 ià(
b™s
==192)

832 
key
->
rounds
 = 12;

834 
key
->
rounds
 = 14;

836 
rk
[0] = 
	`GETU32
(
u£rKey
 );

837 
rk
[1] = 
	`GETU32
(
u£rKey
 + 4);

838 
rk
[2] = 
	`GETU32
(
u£rKey
 + 8);

839 
rk
[3] = 
	`GETU32
(
u£rKey
 + 12);

840 ià(
b™s
 == 128) {

842 
‹mp
 = 
rk
[3];

843 
rk
[4] =„k[0] ^

844 (
Te4
[(
‹mp
 >> 16) & 0xff] & 0xff000000) ^

845 (
Te4
[(
‹mp
 >> 8) & 0xff] & 0x00ff0000) ^

846 (
Te4
[(
‹mp
 ) & 0xff] & 0x0000ff00) ^

847 (
Te4
[(
‹mp
 >> 24) ] & 0x000000ff) ^

848 
rcÚ
[
i
];

849 
rk
[5] =„k[1] ^„k[4];

850 
rk
[6] =„k[2] ^„k[5];

851 
rk
[7] =„k[3] ^„k[6];

852 ià(++
i
 == 10) {

855 
rk
 += 4;

858 
rk
[4] = 
	`GETU32
(
u£rKey
 + 16);

859 
rk
[5] = 
	`GETU32
(
u£rKey
 + 20);

860 ià(
b™s
 == 192) {

862 
‹mp
 = 
rk
[ 5];

863 
rk
[ 6] =„k[ 0] ^

864 (
Te4
[(
‹mp
 >> 16) & 0xff] & 0xff000000) ^

865 (
Te4
[(
‹mp
 >> 8) & 0xff] & 0x00ff0000) ^

866 (
Te4
[(
‹mp
 ) & 0xff] & 0x0000ff00) ^

867 (
Te4
[(
‹mp
 >> 24) ] & 0x000000ff) ^

868 
rcÚ
[
i
];

869 
rk
[ 7] =„k[ 1] ^„k[ 6];

870 
rk
[ 8] =„k[ 2] ^„k[ 7];

871 
rk
[ 9] =„k[ 3] ^„k[ 8];

872 ià(++
i
 == 8) {

875 
rk
[10] =„k[ 4] ^„k[ 9];

876 
rk
[11] =„k[ 5] ^„k[10];

877 
rk
 += 6;

880 
rk
[6] = 
	`GETU32
(
u£rKey
 + 24);

881 
rk
[7] = 
	`GETU32
(
u£rKey
 + 28);

882 ià(
b™s
 == 256) {

884 
‹mp
 = 
rk
[ 7];

885 
rk
[ 8] =„k[ 0] ^

886 (
Te4
[(
‹mp
 >> 16) & 0xff] & 0xff000000) ^

887 (
Te4
[(
‹mp
 >> 8) & 0xff] & 0x00ff0000) ^

888 (
Te4
[(
‹mp
 ) & 0xff] & 0x0000ff00) ^

889 (
Te4
[(
‹mp
 >> 24) ] & 0x000000ff) ^

890 
rcÚ
[
i
];

891 
rk
[ 9] =„k[ 1] ^„k[ 8];

892 
rk
[10] =„k[ 2] ^„k[ 9];

893 
rk
[11] =„k[ 3] ^„k[10];

894 ià(++
i
 == 7) {

897 
‹mp
 = 
rk
[11];

898 
rk
[12] =„k[ 4] ^

899 (
Te4
[(
‹mp
 >> 24) ] & 0xff000000) ^

900 (
Te4
[(
‹mp
 >> 16) & 0xff] & 0x00ff0000) ^

901 (
Te4
[(
‹mp
 >> 8) & 0xff] & 0x0000ff00) ^

902 (
Te4
[(
‹mp
 ) & 0xff] & 0x000000ff);

903 
rk
[13] =„k[ 5] ^„k[12];

904 
rk
[14] =„k[ 6] ^„k[13];

905 
rk
[15] =„k[ 7] ^„k[14];

907 
rk
 += 8;

911 
	}
}

916 
	gAes
::
	$AES_£t_deüy±_key
(cÚ¡ *
u£rKey
, cÚ¡ 
b™s
,

917 
AES_KEY
 *
key
) {

919 *
rk
;

920 
i
, 
j
, 
¡©us
;

921 
‹mp
;

924 
¡©us
 = 
	`AES_£t_’üy±_key
(
u£rKey
, 
b™s
, 
key
);

925 ià(
¡©us
 < 0)

926  
¡©us
;

928 
rk
 = 
key
->
rd_key
;

931 
i
 = 0, 
j
 = 4*(
key
->
rounds
); i < j; i += 4, j -= 4) {

932 
‹mp
 = 
rk
[
i
 ];„k[˜] =„k[
j
 ];„k[j ] =emp;

933 
‹mp
 = 
rk
[
i
 + 1];„k[˜+ 1] =„k[
j
 + 1];„k[j + 1] =emp;

934 
‹mp
 = 
rk
[
i
 + 2];„k[˜+ 2] =„k[
j
 + 2];„k[j + 2] =emp;

935 
‹mp
 = 
rk
[
i
 + 3];„k[˜+ 3] =„k[
j
 + 3];„k[j + 3] =emp;

938 
i
 = 1; i < (
key
->
rounds
); i++) {

939 
rk
 += 4;

940 
rk
[0] =

941 
Td0
[
Te4
[(
rk
[0] >> 24) ] & 0xff] ^

942 
Td1
[
Te4
[(
rk
[0] >> 16) & 0xff] & 0xff] ^

943 
Td2
[
Te4
[(
rk
[0] >> 8) & 0xff] & 0xff] ^

944 
Td3
[
Te4
[(
rk
[0] ) & 0xff] & 0xff];

945 
rk
[1] =

946 
Td0
[
Te4
[(
rk
[1] >> 24) ] & 0xff] ^

947 
Td1
[
Te4
[(
rk
[1] >> 16) & 0xff] & 0xff] ^

948 
Td2
[
Te4
[(
rk
[1] >> 8) & 0xff] & 0xff] ^

949 
Td3
[
Te4
[(
rk
[1] ) & 0xff] & 0xff];

950 
rk
[2] =

951 
Td0
[
Te4
[(
rk
[2] >> 24) ] & 0xff] ^

952 
Td1
[
Te4
[(
rk
[2] >> 16) & 0xff] & 0xff] ^

953 
Td2
[
Te4
[(
rk
[2] >> 8) & 0xff] & 0xff] ^

954 
Td3
[
Te4
[(
rk
[2] ) & 0xff] & 0xff];

955 
rk
[3] =

956 
Td0
[
Te4
[(
rk
[3] >> 24) ] & 0xff] ^

957 
Td1
[
Te4
[(
rk
[3] >> 16) & 0xff] & 0xff] ^

958 
Td2
[
Te4
[(
rk
[3] >> 8) & 0xff] & 0xff] ^

959 
Td3
[
Te4
[(
rk
[3] ) & 0xff] & 0xff];

962 
	}
}

968 
	gAes
::
	$AES_’üy±
(cÚ¡ *
š
, *
out
,

969 cÚ¡ 
AES_KEY
 *
key
) {

971 cÚ¡ *
rk
;

972 
s0
, 
s1
, 
s2
, 
s3
, 
t0
, 
t1
, 
t2
, 
t3
;

974 if(!(
š
 && 
out
 && 
key
)){
	`şick_ch©‹r
("AES Decrypt: Invalid Parameters");}

975 
rk
 = 
key
->
rd_key
;

981 
s0
 = 
	`GETU32
(
š
 ) ^ 
rk
[0];

982 
s1
 = 
	`GETU32
(
š
 + 4è^ 
rk
[1];

983 
s2
 = 
	`GETU32
(
š
 + 8è^ 
rk
[2];

984 
s3
 = 
	`GETU32
(
š
 + 12è^ 
rk
[3];

986 
t0
 = 
Te0
[
s0
 >> 24] ^ 
Te1
[(
s1
 >> 16è& 0xff] ^ 
Te2
[(
s2
 >> 8è& 0xff] ^ 
Te3
[
s3
 & 0xff] ^ 
rk
[ 4];

987 
t1
 = 
Te0
[
s1
 >> 24] ^ 
Te1
[(
s2
 >> 16è& 0xff] ^ 
Te2
[(
s3
 >> 8è& 0xff] ^ 
Te3
[
s0
 & 0xff] ^ 
rk
[ 5];

988 
t2
 = 
Te0
[
s2
 >> 24] ^ 
Te1
[(
s3
 >> 16è& 0xff] ^ 
Te2
[(
s0
 >> 8è& 0xff] ^ 
Te3
[
s1
 & 0xff] ^ 
rk
[ 6];

989 
t3
 = 
Te0
[
s3
 >> 24] ^ 
Te1
[(
s0
 >> 16è& 0xff] ^ 
Te2
[(
s1
 >> 8è& 0xff] ^ 
Te3
[
s2
 & 0xff] ^ 
rk
[ 7];

991 
s0
 = 
Te0
[
t0
 >> 24] ^ 
Te1
[(
t1
 >> 16è& 0xff] ^ 
Te2
[(
t2
 >> 8è& 0xff] ^ 
Te3
[
t3
 & 0xff] ^ 
rk
[ 8];

992 
s1
 = 
Te0
[
t1
 >> 24] ^ 
Te1
[(
t2
 >> 16è& 0xff] ^ 
Te2
[(
t3
 >> 8è& 0xff] ^ 
Te3
[
t0
 & 0xff] ^ 
rk
[ 9];

993 
s2
 = 
Te0
[
t2
 >> 24] ^ 
Te1
[(
t3
 >> 16è& 0xff] ^ 
Te2
[(
t0
 >> 8è& 0xff] ^ 
Te3
[
t1
 & 0xff] ^ 
rk
[10];

994 
s3
 = 
Te0
[
t3
 >> 24] ^ 
Te1
[(
t0
 >> 16è& 0xff] ^ 
Te2
[(
t1
 >> 8è& 0xff] ^ 
Te3
[
t2
 & 0xff] ^ 
rk
[11];

996 
t0
 = 
Te0
[
s0
 >> 24] ^ 
Te1
[(
s1
 >> 16è& 0xff] ^ 
Te2
[(
s2
 >> 8è& 0xff] ^ 
Te3
[
s3
 & 0xff] ^ 
rk
[12];

997 
t1
 = 
Te0
[
s1
 >> 24] ^ 
Te1
[(
s2
 >> 16è& 0xff] ^ 
Te2
[(
s3
 >> 8è& 0xff] ^ 
Te3
[
s0
 & 0xff] ^ 
rk
[13];

998 
t2
 = 
Te0
[
s2
 >> 24] ^ 
Te1
[(
s3
 >> 16è& 0xff] ^ 
Te2
[(
s0
 >> 8è& 0xff] ^ 
Te3
[
s1
 & 0xff] ^ 
rk
[14];

999 
t3
 = 
Te0
[
s3
 >> 24] ^ 
Te1
[(
s0
 >> 16è& 0xff] ^ 
Te2
[(
s1
 >> 8è& 0xff] ^ 
Te3
[
s2
 & 0xff] ^ 
rk
[15];

1001 
s0
 = 
Te0
[
t0
 >> 24] ^ 
Te1
[(
t1
 >> 16è& 0xff] ^ 
Te2
[(
t2
 >> 8è& 0xff] ^ 
Te3
[
t3
 & 0xff] ^ 
rk
[16];

1002 
s1
 = 
Te0
[
t1
 >> 24] ^ 
Te1
[(
t2
 >> 16è& 0xff] ^ 
Te2
[(
t3
 >> 8è& 0xff] ^ 
Te3
[
t0
 & 0xff] ^ 
rk
[17];

1003 
s2
 = 
Te0
[
t2
 >> 24] ^ 
Te1
[(
t3
 >> 16è& 0xff] ^ 
Te2
[(
t0
 >> 8è& 0xff] ^ 
Te3
[
t1
 & 0xff] ^ 
rk
[18];

1004 
s3
 = 
Te0
[
t3
 >> 24] ^ 
Te1
[(
t0
 >> 16è& 0xff] ^ 
Te2
[(
t1
 >> 8è& 0xff] ^ 
Te3
[
t2
 & 0xff] ^ 
rk
[19];

1006 
t0
 = 
Te0
[
s0
 >> 24] ^ 
Te1
[(
s1
 >> 16è& 0xff] ^ 
Te2
[(
s2
 >> 8è& 0xff] ^ 
Te3
[
s3
 & 0xff] ^ 
rk
[20];

1007 
t1
 = 
Te0
[
s1
 >> 24] ^ 
Te1
[(
s2
 >> 16è& 0xff] ^ 
Te2
[(
s3
 >> 8è& 0xff] ^ 
Te3
[
s0
 & 0xff] ^ 
rk
[21];

1008 
t2
 = 
Te0
[
s2
 >> 24] ^ 
Te1
[(
s3
 >> 16è& 0xff] ^ 
Te2
[(
s0
 >> 8è& 0xff] ^ 
Te3
[
s1
 & 0xff] ^ 
rk
[22];

1009 
t3
 = 
Te0
[
s3
 >> 24] ^ 
Te1
[(
s0
 >> 16è& 0xff] ^ 
Te2
[(
s1
 >> 8è& 0xff] ^ 
Te3
[
s2
 & 0xff] ^ 
rk
[23];

1011 
s0
 = 
Te0
[
t0
 >> 24] ^ 
Te1
[(
t1
 >> 16è& 0xff] ^ 
Te2
[(
t2
 >> 8è& 0xff] ^ 
Te3
[
t3
 & 0xff] ^ 
rk
[24];

1012 
s1
 = 
Te0
[
t1
 >> 24] ^ 
Te1
[(
t2
 >> 16è& 0xff] ^ 
Te2
[(
t3
 >> 8è& 0xff] ^ 
Te3
[
t0
 & 0xff] ^ 
rk
[25];

1013 
s2
 = 
Te0
[
t2
 >> 24] ^ 
Te1
[(
t3
 >> 16è& 0xff] ^ 
Te2
[(
t0
 >> 8è& 0xff] ^ 
Te3
[
t1
 & 0xff] ^ 
rk
[26];

1014 
s3
 = 
Te0
[
t3
 >> 24] ^ 
Te1
[(
t0
 >> 16è& 0xff] ^ 
Te2
[(
t1
 >> 8è& 0xff] ^ 
Te3
[
t2
 & 0xff] ^ 
rk
[27];

1016 
t0
 = 
Te0
[
s0
 >> 24] ^ 
Te1
[(
s1
 >> 16è& 0xff] ^ 
Te2
[(
s2
 >> 8è& 0xff] ^ 
Te3
[
s3
 & 0xff] ^ 
rk
[28];

1017 
t1
 = 
Te0
[
s1
 >> 24] ^ 
Te1
[(
s2
 >> 16è& 0xff] ^ 
Te2
[(
s3
 >> 8è& 0xff] ^ 
Te3
[
s0
 & 0xff] ^ 
rk
[29];

1018 
t2
 = 
Te0
[
s2
 >> 24] ^ 
Te1
[(
s3
 >> 16è& 0xff] ^ 
Te2
[(
s0
 >> 8è& 0xff] ^ 
Te3
[
s1
 & 0xff] ^ 
rk
[30];

1019 
t3
 = 
Te0
[
s3
 >> 24] ^ 
Te1
[(
s0
 >> 16è& 0xff] ^ 
Te2
[(
s1
 >> 8è& 0xff] ^ 
Te3
[
s2
 & 0xff] ^ 
rk
[31];

1021 
s0
 = 
Te0
[
t0
 >> 24] ^ 
Te1
[(
t1
 >> 16è& 0xff] ^ 
Te2
[(
t2
 >> 8è& 0xff] ^ 
Te3
[
t3
 & 0xff] ^ 
rk
[32];

1022 
s1
 = 
Te0
[
t1
 >> 24] ^ 
Te1
[(
t2
 >> 16è& 0xff] ^ 
Te2
[(
t3
 >> 8è& 0xff] ^ 
Te3
[
t0
 & 0xff] ^ 
rk
[33];

1023 
s2
 = 
Te0
[
t2
 >> 24] ^ 
Te1
[(
t3
 >> 16è& 0xff] ^ 
Te2
[(
t0
 >> 8è& 0xff] ^ 
Te3
[
t1
 & 0xff] ^ 
rk
[34];

1024 
s3
 = 
Te0
[
t3
 >> 24] ^ 
Te1
[(
t0
 >> 16è& 0xff] ^ 
Te2
[(
t1
 >> 8è& 0xff] ^ 
Te3
[
t2
 & 0xff] ^ 
rk
[35];

1026 
t0
 = 
Te0
[
s0
 >> 24] ^ 
Te1
[(
s1
 >> 16è& 0xff] ^ 
Te2
[(
s2
 >> 8è& 0xff] ^ 
Te3
[
s3
 & 0xff] ^ 
rk
[36];

1027 
t1
 = 
Te0
[
s1
 >> 24] ^ 
Te1
[(
s2
 >> 16è& 0xff] ^ 
Te2
[(
s3
 >> 8è& 0xff] ^ 
Te3
[
s0
 & 0xff] ^ 
rk
[37];

1028 
t2
 = 
Te0
[
s2
 >> 24] ^ 
Te1
[(
s3
 >> 16è& 0xff] ^ 
Te2
[(
s0
 >> 8è& 0xff] ^ 
Te3
[
s1
 & 0xff] ^ 
rk
[38];

1029 
t3
 = 
Te0
[
s3
 >> 24] ^ 
Te1
[(
s0
 >> 16è& 0xff] ^ 
Te2
[(
s1
 >> 8è& 0xff] ^ 
Te3
[
s2
 & 0xff] ^ 
rk
[39];

1030 ià(
key
->
rounds
 > 10) {

1032 
s0
 = 
Te0
[
t0
 >> 24] ^ 
Te1
[(
t1
 >> 16è& 0xff] ^ 
Te2
[(
t2
 >> 8è& 0xff] ^ 
Te3
[
t3
 & 0xff] ^ 
rk
[40];

1033 
s1
 = 
Te0
[
t1
 >> 24] ^ 
Te1
[(
t2
 >> 16è& 0xff] ^ 
Te2
[(
t3
 >> 8è& 0xff] ^ 
Te3
[
t0
 & 0xff] ^ 
rk
[41];

1034 
s2
 = 
Te0
[
t2
 >> 24] ^ 
Te1
[(
t3
 >> 16è& 0xff] ^ 
Te2
[(
t0
 >> 8è& 0xff] ^ 
Te3
[
t1
 & 0xff] ^ 
rk
[42];

1035 
s3
 = 
Te0
[
t3
 >> 24] ^ 
Te1
[(
t0
 >> 16è& 0xff] ^ 
Te2
[(
t1
 >> 8è& 0xff] ^ 
Te3
[
t2
 & 0xff] ^ 
rk
[43];

1037 
t0
 = 
Te0
[
s0
 >> 24] ^ 
Te1
[(
s1
 >> 16è& 0xff] ^ 
Te2
[(
s2
 >> 8è& 0xff] ^ 
Te3
[
s3
 & 0xff] ^ 
rk
[44];

1038 
t1
 = 
Te0
[
s1
 >> 24] ^ 
Te1
[(
s2
 >> 16è& 0xff] ^ 
Te2
[(
s3
 >> 8è& 0xff] ^ 
Te3
[
s0
 & 0xff] ^ 
rk
[45];

1039 
t2
 = 
Te0
[
s2
 >> 24] ^ 
Te1
[(
s3
 >> 16è& 0xff] ^ 
Te2
[(
s0
 >> 8è& 0xff] ^ 
Te3
[
s1
 & 0xff] ^ 
rk
[46];

1040 
t3
 = 
Te0
[
s3
 >> 24] ^ 
Te1
[(
s0
 >> 16è& 0xff] ^ 
Te2
[(
s1
 >> 8è& 0xff] ^ 
Te3
[
s2
 & 0xff] ^ 
rk
[47];

1041 ià(
key
->
rounds
 > 12) {

1043 
s0
 = 
Te0
[
t0
 >> 24] ^ 
Te1
[(
t1
 >> 16è& 0xff] ^ 
Te2
[(
t2
 >> 8è& 0xff] ^ 
Te3
[
t3
 & 0xff] ^ 
rk
[48];

1044 
s1
 = 
Te0
[
t1
 >> 24] ^ 
Te1
[(
t2
 >> 16è& 0xff] ^ 
Te2
[(
t3
 >> 8è& 0xff] ^ 
Te3
[
t0
 & 0xff] ^ 
rk
[49];

1045 
s2
 = 
Te0
[
t2
 >> 24] ^ 
Te1
[(
t3
 >> 16è& 0xff] ^ 
Te2
[(
t0
 >> 8è& 0xff] ^ 
Te3
[
t1
 & 0xff] ^ 
rk
[50];

1046 
s3
 = 
Te0
[
t3
 >> 24] ^ 
Te1
[(
t0
 >> 16è& 0xff] ^ 
Te2
[(
t1
 >> 8è& 0xff] ^ 
Te3
[
t2
 & 0xff] ^ 
rk
[51];

1048 
t0
 = 
Te0
[
s0
 >> 24] ^ 
Te1
[(
s1
 >> 16è& 0xff] ^ 
Te2
[(
s2
 >> 8è& 0xff] ^ 
Te3
[
s3
 & 0xff] ^ 
rk
[52];

1049 
t1
 = 
Te0
[
s1
 >> 24] ^ 
Te1
[(
s2
 >> 16è& 0xff] ^ 
Te2
[(
s3
 >> 8è& 0xff] ^ 
Te3
[
s0
 & 0xff] ^ 
rk
[53];

1050 
t2
 = 
Te0
[
s2
 >> 24] ^ 
Te1
[(
s3
 >> 16è& 0xff] ^ 
Te2
[(
s0
 >> 8è& 0xff] ^ 
Te3
[
s1
 & 0xff] ^ 
rk
[54];

1051 
t3
 = 
Te0
[
s3
 >> 24] ^ 
Te1
[(
s0
 >> 16è& 0xff] ^ 
Te2
[(
s1
 >> 8è& 0xff] ^ 
Te3
[
s2
 & 0xff] ^ 
rk
[55];

1054 
rk
 +ğ
key
->
rounds
 << 2;

1058 
s0
 =

1059 (
Te4
[(
t0
 >> 24) ] & 0xff000000) ^

1060 (
Te4
[(
t1
 >> 16) & 0xff] & 0x00ff0000) ^

1061 (
Te4
[(
t2
 >> 8) & 0xff] & 0x0000ff00) ^

1062 (
Te4
[(
t3
 ) & 0xff] & 0x000000ff) ^

1063 
rk
[0];

1064 
	`PUTU32
(
out
 , 
s0
);

1065 
s1
 =

1066 (
Te4
[(
t1
 >> 24) ] & 0xff000000) ^

1067 (
Te4
[(
t2
 >> 16) & 0xff] & 0x00ff0000) ^

1068 (
Te4
[(
t3
 >> 8) & 0xff] & 0x0000ff00) ^

1069 (
Te4
[(
t0
 ) & 0xff] & 0x000000ff) ^

1070 
rk
[1];

1071 
	`PUTU32
(
out
 + 4, 
s1
);

1072 
s2
 =

1073 (
Te4
[(
t2
 >> 24) ] & 0xff000000) ^

1074 (
Te4
[(
t3
 >> 16) & 0xff] & 0x00ff0000) ^

1075 (
Te4
[(
t0
 >> 8) & 0xff] & 0x0000ff00) ^

1076 (
Te4
[(
t1
 ) & 0xff] & 0x000000ff) ^

1077 
rk
[2];

1078 
	`PUTU32
(
out
 + 8, 
s2
);

1079 
s3
 =

1080 (
Te4
[(
t3
 >> 24) ] & 0xff000000) ^

1081 (
Te4
[(
t0
 >> 16) & 0xff] & 0x00ff0000) ^

1082 (
Te4
[(
t1
 >> 8) & 0xff] & 0x0000ff00) ^

1083 (
Te4
[(
t2
 ) & 0xff] & 0x000000ff) ^

1084 
rk
[3];

1085 
	`PUTU32
(
out
 + 12, 
s3
);

1086 
	}
}

1092 
	gAes
::
	$AES_deüy±
(cÚ¡ *
š
, *
out
,

1093 cÚ¡ 
AES_KEY
 *
key
) {

1095 cÚ¡ *
rk
;

1096 
s0
, 
s1
, 
s2
, 
s3
, 
t0
, 
t1
, 
t2
, 
t3
;

1097 if(!(
š
 && 
out
 && 
key
)è{
	`şick_ch©‹r
("AES_Decrypt: Invalid Parameters");}

1098 
rk
 = 
key
->
rd_key
;

1104 
s0
 = 
	`GETU32
(
š
 ) ^ 
rk
[0];

1105 
s1
 = 
	`GETU32
(
š
 + 4è^ 
rk
[1];

1106 
s2
 = 
	`GETU32
(
š
 + 8è^ 
rk
[2];

1107 
s3
 = 
	`GETU32
(
š
 + 12è^ 
rk
[3];

1109 
t0
 = 
Td0
[
s0
 >> 24] ^ 
Td1
[(
s3
 >> 16è& 0xff] ^ 
Td2
[(
s2
 >> 8è& 0xff] ^ 
Td3
[
s1
 & 0xff] ^ 
rk
[ 4];

1110 
t1
 = 
Td0
[
s1
 >> 24] ^ 
Td1
[(
s0
 >> 16è& 0xff] ^ 
Td2
[(
s3
 >> 8è& 0xff] ^ 
Td3
[
s2
 & 0xff] ^ 
rk
[ 5];

1111 
t2
 = 
Td0
[
s2
 >> 24] ^ 
Td1
[(
s1
 >> 16è& 0xff] ^ 
Td2
[(
s0
 >> 8è& 0xff] ^ 
Td3
[
s3
 & 0xff] ^ 
rk
[ 6];

1112 
t3
 = 
Td0
[
s3
 >> 24] ^ 
Td1
[(
s2
 >> 16è& 0xff] ^ 
Td2
[(
s1
 >> 8è& 0xff] ^ 
Td3
[
s0
 & 0xff] ^ 
rk
[ 7];

1114 
s0
 = 
Td0
[
t0
 >> 24] ^ 
Td1
[(
t3
 >> 16è& 0xff] ^ 
Td2
[(
t2
 >> 8è& 0xff] ^ 
Td3
[
t1
 & 0xff] ^ 
rk
[ 8];

1115 
s1
 = 
Td0
[
t1
 >> 24] ^ 
Td1
[(
t0
 >> 16è& 0xff] ^ 
Td2
[(
t3
 >> 8è& 0xff] ^ 
Td3
[
t2
 & 0xff] ^ 
rk
[ 9];

1116 
s2
 = 
Td0
[
t2
 >> 24] ^ 
Td1
[(
t1
 >> 16è& 0xff] ^ 
Td2
[(
t0
 >> 8è& 0xff] ^ 
Td3
[
t3
 & 0xff] ^ 
rk
[10];

1117 
s3
 = 
Td0
[
t3
 >> 24] ^ 
Td1
[(
t2
 >> 16è& 0xff] ^ 
Td2
[(
t1
 >> 8è& 0xff] ^ 
Td3
[
t0
 & 0xff] ^ 
rk
[11];

1119 
t0
 = 
Td0
[
s0
 >> 24] ^ 
Td1
[(
s3
 >> 16è& 0xff] ^ 
Td2
[(
s2
 >> 8è& 0xff] ^ 
Td3
[
s1
 & 0xff] ^ 
rk
[12];

1120 
t1
 = 
Td0
[
s1
 >> 24] ^ 
Td1
[(
s0
 >> 16è& 0xff] ^ 
Td2
[(
s3
 >> 8è& 0xff] ^ 
Td3
[
s2
 & 0xff] ^ 
rk
[13];

1121 
t2
 = 
Td0
[
s2
 >> 24] ^ 
Td1
[(
s1
 >> 16è& 0xff] ^ 
Td2
[(
s0
 >> 8è& 0xff] ^ 
Td3
[
s3
 & 0xff] ^ 
rk
[14];

1122 
t3
 = 
Td0
[
s3
 >> 24] ^ 
Td1
[(
s2
 >> 16è& 0xff] ^ 
Td2
[(
s1
 >> 8è& 0xff] ^ 
Td3
[
s0
 & 0xff] ^ 
rk
[15];

1124 
s0
 = 
Td0
[
t0
 >> 24] ^ 
Td1
[(
t3
 >> 16è& 0xff] ^ 
Td2
[(
t2
 >> 8è& 0xff] ^ 
Td3
[
t1
 & 0xff] ^ 
rk
[16];

1125 
s1
 = 
Td0
[
t1
 >> 24] ^ 
Td1
[(
t0
 >> 16è& 0xff] ^ 
Td2
[(
t3
 >> 8è& 0xff] ^ 
Td3
[
t2
 & 0xff] ^ 
rk
[17];

1126 
s2
 = 
Td0
[
t2
 >> 24] ^ 
Td1
[(
t1
 >> 16è& 0xff] ^ 
Td2
[(
t0
 >> 8è& 0xff] ^ 
Td3
[
t3
 & 0xff] ^ 
rk
[18];

1127 
s3
 = 
Td0
[
t3
 >> 24] ^ 
Td1
[(
t2
 >> 16è& 0xff] ^ 
Td2
[(
t1
 >> 8è& 0xff] ^ 
Td3
[
t0
 & 0xff] ^ 
rk
[19];

1129 
t0
 = 
Td0
[
s0
 >> 24] ^ 
Td1
[(
s3
 >> 16è& 0xff] ^ 
Td2
[(
s2
 >> 8è& 0xff] ^ 
Td3
[
s1
 & 0xff] ^ 
rk
[20];

1130 
t1
 = 
Td0
[
s1
 >> 24] ^ 
Td1
[(
s0
 >> 16è& 0xff] ^ 
Td2
[(
s3
 >> 8è& 0xff] ^ 
Td3
[
s2
 & 0xff] ^ 
rk
[21];

1131 
t2
 = 
Td0
[
s2
 >> 24] ^ 
Td1
[(
s1
 >> 16è& 0xff] ^ 
Td2
[(
s0
 >> 8è& 0xff] ^ 
Td3
[
s3
 & 0xff] ^ 
rk
[22];

1132 
t3
 = 
Td0
[
s3
 >> 24] ^ 
Td1
[(
s2
 >> 16è& 0xff] ^ 
Td2
[(
s1
 >> 8è& 0xff] ^ 
Td3
[
s0
 & 0xff] ^ 
rk
[23];

1134 
s0
 = 
Td0
[
t0
 >> 24] ^ 
Td1
[(
t3
 >> 16è& 0xff] ^ 
Td2
[(
t2
 >> 8è& 0xff] ^ 
Td3
[
t1
 & 0xff] ^ 
rk
[24];

1135 
s1
 = 
Td0
[
t1
 >> 24] ^ 
Td1
[(
t0
 >> 16è& 0xff] ^ 
Td2
[(
t3
 >> 8è& 0xff] ^ 
Td3
[
t2
 & 0xff] ^ 
rk
[25];

1136 
s2
 = 
Td0
[
t2
 >> 24] ^ 
Td1
[(
t1
 >> 16è& 0xff] ^ 
Td2
[(
t0
 >> 8è& 0xff] ^ 
Td3
[
t3
 & 0xff] ^ 
rk
[26];

1137 
s3
 = 
Td0
[
t3
 >> 24] ^ 
Td1
[(
t2
 >> 16è& 0xff] ^ 
Td2
[(
t1
 >> 8è& 0xff] ^ 
Td3
[
t0
 & 0xff] ^ 
rk
[27];

1139 
t0
 = 
Td0
[
s0
 >> 24] ^ 
Td1
[(
s3
 >> 16è& 0xff] ^ 
Td2
[(
s2
 >> 8è& 0xff] ^ 
Td3
[
s1
 & 0xff] ^ 
rk
[28];

1140 
t1
 = 
Td0
[
s1
 >> 24] ^ 
Td1
[(
s0
 >> 16è& 0xff] ^ 
Td2
[(
s3
 >> 8è& 0xff] ^ 
Td3
[
s2
 & 0xff] ^ 
rk
[29];

1141 
t2
 = 
Td0
[
s2
 >> 24] ^ 
Td1
[(
s1
 >> 16è& 0xff] ^ 
Td2
[(
s0
 >> 8è& 0xff] ^ 
Td3
[
s3
 & 0xff] ^ 
rk
[30];

1142 
t3
 = 
Td0
[
s3
 >> 24] ^ 
Td1
[(
s2
 >> 16è& 0xff] ^ 
Td2
[(
s1
 >> 8è& 0xff] ^ 
Td3
[
s0
 & 0xff] ^ 
rk
[31];

1144 
s0
 = 
Td0
[
t0
 >> 24] ^ 
Td1
[(
t3
 >> 16è& 0xff] ^ 
Td2
[(
t2
 >> 8è& 0xff] ^ 
Td3
[
t1
 & 0xff] ^ 
rk
[32];

1145 
s1
 = 
Td0
[
t1
 >> 24] ^ 
Td1
[(
t0
 >> 16è& 0xff] ^ 
Td2
[(
t3
 >> 8è& 0xff] ^ 
Td3
[
t2
 & 0xff] ^ 
rk
[33];

1146 
s2
 = 
Td0
[
t2
 >> 24] ^ 
Td1
[(
t1
 >> 16è& 0xff] ^ 
Td2
[(
t0
 >> 8è& 0xff] ^ 
Td3
[
t3
 & 0xff] ^ 
rk
[34];

1147 
s3
 = 
Td0
[
t3
 >> 24] ^ 
Td1
[(
t2
 >> 16è& 0xff] ^ 
Td2
[(
t1
 >> 8è& 0xff] ^ 
Td3
[
t0
 & 0xff] ^ 
rk
[35];

1149 
t0
 = 
Td0
[
s0
 >> 24] ^ 
Td1
[(
s3
 >> 16è& 0xff] ^ 
Td2
[(
s2
 >> 8è& 0xff] ^ 
Td3
[
s1
 & 0xff] ^ 
rk
[36];

1150 
t1
 = 
Td0
[
s1
 >> 24] ^ 
Td1
[(
s0
 >> 16è& 0xff] ^ 
Td2
[(
s3
 >> 8è& 0xff] ^ 
Td3
[
s2
 & 0xff] ^ 
rk
[37];

1151 
t2
 = 
Td0
[
s2
 >> 24] ^ 
Td1
[(
s1
 >> 16è& 0xff] ^ 
Td2
[(
s0
 >> 8è& 0xff] ^ 
Td3
[
s3
 & 0xff] ^ 
rk
[38];

1152 
t3
 = 
Td0
[
s3
 >> 24] ^ 
Td1
[(
s2
 >> 16è& 0xff] ^ 
Td2
[(
s1
 >> 8è& 0xff] ^ 
Td3
[
s0
 & 0xff] ^ 
rk
[39];

1153 ià(
key
->
rounds
 > 10) {

1155 
s0
 = 
Td0
[
t0
 >> 24] ^ 
Td1
[(
t3
 >> 16è& 0xff] ^ 
Td2
[(
t2
 >> 8è& 0xff] ^ 
Td3
[
t1
 & 0xff] ^ 
rk
[40];

1156 
s1
 = 
Td0
[
t1
 >> 24] ^ 
Td1
[(
t0
 >> 16è& 0xff] ^ 
Td2
[(
t3
 >> 8è& 0xff] ^ 
Td3
[
t2
 & 0xff] ^ 
rk
[41];

1157 
s2
 = 
Td0
[
t2
 >> 24] ^ 
Td1
[(
t1
 >> 16è& 0xff] ^ 
Td2
[(
t0
 >> 8è& 0xff] ^ 
Td3
[
t3
 & 0xff] ^ 
rk
[42];

1158 
s3
 = 
Td0
[
t3
 >> 24] ^ 
Td1
[(
t2
 >> 16è& 0xff] ^ 
Td2
[(
t1
 >> 8è& 0xff] ^ 
Td3
[
t0
 & 0xff] ^ 
rk
[43];

1160 
t0
 = 
Td0
[
s0
 >> 24] ^ 
Td1
[(
s3
 >> 16è& 0xff] ^ 
Td2
[(
s2
 >> 8è& 0xff] ^ 
Td3
[
s1
 & 0xff] ^ 
rk
[44];

1161 
t1
 = 
Td0
[
s1
 >> 24] ^ 
Td1
[(
s0
 >> 16è& 0xff] ^ 
Td2
[(
s3
 >> 8è& 0xff] ^ 
Td3
[
s2
 & 0xff] ^ 
rk
[45];

1162 
t2
 = 
Td0
[
s2
 >> 24] ^ 
Td1
[(
s1
 >> 16è& 0xff] ^ 
Td2
[(
s0
 >> 8è& 0xff] ^ 
Td3
[
s3
 & 0xff] ^ 
rk
[46];

1163 
t3
 = 
Td0
[
s3
 >> 24] ^ 
Td1
[(
s2
 >> 16è& 0xff] ^ 
Td2
[(
s1
 >> 8è& 0xff] ^ 
Td3
[
s0
 & 0xff] ^ 
rk
[47];

1164 ià(
key
->
rounds
 > 12) {

1166 
s0
 = 
Td0
[
t0
 >> 24] ^ 
Td1
[(
t3
 >> 16è& 0xff] ^ 
Td2
[(
t2
 >> 8è& 0xff] ^ 
Td3
[
t1
 & 0xff] ^ 
rk
[48];

1167 
s1
 = 
Td0
[
t1
 >> 24] ^ 
Td1
[(
t0
 >> 16è& 0xff] ^ 
Td2
[(
t3
 >> 8è& 0xff] ^ 
Td3
[
t2
 & 0xff] ^ 
rk
[49];

1168 
s2
 = 
Td0
[
t2
 >> 24] ^ 
Td1
[(
t1
 >> 16è& 0xff] ^ 
Td2
[(
t0
 >> 8è& 0xff] ^ 
Td3
[
t3
 & 0xff] ^ 
rk
[50];

1169 
s3
 = 
Td0
[
t3
 >> 24] ^ 
Td1
[(
t2
 >> 16è& 0xff] ^ 
Td2
[(
t1
 >> 8è& 0xff] ^ 
Td3
[
t0
 & 0xff] ^ 
rk
[51];

1171 
t0
 = 
Td0
[
s0
 >> 24] ^ 
Td1
[(
s3
 >> 16è& 0xff] ^ 
Td2
[(
s2
 >> 8è& 0xff] ^ 
Td3
[
s1
 & 0xff] ^ 
rk
[52];

1172 
t1
 = 
Td0
[
s1
 >> 24] ^ 
Td1
[(
s0
 >> 16è& 0xff] ^ 
Td2
[(
s3
 >> 8è& 0xff] ^ 
Td3
[
s2
 & 0xff] ^ 
rk
[53];

1173 
t2
 = 
Td0
[
s2
 >> 24] ^ 
Td1
[(
s1
 >> 16è& 0xff] ^ 
Td2
[(
s0
 >> 8è& 0xff] ^ 
Td3
[
s3
 & 0xff] ^ 
rk
[54];

1174 
t3
 = 
Td0
[
s3
 >> 24] ^ 
Td1
[(
s2
 >> 16è& 0xff] ^ 
Td2
[(
s1
 >> 8è& 0xff] ^ 
Td3
[
s0
 & 0xff] ^ 
rk
[55];

1177 
rk
 +ğ
key
->
rounds
 << 2;

1182 
s0
 =

1183 (
Td4
[(
t0
 >> 24) ] & 0xff000000) ^

1184 (
Td4
[(
t3
 >> 16) & 0xff] & 0x00ff0000) ^

1185 (
Td4
[(
t2
 >> 8) & 0xff] & 0x0000ff00) ^

1186 (
Td4
[(
t1
 ) & 0xff] & 0x000000ff) ^

1187 
rk
[0];

1188 
	`PUTU32
(
out
 , 
s0
);

1189 
s1
 =

1190 (
Td4
[(
t1
 >> 24) ] & 0xff000000) ^

1191 (
Td4
[(
t0
 >> 16) & 0xff] & 0x00ff0000) ^

1192 (
Td4
[(
t3
 >> 8) & 0xff] & 0x0000ff00) ^

1193 (
Td4
[(
t2
 ) & 0xff] & 0x000000ff) ^

1194 
rk
[1];

1195 
	`PUTU32
(
out
 + 4, 
s1
);

1196 
s2
 =

1197 (
Td4
[(
t2
 >> 24) ] & 0xff000000) ^

1198 (
Td4
[(
t1
 >> 16) & 0xff] & 0x00ff0000) ^

1199 (
Td4
[(
t0
 >> 8) & 0xff] & 0x0000ff00) ^

1200 (
Td4
[(
t3
 ) & 0xff] & 0x000000ff) ^

1201 
rk
[2];

1202 
	`PUTU32
(
out
 + 8, 
s2
);

1203 
s3
 =

1204 (
Td4
[(
t3
 >> 24) ] & 0xff000000) ^

1205 (
Td4
[(
t2
 >> 16) & 0xff] & 0x00ff0000) ^

1206 (
Td4
[(
t1
 >> 8) & 0xff] & 0x0000ff00) ^

1207 (
Td4
[(
t0
 ) & 0xff] & 0x000000ff) ^

1208 
rk
[3];

1209 
	`PUTU32
(
out
 + 12, 
s3
);

1210 
	}
}

1240 
CLICK_ENDDECLS


1241 
EXPORT_ELEMENT
(
Aes
)

	@ipsec/aes.hh

1 #iâdeà
CLICK_IPSECAES_HH


2 
	#CLICK_IPSECAES_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	gCLICK_DECLS


23 
	#GETU32
(
±
è((()Õt)[0] << 24è^ (()Õt)[1] << 16è^ (()Õt)[2] << 8è^ (()Õt)[3]))

	)

24 
	#PUTU32
(
ù
, 
¡
è{ (ù)[0] = ()((¡è>> 24); (ù)[1] = ()((¡è>> 16); (ù)[2] = ()((¡è>> 8); (ù)[3] = ()(¡); }

	)

27 
	#AES_MAXNR
 14

	)

28 
	#AES_BLOCK_SIZE
 16

	)

30 
	s«s_key_¡
 {

31 
	mrd_key
[4 *(
AES_MAXNR
 + 1)];

32 
	mrounds
;

34 
«s_key_¡
 
	tAES_KEY
;

37 
şass
 
	gAdd»ss
;

40 şas 
	cAes
 : 
public
 
EËm’t
 {

41 
public
:

42 
	$Aes
(è
CLICK_COLD
;

43 
	`Aes
();

44 ~
	$Aes
(è
CLICK_COLD
;

46 cÚ¡ *
	$şass_Çme
() const {  "IPsecAES"; }

47 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

49 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

50 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

52 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

54 ’um { 
AES_DECRYPT
 = 0, 
AES_ENCRYPT
 = 1 
	}
};

56 
	g´iv©e
:

57 
AES_£t_’üy±_key
(cÚ¡ *
u£rKey
, cÚ¡ 
b™s
, 
AES_KEY
 *
key
);

58 
AES_£t_deüy±_key
(cÚ¡ *
u£rKey
, cÚ¡ 
b™s
, 
AES_KEY
 *
key
);

59 
AES_’üy±
(cÚ¡ *
š
, *
out
,cÚ¡ 
AES_KEY
 *
key
);

60 
AES_deüy±
(cÚ¡ *
š
, *
out
,cÚ¡ 
AES_KEY
 *
key
);

61 
	g_İ
;

62 
	g_ignÜe
;

63 
AES_KEY
 
	g_key
;

66 
	gCLICK_ENDDECLS


	@ipsec/des.cc

24 
	~<şick/cÚfig.h
>

25 #iâdeà
HAVE_IPSEC


28 
	~"des.hh
"

29 
	~"e¥.hh
"

30 
	~<şick/add»ss.hh
>

31 
	~<şick/¬gs.hh
>

32 
	~<şick/”rÜ.hh
>

33 
	~<şick/glue.hh
>

34 
	~<şick/·ck‘_ªno.hh
>

35 
	~"§d©©u¶e.hh
"

37 
CLICK_DECLS


39 
	gDes
::
	$Des
()

40 : 
	$_İ
(0)

42 
	}
}

44 
Des
::~
	$Des
()

46 
	}
}

48 
Des
::
	$Des
(
deüy±
)

50 
_İ
 = 
deüy±
;

51 
	}
}

54 
	gDes
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

56 
	gdec_št
;

57 
	g_ignÜe
 = 12;

59 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("ENCRYPT", 
dec_št
).
com¶‘e
() < 0)

61 
	g_İ
 = 
dec_št
;

66 
	gDes
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

69 
	}
}

71 
Pack‘
 *

72 
	gDes
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

74 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

75 
hŞd
[8];

76 *
id©
 = 
p
->
	`d©a
();

77 
e¥_Ãw
 *
e¥
 = (e¥_Ãw *)
p
->
	`d©a
();

78 
des_cblock
 
iv
;

79 
SAD©aTu¶e
 * 
§_d©a
;

80 *
ivp
 = 
e¥
->
e¥_iv
;

81 
i
, 
¶’
 = 
p
->
	`Ëngth
(è- (
e¥_Ãw
è- 
_ignÜe
;

82 
id©
 = 
p
->
	`d©a
(è+ (
e¥_Ãw
);

84 ià(
_İ
 =ğ
DES_DECRYPT
è{ 
	`memıy
(
iv
, 
ivp
, 8);}

86 
§_d©a
 =(
SAD©aTu¶e
 *)
	`IPSEC_SA_DATA_REFERENCE_ANNO
(
p
);

88 if(
§_d©a
==
NULL
è{
	`şick_ch©‹r
("DES: NØSAD©aTu¶ªnÙ©iÚ. Check mª…age\n"); 
p
->
	`kl
();  0;}

90 
	`des_£t_key
(((*)[8])&
§_d©a
->
Enüy±iÚ_key
, 
_ks
);

93 
¶’
 > 0) {

94 if(
_İ
 =ğ
DES_DECRYPT
) {

95 
	`memıy
(
hŞd
, 
id©
, 8);

96 
	`des_ecb_’üy±
((
des_cblock
 *)
id©
, (des_cblock *)idat,

97 
_ks
, 
DES_DECRYPT
);

99 
i
 = 0; i < 8; i++)

100 
id©
[
i
] ^ğ
ivp
[i];

101 
	`memıy
(
ivp
, 
hŞd
, 8);

105 
i
 = 0; i < 8; i++)

106 
id©
[
i
] ^ğ
ivp
[i];

107 
	`des_ecb_’üy±
((
des_cblock
 *)
id©
, (des_cblock *)idat,

108 
_ks
, 
DES_ENCRYPT
);

109 
ivp
 = 
id©
;

111 
id©
 += 8;

112 
¶’
 -= 8;

115 ià(
_İ
 =ğ
DES_DECRYPT
)

116 
	`memıy
(
ivp
, 
iv
, 8);

117 (
p
);

118 
	}
}

123 
	#_
 
ks
.
_


	)

125 
	#ITERATIONS
 16

	)

127 
	#c2l
(
c
,
l
) (l =(()(*((c)++))) , \

128 
l
|=(()(*((
c
)++)))<< 8, \

129 
l
|=(()(*((
c
)++)))<<16, \

130 
l
|=(()(*((
c
)++)))<<24)

	)

133 
	#l2c
(
l
,
c
) (*((c)++)=()(((l) )&0xff), \

134 *((
c
)++)=()(((
l
)>> 8)&0xff), \

135 *((
c
)++)=()(((
l
)>>16)&0xff), \

136 *((
c
)++)=()(((
l
)>>24)&0xff))

	)

140 
	gdes_SPŒªs
[8][64]={

287 
	gdes_skb
[8][64]={

428 
	#PERM_OP
(
a
,
b
,
t
,
n
,
m
) ((t)=((((a)>>(n))^(b))&(m)),\

429 (
b
)^=(
t
),\

430 (
a
)=(×)^((
t
)<<(
n
))))

	)

432 
	#HPERM_OP
(
a
,
t
,
n
,
m
) ((t)=((((a)<<(16-(n)))^(a))&(m)),\

433 (
a
)=×)^(
t
)^Ñ>>(16-(
n
))))

	)

435 
	gshiás2
[16]={0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0};

438 
	#D_ENCRYPT
(
L
,
R
,
S
) \

439 
u
=(
R
^
s
[
S
 ]); \

440 
t
=
R
^
s
[
S
+1]; \

441 
t
=((t>>4)+(t<<28)); \

442 
L
^ğ
des_SPŒªs
[1][(
t
 )&0x3f]| \

443 
des_SPŒªs
[3][(
t
>> 8)&0x3f]| \

444 
des_SPŒªs
[5][(
t
>>16)&0x3f]| \

445 
des_SPŒªs
[7][(
t
>>24)&0x3f]| \

446 
des_SPŒªs
[0][(
u
 )&0x3f]| \

447 
des_SPŒªs
[2][(
u
>> 8)&0x3f]| \

448 
des_SPŒªs
[4][(
u
>>16)&0x3f]| \

449 
des_SPŒªs
[6][(
u
>>24)&0x3f];

	)

453 
	gDes
::
	$des_’üy±
(*
šput
,*
ouut
,

454 
des_key_scheduË
 
ks
,
’üy±
)

456 
l
,
r
,
t
,
u
;

457 
i
;

458 *
s
;

460 
l
=
šput
[0];

461 
r
=
šput
[1];

464 
	`PERM_OP
(
r
,
l
,
t
, 4,0x0f0f0f0f);

465 
	`PERM_OP
(
l
,
r
,
t
,16,0x0000ffff);

466 
	`PERM_OP
(
r
,
l
,
t
, 2,0x33333333);

467 
	`PERM_OP
(
l
,
r
,
t
, 8,0x00ff00ff);

468 
	`PERM_OP
(
r
,
l
,
t
, 1,0x55555555);

478 
t
=(
r
<<1)|(r>>31);

479 
r
=(
l
<<1)|(l>>31);

480 
l
=
t
;

483 
l
&=0xffffffff;

484 
r
&=0xffffffff;

486 
s
=(*)
ks
;

489 ià(
’üy±
)

491 
i
=0; i<32; i+=4)

493 
	`D_ENCRYPT
(
l
,
r
,
i
+0);

494 
	`D_ENCRYPT
(
r
,
l
,
i
+2);

499 
i
=30; i>0; i-=4)

501 
	`D_ENCRYPT
(
l
,
r
,
i
-0);

502 
	`D_ENCRYPT
(
r
,
l
,
i
-2);

505 
l
=(l>>1)|(l<<31);

506 
r
=(r>>1)|(r<<31);

508 
l
&=0xffffffff;

509 
r
&=0xffffffff;

516 
	`PERM_OP
(
r
,
l
,
t
, 1,0x55555555);

517 
	`PERM_OP
(
l
,
r
,
t
, 8,0x00ff00ff);

518 
	`PERM_OP
(
r
,
l
,
t
, 2,0x33333333);

519 
	`PERM_OP
(
l
,
r
,
t
,16,0x0000ffff);

520 
	`PERM_OP
(
r
,
l
,
t
, 4,0x0f0f0f0f);

522 
ouut
[0]=
l
;

523 
ouut
[1]=
r
;

524 
	}
}

527 
	gDes
::
	$des_ecb_’üy±
(
des_cblock
 *
šput
,des_cblock *
ouut
,

528 
des_key_scheduË
 
ks
, 
’üy±
)

530 
l0
,
l1
;

531 *
š
,*
out
;

532 
Î
[2];

534 
š
=(*)
šput
;

535 
out
=(*)
ouut
;

536 
	`c2l
(
š
,
l0
);

537 
	`c2l
(
š
,
l1
);

538 
Î
[0]=
l0
;

539 
Î
[1]=
l1
;

540 
	`des_’üy±
(
Î
,Î,
ks
,
’üy±
);

541 
l0
=
Î
[0];

542 
l1
=
Î
[1];

543 
	`l2c
(
l0
,
out
);

544 
	`l2c
(
l1
,
out
);

546 
	}
}

551 
	gDes
::
	$des_£t_key
(
des_cblock
 *
key
,
des_key_scheduË
 
scheduË
)

553 
c
,
d
,
t
,
s
;

554 *
š
;

555 *
k
;

556 
i
;

558 
k
=(*)
scheduË
;

559 
š
=(*)
key
;

561 
	`c2l
(
š
,
c
);

562 
	`c2l
(
š
,
d
);

567 
	`PERM_OP
 (
d
,
c
,
t
,4,0x0f0f0f0f);

568 
	`HPERM_OP
(
c
,
t
,-2,0xcccc0000);

569 
	`HPERM_OP
(
d
,
t
,-2,0xcccc0000);

570 
	`PERM_OP
 (
d
,
c
,
t
,1,0x55555555);

571 
	`PERM_OP
 (
c
,
d
,
t
,8,0x00ff00ff);

572 
	`PERM_OP
 (
d
,
c
,
t
,1,0x55555555);

573 
d
= (((d&0x000000ff)<<16)| (d&0x0000ff00) |

574 ((
d
&0x00ff0000)>>16)|((
c
&0xf0000000)>>4));

575 
c
&=0x0fffffff;

577 
i
=0; i<
ITERATIONS
; i++)

579 ià(
shiás2
[
i
])

580 { 
c
=((c>>2)|(c<<26)); 
d
=((d>>2)|(d<<26)); }

582 { 
c
=((c>>1)|(c<<27)); 
d
=((d>>1)|(d<<27)); }

583 
c
&=0x0fffffff;

584 
d
&=0x0fffffff;

587 
s
ğ
des_skb
[0][ (
c
 )&0x3f ]|

588 
des_skb
[1][((
c
>> 6)&0x03)|((c>> 7)&0x3c)]|

589 
des_skb
[2][((
c
>>13)&0x0f)|((c>>14)&0x30)]|

590 
des_skb
[3][((
c
>>20)&0x01)|((c>>21)&0x06) |

591 ((
c
>>22)&0x38)];

592 
t
ğ
des_skb
[4][ (
d
 )&0x3f ]|

593 
des_skb
[5][((
d
>> 7)&0x03)|((d>> 8)&0x3c)]|

594 
des_skb
[6][ (
d
>>15)&0x3f ]|

595 
des_skb
[7][((
d
>>21)&0x0f)|((d>>22)&0x30)];

598 *(
k
++)=((
t
<<16)|(
s
&0x0000ffff))&0xffffffff;

599 
s
ğ((s>>16)|(
t
&0xffff0000));

601 
s
=(s<<4)|(s>>28);

602 *(
k
++)=
s
&0xffffffff;

604 
	}
}

606 
CLICK_ENDDECLS


607 
EXPORT_ELEMENT
(
Des
)

	@ipsec/des.hh

1 #iâdeà
CLICK_IPSECDES_HH


2 
	#CLICK_IPSECDES_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


23 
	tdes_cblock
[8];

24 
	sdes_ks_¡ruù
 {

26 
des_cblock
 
	m_
;

28 
	m·d
[2];

29 } 
	mks
;

30 } 
	tdes_key_scheduË
[16];

32 
şass
 
	gAdd»ss
;

34 şas 
	cDes
 : 
public
 
EËm’t
 {

35 
public
:

36 
	$Des
(è
CLICK_COLD
;

37 
	`Des
();

38 ~
	$Des
(è
CLICK_COLD
;

40 cÚ¡ *
	$şass_Çme
() const {  "IPsecDES"; }

41 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

43 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

44 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

46 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

48 ’um { 
DES_DECRYPT
 = 0, 
DES_ENCRYPT
 = 1 
	}
};

50 
	g´iv©e
:

52 
des_£t_key
(
des_cblock
 *
key
, 
des_key_scheduË
 
scheduË
);

53 
des_’üy±
(*
šput
,*
ouut
,

54 
des_key_scheduË
 
ks
,
’üy±
);

55 
des_ecb_’üy±
(
des_cblock
 *
šput
, des_cblock *
ouut
,

56 
des_key_scheduË
 
ks
, 
’üy±
);

58 
	g_İ
;

59 
	g_ignÜe
;

60 
des_key_scheduË
 
	g_ks
;

63 
	gCLICK_ENDDECLS


	@ipsec/desp.cc

20 
	~<şick/cÚfig.h
>

21 #iâdeà
HAVE_IPSEC


24 
	~"e¥.hh
"

25 
	~"de¥.hh
"

26 
	~<şick/add»ss.hh
>

27 
	~<şick/cÚå¬£.hh
>

28 
	~<şick/”rÜ.hh
>

29 
	~<şick/glue.hh
>

30 
	~<şick/–em’t.hh
>

31 
	~<şick/·ck‘_ªno.hh
>

32 
	~"§bË.hh
"

33 
	~"§d©©u¶e.hh
"

34 
CLICK_DECLS


36 
	gIP£cESPUÃnÿp
::
	$IP£cESPUÃnÿp
()

38 
	}
}

40 
IP£cESPUÃnÿp
::~
	$IP£cESPUÃnÿp
()

42 
	}
}

45 
IP£cESPUÃnÿp
::
	$check»¶aywšdow
(
SAD©aTu¶e
 * 
§_d©a
,
£q
)

47 
diff
;

49 ià(
£q
 == 0)

52 if((
£q
 =ğ
§_d©a
->
»¶ay_¡¬t_couÁ”
è&& (§_d©a->
Ï¡£q
!=§_d©a->»¶ay_¡¬t_couÁ”)è{ sa_d©a->
b™m­
=0;sa_data->lastseq=seq; 1;}

54 ià(
£q
 > 
§_d©a
->
Ï¡£q
)

56 
diff
 = 
£q
 - 
§_d©a
->
Ï¡£q
;

57 ià(
diff
 < 
§_d©a
->
ooowš
)

58 
§_d©a
->
b™m­
 = (§_d©a->b™m­ << 
diff
) | 1;

60 
§_d©a
->
b™m­
 = 1;

62 
§_d©a
->
Ï¡£q
 = 
£q
;

65 
diff
 = 
§_d©a
->
Ï¡£q
 - 
£q
;

66 ià(
diff
 >ğ
§_d©a
->
ooowš
) {

67 
	`şick_ch©‹r
("Replay…rotection: This…acket isoo oldo be‡ccepted\n");

71 ià(
§_d©a
->
b™m­
 & (1 << 
diff
)) {

72 
	`şick_ch©‹r
("Replay…rotection: This…acket is‡lready seen...\n");

75 
§_d©a
->
b™m­
 |ğ(1 << 
diff
);

77 
	}
}

79 
Pack‘
 *

80 
	gIP£cESPUÃnÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

82 
i
, 
blks
;

83 cÚ¡ * 
blk
;

84 
SAD©aTu¶e
 * 
§
;

87 
e¥_Ãw
 *
e¥
 = (e¥_Ãw *è
p
->
	`d©a
();

89 
§
=(
SAD©aTu¶e
 *)
	`IPSEC_SA_DATA_REFERENCE_ANNO
(
p
);

91 if(
§
==
NULL
è{
	`şick_ch©‹r
("Null„eferenceo Security Association Table");}

93 if(!
	`check»¶aywšdow
(
§
,()
	`Áohl
(
e¥
->
e¥_½l
))) {

94 
p
->
	`kl
();

99 
p
->
	`puÎ
((
e¥_Ãw
));

101 
blks
 = 
p
->
	`Ëngth
();

102 
blk
 = 
p
->
	`d©a
();

104 if((
blk
[
blks
 - 2] != blk[blks - 3]) && (blk[blks -2] != 0)) {

105 
	`şick_ch©‹r
("Invalid…adding†ength");

106 
p
->
	`kl
();

109 
blks
 = 
blk
[blks - 2];

110 
blk
 = 
p
->
	`d©a
(è+…->
	`Ëngth
(è- (
blks
 + 2);

111 
i
 = 0; (˜< 
blks
è&& (
blk
[i] == i + 1);)

112 ++
i
;

113 if(
i
<
blks
) {

114 
	`şick_ch©‹r
("Corrupt…adding");

115 
p
->
	`kl
();

119 
p
->
	`ke
(
blks
+2);

120  
p
;

121 
	}
}

123 
CLICK_ENDDECLS


124 
	$EXPORT_ELEMENT
(
IP£cESPUÃnÿp
)

125 
	`ELEMENT_MT_SAFE
(
IP£cESPUÃnÿp
)

	@ipsec/desp.hh

1 #iâdeà
CLICK_IPSEC_DESP_HH


2 
	#CLICK_IPSEC_DESP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~"§bË.hh
"

6 
	~"§d©©u¶e.hh
"

7 
CLICK_DECLS


22 şas 
	cIP£cESPUÃnÿp
 : 
public
 
EËm’t
 {

23 
public
:

24 
	$IP£cESPUÃnÿp
(è
CLICK_COLD
;

25 ~
	$IP£cESPUÃnÿp
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "IPsecESPUnencap"; }

28 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

30 
check»¶aywšdow
(
SAD©aTu¶e
 * 
§_d©a
,
£q
);

32 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

35 
	gCLICK_ENDDECLS


	@ipsec/esp.cc

23 
	~<şick/cÚfig.h
>

24 #iâdeà
HAVE_IPSEC


27 
	~"e¥.hh
"

28 
	~<şick/add»ss.hh
>

29 
	~<şick/cÚå¬£.hh
>

30 
	~<şickÃt/.h
>

31 
	~<şick/”rÜ.hh
>

32 
	~<şick/glue.hh
>

33 
	~<şick/·ck‘_ªno.hh
>

34 
	~"§bË.hh
"

35 
	~"§d©©u¶e.hh
"

36 
CLICK_DECLS


38 
	gIP£cESPEnÿp
::
	$IP£cESPEnÿp
()

40 
	}
}

42 
IP£cESPEnÿp
::~
	$IP£cESPEnÿp
()

44 
	}
}

47 
IP£cESPEnÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *)

52 
Pack‘
 *

53 
	gIP£cESPEnÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

55 
i
;

56 
SAD©aTu¶e
 * 
§_d©a
;

57 
u_ch¬
 
_p
=0;

60 ià(
p
->
	`has_ÃtwÜk_h—d”
())

61 
_p
 = 
p
->
	`_h—d”
()->ip_p;

62 
§_d©a
=(
SAD©aTu¶e
 *)
	`IPSEC_SA_DATA_REFERENCE_ANNO
(
p
);

65 
¶’
 = 
p
->
	`Ëngth
();

66 
·ddšg
 = ((
BLKS
 - ((
¶’
 + 2) % BLKS)) % BLKS) + 2;

68 
Wr™abËPack‘
 *
q
 = 
p
->
	`push
((
e¥_Ãw
));

69 
q
 = q->
	`put
(
·ddšg
);

71 
e¥_Ãw
 *
e¥
 = (e¥_Ãw *è
q
->
	`d©a
();

72 
u_ch¬
 *
·d
 = ((u_ch¬ *è
q
->
	`d©a
()è+ (
e¥_Ãw
è+ 
¶’
;

76 
e¥
->
e¥_¥i
 = 
	`htÚl
((
ušt32_t
)
	`IPSEC_SPI_ANNO
(
p
));

77 
e¥
->
e¥_½l
 = 
	`htÚl
(
§_d©a
->
cur_½l
);

79 if((
§_d©a
->
cur_½l
++) == 0) {

81 
§_d©a
->
cur_½l
 = sa_d©a->
»¶ay_¡¬t_couÁ”
;

83 
i
 = 
	`şick_¿ndom
() >> 2;

84 
	`memmove
(&
e¥
->
e¥_iv
[0], &
i
, 4);

85 
i
 = 
	`şick_¿ndom
() >> 2;

86 
	`memmove
(&
e¥
->
e¥_iv
[4], &
i
, 4);

87 
	`memmove
(
q
->
	`d©a
(), 
e¥
, (
e¥_Ãw
));

90 
i
 = 0; i < 
·ddšg
 - 2; i++)

91 
·d
[
i
] = i + 1;

92 
·d
[
·ddšg
 - 2] =…adding - 2;

95 
·d
[
·ddšg
 - 1] = 
_p
;

97 (
q
);

98 
	}
}

102 
CLICK_ENDDECLS


103 
	$EXPORT_ELEMENT
(
IP£cESPEnÿp
)

104 
	`ELEMENT_MT_SAFE
(
IP£cESPEnÿp
)

	@ipsec/esp.hh

1 #iâdeà
CLICK_IPSEC_ESP_HH


2 
	#CLICK_IPSEC_ESP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/©omic.hh
>

5 
	~<şick/glue.hh
>

6 
CLICK_DECLS


26 
	se¥_Ãw
 {

27 
ušt32_t
 
	me¥_¥i
;

28 
ušt32_t
 
	me¥_½l
;

29 
ušt8_t
 
	me¥_iv
[8];

32 şas 
	cIP£cESPEnÿp
 : 
public
 
EËm’t
 {

34 
public
:

35 
	$IP£cESPEnÿp
(è
CLICK_COLD
;

36 
	`IP£cESPEnÿp
(
¥i
);

37 ~
	$IP£cESPEnÿp
(è
CLICK_COLD
;

39 cÚ¡ *
	$şass_Çme
() const {  "IPsecESPEncap"; }

40 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

42 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

44 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

46 
	g´iv©e
:

48 ’um { 
BLKS
 = 8 };

51 
	gCLICK_ENDDECLS


	@ipsec/hmac.cc

59 
	~<şick/cÚfig.h
>

60 
	~"hmac.hh
"

61 
CLICK_DECLS


63 
	$O³nSSLD›
()

65 
	`şick_ch©‹r
("HMAC computation internalƒrror,‡ssertion failed\n");

66 
	}
}

69 
	$HMAC_In™_ex
(
HMAC_CTX
 *
ùx
, cÚ¡ *
key
, 
Ën
)

71 
i
,
j
,
»£t
=0;

72 
·d
[
HMAC_MAX_MD_CBLOCK
];

74 ià(
key
 !ğ
NULL
)

76 
»£t
=1;

77 
j
=
SHA_CBLOCK
;

78 
	`OPENSSL_as£¹
(
j
 <ğ()(
ùx
->
key
));

79 ià(
j
 < 
Ën
)

81 
	`SHA1_š™
(&
ùx
->
md_ùx
);

82 
	`SHA1_upd©e
(&
ùx
->
md_ùx
,(*)
key
,
Ën
);

83 
	`SHA1_fš®
(
ùx
->
key
,&(ùx->
md_ùx
));

87 
	`OPENSSL_as£¹
(
Ën
>=0 &&†’<=()(
ùx
->
key
));

88 
	`memıy
(
ùx
->
key
,key,
Ën
);

89 
ùx
->
key_Ëngth
=
Ën
;

91 if(
ùx
->
key_Ëngth
 !ğ
HMAC_MAX_MD_CBLOCK
)

92 
	`mem£t
(&
ùx
->
key
[ùx->
key_Ëngth
], 0,

93 
HMAC_MAX_MD_CBLOCK
 - 
ùx
->
key_Ëngth
);

96 ià(
»£t
)

98 
i
=0; i<
HMAC_MAX_MD_CBLOCK
; i++)

99 
·d
[
i
]=0x36^
ùx
->
key
[i];

100 
	`SHA1_š™
(&
ùx
->
i_ùx
);

101 
	`SHA1_upd©e
(&
ùx
->
i_ùx
,
·d
,
SHA_CBLOCK
);

103 
i
=0; i<
HMAC_MAX_MD_CBLOCK
; i++)

104 
·d
[
i
]=0x5c^
ùx
->
key
[i];

105 
	`SHA1_š™
(&
ùx
->
o_ùx
);

106 
	`SHA1_upd©e
(&
ùx
->
o_ùx
,
·d
,
SHA_CBLOCK
);

108 
	`memıy
((*)&
ùx
->
md_ùx
,(*)&ùx->
i_ùx
,(
SHA1_ùx
));

109 
	}
}

111 
	$HMAC_In™
(
HMAC_CTX
 *
ùx
, cÚ¡ *
key
, 
Ën
)

113 if(
key
 )

114 
	`HMAC_CTX_š™
(
ùx
);

115 
	`HMAC_In™_ex
(
ùx
,
key
,
Ën
);

116 
	}
}

118 
	$HMAC_Upd©e
(
HMAC_CTX
 *
ùx
, *
d©a
, 
size_t
 
Ën
)

120 
	`SHA1_upd©e
(&
ùx
->
md_ùx
,
d©a
,
Ën
);

121 
	}
}

123 
	$HMAC_Fš®
(
HMAC_CTX
 *
ùx
, *
md
, *
Ën
)

125 
j
;

126 
buf
[
EVP_MAX_MD_SIZE
];

128 
j
=
SHA_BLOCK
;

129 
	`SHA1_fš®
(
buf
,&
ùx
->
md_ùx
);

130 
	`memıy
((*)&
ùx
->
md_ùx
,(*)&ùx->
o_ùx
,(
SHA1_ùx
));

131 
	`SHA1_upd©e
(&
ùx
->
md_ùx
,
buf
,()*
Ën
);

132 
	`SHA1_fš®
(
md
,&
ùx
->
md_ùx
);

133 
	}
}

135 
	$HMAC_CTX_š™
(
HMAC_CTX
 *
ùx
)

137 
	`SHA1_š™
(&
ùx
->
i_ùx
);

138 
	`SHA1_š™
(&
ùx
->
o_ùx
);

139 
	`SHA1_š™
(&
ùx
->
md_ùx
);

140 
	}
}

142 
	$HMAC_CTX_ş—nup
(
HMAC_CTX
 *
ùx
)

144 
	`mem£t
(
ùx
,0, *ctx);

145 
	}
}

147 *
	$HMAC
(*
key
, 
key_Ën
,*
d
, 
size_t
 
n
, *
md
,*
md_Ën
)

149 
HMAC_CTX
 
c
;

150 
m
[
EVP_MAX_MD_SIZE
];

152 ià(
md
 =ğ
NULL
èmd=
m
;

153 
	`HMAC_CTX_š™
(&
c
);

154 
	`HMAC_In™
(&
c
,
key
,
key_Ën
);

155 
	`HMAC_Upd©e
(&
c
,
d
,
n
);

156 
	`HMAC_Fš®
(&
c
,
md
,
md_Ën
);

157 
	`HMAC_CTX_ş—nup
(&
c
);

158 (
md
);

159 
	}
}

161 
	gCLICK_ENDDECLS


	@ipsec/hmac.hh

59 #iâdeà
HEADER_HMAC_H


60 
	#HEADER_HMAC_H


	)

61 
	~"sha1_im¶.hh
"

62 
	gCLICK_DECLS


64 
	#HMAC_MAX_MD_CBLOCK
 128

	)

66 
	#EVP_MAX_MD_SIZE
 64

	)

67 
O³nSSLD›
();

68 
	#OPENSSL_as£¹
(
e
è()(Óè? 0 : (
	`O³nSSLD›
(),1))

	)

71 
	shmac_ùx_¡


73 
SHA1_ùx
 
	mmd_ùx
;

74 
SHA1_ùx
 
	mi_ùx
;

75 
SHA1_ùx
 
	mo_ùx
;

76 
	mkey_Ëngth
;

77 
	mkey
[
HMAC_MAX_MD_CBLOCK
];

78 } 
	tHMAC_CTX
;

82 
HMAC_CTX_š™
(
HMAC_CTX
 *
ùx
);

83 
HMAC_CTX_ş—nup
(
HMAC_CTX
 *
ùx
);

85 
HMAC_In™
(
HMAC_CTX
 *
ùx
, cÚ¡ *
key
, 
Ën
);

86 
HMAC_In™_ex
(
HMAC_CTX
 *
ùx
, cÚ¡ *
key
, 
Ën
);

87 
HMAC_Upd©e
(
HMAC_CTX
 *
ùx
, *
d©a
, 
size_t
 
Ën
);

88 
HMAC_Fš®
(
HMAC_CTX
 *
ùx
, * 
md
, *
Ën
);

89 * 
HMAC
Ğ*
key
, 
key_Ën
,*
d
, 
size_t
 
n
, *
md
,*
md_Ën
);

91 
	gCLICK_ENDDECLS


	@ipsec/hmacsha1.cc

18 
	~<şick/cÚfig.h
>

19 #iâdeà
HAVE_IPSEC


22 
	~"hmacsha1.hh
"

23 
	~"e¥.hh
"

24 
	~<şick/add»ss.hh
>

25 
	~<şick/¬gs.hh
>

26 
	~<şickÃt/.h
>

27 
	~<şick/”rÜ.hh
>

28 
	~<şick/glue.hh
>

29 
	~<şick/·ck‘_ªno.hh
>

31 
	~"–em’ts/£c/hmac.hh
"

32 
	~"§bË.hh
"

33 
	~"§d©©u¶e.hh
"

34 
	gCLICK_DECLS


36 
	#SHA_DIGEST_LEN
 20

	)

37 
	#KEY_SIZE
 16

	)

39 
	gIP£cAuthHMACSHA1
::
	$IP£cAuthHMACSHA1
()

41 
	}
}

43 
IP£cAuthHMACSHA1
::~
	$IP£cAuthHMACSHA1
()

45 
	}
}

48 
IP£cAuthHMACSHA1
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

50  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("VERIFY", 
_İ
).
com¶‘e
();

54 
	gIP£cAuthHMACSHA1
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

56 
_drİs
 = 0;

58 
	}
}

61 
Pack‘
 *

62 
	gIP£cAuthHMACSHA1
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

64 
SAD©aTu¶e
 * 
§_d©a
=(SAD©aTu¶*)
	`IPSEC_SA_DATA_REFERENCE_ANNO
(
p
);

65 
Ën
;

67 
Ën
 = 
SHA_DIGEST_LEN
;

69 ià(
_İ
 =ğ
COMPUTE_AUTH
) {

70 
dige¡
 [
SHA_DIGEST_LEN
];

71 
	`HMAC
(
§_d©a
->
Auth’tiÿtiÚ_key
,
KEY_SIZE
,(
u_ch¬
*è
p
->
	`d©a
(),p->
	`Ëngth
(),
dige¡
,&
Ën
);

72 
Wr™abËPack‘
 *
q
 = 
p
->
	`put
(12);

73 
u_ch¬
 *
ah
 = ((u_ch¬*)
q
->
	`d©a
())+q->
	`Ëngth
()-12;

74 
	`memmove
(
ah
, 
dige¡
, 12);

75  
q
;

78 cÚ¡ 
u_ch¬
 *
ah
 = 
p
->
	`d©a
()+p->
	`Ëngth
()-12;

79 
dige¡
 [
SHA_DIGEST_LEN
];

81 
	`HMAC
(
§_d©a
->
Auth’tiÿtiÚ_key
,
KEY_SIZE
,(
u_ch¬
*è
p
->
	`d©a
(),p->
	`Ëngth
()-12,
dige¡
,&
Ën
);

82 ià(
	`memcmp
(
ah
, 
dige¡
, 12)) {

83 ià(
_drİs
 == 0)

84 
	`şick_ch©‹r
("Invalid SHA1‡uthentication digest");

85 
_drİs
++;

86 ià(
	`nouuts
() > 1)

87 
	`ouut
(1).
	`push
(
p
);

89 
p
->
	`kl
();

93 
p
->
	`ke
(12);

94  
p
;

96 
	}
}

98 
SŒšg


99 
	gIP£cAuthHMACSHA1
::
	$drİ_hªdËr
(
EËm’t
 *
e
, *)

101 
IP£cAuthHMACSHA1
 *
a
 = (IP£cAuthHMACSHA1 *)
e
;

102  
	`SŒšg
(
a
->
_drİs
);

103 
	}
}

106 
	gIP£cAuthHMACSHA1
::
	$add_hªdËrs
()

108 
	`add_»ad_hªdËr
("drİs", 
drİ_hªdËr
, 0);

109 
	}
}

111 
	~"sha1_im¶.cc
"

112 
	~"hmac.cc
"

114 
CLICK_ENDDECLS


115 
	$EXPORT_ELEMENT
(
IP£cAuthHMACSHA1
)

116 
	`ELEMENT_MT_SAFE
(
IP£cAuthHMACSHA1
)

	@ipsec/hmacsha1.hh

1 #iâdeà
CLICK_IPSECAUTHHMACSHA1_HH


2 
	#CLICK_IPSECAUTHHMACSHA1_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/©omic.hh
>

5 
	~<şick/glue.hh
>

6 
CLICK_DECLS


22 şas 
	cIP£cAuthHMACSHA1
 : 
public
 
EËm’t
 {

24 
public
:

25 
IP£cAuthHMACSHA1
();

26 ~
IP£cAuthHMACSHA1
();

28 cÚ¡ *
	$şass_Çme
() const {  "IPsecAuthHMACSHA1"; }

29 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

31 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

32 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

34 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

35 
	$add_hªdËrs
(è
CLICK_COLD
;

37 
SŒšg
 
	`drİ_hªdËr
(
EËm’t
 *
e
, *
thunk
);

39 
´iv©e
:

41 
_İ
;

42 
©omic_ušt32_t
 
_drİs
;

44 ’um { 
COMPUTE_AUTH
 = 0, 
VERIFY_AUTH
 = 1 
	}
};

47 
	gCLICK_ENDDECLS


	@ipsec/ipsecencap.cc

24 
	~<şick/cÚfig.h
>

25 
	~"£ûnÿp.hh
"

26 
	~<şick/Çmešfo.hh
>

27 
	~<şick/¬gs.hh
>

28 
	~<şick/”rÜ.hh
>

29 
	~<şick/·ck‘_ªno.hh
>

30 
	~<şick/glue.hh
>

31 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

32 
CLICK_DECLS


34 
	gIP£cEnÿp
::
	$IP£cEnÿp
()

36 
	}
}

38 
IP£cEnÿp
::~
	$IP£cEnÿp
()

40 
	}
}

43 
IP£cEnÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

45 
şick_
 
	gh
;

46 
mem£t
(&
h
, 0, (
şick_
));

47 
	gh
.
	g_v
 = 4;

48 
	gh
.
	g_hl
 = (
şick_
) >> 2;

49 
	gh
.
	g_tos
 = 0;

50 
	gh
.
	g_off
 = 0;

51 
	gh
.
	g_‰l
 = 250;

52 
	gh
.
	g_sum
 = 0;

53 
	g´Ùo
, 
	gtos
 = -1, 
	gdsı
 = -1;

54 
boŞ
 
	gû
 = 
çl£
, 
	gdf
 = false;

55 
SŒšg
 
	geù_¡r
;

57 ià(
Args
(
cÚf
, 
this
, 
”rh
)

58 .
»ad_mp
("PROTO", 
NamedIÁArg
(
NameInfo
::
T_IP_PROTO
), 
´Ùo
)

59 .
com¶‘e
() < 0)

62 ià(
	g´Ùo
 < 0 ||…roto > 255)

63  
	g”rh
->
”rÜ
("bad IP…rotocol");

64 
	gh
.
	g_p
 = 
´Ùo
;

66 
	geù
 = 0;

67 ià(
	geù_¡r
) {

68 
boŞ
 
	gx
;

69 ià(
BoŞArg
().
·r£
(
eù_¡r
, 
x
))

70 
	geù
 = 
x
;

71 ià(
	geù_¡r
 == "2")

72 
eù
 = 2;

74  
	g”rh
->
”rÜ
("bad ECT v®u'%s'", 
eù_¡r
.
c_¡r
());

77 ià(
	gtos
 >ğ0 && 
dsı
 >= 0)

78  
”rh
->
”rÜ
("cannot set both TOS‡nd DSCP");

79 ià(
	gtos
 >ğ0 && (
eù
 || 
û
))

80  
”rh
->
”rÜ
("cannot set both TOS‡nd ECN bits");

81 ià(
	gtos
 >ğ256 || 
tos
 < -1)

82  
”rh
->
”rÜ
("TOSoo†arge; max 255");

83 ià(
	gdsı
 >ğ63 || 
dsı
 < -1)

84  
”rh
->
”rÜ
("DSCPoo†arge; max 63");

85 ià(
	geù
 && 
	gû
)

86  
	g”rh
->
”rÜ
("can set‡t most one ECN option");

88 ià(
	gtos
 >= 0)

89 
h
.
_tos
 = 
tos
;

90 ià(
	gdsı
 >= 0)

91 
h
.
_tos
 = (
dsı
 << 2);

92 ià(
	geù
)

93 
	gh
.
	g_tos
 |ğ(
eù
 =ğ1 ? 
IP_ECN_ECT1
 : 
IP_ECN_ECT2
);

94 ià(
	gû
)

95 
	gh
.
	g_tos
 |ğ
IP_ECN_CE
;

96 ià(
	gdf
)

97 
	gh
.
	g_off
 |ğ
htÚs
(
IP_DF
);

98 
	g_h
 = 
h
;

100 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


103 
	gªs
, 
	gc
, 
	go
;

104 
	gªs
 = 
Alignm’tInfo
::
qu”y
(
this
, 0, 
c
, 
o
);

105 
	g_®igÃd
 = (
ªs
 && 
c
 =ğ4 && 
o
 == 0);

106 ià(!
	g_®igÃd
)

107 
	g”rh
->
w¬nšg
("IP header unaligned, cannot use fast IP checksum");

108 ià(!
	gªs
)

109 
	g”rh
->
mes§ge
("(Try…assinghe configurationhrough 'click-align'.)");

117 
	gIP£cEnÿp
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

119 
_id
 = 0;

121 
	}
}

123 
Pack‘
 *

124 
	gIP£cEnÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

126 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`push
((
şick_
));

127 ià(!
p
)  0;

129 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
p
->
	`d©a
());

134 
_h
.
_d¡
 = 
p
->
	`d¡__ªno
();

136 
	`SET_FIX_IP_SRC_ANNO
(
p
, 1);

138 
	`memıy
(

, &
_h
, (
şick_
));

139 

->
_Ën
 = 
	`htÚs
(
p
->
	`Ëngth
());

140 

->
_id
 = 
	`htÚs
(
_id
.
	`ãtch_ªd_add
(1));

142 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


143 ià(
_®igÃd
)

144 

->
_sum
 = 
	`_ç¡_csum
((*), (
şick_
) >> 2);

146 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

147 #–ià
HAVE_FAST_CHECKSUM


148 

->
_sum
 = 
	`_ç¡_csum
((*), (
şick_
) >> 2);

150 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

153 
p
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(

->
_d¡
));

154 
p
->
	`£t__h—d”
(

, (
şick_
));

155  
p
;

156 
	}
}

158 
SŒšg


159 
	gIP£cEnÿp
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

161 
IP£cEnÿp
 *
e
 = 
¡©ic_ÿ¡
<IP£cEnÿ°*>(
e
);

162 (
šŒ_t
)
thunk
) {

163 0:  
	`IPAdd»ss
(
e
->
_h
.
_¤c
).
	`uÅ¬£
();

164 1:  
	`IPAdd»ss
(
e
->
_h
.
_d¡
).
	`uÅ¬£
();

167 
	}
}

170 
	gIP£cEnÿp
::
	$add_hªdËrs
()

172 
	}
}

174 
CLICK_ENDDECLS


175 
	$EXPORT_ELEMENT
(
IP£cEnÿp
)

176 
	`ELEMENT_MT_SAFE
(
IP£cEnÿp
)

	@ipsec/ipsecencap.hh

1 #iâdeà
CLICK_IPSECENCAP_HH


2 
	#CLICK_IPSECENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/©omic.hh
>

6 
	~<şickÃt/.h
>

7 
CLICK_DECLS


82 şas 
	cIP£cEnÿp
 : 
public
 
EËm’t
 {…ublic:

84 
	$IP£cEnÿp
(è
CLICK_COLD
;

85 ~
	$IP£cEnÿp
(è
CLICK_COLD
;

87 cÚ¡ *
	$şass_Çme
() const {  "IPsecEncap"; }

88 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

89 cÚ¡ *
	$æags
(ècÚ¡ {  "A"; 
	}
}

91 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

92 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

93 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

94 
	$add_hªdËrs
(è
CLICK_COLD
;

96 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

98 
´iv©e
:

100 
şick_
 
_h
;

101 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


102 
boŞ
 
_®igÃd
;

105 
©omic_ušt32_t
 
_id
;

107 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

109 
	}
};

111 
	gCLICK_ENDDECLS


	@ipsec/ipsecroutetable.cc

29 
	~<şick/cÚfig.h
>

30 
	~<şick/add»ss.hh
>

31 
	~<şick/¬gs.hh
>

32 
	~<şick/”rÜ.hh
>

33 
	~<şick/glue.hh
>

34 
	~<şick/¡¿ccum.hh
>

35 
	~<şick/rou‹r.hh
>

36 
	~<şick/·ck‘_ªno.hh
>

37 
	~"£üou‹bË.hh
"

38 
	~"e¥.hh
"

40 
CLICK_DECLS


43 
boŞ


44 
	$ı_£c_rou‹
(
SŒšg
 
s
, 
IP£cRou‹
 *
r_¡Üe
, 
boŞ
 
»move_rou‹
, 
EËm’t
 *
cÚ‹xt
)

46 
IP£cRou‹
 
r
;

48 
»¶ay
;

49 
ušt8_t
 
oowš
;

51 
SAD©aTu¶e
 * 
§_d©a
;

53 ià(!
	`IPP»fixArg
(
Œue
).
	`·r£
(
	`ı_shiá_¥aûvec
(
s
), 
r
.
addr
,„.
mask
, 
cÚ‹xt
))

54  
çl£
;

56 
r
.
addr
 &ğr.
mask
;

57 
SŒšg
 
wÜd
 = 
	`ı_shiá_¥aûvec
(
s
);

58 ià(
wÜd
 == "-")

60 ià(
	`IPAdd»ssArg
().
	`·r£
(
wÜd
, 
r
.
gw
, 
cÚ‹xt
))

63 
two_wÜds
;

65 
wÜd
 = 
	`ı_shiá_¥aûvec
(
s
);

66 
two_wÜds
:

67 ià(
	`IÁArg
().
	`·r£
(
wÜd
, 
r
.
pÜt
è|| (!wÜd && 
»move_rou‹
))

69 
wÜd
 = 
	`ı_shiá_¥aûvec
(
s
);

71 ià(!
wÜd
) {

73 
r
.
¥i
 = 
	`SPI
(0);

74 
r
.
§_d©a
 = 
NULL
;

76 *
r_¡Üe
 = 
r
;

77  
Œue
;

80 
VeùÜ
<
SŒšg
> 
wÜds
;

81 
wÜds
.
	`push_back
(
wÜd
);

82 
	`ı_¥aûvec
(
s
, 
wÜds
);

83 
SŒšg
 
’c_key
, 
auth_key
;

84 ià(
	`Args
(
wÜds
, 
cÚ‹xt
, 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
())

85 .
	`»ad_mp
("SPI", 
r
.
¥i
)

86 .
	`»ad_mp
("ENCRYPT_KEY", 
’c_key
)

87 .
	`»ad_mp
("AUTH_KEY", 
auth_key
)

88 .
	`»ad_mp
("REPLAY", 
»¶ay
)

89 .
	`»ad_mp
("OOSIZE", 
oowš
)

90 .
	`com¶‘e
() < 0)

91  
çl£
;

92 ià(
’c_key
.
	`Ëngth
(è!ğ16 || 
auth_key
.length() != 16) {

93 
	`şick_ch©‹r
("key has bad†ength");

94  
çl£
;

98 
§_d©a
 = 
Ãw
 
	`SAD©aTu¶e
(
’c_key
.
	`d©a
(), 
auth_key
.d©a(), 
»¶ay
, 
oowš
);

99 ((
IP£cRou‹TabË
*)
cÚ‹xt
)->
_§_bË
.
	`š£¹
(
	`SPI
(
r
.
¥i
),*
§_d©a
);

101 
r
.
§_d©a
 = sa_data;

103 *
r_¡Üe
 = 
r
;

104  
Œue
;

105 
	}
}

108 
	gSŒšgAccum
&

109 
	gIP£cRou‹
::
	$uÅ¬£
(
SŒšgAccum
& 
§
, 
boŞ
 
bs
) const

111 
l
 = 
§
.
	`Ëngth
();

112 
b
 = (
bs
 ? '\t' : ' ');

113 
§
 << 
addr
.
	`uÅ¬£_w™h_mask
(
mask
è<< 
b
;

114 ià(
§
.
	`Ëngth
(è< 
l
 + 17 && 
bs
)

115 
§
 << '\t';

116 
l
 = 
§
.
	`Ëngth
();

117 ià(
gw
)

118 
§
 << 
gw
 << 
b
;

120 
§
 << '-' << 
b
;

121 ià(
§
.
	`Ëngth
(è< 
l
 + 9 && 
bs
)

122 
§
 << '\t';

123 ià(!
	`»®
())

124 
§
 << "-1";

126 
§
 << 
pÜt
;

127 if(
¥i
 != 0) {

128 
§
 << " |TUNNELED CONNECTION| \n|SPI| |ENC KEY| |AUTH KEY| ||\n";

129 
§
 << " |" <<
¥i
<<"|";

130 
§
 << 
§_d©a
->
	`uÅ¬£_’Œ›s
().
	`c_¡r
() <<"\n";

132  
§
;

133 
	}
}

135 
SŒšg


136 
	gIP£cRou‹
::
	$uÅ¬£
() const

138 
SŒšgAccum
 
§
;

139 
§
 << *
this
;

140  
§
.
	`ke_¡ršg
();

141 
	}
}

145 
	gIP£cRou‹TabË
::
	$ÿ¡
(cÚ¡ *
Çme
)

147 ià(
	`¡rcmp
(
Çme
, "IPsecRouteTable") == 0)

148  (*)
this
;

150  
EËm’t
::
	`ÿ¡
(
Çme
);

151 
	}
}

154 
	gIP£cRou‹TabË
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

156 
IP£cRou‹
 
	gr
;

157 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

158 ià(
ı_£c_rou‹
(
cÚf
[
i
], &
r
, 
çl£
, 
this
)

159 && 
	gr
.
	gpÜt
 >ğ0 && 
r
.
pÜt
 < 
nouuts
())

160 (è
add_rou‹
(
r
, 
çl£
, 0, 
”rh
);

162 
	g”rh
->
”rÜ
("¬gum’ˆ%d should b'ADDR/MASK [GATEWAY] OUTPUT'", 
i
+1);

164  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

168 
	gIP£cRou‹TabË
::
	$add_rou‹
(cÚ¡ 
IP£cRou‹
&, 
boŞ
, IP£cRou‹*, 
E¼ÜHªdËr
 *
”rh
)

171  
”rh
->
	`”rÜ
("cannot‡dd„outesohis„outingable");

172 
	}
}

175 
	gIP£cRou‹TabË
::
	$»move_rou‹
(cÚ¡ 
IP£cRou‹
&, IP£cRou‹*, 
E¼ÜHªdËr
 *
”rh
)

178  
”rh
->
	`”rÜ
("cannot delete„outes fromhis„outingable");

179 
	}
}

182 
	gIP£cRou‹TabË
::
	$lookup_rou‹
(
IPAdd»ss
, IPAdd»s &, &, 
SAD©aTu¶e
*&) const

185 
	}
}

187 
SŒšg


188 
	gIP£cRou‹TabË
::
	$dump_rou‹s
()

190  
	`SŒšg
();

191 
	}
}

194 
	gIP£cRou‹TabË
::
	$push
(, 
Pack‘
 *
p
)

197 
IPAdd»ss
 
gw
;

198 
ušt32_t
 
¥i
;

199 
SAD©aTu¶e
 * 
§_d©a
;

200 cÚ¡ 
şick_
 *

 = 
»š‹½»t_ÿ¡
< cÚ¡ click_ *>(
p
->
	`d©a
());

202 
pÜt
 = 
	`lookup_rou‹
(
p
->
	`d¡__ªno
(), 
gw
, 
¥i
, 
§_d©a
);

204 ià(
pÜt
 >= 0) {

205 
pÜt
) {

209 if((
¥i
 =ğ0è|| (
§_d©a
 =ğ
NULL
)) {

210 
	`şick_ch©‹r
("NØIp£øtuÂ– fÜ %s. WrÚguÂ– s‘up", 
p
->
	`d¡__ªno
().
	`uÅ¬£
().
	`c_¡r
());

212 
	`SET_IPSEC_SPI_ANNO
(
p
,(
ušt32_t
)
¥i
);

214 
	`SET_IPSEC_SA_DATA_REFERENCE_ANNO
(
p
, (
ušŒ_t
)
§_d©a
);

220 if(

->
_p
 != 50) {

223 
pÜt
 = 2;

228 
e¥_Ãw
 * 
e¥
 =(e¥_Ãw *)(
p
->
	`d©a
()+(
şick_
));

229 
§_d©a
 = 
_§_bË
.
	`lookup
(
	`SPI
(
	`Áohl
(
e¥
->
e¥_¥i
)));

230 if(
§_d©a
 =ğ
NULL
) {

231 
	`şick_ch©‹r
("Inv®id SPI %d, Drİpšg…ack‘",
	`Áohl
(
e¥
->
e¥_¥i
));

232 
p
->
	`kl
();

235 
	`SET_IPSEC_SA_DATA_REFERENCE_ANNO
(
p
, (
ušŒ_t
)
§_d©a
);

239 
	`as£¹
(
pÜt
 < 
	`nouuts
());

240 ià(
gw
)

241 
p
->
	`£t_d¡__ªno
(
gw
);

242 
	`ouut
(
pÜt
).
	`push
(
p
);

244 
com¶ašed
 = 0;

245 ià(++
com¶ašed
 <= 5)

246 
	`şick_ch©‹r
("IP£cRou‹TabË:‚Ørou‹ fÜ %s", 
p
->
	`d¡__ªno
().
	`uÅ¬£
().
	`c_¡r
());

247 
p
->
	`kl
();

249 
	}
}

253 
	gIP£cRou‹TabË
::
run_commªd
(
commªd
, cÚ¡ 
SŒšg
 &
¡r
, 
VeùÜ
<
IP£cRou‹
> * 
Şd_rou‹s
, 
E¼ÜHªdËr
 *
”rh
)

255 
IP£cRou‹
 
	grou‹
, 
	gŞd_rou‹
;

256 ià(!
ı_£c_rou‹
(
¡r
, &
rou‹
, 
commªd
 =ğ
CMD_REMOVE
, 
this
)

257 || 
	grou‹
.
	gpÜt
 < (
	gcommªd
 =ğ
CMD_REMOVE
 ? -1 : 0)

258 || 
rou‹
.
pÜt
 >ğ
nouuts
())

259  
”rh
->
”rÜ
("ex³ùed 'ADDR/MASK [GATEWAY%s'", (
commªd
 =ğ
CMD_REMOVE
 ? " OUTPUT]" : "] OUTPUT"));

261 
	gr
, 
	gbefÜe
 = 
”rh
->
Ã¼Üs
();

262 ià(
	gcommªd
 =ğ
CMD_ADD
)

263 
r
 = 
add_rou‹
(
rou‹
, 
çl£
, &
Şd_rou‹
, 
”rh
);

264 ià(
	gcommªd
 =ğ
CMD_SET
)

265 
r
 = 
add_rou‹
(
rou‹
, 
Œue
, &
Şd_rou‹
, 
”rh
);

267 
	gr
 = 
»move_rou‹
(
rou‹
, &
Şd_rou‹
, 
”rh
);

270 ià(
	gr
 >ğ0 && 
Şd_rou‹s
) {

271 ià(
Şd_rou‹
.
pÜt
 < 0) {

272 
Şd_rou‹
 = 
rou‹
;

273 
	gŞd_rou‹
.
	gexŒa
 = 
CMD_ADD
;

275 
	gŞd_rou‹
.
	gexŒa
 = 
commªd
;

276 
	gŞd_rou‹s
->
push_back
(
Şd_rou‹
);

280 ià(
	gr
 =ğ-
EEXIST
 && 
”rh
->
Ã¼Üs
(è=ğ
befÜe
)

281 
”rh
->
”rÜ
("cÚæiù w™hƒxi¡šg„ou‹ '%s'", 
Şd_rou‹
.
uÅ¬£
().
c_¡r
());

282 ià(
	gr
 =ğ-
ENOENT
 && 
”rh
->
Ã¼Üs
(è=ğ
befÜe
)

283 
”rh
->
”rÜ
("rou‹ '%s'‚Ù found", 
rou‹
.
uÅ¬£
().
c_¡r
());

284  
	gr
;

289 
	gIP£cRou‹TabË
::
	$add_rou‹_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

291 
IP£cRou‹TabË
 *
bË
 = 
¡©ic_ÿ¡
<IP£cRou‹TabË *>(
e
);

292  
bË
->
	`run_commªd
((
thunk
 ? 
CMD_SET
 : 
CMD_ADD
), 
cÚf
, 0, 
”rh
);

293 
	}
}

296 
	gIP£cRou‹TabË
::
	$»move_rou‹_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

298 
IP£cRou‹TabË
 *
bË
 = 
¡©ic_ÿ¡
<IP£cRou‹TabË *>(
e
);

299  
bË
->
	`run_commªd
(
CMD_REMOVE
, 
cÚf
, 0, 
”rh
);

300 
	}
}

303 
	gIP£cRou‹TabË
::
	$ù¾_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf_š
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

305 
IP£cRou‹TabË
 *
bË
 = 
¡©ic_ÿ¡
<IP£cRou‹TabË *>(
e
);

306 
SŒšg
 
cÚf
 = 
	`ı_uncomm’t
(
cÚf_š
);

307 cÚ¡ * 
s
 = 
cÚf
.
	`begš
(), *
’d
 = cÚf.
	`’d
();

309 
VeùÜ
<
IP£cRou‹
> 
Şd_rou‹s
;

310 
r
 = 0;

312 
s
 < 
’d
) {

313 cÚ¡ * 
Æ
 = 
	`fšd
(
s
, 
’d
, '\n');

314 
SŒšg
 
lše
 = 
cÚf
.
	`sub¡ršg
(
s
, 
Æ
);

316 
SŒšg
 
fœ¡_wÜd
 = 
	`ı_shiá_¥aûvec
(
lše
);

317 
commªd
;

318 ià(
fœ¡_wÜd
 == "add")

319 
commªd
 = 
CMD_ADD
;

320 ià(
fœ¡_wÜd
 == "remove")

321 
commªd
 = 
CMD_REMOVE
;

322 ià(
fœ¡_wÜd
 == "set")

323 
commªd
 = 
CMD_SET
;

324 ià(!
fœ¡_wÜd
)

327 
r
 = 
”rh
->
	`”rÜ
("bad commªd '%#s'", 
fœ¡_wÜd
.
	`c_¡r
());

328 
rŞlback
;

331 ià((
r
 = 
bË
->
	`run_commªd
(
commªd
, 
lše
, &
Şd_rou‹s
, 
”rh
)) < 0)

332 
rŞlback
;

334 
s
 = 
Æ
 + 1;

338 
rŞlback
:

339 
Şd_rou‹s
.
	`size
()) {

340 cÚ¡ 
IP£cRou‹
& 
¹
 = 
Şd_rou‹s
.
	`back
();

341 ià(
¹
.
exŒa
 =ğ
CMD_REMOVE
)

342 
bË
->
	`add_rou‹
(
¹
, 
çl£
, 0, 
”rh
);

343 ià(
¹
.
exŒa
 =ğ
CMD_ADD
)

344 
bË
->
	`»move_rou‹
(
¹
, 0, 
”rh
);

346 
bË
->
	`add_rou‹
(
¹
, 
Œue
, 0, 
”rh
);

347 
Şd_rou‹s
.
	`pİ_back
();

349  
r
;

350 
	}
}

352 
SŒšg


353 
	gIP£cRou‹TabË
::
	$bË_hªdËr
(
EËm’t
 *
e
, *)

355 
IP£cRou‹TabË
 *
r
 = 
¡©ic_ÿ¡
<IP£cRou‹TabË*>(
e
);

356  
r
->
	`dump_rou‹s
();

357 
	}
}

360 
	gIP£cRou‹TabË
::
	$lookup_hªdËr
(, 
SŒšg
& 
s
, 
EËm’t
* 
e
, cÚ¡ 
HªdËr
*, 
E¼ÜHªdËr
* 
”rh
)

362 
IP£cRou‹TabË
 *
bË
 = 
¡©ic_ÿ¡
<IP£cRou‹TabË*>(
e
);

363 
IPAdd»ss
 
a
;

364 ià(
	`IPAdd»ssArg
().
	`·r£
(
	`ı_uncomm’t
(
s
), 
a
, 
bË
)) {

365 
IPAdd»ss
 
gw
;

366 
ušt32_t
 
¥i
;

367 
SAD©aTu¶e
 * 
§_d©a
;

368 
pÜt
 = 
bË
->
	`lookup_rou‹
(
a
, 
gw
,
¥i
,
§_d©a
);

369 ià(
gw
)

370 
s
 = 
	`SŒšg
(
pÜt
è+ " " + 
gw
.
	`uÅ¬£
();

372 
s
 = 
	`SŒšg
(
pÜt
);

375  
”rh
->
	`”rÜ
("ex³ùed IP‡dd»ss,‚Ù '%s'", 
s
.
	`c_¡r
());

376 
	}
}

379 
	gIP£cRou‹TabË
::
	$add_hªdËrs
()

381 
	`add_wr™e_hªdËr
("add", 
add_rou‹_hªdËr
, 0);

382 
	`add_wr™e_hªdËr
("£t", 
add_rou‹_hªdËr
, 1);

383 
	`add_wr™e_hªdËr
("»move", 
»move_rou‹_hªdËr
, 0);

384 
	`add_wr™e_hªdËr
("ù¾", 
ù¾_hªdËr
, 0);

385 
	`add_»ad_hªdËr
("bË", 
bË_hªdËr
, 0);

386 
	`£t_hªdËr
("lookup", 
HªdËr
::
OP_READ
 | HªdËr::
READ_PARAM
, 
lookup_hªdËr
);

387 
	}
}

389 
CLICK_ENDDECLS


390 
ELEMENT_PROVIDES
(
IP£cRou‹TabË
)

	@ipsec/ipsecroutetable.hh

2 #iâdeà
CLICK_IPSECROUTETABLE_HH


3 
	#CLICK_IPSECROUTETABLE_HH


	)

4 
	~<şick/glue.hh
>

5 
	~<şick/–em’t.hh
>

6 
	~"§bË.hh
"

7 
	~"§d©©u¶e.hh
"

8 
CLICK_DECLS


175 
	sIP£cRou‹
 {

176 
IPAdd»ss
 
	maddr
;

177 
IPAdd»ss
 
	mmask
;

178 
IPAdd»ss
 
	mgw
;

179 
št32_t
 
	mpÜt
;

180 
št32_t
 
	mexŒa
;

182 
ušt32_t
 
	m¥i
;

183 
SAD©aTu¶e
 * 
	m§_d©a
;

185 
IP£cRou‹
(è: 
pÜt
(-1) { }

187 
šlše
 
boŞ
 
»®
(ècÚ¡ {  
pÜt
 > (
št32_t
) -0x80000000; }

188 
šlše
 
kl
(è{ 
	maddr
 = 0; 
	mmask
 = 0xFFFFFFFFU; 
	mpÜt
 = -0x80000000; }

189 
šlše
 
boŞ
 
cÚšs
(
IPAdd»ss
 
a
) const;

190 
šlše
 
boŞ
 
cÚšs
(cÚ¡ 
IP£cRou‹
& 
r
) const;

191 
šlše
 
boŞ
 
mask_as_¥ecific
(
IPAdd»ss
 
m
) const;

192 
šlše
 
boŞ
 
mask_as_¥ecific
(cÚ¡ 
IP£cRou‹
& 
r
) const;

193 
šlše
 
boŞ
 
m©ch
(cÚ¡ 
IP£cRou‹
& 
r
) const;

194 
´efix_Ën
(ècÚ¡ {  
	mmask
.
mask_to_´efix_Ën
(); }

196 
	mSŒšgAccum
 &
uÅ¬£
(
SŒšgAccum
&, 
boŞ
 
bs
) const;

197 
SŒšg
 
uÅ¬£
() const;

198 
SŒšg
 
uÅ¬£_addr
(ècÚ¡ {  
	maddr
.
uÅ¬£_w™h_mask
(
mask
); }

202 şas 
	cIP£cRou‹TabË
 : 
public
 
EËm’t
 {…ublic:

204 * 
ÿ¡
(const *);

205 
cÚfigu»
(
VeùÜ
<
SŒšg
>&, 
E¼ÜHªdËr
*è
	mCLICK_COLD
;

206 
	$add_hªdËrs
(è
CLICK_COLD
;

208 
vœtu®
 
	`add_rou‹
(cÚ¡ 
IP£cRou‹
& 
rou‹
, 
boŞ
 
®low_»¶aû
, IP£cRou‹* 
»¶aûd_rou‹
, 
E¼ÜHªdËr
* 
”rh
);

209 
vœtu®
 
	`»move_rou‹
(cÚ¡ 
IP£cRou‹
& 
rou‹
, IP£cRou‹* 
»moved_rou‹
, 
E¼ÜHªdËr
* 
”rh
);

210 
vœtu®
 
	$lookup_rou‹
(
IPAdd»ss
 
de¡
, IPAdd»s &
gw
, &
¥i
, 
SAD©aTu¶e
 * &
§_d©a
) const = 0;

211 
vœtu®
 
SŒšg
 
	`dump_rou‹s
();

213 
	`push
(
pÜt
, 
Pack‘
* 
p
);

215 
	`add_rou‹_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

216 
	`»move_rou‹_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

217 
	`ù¾_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

218 
	`lookup_hªdËr
(
İ”©iÚ
, 
SŒšg
&, 
EËm’t
*, cÚ¡ 
HªdËr
*, 
E¼ÜHªdËr
*);

219 
SŒšg
 
	`bË_hªdËr
(
EËm’t
*, *);

221 
SATabË
 
_§_bË
;

223 
´iv©e
:

224 ’um { 
CMD_ADD
, 
CMD_SET
, 
CMD_REMOVE
 };

225 
	`run_commªd
(
commªd
, cÚ¡ 
SŒšg
 &, 
VeùÜ
<
IP£cRou‹
>* 
Şd_rou‹s
, 
E¼ÜHªdËr
*);

227 
	}
};

229 
šlše
 
	gSŒšgAccum
&

230 
	gİ”©Ü
<<(
	gSŒšgAccum
& 
	g§
, cÚ¡ 
	gIP£cRou‹
& 
	grou‹
)

232  
	grou‹
.
uÅ¬£
(
§
, 
çl£
);

235 
šlše
 
boŞ


236 
	gIP£cRou‹
::
	$cÚšs
(
IPAdd»ss
 
a
) const

238  
a
.
	`m©ches_´efix
(
addr
, 
mask
);

239 
	}
}

241 
šlše
 
boŞ


242 
	gIP£cRou‹
::
	$cÚšs
(cÚ¡ 
IP£cRou‹
& 
r
) const

244  
r
.
addr
.
	`m©ches_´efix
×ddr, 
mask
è&&„.mask.
	`mask_as_¥ecific
(mask);

245 
	}
}

247 
šlše
 
boŞ


248 
	gIP£cRou‹
::
	$mask_as_¥ecific
(
IPAdd»ss
 
m
) const

250  
mask
.
	`mask_as_¥ecific
(
m
);

251 
	}
}

253 
šlše
 
boŞ


254 
	gIP£cRou‹
::
	$mask_as_¥ecific
(cÚ¡ 
IP£cRou‹
& 
r
) const

256  
mask
.
	`mask_as_¥ecific
(
r
.mask);

257 
	}
}

259 
šlše
 
boŞ


260 
	gIP£cRou‹
::
	$m©ch
(cÚ¡ 
IP£cRou‹
& 
r
) const

262  
addr
 =ğ
r
.add¸&& 
mask
 ==„.mask

263 && (
pÜt
 < 0 || (
gw
 =ğ
r
.gw &&…ort ==„.port));

264 
	}
}

266 
	gCLICK_ENDDECLS


	@ipsec/radixipseclookup.cc

27 
	~<şick/cÚfig.h
>

28 
	~<şick/add»ss.hh
>

29 
	~<şick/cÚå¬£.hh
>

30 
	~<şick/”rÜ.hh
>

31 
	~<şick/glue.hh
>

32 
	~<şick/¡¿ccum.hh
>

33 
	~"¿dix£şookup.hh
"

34 
	~"§bË.hh
"

35 
	~"§d©©u¶e.hh
"

36 
CLICK_DECLS


38 
	gRadixIP£cLookup
::
Radix
*

39 
RadixIP£cLookup
::
Radix
::
	$make_¿dix
(
b™shiá
, 
n
)

41 ià(
Radix
* 
r
 = (Radix*è
Ãw
 [(Radixè+ 
n
 * (
Chd
)]) {

42 
r
->
_rou‹_šdex
 = -1;

43 
r
->
_b™shiá
 = 
b™shiá
;

44 
r
->
_n
 = 
n
;

45 
r
->
_nchd»n
 = 0;

46 
	`mem£t
(
r
->
_chd»n
, 0, 
n
 * (
Chd
));

47 
i
 = 0; i < 
n
; i++)

48 
r
->
_chd»n
[
i
].
key
 = -1;

49  
r
;

52 
	}
}

55 
	gRadixIP£cLookup
::
Radix
::
	$ä“_¿dix
(
Radix
* 
r
)

57 ià(
r
->
_nchd»n
)

58 
i
 = 0; i < 
r
->
_n
; i++)

59 ià(
r
->
_chd»n
[
i
].
chd
)

60 
	`ä“_¿dix
(
r
->
_chd»n
[
i
].
chd
);

61 
d–‘e
[] (*)
r
;

62 
	}
}

64 
	gRadixIP£cLookup
::
Radix
*

65 
RadixIP£cLookup
::
Radix
::
	$chªge
(
ušt32_t
 
addr
, ušt32_ˆ
Çddr
, 
key
, ušt32_ˆ
key_´iÜ™y
)

67 ià(
Çddr
 == 0) {

68 
i
 = 0; i < 
_n
; i++)

69 ià(
_chd»n
[
i
].
key_´iÜ™y
 <= key_priority) {

70 
_chd»n
[
i
].
key
 = key;

71 
_chd»n
[
i
].
key_´iÜ™y
 = (
key
 < 0 ? 0 : key_priority);

74 
i1
 = 
addr
 >> 
_b™shiá
;

75 
i2
 = 
i1
 + (
Çddr
 >> 
_b™shiá
);

76 
addr
 &ğ(1 << 
_b™shiá
) - 1;

77 
Çddr
 &ğ(1 << 
_b™shiá
) - 1;

79 ià(
i1
 =ğ
i2
) {

80 ià(!
_chd»n
[
i1
].
chd
) {

81 ià((
_chd»n
[
i1
].
chd
 = 
	`make_¿dix
(
_b™shiá
 - 4, 16)))

82 
_nchd»n
++;

84 ià(
_chd»n
[
i1
].
chd
)

85  
_chd»n
[
i1
].
chd
->
	`chªge
(
addr
, 
Çddr
, 
key
, 
key_´iÜ™y
);

88 
i1
 < 
i2
) {

89 ià(
_chd»n
[
i1
].
key_´iÜ™y
 <= key_priority) {

90 ià((
_chd»n
[
i1
].
key
 >= 0) != (key >= 0))

91 
_nchd»n
 +ğ(
key
 >= 0 ? 1 : -1);

92 
_chd»n
[
i1
].
key
 = key;

93 
_chd»n
[
i1
].
key_´iÜ™y
 = (
key
 < 0 ? 0 : key_priority);

95 
i1
++;

99  
this
;

100 
	}
}

103 
	gRadixIP£cLookup
::
	$RadixIP£cLookup
()

104 : 
	`_vä“
(-1), 
	`_deçuÉ_key
(-1), 
	`_¿dix
(
Radix
::
	$make_¿dix
(24, 256))

106 
	}
}

108 
	gRadixIP£cLookup
::~
	$RadixIP£cLookup
()

110 
	}
}

114 
RadixIP£cLookup
::
	$ş—nup
(
CËªupSge
)

116 
_v
.
	`ş—r
();

117 
Radix
::
	`ä“_¿dix
(
_¿dix
);

118 
_¿dix
 = 0;

119 
	}
}

122 
SŒšg


123 
	gRadixIP£cLookup
::
	$dump_rou‹s
()

125 
SŒšgAccum
 
§
;

126 
j
 = 
_vä“
; j >ğ0; j = 
_v
[j].
exŒa
)

127 
_v
[
j
].
	`kl
();

128 
i
 = 0; i < 
_v
.
	`size
(); i++)

129 ià(!
_v
[
i
].
addr
 || _v[i].
mask
)

130 
_v
[
i
].
	`uÅ¬£
(
§
, 
Œue
) << '\n';

131  
§
.
	`ke_¡ršg
();

132 
	}
}

136 
	gRadixIP£cLookup
::
	$add_rou‹
(cÚ¡ 
IP£cRou‹
& 
rou‹
, 
boŞ
 
£t
, IP£cRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
 *)

138 
found
;

139 ià(
_vä“
 < 0) {

140 
found
 = 
_v
.
	`size
();

141 
_v
.
	`push_back
(
	`IP£cRou‹
());

143 
found
 = 
_vä“
;

144 
_vä“
 = 
_v
[
found
].
exŒa
;

146 
_v
[
found
] = 
rou‹
;

147 
_v
[
found
].
exŒa
 = -1;

149 
št32_t
* 
µ»v
;

150 
ušt32_t
 
hmask
 = 
	`Áohl
(
rou‹
.
mask
.
	`addr
());

151 ià(
hmask
) {

152 
Radix
* 
r
 = 
_¿dix
->
	`chªge
(
	`Áohl
(
rou‹
.
addr
.
	`addr
()), ~
hmask
 + 1, 
found
, hmask);

153 
µ»v
 = &
r
->
_rou‹_šdex
;

155 
_deçuÉ_key
 = 
found
;

156 
µ»v
 = &
_deçuÉ_key
;

159 
št32_t
 
j
 = *
µ»v
; j >= 0; j = *pprev)

160 ià(
rou‹
.
addr
 =ğ
_v
[
j
].add¸&&„ou‹.
mask
 == _v[j].mask) {

161 
r
;

162 ià(
Şd_rou‹
)

163 *
Şd_rou‹
 = 
_v
[
j
];

164 ià(!
£t
) {

165 
_v
[
found
] = _v[
j
];

166 
r
 = -
EEXIST
;

168 
_v
[
found
].
exŒa
 = _v[
j
].extra;

169 
r
 = 0;

171 *
µ»v
 = 
found
;

172 
_v
[
j
].
exŒa
 = 
_vä“
;

173 
_vä“
 = 
j
;

174  
r
;

176 
µ»v
 = &
_v
[
j
].
exŒa
;

178 *
µ»v
 = 
found
;

180 
	}
}

183 
	gRadixIP£cLookup
::
	$»move_rou‹
(cÚ¡ 
IP£cRou‹
& 
rou‹
, IP£cRou‹* 
Şd_rou‹
, 
E¼ÜHªdËr
*)

185 
št32_t
* 
µ»v
;

186 
ušt32_t
 
hmask
 = 
	`Áohl
(
rou‹
.
mask
.
	`addr
());

187 ià(
hmask
) {

188 
Radix
* 
r
 = 
_¿dix
->
	`chªge
(
	`Áohl
(
rou‹
.
addr
.
	`addr
()), ~
hmask
 + 1, -1, hmask);

189 
µ»v
 = &
r
->
_rou‹_šdex
;

192 
µ»v
 = &
_deçuÉ_key
;

195 
r
 = -
ENOENT
;

196 
št32_t
 
j
 = *
µ»v
; j >= 0; j = *pprev)

197 ià(
rou‹
.
	`m©ch
(
_v
[
j
])) {

198 ià(
Şd_rou‹
)

199 *
Şd_rou‹
 = 
_v
[
j
];

200 *
µ»v
 = 
_v
[
j
].
exŒa
;

201 
_v
[
j
].
exŒa
 = 
_vä“
;

202 
_vä“
 = 
j
;

203 
r
 = 0;

205 ià(
_v
[
j
].
	`cÚšs
(
rou‹
è&& (
hmask
 = 
	`Áohl
(_v[j].
mask
.
	`addr
())))

206 (è
_¿dix
->
	`chªge
(
	`Áohl
(
_v
[
j
].
addr
.
	`addr
()), ~
hmask
 + 1, j, hmask);

207 
µ»v
 = &
_v
[
j
].
exŒa
;

210  
r
;

211 
	}
}

214 
	gRadixIP£cLookup
::
	$lookup_rou‹
(
IPAdd»ss
 
addr
, IPAdd»s &
gw
, &
¥i
, 
SAD©aTu¶e
* &
§_d©a
) const

216 
key
 = 
Radix
::
	`lookup
(
_¿dix
, 
_deçuÉ_key
, 
	`Áohl
(
addr
.
	`addr
()));

217 ià(
key
 >ğ0 && 
_v
[key].
	`cÚšs
(
addr
)) {

218 
gw
 = 
_v
[
key
].gw;

219 
¥i
 = 
_v
[
key
].spi;

220 
§_d©a
 = 
_v
[
key
].sa_data;

221  
_v
[
key
].
pÜt
;

223 
gw
 = 0;

226 
	}
}

228 
CLICK_ENDDECLS


229 
	$ELEMENT_REQUIRES
(
IP£cRou‹TabË
)

230 
	`EXPORT_ELEMENT
(
RadixIP£cLookup
)

	@ipsec/radixipseclookup.hh

2 #iâdeà
CLICK_RADIXIPSECLOOKUP_HH


3 
	#CLICK_RADIXIPSECLOOKUP_HH


	)

4 
	~<şick/glue.hh
>

5 
	~<şick/–em’t.hh
>

6 
	~"£üou‹bË.hh
"

7 
	~"§bË.hh
"

8 
	~"§d©©u¶e.hh
"

9 
CLICK_DECLS


73 şas 
	cRadixIP£cLookup
 : 
public
 
IP£cRou‹TabË
 {…ublic:

75 
	$RadixIP£cLookup
(è
CLICK_COLD
;

76 ~
	$RadixIP£cLookup
(è
CLICK_COLD
;

78 cÚ¡ *
	$şass_Çme
() const {  "RadixIPsecLookup"; }

79 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

80 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

82 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

84 
	`add_rou‹
(cÚ¡ 
IP£cRou‹
&, 
boŞ
, IP£cRou‹*, 
E¼ÜHªdËr
 *);

85 
	`»move_rou‹
(cÚ¡ 
IP£cRou‹
&, IP£cRou‹*, 
E¼ÜHªdËr
 *);

86 
	$lookup_rou‹
(
IPAdd»ss
, IPAdd»ss&, &, 
SAD©aTu¶e
*&) const;

87 
SŒšg
 
	`dump_rou‹s
();

89 
´iv©e
:

91 
şass
 
Radix
;

94 
VeùÜ
<
IP£cRou‹
> 
_v
;

95 
_vä“
;

97 
št32_t
 
_deçuÉ_key
;

98 
Radix
* 
_¿dix
;

100 
	}
};

104 şas 
	cRadixIP£cLookup
::
Radix
 { 
public
:

106 
Radix
* 
make_¿dix
(
b™shiá
, 
n
);

107 
ä“_¿dix
(
Radix
*);

109 
Radix
* 
chªge
(
ušt32_t
 
addr
, ušt32_ˆ
Çddr
, 
key
, ušt32_ˆ
key_´iÜ™y
);

110 
lookup
(cÚ¡ 
Radix
*, , 
ušt32_t
 
addr
);

112 
	m´iv©e
:

114 
št32_t
 
_rou‹_šdex
;

115 
	m_b™shiá
;

116 
	m_n
;

117 
	m_nchd»n
;

118 
	sChd
 {

119 
	mkey
;

120 
ušt32_t
 
	mkey_´iÜ™y
;

121 
Radix
* 
	mchd
;

122 } 
	g_chd»n
[0];

124 
	$Radix
(è{ 
	}
}

125 ~
	$Radix
(è{ 
	}
}

127 
ä›nd
 
şass
 
	gRadixIP£cLookup
;

131 
šlše
 

132 
	gRadixIP£cLookup
::
Radix
::
	$lookup
(cÚ¡ 
Radix
* 
r
, 
cur
, 
ušt32_t
 
addr
)

134 
r
) {

135 
i1
 = 
addr
 >> 
r
->
_b™shiá
;

136 
addr
 &ğ(1 << 
r
->
_b™shiá
) - 1;

137 ià(
r
->
_chd»n
[
i1
].
key
 >= 0)

138 
cur
 = 
r
->
_chd»n
[
i1
].
key
;

139 
r
 =„->
_chd»n
[
i1
].
chd
;

141  
cur
;

142 
	}
}

144 
	gCLICK_ENDDECLS


	@ipsec/sadatatuple.hh

1 #iâdeà
CLICK_SADATATUPLE_HH


2 
	#CLICK_SADATATUPLE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/add»ss.hh
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<şick/bighashm­.hh
>

7 
	~<şick/glue.hh
>

8 
	gCLICK_DECLS


29 
	#KEY_SIZE
 16

	)

33 şas 
	cSPI
 {

35 
	mpublic
:

36 
šlše
 
	$SPI
(
a
)

37 : 
	$_¥i
(
a
)

41 
šlše
 
	$SPI
()

43 
	`mem£t
(
this
, 0, (*this));

44 
	}
}

46 
šlše
 
İ”©Ü
 
	$boŞ
() const

48  (
_¥i
 != 0);

49 
	}
}

50 
šlše
 
boŞ


51 
	gİ”©Ü
==(
SPI
 
b
)

53  (
this
->
_¥i
 =ğ
b
._spi);

56 
šlše
 
boŞ


57 
	gİ”©Ü
!=(
SPI
 
b
)

59  (
this
->
_¥i
 !ğ
b
._spi);

61 
ušt32_t
 
	$g‘V®ue
() const

63  (
_¥i
);

64 
	}
}

65 
šlše
 
hashcode_t
 
	$hashcode
() const;

66 
´iv©e
:

67 
ušt32_t
 
_¥i
;

68 
	}
};

71 şas 
	cSAD©aTu¶e
 {

72 
	mpublic
:

75 
ušt8_t
 
Enüy±iÚ_key
[
KEY_SIZE
];

76 
ušt8_t
 
	mAuth’tiÿtiÚ_key
[
KEY_SIZE
];

78 
ušt32_t
 
	m»¶ay_¡¬t_couÁ”
;

79 
ušt32_t
 
	mcur_½l
;

80 
ušt8_t
 
	mooowš
;

81 
ušt32_t
 
	mb™m­
;

82 
ušt32_t
 
	mÏ¡£q
;

84 
	$SAD©aTu¶e
() {

85 
	`mem£t
(
this
, 0, (*this));

88 
	$SAD©aTu¶e
(cÚ¡ * 
’c_key
 , cÚ¡ * 
Auth_key
, 
ušt32_t
 
couÁ”
, 
ušt8_t
 
o_oowš
)

90 
	`mem£t
(
this
, 0, (*this));

91 
	`memıy
(
Enüy±iÚ_key
, 
’c_key
, 
KEY_SIZE
);

92 
	`memıy
(
Auth’tiÿtiÚ_key
, 
Auth_key
, 
KEY_SIZE
);

93 
»¶ay_¡¬t_couÁ”
 = 
couÁ”
;

94 
ooowš
 = 
o_oowš
;

95 
b™m­
=0;

96 
Ï¡£q
=
cur_½l
=
couÁ”
;

97 
	}
}

99 
İ”©Ü
 
	$boŞ
() const

101  ((
cur_½l
 != 0));

102 
	}
}

104 
SŒšg
 
	$uÅ¬£_’Œ›s
() const

106 
buf
[71];

107 
i
,
j
;

108 
	`¥rštf
(
buf
," |");

109 
i
=0,
j
=0;i<16;i++,j+=2) {

110 
	`¥rštf
(&
buf
[2+
j
],"%02x",
Enüy±iÚ_key
[
i
]);

112 
	`¥rštf
(&
buf
[34],"| |");

113 
i
=0,
j
=0;i<16;i++,j+=2) {

114 
	`¥rštf
(&
buf
[37+
j
],"%02x",
Auth’tiÿtiÚ_key
[
i
]);

116 
	`¥rštf
(&
buf
[69],"|");

117  
	`SŒšg
(
buf
, 70);

118 
	}
}

122 
šlše
 
hashcode_t
 
	gSPI
::
	$hashcode
() const

124  
_¥i
;

125 
	}
}

127 
	gCLICK_ENDDECLS


	@ipsec/satable.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/cÚå¬£.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şickÃt/‘h”.h
>

25 
	~"§bË.hh
"

26 
	~"§d©©u¶e.hh
"

28 
CLICK_DECLS


30 
	gSATabË
::
	$SATabË
()

32 
	}
}

34 
SATabË
::~
	$SATabË
()

36 
	}
}

39 
SAD©aTu¶e
 *

40 
SATabË
::
	$lookup
(
SPI
 
this_¥i
)

42 ià(!
this_¥i
) {

43 
	`şick_ch©‹r
("%s:†ooku°ÿÎed w™h NULL spi!\n", 
	`Çme
().
	`c_¡r
());

44  
NULL
;

47 
SAD©aTu¶e
 *
d©
 = 
_bË
.
	`fšdp
(
this_¥i
);

48  
d©
;

49 
	}
}

53 
	gSATabË
::
	$š£¹
(
SPI
 
¥i
 , 
SAD©aTu¶e
 
SA_d©a
)

55 ià((!
¥i
è|| (!
SA_d©a
)) {

56 
	`şick_ch©‹r
("SATabË %s: A‰em±Øš£¹ d©¨çed. Inv®id‡rgum’ts\n",
	`Çme
().
	`c_¡r
());

59 
SAD©aTu¶e
 * 
d©
 = 
_bË
.
	`fšdp
(
¥i
);

60 ià(!
d©
) {

61 
_bË
.
	`š£¹
(
¥i
, 
SA_d©a
);

64 
	}
}

68 
	gSATabË
::
	$»move
(
¥i
)

70 if(!
¥i
){

71 
	`şick_ch©‹r
("Invalid SPI…arameter");

74 
SAD©aTu¶e
 *
d©
 = 
_bË
.
	`fšdp
(
¥i
);

75 if(!
d©
) {

76 
	`şick_ch©‹r
("No suchƒntry");

79 
d–‘e
 
d©
;

80 
_bË
.
	`»move
(
	`SPI
(
¥i
));

83 
	}
}

86 
SŒšg


87 
	gSATabË
::
	$´št_§_d©a
()

89 
SŒšgAccum
 
§
;

90 
k
;

91 
SI‹r
 
™”
 = 
_bË
.
	`begš
(); i‹r.
	`live
(); iter++) {

92 
SAD©aTu¶e
 
n
 = 
™”
.
	`v®ue
();

93 
§
 << "\nNew Entry\n";

94 
k
=0; k< 16;k++)

95 {
§
 << 
n
.
Enüy±iÚ_key
[
k
];}

96 
§
 <<" ";

97 
k
=0; k< 16;k++)

98 {
§
 << 
n
.
Auth’tiÿtiÚ_key
[
k
];}

99 
§
 << " ";

101  
§
.
	`ke_¡ršg
();

102 
	}
}

104 
CLICK_ENDDECLS


105 
EXPORT_ELEMENT
(
SATabË
)

	@ipsec/satable.hh

1 #iâdeà
CLICK_SATABLE_HH


2 
	#CLICK_SATABLE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/add»ss.hh
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<şick/bighashm­.hh
>

7 
	~<şick/glue.hh
>

8 
	~"§d©©u¶e.hh
"

10 
CLICK_DECLS


12 şas 
	cSATabË
 : 
public
 
EËm’t
 {…ublic:

14 
	$SATabË
(è
CLICK_COLD
;

15 ~
	$SATabË
(è
CLICK_COLD
;

17 cÚ¡ *
	$şass_Çme
() const {  "SATable"; }

18 
SŒšg
 
	`´št_§_d©a
();

19 
	`š£¹
(
SPI
 
this_¥i
 , 
SAD©aTu¶e
 
SA_d©a
) ;

20 
	`»move
(
¥i
);

21 
SAD©aTu¶e
 * 
	`lookup
(
SPI
 
this_¥i
);

23 
´iv©e
:

25 
HashM­
<
	tSPI
,
	tSAD©aTu¶e
> 
	tSTabË
;

26 
STabË
::
	tcÚ¡_™”©Ü
 
	tSI‹r
;

27 
STabË
 
_bË
;

29 
	}
};

31 
	gCLICK_ENDDECLS


	@ipsec/sha1.cc

18 
	~<şick/cÚfig.h
>

19 #iâdeà
HAVE_IPSEC


22 
	~"sha1.hh
"

23 
	~"e¥.hh
"

24 
	~<şick/add»ss.hh
>

25 
	~<şick/¬gs.hh
>

26 
	~<şickÃt/.h
>

27 
	~<şick/”rÜ.hh
>

28 
	~<şick/glue.hh
>

29 
	~"–em’ts/£c/sha1_im¶.hh
"

30 
	gCLICK_DECLS


32 
	#SHA_DIGEST_LEN
 20

	)

34 
	gIP£cAuthSHA1
::
	$IP£cAuthSHA1
()

36 
	}
}

38 
IP£cAuthSHA1
::~
	$IP£cAuthSHA1
()

40 
	}
}

43 
IP£cAuthSHA1
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

45  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("VERIFY", 
_İ
).
com¶‘e
();

49 
	gIP£cAuthSHA1
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

51 
_drİs
 = 0;

53 
	}
}

56 
Pack‘
 *

57 
	gIP£cAuthSHA1
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

60 ià(
_İ
 =ğ
COMPUTE_AUTH
) {

61 
dige¡
 [
SHA_DIGEST_LEN
];

62 
SHA1_ùx
 
ùx
;

63 
	`SHA1_š™
 (&
ùx
);

64 
	`SHA1_upd©e
 (&
ùx
, (
u_ch¬
*è
p
->
	`d©a
(),…->
	`Ëngth
());

65 
	`SHA1_fš®
 (
dige¡
, &
ùx
);

66 
Wr™abËPack‘
 *
q
 = 
p
->
	`put
(12);

67 
u_ch¬
 *
ah
 = ((u_ch¬*)
q
->
	`d©a
())+q->
	`Ëngth
()-12;

68 
	`memmove
(
ah
, 
dige¡
, 12);

69  
q
;

73 cÚ¡ 
u_ch¬
 *
ah
 = 
p
->
	`d©a
()+p->
	`Ëngth
()-12;

74 
dige¡
 [
SHA_DIGEST_LEN
];

75 
SHA1_ùx
 
ùx
;

76 
	`SHA1_š™
 (&
ùx
);

77 
	`SHA1_upd©e
 (&
ùx
, (
u_ch¬
*è
p
->
	`d©a
(),…->
	`Ëngth
()-12);

78 
	`SHA1_fš®
 (
dige¡
, &
ùx
);

79 ià(
	`memcmp
(
ah
, 
dige¡
, 12)) {

80 ià(
_drİs
 == 0)

81 
	`şick_ch©‹r
("Invalid SHA1‡uthentication digest");

82 
_drİs
++;

83 ià(
	`nouuts
() > 1)

84 
	`ouut
(1).
	`push
(
p
);

86 
p
->
	`kl
();

89 
p
->
	`ke
(12);

90  
p
;

92 
	}
}

94 
SŒšg


95 
	gIP£cAuthSHA1
::
	$drİ_hªdËr
(
EËm’t
 *
e
, *)

97 
IP£cAuthSHA1
 *
a
 = (IP£cAuthSHA1 *)
e
;

98  
	`SŒšg
(
a
->
_drİs
);

99 
	}
}

102 
	gIP£cAuthSHA1
::
	$add_hªdËrs
()

104 
	`add_»ad_hªdËr
("drİs", 
drİ_hªdËr
, 0);

105 
	}
}

107 
CLICK_ENDDECLS


108 
	$EXPORT_ELEMENT
(
IP£cAuthSHA1
)

109 
	`ELEMENT_MT_SAFE
(
IP£cAuthSHA1
)

	@ipsec/sha1.hh

1 #iâdeà
CLICK_IPSECAUTHSHA1_HH


2 
	#CLICK_IPSECAUTHSHA1_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/©omic.hh
>

5 
	~<şick/glue.hh
>

6 
CLICK_DECLS


22 şas 
	cIP£cAuthSHA1
 : 
public
 
EËm’t
 {

24 
public
:

25 
IP£cAuthSHA1
();

26 ~
IP£cAuthSHA1
();

28 cÚ¡ *
	$şass_Çme
() const {  "IPsecAuthSHA1"; }

29 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

31 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

32 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

34 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

35 
	$add_hªdËrs
(è
CLICK_COLD
;

37 
SŒšg
 
	`drİ_hªdËr
(
EËm’t
 *
e
, *
thunk
);

39 
´iv©e
:

41 
_İ
;

42 
©omic_ušt32_t
 
_drİs
;

43 ’um { 
COMPUTE_AUTH
 = 0, 
VERIFY_AUTH
 = 1 
	}
};

46 
	gCLICK_ENDDECLS


	@ipsec/sha1_impl.cc

58 
	~<şick/cÚfig.h
>

59 
	~"sha1_im¶.hh
"

60 
	gCLICK_DECLS


63 
	#ULONG
 

	)

64 
	#UCHAR
 

	)

65 
	#UINT
 

	)

67 #undeà
c2Æ


68 
	#c2Æ
(
c
,
l
) (l =((()(*((c)++)))<<24), \

69 
l
|=((()(*((
c
)++)))<<16), \

70 
l
|=((()(*((
c
)++)))<< 8), \

71 
l
|=((()(*((
c
)++))è))

	)

73 #undeà
p_c2Æ


74 
	#p_c2Æ
(
c
,
l
,
n
) { \

75 
n
) { \

76 0: 
l
 =(()(*((
c
)++)))<<24; \

77 1: 
l
|=(()(*((
c
)++)))<<16; \

78 2: 
l
|=(()(*((
c
)++)))<< 8; \

79 3: 
l
|=(()(*((
c
)++))); \

81 }

	)

83 #undeà
c2Æ_p


85 
	#c2Æ_p
(
c
,
l
,
n
) { \

86 
l
=0; \

87 (
c
)+=
n
; \

88 
n
) { \

89 3: 
l
 =(()(*(--(
c
))))<< 8; \

90 2: 
l
|=(()(*(--(
c
))))<<16; \

91 1: 
l
|=(()(*(--(
c
))))<<24; \

93 }

	)

95 #undeà
p_c2Æ_p


96 
	#p_c2Æ_p
(
c
,
l
,
sc
,
Ën
) { \

97 
sc
) \

99 0: 
l
 =(()(*((
c
)++)))<<24; \

100 ià(--
Ën
 == 0) ; \

101 1: 
l
|=(()(*((
c
)++)))<<16; \

102 ià(--
Ën
 == 0) ; \

103 2: 
l
|=(()(*((
c
)++)))<< 8; \

105 }

	)

107 #undeà
Æ2c


108 
	#Æ2c
(
l
,
c
) (*((c)++)=()(((l)>>24)&0xff), \

109 *((
c
)++)=()(((
l
)>>16)&0xff), \

110 *((
c
)++)=()(((
l
)>> 8)&0xff), \

111 *((
c
)++)=()(((
l
è)&0xff))

	)

113 #undeà
c2l


114 
	#c2l
(
c
,
l
) (l =((()(*((c)++))) ), \

115 
l
|=((()(*((
c
)++)))<< 8), \

116 
l
|=((()(*((
c
)++)))<<16), \

117 
l
|=((()(*((
c
)++)))<<24))

	)

119 #undeà
p_c2l


120 
	#p_c2l
(
c
,
l
,
n
) { \

121 
n
) { \

122 0: 
l
 =(()(*((
c
)++))); \

123 1: 
l
|=(()(*((
c
)++)))<< 8; \

124 2: 
l
|=(()(*((
c
)++)))<<16; \

125 3: 
l
|=(()(*((
c
)++)))<<24; \

127 }

	)

129 #undeà
c2l_p


131 
	#c2l_p
(
c
,
l
,
n
) { \

132 
l
=0; \

133 (
c
)+=
n
; \

134 
n
) { \

135 3: 
l
 =(()(*(--(
c
))))<<16; \

136 2: 
l
|=(()(*(--(
c
))))<< 8; \

137 1: 
l
|=(()(*(--(
c
)))); \

139 }

	)

141 #undeà
p_c2l_p


142 
	#p_c2l_p
(
c
,
l
,
sc
,
Ën
) { \

143 
sc
) \

145 0: 
l
 =(()(*((
c
)++))); \

146 ià(--
Ën
 == 0) ; \

147 1: 
l
|=(()(*((
c
)++)))<< 8; \

148 ià(--
Ën
 == 0) ; \

149 2: 
l
|=(()(*((
c
)++)))<<16; \

151 }

	)

153 #undeà
l2c


154 
	#l2c
(
l
,
c
) (*((c)++)=()(((l) )&0xff), \

155 *((
c
)++)=()(((
l
)>> 8)&0xff), \

156 *((
c
)++)=()(((
l
)>>16)&0xff), \

157 *((
c
)++)=()(((
l
)>>24)&0xff))

	)

159 #undeà
ROTATE


160 #ià
defšed
(
WIN32
)

161 
	#ROTATE
(
a
,
n
è
	`_ÌÙl
×,n)

	)

163 
	#ROTATE
(
a
,
n
è((×)<<Ò))|((×)&0xffffffff)>>(32-Ò))))

	)

167 #ià
defšed
(
WIN32
)

169 
	#EndŸn_Rev”£32
(
a
) \

171 
l
=(
a
); \

172 (
a
)=((
	`ROTATE
(
l
,8)&0x00FF00FF)|(ROTATE(l,24)&0xFF00FF00)); \

173 }

	)

176 
	#EndŸn_Rev”£32
(
a
) \

178 
l
=(
a
); \

179 
l
=(((l&0xFF00FF00)>>8L)|((l&0x00FF00FF)<<8L)); \

180 (
a
)=
	`ROTATE
(
l
,16L); \

181 }

	)

191 
	#F_00_19
(
b
,
c
,
d
è((((cè^ (d)è& (b)è^ (d))

	)

192 
	#F_20_39
(
b
,
c
,
d
è((bè^ (cè^ (d))

	)

193 
	#F_40_59
(
b
,
c
,
d
è(((bè& (c)è| (((b)|(c)è& (d)))

	)

194 
	#F_60_79
(
b
,
c
,
d
è
	`F_20_39
(b,c,d)

	)

196 #ifdeà
SHA_0


197 #undeà
Xupd©e


198 
	#Xupd©e
(
a
,
i
,
Ÿ
,
ib
,
ic
,
id
è
X
[(i)&0x0f]=(a)=\

199 (
Ÿ
[(
i
)&0x0f]^
ib
[((i)+2)&0x0f]^
ic
[((i)+8)&0x0f]^
id
[((i)+13)&0x0f]);

	)

201 #ifdeà
SHA_1


202 #undeà
Xupd©e


203 
	#Xupd©e
(
a
,
i
,
Ÿ
,
ib
,
ic
,
id
) (a)=\

204 (
Ÿ
[(
i
)&0x0f]^
ib
[((i)+2)&0x0f]^
ic
[((i)+8)&0x0f]^
id
[((i)+13)&0x0f]);\

205 
X
[(
i
)&0x0f]=(
a
)=
	`ROTATE
(×),1);

	)

208 
	#BODY_00_15
(
i
,
a
,
b
,
c
,
d
,
e
,
f
,
xa
) \

209 (
f
)=
xa
[
i
]+(
e
)+
K_00_19
+
	`ROTATE
((
a
),5)+
	`F_00_19
((
b
),(
c
),(
d
)); \

210 (
b
)=
	`ROTATE
((b),30);

	)

212 
	#BODY_16_19
(
i
,
a
,
b
,
c
,
d
,
e
,
f
,
xa
,
xb
,
xc
,
xd
) \

213 
	`Xupd©e
(
f
,
i
,
xa
,
xb
,
xc
,
xd
); \

214 (
f
)+=(
e
)+
K_00_19
+
	`ROTATE
((
a
),5)+
	`F_00_19
((
b
),(
c
),(
d
)); \

215 (
b
)=
	`ROTATE
((b),30);

	)

217 
	#BODY_20_31
(
i
,
a
,
b
,
c
,
d
,
e
,
f
,
xa
,
xb
,
xc
,
xd
) \

218 
	`Xupd©e
(
f
,
i
,
xa
,
xb
,
xc
,
xd
); \

219 (
f
)+=(
e
)+
K_20_39
+
	`ROTATE
((
a
),5)+
	`F_20_39
((
b
),(
c
),(
d
)); \

220 (
b
)=
	`ROTATE
((b),30);

	)

222 
	#BODY_32_39
(
i
,
a
,
b
,
c
,
d
,
e
,
f
,
xa
) \

223 
	`Xupd©e
(
f
,
i
,
xa
,xa,xa,xa); \

224 (
f
)+=(
e
)+
K_20_39
+
	`ROTATE
((
a
),5)+
	`F_20_39
((
b
),(
c
),(
d
)); \

225 (
b
)=
	`ROTATE
((b),30);

	)

227 
	#BODY_40_59
(
i
,
a
,
b
,
c
,
d
,
e
,
f
,
xa
) \

228 
	`Xupd©e
(
f
,
i
,
xa
,xa,xa,xa); \

229 (
f
)+=(
e
)+
K_40_59
+
	`ROTATE
((
a
),5)+
	`F_40_59
((
b
),(
c
),(
d
)); \

230 (
b
)=
	`ROTATE
((b),30);

	)

232 
	#BODY_60_79
(
i
,
a
,
b
,
c
,
d
,
e
,
f
,
xa
) \

233 
	`Xupd©e
(
f
,
i
,
xa
,xa,xa,xa); \

234 (
f
)=
X
[(
i
)&0x0f]+(
e
)+
K_60_79
+
	`ROTATE
((
a
),5)+
	`F_60_79
((
b
),(
c
),(
d
)); \

235 (
b
)=
	`ROTATE
((b),30);

	)

238 cÚ¡ 
	gSHA1_v”siÚ
[] = "SHA1…art of SSLeay 0.8.2b 08-Jan-1998";

243 
	#INIT_DATA_h0
 ()0x67452301L

	)

244 
	#INIT_DATA_h1
 ()0xefcdab89L

	)

245 
	#INIT_DATA_h2
 ()0x98badcãL

	)

246 
	#INIT_DATA_h3
 ()0x10325476L

	)

247 
	#INIT_DATA_h4
 ()0xc3d2e1f0L

	)

249 
	#K_00_19
 0x5a827999L

	)

250 
	#K_20_39
 0x6ed9eba1L

	)

251 
	#K_40_59
 0x8f1bbcdcL

	)

252 
	#K_60_79
 0xÿ62c1d6L

	)

254 #iâdeà
NOPROTO


255 #ifdeà
SHA1_ASM


256 
sha1_block_x86
 (
SHA1_ùx
 * 
c
, *
p
, 
num
);

257 
	#sha1_block
 
sha1_block_x86


	)

259 
sha1_block
 (
SHA1_ùx
 * 
c
, *
p
, 
num
);

262 #ifdeà
SHA1_ASM


263 
sha1_block_x86
 ();

264 
	#sha1_block
 
sha1_block_x86


	)

266 
sha1_block
 ();

270 #ià
defšed
(
L_ENDIAN
è&& defšed(
SHA1_ASM
)

271 
	#M_c2Æ
 
c2l


	)

272 
	#M_p_c2Æ
 
p_c2l


	)

273 
	#M_c2Æ_p
 
c2l_p


	)

274 
	#M_p_c2Æ_p
 
p_c2l_p


	)

275 
	#M_Æ2c
 
l2c


	)

277 
	#M_c2Æ
 
c2Æ


	)

278 
	#M_p_c2Æ
 
p_c2Æ


	)

279 
	#M_c2Æ_p
 
c2Æ_p


	)

280 
	#M_p_c2Æ_p
 
p_c2Æ_p


	)

281 
	#M_Æ2c
 
Æ2c


	)

285 
	$SHA1_š™
 (
SHA1_ùx
 * 
c
)

287 
c
->
h0
 = 
INIT_DATA_h0
;

288 
c
->
h1
 = 
INIT_DATA_h1
;

289 
c
->
h2
 = 
INIT_DATA_h2
;

290 
c
->
h3
 = 
INIT_DATA_h3
;

291 
c
->
h4
 = 
INIT_DATA_h4
;

292 
c
->
Nl
 = 0;

293 
c
->
Nh
 = 0;

294 
c
->
num
 = 0;

295 
	}
}

298 
	$SHA1_upd©e
 (
SHA1_ùx
 * 
c
, *
d©a
, 
Ën
)

300 
ULONG
 *
p
;

301 
ew
, 
ec
, 
sw
, 
sc
;

302 
ULONG
 
l
;

304 ià(
Ën
 == 0)

307 
l
 = (
c
->
Nl
 + (
Ën
 << 3)) & 0xffffffffL;

308 ià(
l
 < 
c
->
Nl
)

309 
c
->
Nh
++;

310 
c
->
Nh
 +ğ(
Ën
 >> 29);

311 
c
->
Nl
 = 
l
;

313 ià(
c
->
num
 != 0)

315 
p
 = 
c
->
d©a
;

316 
sw
 = 
c
->
num
 >> 2;

317 
sc
 = 
c
->
num
 & 0x03;

319 ià((
c
->
num
 + 
Ën
è>ğ
SHA_CBLOCK
)

321 
l
 = 
p
[
sw
];

322 
	`M_p_c2Æ
 (
d©a
, 
l
, 
sc
);

323 
p
[
sw
++] = 
l
;

324 ; 
sw
 < 
SHA_LBLOCK
; sw++)

326 
	`M_c2Æ
 (
d©a
, 
l
);

327 
p
[
sw
] = 
l
;

329 
Ën
 -ğ(
SHA_CBLOCK
 - 
c
->
num
);

331 
	`sha1_block
 (
c
, 
p
, 64);

332 
c
->
num
 = 0;

337 
c
->
num
 +ğ(è
Ën
;

338 ià((
sc
 + 
Ën
) < 4)

340 
l
 = 
p
[
sw
];

341 
	`M_p_c2Æ_p
 (
d©a
, 
l
, 
sc
, 
Ën
);

342 
p
[
sw
] = 
l
;

346 
ew
 = (
c
->
num
 >> 2);

347 
ec
 = (
c
->
num
 & 0x03);

348 
l
 = 
p
[
sw
];

349 
	`M_p_c2Æ
 (
d©a
, 
l
, 
sc
);

350 
p
[
sw
++] = 
l
;

351 ; 
sw
 < 
ew
; sw++)

353 
	`M_c2Æ
 (
d©a
, 
l
);

354 
p
[
sw
] = 
l
;

356 ià(
ec
)

358 
	`M_c2Æ_p
 (
d©a
, 
l
, 
ec
);

359 
p
[
sw
] = 
l
;

372 #ià
	`defšed
(
B_ENDIAN
è|| defšed(
SHA1_ASM
)

373 ià((((è
d©a
è%  (
ULONG
)) == 0)

375 
sw
 = 
Ën
 / 
SHA_CBLOCK
;

376 ià(
sw
)

378 
sw
 *ğ
SHA_CBLOCK
;

379 
	`sha1_block
 (
c
, (
ULONG
 *è
d©a
, 
sw
);

380 
d©a
 +ğ
sw
;

381 
Ën
 -ğ
sw
;

388 
p
 = 
c
->
d©a
;

389 
Ën
 >ğ
SHA_CBLOCK
)

391 #ià
	`defšed
(
B_ENDIAN
è|| defšed(
L_ENDIAN
)

392 ià(
p
 !ğ(*è
d©a
)

393 
	`memıy
 (
p
, 
d©a
, 
SHA_CBLOCK
);

394 
d©a
 +ğ
SHA_CBLOCK
;

395 #ifdeà
L_ENDIAN


396 #iâdeà
SHA1_ASM


397 
sw
 = (
SHA_LBLOCK
 / 4); sw; sw--)

399 
	`EndŸn_Rev”£32
 (
p
[0]);

400 
	`EndŸn_Rev”£32
 (
p
[1]);

401 
	`EndŸn_Rev”£32
 (
p
[2]);

402 
	`EndŸn_Rev”£32
 (
p
[3]);

403 
p
 += 4;

405 
p
 = 
c
->
d©a
;

409 
sw
 = (
SHA_BLOCK
 / 4); sw; sw--)

411 
	`M_c2Æ
 (
d©a
, 
l
);

412 *(
p
++èğ
l
;

413 
	`M_c2Æ
 (
d©a
, 
l
);

414 *(
p
++èğ
l
;

415 
	`M_c2Æ
 (
d©a
, 
l
);

416 *(
p
++èğ
l
;

417 
	`M_c2Æ
 (
d©a
, 
l
);

418 *(
p
++èğ
l
;

420 
p
 = 
c
->
d©a
;

422 
	`sha1_block
 (
c
, 
p
, 64);

423 
Ën
 -ğ
SHA_CBLOCK
;

425 
ec
 = (è
Ën
;

426 
c
->
num
 = 
ec
;

427 
ew
 = (
ec
 >> 2);

428 
ec
 &= 0x03;

430 
sw
 = 0; sw < 
ew
; sw++)

432 
	`M_c2Æ
 (
d©a
, 
l
);

433 
p
[
sw
] = 
l
;

435 
	`M_c2Æ_p
 (
d©a
, 
l
, 
ec
);

436 
p
[
sw
] = 
l
;

437 
	}
}

440 
	$SHA1_ŒªsfÜm
 (
SHA1_ùx
 *
c
, *
b
)

442 
ULONG
 
p
[16];

443 #iâdeà
B_ENDIAN


444 
ULONG
 *
q
;

445 
i
;

448 #ià
	`defšed
(
B_ENDIAN
è|| defšed(
L_ENDIAN
)

449 
	`memıy
 (
p
, 
b
, 64);

450 #ifdeà
L_ENDIAN


451 
q
 = 
p
;

452 
i
 = (
SHA_LBLOCK
 / 4); i; i--)

454 
	`EndŸn_Rev”£32
 (
q
[0]);

455 
	`EndŸn_Rev”£32
 (
q
[1]);

456 
	`EndŸn_Rev”£32
 (
q
[2]);

457 
	`EndŸn_Rev”£32
 (
q
[3]);

458 
q
 += 4;

462 
q
 = 
p
;

463 
i
 = (
SHA_LBLOCK
 / 4); i; i--)

465 
ULONG
 
l
;

466 
	`c2Æ
 (
b
, 
l
);

467 *(
q
++èğ
l
;

468 
	`c2Æ
 (
b
, 
l
);

469 *(
q
++èğ
l
;

470 
	`c2Æ
 (
b
, 
l
);

471 *(
q
++èğ
l
;

472 
	`c2Æ
 (
b
, 
l
);

473 *(
q
++èğ
l
;

476 
	`sha1_block
 (
c
, 
p
, 64);

477 
	}
}

479 #iâdeà
SHA1_ASM


482 
	$sha1_block
 (
SHA1_ùx
 *
c
, *
W
, 
num
)

484 
ULONG
 
A
, 
B
, 
C
, 
D
, 
E
, 
T
;

485 
ULONG
 
X
[16];

487 
A
 = 
c
->
h0
;

488 
B
 = 
c
->
h1
;

489 
C
 = 
c
->
h2
;

490 
D
 = 
c
->
h3
;

491 
E
 = 
c
->
h4
;

495 
	`BODY_00_15
 (0, 
A
, 
B
, 
C
, 
D
, 
E
, 
T
, 
W
);

496 
	`BODY_00_15
 (1, 
T
, 
A
, 
B
, 
C
, 
D
, 
E
, 
W
);

497 
	`BODY_00_15
 (2, 
E
, 
T
, 
A
, 
B
, 
C
, 
D
, 
W
);

498 
	`BODY_00_15
 (3, 
D
, 
E
, 
T
, 
A
, 
B
, 
C
, 
W
);

499 
	`BODY_00_15
 (4, 
C
, 
D
, 
E
, 
T
, 
A
, 
B
, 
W
);

500 
	`BODY_00_15
 (5, 
B
, 
C
, 
D
, 
E
, 
T
, 
A
, 
W
);

501 
	`BODY_00_15
 (6, 
A
, 
B
, 
C
, 
D
, 
E
, 
T
, 
W
);

502 
	`BODY_00_15
 (7, 
T
, 
A
, 
B
, 
C
, 
D
, 
E
, 
W
);

503 
	`BODY_00_15
 (8, 
E
, 
T
, 
A
, 
B
, 
C
, 
D
, 
W
);

504 
	`BODY_00_15
 (9, 
D
, 
E
, 
T
, 
A
, 
B
, 
C
, 
W
);

505 
	`BODY_00_15
 (10, 
C
, 
D
, 
E
, 
T
, 
A
, 
B
, 
W
);

506 
	`BODY_00_15
 (11, 
B
, 
C
, 
D
, 
E
, 
T
, 
A
, 
W
);

507 
	`BODY_00_15
 (12, 
A
, 
B
, 
C
, 
D
, 
E
, 
T
, 
W
);

508 
	`BODY_00_15
 (13, 
T
, 
A
, 
B
, 
C
, 
D
, 
E
, 
W
);

509 
	`BODY_00_15
 (14, 
E
, 
T
, 
A
, 
B
, 
C
, 
D
, 
W
);

510 
	`BODY_00_15
 (15, 
D
, 
E
, 
T
, 
A
, 
B
, 
C
, 
W
);

511 
	`BODY_16_19
 (16, 
C
, 
D
, 
E
, 
T
, 
A
, 
B
, 
W
, W, W, W);

512 
	`BODY_16_19
 (17, 
B
, 
C
, 
D
, 
E
, 
T
, 
A
, 
W
, W, W, W);

513 
	`BODY_16_19
 (18, 
A
, 
B
, 
C
, 
D
, 
E
, 
T
, 
W
, W, W, W);

514 
	`BODY_16_19
 (19, 
T
, 
A
, 
B
, 
C
, 
D
, 
E
, 
W
, W, W, 
X
);

516 
	`BODY_20_31
 (20, 
E
, 
T
, 
A
, 
B
, 
C
, 
D
, 
W
, W, W, 
X
);

517 
	`BODY_20_31
 (21, 
D
, 
E
, 
T
, 
A
, 
B
, 
C
, 
W
, W, W, 
X
);

518 
	`BODY_20_31
 (22, 
C
, 
D
, 
E
, 
T
, 
A
, 
B
, 
W
, W, W, 
X
);

519 
	`BODY_20_31
 (23, 
B
, 
C
, 
D
, 
E
, 
T
, 
A
, 
W
, W, W, 
X
);

520 
	`BODY_20_31
 (24, 
A
, 
B
, 
C
, 
D
, 
E
, 
T
, 
W
, W, 
X
, X);

521 
	`BODY_20_31
 (25, 
T
, 
A
, 
B
, 
C
, 
D
, 
E
, 
W
, W, 
X
, X);

522 
	`BODY_20_31
 (26, 
E
, 
T
, 
A
, 
B
, 
C
, 
D
, 
W
, W, 
X
, X);

523 
	`BODY_20_31
 (27, 
D
, 
E
, 
T
, 
A
, 
B
, 
C
, 
W
, W, 
X
, X);

524 
	`BODY_20_31
 (28, 
C
, 
D
, 
E
, 
T
, 
A
, 
B
, 
W
, W, 
X
, X);

525 
	`BODY_20_31
 (29, 
B
, 
C
, 
D
, 
E
, 
T
, 
A
, 
W
, W, 
X
, X);

526 
	`BODY_20_31
 (30, 
A
, 
B
, 
C
, 
D
, 
E
, 
T
, 
W
, 
X
, X, X);

527 
	`BODY_20_31
 (31, 
T
, 
A
, 
B
, 
C
, 
D
, 
E
, 
W
, 
X
, X, X);

528 
	`BODY_32_39
 (32, 
E
, 
T
, 
A
, 
B
, 
C
, 
D
, 
X
);

529 
	`BODY_32_39
 (33, 
D
, 
E
, 
T
, 
A
, 
B
, 
C
, 
X
);

530 
	`BODY_32_39
 (34, 
C
, 
D
, 
E
, 
T
, 
A
, 
B
, 
X
);

531 
	`BODY_32_39
 (35, 
B
, 
C
, 
D
, 
E
, 
T
, 
A
, 
X
);

532 
	`BODY_32_39
 (36, 
A
, 
B
, 
C
, 
D
, 
E
, 
T
, 
X
);

533 
	`BODY_32_39
 (37, 
T
, 
A
, 
B
, 
C
, 
D
, 
E
, 
X
);

534 
	`BODY_32_39
 (38, 
E
, 
T
, 
A
, 
B
, 
C
, 
D
, 
X
);

535 
	`BODY_32_39
 (39, 
D
, 
E
, 
T
, 
A
, 
B
, 
C
, 
X
);

537 
	`BODY_40_59
 (40, 
C
, 
D
, 
E
, 
T
, 
A
, 
B
, 
X
);

538 
	`BODY_40_59
 (41, 
B
, 
C
, 
D
, 
E
, 
T
, 
A
, 
X
);

539 
	`BODY_40_59
 (42, 
A
, 
B
, 
C
, 
D
, 
E
, 
T
, 
X
);

540 
	`BODY_40_59
 (43, 
T
, 
A
, 
B
, 
C
, 
D
, 
E
, 
X
);

541 
	`BODY_40_59
 (44, 
E
, 
T
, 
A
, 
B
, 
C
, 
D
, 
X
);

542 
	`BODY_40_59
 (45, 
D
, 
E
, 
T
, 
A
, 
B
, 
C
, 
X
);

543 
	`BODY_40_59
 (46, 
C
, 
D
, 
E
, 
T
, 
A
, 
B
, 
X
);

544 
	`BODY_40_59
 (47, 
B
, 
C
, 
D
, 
E
, 
T
, 
A
, 
X
);

545 
	`BODY_40_59
 (48, 
A
, 
B
, 
C
, 
D
, 
E
, 
T
, 
X
);

546 
	`BODY_40_59
 (49, 
T
, 
A
, 
B
, 
C
, 
D
, 
E
, 
X
);

547 
	`BODY_40_59
 (50, 
E
, 
T
, 
A
, 
B
, 
C
, 
D
, 
X
);

548 
	`BODY_40_59
 (51, 
D
, 
E
, 
T
, 
A
, 
B
, 
C
, 
X
);

549 
	`BODY_40_59
 (52, 
C
, 
D
, 
E
, 
T
, 
A
, 
B
, 
X
);

550 
	`BODY_40_59
 (53, 
B
, 
C
, 
D
, 
E
, 
T
, 
A
, 
X
);

551 
	`BODY_40_59
 (54, 
A
, 
B
, 
C
, 
D
, 
E
, 
T
, 
X
);

552 
	`BODY_40_59
 (55, 
T
, 
A
, 
B
, 
C
, 
D
, 
E
, 
X
);

553 
	`BODY_40_59
 (56, 
E
, 
T
, 
A
, 
B
, 
C
, 
D
, 
X
);

554 
	`BODY_40_59
 (57, 
D
, 
E
, 
T
, 
A
, 
B
, 
C
, 
X
);

555 
	`BODY_40_59
 (58, 
C
, 
D
, 
E
, 
T
, 
A
, 
B
, 
X
);

556 
	`BODY_40_59
 (59, 
B
, 
C
, 
D
, 
E
, 
T
, 
A
, 
X
);

558 
	`BODY_60_79
 (60, 
A
, 
B
, 
C
, 
D
, 
E
, 
T
, 
X
);

559 
	`BODY_60_79
 (61, 
T
, 
A
, 
B
, 
C
, 
D
, 
E
, 
X
);

560 
	`BODY_60_79
 (62, 
E
, 
T
, 
A
, 
B
, 
C
, 
D
, 
X
);

561 
	`BODY_60_79
 (63, 
D
, 
E
, 
T
, 
A
, 
B
, 
C
, 
X
);

562 
	`BODY_60_79
 (64, 
C
, 
D
, 
E
, 
T
, 
A
, 
B
, 
X
);

563 
	`BODY_60_79
 (65, 
B
, 
C
, 
D
, 
E
, 
T
, 
A
, 
X
);

564 
	`BODY_60_79
 (66, 
A
, 
B
, 
C
, 
D
, 
E
, 
T
, 
X
);

565 
	`BODY_60_79
 (67, 
T
, 
A
, 
B
, 
C
, 
D
, 
E
, 
X
);

566 
	`BODY_60_79
 (68, 
E
, 
T
, 
A
, 
B
, 
C
, 
D
, 
X
);

567 
	`BODY_60_79
 (69, 
D
, 
E
, 
T
, 
A
, 
B
, 
C
, 
X
);

568 
	`BODY_60_79
 (70, 
C
, 
D
, 
E
, 
T
, 
A
, 
B
, 
X
);

569 
	`BODY_60_79
 (71, 
B
, 
C
, 
D
, 
E
, 
T
, 
A
, 
X
);

570 
	`BODY_60_79
 (72, 
A
, 
B
, 
C
, 
D
, 
E
, 
T
, 
X
);

571 
	`BODY_60_79
 (73, 
T
, 
A
, 
B
, 
C
, 
D
, 
E
, 
X
);

572 
	`BODY_60_79
 (74, 
E
, 
T
, 
A
, 
B
, 
C
, 
D
, 
X
);

573 
	`BODY_60_79
 (75, 
D
, 
E
, 
T
, 
A
, 
B
, 
C
, 
X
);

574 
	`BODY_60_79
 (76, 
C
, 
D
, 
E
, 
T
, 
A
, 
B
, 
X
);

575 
	`BODY_60_79
 (77, 
B
, 
C
, 
D
, 
E
, 
T
, 
A
, 
X
);

576 
	`BODY_60_79
 (78, 
A
, 
B
, 
C
, 
D
, 
E
, 
T
, 
X
);

577 
	`BODY_60_79
 (79, 
T
, 
A
, 
B
, 
C
, 
D
, 
E
, 
X
);

579 
c
->
h0
 = (c->h0 + 
E
) & 0xffffffffL;

580 
c
->
h1
 = (c->h1 + 
T
) & 0xffffffffL;

581 
c
->
h2
 = (c->h2 + 
A
) & 0xffffffffL;

582 
c
->
h3
 = (c->h3 + 
B
) & 0xffffffffL;

583 
c
->
h4
 = (c->h4 + 
C
) & 0xffffffffL;

585 
num
 -= 64;

586 ià(
num
 <= 0)

589 
A
 = 
c
->
h0
;

590 
B
 = 
c
->
h1
;

591 
C
 = 
c
->
h2
;

592 
D
 = 
c
->
h3
;

593 
E
 = 
c
->
h4
;

595 
W
 += 16;

597 
	}
}

601 
	$SHA1_fš®
 (*
md
, 
SHA1_ùx
 *
c
)

603 
i
, 
j
;

604 
ULONG
 
l
;

605 
ULONG
 *
p
;

606 
’d
[4] = { 0x80, 0x00, 0x00, 0x00 };

607 *
ı
 = 
’d
;

610 
p
 = 
c
->
d©a
;

611 
j
 = 
c
->
num
;

612 
i
 = 
j
 >> 2;

613 #ifdeà
PURIFY


614 ià((
j
 & 0x03) == 0)

615 
p
[
i
] = 0;

617 
l
 = 
p
[
i
];

618 
	`M_p_c2Æ
 (
ı
, 
l
, 
j
 & 0x03);

619 
p
[
i
] = 
l
;

620 
i
++;

622 ià(
c
->
num
 >ğ
SHA_LAST_BLOCK
)

624 ; 
i
 < 
SHA_LBLOCK
; i++)

625 
p
[
i
] = 0;

626 
	`sha1_block
 (
c
, 
p
, 64);

627 
i
 = 0;

629 ; 
i
 < (
SHA_LBLOCK
 - 2); i++)

630 
p
[
i
] = 0;

631 
p
[
SHA_LBLOCK
 - 2] = 
c
->
Nh
;

632 
p
[
SHA_LBLOCK
 - 1] = 
c
->
Nl
;

633 #ià
	`defšed
(
L_ENDIAN
è&& defšed(
SHA1_ASM
)

634 
	`EndŸn_Rev”£32
 (
p
[
SHA_LBLOCK
 - 2]);

635 
	`EndŸn_Rev”£32
 (
p
[
SHA_LBLOCK
 - 1]);

637 
	`sha1_block
 (
c
, 
p
, 64);

638 
ı
 = 
md
;

639 
l
 = 
c
->
h0
;

640 
	`Æ2c
 (
l
, 
ı
);

641 
l
 = 
c
->
h1
;

642 
	`Æ2c
 (
l
, 
ı
);

643 
l
 = 
c
->
h2
;

644 
	`Æ2c
 (
l
, 
ı
);

645 
l
 = 
c
->
h3
;

646 
	`Æ2c
 (
l
, 
ı
);

647 
l
 = 
c
->
h4
;

648 
	`Æ2c
 (
l
, 
ı
);

652 
c
->
num
 = 0;

654 
	}
}

657 
	gCLICK_ENDDECLS


	@ipsec/sha1_impl.hh

58 #iâdeà
SHA1_IMPL_HH


59 
	#SHA1_IMPL_HH


	)

60 
	gCLICK_DECLS


62 #undeà
SHA_0


63 
	#SHA_1


	)

65 
	#SHA_CBLOCK
 64

	)

66 
	#SHA_LBLOCK
 16

	)

67 
	#SHA_BLOCK
 16

	)

68 
	#SHA_LAST_BLOCK
 56

	)

69 
	#SHA_LENGTH_BLOCK
 8

	)

70 
	#SHA_DIGEST_LENGTH
 20

	)

71 
	sSHA¡©e_¡
 {

72 
	mh0
, 
	mh1
, 
	mh2
, 
	mh3
, 
	mh4
;

73 
	mNl
, 
	mNh
;

74 
	md©a
[
SHA_LBLOCK
];

75 
	mnum
;

76 } 
	tSHA1_ùx
;

78 
SHA1_š™
 (
SHA1_ùx
 * 
c
);

79 
SHA1_upd©e
 (
SHA1_ùx
 * 
c
, *
d©a
, 
Ën
);

80 
SHA1_fš®
 (*
md
, 
SHA1_ùx
 * 
c
);

81 
SHA1_ŒªsfÜm
 (
SHA1_ùx
 * 
c
, *
d©a
);

83 
	gCLICK_ENDDECLS


	@json/json.cc

20 
	~<şick/cÚfig.h
>

21 
	~"jsÚ.hh
"

22 
	~<şick/cÚå¬£.hh
>

23 
CLICK_DECLS


61 
	gJsÚ
::
¡©ics
[(
JsÚStics
)];

63 
šlše
 
	gJsÚ
::
JsÚStics
::
	$JsÚStics
()

64 : 
	`nuÎ_jsÚ
(), 
	`¬¿y_¡ršg
(
SŒšg
::
	`make_¡abË
("[Array]", 7)),

65 
	`objeù_¡ršg
(
SŒšg
::
	`make_¡abË
("[Object]", 8)) {

66 
	}
}

68 
	gJsÚ
::
	$¡©ic_š™Ÿlize
() {

69 
	`Ãw
((*è
¡©ics
è
JsÚStics
;

70 
	}
}

74 
	gJsÚ
::
ObjeùJsÚ
::
	$ObjeùJsÚ
(cÚ¡ 
ObjeùJsÚ
 &
x
)

75 : 
	`Com¶exJsÚ
(), 
	`os_
(
x
.
os_
), 
	`n_
(x.
n_
), 
	`ÿ·c™y_
(x.
ÿ·c™y_
),

76 
	`hash_
(
x
.
hash_
), 
	$Äemoved_
(
x
.
Äemoved_
)

78 
	`grow
(
Œue
);

79 
	}
}

81 
	gJsÚ
::
ObjeùJsÚ
::~
	$ObjeùJsÚ
()

83 
ObjeùI‹m
 *
ob
 = 
os_
, *
Û
 = ob + 
n_
;

84 ; 
ob
 !ğ
Û
; ++ob)

85 ià(
ob
->
Ãxt_
 > -2)

86 
ob
->~
	`ObjeùI‹m
();

87 
d–‘e
[] 
»š‹½»t_ÿ¡
<*>(
os_
);

88 
	}
}

90 
	gJsÚ
::
ObjeùJsÚ
::
	$grow
(
boŞ
 
cİy
)

92 ià(
cİy
 && !
ÿ·c™y_
)

94 
Ãw_ÿ·c™y
;

95 ià(
cİy
)

96 
Ãw_ÿ·c™y
 = 
ÿ·c™y_
;

97 ià(
ÿ·c™y_
)

98 
Ãw_ÿ·c™y
 = 
ÿ·c™y_
 * 2;

100 
Ãw_ÿ·c™y
 = 8;

101 
ObjeùI‹m
 *
Ãw_os
 = 
»š‹½»t_ÿ¡
<ObjeùI‹m *>(
İ”©Ü
 
Ãw
[]((ObjeùI‹mè* 
Ãw_ÿ·c™y
));

102 
ObjeùI‹m
 *
ob
 = 
os_
, *
Û
 = ob + 
n_
;

103 
ObjeùI‹m
 *
oi
 = 
Ãw_os
; 
ob
 !ğ
Û
; ++oi, ++ob)

104 ià(
ob
->
Ãxt_
 > -2) {

105 
	`Ãw
((*è
oi
è
	`ObjeùI‹m
(
ob
->
v_
.
fœ¡
, ob->v_.
£cÚd
, ob->
Ãxt_
);

106 ià(!
cİy
)

107 
ob
->~
	`ObjeùI‹m
();

109 
oi
->
Ãxt_
 = -2;

110 ià(!
cİy
)

111 
İ”©Ü
 
d–‘e
[](
»š‹½»t_ÿ¡
<*>(
os_
));

112 
os_
 = 
Ãw_os
;

113 
ÿ·c™y_
 = 
Ãw_ÿ·c™y
;

114 
	}
}

116 
	gJsÚ
::
ObjeùJsÚ
::
	$»hash
()

118 
hash_
.
	`assign
(hash_.
	`size
() * 2, -1);

119 
i
 = 
n_
 - 1; i >= 0; --i) {

120 
ObjeùI‹m
 &
oi
 = 
	`™em
(
i
);

121 ià(
oi
.
Ãxt_
 > -2) {

122 
b
 = 
	`buck‘
(
oi
.
v_
.
fœ¡
.
	`d©a
(), oi.v_.fœ¡.
	`Ëngth
());

123 
oi
.
Ãxt_
 = 
hash_
[
b
];

124 
hash_
[
b
] = 
i
;

127 
	}
}

129 
	gJsÚ
::
ObjeùJsÚ
::
	$fšd_š£¹
(cÚ¡ 
SŒšg
 &
key
, cÚ¡ 
JsÚ
 &
v®ue
)

131 ià(
hash_
.
	`em±y
())

132 
hash_
.
	`assign
(8, -1);

133 *
b
 = &
hash_
[
	`buck‘
(
key
.
	`d©a
(), key.
	`Ëngth
())], 
chaš
 = 0;

134 *
b
 >ğ0 && 
os_
[*b].
v_
.
fœ¡
 !ğ
key
) {

135 
b
 = &
os_
[*b].
Ãxt_
;

136 ++
chaš
;

138 ià(*
b
 >= 0)

139  *
b
;

141 *
b
 = 
n_
;

142 ià(
n_
 =ğ
ÿ·c™y_
)

143 
	`grow
(
çl£
);

145 
	`Ãw
 ((*è&
os_
[
n_
]è
	`ObjeùI‹m
(
key
, 
v®ue
, -1);

146 ++
n_
;

147 ià(
chaš
 > 4)

148 
	`»hash
();

149  
n_
 - 1;

151 
	}
}

153 
	gJsÚ
 &JsÚ::
ObjeùJsÚ
::
	$g‘_š£¹
(cÚ¡ 
SŒšgRef
 &
key
)

155 ià(
hash_
.
	`em±y
())

156 
hash_
.
	`assign
(8, -1);

157 *
b
 = &
hash_
[
	`buck‘
(
key
.
	`d©a
(), key.
	`Ëngth
())], 
chaš
 = 0;

158 *
b
 >ğ0 && !
os_
[*b].
v_
.
fœ¡
.
	`equ®s
(
key
.
	`d©a
(), key.
	`Ëngth
())) {

159 
b
 = &
os_
[*b].
Ãxt_
;

160 ++
chaš
;

162 ià(*
b
 >= 0)

163  
os_
[*
b
].
v_
.
£cÚd
;

165 *
b
 = 
n_
;

166 ià(
n_
 =ğ
ÿ·c™y_
)

167 
	`grow
(
çl£
);

169 
	`Ãw
 ((*è&
os_
[
n_
]è
	`ObjeùI‹m
(
	`SŒšg
(
key
.
	`d©a
(), key.
	`Ëngth
()), 
	`make_nuÎ
(), -1);

170 ++
n_
;

171 ià(
chaš
 > 4)

172 
	`»hash
();

173  
os_
[
n_
 - 1].
v_
.
£cÚd
;

175 
	}
}

177 
	gJsÚ
::
size_ty³
 
JsÚ
::
ObjeùJsÚ
::
	$”a£
(cÚ¡ 
SŒšgRef
 &
key
)

179 *
b
 = &
hash_
[
	`buck‘
(
key
.
	`d©a
(), key.
	`Ëngth
())];

180 *
b
 >ğ0 && !
os_
[*b].
v_
.
fœ¡
.
	`equ®s
(
key
.
	`d©a
(), key.
	`Ëngth
()))

181 
b
 = &
os_
[*b].
Ãxt_
;

182 ià(*
b
 >= 0) {

183 
p
 = *
b
;

184 *
b
 = 
os_
[
p
].
Ãxt_
;

185 
os_
[
p
].~
	`ObjeùI‹m
();

186 
os_
[
p
].
Ãxt_
 = -2;

187 ++
Äemoved_
;

191 
	}
}

193 
	gÇme¥aû
 {

194 
	g‹m¶©e
 <
ty³Çme
 
	gT
> 
boŞ
 
¡ršg_to_št_key
(cÚ¡ *
fœ¡
,

195 cÚ¡ *
Ï¡
, 
T
 &
x
)

197 ià(
	gfœ¡
 =ğ
Ï¡
 || !
isdig™
((è*
fœ¡
)

198 || (
fœ¡
[0] =ğ'0' && fœ¡ + 1 !ğ
Ï¡
))

199  
çl£
;

200 
	gx
 = *
fœ¡
 - '0';

201 ++
	gfœ¡
; fœ¡ !ğ
Ï¡
 && 
isdig™
((è*
fœ¡
); ++first)

202 
	gx
 = 10 * 
x
 + *
fœ¡
 - '0';

203  
	gfœ¡
 =ğ
Ï¡
;

207 
	gJsÚ
::
	$h¬d_uniqueify
(
ty³
)

209 ià(
ty³
 < 0) {

210 
	`as£¹
(
_ty³
 =ğ
j_nuÎ
 || _ty³ =ğ-
ty³
);

211 
ty³
 = -type;

214 
Com¶exJsÚ
 *
Şd_cjsÚ
 = 
_cjsÚ
;

215 ià(
Şd_cjsÚ
 && 
ty³
 =ğ
_ty³
 &&y³ =ğ
j_objeù
)

216 
_cjsÚ
 = 
Ãw
 
	`ObjeùJsÚ
(*
¡©ic_ÿ¡
<
ObjeùJsÚ
 *>(
Şd_cjsÚ
));

217 ià(
Şd_cjsÚ
 && 
ty³
 =ğ
_ty³
 &&y³ =ğ
j_¬¿y
)

218 
_cjsÚ
 = 
Ãw
 
	`A¼ayJsÚ
(*
¡©ic_ÿ¡
<
A¼ayJsÚ
 *>(
Şd_cjsÚ
));

219 ià(
ty³
 =ğ
j_objeù
) {

220 
_cjsÚ
 = 
Ãw
 
ObjeùJsÚ
;

221 ià(
Şd_cjsÚ
) {

222 
A¼ayJsÚ
 *
Şd_ajsÚ
 = 
¡©ic_ÿ¡
<A¼ayJsÚ *>(
Şd_cjsÚ
);

223 
ObjeùJsÚ
 *
ojsÚ
 = 
¡©ic_ÿ¡
<ObjeùJsÚ *>(
_cjsÚ
);

224 
JsÚVeùÜ
::
size_ty³
 
i
 = 0;

225 
i
 !ğ
Şd_ajsÚ
->
v®ues
.
	`size
();

226 ++
i
)

227 
ojsÚ
->
	`fšd_š£¹
(
	`SŒšg
(
i
), 
Şd_ajsÚ
->
v®ues
[i]);

230 
_cjsÚ
 = 
Ãw
 
A¼ayJsÚ
;

231 ià(
Şd_cjsÚ
) {

232 
ObjeùJsÚ
 *
Şd_ojsÚ
 = 
¡©ic_ÿ¡
<ObjeùJsÚ *>(
Şd_cjsÚ
);

233 
A¼ayJsÚ
 *
ajsÚ
 = 
¡©ic_ÿ¡
<A¼ayJsÚ *>(
_cjsÚ
);

234 
ObjeùI‹m
 *
ob
 = 
Şd_ojsÚ
->
os_
, *
Û
 = ob + old_ojsÚ->
n_
;

235 
JsÚVeùÜ
::
size_ty³
 
i
;

236 ; 
ob
 !ğ
Û
; ++ob)

237 ià(
ob
->
Ãxt_
 > -2

238 && 
	`¡ršg_to_št_key
(
ob
->
v_
.
fœ¡
.
	`begš
(),

239 
ob
->
v_
.
fœ¡
.
	`’d
(), 
i
)) {

240 ià(
i
 < 
ajsÚ
->
v®ues
.
	`size
())

241 
ajsÚ
->
v®ues
.
	`»size
(
i
 + 1);

242 
ajsÚ
->
v®ues
[
i
] = 
ob
->
v_
.
£cÚd
;

247 ià(
Şd_cjsÚ
)

248 
Şd_cjsÚ
->
	`d”ef
(
_ty³
);

249 
_ty³
 = (
jsÚ_ty³
è
ty³
;

250 
	}
}

255 
	gJsÚ
::
	$h¬d_to_i
() const

257 
_ty³
) {

258 
j_nuÎ
:

260 
j_¬¿y
:

261 
j_objeù
:

262  
	`size
();

263 
j_boŞ
:

264  
_¡r
[0] == 't';

265 
j_št
:

266 
j_doubË
:

267 
j_¡ršg
:

269 cÚ¡ *
b
 = 
_¡r
.
	`c_¡r
();

270 *
s
;

271 
x
 = 
	`¡¹Ş
(
b
, &
s
, 0);

272 #ià
HAVE_FLOAT_TYPES


273 ià(
s
 =ğ
b
 + 
_¡r
.
	`Ëngth
())

274  
x
;

276  (è
	`¡¹od
(
b
, 0);

278  
x
;

281 
	}
}

283 
	gJsÚ
::
	$h¬d_as_i
() const

285 cÚ¡ *
b
 = 
_¡r
.
	`c_¡r
();

286 *
s
;

287 
x
 = 
	`¡¹Ş
(
b
, &
s
, 0);

288 
	`as£¹
(
s
 =ğ
b
 + 
_¡r
.
	`Ëngth
());

289  
x
;

290 
	}
}

292 
ušt64_t
 
	gJsÚ
::
	$h¬d_to_u64
() const

294 
_ty³
) {

295 
j_nuÎ
:

297 
j_¬¿y
:

298 
j_objeù
:

299  
	`size
();

300 
j_boŞ
:

301  
_¡r
[0] == 't';

302 
j_št
:

303 
j_doubË
:

304 
j_¡ršg
:

306 #ià
SIZEOF_LONG
 >ğ8 || !
HAVE_LONG_LONG


307 
x
;

309 
x
;

311 #ià
HAVE_FLOAT_TYPES


312 ià(
	`ı_š‹g”
(
_¡r
.
	`begš
(), _¡r.
	`’d
(), 10, &
x
) == _str.end())

313  
x
;

315  (
ušt64_t
è
	`¡¹od
(
_¡r
.
	`c_¡r
(), 0);

317 
	`ı_š‹g”
(
_¡r
.
	`begš
(), _¡r.
	`’d
(), 10, &
x
);

318  
x
;

321 
	}
}

329 
boŞ
 
	gJsÚ
::
	$to_i
(&
x
) const

331  (
_ty³
 =ğ
j_št
 || _ty³ =ğ
j_doubË
)

332 && 
	`ı_š‹g”
(
_¡r
.
	`begš
(), _¡r.
	`’d
(), 10, &
x
) == _str.end();

333 
	}
}

336 
boŞ
 
	gJsÚ
::
	$to_i
(&
x
) const

338  (
_ty³
 =ğ
j_št
 || _ty³ =ğ
j_doubË
)

339 && 
	`ı_š‹g”
(
_¡r
.
	`begš
(), _¡r.
	`’d
(), 10, &
x
) == _str.end();

340 
	}
}

343 
boŞ
 
	gJsÚ
::
	$to_i
(&
x
) const

345  (
_ty³
 =ğ
j_št
 || _ty³ =ğ
j_doubË
)

346 && 
	`ı_š‹g”
(
_¡r
.
	`begš
(), _¡r.
	`’d
(), 10, &
x
) == _str.end();

347 
	}
}

350 
boŞ
 
	gJsÚ
::
	$to_i
(&
x
) const

352  (
_ty³
 =ğ
j_št
 || _ty³ =ğ
j_doubË
)

353 && 
	`ı_š‹g”
(
_¡r
.
	`begš
(), _¡r.
	`’d
(), 10, &
x
) == _str.end();

354 
	}
}

356 #ià
HAVE_LONG_LONG


358 
boŞ
 
	gJsÚ
::
	$to_i
(&
x
) const

360  (
_ty³
 =ğ
j_št
 || _ty³ =ğ
j_doubË
)

361 && 
	`ı_š‹g”
(
_¡r
.
	`begš
(), _¡r.
	`’d
(), 10, &
x
) == _str.end();

362 
	}
}

365 
boŞ
 
	gJsÚ
::
	$to_i
(&
x
) const

367  (
_ty³
 =ğ
j_št
 || _ty³ =ğ
j_doubË
)

368 && 
	`ı_š‹g”
(
_¡r
.
	`begš
(), _¡r.
	`’d
(), 10, &
x
) == _str.end();

369 
	}
}

372 #ià
HAVE_FLOAT_TYPES


380 
	gJsÚ
::
	$to_d
() const

382 
_ty³
) {

383 
j_nuÎ
:

385 
j_¬¿y
:

386 
j_objeù
:

387  
	`size
();

388 
j_boŞ
:

389  
_¡r
[0] == 't';

390 
j_št
:

391 
j_doubË
:

392 
j_¡ršg
:

394  
	`¡¹od
(
_¡r
.
	`c_¡r
(), 0);

396 
	}
}

399 
boŞ
 
	gJsÚ
::
	$h¬d_to_b
() const

401 
_ty³
) {

402 
j_nuÎ
:

403  
çl£
;

404 
j_¬¿y
:

405 
j_objeù
:

406  !
	`em±y
();

407 
j_boŞ
:

408  
_¡r
[0] == 't';

409 
j_št
:

410  
	`to_i
() != 0;

411 
j_doubË
:

412 #ià
HAVE_FLOAT_TYPES


413  
	`to_d
() != 0;

415  !
_¡r
.
	`equ®s
("0");

417 
j_¡ršg
:

419  !
_¡r
.
	`em±y
();

421 
	}
}

423 cÚ¡ 
	gSŒšg
 &
	gJsÚ
::
	$h¬d_to_s
() const

425 
_ty³
) {

426 
j_nuÎ
:

427  
SŒšg
::
	`make_em±y
();

428 
j_¬¿y
:

429  
»š‹½»t_ÿ¡
<
JsÚStics
 *>(
¡©ics
)->
¬¿y_¡ršg
;

430 
j_objeù
:

431  
»š‹½»t_ÿ¡
<
JsÚStics
 *>(
¡©ics
)->
objeù_¡ršg
;

432 
j_boŞ
:

433 
j_št
:

434 
j_doubË
:

435 
j_¡ršg
:

437  
_¡r
;

439 
	}
}

441 cÚ¡ 
	gJsÚ
 &JsÚ::
	$h¬d_g‘
(cÚ¡ 
SŒšgRef
 &
key
) const

443 
A¼ayJsÚ
 *
aj
;

444 
JsÚVeùÜ
::
size_ty³
 
i
;

445 ià(
_ty³
 =ğ
j_¬¿y
 && (
aj
 = 
	`ajsÚ
())

446 && 
	`¡ršg_to_št_key
(
key
.
	`begš
(), key.
	`’d
(), 
i
)

447 && 
i
 < 
aj
->
v®ues
.
	`size
())

448  
aj
->
v®ues
[
i
];

450  
	`make_nuÎ
();

451 
	}
}

453 cÚ¡ 
	gJsÚ
 &JsÚ::
	$h¬d_g‘
(
size_ty³
 
x
) const

455 ià(
_ty³
 =ğ
j_objeù
 && 
_cjsÚ
)

456  
	`g‘
(
	`SŒšg
(
x
));

458  
	`make_nuÎ
();

459 
	}
}

461 
	gJsÚ
 &JsÚ::
	$h¬d_g‘_š£¹
(
size_ty³
 
x
)

463 ià(
_ty³
 =ğ
j_objeù
)

464  
	`g‘_š£¹
(
	`SŒšg
(
x
));

466 
	`uniqueify_¬¿y
(
Œue
);

467 
A¼ayJsÚ
 *
aj
 = 
	`ajsÚ
();

468 ià(
JsÚVeùÜ
::
	`size_ty³
(
x
è>ğ
aj
->
v®ues
.
	`size
())

469 
aj
->
v®ues
.
	`»size
(
x
 + 1);

470  
aj
->
v®ues
[
x
];

472 
	}
}

477 
boŞ
 
	gJsÚ
::
	$uÅ¬£_is_com¶ex
() const

479 ià(
_ty³
 =ğ
j_objeù
) {

480 ià(
ObjeùJsÚ
 *
oj
 = 
	`ojsÚ
()) {

481 ià(
oj
->
n_
 - oj->
Äemoved_
 > 5)

482  
Œue
;

483 
ObjeùI‹m
 *
ob
 = 
oj
->
os_
, *
Û
 = ob + oj->
n_
;

484 ; 
ob
 !ğ
Û
; ++ob)

485 ià(
ob
->
Ãxt_
 > -2 && !ob->
v_
.
£cÚd
.
	`em±y
(è&& !ob->v_.£cÚd.
	`is_´im™ive
())

486  
Œue
;

488 } ià(
_ty³
 =ğ
j_¬¿y
) {

489 ià(
A¼ayJsÚ
 *
aj
 = 
	`ajsÚ
()) {

490 ià(
aj
->
v®ues
.
	`size
() > 8)

491  
Œue
;

492 
JsÚVeùÜ
::
cÚ¡_™”©Ü
 
™
 = 
aj
->
v®ues
.
	`begš
();

493 
™
 !ğ
aj
->
v®ues
.
	`’d
(); ++it)

494 ià(!
™
->
	`em±y
(è&& !™->
	`is_´im™ive
())

495  
Œue
;

498  
çl£
;

499 
	}
}

501 
	gJsÚ
::
	$uÅ¬£_šd’t
(
SŒšgAccum
 &
§
, cÚ¡ 
uÅ¬£_mªuÏtÜ
 &
m
, 
d•th
)

503 
d•th
 *ğ
m
.
	`b_width
();

504 
§
.
	`­³nd_fl
('\t', 
d•th
 / 8);

505 
§
.
	`­³nd_fl
(' ', 
d•th
 % 8);

506 
	}
}

508 
	gJsÚ
::
	$h¬d_uÅ¬£
(
SŒšgAccum
 &
§
, cÚ¡ 
uÅ¬£_mªuÏtÜ
 &
m
, 
d•th
) const

510 ià(
d•th
 >ğ
m
.
	`šd’t_d•th
(è|| m.
	`b_width
() == 0

511 || !
	`uÅ¬£_is_com¶ex
()) {

512 
	`uÅ¬£
(
§
);

516 
	`as£¹
(
_ty³
 =ğ
j_objeù
 || _ty³ =ğ
j_¬¿y
);

517 ià(
_ty³
 =ğ
j_objeù
) {

518 cÚ¡ *
q
 = "{\n";

519 
ObjeùJsÚ
 *
oj
 = 
	`ojsÚ
();

520 
ObjeùI‹m
 *
ob
 = 
oj
->
os_
, *
Û
 = ob + oj->
n_
;

521 ; 
ob
 !ğ
Û
; ++ob)

522 ià(
ob
->
Ãxt_
 > -2) {

523 
§
.
	`­³nd
(
q
, 2);

524 
	`uÅ¬£_šd’t
(
§
, 
m
, 
d•th
 + 1);

525 
§
 << '\"' << 
ob
->
v_
.
fœ¡
.
	`’code_jsÚ
() << '\"' << ':';

526 
ob
->
v_
.
£cÚd
.
	`h¬d_uÅ¬£
(
§
, 
m
, 
d•th
 + 1);

527 
q
 = ",\n";

529 
§
 << '\n';

530 
	`uÅ¬£_šd’t
(
§
, 
m
, 
d•th
);

531 
§
 << '}';

532 } ià(
_ty³
 =ğ
j_¬¿y
) {

533 cÚ¡ *
q
 = "[\n";

534 
A¼ayJsÚ
 *
aj
 = 
	`ajsÚ
();

535 
JsÚVeùÜ
::
cÚ¡_™”©Ü
 
™
 = 
aj
->
v®ues
.
	`begš
();

536 
™
 !ğ
aj
->
v®ues
.
	`’d
(); ++it) {

537 
§
.
	`­³nd
(
q
, 2);

538 
	`uÅ¬£_šd’t
(
§
, 
m
, 
d•th
 + 1);

539 
™
->
	`h¬d_uÅ¬£
(
§
, 
m
, 
d•th
 + 1);

540 
q
 = ",\n";

542 
§
 << '\n';

543 
	`uÅ¬£_šd’t
(
§
, 
m
, 
d•th
);

544 
§
 << ']';

546 
	}
}

549 
	gJsÚ
::
	$uÅ¬£
(
SŒšgAccum
 &
§
) const

551 ià(
_ty³
 =ğ
j_objeù
) {

552 
q
 = '{';

553 ià(
ObjeùJsÚ
 *
oj
 = 
	`ojsÚ
()) {

556 
ObjeùI‹m
 *
ob
 = 
oj
->
os_
, *
Û
 = ob + oj->
n_
;

557 ; 
ob
 !ğ
Û
; ++ob)

558 ià(
ob
->
Ãxt_
 > -2) {

559 
§
 << 
q
 << '\"' << 
ob
->
v_
.
fœ¡
.
	`’code_jsÚ
() << '\"'

560 << ':' << 
ob
->
v_
.
£cÚd
;

561 
q
 = ',';

564 ià(
q
 == '{')

565 
§
 << 
q
;

566 
§
 << '}';

567 } ià(
_ty³
 =ğ
j_¬¿y
) {

568 
q
 = '[';

569 ià(
A¼ayJsÚ
 *
aj
 = 
	`ajsÚ
())

570 
JsÚVeùÜ
::
cÚ¡_™”©Ü
 
™
 = 
aj
->
v®ues
.
	`begš
();

571 
™
 !ğ
aj
->
v®ues
.
	`’d
(); ++it) {

572 
§
 << 
q
 << *
™
;

573 
q
 = ',';

575 ià(
q
 == '[')

576 
§
 << 
q
;

577 
§
 << ']';

578 } ià(
_ty³
 =ğ
j_¡ršg
)

579 
§
 << '\"' << 
_¡r
.
	`’code_jsÚ
() << '\"';

580 ià(
_ty³
 =ğ
j_nuÎ
)

581 
§
.
	`­³nd
("null", 4);

583 
	`as£¹
(
_¡r
);

584 
§
 << 
_¡r
;

586 
	}
}

589 
šlše
 const *

590 
	gJsÚ
::
	$sk_¥aû
(cÚ¡ *
s
, cÚ¡ *
’d
)

592 
s
 !ğ
’d
 && () *s <= 32

593 && (*
s
 == ' ' || *s == '\n' || *s == '\r' || *s == '\t'))

594 ++
s
;

595  
s
;

596 
	}
}

598 
boŞ


599 
	gJsÚ
::
	$assign_·r£
(cÚ¡ 
SŒšg
 &
¡r
, cÚ¡ *
s
, cÚ¡ *
’d
)

601 
¡©e
 = 
¡_š™Ÿl
;

602 
JsÚ
 
»suÉ
;

603 
SŒšg
 
key
;

604 
VeùÜ
<
JsÚ
 *> 
¡ack
;

607 
Ãxt_tok’
:

608 
s
 = 
	`sk_¥aû
(s, 
’d
);

609 ià(
s
 =ğ
’d
)

610  
çl£
;

612 *
s
) {

615 ià(
¡©e
 =ğ
¡_objeù_d–im
) {

616 
¡©e
 = 
¡_objeù_key
;

617 ++
s
;

618 
Ãxt_tok’
;

619 } ià(
¡©e
 =ğ
¡_¬¿y_d–im
) {

620 
¡©e
 = 
¡_¬¿y_v®ue
;

621 ++
s
;

622 
Ãxt_tok’
;

624  
çl£
;

627 ià(
¡©e
 =ğ
¡_objeù_cŞÚ
) {

628 
¡©e
 = 
¡_objeù_v®ue
;

629 ++
s
;

630 
Ãxt_tok’
;

632  
çl£
;

635 ià(
¡©e
 =ğ
¡_objeù_š™Ÿl
 || s‹ =ğ
¡_objeù_d–im
) {

636 
·r£_com¶ex_v®ue
:

637 ++
s
;

638 
¡ack
.
	`pİ_back
();

639 
·r£_v®ue
:

640 ià(
¡ack
.
	`size
() == 0)

641 
dÚe
;

642 
¡©e
 = (
¡ack
.
	`back
()->
	`is_objeù
(è? 
¡_objeù_d–im
 : 
¡_¬¿y_d–im
);

643 
Ãxt_tok’
;

645  
çl£
;

648 ià(
¡©e
 =ğ
¡_¬¿y_š™Ÿl
 || s‹ =ğ
¡_¬¿y_d–im
)

649 
·r£_com¶ex_v®ue
;

651  
çl£
;

654 ià(
¡©e
 =ğ
¡_objeù_š™Ÿl
 || s‹ =ğ
¡_objeù_key
) {

655 ià((
s
 = 
	`·r£_¡ršg
(
key
, 
¡r
, s + 1, 
’d
))) {

656 
¡©e
 = 
¡_objeù_cŞÚ
;

657 
Ãxt_tok’
;

659  
çl£
;

665 
JsÚ
 *
this_v®ue
;

666 ià(
¡©e
 =ğ
¡_š™Ÿl
)

667 
this_v®ue
 = &
»suÉ
;

668 ià(
¡©e
 =ğ
¡_objeù_v®ue
)

669 
this_v®ue
 = &
¡ack
.
	`back
()->
	`g‘_š£¹
(
key
);

670 ià(
¡©e
 =ğ
¡_¬¿y_š™Ÿl
 || s‹ =ğ
¡_¬¿y_v®ue
) {

671 
¡ack
.
	`back
()->
	`push_back
(
	`JsÚ
());

672 
this_v®ue
 = &
¡ack
.
	`back
()->back();

674  
çl£
;

676 *
s
) {

679 ià(
¡ack
.
	`size
(è< 
max_d•th
) {

680 *
this_v®ue
 = 
JsÚ
::
	`make_objeù
();

681 
¡©e
 = 
¡_objeù_š™Ÿl
;

682 
¡ack
.
	`push_back
(
this_v®ue
);

683 ++
s
;

684 
Ãxt_tok’
;

686  
çl£
;

689 ià(
¡ack
.
	`size
(è< 
max_d•th
) {

690 *
this_v®ue
 = 
JsÚ
::
	`make_¬¿y
();

691 
¡©e
 = 
¡_¬¿y_š™Ÿl
;

692 
¡ack
.
	`push_back
(
this_v®ue
);

693 ++
s
;

694 
Ãxt_tok’
;

696  
çl£
;

699 ià((
s
 = 
	`·r£_¡ršg
(
key
, 
¡r
, s + 1, 
’d
))) {

700 *
this_v®ue
 = 
JsÚ
::
	`make_¡ršg
(
key
);

701 
·r£_v®ue
;

703  
çl£
;

706 ià((
s
 = 
this_v®ue
->
	`·r£_´im™ive
(
¡r
, s, 
’d
)))

707 
·r£_v®ue
;

709  
çl£
;

714 
dÚe
:

715 ià(
	`sk_¥aû
(
s
, 
’d
) ==ƒnd) {

716 
	`sw­
(
»suÉ
);

717  
Œue
;

719  
çl£
;

720 
	}
}

723 
	gJsÚ
::
	$·r£_¡ršg
(
SŒšg
 &
»suÉ
, cÚ¡ SŒšg &
¡r
, cÚ¡ *
s
, cÚ¡ *
’d
)

725 ià(
s
 =ğ
’d
)

727 
SŒšgAccum
 
§
;

728 cÚ¡ *
Ï¡
 = 
s
;

729 ; 
s
 !ğ
’d
; ++s) {

730 ià(*
s
 == '\\') {

731 ià(
s
 + 1 =ğ
’d
)

733 
§
.
	`­³nd
(
Ï¡
, 
s
);

734 ià(
s
[1] == '\"' || s[1] == '\\' || s[1] == '/')

735 ++
s
, 
Ï¡
 = s;

736 ià(
s
[1] == 'b') {

737 
§
.
	`­³nd
('\b');

738 ++
s
, 
Ï¡
 = s + 1;

739 } ià(
s
[1] == 'f') {

740 
§
.
	`­³nd
('\f');

741 ++
s
, 
Ï¡
 = s + 1;

742 } ià(
s
[1] == 'n') {

743 
§
.
	`­³nd
('\n');

744 ++
s
, 
Ï¡
 = s + 1;

745 } ià(
s
[1] == 'r') {

746 
§
.
	`­³nd
('\r');

747 ++
s
, 
Ï¡
 = s + 1;

748 } ià(
s
[1] == 't') {

749 
§
.
	`­³nd
('\t');

750 ++
s
, 
Ï¡
 = s + 1;

751 } ià(
s
[1] =ğ'u' && s + 5 < 
’d
) {

752 
ch
 = 0;

753 
i
 = 2; i < 6; ++i) {

754 
c
 = 
s
[
i
];

755 ià(
c
 >= '0' && c <= '9')

756 
ch
 = 16 * ch + 
c
 - '0';

757 ià(
c
 >= 'A' && c <= 'F')

758 
ch
 = 16 * ch + 
c
 - 'A' + 10;

759 ià(
c
 >= 'a' && c <= 'f')

760 
ch
 = 16 * ch + 
c
 - 'a' + 10;

765 ià(
	`uÆik–y
(
ch
 >= 0xD800 && ch <= 0xDFFF)) {

766 ià(
ch
 >ğ0xDC00 || 
s
 + 11 >ğ
’d
 || s[6] != '\\' || s[7] != 'u')

768 
ch2
 = 0;

769 
i
 = 8; i < 12; ++i) {

770 
c
 = 
s
[
i
];

771 ià(
c
 >= '0' && c <= '9')

772 
ch2
 = 16 * ch2 + 
c
 - '0';

773 ià(
c
 >= 'A' && c <= 'F')

774 
ch2
 = 16 * ch2 + 
c
 - 'A' + 10;

775 ià(
c
 >= 'a' && c <= 'f')

776 
ch2
 = 16 * ch2 + 
c
 - 'a' + 10;

780 ià(
ch2
 < 0xDC00 || ch2 > 0xDFFF)

782 ià(!
§
.
	`­³nd_utf8
(0x10000 + (
ch
 - 0xD800è* 0x400 + (
ch2
 - 0xDC00)))

784 
s
 +ğ11, 
Ï¡
 = s + 1;

786 ià(!
§
.
	`­³nd_utf8
(
ch
))

788 
s
 +ğ5, 
Ï¡
 = s + 1;

792 } ià(*
s
 == '\"')

794 ià(
	`lik–y
((è*
s
 >= 32 && () *s < 128))

796 ià((è*
s
 < 32)

799 cÚ¡ *
t
 = 
SŒšg
::
	`sk_utf8_ch¬
(
s
, 
’d
);

800 ià(
t
 =ğ
s
)

802 
s
 = 
t
 - 1;

805 ià(
s
 =ğ
’d
)

807 ià(!
§
.
	`em±y
()) {

808 
§
.
	`­³nd
(
Ï¡
, 
s
);

809 
»suÉ
 = 
§
.
	`ke_¡ršg
();

810 } ià(
Ï¡
 =ğ
s
)

811 
»suÉ
 = 
	`SŒšg
();

812 ià(
Ï¡
 >ğ
¡r
.
	`begš
(è&& 
s
 <ğ¡r.
	`’d
())

813 
»suÉ
 = 
¡r
.
	`sub¡ršg
(
Ï¡
, 
s
);

815 
»suÉ
 = 
	`SŒšg
(
Ï¡
, 
s
);

816  
s
 + 1;

817 
	}
}

820 
	gJsÚ
::
	$·r£_´im™ive
(cÚ¡ 
SŒšg
 &
¡r
, cÚ¡ *
begš
, cÚ¡ *
’d
)

822 ià(
_cjsÚ
)

823 
_cjsÚ
->
	`d”ef
(
_ty³
);

824 
_cjsÚ
 = 0;

826 cÚ¡ *
s
 = 
begš
;

827 *
s
) {

829 ià(
s
 + 1 =ğ
’d
 || s[1] < '0' || s[1] > '9')

831 ++
s
;

843 
jsÚ_ty³
 
ty³
 = 
j_št
;

844 ià(*
s
 == '0')

845 ++
s
;

847 ++
s
; s !ğ
’d
 && 
	`isdig™
(() *s); )

848 ++
s
;

849 ià(
s
 !ğ
’d
 && *s == '.') {

850 
ty³
 = 
j_doubË
;

851 ià(
s
 + 1 =ğ
’d
 || s[1] < '0' || s[1] > '9')

853 
s
 +ğ2; s !ğ
’d
 && 
	`isdig™
(() *s); )

854 ++
s
;

856 ià(
s
 !ğ
’d
 && (*s == 'e' || *s == 'E')) {

857 
ty³
 = 
j_doubË
;

858 ++
s
;

859 ià(
s
 !ğ
’d
 && (*s == '+' || *s == '-'))

860 ++
s
;

861 ià(
s
 =ğ
’d
 || s[1] < '0' || s[1] > '9')

863 ++
s
; s !ğ
’d
 && 
	`isdig™
(() *s); )

864 ++
s
;

866 ià(
begš
 >ğ
¡r
.
	`begš
(è&& 
s
 <ğ¡r.
	`’d
())

867 
_¡r
 = 
¡r
.
	`sub¡ršg
(
begš
, 
s
);

869 
_¡r
 = 
	`SŒšg
(
begš
, 
s
);

870 
_ty³
 = 
ty³
;

871  
s
;

874 ià(
s
 + 4 <ğ
’d
 && s[1] == 'r' && s[2] == 'u' && s[3] == 'e') {

875 
_¡r
 = 
	`SŒšg
(
Œue
);

876 
_ty³
 = 
j_boŞ
;

877  
s
 + 4;

881 ià(
s
 + 5 <ğ
’d
 && s[1] == 'a' && s[2] == 'l' && s[3] == 's' && s[4] == 'e') {

882 
_¡r
 = 
	`SŒšg
(
çl£
);

883 
_ty³
 = 
j_boŞ
;

884  
s
 + 5;

888 ià(
s
 + 4 <ğ
’d
 && s[1] == 'u' && s[2] == 'l' && s[3] == 'l') {

889 
_¡r
 = 
	`SŒšg
();

890 
_ty³
 = 
j_nuÎ
;

891  
s
 + 4;

897 
	}
}

899 
CLICK_ENDDECLS


900 
ELEMENT_PROVIDES
(
JsÚ
)

	@json/json.hh

2 #iâdeà
CLICK_JSON_HH


3 
	#CLICK_JSON_HH
 1

	)

4 
	~<şick/¡¿ccum.hh
>

5 
	~<şick/hashbË.hh
>

6 
	~<şick/veùÜ.hh
>

7 
	~<şick/glue.hh
>

8 
	~<şick/·œ.hh
>

9 #ià
CLICK_USERLEVEL


10 
	~<™”©Ü
>

12 
CLICK_DECLS


14 
	g‹m¶©e
 <
ty³Çme
 
	gP
> 
şass
 
	gJsÚ_´oxy_ba£
;

15 
	g‹m¶©e
 <
ty³Çme
 
	gT
> 
şass
 
	gJsÚ_objeù_´oxy
;

16 
	g‹m¶©e
 <
ty³Çme
 
	gT
> 
şass
 
	gJsÚ_objeù_¡r_´oxy
;

17 
	g‹m¶©e
 <
ty³Çme
 
	gT
> 
şass
 
	gJsÚ_¬¿y_´oxy
;

18 
şass
 
	gJsÚ_g‘_´oxy
;

20 şas 
	cJsÚ
 { 
	mpublic
:

22 
	ejsÚ_ty³
 {

23 
j_nuÎ
 = 0, 
	mj_¬¿y
, 
	mj_objeù
, 
	mj_št
, 
	mj_doubË
, 
	mj_boŞ
, 
	mj_¡ršg


26 
	tsize_ty³
;

28 
	gPaœ
<cÚ¡ 
	tSŒšg
, 
	tJsÚ
> 
	tobjeù_v®ue_ty³
;

29 
şass
 
	gobjeù_™”©Ü
;

30 
şass
 
	gcÚ¡_objeù_™”©Ü
;

32 
JsÚ
 
	t¬¿y_v®ue_ty³
;

33 
şass
 
	g¬¿y_™”©Ü
;

34 
şass
 
	gcÚ¡_¬¿y_™”©Ü
;

36 
şass
 
	g™”©Ü
;

37 
şass
 
	gcÚ¡_™”©Ü
;

39 
	$boŞ
 (
	tJsÚ
::*
	tun¥ecif›d_boŞ_ty³
)() const;

40 
uÅ¬£_mªuÏtÜ
;

43 
šlše
 
	`JsÚ
();

44 
šlše
 
	`JsÚ
(cÚ¡ 
JsÚ
 &
x
);

45 #ià
HAVE_CXX_RVALUE_REFERENCES


46 
šlše
 
	`JsÚ
(
JsÚ
 &&
x
);

48 
šlše
 
	`JsÚ
(
x
);

49 
šlše
 
	`JsÚ
(
x
);

50 
šlše
 
	`JsÚ
(
x
);

51 
šlše
 
	`JsÚ
(
x
);

52 #ià
HAVE_LONG_LONG


53 
šlše
 
	`JsÚ
(
x
);

54 
šlše
 
	`JsÚ
(
x
);

56 #ià
HAVE_FLOAT_TYPES


57 
šlše
 
	`JsÚ
(
x
);

59 
šlše
 
	`JsÚ
(
boŞ
 
x
);

60 
šlše
 
	`JsÚ
(cÚ¡ 
SŒšg
 &
x
);

61 
šlše
 
	`JsÚ
(cÚ¡ *
x
);

62 
‹m¶©e
 <
ty³Çme
 
T
> 
šlše
 
	`JsÚ
(cÚ¡ 
VeùÜ
<T> &
x
);

63 
‹m¶©e
 <
ty³Çme
 
T
> 
šlše
 
	`JsÚ
(T 
fœ¡
, T 
Ï¡
);

64 
‹m¶©e
 <
ty³Çme
 
T
> 
šlše
 
	`JsÚ
(cÚ¡ 
HashTabË
<
SŒšg
, T> &
x
);

65 
šlše
 ~
	`JsÚ
();

67 
šlše
 cÚ¡ 
JsÚ
 &
	`make_nuÎ
();

68 
šlše
 
JsÚ
 
	`make_¬¿y
();

69 
šlše
 
JsÚ
 
	`make_objeù
();

70 
šlše
 
JsÚ
 
	`make_¡ršg
(cÚ¡ 
SŒšg
 &
x
);

71 
šlše
 
JsÚ
 
	`make_¡ršg
(cÚ¡ *
s
, 
Ën
);

73 
	`¡©ic_š™Ÿlize
();

76 
šlše
 
İ”©Ü
 
	$un¥ecif›d_boŞ_ty³
() const;

77 
šlše
 
boŞ
 
İ”©Ü
!() const;

79 
šlše
 
jsÚ_ty³
 
	$ty³
() const;

80 
šlše
 
boŞ
 
	$is_nuÎ
() const;

81 
šlše
 
boŞ
 
	$is_št
() const;

82 
šlše
 
boŞ
 
	$is_doubË
() const;

83 
šlše
 
boŞ
 
	$is_numb”
() const;

84 
šlše
 
boŞ
 
	$is_boŞ
() const;

85 
šlše
 
boŞ
 
	$is_¡ršg
() const;

86 
šlše
 
boŞ
 
	$is_¬¿y
() const;

87 
šlše
 
boŞ
 
	$is_objeù
() const;

88 
šlše
 
boŞ
 
	$is_´im™ive
() const;

90 
šlše
 
boŞ
 
	$em±y
() const;

91 
šlše
 
size_ty³
 
	$size
() const;

94 
šlše
 
	$to_i
() const;

95 
šlše
 
ušt64_t
 
	$to_u64
() const;

96 
boŞ
 
	$to_i
(&
x
) const;

97 
boŞ
 
	$to_i
(&
x
) const;

98 
boŞ
 
	$to_i
(&
x
) const;

99 
boŞ
 
	$to_i
(&
x
) const;

100 #ià
HAVE_LONG_LONG


101 
boŞ
 
	$to_i
(&
x
) const;

102 
boŞ
 
	$to_i
(&
x
) const;

104 
šlše
 
	$as_i
() const;

106 #ià
HAVE_FLOAT_TYPES


107 
	$to_d
() const;

108 
šlše
 
boŞ
 
	$to_d
(&
x
) const;

109 
šlše
 
	$as_d
() const;

112 
šlše
 
boŞ
 
	$to_b
() const;

113 
šlše
 
boŞ
 
	$to_b
(
boŞ
 &
x
) const;

114 
šlše
 
boŞ
 
	$as_b
() const;

116 
šlše
 cÚ¡ 
SŒšg
 &
	$to_s
() const;

117 
šlše
 
boŞ
 
	$to_s
(
SŒšg
 &
x
) const;

118 
šlše
 cÚ¡ 
SŒšg
 &
	$as_s
() const;

119 
šlše
 cÚ¡ *
	$c_¡r
() const;

122 
šlše
 
size_ty³
 
	$couÁ
(cÚ¡ 
SŒšgRef
 &
key
) const;

123 
šlše
 cÚ¡ 
JsÚ
 &
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
) const;

124 
šlše
 
JsÚ
 &
	`g‘_š£¹
(cÚ¡ 
SŒšg
 &
key
);

125 
šlše
 
JsÚ
 &
	`g‘_š£¹
(cÚ¡ 
SŒšgRef
 &
key
);

126 
šlše
 
JsÚ
 &
	`g‘_š£¹
(cÚ¡ *
key
);

128 
šlše
 
	$g‘_i
(cÚ¡ 
SŒšgRef
 &
key
) const;

129 #ià
HAVE_FLOAT_TYPES


130 
šlše
 
	$g‘_d
(cÚ¡ 
SŒšgRef
 &
key
) const;

132 
šlše
 
boŞ
 
	$g‘_b
(cÚ¡ 
SŒšgRef
 &
key
) const;

133 
šlše
 cÚ¡ 
SŒšg
 &
	$g‘_s
(cÚ¡ 
SŒšgRef
 &
key
) const;

135 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, 
JsÚ
 &
x
) const;

136 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const;

137 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const;

138 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const;

139 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const;

140 #ià
HAVE_LONG_LONG


141 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const;

142 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const;

144 #ià
HAVE_FLOAT_TYPES


145 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const;

147 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, 
boŞ
 &
x
) const;

148 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, 
SŒšg
 &
x
) const;

150 cÚ¡ 
JsÚ
 &
İ”©Ü
[](cÚ¡ 
SŒšgRef
 &
key
) const;

151 
šlše
 
JsÚ_objeù_´oxy
<
JsÚ
> 
İ”©Ü
[](cÚ¡ 
SŒšg
 &
key
);

152 
šlše
 
JsÚ_objeù_¡r_´oxy
<
JsÚ
> 
İ”©Ü
[](cÚ¡ 
SŒšgRef
 &
key
);

153 
šlše
 
JsÚ_objeù_¡r_´oxy
<
JsÚ
> 
İ”©Ü
[](cÚ¡ *
key
);

155 
šlše
 cÚ¡ 
JsÚ
 &
	$©
(cÚ¡ 
SŒšgRef
 &
key
) const;

156 
šlše
 
JsÚ
 &
	`©_š£¹
(cÚ¡ 
SŒšg
 &
key
);

157 
šlše
 
JsÚ
 &
	`©_š£¹
(cÚ¡ 
SŒšgRef
 &
key
);

158 
šlše
 
JsÚ
 &
	`©_š£¹
(cÚ¡ *
key
);

160 
‹m¶©e
 <
ty³Çme
 
T
> 
šlše
 
JsÚ
 &
	`£t
(cÚ¡ 
SŒšg
 &
key
, T 
v®ue
);

161 #ià
HAVE_CXX_RVALUE_REFERENCES


162 
šlše
 
JsÚ
 &
	`£t
(cÚ¡ 
SŒšg
 &
key
, JsÚ &&
x
);

164 
šlše
 
JsÚ
 &
	`un£t
(cÚ¡ 
SŒšgRef
 &
key
);

166 
šlše
 
Paœ
<
objeù_™”©Ü
, 
boŞ
> 
	`š£¹
(cÚ¡ 
objeù_v®ue_ty³
 &
x
);

167 
šlše
 
objeù_™”©Ü
 
	`š£¹
(objeù_™”©Ü 
pos™iÚ
,

168 cÚ¡ 
objeù_v®ue_ty³
 &
x
);

169 
šlše
 
size_ty³
 
	`”a£
(cÚ¡ 
SŒšgRef
 &
key
);

171 
šlše
 
JsÚ
 &
	`m”ge
(cÚ¡ JsÚ &
x
);

172 
‹m¶©e
 <
ty³Çme
 
P
> 
šlše
 
JsÚ
 &
	`m”ge
(cÚ¡ 
JsÚ_´oxy_ba£
<P> &
x
);

175 
šlše
 cÚ¡ 
JsÚ
 &
	$g‘
(
size_ty³
 
x
) const;

176 
šlše
 
JsÚ
 &
	`g‘_š£¹
(
size_ty³
 
x
);

178 
šlše
 cÚ¡ 
JsÚ
 &
İ”©Ü
[](
size_ty³
 
x
) const;

179 
šlše
 
JsÚ_¬¿y_´oxy
<
JsÚ
> 
İ”©Ü
[](
size_ty³
 
x
);

181 
šlše
 cÚ¡ 
JsÚ
 &
	$©
(
size_ty³
 
x
) const;

182 
šlše
 
JsÚ
 &
	`©_š£¹
(
size_ty³
 
x
);

184 
šlše
 cÚ¡ 
JsÚ
 &
	$back
() const;

185 
šlše
 
JsÚ
 &
	`back
();

187 
‹m¶©e
 <
ty³Çme
 
T
> 
šlše
 
JsÚ
 &
	`push_back
(T 
x
);

188 #ià
HAVE_CXX_RVALUE_REFERENCES


189 
šlše
 
JsÚ
 &
	`push_back
(JsÚ &&
x
);

191 
šlše
 
	`pİ_back
();

194 
šlše
 
cÚ¡_objeù_™”©Ü
 
	$obegš
() const;

195 
šlše
 
cÚ¡_objeù_™”©Ü
 
	$Ûnd
() const;

196 
šlše
 
objeù_™”©Ü
 
	`obegš
();

197 
šlše
 
objeù_™”©Ü
 
	`Ûnd
();

198 
šlše
 
cÚ¡_objeù_™”©Ü
 
	$cobegš
() const;

199 
šlše
 
cÚ¡_objeù_™”©Ü
 
	$cÛnd
() const;

201 
šlše
 
cÚ¡_¬¿y_™”©Ü
 
	$abegš
() const;

202 
šlše
 
cÚ¡_¬¿y_™”©Ü
 
	$«nd
() const;

203 
šlše
 
¬¿y_™”©Ü
 
	`abegš
();

204 
šlše
 
¬¿y_™”©Ü
 
	`«nd
();

205 
šlše
 
cÚ¡_¬¿y_™”©Ü
 
	$ÿbegš
() const;

206 
šlše
 
cÚ¡_¬¿y_™”©Ü
 
	$ÿ’d
() const;

208 
šlše
 
cÚ¡_™”©Ü
 
	$begš
() const;

209 
šlše
 
cÚ¡_™”©Ü
 
	$’d
() const;

210 
šlše
 
™”©Ü
 
	`begš
();

211 
šlše
 
™”©Ü
 
	`’d
();

212 
šlše
 
cÚ¡_™”©Ü
 
	$cbegš
() const;

213 
šlše
 
cÚ¡_™”©Ü
 
	$ûnd
() const;

216 
šlše
 
uÅ¬£_mªuÏtÜ
 
	`šd’t_d•th
(
x
);

217 
šlše
 
uÅ¬£_mªuÏtÜ
 
	`b_width
(
x
);

219 
šlše
 
SŒšg
 
	$uÅ¬£
() const;

220 
šlše
 
SŒšg
 
	$uÅ¬£
(
boŞ
 
add_Ãwlše
) const;

221 
šlše
 
SŒšg
 
	$uÅ¬£
(cÚ¡ 
uÅ¬£_mªuÏtÜ
 &
m
,

222 
boŞ
 
add_Ãwlše
 = 
çl£
) const;

223 
	$uÅ¬£
(
SŒšgAccum
 &
§
) const;

224 
šlše
 
	$uÅ¬£
(
SŒšgAccum
 &
§
, cÚ¡ 
uÅ¬£_mªuÏtÜ
 &
m
) const;

227 
šlše
 
boŞ
 
	`assign_·r£
(cÚ¡ 
SŒšg
 &
¡r
);

228 
šlše
 
boŞ
 
	`assign_·r£
(cÚ¡ *
fœ¡
, cÚ¡ *
Ï¡
);

230 
šlše
 
JsÚ
 
	`·r£
(cÚ¡ 
SŒšg
 &
¡r
);

231 
šlše
 
JsÚ
 
	`·r£
(cÚ¡ *
fœ¡
, cÚ¡ *
Ï¡
);

234 
šlše
 
JsÚ
 &
İ”©Ü
=(cÚ¡ JsÚ &
x
);

235 #ià
HAVE_CXX_RVALUE_REFERENCES


236 
šlše
 
JsÚ
 &
İ”©Ü
=(JsÚ &&
x
);

238 
‹m¶©e
 <
ty³Çme
 
P
> 
šlše
 
JsÚ
 &
İ”©Ü
=(cÚ¡ 
JsÚ_´oxy_ba£
<P> &
x
);

240 
šlše
 
JsÚ
 &
İ”©Ü
++();

241 
šlše
 
İ”©Ü
++();

242 
šlše
 
JsÚ
 &
İ”©Ü
--();

243 
šlše
 
İ”©Ü
--();

244 
šlše
 
JsÚ
 &
İ”©Ü
+=(
x
);

245 
šlše
 
JsÚ
 &
İ”©Ü
+=(
x
);

246 #ià
HAVE_FLOAT_TYPES


247 
šlše
 
JsÚ
 &
İ”©Ü
+=(
x
);

250 
šlše
 
	`sw­
(
JsÚ
 &
x
);

252 
´iv©e
:

255 
¡_š™Ÿl
 = 0, 
¡_¬¿y_š™Ÿl
 = 1, 
¡_¬¿y_d–im
 = 2,

256 
¡_¬¿y_v®ue
 = 3, 
¡_objeù_š™Ÿl
 = 4, 
¡_objeù_d–im
 = 5,

257 
¡_objeù_key
 = 6, 
¡_objeù_cŞÚ
 = 7, 
¡_objeù_v®ue
 = 8,

258 
max_d•th
 = 2048

259 
	}
};

261 
	gVeùÜ
<
	tJsÚ
> 
	tJsÚVeùÜ
;

263 
	sCom¶exJsÚ
 {

264 
	g»fcouÁ
;

265 
Com¶exJsÚ
()

266 : 
»fcouÁ
(1) {

268 
»f
() {

269 ++
»fcouÁ
;

271 
šlše
 
d”ef
(
jsÚ_ty³
 
j
);

272 
	g´iv©e
:

273 
Com¶exJsÚ
(cÚ¡ Com¶exJsÚ &
x
);

276 
	gA¼ayJsÚ
;

277 
	gObjeùI‹m
;

278 
	gObjeùJsÚ
;

280 
jsÚ_ty³
 
	g_ty³
;

281 
SŒšg
 
	g_¡r
;

282 
Com¶exJsÚ
 *
	g_cjsÚ
;

284 
šlše
 
ObjeùJsÚ
 *
	$ojsÚ
() const;

285 
šlše
 
A¼ayJsÚ
 *
	$ajsÚ
() const;

287 
	$h¬d_to_i
() const;

288 
	$h¬d_as_i
() const;

289 
ušt64_t
 
	$h¬d_to_u64
() const;

290 
boŞ
 
	$h¬d_to_b
() const;

291 cÚ¡ 
SŒšg
 &
	$h¬d_to_s
() const;

292 
šlše
 
	`fÜû_numb”
();

294 cÚ¡ 
JsÚ
 &
	$h¬d_g‘
(cÚ¡ 
SŒšgRef
 &
key
) const;

295 cÚ¡ 
JsÚ
 &
	$h¬d_g‘
(
size_ty³
 
x
) const;

296 
JsÚ
 &
	`h¬d_g‘_š£¹
(
size_ty³
 
x
);

298 
	`h¬d_uniqueify
(
ty³
);

299 
šlše
 
	`uniqueify_objeù
(
boŞ
 
cÚv”t
);

300 
šlše
 
	`uniqueify_¬¿y
(
boŞ
 
cÚv”t
);

302 
boŞ
 
	$uÅ¬£_is_com¶ex
() const;

303 
	`uÅ¬£_šd’t
(
SŒšgAccum
 &
§
, cÚ¡ 
uÅ¬£_mªuÏtÜ
 &
m
, 
d•th
);

304 
	$h¬d_uÅ¬£
(
SŒšgAccum
 &
§
, cÚ¡ 
uÅ¬£_mªuÏtÜ
 &
m
, 
d•th
) const;

306 
šlše
 cÚ¡ *
	`sk_¥aû
(cÚ¡ *
s
, cÚ¡ *
’d
);

307 
boŞ
 
	`assign_·r£
(cÚ¡ 
SŒšg
 &
¡r
, cÚ¡ *
begš
, cÚ¡ *
’d
);

308 cÚ¡ *
	`·r£_¡ršg
(
SŒšg
 &
»suÉ
, cÚ¡ SŒšg &
¡r
, cÚ¡ *
s
, cÚ¡ *
’d
);

309 cÚ¡ *
	`·r£_´im™ive
(cÚ¡ 
SŒšg
 &
¡r
, cÚ¡ *
s
, cÚ¡ *
’d
);

311 
ä›nd
 
şass
 
objeù_™”©Ü
;

312 
ä›nd
 
şass
 
cÚ¡_objeù_™”©Ü
;

313 
ä›nd
 
şass
 
¬¿y_™”©Ü
;

314 
ä›nd
 
şass
 
cÚ¡_¬¿y_™”©Ü
;

315 
ä›nd
 
boŞ
 
İ”©Ü
==(cÚ¡ 
JsÚ
 &
a
, cÚ¡ JsÚ &
b
);

317 
JsÚStics
;

318 
¡©ics
[];

320 
	}
};

323 
	gJsÚ
::
A¼ayJsÚ
 : 
public
 
Com¶exJsÚ
 {

324 
JsÚVeùÜ
 
v®ues
;

325 
A¼ayJsÚ
() {

327 
A¼ayJsÚ
(cÚ¡ A¼ayJsÚ &
x
)

328 : 
Com¶exJsÚ
(), 
v®ues
(
x
.values) {

332 
	gJsÚ
::
ObjeùI‹m
 {

333 
Paœ
<cÚ¡ 
SŒšg
, 
	gJsÚ
> 
	gv_
;

334 
	gÃxt_
;

335 
ex¶ic™
 
ObjeùI‹m
(cÚ¡ 
SŒšg
 &
key
, cÚ¡ 
JsÚ
 &
v®ue
, 
Ãxt
)

336 : 
v_
(
key
, 
v®ue
), 
Ãxt_
(
Ãxt
) {

340 
	gJsÚ
::
ObjeùJsÚ
 : 
public
 
Com¶exJsÚ
 {

341 
ObjeùI‹m
 *
os_
;

342 
	gn_
;

343 
	gÿ·c™y_
;

344 
	gVeùÜ
<> 
	ghash_
;

345 
	gÄemoved_
;

346 
ObjeùJsÚ
()

347 : 
os_
(), 
n_
(0), 
ÿ·c™y_
(0), 
Äemoved_
(0) {

349 
ObjeùJsÚ
(cÚ¡ ObjeùJsÚ &
x
);

350 ~
ObjeùJsÚ
(è
	gCLICK_COLD
;

351 
grow
(
boŞ
 
cİy
);

352 
buck‘
(cÚ¡ *
s
, 
Ën
) const {

353  
	gSŒšg
::
hashcode
(
s
, s + 
Ën
è& (
	ghash_
.
size
() - 1);

355 
	gObjeùI‹m
 &
™em
(
i
) const {

356  
	gos_
[
i
];

358 
fšd
(cÚ¡ *
s
, 
Ën
) const {

359 ià(
	ghash_
.
size
()) {

360 
	gi
 = 
hash_
[
buck‘
(
s
, 
Ën
)];

361 
	gi
 >= 0) {

362 
ObjeùI‹m
 &
oi
 = 
™em
(
i
);

363 ià(
	goi
.
	gv_
.
	gfœ¡
.
equ®s
(
s
, 
Ën
))

364  
	gi
;

365 
	gi
 = 
oi
.
Ãxt_
;

370 
fšd_š£¹
(cÚ¡ 
SŒšg
 &
key
, cÚ¡ 
JsÚ
 &
v®ue
);

371 
šlše
 
	gJsÚ
 &
g‘_š£¹
(cÚ¡ 
SŒšg
 &
key
) {

372 
	gi
 = 
fšd_š£¹
(
key
, 
make_nuÎ
());

373  
™em
(
i
).
	gv_
.
	g£cÚd
;

375 
	gJsÚ
 &
g‘_š£¹
(cÚ¡ 
SŒšgRef
 &
key
);

376 
size_ty³
 
”a£
(cÚ¡ 
SŒšgRef
 &
key
);

377 
»hash
();

380 
CLICK_MAY_ALIAS
 
	gJsÚ
::
JsÚStics
 {

381 
JsÚ
 
nuÎ_jsÚ
;

382 
SŒšg
 
	g¬¿y_¡ršg
;

383 
SŒšg
 
	gobjeù_¡ršg
;

384 
šlše
 
JsÚStics
();

387 
šlše
 cÚ¡ 
	gJsÚ
 &JsÚ::
	$make_nuÎ
() {

388  
»š‹½»t_ÿ¡
<
JsÚStics
 *>(
¡©ics
)->
nuÎ_jsÚ
;

389 
	}
}

391 
šlše
 
	gJsÚ
::
Com¶exJsÚ
::
	$d”ef
(
jsÚ_ty³
 
j
) {

392 ià(--
»fcouÁ
 <= 0) {

393 ià(
j
 =ğ
j_objeù
)

394 
d–‘e
 
¡©ic_ÿ¡
<
ObjeùJsÚ
 *>(
this
);

396 
d–‘e
 
¡©ic_ÿ¡
<
A¼ayJsÚ
 *>(
this
);

398 
	}
}

400 
šlše
 
	gJsÚ
::
A¼ayJsÚ
 *
JsÚ
::
	$ajsÚ
() const {

401 
	`as£¹
(
_ty³
 =ğ
j_nuÎ
 || _ty³ =ğ
j_¬¿y
);

402  
¡©ic_ÿ¡
<
A¼ayJsÚ
 *>(
_cjsÚ
);

403 
	}
}

405 
šlše
 
	gJsÚ
::
ObjeùJsÚ
 *
JsÚ
::
	$ojsÚ
() const {

406 
	`as£¹
(
_ty³
 =ğ
j_nuÎ
 || _ty³ =ğ
j_objeù
);

407  
¡©ic_ÿ¡
<
ObjeùJsÚ
 *>(
_cjsÚ
);

408 
	}
}

410 
šlše
 
	gJsÚ
::
	$uniqueify_objeù
(
boŞ
 
cÚv”t
) {

411 ià(
_ty³
 !ğ
j_objeù
 || !
_cjsÚ
 || _cjsÚ->
»fcouÁ
 > 1)

412 
	`h¬d_uniqueify
(
cÚv”t
 ? 
j_objeù
 : -j_object);

413 
	`as£¹
(
_ty³
 =ğ
j_objeù
);

414 
	}
}

416 
šlše
 
	gJsÚ
::
	$uniqueify_¬¿y
(
boŞ
 
cÚv”t
) {

417 ià(
_ty³
 !ğ
j_¬¿y
 || !
_cjsÚ
 || _cjsÚ->
»fcouÁ
 > 1)

418 
	`h¬d_uniqueify
(
cÚv”t
 ? 
j_¬¿y
 : -j_array);

419 
	`as£¹
(
_ty³
 =ğ
j_¬¿y
);

420 
	}
}

423 şas 
	cJsÚ
::
cÚ¡_objeù_™”©Ü
 { 
public
:

424 
Paœ
<cÚ¡ 
	tSŒšg
, 
	tJsÚ
> 
	tv®ue_ty³
;

425 cÚ¡ 
	tv®ue_ty³
 *
	tpoš‹r_ty³
;

426 cÚ¡ 
	tv®ue_ty³
 &
	t»ã»nû_ty³
;

427 #ià
CLICK_USERLEVEL


428 
	m¡d
::
	tfÜw¬d_™”©Ü_g
 
	t™”©Ü_ÿ‹gÜy
;

431 
	$cÚ¡_objeù_™”©Ü
() {

433 
	$boŞ
 (
	tcÚ¡_objeù_™”©Ü
::*
	tun¥ecif›d_boŞ_ty³
)() const;

434 
İ”©Ü
 
	$un¥ecif›d_boŞ_ty³
() const {

435  
	`live
(è? &
cÚ¡_objeù_™”©Ü
::
live
 : 0;

436 
	}
}

437 
boŞ
 
	$live
() const {

438  
i_
 >= 0;

439 
	}
}

440 cÚ¡ 
	gv®ue_ty³
 &
	gİ”©Ü
*() const {

441  
	gj_
->
ojsÚ
()->
™em
(
i_
).
	gv_
;

443 cÚ¡ 
v®ue_ty³
 *
	gİ”©Ü
->() const {

444  &(**
	gthis
);

446 cÚ¡ 
	gSŒšg
 &
	$key
() const {

447  (**
this
).
fœ¡
;

448 
	}
}

449 cÚ¡ 
	gJsÚ
 &
	$v®ue
() const {

450  (**
this
).
£cÚd
;

451 
	}
}

452 
	gİ”©Ü
++() {

453 ++
	gi_
;

454 
fix
();

456 
	gİ”©Ü
++() {

457 ++(*
	gthis
);

459 
	g´iv©e
:

460 cÚ¡ 
JsÚ
 *
j_
;

461 
	gi_
;

462 
	$cÚ¡_objeù_™”©Ü
(cÚ¡ 
JsÚ
 *
j
, 
i
)

463 : 
	`j_
(
j
), 
	$i_
(
i
) {

464 ià(
i_
 >= 0)

465 
	`fix
();

466 
	}
}

467 
	$fix
() {

468 
ObjeùJsÚ
 *
oj
 = 
j_
->
	`ojsÚ
();

469 
»Œy
:

470 ià(!
oj
 || 
i_
 >ğoj->
n_
)

471 
i_
 = -1;

472 ià(
oj
->
	`™em
(
i_
).
Ãxt_
 == -2) {

473 ++
i_
;

474 
»Œy
;

476 
	}
}

477 
ä›nd
 
şass
 
	gJsÚ
;

478 
ä›nd
 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
cÚ¡_objeù_™”©Ü
 &, cÚ¡ 
	gcÚ¡_objeù_™”©Ü
 &);

481 şas 
	cJsÚ
::
objeù_™”©Ü
 : 
public
 
cÚ¡_objeù_™”©Ü
 {…ublic:

482 
v®ue_ty³
 *
	tpoš‹r_ty³
;

483 
	mv®ue_ty³
 &
	t»ã»nû_ty³
;

485 
	$objeù_™”©Ü
() {

487 
v®ue_ty³
 &
İ”©Ü
*() const {

488 
cÚ¡_ÿ¡
<
JsÚ
 *>(
j_
)->
	`uniqueify_objeù
(
çl£
);

489  
j_
->
	`ojsÚ
()->
	`™em
(
i_
).
v_
;

490 
	}
}

491 
v®ue_ty³
 *
	gİ”©Ü
->() const {

492  &(**
	gthis
);

494 
	gJsÚ
 &
	$v®ue
() const {

495  (**
this
).
£cÚd
;

496 
	}
}

497 
	g´iv©e
:

498 
	$objeù_™”©Ü
(
JsÚ
 *
j
, 
i
)

499 : 
	$cÚ¡_objeù_™”©Ü
(
j
, 
i
) {

500 
	}
}

501 
ä›nd
 
şass
 
	gJsÚ
;

504 
šlše
 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
JsÚ
::
cÚ¡_objeù_™”©Ü
 &
a
, cÚ¡ 
	gJsÚ
::cÚ¡_objeù_™”©Ü &
b
) {

505  
a
.
j_
 =ğ
b
.j_ &&‡.
i_
 == b.i_;

508 
šlše
 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
JsÚ
::
cÚ¡_objeù_™”©Ü
 &
a
, cÚ¡ 
	gJsÚ
::cÚ¡_objeù_™”©Ü &
b
) {

509  !(
a
 =ğ
b
);

512 şas 
	cJsÚ
::
cÚ¡_¬¿y_™”©Ü
 { 
public
:

513 
JsÚ
::
	tsize_ty³
 
	tdifã»nû_ty³
;

514 
JsÚ
 
	tv®ue_ty³
;

515 cÚ¡ 
	tJsÚ
 *
	tpoš‹r_ty³
;

516 cÚ¡ 
	tJsÚ
 &
	t»ã»nû_ty³
;

517 #ià
CLICK_USERLEVEL


518 
	m¡d
::
	t¿ndom_acûss_™”©Ü_g
 
	t™”©Ü_ÿ‹gÜy
;

521 
	$cÚ¡_¬¿y_™”©Ü
() {

523 
	$boŞ
 (
	tcÚ¡_¬¿y_™”©Ü
::*
	tun¥ecif›d_boŞ_ty³
)() const;

524 
İ”©Ü
 
	$un¥ecif›d_boŞ_ty³
() const {

525  
	`live
(è? &
cÚ¡_¬¿y_™”©Ü
::
live
 : 0;

526 
	}
}

527 
boŞ
 
	$live
() const {

528  
j_
->
_ty³
 =ğ
j_¬¿y
 && j_->
	`ajsÚ
(è&& 
JsÚVeùÜ
::
	`size_ty³
(
i_
è< j_->ajsÚ()->
v®ues
.
	`size
();

529 
	}
}

530 cÚ¡ 
	gJsÚ
 &
	gİ”©Ü
*() const {

531  
	gj_
->
ajsÚ
()->
	gv®ues
[
i_
];

533 cÚ¡ 
	gJsÚ
 &
	gİ”©Ü
[](
difã»nû_ty³
 
	gi
) const {

534  
	gj_
->
ajsÚ
()->
	gv®ues
[
i_
 + 
i
];

536 cÚ¡ 
JsÚ
 *
	gİ”©Ü
->() const {

537  &(**
	gthis
);

539 cÚ¡ 
	gJsÚ
 &
	$v®ue
() const {

540  **
this
;

541 
	}
}

542 
	gİ”©Ü
++() {

543 ++
	gi_
;

545 
	gİ”©Ü
++() {

546 ++
	gi_
;

548 
	gİ”©Ü
--() {

549 --
	gi_
;

551 
	gİ”©Ü
--() {

552 --
	gi_
;

554 
	gcÚ¡_¬¿y_™”©Ü
 &
	gİ”©Ü
+=(
difã»nû_ty³
 
x
) {

555 
i_
 +ğ
x
;

556  *
	gthis
;

558 
	gcÚ¡_¬¿y_™”©Ü
 &
	gİ”©Ü
-=(
difã»nû_ty³
 
x
) {

559 
i_
 -ğ
x
;

560  *
	gthis
;

562 
	g´iv©e
:

563 cÚ¡ 
JsÚ
 *
j_
;

564 
	gi_
;

565 
	$cÚ¡_¬¿y_™”©Ü
(cÚ¡ 
JsÚ
 *
j
, 
i
)

566 : 
	`j_
(
j
), 
	$i_
(
i
) {

567 
	}
}

568 
ä›nd
 
şass
 
	gJsÚ
;

569 
ä›nd
 
şass
 
	gJsÚ
::
¬¿y_™”©Ü
;

570 
ä›nd
 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
cÚ¡_¬¿y_™”©Ü
 &, cÚ¡ 
	gcÚ¡_¬¿y_™”©Ü
 &);

571 
ä›nd
 
boŞ
 
	gİ”©Ü
<(cÚ¡ 
	gcÚ¡_¬¿y_™”©Ü
 &, const const_array_iterator &);

572 
ä›nd
 
difã»nû_ty³
 
	gİ”©Ü
-(cÚ¡ 
	gcÚ¡_¬¿y_™”©Ü
 &, const const_array_iterator &);

575 şas 
	cJsÚ
::
¬¿y_™”©Ü
 : 
public
 
cÚ¡_¬¿y_™”©Ü
 {…ublic:

576 cÚ¡ 
	tJsÚ
 *
	tpoš‹r_ty³
;

577 cÚ¡ 
	tJsÚ
 &
	t»ã»nû_ty³
;

579 
	$¬¿y_™”©Ü
() {

581 
JsÚ
 &
İ”©Ü
*() const {

582 
cÚ¡_ÿ¡
<
JsÚ
 *>(
j_
)->
	`uniqueify_¬¿y
(
çl£
);

583  
j_
->
	`ajsÚ
()->
v®ues
[
i_
];

584 
	}
}

585 
	gJsÚ
 &
	gİ”©Ü
[](
difã»nû_ty³
 
	gi
) const {

586 
	gcÚ¡_ÿ¡
<
	gJsÚ
 *>(
	gj_
)->
uniqueify_¬¿y
(
çl£
);

587  
	gj_
->
ajsÚ
()->
	gv®ues
[
i_
 + 
i
];

589 
JsÚ
 *
	gİ”©Ü
->() const {

590  &(**
	gthis
);

592 
	gJsÚ
 &
	$v®ue
() const {

593  **
this
;

594 
	}
}

595 
	g´iv©e
:

596 
	$¬¿y_™”©Ü
(
JsÚ
 *
j
, 
i
)

597 : 
	$cÚ¡_¬¿y_™”©Ü
(
j
, 
i
) {

598 
	}
}

599 
ä›nd
 
şass
 
	gJsÚ
;

602 
šlše
 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
JsÚ
::
cÚ¡_¬¿y_™”©Ü
 &
a
, cÚ¡ 
	gJsÚ
::cÚ¡_¬¿y_™”©Ü &
b
) {

603  
a
.
j_
 =ğ
b
.j_ &&‡.
i_
 == b.i_;

606 
šlše
 
boŞ
 
	gİ”©Ü
<(cÚ¡ 
	gJsÚ
::
cÚ¡_¬¿y_™”©Ü
 &
a
, cÚ¡ JsÚ::cÚ¡_¬¿y_™”©Ü &
b
) {

607  
a
.
j_
 < 
b
.j_ || (a.j_ =ğb.j_ &&‡.
i_
 < b.i_);

610 
šlše
 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
JsÚ
::
cÚ¡_¬¿y_™”©Ü
 &
a
, cÚ¡ 
	gJsÚ
::cÚ¡_¬¿y_™”©Ü &
b
) {

611  !(
a
 =ğ
b
);

614 
šlše
 
boŞ
 
	gİ”©Ü
<=(cÚ¡ 
JsÚ
::
cÚ¡_¬¿y_™”©Ü
 &
a
, cÚ¡ 
	gJsÚ
::cÚ¡_¬¿y_™”©Ü &
b
) {

615  !(
b
 < 
a
);

618 
šlše
 
boŞ
 
	gİ”©Ü
>(cÚ¡ 
	gJsÚ
::
cÚ¡_¬¿y_™”©Ü
 &
a
, cÚ¡ JsÚ::cÚ¡_¬¿y_™”©Ü &
b
) {

619  
b
 < 
a
;

622 
šlše
 
boŞ
 
	gİ”©Ü
>=(cÚ¡ 
JsÚ
::
cÚ¡_¬¿y_™”©Ü
 &
a
, cÚ¡ 
	gJsÚ
::cÚ¡_¬¿y_™”©Ü &
b
) {

623  !(
a
 < 
b
);

626 
šlše
 
	gJsÚ
::
cÚ¡_¬¿y_™”©Ü
 
İ”©Ü
+(
JsÚ
::cÚ¡_¬¿y_™”©Ü 
a
, JsÚ::cÚ¡_¬¿y_™”©Ü::
difã»nû_ty³
 
i
) {

627  
a
 +ğ
i
;

630 
šlše
 
	gJsÚ
::
cÚ¡_¬¿y_™”©Ü
 
İ”©Ü
-(
JsÚ
::cÚ¡_¬¿y_™”©Ü 
a
, JsÚ::cÚ¡_¬¿y_™”©Ü::
difã»nû_ty³
 
i
) {

631  
a
 -ğ
i
;

634 
šlše
 
	gJsÚ
::
cÚ¡_¬¿y_™”©Ü
::
difã»nû_ty³
 
İ”©Ü
-(cÚ¡ 
JsÚ
::cÚ¡_¬¿y_™”©Ü &
a
, cÚ¡ JsÚ::cÚ¡_¬¿y_™”©Ü &
b
) {

635 
as£¹
(
a
.
j_
 =ğ
b
.j_);

636  
	ga
.
	gi_
 - 
	gb
.i_;

639 şas 
	cJsÚ
::
cÚ¡_™”©Ü
 { 
public
:

640 
Paœ
<cÚ¡ 
	tSŒšg
, 
	tJsÚ
 &> 
	tv®ue_ty³
;

641 cÚ¡ 
	tv®ue_ty³
 *
	tpoš‹r_ty³
;

642 cÚ¡ 
	tv®ue_ty³
 &
	t»ã»nû_ty³
;

643 #ià
CLICK_USERLEVEL


644 
	m¡d
::
	tfÜw¬d_™”©Ü_g
 
	t™”©Ü_ÿ‹gÜy
;

647 
	$cÚ¡_™”©Ü
()

648 : 
	`v®ue_
(
	`SŒšg
(), *(
JsÚ
 *) 0) {

650 
	$boŞ
 (
	tcÚ¡_™”©Ü
::*
	tun¥ecif›d_boŞ_ty³
)() const;

651 
İ”©Ü
 
	$un¥ecif›d_boŞ_ty³
() const {

652  
	`live
(è? &
cÚ¡_™”©Ü
::
live
 : 0;

653 
	}
}

654 
boŞ
 
	$live
() const {

655  
i_
 >= 0;

656 
	}
}

657 cÚ¡ 
	gv®ue_ty³
 &
	gİ”©Ü
*() const {

658  
	gv®ue_
;

660 cÚ¡ 
v®ue_ty³
 *
	gİ”©Ü
->() const {

661  &(**
	gthis
);

663 cÚ¡ 
	gSŒšg
 &
	$key
() const {

664  (**
this
).
fœ¡
;

665 
	}
}

666 cÚ¡ 
	gJsÚ
 &
	$v®ue
() const {

667  (**
this
).
£cÚd
;

668 
	}
}

669 
	gİ”©Ü
++() {

670 ++
	gi_
;

671 
fix
();

673 
	gİ”©Ü
++() {

674 ++(*
	gthis
);

676 
	g´iv©e
:

677 cÚ¡ 
JsÚ
 *
j_
;

678 
	gi_
;

679 
v®ue_ty³
 
	gv®ue_
;

680 
	$cÚ¡_™”©Ü
(cÚ¡ 
JsÚ
 *
j
, 
i
)

681 : 
	`j_
(
j
), 
	`i_
(
i
), 
	`v®ue_
(
	`SŒšg
(), *(
JsÚ
 *) 0) {

682 ià(
i_
 >= 0)

683 
	`fix
();

684 
	}
}

685 
	$fix
() {

686 ià(
j_
->
_ty³
 =ğ
j_objeù
) {

687 
ObjeùJsÚ
 *
oj
 = 
j_
->
	`ojsÚ
();

688 
»Œy
:

689 ià(!
oj
 || 
i_
 >ğoj->
n_
)

690 
i_
 = -1;

691 ià(
oj
->
	`™em
(
i_
).
Ãxt_
 == -2) {

692 ++
i_
;

693 
»Œy
;

695 
v®ue_
.~
	`Paœ
();

696 
	`Ãw
((*è&
v®ue_
è
	`v®ue_ty³
(
oj
->
	`™em
(
i_
).
v_
.
fœ¡
,

697 
oj
->
	`™em
(
i_
).
v_
.
£cÚd
);

700 
A¼ayJsÚ
 *
aj
 = 
j_
->
	`ajsÚ
();

701 ià(!
aj
 || 
i_
 >ğaj->
v®ues
.
	`size
())

702 
i_
 = -1;

704 
v®ue_
.~
	`Paœ
();

705 
	`Ãw
((*è&
v®ue_
è
	`v®ue_ty³
(
	`SŒšg
(
i_
), 
aj
->
v®ues
[i_]);

708 
	}
}

709 
ä›nd
 
şass
 
	gJsÚ
;

710 
ä›nd
 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
cÚ¡_™”©Ü
 &, cÚ¡ 
	gcÚ¡_™”©Ü
 &);

713 şas 
	cJsÚ
::
™”©Ü
 : 
public
 
cÚ¡_™”©Ü
 {…ublic:

714 
v®ue_ty³
 *
	tpoš‹r_ty³
;

715 
	mv®ue_ty³
 &
	t»ã»nû_ty³
;

717 
	$™”©Ü
() {

719 
v®ue_ty³
 &
İ”©Ü
*() const {

720 ià(
j_
->
_cjsÚ
->
»fcouÁ
 > 1)

721 
	`uniqueify
();

722  
cÚ¡_ÿ¡
<
v®ue_ty³
 &>(
cÚ¡_™”©Ü
::
İ”©Ü
*());

723 
	}
}

724 
v®ue_ty³
 *
	gİ”©Ü
->() const {

725  &(**
	gthis
);

727 
	gJsÚ
 &
	$v®ue
() const {

728  (**
this
).
£cÚd
;

729 
	}
}

730 
	g´iv©e
:

731 
	$™”©Ü
(
JsÚ
 *
j
, 
i
)

732 : 
	$cÚ¡_™”©Ü
(
j
, 
i
) {

733 
	}
}

734 
	$uniqueify
() const {

735 ià(
j_
->
_ty³
 =ğ
j_objeù
)

736 
cÚ¡_ÿ¡
<
JsÚ
 *>(
j_
)->
	`uniqueify_objeù
(
çl£
);

738 
cÚ¡_ÿ¡
<
JsÚ
 *>(
j_
)->
	`uniqueify_¬¿y
(
çl£
);

739 
cÚ¡_ÿ¡
<
™”©Ü
 *>(
this
)->
	`fix
();

740 
	}
}

741 
ä›nd
 
şass
 
	gJsÚ
;

744 
šlše
 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
JsÚ
::
cÚ¡_™”©Ü
 &
a
, cÚ¡ 
	gJsÚ
::cÚ¡_™”©Ü &
b
) {

745  
a
.
j_
 =ğ
b
.j_ &&‡.
i_
 == b.i_;

748 
šlše
 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
JsÚ
::
cÚ¡_™”©Ü
 &
a
, cÚ¡ 
	gJsÚ
::cÚ¡_™”©Ü &
b
) {

749  !(
a
 =ğ
b
);

753 
	g‹m¶©e
 <
ty³Çme
 
	gP
>

754 şas 
	cJsÚ_´oxy_ba£
 {

755 
	mpublic
:

756 cÚ¡ 
JsÚ
 &
	$cv®ue
() const {

757  
¡©ic_ÿ¡
<cÚ¡ 
P
 *>(
this
)->
	`cv®ue
();

759 
JsÚ
 &
	$v®ue
() {

760  
¡©ic_ÿ¡
<
P
 *>(
this
)->
	`v®ue
();

761 
	}
}

762 
İ”©Ü
 cÚ¡ 
	gJsÚ
 &() const {

763  
cv®ue
();

765 
İ”©Ü
 
	gJsÚ
 &() {

766  
v®ue
();

768 
İ”©Ü
 
	gJsÚ
::
	$un¥ecif›d_boŞ_ty³
() const {

769  
	`cv®ue
();

770 
	}
}

771 
boŞ
 
	gİ”©Ü
!() const {

772  !
cv®ue
();

774 
	gJsÚ
::
jsÚ_ty³
 
	$ty³
() const {

775  
	`cv®ue
().
	`ty³
();

776 
	}
}

777 
boŞ
 
	$is_nuÎ
() const {

778  
	`cv®ue
().
	`is_nuÎ
();

779 
	}
}

780 
boŞ
 
	$is_št
() const {

781  
	`cv®ue
().
	`is_št
();

782 
	}
}

783 
boŞ
 
	$is_doubË
() const {

784  
	`cv®ue
().
	`is_doubË
();

785 
	}
}

786 
boŞ
 
	$is_numb”
() const {

787  
	`cv®ue
().
	`is_numb”
();

788 
	}
}

789 
boŞ
 
	$is_boŞ
() const {

790  
	`cv®ue
().
	`is_boŞ
();

791 
	}
}

792 
boŞ
 
	$is_¡ršg
() const {

793  
	`cv®ue
().
	`is_¡ršg
();

794 
	}
}

795 
boŞ
 
	$is_¬¿y
() const {

796  
	`cv®ue
().
	`is_¬¿y
();

797 
	}
}

798 
boŞ
 
	$is_objeù
() const {

799  
	`cv®ue
().
	`is_objeù
();

800 
	}
}

801 
boŞ
 
	$is_´im™ive
() const {

802  
	`cv®ue
().
	`is_´im™ive
();

803 
	}
}

804 
boŞ
 
	$em±y
() const {

805  
	`cv®ue
().
	`em±y
();

806 
	}
}

807 
	gJsÚ
::
size_ty³
 
	$size
() const {

808  
	`cv®ue
().
	`size
();

809 
	}
}

810 
	$to_i
() const {

811  
	`cv®ue
().
	`to_i
();

812 
	}
}

813 
ušt64_t
 
	$to_u64
() const {

814  
	`cv®ue
().
	`to_u64
();

815 
	}
}

816 
boŞ
 
	$to_i
(&
x
) const {

817  
	`cv®ue
().
	`to_i
(
x
);

818 
	}
}

819 
boŞ
 
	$to_i
(&
x
) const {

820  
	`cv®ue
().
	`to_i
(
x
);

821 
	}
}

822 
boŞ
 
	$to_i
(&
x
) const {

823  
	`cv®ue
().
	`to_i
(
x
);

824 
	}
}

825 
boŞ
 
	$to_i
(&
x
) const {

826  
	`cv®ue
().
	`to_i
(
x
);

827 
	}
}

828 #ià
HAVE_LONG_LONG


829 
boŞ
 
	$to_i
(&
x
) const {

830  
	`cv®ue
().
	`to_i
(
x
);

831 
	}
}

832 
boŞ
 
	$to_i
(&
x
) const {

833  
	`cv®ue
().
	`to_i
(
x
);

834 
	}
}

836 
	$as_i
() const {

837  
	`cv®ue
().
	`as_i
();

838 
	}
}

839 #ià
HAVE_FLOAT_TYPES


840 
	$to_d
() const {

841  
	`cv®ue
().
	`to_d
();

842 
	}
}

843 
boŞ
 
	$to_d
(&
x
) const {

844  
	`cv®ue
().
	`to_d
(
x
);

845 
	}
}

846 
	$as_d
() const {

847  
	`cv®ue
().
	`as_d
();

848 
	}
}

850 
boŞ
 
	$to_b
() const {

851  
	`cv®ue
().
	`to_b
();

852 
	}
}

853 
boŞ
 
	$to_b
(
boŞ
 &
x
) const {

854  
	`cv®ue
().
	`to_b
(
x
);

855 
	}
}

856 
boŞ
 
	$as_b
() const {

857  
	`cv®ue
().
	`as_b
();

858 
	}
}

859 cÚ¡ 
	gSŒšg
 &
	$to_s
() const {

860  
	`cv®ue
().
	`to_s
();

861 
	}
}

862 
boŞ
 
	$to_s
(
SŒšg
 &
x
) const {

863  
	`cv®ue
().
	`to_s
(
x
);

864 
	}
}

865 cÚ¡ 
	gSŒšg
 &
	$as_s
() const {

866  
	`cv®ue
().
	`as_s
();

867 
	}
}

868 cÚ¡ *
	$c_¡r
() const {

869  
	`cv®ue
().
	`c_¡r
();

870 
	}
}

871 
	gJsÚ
::
size_ty³
 
	$couÁ
(cÚ¡ 
SŒšgRef
 &
key
) const {

872  
	`cv®ue
().
	`couÁ
(
key
);

873 
	}
}

874 cÚ¡ 
	gJsÚ
 &
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
) const {

875  
	`cv®ue
().
	`g‘
(
key
);

876 
	}
}

877 
	gJsÚ
 &
	$g‘_š£¹
(cÚ¡ 
SŒšg
 &
key
) {

878  
	`v®ue
().
	`g‘_š£¹
(
key
);

879 
	}
}

880 
	gJsÚ
 &
	$g‘_š£¹
(cÚ¡ 
SŒšgRef
 &
key
) {

881  
	`v®ue
().
	`g‘_š£¹
(
key
);

882 
	}
}

883 
	gJsÚ
 &
	$g‘_š£¹
(cÚ¡ *
key
) {

884  
	`v®ue
().
	`g‘_š£¹
(
key
);

885 
	}
}

886 
	$g‘_i
(cÚ¡ 
SŒšgRef
 &
key
) const {

887  
	`cv®ue
().
	`g‘_i
(
key
);

888 
	}
}

889 #ià
HAVE_FLOAT_TYPES


890 
	$g‘_d
(cÚ¡ 
SŒšgRef
 &
key
) const {

891  
	`cv®ue
().
	`g‘_d
(
key
);

892 
	}
}

894 
boŞ
 
	$g‘_b
(cÚ¡ 
SŒšgRef
 &
key
) const {

895  
	`cv®ue
().
	`g‘_b
(
key
);

896 
	}
}

897 cÚ¡ 
	gSŒšg
 &
	$g‘_s
(cÚ¡ 
SŒšgRef
 &
key
) const {

898  
	`cv®ue
().
	`g‘_s
(
key
);

899 
	}
}

900 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, 
JsÚ
 &
x
) const;

901 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const;

902 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const;

903 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const;

904 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const;

905 #ià
HAVE_LONG_LONG


906 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const;

907 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const;

909 #ià
HAVE_FLOAT_TYPES


910 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const;

912 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, 
boŞ
 &
x
) const;

913 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, 
SŒšg
 &
x
) const;

914 cÚ¡ 
JsÚ
 &
İ”©Ü
[](cÚ¡ 
SŒšgRef
 &
key
) const {

915  
	`cv®ue
().
	`g‘
(
key
);

916 
	}
}

917 
	gJsÚ_objeù_´oxy
<
	gP
> 
	gİ”©Ü
[](cÚ¡ 
	gSŒšg
 &
	gkey
) {

918  
	gJsÚ_objeù_´oxy
<
	gP
>(*
	g¡©ic_ÿ¡
<P *>(
	gthis
), 
	gkey
);

920 
	gJsÚ_objeù_¡r_´oxy
<
	gP
> 
	gİ”©Ü
[](cÚ¡ 
	gSŒšgRef
 &
	gkey
) {

921  
	gJsÚ_objeù_¡r_´oxy
<
	gP
>(*
	g¡©ic_ÿ¡
<P *>(
	gthis
), 
	gkey
);

923 
	gJsÚ_objeù_¡r_´oxy
<
	gP
> 
	gİ”©Ü
[](cÚ¡ *
	gkey
) {

924  
	gJsÚ_objeù_¡r_´oxy
<
	gP
>(*
	g¡©ic_ÿ¡
<P *>(
	gthis
), 
	gkey
);

926 cÚ¡ 
	gJsÚ
 &
	$©
(cÚ¡ 
SŒšgRef
 &
key
) const {

927  
	`cv®ue
().
	`©
(
key
);

928 
	}
}

929 
	gJsÚ
 &
	$©_š£¹
(cÚ¡ 
SŒšg
 &
key
) {

930  
	`v®ue
().
	`©_š£¹
(
key
);

931 
	}
}

932 
	gJsÚ
 &
	$©_š£¹
(cÚ¡ 
SŒšgRef
 &
key
) {

933  
	`v®ue
().
	`©_š£¹
(
key
);

934 
	}
}

935 
	gJsÚ
 &
	$©_š£¹
(cÚ¡ *
key
) {

936  
	`v®ue
().
	`©_š£¹
(
key
);

937 
	}
}

938 
	g‹m¶©e
 <
ty³Çme
 
	gT
> 
šlše
 
	gJsÚ
 &
	$£t
(cÚ¡ 
SŒšg
 &
key
, 
T
 
v®ue
) {

939  
this
->
	`v®ue
().
	`£t
(
key
, 
v®ue
);

940 
	}
}

941 #ià
HAVE_CXX_RVALUE_REFERENCES


942 
šlše
 
	gJsÚ
 &
	$£t
(cÚ¡ 
SŒšg
 &
key
, 
JsÚ
 &&
v®ue
) {

943  
this
->
	`v®ue
().
	`£t
(
key
, 
	`şick_move
(
v®ue
));

944 
	}
}

946 
	gJsÚ
 &
	$un£t
(cÚ¡ 
SŒšgRef
 &
key
) {

947  
	`v®ue
().
	`un£t
(
key
);

948 
	}
}

949 
	gPaœ
<
	gJsÚ
::
objeù_™”©Ü
, 
	gboŞ
> 
	$š£¹
(cÚ¡ 
JsÚ
::
objeù_v®ue_ty³
 &
x
) {

950  
	`v®ue
().
	`š£¹
(
x
);

951 
	}
}

952 
	gJsÚ
::
objeù_™”©Ü
 
	$š£¹
(
JsÚ
::
objeù_™”©Ü
 
pos™iÚ
, cÚ¡ JsÚ::
objeù_v®ue_ty³
 &
x
) {

953  
	`v®ue
().
	`š£¹
(
pos™iÚ
, 
x
);

954 
	}
}

955 
	gJsÚ
::
size_ty³
 
	$”a£
(cÚ¡ 
SŒšgRef
 &
key
) {

956  
	`v®ue
().
	`”a£
(
key
);

957 
	}
}

958 
	gJsÚ
 &
	$m”ge
(cÚ¡ 
JsÚ
 &
x
) {

959  
	`v®ue
().
	`m”ge
(
x
);

960 
	}
}

961 
	g‹m¶©e
 <
ty³Çme
 
	gP2
> 
	gJsÚ
 &
m”ge
(cÚ¡ 
JsÚ_´oxy_ba£
<
P2
> &
x
) {

962  
v®ue
().
m”ge
(
x
.
cv®ue
());

964 cÚ¡ 
	gJsÚ
 &
	$g‘
(
JsÚ
::
size_ty³
 
x
) const {

965  
	`cv®ue
().
	`g‘
(
x
);

966 
	}
}

967 
	gJsÚ
 &
	$g‘_š£¹
(
JsÚ
::
size_ty³
 
x
) {

968  
	`v®ue
().
	`g‘_š£¹
(
x
);

969 
	}
}

970 cÚ¡ 
	gJsÚ
 &
	gİ”©Ü
[](
	gkey
) const {

971  
cv®ue
().
©
(
key
);

973 
	gJsÚ_¬¿y_´oxy
<
	gP
> 
	gİ”©Ü
[](
	gkey
) {

974  
	gJsÚ_¬¿y_´oxy
<
	gP
>(*
	g¡©ic_ÿ¡
<P *>(
	gthis
), 
	gkey
);

976 cÚ¡ 
	gJsÚ
 &
	$©
(
JsÚ
::
size_ty³
 
x
) const {

977  
	`cv®ue
().
	`©
(
x
);

978 
	}
}

979 
	gJsÚ
 &
	$©_š£¹
(
JsÚ
::
size_ty³
 
x
) {

980  
	`v®ue
().
	`©_š£¹
(
x
);

981 
	}
}

982 cÚ¡ 
	gJsÚ
 &
	$back
() const {

983  
	`cv®ue
().
	`back
();

984 
	}
}

985 
	gJsÚ
 &
	$back
() {

986  
	`v®ue
().
	`back
();

987 
	}
}

988 
	g‹m¶©e
 <
ty³Çme
 
	gT
> 
	gJsÚ
 &
	$push_back
(
T
 
x
) {

989  
	`v®ue
().
	`push_back
(
x
);

990 
	}
}

991 #ià
HAVE_CXX_RVALUE_REFERENCES


992 
	gJsÚ
 &
	$push_back
(
JsÚ
 &&
x
) {

993  
	`v®ue
().
	`push_back
(
	`şick_move
(
x
));

994 
	}
}

996 
	$pİ_back
() {

997 
	`v®ue
().
	`pİ_back
();

998 
	}
}

999 
	$uÅ¬£
(
SŒšgAccum
 &
§
) const {

1000  
	`cv®ue
().
	`uÅ¬£
(
§
);

1001 
	}
}

1002 
	$uÅ¬£
(
SŒšgAccum
 &
§
, cÚ¡ 
JsÚ
::
uÅ¬£_mªuÏtÜ
 &
m
) const {

1003  
	`cv®ue
().
	`uÅ¬£
(
§
, 
m
);

1004 
	}
}

1005 
SŒšg
 
	$uÅ¬£
() const {

1006  
	`cv®ue
().
	`uÅ¬£
(
çl£
);

1007 
	}
}

1008 
SŒšg
 
	$uÅ¬£
(
boŞ
 
add_Ãwlše
) const {

1009  
	`cv®ue
().
	`uÅ¬£
(
add_Ãwlše
);

1010 
	}
}

1011 
SŒšg
 
	$uÅ¬£
(cÚ¡ 
JsÚ
::
uÅ¬£_mªuÏtÜ
 &
m
, 
boŞ
 
add_Ãwlše
 = 
çl£
) const {

1012  
	`cv®ue
().
	`uÅ¬£
(
m
, 
add_Ãwlše
);

1013 
	}
}

1014 
boŞ
 
	$assign_·r£
(cÚ¡ 
SŒšg
 &
¡r
) {

1015  
	`v®ue
().
	`assign_·r£
(
¡r
);

1016 
	}
}

1017 
boŞ
 
	$assign_·r£
(cÚ¡ *
fœ¡
, cÚ¡ *
Ï¡
) {

1018  
	`v®ue
().
	`assign_·r£
(
fœ¡
, 
Ï¡
);

1019 
	}
}

1020 
	gJsÚ
 &
	gİ”©Ü
++() {

1021  ++
v®ue
();

1023 
	gİ”©Ü
++() {

1024 
v®ue
()++;

1026 
	gJsÚ
 &
	gİ”©Ü
--() {

1027  --
v®ue
();

1029 
	gİ”©Ü
--() {

1030 
v®ue
()--;

1032 
	gJsÚ
 &
	gİ”©Ü
+=(
x
) {

1033  
v®ue
(è+ğ
x
;

1035 
	gJsÚ
 &
	gİ”©Ü
+=(
x
) {

1036  
v®ue
(è+ğ
x
;

1038 #ià
HAVE_FLOAT_TYPES


1039 
	gJsÚ
 &
	gİ”©Ü
+=(
x
) {

1040  
v®ue
(è+ğ
x
;

1043 
	gJsÚ
::
cÚ¡_objeù_™”©Ü
 
	$obegš
() const {

1044  
	`cv®ue
().
	`obegš
();

1045 
	}
}

1046 
	gJsÚ
::
cÚ¡_objeù_™”©Ü
 
	$Ûnd
() const {

1047  
	`cv®ue
().
	`Ûnd
();

1048 
	}
}

1049 
	gJsÚ
::
objeù_™”©Ü
 
	$obegš
() {

1050  
	`v®ue
().
	`obegš
();

1051 
	}
}

1052 
	gJsÚ
::
objeù_™”©Ü
 
	$Ûnd
() {

1053  
	`v®ue
().
	`Ûnd
();

1054 
	}
}

1055 
	gJsÚ
::
cÚ¡_objeù_™”©Ü
 
	$cobegš
() const {

1056  
	`cv®ue
().
	`cobegš
();

1057 
	}
}

1058 
	gJsÚ
::
cÚ¡_objeù_™”©Ü
 
	$cÛnd
() const {

1059  
	`cv®ue
().
	`cÛnd
();

1060 
	}
}

1061 
	gJsÚ
::
cÚ¡_¬¿y_™”©Ü
 
	$abegš
() const {

1062  
	`cv®ue
().
	`abegš
();

1063 
	}
}

1064 
	gJsÚ
::
cÚ¡_¬¿y_™”©Ü
 
	$«nd
() const {

1065  
	`cv®ue
().
	`«nd
();

1066 
	}
}

1067 
	gJsÚ
::
¬¿y_™”©Ü
 
	$abegš
() {

1068  
	`v®ue
().
	`abegš
();

1069 
	}
}

1070 
	gJsÚ
::
¬¿y_™”©Ü
 
	$«nd
() {

1071  
	`v®ue
().
	`«nd
();

1072 
	}
}

1073 
	gJsÚ
::
cÚ¡_¬¿y_™”©Ü
 
	$ÿbegš
() const {

1074  
	`cv®ue
().
	`ÿbegš
();

1075 
	}
}

1076 
	gJsÚ
::
cÚ¡_¬¿y_™”©Ü
 
	$ÿ’d
() const {

1077  
	`cv®ue
().
	`ÿ’d
();

1078 
	}
}

1079 
	gJsÚ
::
cÚ¡_™”©Ü
 
	$begš
() const {

1080  
	`cv®ue
().
	`begš
();

1081 
	}
}

1082 
	gJsÚ
::
cÚ¡_™”©Ü
 
	$’d
() const {

1083  
	`cv®ue
().
	`’d
();

1084 
	}
}

1085 
	gJsÚ
::
™”©Ü
 
	$begš
() {

1086  
	`v®ue
().
	`begš
();

1087 
	}
}

1088 
	gJsÚ
::
™”©Ü
 
	$’d
() {

1089  
	`v®ue
().
	`’d
();

1090 
	}
}

1091 
	gJsÚ
::
cÚ¡_™”©Ü
 
	$cbegš
() const {

1092  
	`cv®ue
().
	`cbegš
();

1093 
	}
}

1094 
	gJsÚ
::
cÚ¡_™”©Ü
 
	$ûnd
() const {

1095  
	`cv®ue
().
	`ûnd
();

1096 
	}
}

1099 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1100 
şass
 
	gJsÚ_objeù_´oxy
 : 
public
 
JsÚ_´oxy_ba£
<
JsÚ_objeù_´oxy
<
T
> > {

1101 
public
:

1102 cÚ¡ 
JsÚ
 &
cv®ue
() const {

1103  
ba£_
.
g‘
(
key_
);

1105 
	gJsÚ
 &
v®ue
() {

1106  
	gba£_
.
g‘_š£¹
(
key_
);

1108 
	gJsÚ
 &
	gİ”©Ü
=(cÚ¡ 
JsÚ
 &
x
) {

1109  
v®ue
(èğ
x
;

1111 #ià
HAVE_CXX_RVALUE_REFERENCES


1112 
	gJsÚ
 &
	gİ”©Ü
=(
JsÚ
 &&
x
) {

1113  
v®ue
(èğ
şick_move
(
x
);

1116 
	gJsÚ
 &
	gİ”©Ü
=(cÚ¡ 
JsÚ_objeù_´oxy
<
T
> &
x
) {

1117  
v®ue
(èğ
x
.
cv®ue
();

1119 
	g‹m¶©e
 <
ty³Çme
 
	gP
> 
	gJsÚ
 &
	gİ”©Ü
=(cÚ¡ 
JsÚ_´oxy_ba£
<
P
> &
x
) {

1120  
v®ue
(èğ
x
.
cv®ue
();

1122 
JsÚ_objeù_´oxy
(
T
 &
»f
, cÚ¡ 
SŒšg
 &
key
)

1123 : 
ba£_
(
»f
), 
key_
(
key
) {

1125 
	gT
 &
	gba£_
;

1126 
SŒšg
 
	gkey_
;

1129 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1130 
şass
 
	gJsÚ_objeù_¡r_´oxy
 : 
public
 
JsÚ_´oxy_ba£
<
JsÚ_objeù_¡r_´oxy
<
T
> > {

1131 
public
:

1132 cÚ¡ 
JsÚ
 &
cv®ue
() const {

1133  
ba£_
.
g‘
(
key_
);

1135 
	gJsÚ
 &
v®ue
() {

1136  
	gba£_
.
g‘_š£¹
(
key_
);

1138 
	gJsÚ
 &
	gİ”©Ü
=(cÚ¡ 
JsÚ
 &
x
) {

1139  
v®ue
(èğ
x
;

1141 #ià
HAVE_CXX_RVALUE_REFERENCES


1142 
	gJsÚ
 &
	gİ”©Ü
=(
JsÚ
 &&
x
) {

1143  
v®ue
(èğ
şick_move
(
x
);

1146 
	gJsÚ
 &
	gİ”©Ü
=(cÚ¡ 
JsÚ_objeù_¡r_´oxy
<
T
> &
x
) {

1147  
v®ue
(èğ
x
.
cv®ue
();

1149 
	g‹m¶©e
 <
ty³Çme
 
	gP
> 
	gJsÚ
 &
	gİ”©Ü
=(cÚ¡ 
JsÚ_´oxy_ba£
<
P
> &
x
) {

1150  
v®ue
(èğ
x
.
cv®ue
();

1152 
JsÚ_objeù_¡r_´oxy
(
T
 &
»f
, cÚ¡ 
SŒšgRef
 &
key
)

1153 : 
ba£_
(
»f
), 
key_
(
key
) {

1155 
	gT
 &
	gba£_
;

1156 
SŒšgRef
 
	gkey_
;

1159 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1160 
şass
 
	gJsÚ_¬¿y_´oxy
 : 
public
 
JsÚ_´oxy_ba£
<
JsÚ_¬¿y_´oxy
<
T
> > {

1161 
public
:

1162 cÚ¡ 
JsÚ
 &
cv®ue
() const {

1163  
ba£_
.
g‘
(
key_
);

1165 
	gJsÚ
 &
v®ue
() {

1166  
	gba£_
.
g‘_š£¹
(
key_
);

1168 
	gJsÚ
 &
	gİ”©Ü
=(cÚ¡ 
JsÚ
 &
x
) {

1169  
v®ue
(èğ
x
;

1171 #ià
HAVE_CXX_RVALUE_REFERENCES


1172 
	gJsÚ
 &
	gİ”©Ü
=(
JsÚ
 &&
x
) {

1173  
v®ue
(èğ
şick_move
(
x
);

1176 
	gJsÚ
 &
	gİ”©Ü
=(cÚ¡ 
JsÚ_¬¿y_´oxy
<
T
> &
x
) {

1177  
v®ue
(èğ
x
.
cv®ue
();

1179 
	g‹m¶©e
 <
ty³Çme
 
	gP
> 
	gJsÚ
 &
	gİ”©Ü
=(cÚ¡ 
JsÚ_´oxy_ba£
<
P
> &
x
) {

1180  
v®ue
(èğ
x
.
cv®ue
();

1182 
JsÚ_¬¿y_´oxy
(
T
 &
»f
, 
key
)

1183 : 
ba£_
(
»f
), 
key_
(
key
) {

1185 
	gT
 &
	gba£_
;

1186 
	gkey_
;

1189 
şass
 
	gJsÚ_g‘_´oxy
 : 
public
 
JsÚ_´oxy_ba£
<
JsÚ_g‘_´oxy
> {

1190 
public
:

1191 cÚ¡ 
JsÚ
 &
cv®ue
() const {

1192  
ba£_
;

1194 
İ”©Ü
 
	gJsÚ
::
un¥ecif›d_boŞ_ty³
() const {

1195  
¡©us_
 ? &
JsÚ
::
is_nuÎ
 : 0;

1197 
boŞ
 
	gİ”©Ü
!() const {

1198  !
	g¡©us_
;

1200 
boŞ
 
¡©us
() const {

1201  
	g¡©us_
;

1203 cÚ¡ 
	gJsÚ_g‘_´oxy
 &
¡©us
(
boŞ
 &
x
) const {

1204 
	gx
 = 
¡©us_
;

1205  *
	gthis
;

1207 
JsÚ_g‘_´oxy
(cÚ¡ 
JsÚ
 &
»f
, 
boŞ
 
¡©us
)

1208 : 
ba£_
(
»f
), 
¡©us_
(
¡©us
) {

1210 cÚ¡ 
	gJsÚ
 &
	gba£_
;

1211 
boŞ
 
	g¡©us_
;

1212 
	g´iv©e
:

1213 
JsÚ_g‘_´oxy
 &
İ”©Ü
=(cÚ¡ JsÚ_g‘_´oxy &
x
);

1216 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1217 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ_´oxy_ba£
<
	gT
>::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, 
JsÚ
 &
x
) const {

1218  
	`cv®ue
().
	`g‘
(
key
, 
x
);

1219 
	}
}

1220 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1221 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ_´oxy_ba£
<
	gT
>::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const {

1222  
	`cv®ue
().
	`g‘
(
key
, 
x
);

1223 
	}
}

1224 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1225 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ_´oxy_ba£
<
	gT
>::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const {

1226  
	`cv®ue
().
	`g‘
(
key
, 
x
);

1227 
	}
}

1228 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1229 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ_´oxy_ba£
<
	gT
>::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const {

1230  
	`cv®ue
().
	`g‘
(
key
, 
x
);

1231 
	}
}

1232 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1233 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ_´oxy_ba£
<
	gT
>::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const {

1234  
	`cv®ue
().
	`g‘
(
key
, 
x
);

1235 
	}
}

1236 #ià
HAVE_LONG_LONG


1237 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1238 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ_´oxy_ba£
<
	gT
>::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const {

1239  
	`cv®ue
().
	`g‘
(
key
, 
x
);

1240 
	}
}

1241 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1242 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ_´oxy_ba£
<
	gT
>::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const {

1243  
	`cv®ue
().
	`g‘
(
key
, 
x
);

1244 
	}
}

1246 #ià
HAVE_FLOAT_TYPES


1247 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1248 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ_´oxy_ba£
<
	gT
>::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const {

1249  
	`cv®ue
().
	`g‘
(
key
, 
x
);

1250 
	}
}

1252 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1253 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ_´oxy_ba£
<
	gT
>::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, 
boŞ
 &
x
) const {

1254  
	`cv®ue
().
	`g‘
(
key
, 
x
);

1255 
	}
}

1256 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1257 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ_´oxy_ba£
<
	gT
>::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, 
SŒšg
 &
x
) const {

1258  
	`cv®ue
().
	`g‘
(
key
, 
x
);

1259 
	}
}

1263 
šlše
 
	gJsÚ
::
	$JsÚ
()

1264 : 
	`_ty³
(
j_nuÎ
), 
	$_cjsÚ
() {

1265 
	}
}

1267 
šlše
 
	gJsÚ
::
	$JsÚ
(cÚ¡ 
JsÚ
 &
x
)

1268 : 
	`_ty³
(
x
.
_ty³
), 
	`_¡r
(x.
_¡r
), 
	$_cjsÚ
(
x
.
_cjsÚ
) {

1269 ià(
_cjsÚ
)

1270 
_cjsÚ
->
	`»f
();

1271 
	}
}

1272 #ià
HAVE_CXX_RVALUE_REFERENCES


1274 
šlše
 
	gJsÚ
::
	$JsÚ
(
JsÚ
 &&
x
)

1275 : 
	`_ty³
(
x
.
_ty³
), 
	`_¡r
(
	`şick_move
(x.
_¡r
)), 
	$_cjsÚ
(
x
.
_cjsÚ
) {

1276 
x
.
_cjsÚ
 = 0;

1277 
	}
}

1280 
šlše
 
	gJsÚ
::
	$JsÚ
(
x
)

1281 : 
	`_ty³
(
j_št
), 
	`_¡r
(
x
), 
	$_cjsÚ
() {

1282 
	}
}

1283 
šlše
 
	gJsÚ
::
	$JsÚ
(
x
)

1284 : 
	`_ty³
(
j_št
), 
	`_¡r
(
x
), 
	$_cjsÚ
() {

1285 
	}
}

1286 
šlše
 
	gJsÚ
::
	$JsÚ
(
x
)

1287 : 
	`_ty³
(
j_št
), 
	`_¡r
(
x
), 
	$_cjsÚ
() {

1288 
	}
}

1289 
šlše
 
	gJsÚ
::
	$JsÚ
(
x
)

1290 : 
	`_ty³
(
j_št
), 
	`_¡r
(
x
), 
	$_cjsÚ
() {

1291 
	}
}

1292 #ià
HAVE_LONG_LONG


1293 
šlše
 
	gJsÚ
::
	$JsÚ
(
x
)

1294 : 
	`_ty³
(
j_št
), 
	`_¡r
(
x
), 
	$_cjsÚ
() {

1295 
	}
}

1296 
šlše
 
	gJsÚ
::
	$JsÚ
(
x
)

1297 : 
	`_ty³
(
j_št
), 
	`_¡r
(
x
), 
	$_cjsÚ
() {

1298 
	}
}

1300 #ià
HAVE_FLOAT_TYPES


1301 
šlše
 
	gJsÚ
::
	$JsÚ
(
x
)

1302 : 
	`_ty³
(
j_doubË
), 
	`_¡r
(
x
), 
	$_cjsÚ
() {

1303 
	}
}

1305 
šlše
 
	gJsÚ
::
	$JsÚ
(
boŞ
 
x
)

1306 : 
	`_ty³
(
j_boŞ
), 
	`_¡r
(
x
), 
	$_cjsÚ
() {

1307 
	}
}

1308 
šlše
 
	gJsÚ
::
	$JsÚ
(cÚ¡ 
SŒšg
 &
x
)

1309 : 
	`_ty³
(
j_¡ršg
), 
	`_¡r
(
x
), 
	$_cjsÚ
() {

1310 
	}
}

1311 
šlše
 
	gJsÚ
::
	$JsÚ
(cÚ¡ *
x
)

1312 : 
	`_ty³
(
j_¡ršg
), 
	`_¡r
(
x
), 
	$_cjsÚ
() {

1313 
	}
}

1315 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1316 
šlše
 
	gJsÚ
::
JsÚ
(cÚ¡ 
VeùÜ
<
T
> &
x
)

1317 : 
_ty³
(
j_¬¿y
), 
	$_cjsÚ
(
Ãw
 
A¼ayJsÚ
) {

1318 cÚ¡ 
T
 *
™
 = 
x
.
	`begš
(); iˆ!ğx.
	`’d
(); ++it)

1319 
	`ajsÚ
()->
v®ues
.
	`push_back
(
	`JsÚ
(*
™
));

1320 
	}
}

1323 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1324 
šlše
 
	gJsÚ
::
	$JsÚ
(
T
 
fœ¡
, T 
Ï¡
)

1325 : 
	`_ty³
(
j_¬¿y
), 
	$_cjsÚ
(
Ãw
 
A¼ayJsÚ
) {

1326 
fœ¡
 !ğ
Ï¡
) {

1327 
	`ajsÚ
()->
v®ues
.
	`push_back
(
	`JsÚ
(*
fœ¡
));

1328 ++
fœ¡
;

1330 
	}
}

1332 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

1333 
šlše
 
	gJsÚ
::
JsÚ
(cÚ¡ 
HashTabË
<
SŒšg
, 
T
> &
x
)

1334 : 
_ty³
(
j_objeù
), 
	$_cjsÚ
(
Ãw
 
ObjeùJsÚ
) {

1335 
ty³Çme
 
HashTabË
<
SŒšg
, 
T
>::
cÚ¡_™”©Ü
 
™
 = 
x
.
	`begš
();

1336 
™
 !ğ
x
.
	`’d
(); ++it) {

1337 
JsÚ
 &
x
 = 
	`ojsÚ
()->
	`g‘_š£¹
(
™
.
	`key
());

1338 
x
 = 
	`JsÚ
(
™
.
	`v®ue
());

1340 
	}
}

1341 
šlše
 
	gJsÚ
::~
	$JsÚ
() {

1342 ià(
_cjsÚ
)

1343 
_cjsÚ
->
	`d”ef
(
_ty³
);

1344 
	}
}

1347 
šlše
 
JsÚ
 
	gJsÚ
::
	$make_¬¿y
() {

1348 
JsÚ
 
j
;

1349 
j
.
_ty³
 = 
j_¬¿y
;

1350  
j
;

1351 
	}
}

1353 
šlše
 
JsÚ
 
	gJsÚ
::
	$make_objeù
() {

1354 
JsÚ
 
j
;

1355 
j
.
_ty³
 = 
j_objeù
;

1356  
j
;

1357 
	}
}

1359 
šlše
 
JsÚ
 
	gJsÚ
::
	$make_¡ršg
(cÚ¡ 
SŒšg
 &
x
) {

1360  
	`JsÚ
(
x
);

1361 
	}
}

1363 
šlše
 
JsÚ
 
	gJsÚ
::
	$make_¡ršg
(cÚ¡ *
s
, 
Ën
) {

1364  
	`JsÚ
(
	`SŒšg
(
s
, 
Ën
));

1365 
	}
}

1369 
šlše
 
	gJsÚ
::
İ”©Ü
 
	$un¥ecif›d_boŞ_ty³
() const {

1370  
_ty³
 =ğ
j_nuÎ
 ? 0 : &
JsÚ
::
is_nuÎ
;

1371 
	}
}

1373 
šlše
 
boŞ
 
	gJsÚ
::
İ”©Ü
!() const {

1374  
_ty³
 =ğ
j_nuÎ
;

1378 
šlše
 
	gJsÚ
::
jsÚ_ty³
 
JsÚ
::
	$ty³
() const {

1379  
_ty³
;

1380 
	}
}

1382 
šlše
 
boŞ
 
	gJsÚ
::
	$is_nuÎ
() const {

1383  
_ty³
 =ğ
j_nuÎ
;

1384 
	}
}

1385 
šlše
 
boŞ
 
	gJsÚ
::
	$is_št
() const {

1386  
_ty³
 =ğ
j_št
;

1387 
	}
}

1388 
šlše
 
boŞ
 
	gJsÚ
::
	$is_doubË
() const {

1389  
_ty³
 =ğ
j_doubË
;

1390 
	}
}

1391 
šlše
 
boŞ
 
	gJsÚ
::
	$is_numb”
() const {

1392  
	`is_št
(è|| 
	`is_doubË
();

1393 
	}
}

1394 
šlše
 
boŞ
 
	gJsÚ
::
	$is_boŞ
() const {

1395  
_ty³
 =ğ
j_boŞ
;

1396 
	}
}

1397 
šlše
 
boŞ
 
	gJsÚ
::
	$is_¡ršg
() const {

1398  
_ty³
 =ğ
j_¡ršg
;

1399 
	}
}

1400 
šlše
 
boŞ
 
	gJsÚ
::
	$is_¬¿y
() const {

1401  
_ty³
 =ğ
j_¬¿y
;

1402 
	}
}

1403 
šlše
 
boŞ
 
	gJsÚ
::
	$is_objeù
() const {

1404  
_ty³
 =ğ
j_objeù
;

1405 
	}
}

1407 
šlše
 
boŞ
 
	gJsÚ
::
	$is_´im™ive
() const {

1408  
_ty³
 >ğ
j_št
 && _ty³ <ğ
j_¡ršg
;

1409 
	}
}

1413 
šlše
 
boŞ
 
	gJsÚ
::
	$em±y
() const {

1414  (
_ty³
 <ğ
j_objeù
 && 
	`size
() == 0);

1415 
	}
}

1418 
šlše
 
	gJsÚ
::
size_ty³
 
JsÚ
::
	$size
() const {

1419 
	`as£¹
(
_ty³
 =ğ
j_nuÎ
 || _ty³ =ğ
j_¬¿y
 || _ty³ =ğ
j_objeù
);

1420 ià(!
_cjsÚ
)

1422 ià(
_ty³
 =ğ
j_objeù
) {

1423 
ObjeùJsÚ
 *
oj
 = 
	`ojsÚ
();

1424  
oj
->
n_
 - oj->
Äemoved_
;

1426  
	`ajsÚ
()->
v®ues
.
	`size
();

1427 
	}
}

1439 
šlše
 
	gJsÚ
::
	$to_i
() const {

1440 ià(
_ty³
 =ğ
j_št
 && 
_¡r
.
	`Ëngth
() == 1)

1441  
_¡r
[0] - '0';

1443  
	`h¬d_to_i
();

1444 
	}
}

1449 
šlše
 
ušt64_t
 
	gJsÚ
::
	$to_u64
() const {

1450 ià(
_ty³
 =ğ
j_št
 && 
_¡r
.
	`Ëngth
() == 1)

1451  
_¡r
[0] - '0';

1453  
	`h¬d_to_u64
();

1454 
	}
}

1459 
šlše
 
	gJsÚ
::
	$as_i
() const {

1460 
	`as£¹
(
_ty³
 =ğ
j_št
 || _ty³ =ğ
j_doubË
);

1461 ià(
_¡r
.
	`Ëngth
() == 1)

1462  
_¡r
[0] - '0';

1464  
	`h¬d_as_i
();

1465 
	}
}

1467 #ià
HAVE_FLOAT_TYPES


1473 
šlše
 
boŞ
 
	gJsÚ
::
	$to_d
(&
x
) const {

1474 ià(
_ty³
 =ğ
j_doubË
 || _ty³ =ğ
j_št
) {

1475 
x
 = 
	`to_d
();

1476  
Œue
;

1478  
çl£
;

1479 
	}
}

1484 
šlše
 
	gJsÚ
::
	$as_d
() const {

1485 
	`as£¹
(
_ty³
 =ğ
j_doubË
 || _ty³ =ğ
j_št
);

1486  
	`to_d
();

1487 
	}
}

1497 
šlše
 
boŞ
 
	gJsÚ
::
	$to_b
() const {

1498 ià(
_ty³
 =ğ
j_boŞ
)

1499  
_¡r
[0] == 't';

1501  
	`h¬d_to_b
();

1502 
	}
}

1509 
šlše
 
boŞ
 
	gJsÚ
::
	$to_b
(
boŞ
 &
x
) const {

1510 ià(
_ty³
 =ğ
j_boŞ
) {

1511 
x
 = 
_¡r
[0] == 't';

1512  
Œue
;

1514  
çl£
;

1515 
	}
}

1520 
šlše
 
boŞ
 
	gJsÚ
::
	$as_b
() const {

1521 
	`as£¹
(
_ty³
 =ğ
j_boŞ
);

1522  
_¡r
[0] == 't';

1523 
	}
}

1532 
šlše
 cÚ¡ 
	gSŒšg
 &
	gJsÚ
::
	$to_s
() const {

1533 ià(
_ty³
 =ğ
j_¡ršg
)

1534  
_¡r
;

1536  
	`h¬d_to_s
();

1537 
	}
}

1544 
šlše
 
boŞ
 
	gJsÚ
::
	$to_s
(
SŒšg
 &
x
) const {

1545 ià(
_ty³
 =ğ
j_¡ršg
) {

1546 
x
 = 
_¡r
;

1547  
Œue
;

1549  
çl£
;

1550 
	}
}

1555 
šlše
 cÚ¡ 
	gSŒšg
 &
	gJsÚ
::
	$as_s
() const {

1556 
	`as£¹
(
_ty³
 =ğ
j_¡ršg
);

1557  
_¡r
;

1558 
	}
}

1561 
šlše
 cÚ¡ *
	gJsÚ
::
	$c_¡r
() const {

1562  
	`to_s
().
	`c_¡r
();

1563 
	}
}

1565 
šlše
 
	gJsÚ
::
	$fÜû_numb”
() {

1566 
	`as£¹
(
_ty³
 =ğ
j_nuÎ
 || _ty³ =ğ
j_št
 || _ty³ =ğ
j_doubË
);

1567 ià(
_ty³
 =ğ
j_nuÎ
) {

1568 
_ty³
 = 
j_št
;

1569 
_¡r
 = 
	`SŒšg
(0);

1571 
	}
}

1579 
šlše
 
	gJsÚ
::
size_ty³
 
JsÚ
::
	$couÁ
(cÚ¡ 
SŒšgRef
 &
key
) const {

1580 
	`as£¹
(
_ty³
 =ğ
j_nuÎ
 || _ty³ =ğ
j_objeù
);

1581  
_cjsÚ
 ? 
	`ojsÚ
()->
	`fšd
(
key
.
	`d©a
(), key.
	`Ëngth
()) >= 0 : 0;

1582 
	}
}

1589 
šlše
 cÚ¡ 
	gJsÚ
 &JsÚ::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
) const {

1590 
i
;

1591 
ObjeùJsÚ
 *
oj
;

1592 ià(
_ty³
 =ğ
j_objeù
 && (
oj
 = 
	`ojsÚ
())

1593 && (
i
 = 
oj
->
	`fšd
(
key
.
	`d©a
(), key.
	`Ëngth
())) >= 0)

1594  
oj
->
	`™em
(
i
).
v_
.
£cÚd
;

1596  
	`h¬d_g‘
(
key
);

1597 
	}
}

1604 
šlše
 
	gJsÚ
 &JsÚ::
	$g‘_š£¹
(cÚ¡ 
SŒšg
 &
key
) {

1605 
	`uniqueify_objeù
(
Œue
);

1606  
	`ojsÚ
()->
	`g‘_š£¹
(
key
);

1607 
	}
}

1610 
šlše
 
	gJsÚ
 &JsÚ::
	$g‘_š£¹
(cÚ¡ 
SŒšgRef
 &
key
) {

1611 
	`uniqueify_objeù
(
Œue
);

1612  
	`ojsÚ
()->
	`g‘_š£¹
(
key
);

1613 
	}
}

1616 
šlše
 
	gJsÚ
 &JsÚ::
	$g‘_š£¹
(cÚ¡ *
key
) {

1617 
	`uniqueify_objeù
(
Œue
);

1618  
	`ojsÚ
()->
	`g‘_š£¹
(
	`SŒšgRef
(
key
));

1619 
	}
}

1622 
šlše
 
	gJsÚ
::
	$g‘_i
(cÚ¡ 
SŒšgRef
 &
key
) const {

1623  
	`g‘
(
key
).
	`to_i
();

1624 
	}
}

1626 #ià
HAVE_FLOAT_TYPES


1628 
šlše
 
	gJsÚ
::
	$g‘_d
(cÚ¡ 
SŒšgRef
 &
key
) const {

1629  
	`g‘
(
key
).
	`to_d
();

1630 
	}
}

1634 
šlše
 
boŞ
 
	gJsÚ
::
	$g‘_b
(cÚ¡ 
SŒšgRef
 &
key
) const {

1635  
	`g‘
(
key
).
	`to_b
();

1636 
	}
}

1639 
šlše
 cÚ¡ 
	gSŒšg
 &
	gJsÚ
::
	$g‘_s
(cÚ¡ 
SŒšgRef
 &
key
) const {

1640  
	`g‘
(
key
).
	`to_s
();

1641 
	}
}

1685 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ
::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, 
JsÚ
 &
x
) const {

1686 
i
;

1687 
ObjeùJsÚ
 *
oj
;

1688 ià(
_ty³
 =ğ
j_objeù
 && (
oj
 = 
	`ojsÚ
())

1689 && (
i
 = 
oj
->
	`fšd
(
key
.
	`d©a
(), key.
	`Ëngth
())) >= 0) {

1690 
x
 = 
oj
->
	`™em
(
i
).
v_
.
£cÚd
;

1691  
	`JsÚ_g‘_´oxy
(*
this
, 
Œue
);

1693  
	`JsÚ_g‘_´oxy
(*
this
, 
çl£
);

1694 
	}
}

1697 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ
::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const {

1698  
	`JsÚ_g‘_´oxy
(*
this
, 
	`g‘
(
key
).
	`to_i
(
x
));

1699 
	}
}

1702 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ
::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const {

1703  
	`JsÚ_g‘_´oxy
(*
this
, 
	`g‘
(
key
).
	`to_i
(
x
));

1704 
	}
}

1707 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ
::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const {

1708  
	`JsÚ_g‘_´oxy
(*
this
, 
	`g‘
(
key
).
	`to_i
(
x
));

1709 
	}
}

1712 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ
::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const {

1713  
	`JsÚ_g‘_´oxy
(*
this
, 
	`g‘
(
key
).
	`to_i
(
x
));

1714 
	}
}

1716 #ià
HAVE_LONG_LONG


1718 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ
::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const {

1719  
	`JsÚ_g‘_´oxy
(*
this
, 
	`g‘
(
key
).
	`to_i
(
x
));

1720 
	}
}

1723 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ
::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const {

1724  
	`JsÚ_g‘_´oxy
(*
this
, 
	`g‘
(
key
).
	`to_i
(
x
));

1725 
	}
}

1728 #ià
HAVE_FLOAT_TYPES


1730 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ
::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, &
x
) const {

1731  
	`JsÚ_g‘_´oxy
(*
this
, 
	`g‘
(
key
).
	`to_d
(
x
));

1732 
	}
}

1736 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ
::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, 
boŞ
 &
x
) const {

1737  
	`JsÚ_g‘_´oxy
(*
this
, 
	`g‘
(
key
).
	`to_b
(
x
));

1738 
	}
}

1741 
šlše
 cÚ¡ 
JsÚ_g‘_´oxy
 
	gJsÚ
::
	$g‘
(cÚ¡ 
SŒšgRef
 &
key
, 
SŒšg
 &
x
) const {

1742  
	`JsÚ_g‘_´oxy
(*
this
, 
	`g‘
(
key
).
	`to_s
(
x
));

1743 
	}
}

1748 
šlše
 cÚ¡ 
	gJsÚ
 &JsÚ::
İ”©Ü
[](cÚ¡ 
SŒšgRef
 &
key
) const {

1749  
g‘
(
key
);

1758 
šlše
 
	gJsÚ_objeù_´oxy
<
	gJsÚ
> JsÚ::
İ”©Ü
[](cÚ¡ 
SŒšg
 &
key
) {

1759  
JsÚ_objeù_´oxy
<
JsÚ
>(*
this
, 
	gkey
);

1763 
šlše
 
	gJsÚ_objeù_¡r_´oxy
<
	gJsÚ
> JsÚ::
İ”©Ü
[](cÚ¡ 
SŒšgRef
 &
key
) {

1764  
JsÚ_objeù_¡r_´oxy
<
JsÚ
>(*
this
, 
	gkey
);

1768 
šlše
 
	gJsÚ_objeù_¡r_´oxy
<
	gJsÚ
> JsÚ::
İ”©Ü
[](cÚ¡ *
key
) {

1769  
JsÚ_objeù_¡r_´oxy
<
JsÚ
>(*
this
, 
	gkey
);

1774 
šlše
 cÚ¡ 
	gJsÚ
 &JsÚ::
	$©
(cÚ¡ 
SŒšgRef
 &
key
) const {

1775 
	`as£¹
(
_ty³
 =ğ
j_objeù
 && 
_cjsÚ
);

1776 
ObjeùJsÚ
 *
oj
 = 
	`ojsÚ
();

1777 
i
 = 
oj
->
	`fšd
(
key
.
	`d©a
(), key.
	`Ëngth
());

1778 
	`as£¹
(
i
 >= 0);

1779  
oj
->
	`™em
(
i
).
v_
.
£cÚd
;

1780 
	}
}

1786 
šlše
 
	gJsÚ
 &JsÚ::
	$©_š£¹
(cÚ¡ 
SŒšg
 &
key
) {

1787 
	`as£¹
(
_ty³
 =ğ
j_objeù
);

1788  
	`g‘_š£¹
(
key
);

1789 
	}
}

1792 
šlše
 
	gJsÚ
 &JsÚ::
	$©_š£¹
(cÚ¡ 
SŒšgRef
 &
key
) {

1793 
	`as£¹
(
_ty³
 =ğ
j_objeù
);

1794  
	`g‘_š£¹
(
key
);

1795 
	}
}

1798 
šlše
 
	gJsÚ
 &JsÚ::
	$©_š£¹
(cÚ¡ *
key
) {

1799 
	`as£¹
(
_ty³
 =ğ
j_objeù
);

1800  
	`g‘_š£¹
(
	`SŒšgRef
(
key
));

1801 
	}
}

1808 
	g‹m¶©e
 <
ty³Çme
 
	gT
> 
šlše
 
	gJsÚ
 &JsÚ::
	$£t
(cÚ¡ 
SŒšg
 &
key
, 
T
 
v®ue
) {

1809 
	`uniqueify_objeù
(
Œue
);

1810 
	`ojsÚ
()->
	`g‘_š£¹
(
key
èğ
	`JsÚ
(
v®ue
);

1811  *
this
;

1812 
	}
}

1814 #ià
HAVE_CXX_RVALUE_REFERENCES


1816 
šlše
 
	gJsÚ
 &JsÚ::
	$£t
(cÚ¡ 
SŒšg
 &
key
, 
JsÚ
 &&
v®ue
) {

1817 
	`uniqueify_objeù
(
Œue
);

1818 
	`ojsÚ
()->
	`g‘_š£¹
(
key
èğ
	`şick_move
(
v®ue
);

1819  *
this
;

1820 
	}
}

1826 
šlše
 
	gJsÚ
 &JsÚ::
	$un£t
(cÚ¡ 
SŒšgRef
 &
key
) {

1827 ià(
_ty³
 =ğ
j_objeù
) {

1828 
	`uniqueify_objeù
(
Œue
);

1829 
	`ojsÚ
()->
	`”a£
(
key
);

1831  *
this
;

1832 
	}
}

1841 
šlše
 
	gPaœ
<
	gJsÚ
::
objeù_™”©Ü
, 
	gboŞ
> JsÚ::
	$š£¹
(cÚ¡ 
objeù_v®ue_ty³
 &
x
) {

1842 
	`as£¹
(
_ty³
 =ğ
j_objeù
);

1843 
	`uniqueify_objeù
(
çl£
);

1844 
ObjeùJsÚ
 *
oj
 = 
	`ojsÚ
();

1845 
n
 = 
oj
->
n_
, 
i
 = oj->
	`fšd_š£¹
(
x
.
fœ¡
, x.
£cÚd
);

1846  
	`make_·œ
(
	`objeù_™”©Ü
(
this
, 
i
), i =ğ
n
);

1847 
	}
}

1857 
šlše
 
	gJsÚ
::
objeù_™”©Ü
 
JsÚ
::
	$š£¹
(
objeù_™”©Ü
 
pos™iÚ
, cÚ¡ 
objeù_v®ue_ty³
 &
x
) {

1858 (è
pos™iÚ
;

1859  
	`š£¹
(
x
).
fœ¡
;

1860 
	}
}

1865 
šlše
 
	gJsÚ
::
size_ty³
 
JsÚ
::
	$”a£
(cÚ¡ 
SŒšgRef
 &
key
) {

1866 
	`as£¹
(
_ty³
 =ğ
j_objeù
);

1867 
	`uniqueify_objeù
(
çl£
);

1868  
	`ojsÚ
()->
	`”a£
(
key
);

1869 
	}
}

1878 
šlše
 
	gJsÚ
 &JsÚ::
	$m”ge
(cÚ¡ 
JsÚ
 &
x
) {

1879 
	`as£¹
(
_ty³
 =ğ
j_objeù
 || _ty³ =ğ
j_nuÎ
);

1880 
	`as£¹
(
x
.
_ty³
 =ğ
j_objeù
 || x._ty³ =ğ
j_nuÎ
);

1881 ià(
x
.
_cjsÚ
) {

1882 
	`uniqueify_objeù
(
çl£
);

1883 
ObjeùJsÚ
 *
oj
 = 
	`ojsÚ
(), *
xoj
 = 
x
.ojson();

1884 cÚ¡ 
ObjeùI‹m
 *
xb
 = 
xoj
->
os_
, *
xe
 = xb + xoj->
n_
;

1885 ; 
xb
 !ğ
xe
; ++xb)

1886 ià(
xb
->
Ãxt_
 > -2)

1887 
oj
->
	`g‘_š£¹
(
xb
->
v_
.
fœ¡
èğxb->v_.
£cÚd
;

1889  *
this
;

1890 
	}
}

1893 
	g‹m¶©e
 <
ty³Çme
 
	gU
>

1894 
šlše
 
	gJsÚ
 &JsÚ::
m”ge
(cÚ¡ 
JsÚ_´oxy_ba£
<
U
> &
x
) {

1895  
m”ge
(
x
.
cv®ue
());

1907 
šlše
 cÚ¡ 
	gJsÚ
 &JsÚ::
	$g‘
(
size_ty³
 
x
) const {

1908 
A¼ayJsÚ
 *
aj
;

1909 ià(
_ty³
 =ğ
j_¬¿y
 && (
aj
 = 
	`ajsÚ
())

1910 && 
JsÚVeùÜ
::
	`size_ty³
(
x
è< 
aj
->
v®ues
.
	`size
())

1911  
aj
->
v®ues
[
x
];

1913  
	`h¬d_g‘
(
x
);

1914 
	}
}

1921 
šlše
 
	gJsÚ
 &JsÚ::
	$g‘_š£¹
(
size_ty³
 
x
) {

1922 
A¼ayJsÚ
 *
aj
;

1923 ià(
_ty³
 =ğ
j_¬¿y
 && (
aj
 = 
	`ajsÚ
()è&&‡j->
»fcouÁ
 == 1

1924 && 
JsÚVeùÜ
::
	`size_ty³
(
x
è< 
aj
->
v®ues
.
	`size
())

1925  
aj
->
v®ues
[
x
];

1927  
	`h¬d_g‘_š£¹
(
x
);

1928 
	}
}

1934 
šlše
 cÚ¡ 
	gJsÚ
 &JsÚ::
	$©
(
size_ty³
 
x
) const {

1935 
	`as£¹
(
_ty³
 =ğ
j_¬¿y
);

1936  
	`g‘
(
x
);

1937 
	}
}

1943 
šlše
 
	gJsÚ
 &JsÚ::
	$©_š£¹
(
size_ty³
 
x
) {

1944 
	`as£¹
(
_ty³
 =ğ
j_¬¿y
);

1945  
	`g‘_š£¹
(
x
);

1946 
	}
}

1953 
šlše
 cÚ¡ 
	gJsÚ
 &JsÚ::
İ”©Ü
[](
size_ty³
 
x
) const {

1954  
g‘
(
x
);

1964 
šlše
 
	gJsÚ_¬¿y_´oxy
<
	gJsÚ
> JsÚ::
İ”©Ü
[](
size_ty³
 
x
) {

1965  
JsÚ_¬¿y_´oxy
<
JsÚ
>(*
this
, 
	gx
);

1970 
šlše
 cÚ¡ 
	gJsÚ
 &JsÚ::
	$back
() const {

1971 
	`as£¹
(
_ty³
 =ğ
j_¬¿y
 && 
_cjsÚ
 && 
	`ajsÚ
()->
v®ues
.
	`size
() > 0);

1972  
	`ajsÚ
()->
v®ues
.
	`back
();

1973 
	}
}

1977 
šlše
 
	gJsÚ
 &JsÚ::
	$back
() {

1978 
	`as£¹
(
_ty³
 =ğ
j_¬¿y
 && 
_cjsÚ
 && 
	`ajsÚ
()->
v®ues
.
	`size
() > 0);

1979 
	`uniqueify_¬¿y
(
çl£
);

1980  
	`ajsÚ
()->
v®ues
.
	`back
();

1981 
	}
}

1988 
	g‹m¶©e
 <
ty³Çme
 
	gT
> 
šlše
 
	gJsÚ
 &JsÚ::
	$push_back
(
T
 
x
) {

1989 
	`uniqueify_¬¿y
(
çl£
);

1990 
	`ajsÚ
()->
v®ues
.
	`push_back
(
	`JsÚ
(
x
));

1991  *
this
;

1992 
	}
}

1994 #ià
HAVE_CXX_RVALUE_REFERENCES


1996 
šlše
 
	gJsÚ
 &JsÚ::
	$push_back
(
JsÚ
 &&
x
) {

1997 
	`uniqueify_¬¿y
(
çl£
);

1998 
	`ajsÚ
()->
v®ues
.
	`push_back
(
	`şick_move
(
x
));

1999  *
this
;

2000 
	}
}

2005 
	gJsÚ
::
	$pİ_back
() {

2006 
	`as£¹
(
_ty³
 =ğ
j_¬¿y
 && 
_cjsÚ
 && 
	`ajsÚ
()->
v®ues
.
	`size
() > 0);

2007 
	`uniqueify_¬¿y
(
çl£
);

2008 
	`ajsÚ
()->
v®ues
.
	`pİ_back
();

2009 
	}
}

2012 
šlše
 
	gJsÚ
::
cÚ¡_objeù_™”©Ü
 
JsÚ
::
	$cobegš
() const {

2013 
	`as£¹
(
_ty³
 =ğ
j_nuÎ
 || _ty³ =ğ
j_objeù
);

2014  
	`cÚ¡_objeù_™”©Ü
(
this
, 0);

2015 
	}
}

2017 
šlše
 
	gJsÚ
::
cÚ¡_objeù_™”©Ü
 
JsÚ
::
	$cÛnd
() const {

2018 
	`as£¹
(
_ty³
 =ğ
j_nuÎ
 || _ty³ =ğ
j_objeù
);

2019  
	`cÚ¡_objeù_™”©Ü
(
this
, -1);

2020 
	}
}

2022 
šlše
 
	gJsÚ
::
cÚ¡_objeù_™”©Ü
 
JsÚ
::
	$obegš
() const {

2023  
	`cobegš
();

2024 
	}
}

2026 
šlše
 
	gJsÚ
::
cÚ¡_objeù_™”©Ü
 
JsÚ
::
	$Ûnd
() const {

2027  
	`cÛnd
();

2028 
	}
}

2030 
šlše
 
	gJsÚ
::
objeù_™”©Ü
 
JsÚ
::
	$obegš
() {

2031 
	`as£¹
(
_ty³
 =ğ
j_nuÎ
 || _ty³ =ğ
j_objeù
);

2032  
	`objeù_™”©Ü
(
this
, 0);

2033 
	}
}

2035 
šlše
 
	gJsÚ
::
objeù_™”©Ü
 
JsÚ
::
	$Ûnd
() {

2036 
	`as£¹
(
_ty³
 =ğ
j_nuÎ
 || _ty³ =ğ
j_objeù
);

2037  
	`objeù_™”©Ü
(
this
, -1);

2038 
	}
}

2040 
šlše
 
	gJsÚ
::
cÚ¡_¬¿y_™”©Ü
 
JsÚ
::
	$ÿbegš
() const {

2041 
	`as£¹
(
_ty³
 =ğ
j_nuÎ
 || _ty³ =ğ
j_¬¿y
);

2042  
	`cÚ¡_¬¿y_™”©Ü
(
this
, 0);

2043 
	}
}

2045 
šlše
 
	gJsÚ
::
cÚ¡_¬¿y_™”©Ü
 
JsÚ
::
	$ÿ’d
() const {

2046 
	`as£¹
(
_ty³
 =ğ
j_nuÎ
 || _ty³ =ğ
j_¬¿y
);

2047 
A¼ayJsÚ
 *
aj
 = 
	`ajsÚ
();

2048  
	`cÚ¡_¬¿y_™”©Ü
(
this
, 
aj
 ?‡j->
v®ues
.
	`size
() : 0);

2049 
	}
}

2051 
šlše
 
	gJsÚ
::
cÚ¡_¬¿y_™”©Ü
 
JsÚ
::
	$abegš
() const {

2052  
	`ÿbegš
();

2053 
	}
}

2055 
šlše
 
	gJsÚ
::
cÚ¡_¬¿y_™”©Ü
 
JsÚ
::
	$«nd
() const {

2056  
	`ÿ’d
();

2057 
	}
}

2059 
šlše
 
	gJsÚ
::
¬¿y_™”©Ü
 
JsÚ
::
	$abegš
() {

2060 
	`as£¹
(
_ty³
 =ğ
j_nuÎ
 || _ty³ =ğ
j_¬¿y
);

2061  
	`¬¿y_™”©Ü
(
this
, 0);

2062 
	}
}

2064 
šlše
 
	gJsÚ
::
¬¿y_™”©Ü
 
JsÚ
::
	$«nd
() {

2065 
	`as£¹
(
_ty³
 =ğ
j_nuÎ
 || _ty³ =ğ
j_¬¿y
);

2066 
A¼ayJsÚ
 *
aj
 = 
	`ajsÚ
();

2067  
	`¬¿y_™”©Ü
(
this
, 
aj
 ?‡j->
v®ues
.
	`size
() : 0);

2068 
	}
}

2070 
šlše
 
	gJsÚ
::
cÚ¡_™”©Ü
 
JsÚ
::
	$cbegš
() const {

2071  
	`cÚ¡_™”©Ü
(
this
, 0);

2072 
	}
}

2074 
šlše
 
	gJsÚ
::
cÚ¡_™”©Ü
 
JsÚ
::
	$ûnd
() const {

2075  
	`cÚ¡_™”©Ü
(
this
, -1);

2076 
	}
}

2078 
šlše
 
	gJsÚ
::
™”©Ü
 
JsÚ
::
	$begš
() {

2079  
	`™”©Ü
(
this
, 0);

2080 
	}
}

2082 
šlše
 
	gJsÚ
::
™”©Ü
 
JsÚ
::
	$’d
() {

2083  
	`™”©Ü
(
this
, -1);

2084 
	}
}

2086 
šlše
 
	gJsÚ
::
cÚ¡_™”©Ü
 
JsÚ
::
	$begš
() const {

2087  
	`cbegš
();

2088 
	}
}

2090 
šlše
 
	gJsÚ
::
cÚ¡_™”©Ü
 
JsÚ
::
	$’d
() const {

2091  
	`ûnd
();

2092 
	}
}

2096 
	gJsÚ
::
uÅ¬£_mªuÏtÜ
 {

2097 
uÅ¬£_mªuÏtÜ
()

2098 : 
_šd’t_d•th
(0), 
_b_width
(8) {

2100 
šd’t_d•th
() const {

2101  
	g_šd’t_d•th
;

2103 
uÅ¬£_mªuÏtÜ
 
šd’t_d•th
(
x
) const {

2104 
uÅ¬£_mªuÏtÜ
 
m
(*
this
);

2105 
	gm
.
	g_šd’t_d•th
 = 
x
;

2106  
	gm
;

2108 
b_width
() const {

2109  
	g_b_width
;

2111 
uÅ¬£_mªuÏtÜ
 
b_width
(
x
) const {

2112 
uÅ¬£_mªuÏtÜ
 
m
(*
this
);

2113 
	gm
.
	g_b_width
 = 
x
;

2114  
	gm
;

2116 
	g´iv©e
:

2117 
_šd’t_d•th
;

2118 
	g_b_width
;

2121 
šlše
 
	gJsÚ
::
uÅ¬£_mªuÏtÜ
 
JsÚ
::
	$šd’t_d•th
(
x
) {

2122  
	`uÅ¬£_mªuÏtÜ
().
	`šd’t_d•th
(
x
);

2123 
	}
}

2124 
šlše
 
	gJsÚ
::
uÅ¬£_mªuÏtÜ
 
JsÚ
::
	$b_width
(
x
) {

2125  
	`uÅ¬£_mªuÏtÜ
().
	`b_width
(
x
);

2126 
	}
}

2129 
šlše
 
SŒšg
 
	gJsÚ
::
	$uÅ¬£
() const {

2130  
	`uÅ¬£
(
çl£
);

2131 
	}
}

2135 
šlše
 
SŒšg
 
	gJsÚ
::
	$uÅ¬£
(
boŞ
 
add_Ãwlše
) const {

2136 
SŒšgAccum
 
§
;

2137 
	`uÅ¬£
(
§
);

2138 ià(
add_Ãwlše
)

2139 
§
 << '\n';

2140  
§
.
	`ke_¡ršg
();

2141 
	}
}

2144 
šlše
 
	gJsÚ
::
	$uÅ¬£
(
SŒšgAccum
 &
§
, cÚ¡ 
uÅ¬£_mªuÏtÜ
 &
m
) const {

2145 
	`h¬d_uÅ¬£
(
§
, 
m
, 0);

2146 
	}
}

2150 
šlše
 
SŒšg
 
	gJsÚ
::
	$uÅ¬£
(cÚ¡ 
uÅ¬£_mªuÏtÜ
 &
m
,

2151 
boŞ
 
add_Ãwlše
) const {

2152 
SŒšgAccum
 
§
;

2153 
	`h¬d_uÅ¬£
(
§
, 
m
, 0);

2154 ià(
add_Ãwlše
)

2155 
§
 << '\n';

2156  
§
.
	`ke_¡ršg
();

2157 
	}
}

2166 
šlše
 
boŞ
 
	gJsÚ
::
	$assign_·r£
(cÚ¡ 
SŒšg
 &
¡r
) {

2167  
	`assign_·r£
(
¡r
, sŒ.
	`begš
(), sŒ.
	`’d
());

2168 
	}
}

2174 
šlše
 
boŞ
 
	gJsÚ
::
	$assign_·r£
(cÚ¡ *
fœ¡
, cÚ¡ *
Ï¡
) {

2175  
	`assign_·r£
(
	`SŒšg
(), 
fœ¡
, 
Ï¡
);

2176 
	}
}

2181 
šlše
 
JsÚ
 
	gJsÚ
::
	$·r£
(cÚ¡ 
SŒšg
 &
¡r
) {

2182 
JsÚ
 
j
;

2183 (è
j
.
	`assign_·r£
(
¡r
);

2184  
j
;

2185 
	}
}

2190 
šlše
 
JsÚ
 
	gJsÚ
::
	$·r£
(cÚ¡ *
fœ¡
, cÚ¡ *
Ï¡
) {

2191 
JsÚ
 
j
;

2192 (è
j
.
	`assign_·r£
(
fœ¡
, 
Ï¡
);

2193  
j
;

2194 
	}
}

2199 
šlše
 
	gJsÚ
 &JsÚ::
İ”©Ü
=(cÚ¡ 
JsÚ
 &
x
) {

2200 
_¡r
 = 
x
._str;

2201 ià(
	g_cjsÚ
 !ğ
x
.
_cjsÚ
) {

2202 ià(
_cjsÚ
)

2203 
_cjsÚ
->
d”ef
(
_ty³
);

2204 
	g_cjsÚ
 = 
x
.
_cjsÚ
;

2205 ià(
	g_cjsÚ
)

2206 
	g_cjsÚ
->
»f
();

2208 
	g_ty³
 = 
x
.
_ty³
;

2209  *
	gthis
;

2212 #ià
HAVE_CXX_RVALUE_REFERENCES


2213 
šlše
 
	gJsÚ
 &JsÚ::
İ”©Ü
=(
JsÚ
 &&
x
) {

2214 
_ty³
 = 
x
._type;

2215 
	g_¡r
 = 
şick_move
(
x
.
_¡r
);

2216 
	g_cjsÚ
 = 
x
.
_cjsÚ
;

2217 
	gx
.
	g_cjsÚ
 = 0;

2218  *
	gthis
;

2223 
	g‹m¶©e
 <
ty³Çme
 
	gU
>

2224 
šlše
 
	gJsÚ
 &JsÚ::
İ”©Ü
=(cÚ¡ 
JsÚ_´oxy_ba£
<
U
> &
x
) {

2225  *
this
 = 
x
.
cv®ue
();

2229 
šlše
 
	gJsÚ
 &JsÚ::
İ”©Ü
++() {

2230  *
this
 += 1;

2232 
šlše
 
	gJsÚ
::
İ”©Ü
++() {

2233 ++(*
this
);

2235 
šlše
 
	gJsÚ
 &JsÚ::
İ”©Ü
--() {

2236  *
this
 += -1;

2238 
šlše
 
	gJsÚ
::
İ”©Ü
--() {

2239 --(*
this
);

2241 
šlše
 
	gJsÚ
 &JsÚ::
İ”©Ü
+=(
x
) {

2242 
fÜû_numb”
();

2243 #ià
HAVE_FLOAT_TYPES


2244 ià(
	g_ty³
 =ğ
j_št
)

2245 
_¡r
 = 
SŒšg
(
as_i
(è+ 
x
);

2247 
	g_¡r
 = 
SŒšg
(
as_d
(è+ 
x
);

2249 
	g_¡r
 = 
SŒšg
(
as_i
(è+ 
x
);

2251  *
	gthis
;

2253 
šlše
 
	gJsÚ
 &JsÚ::
İ”©Ü
+=(
x
) {

2254 
fÜû_numb”
();

2255 #ià
HAVE_FLOAT_TYPES


2256 ià(
	g_ty³
 =ğ
j_št
)

2257 
_¡r
 = 
SŒšg
(
as_i
(è+ 
x
);

2259 
	g_¡r
 = 
SŒšg
(
as_d
(è+ 
x
);

2261 
	g_¡r
 = 
SŒšg
(
as_i
(è+ 
x
);

2263  *
	gthis
;

2265 #ià
HAVE_FLOAT_TYPES


2266 
šlše
 
	gJsÚ
 &JsÚ::
İ”©Ü
+=(
x
) {

2267 
fÜû_numb”
();

2268 
	g_¡r
 = 
SŒšg
(
as_d
(è+ 
x
);

2269  *
	gthis
;

2274 
šlše
 
	gJsÚ
::
	$sw­
(
JsÚ
 &
x
) {

2275 
	`şick_sw­
(
_ty³
, 
x
._type);

2276 
_¡r
.
	`sw­
(
x
._str);

2277 
	`şick_sw­
(
_cjsÚ
, 
x
._cjson);

2278 
	}
}

2281 
šlše
 
	gSŒšgAccum
 &
	gİ”©Ü
<<(SŒšgAccum &
	g§
, cÚ¡ 
	gJsÚ
 &
	gjsÚ
) {

2282 
	gjsÚ
.
uÅ¬£
(
§
);

2283  
	g§
;

2286 
šlše
 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
JsÚ
 &
a
, cÚ¡ 
	gJsÚ
 &
	gb
) {

2287  
	ga
.
ty³
(è=ğ
b
.type()

2288 && (
a
.
is_´im™ive
(è?‡.
_¡r
 =ğ
b
._¡¸:‡.
_cjsÚ
 == b._cjson);

2291 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

2292 
šlše
 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
JsÚ_´oxy_ba£
<
T
> &
a
, cÚ¡ 
	gJsÚ
 &
	gb
) {

2293  
	ga
.
cv®ue
(è=ğ
b
;

2296 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

2297 
šlše
 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
JsÚ
 &
a
, cÚ¡ 
	gJsÚ_´oxy_ba£
<
	gT
> &
	gb
) {

2298  
	ga
 =ğ
b
.
cv®ue
();

2301 
	g‹m¶©e
 <
ty³Çme
 
	gT
,y³Çm
	gU
>

2302 
šlše
 
boŞ
 
	gİ”©Ü
==(cÚ¡ 
JsÚ_´oxy_ba£
<
T
> &
a
,

2303 cÚ¡ 
	gJsÚ_´oxy_ba£
<
	gU
> &
	gb
) {

2304  
	ga
.
cv®ue
(è=ğ
b
.cvalue();

2307 
šlše
 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
JsÚ
 &
a
, cÚ¡ 
	gJsÚ
 &
	gb
) {

2308  !(
	ga
 =ğ
b
);

2311 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

2312 
šlše
 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
JsÚ_´oxy_ba£
<
T
> &
a
, cÚ¡ 
	gJsÚ
 &
	gb
) {

2313  !(
	ga
 =ğ
b
);

2316 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

2317 
šlše
 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
JsÚ
 &
a
, cÚ¡ 
	gJsÚ_´oxy_ba£
<
	gT
> &
	gb
) {

2318  !(
	ga
 =ğ
b
);

2321 
	g‹m¶©e
 <
ty³Çme
 
	gT
,y³Çm
	gU
>

2322 
šlše
 
boŞ
 
	gİ”©Ü
!=(cÚ¡ 
JsÚ_´oxy_ba£
<
T
> &
a
,

2323 cÚ¡ 
	gJsÚ_´oxy_ba£
<
	gU
> &
	gb
) {

2324  !(
	ga
 =ğ
b
);

2327 
	gCLICK_ENDDECLS


	@linuxmodule/anydevice.cc

22 
	~<şick/cÚfig.h
>

23 
	~<şick/glue.hh
>

24 
	~"ªydeviû.hh
"

25 
	~"äomdeviû.hh
"

26 
	~<şick/¬gs.hh
>

27 
	~<şick/”rÜ.hh
>

28 
	~<şick/hªdËrÿÎ.hh
>

29 
	~<şickÃt/‘h”.h
>

30 
	~<şick/‘h”add»ss.hh
>

31 
	~<şick/¡ªd¬d/add»ssšfo.hh
>

32 
	~<şick/cxx´Ùeù.h
>

33 
	gCLICK_CXX_PROTECT


34 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 0)

35 
	~<lšux/if_¬p.h
>

37 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 24)

38 
	~<lšux/¹Ãšk.h
>

39 
	~<Ãt/Ãt_Çme¥aû.h
>

41 
	gCLICK_CXX_UNPROTECT


42 
	~<şick/cxxuÅrÙeù.h
>

44 #ià
CLICK_DEVICE_UNRECEIVABLE_SK_BUFF


46 
DEFINE_PER_CPU
(
sk_buff
 *, 
şick_deviû_uÄeûivabË_sk_buff
);

50 
AnyDeviû
::
	$AnyDeviû
()

51 : 
	`_dev
(0), 
	`_´omisc
(
çl£
), 
	`_time¡amp
(
Œue
), 
	`_š_m­
(false),

52 
	`_qu›t
(
çl£
), 
	`_®low_nÚexi¡’t
(çl£), 
	`_devÇme_exi¡s
(false),

53 
	`_ÿ¼›r_ok
(
çl£
), 
	`_Ãxt
(0), 
	`_up_ÿÎ
(0), 
	$_down_ÿÎ
(0)

55 
	}
}

57 
AnyDeviû
::~
	$AnyDeviû
()

59 ià(
_š_m­
 || 
_dev
)

60 
	`şick_ch©‹r
("%s: bad deviû de¡ruùÜ!", 
	`Çme
().
	`c_¡r
());

61 
d–‘e
 
_up_ÿÎ
;

62 
d–‘e
 
_down_ÿÎ
;

63 
	}
}

66 
AnyDeviû
::
cÚfigu»_keywÜds
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
,

67 
boŞ
 
is_»ad”
)

69 
boŞ
 
®low_nÚexi¡’t
 = 
_®low_nÚexi¡’t
;

70 
boŞ
 
qu›t
 = 
_qu›t
;

71 
boŞ
 
´omisc
 = 
_´omisc
;

72 
boŞ
 
time¡amp
 = 
_time¡amp
;

73 
HªdËrC®l
 
up_ÿÎ
, 
down_ÿÎ
;

75 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

76 .
»ad
("UP_CALL", 
HªdËrC®lArg
(
HªdËrC®l
::
wr™abË
), 
up_ÿÎ
)

77 .
»ad
("DOWN_CALL", 
HªdËrC®lArg
(
HªdËrC®l
::
wr™abË
), 
down_ÿÎ
)

78 .
»ad
("ALLOW_NONEXISTENT", 
®low_nÚexi¡’t
)

79 .
»ad
("QUIET", 
qu›t
)

80 .
cÚsume
() < 0)

82 ià(
is_»ad”
 && (
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

83 .
»ad
("PROMISC", 
´omisc
)

84 .
»ad
("TIMESTAMP", 
time¡amp
)

85 .
cÚsume
() < 0))

88 
_®low_nÚexi¡’t
 = 
®low_nÚexi¡’t
;

89 
_qu›t
 = 
qu›t
;

90 
_´omisc
 = 
´omisc
;

91 
_time¡amp
 = 
time¡amp
;

92 
d–‘e
 
_up_ÿÎ
;

93 
_up_ÿÎ
 = 
up_ÿÎ
 ? 
Ãw
 
HªdËrC®l
(up_call) : 0;

94 
d–‘e
 
_down_ÿÎ
;

95 
_down_ÿÎ
 = 
down_ÿÎ
 ? 
Ãw
 
HªdËrC®l
(down_call) : 0;

100 
AnyDeviû
::
	$š™Ÿlize_keywÜds
(
E¼ÜHªdËr
 *
”rh
)

102 ià((
_up_ÿÎ
 && _up_ÿÎ->
	`š™Ÿlize_wr™e
(
this
, 
”rh
) < 0)

103 || (
_down_ÿÎ
 && _down_ÿÎ->
	`š™Ÿlize_wr™e
(
this
, 
”rh
) < 0))

105 ià(
_up_ÿÎ
 && 
_ÿ¼›r_ok
)

106 
_up_ÿÎ
->
	`ÿÎ_wr™e
(
”rh
);

107 ià(
_down_ÿÎ
 && !
_ÿ¼›r_ok
)

108 
_down_ÿÎ
->
	`ÿÎ_wr™e
(
”rh
);

110 
	}
}

113 
AnyDeviû
::
	$®‹r_´omiscu™y
(
d–
)

115 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 24)

116 
	`¹Æ_lock
();

117 
	`dev_£t_´omiscu™y
(
_dev
, 
d–
);

118 
	`¹Æ_uÆock
();

120 
	`dev_£t_´omiscu™y
(
_dev
, 
d–
);

122 
	}
}

125 
AnyDeviû
::
	$®‹r_äom_deviû
(
d–
)

127 #ià
HAVE_CLICK_KERNEL


128 (è
d–
;

129 #–ià
CLICK_FROMDEVICE_USE_BRIDGE


130 ià(!
_dev
)

132 
çke_bridge
 *
fb
 = 
»š‹½»t_ÿ¡
<çke_bridg*>(
_dev
->
br_pÜt
);

133 ià(
fb
 && fb->
magic
 !ğ
çke_bridge
::
şick_magic
)

134 
	`´štk
("<1>%s:‡µ—r tØbowÃd byhbridgmoduË!", 
_devÇme
.
	`c_¡r
());

135 ià(
d–
 < 0 && 
fb
 && 
	`©omic_dec_ªd_‹¡
(&fb->
»fcouÁ
)) {

136 
d–‘e
 
fb
;

137 
	`rcu_assign_poš‹r
(
_dev
->
br_pÜt
, 
NULL
);

138 } ià(
d–
 > 0 && !
fb
) {

139 
fb
 = 
Ãw
 
çke_bridge
;

140 
fb
->
magic
 = 
çke_bridge
::
şick_magic
;

141 
	`©omic_£t
(&
fb
->
»fcouÁ
, 1);

142 
	`rcu_assign_poš‹r
(
_dev
->
br_pÜt
, 
»š‹½»t_ÿ¡
<
Ãt_bridge_pÜt
 *>(
fb
));

143 } ià(
d–
 > 0)

144 
	`©omic_šc
(&
fb
->
»fcouÁ
);

145 #–ià
HAVE_LINUX_NETDEV_RX_HANDLER_REGISTER


146 ià(!
_dev
)

148 
	`¹Æ_lock
();

149 ià(
_dev
->
rx_hªdËr
 && _dev->rx_hªdË¸!ğ
şick_äomdeviû_rx_hªdËr
)

150 
	`´štk
("<1>%s:„x_hªdË¸®»ady s‘!", 
_devÇme
.
	`c_¡r
());

151 ià(
d–
 < 0 && !
_dev
->
rx_hªdËr_d©a
)

152 
	`Ãtdev_rx_hªdËr_uÄegi¡”
(
_dev
);

153 ià(
d–
 > 0 && !
_dev
->
rx_hªdËr
)

154 
	`Ãtdev_rx_hªdËr_»gi¡”
(
_dev
, 
şick_äomdeviû_rx_hªdËr
, 0);

156 
_dev
->
rx_hªdËr_d©a
 = (*è((
ušŒ_t
è_dev->rx_hªdËr_d©¨+ 
d–
);

157 
	`¹Æ_uÆock
();

159 (è
d–
;

161 
	}
}

163 
Ãt_deviû
 *

164 
AnyDeviû
::
	$lookup_deviû
(
E¼ÜHªdËr
 *
”rh
)

166 
Ãt_deviû
 *
dev
 = 
	`g‘_by_Çme
(
_devÇme
.
	`c_¡r
());

167 
_devÇme_exi¡s
 = (
boŞ
è
dev
;

168 ià(!
dev
)

169 
dev
 = 
	`g‘_by_‘h”_add»ss
(
_devÇme
, 
this
);

171 ià(!
dev
 && !
_®low_nÚexi¡’t
)

172 
”rh
->
	`”rÜ
("unknowÀdeviû %<%s%>", 
_devÇme
.
	`c_¡r
());

173 ià(!
dev
 && !
_qu›t
)

174 
”rh
->
	`w¬nšg
("unknowÀdeviû %<%s%>", 
_devÇme
.
	`c_¡r
());

175 ià(
dev
 && !(dev->
æags
 & 
IFF_UP
)) {

176 ià(!
_qu›t
)

177 
”rh
->
	`w¬nšg
("deviû %<%s%> i down", 
_devÇme
.
	`c_¡r
());

178 
	`dev_put
(
dev
);

179 
dev
 = 0;

181  
dev
;

182 
	}
}

185 
AnyDeviû
::
	$£t_deviû
(
Ãt_deviû
 *
dev
, 
AnyDeviûM­
 *
adm
, 
æags
)

187 ià(!
dev
 && !
_dev
 && !
_š_m­
 && 
adm
) {

188 
adm
->
	`š£¹
(
this
, 
æags
 & 
ªydev_chªge
);

192 ià(
_dev
 =ğ
dev
) {

193 
boŞ
 
ÿ¼›r_ok
 = (
_dev
 && 
	`Ãtif_ÿ¼›r_ok
(_dev));

194 ià(
ÿ¼›r_ok
 !ğ
_ÿ¼›r_ok
) {

195 
_ÿ¼›r_ok
 = 
ÿ¼›r_ok
;

196 ià(
_down_ÿÎ
 && !
_ÿ¼›r_ok
 && (
æags
 & 
ªydev_chªge
))

197 
_down_ÿÎ
->
	`ÿÎ_wr™e
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

198 ià(
_up_ÿÎ
 && 
_ÿ¼›r_ok
 && (
æags
 & 
ªydev_chªge
))

199 
_up_ÿÎ
->
	`ÿÎ_wr™e
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

205 ià(
_dev
) {

206 ià(
_down_ÿÎ
 && 
_ÿ¼›r_ok
 && (
æags
 & 
ªydev_chªge
))

207 
_down_ÿÎ
->
	`ÿÎ_wr™e
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

208 ià(!
_down_ÿÎ
 && !
_qu›t
)

209 
	`şick_ch©‹r
("%s: deviû %<%s%> w’ˆdown", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_devÇme
.c_str());

212 
	`ş—r_deviû
(
adm
, 
æags
);

214 
_dev
 = 
dev
;

215 ià(
_dev
 && (
æags
 & 
ªydev_chªge
))

216 
	`dev_hŞd
(
_dev
);

217 ià(
adm
)

218 
adm
->
	`š£¹
(
this
, 
æags
 & 
ªydev_chªge
);

220 ià(
_dev
 && 
_´omisc
)

221 
	`®‹r_´omiscu™y
(1);

222 #ià
HAVE_NET_ENABLE_TIMESTAMP


223 ià(
_dev
 && 
_time¡amp
)

224 
	`Ãt_’abË_time¡amp
();

226 ià(
_dev
 && (
æags
 & 
ªydev_äom_deviû
))

227 
	`®‹r_äom_deviû
(1);

228 
_ÿ¼›r_ok
 = (
_dev
 && 
	`Ãtif_ÿ¼›r_ok
(_dev));

231 ià(
_dev
 && (
æags
 & 
ªydev_chªge
)) {

232 ià(
_up_ÿÎ
 && 
_ÿ¼›r_ok
)

233 
_up_ÿÎ
->
	`ÿÎ_wr™e
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

234 ià(!
_up_ÿÎ
 && !
_qu›t
)

235 
	`şick_ch©‹r
("%s: deviû %<%s%> camup", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_devÇme
.c_str());

237 
	}
}

240 
AnyDeviû
::
	$ş—r_deviû
(
AnyDeviûM­
 *
adm
, 
æags
)

242 ià(
_dev
 && 
_´omisc
)

243 
	`®‹r_´omiscu™y
(-1);

244 #ià
HAVE_NET_ENABLE_TIMESTAMP


245 ià(
_dev
 && 
_time¡amp
)

246 
	`Ãt_di§bË_time¡amp
();

248 ià(
_dev
 && (
æags
 & 
ªydev_äom_deviû
))

249 
	`®‹r_äom_deviû
(-1);

250 ià(
adm
 && 
_š_m­
)

251 
adm
->
	`»move
(
this
, 
æags
 & 
ªydev_chªge
);

252 ià(
_dev
)

253 
	`dev_put
(
_dev
);

254 
_dev
 = 0;

255 
_ÿ¼›r_ok
 = 
çl£
;

256 
	}
}

259 
AnyTaskDeviû
::
	$AnyTaskDeviû
()

260 : 
	`_sk
(
this
), 
	$_idËs
(0)

262 
	}
}

266 
AnyDeviûM­
::
	$š™Ÿlize
()

268 
_unknown_m­
 = 0;

269 
i
 = 0; i < 
MAP_SIZE
; i++)

270 
_m­
[
i
] = 0;

271 
	`rwlock_š™
(&
_lock
);

272 
	}
}

275 
AnyDeviûM­
::
	$š£¹
(
AnyDeviû
 *
d
, 
boŞ
 
locked
)

278 
lock_æags
;

279 ià(!
locked
)

280 
	`lock
(
Œue
, 
lock_æags
);

283 
ifi
 = 
d
->
	`ifšdex
();

284 
AnyDeviû
 **
µ»v
 = (
ifi
 >ğ0 ? &
_m­
[if˜% 
MAP_SIZE
] : &
_unknown_m­
);

285 
AnyDeviû
 *
Œav
 = *
µ»v
;

286 
Œav
) {

287 
µ»v
 = &
Œav
->
_Ãxt
;

288 
Œav
 = *
µ»v
;

290 
d
->
_Ãxt
 = 0;

291 *
µ»v
 = 
d
;

293 
d
->
_š_m­
 = 
Œue
;

294 ià(!
locked
)

295 
	`uÆock
(
Œue
, 
lock_æags
);

296 
	}
}

299 
AnyDeviûM­
::
	$»move
(
AnyDeviû
 *
d
, 
boŞ
 
locked
)

301 
lock_æags
;

302 ià(!
locked
)

303 
	`lock
(
Œue
, 
lock_æags
);

304 
ifi
 = 
d
->
	`ifšdex
();

305 
AnyDeviû
 **
µ»v
 = (
ifi
 >ğ0 ? &
_m­
[if˜% 
MAP_SIZE
] : &
_unknown_m­
);

306 
AnyDeviû
 *
Œav
 = *
µ»v
;

307 
Œav
 &&¿v !ğ
d
) {

308 
µ»v
 = &
Œav
->
_Ãxt
;

309 
Œav
 = *
µ»v
;

311 ià(
Œav
)

312 *
µ»v
 = 
d
->
_Ãxt
;

313 
d
->
_š_m­
 = 
çl£
;

314 ià(!
locked
)

315 
	`uÆock
(
Œue
, 
lock_æags
);

316 
	}
}

318 
AnyDeviû
 *

319 
AnyDeviûM­
::
	$lookup_unknown
(
Ãt_deviû
 *
dev
, 
AnyDeviû
 *
Ï¡
) const

323 ià(!
dev
)

327 
dev_Çme_Ën
 = 
	`¡¾’
(
dev
->
Çme
);

328 
’
[6];

330 
AnyDeviû
 *
d
 = (
Ï¡
 ?†a¡->
_Ãxt
 : 
_unknown_m­
); d; d = d->_next)

331 ià(
d
->
	`devÇme
().
	`equ®s
(
dev
->
Çme
, 
dev_Çme_Ën
)) {

332 
d
->
_devÇme_exi¡s
 = 
Œue
;

333  
d
;

334 } ià((
dev
->
ty³
 =ğ
ARPHRD_ETHER
 || dev->ty³ =ğ
ARPHRD_80211
)

335 && !
d
->
_devÇme_exi¡s


336 && 
	`Eth”Add»ssArg
(
Add»ssInfo
::
f_nodeviû
).
	`·r£
(
d
->
	`devÇme
(), 
’
, d)

337 && 
	`memcmp
(
’
, 
dev
->
dev_addr
, 6) == 0)

338  
d
;

341 
	}
}

344 
AnyDeviûM­
::
	$lookup_®l
(
Ãt_deviû
 *
dev
, 
boŞ
 
known
, 
AnyDeviû
 **
dev_¡Üe
,

345 
ndev
) const

348 
i
 = 0;

349 ià(
known
)

350 
AnyDeviû
 *
d
 = 0; 
i
 < 
ndev
 && (d = 
	`lookup
(
dev
, d)); ++i)

351 
dev_¡Üe
[
i
] = 
d
;

353 
AnyDeviû
 *
d
 = 0; 
i
 < 
ndev
 && (d = 
	`lookup_unknown
(
dev
, d)); ++i)

354 
dev_¡Üe
[
i
] = 
d
;

355  
i
;

356 
	}
}

359 
Ãt_deviû
 *

360 
AnyDeviû
::
	$g‘_by_‘h”_add»ss
(cÚ¡ 
SŒšg
 &
Çme
, 
EËm’t
 *
cÚ‹xt
)

362 
’
[6];

363 ià(!
	`Eth”Add»ssArg
(
Add»ssInfo
::
f_nodeviû
).
	`·r£
(
Çme
, 
’
, 
cÚ‹xt
))

365 
	`»ad_lock
(&
dev_ba£_lock
);

366 
Ãt_deviû
 *
dev
;

367 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 24)

368 
	`fÜ_—ch_Ãtdev
(&
š™_Ãt
, 
dev
)

370 
dev
 = 
dev_ba£
; dev; dev = dev->
Ãxt
)

372 ià((
dev
->
ty³
 =ğ
ARPHRD_ETHER
 || dev->ty³ =ğ
ARPHRD_80211
)

373 && 
	`memcmp
(
’
, 
dev
->
dev_addr
, 6) == 0) {

374 
	`dev_hŞd
(
dev
);

378 
	`»ad_uÆock
(&
dev_ba£_lock
);

379  
dev
;

380 
	}
}

382 
	$ELEMENT_REQUIRES
(
lšuxmoduË
 
FromDeviû
)

383 
	`ELEMENT_PROVIDES
(
AnyDeviû
)

	@linuxmodule/anydevice.hh

2 #iâdeà
ANYDEVICE_HH


3 
	#ANYDEVICE_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
şass
 
	gHªdËrC®l
;

8 
	~<şick/cxx´Ùeù.h
>

9 
	gCLICK_CXX_PROTECT


10 
	~<lšux/Ãtdeviû.h
>

11 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 24)

12 
	~<Ãt/Ãt_Çme¥aû.h
>

13 
	~<lšux/³rıu.h
>

15 
	gCLICK_CXX_UNPROTECT


16 
	~<şick/cxxuÅrÙeù.h
>

22 
	#CLICK_CYCLE_COMPENSATION
 0

	)

24 #ià
HAVE_STRIDE_SCHED


25 
	#CLICK_DEVICE_ADJUST_TICKETS
 1

	)

28 #ià
CLICK_DEVICE_PRFCTR
 && 
__i386__


29 
	#CLICK_DEVICE_STATS
 1

	)

30 
	#SET_STATS
(
p0m¬k
, 
p1m¬k
, 
time_m¬k
) \

32 
high
; \

33 
	`rdpmc
(0, 
p0m¬k
, 
high
); \

34 
	`rdpmc
(1, 
p1m¬k
, 
high
); \

35 
time_m¬k
 = 
	`şick_g‘_cyşes
(); \

36 }

	)

37 
	#GET_STATS_RESET
(
p0m¬k
, 
p1m¬k
, 
time_m¬k
, 
pùr0
, 
pùr1
, 
tùr
) \

39 
high
; \

40 
low01
, 
low11
; \

41 
tùr
 +ğ
	`şick_g‘_cyşes
(è- 
time_m¬k
 - 
CLICK_CYCLE_COMPENSATION
; \

42 
	`rdpmc
(0, 
low01
, 
high
); \

43 
	`rdpmc
(1, 
low11
, 
high
); \

44 
pùr0
 +ğ(
low01
 >ğ
p0m¬k
è?†ow01-p0m¬k : (
UINT_MAX
-p0mark+low01); \

45 
pùr1
 +ğ(
low11
 >ğ
p1m¬k
è?†ow11-p1m¬k : (
UINT_MAX
-p1mark+low11); \

46 
	`rdpmc
(0, 
p0m¬k
, 
high
); \

47 
	`rdpmc
(1, 
p1m¬k
, 
high
); \

48 
time_m¬k
 = 
	`şick_g‘_cyşes
(); \

49 }

	)

50 #–ià
CLICK_DEVICE_CYCLES


51 
	#CLICK_DEVICE_STATS
 1

	)

52 
	#SET_STATS
(
p0m¬k
, 
p1m¬k
, 
time_m¬k
) \

54 
time_m¬k
 = 
	`şick_g‘_cyşes
(); \

55 }

	)

56 
	#GET_STATS_RESET
(
p0m¬k
, 
p1m¬k
, 
time_m¬k
, 
pùr0
, 
pùr1
, 
tùr
) \

58 
ušt64_t
 
__now
 = 
	`şick_g‘_cyşes
(); \

59 
tùr
 +ğ
__now
 - 
time_m¬k
 - 
CLICK_CYCLE_COMPENSATION
; \

60 
time_m¬k
 = 
__now
; \

61 }

	)

63 
	#GET_STATS_RESET
(
a
,
b
,
c
,
d
,
e
,
f
è

	)

64 
	#SET_STATS
(
a
,
b
,
c
è

	)

67 #ià(
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(3, 1, 0è|| 
defšed
(
HAVE_NETIF_RECEIVE_SKB
)) \

68 && !(
	gHAVE___NETIF_RECEIVE_SKB
 || 
	gHAVE_NETIF_RECEIVE_SKB_EXTENDED
)

69 
	#CLICK_DEVICE_UNRECEIVABLE_SK_BUFF
 1

	)

71 
DECLARE_PER_CPU
(
sk_buff
*, 
şick_deviû_uÄeûivabË_sk_buff
);

73 #ià
SIZEOF_VOID_P
 == 8

74 
	#CLICK_DEVICE_UNRECEIVABLE_SK_BUFF_READ
(è
	`¿w_ıu_»ad_8
(
şick_deviû_uÄeûivabË_sk_buff
)

	)

75 
	#CLICK_DEVICE_UNRECEIVABLE_SK_BUFF_WRITE
(
v®
è
	`¿w_ıu_wr™e_8
(
şick_deviû_uÄeûivabË_sk_buff
, (v®))

	)

76 #–ià
SIZEOF_VOID_P
 == 4

77 
	#CLICK_DEVICE_UNRECEIVABLE_SK_BUFF_READ
(è
	`¿w_ıu_»ad_4
(
şick_deviû_uÄeûivabË_sk_buff
)

	)

78 
	#CLICK_DEVICE_UNRECEIVABLE_SK_BUFF_WRITE
(
v®
è
	`¿w_ıu_wr™e_4
(
şick_deviû_uÄeûivabË_sk_buff
, (v®))

	)

82 #ià!
HAVE_CLICK_KERNEL
 && 
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 24) \

83 && 
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2, 6, 36) \

84 && (
defšed
(
CONFIG_BRIDGE
è|| defšed(
CONFIG_BRIDGE_MODULE
)) \

85 && !
HAVE_LINUX_NETDEV_RX_HANDLER_REGISTER


86 
	#CLICK_FROMDEVICE_USE_BRIDGE
 1

	)

89 
şass
 
AnyDeviûM­
;

91 şas 
	cAnyDeviû
 : 
public
 
EËm’t
 {…ublic:

93 ’um { 
CONFIGURE_PHASE_FROMHOST
 = 
CONFIGURE_PHASE_DEFAULT
 - 2,

94 
	mCONFIGURE_PHASE_TODEVICE
 = 
CONFIGURE_PHASE_DEFAULT
 - 1,

95 
	mCONFIGURE_PHASE_POLLDEVICE
 = 
CONFIGURE_PHASE_DEFAULT
 };

97 
	$AnyDeviû
(è
CLICK_COLD
;

98 ~
	$AnyDeviû
(è
CLICK_COLD
;

100 cÚ¡ 
SŒšg
 &
	$devÇme
(ècÚ¡ {  
_devÇme
; 
	}
}

101 
Ãt_deviû
 *
	$deviû
(ècÚ¡ {  
_dev
; 
	}
}

102 
	$ifšdex
(ècÚ¡ {  
_dev
 ? _dev->
ifšdex
 : -1; 
	}
}

104 
boŞ
 
	$®low_nÚexi¡’t
(ècÚ¡ {  
_®low_nÚexi¡’t
; 
	}
}

105 
boŞ
 
	$´omisc
(ècÚ¡ {  
_´omisc
; 
	}
}

106 
boŞ
 
	$time¡amp
(ècÚ¡ {  
_time¡amp
; 
	}
}

108 
cÚfigu»_keywÜds
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
,

109 
boŞ
 
is_»ad”
);

110 
š™Ÿlize_keywÜds
(
E¼ÜHªdËr
 *
”rh
);

112 
Ãt_deviû
 *
lookup_deviû
(
E¼ÜHªdËr
 *
”rh
);

114 
	gªydev_chªge
 = 1,

115 
	gªydev_äom_deviû
 = 2

117 
£t_deviû
(
Ãt_deviû
 *
dev
, 
AnyDeviûM­
 *
m­
, 
æags
);

118 
ş—r_deviû
(
AnyDeviûM­
 *
m­
, 
æags
);

119 
®‹r_äom_deviû
(
d–
);

121 
šlše
 
Ãt_deviû
 *
	$g‘_by_Çme
(cÚ¡ *
Çme
) {

122 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 24)

123  
	`dev_g‘_by_Çme
(&
š™_Ãt
, 
Çme
);

125  
	`dev_g‘_by_Çme
(
Çme
);

127 
	}
}

129 
Ãt_deviû
 *
g‘_by_‘h”_add»ss
(cÚ¡ 
SŒšg
 &
Çme
, 
EËm’t
 *
cÚ‹xt
);

132 
	sçke_bridge
 {

133 
	gmagic
;

134 
©omic_t
 
	g»fcouÁ
;

136 
	gşick_magic
 = 0x817A10A7

140 
	g´Ùeùed
:

142 
SŒšg
 
_devÇme
;

143 
Ãt_deviû
 *
	g_dev
;

145 
boŞ
 
	g_´omisc
;

146 
boŞ
 
	g_time¡amp
;

147 
boŞ
 
	g_ş—r_ªno
;

148 
boŞ
 
	g_š_m­
 : 1;

149 
boŞ
 
	g_qu›t
 : 1;

150 
boŞ
 
	g_®low_nÚexi¡’t
 : 1;

151 
boŞ
 
	g_devÇme_exi¡s
 : 1;

152 
boŞ
 
	g_ÿ¼›r_ok
 : 1;

153 
AnyDeviû
 *
	g_Ãxt
;

155 
HªdËrC®l
 *
	g_up_ÿÎ
;

156 
HªdËrC®l
 *
	g_down_ÿÎ
;

158 
®‹r_´omiscu™y
(
d–
);

160 
ä›nd
 
şass
 
	gAnyDeviûM­
;

164 şas 
	cAnyTaskDeviû
 : 
public
 
AnyDeviû
 {…ublic:

166 
	$AnyTaskDeviû
(è
CLICK_COLD
;

168 
šlše
 
	`adju¡_tick‘s
(
wÜk
);

170 
´Ùeùed
:

172 
Task
 
_sk
;

173 
_max_tick‘s
;

174 
_idËs
;

179 
šlše
 

180 
AnyTaskDeviû
::
	$adju¡_tick‘s
(
wÜk
)

182 #ià
CLICK_DEVICE_ADJUST_TICKETS


183 
tix
 = 
_sk
.
	`tick‘s
();

186 ià(
wÜk
 > 2) {

187 
tix
 +ğ
wÜk
;

188 ià(
tix
 > 
_max_tick‘s
)

189 
tix
 = 
_max_tick‘s
;

190 
_idËs
 = 0;

191 } ià(
wÜk
 == 0) {

192 
_idËs
++;

193 ià(
_idËs
 >= 64) {

194 ià(
tix
 > 64)

195 
tix
 -= (tix >> 5);

197 
tix
 -= 2;

198 ià(
tix
 < 1)

199 
tix
 = 1;

200 
_idËs
 = 0;

204 
_sk
.
	`£t_tick‘s
(
tix
);

206 
	}
}

208 şas 
	cAnyDeviûM­
 { 
	mpublic
:

210 
	$š™Ÿlize
(è
CLICK_COLD
;

211 
šlše
 
	`lock
(
boŞ
 
wr™e
, &
æags
);

212 
šlše
 
	`uÆock
(
boŞ
 
wr™e
, 
æags
);

213 
šlše
 
AnyDeviû
 *
	$lookup
(
Ãt_deviû
 *
dev
, 
AnyDeviû
 *
Ï¡
) const;

214 
AnyDeviû
 *
	$lookup_unknown
(
Ãt_deviû
 *
dev
, 
AnyDeviû
 *
Ï¡
) const;

215 
	$lookup_®l
(
Ãt_deviû
 *
dev
, 
boŞ
 
known
, 
AnyDeviû
 **
dev–t_¡Üe
, 
ndev
) const;

216 
	`š£¹
(
AnyDeviû
 *
dev–t
, 
boŞ
 
locked
);

217 
	`»move
(
AnyDeviû
 *
dev–t
, 
boŞ
 
locked
);

219 
´iv©e
:

221 ’um { 
MAP_SIZE
 = 64 };

222 
AnyDeviû
 *
_unknown_m­
;

223 
AnyDeviû
 *
_m­
[
MAP_SIZE
];

224 
rwlock_t
 
_lock
;

226 
	}
};

228 
šlše
 

229 
	gAnyDeviûM­
::
	$lock
(
boŞ
 
wr™e
, &
æags
)

231 ià(
wr™e
)

232 
	`wr™e_lock_œq§ve
(&
_lock
, 
æags
);

234 
	`»ad_lock_œq§ve
(&
_lock
, 
æags
);

235 
	}
}

237 
šlše
 

238 
	gAnyDeviûM­
::
	$uÆock
(
boŞ
 
wr™e
, 
æags
)

240 ià(
wr™e
)

241 
	`wr™e_uÆock_œq»¡Üe
(&
_lock
, 
æags
);

243 
	`»ad_uÆock_œq»¡Üe
(&
_lock
, 
æags
);

244 
	}
}

246 
šlše
 
AnyDeviû
 *

247 
	gAnyDeviûM­
::
	$lookup
(
Ãt_deviû
 *
dev
, 
AnyDeviû
 *
Ï¡
) const

250 ià(!
dev
)

252 
AnyDeviû
 *
d
 = (
Ï¡
 ?†a¡->
_Ãxt
 : 
_m­
[
dev
->
ifšdex
 % 
MAP_SIZE
]);

253 
d
 && d->
	`deviû
(è!ğ
dev
)

254 
d
 = d->
_Ãxt
;

255  
d
;

256 
	}
}

	@linuxmodule/cyclecountaccum.cc

19 
	~<şick/cÚfig.h
>

20 
	~"cyşecouÁaccum.hh
"

21 
	~<şick/·ck‘_ªno.hh
>

22 
	~<şick/glue.hh
>

24 
	gCyşeCouÁAccum
::
	$CyşeCouÁAccum
()

25 : 
	`_accum
(0), 
	`_couÁ
(0), 
	$_z”o_couÁ
(0)

27 
	}
}

29 
	gCyşeCouÁAccum
::~
	$CyşeCouÁAccum
()

31 
	}
}

33 
šlše
 

34 
CyşeCouÁAccum
::
	$smaùiÚ
(
Pack‘
 *
p
)

36 ià(
	`PERFCTR_ANNO
(
p
)) {

37 
_accum
 +ğ
	`şick_g‘_cyşes
(è- 
	`PERFCTR_ANNO
(
p
);

38 
_couÁ
++;

40 
_z”o_couÁ
++;

41 ià(
_z”o_couÁ
 == 1)

42 
	`şick_ch©‹r
("%s:…ack‘ w™h z”ØcyşcouÁ”‡ÂÙ©iÚ!", 
	`deş¬©iÚ
().
	`c_¡r
());

44 
	}
}

47 
	gCyşeCouÁAccum
::
	$push
(, 
Pack‘
 *
p
)

49 
	`smaùiÚ
(
p
);

50 
	`ouut
(0).
	`push
(
p
);

51 
	}
}

53 
Pack‘
 *

54 
	gCyşeCouÁAccum
::
	$puÎ
()

56 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

57 ià(
p
)

58 
	`smaùiÚ
(
p
);

59  
p
;

60 
	}
}

62 
SŒšg


63 
	gCyşeCouÁAccum
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

65 
CyşeCouÁAccum
 *
cÿ
 = 
¡©ic_ÿ¡
<CyşeCouÁAccum *>(
e
);

66 (
ušŒ_t
)
thunk
) {

68  
	`SŒšg
(
cÿ
->
_couÁ
);

70  
	`SŒšg
(
cÿ
->
_accum
);

72  
	`SŒšg
(
cÿ
->
_z”o_couÁ
);

74  
	`SŒšg
();

76 
	}
}

79 
	gCyşeCouÁAccum
::
	$»£t_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

81 
CyşeCouÁAccum
 *
cÿ
 = 
¡©ic_ÿ¡
<CyşeCouÁAccum *>(
e
);

82 
cÿ
->
_couÁ
 = cÿ->
_accum
 = cÿ->
_z”o_couÁ
 = 0;

84 
	}
}

87 
	gCyşeCouÁAccum
::
	$add_hªdËrs
()

89 
	`add_»ad_hªdËr
("couÁ", 
»ad_hªdËr
, 0);

90 
	`add_»ad_hªdËr
("cyşes", 
»ad_hªdËr
, 1);

91 
	`add_»ad_hªdËr
("z”o_couÁ", 
»ad_hªdËr
, 2);

92 
	`add_wr™e_hªdËr
("»£t_couÁs", 
»£t_hªdËr
, 0, 
HªdËr
::
BUTTON
);

93 
	}
}

95 
	$ELEMENT_REQUIRES
(
lšuxmoduË
 
št64
)

96 
	`EXPORT_ELEMENT
(
CyşeCouÁAccum
)

	@linuxmodule/cyclecountaccum.hh

2 #iâdeà
CLICK_CYCLECOUNTACCUM_HH


3 
	#CLICK_CYCLECOUNTACCUM_HH


	)

44 
	~<şick/–em’t.hh
>

46 şas 
	cCyşeCouÁAccum
 : 
public
 
EËm’t
 {…ublic:

48 
	$CyşeCouÁAccum
(è
CLICK_COLD
;

49 ~
	$CyşeCouÁAccum
(è
CLICK_COLD
;

51 cÚ¡ *
	$şass_Çme
() const {  "CycleCountAccum"; }

52 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

54 
	$add_hªdËrs
(è
CLICK_COLD
;

56 
šlše
 
	`smaùiÚ
(
Pack‘
 *);

57 
	`push
(, 
Pack‘
 *
p
);

58 
Pack‘
 *
	`puÎ
();

60 
´iv©e
:

62 
ušt64_t
 
_accum
;

63 
ušt64_t
 
_couÁ
;

64 
ušt64_t
 
_z”o_couÁ
;

66 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

67 
	`»£t_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
*, *, 
E¼ÜHªdËr
*);

69 
	}
};

	@linuxmodule/fastudpsrc.cc

17 
	~<şick/cÚfig.h
>

18 
	~<şickÃt/.h
>

19 
	~"ç¡udp¤c.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/‘h”add»ss.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

26 cÚ¡ 
	gFa¡UDPSourû
::
NO_LIMIT
;

28 
	gFa¡UDPSourû
::
	$Fa¡UDPSourû
()

29 : 
	$_·ck‘
(0)

31 
_¿‹_lim™ed
 = 
Œue
;

32 
_fœ¡
 = 
_Ï¡
 = 0;

33 
_couÁ
 = 0;

34 
	}
}

36 
	gFa¡UDPSourû
::~
	$Fa¡UDPSourû
()

38 
	}
}

41 
Fa¡UDPSourû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

43 
	g_cksum
 = 
Œue
;

44 
	g_aùive
 = 
Œue
;

45 
	g_š‹rv®
 = 0;

46 
	g¿‹
;

47 
	glim™
;

48 ià(
Args
(
cÚf
, 
this
, 
”rh
)

49 .
»ad_mp
("RATE", 
¿‹
)

50 .
»ad_mp
("LIMIT", 
lim™
)

51 .
»ad_mp
("LENGTH", 
_Ën
)

52 .
»ad_mp
("SRCETH", 
Eth”Add»ssArg
(), 
_‘hh
.
‘h”_sho¡
)

53 .
»ad_mp
("SRCIP", 
_saddr
)

54 .
»ad_mp
("SPORT", 
IPPÜtArg
(
IP_PROTO_UDP
), 
_¥Üt
)

55 .
»ad_mp
("DSTETH", 
Eth”Add»ssArg
(), 
_‘hh
.
‘h”_dho¡
)

56 .
»ad_mp
("DSTIP", 
_daddr
)

57 .
»ad_mp
("DPORT", 
IPPÜtArg
(
IP_PROTO_UDP
), 
_dpÜt
)

58 .
»ad_p
("CHECKSUM", 
_cksum
)

59 .
»ad_p
("INTERVAL", 
_š‹rv®
)

60 .
»ad_p
("ACTIVE", 
_aùive
)

61 .
com¶‘e
() < 0)

63 ià(
	g_Ën
 < 60) {

64 
şick_ch©‹r
("warning:…acket†ength < 60, defaultingo 60");

65 
	g_Ën
 = 60;

67 
	g_‘hh
.
	g‘h”_ty³
 = 
htÚs
(0x0800);

68 if(
	g¿‹
 != 0){

69 
_¿‹_lim™ed
 = 
Œue
;

70 
	g_¿‹
.
£t_¿‹
(
¿‹
, 
”rh
);

72 
	g_¿‹_lim™ed
 = 
çl£
;

74 
	g_lim™
 = (
lim™
 >ğ0 ?†im™ : 
NO_LIMIT
);

79 
	gFa¡UDPSourû
::
	$šü_pÜts
()

81 
Wr™abËPack‘
 *
q
 = 
_·ck‘
->
	`uniqueify
();

82 
_·ck‘
 = 
q
;

83 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
q
->
	`d©a
()+14);

84 
şick_udp
 *
udp
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(

 + 1);

85 
_šü
++;

86 
udp
->
uh_¥Üt
 = 
	`htÚs
(
_¥Üt
+
_šü
);

87 
udp
->
uh_dpÜt
 = 
	`htÚs
(
_dpÜt
+
_šü
);

88 
udp
->
uh_sum
 = 0;

89 
Ën
 = 
_Ën
-14-(
şick_
);

90 ià(
_cksum
) {

91 
csum
 = ~
	`şick_š_cksum
((*)
udp
, 
Ën
) & 0xFFFF;

92 
udp
->
uh_sum
 = 
	`csum_tıudp_magic
(
_saddr
.
s_addr
, 
_daddr
.s_addr,

93 
Ën
, 
IP_PROTO_UDP
, 
csum
);

95 
udp
->
uh_sum
 = 0;

96 
	}
}

99 
	gFa¡UDPSourû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

101 
_couÁ
 = 0;

102 
_šü
 = 0;

103 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(
_Ën
);

104 
_·ck‘
 = 
q
;

105 
	`memıy
(
q
->
	`d©a
(), &
_‘hh
, 14);

106 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
q
->
	`d©a
()+14);

107 
şick_udp
 *
udp
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(

 + 1);

110 

->
_v
 = 4;

111 

->
_hl
 = (
şick_
) >> 2;

112 

->
_Ën
 = 
	`htÚs
(
_Ën
-14);

113 

->
_id
 = 0;

114 

->
_p
 = 
IP_PROTO_UDP
;

115 

->
_¤c
 = 
_saddr
;

116 

->
_d¡
 = 
_daddr
;

117 

->
_tos
 = 0;

118 

->
_off
 = 0;

119 

->
_‰l
 = 250;

120 

->
_sum
 = 0;

121 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

122 
_·ck‘
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(
_daddr
));

123 
_·ck‘
->
	`£t__h—d”
(

, (
şick_
));

126 
udp
->
uh_¥Üt
 = 
	`htÚs
(
_¥Üt
);

127 
udp
->
uh_dpÜt
 = 
	`htÚs
(
_dpÜt
);

128 
udp
->
uh_sum
 = 0;

129 
Ën
 = 
_Ën
-14-(
şick_
);

130 
udp
->
uh_uËn
 = 
	`htÚs
(
Ën
);

131 ià(
_cksum
) {

132 
csum
 = ~
	`şick_š_cksum
((*)
udp
, 
Ën
) & 0xFFFF;

133 
udp
->
uh_sum
 = 
	`csum_tıudp_magic
(
_saddr
.
s_addr
, 
_daddr
.s_addr,

134 
Ën
, 
IP_PROTO_UDP
, 
csum
);

136 
udp
->
uh_sum
 = 0;

139 
	}
}

142 
	gFa¡UDPSourû
::
	$ş—nup
(
CËªupSge
)

144 ià(
_·ck‘
) {

145 
_·ck‘
->
	`kl
();

146 
_·ck‘
=0;

148 
	}
}

150 
Pack‘
 *

151 
	gFa¡UDPSourû
::
	$puÎ
()

153 
Pack‘
 *
p
 = 0;

155 ià(!
_aùive
 || (
_lim™
 !ğ
NO_LIMIT
 && 
_couÁ
 >= _limit))  0;

157 if(
_¿‹_lim™ed
){

158 ià(
_¿‹
.
	`Ãed_upd©e
(
Time¡amp
::
	`now
())) {

159 
_¿‹
.
	`upd©e
();

160 
p
 = 
_·ck‘
->
	`şÚe
();

163 
p
 = 
_·ck‘
->
	`şÚe
();

166 if(
p
) {

167 
_couÁ
++;

168 if(
_couÁ
 == 1)

169 
_fœ¡
 = 
	`şick_jiff›s
();

170 if(
_lim™
 !ğ
NO_LIMIT
 && 
_couÁ
 >= _limit)

171 
_Ï¡
 = 
	`şick_jiff›s
();

172 if(
_š‹rv®
>0 && !(
_couÁ
%_interval))

173 
	`šü_pÜts
();

176 (
p
);

177 
	}
}

180 
	gFa¡UDPSourû
::
	$»£t
()

182 
_couÁ
 = 0;

183 
_fœ¡
 = 0;

184 
_Ï¡
 = 0;

185 
_šü
 = 0;

186 
	}
}

188 
SŒšg


189 
	$Fa¡UDPSourû_»ad_couÁ_hªdËr
(
EËm’t
 *
e
, *)

191 
Fa¡UDPSourû
 *
c
 = (Fa¡UDPSourû *)
e
;

192  
	`SŒšg
(
c
->
	`couÁ
());

193 
	}
}

195 
SŒšg


196 
	$Fa¡UDPSourû_»ad_¿‹_hªdËr
(
EËm’t
 *
e
, *)

198 
Fa¡UDPSourû
 *
c
 = (Fa¡UDPSourû *)
e
;

199 if(
c
->
	`Ï¡
() != 0){

200 
d
 = 
c
->
	`Ï¡
(è- c->
	`fœ¡
();

201 ià(
d
 < 1) d = 1;

202 
¿‹
 = 
c
->
	`couÁ
(è* 
CLICK_HZ
 / 
d
;

203  
	`SŒšg
(
¿‹
);

205  
	`SŒšg
("0");

207 
	}
}

210 
	gFa¡UDPSourû_»£t_wr™e_hªdËr


211 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *)

213 
Fa¡UDPSourû
 *
	gc
 = (Fa¡UDPSourû *)
e
;

214 
	gc
->
»£t
();

219 
	gFa¡UDPSourû_lim™_wr™e_hªdËr


220 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

222 
Fa¡UDPSourû
 *
	gc
 = (Fa¡UDPSourû *)
e
;

223 
	glim™
;

224 ià(!
IÁArg
().
·r£
(
s
, 
lim™
))

225  
	g”rh
->
”rÜ
("limit…arameter must be integer >= 0");

226 
	gc
->
	g_lim™
 = (
lim™
 >ğ0 ?†im™ : 
c
->
NO_LIMIT
);

231 
	gFa¡UDPSourû_¿‹_wr™e_hªdËr


232 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

234 
Fa¡UDPSourû
 *
	gc
 = (Fa¡UDPSourû *)
e
;

235 
	g¿‹
;

236 ià(!
IÁArg
().
·r£
(
s
, 
¿‹
))

237  
	g”rh
->
”rÜ
("rate…arameter must be integer >= 0");

238 ià(
	g¿‹
 > 
	gG­R©e
::
MAX_RATE
)

240  
”rh
->
”rÜ
("¿‹oØÏrge; max i %u", 
G­R©e
::
MAX_RATE
);

241 
	gc
->
	g_¿‹
.
£t_¿‹
(
¿‹
);

246 
	gFa¡UDPSourû_aùive_wr™e_hªdËr


247 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

249 
Fa¡UDPSourû
 *
	gc
 = (Fa¡UDPSourû *)
e
;

250 
boŞ
 
	gaùive
;

251 ià(!
BoŞArg
().
·r£
(
s
, 
aùive
))

252  
	g”rh
->
”rÜ
("active…arameter must be boolean");

253 
	gc
->
	g_aùive
 = 
aùive
;

254 ià(
	gaùive
è
	gc
->
»£t
();

259 
	gFa¡UDPSourû
::
	$add_hªdËrs
()

261 
	`add_»ad_hªdËr
("couÁ", 
Fa¡UDPSourû_»ad_couÁ_hªdËr
, 0);

262 
	`add_»ad_hªdËr
("¿‹", 
Fa¡UDPSourû_»ad_¿‹_hªdËr
, 0);

263 
	`add_wr™e_hªdËr
("¿‹", 
Fa¡UDPSourû_¿‹_wr™e_hªdËr
, 0);

264 
	`add_wr™e_hªdËr
("»£t", 
Fa¡UDPSourû_»£t_wr™e_hªdËr
, 0, 
HªdËr
::
BUTTON
);

265 
	`add_wr™e_hªdËr
("aùive", 
Fa¡UDPSourû_aùive_wr™e_hªdËr
, 0, 
HªdËr
::
CHECKBOX
);

266 
	`add_wr™e_hªdËr
("lim™", 
Fa¡UDPSourû_lim™_wr™e_hªdËr
, 0);

267 
	}
}

269 
	$ELEMENT_REQUIRES
(
lšuxmoduË
)

270 
	`EXPORT_ELEMENT
(
Fa¡UDPSourû
)

	@linuxmodule/fastudpsrc.hh

1 #iâdeà
FASTUDPSRCLINUXMODULE_HH


2 
	#FASTUDPSRCLINUXMODULE_HH


	)

53 
	~<şick/–em’t.hh
>

54 
	~<şick/glue.hh
>

55 
	~<şick/g­¿‹.hh
>

56 
	~<şick/·ck‘.hh
>

57 
	~<şickÃt/‘h”.h
>

58 
	~<şickÃt/udp.h
>

60 şas 
	cFa¡UDPSourû
 : 
public
 
EËm’t
 {

62 
boŞ
 
_¿‹_lim™ed
;

63 
	m_Ën
;

64 
şick_‘h”
 
	m_‘hh
;

65 
š_addr
 
	m_saddr
;

66 
š_addr
 
	m_daddr
;

67 
ušt16_t
 
	m_¥Üt
;

68 
ušt16_t
 
	m_dpÜt
;

69 
	m_šü
;

70 
	m_š‹rv®
;

71 
boŞ
 
	m_cksum
;

72 
Pack‘
 *
	m_·ck‘
;

73 
şick_jiff›s_t
 
	m_fœ¡
;

74 
şick_jiff›s_t
 
	m_Ï¡
;

76 
šü_pÜts
();

78 
	mpublic
:

80 cÚ¡ 
NO_LIMIT
 = 0xFFFFFFFFU;

82 
G­R©e
 
	m_¿‹
;

83 
	m_couÁ
;

84 
	m_lim™
;

85 
boŞ
 
	m_aùive
;

87 
	$Fa¡UDPSourû
(è
CLICK_COLD
;

88 ~
	$Fa¡UDPSourû
(è
CLICK_COLD
;

90 cÚ¡ *
	$şass_Çme
() const {  "FastUDPSource"; }

91 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

92 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

94 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

95 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

96 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

97 
Pack‘
 *
	`puÎ
();

99 
	$add_hªdËrs
(è
CLICK_COLD
;

100 
	`»£t
();

101 
	$couÁ
(è{  
_couÁ
; 
	}
}

102 
şick_jiff›s_t
 
	$fœ¡
(è{  
_fœ¡
; 
	}
}

103 
şick_jiff›s_t
 
	$Ï¡
(è{  
_Ï¡
; 
	}
}

106 
ä›nd
 
	gFa¡UDPSourû_lim™_wr™e_hªdËr


107 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *);

108 
ä›nd
 
	gFa¡UDPSourû_¿‹_wr™e_hªdËr


109 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *);

110 
ä›nd
 
	gFa¡UDPSourû_aùive_wr™e_hªdËr


111 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *);

	@linuxmodule/fromdevice.cc

25 
	~<şick/cÚfig.h
>

26 
	~<şick/glue.hh
>

27 
	~"äomdeviû.hh
"

28 
	~<şick/”rÜ.hh
>

29 
	~<şick/¬gs.hh
>

30 
	~<şick/rou‹r.hh
>

31 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

32 
	~<şick/¡¿ccum.hh
>

34 
	~<şick/cxx´Ùeù.h
>

35 
	gCLICK_CXX_PROTECT


36 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 24)

37 
	~<lšux/¹Ãšk.h
>

39 
	gCLICK_CXX_UNPROTECT


40 
	~<şick/cxxuÅrÙeù.h
>

42 
AnyDeviûM­
 
	gäom_deviû_m­
;

43 
	g»gi¡”ed_»ad”s
;

44 #ià
HAVE_CLICK_KERNEL


45 
nÙif›r_block
 
	g·ck‘_nÙif›r
;

47 #ià
CLICK_FROMDEVICE_USE_BRIDGE


48 
nÙif›r_block
 
	gdeviû_nÙif›r_—¾y
;

50 
nÙif›r_block
 
	gdeviû_nÙif›r
;

52 #ià
CLICK_FROMDEVICE_USE_BRIDGE


53 
	~<şick/cxx´Ùeù.h
>

54 
	gCLICK_CXX_PROTECT


55 
	~<lšux/if_bridge.h
>

56 
	gCLICK_CXX_UNPROTECT


57 
	~<şick/cxxuÅrÙeù.h
>

62 #ià
HAVE_CLICK_KERNEL


63 
·ck‘_nÙif›r_hook
(
nÙif›r_block
 *
nb
, 
v®
, *
v
);

64 #–ià
CLICK_FROMDEVICE_USE_BRIDGE


65 
sk_buff
 *
şick_br_hªdË_äame_hook
(
Ãt_bridge_pÜt
 *
p
, sk_bufà*
skb
);

66 
sk_buff
 *(*
»®_br_hªdË_äame_hook
)(
Ãt_bridge_pÜt
 *
p
, sk_bufà*
skb
);

67 
deviû_nÙif›r_hook_—¾y
(
nÙif›r_block
 *
nb
, 
v®
, *
v
);

69 
deviû_nÙif›r_hook
(
nÙif›r_block
 *
nb
, 
v®
, *
v
);

73 
FromDeviû
::
	$¡©ic_š™Ÿlize
()

75 
äom_deviû_m­
.
	`š™Ÿlize
();

76 #ià
HAVE_CLICK_KERNEL


77 
·ck‘_nÙif›r
.
nÙif›r_ÿÎ
 = 
·ck‘_nÙif›r_hook
;

78 
·ck‘_nÙif›r
.
´iÜ™y
 = 1;

79 
·ck‘_nÙif›r
.
Ãxt
 = 0;

81 #ià
CLICK_FROMDEVICE_USE_BRIDGE


82 
deviû_nÙif›r_—¾y
.
nÙif›r_ÿÎ
 = 
deviû_nÙif›r_hook_—¾y
;

83 
deviû_nÙif›r_—¾y
.
´iÜ™y
 = 
INT_MAX
;

84 
deviû_nÙif›r_—¾y
.
Ãxt
 = 0;

85 
	`»gi¡”_Ãtdeviû_nÙif›r
(&
deviû_nÙif›r_—¾y
);

87 
deviû_nÙif›r
.
nÙif›r_ÿÎ
 = 
deviû_nÙif›r_hook
;

88 
deviû_nÙif›r
.
´iÜ™y
 = 
INT_MIN
;

89 
deviû_nÙif›r
.
Ãxt
 = 0;

90 
	`»gi¡”_Ãtdeviû_nÙif›r
(&
deviû_nÙif›r
);

91 
	}
}

94 
FromDeviû
::
	$¡©ic_ş—nup
()

96 #ià
HAVE_CLICK_KERNEL


97 ià(
»gi¡”ed_»ad”s
)

98 
	`uÄegi¡”_Ãt_š
(&
·ck‘_nÙif›r
);

99 #–ià
CLICK_FROMDEVICE_USE_BRIDGE


100 ià(
br_hªdË_äame_hook
 =ğ
şick_br_hªdË_äame_hook
)

101 
br_hªdË_äame_hook
 = 
»®_br_hªdË_äame_hook
;

102 
	`uÄegi¡”_Ãtdeviû_nÙif›r
(&
deviû_nÙif›r_—¾y
);

104 
	`uÄegi¡”_Ãtdeviû_nÙif›r
(&
deviû_nÙif›r
);

105 
	}
}

107 
FromDeviû
::
	$FromDeviû
()

109 
	`£t_h—d
(0);

110 
	`£t_
(0);

111 
	}
}

113 
FromDeviû
::~
	$FromDeviû
()

115 
	}
}

118 
FromDeviû
::
	$ÿ¡
(cÚ¡ *
n
)

120 ià(
	`¡rcmp
(
n
, "Storage") == 0)

121  (
StÜage
 *)
this
;

122 ià(
	`¡rcmp
(
n
, "FromDevice") == 0)

123  (
EËm’t
 *)
this
;

126 
	}
}

129 
FromDeviû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

131 
_bur¡
 = 8;

132 
_aùive
 = 
Œue
;

133 
SŒšg
 
®ignm’t
;

134 ià(
AnyDeviû
::
cÚfigu»_keywÜds
(
cÚf
, 
”rh
, 
Œue
) < 0

135 || (
Args
(
cÚf
, 
this
, 
”rh
)

136 .
»ad_mp
("DEVNAME", 
_devÇme
)

137 .
»ad_p
("BURST", 
_bur¡
)

138 .
»ad
("ACTIVE", 
_aùive
)

139 .
»ad
("ALIGNMENT", 
AnyArg
(), 
®ignm’t
)

140 .
com¶‘e
() < 0))

144 
£t_h—d
(0);

145 
£t_
(0);

146 
_ÿ·c™y
 = 0;

148 
Ãt_deviû
 *
dev
 = 
lookup_deviû
(
”rh
);

149 
£t_deviû
(
dev
, &
äom_deviû_m­
, 
ªydev_äom_deviû
);

150  
”rh
->
Ã¼Üs
() ? -1 : 0;

158 
FromDeviû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

160 ià(
AnyDeviû
::
	`š™Ÿlize_keywÜds
(
”rh
) < 0)

164 ià(
	`ifšdex
() >= 0) {

165 *&
u£d
 = 
	`rou‹r
()->
	`fÜû_©chm’t
("deviû_»ad”_" + 
	`SŒšg
(
	`ifšdex
()));

166 ià(
u£d
)

167  
”rh
->
	`”rÜ
("deviû %<%s%> ha du¶iÿ‹„—d”", 
_devÇme
.
	`c_¡r
());

168 
u£d
 = 
this
;

171 ià(
»gi¡”ed_»ad”s
 == 0) {

172 #ià
HAVE_CLICK_KERNEL


173 
·ck‘_nÙif›r
.
Ãxt
 = 0;

174 
	`»gi¡”_Ãt_š
(&
·ck‘_nÙif›r
);

175 #–ià
CLICK_FROMDEVICE_USE_BRIDGE


176 
»®_br_hªdË_äame_hook
 = 
br_hªdË_äame_hook
;

177 
br_hªdË_äame_hook
 = 
şick_br_hªdË_äame_hook
;

178 #–ià
HAVE_LINUX_NETDEV_RX_HANDLER_REGISTER


181 
”rh
->
	`w¬nšg
("can't get…ackets:‚ot compiled for‡ Click kernel");

184 ++
»gi¡”ed_»ad”s
;

186 
	`»£t_couÁs
();

188 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_dev
 !ğ0, 
”rh
);

189 #ià
HAVE_STRIDE_SCHED


191 
_max_tick‘s
 = 
_sk
.
	`tick‘s
();

192 
_sk
.
	`£t_tick‘s
(
Task
::
DEFAULT_TICKETS
);

195 
i
 = 0; i < 
QSIZE
; i ++) {

196 
_queue
[
i
] = 0;

200 
_ÿ·c™y
 = 
QSIZE
;

203 
	}
}

206 
FromDeviû
::
	$ş—nup
(
CËªupSge
 
¡age
)

208 ià(
¡age
 >ğ
CLEANUP_INITIALIZED
) {

209 --
»gi¡”ed_»ad”s
;

210 ià(
»gi¡”ed_»ad”s
 == 0) {

211 #ià
HAVE_CLICK_KERNEL


212 
	`uÄegi¡”_Ãt_š
(&
·ck‘_nÙif›r
);

213 #–ià
CLICK_FROMDEVICE_USE_BRIDGE


214 
br_hªdË_äame_hook
 = 
»®_br_hªdË_äame_hook
;

219 
	`ş—r_deviû
(&
äom_deviû_m­
, 
ªydev_äom_deviû
);

221 ià(
¡age
 >ğ
CLEANUP_INITIALIZED
)

222 
StÜage
::
šdex_ty³
 
i
 = 
	`h—d
(); i !ğ
	`
(); i = 
	`Ãxt_i
(i))

223 
_queue
[
i
]->
	`kl
();

224 
	`£t_h—d
(0);

225 
	`£t_
(0);

226 
	}
}

229 
FromDeviû
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *
”rh
)

231 ià(
FromDeviû
 *
fd
 = (FromDeviû *)
e
->
	`ÿ¡
("FromDevice")) {

232 
SpšlockIRQ
::
æags_t
 
æags
;

233 
	`loÿl_œq_§ve
(
æags
);

235 
StÜage
::
šdex_ty³
 
fd_i
 = 
fd
->
	`h—d
();

236 
fd_i
 !ğ
fd
->
	`
()) {

237 
StÜage
::
šdex_ty³
 
t
 = 
fd
->
	`
(), 
Á
 = 
	`Ãxt_i
(t);

238 ià(
Á
 =ğ
fd
->
	`h—d
())

240 
_queue
[
t
] = 
fd
->_queue[
fd_i
];

241 
fd_i
 = 
fd
->
	`Ãxt_i
(fd_i);

242 
	`£t_
(
Á
);

244 ; 
fd_i
 !ğ
fd
->
	`
(); fd_˜ğfd->
	`Ãxt_i
(fd_i))

245 
fd
->
_queue
[
fd_i
]->
	`kl
();

246 ià(
	`h—d
(è!ğ
	`
())

247 
_sk
.
	`»scheduË
();

249 
fd
->
	`£t_h—d
(0);

250 
fd
->
	`£t_
(0);

251 
fd
->
_ÿ·c™y
 = 0;

252 
_highw©”_Ëngth
 = 
	`size
();

254 
	`loÿl_œq_»¡Üe
(
æags
);

256 
	}
}

263 #ià
HAVE_CLICK_KERNEL


265 
·ck‘_nÙif›r_hook
(
nÙif›r_block
 *
nb
, 
backlog_Ën
, *
v
)

267 
sk_buff
 *
skb
 = (sk_bufà*)
v
;

268 
¡Ş’
 = 0;

269 
FromDeviû
 *
fd
 = 0;

270 
lock_æags
;

271 
äom_deviû_m­
.
lock
(
çl£
, 
lock_æags
);

272 
¡Ş’
 =ğ0 && (
fd
 = (
FromDeviû
 *)
äom_deviû_m­
.
lookup
(
skb
->
dev
, fd)))

273 
¡Ş’
 = 
fd
->
gÙ_skb
(
skb
);

274 
äom_deviû_m­
.
uÆock
(
çl£
, 
lock_æags
);

275  (
¡Ş’
 ? 
NOTIFY_STOP_MASK
 : 0);

278 #–ià
CLICK_FROMDEVICE_USE_BRIDGE


279 
sk_buff
 *

280 
şick_br_hªdË_äame_hook
(
Ãt_bridge_pÜt
 *
p
, 
sk_buff
 *
skb
)

282 #ià
CLICK_DEVICE_UNRECEIVABLE_SK_BUFF


283 ià(
CLICK_DEVICE_UNRECEIVABLE_SK_BUFF_READ
(è=ğ
skb
)

285  
skb
;

288 
¡Ş’
 = 0;

289 
FromDeviû
 *
fd
 = 0;

290 
lock_æags
;

292 
äom_deviû_m­
.
lock
(
çl£
, 
lock_æags
);

293 
¡Ş’
 =ğ0 && (
fd
 = (
FromDeviû
 *)
äom_deviû_m­
.
lookup
(
skb
->
dev
, fd)))

294 
¡Ş’
 = 
fd
->
gÙ_skb
(
skb
);

295 
äom_deviû_m­
.
uÆock
(
çl£
, 
lock_æags
);

296 ià(
¡Ş’
)

298 ià(
»®_br_hªdË_äame_hook
)

299  
»®_br_hªdË_äame_hook
(
p
, 
skb
);

301  
skb
;

304 #–ià
HAVE_LINUX_NETDEV_RX_HANDLER_REGISTER


305 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 39)

306 
rx_hªdËr_»suÉ_t


307 
şick_äomdeviû_rx_hªdËr
(
sk_buff
 **
pskb
)

309 
sk_buff
 *

310 
şick_äomdeviû_rx_hªdËr
(
sk_buff
 *
skb
)

311 
	#RX_HANDLER_PASS
 
skb


	)

312 
	#RX_HANDLER_CONSUMED
 0

	)

315 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 39)

316 
sk_buff
 *
skb
 = *
pskb
;

318 #ià
CLICK_DEVICE_UNRECEIVABLE_SK_BUFF


319 ià(
CLICK_DEVICE_UNRECEIVABLE_SK_BUFF_READ
(è=ğ
skb
)

321  
RX_HANDLER_PASS
;

324 
¡Ş’
 = 0;

325 
FromDeviû
 *
fd
 = 0;

326 
lock_æags
;

328 
äom_deviû_m­
.
lock
(
çl£
, 
lock_æags
);

329 
¡Ş’
 =ğ0 && (
fd
 = (
FromDeviû
 *)
äom_deviû_m­
.
lookup
(
skb
->
dev
, fd)))

330 
¡Ş’
 = 
fd
->
gÙ_skb
(
skb
);

331 
äom_deviû_m­
.
uÆock
(
çl£
, 
lock_æags
);

332 ià(
¡Ş’
)

333  
RX_HANDLER_CONSUMED
;

335  
RX_HANDLER_PASS
;

339 #ià
CLICK_FROMDEVICE_USE_BRIDGE


341 
deviû_nÙif›r_hook_—¾y
(
nÙif›r_block
 *
nb
, 
æags
, *
v
)

343 
lock_æags
;

344 
Ãt_deviû
* 
dev
 = (Ãt_deviû*)
v
;

345 
AnyDeviû
 *
es
[8];

346 
i
, 
Ãs
;

348 #ifdeà
NETDEV_GOING_DOWN


349 ià(
æags
 =ğ
NETDEV_GOING_DOWN
)

350 
æags
 = 
NETDEV_DOWN
;

352 ià(
æags
 =ğ
NETDEV_DOWN
 || fÏg =ğ
NETDEV_UP
 || fÏg =ğ
NETDEV_CHANGE
) {

353 
boŞ
 
exi¡s
 = (
æags
 !ğ
NETDEV_UP
);

354 
äom_deviû_m­
.
lock
(
Œue
, 
lock_æags
);

355 
Ãs
 = 
äom_deviû_m­
.
lookup_®l
(
dev
, 
exi¡s
, 
es
, 8);

356 
i
 = 0; i < 
Ãs
; i++)

357 ((
FromDeviû
*)(
es
[
i
]))->
®‹r_äom_deviû
(-1);

358 
äom_deviû_m­
.
uÆock
(
Œue
, 
lock_æags
);

366 
deviû_nÙif›r_hook
(
nÙif›r_block
 *
nb
, 
æags
, *
v
)

368 #ifdeà
NETDEV_GOING_DOWN


369 ià(
æags
 =ğ
NETDEV_GOING_DOWN
)

370 
æags
 = 
NETDEV_DOWN
;

372 ià(
æags
 =ğ
NETDEV_DOWN
 || fÏg =ğ
NETDEV_UP
 || fÏg =ğ
NETDEV_CHANGE
) {

373 
boŞ
 
exi¡s
 = (
æags
 !ğ
NETDEV_UP
);

374 
Ãt_deviû
* 
dev
 = (Ãt_deviû*)
v
;

375 
lock_æags
;

376 
äom_deviû_m­
.
lock
(
Œue
, 
lock_æags
);

377 
AnyDeviû
 *
es
[8];

378 
Ãs
 = 
äom_deviû_m­
.
lookup_®l
(
dev
, 
exi¡s
, 
es
, 8);

379 
i
 = 0; i < 
Ãs
; i++)

380 ((
FromDeviû
*)(
es
[
i
]))->
£t_deviû
(
æags
 =ğ
NETDEV_DOWN
 ? 0 : 
dev
, &
äom_deviû_m­
, 
AnyDeviû
::
ªydev_chªge
 | AnyDeviû::
ªydev_äom_deviû
);

381 
äom_deviû_m­
.
uÆock
(
Œue
, 
lock_æags
);

392 
FromDeviû
::
	$gÙ_skb
(
sk_buff
 *
skb
)

394 ià(!
_aùive
)

397 
skb
 = 
	`skb_sh¬e_check
(skb, 
GFP_ATOMIC
);

398 ià(!
skb
)

400 
	`as£¹
(
	`skb_sh¬ed
(
skb
) == 0);

401 
t
 = 
	`»£rve__©omic
();

402 ià(
t
 !ğ
šv®id_šdex
) {

405 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 24)

406 
	`skb_push
(
skb
, skb->
d©a
 - 
	`skb_mac_h—d”
(skb));

408 
	`skb_push
(
skb
, skb->
d©a
 - skb->
mac
.
¿w
);

411 
Pack‘
 *
p
 = Pack‘::
	`make
(
skb
);

412 
_queue
[
t
] = 
p
;

414 #ià
CLICK_DEBUG_SCHEDULING


415 
_schšfo
[
t
].
’q_time
.
	`assign_now
();

416 
Rou‹rTh»ad
 *
¹
 = 
_sk
.
	`th»ad
();

417 
_schšfo
[
t
].
’q_¡©e
 = 
¹
->
	`th»ad_¡©e
();

418 
’q_´oûss_a¦“p
 = 
¹
->
	`¦“³r
(è&&„t->¦“³r()->
¡©e
 !ğ
TASK_RUNNING
;

419 
_schšfo
[
t
].
’q_sk_scheduËd
 = 
_sk
.
	`scheduËd
();

420 
_schšfo
[
t
].
’q_•och
 = 
¹
->
	`driv”_•och
();

421 
_schšfo
[
t
].
’q_sk_•och
 = 
¹
->
	`driv”_sk_•och
();

424 
_sk
.
	`»scheduË
();

426 #ià
CLICK_DEBUG_SCHEDULING


427 
_schšfo
[
t
].
’q_woke_´oûss
 = 
’q_´oûss_a¦“p
 && 
¹
->
	`¦“³r
()->
¡©e
 =ğ
TASK_RUNNING
;

430 
s
 = 
	`size
(
	`h—d
(), 
	`
());

431 ià(
s
 > 
_highw©”_Ëngth
)

432 
_highw©”_Ëngth
 = 
s
;

434 } ià(
_ÿ·c™y
 > 0) {

436 
	`kä“_skb
(
skb
);

437 
_drİs
++;

443 
	}
}

445 #ià
CLICK_DEBUG_SCHEDULING


447 
FromDeviû
::
	$emissiÚ_»pÜt
(
idx
)

449 
Time¡amp
 
now
 = Time¡amp::
	`now
();

450 
Rou‹rTh»ad
 *
¹
 = 
_sk
.
	`th»ad
();

451 
SŒšgAccum
 
§
;

452 
§
 << "dˆ" << (
now
 - 
_schšfo
[
idx
].
’q_time
);

453 ià(
_schšfo
[
idx
].
’q_¡©e
 !ğ
Rou‹rTh»ad
::
S_RUNNING
) {

454 
Time¡amp
 
‘ime
 = 
¹
->
	`sk_•och_time
(
_schšfo
[
idx
].
’q_sk_•och
 + 1);

455 ià(
‘ime
)

456 
§
 << " dt_th»ad " << (
‘ime
 - 
_schšfo
[
idx
].
’q_time
);

458 
§
 << "‡¼¡ " << 
Rou‹rTh»ad
::
	`th»ad_¡©e_Çme
(
_schšfo
[
idx
].
’q_¡©e
)

459 << " d•och " << (
¹
->
	`driv”_•och
(è- 
_schšfo
[
idx
].
’q_•och
)

460 << " d‹poch " << (
¹
->
	`driv”_sk_•och
(è- 
_schšfo
[
idx
].
’q_sk_•och
);

461 ià(
_schšfo
[
idx
].
’q_woke_´oûss
)

462 
§
 << " woke";

463 ià(
_schšfo
[
idx
].
’q_sk_scheduËd
)

464 
§
 << "asksched";

466 
	`şick_ch©‹r
("% ·ck‘: %s", 
	`Çme
().
	`c_¡r
(), 
§
.c_str());

467 
	}
}

470 
boŞ


471 
FromDeviû
::
	$run_sk
(
Task
 *)

473 
_runs
++;

474 
Åq
 = 0;

475 
StÜage
::
šdex_ty³
 
h
;

476 
Åq
 < 
_bur¡
 && (
h
 = 
	`h—d
()è!ğ
	`
()) {

477 
Pack‘
 *
p
 = 
_queue
[
h
];

478 ià(
p
 =ğ
NULL
) {

479 
_sk
.
	`ç¡_»scheduË
();

480  
Åq
 > 0;

482 
_queue
[
h
] = 0;

483 #ià
CLICK_DEBUG_SCHEDULING


484 
	`emissiÚ_»pÜt
(
h
);

486 
	`£t_h—d
(
	`Ãxt_i
(
h
));

487 
	`ouut
(0).
	`push
(
p
);

488 
Åq
++;

489 
_couÁ
++;

491 ià(
Åq
 == 0)

492 
_em±y_runs
++;

500 ià(
Åq
 > 0)

501 
_sk
.
	`ç¡_»scheduË
();

502  
Åq
 > 0;

503 
	}
}

505 
SŒšg
 
FromDeviû
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

507 
FromDeviû
 *
fd
 = 
¡©ic_ÿ¡
<FromDeviû *>(
e
);

508 
SŒšgAccum
 
§
;

509 
»š‹½»t_ÿ¡
<
šŒ_t
>(
thunk
)) {

510 
h_aùive
:

511 
§
 << (
fd
->
_dev
 && fd->
_aùive
);

513 
h_Ëngth
:

514 
§
 << 
fd
->
	`size
();

516 
h_ÿÎs
:

517 
§
 << "ÿÎ tØrun_sk(): " << 
fd
->
_runs
 << "\n"

518 << "ÿÎ tØpush(): " << 
fd
->
_couÁ
 << "\n"

519 << "em±y„uns: " << 
fd
->
_em±y_runs
 << "\n"

520 << "drİs: " << 
fd
->
_drİs
 << "\n";

523  
§
.
	`ke_¡ršg
();

524 
	}
}

526 
FromDeviû
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

528 
FromDeviû
 *
fd
 = 
¡©ic_ÿ¡
<FromDeviû *>(
e
);

529 
»š‹½»t_ÿ¡
<
šŒ_t
>(
thunk
)) {

530 
h_aùive
:

531 ià(!
	`BoŞArg
().
	`·r£
(
¡r
, 
fd
->
_aùive
))

532  
”rh
->
	`”rÜ
("active…arameter must be boolean");

534 
h_»£t_couÁs
:

535 
fd
->
	`»£t_couÁs
();

540 
	}
}

543 
FromDeviû
::
	$add_hªdËrs
()

545 
	`add_sk_hªdËrs
(&
_sk
);

546 
	`add_»ad_hªdËr
("aùive", 
»ad_hªdËr
, 
h_aùive
, 
HªdËr
::
CHECKBOX
);

547 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
OP_READ
, &
_couÁ
);

548 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

549 
	`add_»ad_hªdËr
("Ëngth", 
»ad_hªdËr
, 
h_Ëngth
);

550 
	`add_d©a_hªdËrs
("highw©”_Ëngth", 
HªdËr
::
OP_READ
, &
_highw©”_Ëngth
);

551 
	`add_»ad_hªdËr
("ÿÎs", 
»ad_hªdËr
, 
h_ÿÎs
);

552 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 
h_aùive
);

553 
	`add_wr™e_hªdËr
("»£t_couÁs", 
wr™e_hªdËr
, 
h_»£t_couÁs
, 
HªdËr
::
BUTTON
);

554 
	}
}

556 #undeà
CLICK_FROMDEVICE_USE_BRIDGE


557 
	$ELEMENT_REQUIRES
(
AnyDeviû
 
lšuxmoduË
 
çl£
)

558 
	`EXPORT_ELEMENT
(
FromDeviû
)

	@linuxmodule/fromdevice.hh

2 #iâdeà
CLICK_FROMDEVICE_HH


3 
	#CLICK_FROMDEVICE_HH


	)

132 
	~"–em’ts/lšuxmoduË/ªydeviû.hh
"

133 
	~<şick/¡ªd¬d/¡Üage.hh
>

135 
şass
 
	gFromDeviû
 : 
public
 
AnyTaskDeviû
,…ubliø
	gStÜage
 { 
	gpublic
:

137 
FromDeviû
(è
CLICK_COLD
;

138 ~
FromDeviû
(è
	gCLICK_COLD
;

140 
¡©ic_š™Ÿlize
();

141 
¡©ic_ş—nup
();

143 cÚ¡ *
şass_Çme
() const {  "FromDevice"; }

144 cÚ¡ *
pÜt_couÁ
(ècÚ¡ {  
	gPORTS_0_1
; }

145 cÚ¡ *
´oûssšg
(ècÚ¡ {  
	gPUSH
; }

146 *
ÿ¡
(const *);

148 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

149 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

150 
ş—nup
(
CËªupSge
è
	gCLICK_COLD
;

151 
add_hªdËrs
(è
	gCLICK_COLD
;

152 
ke_¡©e
(
EËm’t
 *, 
E¼ÜHªdËr
 *);

155 
gÙ_skb
(
sk_buff
 *);

157 
boŞ
 
run_sk
(
Task
 *);

158 
»£t_couÁs
() {

159 
	g_runs
 = 
_em±y_runs
 = 
_couÁ
 = 
_drİs
 = 0;

160 
	g_highw©”_Ëngth
 = 
StÜage
::
size
();

163 
	g´iv©e
:

165 
boŞ
 
_aùive
;

166 
	g_bur¡
;

167 
	g_drİs
;

168 
	g_highw©”_Ëngth
;

170 
	g_runs
;

171 
	g_em±y_runs
;

172 
	g_couÁ
;

174 ’um { 
	gQSIZE
 = 511 };

175 
Pack‘
 * vŞ©
	g_queue
[
QSIZE
+1];

176 #ià
CLICK_DEBUG_SCHEDULING


177 
	sSchšfo
 {

178 
Time¡amp
 
	g’q_time
;

179 
	g’q_¡©e
;

180 
	g’q_woke_´oûss
;

181 
	g’q_sk_scheduËd
;

182 
ušt32_t
 
	g’q_•och
;

183 
ušt32_t
 
	g’q_sk_•och
;

185 
Schšfo
 
	g_schšfo
[
QSIZE
+1];

186 
emissiÚ_»pÜt
();

189 ’um { 
	gh_aùive
, 
	gh_ÿÎs
, 
	gh_»£t_couÁs
, 
	gh_Ëngth
 };

190 
SŒšg
 
»ad_hªdËr
(
EËm’t
 *, *è
	gCLICK_COLD
;

191 
wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

196 #ià
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2, 6, 39)

197 
sk_buff
 *
şick_äomdeviû_rx_hªdËr
(sk_bufà*
skb
);

199 
rx_hªdËr_»suÉ_t
 
şick_äomdeviû_rx_hªdËr
(
sk_buff
 **
pskb
);

	@linuxmodule/fromhost.cc

22 
	~<şick/cÚfig.h
>

23 
	~<şick/rou‹r.hh
>

24 
	~"äomho¡.hh
"

25 
	~<şick/¬gs.hh
>

26 
	~<şick/”rÜ.hh
>

27 
	~<şick/¡¿ccum.hh
>

28 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

29 
	~<şickÃt/6.h
>

31 
	~<şick/cxx´Ùeù.h
>

32 
	gCLICK_CXX_PROTECT


33 
	~<asm/ty³s.h
>

34 
	~<asm/uacûss.h
>

35 
	~<lšux/.h
>

36 
	~<lšux/š‘deviû.h
>

37 
	~<lšux/if_¬p.h
>

38 
	~<lšux/‘h”deviû.h
>

39 
	~<Ãt/rou‹.h
>

40 
	~<Ãt/d¡.h
>

41 
	~<Ãt/š‘_commÚ.h
>

42 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 24)

43 
	~<Ãt/Ãt_Çme¥aû.h
>

45 
	gCLICK_CXX_UNPROTECT


46 
	~<şick/cxxuÅrÙeù.h
>

48 #ià
HAVE_LINUX_INET_CTL_SOCK_CREATE


49 
	#şick_š‘_ioùl
(
sock
, 
dev
, 
cmd
, 
¬g
è
	`š‘_ioùl
((sock), (cmd), (¬g))

	)

50 #–ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 27)

51 
	#şick_š‘_ioùl
(
sock
, 
dev
, 
cmd
, 
¬g
è
	`devš‘_ioùl
(
	`dev_Ãt
(dev), (cmd), (¬g))

	)

53 
	#şick_š‘_ioùl
(
sock
, 
dev
, 
cmd
, 
¬g
è
	`devš‘_ioùl
((cmd), (¬g))

	)

56 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 27)

57 
	#şick_dev_ioùl
(
dev
, 
cmd
, 
¬g
è
	`dev_ioùl
(
	`dev_Ãt
(dev), (cmd), (¬g))

	)

58 #–ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 24)

59 
	#şick_dev_ioùl
(
dev
, 
cmd
, 
¬g
è
	`dev_ioùl
(&
š™_Ãt
, (cmd), (¬g))

	)

61 
	#şick_dev_ioùl
(
dev
, 
cmd
, 
¬g
è
	`dev_ioùl
((cmd), (¬g))

	)

64 #iâdeà
NETDEV_TX_OK


65 
	#NETDEV_TX_OK
 0

	)

66 
	#NETDEV_TX_BUSY
 1

	)

70 
æ_İ’
(
Ãt_deviû
 *);

71 
æ_şo£
(
Ãt_deviû
 *);

72 
æ_wakeup
(
Tim”
 *, *);

75 
FromHo¡
 *FromHo¡::
cÚfiguršg
 = 0;

76 
AnyDeviûM­
 
	gäomlšux_m­
;

78 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 32)

79 
Ãt_deviû_İs
 
	gäomho¡_Ãtdev_İs
;

80 
	#Ãtdev_İ
(
dev
, 
İÇme
è(dev)->
Ãtdev_İs
->
ndo_
##
	)
opname

82 
	#Ãtdev_İ
(
dev
, 
İÇme
è(dev)->
	)
opname

86 
	gFromHo¡
::
	$¡©ic_š™Ÿlize
()

88 
äomlšux_m­
.
	`š™Ÿlize
();

89 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 32)

90 
äomho¡_Ãtdev_İs
.
ndo_İ’
 = 
æ_İ’
;

91 
äomho¡_Ãtdev_İs
.
ndo_¡İ
 = 
æ_şo£
;

92 
äomho¡_Ãtdev_İs
.
ndo_¡¬t_xm™
 = 
æ_tx
;

93 
äomho¡_Ãtdev_İs
.
ndo_£t_mac_add»ss
 = 
‘h_mac_addr
;

95 
	}
}

97 
	gFromHo¡
::
	$FromHo¡
()

98 : 
	`_maÿddr
((const *)"\000\001\002\003\004\005"),

99 
	`_sk
(
this
), 
	`_wakeup_tim”
(
æ_wakeup
,his),

100 
	`_drİs
(0), 
	$_nšv®id
(0)

102 
	`£t_h—d
(0);

103 
	`£t_
(0);

104 
_ÿ·c™y
 = 100;

105 
_q
.
lgq
 = 0;

106 #ià
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2, 6, 32)

107 
	`mem£t
(&
_¡©s
, 0, (_stats));

109 
	}
}

111 
	gFromHo¡
::~
	$FromHo¡
()

113 
	}
}

115 *
FromHo¡
::
	$ÿ¡
(cÚ¡ *
Çme
)

117 ià(
	`¡rcmp
(
Çme
, "Storage") == 0)

118  (
StÜage
 *)
this
;

119 ià(
	`¡rcmp
(
Çme
, "FromHost") == 0)

120  (
EËm’t
 *)
this
;

123 
	}
}

125 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 0)

127 
äomho¡_š‘_£tup
(
Ãt_deviû
 *
dev
)

129 
dev
->
ty³
 = 
ARPHRD_NONE
;

130 
dev
->
h¬d_h—d”_Ën
 = 0;

131 
dev
->
addr_Ën
 = 0;

132 
dev
->
mtu
 = 1500;

133 
dev
->
æags
 = 
IFF_POINTOPOINT
 | 
IFF_NOARP
 | 
IFF_MULTICAST
;

138 
Ãt_deviû
 *

139 
FromHo¡
::
	$Ãw_deviû
(cÚ¡ *
Çme
)

141 (*
£tup
)(
Ãt_deviû
 *èğ(
_maÿddr
 ? 
‘h”_£tup
 : 
äomho¡_š‘_£tup
);

142 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 0)

143 
Ãt_deviû
 *
dev
 = 
	`®loc_Ãtdev
(0, 
Çme
, 
£tup
);

145 
”rcode
;

146 
	`»ad_lock
(&
dev_ba£_lock
);

147 
Ãt_deviû
 *
dev
 = 
	`dev_®loc
(
Çme
, &
”rcode
);

148 
	`»ad_uÆock
(&
dev_ba£_lock
);

150 ià(!
dev
)

153 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 32)

154 
dev
->
Ãtdev_İs
 = &
äomho¡_Ãtdev_İs
;

155 #–ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 0)

156 
dev
->
İ’
 = 
æ_İ’
;

157 
dev
->
¡İ
 = 
æ_şo£
;

158 
dev
->
h¬d_¡¬t_xm™
 = 
æ_tx
;

159 
dev
->
g‘_¡©s
 = 
æ_¡©s
;

161 
	`£tup
(
dev
);

163 
dev
->
mtu
 = 
_mtu
;

164 
dev
->
tx_queue_Ën
 = 0;

165 
dev
->
ifšdex
 = -1;

166  
dev
;

167 
	}
}

170 
FromHo¡
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

172 
SŒšg
 
ty³
;

173 
mtu
 = 1500;

174 
_de¡addr
 = 
IPAdd»ss
();

175 
_de¡mask
 = 
IPAdd»ss
();

176 
_ş—r_ªno
 = 
Œue
;

177 
_bur¡
 = 8;

179 ià(
Args
(
cÚf
, 
this
, 
”rh
)

180 .
»ad_mp
("DEVNAME", 
_devÇme
)

181 .
»ad_p
("PREFIX", 
IPP»fixArg
(), 
_de¡addr
, 
_de¡mask
)

182 .
»ad
("TYPE", 
WÜdArg
(), 
ty³
)

183 .
»ad
("ETHER", 
_maÿddr
)

184 .
»ad
("MTU", 
mtu
)

185 .
»ad
("CAPACITY", 
_ÿ·c™y
)

186 .
»ad
("CLEAR_ANNO", 
_ş—r_ªno
)

187 .
»ad
("BURST", 
BoundedIÁArg
(1, 1000000), 
_bur¡
)

188 .
com¶‘e
() < 0)

192 ià(
_devÇme
.
Ëngth
(è> 
IFNAMSIZ
 - 1)

193  
”rh
->
”rÜ
("deviû‚am'%s'oØlÚg", 
_devÇme
.
c_¡r
());

194 *&
u£d
 = 
rou‹r
()->
fÜû_©chm’t
("FromHo¡_" + 
_devÇme
);

195 ià(
u£d
)

196  
”rh
->
”rÜ
("du¶iÿ‹ FromHo¡ fÜ deviû '%s'", 
_devÇme
.
c_¡r
());

197 
u£d
 = 
this
;

199 
_mtu
 = 
mtu
;

201 
_dev
 = 
AnyDeviû
::
g‘_by_Çme
(
_devÇme
.
c_¡r
());

202 ià(
_dev
) {

203 ià(
Ãtdev_İ
(
_dev
, 
İ’
è!ğ
æ_İ’
) {

204 
dev_put
(
_dev
);

205 
_dev
 = 0;

206  
”rh
->
”rÜ
("deviû '%s'‡Ì—dyƒxi¡s", 
_devÇme
.
c_¡r
());

208 
äomlšux_m­
.
š£¹
(
this
, 
çl£
);

214 ià(
ty³
 == "IP")

215 
_maÿddr
 = 
Eth”Add»ss
();

216 ià(
ty³
 != "ETHER" &&ype != "")

217  
”rh
->
”rÜ
("bad TYPE");

220 ià(
_ÿ·c™y
 < 1)

221 
_ÿ·c™y
 = 1;

222 ià(
_ÿ·c™y
 > 
smq_size
)

223 ià(!(
_q
.
lgq
 = 
Ãw
 
Pack‘
 *[
_ÿ·c™y
 + 1]))

224  
”rh
->
”rÜ
("out of memory!");

227 
»s
;

228 
_dev
 = 
Ãw_deviû
(
_devÇme
.
c_¡r
());

229 ià(!
_dev
)

230  
”rh
->
”rÜ
("ouˆoàmemÜy„egi¡”šg deviû '%s'", 
_devÇme
.
c_¡r
());

235 
dev_hŞd
(
_dev
);

236 
cÚfiguršg
 = 
this
;

237 
»s
 = 
»gi¡”_Ãtdev
(
_dev
);

238 
cÚfiguršg
 = 0;

239 ià(
»s
 == 0)

240 
äomlšux_m­
.
š£¹
(
this
, 
çl£
);

242 
dev_put
(
_dev
);

243 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 0)

244 
ä“_Ãtdev
(
_dev
);

246 
kä“
(
_dev
);

248 
_dev
 = 0;

249  
”rh
->
”rÜ
("”rÜ %d„egi¡”šg deviû '%s'", 
»s
, 
_devÇme
.
c_¡r
());

257 
FromHo¡
::
	$£t_deviû_add»s£s
(
E¼ÜHªdËr
 *
”rh
)

259 
»s
 = 0;

260 
iäeq
 
iä
;

261 
	`¡ºıy
(
iä
.
iä_Çme
, 
_dev
->
Çme
, 
IFNAMSIZ
);

262 
sockaddr_š
 *
sš
 = (sockaddr_š *)&
iä
.
iä_addr
;

263 
mm_£gm’t_t
 
Şdfs
;

265 ià(
_maÿddr
) {

266 
iä
.
iä_hwaddr
.
§_çmy
 = 
_dev
->
ty³
;

267 
	`memıy
(
iä
.
iä_hwaddr
.
§_d©a
, 
_maÿddr
.
	`d©a
(), 6);

268 #ià
HAVE_LINUX_DEV_IOCTL


269 
Şdfs
 = 
	`g‘_fs
();

270 
	`£t_fs
(
	`g‘_ds
());

271 
»s
 = 
	`şick_dev_ioùl
(
_dev
, 
SIOCSIFHWADDR
, &
iä
);

272 
	`£t_fs
(
Şdfs
);

274 
	`¹Æ_lock
();

275 
»s
 = 
	`dev_£t_mac_add»ss
(
_dev
, &
iä
.
iä_hwaddr
);

276 
	`¹Æ_uÆock
();

278 ià(
»s
)

279 
”rh
->
	`”rÜ
("error %d setting hardware‡ddress for device '%s'",

280 
»s
, 
_devÇme
.
	`c_¡r
());

283 ià(
_de¡addr
) {

284 #ià
HAVE_LINUX_DEVINET_IOCTL
 || 
HAVE_LINUX_INET_CTL_SOCK_CREATE


285 
sš
->
sš_çmy
 = 
AF_INET
;

286 
sš
->
sš_addr
 = 
_de¡addr
;

287 #ià
HAVE_LINUX_INET_CTL_SOCK_CREATE


288 
sock‘
 *
sock
 = (sock‘*è
	`km®loc
((sock‘), 
GFP_KERNEL
);

289 
sock
->
sk
 = 0;

290 ià(
»s
 >ğ0 && (» ğ
	`š‘_ùl_sock_ü—‹
(&
sock
->
sk
, 
AF_INET
, 
SOCK_RAW
, 
IPPROTO_TCP
, 
	`dev_Ãt
(
_dev
))) != 0) {

291 
”rh
->
	`”rÜ
("”rÜ %d c»©šg cÚŒŞ sock‘ fÜ deviû '%s'", 
»s
, 
_devÇme
.
	`c_¡r
());

292 
»s
 = -1;

295 
Şdfs
 = 
	`g‘_fs
();

296 
	`£t_fs
(
	`g‘_ds
());

297 ià(
»s
 >ğ0 && (» ğ
	`şick_š‘_ioùl
(
sock
, 
_dev
, 
SIOCSIFADDR
, &
iä
)) < 0)

298 
”rh
->
	`”rÜ
("”rÜ %d s‘tšg‡dd»s fÜ deviû '%s'", 
»s
, 
_devÇme
.
	`c_¡r
());

300 
sš
->
sš_addr
 = 
_de¡mask
;

301 ià(
»s
 >ğ0 && (» ğ
	`şick_š‘_ioùl
(
sock
, 
_dev
, 
SIOCSIFNETMASK
, &
iä
)) < 0)

302 
”rh
->
	`”rÜ
("”rÜ %d s‘tšg‚‘mask fÜ deviû '%s'", 
»s
, 
_devÇme
.
	`c_¡r
());

303 
	`£t_fs
(
Şdfs
);

304 #ià
HAVE_LINUX_INET_CTL_SOCK_CREATE


305 
	`š‘_ùl_sock_de¡roy
(
sock
->
sk
);

306 
	`kä“
(
sock
);

309 
»s
 = 
”rh
->
	`”rÜ
("cannot set IP‡ddress for FromHost devices onhis kernel");

313  
»s
;

314 
	}
}

317 
	$dev_updown
(
Ãt_deviû
 *
dev
, 
up
, 
E¼ÜHªdËr
 *
”rh
)

319 
iäeq
 
iä
;

320 
	`¡ºıy
(
iä
.
iä_Çme
, 
dev
->
Çme
, 
IFNAMSIZ
);

321 
ušt32_t
 
æags
 = 
IFF_UP
 | 
IFF_RUNNING
;

322 
»s
 = -
EINVAL
;

324 #ià
HAVE_LINUX_DEV_IOCTL


325 
mm_£gm’t_t
 
Şdfs
 = 
	`g‘_fs
();

326 
	`£t_fs
(
	`g‘_ds
());

328 (è
	`şick_dev_ioùl
(
dev
, 
SIOCGIFFLAGS
, &
iä
);

329 
iä
.
iä_æags
 = (
up
 > 0 ? iä.iä_æag | 
æags
 : ifr.ifr_flags & ~flags);

330 
»s
 = 
	`şick_dev_ioùl
(
dev
, 
SIOCSIFFLAGS
, &
iä
);

331 
	`£t_fs
(
Şdfs
);

333 
	`¹Æ_lock
();

334 
»s
 = 
	`dev_chªge_æags
(
dev
, dev->
æags
 | 
IFF_UP
);

335 
	`¹Æ_uÆock
();

338 ià(
»s
 < 0 && 
”rh
)

339 
”rh
->
	`”rÜ
("”rÜ %d bršgšg % deviû '%s'", 
»s
, (
up
 > 0 ? "up" : "down"), 
dev
->
Çme
);

340  
»s
;

341 
	}
}

344 
FromHo¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

346 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_dev
 !ğ0, 
”rh
);

347 
_nÚfuÎ_sigÇl
 = 
NÙif›r
::
	`down¡»am_fuÎ_sigÇl
(
this
, 0, &
_sk
);

348 ià(
_dev
->
æags
 & 
IFF_UP
) {

349 
_wakeup_tim”
.
	`š™Ÿlize
(
this
);

350 
_wakeup_tim”
.
	`scheduË_now
();

352 } ià(
	`£t_deviû_add»s£s
(
”rh
) < 0)

355  
	`dev_updown
(
_dev
, 1, 
”rh
);

356 
	}
}

359 
FromHo¡
::
	$ş—nup
(
CËªupSge
)

361 
äomlšux_m­
.
	`»move
(
this
, 
çl£
);

363 
Pack‘
 * vŞ©*
q
 = 
	`queue
();

364 
	`h—d
(è!ğ
	`
()) {

365 
Pack‘
 *
p
 = 
q
[
	`h—d
()];

366 
p
->
	`kl
();

367 
	`£t_h—d
(
	`Ãxt_i
(
	`h—d
()));

369 ià(
_ÿ·c™y
 > 
smq_size
)

370 
d–‘e
[] 
_q
.
lgq
;

371 
_ÿ·c™y
 = 1;

372 
	`£t_h—d
(0);

373 
	`£t_
(0);

375 ià(
_dev
) {

376 
	`dev_put
(
_dev
);

377 
lock_æags
;

378 
äomlšux_m­
.
	`lock
(
çl£
, 
lock_æags
);

379 ià(
äomlšux_m­
.
	`lookup
(
_dev
, 0))

381 
_dev
 = 0;

382 
äomlšux_m­
.
	`uÆock
(
çl£
, 
lock_æags
);

383 ià(
_dev
) {

384 ià(
_dev
->
æags
 & 
IFF_UP
)

385 
	`dev_updown
(
_dev
, -1, 0);

386 
	`uÄegi¡”_Ãtdev
(
_dev
);

387 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 0)

388 
	`ä“_Ãtdev
(
_dev
);

390 
	`kä“
(
_dev
);

392 
_dev
 = 0;

395 
	}
}

403 
æ_İ’
(
Ãt_deviû
 *
dev
)

405 
Ãtif_¡¬t_queue
(
dev
);

410 
æ_şo£
(
Ãt_deviû
 *
dev
)

412 
Ãtif_¡İ_queue
(
dev
);

417 
æ_wakeup
(
Tim”
 *, *
thunk
)

419 
FromHo¡
 *
æ
 = (FromHo¡ *)
thunk
;

420 
P»fixE¼ÜHªdËr
 
”rh
(
E¼ÜHªdËr
::
deçuÉ_hªdËr
(), 
æ
->
deş¬©iÚ
() + ": ");

421 
Ãt_deviû
 *
dev
 = 
æ
->
deviû
();

423 ià(
dev
->
æags
 & 
IFF_UP
)

424 
dev_updown
(
dev
, -1, &
”rh
);

426 
æ
->
£t_deviû_add»s£s
(&
”rh
);

428 
dev_updown
(
dev
, 1, &
”rh
);

431 #ià
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2, 6, 32)

432 
Ãt_deviû_¡©s
 *

433 
FromHo¡
::
æ_¡©s
(
Ãt_deviû
 *
dev
)

435 
lock_æags
;

436 
äomlšux_m­
.
lock
(
çl£
, 
lock_æags
);

437 
FromHo¡
 *
æ
 = (FromHo¡ *è
äomlšux_m­
.
lookup
(
dev
, 0);

438 ià(!
æ
)

439 
æ
 = (
FromHo¡
 *è
äomlšux_m­
.
lookup_unknown
(
dev
, 0);

440 ià(!
æ
 && 
cÚfiguršg
 && cÚfiguršg->
deviû
(è=ğ
dev
)

441 
æ
 = 
cÚfiguršg
;

442 
Ãt_deviû_¡©s
 *
¡©s
 = (
æ
 ? fl->stats() : 0);

443 
äomlšux_m­
.
uÆock
(
çl£
, 
lock_æags
);

444  
¡©s
;

449 
Ãtdev_tx_t


450 
FromHo¡
::
	$æ_tx
(
sk_buff
 *
skb
, 
Ãt_deviû
 *
dev
)

462 
Ãtdev_tx_t
 
»t
;

463 
lock_æags
;

464 
äomlšux_m­
.
	`lock
(
çl£
, 
lock_æags
);

465 ià(
FromHo¡
 *
æ
 = (FromHo¡ *)
äomlšux_m­
.
	`lookup
(
dev
, 0)) {

466 
StÜage
::
šdex_ty³
 
t
 = 
æ
->
	`
(), 
Á
 = fl->
	`Ãxt_i
(t);

467 ià(
	`lik–y
(
Á
 !ğ
æ
->
	`h—d
())) {

468 
Pack‘
 * vŞ©*
q
 = 
æ
->
	`queue
();

472 #ià
HAVE_SKB_DST_DROP


473 
	`skb_d¡_drİ
(
skb
);

475 ià(
skb
->
d¡
) {

476 
	`d¡_»Ëa£
(
skb
->
d¡
);

477 
skb
->
d¡
 = 0;

481 
Pack‘
 *
p
 = Pack‘::
	`make
(
skb
);

482 
p
->
	`time¡amp_ªno
().
	`assign_now
();

483 ià(
æ
->
_ş—r_ªno
)

484 
p
->
	`ş—r_ªnÙ©iÚs
(
çl£
);

485 
æ
->
	`¡©s
()->
tx_·ck‘s
++;

486 
æ
->
	`¡©s
()->
tx_by‹s
 +ğ
p
->
	`Ëngth
();

487 
æ
->
_sk
.
	`»scheduË
();

488 
q
[
t
] = 
p
;

489 
æ
->
	`£t_
(
Á
);

490 
»t
 = (
Ãtdev_tx_t
è
NETDEV_TX_OK
;

492 
æ
->
_drİs
++;

493 
»t
 = (
Ãtdev_tx_t
è
NETDEV_TX_BUSY
;

496 
»t
 = (
Ãtdev_tx_t
è
NETDEV_TX_BUSY
;

497 
äomlšux_m­
.
	`uÆock
(
çl£
, 
lock_æags
);

498  
»t
;

499 
	}
}

501 
boŞ


502 
FromHo¡
::
	$run_sk
(
Task
 *)

504 ià(!
_nÚfuÎ_sigÇl
 || 
	`uÆik–y
(
	`em±y
()))

505  
çl£
;

507 
Pack‘
 * vŞ©*
q
 = 
	`queue
();

508 
couÁ
 = 0; couÁ < 
_bur¡
 && !
	`em±y
(); ++count) {

509 
StÜage
::
šdex_ty³
 
h
 = 
	`h—d
();

510 
Pack‘
 *
p
 = 
q
[
h
];

511 
	`£t_h—d
(
	`Ãxt_i
(
h
));

514 ià(
_dev
->
ty³
 =ğ
ARPHRD_NONE
 && 
p
->
	`Ëngth
() >= 1) {

515 cÚ¡ 
şick_
 *
h
 = (cÚ¡ click_ *è
p
->
	`d©a
();

516 ià(
h
->
_v
 == 4) {

517 ià(
h
->
_hl
 >= 5

518 && 
	`Áohs
(
h
->
_Ën
è>ğ(h->
_hl
 << 2)

519 && 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
 *>(
h
è+ (h->
_hl
 << 2è<ğ
p
->
	`’d_d©a
()) {

520 
p
->
	`£t__h—d”
(
h
, iph->
_hl
 << 2);

521 
p
->
	`£t_d¡__ªno
(
h
->
_d¡
);

523 
bad
;

524 } ià(
h
->
_v
 == 6) {

525 ià(
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
 *>(
h
è+ (
şick_6
è<ğ
p
->
	`’d_d©a
())

526 
p
->
	`£t_6_h—d”
(
»š‹½»t_ÿ¡
<cÚ¡ 
şick_6
 *>(
h
));

528 
bad
;

530 
bad
:

531 
_nšv®id
++;

532 
	`checked_ouut_push
(1, 
p
);

537 
	`ouut
(0).
	`push
(
p
);

540 ià(!
	`em±y
())

541 
_sk
.
	`ç¡_»scheduË
();

542  
Œue
;

543 
	}
}

545 
SŒšg


546 
FromHo¡
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *)

548 
FromHo¡
 *
fh
 = (FromHo¡ *è
e
;

549  
	`SŒšg
(
fh
->
	`size
());

550 
	}
}

552 
FromHo¡
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

554 
FromHo¡
 *
fh
 = 
¡©ic_ÿ¡
<FromHo¡ *>(
e
);

555 
»š‹½»t_ÿ¡
<
šŒ_t
>(
thunk
)) {

556 
h_bur¡
:

557 ià(!
	`BoundedIÁArg
(1, 1000000).
	`·r£
(
¡r
, 
fh
->
_bur¡
))

558  
”rh
->
	`”rÜ
("burst…arameter must be integer between 1‡nd 1000000");

560 
h_‘h”
: {

561 
Eth”Add»ss
 
maÿddr
;

562 ià(
	`Args
(
”rh
).
	`push_back_wÜds
(
¡r
)

563 .
	`»ad_mp
("ETHER", 
maÿddr
)

564 .
	`com¶‘e
() < 0)

566 ià(!
maÿddr
)

567  
”rh
->
	`”rÜ
("ether…arameter must be set");

569 ià(
fh
->
_maÿddr
 !ğ
maÿddr
) {

570 
fh
->
_maÿddr
 = 
maÿddr
;

571 ià(
fh
->
_dev
->
æags
 & 
IFF_UP
) {

572 ià(!
fh
->
_wakeup_tim”
.
	`š™Ÿlized
())

573 
fh
->
_wakeup_tim”
.
	`š™Ÿlize
(fh);

574 
fh
->
_wakeup_tim”
.
	`scheduË_now
();

576 } ià(
fh
->
	`£t_deviû_add»s£s
(
”rh
) < 0)

584 
	}
}

587 
FromHo¡
::
	$add_hªdËrs
()

589 
	`add_sk_hªdËrs
(&
_sk
);

590 
	`add_»ad_hªdËr
("Ëngth", 
»ad_hªdËr
, 
h_Ëngth
);

591 
	`add_d©a_hªdËrs
("ÿ·c™y", 
HªdËr
::
OP_READ
, &
_ÿ·c™y
);

592 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

593 
	`add_d©a_hªdËrs
("bur¡", 
HªdËr
::
OP_READ
, &
_bur¡
);

594 
	`add_wr™e_hªdËr
("bur¡", 
wr™e_hªdËr
, 
h_bur¡
);

595 ià(
_dev
->
ty³
 =ğ
ARPHRD_ETHER
) {

596 
	`add_d©a_hªdËrs
("‘h”", 
HªdËr
::
OP_READ
, &
_maÿddr
);

597 
	`add_wr™e_hªdËr
("‘h”", 
wr™e_hªdËr
, 
h_‘h”
);

599 
	}
}

601 
	$ELEMENT_REQUIRES
(
AnyDeviû
 
lšuxmoduË
)

602 
	`EXPORT_ELEMENT
(
FromHo¡
)

	@linuxmodule/fromhost.hh

2 #iâdeà
CLICK_FROMHOST_HH


3 
	#CLICK_FROMHOST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<şick/tim”.hh
>

7 
	~<şick/nÙif›r.hh
>

118 
	~<şick/cxx´Ùeù.h
>

119 
	gCLICK_CXX_PROTECT


120 
	~<lšux/Ãtdeviû.h
>

121 
	~<lšux/rou‹.h
>

122 
	gCLICK_CXX_UNPROTECT


123 
	~<şick/cxxuÅrÙeù.h
>

124 
	~<şick/¡ªd¬d/¡Üage.hh
>

126 
	~"–em’ts/lšuxmoduË/ªydeviû.hh
"

127 
şass
 
	gEth”Add»ss
;

129 #ià
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2, 6, 32)

130 
	tÃtdev_tx_t
;

133 
şass
 
	gFromHo¡
 : 
public
 
AnyDeviû
,…ubliø
	gStÜage
 { 
	gpublic
:

135 
FromHo¡
(è
CLICK_COLD
;

136 ~
FromHo¡
(è
	gCLICK_COLD
;

138 
¡©ic_š™Ÿlize
();

140 cÚ¡ *
şass_Çme
() const {  "FromHost"; }

141 cÚ¡ *
pÜt_couÁ
() const {  "0/1-2"; }

142 cÚ¡ *
´oûssšg
(ècÚ¡ {  
	gPUSH
; }

143 *
ÿ¡
(cÚ¡ *
Çme
);

145 
cÚfigu»_pha£
(ècÚ¡ {  
	gCONFIGURE_PHASE_FROMHOST
; }

146 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

147 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

148 
add_hªdËrs
(è
	gCLICK_COLD
;

149 
ş—nup
(
CËªupSge
è
	gCLICK_COLD
;

151 
£t_deviû_add»s£s
(
E¼ÜHªdËr
 *);

153 
boŞ
 
run_sk
(
Task
 *);

155 
	g´iv©e
:

157 
Eth”Add»ss
 
_maÿddr
;

158 
IPAdd»ss
 
	g_de¡addr
;

159 
IPAdd»ss
 
	g_de¡mask
;

160 #ià
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2, 6, 32)

161 
Ãt_deviû_¡©s
 
	g_¡©s
;

164 
	g_bur¡
;

166 
Task
 
	g_sk
;

167 
Tim”
 
	g_wakeup_tim”
;

169 ’um { 
	gsmq_size
 = 4 };

171 
Pack‘
 * vŞ©
	gsmq
[
smq_size
 + 1];

172 
Pack‘
 * vŞ©*
	glgq
;

173 } 
	g_q
;

174 
NÙif›rSigÇl
 
	g_nÚfuÎ_sigÇl
;

176 
	g_mtu
;

177 
	g_drİs
;

178 
	g_nšv®id
;

180 
FromHo¡
 *
	gcÚfiguršg
;

181 
Ãt_deviû
 *
Ãw_deviû
(const *);

182 
Ãtdev_tx_t
 
æ_tx
(
sk_buff
 *, 
Ãt_deviû
 *);

183 
šlše
 
Pack‘
 * vŞ©*
queue
() {

184  
	g_ÿ·c™y
 <ğ
smq_size
 ? 
_q
.
smq
 : _q.
lgq
;

187 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 32)

188 
Ãt_deviû_¡©s
 *
¡©s
(è{  &
	g_dev
->
	g¡©s
; }

190 
Ãt_deviû_¡©s
 *
¡©s
(è{  &
	g_¡©s
; }

191 
Ãt_deviû_¡©s
 *
æ_¡©s
(
Ãt_deviû
 *
dev
);

194 ’um { 
	gh_Ëngth
, 
	gh_bur¡
, 
	gh_‘h”
 };

195 
SŒšg
 
»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
è
	gCLICK_COLD
;

196 
wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

	@linuxmodule/fromuserdevice.cc

25 
	~<şick/cÚfig.h
>

26 
	~<şick/glue.hh
>

27 
	~<şick/”rÜ.hh
>

28 
	~<şick/¬gs.hh
>

29 
	~<şick/rou‹r.hh
>

31 
	~<şick/cxx´Ùeù.h
>

32 
	gCLICK_CXX_PROTECT


33 
	~<lšux/pŞl.h
>

34 
	~<lšux/wa™.h
>

35 
	~<lšux/sched.h
>

36 
	~<asm/uacûss.h
>

37 
	gCLICK_CXX_UNPROTECT


38 
	~<şick/cxxuÅrÙeù.h
>

40 
	~"äomu£rdeviû.hh
"

41 
	~"tou£rdeviû.hh
"

44 
	gFromU£rDeviû
::
	$FromU£rDeviû
()

46 
	`¥š_lock_š™
(&
_lock
);

47 
_size
 = 0;

48 
_buff
 = 0;

49 
_r_¦Ù
 = 0;

50 
_w_¦Ù
 = 0;

52 
_wr™e_couÁ
 = 0;

53 
_drİ_couÁ
 = 0;

54 
_pkt_couÁ
 = 0;

55 
_block_couÁ
 = 0;

56 
_çed_couÁ
 = 0;

57 
_ex™
 = 
çl£
;

58 
_max
 = 0;

60 
_¦“p_´oc
 = 0;

61 
	`š™_wa™queue_h—d
(&
_´oc_queue
);

62 
	}
}

64 
	gFromU£rDeviû
::~
	$FromU£rDeviû
()

66 
	}
}

68 
ssize_t


69 
FromU£rDeviû
::
	$dev_wr™e
(cÚ¡ *
buf
, 
size_t
 
couÁ
, 
loff_t
 *
µos
)

71 
ulÚg
 
æags
;

75 ià(
couÁ
 > 
_max_pkt_size
)

77 
	`¥š_lock_œq§ve
(&
_lock
, 
æags
);

78 
_drİ_couÁ
++;

79 
	`¥š_uÆock_œq»¡Üe
(&
_lock
, 
æags
);

80  -
EMSGSIZE
;

84 
Wr™abËPack‘
 *
p
 = Wr™abËPack‘::
	`make
(
_h—droom
, 0, 
couÁ
, 
_room
);

85 ià(!
p
)

86  -
ENOMEM
;

87 
”r
 = 
	`cİy_äom_u£r
((*)
p
->
	`d©a
(), 
buf
, 
couÁ
);

88 ià(
”r
 != 0) {

89 
p
->
	`kl
();

90 
	`¥š_lock_œq§ve
(&
_lock
, 
æags
);

91 
_çed_couÁ
++;

92 
	`¥š_uÆock_œq»¡Üe
(&
_lock
, 
æags
);

93  -
EFAULT
;

97 
wa™_queue_t
 
wq
;

98 
	~<şick/cxx´Ùeù.h
>

99 
	`š™_wa™
(&
wq
);

100 
	~<şick/cxxuÅrÙeù.h
>

102 
	`¥š_lock_œq§ve
(&
_lock
, 
æags
);

104 ià(
_ex™
) {

105 
	`¥š_uÆock_œq»¡Üe
(&
_lock
, 
æags
);

106 
p
->
	`kl
();

107  -
EIO
;

109 ià(
_size
 < 
_ÿ·c™y
) {

113 
_¦“p_´oc
++;

114 
_block_couÁ
++;

115 
	`´•¬e_to_wa™
(&
_´oc_queue
, &
wq
, 
TASK_INTERRUPTIBLE
);

116 
	`¥š_uÆock_œq»¡Üe
(&
_lock
, 
æags
);

117 ià(
	`sigÇl_³ndšg
(
cu¼’t
)) {

118 
	`fšish_wa™
(&
_´oc_queue
, &
wq
);

119 
p
->
	`kl
();

120  -
ERESTARTSYS
;

124 
	`scheduË
();

125 
	`fšish_wa™
(&
_´oc_queue
, &
wq
);

126 
	`¥š_lock_œq§ve
(&
_lock
, 
æags
);

127 
_¦“p_´oc
--;

128 ià(
_ex™
) {

129 
	`¥š_uÆock_œq»¡Üe
(&
_lock
, 
æags
);

130 
p
->
	`kl
();

131  -
EIO
;

136 
_buff
[
_w_¦Ù
] = 
p
;

138 
_w_¦Ù
++;

139 ià(
_w_¦Ù
 =ğ
_ÿ·c™y
)

140 
_w_¦Ù
 = 0;

141 
_size
++;

142 
_wr™e_couÁ
++;

143 ià(
_max
 < 
_size
)

144 
_max
 = 
_size
;

146 
	`¥š_uÆock_œq»¡Üe
(&
_lock
, 
æags
);

148 
_em±y_nÙe
.
	`wake
();

149  
couÁ
;

150 
	}
}

153 
	gFromU£rDeviû
::
	$ÿ¡
(cÚ¡ *
n
)

155 ià(
	`¡rcmp
(
n
, 
NÙif›r
::
EMPTY_NOTIFIER
) == 0)

156  
¡©ic_ÿ¡
<
NÙif›r
 *>(&
_em±y_nÙe
);

158  
EËm’t
::
	`ÿ¡
(
n
);

159 
	}
}

162 
	gFromU£rDeviû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

164 
ToU£rDeviû
 *
	gtud
;

165 
	g_em±y_nÙe
.
š™Ÿlize
(
NÙif›r
::
EMPTY_NOTIFIER
, 
rou‹r
());

166 
	g_h—droom
 = 
Pack‘
::
deçuÉ_h—droom
;

167 
	g_room
 = 0;

168 
	g_max_pkt_size
 = 1536;

169 
	g_ÿ·c™y
 = 64;

170 ià(
Args
(
cÚf
, 
this
, 
”rh
)

171 .
»ad_mp
("TO_USER_DEVICE", 
EËm’tCa¡Arg
("ToU£rDeviû"), 
tud
)

172 .
»ad
("CAPACITY", 
_ÿ·c™y
)

173 .
»ad
("HEADROOM", 
_h—droom
)

174 .
»ad
("TAILROOM", 
_room
)

175 .
»ad
("MAX_PACKET_SIZE", 
_max_pkt_size
)

176 .
com¶‘e
() < 0)

179 ià(
	gtud
->
	g_äom_u£r_deviû
)

180  
	g”rh
->
”rÜ
("%p{–em’t}‡Ì—dy ha ¨»gi¡”ed FromU£rDeviû", 
tud
);

181 ià(
	gtud
->
	g_ty³
 !ğ
ToU£rDeviû
::
ty³_·ck‘
)

182  
”rh
->
”rÜ
("FromUserDevice only supports 'TYPE…acket' ToUserDeviceƒlements");

183 
	gtud
->
	g_äom_u£r_deviû
 = 
this
;

185 ià(
	g_ÿ·c™y
 == 0)

186  
”rh
->
”rÜ
("CAPACITY must be greaterhan zero");

187 ià(!(
	g_buff
 = (
Pack‘
**)
şick_ÏÎoc
(
_ÿ·c™y
 * (Packet*))))

188  
”rh
->
”rÜ
("failedo‡llocate memory");

192 
ušt


193 
	gFromU£rDeviû
::
	$dev_pŞl
()

195 
ušt
 
mask
 = 0;

196 
ulÚg
 
æags
;

198 
	`¥š_lock_œq§ve
(&
_lock
, 
æags
);

199 ià(
_ex™
 || 
_size
 < 
_ÿ·c™y
)

200 
mask
 |ğ
POLLOUT
 | 
POLLWRNORM
;

201 
	`¥š_uÆock_œq»¡Üe
(&
_lock
, 
æags
);

202  
mask
;

203 
	}
}

205 
Pack‘
 *

206 
	gFromU£rDeviû
::
	$puÎ
()

208 
Pack‘
 *
p
 = 0;

209 
ulÚg
 
æags
;

211 
	`¥š_lock_œq§ve
(&
_lock
, 
æags
);

212 ià(
_size
) {

213 
p
 = 
_buff
[
_r_¦Ù
];

214 
_r_¦Ù
++;

215 ià(
_r_¦Ù
 =ğ
_ÿ·c™y
)

216 
_r_¦Ù
 = 0;

217 
_size
--;

218 
_pkt_couÁ
++;

220 ià(!
p
)

221 
_em±y_nÙe
.
	`¦“p
();

222 
	`¥š_uÆock_œq»¡Üe
(&
_lock
, 
æags
);

224 
	`wake_up_š‹¼u±ibË
(&
_´oc_queue
);

225  
p
;

226 
	}
}

229 
	gFromU£rDeviû
::
	$ş—nup
(
CËªupSge
 
¡age
)

231 
ulÚg
 
æags
;

233 ià(
¡age
 < 
CLEANUP_CONFIGURED
)

236 
	`¥š_lock_œq§ve
(&
_lock
, 
æags
);

237 
_ex™
 = 
Œue
;

238 
	`¥š_uÆock_œq»¡Üe
(&
_lock
, 
æags
);

240 ià(
_buff
) {

241 
	`wake_up_š‹¼u±ibË
(&
_´oc_queue
);

242 
	`wa™queue_aùive
(&
_´oc_queue
))

243 
	`scheduË
();

245 
_size
) {

246 
Pack‘
 *
p
 = 
_buff
[
_r_¦Ù
];

247 
_r_¦Ù
 = (_r_¦Ù + 1è% 
_ÿ·c™y
;

248 
p
->
	`kl
();

249 
_size
--;

251 
	`şick_lä“
((*)
_buff
, 
_ÿ·c™y
 * (
Pack‘
*));

253 
	}
}

256 
	gFromU£rDeviû
::
	$add_hªdËrs
()

258 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
h_»ad
, &
_pkt_couÁ
);

259 
	`add_d©a_hªdËrs
("çed", 
HªdËr
::
h_»ad
, &
_çed_couÁ
);

260 
	`add_d©a_hªdËrs
("blocks", 
HªdËr
::
h_»ad
, &
_block_couÁ
);

261 
	`add_d©a_hªdËrs
("size", 
HªdËr
::
h_»ad
, &
_size
);

262 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
h_»ad
, &
_drİ_couÁ
);

263 
	`add_d©a_hªdËrs
("wr™es", 
HªdËr
::
h_»ad
, &
_wr™e_couÁ
);

264 
	`add_d©a_hªdËrs
("ÿ·c™y", 
HªdËr
::
h_»ad
, &
_ÿ·c™y
);

265 
	`add_d©a_hªdËrs
("max", 
HªdËr
::
h_»ad
, &
_max
);

266 
	}
}

268 
	$ELEMENT_REQUIRES
(
lšuxmoduË
 
ToU£rDeviû
)

269 
	$EXPORT_ELEMENT
(
FromU£rDeviû
)

270 
	`ELEMENT_MT_SAFE
(
FromU£rDeviû
)

	@linuxmodule/fromuserdevice.hh

1 #iâdeà
CLICK_FROMUSERDEVICE_HH


2 
	#CLICK_FROMUSERDEVICE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/nÙif›r.hh
>

5 
	~<şick/©omic.hh
>

7 
	~<şick/cxx´Ùeù.h
>

8 
	gCLICK_CXX_PROTECT


9 
	~<lšux/wa™.h
>

10 
	gCLICK_CXX_UNPROTECT


11 
	~<şick/cxxuÅrÙeù.h
>

66 şas 
	cFromU£rDeviû
 : 
public
 
EËm’t


68 
public
:

70 
	$FromU£rDeviû
(è
CLICK_COLD
;

71 ~
	$FromU£rDeviû
(è
CLICK_COLD
;

73 cÚ¡ *
	$şass_Çme
() const {  "FromUserDevice"; }

74 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

75 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

77 *
ÿ¡
(const *);

78 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

79 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

80 
	$add_hªdËrs
(è
CLICK_COLD
;

82 
Pack‘
* 
	`puÎ
(
pÜt
);

84 
ssize_t
 
	`dev_wr™e
(cÚ¡ *
buf
, 
size_t
 
couÁ
, 
loff_t
 *
µos
);

85 
ušt
 
	`dev_pŞl
();

87 
´iv©e
:

88 
AùiveNÙif›r
 
_em±y_nÙe
;

91 
¥šlock_t
 
_lock
;

92 
ušt32_t
 
_size
;

93 
Pack‘
 **
_buff
;

94 
ušt32_t
 
_r_¦Ù
;

95 
ušt32_t
 
_w_¦Ù
;

98 
ušt32_t
 
_ÿ·c™y
;

99 
ušt32_t
 
_max_pkt_size
;

100 
ušt32_t
 
_h—droom
;

101 
ušt32_t
 
_room
;

104 
ušt32_t
 
_wr™e_couÁ
;

105 
ušt32_t
 
_drİ_couÁ
;

106 
ušt32_t
 
_pkt_couÁ
;

107 
ušt32_t
 
_block_couÁ
;

108 
ušt32_t
 
_max
;

109 
ušt32_t
 
_çed_couÁ
;

110 
boŞ
 
_ex™
;

113 
ušt32_t
 
_¦“p_´oc
;

114 
wa™_queue_h—d_t
 
_´oc_queue
;

115 
	}
};

	@linuxmodule/perfcountaccum.cc

18 
	~<şick/cÚfig.h
>

19 
	~"³rfcouÁaccum.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
	~<şick/³rfùr-i586.hh
>

26 
	gP”fCouÁAccum
::
	$P”fCouÁAccum
()

28 
	}
}

30 
P”fCouÁAccum
::~
	$P”fCouÁAccum
()

32 
	}
}

35 
P”fCouÁAccum
::
	$ÿ¡
(cÚ¡ *
n
)

37 ià(
	`¡rcmp
(
n
, "PerfCountUser") == 0)

38  (
P”fCouÁU£r
 *)
this
;

39 ià(
	`¡rcmp
(
n
, "PerfCountAccum") == 0)

40  (
EËm’t
 *)
this
;

43 
	}
}

46 
	gP”fCouÁAccum
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

48 
SŒšg
 
	gm‘ric_Çme
;

49 ià(
Args
(
cÚf
, 
this
, 
”rh
)

50 .
»ad_mp
("METRIC", 
WÜdArg
(), 
m‘ric_Çme
)

51 .
com¶‘e
() < 0)

53 
	g_which
 = 
P”fCouÁU£r
::
´•¬e
(
m‘ric_Çme
, 
”rh
);

54  (
	g_which
 < 0 ? -1 : 0);

58 
	gP”fCouÁAccum
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

60 
_couÁ
 = 
_accum
 = 0;

61  
P”fCouÁU£r
::
	`š™Ÿlize
(
”rh
);

62 
	}
}

64 
šlše
 

65 
	gP”fCouÁAccum
::
	$smaùiÚ
(
Pack‘
 *
p
)

67 
l
, 
h
;

68 
	`rdpmc
(
_which
, 
l
, 
h
);

69 
ušt64_t
 
d–
 =

70 
	`PERFCTR_ANNO
(
p
è- (((
ušt64_t
)
h
 << 32è| 
l
);

71 
_accum
 +ğ
d–
;

72 
_couÁ
++;

73 
	}
}

76 
	gP”fCouÁAccum
::
	$push
(, 
Pack‘
 *
p
)

78 
	`smaùiÚ
(
p
);

79 
	`ouut
(0).
	`push
(
p
);

80 
	}
}

82 
Pack‘
 *

83 
	gP”fCouÁAccum
::
	$puÎ
()

85 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

86 ià(
p
)

87 
	`smaùiÚ
(
p
);

88  
p
;

89 
	}
}

91 
SŒšg


92 
	gP”fCouÁAccum
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

94 
P”fCouÁAccum
 *
pÿ
 = 
¡©ic_ÿ¡
<P”fCouÁAccum *>(
e
);

95 
which
 = 
»š‹½»t_ÿ¡
<>(
thunk
);

96 
which
) {

98  
	`SŒšg
(
pÿ
->
_couÁ
);

100  
	`SŒšg
(
pÿ
->
_accum
);

102  
	`SŒšg
();

104 
	}
}

107 
	gP”fCouÁAccum
::
	$»£t_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

109 
P”fCouÁAccum
 *
pÿ
 = 
¡©ic_ÿ¡
<P”fCouÁAccum *>(
e
);

110 
pÿ
->
_couÁ
 = 0;

111 
pÿ
->
_accum
 = 0;

113 
	}
}

116 
	gP”fCouÁAccum
::
	$add_hªdËrs
()

118 
	`add_»ad_hªdËr
("couÁ", 
»ad_hªdËr
, 0);

119 
	`add_»ad_hªdËr
("accum", 
»ad_hªdËr
, 1);

120 
	`add_wr™e_hªdËr
("»£t_couÁs", 
»£t_hªdËr
, 0, 
HªdËr
::
BUTTON
);

121 
	}
}

123 
	$ELEMENT_REQUIRES
(
lšuxmoduË
 
i586
 
št64
 
P”fCouÁU£r
)

124 
	`EXPORT_ELEMENT
(
P”fCouÁAccum
)

	@linuxmodule/perfcountaccum.hh

1 #iâdeà
PERFCOUNTACCUM_HH


2 
	#PERFCOUNTACCUM_HH


	)

34 
	~"–em’ts/lšuxmoduË/³rfcouÁu£r.hh
"

36 şas 
	cP”fCouÁAccum
 : 
public
 
P”fCouÁU£r
 {…ublic:

38 
	$P”fCouÁAccum
(è
CLICK_COLD
;

39 ~
	$P”fCouÁAccum
(è
CLICK_COLD
;

41 cÚ¡ *
	$şass_Çme
() const {  "PerfCountAccum"; }

42 *
	`ÿ¡
(const *);

43 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

45 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

46 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

47 
	$add_hªdËrs
(è
CLICK_COLD
;

49 
šlše
 
	`smaùiÚ
(
Pack‘
 *);

50 
	`push
(, 
Pack‘
 *
p
);

51 
Pack‘
 *
	`puÎ
();

53 
´iv©e
:

55 
_which
;

56 
ušt64_t
 
_accum
;

57 
ušt64_t
 
_couÁ
;

59 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

60 
	`»£t_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

62 
	}
};

	@linuxmodule/perfcountinfo.cc

18 
	~<şick/cÚfig.h
>

19 
	~"³rfcouÁšfo.hh
"

20 
	~<şick/¬gs.hh
>

22 
	gP”fCouÁInfo
::
	$P”fCouÁInfo
()

24 
	}
}

26 
P”fCouÁInfo
::~
	$P”fCouÁInfo
()

28 
	}
}

31 
P”fCouÁInfo
::
	$ÿ¡
(cÚ¡ *
n
)

33 ià(
	`¡rcmp
(
n
, "PerfCountUser") == 0)

34  (
P”fCouÁU£r
 *)
this
;

35 ià(
	`¡rcmp
(
n
, "PerfCountInfo") == 0)

36  (
EËm’t
 *)
this
;

39 
	}
}

42 
	gP”fCouÁInfo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

44 
SŒšg
 
	gm‘ric0
, 
	gm‘ric1
;

45 ià(
Args
(
cÚf
, 
this
, 
”rh
)

46 .
»ad_p
("METRIC0", 
WÜdArg
(), 
m‘ric0
)

47 .
»ad_p
("METRIC1", 
WÜdArg
(), 
m‘ric1
)

48 .
com¶‘e
() < 0)

51 
boŞ
 
	gok
 = 
Œue
;

52 ià(
	gm‘ric0
) {

53 ià(
	gP”fCouÁU£r
::
´•¬e
(
m‘ric0
, 
”rh
, 0) < 0)

54 
	gok
 = 
çl£
;

56 ià(
	gm‘ric1
) {

57 ià(
	gP”fCouÁU£r
::
´•¬e
(
m‘ric1
, 
”rh
, 1) < 0)

58 
	gok
 = 
çl£
;

61  (
	gok
 ? 0 : -1);

64 
	$ELEMENT_REQUIRES
(
lšuxmoduË
 
P”fCouÁU£r
)

65 
	`EXPORT_ELEMENT
(
P”fCouÁInfo
)

	@linuxmodule/perfcountinfo.hh

1 #iâdeà
PERFCOUNTINFO_HH


2 
	#PERFCOUNTINFO_HH


	)

3 
	~"–em’ts/lšuxmoduË/³rfcouÁu£r.hh
"

33 şas 
	cP”fCouÁInfo
 : 
public
 
P”fCouÁU£r
 {…ublic:

35 
	$P”fCouÁInfo
(è
CLICK_COLD
;

36 ~
	$P”fCouÁInfo
(è
CLICK_COLD
;

38 cÚ¡ *
	$şass_Çme
() const {  "PerfCountInfo"; }

39 *
	`ÿ¡
(const *);

40 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_INFO
; 
	}
}

41 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

	@linuxmodule/perfcountuser.cc

18 
	~<şick/cÚfig.h
>

19 
	~"³rfcouÁu£r.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şick/³rfùr-i586.hh
>

26 
	gP”fCouÁU£r
::
	$P”fCouÁU£r
()

28 
_m‘ric0
 = 
_m‘ric1
 = -2;

29 
	}
}

31 
	gP”fCouÁU£r
::~
	$P”fCouÁU£r
()

33 
	}
}

36 
	$¡ršg_to_³rfùr
(cÚ¡ 
SŒšg
 &
Çme_š
)

38 
SŒšg
 
Çme
 = 
Çme_š
.
	`uµ”
();

39 
	#TRY
(
x
èià(
Çme
 =ğ#xè x;

	)

40 
	`TRY
(
BUS_TRAN_INVAL
);

41 
	`TRY
(
BUS_TRAN_MEM
);

42 
	`TRY
(
DCU_MISS_OUTSTANDING
);

43 
	`TRY
(
IFU_FETCH
);

44 
	`TRY
(
IFU_FETCH_MISS
);

45 
	`TRY
(
IFU_MEM_STALL
);

46 
	`TRY
(
INST_RETIRED
);

47 
	`TRY
(
L2_IFETCH
);

48 
	`TRY
(
L2_LD
);

49 
	`TRY
(
L2_LINES_IN
);

50 
	`TRY
(
L2_LINES_OUT
);

51 
	`TRY
(
L2_LINES_OUTM
);

52 
	`TRY
(
L2_RQSTS
);

53 
	`TRY
(
BUS_LOCK_CLOCKS
);

54 #undeà
TRY


56 
	}
}

59 
	gP”fCouÁU£r
::
	$´•¬e
(cÚ¡ 
SŒšg
 &
Çme
, 
E¼ÜHªdËr
 *
”rh
, 
fÜû
)

61 
which
 = 
	`¡ršg_to_³rfùr
(
Çme
);

62 ià(
which
 == -1)

63  
”rh
->
	`”rÜ
("unknowÀ³rfÜmªû m‘riø'%s'", 
Çme
.
	`c_¡r
());

66 
P”fCouÁU£r
 *
ba£
 = 0;

67 
ei
 = 0;ƒ˜< 
	`rou‹r
()->
	`ÃËm’ts
(è&& !
ba£
;ƒi++) {

68 
EËm’t
 *
e
 = 
	`rou‹r
()->
	`–em’t
(
ei
);

69 ià(
P”fCouÁU£r
 *
pc
 = (P”fCouÁU£¸*)
e
->
	`ÿ¡
("PerfCountUser")) {

70 ià(
pc
->
	`is_ba£
())

71 
ba£
 = 
pc
;

74 ià(!
ba£
) {

75 
_m‘ric0
 = 
_m‘ric1
 = -1;

76 
ba£
 = 
this
;

79 ià((
fÜû
 < 0 || force == 0)

80 && (
ba£
->
_m‘ric0
 < 0 || ba£->_m‘ric0 =ğ
which
)) {

81 
ba£
->
_m‘ric0
 = 
which
;

83 } ià((
fÜû
 < 0 || force == 1)

84 && (
ba£
->
_m‘ric1
 < 0 || ba£->_m‘ric1 =ğ
which
)) {

85 
ba£
->
_m‘ric1
 = 
which
;

87 } ià(
fÜû
 < 0)

88  
”rh
->
	`”rÜ
("configuration usesoo many…erformance metrics\n(I can keeprack of‡t mostwo different metrics.)");

90  
”rh
->
	`”rÜ
("³rfÜmªû m‘riø%d‡Ì—dy u£d", 
fÜû
);

91 
	}
}

94 
	gP”fCouÁU£r
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

96 ià(
_m‘ric0
 >= 0)

97 
	`wrm¤
(
MSR_EVNTSEL0
, 
_m‘ric0
 | 
MSR_FLAGS0
, 0);

98 ià(
_m‘ric1
 >= 0)

99 
	`wrm¤
(
MSR_EVNTSEL1
, 
_m‘ric1
 | 
MSR_FLAGS1
, 0);

101 
	}
}

103 
	$ELEMENT_REQUIRES
(
lšuxmoduË
 
i586
)

104 
	`ELEMENT_PROVIDES
(
P”fCouÁU£r
)

	@linuxmodule/perfcountuser.hh

1 #iâdeà
PERFCOUNTUSER_HH


2 
	#PERFCOUNTUSER_HH


	)

3 
	~<şick/–em’t.hh
>

5 şas 
	cP”fCouÁU£r
 : 
public
 
EËm’t
 {…ublic:

7 
	$P”fCouÁU£r
(è
CLICK_COLD
;

8 ~
	$P”fCouÁU£r
(è
CLICK_COLD
;

10 
boŞ
 
	$is_ba£
(ècÚ¡ {  
_m‘ric0
 > -2; }

12 
	`´•¬e
(cÚ¡ 
SŒšg
 &, 
E¼ÜHªdËr
 *, 
fÜû
 = -1);

13 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

15 
´iv©e
:

17 
_m‘ric0
;

18 
_m‘ric1
;

20 
	}
};

22 
	#MSR_OS
 (1<<17)

	)

23 
	#MSR_OCCURRENCE
 (1<<18)

	)

24 
	#MSR_ENABLE
 (1<<22)

	)

25 
	#MSR_FLAGS0
 (
MSR_OS
|
MSR_OCCURRENCE
|
MSR_ENABLE
)

	)

26 
	#MSR_FLAGS1
 (
MSR_OS
|
MSR_OCCURRENCE
)

	)

28 
	#MSR_EVNTSEL0
 0x186

	)

29 
	#MSR_EVNTSEL1
 0x187

	)

	@linuxmodule/polldevice.cc

22 
	~<şick/cÚfig.h
>

23 
	~<şick/glue.hh
>

24 
	~"pŞldeviû.hh
"

25 
	~"äomdeviû.hh
"

26 
	~"todeviû.hh
"

27 
	~<şick/”rÜ.hh
>

28 
	~<şick/¬gs.hh
>

29 
	~<şick/rou‹r.hh
>

30 
	~<şick/skbmgr.hh
>

31 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

33 
	~<şick/cxx´Ùeù.h
>

34 
	gCLICK_CXX_PROTECT


35 
	~<lšux/Ãtdeviû.h
>

36 #ià
__i386__


37 
	~<şick/³rfùr-i586.hh
>

39 
	gCLICK_CXX_UNPROTECT


40 
	~<şick/cxxuÅrÙeù.h
>

43 
AnyDeviûM­
 
	gpŞl_deviû_m­
;

44 
nÙif›r_block
 
	gdeviû_nÙif›r
;

46 
deviû_nÙif›r_hook
(
nÙif›r_block
 *
nb
, 
v®
, *
v
);

50 
PŞlDeviû
::
	$¡©ic_š™Ÿlize
()

52 
pŞl_deviû_m­
.
	`š™Ÿlize
();

53 
deviû_nÙif›r
.
nÙif›r_ÿÎ
 = 
deviû_nÙif›r_hook
;

54 
deviû_nÙif›r
.
´iÜ™y
 = 1;

55 
deviû_nÙif›r
.
Ãxt
 = 0;

56 
	`»gi¡”_Ãtdeviû_nÙif›r
(&
deviû_nÙif›r
);

57 
	}
}

60 
PŞlDeviû
::
	$¡©ic_ş—nup
()

62 
	`uÄegi¡”_Ãtdeviû_nÙif›r
(&
deviû_nÙif›r
);

63 
	}
}

65 
PŞlDeviû
::
	$PŞlDeviû
()

67 
	}
}

69 
PŞlDeviû
::~
	$PŞlDeviû
()

71 
	}
}

75 
PŞlDeviû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

77 
_bur¡
 = 8;

78 
_h—droom
 = 64;

79 
_Ëngth
 = 0;

80 
_u£r_Ëngth
 = 
çl£
;

81 ià(
AnyDeviû
::
cÚfigu»_keywÜds
(
cÚf
, 
”rh
, 
Œue
) < 0

82 || (
Args
(
cÚf
, 
this
, 
”rh
)

83 .
»ad_mp
("DEVNAME", 
_devÇme
)

84 .
»ad_p
("BURST", 
_bur¡
)

85 .
»ad
("HEADROOM", 
_h—droom
)

86 .
»ad
("LENGTH", 
_Ëngth
).
»ad_¡©us
(
_u£r_Ëngth
)

87 .
com¶‘e
() < 0))

90 #ià
HAVE_LINUX_POLLING


91 
Ãt_deviû
 *
dev
 = 
lookup_deviû
(
”rh
);

92 ià(
dev
 && (!dev->
pŞl_Ú
 || dev->
pŞlšg
 < 0)) {

93 
dev_put
(
dev
);

94  
”rh
->
”rÜ
("deviû %<%s%>‚Ù…ŞÏbË, u£ FromDeviû in¡—d", 
_devÇme
.
c_¡r
());

96 
£t_deviû
(
dev
, &
pŞl_deviû_m­
, 0);

98  
”rh
->
Ã¼Üs
() ? -1 : 0;

107 
PŞlDeviû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

109 ià(
AnyDeviû
::
	`š™Ÿlize_keywÜds
(
”rh
) < 0)

112 #ià
HAVE_LINUX_POLLING


114 ià(
	`ifšdex
() >= 0) {

115 *&
u£d
 = 
	`rou‹r
()->
	`fÜû_©chm’t
("deviû_»ad”_" + 
	`SŒšg
(
	`ifšdex
()));

116 ià(
u£d
)

117  
”rh
->
	`”rÜ
("du¶iÿ‹„—d” fÜ deviû '%s'", 
_devÇme
.
	`c_¡r
());

118 
u£d
 = 
this
;

120 ià(!
	`rou‹r
()->
	`©chm’t
("deviû_wr™”_" + 
	`SŒšg
(
	`ifšdex
()) + "_0"))

121 
”rh
->
	`w¬nšg
("nØToDeviû(%sèš cÚfigu¿tiÚ\n(\
, you wÈg‘ bad…”fÜmªû from PŞlDeviû uÆess\n\
 inşud¨ToDeviû fÜh§mdeviû. Try‡ddšg\n\
'IdË -> ToDeviû(%s)'Øyou¸cÚfigu¿tiÚ.)", 
_devÇme
.
	`c_¡r
(), _devname.c_str());

127 ià(
_dev
 && !_dev->
pŞlšg
) {

129 
rx_bufãr_Ëngth
 = 
_dev
->
	`pŞl_Ú
(_dev);

130 ià(
_dev
->
pŞlšg
 != 2)

131  
”rh
->
	`”rÜ
("PollDevice detected wrong version of…olling…atch");

132 ià(!
_u£r_Ëngth
)

133 
_Ëngth
 = (
rx_bufãr_Ëngth
 < 1536 ? 1536 :„x_buffer_length);

135 ià(
_dev
 && 
_h—droom
 < 
	`LL_RESERVED_SPACE
(_dev))

136 
”rh
->
	`w¬nšg
("deviû % »que¡ ©†—¡ %d by‹ oàHEADROOM", 
_devÇme
.
	`c_¡r
(), (è
	`LL_RESERVED_SPACE
(
_dev
));

138 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_dev
 !ğ0, 
”rh
);

139 #ià
HAVE_STRIDE_SCHED


141 
_max_tick‘s
 = 
_sk
.
	`tick‘s
();

142 
_sk
.
	`£t_tick‘s
(
Task
::
DEFAULT_TICKETS
);

145 
	`»£t_couÁs
();

148 
”rh
->
	`w¬nšg
("can't get…ackets:‚ot compiled with…ollingƒxtensions");

152 
	}
}

155 
PŞlDeviû
::
	$»£t_couÁs
()

157 
_Åack‘s
 = 0;

159 #ià
CLICK_DEVICE_STATS


160 
_aùiv©iÚs
 = 0;

161 
_em±y_pŞls
 = 0;

162 
_time_pŞl
 = 0;

163 
_time_»fl
 = 0;

164 
_time_®locskb
 = 0;

165 
_³rfút1_pŞl
 = 0;

166 
_³rfút1_»fl
 = 0;

167 
_³rfút1_®locskb
 = 0;

168 
_³rfút1_pushšg
 = 0;

169 
_³rfút2_pŞl
 = 0;

170 
_³rfút2_»fl
 = 0;

171 
_³rfút2_®locskb
 = 0;

172 
_³rfút2_pushšg
 = 0;

174 #ià
CLICK_DEVICE_THESIS_STATS
 || 
CLICK_DEVICE_STATS


175 
_push_cyşes
 = 0;

177 
_bufãrs_»u£d
 = 0;

178 
	}
}

181 
PŞlDeviû
::
	$ş—nup
(
CËªupSge
)

183 #ià
HAVE_LINUX_POLLING


184 
Ãt_deviû
 *
had_dev
 = 
_dev
;

188 
	`ş—r_deviû
(&
pŞl_deviû_m­
, 0);

190 
lock_æags
;

191 
pŞl_deviû_m­
.
	`lock
(
çl£
, 
lock_æags
);

192 ià(
had_dev
 && had_dev->
pŞlšg
 > 0 && !
pŞl_deviû_m­
.
	`lookup
(had_dev, 0))

193 
had_dev
->
	`pŞl_off
(had_dev);

194 
pŞl_deviû_m­
.
	`uÆock
(
çl£
, 
lock_æags
);

196 
	}
}

198 
boŞ


199 
PŞlDeviû
::
	$run_sk
(
Task
 *)

201 #ià
HAVE_LINUX_POLLING


202 
sk_buff
 *
skb_li¡
, *
skb
;

203 
gÙ
=0;

204 #ià
CLICK_DEVICE_STATS


205 
ušt64_t
 
time_now
;

206 
low00
, 
low10
;

209 
	`SET_STATS
(
low00
, 
low10
, 
time_now
);

211 
gÙ
 = 
_bur¡
;

212 
skb_li¡
 = 
_dev
->
	`rx_pŞl
(_dev, &
gÙ
);

214 #ià
CLICK_DEVICE_STATS


215 ià(
gÙ
 > 0 || 
_aùiv©iÚs
 > 0) {

216 
	`GET_STATS_RESET
(
low00
, 
low10
, 
time_now
,

217 
_³rfút1_pŞl
, 
_³rfút2_pŞl
, 
_time_pŞl
);

218 ià(
gÙ
 == 0)

219 
_em±y_pŞls
++;

221 
_aùiv©iÚs
++;

225 
nskbs
 = 
gÙ
;

226 ià(
gÙ
 == 0)

227 
nskbs
 = 
_dev
->
	`rx_»fl
(_dev, 0);

229 ià(
nskbs
 > 0) {

238 
sk_buff
 *
Ãw_skbs
 = 
	`skbmgr_®loÿ‹_skbs
(
_h—droom
, 
_Ëngth
, &
nskbs
);

240 #ià
CLICK_DEVICE_STATS


241 ià(
_aùiv©iÚs
 > 0)

242 
	`GET_STATS_RESET
(
low00
, 
low10
, 
time_now
,

243 
_³rfút1_®locskb
, 
_³rfút2_®locskb
, 
_time_®locskb
);

246 
nskbs
 = 
_dev
->
	`rx_»fl
(_dev, &
Ãw_skbs
);

248 #ià
CLICK_DEVICE_STATS


249 ià(
_aùiv©iÚs
 > 0)

250 
	`GET_STATS_RESET
(
low00
, 
low10
, 
time_now
,

251 
_³rfút1_»fl
, 
_³rfút2_»fl
, 
_time_»fl
);

254 ià(
Ãw_skbs
) {

255 
sk_buff
 *
skb
 = 
Ãw_skbs
; skb; skb = skb->
Ãxt
)

256 
_bufãrs_»u£d
++;

257 
	`skbmgr_»cyşe_skbs
(
Ãw_skbs
);

261 
i
 = 0; i < 
gÙ
; i++) {

262 
skb
 = 
skb_li¡
;

263 
skb_li¡
 = skb_li¡->
Ãxt
;

264 
skb
->
Ãxt
 = 
NULL
;

266 ià(
skb_li¡
) {

269 #ià
__i386__
 && 
HAVE_INTEL_CPU


270 
asm
 vŞ©e("´eãtcht0 %0" : : "m" (
skb_li¡
->
cb
[0]));

272 
asm
 vŞ©e("´eãtcht0 %0" : : "m" (*(
skb_li¡
->
d©a
+32)));

277 
	`skb_push
(
skb
, 14);

278 ià(
skb
->
pkt_ty³
 =ğ
PACKET_HOST
)

279 
skb
->
pkt_ty³
 |ğ
PACKET_CLEAN
;

281 
Pack‘
 *
p
 = Pack‘::
	`make
(
skb
);

283 #iâdeà
CLICK_WARP9


284 ià(
	`time¡amp
())

285 
p
->
	`time¡amp_ªno
().
	`assign_now
();

288 
_Åack‘s
++;

289 #ià
CLICK_DEVICE_THESIS_STATS
 && !
CLICK_DEVICE_STATS


290 
şick_cyşes_t
 
befÜe_push_cyşes
 = 
	`şick_g‘_cyşes
();

292 
	`ouut
(0).
	`push
(
p
);

293 #ià
CLICK_DEVICE_THESIS_STATS
 && !
CLICK_DEVICE_STATS


294 
_push_cyşes
 +ğ
	`şick_g‘_cyşes
(è- 
befÜe_push_cyşes
 - 
CLICK_CYCLE_COMPENSATION
;

298 #ià
CLICK_DEVICE_STATS


299 ià(
_aùiv©iÚs
 > 0) {

300 
	`GET_STATS_RESET
(
low00
, 
low10
, 
time_now
,

301 
_³rfút1_pushšg
, 
_³rfút2_pushšg
, 
_push_cyşes
);

302 #ià
_DEV_OVRN_STATS_


303 ià((
_aùiv©iÚs
 % 1024) == 0)

304 
_dev
->
	`g‘_¡©s
(_dev);

309 
	`adju¡_tick‘s
(
gÙ
);

310 
_sk
.
	`ç¡_»scheduË
();

311  
gÙ
 > 0;

313  
çl£
;

315 
	}
}

318 
PŞlDeviû
::
	$chªge_deviû
(
Ãt_deviû
 *
dev
)

320 #ià
HAVE_LINUX_POLLING


321 
boŞ
 
dev_chªge
 = 
_dev
 !ğ
dev
;

323 ià(
dev_chªge
) {

324 
_sk
.
	`¡rÚg_unscheduË
();

326 ià(
dev
 && (!dev->
pŞl_Ú
 || dev->
pŞlšg
 < 0)) {

327 
	`şick_ch©‹r
("%s: deviû '%s' dÛ nÙ suµÜˆpŞlšg", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_devÇme
.c_str());

328 
dev
 = 0;

331 ià(
_dev
)

332 
_dev
->
	`pŞl_off
(_dev);

335 
	`£t_deviû
(
dev
, &
pŞl_deviû_m­
, 
ªydev_chªge
);

337 ià(
dev_chªge
) {

338 ià(
_dev
 && !_dev->
pŞlšg
) {

339 
rx_bufãr_Ëngth
 = 
_dev
->
	`pŞl_Ú
(_dev);

340 ià(!
_u£r_Ëngth
)

341 
_Ëngth
 = (
rx_bufãr_Ëngth
 < 1536 ? 1536 :„x_buffer_length);

344 ià(
_dev
)

345 
_sk
.
	`¡rÚg_»scheduË
();

348 (è
dev
;

350 
	}
}

354 
deviû_nÙif›r_hook
(
nÙif›r_block
 *
nb
, 
æags
, *
v
)

356 #ifdeà
NETDEV_GOING_DOWN


357 ià(
æags
 =ğ
NETDEV_GOING_DOWN
)

358 
æags
 = 
NETDEV_DOWN
;

360 ià(
æags
 =ğ
NETDEV_DOWN
 || fÏg =ğ
NETDEV_UP
 || fÏg =ğ
NETDEV_CHANGE
) {

361 
boŞ
 
exi¡s
 = (
æags
 !ğ
NETDEV_UP
);

362 
Ãt_deviû
 *
dev
 = (Ãt_deviû *)
v
;

363 
lock_æags
;

364 
pŞl_deviû_m­
.
lock
(
Œue
, 
lock_æags
);

365 
AnyDeviû
 *
es
[8];

366 
Ãs
 = 
pŞl_deviû_m­
.
lookup_®l
(
dev
, 
exi¡s
, 
es
, 8);

367 
i
 = 0; i < 
Ãs
; i++)

368 ((
PŞlDeviû
 *)(
es
[
i
]))->
chªge_deviû
(
æags
 =ğ
NETDEV_DOWN
 ? 0 : 
dev
);

369 
pŞl_deviû_m­
.
uÆock
(
Œue
, 
lock_æags
);

375 
SŒšg


376 
	$PŞlDeviû_»ad_ÿÎs
(
EËm’t
 *
f
, *)

378 
PŞlDeviû
 *
kw
 = (PŞlDeviû *)
f
;

380 
	`SŒšg
(
kw
->
_Åack‘s
) + "…ackets„eceived\n" +

381 
	`SŒšg
(
kw
->
_bufãrs_»u£d
) + " buffers„eused\n" +

382 #ià
CLICK_DEVICE_STATS


383 
	`SŒšg
(
kw
->
_time_pŞl
) + " cycles…oll\n" +

384 
	`SŒšg
(
kw
->
_time_»fl
) + " cycles„efill\n" +

385 
	`SŒšg
(
kw
->
_time_®locskb
) + " cycles‡llocskb\n" +

386 
	`SŒšg
(
kw
->
_push_cyşes
) + " cycles…ushing\n" +

387 
	`SŒšg
(
kw
->
_³rfút1_pŞl
) + "…erfctr1…oll\n" +

388 
	`SŒšg
(
kw
->
_³rfút1_»fl
) + "…erfctr1„efill\n" +

389 
	`SŒšg
(
kw
->
_³rfút1_®locskb
) + "…erfctr1‡llocskb\n" +

390 
	`SŒšg
(
kw
->
_³rfút1_pushšg
) + "…erfctr1…ushing\n" +

391 
	`SŒšg
(
kw
->
_³rfút2_pŞl
) + "…erfctr2…oll\n" +

392 
	`SŒšg
(
kw
->
_³rfút2_»fl
) + "…erfctr2„efill\n" +

393 
	`SŒšg
(
kw
->
_³rfút2_®locskb
) + "…erfctr2‡llocskb\n" +

394 
	`SŒšg
(
kw
->
_³rfút2_pushšg
) + "…erfctr2…ushing\n" +

395 
	`SŒšg
(
kw
->
_em±y_pŞls
) + "ƒmpty…olls\n" +

396 
	`SŒšg
(
kw
->
_aùiv©iÚs
) + "‡ctivations\n";

398 
	`SŒšg
();

400 
	}
}

403 
	$PŞlDeviû_wr™e_¡©s
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

405 
PŞlDeviû
 *
pd
 = (PŞlDeviû *)
e
;

406 
pd
->
	`»£t_couÁs
();

408 
	}
}

411 
PŞlDeviû
::
	$add_hªdËrs
()

413 
	`add_»ad_hªdËr
("ÿÎs", 
PŞlDeviû_»ad_ÿÎs
, 0);

414 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
f_»ad
, &
_Åack‘s
);

416 
	`add_d©a_hªdËrs
("·ck‘s", 
HªdËr
::
f_»ad
 | HªdËr::
f_d•»ÿ‹d
, &
_Åack‘s
);

417 #ià
CLICK_DEVICE_THESIS_STATS
 || 
CLICK_DEVICE_STATS


418 
	`add_d©a_hªdËrs
("push_cyşes", 
HªdËr
::
f_»ad
, &
_push_cyşes
);

420 #ià
CLICK_DEVICE_STATS


421 
	`add_d©a_hªdËrs
("pŞl_cyşes", 
HªdËr
::
f_»ad
, &
_time_pŞl
);

422 
	`add_d©a_hªdËrs
("»fl_dma_cyşes", 
HªdËr
::
f_»ad
, &
_time_»fl
);

424 
	`add_wr™e_hªdËr
("»£t_couÁs", 
PŞlDeviû_wr™e_¡©s
, 0, 
HªdËr
::
f_bu‰Ú
);

425 
	`add_d©a_hªdËrs
("bufãrs_»u£d", 
HªdËr
::
f_»ad
, &
_bufãrs_»u£d
);

426 
	`add_sk_hªdËrs
(&
_sk
);

427 
	}
}

429 
	$ELEMENT_REQUIRES
(
AnyDeviû
 
lšuxmoduË
)

430 
	`EXPORT_ELEMENT
(
PŞlDeviû
)

	@linuxmodule/polldevice.hh

1 #iâdeà
CLICK_POLLDEVICE_HH


2 
	#CLICK_POLLDEVICE_HH


	)

101 
	~"–em’ts/lšuxmoduË/ªydeviû.hh
"

103 şas 
	cPŞlDeviû
 : 
public
 
AnyTaskDeviû
 {…ublic:

105 
	$PŞlDeviû
(è
CLICK_COLD
;

106 ~
	$PŞlDeviû
(è
CLICK_COLD
;

108 
	`¡©ic_š™Ÿlize
();

109 
	`¡©ic_ş—nup
();

111 cÚ¡ *
	$şass_Çme
() const {  "PollDevice"; }

112 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

113 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

115 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_POLLDEVICE
; 
	}
}

116 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

117 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

118 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

119 
	$add_hªdËrs
(è
CLICK_COLD
;

121 
	`chªge_deviû
(
Ãt_deviû
 *);

123 
	`gÙ_skb
(
sk_buff
 *);

125 
boŞ
 
	`run_sk
(
Task
 *);

127 
	`»£t_couÁs
();

129 
ušt32_t
 
_Åack‘s
;

130 #ià
CLICK_DEVICE_STATS


131 
ušt64_t
 
_time_pŞl
;

132 
ušt64_t
 
_time_®locskb
;

133 
ušt64_t
 
_time_»fl
;

135 
ušt64_t
 
_³rfút1_pŞl
;

136 
ušt64_t
 
_³rfút1_»fl
;

137 
ušt64_t
 
_³rfút1_®locskb
;

138 
ušt64_t
 
_³rfút1_pushšg
;

139 
ušt64_t
 
_³rfút2_pŞl
;

140 
ušt64_t
 
_³rfút2_»fl
;

141 
ušt64_t
 
_³rfút2_®locskb
;

142 
ušt64_t
 
_³rfút2_pushšg
;

144 
ušt32_t
 
_em±y_pŞls
;

145 
ušt32_t
 
_aùiv©iÚs
;

147 #ià
CLICK_DEVICE_THESIS_STATS
 || 
CLICK_DEVICE_STATS


148 
şick_cyşes_t
 
_push_cyşes
;

151 
ušt32_t
 
_bufãrs_»u£d
;

153 
´iv©e
:

155 
_bur¡
;

156 
_h—droom
;

157 
ušt32_t
 
_Ëngth
;

158 
boŞ
 
_u£r_Ëngth
;

160 
	}
};

	@linuxmodule/rtcycles.cc

17 
	~<şick/cÚfig.h
>

18 
	~"¹cyşes.hh
"

19 
	~<şick/”rÜ.hh
>

20 
	~<şick/glue.hh
>

22 
	gRTCyşes
::
	$RTCyşes
()

24 
_accum
 = 
_Åack‘s
 = 0;

25 
	}
}

27 
	gRTCyşes
::~
	$RTCyşes
()

29 
	}
}

32 
RTCyşes
::
	$push
(, 
Pack‘
 *
p
)

34 
şick_cyşes_t
 
c
 = 
	`şick_g‘_cyşes
();

35 
	`ouut
(0).
	`push
(
p
);

36 
_accum
 +ğ
	`şick_g‘_cyşes
(è- 
c
;

37 
_Åack‘s
++;

38 
	}
}

40 
Pack‘
 *

41 
	gRTCyşes
::
	$puÎ
()

43 
şick_cyşes_t
 
c
 = 
	`şick_g‘_cyşes
();

44 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

45 
_accum
 +ğ
	`şick_g‘_cyşes
(è- 
c
;

46 ià(
p
è
_Åack‘s
++;

47 (
p
);

48 
	}
}

50 
SŒšg


51 
	$RTCyşes_»ad_cyşes
(
EËm’t
 *
e
, *
thunk
)

53 
RTCyşes
 *
s
 = 
¡©ic_ÿ¡
<RTCyşe *>(
e
);

54 
»š‹½»t_ÿ¡
<
šŒ_t
>(
thunk
)) {

56  
	`SŒšg
(
s
->
_Åack‘s
);

58  
	`SŒšg
(
s
->
_accum
);

60  
	`SŒšg
();

62 
	}
}

65 
	$RTCyşes_»£t_couÁs
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

67 
RTCyşes
 *
s
 = 
¡©ic_ÿ¡
<RTCyşe *>(
e
);

68 
s
->
_Åack‘s
 = 0;

69 
s
->
_accum
 = 0;

71 
	}
}

74 
	gRTCyşes
::
	$add_hªdËrs
()

76 
	`add_»ad_hªdËr
("·ck‘s", 
RTCyşes_»ad_cyşes
, 0);

77 
	`add_»ad_hªdËr
("cyşes", 
RTCyşes_»ad_cyşes
, 1);

78 
	`add_wr™e_hªdËr
("»£t_couÁs", 
RTCyşes_»£t_couÁs
, 0, 
HªdËr
::
BUTTON
);

79 
	}
}

82 
	$ELEMENT_REQUIRES
(
lšuxmoduË
 
št64
)

83 
	`EXPORT_ELEMENT
(
RTCyşes
)

	@linuxmodule/rtcycles.hh

1 #iâdeà
RTCYCLES_HH


2 
	#RTCYCLES_HH


	)

3 
	~<şick/–em’t.hh
>

30 şas 
	cRTCyşes
 : 
public
 
EËm’t
 {…ublic:

32 
	$RTCyşes
(è
CLICK_COLD
;

33 ~
	$RTCyşes
(è
CLICK_COLD
;

35 cÚ¡ *
	$şass_Çme
() const {  "RoundTripCycleCount"; }

36 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

38 
push
(, 
Pack‘
 *
p
);

39 
Pack‘
 *
puÎ
();

40 
	$add_hªdËrs
(è
CLICK_COLD
;

42 
şick_cyşes_t
 
_accum
;

43 
şick_cyşes_t
 
_Åack‘s
;

45 
	}
};

	@linuxmodule/schedulelinux.cc

17 
	~<şick/cÚfig.h
>

18 
	~<şick/rou‹r.hh
>

19 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

20 
	~"scheduËlšux.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

24 
	gScheduËLšux
::
	$ScheduËLšux
()

25 : 
	$_sk
(
this
)

27 
	}
}

29 
ScheduËLšux
::~
	$ScheduËLšux
()

31 
	}
}

34 
ScheduËLšux
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

36 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

38 
	}
}

40 
boŞ


41 
	gScheduËLšux
::
	$run_sk
(
Task
 *)

43 
	`scheduË
();

44 
_sk
.
	`ç¡_»scheduË
();

45  
Œue
;

46 
	}
}

49 
	gScheduËLšux
::
	$add_hªdËrs
()

51 
	`add_sk_hªdËrs
(&
_sk
);

52 
	}
}

54 
	$ELEMENT_REQUIRES
(
lšuxmoduË
)

55 
	`EXPORT_ELEMENT
(
ScheduËLšux
)

	@linuxmodule/schedulelinux.hh

1 #iâdeà
SCHEDULELINUX_HH


2 
	#SCHEDULELINUX_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/sk.hh
>

18 şas 
	cScheduËLšux
 : 
public
 
EËm’t
 {…ublic:

20 
	$ScheduËLšux
(è
CLICK_COLD
;

21 ~
	$ScheduËLšux
(è
CLICK_COLD
;

23 cÚ¡ *
	$şass_Çme
() const {  "ScheduleLinux"; }

25 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

26 
	$add_hªdËrs
(è
CLICK_COLD
;

28 
boŞ
 
	`run_sk
(
Task
 *);

30 
´iv©e
:

32 
Task
 
_sk
;

34 
	}
};

	@linuxmodule/setcyclecount.cc

18 
	~<şick/cÚfig.h
>

19 
	~"£tcyşecouÁ.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/·ck‘_ªno.hh
>

23 
	gS‘CyşeCouÁ
::
	$S‘CyşeCouÁ
()

25 
	}
}

27 
S‘CyşeCouÁ
::~
	$S‘CyşeCouÁ
()

29 
	}
}

32 
S‘CyşeCouÁ
::
	$push
(, 
Pack‘
 *
p
)

34 
	`SET_PERFCTR_ANNO
(
p
, 
	`şick_g‘_cyşes
());

35 
	`ouut
(0).
	`push
(
p
);

36 
	}
}

38 
Pack‘
 *

39 
	gS‘CyşeCouÁ
::
	$puÎ
()

41 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

42 ià(
p
)

43 
	`SET_PERFCTR_ANNO
(
p
, 
	`şick_g‘_cyşes
());

44  
p
;

45 
	}
}

47 
	$ELEMENT_REQUIRES
(
lšuxmoduË
 
št64
)

48 
	`EXPORT_ELEMENT
(
S‘CyşeCouÁ
)

	@linuxmodule/setcyclecount.hh

1 #iâdeà
SETCYCLECOUNT_HH


2 
	#SETCYCLECOUNT_HH


	)

22 
	~<şick/–em’t.hh
>

24 şas 
	cS‘CyşeCouÁ
 : 
public
 
EËm’t
 {…ublic:

26 
	$S‘CyşeCouÁ
(è
CLICK_COLD
;

27 ~
	$S‘CyşeCouÁ
(è
CLICK_COLD
;

29 cÚ¡ *
	$şass_Çme
() const {  "SetCycleCount"; }

30 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

32 
push
(, 
Pack‘
 *
p
);

33 
Pack‘
 *
puÎ
();

	@linuxmodule/setperfcount.cc

18 
	~<şick/cÚfig.h
>

19 
	~"£”fcouÁ.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
	~<şick/³rfùr-i586.hh
>

26 
	gS‘P”fCouÁ
::
	$S‘P”fCouÁ
()

28 
	}
}

30 
S‘P”fCouÁ
::~
	$S‘P”fCouÁ
()

32 
	}
}

35 
S‘P”fCouÁ
::
	$ÿ¡
(cÚ¡ *
n
)

37 ià(
	`¡rcmp
(
n
, "PerfCountUser") == 0)

38  (
P”fCouÁU£r
 *)
this
;

39 ià(
	`¡rcmp
(
n
, "SetPerfCount") == 0)

40  (
EËm’t
 *)
this
;

43 
	}
}

46 
	gS‘P”fCouÁ
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

48 
SŒšg
 
	gm‘ric_Çme
;

49 ià(
Args
(
cÚf
, 
this
, 
”rh
)

50 .
»ad_mp
("METRIC", 
WÜdArg
(), 
m‘ric_Çme
)

51 .
com¶‘e
() < 0)

53 
	g_which
 = 
P”fCouÁU£r
::
´•¬e
(
m‘ric_Çme
, 
”rh
);

54  (
	g_which
 < 0 ? -1 : 0);

57 
šlše
 

58 
	gS‘P”fCouÁ
::
	$smaùiÚ
(
Pack‘
 *
p
)

60 
l
, 
h
;

61 
	`rdpmc
(
_which
, 
l
, 
h
);

62 
ušt64_t
 
hq
 = 
h
;

63 
	`SET_PERFCTR_ANNO
(
p
, (
hq
 << 32è| 
l
);

64 
	}
}

67 
	gS‘P”fCouÁ
::
	$push
(, 
Pack‘
 *
p
)

69 
	`smaùiÚ
(
p
);

70 
	`ouut
(0).
	`push
(
p
);

71 
	}
}

73 
Pack‘
 *

74 
	gS‘P”fCouÁ
::
	$puÎ
()

76 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

77 ià(
p
)

78 
	`smaùiÚ
(
p
);

79  
p
;

80 
	}
}

82 
	$ELEMENT_REQUIRES
(
lšuxmoduË
 
i586
 
št64
 
P”fCouÁU£r
)

83 
	`EXPORT_ELEMENT
(
S‘P”fCouÁ
)

	@linuxmodule/setperfcount.hh

1 #iâdeà
SETPERFCOUNT_HH


2 
	#SETPERFCOUNT_HH


	)

3 
	~"–em’ts/lšuxmoduË/³rfcouÁu£r.hh
"

28 şas 
	cS‘P”fCouÁ
 : 
public
 
P”fCouÁU£r
 {…ublic:

30 
	$S‘P”fCouÁ
(è
CLICK_COLD
;

31 ~
	$S‘P”fCouÁ
(è
CLICK_COLD
;

33 cÚ¡ *
	$şass_Çme
() const {  "SetPerfCount"; }

34 *
	`ÿ¡
(const *);

35 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

37 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

39 
šlše
 
smaùiÚ
(
Pack‘
 *);

40 
push
(, 
Pack‘
 *
p
);

41 
Pack‘
 *
puÎ
();

43 
	g´iv©e
:

45 
_which
;

	@linuxmodule/threadmonitor.cc

20 
	~<şick/cÚfig.h
>

21 
	~"th»admÚ™Ü.hh
"

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/rou‹r.hh
>

25 
	~<şick/ma¡”.hh
>

26 
	~<şick/”rÜ.hh
>

28 
	gTh»adMÚ™Ü
::
	$Th»adMÚ™Ü
()

29 : 
	$_tim”
(
this
)

31 
	}
}

33 
Th»adMÚ™Ü
::~
	$Th»adMÚ™Ü
()

35 
	}
}

38 
Th»adMÚ™Ü
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40 
	g_š‹rv®
 = 1000;

41 
	g_th»sh
 = 1000;

42 ià(
Args
(
cÚf
, 
this
, 
”rh
)

43 .
»ad_p
("INTERVAL", 
_š‹rv®
)

44 .
»ad_p
("THRESH", 
_th»sh
)

45 .
com¶‘e
() < 0)

51 
	gTh»adMÚ™Ü
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

53 
_tim”
.
	`š™Ÿlize
(
this
);

54 
_tim”
.
	`scheduË_aá”_m£c
(10);

56 
	}
}

59 
	gTh»adMÚ™Ü
::
	$run_tim”
(
Tim”
 *)

61 
Ma¡”
 *
m
 = 
	`rou‹r
()->
	`ma¡”
();

62 
SŒšgAccum
 
§
;

63 
şick_jiff›s_t
 
now_jiff›s
 = 
	`şick_jiff›s
();

64 
VeùÜ
<
Task
 *> 
sks
;

67 
tid
 = 0;id < 
m
->
	`Áh»ads
();id++) {

68 
sks
.
	`ş—r
();

69 
m
->
	`th»ad
(
tid
)->
	`scheduËd_sks
(
	`rou‹r
(), 
sks
);

70 
Task
 **
t
 = 
sks
.
	`begš
(); !ğsks.
	`’d
(); ++t)

71 ià((*
t
)->
	`cyşes
(è>ğ
_th»sh
) {

72 
§
 << 
now_jiff›s
 << ": oÀth»ad " << 
tid
 << ": "

73 << (*)*
t


74 << " (" << (*
t
)->
	`–em’t
()->
	`deş¬©iÚ
()

75 << "), cyşe " << (*
t
)->
	`cyşes
() << '\n';

79 ià(
§
.
	`Ëngth
())

80 
	`şick_ch©‹r
("%s", 
§
.
	`c_¡r
());

82 
_tim”
.
	`scheduË_aá”_m£c
(
_š‹rv®
);

83 
	}
}

85 
	$ELEMENT_REQUIRES
(
lšuxmoduË
 
smpşick
)

86 
	`EXPORT_ELEMENT
(
Th»adMÚ™Ü
)

	@linuxmodule/threadmonitor.hh

2 #iâdeà
CLICK_THREADMONITOR_HH


3 
	#CLICK_THREADMONITOR_HH


	)

20 
	~<şick/–em’t.hh
>

21 
	~<şick/tim”.hh
>

23 şas 
	cTh»adMÚ™Ü
 : 
public
 
EËm’t
 {…ublic:

25 
	$Th»adMÚ™Ü
(è
CLICK_COLD
;

26 ~
	$Th»adMÚ™Ü
(è
CLICK_COLD
;

28 cÚ¡ *
	$şass_Çme
() const {  "ThreadMonitor"; }

29 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

31 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

32 
	`run_tim”
(
Tim”
 *);

34 
´iv©e
:

36 
Tim”
 
_tim”
;

37 
_š‹rv®
;

38 
_th»sh
;

40 
	}
};

	@linuxmodule/todevice.cc

25 
	~<şick/cÚfig.h
>

26 
	~<şick/glue.hh
>

27 
	~"pŞldeviû.hh
"

28 
	~"todeviû.hh
"

29 
	~<şick/”rÜ.hh
>

30 
	~<şick/‘h”add»ss.hh
>

31 
	~<şick/¬gs.hh
>

32 
	~<şick/rou‹r.hh
>

33 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

34 
	~<şick/¡¿ccum.hh
>

36 
	~<şick/cxx´Ùeù.h
>

37 
	gCLICK_CXX_PROTECT


38 
	~<Ãt/pkt_sched.h
>

39 
	~<Ãt/d¡.h
>

40 
	gCLICK_CXX_UNPROTECT


41 
	~<şick/cxxuÅrÙeù.h
>

42 #ià
__i386__


43 
	~<şick/³rfùr-i586.hh
>

47 
AnyDeviûM­
 
	gto_deviû_m­
;

48 
nÙif›r_block
 
	gdeviû_nÙif›r
;

50 
deviû_nÙif›r_hook
(
nÙif›r_block
 *
nb
, 
v®
, *
v
);

51 #ià
HAVE_CLICK_KERNEL_TX_NOTIFY


52 
nÙif›r_block
 
tx_nÙif›r
;

53 
»gi¡”ed_tx_nÙif›rs
;

54 
tx_nÙif›r_hook
(
nÙif›r_block
 *
nb
, 
v®
, *
v
);

59 
ToDeviû
::
	$¡©ic_š™Ÿlize
()

61 
to_deviû_m­
.
	`š™Ÿlize
();

62 #ià
HAVE_CLICK_KERNEL_TX_NOTIFY


63 
tx_nÙif›r
.
nÙif›r_ÿÎ
 = 
tx_nÙif›r_hook
;

64 
tx_nÙif›r
.
´iÜ™y
 = 1;

65 
tx_nÙif›r
.
Ãxt
 = 0;

67 
deviû_nÙif›r
.
nÙif›r_ÿÎ
 = 
deviû_nÙif›r_hook
;

68 
deviû_nÙif›r
.
´iÜ™y
 = 1;

69 
deviû_nÙif›r
.
Ãxt
 = 0;

70 
	`»gi¡”_Ãtdeviû_nÙif›r
(&
deviû_nÙif›r
);

71 
	}
}

74 
ToDeviû
::
	$¡©ic_ş—nup
()

76 
	`uÄegi¡”_Ãtdeviû_nÙif›r
(&
deviû_nÙif›r
);

77 #ià
HAVE_CLICK_KERNEL_TX_NOTIFY


78 ià(
»gi¡”ed_tx_nÙif›rs
)

79 
	`uÄegi¡”_Ãt_tx
(&
tx_nÙif›r
);

81 
	}
}

83 
šlše
 

84 
ToDeviû
::
	$tx_wake_queue
(
Ãt_deviû
 *
dev
)

87 
_sk
.
	`»scheduË
();

88 
	}
}

90 #ià
HAVE_CLICK_KERNEL_TX_NOTIFY


93 
tx_nÙif›r_hook
(
nÙif›r_block
 *
nb
, 
v®
, *
v
)

95 
Ãt_deviû
 *
dev
 = (Ãt_deviû *)
v
;

96 ià(!
dev
)

98 
lock_æags
;

99 
to_deviû_m­
.
lock
(
çl£
, 
lock_æags
);

100 
AnyDeviû
 *
es
[8];

101 
Ãs
 = 
to_deviû_m­
.
lookup_®l
(
dev
, 
Œue
, 
es
, 8);

102 
i
 = 0; i < 
Ãs
; i++)

103 ((
ToDeviû
 *)(
es
[
i
]))->
tx_wake_queue
(
dev
);

104 
to_deviû_m­
.
uÆock
(
çl£
, 
lock_æags
);

110 
ToDeviû
::
	$ToDeviû
()

111 : 
	`_q
(0), 
	$_no_·d
(
çl£
)

113 
	}
}

115 
ToDeviû
::~
	$ToDeviû
()

117 
	}
}

121 
ToDeviû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

123 
_bur¡
 = 16;

124 
tx_queue
 = 0;

125 ià(
AnyDeviû
::
cÚfigu»_keywÜds
(
cÚf
, 
”rh
, 
çl£
) < 0

126 || (
Args
(
cÚf
, 
this
, 
”rh
)

127 .
»ad_mp
("DEVNAME", 
_devÇme
)

128 .
»ad_p
("BURST", 
_bur¡
)

129 .
»ad
("NO_PAD", 
_no_·d
)

130 .
»ad
("QUEUE", 
tx_queue
)

131 .
com¶‘e
() < 0))

133 #ià!
HAVE_NETDEV_GET_TX_QUEUE


134 ià(
tx_queue
 != 0)

135  
”rh
->
”rÜ
("the kernel only supports QUEUE 0");

137 
_tx_queue
 = 
tx_queue
;

140 
Ãt_deviû
 *
dev
 = 
lookup_deviû
(
”rh
);

141 #ià
HAVE_NETDEV_GET_TX_QUEUE


142 ià(
dev
 && 
_tx_queue
 >ğdev->
num_tx_queues
) {

143 
dev_put
(
dev
);

144 
dev
 = 0;

145 ià(!
®low_nÚexi¡’t
())

146  
”rh
->
”rÜ
("deviû %<%s%> ha Úly %d queues", 
_devÇme
.
c_¡r
(), 
_tx_queue
);

149 
£t_deviû
(
dev
, &
to_deviû_m­
, 0);

150  
”rh
->
Ã¼Üs
() ? -1 : 0;

154 
ToDeviû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

156 ià(
AnyDeviû
::
	`š™Ÿlize_keywÜds
(
”rh
) < 0)

160 ià(
	`ifšdex
() >= 0) {

161 
SŒšgAccum
 
wr™”_Çme
;

162 
wr™”_Çme
 << "deviû_wr™”_" << 
	`ifšdex
(è<< "_" << 
_tx_queue
;

163 *&
u£d
 = 
	`rou‹r
()->
	`fÜû_©chm’t
(
wr™”_Çme
.
	`ke_¡ršg
());

164 ià(
u£d
)

165  
”rh
->
	`”rÜ
("du¶iÿ‹ wr™” fÜ deviû %<%s%>", 
_devÇme
.
	`c_¡r
());

166 
u£d
 = 
this
;

169 #ià
HAVE_CLICK_KERNEL_TX_NOTIFY


170 ià(!
»gi¡”ed_tx_nÙif›rs
) {

171 
tx_nÙif›r
.
Ãxt
 = 0;

172 
	`»gi¡”_Ãt_tx
(&
tx_nÙif›r
);

174 
»gi¡”ed_tx_nÙif›rs
++;

177 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_dev
 !ğ0, 
”rh
);

178 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

180 #ià
HAVE_STRIDE_SCHED


182 
_max_tick‘s
 = 
_sk
.
	`tick‘s
();

183 
_sk
.
	`£t_tick‘s
(
Task
::
DEFAULT_TICKETS
);

186 
	`»£t_couÁs
();

188 
	}
}

191 
ToDeviû
::
	$»£t_couÁs
()

193 
_Åack‘s
 = 0;

195 
_busy_»tuºs
 = 0;

196 
_dev_idË
 = 0;

197 
_h¬d_¡¬t
 = 0;

198 
_too_shÜt
 = 0;

199 
_runs
 = 0;

200 
_drİs
 = 0;

201 
_hŞds
 = 0;

202 
_puÎs
 = 0;

203 #ià
CLICK_DEVICE_STATS


204 
_aùiv©iÚs
 = 0;

205 
_time_ş—n
 = 0;

206 
_time_ä“skb
 = 0;

207 
_time_queue
 = 0;

208 
_³rfút1_puÎ
 = 0;

209 
_³rfút1_ş—n
 = 0;

210 
_³rfút1_ä“skb
 = 0;

211 
_³rfút1_queue
 = 0;

212 
_³rfút2_puÎ
 = 0;

213 
_³rfút2_ş—n
 = 0;

214 
_³rfút2_ä“skb
 = 0;

215 
_³rfút2_queue
 = 0;

217 #ià
CLICK_DEVICE_THESIS_STATS
 || 
CLICK_DEVICE_STATS


218 
_puÎ_cyşes
 = 0;

220 
	}
}

223 
ToDeviû
::
	$ş—nup
(
CËªupSge
 
¡age
)

225 #ià
HAVE_CLICK_KERNEL_TX_NOTIFY


226 ià(
¡age
 >ğ
CLEANUP_INITIALIZED
) {

227 
»gi¡”ed_tx_nÙif›rs
--;

228 ià(
»gi¡”ed_tx_nÙif›rs
 == 0)

229 
	`uÄegi¡”_Ãt_tx
(&
tx_nÙif›r
);

232 ià(
_q
)

233 
_q
->
	`kl
();

234 
	`ş—r_deviû
(&
to_deviû_m­
, 0);

235 
	}
}

243 #ià
LINUX_VERSION_CODE
 < 0x020400

244 
	#şick_Ãtif_tx_queue_¡İ³d
(
dev
, 
txq
è((dev)->
tbusy
)

	)

245 
	#şick_Ãtif_tx_wake_queue
(
dev
, 
txq
è
	`m¬k_bh
(
NET_BH
)

	)

246 #–ià
HAVE_NETDEV_GET_TX_QUEUE


247 
	#şick_Ãtif_tx_queue_¡İ³d
(
dev
, 
txq
è
	`Ãtif_tx_queue_¡İ³d
(Ñxq))

	)

248 
	#şick_Ãtif_tx_wake_queue
(
dev
, 
txq
è
	`Ãtif_tx_wake_queue
(Ñxq))

	)

250 
	#şick_Ãtif_tx_queue_¡İ³d
(
dev
, 
txq
è
	`Ãtif_queue_¡İ³d
((dev))

	)

251 
	#şick_Ãtif_tx_wake_queue
(
dev
, 
txq
è
	`Ãtif_wake_queue
((dev))

	)

254 #ià
HAVE_NETIF_TX_QUEUE_FROZEN


255 
	#şick_Ãtif_tx_queue_äoz’
(
txq
è
	`Ãtif_tx_queue_äoz’
(Ñxq))

	)

257 
	#şick_Ãtif_tx_queue_äoz’
(
txq
è0

	)

260 #ifdeà
NETIF_F_LLTX


261 
	#şick_Ãtif_Ãeds_lock
(
dev
è(((dev)->
ã©u»s
 & 
NETIF_F_LLTX
è=ğ0)

	)

263 
	#şick_Ãtif_Ãeds_lock
(
dev
è1

	)

266 #ià
HAVE_NETDEV_GET_TX_QUEUE


267 
	#şick_Ãtif_lock
(
dev
, 
txq
èÑxq)->
_xm™_lock


	)

268 
	#şick_Ãtif_lock_owÃr
(
dev
, 
txq
èÑxq)->
xm™_lock_owÃr


	)

269 #–ià
HAVE_NETIF_TX_LOCK


270 
	#şick_Ãtif_lock
(
dev
, 
txq
è(dev)->
_xm™_lock


	)

271 
	#şick_Ãtif_lock_owÃr
(
dev
, 
txq
è(dev)->
xm™_lock_owÃr


	)

273 
	#şick_Ãtif_lock
(
dev
, 
txq
è(dev)->
xm™_lock


	)

274 
	#şick_Ãtif_lock_owÃr
(
dev
, 
txq
è(dev)->
xm™_lock_owÃr


	)

277 
boŞ


278 
	$tx_Œylock
(
Ãt_deviû
 *
dev
, 
Ãtdev_queue
 *
txq
) {

279 ià(!
	`şick_Ãtif_Ãeds_lock
(
dev
))

280  
Œue
;

282 ià(!
	`¥š_Œylock_bh
(&
	`şick_Ãtif_lock
(
dev
, 
txq
)))

283  
çl£
;

285 
	`şick_Ãtif_lock_owÃr
(
dev
, 
txq
èğ
	`smp_´oûssÜ_id
();

287  
Œue
;

288 
	}
}

291 
	$tx_uÆock
(
Ãt_deviû
 *
dev
, 
Ãtdev_queue
 *
txq
) {

292 ià(!
	`şick_Ãtif_Ãeds_lock
(
dev
))

295 #ià
HAVE_NETDEV_GET_TX_QUEUE


296 
	`__Ãtif_tx_uÆock_bh
(
txq
);

297 #–ià
HAVE_NETIF_TX_LOCK


298 
	`Ãtif_tx_uÆock_bh
(
dev
);

300 
dev
->
xm™_lock_owÃr
 = -1;

301 
	`¥š_uÆock_bh
(&
dev
->
xm™_lock
);

303 
	}
}

305 
boŞ


306 
ToDeviû
::
	$run_sk
(
Task
 *)

308 
busy
 = 0, 
£Á
 = 0, 
ok
;

309 
Ãt_deviû
 *
dev
 = 
_dev
;

310 ++
_runs
;

312 #ià
HAVE_NETDEV_GET_TX_QUEUE


313 
Ãtdev_queue
 *
txq
 = 
	`Ãtdev_g‘_tx_queue
(
dev
, 
_tx_queue
);

315 
Ãtdev_queue
 *
txq
 = 0;

318 ià(!
	`tx_Œylock
(
dev
, 
txq
)) {

319 
_sk
.
	`ç¡_»scheduË
();

320  
çl£
;

323 #ià
CLICK_DEVICE_STATS


324 
low00
, 
low10
;

325 
ušt64_t
 
time_now
;

326 
	`SET_STATS
(
low00
, 
low10
, 
time_now
);

329 #ià
HAVE_LINUX_POLLING


330 
boŞ
 
is_pŞlšg
 = (
dev
->
pŞlšg
 > 0);

331 
sk_buff
 *
ş—n_skbs
;

332 ià(
is_pŞlšg
)

333 
ş—n_skbs
 = 
dev
->
	`tx_ş—n
(dev);

335 
ş—n_skbs
 = 0;

339 
£Á
 < 
_bur¡
) {

341 
busy
 = 
	`şick_Ãtif_tx_queue_¡İ³d
(
dev
, 
txq
)

342 || 
	`şick_Ãtif_tx_queue_äoz’
(
txq
);

343 ià(
busy
 != 0)

346 #ià
CLICK_DEVICE_THESIS_STATS
 && !
CLICK_DEVICE_STATS


347 
şick_cyşes_t
 
befÜe_puÎ_cyşes
 = 
	`şick_g‘_cyşes
();

350 
_puÎs
++;

352 
Pack‘
 *
p
;

353 ià((
p
 = 
_q
)) {

354 
_q
 = 0;

355 ià(
	`şick_jiff›s_Ëss
(
_q_expœy_j
, 
	`şick_jiff›s
())) {

356 
p
->
	`kl
();

357 
_drİs
++;

358 
p
 = 0;

361 ià(!
p
) {

362 
	`tx_uÆock
(
dev
, 
txq
);

363 
p
 = 
	`šput
(0).
	`puÎ
();

364 ià(!
	`tx_Œylock
(
dev
, 
txq
)) {

365 
_sk
.
	`»scheduË
();

366 
_q
 = 
p
;

367 
_q_expœy_j
 = 
	`şick_jiff›s
(è+ 
queue_timeout
;

368 
ba
;

371 ià(!
p
)

374 #ià
CLICK_DEVICE_THESIS_STATS
 && !
CLICK_DEVICE_STATS


375 
_puÎ_cyşes
 +ğ
	`şick_g‘_cyşes
(è- 
befÜe_puÎ_cyşes
 - 
CLICK_CYCLE_COMPENSATION
;

378 
	`GET_STATS_RESET
(
low00
, 
low10
, 
time_now
,

379 
_³rfút1_puÎ
, 
_³rfút2_puÎ
, 
_puÎ_cyşes
);

381 
busy
 = 
	`queue_·ck‘
(
p
, 
txq
);

383 
	`GET_STATS_RESET
(
low00
, 
low10
, 
time_now
,

384 
_³rfút1_queue
, 
_³rfút2_queue
, 
_time_queue
);

386 ià(
busy
)

388 
£Á
++;

391 #ià
HAVE_LINUX_POLLING


392 ià(
is_pŞlšg
 && 
£Á
 > 0)

393 
dev
->
	`tx_eob
(dev);

400 ià(
is_pŞlšg
 && !
busy
 && 
dev
->
qdisc
->
q
.
qËn
) {

401 
dev
->
	`tx_eob
(dev);

402 
	`şick_Ãtif_tx_wake_queue
(
dev
, 
txq
);

407 #ià
HAVE_LINUX_POLLING


408 ià(
is_pŞlšg
) {

409 ià(
busy
 && 
£Á
 == 0) {

410 
_dev_idË
++;

411 ià(
_dev_idË
 == 1024) {

413 
dev
->
	`tx_¡¬t
(dev);

414 
_dev_idË
 = 0;

415 
_h¬d_¡¬t
++;

418 
_dev_idË
 = 0;

422 
	`tx_uÆock
(
dev
, 
txq
);

424 
ba
:

426 #ià
CLICK_DEVICE_STATS


427 ià(
£Á
 > 0)

428 
_aùiv©iÚs
++;

431 ià(
busy
 && 
£Á
 == 0)

432 
_busy_»tuºs
++;

438 #ià
HAVE_CLICK_KERNEL_TX_NOTIFY


439 
boŞ
 
»scheduË
 = (!
busy
 && (
£Á
 > 0 || 
_sigÇl
.
	`aùive
()));

441 
boŞ
 
»scheduË
 = (
busy
 || 
£Á
 > 0 || 
_sigÇl
.
	`aùive
());

444 #ià
HAVE_LINUX_POLLING


445 ià(
is_pŞlšg
) {

448 ià(
ş—n_skbs
) {

449 #ià
CLICK_DEVICE_STATS


450 ià(
_aùiv©iÚs
 > 1)

451 
	`GET_STATS_RESET
(
low00
, 
low10
, 
time_now
,

452 
_³rfút1_ş—n
, 
_³rfút2_ş—n
, 
_time_ş—n
);

454 
	`skbmgr_»cyşe_skbs
(
ş—n_skbs
);

455 #ià
CLICK_DEVICE_STATS


456 ià(
_aùiv©iÚs
 > 1)

457 
	`GET_STATS_RESET
(
low00
, 
low10
, 
time_now
,

458 
_³rfút1_ä“skb
, 
_³rfút2_ä“skb
, 
_time_ä“skb
);

462 
»scheduË
 = 
Œue
;

468 
	`adju¡_tick‘s
(
£Á
);

475 ià(
busy
 && 
£Á
 =ğ0 && !
	`Ãtif_ÿ¼›r_ok
(
dev
))

476 
»scheduË
 = 
çl£
;

478 ià(
»scheduË
)

479 
_sk
.
	`ç¡_»scheduË
();

480  
£Á
 > 0;

481 
	}
}

484 
ToDeviû
::
	$queue_·ck‘
(
Pack‘
 *
p
, 
Ãtdev_queue
 *
txq
)

486 
sk_buff
 *
skb1
 = 
p
->
	`skb
();

487 
Ãt_deviû
 *
dev
 = 
_dev
;

494 
Ãed_
 = 60 - 
p
->
	`Ëngth
();

496 ià(!
_no_·d
 && 
Ãed_
 > 0) {

497 ià(
	`skb_room
(
skb1
è< 
Ãed_
) {

498 ià(++
_too_shÜt
 == 1)

499 
	`´štk
("<1>ToDeviû % ·ck‘oØsm®ÈÖ’ %d,aroom %d,‚“d %d), hadØcİy\n", 
dev
->
Çme
, 
skb1
->
Ën
, 
	`skb_room
(skb1), 
Ãed_
);

500 
sk_buff
 *
nskb
 = 
	`skb_cİy_ex·nd
(
skb1
, 
	`skb_h—droom
(skb1), 
Ãed_
, 
GFP_ATOMIC
);

501 
	`kä“_skb
(
skb1
);

502 ià(!
nskb
)

504 
skb1
 = 
nskb
;

507 
	`mem£t
(
	`skb_put
(
skb1
, 
Ãed_
), 0,‚eed_tail);

512 
skb1
->
dev
 = dev;

514 #ifdeà
IFF_XMIT_DST_RELEASE


519 ià(
dev
->
´iv_æags
 & 
IFF_XMIT_DST_RELEASE
)

520 
	`skb_d¡_drİ
(
skb1
);

523 
»t
;

524 #ià
HAVE_LINUX_POLLING


525 ià(
dev
->
pŞlšg
 > 0) {

526 
»t
 = 
dev
->
	`tx_queue
(dev, 
skb1
);

527 
’queued
;

531 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 30)

533 
»t
 = 
dev
->
Ãtdev_İs
->
	`ndo_¡¬t_xm™
(
skb1
, dev);

534 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 31)

535 ià(
»t
 =ğ
NETDEV_TX_OK
)

536 
	`txq_Œªs_upd©e
(
txq
);

538 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 33)

539 
»t
 = !
	`dev_xm™_com¶‘e
(ret);

541 ià(
	`uÆik–y
(
»t
 =ğ
NET_XMIT_DROP
))

542 
p
 = 
NULL
;

545 
»t
 = 
dev
->
	`h¬d_¡¬t_xm™
(
skb1
, dev);

547 ++
_h¬d_¡¬t
;

549 
’queued
:

550 ià(
»t
 != 0) {

551 
_q
 = (
Pack‘
*)
skb1
;

552 
_q_expœy_j
 = 
	`şick_jiff›s
(è+ 
queue_timeout
;

553 ià(++
_hŞds
 == 1)

554 
	`´štk
("<1>ToDeviû % i fuÎ,…ack‘ d–ayed\n", 
dev
->
Çme
);

556 
_Åack‘s
++;

557  
»t
;

558 
	}
}

561 
ToDeviû
::
	$chªge_deviû
(
Ãt_deviû
 *
dev
)

563 #ià
HAVE_NETDEV_GET_TX_QUEUE


564 ià(
dev
 && 
_tx_queue
 >ğdev->
num_tx_queues
)

565 
dev
 = 0;

567 
boŞ
 
dev_chªge
 = 
_dev
 !ğ
dev
;

569 ià(
dev_chªge
)

570 
_sk
.
	`¡rÚg_unscheduË
();

572 
	`£t_deviû
(
dev
, &
to_deviû_m­
, 
ªydev_chªge
);

574 ià(
dev_chªge
 && 
_dev
)

575 
_sk
.
	`¡rÚg_»scheduË
();

576 ià(
_dev
 && 
_ÿ¼›r_ok
)

577 
_sk
.
	`»scheduË
();

578 
	}
}

582 
deviû_nÙif›r_hook
(
nÙif›r_block
 *
nb
, 
æags
, *
v
)

584 #ifdeà
NETDEV_GOING_DOWN


585 ià(
æags
 =ğ
NETDEV_GOING_DOWN
)

586 
æags
 = 
NETDEV_DOWN
;

588 ià(
æags
 =ğ
NETDEV_DOWN
 || fÏg =ğ
NETDEV_UP
 || fÏg =ğ
NETDEV_CHANGE
) {

589 
boŞ
 
exi¡s
 = (
æags
 !ğ
NETDEV_UP
);

590 
Ãt_deviû
 *
dev
 = (Ãt_deviû *)
v
;

591 
lock_æags
;

592 
to_deviû_m­
.
lock
(
Œue
, 
lock_æags
);

593 
AnyDeviû
 *
es
[8];

594 
Ãs
 = 
to_deviû_m­
.
lookup_®l
(
dev
, 
exi¡s
, 
es
, 8);

595 
i
 = 0; i < 
Ãs
; i++)

596 ((
ToDeviû
 *)(
es
[
i
]))->
chªge_deviû
(
æags
 =ğ
NETDEV_DOWN
 ? 0 : 
dev
);

597 
to_deviû_m­
.
uÆock
(
Œue
, 
lock_æags
);

603 
SŒšg


604 
ToDeviû
::
	$»ad_ÿÎs
(
EËm’t
 *
e
, *)

606 
ToDeviû
 *
td
 = (ToDeviû *)
e
;

607 
SŒšgAccum
 
§
;

608 
§
 << 
td
->
_hŞds
 << "…ackets held\n"

609 << 
td
->
_drİs
 << "…ackets dropped\n"

610 << 
td
->
_h¬d_¡¬t
 << " hard start xmit\n"

611 << 
td
->
_busy_»tuºs
 << " device busy„eturns\n"

612 << 
td
->
_Åack‘s
 << "…ackets sent\n"

613 << 
td
->
_runs
 << " callso„un_task()\n"

614 << 
td
->
_puÎs
 << "…ulls\n";

615 #ià
CLICK_DEVICE_STATS


616 
§
 << 
td
->
_puÎ_cyşes
 << " cycles…ull\n"

617 << 
td
->
_time_ş—n
 << " cycles clean\n"

618 << 
td
->
_time_ä“skb
 << " cycles freeskb\n"

619 << 
td
->
_time_queue
 << " cycles queue\n"

620 << 
td
->
_³rfút1_puÎ
 << "…erfctr1…ull\n"

621 << 
td
->
_³rfút1_ş—n
 << "…erfctr1 clean\n"

622 << 
td
->
_³rfút1_ä“skb
 << "…erfctr1 freeskb\n"

623 << 
td
->
_³rfút1_queue
 << "…erfctr1 queue\n"

624 << 
td
->
_³rfút2_puÎ
 << "…erfctr2…ull\n"

625 << 
td
->
_³rfút2_ş—n
 << "…erfctr2 clean\n"

626 << 
td
->
_³rfút2_ä“skb
 << "…erfctr2 freeskb\n"

627 << 
td
->
_³rfút2_queue
 << "…erfctr2 queue\n"

628 << 
td
->
_aùiv©iÚs
 << "ransmit‡ctivations\n";

630  
§
.
	`ke_¡ršg
();

631 
	}
}

634 
ToDeviû
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

636 
ToDeviû
 *
td
 = (ToDeviû *)
e
;

637 
td
->
	`»£t_couÁs
();

639 
	}
}

642 
ToDeviû
::
	$add_hªdËrs
()

644 
	`add_»ad_hªdËr
("ÿÎs", 
»ad_ÿÎs
, 0);

645 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
f_»ad
, &
_Åack‘s
);

646 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
f_»ad
, &
_drİs
);

647 
	`add_d©a_hªdËrs
("hŞds", 
HªdËr
::
f_»ad
, &
_hŞds
);

648 
	`add_d©a_hªdËrs
("·ck‘s", 
HªdËr
::
f_»ad
 | HªdËr::
f_d•»ÿ‹d
, &
_Åack‘s
);

649 #ià
CLICK_DEVICE_THESIS_STATS
 || 
CLICK_DEVICE_STATS


650 
	`add_»ad_hªdËr
("puÎ_cyşes", 
HªdËr
::
f_»ad
, &
_puÎ_cyşes
);

652 #ià
CLICK_DEVICE_STATS


653 
	`add_»ad_hªdËr
("’queue_cyşes", 
HªdËr
::
f_»ad
, &
_time_queue
);

654 
	`add_»ad_hªdËr
("ş—n_dma_cyşes", 
HªdËr
::
f_»ad
, &
_time_ş—n
);

656 
	`add_wr™e_hªdËr
("»£t_couÁs", 
wr™e_hªdËr
, 0, 
HªdËr
::
f_bu‰Ú
);

657 
	`add_sk_hªdËrs
(&
_sk
);

658 
	}
}

660 
	$ELEMENT_REQUIRES
(
AnyDeviû
 
lšuxmoduË
)

661 
	`EXPORT_ELEMENT
(
ToDeviû
)

	@linuxmodule/todevice.hh

1 #iâdeà
CLICK_TODEVICE_HH


2 
	#CLICK_TODEVICE_HH


	)

108 
	~"–em’ts/lšuxmoduË/ªydeviû.hh
"

109 
	~<şick/nÙif›r.hh
>

110 
	gÃtdev_queue
;

112 şas 
	cToDeviû
 : 
public
 
AnyTaskDeviû
 {…ublic:

114 
	$ToDeviû
(è
CLICK_COLD
;

115 ~
	$ToDeviû
(è
CLICK_COLD
;

117 
	`¡©ic_š™Ÿlize
();

118 
	`¡©ic_ş—nup
();

120 cÚ¡ *
	$şass_Çme
() const {  "ToDevice"; }

121 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_0
; 
	}
}

122 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

124 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_TODEVICE
; 
	}
}

125 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

126 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

127 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

128 
	$add_hªdËrs
(è
CLICK_COLD
;

130 
boŞ
 
	`run_sk
(
Task
 *);

132 
	`»£t_couÁs
();

133 
šlše
 
	`tx_wake_queue
(
Ãt_deviû
 *);

134 
boŞ
 
	`tx_šŒ
();

135 
	`chªge_deviû
(
Ãt_deviû
 *);

137 #ià
HAVE_LINUX_POLLING


138 
boŞ
 
	$pŞlšg
(ècÚ¡ {  
_dev
 && _dev->
pŞlšg
 > 0; 
	}
}

140 
boŞ
 
	$pŞlšg
(ècÚ¡ {  
çl£
; 
	}
}

143 
	g´iv©e
:

146 
queue_timeout
 = 
CLICK_HZ
 / 4

149 #ià
HAVE_NETDEV_GET_TX_QUEUE


150 
	g_tx_queue
;

152 ’um { 
	g_tx_queue
 = 0 };

154 
Pack‘
 *
	g_q
;

155 
şick_jiff›s_t
 
	g_q_expœy_j
;

156 
	g_bur¡
;

157 
	g_dev_idË
;

158 
NÙif›rSigÇl
 
	g_sigÇl
;

159 
boŞ
 
	g_no_·d
;

161 #ià
CLICK_DEVICE_STATS


163 
ušt64_t
 
	g_time_ş—n
;

164 
ušt64_t
 
	g_time_ä“skb
;

165 
ušt64_t
 
	g_time_queue
;

166 
ušt64_t
 
	g_³rfút1_puÎ
;

167 
ušt64_t
 
	g_³rfút1_ş—n
;

168 
ušt64_t
 
	g_³rfút1_ä“skb
;

169 
ušt64_t
 
	g_³rfút1_queue
;

170 
ušt64_t
 
	g_³rfút2_puÎ
;

171 
ušt64_t
 
	g_³rfút2_ş—n
;

172 
ušt64_t
 
	g_³rfút2_ä“skb
;

173 
ušt64_t
 
	g_³rfút2_queue
;

174 
ušt32_t
 
	g_aùiv©iÚs
;

176 
ušt32_t
 
	g_runs
;

177 
ušt32_t
 
	g_puÎs
;

178 
ušt32_t
 
	g_Åack‘s
;

179 #ià
CLICK_DEVICE_THESIS_STATS
 || 
CLICK_DEVICE_STATS


180 
şick_cyşes_t
 
	g_puÎ_cyşes
;

182 
ušt32_t
 
	g_drİs
;

183 
ušt32_t
 
	g_hŞds
;

184 
ušt32_t
 
	g_h¬d_¡¬t
;

185 
ušt32_t
 
	g_busy_»tuºs
;

186 
ušt32_t
 
	g_too_shÜt
;

188 
queue_·ck‘
(
Pack‘
 *
p
, 
Ãtdev_queue
 *
txq
);

190 
SŒšg
 
»ad_ÿÎs
(
EËm’t
 *
e
, *
u£r_d©a
);

191 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
u£r_d©a
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

193 
	}
};

	@linuxmodule/tohost.cc

20 
	~<şick/cÚfig.h
>

21 
	~"toho¡.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

25 
	~<şick/cxx´Ùeù.h
>

26 
	gCLICK_CXX_PROTECT


27 
	~<Ãt/d¡.h
>

28 
	~<Ãt/xäm.h
>

29 
	~<lšux/if_‘h”.h
>

30 
	~<lšux/if_¬p.h
>

31 
	~<lšux/‘h”deviû.h
>

32 
	~<lšux/Ãtdeviû.h
>

33 #ià
LINUX_VERSION_CODE
 >= 0x020400 && LINUX_VERSION_CODE < 0x020600

34 
	~<lšux/b¾ock.h
>

36 
	gCLICK_CXX_UNPROTECT


37 
	~<şick/cxxuÅrÙeù.h
>

40 
AnyDeviûM­
 
	gto_ho¡_m­
;

41 
nÙif›r_block
 
	gdeviû_nÙif›r
;

43 
deviû_nÙif›r_hook
(
nÙif›r_block
 *
nb
, 
v®
, *
v
);

47 
ToHo¡
::
	$¡©ic_š™Ÿlize
()

49 
to_ho¡_m­
.
	`š™Ÿlize
();

50 
deviû_nÙif›r
.
nÙif›r_ÿÎ
 = 
deviû_nÙif›r_hook
;

51 
deviû_nÙif›r
.
´iÜ™y
 = 1;

52 
deviû_nÙif›r
.
Ãxt
 = 0;

53 
	`»gi¡”_Ãtdeviû_nÙif›r
(&
deviû_nÙif›r
);

54 
	}
}

57 
ToHo¡
::
	$¡©ic_ş—nup
()

59 
	`uÄegi¡”_Ãtdeviû_nÙif›r
(&
deviû_nÙif›r
);

60 
	}
}

62 
ToHo¡
::
	$ToHo¡
()

63 : 
	`_¢ifãrs
(
çl£
), 
	$_drİs
(0)

65 
	}
}

67 
ToHo¡
::~
	$ToHo¡
()

69 
	}
}

72 
ToHo¡
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

74 
SŒšg
 
ty³
;

75 ià(
AnyDeviû
::
cÚfigu»_keywÜds
(
cÚf
, 
”rh
, 
çl£
) < 0

76 || (
Args
(
cÚf
, 
this
, 
”rh
)

77 .
»ad_p
("DEVNAME", 
_devÇme
)

78 .
»ad
("SNIFFERS", 
_¢ifãrs
)

79 .
»ad
("TYPE", 
WÜdArg
(), 
ty³
)

80 .
com¶‘e
() < 0))

82 ià(
ty³
 == "ETHER" ||ype == "")

83 
_ty³
 = 
ARPHRD_ETHER
;

84 ià(
ty³
 == "IP")

85 
_ty³
 = 
ARPHRD_NONE
;

87  
”rh
->
”rÜ
("bad TYPE");

92 
ToHo¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

94 ià(
AnyDeviû
::
	`š™Ÿlize_keywÜds
(
”rh
) < 0)

99 ià(
_devÇme
) {

100 
Ãt_deviû
 *
dev
 = 
	`lookup_deviû
(
”rh
);

101 
	`£t_deviû
(
dev
, &
to_ho¡_m­
, 0);

103  
”rh
->
	`Ã¼Üs
() ? -1 : 0;

104 
	}
}

107 
ToHo¡
::
	$ş—nup
(
CËªupSge
)

109 
	`ş—r_deviû
(&
to_ho¡_m­
, 0);

110 
	}
}

114 
deviû_nÙif›r_hook
(
nÙif›r_block
 *
nb
, 
æags
, *
v
)

116 #ifdeà
NETDEV_GOING_DOWN


117 ià(
æags
 =ğ
NETDEV_GOING_DOWN
)

118 
æags
 = 
NETDEV_DOWN
;

120 ià(
æags
 =ğ
NETDEV_DOWN
 || fÏg =ğ
NETDEV_UP
) {

121 
boŞ
 
exi¡s
 = (
æags
 !ğ
NETDEV_UP
);

122 
Ãt_deviû
 *
dev
 = (Ãt_deviû *)
v
;

123 
lock_æags
;

124 
to_ho¡_m­
.
lock
(
Œue
, 
lock_æags
);

125 
AnyDeviû
 *
es
[8];

126 
Ãs
 = 
to_ho¡_m­
.
lookup_®l
(
dev
, 
exi¡s
, 
es
, 8);

127 
i
 = 0; i < 
Ãs
; i++)

128 ((
ToHo¡
 *)(
es
[
i
]))->
£t_deviû
(
æags
 =ğ
NETDEV_DOWN
 ? 0 : 
dev
, &
to_ho¡_m­
, 
AnyDeviû
::
ªydev_chªge
);

129 
to_ho¡_m­
.
uÆock
(
Œue
, 
lock_æags
);

135 
šlše
 
ušt16_t


136 
	$toho¡_‘h_ty³_Œªs
(
sk_buff
 *
skb
, 
Ãt_deviû
 *
dev
)

141 #ià
HAVE_NETDEV_USES_DSA_TAGS


142 ià(
	`Ãtdev_u£s_d§_gs
(
skb
->
dev
))

143  
	`__cÚ¡ªt_htÚs
(
ETH_P_DSA
);

145 #ià
HAVE_NETDEV_USES_TRAILER_TAGS


146 ià(
	`Ãtdev_u£s_Œa”_gs
(
skb
->
dev
))

147  
	`__cÚ¡ªt_htÚs
(
ETH_P_TRAILER
);

151 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 0)

152 cÚ¡ 
‘hhdr
 *
‘h
 = 
	`‘h_hdr
(
skb
);

154 cÚ¡ 
‘hhdr
 *
‘h
 = 
skb
->
mac
.
‘h”Ãt
;

156 ià(
	`Áohs
(
‘h
->
h_´Ùo
) >= 1536)

157  
‘h
->
h_´Ùo
;

159 cÚ¡ *
¿wp
 = 
skb
->
d©a
;

162 ià(*(cÚ¡ *)
¿wp
 == 0xFFFF)

163  
	`__cÚ¡ªt_htÚs
(
ETH_P_802_3
);

164  
	`__cÚ¡ªt_htÚs
(
ETH_P_802_2
);

165 
	}
}

168 
ToHo¡
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

170 
p
->
	`ş—r_ªnÙ©iÚs
(
çl£
);

172 
sk_buff
 *
skb
 = 
p
->
	`skb
();

175 ià(
_dev
)

176 
skb
->
dev
 = 
_dev
;

179 ià(!
skb
->
dev
) {

180 ià(++
_drİs
 == 1)

181 
	`şick_ch©‹r
("%p{–em’t}: drİ³d‡…ack‘ w™h‚uÎ skb->dev", 
this
);

182 
p
->
	`kl
();

186 #ià
PACKET_TYPE_MASK


188 
skb
->
pkt_ty³
 &ğ
PACKET_TYPE_MASK
;

193 #ià
HAVE_SKB_DST_DROP


194 
	`skb_d¡_drİ
(
skb
);

196 ià(
skb
->
d¡
) {

197 
	`d¡_»Ëa£
(
skb
->
d¡
);

198 
skb
->
d¡
 = 0;

205 
	`£ı©h_»£t
(
skb
);

208 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 24)

209 
	`skb_»£t_mac_h—d”
(
skb
);

211 
skb
->
mac
.
¿w
 = skb->
d©a
;

215 ià(
_ty³
 =ğ
ARPHRD_NONE
)

216 
skb
->
´ÙocŞ
 = 
	`__cÚ¡ªt_htÚs
(
ETH_P_IP
);

220 
	`skb_puÎ
(
skb
, 14);

221 
skb
->
´ÙocŞ
 = 
	`toho¡_‘h_ty³_Œªs
(skb, skb->
dev
);

225 
´ÙocŞ
 = (
_¢ifãrs
 ? 0xFFFF : 
skb
->protocol);

228 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(3, 1, 0è|| 
	`defšed
(
HAVE_NETIF_RECEIVE_SKB
)

229 
Ãt_deviû
 *
dev
 = 
skb
->dev;

230 
	`loÿl_bh_di§bË
();

231 
	`dev_hŞd
(
dev
);

233 #ià
HAVE___NETIF_RECEIVE_SKB


234 (è
	`__Ãtif_»ûive_skb
(
skb
, 
´ÙocŞ
, -1);

235 #–ià
HAVE_NETIF_RECEIVE_SKB_EXTENDED


236 
	`Ãtif_»ûive_skb
(
skb
, 
´ÙocŞ
, -1);

240 (è
´ÙocŞ
;

243 ià(
_¢ifãrs
)

244 
skb
->
pkt_ty³
 = 
PACKET_OTHERHOST
;

247 
	`CLICK_DEVICE_UNRECEIVABLE_SK_BUFF_WRITE
(
skb
);

248 
	`Ãtif_»ûive_skb
(
skb
);

249 
	`CLICK_DEVICE_UNRECEIVABLE_SK_BUFF_WRITE
((
sk_buff
*) 0);

252 
	`dev_put
(
dev
);

253 
	`loÿl_bh_’abË
();

258 ià(
skb
->
¡amp
.
tv_£c
 == 0) {

259 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 4, 18)

260 
	`do_g‘timeofday
(&
skb
->
¡amp
);

261 #–ià!
	`defšed
(
CONFIG_CPU_IS_SLOW
)

262 
	`g‘_ç¡_time
(&
skb
->
¡amp
);

264 
skb
->
¡amp
 = 
xtime
;

268 #ifdeà
HAVE_CLICK_KERNEL


269 
skb
->
h
.
¿w
 = skb->
nh
.¿w = skb->
d©a
;

270 #ià
LINUX_VERSION_CODE
 >= 0x020400

271 
	`loÿl_bh_di§bË
();

272 
	`br_»ad_lock
(
BR_NETPROTO_LOCK
);

273 
Ãt_deviû
 *
dev
 = 
skb
->dev;

274 
	`dev_hŞd
(
dev
);

275 
	`±y³_di¥©ch
(
skb
, 
´ÙocŞ
);

276 
	`dev_put
(
dev
);

277 
	`br_»ad_uÆock
(
BR_NETPROTO_LOCK
);

278 
	`loÿl_bh_’abË
();

283 ++
_drİs
;

284 
	`kä“_skb
(
skb
);

287 
	}
}

290 
ToHo¡
::
	$add_hªdËrs
()

292 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

293 
	}
}

295 
	$ELEMENT_REQUIRES
(
lšuxmoduË
 
AnyDeviû
)

296 
	`EXPORT_ELEMENT
(
ToHo¡
)

	@linuxmodule/tohost.hh

2 #iâdeà
CLICK_TOHOST_HH


3 
	#CLICK_TOHOST_HH


	)

4 
	~"–em’ts/lšuxmoduË/ªydeviû.hh
"

113 şas 
	cToHo¡
 : 
public
 
AnyDeviû
 {…ublic:

115 
	$ToHo¡
(è
CLICK_COLD
;

116 ~
	$ToHo¡
(è
CLICK_COLD
;

118 
	`¡©ic_š™Ÿlize
();

119 
	`¡©ic_ş—nup
();

121 cÚ¡ *
	$şass_Çme
() const {  "ToHost"; }

122 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_0
; 
	}
}

123 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

124 cÚ¡ *
	$æags
(ècÚ¡ {  "S2"; 
	}
}

126 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_TODEVICE
; 
	}
}

127 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

128 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

129 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

130 
	$add_hªdËrs
(è
CLICK_COLD
;

132 
	`push
(
pÜt
, 
Pack‘
 *);

134 
´iv©e
:

136 
boŞ
 
_¢ifãrs
;

137 
_drİs
;

138 
_ty³
;

140 
ä›nd
 
şass
 
ToHo¡Snifãrs
;

142 
	}
};

	@linuxmodule/tohostsniffers.cc

20 
	~<şick/cÚfig.h
>

21 
	~"toho¡¢ifãrs.hh
"

23 
	gToHo¡Snifãrs
::
	$ToHo¡Snifãrs
()

26 
_¢ifãrs
 = 
Œue
;

27 
	}
}

29 
	gToHo¡Snifãrs
::~
	$ToHo¡Snifãrs
()

32 
	}
}

34 
	$ELEMENT_REQUIRES
(
lšuxmoduË
 
ToHo¡
)

35 
	`EXPORT_ELEMENT
(
ToHo¡Snifãrs
)

	@linuxmodule/tohostsniffers.hh

2 #iâdeà
CLICK_TOHOSTSNIFFERS_HH


3 
	#CLICK_TOHOSTSNIFFERS_HH


	)

4 
	~"–em’ts/lšuxmoduË/toho¡.hh
"

32 şas 
	cToHo¡Snifãrs
 : 
public
 
ToHo¡
 {…ublic:

34 
	$ToHo¡Snifãrs
(è
CLICK_COLD
;

35 ~
	$ToHo¡Snifãrs
(è
CLICK_COLD
;

37 cÚ¡ *
	$şass_Çme
() const {  "ToHostSniffers"; }

39 
	}
};

	@linuxmodule/touserdevice.cc

25 
	~<şick/cÚfig.h
>

26 
	~<şick/glue.hh
>

27 
	~<şick/”rÜ.hh
>

28 
	~<şick/¬gs.hh
>

29 
	~<şick/rou‹r.hh
>

30 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

32 
	~<şick/cxx´Ùeù.h
>

33 
	gCLICK_CXX_PROTECT


34 
	~<lšux/pŞl.h
>

35 
	~<lšux/wa™.h
>

36 
	~<lšux/sched.h
>

37 
	~<lšux/fs.h
>

38 
	~<asm/uacûss.h
>

39 
	gCLICK_CXX_UNPROTECT


40 
	~<şick/cxxuÅrÙeù.h
>

42 
	~"tou£rdeviû.hh
"

43 
	~"äomu£rdeviû.hh
"

46 cÚ¡ 
	gDEV_NAME
[] = "click_user";

47 
	gDEV_MAJOR
 = 241;

48 
	gDEV_NUM
 = 0;

50 
fe_İ”©iÚs
 *
	gToU£rDeviû
::
dev_fİs
;

52 
ToU£rDeviû
 * vŞ©
	gToU£rDeviû
::
–em_m­
[256] = {0};

54 
¥šlock_t
 
	gu£rdeviû_lock
;

56 
	spÿp_hdr
 {

57 
ušt32_t
 
	mmagic_numb”
;

58 
ušt16_t
 
	mv”siÚ_majÜ
;

59 
ušt16_t
 
	mv”siÚ_mšÜ
;

60 
št32_t
 
	mthiszÚe
;

61 
ušt32_t
 
	msigfigs
;

62 
ušt32_t
 
	m¢­Ën
;

63 
ušt32_t
 
	mÃtwÜk
;

66 
	spÿ´ec_hdr
 {

67 
ušt32_t
 
	mts_£c
;

68 
ušt32_t
 
	mts_u£c
;

69 
ušt32_t
 
	mšş_Ën
;

70 
ušt32_t
 
	mÜig_Ën
;

73 
	g‹m¶©e
 <
ty³Çme
 
	gT
>

74 şas 
	c»f_hŞd”
 {

75 
	mpublic
:

76 
ex¶ic™
 
	$»f_hŞd”
(
T
 & 
t
è: 
	$t_
(
t
) { }

77 ~
	$»f_hŞd”
(è{ --
t_
; 
	}
}

78 
	g´iv©e
:

79 
T
 & 
t_
;

82 
	gToU£rDeviû
::
	$ToU£rDeviû
(è: 
	$_sk
(
this
)

84 
_ex™
 = 
çl£
;

85 
_u£_couÁ
 = 0;

86 
_size
 = 0;

87 
_q
 = 0;

88 
_r_¦Ù
 = 0;

89 
_w_¦Ù
 = 0;

90 
_dev_majÜ
 = 
DEV_MAJOR
;

91 
_»ad_couÁ
 = 0;

92 
_drİ_couÁ
 = 0;

93 
_¦“p_´oc
 = 0;

94 
_pkt_couÁ
 = 0;

95 
_block_couÁ
 = 0;

96 
_pkt_»ad_couÁ
 = 0;

97 
_çed_couÁ
 = 0;

98 
_äom_u£r_deviû
 = 0;

99 
	}
}

101 
	gToU£rDeviû
::~
	$ToU£rDeviû
()

103 
	}
}

105 
fe_İ”©iÚs
 *
şick_Ãw_fe_İ”©iÚs
(cÚ¡ * 
Çme
);

108 
	gToU£rDeviû
::
	$¡©ic_š™Ÿlize
()

110 
	`¥š_lock_š™
(&
u£rdeviû_lock
);

112 ià((
dev_fİs
 = 
	`şick_Ãw_fe_İ”©iÚs
("ToUserDev"))) {

113 
dev_fİs
->
»ad
 = 
dev_»ad
;

114 
dev_fİs
->
wr™e
 = 
dev_wr™e
;

115 
dev_fİs
->
pŞl
 = 
dev_pŞl
;

116 
dev_fİs
->
İ’
 = 
dev_İ’
;

117 
dev_fİs
->
»Ëa£
 = 
dev_»Ëa£
;

119 
	}
}

122 
	gToU£rDeviû
::
	$¡©ic_ş—nup
()

124 
dev_fİs
 = 0;

125 
	}
}

127 
	#GETELEM
(
fp
è(
ToU£rDeviû
::
–em_m­
[((
fe_´iv
 *)fp->
´iv©e_d©a
)->
mšÜ_num
])

	)

131 
	gToU£rDeviû
::
	$dev_İ’
(
šode
 *šode, 
fe
 *
fp
)

133 
num
 = 
	`MINOR
(
šode
->
i_rdev
);

134 ià(!
–em_m­
[
num
]) {

135 
	`şick_ch©‹r
("NØToU£rDeviûƒËm’ˆfÜhi deviû: %d\n", 
num
);

136  -
EIO
;

139 
fe_´iv
 *
f
 = (fe_´iv *è
	`km®loc
((fe_´iv), 
GFP_ATOMIC
);

140 ià(!
f
)

141  -
ENOMEM
;

142 
f
->
mšÜ_num
 = 
num
;

143 
f
->
»ad_Úû
 = 0;

144 
f
->
p
 = 0;

145 
fp
->
´iv©e_d©a
 = (*)
f
;

147 
	}
}

151 
	gToU£rDeviû
::
	$dev_»Ëa£
(
šode
 *šode, 
fe
 *
fp
)

153 
fe_´iv
 *
f
 = (fe_´iv *)
fp
->
´iv©e_d©a
;

154 ià(
f
 && f->
p
)

155 
f
->
p
->
	`kl
();

156 
	`kä“
(
fp
->
´iv©e_d©a
);

158 
	}
}

160 
ssize_t


161 
	gToU£rDeviû
::
	$dev_wr™e
(
fe
 *
fp
, cÚ¡ *
buff
, 
size_t
 
Ën
, 
loff_t
 *
µos
)

163 
	`¥š_lock
(&
u£rdeviû_lock
);

164 
ToU£rDeviû
 *
–em
 = 
	`GETELEM
(
fp
);

165 ià(
–em
)

166 ++
–em
->
_u£_couÁ
;

167 
	`¥š_uÆock
(&
u£rdeviû_lock
);

169 ià(!
–em
)

170  -
ENODEV
;

172 
»f_hŞd”
<
	`ty³of
(
–em
->
_u£_couÁ
)> 
	`r
(elem->_use_count);

174 
FromU£rDeviû
 *
fud
 = 
–em
->
_äom_u£r_deviû
;

175 ià(!
fud
)

176  -
EPERM
;

178  
fud
->
	`dev_wr™e
(
buff
, 
Ën
, 
µos
);

179 
	}
}

181 
ssize_t


182 
	gToU£rDeviû
::
	$dev_»ad
(
fe
 *
fp
, *
buff
, 
size_t
 
Ën
, 
loff_t
 *
µos
)

184 
	`¥š_lock
(&
u£rdeviû_lock
);

185 
ToU£rDeviû
 *
–em
 = 
	`GETELEM
(
fp
);

186 ià(
–em
)

187 ++
–em
->
_u£_couÁ
;

188 
	`¥š_uÆock
(&
u£rdeviû_lock
);

190 ià(!
–em
)

191  -
ENODEV
;

193 
»f_hŞd”
<
	`ty³of
(
–em
->
_u£_couÁ
)> 
	`r
(elem->_use_count);

195 
fe_´iv
 *
f
 = (fe_´iv *)
fp
->
´iv©e_d©a
;

196 
nãtched
 = 0;

197 
ssize_t
 
Ä—d
 = 0;

199 
–em
->
_»ad_couÁ
++;

201 ià(
–em
->
_debug
)

202 
	`´štk
("»ad %d…kˆ%p\n", 
f
->
»ad_Úû
, f->
p
);

204 ià(
f
->
»ad_Úû
 =ğ0 && 
–em
->
_’ÿp_ty³
 =ğ
ty³_’ÿp_pÿp
) {

206 
Pack‘
 *
p
 = Pack‘::
	`make
((
pÿp_hdr
));

207 ià(!
p
)

208  -
ENOMEM
;

209 
nãtched
++;

210 
pÿp_hdr
 *
hdr
 = (pÿp_hd¸*)
p
->
	`d©a
();

211 
	`mem£t
(
hdr
, 0, (
pÿp_hdr
));

212 
hdr
->
magic_numb”
 = 
	`htÚl
(0xa1b2c3d4);

213 
hdr
->
v”siÚ_majÜ
 = 
	`htÚs
(2);

214 
hdr
->
v”siÚ_mšÜ
 = 
	`htÚs
(4);

215 
hdr
->
thiszÚe
 = 
	`htÚl
(0);

216 
hdr
->
sigfigs
 = 
	`htÚl
(0);

217 
hdr
->
¢­Ën
 = 
	`htÚl
(
–em
->
_pÿp_¢­Ën
);

218 
hdr
->
ÃtwÜk
 = 
	`htÚl
(
–em
->
_pÿp_ÃtwÜk
);

219 
f
->
p
 =…;

220 
f
->
»ad_Úû
 = 1;

221 ià(
–em
->
_debug
)

222 
	`´štk
("%s:%d cİ›d h—d”\n", 
__func__
, 
__LINE__
);

225 ià(
f
->
p
) {

226 
Pack‘
 *
p
 = 
f
->p;

227 
ssize_t
 
to_cİy
 = 
p
->
	`Ëngth
();

228 ià(
to_cİy
 > 
Ën
)

229 
to_cİy
 = 
Ën
;

230 ià(
	`cİy_to_u£r
(
buff
, 
p
->
	`d©a
(), 
to_cİy
)) {

231 
–em
->
_çed_couÁ
++;

232 
	`şick_ch©‹r
("%p{–em’t}: R—d FauÉ", 
–em
);

233 
p
->
	`kl
();

234  -
EFAULT
;

236 
Ä—d
 +ğ
to_cİy
;

237 ià(
to_cİy
 < 
p
->
	`Ëngth
()) {

238 
p
->
	`puÎ
(
Ä—d
);

239 } ià(
to_cİy
 =ğ
p
->
	`Ëngth
()) {

240 
p
->
	`kl
();

241 
f
->
p
 = 0;

243 ià(
Ä—d
 =ğ
Ën
 || 
–em
->
_ty³
 =ğ
ty³_·ck‘
)

244  
Ä—d
;

247 
	`¥š_lock
(&
–em
->
_lock
);

248 ià(!
Ä—d
 && 
–em
->
_blockšg
) {

249 ià((
fp
->
f_æags
 & 
O_NONBLOCK
è&& !
–em
->
_size
) {

250 
	`¥š_uÆock
(&
–em
->
_lock
);

251  -
EAGAIN
;

255 
wa™_queue_t
 
wq
;

256 
	~<şick/cxx´Ùeù.h
>

257 
	`š™_wa™
(&
wq
);

258 
	~<şick/cxxuÅrÙeù.h
>

259 !
–em
->
_size
 && !–em->
_ex™
) {

261 
–em
->
_block_couÁ
++;

262 
–em
->
_¦“p_´oc
++;

263 
	`´•¬e_to_wa™
(&
–em
->
_´oc_queue
, &
wq
, 
TASK_INTERRUPTIBLE
);

264 ià(
–em
->
_size
 ||ƒËm->
_ex™
) {

265 
	`fšish_wa™
(&
–em
->
_´oc_queue
, &
wq
);

268 
	`¥š_uÆock
(&
–em
->
_lock
);

269 ià(
	`sigÇl_³ndšg
(
cu¼’t
)) {

270 
	`fšish_wa™
(&
–em
->
_´oc_queue
, &
wq
);

271  -
ERESTARTSYS
;

274 
	`scheduË
();

276 ià(!
–em
->
_ex™
)

277  -
ENODEV
;

279 
	`¥š_lock
(&
–em
->
_lock
);

280 
–em
->
_¦“p_´oc
--;

282 ià(
–em
->
_ex™
) {

283 
	`¥š_uÆock
(&
–em
->
_lock
);

284  -
EIO
;

288 
–em
->
_size


289 && (
nãtched
 < 
–em
->
_max_bur¡
 ||ƒlem->_max_burst == 0)

290 && 
Ä—d
 < 
Ën


291 && !
–em
->
_ex™
) {

292 
nãtched
++;

293 
Pack‘
 *
p
 = 
–em
->
	`pİ_·ck‘
();

294 
	`¥š_uÆock
(&
–em
->
_lock
);

296 
ssize_t
 
to_cİy
 = 
p
->
	`Ëngth
();

297 ià(
to_cİy
 > 
Ën
 - 
Ä—d
)

298 
to_cİy
 = 
Ën
 - 
Ä—d
;

299 ià(
	`cİy_to_u£r
(
buff
 + 
Ä—d
, 
p
->
	`d©a
(), 
to_cİy
)) {

300 
–em
->
_çed_couÁ
++;

301 
	`şick_ch©‹r
("%p{–em’t}: R—d FauÉ", 
–em
);

302 
p
->
	`kl
();

303  -
EFAULT
;

305 
Ä—d
 +ğ
to_cİy
;

306 ià(
–em
->
_ty³
 =ğ
ty³_¡»am
 && 
to_cİy
 < 
p
->
	`Ëngth
()) {

307 
p
->
	`puÎ
(
to_cİy
);

308 
f
->
p
 =…;

310 
p
->
	`kl
();

312 
	`¥š_lock
(&
–em
->
_lock
);

313 
–em
->
_pkt_»ad_couÁ
++;

316 ià(
Ä—d
 =ğ0 && 
–em
->
_ex™
)

317 
Ä—d
 = -
EIO
;

319 
	`¥š_uÆock
(&
–em
->
_lock
);

320  
Ä—d
;

321 
	}
}

323 
ušt


324 
	gToU£rDeviû
::
	$dev_pŞl
(
fe
 *
fp
, 
pŞl_bË_¡ruù
 *
±
)

326 
	`¥š_lock
(&
u£rdeviû_lock
);

327 
ToU£rDeviû
 *
–em
 = 
	`GETELEM
(
fp
);

328 ià(
–em
)

329 ++
–em
->
_u£_couÁ
;

330 
	`¥š_uÆock
(&
u£rdeviû_lock
);

332 ià(!
–em
)

335 
»f_hŞd”
<
	`ty³of
(
–em
->
_u£_couÁ
)> 
	`r
(elem->_use_count);

337 
ušt
 
mask
 = 0;

338 
	`pŞl_wa™
(
fp
, &
–em
->
_´oc_queue
, 
±
);

340 
FromU£rDeviû
 *
fud
 = 
–em
->
_äom_u£r_deviû
;

341 ià(
fud
)

342 
mask
 |ğ
fud
->
	`dev_pŞl
();

344 
	`¥š_lock
(&
–em
->
_lock
);

345 ià(
–em
->
_ex™
 || !–em->
_blockšg
 ||ƒËm->
_size
)

347 
mask
 |ğ
POLLIN
 | 
POLLRDNORM
;

350 
	`¥š_uÆock
(&
–em
->
_lock
);

351  
mask
;

352 
	}
}

355 
	gToU£rDeviû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

357 
	g»s
;

358 
dev_t
 
	gdev
;

360 ià(!
	gdev_fİs
)

361  
	g”rh
->
”rÜ
("file operations missing");

363 
	g_pÿp_ÃtwÜk
 = 1;

364 
	g_pÿp_¢­Ën
 = 65535;

365 
	g_debug
 = 
çl£
;

366 
	g_drİ_
 = 
Œue
;

367 
	g_blockšg
 = 
Œue
;

368 
	g_max_bur¡
 = 1;

369 
	g_ÿ·c™y
 = 
deçuÉ_ÿ·c™y
;

370 
SŒšg
 
	g’ÿp
 = SŒšg::
make_¡abË
("none");

371 
SŒšg
 
	gty³
;

372 ià(
Args
(
cÚf
, 
this
, 
”rh
)

373 .
»ad_mp
("DEV_MINOR", 
_dev_mšÜ
)

374 .
»ad
("CAPACITY", 
_ÿ·c™y
)

375 .
»ad
("BURST", 
_max_bur¡
)

376 .
»ad
("TYPE", 
WÜdArg
(), 
ty³
)

377 .
»ad
("ENCAP", 
WÜdArg
(), 
’ÿp
)

378 .
»ad
("PCAP_NETWORK", 
_pÿp_ÃtwÜk
)

379 .
»ad
("PCAP_SNAPLEN", 
_pÿp_¢­Ën
)

380 .
»ad
("DEBUG", 
_debug
)

381 .
»ad
("BLOCKING", 
_blockšg
)

382 .
»ad
("DROP_TAIL", 
_drİ_
)

383 .
com¶‘e
() < 0)

386 ià(
	g_dev_mšÜ
 >= 256)

387  
”rh
->
”rÜ
("DEV_MINOR‚umberoo high");

389 ià(
	g’ÿp
 == "none")

390 
_’ÿp_ty³
 = 
ty³_’ÿp_nÚe
;

391 ià(
	g’ÿp
 == "pcap")

392 
_’ÿp_ty³
 = 
ty³_’ÿp_pÿp
;

393 ià(
	g’ÿp
 == "len32")

394 
_’ÿp_ty³
 = 
ty³_’ÿp_Ën32
;

395 ià(
	g’ÿp
 == "len_net16")

396 
_’ÿp_ty³
 = 
ty³_’ÿp_Ën_Ãt16
;

398  
	g”rh
->
”rÜ
("bad ENCAPype");

400 ià(
	gty³
 == "packet")

401 
_ty³
 = 
ty³_·ck‘
;

402 ià(
	gty³
 == "stream")

403 
_ty³
 = 
ty³_¡»am
;

404 ià(!
	gty³
)

405 
	g_ty³
 = (
_’ÿp_ty³
 =ğ
ty³_’ÿp_nÚe
è? 
ty³_·ck‘
 : 
ty³_¡»am
;

407  
	g”rh
->
”rÜ
("bad TYPE (must be…acket or stream)");

409 
¥š_lock_š™
(&
_lock
);

410 ià(!(
	g_q
 = (
Pack‘
 **)
şick_ÏÎoc
(
_ÿ·c™y
 * (Packet *))))

412 
şick_ch©‹r
("ToU£rDeviû FaedØ®loø%lu slÙs\n", 
_ÿ·c™y
);

415 
	g_dev_majÜ
 = 
DEV_MAJOR
;

416 
	gDEV_NUM
++;

417 ià(
	gDEV_NUM
 == 1)

422 
»s
 = 
»gi¡”_chrdev
(
_dev_majÜ
, 
DEV_NAME
, 
dev_fİs
);

423 ià(
	g»s
 < 0)

425 
şick_ch©‹r
("Failedo Register Dev:%s Major:%d Minor:%d\n",

426 
DEV_NAME
, 
_dev_majÜ
, 
_dev_mšÜ
);

427 
şick_lä“
((*)
_q
, 
_ÿ·c™y
 * (
Pack‘
 *));

428 
	g_q
 = 0;

429  - 
	gEIO
;

432 
š™_wa™queue_h—d
(&
_´oc_queue
);

433 
¥š_lock
(&
u£rdeviû_lock
);

434 
	g–em_m­
[
_dev_mšÜ
] = 
this
;

435 
¥š_uÆock
(&
u£rdeviû_lock
);

440 
	gToU£rDeviû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

442 ià(
	`šput_is_puÎ
(0))

444 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
”rh
);

445 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

448 
	}
}

451 
	gToU£rDeviû
::
	$ş—nup
(
CËªupSge
 
¡age
)

453 ià(
¡age
 < 
CLEANUP_CONFIGURED
)

455 
	`¥š_lock
(&
u£rdeviû_lock
);

456 
–em_m­
[
_dev_mšÜ
] = 0;

457 
	`¥š_uÆock
(&
u£rdeviû_lock
);

458 
	`¥š_lock
(&
_lock
);

459 
DEV_NUM
--;

460 
_ex™
 = 
Œue
;

461 
	`¥š_uÆock
(&
_lock
);

463 ià(
_q
) {

465 
	`wake_up_š‹¼u±ibË
(&
_´oc_queue
);

467 
	`scheduË
();

468 } 
	`wa™queue_aùive
(&
_´oc_queue
));

469 } 
_u£_couÁ
);

471 ià(!
DEV_NUM
)

472 
	`uÄegi¡”_chrdev
(
_dev_majÜ
, 
DEV_NAME
);

474 
	`»£t
();

475 
	`şick_lä“
((*)
_q
, 
_ÿ·c™y
 * (
Pack‘
 *));

477 
	}
}

480 
	gToU£rDeviû
::
	$»£t
()

482 
	`¥š_lock
(&
_lock
);

484 
_size
 > 0) {

485 
_q
[
_r_¦Ù
]->
	`kl
();

486 
_r_¦Ù
++;

487 ià(
_r_¦Ù
 =ğ
_ÿ·c™y
)

488 
_r_¦Ù
 = 0;

489 
_size
--;

491 
	`¥š_uÆock
(&
_lock
);

492 
	}
}

494 
boŞ


495 
	gToU£rDeviû
::
	$´oûss
(
Pack‘
 *
p
)

497 ià(
_’ÿp_ty³
 !ğ
ty³_’ÿp_nÚe
) {

498 
Wr™abËPack‘
 *
wp
 = 
p
->
	`uniqueify
();

499 ià(
	`uÆik–y
(!
wp
))

500  
çl£
;

501 ià(
_’ÿp_ty³
 =ğ
ty³_’ÿp_pÿp
) {

502 
Üig_Ën
 = 
wp
->
	`Ëngth
();

503 
this_Ën
 = 
wp
->
	`Ëngth
();

504 ià(
this_Ën
 > 
_pÿp_¢­Ën
) {

505 
this_Ën
 = 
_pÿp_¢­Ën
;

506 
wp
->
	`ke
(wp->
	`Ëngth
(è- 
_pÿp_¢­Ën
);

508 
wp
 = wp->
	`push
((
pÿ´ec_hdr
));

509 ià(
	`uÆik–y
(!
wp
))

510  
çl£
;

511 
pÿ´ec_hdr
 *
h
 = (pÿ´ec_hd¸*)
wp
->
	`d©a
();

512 
	`mem£t
(
h
, 0, (
pÿ´ec_hdr
));

513 
Time¡amp
 
t
 = 
wp
->
	`time¡amp_ªno
();

514 
h
->
ts_£c
 = 
	`htÚl
(
t
.
	`£c
());

515 
h
->
ts_u£c
 = 
	`htÚl
(
t
.
	`u£c
());

516 
h
->
šş_Ën
 = 
	`htÚl
(
this_Ën
);

517 
h
->
Üig_Ën
 = 
	`htÚl
(orig_len);

518 } ià(
_’ÿp_ty³
 =ğ
ty³_’ÿp_Ën32
) {

519 
wp
 = wp->
	`push
((
ušt32_t
));

520 ià(
	`uÆik–y
(!
wp
))

521  
çl£
;

522 
ušt32_t
 
Ën
 = 
wp
->
	`Ëngth
();

523 
	`memıy
(
wp
->
	`d©a
(), &
Ën
, (
ušt32_t
));

524 } ià(
_’ÿp_ty³
 =ğ
ty³_’ÿp_Ën_Ãt16
) {

525 
wp
 = wp->
	`push
((
ušt16_t
));

526 ià(
	`uÆik–y
(!
wp
))

527  
çl£
;

528 
ušt16_t
 
Ën
 = 
	`htÚs
(
wp
->
	`Ëngth
());

529 
	`memıy
(
wp
->
	`d©a
(), &
Ën
, (
ušt16_t
));

531 
p
 = 
wp
;

534 
	`¥š_lock
(&
_lock
);

535 
_pkt_couÁ
++;

537 ià(
_size
 >ğ
_ÿ·c™y
) {

538 
_drİ_couÁ
++;

539 ià(
_drİ_
)

540 
	`pİ_·ck‘
()->
	`kl
();

542 
p
->
	`kl
();

543 
	`¥š_uÆock
(&
_lock
);

544  
çl£
;

548 
_q
[
_w_¦Ù
] = 
p
;

549 
_w_¦Ù
++;

550 ià(
_w_¦Ù
 =ğ
_ÿ·c™y
)

551 
_w_¦Ù
 = 0;

552 
_size
++;

553 
	`¥š_uÆock
(&
_lock
);

555 
	`wake_up_š‹¼u±ibË
(&
_´oc_queue
);

556  
Œue
;

557 
	}
}

560 
	gToU£rDeviû
::
	$push
(, 
Pack‘
 *
p
)

562 
	`´oûss
(
p
);

563 
	}
}

566 
boŞ


567 
	gToU£rDeviû
::
	$run_sk
(
Task
 *)

569 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

571 ià(
p
)

572 
	`´oûss
(
p
);

573 ià(!
_sigÇl
)

574  
çl£
;

575 
_sk
.
	`ç¡_»scheduË
();

576  
p
 != 0;

577 
	}
}

579 
Pack‘
 *

580 
	gToU£rDeviû
::
	$pİ_·ck‘
()

582 
Pack‘
 *
p
 = 0;

583 ià(
_size
 > 0) {

584 
p
 = 
_q
[
_r_¦Ù
];

585 
_r_¦Ù
++;

586 ià(
_r_¦Ù
 =ğ
_ÿ·c™y
)

587 
_r_¦Ù
 = 0;

588 
_size
--;

590  
p
;

591 
	}
}

594 
	gToU£rDeviû
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s_š
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

596 
ToU£rDeviû
 *
td
 = (ToU£rDeviû *)
e
;

597 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
s_š
);

598 (
šŒ_t
)
thunk
) {

599 
h_»£t
: {

600 
td
->
	`»£t
();

605 
	}
}

608 
	gToU£rDeviû
::
	$add_hªdËrs
()

610 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
OP_READ
, &
_pkt_couÁ
);

611 
	`add_d©a_hªdËrs
("size", 
HªdËr
::
OP_READ
, &
_size
);

612 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİ_couÁ
);

613 
	`add_d©a_hªdËrs
("ÿ·c™y", 
HªdËr
::
OP_READ
, &
_ÿ·c™y
);

614 
	`add_d©a_hªdËrs
("»ad_couÁ", 
HªdËr
::
OP_READ
, &
_»ad_couÁ
);

615 
	`add_d©a_hªdËrs
("»ad_ç_couÁ", 
HªdËr
::
OP_READ
, &
_çed_couÁ
);

616 
	`add_d©a_hªdËrs
("pkt_»ad_couÁ", 
HªdËr
::
OP_READ
, &
_pkt_»ad_couÁ
);

617 
	`add_d©a_hªdËrs
("drİ_couÁ", 
HªdËr
::
OP_READ
, &
_drİ_couÁ
);

618 
	`add_d©a_hªdËrs
("block_couÁ", 
HªdËr
::
OP_READ
, &
_block_couÁ
);

619 
	`add_d©a_hªdËrs
("¦“pšg_´oc", 
HªdËr
::
OP_READ
, &
_¦“p_´oc
);

621 
	`add_wr™e_hªdËr
("»£t", 
wr™e_hªdËr
, 
h_»£t
);

622 
	`add_d©a_hªdËrs
("debug", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_debug
);

623 
	`add_d©a_hªdËrs
("drİ_", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_drİ_
);

624 
	`add_d©a_hªdËrs
("bur¡", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_max_bur¡
);

626 ià(
_’ÿp_ty³
 =ğ
ty³_’ÿp_pÿp
) {

627 
	`add_d©a_hªdËrs
("pÿp_¢­Ën", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_pÿp_¢­Ën
);

628 
	`add_d©a_hªdËrs
("pÿp_ÃtwÜk", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_pÿp_ÃtwÜk
);

631 ià(
	`šput_is_puÎ
(0))

632 
	`add_sk_hªdËrs
(&
_sk
);

633 
	}
}

636 
	$ELEMENT_REQUIRES
(
lšuxmoduË
 
FromU£rDeviû
)

637 
	$EXPORT_ELEMENT
(
ToU£rDeviû
)

638 
	`ELEMENT_MT_SAFE
(
ToU£rDeviû
)

	@linuxmodule/touserdevice.hh

1 #iâdeà
CLICK_TOUSERDEVICE_HH


2 
	#CLICK_TOUSERDEVICE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/nÙif›r.hh
>

5 
	~<şick/©omic.hh
>

7 
	~<şick/cxx´Ùeù.h
>

8 
	gCLICK_CXX_PROTECT


9 
	~<lšux/wa™.h
>

10 
	gCLICK_CXX_UNPROTECT


11 
	~<şick/cxxuÅrÙeù.h
>

114 şas 
	cToU£rDeviû
 : 
public
 
EËm’t


116 
public
:

118 
	$ToU£rDeviû
(è
CLICK_COLD
;

119 ~
	$ToU£rDeviû
(è
CLICK_COLD
;

121 
	`¡©ic_š™Ÿlize
();

122 
	`¡©ic_ş—nup
();

124 cÚ¡ *
	$şass_Çme
() const {  "ToUserDevice"; }

125 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_0
; 
	}
}

126 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

128 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

129 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_DEFAULT
 - 1; 
	}
}

130 
boŞ
 
run_sk
(
Task
 *);

131 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

132 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

133 
	$add_hªdËrs
(è
CLICK_COLD
;

134 
	`push
(, 
Pack‘
 *);

136 
´iv©e
:

137 
	sfe_´iv
 {

138 
ušt8_t
 
mšÜ_num
;

139 
ušt8_t
 
»ad_Úû
;

140 
Pack‘
 *
p
;

141 
	}
};

143 
Pack‘
 *
pİ_·ck‘
();

144 
boŞ
 
´oûss
(
Pack‘
 *);

145 
»£t
();

147 ’um { 
	gdeçuÉ_ÿ·c™y
 = 64 };

148 ’um { 
	gh_»£t
 };

150 
Pack‘
 ** 
	g_q
;

151 
ušt32_t
 
	g_size
;

152 
ušt32_t
 
	g_r_¦Ù
;

153 
ušt32_t
 
	g_w_¦Ù
;

154 
ušt32_t
 
	g_ÿ·c™y
;

155 
ušt32_t
 
	g_max_bur¡
;

156 
¥šlock_t
 
	g_lock
;

157 
boŞ
 
	g_debug
;

158 
boŞ
 
	g_drİ_
;

159 
boŞ
 
	g_blockšg
;

160 
ulÚg
 
	g_»ad_couÁ
;

161 
ulÚg
 
	g_pkt_»ad_couÁ
;

162 
ulÚg
 
	g_pkt_couÁ
;

163 
ulÚg
 
	g_drİ_couÁ
;

164 
ulÚg
 
	g_block_couÁ
;

165 
©omic_ušt32_t
 
	g_çed_couÁ
;

166 
Task
 
	g_sk
;

167 
NÙif›rSigÇl
 
	g_sigÇl
;

168 vŞ©
boŞ
 
	g_ex™
;

169 
©omic_ušt32_t
 
	g_u£_couÁ
;

171 
ulÚg
 
	g_dev_majÜ
;

172 
ulÚg
 
	g_dev_mšÜ
;

173 
wa™_queue_h—d_t
 
	g_´oc_queue
;

174 
ulÚg
 
	g_¦“p_´oc
;

175 ’um { 
	gty³_·ck‘
, 
	gty³_¡»am
 };

176 
ušt8_t
 
	g_ty³
;

177 ’um { 
	gty³_’ÿp_nÚe
, 
	gty³_’ÿp_pÿp
, 
	gty³_’ÿp_Ën32
, 
	gty³_’ÿp_Ën_Ãt16
 };

178 
ušt8_t
 
	g_’ÿp_ty³
;

179 
ušt32_t
 
	g_pÿp_ÃtwÜk
;

180 
ušt32_t
 
	g_pÿp_¢­Ën
;

181 
şass
 
FromU£rDeviû
 *
	g_äom_u£r_deviû
;

183 
fe_İ”©iÚs
 *
	gdev_fİs
;

184 
ToU£rDeviû
 * vŞ©
	g–em_m­
[256];

186 
ssize_t
 
dev_»ad
(
fe
 *fe, *
buf
, 
size_t
 
couÁ
, 
loff_t
 *
µos
);

187 
ssize_t
 
dev_wr™e
(
fe
 *
fp
, cÚ¡ *
buff
, 
size_t
 
Ën
, 
loff_t
 *
µos
);

188 
dev_İ’
(
šode
 *šode, 
fe
 *
fp
);

189 
dev_»Ëa£
(
šode
 *šode, 
fe
 *file);

190 
ušt
 
dev_pŞl
(
fe
 *, 
pŞl_bË_¡ruù
 *);

192 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

194 
ä›nd
 
şass
 
FromU£rDeviû
;

195 
	}
};

	@local/bufconv.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şickÃt/.h
>

21 
	~<şickÃt/tı.h
>

22 
	~<şick/tim”.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~"bufcÚv.hh
"

25 
CLICK_DECLS


27 
	gBufãrCÚv”‹r
::
	$BufãrCÚv”‹r
()

28 : 
	$_tim”
(
this
)

30 
	}
}

32 
BufãrCÚv”‹r
::~
	$BufãrCÚv”‹r
()

34 
	}
}

37 
BufãrCÚv”‹r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("MTU", 
_mtu
).
com¶‘e
();

43 
	gBufãrCÚv”‹r
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

45 
_tim”
.
	`š™Ÿlize
(
this
);

47 
	}
}

50 
	gBufãrCÚv”‹r
::
	$push
(, 
Pack‘
 *
p
)

53 
p
->
	`kl
();

54 
	}
}

57 
	gBufãrCÚv”‹r
::
	$run_tim”
(
Tim”
 *)

59 
_tim”
.
	`scheduË_aá”_m£c
(
·ck‘_tx_d–ay
);

60 
	}
}

63 
	gBufãrCÚv”‹r
::
	$İut
(cÚ¡ 
SŒšg
 &
s
)

65 
dËn
 = 
_obuf
.
	`Ëngth
(è+ 
s
.length();

66 ià(
dËn
 > 
_mtu
)

67 
dËn
 = 
_mtu
;

69 
şick_
 *

;

70 
şick_tı
 *
tı
;

71 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((*

è+ (*
tı
è+ 
dËn
);

72 ià(
q
 == 0) {

73 
	`şick_ch©‹r
("BufferConverter: cannot make…acket");

76 
	`mem£t
(
q
->
	`d©a
(), '\0', (*

)+(*
tı
));

77 

 = (
şick_
 *è
q
->
	`d©a
();

78 
tı
 = (
şick_tı
 *è(

 + 1);

79 

->
_v
 = 4;

80 

->
_hl
 = 5;

81 

->
_tos
 = 0x10;

82 

->
_Ën
 = 
	`htÚs
(
q
->
	`Ëngth
());

83 

->
_id
 = 
	`htÚs
(0);

84 

->
_off
 = 
	`htÚs
(
IP_DF
);

85 

->
_‰l
 = 255;

86 

->
_p
 = 
IP_PROTO_TCP
;

87 

->
_sum
 = 0;

89 
tı
->
th_off
 = 5;

90 
tı
->
th_æags
 = 
TH_PUSH
;

91 
tı
->
th_wš
 = 
	`htÚs
(32120);

92 
tı
->
th_sum
 = 
	`htÚs
(0);

93 
tı
->
th_u½
 = 
	`htÚs
(0);

95 *
d©a
 = 
q
->
	`d©a
(è+ (*

è+ (*
tı
);

96 ià(
_obuf
.
	`Ëngth
(è> 
_mtu
) {

97 
	`memmove
(
d©a
, 
_obuf
.
	`c_¡r
(), 
_mtu
);

98 
_obuf
 = _obuf.
	`sub¡ršg
(
_mtu
, _obuf.
	`Ëngth
()-_mtu);

99 
dËn
 -ğ
_mtu
;

100 
d©a
 +ğ
_mtu
;

102 ià(
_obuf
.
	`Ëngth
() > 0) {

103 
	`memmove
(
d©a
, 
_obuf
.
	`c_¡r
(), _obuf.
	`Ëngth
());

104 
dËn
 -ğ
_obuf
.
	`Ëngth
();

105 
d©a
 +ğ
_obuf
.
	`Ëngth
();

106 
_obuf
 = "";

108 
SŒšg
 
ss
 = 
s
;

109 
	`memmove
(
d©a
, 
ss
.
	`d©a
(), 
dËn
);

110 ià(
ss
.
	`Ëngth
(è> 
dËn
)

111 
_obuf
 +ğ
ss
.
	`sub¡ršg
(
dËn
, ss.
	`Ëngth
()-dlen);

113 
q
->
	`£t__h—d”
(

, ip->
_hl
 << 2);

114 
	`ouut
(0).
	`push
(
q
);

115 
	}
}

117 
SŒšg


118 
	gBufãrCÚv”‹r
::
	$ut
()

120 
Pack‘
 *
p
;

121 (
p
 = 
	`šput
(0).
	`puÎ
())) {

122 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

123 cÚ¡ 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

124 
dËn
 = 
	`Áohs
(
h
->
_Ën
)-(h->
_hl
<<2)-(
tıh
->
th_off
<<2);

125 ià(
dËn
 == 0) {

126 
p
->
	`kl
();

129 
off
 = 
tıh
->
th_off
 << 2;

130 cÚ¡ *
d©a
 = ((cÚ¡ *)
tıh
è+ 
off
;

131 
SŒšg
 
	`s
(
d©a
, 
dËn
);

132 
p
->
	`kl
();

133  
s
;

136 
	}
}

139 
	gBufãrCÚv”‹r
::
	$add_hªdËrs
()

141 
	`add_wr™e_hªdËr
("d©a", 
d©a_wr™e_hªdËr
, 0);

142 
	`add_»ad_hªdËr
("d©a", 
d©a_»ad_hªdËr
, 0);

143 
	}
}

146 
	gBufãrCÚv”‹r
::
d©a_wr™e_hªdËr


147 (cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *)

149 
	g»š‹½»t_ÿ¡
<
	gBufãrCÚv”‹r
*>(
	ge
)->
İut
(
s
);

153 
SŒšg


154 
	gBufãrCÚv”‹r
::
	$d©a_»ad_hªdËr
(
EËm’t
 *
e
, *)

156  
»š‹½»t_ÿ¡
<
BufãrCÚv”‹r
*>(
e
)->
	`ut
();

157 
	}
}

159 
CLICK_ENDDECLS


160 
EXPORT_ELEMENT
(
BufãrCÚv”‹r
)

	@local/bufconv.hh

1 #iâdeà
CLICK_BUFCONV_HH


2 
	#CLICK_BUFCONV_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tim”.hh
>

5 
	~<şickÃt/tı.h
>

6 
CLICK_DECLS


21 şas 
	cBufãrCÚv”‹r
 : 
public
 
EËm’t
 {

22 cÚ¡ 
·ck‘_tx_d–ay
 = 5;

24 
SŒšg
 
	$d©a_»ad_hªdËr
(
EËm’t
 *
e
, *è
CLICK_COLD
;

25 
d©a_wr™e_hªdËr


26 (cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

28 
Tim”
 
_tim”
;

29 
_mtu
;

30 
SŒšg
 
_obuf
;

32 
SŒšg
 
	`ut
();

33 
	`İut
(cÚ¡ 
SŒšg
 &);

35 
public
:

36 
	$BufãrCÚv”‹r
(è
CLICK_COLD
;

37 ~
	$BufãrCÚv”‹r
(è
CLICK_COLD
;

39 cÚ¡ *
	$şass_Çme
() const {  "BufferConverter"; }

40 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/1"; 
	}
}

41 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "lh/h"; 
	}
}

43 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

44 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

46 
	`push
(, 
Pack‘
 *
p
);

47 
	`run_tim”
(
Tim”
 *);

48 
	$add_hªdËrs
(è
CLICK_COLD
;

49 
	}
};

51 
	gCLICK_ENDDECLS


	@local/chuckcheck.cc

18 
	~<şick/cÚfig.h
>

19 
	~"chuckcheck.hh
"

20 
	~<şick/¡¿ccum.hh
>

21 
	~<şickÃt/.h
>

22 
CLICK_DECLS


24 
	gChuckCheck
::
	$ChuckCheck
()

26 
	}
}

28 
ChuckCheck
::~
	$ChuckCheck
()

30 
	}
}

33 
ChuckCheck
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

35 
_h—d
 = 
_
 = 
_h—d_id
 = 0;

37 
	}
}

40 
	gChuckCheck
::
	$couÁ
(
Pack‘
 *
p
)

42 
St
 &
s
 = 
_šfo
[
_
];

43 
s
.
time
.
	`assign_now
();

44 
s
.
§ddr
 = 
p
->
	`_h—d”
()->
_¤c
.
s_addr
;

45 
_
 = (_ + 1è% 
BUCKETS
;

46 ià(
_
 =ğ
_h—d
) {

47 
_h—d
 = (_h—d + 1è% 
BUCKETS
;

48 
_h—d_id
++;

50 
	}
}

53 
	gChuckCheck
::
	$push
(, 
Pack‘
 *
p
)

55 
	`couÁ
(
p
);

56 
	`ouut
(0).
	`push
(
p
);

57 
	}
}

59 
Pack‘
 *

60 
	gChuckCheck
::
	$puÎ
()

62 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

63 ià(
p
è
	`couÁ
(p);

64  
p
;

65 
	}
}

67 
SŒšg


68 
	gChuckCheck
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *)

72 
ChuckCheck
 *
cc
 = (ChuckCheck *)
e
;

73 
SŒšg
 
¡r
 = SŒšg::
	`make_g¬bage
((1 + 
BUCKETS
*4) * ());

74 ià(!
¡r
)

75  
SŒšg
::
	`make_¡abË
("out of memory\n");

77 *
buf
 = (*)(
¡r
.
	`mubË_d©a
());

78 
j
 = 1;

79 
num
 = 
cc
->
_h—d_id
;

80 
h—d
 = 
cc
->
_h—d
;

81 

 = 
cc
->
_
;

83 
i
 = 
h—d
; i !ğ

; i = (˜+ 1è% 
BUCKETS
) {

84 
buf
[
j
++] = 
num
++;

85 
buf
[
j
++] = 
cc
->
_šfo
[
i
].
time
.
	`£c
();

86 
buf
[
j
++] = 
cc
->
_šfo
[
i
].
time
.
	`u£c
();

87 
buf
[
j
++] = 
cc
->
_šfo
[
i
].
§ddr
;

90 
buf
[0] = 
num
 - 
h—d
;

91  
¡r
;

92 
	}
}

95 
	gChuckCheck
::
	$add_hªdËrs
()

97 
	`add_»ad_hªdËr
("šfo", 
»ad_hªdËr
, 0);

98 
	}
}

100 
CLICK_ENDDECLS


101 
	$ELEMENT_REQUIRES
(
çl£
)

102 
	`EXPORT_ELEMENT
(
ChuckCheck
)

	@local/chuckcheck.hh

1 #iâdeà
CLICK_CHUCKCHECK_HH


2 
	#CLICK_CHUCKCHECK_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


66 şas 
	cChuckCheck
 : 
public
 
EËm’t
 {

68 
	sSt
 {

69 
Time¡amp
 
time
;

70 
	m§ddr
;

73 ’um { 
	gBUCKETS
 = 4096 };

75 
St
 
	g_šfo
[
BUCKETS
];

76 
	g_h—d
;

77 
	g_
;

78 
	g_h—d_id
;

80 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

82 
šlše
 
	`couÁ
(
Pack‘
 *);

84 
public
:

86 
	$ChuckCheck
(è
CLICK_COLD
;

87 ~
	$ChuckCheck
(è
CLICK_COLD
;

89 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "ChuckCheck"; 
	}
}

90 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

91 
	$add_hªdËrs
(è
CLICK_COLD
;

93 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

95 
	`push
(, 
Pack‘
 *);

96 
Pack‘
 *
	`puÎ
();

98 
	}
};

100 
	gCLICK_ENDDECLS


	@local/copyflowid.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şickÃt/tı.h
>

21 
	~"cİyæowid.hh
"

22 
CLICK_DECLS


24 
	gCİyFlowID
::
	$CİyFlowID
()

26 
	}
}

28 
CİyFlowID
::~
	$CİyFlowID
()

30 
	}
}

33 
CİyFlowID
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *)

40 
	gCİyFlowID
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

42 
_¡¬t
 = 
çl£
;

44 
	}
}

47 
	gCİyFlowID
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

49 ià(
pÜt
 == 0)

50 
	`mÚ™Ü
(
p
);

52 
p
 = 
	`£t
(p);

53 
	`ouut
(
pÜt
).
	`push
(
p
);

54 
	}
}

56 
Pack‘
 *

57 
	gCİyFlowID
::
	$puÎ
(
pÜt
)

59 
Pack‘
 *
p
 = 
	`šput
(
pÜt
).
	`puÎ
();

60 ià(
p
) {

61 ià(
pÜt
 == 0) {

62 
	`mÚ™Ü
(
p
);

63  
p
;

66  
	`£t
(
p
);

69 
	}
}

72 
	gCİyFlowID
::
	$mÚ™Ü
(
Pack‘
 *
p
)

74 ià(!
_¡¬t
) {

75 
_æow
 = 
	`IPFlowID
(
p
);

76 
_¡¬t
 = 
Œue
;

78 
	}
}

80 
Pack‘
 *

81 
	gCİyFlowID
::
	$£t
(
Pack‘
 *
p
)

83 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
()) {

84 
şick_
 *
h
 = 
q
->
	`_h—d”
();

85 
şick_tı
 *
tıh
 = 
q
->
	`tı_h—d”
();

86 
§
 = 
_æow
.
	`§ddr
();

87 
da
 = 
_æow
.
	`daddr
();

88 
	`memmove
((*è&(
h
->
_¤c
), (*è&
§
, 4);

89 
	`memmove
((*è&(
h
->
_d¡
), (*è&
da
, 4);

90 
tıh
->
th_¥Üt
 = 
_æow
.
	`¥Üt
();

91 
tıh
->
th_dpÜt
 = 
_æow
.
	`dpÜt
();

92  
q
;

95 
	}
}

98 
	gCİyFlowID
::
	$add_hªdËrs
()

100 
	`add_wr™e_hªdËr
("»£t", 
»£t_wr™e_hªdËr
, 0, 
HªdËr
::
BUTTON
);

101 
	}
}

104 
	gCİyFlowID
::
»£t_wr™e_hªdËr


105 (cÚ¡ 
SŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *)

107 (
	g»š‹½»t_ÿ¡
<
	gCİyFlowID
*>(
	ge
))->
	g_¡¬t
 = 
çl£
;

111 
CLICK_ENDDECLS


112 
EXPORT_ELEMENT
(
CİyFlowID
)

	@local/copyflowid.hh

1 #iâdeà
CLICK_COPYFLOWID_HH


2 
	#CLICK_COPYFLOWID_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/æowid.hh
>

5 
CLICK_DECLS


18 şas 
	cCİyFlowID
 : 
public
 
EËm’t
 {

19 
´iv©e
:

20 
»£t_wr™e_hªdËr


21 (cÚ¡ 
SŒšg
 &, 
	mEËm’t
 *, *, 
	mE¼ÜHªdËr
 *);

23 
mÚ™Ü
(
Pack‘
 *);

24 
Pack‘
 *
£t
(Packet *);

26 
boŞ
 
	m_¡¬t
;

27 
IPFlowID
 
	m_æow
;

29 
	mpublic
:

30 
	$CİyFlowID
(è
CLICK_COLD
;

31 ~
	$CİyFlowID
(è
CLICK_COLD
;

33 cÚ¡ *
	$şass_Çme
() const {  "CopyFlowID"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/2"; 
	}
}

36 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

37 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

39 
	`push
(, 
Pack‘
 *);

40 
Pack‘
 *
	`puÎ
();

41 
	$add_hªdËrs
(è
CLICK_COLD
;

43 
	}
};

45 
	gCLICK_ENDDECLS


	@local/copytcpseq.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şickÃt/tı.h
>

21 
	~"cİytı£q.hh
"

22 
CLICK_DECLS


24 
	gCİyTCPSeq
::
	$CİyTCPSeq
()

26 
	}
}

28 
CİyTCPSeq
::~
	$CİyTCPSeq
()

30 
	}
}

33 
CİyTCPSeq
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *)

40 
	gCİyTCPSeq
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

42 
_¡¬t
 = 
çl£
;

44 
	}
}

47 
	gCİyTCPSeq
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

49 ià(
pÜt
 == 0)

50 
	`mÚ™Ü
(
p
);

52 
p
 = 
	`£t
(p);

53 
	`ouut
(
pÜt
).
	`push
(
p
);

54 
	}
}

56 
Pack‘
 *

57 
	gCİyTCPSeq
::
	$puÎ
(
pÜt
)

59 
Pack‘
 *
p
 = 
	`šput
(
pÜt
).
	`puÎ
();

60 ià(
p
) {

61 ià(
pÜt
 == 0) {

62 
	`mÚ™Ü
(
p
);

63  
p
;

66  
	`£t
(
p
);

69 
	}
}

72 
	gCİyTCPSeq
::
	$mÚ™Ü
(
Pack‘
 *
p
)

74 cÚ¡ 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

75 
£q
 = 
	`Áohl
(
tıh
->
th_£q
);

76 ià(!
_¡¬t
) {

77 
_£q
 = 
£q
;

78 
_¡¬t
 = 
Œue
;

80 ià(
	`SEQ_GT
(
£q
, 
_£q
))

81 
_£q
 = 
£q
;

83 
	}
}

85 
Pack‘
 *

86 
	gCİyTCPSeq
::
	$£t
(
Pack‘
 *
p
)

88 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
()) {

89 
şick_tı
 *
tıh
 = 
q
->
	`tı_h—d”
();

90 
tıh
->
th_£q
 = 
	`htÚl
(
_£q
);

91  
q
;

94 
	}
}

97 
	gCİyTCPSeq
::
	$add_hªdËrs
()

99 
	`add_wr™e_hªdËr
("»£t", 
»£t_wr™e_hªdËr
, 0, 
HªdËr
::
BUTTON
);

100 
	}
}

103 
	gCİyTCPSeq
::
»£t_wr™e_hªdËr


104 (cÚ¡ 
SŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *)

106 (
	g»š‹½»t_ÿ¡
<
	gCİyTCPSeq
*>(
	ge
))->
	g_¡¬t
 = 
çl£
;

110 
CLICK_ENDDECLS


111 
EXPORT_ELEMENT
(
CİyTCPSeq
)

	@local/copytcpseq.hh

1 #iâdeà
CLICK_COPYTCPSEQ_HH


2 
	#CLICK_COPYTCPSEQ_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/tı.h
>

5 
	~<şick/æowid.hh
>

6 
CLICK_DECLS


19 şas 
	cCİyTCPSeq
 : 
public
 
EËm’t
 {

20 
´iv©e
:

21 
»£t_wr™e_hªdËr


22 (cÚ¡ 
SŒšg
 &, 
	mEËm’t
 *, *, 
	mE¼ÜHªdËr
 *);

24 
mÚ™Ü
(
Pack‘
 *);

25 
Pack‘
 *
£t
(Packet *);

27 
boŞ
 
	m_¡¬t
;

28 
	m_£q
;

30 
	mpublic
:

31 
	$CİyTCPSeq
(è
CLICK_COLD
;

32 ~
	$CİyTCPSeq
(è
CLICK_COLD
;

34 cÚ¡ *
	$şass_Çme
() const {  "CopyTCPSeq"; }

35 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/2"; 
	}
}

37 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

38 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

40 
	`push
(, 
Pack‘
 *);

41 
Pack‘
 *
	`puÎ
();

42 
	$add_hªdËrs
(è
CLICK_COLD
;

44 
	}
};

46 
	gCLICK_ENDDECLS


	@local/duppath.cc

1 
	~<şick/cÚfig.h
>

2 
	~<şick/”rÜ.hh
>

3 
	~<şickÃt/.h
>

4 
	~"duµ©h.hh
"

5 
CLICK_DECLS


7 
	gDupP©h
::
	$DupP©h
()

9 
_q
._q = 0;

10 
_q
.
_h—d
 = _q.
_
 = 0;

11 
	}
}

13 
	gDupP©h
::~
	$DupP©h
()

15 
	}
}

18 
DupP©h
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

20 ià(!(
_q
._q = 
Ãw
 
Pack‘
*[129]))

21  
”rh
->
	`”rÜ
("out of memory!");

22 
_q
.
_h—d
 = 0;

23 
_q
.
_
 = 0;

25 
	}
}

28 
	gDupP©h
::
	$ş—nup
(
CËªupSge
)

30 
j
 = 
_q
.
_h—d
; j !ğ_q.
_
; j = 
	`Ãxt_i
(j))

31 
_q
._q[
j
]->
	`kl
();

32 
d–‘e
[] 
_q
._q;

33 
_q
._q = 0;

34 
	}
}

36 
šlše
 
Pack‘
 *

37 
	gDupP©h
::
	$deq
()

39 ià(
_q
.
_h—d
 !ğ_q.
_
) {

40 
Pack‘
 *
p
 = 
_q
._q[_q.
_h—d
];

41 
	`as£¹
(
p
);

42 
_q
.
_h—d
 = 
	`Ãxt_i
(_q._head);

43  
p
;

46 
	}
}

49 
	gDupP©h
::
	$push
(, 
Pack‘
 *
p
)

51 
d
 = 
	`Áohl
(
p
->
	`_h—d”
()->
_¤c
.
s_addr
);

52 ià((
d
 ^ (d>>4)) & 1) {

53 
Ãxt
 = 
	`Ãxt_i
(
_q
.
_
);

54 ià(
Ãxt
 !ğ
_q
.
_h—d
) {

55 
_q
._q[_q.
_
] = 
p
;

56 
_q
.
_
 = 
Ãxt
;

58 
p
->
	`kl
();

60 
	`ouut
(0).
	`push
(
p
);

61 
	}
}

63 
Pack‘
 *

64 
	gDupP©h
::
	$puÎ
()

66  
	`deq
();

67 
	}
}

69 
CLICK_ENDDECLS


70 
	$EXPORT_ELEMENT
(
DupP©h
)

71 
	`ELEMENT_MT_SAFE
(
DupP©h
)

	@local/duppath.hh

1 #iâdeà
CLICK_DUPPATH_HH


2 
	#CLICK_DUPPATH_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


6 şas 
	cDupP©h
 : 
public
 
EËm’t
 {

8 
Pack‘
 **
_q
;

9 
	m_h—d
;

10 
	m_
;

11 } 
	g_q
;

13 
	$Ãxt_i
(
i
ècÚ¡ {  (i!=128 ? i+1 : 0); 
	}
}

14 
Pack‘
 *
deq
();

16 
	gpublic
:

18 
	$DupP©h
(è
CLICK_COLD
;

19 ~
	$DupP©h
(è
CLICK_COLD
;

21 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "DupP©h"; 
	}
}

22 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/2"; 
	}
}

23 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "h/hl"; 
	}
}

24 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

25 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

27 
	`push
(
pÜt
, 
Pack‘
 *);

28 
Pack‘
 *
	`puÎ
(
pÜt
);

29 
	}
};

31 
	gCLICK_ENDDECLS


	@local/forceicmp.cc

18 
	~<şick/cÚfig.h
>

19 
	~"fÜûicmp.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şickÃt/.h
>

23 
	~<şickÃt/icmp.h
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/Çmešfo.hh
>

26 
CLICK_DECLS


28 
	gFÜûICMP
::
	$FÜûICMP
()

30 
_couÁ
 = 0;

31 
_ty³
 = -1;

32 
_code
 = -1;

33 
	}
}

35 
	gFÜûICMP
::~
	$FÜûICMP
()

37 
	}
}

40 
FÜûICMP
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

42 
SŒšg
 
	gcode_¡r
;

43 ià(
Args
(
cÚf
, 
this
, 
”rh
)

44 .
»ad_mp
("TYPE", 
NamedIÁArg
(
NameInfo
::
T_ICMP_TYPE
), 
_ty³
)

45 .
»ad_mp
("CODE", 
WÜdArg
(), 
code_¡r
)

46 .
com¶‘e
() < 0)

48 ià(
	g_ty³
 < 0 || _type > 255)

49  
	g”rh
->
”rÜ
("ICMPype must be between 0‡nd 255");

50 ià(!
	gNameInfo
::
qu”y_št
(
NameInfo
::
T_ICMP_CODE
 + 
_ty³
, 
this
, 
code_¡r
, &
_code
)

51 || 
	g_code
 < 0 || _code > 255)

52  
	g”rh
->
”rÜ
("argument 2akes ICMP code");

56 
Pack‘
 *

57 
	gFÜûICMP
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

59 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

60 
şick_
 *

 = 
p
->
	`_h—d”
();

61 
¶’
 = 
p
->
	`ÃtwÜk_Ëngth
();

62 
hËn
, 
’
;

63 
şick_icmp
 *
ih
;

65 ià(!
p
->
	`has_ÃtwÜk_h—d”
(è|| 
¶’
 < (
şick_
))

66 
bad
;

68 
hËn
 = 

->
_hl
 << 2;

69 ià(
hËn
 < (
şick_
è|| hËÀ> 
¶’
)

70 
bad
;

72 
’
 = 
	`Áohs
(

->
_Ën
);

73 if(
’
 > 
¶’
 || iËÀ< 
hËn
 + (
şick_icmp
))

74 
bad
;

76 
ih
 = (
şick_icmp
 *è(((*)

è+ 
hËn
);

78 ià(
	`şick_¿ndom
(0, 1)) {

79 
ih
->
icmp_ty³
 = 
	`şick_¿ndom
(0, 19);

80 
ih
->
icmp_code
 = 
	`şick_¿ndom
(0, 19);

83 if(
_ty³
 >= 0)

84 
ih
->
icmp_ty³
 = 
_ty³
;

85 if(
_code
 >= 0)

86 
ih
->
icmp_code
 = 
_code
;

88 
_couÁ
++;

90 
ih
->
icmp_cksum
 = 0;

91 
ih
->
icmp_cksum
 = 
	`şick_š_cksum
((*)ih, 
’
 - 
hËn
);

93  
p
;

95 
bad
:

96 
	`şick_ch©‹r
("ForceICMP: bad†engths");

97 
p
->
	`kl
();

99 
	}
}

101 
CLICK_ENDDECLS


102 
EXPORT_ELEMENT
(
FÜûICMP
)

	@local/forceicmp.hh

1 #iâdeà
CLICK_FORCEICMP_HH


2 
	#CLICK_FORCEICMP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


17 şas 
	cFÜûICMP
 : 
public
 
EËm’t
 {

18 
public
:

19 
	$FÜûICMP
(è
CLICK_COLD
;

20 ~
	$FÜûICMP
(è
CLICK_COLD
;

22 cÚ¡ *
	$şass_Çme
() const {  "ForceICMP"; }

23 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

24 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

26 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

28 
	g´iv©e
:

29 
_couÁ
;

30 
	g_ty³
;

31 
	g_code
;

34 
	gCLICK_ENDDECLS


	@local/forceip.cc

18 
	~<şick/cÚfig.h
>

19 
	~"fÜû.hh
"

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

23 
CLICK_DECLS


25 
	gFÜûIP
::
	$FÜûIP
()

27 
_couÁ
 = 0;

28 
	}
}

30 
	gFÜûIP
::~
	$FÜûIP
()

32 
	}
}

34 
Pack‘
 *

35 
FÜûIP
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

37 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

38 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
p
->
	`d©a
());

39 
¶’
 = 
p
->
	`Ëngth
();

41 

->
_v
 = 4;

42 

->
_Ën
 = 
	`htÚs
(
¶’
);

44 if((
_couÁ
++ & 7) != 1){

45 

->
_off
 = 0;

48 
hËn
 = 

->
_hl
 << 2;

49 if(
hËn
 < (
şick_
è|| hËÀ> 
¶’
){

50 

->
_hl
 = 
¶’
 >> 2;

53 

->
_sum
 = 0;

54 

->
_sum
 = 
	`şick_š_cksum
((*), ip->
_hl
 << 2);

56 
p
->
	`£t__h—d”
(

, 
hËn
);

58  
p
;

59 
	}
}

61 
CLICK_ENDDECLS


62 
EXPORT_ELEMENT
(
FÜûIP
)

	@local/forceip.hh

1 #iâdeà
CLICK_FORCEIP_HH


2 
	#CLICK_FORCEIP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şickÃt/.h
>

6 
CLICK_DECLS


26 şas 
	cFÜûIP
 : 
public
 
EËm’t
 {

28 
_couÁ
;

30 
	mpublic
:

32 
	$FÜûIP
(è
CLICK_COLD
;

33 ~
	$FÜûIP
(è
CLICK_COLD
;

35 cÚ¡ *
	$şass_Çme
() const {  "ForceIP"; }

36 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

38 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

42 
	gCLICK_ENDDECLS


	@local/forcetcp.cc

18 
	~<şick/cÚfig.h
>

19 
	~"fÜûtı.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şickÃt/.h
>

23 
	~<şickÃt/tı.h
>

24 
	~<şick/¬gs.hh
>

25 
CLICK_DECLS


27 
	gFÜûTCP
::
	$FÜûTCP
()

29 
_couÁ
 = 0;

30 
_¿ndom
 = 
çl£
;

31 
_æags
 = -1;

32 
	}
}

34 
	gFÜûTCP
::~
	$FÜûTCP
()

36 
	}
}

39 
FÜûTCP
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41 
	g_dpÜt
 = 0;

42  
Args
(
cÚf
, 
this
, 
”rh
)

43 .
»ad_p
("DPORT", 
IPPÜtArg
(
IP_PROTO_TCP
), 
_dpÜt
)

44 .
»ad_p
("RANDOM_DPORT", 
_¿ndom
)

45 .
»ad_p
("FLAGS", 
_æags
)

46 .
com¶‘e
();

49 
Pack‘
 *

50 
	gFÜûTCP
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

52 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

53 
şick_
 *

 = 
p
->
	`_h—d”
();

54 
¶’
 = 
p
->
	`ÃtwÜk_Ëngth
();

55 
hËn
, 
’
, 
oisum
, 
off
;

56 
™mp
[9];

57 
şick_tı
 *
th
;

59 ià(!
p
->
	`has_ÃtwÜk_h—d”
(è|| 
¶’
 < (
şick_
))

60 
bad
;

62 
hËn
 = 

->
_hl
 << 2;

63 ià(
hËn
 < (
şick_
è|| hËÀ> 
¶’
)

64 
bad
;

66 
’
 = 
	`Áohs
(

->
_Ën
);

67 if(
’
 > 
¶’
 || iËÀ< 
hËn
 + (
şick_tı
))

68 
bad
;

70 
th
 = (
şick_tı
 *è(((*)

è+ 
hËn
);

72 
off
 = 
th
->
th_off
 << 2;

73 if(
off
 < (
şick_tı
è|| ofà> (
’
 - 
hËn
)){

74 
noff
;

76 if(
’
 - 
hËn
 - (
şick_tı
) > 0){

77 
noff
 = 
	`şick_¿ndom
(0, 
’
 - 
hËn
 - (
şick_tı
) - 1);

79 
noff
 = 
’
 - 
hËn
;

82 
noff
 = (
şick_tı
);

84 
th
->
th_off
 = 
noff
 >> 2;

87 if(
_æags
 != -1){

88 
th
->
th_æags
 = 
_æags
;

91 if(
_dpÜt
 > 0){

92 
th
->
th_dpÜt
 = 
	`htÚs
(
_dpÜt
);

94 ià(
_¿ndom
) {

96 if((
_couÁ
 & 7) < 2){

97 
th
->
th_dpÜt
 = 
	`htÚs
(80);

98 } if((
_couÁ
 & 7) == 3){

99 
th
->
th_dpÜt
 = 
	`htÚs
(
	`şick_¿ndom
() % 1024);

102 
th
->
th_dpÜt
 = 
	`htÚs
(
	`şick_¿ndom
() % 1024);

105 
_couÁ
++;

107 
	`memıy
(
™mp
, 

, 9);

108 
	`mem£t
(

, '\0', 9);

109 
oisum
 = 

->
_sum
;

110 

->
_sum
 = 0;

111 

->
_Ën
 = 
	`htÚs
(
’
 - 
hËn
);

113 
th
->
th_sum
 = 0;

114 
th
->
th_sum
 = 
	`şick_š_cksum
((*)

, 
’
);

116 
	`memıy
(

, 
™mp
, 9);

117 

->
_sum
 = 
oisum
;

118 

->
_Ën
 = 
	`htÚs
(
’
);

120  
p
;

122 
bad
:

123 
	`şick_ch©‹r
("ForceTCP: bad†engths");

124 
p
->
	`kl
();

126 
	}
}

128 
CLICK_ENDDECLS


129 
EXPORT_ELEMENT
(
FÜûTCP
)

	@local/forcetcp.hh

1 #iâdeà
CLICK_FORCETCP_HH


2 
	#CLICK_FORCETCP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


21 şas 
	cFÜûTCP
 : 
public
 
EËm’t
 {

22 
public
:

23 
	$FÜûTCP
(è
CLICK_COLD
;

24 ~
	$FÜûTCP
(è
CLICK_COLD
;

26 cÚ¡ *
	$şass_Çme
() const {  "ForceTCP"; }

27 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

28 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

30 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

32 
	g´iv©e
:

33 
_couÁ
;

34 
ušt16_t
 
	g_dpÜt
;

35 
	g_æags
;

36 
boŞ
 
	g_¿ndom
;

39 
	gCLICK_ENDDECLS


	@local/forceudp.cc

18 
	~<şick/cÚfig.h
>

19 
	~"fÜûudp.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şickÃt/.h
>

23 
	~<şickÃt/udp.h
>

24 
	~<şick/¬gs.hh
>

25 
CLICK_DECLS


27 
	gFÜûUDP
::
	$FÜûUDP
()

29 
_couÁ
 = 0;

30 
_dpÜt
 = -1;

31 
	}
}

33 
	gFÜûUDP
::~
	$FÜûUDP
()

35 
	}
}

38 
FÜûUDP
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40 ià(
	gcÚf
.
size
(è=ğ0 || 
cÚf
[0] == "-1")

42 
ušt16_t
 
	gdp
;

43 ià(
Args
(
cÚf
, 
this
, 
”rh
)

44 .
»ad_p
("DPORT", 
IPPÜtArg
(
IP_PROTO_UDP
), 
dp
)

45 .
com¶‘e
() < 0)

47 
	g_dpÜt
 = 
dp
;

51 
Pack‘
 *

52 
	gFÜûUDP
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

54 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

55 
şick_
 *

 = 
p
->
	`_h—d”
();

56 
¶’
 = 
p
->
	`ÃtwÜk_Ëngth
();

57 
hËn
, 
’
, 
oisum
;

58 
™mp
[9];

59 
şick_udp
 *
uh
;

61 ià(!
p
->
	`has_ÃtwÜk_h—d”
(è|| 
¶’
 < (
şick_
))

62 
bad
;

64 
hËn
 = 

->
_hl
 << 2;

65 ià(
hËn
 < (
şick_
è|| hËÀ> 
¶’
)

66 
bad
;

68 
’
 = 
	`Áohs
(

->
_Ën
);

69 ifĞ
’
 < 
hËn
 + (
şick_udp
))

70 
bad
;

72 
uh
 = (
şick_udp
 *è(((*)

è+ 
hËn
);

74 
uh
->
uh_uËn
 = 
	`htÚs
(
’
 - 
hËn
);

76 if(
_dpÜt
 >= 0){

77 
uh
->
uh_dpÜt
 = 
	`htÚs
(
_dpÜt
);

79 
uh
->
uh_dpÜt
 = 
	`htÚs
(
	`şick_¿ndom
(0, 1023));

81 
_couÁ
++;

83 
	`memıy
(
™mp
, 

, 9);

84 
	`mem£t
(

, '\0', 9);

85 
oisum
 = 

->
_sum
;

86 

->
_sum
 = 0;

87 

->
_Ën
 = 
	`htÚs
(
’
 - 
hËn
);

89 
uh
->
uh_sum
 = 0;

90 
uh
->
uh_sum
 = 
	`şick_š_cksum
((*)

, 
’
);

92 
	`memıy
(

, 
™mp
, 9);

93 

->
_sum
 = 
oisum
;

94 

->
_Ën
 = 
	`htÚs
(
’
);

96  
p
;

98 
bad
:

99 
	`şick_ch©‹r
("ForceUDP: bad†engths");

100 
p
->
	`kl
();

102 
	}
}

104 
CLICK_ENDDECLS


105 
EXPORT_ELEMENT
(
FÜûUDP
)

	@local/forceudp.hh

1 #iâdeà
CLICK_FORCEUDP_HH


2 
	#CLICK_FORCEUDP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


18 şas 
	cFÜûUDP
 : 
public
 
EËm’t
 {

19 
public
:

20 
	$FÜûUDP
(è
CLICK_COLD
;

21 ~
	$FÜûUDP
(è
CLICK_COLD
;

23 cÚ¡ *
	$şass_Çme
() const {  "ForceUDP"; }

24 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

25 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

27 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

29 
	g´iv©e
:

30 
_couÁ
;

31 
	g_dpÜt
;

34 
	gCLICK_ENDDECLS


	@local/indextreesiplookup.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~"šdexŒ“slookup.hh
"

25 
CLICK_DECLS


27 
	gIndexT»esIPLookup
::
	$IndexT»esIPLookup
()

29 
i
=0; i<
INDEX_SIZE
; i++)

30 
_Œ“s
[
i
] = 0;

31 
	}
}

33 
	gIndexT»esIPLookup
::~
	$IndexT»esIPLookup
()

35 
	}
}

38 
IndexT»esIPLookup
::
	$ş—nup
(
CËªupSge
)

40 
i
=0; i<
INDEX_SIZE
; i++)

41 
d–‘e
 
_Œ“s
[
i
];

42 
	}
}

44 
SŒšg


45 
	gIndexT»esIPLookup
::
	$dump_rou‹s
()

47 
SŒšg
 
»t
 = "";

48  
»t
;

49 
	}
}

52 
	gIndexT»esIPLookup
::
	$add_rou‹
(
IPAdd»ss
 
d
, IPAdd»s 
m
, IPAdd»s 
g
, 
pÜt
)

56 
	}
}

59 
	gIndexT»esIPLookup
::
	$»move_rou‹
(
IPAdd»ss
 
d
, IPAdd»s 
m
)

62 
	}
}

65 
	gIndexT»esIPLookup
::
	$lookup_rou‹
(
IPAdd»ss
 
d
, IPAdd»s &
gw
)

67 
h
 = 
	`hash
(
d
);

68 
	}
}

70 
	gCLICK_ENDDECLS


	@local/indextreesiplookup.hh

1 #iâdeà
CLICK_INDEXTREEIPLOOKUP_HH


2 
	#CLICK_INDEXTREEIPLOOKUP_HH


	)

3 
	~<şick/glue.hh
>

4 
	~<şick/–em’t.hh
>

5 
	~"..//rou‹bË.hh
"

6 
CLICK_DECLS


23 şas 
	cT»eNode
 {

24 
	mpublic
:

25 
T»eNode
(
IPAdd»ss
, IPAddress, IPAddress, );

26 ~
	$T»eNode
(è
CLICK_COLD
;

28 
	`š£¹
(
IPAdd»ss
, IPAddress, IPAddress, );

29 
	`»move
(
IPAdd»ss
, IPAddress);

30 
T»eNode
* 
	`£¬ch
(
IPAdd»ss
);

32 
IPAdd»ss
 
	$d¡
(ècÚ¡ {  
_d¡
; }

33 
IPAdd»ss
 
	$mask
(ècÚ¡ {  
_mask
; 
	}
}

34 
IPAdd»ss
 
	$gw
(ècÚ¡ {  
_gw
; 
	}
}

35 
	$pÜt
(ècÚ¡ {  
_pÜt
; 
	}
}

37 
	g´iv©e
:

38 
T»eNode
 *
_Ëá
;

39 
T»eNode
 *
	g_right
;

40 
T»eNode
 *
	g_middË
;

42 
IPAdd»ss
 
	g_d¡
;

43 
IPAdd»ss
 
	g_mask
;

44 
IPAdd»ss
 
	g_gw
;

45 
	g_pÜt
;

48 şas 
	cIndexT»esIPLookup
 : 
public
 
EËm’t
 {

49 
public
:

50 
	$IndexT»esIPLookup
(è
CLICK_COLD
;

51 ~
	$IndexT»esIPLookup
(è
CLICK_COLD
;

53 cÚ¡ *
	$şass_Çme
() const {  "IndexTreesIPLookup"; }

54 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

55 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

57 
SŒšg
 
	`dump_rou‹s
();

58 
	`add_rou‹
(
IPAdd»ss
, IPAddress, IPAddress, );

59 
	`»move_rou‹
(
IPAdd»ss
, IPAddress);

60 
	`lookup_rou‹
(
IPAdd»ss
, IPAddress &);

62 
´iv©e
:

64 cÚ¡ 
INDEX_SIZE
 = 256;

65 
T»eNode
* 
_Œ“s
[
INDEX_SIZE
];

67 
	$hash
(
a
è{  (×>>24)&255); 
	}
}

70 
	gCLICK_ENDDECLS


	@local/print80211.cc

18 
	~<m©h.h
>

19 
	~<şick/cÚfig.h
>

20 
	~"´št80211.hh
"

21 
	~<şick/glue.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/‘h”add»ss.hh
>

26 #ià
__F»eBSD__
 >= 4

27 
	~<Ãt/‘h”Ãt.h
>

28 
	~<Ãt/if.h
>

29 #ià
__F»eBSD__
 >= 6

30 
	~<Ãt80211/›“80211.h
>

32 
	~<Ãt/if_›“80211.h
>

35 
CLICK_DECLS


37 
	gPršt80211
::
	$Pršt80211
()

39 
	}
}

41 
Pršt80211
::~
	$Pršt80211
()

43 
	}
}

46 
Pršt80211
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
* 
”rh
)

48 
SŒšg
 
	gÏb–
;

49 
boŞ
 
	gtime¡amp
 = 
çl£
;

50 
boŞ
 
	gv”bo£
 = 
çl£
;

51 ià(
Args
(
cÚf
, 
this
, 
”rh
)

52 .
»ad_p
("LABEL", 
Ïb–
)

53 .
»ad
("TIMESTAMP", 
time¡amp
)

54 .
»ad
("VERBOSE", 
v”bo£
)

55 .
com¶‘e
() < 0)

58 
	g_Ïb–
 = 
Ïb–
;

59 
	g_time¡amp
 = 
time¡amp
;

60 
	g_v”bo£
 = 
v”bo£
;

64 #ià
defšed
(
__F»eBSD__
) && __FreeBSD__ >= 4

65 
SŒšg


66 
	$hex_¡ršg
(
i
, 
boŞ
 
add_x
 = 
çl£
)

68 
buf
[100];

69 
	`¢´štf
(
buf
, (buf), "%s%x", (
add_x
 ? "0x" : ""), 
i
);

70  
buf
;

71 
	}
}

74 
	$´št_d©a
(
SŒšgAccum
 &
s
, 
boŞ
 , cÚ¡ 
ušt8_t
 *
buf
, 
buæ’
)

76 ià(
buæ’
 < 26) {

77 
s
 << "D©¨äamtoØshÜˆ(hav" << 
buæ’
 << ", wanted‡t†east 26)";

80 
ušt8_t
 
fc1
 = 
buf
[1];

81 
boŞ
 
to_ds
 = ((
fc1
 & 
IEEE80211_FC1_DIR_MASK
è=ğ
IEEE80211_FC1_DIR_TODS
);

82 
boŞ
 
äom_ds
 = ((
fc1
 & 
IEEE80211_FC1_DIR_MASK
è=ğ
IEEE80211_FC1_DIR_FROMDS
);

83 
Eth”Add»ss
 
	`a1
(
buf
 + 4);

84 
Eth”Add»ss
 
	`a2
(
buf
 + 10);

85 
Eth”Add»ss
 
	`a3
(
buf
 + 16);

87 ià(!
to_ds
 && !
äom_ds
)

88 
s
 << "SA " << 
a2
.
	`s
(è<< " -> DA " << 
a1
.s(è<< ", BSSID " << 
a3
.s();

89 ià(!
to_ds
 && 
äom_ds
)

90 
s
 << "BSSID " << 
a2
.
	`s
(è<< " -> DA " << 
a1
.s(è<< ", SA " << 
a3
.s();

91 ià(
to_ds
 && !
äom_ds
)

92 
s
 << "SA " << 
a2
.
	`s
(è<< " -> BSSID " << 
a1
.s(è<< ", DA " << 
a3
.s();

94 
Eth”Add»ss
 
	`a4
(
buf
 + 24);

95 
s
 << "TA " << 
a2
.
	`s
(è<< " -> RA " << 
a1
.s(è<< ", DA " << 
a3
.s(è<< ", SA " << 
a4
.s();

97 
sbuf
[100];

98 
	`¢´štf
(
sbuf
, (sbuf), " Seq: %02x %02x\n", (è
buf
[22], () buf[23]);

99 
s
 << 
sbuf
;

100 
	}
}

103 
	$´št_mgmt
(
SŒšgAccum
 &
s
, 
boŞ
 , cÚ¡ 
ušt8_t
 *
buf
, 
buæ’
)

105 ià(
buæ’
 < 24) {

106 
s
 << "Mªagem’ˆäamtoØshÜˆ(hav" << 
buæ’
 << ", wanted‡t†east 24)\n";

109 
Eth”Add»ss
 
	`d¡
(
buf
 + 4);

110 
Eth”Add»ss
 
	`¤c
(
buf
 + 10);

111 
Eth”Add»ss
 
	`bssid
(
buf
 + 16);

112 
s
 << "DA: " << 
d¡
.
	`s
(è<< " SA: " << 
¤c
.s(è<< " BSSID: " << 
bssid
.s();

113 
	}
}

116 
	$´št_ùl
(
SŒšgAccum
 &
s
, 
boŞ
 , cÚ¡ 
ušt8_t
 *
buf
, )

118 
ušt8_t
 
fc0
 = 
buf
[0];

119 
fc0
 & 
IEEE80211_FC0_SUBTYPE_MASK
) {

120 
IEEE80211_FC0_SUBTYPE_RTS
: {

121 
Eth”Add»ss
 
	`¿
(
buf
 + 4);

122 
Eth”Add»ss
 
	`
(
buf
 + 10);

123 
s
 << "RA: " << 
¿
.
	`s
(è<< " TA: " << 

.s();

126 
IEEE80211_FC0_SUBTYPE_CTS
:

127 
IEEE80211_FC0_SUBTYPE_ACK
: {

128 
Eth”Add»ss
 
	`¿
(
buf
 + 4);

129 
s
 << "RA: " << 
¿
.
	`s
().
	`c_¡r
();

132 
IEEE80211_FC0_SUBTYPE_PS_POLL
: {

133 
s
 << "AID is Duration ";

134 
Eth”Add»ss
 
	`bssid
(
buf
 + 4);

135 
Eth”Add»ss
 
	`
(
buf
 + 10);

136 
s
 << "BSSID: " << 
bssid
.
	`s
(è<< " TA: " << 

.s();

139 
IEEE80211_FC0_SUBTYPE_CF_END
:

140 
IEEE80211_FC0_SUBTYPE_CF_END_ACK
: {

141 
Eth”Add»ss
 
	`¿
(
buf
 + 4);

142 
Eth”Add»ss
 
	`bssid
(
buf
 + 10);

143 
s
 << "RA: " << 
¿
.
	`s
(è<< " BSSID: " << 
bssid
.s();

147 
s
 << "UnknowÀcÚŒŞ f¿msubty³ " << 
	`hex_¡ršg
(
fc0
 & 
IEEE80211_FC0_SUBTYPE_MASK
);

149 
	}
}

152 
	$äame_ty³
(cÚ¡ 
ušt8_t
 *
fùl
)

154 
SŒšg
 
s
;

155 
s
 = "";

156 
ušt8_t
 
fc0
 = 
fùl
[0];

157 
ty³
 = 
IEEE80211_FC0_TYPE_MASK
 & 
fc0
;

158 
subty³
 = 
IEEE80211_FC0_SUBTYPE_MASK
 & 
fc0
;

160 
ty³
) {

161 
IEEE80211_FC0_TYPE_MGT
:

162 
s
 = "Management, ";

163 
subty³
) {

164 
IEEE80211_FC0_SUBTYPE_ASSOC_REQ
: 
s
 += "Association„equest"; ;

165 
IEEE80211_FC0_SUBTYPE_ASSOC_RESP
: 
s
 += "Association„esponse"; ;

166 
IEEE80211_FC0_SUBTYPE_REASSOC_REQ
: 
s
 += "Reassociation„equest"; ;

167 
IEEE80211_FC0_SUBTYPE_REASSOC_RESP
: 
s
 += "Reassociation„esponse"; ;

168 
IEEE80211_FC0_SUBTYPE_PROBE_REQ
: 
s
 += "Probe„equest"; ;

169 
IEEE80211_FC0_SUBTYPE_PROBE_RESP
: 
s
+= "Probe„esponse"; ;

170 
IEEE80211_FC0_SUBTYPE_BEACON
: 
s
 += "Beacon"; ;

171 
IEEE80211_FC0_SUBTYPE_ATIM
: 
s
 += "ATIM"; ;

172 
IEEE80211_FC0_SUBTYPE_DISASSOC
: 
s
 += "Disassociation"; ;

173 
IEEE80211_FC0_SUBTYPE_AUTH
: 
s
 += "Authorization"; ;

174 
IEEE80211_FC0_SUBTYPE_DEAUTH
: 
s
 += "Deauthorization"; ;

175 : 
s
 +ğ"UnknowÀsubty³ " + 
	`hex_¡ršg
(
subty³
);

178 
IEEE80211_FC0_TYPE_CTL
:

179 
s
 = "Control, ";

180 
subty³
) {

181 
IEEE80211_FC0_SUBTYPE_PS_POLL
: 
s
 += "PS Poll"; ;

182 
IEEE80211_FC0_SUBTYPE_RTS
: 
s
 += "RTS"; ;

183 
IEEE80211_FC0_SUBTYPE_CTS
: 
s
 += "CTS"; ;

184 
IEEE80211_FC0_SUBTYPE_ACK
: 
s
 += "ACK"; ;

185 
IEEE80211_FC0_SUBTYPE_CF_END
: 
s
 += "CF End"; ;

186 
IEEE80211_FC0_SUBTYPE_CF_END_ACK
: 
s
 += "CF End ACK"; ;

187 : 
s
 +ğ"UnknowÀsubty³ " + 
	`hex_¡ršg
(
subty³
);

190 
IEEE80211_FC0_TYPE_DATA
:

191 
s
 = "Data, ";

192 
subty³
) {

193 
IEEE80211_FC0_SUBTYPE_DATA
: 
s
 += "Real data"; ;

194 
IEEE80211_FC0_SUBTYPE_CF_ACK
: 
s
 += "CF ACK"; ;

195 
IEEE80211_FC0_SUBTYPE_CF_POLL
: 
s
 += "CF…oll"; ;

196 
IEEE80211_FC0_SUBTYPE_CF_ACPL
: 
s
 += "CF ACPL"; ;

197 
IEEE80211_FC0_SUBTYPE_NODATA
: 
s
 += "No data"; ;

198 
IEEE80211_FC0_SUBTYPE_CFACK
: 
s
 += "CFACK"; ;

199 
IEEE80211_FC0_SUBTYPE_CFPOLL
: 
s
 += "CFPOLL"; ;

200 
IEEE80211_FC0_SUBTYPE_CF_ACK_CF_ACK
: 
s
 += "CF ACK of ACK"; ;

201 : 
s
 +ğ"UnknowÀsubty³ " + 
	`hex_¡ršg
(
subty³
);

205 
s
 = "UnknowÀty³ " + 
	`hex_¡ršg
(
ty³
);

207  
s
.
	`c_¡r
();

208 
	}
}

211 
Pack‘
 *

212 
	gPršt80211
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

214 
SŒšgAccum
 
§
;

215 
§
 << 
_Ïb–
;

216 ià(
_Ïb–
)

217 
§
 << ": ";

218 ià(
_time¡amp
)

219 
§
 << 
p
->
	`time¡amp_ªno
() << ": ";

221 
sbuf
[100];

222 
	`¢´štf
(
sbuf
, (sbuf), "%4d | ", 
p
->
	`Ëngth
());

223 
§
 << 
sbuf
;

225 #ià
	`defšed
(
__F»eBSD__
) && __FreeBSD__ >= 4

226 
›“80211_äame
 *
äame
 = (›“80211_äam*è
p
->
	`d©a
();

229 
§
 << "F¿mty³: " << 
	`äame_ty³
(
äame
->
i_fc
) << " ";

231 
fc0
 = 
äame
->
i_fc
[0];

232 ià(
_v”bo£
) {

233 
fc1
 = 
äame
->
i_fc
[1];

234 
dur0
 = 
	`Áohs
(
äame
->
i_dur
);

235 
	`¢´štf
(
sbuf
, (sbuf), "F¿mCÚŒŞ: %02x %02x ", 
fc0
, 
fc1
);

236 
§
 << 
sbuf
;

237 
	`¢´štf
(
sbuf
, (sbuf), "Du¿tiÚ: %04x ", 
dur
);

238 
§
 << 
sbuf
;

241 
ty³
 = 
fc0
 & 
IEEE80211_FC0_TYPE_MASK
;

242 
ty³
) {

243 
IEEE80211_FC0_TYPE_DATA
: 
	`´št_d©a
(
§
, 
_v”bo£
, 
p
->
	`d©a
(),…->
	`Ëngth
()); ;

244 
IEEE80211_FC0_TYPE_MGT
: 
	`´št_mgmt
(
§
, 
_v”bo£
, 
p
->
	`d©a
(),…->
	`Ëngth
()); ;

245 
IEEE80211_FC0_TYPE_CTL
: 
	`´št_ùl
(
§
, 
_v”bo£
, 
p
->
	`d©a
(),…->
	`Ëngth
()); ;

247 
	`¢´štf
(
sbuf
, (sbuf),"x%x", 
ty³
);

248 
§
 << "UnknowÀ802.11…ack‘y³ " << 
sbuf
;

252 
	`şick_ch©‹r
("%s", 
§
.
	`c_¡r
());

253  
p
;

254 
	}
}

256 
CLICK_ENDDECLS


257 
	$EXPORT_ELEMENT
(
Pršt80211
)

258 
	`ELEMENT_REQUIRES
(
u£¾ev–
)

	@local/print80211.hh

1 #iâdeà
CLICK_PRINT80211_HH


2 
	#CLICK_PRINT80211_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/¡ršg.hh
>

5 
CLICK_DECLS


34 şas 
	cPršt80211
 : 
public
 
EËm’t
 {…ublic:

36 
Pršt80211
();

37 ~
Pršt80211
();

39 cÚ¡ *
	$şass_Çme
() const {  "Print80211"; }

40 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

42 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

43 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

45 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

47 
	g´iv©e
:

49 
SŒšg
 
_Ïb–
;

50 
boŞ
 
	g_time¡amp
;

51 
boŞ
 
	g_v”bo£
;

54 
	gCLICK_ENDDECLS


	@local/printairo.cc

18 
	~<şick/cÚfig.h
>

19 
	~"´šœo.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şick/‘h”add»ss.hh
>

25 #ifdeà
CLICK_USERLEVEL


26 
	~<m©h.h
>

29 
CLICK_DECLS


35 
	sª_rxäame
 {

36 
u_št32_t
 
	mª_rx_time
;

37 
u_št16_t
 
	mª_rx_¡©us
;

38 
u_št16_t
 
	mª_rx_·ylßd_Ën
;

39 
u_št8_t
 
	mª_rsvd0
;

40 
u_št8_t
 
	mª_rx_sigÇl_¡»ngth
;

41 
u_št8_t
 
	mª_rx_¿‹
;

42 
u_št8_t
 
	mª_rx_chª
;

43 
u_št8_t
 
	mª_rx_assoc_út
;

44 
u_št8_t
 
	mª_rsvd1
[3];

45 
u_št8_t
 
	mª_¶ı_hdr
[4];

46 
u_št16_t
 
	mª_äame_ùl
;

47 
u_št16_t
 
	mª_du¿tiÚ
;

48 
u_št8_t
 
	mª_addr1
[6];

49 
u_št8_t
 
	mª_addr2
[6];

50 
u_št8_t
 
	mª_addr3
[6];

51 
u_št16_t
 
	mª_£q_ùl
;

52 
u_št8_t
 
	mª_addr4
[6];

53 
u_št8_t
 
	mª_g­Ën
;

54 } 
__©Œibu‹__
((
·cked
));

56 
	gPrštAœo
::
	$PrštAœo
()

58 
	}
}

60 
PrštAœo
::~
	$PrštAœo
()

62 
	}
}

65 
PrštAœo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
* 
”rh
)

67 
SŒšg
 
	gÏb–
;

68 
boŞ
 
	gtime¡amp
 = 
çl£
;

69 
boŞ
 
	gqu›t
 = 
çl£
;

70 
boŞ
 
	gv”bo£
 = 
çl£
;

71 ià(
Args
(
cÚf
, 
this
, 
”rh
)

72 .
»ad_p
("LABEL", 
Ïb–
)

73 .
»ad
("TIMESTAMP", 
time¡amp
)

74 .
»ad
("QUIET", 
qu›t
)

75 .
»ad
("VERBOSE", 
v”bo£
)

76 .
com¶‘e
() < 0)

79 
	g_Ïb–
 = 
Ïb–
;

80 
	g_time¡amp
 = 
time¡amp
;

81 
	g_qu›t
 = 
qu›t
;

82 
	g_v”bo£
 = 
v”bo£
;

86 
	gb™s
[9];

89 
	$b™_¡ršg
(
u_št8_t
 
b
)

91 
b™s
[8] = 0;

92 
i
 = 0; i < 8; i++) {

93 
mask
 = 1 << 
i
;

94 ià(
mask
 & 
b
)

95 
b™s
[
i
] = '1';

97 
b™s
[
i
] = '.';

99  
b™s
;

100 
	}
}

104 
	#IEEE80211_FC1_DIR_TODS
 0x01

	)

105 
	#IEEE80211_FC1_DIR_FROMDS
 0x02

	)

107 
Pack‘
 *

108 
	gPrštAœo
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

110 
ª_rxäame
 *
äame
 = (ª_rxäam*è
p
->
	`d©a
();

112 ià(
p
->
	`Ëngth
(è< (*
äame
)) {

113 
	`şick_ch©‹r
("%s: Pack‘oØshÜˆtØhŞd AœÚ‘ h—d”", 
	`Çme
().
	`c_¡r
());

119 
u_št8_t
 
buf
[2048];

120 
u_št16_t
 
fc1
 = 
äame
->
ª_äame_ùl
 >> 8;

121 
›“80211_h—d”_Ën
 = 24;

122 ià((
fc1
 & 
IEEE80211_FC1_DIR_TODS
) &&

123 (
fc1
 & 
IEEE80211_FC1_DIR_FROMDS
))

124 
›“80211_h—d”_Ën
 += 6;

125 
Ën
 = 
äame
->
ª_rx_·ylßd_Ën
 + 
›“80211_h—d”_Ën
;

126 ià(
Ën
 > (
buf
)) {

127 
	`şick_ch©‹r
("%s: Frameoo bigo copy into buffer (%d > %d)\n",

128 
	`Çme
().
	`c_¡r
(), 
Ën
, ()(
buf
));

132 
	`memıy
(
buf
, &
äame
->
ª_äame_ùl
, 
›“80211_h—d”_Ën
);

135 
	`memıy
(
buf
 + 
›“80211_h—d”_Ën
,

136 ((
u_št8_t
 *è
äame
è+ (
ª_rxäame
è+ f¿me->
ª_g­Ën
,

137 
äame
->
ª_rx_·ylßd_Ën
);

139 ià(!
_qu›t
) {

140 
SŒšgAccum
 
§
;

141 ià(!
_qu›t
) {

142 ià(
_Ïb–
)

143 
§
 << 
_Ïb–
;

145 
§
 << 
	`Çme
();

146 
§
 << ": ";

147 ià(
_time¡amp
)

148 
§
 << 
p
->
	`time¡amp_ªno
() << ": ";

150 
r
 = 
äame
->
ª_rx_¿‹
 / 2;

151 
boŞ
 
´št5
 = (
r
 * 2 < 
äame
->
ª_rx_¿‹
);

152 
šfo
[1024];

153 
	`¢´štf
(
šfo
, (info), "%s%4d | RSSI: %d Rate: %d%s Mbps Chan: %d",

154 
§
.
	`c_¡r
(), 
p
->
	`Ëngth
(), (è
äame
->
ª_rx_sigÇl_¡»ngth
,

155 
r
, 
´št5
 ? ".5" : "", (è
äame
->
ª_rx_chª
);

156 
	`şick_ch©‹r
("%s", 
šfo
);

158 ià(
_v”bo£
) {

159 
¶ı_¿‹
 = 0;

160 
äame
->
ª_¶ı_hdr
[0]) {

161 0x0a: 
	`şick_ch©‹r
("\tPLCP.SigÇl: 1 Mbp DBPSK\n"); 
¶ı_¿‹
 = 2; ;

162 0x14: 
	`şick_ch©‹r
("\tPLCP.SigÇl: 2 Mbp DQPSK\n"); 
¶ı_¿‹
 = 4; ;

163 0x37: 
	`şick_ch©‹r
("\tPLCP.SigÇl: 5.5 Mbps\n"); 
¶ı_¿‹
 = 11; ;

164 0x6e: 
	`şick_ch©‹r
("\tPLCP.SigÇl: 11 Mbps\n"); 
¶ı_¿‹
 = 22; ;

165 : 
	`şick_ch©‹r
("PLCP.Signal value‚ot„ecognized \n");

167 ià(
¶ı_¿‹
 > 0 &&…lı_¿‹ !ğ
äame
->
ª_rx_¿‹
)

168 
	`şick_ch©‹r
("\tWarning: PLCP signal„ate does‚ot match„ate…rovided by‡dapter!");

170 
u_št8_t
 
svc
 = 
äame
->
ª_¶ı_hdr
[1];

171 
	`şick_ch©‹r
("\tPLCP.Service:†ocked_clocks=%d modulation=%s†ength_extension=%d (%s)\n",

172 
svc
 & 4 ? 1 : 0, svø& 8 ? "PBCC" : "CCK", svø& 128 ? 1 : 0, 
	`b™_¡ršg
(svc));

174 
Ën_u£cs
 = (
äame
->
ª_¶ı_hdr
[3] << 8) | frame->an_plcp_hdr[2];

175 
	`şick_ch©‹r
("\tPLCP.L’gth: %d miüo£cÚds\n", 
Ën_u£cs
);

177 #ifdeà
CLICK_USERLEVEL


178 
Ën_où‘s
;

179 
äame
->
ª_rx_¿‹
) {

181 
Ën_où‘s
 = 
Ën_u£cs
 / 8;

184 
Ën_où‘s
 = 
Ën_u£cs
 / 4;

187 ià(
svc
 & 8)

188 
Ën_où‘s
 = (è
	`æoÜ
((
Ën_u£cs
 * 5.5 / 8) - 1);

190 
Ën_où‘s
 = (è
	`æoÜ
(
Ën_u£cs
 * 5.5 / 8);

193 ià(
svc
 & 8)

194 
Ën_où‘s
 = (è
	`æoÜ
((
Ën_u£cs
 * 11 / 8) - 1);

196 
Ën_où‘s
 = (è
	`æoÜ
(
Ën_u£cs
 * 11 / 8);

197 ià(
svc
 & 128)

198 
Ën_où‘s
--;

201 
Ën_où‘s
 = -1;

203 
	`şick_ch©‹r
("\tEx³ùed %d PSDU où‘s, gÙ %d\n", 
Ën_où‘s
, 
Ën
);

205 
	`şick_ch©‹r
("\tAœØ·ylßd†’gth: %d\n", (è
äame
->
ª_rx_·ylßd_Ën
);

206 
	`şick_ch©‹r
("\tIEEE h—d”†’gth: %d\n", 
›“80211_h—d”_Ën
);

207 
	`şick_ch©‹r
("\tG­†’gth: %d\n", (è
äame
->
ª_g­Ën
);

215 
p
->
	`kl
();

216 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(
buf
, 
Ën
);

218  
q
;

219 
	}
}

221 
CLICK_ENDDECLS


222 
	$EXPORT_ELEMENT
(
PrštAœo
)

223 
	`ELEMENT_REQUIRES
(
u£¾ev–
)

	@local/printairo.hh

1 #iâdeà
CLICK_PRINTAIRO_HH


2 
	#CLICK_PRINTAIRO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/¡ršg.hh
>

5 
CLICK_DECLS


45 şas 
	cPrštAœo
 : 
public
 
EËm’t
 {…ublic:

47 
	$PrštAœo
(è
CLICK_COLD
;

48 ~
	$PrštAœo
(è
CLICK_COLD
;

50 cÚ¡ *
	$şass_Çme
() const {  "PrintAiro"; }

51 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

53 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

54 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

56 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

58 
	g´iv©e
:

60 
SŒšg
 
_Ïb–
;

61 
boŞ
 
	g_time¡amp
;

62 
boŞ
 
	g_qu›t
;

63 
boŞ
 
	g_v”bo£
;

66 
	gCLICK_ENDDECLS


	@local/reframe.cc

10 
	~<şick/cÚfig.h
>

11 
	~"»äame.hh
"

12 
	~<şick/”rÜ.hh
>

13 
	~<şick/¬gs.hh
>

14 
	~<şick/glue.hh
>

15 
	~<şick/·ck‘_ªno.hh
>

16 
	~<şick/·ck‘.hh
>

17 
	~<uni¡d.h
>

18 
	~<sys/sock‘.h
>

19 
	~<sys/un.h
>

20 
	~<¬·/š‘.h
>

21 
	~<fú.h
>

23 
	gCLICK_DECLS


25 
	#MIN
(
a
, 
b
è(×è< (bè? (aè: (b))

	)

26 
	#®igÁo
(
m
, 
n
è(((m)+Ò)-1)/Ò)*Ò))

	)

28 
	gReäame
::
	$Reäame
()

29 : 
	`_foff
(2), 
	`_æ’
(2), 
	`_Áoh
(
Œue
), 
	`_mul
(1), 
	`_®ign
(1), 
	`_add
(0),

30 
	`_h—d”
(0), 
	`_qh—d
(0), 
	`_q
(0), 
	`_have
(0), 
	`_Ãed
(-1)

32 
	}
}

34 
	gReäame
::~
	$Reäame
()

36 
	}
}

39 
Reäame
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

42 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

43 .
»ad
("FOFF", 
_foff
)

44 .
»ad
("FLEN", 
_æ’
)

45 .
»ad
("NTOH", 
_Áoh
)

46 .
»ad
("MUL", 
_mul
)

47 .
»ad
("ALIGN", 
_®ign
)

48 .
»ad
("ADD", 
_add
)

49 .
cÚsume
() < 0)

52 
	g_æ’
) {

56  
”rh
->
”rÜ
("šv®id f›ld†’gth %d (v®id f›ld†’gth ¬0, 1, 2,‡nd 4 by‹s)", 
_æ’
);

63 
	gReäame
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

65 ià(
_æ’
) {

67 
_h—d”
 = 
Pack‘
::
	`make
(
_foff
 + 
_æ’
);

68 ià(!
_h—d”
) {

69  
”rh
->
	`”rÜ
("out of memory");

71 
_h—d”
->
	`ke
(_h—d”->
	`Ëngth
());

74 
	}
}

77 
	gReäame
::
	$ş—nup
(
CËªupSge
)

79 ià(
_h—d”
) {

80 
_h—d”
->
	`kl
();

82 
_qh—d
) {

83 
Pack‘
 *
p
 = 
_qh—d
;

84 
_qh—d
 = 
p
->
	`Ãxt
();

85 
p
->
	`kl
();

87 
	}
}

90 
	gReäame
::
	$»äame
()

92 ià(
_æ’
) {

93 ià(
_have
 >ğ(
_foff
 + 
_æ’
)) {

95 ià(
_h—d”
->
	`Ëngth
() == 0) {

96 
	`as£¹
(
_qh—d
);

98 
Pack‘
 *
p
 = 
_qh—d
;

99 
p
 && (è
_h—d”
->
	`Ëngth
(è< (
_foff
 + 
_æ’
);

100 
p
 =…->
	`Ãxt
()) {

101 
	`memıy
(
_h—d”
->
	`’d_d©a
(), 
p
->
	`d©a
(),

102 
	`MIN
(
p
->
	`Ëngth
(), 
_foff
 + 
_æ’
 - 
_h—d”
->length()));

103 
_h—d”
 = _h—d”->
	`put
(
	`MIN
(
p
->
	`Ëngth
(), 
_foff
 + 
_æ’
 - _header->length()));

108 
_æ’
) {

110 
ušt8_t
 
Ën
;

111 
	`memıy
(&
Ën
, 
_h—d”
->
	`d©a
(è+ 
_foff
, 
_æ’
);

112 
_Ãed
 = 
_mul
 * 
Ën
;

116 
ušt16_t
 
Ën
;

117 
	`memıy
(&
Ën
, 
_h—d”
->
	`d©a
(è+ 
_foff
, 
_æ’
);

118 
_Ãed
 = 
_mul
 * (
_Áoh
 ? 
	`Áohs
(
Ën
) :†en);

122 
ušt32_t
 
Ën
;

123 
	`memıy
(&
Ën
, 
_h—d”
->
	`d©a
(è+ 
_foff
, 
_æ’
);

124 
_Ãed
 = 
_mul
 * (
_Áoh
 ? 
	`Áohl
(
Ën
) :†en);

128 
	`as£¹
(
_æ’
 == 1 || _flen == 2 || _flen == 4);

133 
_Ãed
 = 
	`®igÁo
(_Ãed, 
_®ign
è+ 
_add
;

136 
_Ãed
 = -1;

140 
_Ãed
 = 
_add
;

142 
	}
}

144 
Pack‘
 *

145 
	gReäame
::
	$puÎ
()

147 ià(
_Ãed
 >ğ0 && 
_have
 >= _need) {

149 
Wr™abËPack‘
 *
p1
 = 
Pack‘
::
	`make
(
_Ãed
);

150 ià(!
p1
) {

153 
p1
->
	`ke
(
_Ãed
);

154 
_Ãed
 > 0) {

155 
	`as£¹
(
_qh—d
);

156 
Pack‘
 *
p
 = 
_qh—d
;

157 ià((è
p
->
	`Ëngth
(è> 
_Ãed
) {

159 
	`memıy
(
p1
->
	`’d_d©a
(), 
p
->
	`d©a
(), 
_Ãed
);

160 
p1
 =…1->
	`put
(
_Ãed
);

162 
p
->
	`puÎ
(
_Ãed
);

163 
_have
 -ğ
_Ãed
;

164 
_Ãed
 = 0;

167 
	`memıy
(
p1
->
	`’d_d©a
(), 
p
->
	`d©a
(),…->
	`Ëngth
());

168 
p1
 =…1->
	`put
(
p
->
	`Ëngth
());

169 
_have
 -ğ
p
->
	`Ëngth
();

170 
_Ãed
 -ğ
p
->
	`Ëngth
();

172 
_qh—d
 = 
p
->
	`Ãxt
();

173 ià(!
_qh—d
)

174 
_q
 = 0;

175 
p
->
	`kl
();

179 
	`as£¹
(
_Ãed
 == 0);

181 ià(
_h—d”
)

182 
_h—d”
->
	`ke
(_h—d”->
	`Ëngth
());

183 
	`»äame
();

184  
p1
;

188 
	}
}

191 
	gReäame
::
	$push
(, 
Pack‘
 *
p
)

194 ià(
_q
) {

195 
	`as£¹
(
_qh—d
);

196 
_q
->
	`£t_Ãxt
(
p
);

198 
	`as£¹
(!
_qh—d
);

199 
_qh—d
 = 
p
;

201 
_q
 = 
p
;

202 
p
->
	`£t_Ãxt
(0);

203 
_have
 +ğ
p
->
	`Ëngth
();

204 
p
 = 0;

207 
	`»äame
();

209 (
p
 = 
	`puÎ
(0)))

210 
	`ouut
(0).
	`push
(
p
);

211 
	}
}

213 
CLICK_ENDDECLS


214 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

215 
	`EXPORT_ELEMENT
(
Reäame
)

	@local/reframe.hh

1 #iâdeà
CLICK_REFRAME_HH


2 
	#CLICK_REFRAME_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


108 şas 
	cReäame
 : 
public
 
EËm’t
 {…ublic:

110 
	$Reäame
(è
CLICK_COLD
;

111 ~
	$Reäame
(è
CLICK_COLD
;

113 cÚ¡ *
	$şass_Çme
() const {  "Reframe"; }

114 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

115 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "h/a"; 
	}
}

117 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

118 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

119 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

121 
	`push
(, 
Pack‘
*);

122 
Pack‘
 * 
	`puÎ
();

124 
´iv©e
:

126 
_foff
;

127 
_æ’
;

128 
boŞ
 
_Áoh
;

129 
_mul
;

130 
_®ign
;

131 
_add
;

133 
Wr™abËPack‘
 *
_h—d”
;

134 
Pack‘
 *
_qh—d
, *
_q
;

135 
_have
, 
_Ãed
;

137 
	`»äame
();

138 
	}
};

140 
	gCLICK_ENDDECLS


	@local/rrunqueue.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/”rÜ.hh
>

20 
	~"¼unqueue.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

23 
CLICK_DECLS


25 
	gRoundRobšUnqueue
::
	$RoundRobšUnqueue
()

26 : 
	`_sk
(
this
), 
	$_Ãxt
(0)

28 
	}
}

30 
	gRoundRobšUnqueue
::~
	$RoundRobšUnqueue
()

32 
	}
}

35 
RoundRobšUnqueue
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 
	g_bur¡
 = 1;

38  
Args
(
cÚf
, 
this
, 
”rh
)

39 .
»ad_p
("BURST", 
_bur¡
)

40 .
com¶‘e
();

44 
	gRoundRobšUnqueue
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

46 ià(
	`nouuts
(è!ğ
	`nšputs
()) {

47  
”rh
->
	`”rÜ
("number of outputs mustƒqualo‚umber of inputs");

49 
_·ck‘s
 = 0;

50 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

52 
	}
}

54 
boŞ


55 
	gRoundRobšUnqueue
::
	$run_sk
(
Task
 *)

57 
Œ›s
 = 0;

58 
Pack‘
 *
p_Ãxt
 = 
	`šput
(
_Ãxt
).
	`puÎ
();

60 
p_Ãxt
) {

61 
Pack‘
 *
p
 = 
p_Ãxt
;

62 
Œ›s
++;

63 ià(
Œ›s
 < 
_bur¡
 || _burst == 0) {

64 
p_Ãxt
 = 
	`šput
(
_Ãxt
).
	`puÎ
();

66 
p_Ãxt
 = 0;

67 #ifdeà
CLICK_LINUXMODULE


68 #ià
__i386__
 && 
HAVE_INTEL_CPU


69 ià(
p_Ãxt
) {

70 
sk_buff
 *
skb
 = 
p_Ãxt
->
	`skb
();

71 
asm
 vŞ©e("´eãtcht0 %0" : : "m" (
skb
->
Ën
));

72 
asm
 vŞ©e("´eãtcht0 %0" : : "m" (
skb
->
cb
[0]));

76 
	`ouut
(
_Ãxt
).
	`push
(
p
);

77 
_·ck‘s
++;

80 ià(
_Ãxt
 =ğ
	`nouuts
()-1)

81 
_Ãxt
 = 0;

83 
_Ãxt
++;

84 
_sk
.
	`ç¡_»scheduË
();

85  
Œue
;

86 
	}
}

88 
SŒšg


89 
	gRoundRobšUnqueue
::
	$»ad_·¿m
(
EËm’t
 *
e
, *)

91 
RoundRobšUnqueue
 *
u
 = (RoundRobšUnqueu*)
e
;

92  
	`SŒšg
(
u
->
_·ck‘s
) + "…ackets\n";

93 
	}
}

96 
	gRoundRobšUnqueue
::
	$add_hªdËrs
()

98 
	`add_»ad_hªdËr
("·ck‘s", 
»ad_·¿m
, 0);

99 
	`add_sk_hªdËrs
(&
_sk
);

100 
	}
}

102 
CLICK_ENDDECLS


103 
	$EXPORT_ELEMENT
(
RoundRobšUnqueue
)

104 
	`ELEMENT_MT_SAFE
(
RoundRobšUnqueue
)

	@local/rrunqueue.hh

1 #iâdeà
CLICK_RRUNQUEUE_HH


2 
	#CLICK_RRUNQUEUE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/sk.hh
>

5 
CLICK_DECLS


21 şas 
	cRoundRobšUnqueue
 : 
public
 
EËm’t
 {…ublic:

23 
	$RoundRobšUnqueue
(è
CLICK_COLD
;

24 ~
	$RoundRobšUnqueue
(è
CLICK_COLD
;

26 cÚ¡ *
	$şass_Çme
() const {  "RoundRobinUnqueue"; }

27 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/-"; 
	}
}

28 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL_TO_PUSH
; 
	}
}

30 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

31 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

32 
	$add_hªdËrs
(è
CLICK_COLD
;

34 
boŞ
 
	`run_sk
(
Task
 *);

36 
SŒšg
 
	$»ad_·¿m
(
EËm’t
 *
e
, *è
CLICK_COLD
;

38 
´iv©e
:

40 
_bur¡
;

41 
_·ck‘s
;

42 
Task
 
_sk
;

43 
_Ãxt
;

44 
	}
};

46 
	gCLICK_ENDDECLS


	@local/tcpack.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şickÃt/.h
>

21 
	~<şickÃt/tı.h
>

22 
	~<şick/rou‹rvis™Ü.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~"tıbufãr.hh
"

26 
	~"tıack.hh
"

27 
CLICK_DECLS


29 
	gTCPAck
::
	$TCPAck
()

30 : 
	$_tim”
(
this
)

32 
	}
}

34 
TCPAck
::~
	$TCPAck
()

36 
	}
}

39 
TCPAck
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41 
	g_ackd–ay_ms
 = 20;

42  
Args
(
cÚf
, 
this
, 
”rh
)

43 .
»ad
("DELAY", 
SecÚdsArg
(3), 
_ackd–ay_ms
)

44 .
com¶‘e
();

49 
	gTCPAck
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

51 
EËm’tCa¡T¿ck”
 
	`f‹r
(
	`rou‹r
(), "TCPBuffer");

52 ià(
	`rou‹r
()->
	`vis™_down¡»am
(
this
, 0, &
f‹r
) < 0)

53  
”rh
->
	`”rÜ
("flow-based„outer context failure");

54 ià(
f‹r
.
	`size
() < 1)

55  
”rh
->
	`”rÜ
("need‡t†east 1 downstream TCPBuffer");

56 
_tıbufãr
 = 
»š‹½»t_ÿ¡
<
TCPBufãr
 *>(
f‹r
[0]->
	`ÿ¡
("TCPBuffer"));

58 
_syÇck
 = 
çl£
;

59 
_Ãedack
 = 
çl£
;

60 
_tim”
.
	`š™Ÿlize
(
this
);

61 
_tim”
.
	`scheduË_aá”_m£c
(
_ackd–ay_ms
);

63 
	}
}

66 
	gTCPAck
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

68 
boŞ
 
fÜw¬d
;

69 ià(
pÜt
 == 0)

70 
fÜw¬d
 = 
	`ut
(
p
);

72 
fÜw¬d
 = 
	`İut
(
p
);

73 ià(
fÜw¬d
)

74 
	`ouut
(
pÜt
).
	`push
(
p
);

76 
p
->
	`kl
();

77 
	}
}

79 
Pack‘
 *

80 
	gTCPAck
::
	$puÎ
(
pÜt
)

82 
boŞ
 
fÜw¬d
;

83 
Pack‘
 *
p
 = 
	`šput
(
pÜt
).
	`puÎ
();

84 ià(
p
) {

85 ià(
pÜt
 == 0)

86 
fÜw¬d
 = 
	`ut
(
p
);

88 
fÜw¬d
 = 
	`İut
(
p
);

89 ià(
fÜw¬d
)

90  
p
;

92 
p
->
	`kl
();

97 
	}
}

99 
boŞ


100 
	gTCPAck
::
	$ut
(
Pack‘
 *
p
)

102 cÚ¡ 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

103 ià(!
_syÇck
 && (
tıh
->
th_æags
&(
TH_SYN
|
TH_ACK
))==(TH_SYN|TH_ACK)) {

105 
_ack_nxt
 = 
	`Áohl
(
tıh
->
th_£q
)+1;

106 
_syÇck
 = 
Œue
;

108 ià(!
_syÇck
)

109  
çl£
;

111 ià(
tıh
->
th_æags
 & (
TH_SYN
|
TH_FIN
|
TH_RST
))

112  
Œue
;

115 ià(
TCPBufãr
::
	`£qno
(
p
è=ğ
_ack_nxt
) {

119 
_ack_nxt
 +ğ
TCPBufãr
::
	`£qËn
(
p
);

120 
boŞ
 
v
 = 
_tıbufãr
->
	`Ãxt_missšg_£q_no
(
_ack_nxt
, _ack_nxt);

122 
	`as£¹
(
v
);

124 
	`şick_ch©‹r
("seqno <‡ck_nxt: out of order or„etransmitted…acket");

127 
_Ãedack
 = 
Œue
;

128 ià(!
_tim”
.
	`scheduËd
())

129 
_tim”
.
	`scheduË_aá”_m£c
(
_ackd–ay_ms
);

130  
Œue
;

131 
	}
}

133 
boŞ


134 
	gTCPAck
::
	$İut
(
Pack‘
 *
p
)

136 cÚ¡ 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

137 ià((
tıh
->
th_æags
&(
TH_SYN
|
TH_ACK
)) == (TH_SYN|TH_ACK)) {

139 
_ack_nxt
 = 
	`Áohl
(
tıh
->
th_ack
);

140 
_syÇck
 = 
Œue
;

142 ià(!
_syÇck
)

143  
çl£
;

144 
_Ãedack
 = 
çl£
;

146 
şick_tı
 *
tıh_Ãw
 = 
p
->
	`uniqueify
()->
	`tı_h—d”
();

147 
tıh_Ãw
->
th_ack
 = 
	`htÚl
(
_ack_nxt
);

148  
Œue
;

149 
	}
}

152 
	gTCPAck
::
	$run_tim”
(
Tim”
 *)

154 ià(
_Ãedack
) {

155 
	`£nd_ack
();

156 
_Ãedack
 = 
çl£
;

158 
	}
}

161 
	gTCPAck
::
	$£nd_ack
()

163 
şick_
 *

;

164 
şick_tı
 *
tı
;

165 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((*

è+ (*
tı
));

166 ià(
q
 == 0) {

167 
	`şick_ch©‹r
("TCPAck: cannot make…acket");

170 
	`mem£t
(
q
->
	`d©a
(), '\0', q->
	`Ëngth
());

171 

 = (
şick_
 *è
q
->
	`d©a
();

172 
tı
 = (
şick_tı
 *è(

 + 1);

174 

->
_v
 = 4;

175 

->
_hl
 = 5;

176 

->
_tos
 = 0x10;

177 

->
_Ën
 = 
	`htÚs
(
q
->
	`Ëngth
());

178 

->
_id
 = 
	`htÚs
(0);

179 

->
_off
 = 
	`htÚs
(
IP_DF
);

180 

->
_‰l
 = 255;

181 

->
_p
 = 
IP_PROTO_TCP
;

182 

->
_sum
 = 0;

184 
tı
->
th_ack
 = 
	`htÚl
(
_ack_nxt
);

185 
tı
->
th_off
 = 5;

186 
tı
->
th_æags
 = 
TH_ACK
;

187 
tı
->
th_wš
 = 
	`htÚs
(32120);

188 
tı
->
th_sum
 = 
	`htÚs
(0);

189 
tı
->
th_u½
 = 
	`htÚs
(0);

191 
q
->
	`£t__h—d”
(

, ip->
_hl
 << 2);

192 
	`ouut
(2).
	`push
(
q
);

193 
	}
}

195 
CLICK_ENDDECLS


196 
EXPORT_ELEMENT
(
TCPAck
)

	@local/tcpack.hh

1 #iâdeà
CLICK_TCPACK_HH


2 
	#CLICK_TCPACK_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tim”.hh
>

5 
	~<şickÃt/tı.h
>

6 
CLICK_DECLS


45 
şass
 
	gTCPBufãr
;

47 şas 
	cTCPAck
 : 
public
 
EËm’t
 {

48 
´iv©e
:

49 
Tim”
 
_tim”
;

51 
boŞ
 
	m_syÇck
;

52 
boŞ
 
	m_Ãedack
;

53 
	m_ack_nxt
;

55 
TCPBufãr
 *
	m_tıbufãr
;

57 
	m_ackd–ay_ms
;

59 
boŞ
 
ut
(
Pack‘
 *);

60 
boŞ
 
İut
(
Pack‘
 *);

61 
£nd_ack
();

63 
	mpublic
:

64 
	$TCPAck
(è
CLICK_COLD
;

65 ~
	$TCPAck
(è
CLICK_COLD
;

67 cÚ¡ *
	$şass_Çme
() const {  "TCPAck"; }

68 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/3"; 
	}
}

69 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "¯/¯h"; 
	}
}

71 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

72 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

74 
	`push
(, 
Pack‘
 *);

75 
Pack‘
 *
	`puÎ
();

76 
	`run_tim”
(
Tim”
 *);

77 
	}
};

79 
	gCLICK_ENDDECLS


	@local/tcpbuffer.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şickÃt/.h
>

21 
	~<şickÃt/tı.h
>

22 
	~"tıbufãr.hh
"

23 
CLICK_DECLS


25 
	gTCPBufãr
::
	$TCPBufãr
()

26 : 
	$_chaš
(0)

28 
	}
}

30 
TCPBufãr
::~
	$TCPBufãr
()

32 
	}
}

35 
TCPBufãr
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 
	g_sk
 = 
çl£
;

38  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("SKIP", 
_sk
).
com¶‘e
();

43 
	gTCPBufãr
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

45 
_¡¬t_push
 = 
çl£
;

46 
_¡¬t_puÎ
 = 
çl£
;

48 
	}
}

51 
	gTCPBufãr
::
	$ş—nup
(
CËªupSge
)

53 
TCPBufãrEÉ
 *
–t
 = 
_chaš
;

54 
–t
) {

55 
TCPBufãrEÉ
 *
t
 = 
–t
;

56 
–t
 =ƒÉ->
	`Ãxt
();

57 
Pack‘
 *
p
 = 
t
->
	`kl_–t
();

58 
p
->
	`kl
();

60 
	`as£¹
(
_chaš
 == 0);

61 
	}
}

64 
	gTCPBufãr
::
	$push
(, 
Pack‘
 *
p
)

66 
¢
 = 
	`£qno
(
p
);

67 ià(!
_¡¬t_push
)

68 
_š™Ÿl_£q
 = 
¢
;

69 ià(
_¡¬t_puÎ
 && 
	`SEQ_LT
(
¢
,
_fœ¡_£q
)) {

70 
p
->
	`kl
();

73 
Ãw
 
	`TCPBufãrEÉ
(&
_chaš
, 
p
);

74 
	}
}

77 
	gTCPBufãr
::
	$dump
()

79 
	`şick_ch©‹r
("£q0 %u, seq %u", 
_š™Ÿl_£q
, 
_fœ¡_£q
);

80 
TCPBufãrEÉ
 *
–t
 = 
_chaš
;

81 
–t
) {

82 
Pack‘
 *
µ
 = 
–t
->
	`·ck‘
();

83 
	`şick_ch©‹r
("–ˆ%°(%p): %u", 
–t
, 
µ
, 
	`£qno
(pp));

84 
–t
 =ƒÉ->
	`Ãxt
();

86 
	}
}

88 
Pack‘
 *

89 
	gTCPBufãr
::
	$puÎ
()

91 ià(
_chaš
) {

92 
Pack‘
 *
p
 = 
_chaš
->
	`·ck‘
();

93 ià(!
_¡¬t_puÎ
 || 
_sk
 || 
	`£qno
(
p
)==
_fœ¡_£q
) {

94 
_chaš
->
	`kl_–t
();

95 
_fœ¡_£q
 = 
	`£qno
(
p
è+ 
	`£qËn
(p);

96 
_¡¬t_puÎ
 = 
Œue
;

97  
p
;

101 
	}
}

103 
CLICK_ENDDECLS


104 
EXPORT_ELEMENT
(
TCPBufãr
)

	@local/tcpbuffer.hh

1 #iâdeà
CLICK_TCPBUFFER_HH


2 
	#CLICK_TCPBUFFER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/tı.h
>

5 
CLICK_DECLS


39 şas 
	cTCPBufãr
 : 
public
 
EËm’t
 {

40 
´iv©e
:

41 cÚ¡ 
_ÿ·c™y
 = 128;

43 şas 
	cTCPBufãrEÉ
 {

44 
	m´iv©e
:

45 
Pack‘
 *
_·ck‘
;

46 
TCPBufãrEÉ
 **
	m_chaš_±r
;

47 
TCPBufãrEÉ
 *
	m_Ãxt
;

48 
TCPBufãrEÉ
 *
	m_´ev
;

50 
	mpublic
:

51 
TCPBufãrEÉ
(TCPBufãrEÉ **
chaš
, 
Pack‘
 *
p
);

53 
TCPBufãrEÉ
 *
Ãxt
(ècÚ¡ {  
	m_Ãxt
; }

54 
TCPBufãrEÉ
 *
´ev
(ècÚ¡ {  
	m_´ev
; }

55 
Pack‘
* 
·ck‘
(ècÚ¡ {  
	m_·ck‘
; }

57 
Pack‘
* 
kl_–t
();

60 
TCPBufãrEÉ
 *
	g_chaš
;

61 
	g_š™Ÿl_£q
;

62 
	g_fœ¡_£q
;

63 
boŞ
 
	g_¡¬t_push
;

64 
boŞ
 
	g_¡¬t_puÎ
;

66 
boŞ
 
	g_sk
;

67 
dump
();

69 
	gpublic
:

71 
	$TCPBufãr
(è
CLICK_COLD
;

72 ~
	$TCPBufãr
(è
CLICK_COLD
;

74 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "TCPBufãr"; 
	}
}

75 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

76 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH_TO_PULL
; 
	}
}

78 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

79 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

80 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

82 
	`push
(, 
Pack‘
 *);

83 
Pack‘
 *
	`puÎ
();

88 
boŞ
 
	`fœ¡_missšg_£q_no
(& 
£qno
);

93 
boŞ
 
	`Ãxt_missšg_£q_no
(
pos
, &
£qno
);

95 
	`£qËn
(
Pack‘
 *);

96 
	`£qno
(
Pack‘
 *);

97 
	}
};

99 
šlše


100 
	gTCPBufãr
::
TCPBufãrEÉ
::
	$TCPBufãrEÉ
(
TCPBufãrEÉ
 **
chaš_±r
, 
Pack‘
 *
p
)

102 
£qn
 = 
	`£qno
(
p
);

103 
_chaš_±r
 = 
chaš_±r
;

104 
_·ck‘
 = 
p
;

106 ià(*
chaš_±r
 == 0) {

107 *
chaš_±r
 = 
this
;

108 
_Ãxt
 = 0;

109 
_´ev
 = 0;

113 
TCPBufãrEÉ
 *
li¡
 = *
chaš_±r
;

114 
TCPBufãrEÉ
 *
Í»v
 = 0L;

116 
Pack‘
 *
µ
 = 
li¡
->
	`·ck‘
();

117 ià(
	`SEQ_LT
(
£qn
,
	`£qno
(
µ
))) {

119 
_Ãxt
 = 
li¡
;

120 
_´ev
 = 
li¡
->_prev;

121 
_Ãxt
->
_´ev
 = 
this
;

122 ià(
_´ev
)

123 
_´ev
->
_Ãxt
 = 
this
;

124 ià(
li¡
 =ğ*
chaš_±r
)

125 *
chaš_±r
 = 
this
;

128 ià(
£qn
 =ğ
	`£qno
(
µ
)) {

129 
p
->
	`kl
();

130 
d–‘e
 
this
;

133 
Í»v
 = 
li¡
;

134 
li¡
 =†i¡->
_Ãxt
;

135 } 
li¡
);

136 ià(!
li¡
) {

138 
_Ãxt
 = 0;

139 
_´ev
 = 
Í»v
;

140 
Í»v
->
_Ãxt
 = 
this
;

144 
	}
}

146 
šlše
 
Pack‘
 *

147 
	gTCPBufãr
::
TCPBufãrEÉ
::
	$kl_–t
()

149 
Pack‘
 *
p
 = 
_·ck‘
;

150 ià(
_chaš_±r
 && *_chaš_±¸=ğ
this
) {

152 ià(
_Ãxt
)

153 
_Ãxt
->
_´ev
 = 0;

154 *
_chaš_±r
 = 
_Ãxt
;

156 ià(
_´ev
 || 
_Ãxt
) {

157 ià(
_´ev
)

158 
_´ev
->
_Ãxt
 = _next;

159 ià(
_Ãxt
)

160 
_Ãxt
->
_´ev
 = _prev;

162 
_´ev
 = 0;

163 
_Ãxt
 = 0;

164 
_·ck‘
 = 0;

165 
d–‘e
 
this
;

166  
p
;

167 
	}
}

169 
šlše
 
boŞ


170 
	gTCPBufãr
::
	$fœ¡_missšg_£q_no
(& 
¢
)

172 ià(!
_chaš
 && !
_¡¬t_puÎ
)

173  
çl£
;

174 
ex³ù
 =

175 
_¡¬t_puÎ
 ? 
_fœ¡_£q
 : 
	`£qno
(
_chaš
->
	`·ck‘
());

176  
	`Ãxt_missšg_£q_no
(
ex³ù
, 
¢
);

177 
	}
}

179 
šlše
 
boŞ


180 
	gTCPBufãr
::
	$Ãxt_missšg_£q_no
(
pos
, & 
¢
)

182 
TCPBufãrEÉ
 *
–t
 = 
_chaš
;

183 
ex³ù
 = 
_fœ¡_£q
;

184 ià(
–t
) {

185 
Pack‘
 *
p
 = 
–t
->
	`·ck‘
();

186 
ex³ù
 = 
_¡¬t_puÎ
 ? 
_fœ¡_£q
 : 
	`£qno
(
p
);

187 
–t
) {

188 
Pack‘
 *
p
 = 
–t
->
	`·ck‘
();

189 ià(
	`£qno
(
p
è!ğ
ex³ù
) {

190 ià(
	`SEQ_GEQ
(
ex³ù
,
pos
)) {

191 
¢
 = 
ex³ù
;

192  
Œue
;

194 ià(
	`SEQ_GT
(
	`£qno
(
p
), 
pos
)) {

195 
¢
 = 
pos
;

196  
Œue
;

199 
ex³ù
 = 
	`£qno
(
p
è+ 
	`£qËn
(p);

200 
–t
 =ƒÉ->
	`Ãxt
();

203 ià(
_¡¬t_puÎ
 || 
_chaš
) {

204 ià(
	`SEQ_GEQ
(
ex³ù
,
pos
)) {

205 
¢
 = 
ex³ù
;

206  
Œue
;

209 
¢
 = 
pos
;

210  
Œue
;

213  
çl£
;

214 
	}
}

216 
šlše
 

217 
	gTCPBufãr
::
	$£qËn
(
Pack‘
 *
p
)

219 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

220 cÚ¡ 
şick_tı
 *
tıh
 =

221 
»š‹½»t_ÿ¡
<cÚ¡ 
şick_tı
 *>(
p
->
	`Œª¥Üt_h—d”
());

222 
£qËn
 = (
	`Áohs
(
h
->
_Ën
)-(h->
_hl
<<2)-(
tıh
->
th_off
<<2));

223 ià((
tıh
->
th_æags
&
TH_SYN
è|| (tıh->th_æags&
TH_FIN
)è
£qËn
++;

224  
£qËn
;

225 
	}
}

227 
šlše
 

228 
	gTCPBufãr
::
	$£qno
(
Pack‘
 *
p
)

230 cÚ¡ 
şick_tı
 *
tıh
 =

231 
»š‹½»t_ÿ¡
<cÚ¡ 
şick_tı
 *>(
p
->
	`Œª¥Üt_h—d”
());

232  
	`Áohl
(
tıh
->
th_£q
);

233 
	}
}

235 
	gCLICK_ENDDECLS


	@local/tcpconn.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şickÃt/.h
>

21 
	~<şickÃt/tı.h
>

22 
	~<şick/rou‹rvis™Ü.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~"tıdemux.hh
"

26 
	~"tıbufãr.hh
"

27 
	~"tıcÚn.hh
"

28 
CLICK_DECLS


30 
	gTCPCÚn
::
	$TCPCÚn
()

31 : 
	$_aùive
(
çl£
)

33 
	}
}

35 
TCPCÚn
::~
	$TCPCÚn
()

37 
	}
}

40 
TCPCÚn
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *)

46 
	gTCPCÚn
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

48 
EËm’tCa¡T¿ck”
 
	`f‹r
(
	`rou‹r
(), "TCPDemux");

49 ià(
	`rou‹r
()->
	`vis™_up¡»am
(
this
, 0, &
f‹r
) < 0)

50  
”rh
->
	`”rÜ
("flow-based„outer context failure");

51 ià(
f‹r
.
	`size
() < 1)

52  
”rh
->
	`”rÜ
("need‡t†east 1 upstream TCPDemux");

53 
_tıdemux
 = 
»š‹½»t_ÿ¡
<
TCPDemux
 *>(
f‹r
[0]->
	`ÿ¡
("TCPDemux"));

55 
	}
}

58 
	gTCPCÚn
::
	$ş—nup
(
CËªupSge
)

60 
	`»£t
();

61 
	}
}

64 
	gTCPCÚn
::
	$»£t
()

66 ià(
_aùive
) {

67 
_tıdemux
->
»move_æow


68 (
_æow
.
	`§ddr
(), _æow.
	`¥Üt
(), _æow.
	`daddr
(), _æow.
	`dpÜt
());

69 
_aùive
 = 
çl£
;

71 
	}
}

74 
	gTCPCÚn
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

76 
	`as£¹
(
pÜt
 == 0);

77 ià(
	`ut
(
p
))

78 
	`ouut
(0).
	`push
(
p
);

80 
p
->
	`kl
();

81 
	}
}

83 
Pack‘
*

84 
	gTCPCÚn
::
	$puÎ
(
pÜt
)

86 ià(!
_aùive
 || 
_li¡’
 || !
_e¡ablished
)

89 
	`as£¹
(
pÜt
 == 1);

90 
Pack‘
 *
p
 = 
	`šput
(1).
	`puÎ
();

91 ià(
p
)

92  
	`İut
(
p
);

94 
	}
}

96 
boŞ


97 
	gTCPCÚn
::
	$ut
(
Pack‘
 *
p
)

99 cÚ¡ 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

101 ià(
_li¡’
) {

102 ià(
tıh
->
th_æags
 & 
TH_SYN
) {

105  
çl£
;

108  
çl£
;

112 ià((
tıh
->
th_æags
&(
TH_SYN
|
TH_ACK
)) == (TH_SYN|TH_ACK)) {

113 
_e¡ablished
 = 
Œue
;

114 
_£q_nxt
++;

117  
Œue
;

119 
	}
}

121 
Pack‘
 *

122 
	gTCPCÚn
::
	$İut
(
Pack‘
 *
p
)

124 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
()) {

125 
şick_
 *
h
 = 
q
->
	`_h—d”
();

126 
şick_tı
 *
tıh
 = 
q
->
	`tı_h—d”
();

127 
§
 = 
_æow
.
	`§ddr
();

128 
da
 = 
_æow
.
	`daddr
();

129 
	`memmove
((*è&(
h
->
_¤c
), (*è&
§
, 4);

130 
	`memmove
((*è&(
h
->
_d¡
), (*è&
da
, 4);

131 
tıh
->
th_¥Üt
 = 
_æow
.
	`¥Üt
();

132 
tıh
->
th_dpÜt
 = 
_æow
.
	`dpÜt
();

133 
tıh
->
th_£q
 = 
	`Áohl
(
_£q_nxt
);

134 
_£q_nxt
 +ğ
TCPBufãr
::
	`£qËn
(
p
);

135  
q
;

138 
	}
}

140 
boŞ


141 
	gTCPCÚn
::
	$cÚÃù_hªdËr
(
IPFlowID
 
f
)

143 
	`as£¹
(!
_aùive
);

144 ià(
_tıdemux
->
	`add_æow
(
f
.
	`§ddr
(), f.
	`¥Üt
(), f.
	`daddr
(), f.
	`dpÜt
(), 0)) {

145 
_aùive
 = 
Œue
;

146 
_li¡’
 = 
çl£
;

147 
_e¡ablished
 = 
çl£
;

148 
_æow
 = 
f
;

149 
_£q_nxt
 = 
	`şick_¿ndom
();

150 
	`£nd_syn
();

151  
Œue
;

154  
çl£
;

155 
	}
}

157 
boŞ


158 
	gTCPCÚn
::
	$li¡’_hªdËr
(
IPFlowID
 
f
)

160 
	`as£¹
(!
_aùive
);

161 ià(
_tıdemux
->
	`add_æow
(
f
.
	`§ddr
(), f.
	`¥Üt
(), f.
	`daddr
(), f.
	`dpÜt
(), 0)) {

162 
_aùive
 = 
Œue
;

163 
_li¡’
 = 
Œue
;

164 
_e¡ablished
 = 
çl£
;

165 
_æow
 = 
f
;

166  
Œue
;

169  
çl£
;

170 
	}
}

173 
	gTCPCÚn
::
	$£nd_syn
()

175 
şick_
 *

;

176 
şick_tı
 *
tı
;

177 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((*

è+ (*
tı
));

178 ià(
q
 == 0) {

179 
	`şick_ch©‹r
("TCPConn: cannot make…acket");

182 
	`mem£t
(
q
->
	`d©a
(), '\0', q->
	`Ëngth
());

183 

 = (
şick_
 *è
q
->
	`d©a
();

184 
tı
 = (
şick_tı
 *è(

 + 1);

186 

->
_v
 = 4;

187 

->
_hl
 = 5;

188 

->
_tos
 = 0x10;

189 

->
_Ën
 = 
	`htÚs
(
q
->
	`Ëngth
());

190 

->
_id
 = 
	`htÚs
(0);

191 

->
_off
 = 
	`htÚs
(
IP_DF
);

192 

->
_‰l
 = 255;

193 

->
_p
 = 
IP_PROTO_TCP
;

194 

->
_sum
 = 0;

195 
§
 = 
_æow
.
	`§ddr
();

196 
da
 = 
_æow
.
	`daddr
();

197 
	`memmove
((*è&(

->
_¤c
), (*è&
§
, 4);

198 
	`memmove
((*è&(

->
_d¡
), (*è&
da
, 4);

200 
tı
->
th_¥Üt
 = 
_æow
.
	`¥Üt
();

201 
tı
->
th_dpÜt
 = 
_æow
.
	`dpÜt
();

202 
tı
->
th_£q
 = 
	`htÚl
(
_£q_nxt
);

203 
tı
->
th_ack
 = 0;

204 
tı
->
th_off
 = 5;

205 
tı
->
th_æags
 = 
TH_SYN
;

206 
tı
->
th_wš
 = 
	`htÚs
(32120);

207 
tı
->
th_sum
 = 
	`htÚs
(0);

208 
tı
->
th_u½
 = 
	`htÚs
(0);

210 
q
->
	`£t__h—d”
(

, ip->
_hl
 << 2);

211 
	`ouut
(2).
	`push
(
q
);

212 
	}
}

215 
	gTCPCÚn
::
	$add_hªdËrs
()

217 
	`add_wr™e_hªdËr
("ù¾", 
ù¾_wr™e_hªdËr
, 0);

218 
	`add_wr™e_hªdËr
("»£t", 
»£t_wr™e_hªdËr
, 0, 
HªdËr
::
BUTTON
);

219 
	}
}

222 
	gTCPCÚn
::
»£t_wr™e_hªdËr


223 (cÚ¡ 
SŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *)

225 (
	g»š‹½»t_ÿ¡
<
	gTCPCÚn
*>(
	ge
))->
»£t
();

230 
	gTCPCÚn
::
ù¾_wr™e_hªdËr


231 (cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

233 ià((
	g»š‹½»t_ÿ¡
<
	gTCPCÚn
*>(
	ge
))->
	g_aùive
)

234  
	g”rh
->
”rÜ
("TCPConn‡lready‡ctive");

236 
SŒšg
 
	gaùiÚ
;

237 
SŒšg
 
	g¡r_addr0
, 
	g¡r_addr1
;

238 
IPAdd»ss
 
	gaddr0
, 
	gaddr1
;

239 
ušt16_t
 
	gpÜt0
 = 0, 
	gpÜt1
 = 0;

241 ià(
Args
(
e
, 
”rh
).
push_back_wÜds
(
s
)

242 .
»ad_mp
("ACTION", 
aùiÚ
)

243 .
»ad_mp
("SRC", 
¡r_addr0
)

244 .
»ad_mp
("SPORT", 
IPPÜtArg
(
IP_PROTO_TCP
), 
pÜt0
)

245 .
»ad_p
("DST", 
¡r_addr1
)

246 .
»ad_p
("DPORT", 
IPPÜtArg
(
IP_PROTO_TCP
), 
pÜt1
)

247 .
com¶‘e
() < 0)

249 
	gaddr0
 = 
IPAdd»ss
(
¡r_addr0
);

250 
	gaddr1
 = 
IPAdd»ss
(
¡r_addr1
);

252 ià(
	gaùiÚ
 == "connect") {

253 ià(!(
»š‹½»t_ÿ¡
<
TCPCÚn
*>(
e
))->
cÚÃù_hªdËr


254 (
IPFlowID
(
addr0
,
htÚs
(
pÜt0
),
addr1
,htÚs(
pÜt1
))))

255  
”rh
->
”rÜ
("cannot connect");

256 } ià(
	gaùiÚ
 == "listen") {

257 ià(!(
»š‹½»t_ÿ¡
<
TCPCÚn
*>(
e
))->
li¡’_hªdËr


258 (
IPFlowID
(
addr0
,
htÚs
(
pÜt0
),0,0)))

259  
”rh
->
”rÜ
("cannot†isten");

261  
	g”rh
->
”rÜ
("action must be connect or†isten\n");

265 
CLICK_ENDDECLS


266 
EXPORT_ELEMENT
(
TCPCÚn
)

	@local/tcpconn.hh

1 #iâdeà
CLICK_TCPCONN_HH


2 
	#CLICK_TCPCONN_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tim”.hh
>

5 
	~<şickÃt/tı.h
>

6 
	~<şick/bighashm­.hh
>

7 
	~<şick/æowid.hh
>

8 
CLICK_DECLS


24 
şass
 
	gTCPDemux
;

26 şas 
	cTCPCÚn
 : 
public
 
EËm’t
 {

27 
´iv©e
:

28 
TCPDemux
 *
_tıdemux
;

30 
boŞ
 
	m_aùive
;

31 
boŞ
 
	m_li¡’
;

32 
boŞ
 
	m_e¡ablished
;

34 
	m_£q_nxt
;

35 
IPFlowID
 
	m_æow
;

37 
boŞ
 
cÚÃù_hªdËr
(
IPFlowID
 
f
);

38 
boŞ
 
li¡’_hªdËr
(
IPFlowID
 
f
);

39 
£nd_syn
();

41 
»£t
();

42 
boŞ
 
ut
(
Pack‘
 *
p
);

43 
Pack‘
 *
İut
(Pack‘ *
p
);

45 
	mpublic
:

46 
	$TCPCÚn
(è
CLICK_COLD
;

47 ~
	$TCPCÚn
(è
CLICK_COLD
;

49 cÚ¡ *
	$şass_Çme
() const {  "TCPConn"; }

50 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/3"; 
	}
}

51 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "hl/hlh"; 
	}
}

53 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

54 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

55 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

57 
	`push
(, 
Pack‘
 *);

58 
Pack‘
 *
	`puÎ
();

59 
	$add_hªdËrs
(è
CLICK_COLD
;

61 
ù¾_wr™e_hªdËr


62 (cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

63 
»£t_wr™e_hªdËr


64 (cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

65 
	}
};

67 
	gCLICK_ENDDECLS


	@local/tcpdemux.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şickÃt/.h
>

21 
	~<şickÃt/tı.h
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~"tıdemux.hh
"

25 
CLICK_DECLS


27 
	gTCPDemux
::
	$TCPDemux
()

29 
	}
}

31 
TCPDemux
::~
	$TCPDemux
()

33 
	}
}

36 
TCPDemux
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *)

43 
	gTCPDemux
::
	$fšd_æow
(
Pack‘
 *
p
)

45 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

46 cÚ¡ 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

49 
IPFlowID
 
	`fid
(
p
);

50 *
Œ
 = 
_æows
.
	`fšdp
(
fid
.
	`»v”£
());

51 ià(
Œ
)

52  *
Œ
;

55 
fid
 = 
	`IPFlowID
(0, 0, 
h
->
_d¡
, 
tıh
->
th_dpÜt
);

56 
Œ
 = 
_æows
.
	`fšdp
(
fid
.
	`»v”£
());

57 ià(
Œ
)

58  *
Œ
;

61 
fid
 = 
	`IPFlowID
(0, 0, 0, 
tıh
->
th_dpÜt
);

62 
Œ
 = 
_æows
.
	`fšdp
(
fid
.
	`»v”£
());

63 ià(
Œ
)

64  *
Œ
;

67 
fid
 = 
	`IPFlowID
(0, 0, 
h
->
_d¡
, 0);

68 
Œ
 = 
_æows
.
	`fšdp
(
fid
.
	`»v”£
());

69 ià(
Œ
)

70  *
Œ
;

73 
fid
 = 
	`IPFlowID
(0, 0, 0, 0);

74 
Œ
 = 
_æows
.
	`fšdp
(
fid
);

75 ià(
Œ
)

76  *
Œ
;

79 
	}
}

82 
	gTCPDemux
::
	$push
(, 
Pack‘
 *
p
)

84 
pÜt
 = 
	`fšd_æow
(
p
);

85 ià(
pÜt
 < 0 ||…Üˆ> 
	`nouuts
()) {

86 
	`şick_ch©‹r
("reject…acket from unknown flow");

87 
p
->
	`kl
();

90 
	`ouut
(
pÜt
).
	`push
(
p
);

91 
	}
}

93 
boŞ


94 
	gTCPDemux
::
	$add_æow
(
IPAdd»ss
 
§
, 
¥
,

95 
IPAdd»ss
 
da
, 
dp
, 
pÜt
)

97 ià(
_æows
.
	`fšdp
(
	`IPFlowID
(
§
, 
¥
, 
da
, 
dp
)))

98  
çl£
;

100  
_æows
.
	`š£¹
(
	`IPFlowID
(
§
, 
¥
, 
da
, 
dp
), 
pÜt
);

101 
	}
}

104 
boŞ


105 
	gTCPDemux
::
	$»move_æow
(
IPAdd»ss
 
§
, 
¥
,

106 
IPAdd»ss
 
da
, 
dp
)

108  
_æows
.
	`»move
(
	`IPFlowID
(
§
, 
¥
, 
da
, 
dp
));

109 
	}
}

111 
	$EXPORT_ELEMENT
(
TCPDemux
)

112 
CLICK_ENDDECLS


	@local/tcpdemux.hh

1 #iâdeà
CLICK_TCPDEMUX_HH


2 
	#CLICK_TCPDEMUX_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tim”.hh
>

5 
	~<şickÃt/tı.h
>

6 
	~<şick/bighashm­.hh
>

7 
	~<şick/æowid.hh
>

8 
CLICK_DECLS


24 
	gHashM­
<
	tIPFlowID
, > 
	tFlowTabË
;

26 şas 
	cTCPDemux
 : 
public
 
EËm’t
 {

27 
´iv©e
:

28 
FlowTabË
 
_æows
;

29 
fšd_æow
(
Pack‘
 *
p
);

31 
	mpublic
:

32 
	$TCPDemux
(è
CLICK_COLD
;

33 ~
	$TCPDemux
(è
CLICK_COLD
;

35 cÚ¡ *
	$şass_Çme
() const {  "TCPDemux"; }

36 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

37 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

39 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

41 
push
(, 
Pack‘
 *);

45 
boŞ
 
add_æow
(
IPAdd»ss
 
§
, 
¥
,

46 
IPAdd»ss
 
da
, 
dp
, 
pÜt
);

49 
boŞ
 
»move_æow
(
IPAdd»ss
 
§
, 
¥
,

50 
IPAdd»ss
 
da
, 
dp
);

53 
	gCLICK_ENDDECLS


	@local/tcpreflector.cc

18 
	~<şick/cÚfig.h
>

19 
	~"tı»æeùÜ.hh
"

20 
	~<şickÃt/tı.h
>

21 
	~<şickÃt/.h
>

22 
	~<şick/add»ss.hh
>

23 
	~<şick/glue.hh
>

24 
CLICK_DECLS


26 
	gTCPReæeùÜ
::
	$TCPReæeùÜ
()

28 
	}
}

30 
TCPReæeùÜ
::~
	$TCPReæeùÜ
()

32 
	}
}

34 
Pack‘
 *

35 
TCPReæeùÜ
::
	$tı_šput
(
Pack‘
 *
xp
)

37 
Wr™abËPack‘
 *
p
 = 
xp
->
	`uniqueify
();

38 
£q
, 
ack
, 
off
, 
hËn
;

39 
¶’
 = 
p
->
	`Ëngth
();

40 
š_addr
 
¤c
, 
d¡
;

41 
¥Üt
, 
dpÜt
;

42 
™mp
[9];

43 
dËn
;

44 
şick_
 *

;

45 
şick_tı
 *
th
;

47 if(
¶’
 < (
şick_
è+ (
şick_tı
))

48 
ignÜe
;

50 

 = (
şick_
 *è
p
->
	`d©a
();

51 
hËn
 = 

->
_hl
 << 2;

52 ià(
hËn
 < (
şick_
è|| hËÀ> 
¶’
)

53 
ignÜe
;

55 
th
 = (
şick_tı
 *è(((*)

è+ 
hËn
);

56 
off
 = 
th
->
th_off
 << 2;

57 
dËn
 = 
¶’
 - 
hËn
 - 
off
;

59 
¤c
 = 

->
_¤c
;

60 
d¡
 = 

->
_d¡
;

61 
¥Üt
 = 
th
->
th_¥Üt
;

62 
dpÜt
 = 
th
->
th_dpÜt
;

63 
£q
 = 
	`Áohl
(
th
->
th_£q
);

64 
ack
 = 
	`Áohl
(
th
->
th_ack
);

66 
th
->
th_æags
 &ğ~
TH_PUSH
;

68 if(
th
->
th_æags
 =ğ
TH_SYN
){

69 
th
->
th_æags
 = 
TH_SYN
 | 
TH_ACK
;

70 
th
->
th_£q
 = 
	`şick_¿ndom
(0, 0xFFFFFFFFU);

71 
th
->
th_ack
 = 
	`htÚl
(
£q
 + 1);

72 } if(
th
->
th_æags
 & 
TH_SYN
){

73 
ignÜe
;

74 } if(
th
->
th_æags
 & 
TH_RST
){

75 
ignÜe
;

76 } if(
dËn
 > 0 || (
th
->
th_æags
 & 
TH_FIN
)){

77 
th
->
th_£q
 = 
	`htÚl
(
ack
);

78 if(
th
->
th_æags
 & 
TH_FIN
){

79 
th
->
th_æags
 = 
TH_ACK
 | 
TH_FIN
;

80 
th
->
th_ack
 = 
	`htÚl
(
£q
 + 
dËn
 + 1);

82 
th
->
th_æags
 = 
TH_ACK
;

83 
th
->
th_ack
 = 
	`htÚl
(
£q
 + 
dËn
);

86 
ignÜe
;

89 

->
_¤c
 = 
d¡
;

90 

->
_d¡
 = 
¤c
;

91 

->
_‰l
 = 250;

92 
p
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(

->
_d¡
));

94 
th
->
th_¥Üt
 = 
dpÜt
;

95 
th
->
th_dpÜt
 = 
¥Üt
;

96 
th
->
th_wš
 = 
	`htÚs
(60 * 1024);

98 
	`memıy
(
™mp
, 

, 9);

99 
	`mem£t
(

, '\0', 9);

100 

->
_sum
 = 0;

101 

->
_Ën
 = 
	`htÚs
(
¶’
 - 20);

103 
th
->
th_sum
 = 0;

104 
th
->
th_sum
 = 
	`şick_š_cksum
((*)

, 
¶’
);

106 
	`memıy
(

, 
™mp
, 9);

107 

->
_Ën
 = 
	`htÚs
(
¶’
);

109 

->
_sum
 = 0;

110 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

112 (
p
);

114 
ignÜe
:

115 if(
p
)

116 
p
->
	`kl
();

118 
	}
}

120 
Pack‘
 *

121 
	gTCPReæeùÜ
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

123 (
	`tı_šput
(
p
));

124 
	}
}

126 
CLICK_ENDDECLS


127 
EXPORT_ELEMENT
(
TCPReæeùÜ
)

	@local/tcpreflector.hh

1 #iâdeà
CLICK_TCPREFLECTOR_HH


2 
	#CLICK_TCPREFLECTOR_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/tim”.hh
>

6 
	~<şick/add»ss.hh
>

7 
CLICK_DECLS


30 şas 
	cTCPReæeùÜ
 : 
public
 
EËm’t
 {

31 
public
:

33 
	$TCPReæeùÜ
(è
CLICK_COLD
;

34 ~
	$TCPReæeùÜ
(è
CLICK_COLD
;

36 cÚ¡ *
	$şass_Çme
() const {  "TCPReflector"; }

37 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

39 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

40 
Pack‘
 *
tı_šput
(Pack‘ *
xp
);

43 
	gCLICK_ENDDECLS


	@local/toytcp.cc

18 
	~<şick/cÚfig.h
>

19 
	~"toytı.hh
"

20 
	~<şickÃt/tı.h
>

21 
	~<şickÃt/.h
>

22 
	~<şick/add»ss.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/glue.hh
>

26 
CLICK_DECLS


28 
	gToyTCP
::
	$ToyTCP
()

29 : 
	$_tim”
(
this
)

32 
_dpÜt
 = 0;

34 
_šgood
 = 0;

35 
_šbad
 = 0;

36 
_out
 = 0;

38 
	`»¡¬t
();

39 
	}
}

42 
	gToyTCP
::
	$»¡¬t
()

44 
Time¡amp
 
tv
 = Time¡amp::
	`now
();

46 
_iss
 = 
tv
.
	`£c
() & 0x0fffffff;

47 
_œs
 = 0;

48 
_¢d_nxt
 = 
_iss
;

49 
_¥Üt
 = 
	`htÚs
(1024 + (
tv
.
	`u£c
() % 60000));

50 
_¡©e
 = 0;

51 
_grow
 = 0;

52 
_wc
 = 0;

53 
_»£t
 = 0;

54 
	}
}

56 
	gToyTCP
::~
	$ToyTCP
()

58 
	}
}

61 
ToyTCP
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

63 
ušt16_t
 
	gdpÜt
;

64 
	g»t
;

66 
	g»t
 = 
Args
(
cÚf
, 
this
, 
”rh
)

67 .
»ad_mp
("DPORT", 
IPPÜtArg
(
IP_PROTO_TCP
), 
dpÜt
)

68 .
com¶‘e
();

69 if(
	g»t
 < 0)

70 (
	g»t
);

72 
	g_dpÜt
 = 
htÚs
(
dpÜt
);

78 
	gToyTCP
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

80 
_tim”
.
	`š™Ÿlize
(
this
);

81 
_tim”
.
	`scheduË_aá”_m£c
(1000);

83 
	}
}

86 
	gToyTCP
::
	$run_tim”
(
Tim”
 *)

88 if(
_»£t
)

89 
	`»¡¬t
();

90 
	`tı_ouut
(0);

91 
_tim”
.
	`scheduË_aá”_m£c
(1000);

92 
	`şick_ch©‹r
("ToyTCP: %d good in, %d bad in, %d out",

93 
_šgood
, 
_šbad
, 
_out
);

94 
	}
}

97 
	gToyTCP
::
	$tı_šput
(
Pack‘
 *
p
)

99 
şick_tı
 *
th
 = (şick_tı *è
p
->
	`d©a
();

100 
£q
, 
ack
;

102 if(
p
->
	`Ëngth
(è< (*
th
))

104 if(
th
->
th_¥Üt
 !ğ
_dpÜt
 ||h->
th_dpÜt
 !ğ
_¥Üt
)

106 
£q
 = 
	`Áohl
(
th
->
th_£q
);

107 
ack
 = 
	`Áohl
(
th
->
th_ack
);

109 if((
th
->
th_æags
 & (
TH_ACK
|
TH_RST
)) == TH_ACK &&

110 
ack
 =ğ
_iss
 + 1 &&

111 
_¡©e
 == 0){

112 
_¢d_nxt
 = 
_iss
 + 1;

113 
_œs
 = 
£q
;

114 
_rcv_nxt
 = 
_œs
 + 1;

115 
_¡©e
 = 1;

116 
	`şick_ch©‹r
("ToyTCP connected");

119 if(
th
->
th_æags
 & 
TH_RST
){

120 
	`şick_ch©‹r
("ToyTCP: RST from…ort %d, in %d, out %d",

121 
	`Áohs
(
th
->
th_¥Üt
),

122 
_šgood
, 
_out
);

123 
_šbad
++;

124 
_»£t
 = 1;

126 
_šgood
++;

128 
	}
}

130 
Pack‘
 *

131 
	gToyTCP
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

133 if(
_»£t
){

134 
p
->
	`kl
();

136 
	`tı_šput
(
p
);

137 
	`tı_ouut
(
p
);

138 if(
_grow
++ > 4){

139 
	`tı_ouut
(0);

140 
_grow
 = 0;

144 
	}
}

149 
	gToyTCP
::
	$tı_ouut
(
Pack‘
 *
xp
)

151 
·yËn
 = 
_¡©e
 ? 1 : 0;

152 
¶’
 = (
şick_tı
è+ 
·yËn
;

153 
h—droom
 = 34;

154 
Wr™abËPack‘
 *
p
 = 0;

156 if(
xp
 == 0 ||

157 
xp
->
	`sh¬ed
() ||

158 
xp
->
	`h—droom
(è< 
h—droom
 ||

159 
xp
->
	`Ëngth
(è+ xp->
	`room
(è< 
¶’
){

160 if(
xp
){

161 
	`şick_ch©‹r
("could‚ot„e-use %d %d %d",

162 
xp
->
	`h—droom
(), xp->
	`Ëngth
(), xp->
	`room
());

163 
xp
->
	`kl
();

165 
p
 = 
Pack‘
::
	`make
(
h—droom
, (cÚ¡ *)0, 
¶’
, 0);

167 
p
 = 
xp
->
	`uniqueify
();

168 ià(
p
->
	`Ëngth
(è> 
¶’
)

169 
p
->
	`ke
Õ->
	`Ëngth
(è- 
¶’
);

170 ià(
p
->
	`Ëngth
(è< 
¶’
)

171 ià(!(
p
 =…->
	`put
(
¶’
 -…->
	`Ëngth
())))

175 
şick_tı
 *
th
 = (şick_tı *è
p
->
	`d©a
();

177 
	`mem£t
(
th
, '\0', (*th));

179 
th
->
th_¥Üt
 = 
_¥Üt
;

180 
th
->
th_dpÜt
 = 
_dpÜt
;

181 if(
_¡©e
){

182 
th
->
th_£q
 = 
	`htÚl
(
_¢d_nxt
 + 1 + (
_out
 & 0xfff));

184 
th
->
th_£q
 = 
	`htÚl
(
_¢d_nxt
);

186 
th
->
th_off
 = (
şick_tı
) >> 2;

187 if(
_¡©e
 == 0){

188 
th
->
th_æags
 = 
TH_SYN
;

190 
th
->
th_æags
 = 
TH_ACK
;

191 
th
->
th_ack
 = 
	`htÚl
(
_rcv_nxt
);

194 if(
_wc
++ > 2){

195 
_wc
 = 0;

196 
th
->
th_wš
 = 
	`htÚs
(30*1024);

198 
th
->
th_wš
 = 
	`htÚs
(60*1024);

201 
	`ouut
(0).
	`push
(
p
);

203 
_out
++;

204 
	}
}

206 
CLICK_ENDDECLS


207 
EXPORT_ELEMENT
(
ToyTCP
)

	@local/toytcp.hh

1 #iâdeà
CLICK_TOYTCP_HH


2 
	#CLICK_TOYTCP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/tim”.hh
>

6 
	~<şick/add»ss.hh
>

7 
CLICK_DECLS


24 şas 
	cToyTCP
 : 
public
 
EËm’t
 {

25 
public
:

27 
	$ToyTCP
(è
CLICK_COLD
;

28 ~
	$ToyTCP
(è
CLICK_COLD
;

30 cÚ¡ *
	$şass_Çme
() const {  "ToyTCP"; }

31 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

32 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

33 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

34 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

36 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

37 
	`run_tim”
(
Tim”
 *);

39 
´iv©e
:

40 
Tim”
 
_tim”
;

42 
_¥Üt
;

43 
_dpÜt
;

45 
_iss
;

46 
_¢d_nxt
;

47 
_œs
;

48 
_rcv_nxt
;

50 
_¡©e
;

51 
_grow
;

52 
_wc
;

53 
_»£t
;

55 
_šgood
;

56 
_šbad
;

57 
_out
;

59 
	`tı_ouut
(
Pack‘
 *);

60 
	`tı_šput
(
Pack‘
 *);

61 
	`»¡¬t
();

62 
	}
};

64 
	gCLICK_ENDDECLS


	@local/webgen.cc

18 
	~<şick/cÚfig.h
>

19 
	~"webg’.hh
"

20 
	~<şickÃt/tı.h
>

21 
	~<şickÃt/.h
>

22 
	~<şick/add»ss.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/glue.hh
>

26 
CLICK_DECLS


29 
	$time¡amp_diff
(cÚ¡ 
Time¡amp
 &
t1
, cÚ¡ Time¡am°&
t2
)

31  (
t1
.
	`£c
(è- 
t2
.£c()è* 1000000 + (t1.
	`u£c
() -2.usec());

32 
	}
}

34 
	gWebG’
::
	$WebG’
()

35 : 
	$_tim”
(
this
)

38 
cbä“
 = 
NULL
;

39 
»xm™_h—d
 = 
NULL
;

40 
»xm™_
 = 
NULL
;

42 
	`mem£t
 (
cbhash
, 0,  (cbhash));

43 
	`mem£t
 (&
³rfút
, 0,  (perfcnt));

44 
	}
}

46 
	gWebG’
::~
	$WebG’
()

48 
	}
}

51 
WebG’
::
cÚfigu»
 (
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

53 
	g»t
;

54 
	gıs
;

56 
	g»t
 = 
Args
(
cÚf
, 
this
, 
”rh
)

57 .
»ad_mp
("PREFIX", 
IPP»fixArg
(
Œue
), 
_¤c_´efix
, 
_mask
)

58 .
»ad_mp
("DST", 
_d¡
)

59 .
»ad_mp
("RATE", 
ıs
)

60 .
com¶‘e
();

62 
	g¡¬t_š‹rv®
 = 1000000 / 
ıs
;

63  
	g»t
;

66 
IPAdd»ss


67 
	gWebG’
::
	$pick_¤c
 ()

69 
ušt32_t
 
x
;

70 
ušt32_t
 
mask
 = (ušt32_tè
_mask
;

72 
x
 = (
	`şick_¿ndom
(è& ~
mask
è| ((
ušt32_t
è
_¤c_´efix
 & mask);

74  
	`IPAdd»ss
 (
x
);

75 
	}
}

78 
	gWebG’
::
	$cÚnhash
 (
¤c
, 
¥Üt
)

80  (
¤c
 ^ 
¥Üt
è& 
htmask
;

81 
	}
}

84 
	gWebG’
::
	$š™Ÿlize
 (
E¼ÜHªdËr
 *)

86 
_tim”
.
	`š™Ÿlize
 (
this
);

87 
_tim”
.
	`scheduË_now
 ();

89 
ncbs
 = 2 * (
»£nd_dt
 / 
¡¬t_š‹rv®
è* 
»£nd_max
;

90 
i
 = 0; i < 
ncbs
; i++) {

91 
CB
 *
cb
 = 
Ãw
 CB;

92 ià(!
cb
) {

93 
	`şick_ch©‹r
 ("Notƒnough memory for CBs\n");

94  
ENOMEM
;

96 
cb
->
	`add_to_li¡
 (&
cbä“
);

98 
	`şick_ch©‹r
 ("AÎoÿ‹d %d CBs\n", 
ncbs
);

100 
Time¡amp
 
now
 = Time¡amp::
	`now
();

101 
³rf_tv
 = 
now
;

102 
¡¬t_tv
 = 
now
;

104 
»xm™_h—d
 = 
Ãw
 
CB
;

105 
»xm™_
 = 
Ãw
 
CB
;

106 ià(!
»xm™_h—d
 || !
»xm™_
) {

107 
	`şick_ch©‹r
 ("Notƒnough memory for dummyƒlements\n");

108  
ENOMEM
;

110 
»xm™_h—d
->
»xm™_Ãxt
 = 
»xm™_
;

111 
»xm™_h—d
->
»xm™_´ev
 = 
NULL
;

112 
»xm™_
->
»xm™_Ãxt
 = 
NULL
;

113 
»xm™_
->
»xm™_´ev
 = 
»xm™_h—d
;

116 
	}
}

119 
	gWebG’
::
	$ş—nup
 (
CËªupSge
 
¡age
)

121 
i
 = 0;

122 
CB
 *
c
 = 
cbä“
;

125 
c
) {

126 
CB
 *
tc
 = 
c
;

127 
c
 = 
tc
->
Ãxt
;

128 
d–‘e
 
tc
;

131 
c
 = 
cbhash
[
i
++];

132 } 
i
 <ğ
htsize
);

134 
d–‘e
 
»xm™_h—d
;

135 
d–‘e
 
»xm™_
;

137 ià(
¡age
 >ğ
CLEANUP_INITIALIZED
)

138 
	`do_³rf_¡©s
 ();

139 
	}
}

142 
	gWebG’
::
	$»cyşe
 (
CB
 *
cb
)

144 
cb
->
	`»xm™_uÆšk
 ();

145 
cb
->
	`»move_äom_li¡
 ();

146 
cb
->
	`add_to_li¡
 (&
cbä“
);

147 
	}
}

150 
	gWebG’
::
	$do_³rf_¡©s
 ()

152 
Time¡amp
 
now
 = Time¡amp::
	`now
();

161 
	`şick_ch©‹r
 ("init: %d comp: %5dmo: %5d„st: %5d\n",

162 
³rfút
.
š™Ÿ‹d
,…”fút.
com¶‘ed
,

163 
³rfút
.
timeout
,…”fút.
»£t
);

164 
³rf_tv
 = 
now
;

165 
	`mem£t
 (&
³rfút
, 0,  (perfcnt));

166 
	}
}

169 
	gWebG’
::
	$run_tim”
 (
Tim”
 *)

171 
CB
 *
cb
;

172 
Time¡amp
 
now
 = Time¡amp::
	`now
();

174 
	`time¡amp_diff
(
now
, 
¡¬t_tv
è> 
¡¬t_š‹rv®
) {

175 
¡¬t_tv
 +ğ
Time¡amp
::
	`make_u£c
(
¡¬t_š‹rv®
);

176 
cb
 = 
cbä“
;

178 ià(
cb
) {

179 
cb
->
	`»move_äom_li¡
 ();

180 
cb
->
	`»£t
 (
	`pick_¤c
 ());

182 
hv
 = 
	`cÚnhash
 (
cb
->
_¤c
, cb->
_¥Üt
);

183 
cb
->
	`add_to_li¡
 (&
cbhash
[
hv
]);

184 
	`tı_£nd
(
cb
, 0);

185 
³rfút
.
š™Ÿ‹d
++;

187 
	`şick_ch©‹r
 ("out of‡vailable CBs\n");

191 
CB
 *
Ìxcb
 = 
»xm™_
->
»xm™_´ev
;

193 
cb
 = 
»xm™_h—d
->
»xm™_Ãxt
;

195 ià(
cb
 =ğ
»xm™_
)

198 ià(
	`time¡amp_diff
(
now
, 
cb
->
Ï¡_£nd
è> 
»£nd_dt
) {

199 ià(
cb
->
_»£nds
++ > 
»£nd_max
) {

200 
³rfút
.
timeout
++;

201 
	`»cyşe
 (
cb
);

203 
	`tı_£nd
 (
cb
, 0);

208 } 
cb
 !ğ
Ìxcb
);

210 ià(
	`time¡amp_diff
(
now
, 
³rf_tv
è> 
³rf_dt
)

211 
	`do_³rf_¡©s
 ();

213 
_tim”
.
	`scheduË_aá”_m£c
(1);

214 
	}
}

216 
	gWebG’
::
CB
 *

217 
WebG’
::
	$fšd_cb
 (
¤c
, 
¥Üt
, 
dpÜt
)

219 
hv
 = 
	`cÚnhash
 (
¤c
, 
¥Üt
);

220 
CB
 *
cb
 = 
cbhash
[
hv
];

222 
cb
) {

223 ià(
¥Üt
 =ğ
cb
->
_¥Üt
 &&

224 
dpÜt
 =ğ
cb
->
_dpÜt
 &&

225 
¤c
 =ğ(
ušt32_t
è
cb
->
_¤c
)

226  
cb
;

227 
cb
 = cb->
Ãxt
;

229  
NULL
;

230 
	}
}

232 
Pack‘
 *

233 
	gWebG’
::
	$sim¶e_aùiÚ
 (
Pack‘
 *
p
)

235 
	`tı_šput
 (
p
);

236  
NULL
;

237 
	}
}

240 
	gWebG’
::
	$tı_šput
 (
Pack‘
 *
p
)

242 
£q
, 
ack
;

243 
¶’
 = 
p
->
	`Ëngth
 ();

245 ià(
¶’
 < (
şick_
è+ (
şick_tı
))

248 
şick_
 *

 = (şick_ *è
p
->
	`d©a
();

249 
Ën
 = 
	`Áohs
(

->
_Ën
);

250 
hËn
 = 

->
_hl
 << 2;

251 ià(
hËn
 < (
şick_
è|| hËÀ> 
Ën
 || i¶’ > 
¶’
) {

252 
p
->
	`kl
();

256 
şick_tı
 *
th
 = (şick_tı *è(((*)

è+ 
hËn
);

257 
off
 = 
th
->
th_off
 << 2;

258 
dËn
 = 
Ën
 - 
hËn
 - 
off
;

260 
CB
 *
cb
 = 
	`fšd_cb
(

->
_d¡
.
s_addr
, 
th
->
th_dpÜt
,h->
th_¥Üt
);

261 ià(
cb
 == 0) {

262 
¶’
 =  (
şick_
è+  (
şick_tı
);

264 
Wr™abËPack‘
 *
wp
 = 
	`fixup_·ck‘
 (
p
, 
¶’
);

265 
	`tı_ouut
 (
wp
,

266 

->
_d¡
, 
th
->
th_dpÜt
,

267 

->
_¤c
, 
th
->
th_¥Üt
,

268 
th
->
th_ack
,h->
th_£q
, 
TH_RST
,

269 
NULL
, 0);

273 
£q
 = 
	`Áohl
(
th
->
th_£q
);

274 
ack
 = 
	`Áohl
(
th
->
th_ack
);

276 ià((
th
->
th_æags
 & (
TH_ACK
|
TH_RST
)) == TH_ACK &&

277 
ack
 =ğ
cb
->
_iss
 + 1 &&

278 
cb
->
_cÚÃùed
 == 0) {

279 
cb
->
_¢d_nxt
 = cb->
_iss
 + 1;

280 
cb
->
_¢d_uÇ
 = cb->
_¢d_nxt
;

281 
cb
->
_œs
 = 
£q
;

282 
cb
->
_rcv_nxt
 = cb->
_œs
 + 1;

283 
cb
->
_cÚÃùed
 = 1;

284 
cb
->
_do_£nd
 = 1;

288 } ià(
dËn
 > 0) {

289 
cb
->
_do_£nd
 = 1;

290 ià(
£q
 + 
dËn
 > 
cb
->
_rcv_nxt
) {

292 
cb
->
_rcv_nxt
 = 
£q
 + 
dËn
;

296 ià(
th
->
th_æags
 & 
TH_ACK
) {

297 ià(
ack
 > 
cb
->
_¢d_uÇ
) {

298 
cb
->
_¢d_uÇ
 = 
ack
;

302 ià((
th
->
th_æags
 & 
TH_FIN
) &&

303 
£q
 + 
dËn
 =ğ
cb
->
_rcv_nxt
 &&

304 
cb
->
_gÙ_fš
 == 0) {

305 
cb
->
_gÙ_fš
 = 1;

306 
cb
->
_rcv_nxt
 += 1;

307 
cb
->
_do_£nd
 = 1;

310 ià(
th
->
th_æags
 & 
TH_RST
) {

312 
p
->
	`kl
 ();

313 
	`»cyşe
 (
cb
);

314 
³rfút
.
»£t
++;

318 
	`tı_£nd
 (
cb
, 
p
);

320 ià(
cb
->
_şo£d
)

321 
	`»cyşe
 (
cb
);

322 
	}
}

324 
Wr™abËPack‘
 *

325 
	gWebG’
::
	$fixup_·ck‘
 (
Pack‘
 *
xp
, 
¶’
)

327 
h—droom
 = 34;

328 
Wr™abËPack‘
 *
p
;

330 ià(
xp
 == 0 ||

331 
xp
->
	`sh¬ed
 () ||

332 
xp
->
	`h—droom
 (è< 
h—droom
 ||

333 
xp
->
	`Ëngth
 (è+ xp->
	`room
(è< 
¶’
) {

334 ià(
xp
)

335 
xp
->
	`kl
 ();

336 
p
 = 
Pack‘
::
	`make
 (
h—droom
, 
NULL
, 
¶’
, 0);

338 
p
 = 
xp
->
	`uniqueify
 ();

339 ià(
p
->
	`Ëngth
 (è< 
¶’
)

340 
p
 =…->
	`put
 (
¶’
 -…->
	`Ëngth
 ());

341 ià(
p
->
	`Ëngth
 (è> 
¶’
)

342 
p
->
	`ke
 (p->
	`Ëngth
 (è- 
¶’
);

345  
p
;

346 
	}
}

351 
	gWebG’
::
	$tı_£nd
 (
CB
 *
cb
, 
Pack‘
 *
xp
)

353 
·yËn
;

354 
¶’
;

355 
£q
;

356 
Wr™abËPack‘
 *
p
 = 0;

360 ià(
cb
->
_cÚÃùed
 && cb->
_¢d_uÇ
 - cb->
_iss
 - 1 < cb->
¢dËn
) {

361 
·yËn
 = 
cb
->
¢dËn
;

362 
£q
 = 
cb
->
_iss
 + 1;

363 
cb
->
_¢d_nxt
 = 
£q
 + 
·yËn
;

365 
·yËn
 = 0;

366 
£q
 = 
cb
->
_¢d_nxt
 + cb->
_£Á_fš
;

368 
¶’
 = (
şick_
è+ (
şick_tı
è+ 
·yËn
;

370 
cb
->
	`»xm™_upd©e
 (
»xm™_
);

372 ià(
cb
->
_cÚÃùed
 =ğ1 && cb->
_do_£nd
 =ğ0 && 
·yËn
 == 0) {

373 ià(
xp
)

374 
xp
->
	`kl
 ();

377 
cb
->
_do_£nd
 = 0;

379 
p
 = 
	`fixup_·ck‘
 (
xp
, 
¶’
);

381 
æags
 = 0;

382 
ack
 = 0;

384 ià(
cb
->
_cÚÃùed
 == 0) {

385 
æags
 = 
TH_SYN
;

387 
æags
 = 
TH_ACK
;

388 ià(
·yËn
)

389 
æags
 |ğ
TH_PUSH
 | 
TH_FIN
;

390 ià(
cb
->
_gÙ_fš
)

391 
æags
 |ğ
TH_FIN
;

392 
ack
 = 
cb
->
_rcv_nxt
;

395 ià(
æags
 & 
TH_FIN
)

396 
cb
->
_£Á_fš
 = 1;

398 ià(
cb
->
_£Á_fš
 && cb->
_gÙ_fš
) {

400 
cb
->
_şo£d
 = 1;

401 
³rfút
.
com¶‘ed
++;

404 
	`tı_ouut
 (
p
, 
cb
->
_¤c
, cb->
_¥Üt
, 
_d¡
, cb->
_dpÜt
,

405 
	`htÚl
 (
£q
), htÚÈ(
ack
), 
æags
,

406 
cb
->
¢dbuf
, 
·yËn
);

407 
	}
}

410 
	gWebG’
::
	$tı_ouut
 (
Wr™abËPack‘
 *
p
,

411 
IPAdd»ss
 
¤c
, 
¥Üt
,

412 
IPAdd»ss
 
d¡
, 
dpÜt
,

413 
£q
, 
ack
, 
tıæags
,

414 *
·ylßd
, 
·yËn
)

416 
¶’
 = 
p
->
	`Ëngth
 ();

418 
şick_
 *

 = (şick_ *è
p
->
	`d©a
 ();

419 

->
_v
 = 4;

420 

->
_hl
 =  (
şick_
) >> 2;

421 

->
_id
 = 
	`htÚs
 (
_id
.
	`ãtch_ªd_add
 (1));

422 

->
_p
 = 6;

423 

->
_¤c
 = 
¤c
;

424 

->
_d¡
 = 
d¡
;

425 

->
_tos
 = 0;

426 

->
_off
 = 0;

427 

->
_‰l
 = 250;

428 
p
->
	`£t_d¡__ªno
 (
	`IPAdd»ss
 (

->
_d¡
));

429 
p
->
	`£t__h—d”
 (

,  (
şick_
));

431 
şick_tı
 *
th
 = (şick_tı *è(

 + 1);

433 
	`mem£t
 (
th
, '\0', (*th));

435 ià(
·yËn
 > 0)

436 
	`memıy
 (
th
 + 1, 
·ylßd
, 
·yËn
);

438 
th
->
th_¥Üt
 = 
¥Üt
;

439 
th
->
th_dpÜt
 = 
dpÜt
;

440 
th
->
th_£q
 = 
£q
;

441 
th
->
th_ack
 = 
ack
;

442 
th
->
th_off
 =  (
şick_tı
) >> 2;

443 
th
->
th_æags
 = 
tıæags
;

444 
th
->
th_wš
 = 
	`htÚs
 (60*1024);

446 
™mp
[9];

447 
	`memıy
 (
™mp
, 

, 9);

448 
	`mem£t
 (

, '\0', 9);

449 

->
_sum
 = 0;

450 

->
_Ën
 = 
	`htÚs
 (
¶’
 - 20);

452 
th
->
th_sum
 = 0;

453 
th
->
th_sum
 = 
	`şick_š_cksum
 ((*è

, 
¶’
);

455 
	`memıy
 (

, 
™mp
, 9);

456 

->
_Ën
 = 
	`htÚs
 (
¶’
);

458 

->
_sum
 = 0;

459 

->
_sum
 = 
	`şick_š_cksum
 ((*è,  (
şick_
));

461 
	`ouut
 (0).
	`push
 (
p
);

462 
	}
}

464 
	gWebG’
::
CB
::
	$CB
 ()

466 
Ãxt
 = 
NULL
;

467 
µ»v
 = 
NULL
;

469 
»xm™_Ãxt
 = 
NULL
;

470 
»xm™_´ev
 = 
NULL
;

472 
Ï¡_£nd
.
	`assign_now
();

473 
	}
}

476 
	gWebG’
::
CB
::
	$»£t
 (
IPAdd»ss
 
¤c
)

478 
_¤c
 = 
¤c
;

479 
_dpÜt
 = 
	`htÚs
 (80);

480 
_iss
 = 
	`şick_¿ndom
() & 0x0fffffff;

481 
_œs
 = 0;

482 
_¢d_nxt
 = 
_iss
;

483 
_¢d_uÇ
 = 
_iss
;

484 
_¥Üt
 = 
	`htÚs
 (1024 + (
	`şick_¿ndom
() % 60000));

485 
_do_£nd
 = 0;

486 
_cÚÃùed
 = 0;

487 
_gÙ_fš
 = 0;

488 
_£Á_fš
 = 0;

489 
_şo£d
 = 0;

490 
_»£nds
 = 0;

492 
dœ
 = 
	`şick_¿ndom
(0, 9);

493 
fe
 = 
	`şick_¿ndom
(0, 8);

494 
c
 = 
	`şick_¿ndom
(0, 2);

495 
	`¥rštf
 (
¢dbuf
, "GET /spec/%d/%d-%d-%d HTTP/1.0\r\n\r\n",

496 
dœ
, dœ, 
c
, 
fe
);

497 
¢dËn
 = 
	`¡¾’
 (
¢dbuf
);

498 
	}
}

501 
	gWebG’
::
CB
::
	$»move_äom_li¡
 ()

503 ià(
Ãxt
)

504 
Ãxt
->
µ»v
 =…prev;

505 ià(
µ»v
)

506 *
µ»v
 = 
Ãxt
;

508 
Ãxt
 = 
NULL
;

509 
µ»v
 = 
NULL
;

510 
	}
}

513 
	gWebG’
::
CB
::
	$add_to_li¡
 (
CB
 **
ph—d
)

515 
	`as£¹
 (!
Ãxt
 && !
µ»v
);

517 
Ãxt
 = *
ph—d
;

518 ià(
Ãxt
)

519 
Ãxt
->
µ»v
 = &next;

521 
µ»v
 = 
ph—d
;

522 *
ph—d
 = 
this
;

523 
	}
}

526 
	gWebG’
::
CB
::
	$»xm™_uÆšk
 ()

528 ià(
»xm™_Ãxt
)

529 
»xm™_Ãxt
->
»xm™_´ev
 =„exmit_prev;

530 ià(
»xm™_´ev
)

531 
»xm™_´ev
->
»xm™_Ãxt
 =„exmit_next;

533 
»xm™_Ãxt
 = 
NULL
;

534 
»xm™_´ev
 = 
NULL
;

535 
	}
}

538 
	gWebG’
::
CB
::
	$»xm™_upd©e
 (
CB
 *

)

540 
Ï¡_£nd
.
	`assign_now
();

542 
	`»xm™_uÆšk
 ();

544 
»xm™_Ãxt
 = 

;

545 
»xm™_´ev
 = 

->rexmit_prev;

547 
»xm™_´ev
->
»xm™_Ãxt
 = 
this
;

548 
»xm™_Ãxt
->
»xm™_´ev
 = 
this
;

549 
	}
}

551 
CLICK_ENDDECLS


552 
EXPORT_ELEMENT
(
WebG’
)

	@local/webgen.hh

1 #iâdeà
CLICK_WEBGEN_HH


2 
	#CLICK_WEBGEN_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/tim”.hh
>

6 
	~<şick/add»ss.hh
>

7 
CLICK_DECLS


25 şas 
	cWebG’
 : 
public
 
EËm’t
 {

26 
public
:

28 
	$WebG’
(è
CLICK_COLD
;

29 ~
	$WebG’
(è
CLICK_COLD
;

31 cÚ¡ *
	$şass_Çme
() const {  "WebGen"; }

32 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

33 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

34 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

35 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

36 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

38 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

39 
	`run_tim”
(
Tim”
 *);

41 
´iv©e
:

42 
Tim”
 
_tim”
;

43 
IPAdd»ss
 
_¤c_´efix
;

44 
IPAdd»ss
 
_mask
;

45 
IPAdd»ss
 
_d¡
;

46 
©omic_ušt32_t
 
_id
;

49 şas 
	cCB
 {

50 
public
:

51 
	`CB
(è
CLICK_COLD
;

53 
IPAdd»ss
 
_¤c
;

54 
_¥Üt
;

55 
_dpÜt
;

57 
_iss
;

58 
_¢d_uÇ
;

59 
_¢d_nxt
;

60 
_œs
;

61 
_rcv_nxt
;

64 
_cÚÃùed
:1,

65 
_gÙ_fš
:1,

66 
_£Á_fš
:1,

67 
_şo£d
:1,

68 
_do_£nd
:1,

69 
_¥¬e_b™s
:3;

70 
_»£nds
;

72 
Time¡amp
 
Ï¡_£nd
;

73 
¢dbuf
[64];

74 
¢dËn
;

76 
	`»£t
 (
IPAdd»ss
 
¤c
);

78 
	`»move_äom_li¡
 ();

79 
	`add_to_li¡
 (
CB
 **
ph—d
);

81 
	`»xm™_uÆšk
 ();

82 
	`»xm™_upd©e
 (
CB
 *

);

84 
CB
 *
Ãxt
;

85 
CB
 **
µ»v
;

87 
CB
 *
»xm™_Ãxt
;

88 
CB
 *
»xm™_´ev
;

89 
	}
};

91 cÚ¡ 
	ghtb™s
 = 10;

92 cÚ¡ 
	ghtsize
 = 1 << 
htb™s
;

93 cÚ¡ 
	ghtmask
 = 
htsize
 - 1;

94 
CB
 *
	gcbhash
[
htsize
];

95 
CB
 *
	gcbä“
;

96 
CB
 *
	g»xm™_h—d
, *
	g»xm™_
;

99 cÚ¡ 
	g»£nd_dt
 = 1000000;

100 cÚ¡ 
	g»£nd_max
 = 5;

103 
	g¡¬t_š‹rv®
;

104 
Time¡amp
 
	g¡¬t_tv
;

107 cÚ¡ 
	g³rf_dt
 = 5000000;

108 
Time¡amp
 
	g³rf_tv
;

110 
	gš™Ÿ‹d
;

111 
	gcom¶‘ed
;

112 
	g»£t
;

113 
	gtimeout
;

114 } 
	g³rfút
;

116 
do_³rf_¡©s
 ();

118 
»cyşe
(
CB
 *);

119 
CB
 *
fšd_cb
(
¤c
, 
¥Üt
, 
dpÜt
);

120 
IPAdd»ss
 
pick_¤c
();

121 
cÚnhash
(
¤c
, 
¥Üt
);

123 
Wr™abËPack‘
 *
fixup_·ck‘
 (
Pack‘
 *
p
, 
¶’
);

125 
tı_šput
(
Pack‘
 *);

126 
tı_£nd
(
CB
 *, 
Pack‘
 *);

127 
tı_ouut
(
Wr™abËPack‘
 *
p
,

128 
IPAdd»ss
 
¤c
, 
¥Üt
,

129 
IPAdd»ss
 
d¡
, 
dpÜt
,

130 
£q
, 
ack
, 
tıæags
,

131 *
·ylßd
, 
·yËn
);

134 
	gCLICK_ENDDECLS


	@radio/b8b10.cc

19 
	~<şick/cÚfig.h
>

20 
	~"b8b10.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/glue.hh
>

24 
CLICK_DECLS


26 
	gB8B10
::
	$B8B10
()

28 
	}
}

30 
B8B10
::~
	$B8B10
()

32 
	}
}

40 
x8to10
[] = {

81 
	gx10to8
[1024];

84 
	gB8B10
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

86 
i
;

88 if((
x8to10
)/(x8to10[0]) != 256)

89  
”rh
->
	`”rÜ
("sizeof(x8to10) != 256");

91 
i
 = 0; i < 1024; i++)

92 
x10to8
[
i
] = -1;

93 
i
 = 0; i < 256; i++){

94 if(
x10to8
[
x8to10
[
i
]] != -1)

95  
”rh
->
	`”rÜ
("duplicate x8to10ƒntry");

96 
x10to8
[
x8to10
[
i
]] = i;

100 
	}
}

103 
	gB8B10
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

105  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("ENCODE", 
_æag
).
com¶‘e
();

108 
Pack‘
 *

109 
	gB8B10
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

111 ià(
_æag
) {

113 
qb™s
 = 
p
->
	`Ëngth
() * 10;

114 
qby‹s
 = (
qb™s
 + 7) / 8;

115 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(
qby‹s
);

116 
	`mem£t
(
q
->
	`d©a
(), '\0', q->
	`Ëngth
());

117 
qb™
 = 0;

118 
pi
;

119 
pi
 = 0;…˜< ()
p
->
	`Ëngth
();…i++){

120 
x10
 = 
x8to10
[
p
->
	`d©a
()[
pi
] & 0xff];

121 
	`as£¹
(
x10
 >= 0 && x10 < 1024);

122 
qi
 = 
qb™
 / 8;

123 
qj
 = 
qb™
 % 8;

124 
	`as£¹
(
qi
+1 < ()
q
->
	`Ëngth
());

125 
q
->
	`d©a
()[
qi
] |ğ(
x10
 >> (
qj
+2));

126 
q
->
	`d©a
()[
qi
+1] |ğ(
x10
 << (6-
qj
)) & 0xff;

127 
qb™
 += 10;

129 
p
->
	`kl
();

130 (
q
);

133 
babblšg
 = 0;

134 
pb™s
 = 
p
->
	`Ëngth
() * 8;

135 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(
pb™s
 / 10);

136 
qi
 = 0;

137 
pb™
;

138 
pb™
 = 0;…b™ < 
pb™s
;…bit += 10){

139 
pi
 = 
pb™
 / 8;

140 
pj
 = 
pb™
 % 8;

141 
x10
 = ((
p
->
	`d©a
()[
pi
] << 
pj
) & 0xff) << 2;

142 
x10
 |ğ(
p
->
	`d©a
()[
pi
+1] & 0xffè>> (6-
pj
);

143 
	`as£¹
(
x10
 >= 0 && x10 < 1024);

144 
x8
 = 
x10to8
[
x10
];

145 if(
x8
 =ğ-1 && 
babblšg
 == 0){

146 
	`şick_ch©‹r
("b8b10 bad cod0x%03x", 
x10
);

147 
babblšg
 = 1;

149 
q
->
	`d©a
()[
qi
++] = 
x8
;

151 
p
->
	`kl
();

152 (
q
);

154 
	}
}

156 
CLICK_ENDDECLS


157 
	$ELEMENT_REQUIRES
(
BIM
)

158 
	`EXPORT_ELEMENT
(
B8B10
)

	@radio/b8b10.hh

1 #iâdeà
CLICK_B8B10_HH


2 
	#CLICK_B8B10_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


17 şas 
	cB8B10
 : 
public
 
EËm’t
 {

18 
public
:

19 
B8B10
();

20 ~
B8B10
();

22 cÚ¡ *
	$şass_Çme
() const {  "B8B10"; }

23 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

24 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

25 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

27 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

29 
´iv©e
:

30 
_æag
;

32 
	}
};

34 
	gCLICK_ENDDECLS


	@radio/bim-proto.hh

1 
	#BIM_ESC
 0xac

	)

2 
	#BIM_ESC_ESC
 0xB2

	)

3 
	#BIM_ESC_START
 0xc6

	)

4 
	#BIM_ESC_END
 0x87

	)

	@radio/bim.cc

19 
	~<şick/cÚfig.h
>

20 
	~"bim.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/·ck‘.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/glue.hh
>

25 
	~"bim-´Ùo.hh
"

26 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

27 
	~<uni¡d.h
>

28 
	~<‹rmios.h
>

29 
	~<fú.h
>

30 
	~<sys/ioùl.h
>

31 
CLICK_DECLS


33 
	gBIM
::
	$BIM
()

34 : 
	$_sk
(
this
)

36 
_¥“d
 = 9600;

37 
_fd
 = -1;

38 
_Ën
 = 
_¡¬‹d
 = 
_esÿ³d
 = 0;

39 
	}
}

41 
	gBIM
::~
	$BIM
()

43 if(
_fd
 >= 0)

44 
	`şo£
(
_fd
);

45 
	}
}

48 
	gBIM
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

50 ià(
Args
(
cÚf
, 
this
, 
”rh
)

51 .
»ad_mp
("DEVNAME", 
_dev
)

52 .
»ad_p
("BAUD", 
_¥“d
)

53 .
com¶‘e
() < 0)

56 if(
	g_¥“d
 == 4800)

57 
_¥“d
 = 
B4800
;

58 if(
	g_¥“d
 == 9600)

59 
_¥“d
 = 
B9600
;

60 if(
	g_¥“d
 == 19200)

61 
_¥“d
 = 
B19200
;

62 if(
	g_¥“d
 == 38400)

63 
_¥“d
 = 
B38400
;

65  
	g”rh
->
”rÜ
("bad s³ed %d", 
_¥“d
);

72 
	gBIM
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

74 ià(
_fd
 >= 0)

76 ià(!
_dev
)

77  
”rh
->
	`”rÜ
("device‚ame‚ot set");

79 *
dÇme
 = 
_dev
.
	`mubË_c_¡r
();

80 
_fd
 = 
	`İ’
(
dÇme
, 
O_RDWR
|
O_NONBLOCK
, 0);

81 if(
_fd
 < 0)

82  
”rh
->
	`”rÜ
("%s: %s", 
dÇme
, 
	`¡»¼Ü
(
”ºo
));

84 
	`ioùl
(
_fd
, 
TIOCEXCL
, 0);

86 
‹rmios
 
t
;

88 if(
	`tcg‘©Œ
(
_fd
, &
t
) < 0)

89  
”rh
->
	`”rÜ
("badcgetattr");

91 
t
.
c_iæag
 = 
IGNBRK
;

92 
t
.
c_oæag
 = 0;

93 
t
.
c_cæag
 = 
CS8
|
CREAD
|
HUPCL
|
CLOCAL
;

94 
t
.
c_læag
 = 0;

95 
	`cf£ti¥“d
(&
t
, 
_¥“d
);

96 
	`cf£to¥“d
(&
t
, 
_¥“d
);

97 if(
	`tc£‰r
(
_fd
, 
TCSANOW
, &
t
) < 0)

98  
”rh
->
	`”rÜ
("can't seterminal characteristics");

100 #ifdeà
FIONBIO


101 
yes
 = 1;

102 if(
	`ioùl
(
_fd
, 
FIONBIO
, &
yes
) < 0)

103  
”rh
->
	`”rÜ
("can't set‚on-blocking IO");

105  
”rh
->
	`”rÜ
("not configured for‚on-blocking IO");

108 #ifdeà
TCIOFLUSH


109 
	`tcæush
(
_fd
, 
TCIOFLUSH
);

110 #–ià
	`defšed
(
TIOCFLUSH
)

111 
	`tcæush
(
_fd
, 
TIOCFLUSH
);

113  
”rh
->
	`”rÜ
("this‡rchitecture has‚o TIOCFLUSH");

116 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

117 
	`add_£Ëù
(
_fd
, 
SELECT_READ
 | 
SELECT_WRITE
);

120 
	}
}

123 
	gBIM
::
	$£Ëùed
(
fd
, )

125 
cc
, 
i
;

126 
b
[128];

128 ià(
fd
 !ğ
_fd
)

131 
cc
 = 
	`»ad
(
_fd
, 
b
, (b));

132 
i
 = 0; i < 
cc
; i++)

133 
	`gÙ_ch¬
(
b
[
i
] & 0xff);

134 
	}
}

137 
	gBIM
::
	$gÙ_ch¬
(
c
)

139 if(
_¡¬‹d
 =ğ0 && 
_esÿ³d
 =ğ0 && 
c
 =ğ
BIM_ESC
){

140 
_esÿ³d
 = 1;

141 } if(
_esÿ³d
 && 
c
 =ğ
BIM_ESC_START
){

142 
_esÿ³d
 = 0;

143 
_¡¬‹d
 = 1;

144 
_Ën
 = 0;

145 } if(
_¡¬‹d
 && !
_esÿ³d
 && 
c
 =ğ
BIM_ESC
){

146 
_esÿ³d
 = 1;

147 } if(
_¡¬‹d
 && 
_esÿ³d
 && 
c
 =ğ
BIM_ESC_END
){

148 
Pack‘
 *
p
 = Pack‘::
	`make
(
_buf
, 
_Ën
);

149 
	`ouut
(0).
	`push
(
p
);

150 
_esÿ³d
 = 
_¡¬‹d
 = 
_Ën
 = 0;

151 } if(
_¡¬‹d
 && 
_esÿ³d
 && 
c
 =ğ
BIM_ESC_ESC
){

152 
_buf
[
_Ën
++] = 
BIM_ESC
;

153 
_esÿ³d
 = 0;

154 } if(
_¡¬‹d
 && !
_esÿ³d
 && 
c
 !ğ
BIM_ESC
){

155 
_buf
[
_Ën
++] = 
c
;

156 } if(
_¡¬‹d
 || 
_esÿ³d
){

157 
	`årštf
(
¡d”r
, "bim: framingƒrror, st %dƒs %d _len %d c %02x\n",

158 
_¡¬‹d
, 
_esÿ³d
, 
_Ën
, 
c
);

159 
_¡¬‹d
 = 
_esÿ³d
 = 
_Ën
 = 0;

162 if(
_Ën
 > 1024){

163 
	`årštf
(
¡d”r
, "bim: incoming…acketoo†arge\n");

164 
_Ën
 = 
_¡¬‹d
 = 0;

166 
	}
}

168 
boŞ


169 
	gBIM
::
	$run_sk
(
Task
 *)

171 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

172 ià(
p
)

173 
	`push
(0, 
p
);

174 
_sk
.
	`ç¡_»scheduË
();

175  
p
 != 0;

176 
	}
}

179 
	gBIM
::
	$push
(, 
Pack‘
 *
p
)

181 
	`£nd_·ck‘
(
p
->
	`d©a
(),…->
	`Ëngth
());

182 
p
->
	`kl
();

183 
	}
}

186 
	gBIM
::
	$£nd_·ck‘
(cÚ¡ 
buf
[], 
Ën
)

188 
i
, 
j
;

189 
big
[2048];

191 if(
Ën
 > 1024){

192 
	`årštf
(
¡d”r
, "bim:…acketoo†arge\n");

196 
j
 = 0;

197 
i
 = 0; i < 13; i++){

198 
big
[
j
++] = 'U';

200 
big
[
j
++] = 0xff;

202 
big
[
j
++] = 
BIM_ESC
;

203 
big
[
j
++] = 
BIM_ESC_START
;

205 
i
 = 0; i < 
Ën
; i++){

206 
c
 = 
buf
[
i
] & 0xff;

207 if(
c
 =ğ
BIM_ESC
){

208 
big
[
j
++] = 
BIM_ESC
;

209 
big
[
j
++] = 
BIM_ESC_ESC
;

211 
big
[
j
++] = 
c
;

215 
big
[
j
++] = 
BIM_ESC
;

216 
big
[
j
++] = 
BIM_ESC_END
;

218 if(
	`wr™e
(
_fd
, 
big
, 
j
) != () j){

219 
	`³¼Ü
("bim: write„s232");

224 
FILE
 *
å
 = 
	`fİ’
("foo", "a");

225 if(
å
){

226 
a
 = 0.5;

227 
by
, 
bi
;

228 
by
 = 0; by < 
j
; by++){

229 
bi
 = 0; bi < 8; bi++){

230 
b™
 = (
big
[
by
] >> 
bi
) & 1;

231 
a
 = (¨* 0.9è+ (
b™
 * 0.1);

232 
	`årštf
(
å
, "%.5f\n", 
a
);

235 
	`årštf
(
å
, "\n");

236 
	`fşo£
(
å
);

240 
	}
}

242 
CLICK_ENDDECLS


243 
	$EXPORT_ELEMENT
(
BIM
)

244 
	`ELEMENT_REQUIRES
(
u£¾ev–
)

	@radio/bim.hh

1 #iâdeà
CLICK_BIM_HH


2 
	#CLICK_BIM_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/sk.hh
>

5 
CLICK_DECLS


16 şas 
	cBIM
 : 
public
 
EËm’t
 {

17 
public
:

18 
	$BIM
(è
CLICK_COLD
;

19 ~
	$BIM
(è
CLICK_COLD
;

21 cÚ¡ *
	$şass_Çme
() const {  "BIM"; }

22 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

23 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL_TO_PUSH
; 
	}
}

25 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

26 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

28 
	`£Ëùed
(
fd
, 
mask
);

30 
	`push
(
pÜt
, 
Pack‘
 *);

31 
boŞ
 
	`run_sk
(
Task
 *);

33 
´iv©e
:

34 
SŒšg
 
_dev
;

35 
_¥“d
;

36 
_fd
;

37 
Task
 
_sk
;

40 
	`gÙ_ch¬
(
c
);

41 
_buf
[2048];

42 
_Ën
;

43 
_¡¬‹d
;

44 
_esÿ³d
;

46 
	`£nd_·ck‘
(cÚ¡ 
buf
[], 
Ën
);

47 
	}
};

49 
	gCLICK_ENDDECLS


	@radio/checkpattern.cc

18 
	~<şick/cÚfig.h
>

19 
	~"check·‰”n.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/¬gs.hh
>

22 
CLICK_DECLS


24 
	gCheckP©‹º
::
	$CheckP©‹º
()

26 
_Ën
 = 1;

27 
	}
}

29 
	gCheckP©‹º
::~
	$CheckP©‹º
()

31 
	}
}

34 
CheckP©‹º
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36  
Args
(
cÚf
, 
this
, 
”rh
)

37 .
»ad_mp
("LENGTH", 
_Ën
)

38 .
com¶‘e
();

41 
Pack‘
 *

42 
	gCheckP©‹º
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

44 
i
;

46 if(
p
->
	`Ëngth
(è!ğ
_Ën
)

47 
	`şick_ch©‹r
("CheckPattern:…->length() %d _len %d",

48 
p
->
	`Ëngth
(), 
_Ën
);

50 
i
 = 0; i < 
_Ën
 && i < 
p
->
	`Ëngth
(); i++){

51 if((
p
->
	`d©a
()[
i
]&0xff) != (i&0xff)){

52 
	`şick_ch©‹r
("CheckPattern: i=%d…kt %02x wanted %02x",

53 
i
, 
p
->
	`d©a
()[i] & 0xff, i & 0xff);

58 (
p
);

59 
	}
}

61 
CLICK_ENDDECLS


62 
EXPORT_ELEMENT
(
CheckP©‹º
)

	@radio/checkpattern.hh

1 #iâdeà
CHECKPATTERN_HH


2 
	#CHECKPATTERN_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


12 şas 
	cCheckP©‹º
 : 
public
 
EËm’t
 {

14 
_Ën
;

16 
	mpublic
:

18 
	$CheckP©‹º
(è
CLICK_COLD
;

19 ~
	$CheckP©‹º
(è
CLICK_COLD
;

21 cÚ¡ *
	$şass_Çme
() const {  "CheckPattern"; }

22 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

24 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

26 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

30 
	gCLICK_ENDDECLS


	@radio/scramble.cc

18 
	~<şick/cÚfig.h
>

19 
	~"süambË.hh
"

20 
CLICK_DECLS


22 
	gSüambË
::
	$SüambË
()

24 
	}
}

26 
SüambË
::~
	$SüambË
()

28 
	}
}

30 
·‰”n
[] = {

48 
Pack‘
 *

49 
	gSüambË
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

51 
i
, 
Ën
, 
j
;

53 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

54 
Ën
 = 
p
->
	`Ëngth
();

55 
j
 = 0;

56 
i
 = 0; i < 
Ën
; i++){

57 
p
->
	`d©a
()[
i
] ^ğ
·‰”n
[
j
];

58 
j
++;

59 if(
j
 >ğ()(
·‰”n
))

60 
j
 = 0;

63 (
p
);

64 
	}
}

66 
CLICK_ENDDECLS


67 
EXPORT_ELEMENT
(
SüambË
)

	@radio/scramble.hh

1 #iâdeà
SCRAMBLE_HH


2 
	#SCRAMBLE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


18 şas 
	cSüambË
 : 
public
 
EËm’t
 {

19 
public
:

20 
	$SüambË
(è
CLICK_COLD
;

21 ~
	$SüambË
(è
CLICK_COLD
;

23 cÚ¡ *
	$şass_Çme
() const {  "Scramble"; }

24 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

26 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

30 
	gCLICK_ENDDECLS


	@radio/sendpattern.cc

19 
	~<şick/cÚfig.h
>

20 
	~"£nd·‰”n.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gS’dP©‹º
::
	$S’dP©‹º
()

27 
_Ën
 = 1;

28 
	}
}

30 
	gS’dP©‹º
::~
	$S’dP©‹º
()

32 
	}
}

35 
S’dP©‹º
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37  
Args
(
cÚf
, 
this
, 
”rh
)

38 .
»ad_mp
("LENGTH", 
_Ën
)

39 .
com¶‘e
();

42 
Pack‘
 *

43 
	gS’dP©‹º
::
	$puÎ
()

45 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
_Ën
);

46 
i
;

47 
i
 = 0; i < 
_Ën
; i++)

48 
p
->
	`d©a
()[
i
] = i & 0xff;

49  
p
;

50 
	}
}

52 
CLICK_ENDDECLS


53 
EXPORT_ELEMENT
(
S’dP©‹º
)

	@radio/sendpattern.hh

1 #iâdeà
CLICK_SENDPATTERN_HH


2 
	#CLICK_SENDPATTERN_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


16 şas 
	cS’dP©‹º
 : 
public
 
EËm’t
 {

18 
_Ën
;

20 
	mpublic
:

22 
	$S’dP©‹º
(è
CLICK_COLD
;

23 ~
	$S’dP©‹º
(è
CLICK_COLD
;

25 cÚ¡ *
	$şass_Çme
() const {  "SendPattern"; }

26 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

27 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

29 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

31 
Pack‘
 *
puÎ
();

35 
	gCLICK_ENDDECLS


	@simple/simpleidle.cc

18 
	~<şick/cÚfig.h
>

19 
	~"sim¶eidË.hh
"

20 
CLICK_DECLS


22 
	gSim¶eIdË
::
	$Sim¶eIdË
()

24 
	}
}

26 
Sim¶eIdË
::~
	$Sim¶eIdË
()

28 
	}
}

31 
Sim¶eIdË
::
	$push
(, 
Pack‘
 *
p
)

33 
p
->
	`kl
();

34 
	}
}

36 
Pack‘
 *

37 
	gSim¶eIdË
::
	$puÎ
()

40 
	}
}

42 
CLICK_ENDDECLS


43 
	$EXPORT_ELEMENT
(
Sim¶eIdË
)

44 
	`ELEMENT_MT_SAFE
(
Sim¶eIdË
)

	@simple/simpleidle.hh

1 #iâdeà
CLICK_SIMPLEIDLE_HH


2 
	#CLICK_SIMPLEIDLE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


18 şas 
	cSim¶eIdË
 : 
public
 
EËm’t
 {…ublic:

20 
	$Sim¶eIdË
(è
CLICK_COLD
;

21 ~
	$Sim¶eIdË
(è
CLICK_COLD
;

23 cÚ¡ *
	$şass_Çme
() const {  "SimpleIdle"; }

24 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/-"; 
	}
}

25 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "a/a"; 
	}
}

26 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

28 
push
(, 
Pack‘
 *);

29 
Pack‘
 *
puÎ
();

33 
	gCLICK_ENDDECLS


	@simple/simplepriosched.cc

19 
	~<şick/cÚfig.h
>

20 
	~"sim¶•riosched.hh
"

21 
CLICK_DECLS


23 
	gSim¶ePrioSched
::
	$Sim¶ePrioSched
()

25 
	}
}

27 
Sim¶ePrioSched
::~
	$Sim¶ePrioSched
()

29 
	}
}

31 
Pack‘
 *

32 
Sim¶ePrioSched
::
	$puÎ
()

34 
i
 = 0; i < 
	`nšputs
(); i++) {

35 ià(
Pack‘
 *
p
 = 
	`šput
(
i
).
	`puÎ
())

36  
p
;

39 
	}
}

41 
CLICK_ENDDECLS


42 
	$EXPORT_ELEMENT
(
Sim¶ePrioSched
)

43 
	`ELEMENT_MT_SAFE
(
Sim¶ePrioSched
)

	@simple/simplepriosched.hh

2 #iâdeà
CLICK_SIMPLEPRIOSCHED_HH


3 
	#CLICK_SIMPLEPRIOSCHED_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


24 şas 
	cSim¶ePrioSched
 : 
public
 
EËm’t
 {…ublic:

26 
	$Sim¶ePrioSched
(è
CLICK_COLD
;

27 ~
	$Sim¶ePrioSched
(è
CLICK_COLD
;

29 cÚ¡ *
	$şass_Çme
() const {  "SimplePrioSched"; }

30 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/1"; 
	}
}

31 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

32 cÚ¡ *
	$æags
(ècÚ¡ {  "S0"; 
	}
}

34 
Pack‘
 *
puÎ
(
pÜt
);

38 
	gCLICK_ENDDECLS


	@simple/simplepullswitch.cc

18 
	~<şick/cÚfig.h
>

19 
	~"sim¶•uÎsw™ch.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/Î½c.h
>

23 
CLICK_DECLS


25 
	gSim¶ePuÎSw™ch
::
	$Sim¶ePuÎSw™ch
()

27 
	}
}

29 
Sim¶ePuÎSw™ch
::~
	$Sim¶ePuÎSw™ch
()

31 
	}
}

34 
Sim¶ePuÎSw™ch
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
	gšput
 = 0;

37 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("INPUT", 
šput
).
com¶‘e
() < 0)

39 
£t_šput
(
šput
);

44 
	gSim¶ePuÎSw™ch
::
	$£t_šput
(
šput
)

46 
_šput
 = (
šput
 < 0 || iÅuˆ>ğ
	`nšputs
() ? -1 : input);

47 
	}
}

49 
Pack‘
 *

50 
	gSim¶ePuÎSw™ch
::
	$puÎ
()

52 ià(
_šput
 < 0)

55  
	`šput
(
_šput
).
	`puÎ
();

56 
	}
}

59 
	gSim¶ePuÎSw™ch
::
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

61 
Sim¶ePuÎSw™ch
 *
sw
 = 
¡©ic_ÿ¡
<Sim¶ePuÎSw™ch *>(
e
);

62 
šput
;

63 ià(!
	`IÁArg
().
	`·r£
(
s
, 
šput
))

64  
”rh
->
	`”rÜ
("syntaxƒrror");

65 
sw
->
	`£t_šput
(
šput
);

67 
	}
}

70 
	gSim¶ePuÎSw™ch
::
	$add_hªdËrs
()

72 
	`add_d©a_hªdËrs
("sw™ch", 
HªdËr
::
OP_READ
, &
_šput
);

73 
	`add_wr™e_hªdËr
("sw™ch", 
wr™e_·¿m
);

74 
	`add_d©a_hªdËrs
("cÚfig", 
HªdËr
::
OP_READ
, &
_šput
);

75 
	`£t_hªdËr_æags
("cÚfig", 0, 
HªdËr
::
CALM
);

76 
	}
}

79 
	gSim¶ePuÎSw™ch
::
	$Î½c
(
commªd
, *
d©a
)

81 ià(
commªd
 =ğ
CLICK_LLRPC_SET_SWITCH
) {

82 
št32_t
 *
v®
 = 
»š‹½»t_ÿ¡
<št32_ˆ*>(
d©a
);

83 
	`£t_šput
(*
v®
);

86 } ià(
commªd
 =ğ
CLICK_LLRPC_GET_SWITCH
) {

87 
št32_t
 *
v®
 = 
»š‹½»t_ÿ¡
<št32_ˆ*>(
d©a
);

88 *
v®
 = 
_šput
;

92  
EËm’t
::
	`Î½c
(
commªd
, 
d©a
);

93 
	}
}

95 
CLICK_ENDDECLS


96 
	$EXPORT_ELEMENT
(
Sim¶ePuÎSw™ch
)

97 
	`ELEMENT_MT_SAFE
(
Sim¶ePuÎSw™ch
)

	@simple/simplepullswitch.hh

1 #iâdeà
CLICK_SIMPLEPULLSWITCH_HH


2 
	#CLICK_SIMPLEPULLSWITCH_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


38 şas 
	cSim¶ePuÎSw™ch
 : 
public
 
EËm’t
 {…ublic:

40 
	$Sim¶ePuÎSw™ch
(è
CLICK_COLD
;

41 ~
	$Sim¶ePuÎSw™ch
(è
CLICK_COLD
;

43 cÚ¡ *
	$şass_Çme
() const {  "SimplePullSwitch"; }

44 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/1"; 
	}
}

45 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

47 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

48 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

49 
	$add_hªdËrs
(è
CLICK_COLD
;

51 
vœtu®
 
	`£t_šput
(
šput
);

53 
Pack‘
 *
	`puÎ
();

55 
	`Î½c
(
commªd
, *
d©a
);

57 
´Ùeùed
:

59 
_šput
;

61 
SŒšg
 
	$»ad_·¿m
(
EËm’t
 *, *è
CLICK_COLD
;

62 
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

64 
	}
};

66 
	gCLICK_ENDDECLS


	@simple/simplerrsched.cc

18 
	~<şick/cÚfig.h
>

19 
	~"sim¶”rsched.hh
"

20 
CLICK_DECLS


22 
	gSim¶eRRSched
::
	$Sim¶eRRSched
()

24 
_Ãxt
 = 0;

25 
	}
}

27 
	gSim¶eRRSched
::~
	$Sim¶eRRSched
()

29 
	}
}

31 
Pack‘
 *

32 
Sim¶eRRSched
::
	$puÎ
()

34 
n
 = 
	`nšputs
();

35 
i
 = 
_Ãxt
;

36 
j
 = 0; j < 
n
; j++) {

37 
Pack‘
 *
p
 = 
	`šput
(
i
).
	`puÎ
();

38 
i
++;

39 ià(
i
 >ğ
n
)

40 
i
 = 0;

41 ià(
p
) {

42 
_Ãxt
 = 
i
;

43  
p
;

47 
	}
}

49 
CLICK_ENDDECLS


50 
EXPORT_ELEMENT
(
Sim¶eRRSched
)

	@simple/simplerrsched.hh

2 #iâdeà
CLICK_SIMPLERRSCHED_HH


3 
	#CLICK_SIMPLERRSCHED_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


27 şas 
	cSim¶eRRSched
 : 
public
 
EËm’t
 {…ublic:

29 
	$Sim¶eRRSched
(è
CLICK_COLD
;

30 ~
	$Sim¶eRRSched
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "SimpleRoundRobinSched"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/1"; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

35 cÚ¡ *
	$æags
(ècÚ¡ {  "S0"; 
	}
}

37 
Pack‘
 *
puÎ
(
pÜt
);

39 
	g´iv©e
:

41 
_Ãxt
;

45 
	gCLICK_ENDDECLS


	@standard/addressinfo.cc

21 
	~<şick/cÚfig.h
>

22 
	~<şick/¡ªd¬d/add»ssšfo.hh
>

23 
	~<şick/Çmešfo.hh
>

24 
	~<şick/glue.hh
>

25 
	~<şick/cÚå¬£.hh
>

26 
	~<şick/rou‹r.hh
>

27 
	~<şick/”rÜ.hh
>

28 
	~<şickÃt/‘h”.h
>

29 
	~<şick/‘h”add»ss.hh
>

30 #ià
CLICK_NS


31 
	~<şick/ma¡”.hh
>

33 #ià
CLICK_USERLEVEL


34 
	~<uni¡d.h
>

35 
	~<time.h
>

36 
	~<şick/u£ruts.hh
>

37 #ià
HAVE_IFADDRS_H


38 
	~<sys/ty³s.h
>

39 
	~<sys/sock‘.h
>

40 
	~<Ãt/if.h
>

41 #ià
HAVE_NET_IF_TYPES_H


42 
	~<Ãt/if_ty³s.h
>

44 #ià
HAVE_NET_IF_DL_H


45 
	~<Ãt/if_dl.h
>

47 #ià
HAVE_NETPACKET_PACKET_H


48 
	~<Ãack‘/·ck‘.h
>

50 
	~<içddrs.h
>

51 #–ià
defšed
(
__lšux__
)

52 
	~<Ãt/if.h
>

53 
	~<sys/ioùl.h
>

54 
	~<Ãt/if_¬p.h
>

55 
	~<şick/u£ruts.hh
>

57 #–ià
CLICK_LINUXMODULE


58 
	~<şick/cxx´Ùeù.h
>

59 
	gCLICK_CXX_PROTECT


60 
	~<lšux/Ãtdeviû.h
>

61 
	~<lšux/¹Ãšk.h
>

62 
	~<lšux/if_¬p.h
>

63 
	~<lšux/š‘deviû.h
>

64 
	~<Ãt/rou‹.h
>

65 #ià
LINUX_VERSION_CODE
 >ğ
KERNEL_VERSION
(2, 6, 24)

66 
	~<Ãt/Ãt_Çme¥aû.h
>

68 
	gCLICK_CXX_UNPROTECT


69 
	~<şick/cxxuÅrÙeù.h
>

71 #ià
CLICK_BSDMODULE


72 
	~<şick/cxx´Ùeù.h
>

73 
	gCLICK_CXX_PROTECT


74 
	~<sys/sock‘.h
>

75 
	~<Ãt/if.h
>

76 
	~<Ãt/if_dl.h
>

77 
	gCLICK_CXX_UNPROTECT


78 
	~<şick/cxxuÅrÙeù.h
>

80 #ià
HAVE_IP6


81 
	~<şick/6add»ss.hh
>

83 
CLICK_DECLS


85 ’um { 
	mtc_v4
 = 'i', 
	mtc_v4´efix
 = 'I', 
	mtc_‘h”
 = 'e',

86 
	mtc_v4gw
 = 'g' };

88 
	gAdd»ssInfo
::
	$Add»ssInfo
()

90 
	}
}

93 
Add»ssInfo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

95 ’um { 
	gt_‘h
 = 1, 
	gt_4
 = 2, 
	gt_4Ãt
 = 4, 
	gt_6
 = 8, 
	gt_6Ãt
 = 16 };

96 
š_addr
 
	g4
[2];

97 
	g‘h”
[6];

98 #ià
HAVE_IP6


99 
	s6·¹s
 {

100 
IP6Add»ss
 
	g6
;

101 
	g¶’
;

102 
6·¹s
(è: 
6
(
IP6Add»ss
::
unš™Ÿlized_t
()) {

105 
6·¹s
 
	g6
;

107 
ArgCÚ‹xt
 
cÚ‹xt
(
this
);

109 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

110 
	gVeùÜ
<
	gSŒšg
> 
	g·¹s
;

111 
ı_¥aûvec
(
cÚf
[
i
], 
·¹s
);

112 ià(
	g·¹s
.
size
() == 0)

115 ià(
	g·¹s
.
size
() < 2)

116 
	g”rh
->
”rÜ
("expected %<NAME [ADDRS]%>");

117 
	gty³s
 = 0;

119 
	gj
 = 1; j < 
	g·¹s
.
size
(); j++) {

120 
	gmy_ty³s
 = 0;

121 ià(
Eth”Add»ssArg
().
·r£
(
·¹s
[
j
], 
‘h”
, 
cÚ‹xt
))

122 
	gmy_ty³s
 |ğ
t_‘h
;

123 ià(
IPAdd»ssArg
().
·r£
(
·¹s
[
j
], 
4
[0], 
cÚ‹xt
))

124 
	gmy_ty³s
 |ğ
t_4
;

125 ià(
IPP»fixArg
().
·r£
(
·¹s
[
j
], 
4
[0], ip4[1], 
cÚ‹xt
)) {

126 
	gmy_ty³s
 |ğ
t_4Ãt
;

127 ià(
	g4
[0].
	gs_addr
 & ~ip4[1].s_addr)

128 
	gmy_ty³s
 |ğ
t_4
;

130 #ià
HAVE_IP6


131 ià(
IP6Add»ssArg
().
·r£
(
·¹s
[
j
], 
6
.6, 
cÚ‹xt
))

132 
	gmy_ty³s
 |ğ
t_6
;

133 ià(
IP6P»fixArg
().
·r£
(
·¹s
[
j
], 
6
.6, ip6.
¶’
, 
cÚ‹xt
)) {

134 
	gmy_ty³s
 |ğ
t_6Ãt
;

135 ià(
	g6
.6 & 
	gIP6Add»ss
::
make_šv”‹d_´efix
(
6
.
¶’
))

136 
my_ty³s
 |ğ
t_6
;

140 
boŞ
 
	gÚe_ty³
 = (
my_ty³s
 & (my_types - 1)) == 0;

141 ià((
	gmy_ty³s
 & 
	gt_‘h
è&& (
	gÚe_ty³
 || !(
	gty³s
 &_eth)))

142 
	gNameInfo
::
defše
(
NameInfo
::
T_ETHERNET_ADDR
, 
this
, 
·¹s
[0], 
‘h”
, 6);

143 ià((
	gmy_ty³s
 & 
	gt_4
è&& (
	gÚe_ty³
 || !(
	gty³s
 &_ip4)))

144 
	gNameInfo
::
defše
(
NameInfo
::
T_IP_ADDR
, 
this
, 
·¹s
[0], &
4
[0], 4);

145 ià((
	gmy_ty³s
 & 
	gt_4Ãt
è&& (
	gÚe_ty³
 || !(
	gty³s
 &_ip4net)))

146 
	gNameInfo
::
defše
(
NameInfo
::
T_IP_PREFIX
, 
this
, 
·¹s
[0], &
4
[0], 8);

147 #ià
HAVE_IP6


148 ià((
	gmy_ty³s
 & 
	gt_6
è&& (
	gÚe_ty³
 || !(
	gty³s
 &_ip6)))

149 
	gNameInfo
::
defše
(
NameInfo
::
T_IP6_ADDR
, 
this
, 
·¹s
[0], &
6
.ip6, 16);

150 ià((
	gmy_ty³s
 & 
	gt_6Ãt
è&& (
	gÚe_ty³
 || !(
	gty³s
 &_ip6net)))

151 
	gNameInfo
::
defše
(
NameInfo
::
T_IP6_PREFIX
, 
this
, 
·¹s
[0], &
6
, 16 + ());

154 
	gty³s
 |ğ
my_ty³s
;

155 ià(!
	gmy_ty³s
)

156 
	g”rh
->
”rÜ
("%<%s%> i nÙ‡„ecognizabË‡dd»ss", 
·¹s
[
j
].
c_¡r
());

160  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

164 #ià
CLICK_USERLEVEL
 && !
CLICK_NS
 && (
HAVE_IFADDRS_H
 || 
defšed
(
__lšux__
))

165 
šlše
 

166 
add_deviûšfo
(
VeùÜ
<
SŒšg
> &
deviûšfo
, cÚ¡ SŒšg &
Çme
,

167 
ty³
, cÚ¡ 
SŒšg
 &
d©a
)

169 
	gdeviûšfo
.
push_back
(
Çme
);

170 
	gdeviûšfo
.
push_back
(
SŒšg
((è
ty³
è+ 
d©a
);

174 
ü—‹_deviûšfo
(
VeùÜ
<
SŒšg
> &
deviûšfo
)

176 #ià
HAVE_IFADDRS_H


178 
içddrs
 *
	giçp
;

179 ià(
g‘içddrs
(&
içp
) >= 0) {

180 
içddrs
 *
iç
 = 
içp
; 
	giç
; iç = iç->
iç_Ãxt
) {

181 ià(!
iç
->
iç_addr
)

184 ià(
	giç
->
	giç_addr
->
	g§_çmy
 =ğ
AF_INET
) {

185 
sockaddr_š
 *
sš
 = (sockaddr_š *è
iç
->
iç_addr
;

186 
add_deviûšfo
(
deviûšfo
, 
iç
->
iç_Çme
, 
tc_v4
, 
SŒšg
((*è&
sš
->
sš_addr
, (
š_addr
)));

187 ià(
	giç
->
	giç_Ãtmask
) {

188 
sockaddr_š
 *
	gsšm
 = (sockaddr_š *è
iç
->
iç_Ãtmask
;

189 
add_deviûšfo
(
deviûšfo
, 
iç
->
iç_Çme
, 
tc_v4´efix
, 
SŒšg
((*è&
sš
->
sš_addr
, (
š_addr
)è+ SŒšg((*è&
sšm
->sin_addr, (in_addr)));

193 #ià
defšed
(
AF_PACKET
è&& 
HAVE_NETPACKET_PACKET_H


194 ià(
	giç
->
	giç_addr
->
	g§_çmy
 =ğ
AF_PACKET
) {

195 
sockaddr_Î
 *
¦l
 = (sockaddr_Î *è
iç
->
iç_addr
;

196 ià((
	g¦l
->
	g¦l_h©y³
 =ğ
ARPHRD_ETHER
 || 
¦l
->
¦l_h©y³
 =ğ
ARPHRD_80211
è&& sÎ->
¦l_h®’
 =ğ(
Eth”Add»ss
))

197 
add_deviûšfo
(
deviûšfo
, 
iç
->
iç_Çme
, 
tc_‘h”
, 
SŒšg
((*è
¦l
->
¦l_addr
, (
Eth”Add»ss
)));

201 #ià
defšed
(
AF_LINK
è&& 
HAVE_NET_IF_DL_H


202 ià(
	giç
->
	giç_addr
->
	g§_çmy
 =ğ
AF_LINK
) {

203 
sockaddr_dl
 *
sdl
 = (sockaddr_dÈ*è
iç
->
iç_addr
;

204 ià(
	gsdl
->
	gsdl_ty³
 =ğ
IFT_ETHER
 && 
sdl
->
sdl_®’
 =ğ(
Eth”Add»ss
))

205 
add_deviûšfo
(
deviûšfo
, 
iç
->
iç_Çme
, 
tc_‘h”
, 
SŒšg
((*è
LLADDR
(
sdl
), (
Eth”Add»ss
)));

210 
ä“içddrs
(
içp
);

213 #–ià
defšed
(
__lšux__
)

215 
	gqu”y_fd
 = 
sock‘
(
AF_INET
, 
SOCK_DGRAM
, 0);

216 ià(
	gqu”y_fd
 < 0)

219 
SŒšg
 
	gf
 = 
fe_¡ršg
("/proc/net/dev");

220 cÚ¡ *
	gbegš
 = 
f
.
begš
(), *
	g’d
 = f.
’d
(), *
	gÆ
;

221 
iäeq
 
	giä
;

222 ; 
	gbegš
 < 
	g’d
; begš = 
Æ
 + 1) {

223 cÚ¡ *
cŞÚ
 = 
fšd
(
begš
, 
’d
, ':');

224 
	gÆ
 = 
fšd
(
begš
, 
’d
, '\n');

225 ià(
	gcŞÚ
 <ğ
begš
 || 
cŞÚ
 >ğ
Æ
)

228 cÚ¡ *
	gwÜd
 = 
cŞÚ
;

229 
	gwÜd
 > 
	gbegš
 && !
is¥aû
((è
wÜd
[-1]))

230 --
	gwÜd
;

231 ià((
	gsize_t
è(
	gcŞÚ
 - 
	gwÜd
è>ğ(
iä
.
iä_Çme
))

235 
SŒšg
 
	gdev_Çme
 = 
f
.
sub¡ršg
(
wÜd
, 
cŞÚ
);

236 
¡rıy
(
iä
.
iä_Çme
, 
dev_Çme
.
c_¡r
());

237 ià(
ioùl
(
qu”y_fd
, 
SIOCGIFHWADDR
, &
iä
) >= 0

238 && (
iä
.
iä_hwaddr
.
§_çmy
 =ğ
ARPHRD_ETHER


239 || 
iä
.
iä_hwaddr
.
§_çmy
 =ğ
ARPHRD_80211
))

240 
add_deviûšfo
(
deviûšfo
, 
dev_Çme
, 
tc_‘h”
, 
SŒšg
(
iä
.
iä_hwaddr
.
§_d©a
, (
Eth”Add»ss
)));

241 
	gx
[8];

242 ià(
ioùl
(
qu”y_fd
, 
SIOCGIFADDR
, &
iä
) >= 0

243 && 
iä
.
iä_addr
.
§_çmy
 =ğ
AF_INET
) {

244 
sockaddr_š
 *
sš
 = (sockaddr_š *è&
iä
.
iä_addr
;

245 
memıy
(
x
, &
sš
->
sš_addr
, (
š_addr
));

246 
add_deviûšfo
(
deviûšfo
, 
dev_Çme
, 
tc_v4
, 
SŒšg
(
x
, (
š_addr
)));

247 ià(
ioùl
(
qu”y_fd
, 
SIOCGIFNETMASK
, &
iä
) >= 0

248 && 
iä
.
iä_addr
.
§_çmy
 =ğ
AF_INET
) {

249 
memıy
(
x
 + (
š_addr
), &
sš
->
sš_addr
, (in_addr));

250 
add_deviûšfo
(
deviûšfo
, 
dev_Çme
, 
tc_v4´efix
, 
SŒšg
(
x
, 2 * (
š_addr
)));

255 
şo£
(
qu”y_fd
);

259 
boŞ


260 
ü—‹_v4gw_deviûšfo
(cÚ¡ 
SŒšg
 &
iâame
, 
VeùÜ
<SŒšg> &
deviûšfo
)

262 #ià
defšed
(
__lšux__
)

263 
SŒšg
 
	gouut
 = 
sh–l_commªd_ouut_¡ršg
("/sbš/„ou‹ showØ0/0 oià" + 
sh–l_quÙe
(
iâame
), "", 
E¼ÜHªdËr
::
s’t_hªdËr
());

264 ià(
	gouut
.
¡¬ts_w™h
("default via ")) {

265 
	g
[4];

266 
	gnby‹s
;

267 ià(
	gIPAdd»ssArg
::
basic_·r£
(
ouut
.
begš
(è+ 12, ouut.
’d
(),

268 

, 
nby‹s
è!ğ
ouut
.
begš
() + 12

269 && 
nby‹s
 == 4) {

270 
add_deviûšfo
(
deviûšfo
, 
iâame
, 
tc_v4gw
, 
SŒšg
(

, 4));

271  
	gŒue
;

275 (è
	giâame
, (è
	gdeviûšfo
;

277  
	gçl£
;

281 
boŞ


282 
	gAdd»ssInfo
::
	$qu”y_Ãtdeviû
(cÚ¡ 
SŒšg
 &
s
, *
¡Üe
,

283 
ty³
, 
Ën
, cÚ¡ 
EËm’t
 *
cÚ‹xt
, 
æags
)

286 (è
s
, (è
¡Üe
, (è
ty³
, (è
Ën
, (è
cÚ‹xt
;

287 ià(
æags
 & 
f_nodeviû
)

288  
çl£
;

290 #ià
CLICK_USERLEVEL
 && !
CLICK_NS
 && (
HAVE_IFADDRS_H
 || 
	`defšed
(
__lšux__
))

295 
time_t
 
»ad_time
 = 0;

296 
VeùÜ
<
SŒšg
> 
deviûšfo
;

299 ià(!
»ad_time
 ||„—d_tim+ 30 < 
	`time
(0)) {

300 
deviûšfo
.
	`ş—r
();

301 
	`ü—‹_deviûšfo
(
deviûšfo
);

302 
»ad_time
 = 
	`time
(0);

306 
i
 = 0; i < 
deviûšfo
.
	`size
(); i += 2) {

307 
	`årštf
(
¡d”r
, "% %c:", 
deviûšfo
[
i
].
	`c_¡r
(), deviceinfo[i+1][0]);

308 cÚ¡ *
x
 = 
deviûšfo
[
i
+1].
	`begš
(è+ 1; x !ğdeviûšfo[i+1].
	`’d
(); ++x)

309 
	`årštf
(
¡d”r
, "%02x", (è*
x
);

310 
	`årštf
(
¡d”r
, "\n");

314 
i
 = 0; i < 
deviûšfo
.
	`size
(); i += 2)

315 ià(
deviûšfo
[
i
] =ğ
s


316 && (è
deviûšfo
[
i
+1][0] =ğ(è
ty³
) {

317 
	`memıy
(
¡Üe
, 
deviûšfo
[
i
+1].
	`d©a
(è+ 1, 
Ën
);

318  
Œue
;

321 ià(
ty³
 =ğ
tc_v4gw
 && 
	`ü—‹_v4gw_deviûšfo
(
s
, 
deviûšfo
)) {

322 
	`memıy
(
¡Üe
, 
deviûšfo
.
	`back
().
	`d©a
(è+ 1, 
Ën
);

323  
Œue
;

326 #–ià
CLICK_LINUXMODULE


328 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 24)

329 
Ãt_deviû
 *
dev
 = 
	`dev_g‘_by_Çme
(&
š™_Ãt
, 
s
.
	`c_¡r
());

331 
Ãt_deviû
 *
dev
 = 
	`dev_g‘_by_Çme
(
s
.
	`c_¡r
());

333 
boŞ
 
found
 = 
çl£
;

334 ià(
dev
 && 
ty³
 =ğ
tc_‘h”


335 && (
dev
->
ty³
 =ğ
ARPHRD_ETHER
 || dev->ty³ =ğ
ARPHRD_80211
)) {

336 
	`memıy
(
¡Üe
, 
dev
->
dev_addr
, 6);

337 
found
 = 
Œue
;

338 } ià(
dev
 && (
ty³
 =ğ
tc_v4
 ||y³ =ğ
tc_v4´efix


339 || 
ty³
 =ğ
tc_v4gw
)) {

340 
ušt32_t
 
addr
[2];

341 ià(
š_deviû
 *
š_dev
 = 
	`š_dev_g‘
(
dev
)) {

342 
	`fÜ_´im¬y_iç
(
š_dev
) {

343 
addr
[0] = 
iç
->
iç_loÿl
;

344 
addr
[1] = 
iç
->
iç_mask
;

345 
found
 = 
Œue
;

347 } 
	`’dfÜ_iç
(
š_dev
);

348 
	`š_dev_put
(
š_dev
);

350 ià(!
found
)

352 ià(
ty³
 =ğ
tc_v4gw
) {

353 
found
 = 
çl£
;

356 
¦ash8
 = (
ušt32_t
è
	`Áohl
(
addr
[0]) >> 24;

357 
addr
[0] ^ğ
	`htÚl
(0x01000000 << (
¦ash8
 == 1 || slash8 == 126));

358 
¹abË
 *
¹
;

359 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 39)

360 
¹
 = 
	`_rou‹_ouut
(
	`dev_Ãt
(
dev
), 
addr
[0], 0, 0, dev->
ifšdex
);

362 
æowi
 
æ
;

363 
	`mem£t
(&
æ
, 0, (fl));

364 
æ
.
oif
 = 
dev
->
ifšdex
;

365 
æ
.
æ4_d¡
 = 
addr
[0];

366 #ià
LINUX_VERSION_CODE
 >ğ
	`KERNEL_VERSION
(2, 6, 25)

367 
”r
 = 
	`_rou‹_ouut_key
(
	`dev_Ãt
(
dev
), &
¹
, &
æ
);

369 
”r
 = 
	`_rou‹_ouut_key
(&
¹
, &
æ
);

371 ià(
”r
 < 0)

372 
¹
 = (
¹abË
 *è
	`ERR_PTR
(
”r
);

374 ià(!
	`IS_ERR
(
¹
)) {

375 ià(
¹
->
¹_g©eway
) {

376 
	`memıy
(
¡Üe
, &
¹
->
¹_g©eway
, 4);

377 
found
 = 
Œue
;

379 
	`_¹_put
(
¹
);

382 
	`memıy
(
¡Üe
, 
addr
, 
ty³
 =ğ
tc_v4
 ? 4 : 8);

384 ià(
dev
)

385 
	`dev_put
(
dev
);

386  
found
;

388 #–ià
CLICK_BSDMODULE


389 
iâ‘
 *
iå
;

390 
boŞ
 
found
 = 
çl£
;

391 
iå
 = 
	`ifun™
(
s
.
	`c_¡r
());

392 ià(
iå
 && 
ty³
 =ğ
tc_‘h”
) {

393 
sockaddr_dl
 *
sdl
;

394 
sdl
 = (
sockaddr_dl
 *)
iå
->
if_addr
->
iç_addr
;

395 
	`memıy
(
¡Üe
, 
	`LLADDR
(
sdl
), 6 );

396 
found
 = 
Œue
;

397 } ià(
iå
 && (
ty³
 =ğ
tc_v4
 ||y³ =ğ
tc_v4´efix
)) {

398 
içddr
 *
iç
;

399 
	`IF_ADDR_LOCK
(
iå
);

400 
	`TAILQ_FOREACH
(
iç
, &
iå
->
if_addrh—d
, 
iç_lšk
) {

401 
sockaddr_š
 *
sš
;

402 
sš
 = 
	`§tosš
(
iç
->
iç_addr
);

404 ià(
sš
 !ğ
NULL
 && sš->
sš_çmy
 =ğ
AF_INET
) {

405 
	`memıy
(
¡Üe
, (
ušt8_t
 *)(&(
sš
->
sš_addr
)),

407 ià(
ty³
 =ğ
tc_v4´efix
) {

408 
sš
 = 
	`§tosš
(
iç
->
iç_Ãtmask
);

409 
	`memıy
(
¡Üe
 + 4, (
ušt8_t
 *)(&(
sš
->
sš_addr
)), 4);

411 
found
 = 
Œue
;

415 
	`IF_ADDR_UNLOCK
(
iå
);

417  
found
;

419 #–ià
CLICK_NS


421 ià(
cÚ‹xt
 && 
ty³
 =ğ
tc_v4
) {

422 
tmp
[255];

423 
r
 = 
	`simşick_sim_commªd
(
cÚ‹xt
->
	`rou‹r
()->
	`ma¡”
()->
	`simnode
(), 
SIMCLICK_IPADDR_FROM_NAME
, 
s
.
	`c_¡r
(), 
tmp
, 255);

424 ià(
r
 >ğ0 && 
tmp
[0] && 
	`IPAdd»ssArg
().
	`·r£
Ñmp, *
»š‹½»t_ÿ¡
<
IPAdd»ss
 *>(
¡Üe
)))

425  
Œue
;

426 } ià(
cÚ‹xt
 && 
ty³
 =ğ
tc_‘h”
) {

427 
tmp
[255];

428 
r
 = 
	`simşick_sim_commªd
(
cÚ‹xt
->
	`rou‹r
()->
	`ma¡”
()->
	`simnode
(), 
SIMCLICK_MACADDR_FROM_NAME
, 
s
.
	`c_¡r
(), 
tmp
, 255);

429 ià(
r
 >ğ0 && 
tmp
[0] && 
	`Eth”Add»ssArg
().
	`·r£
Ñmp, 
¡Üe
))

430  
Œue
;

431 } ià(
cÚ‹xt
 && 
ty³
 =ğ
tc_v4´efix
) {

432 
tmp
[255];

433 
IPAdd»ss
 
¡Üex
[2];

434 
r
 = 
	`simşick_sim_commªd
(
cÚ‹xt
->
	`rou‹r
()->
	`ma¡”
()->
	`simnode
(), 
SIMCLICK_IPADDR_FROM_NAME
, 
s
.
	`c_¡r
(), 
tmp
, 255);

435 ià(
r
 >ğ0 && 
tmp
[0] && 
	`IPAdd»ssArg
().
	`·r£
Ñmp, 
¡Üex
[0])) {

436 
r
 = 
	`simşick_sim_commªd
(
cÚ‹xt
->
	`rou‹r
()->
	`ma¡”
()->
	`simnode
(), 
SIMCLICK_IPPREFIX_FROM_NAME
, 
s
.
	`c_¡r
(), 
tmp
, 255);

437 ià(
r
 >ğ0 && 
tmp
[0] && 
	`IPAdd»ssArg
().
	`·r£
Ñmp, 
¡Üex
[1])) {

438 
	`memıy
(
¡Üe
, 
¡Üex
, 8);

439  
Œue
;

446  
çl£
;

447 
	}
}

450 
boŞ


451 
	gAdd»ssInfo
::
	$qu”y_
(cÚ¡ 
SŒšg
 &
suffixed_s
, *
¡Üe
,

452 cÚ¡ 
EËm’t
 *
cÚ‹xt
, 
æags
)

454 
SŒšg
 
	`s
(
suffixed_s
);

455 
cŞÚ
 = 
s
.
	`fšd_right
(':');

456 ià(
cŞÚ
 >= 0) {

457 
SŒšg
 
ty³¡r
 = 
s
.
	`sub¡ršg
(
cŞÚ
).
	`low”
();

458 
s
 = s.
	`sub¡ršg
(0, 
cŞÚ
);

460 
ušt32_t
 
addr
[2];

461 
x
[8];

462 } 
u
;

463 ià(
ty³¡r
.
	`equ®s
(":ip", 3) ||ypestr.equals(":ip4", 4))

465 ià(
ty³¡r
.
	`equ®s
(":bcast", 6)) {

466 ià(
	`qu”y__´efix
(
s
, &
u
.
x
[0], &u.x[4], 
cÚ‹xt
, 
æags
)) {

467 
u
.
addr
[0] |= ~u.addr[1];

468 
	`memıy
(
¡Üe
, 
u
.
x
, 4);

469  
Œue
;

471  
çl£
;

472 } ià(
ty³¡r
.
	`equ®s
(":gw", 3)) {

473 ià(
NameInfo
::
	`qu”y
(NameInfo::
T_IP_ADDR
, 
cÚ‹xt
, 
suffixed_s
, 
¡Üe
, 4))

474  
Œue
;

475 ià(
NameInfo
::
	`qu”y
(NameInfo::
T_IP_PREFIX
, 
cÚ‹xt
, 
s
, &
u
.
x
[0], 8))

477 ià(
	`qu”y_Ãtdeviû
(
s
, 
¡Üe
, 
tc_v4gw
, 4, 
cÚ‹xt
, 
æags
))

478  
Œue
;

479 ià(
	`qu”y_Ãtdeviû
(
s
, &
u
.
x
[0], 
tc_v4´efix
, 8, 
cÚ‹xt
, 
æags
))

482  
çl£
;

483 
u
.
addr
[0] = (u.addr[0] & u.addr[1]è| 
	`htÚl
(1);

484 
	`memıy
(
¡Üe
, 
u
.
x
, 4);

485  
Œue
;

487  
çl£
;

490  
NameInfo
::
	`qu”y
(NameInfo::
T_IP_ADDR
, 
cÚ‹xt
, 
s
, 
¡Üe
, 4)

491 || 
	`qu”y_Ãtdeviû
(
s
, 
¡Üe
, 
tc_v4
, 4, 
cÚ‹xt
, 
æags
);

492 
	}
}

494 
boŞ


495 
	gAdd»ssInfo
::
	$qu”y__´efix
(
SŒšg
 
s
, *
¡Üe
,

496 *
mask_¡Üe
, cÚ¡ 
EËm’t
 *
cÚ‹xt
,

497 
æags
)

499 
cŞÚ
 = 
s
.
	`fšd_right
(':');

500 ià(
cŞÚ
 >= 0) {

501 
SŒšg
 
	`ty³¡r
(
s
.
	`sub¡ršg
(
cŞÚ
).
	`low”
());

502 ià(!
ty³¡r
.
	`equ®s
(":net", 4)

503 && !
ty³¡r
.
	`equ®s
(":ipnet", 6)

504 && !
ty³¡r
.
	`equ®s
(":ip4net", 7))

505  
çl£
;

506 
s
 = s.
	`sub¡ršg
(0, 
cŞÚ
);

509 
ušt8_t
 
d©a
[8];

510 ià(
NameInfo
::
	`qu”y
(NameInfo::
T_IP_PREFIX
, 
cÚ‹xt
, 
s
, &
d©a
[0], 8)

511 || 
	`qu”y_Ãtdeviû
(
s
, 
d©a
, 
tc_v4´efix
, 8, 
cÚ‹xt
, 
æags
)) {

512 
	`memıy
(
¡Üe
, &
d©a
[0], 4);

513 
	`memıy
(
mask_¡Üe
, &
d©a
[4], 4);

514  
Œue
;

516  
çl£
;

517 
	}
}

520 #ifdeà
HAVE_IP6


522 
boŞ


523 
	gAdd»ssInfo
::
	$qu”y_6
(
SŒšg
 
s
, *
¡Üe
, cÚ¡ 
EËm’t
 *
e
, )

525 
cŞÚ
 = 
s
.
	`fšd_right
(':');

526 ià(
cŞÚ
 >= 0) {

527 ià(!
s
.
	`sub¡ršg
(
cŞÚ
).
	`low”
().
	`equ®s
(":ip6", 4))

528  
çl£
;

529 
s
 = s.
	`sub¡ršg
(0, 
cŞÚ
);

532  
NameInfo
::
	`qu”y
(NameInfo::
T_IP6_ADDR
, 
e
, 
s
, 
¡Üe
, 16);

533 
	}
}

535 
boŞ


536 
	gAdd»ssInfo
::
	$qu”y_6_´efix
(
SŒšg
 
s
, *
¡Üe
,

537 *
b™s_¡Üe
, cÚ¡ 
EËm’t
 *
cÚ‹xt
, )

539 
cŞÚ
 = 
s
.
	`fšd_right
(':');

540 ià(
cŞÚ
 >= 0) {

541 ià(!
s
.
	`sub¡ršg
(
cŞÚ
).
	`low”
().
	`equ®s
(":ip6net", 7))

542  
çl£
;

543 
s
 = s.
	`sub¡ršg
(0, 
cŞÚ
);

547 
c
[16];

548 
p
;

549 } 
d©a
;

550 ià(
NameInfo
::
	`qu”y
(NameInfo::
T_IP6_PREFIX
, 
cÚ‹xt
, 
s
, &
d©a
, (data))) {

551 
	`memıy
(
¡Üe
, 
d©a
.
c
, 16);

552 *
b™s_¡Üe
 = 
d©a
.
p
;

553  
Œue
;

556  
çl£
;

557 
	}
}

562 
boŞ


563 
	gAdd»ssInfo
::
	$qu”y_‘h”Ãt
(
SŒšg
 
s
, *
¡Üe
, cÚ¡ 
EËm’t
 *
cÚ‹xt
,

564 
æags
)

566 
cŞÚ
 = 
s
.
	`fšd_right
(':');

567 ià(
cŞÚ
 >= 0) {

568 
SŒšg
 
	`ty³¡r
(
s
.
	`sub¡ršg
(
cŞÚ
).
	`low”
());

569 ià(!
ty³¡r
.
	`equ®s
(":eth", 4)

570 && !
ty³¡r
.
	`equ®s
(":ether", 6)

571 && !
ty³¡r
.
	`equ®s
(":ethernet", 9))

572  
çl£
;

573 
s
 = s.
	`sub¡ršg
(0, 
cŞÚ
);

576  
NameInfo
::
	`qu”y
(NameInfo::
T_ETHERNET_ADDR
, 
cÚ‹xt
, 
s
, 
¡Üe
, 6)

577 || 
	`qu”y_Ãtdeviû
(
s
, 
¡Üe
, 
tc_‘h”
, 6, 
cÚ‹xt
, 
æags
);

578 
	}
}

580 
CLICK_ENDDECLS


581 
	$EXPORT_ELEMENT
(
Add»ssInfo
)

582 
	`ELEMENT_HEADER
(<
şick
/
¡ªd¬d
/
add»ssšfo
.
hh
>)

	@standard/align.cc

18 
	~<şick/cÚfig.h
>

19 
	~"®ign.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gAlign
::
	$Align
()

27 
	}
}

30 
Align
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

32 
	gmodulus
;

33 ià(
Args
(
cÚf
, 
this
, 
”rh
)

34 .
»ad_mp
("MODULUS", 
modulus
)

35 .
»ad_mp
("OFFSET", 
_off£t
)

36 .
com¶‘e
() < 0)

38 ià(
	gmodulus
 !ğ2 && 
modulus
 != 4 && modulus != 8)

39  
”rh
->
”rÜ
("MODULUS must be 2, 4, or 8");

40 ià(
	g_off£t
 >ğ()
modulus
)

41  
”rh
->
”rÜ
("OFFSET must be smallerhan MODULUS");

42 
	g_mask
 = 
modulus
 - 1;

46 
Pack‘
 *

47 
	gAlign
::
	$smaùiÚ
(
Pack‘
 *
p
)

49 
d–
 = 
_off£t
 - (
»š‹½»t_ÿ¡
<
ušŒ_t
>(
p
->
	`d©a
()è& 
_mask
);

50 ià(
d–
 == 0)

51  
p
;

52 ià(
d–
 < 0)

53 
d–
 +ğ
_mask
 + 1;

54  
p
->
	`shiá_d©a
(
d–
);

55 
	}
}

58 
	gAlign
::
	$push
(, 
Pack‘
 *
p
)

60 
	`ouut
(0).
	`push
(
	`smaùiÚ
(
p
));

61 
	}
}

63 
Pack‘
 *

64 
	gAlign
::
	$puÎ
()

66 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

67  (
p
 ? 
	`smaùiÚ
(p) : 0);

68 
	}
}

70 
CLICK_ENDDECLS


71 
	$EXPORT_ELEMENT
(
Align
)

72 
	`ELEMENT_MT_SAFE
(
Align
)

	@standard/align.hh

1 #iâdeà
CLICK_ALIGN_HH


2 
	#CLICK_ALIGN_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


27 şas 
	cAlign
 : 
public
 
EËm’t
 {

29 
_off£t
;

30 
	m_mask
;

32 
	mpublic
:

34 
	$Align
(è
CLICK_COLD
;

36 cÚ¡ *
	$şass_Çme
() const {  "Align"; }

37 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

39 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

41 
Pack‘
 *
smaùiÚ
(Packet *);

42 
push
(, 
Pack‘
 *);

43 
Pack‘
 *
puÎ
();

47 
	gCLICK_ENDDECLS


	@standard/alignmentinfo.cc

20 
	~<şick/cÚfig.h
>

21 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/rou‹r.hh
>

25 
	~<şick/”rÜ.hh
>

26 
CLICK_DECLS


28 
	gAlignm’tInfo
::
	$Alignm’tInfo
()

30 
	}
}

33 
Alignm’tInfo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 ià(*
	ga
 = 
rou‹r
()->
©chm’t
("AlignmentInfo"))

37 ià(
a
 !ğ
this
)

38  ((
Alignm’tInfo
 *)
a
)->
cÚfigu»
(
cÚf
, 
”rh
);

39 
rou‹r
()->
£t_©chm’t
("Alignm’tInfo", 
this
);

42 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

43 
	gVeùÜ
<
	gSŒšg
> 
	g·¹s
;

44 
ı_¥aûvec
(
cÚf
[
i
], 
·¹s
);

46 ià(
	g·¹s
.
size
() == 0)

47 
”rh
->
w¬nšg
("em±y cÚfigu¿tiÚ‡rgum’ˆ%d", 
i
);

49 ià(
EËm’t
 *
	ge
 = 
ı_–em’t
(
·¹s
[0], 
this
, 0)) {

50 
	gnumb”
 = 
e
->
ešdex
();

51 ià(
	g_–em_off£t
.
size
(è<ğ
numb”
) {

52 
_–em_off£t
.
»size
(
numb”
 + 1, -1);

53 
	g_–em_icouÁ
.
»size
(
numb”
 + 1, -1);

56 
	gŞd_off£t
 = 
_–em_off£t
[
numb”
];

57 
	gŞd_icouÁ
 = 
_–em_icouÁ
[
numb”
];

58 ià(
	g·¹s
.
size
() % 2 != 1)

59 
”rh
->
”rÜ
("expected %<ELEMENTNAME CHUNK OFFSET [CHUNK OFFSET...]%>");

60 
	g_–em_off£t
[
numb”
] = 
_chunks
.
size
();

61 
	g_–em_icouÁ
[
numb”
] = (
·¹s
.
size
() - 1) / 2;

62 
	gj
 = 1; j < 
	g·¹s
.
size
() - 1; j += 2) {

63 
št32_t
 
c
 = -1, 
	go
 = -1;

64 ià(!
IÁArg
().
·r£
(
·¹s
[
j
], 
c
))

65 
	g”rh
->
”rÜ
("expected CHUNK");

66 ià(!
IÁArg
().
·r£
(
·¹s
[
j
+1], 
o
))

67 
	g”rh
->
”rÜ
("expected OFFSET");

68 
	g_chunks
.
push_back
(
c
);

69 
	g_off£ts
.
push_back
(
o
);

72 ià(
	gŞd_off£t
 >= 0

73 && (
Şd_icouÁ
 !ğ
_–em_icouÁ
[
numb”
]

74 || 
memcmp
(&
_chunks
[
Şd_off£t
], &_chunks[
_–em_off£t
[
numb”
]],

75 
Şd_icouÁ
 * ()) != 0

76 || 
memcmp
(&
_off£ts
[
Şd_off£t
], &_off£ts[
_–em_off£t
[
numb”
]],

77 
Şd_icouÁ
 * ()) != 0))

78 
”rh
->
”rÜ
("cÚæiùšg Alignm’tInfØfÜ %<%s%>", 
·¹s
[0].
c_¡r
());

86 
boŞ


87 
	gAlignm’tInfo
::
	$qu”y1
(cÚ¡ 
EËm’t
 *
e
, 
pÜt
, &
chunk
, &
off£t
) const

89 
idx
 = 
e
->
	`ešdex
();

90 ià(
idx
 < 0 || idx >ğ
_–em_off£t
.
	`size
() || _elem_offset[idx] < 0

91 || 
pÜt
 >ğ
_–em_icouÁ
[
idx
])

92  
çl£
;

94 
chunk
 = 
_chunks
[ 
_–em_off£t
[
idx
] + 
pÜt
 ];

95 
off£t
 = 
_off£ts
[ 
_–em_off£t
[
idx
] + 
pÜt
 ];

96  
Œue
;

98 
	}
}

100 
boŞ


101 
	gAlignm’tInfo
::
	$qu”y
(cÚ¡ 
EËm’t
 *
e
, 
pÜt
, &
chunk
, &
off£t
)

103 ià(*
a
 = 
e
->
	`rou‹r
()->
	`©chm’t
("AlignmentInfo"))

104  ((
Alignm’tInfo
 *)
a
)->
	`qu”y1
(
e
, 
pÜt
, 
chunk
, 
off£t
);

106  
çl£
;

107 
	}
}

109 
CLICK_ENDDECLS


110 
	$EXPORT_ELEMENT
(
Alignm’tInfo
)

111 
	`ELEMENT_HEADER
(<
şick
/
¡ªd¬d
/
®ignm’tšfo
.
hh
>)

	@standard/annotationinfo.cc

19 
	~<şick/cÚfig.h
>

20 
	~"ªnÙ©iÚšfo.hh
"

21 
	~<şick/Çmešfo.hh
>

22 
	~<şick/cÚå¬£.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
	~<şick/”rÜ.hh
>

25 
CLICK_DECLS


27 
	gAÂÙ©iÚInfo
::
	$AÂÙ©iÚInfo
()

29 
	}
}

32 
AÂÙ©iÚInfo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

34 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

35 
SŒšg
 
	g¡r
 = 
cÚf
[
i
];

36 
SŒšg
 
	gÇme_¡r
 = 
ı_shiá_¥aûvec
(
¡r
);

37 ià(!
	gÇme_¡r


38 || 
	gÇme_¡r
[0] == '#'

39 || 
Çme_¡r
.
equ®s
("CHECK_OVERLAP", 13))

42 
SŒšg
 
	goff£t_¡r
 = 
ı_shiá_¥aûvec
(
¡r
);

43 
SŒšg
 
	gsize_¡r
 = 
ı_shiá_¥aûvec
(
¡r
);

45 
	goff£t
, 
	gsize
 = 0;

46 ià(!
ı_is_wÜd
(
Çme_¡r
è|| 
ı_ªno
Òame_¡r, 0, &
off£t
, 0))

47 
	g”rh
->
”rÜ
("bad NAME %<%s%>", 
Çme_¡r
.
c_¡r
());

48 ià(!
ı_ªno
(
off£t_¡r
, 0, &
off£t
, 
this
)

49 || (
	gsize_¡r
 && !
IÁArg
().
·r£
(
size_¡r
, 
size
))

50 || 
	gsize
 < 0

51 || 
ANNOTATIONINFO_OFFSET
(
off£t
è+ 
	gsize
 > 
	gPack‘
::
ªno_size


52 || (
size
 && 
ANNOTATIONINFO_SIZE
(
off£t
)

53 && 
size
 !ğ
ANNOTATIONINFO_SIZE
(
off£t
))

54 || 
¡r
)

55 
”rh
->
”rÜ
("badƒÁry fÜ %<%s%>", 
Çme_¡r
.
c_¡r
());

57 
ušt32_t
 
	gªno
 = 
MAKE_ANNOTATIONINFO
(
ANNOTATIONINFO_OFFSET
(
off£t
), 
size
);

58 
	gNameInfo
::
defše
(
NameInfo
::
T_ANNOTATION
, 
this
, 
Çme_¡r
, &
ªno
, 4);

62  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

66 
	gAÂÙ©iÚInfo
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

68 
VeùÜ
<
SŒšg
> 
cÚf
;

69 
	`ı_¬gvec
(
	`cÚfigu¿tiÚ
(), 
cÚf
);

70 
i
 = 0; i < 
cÚf
.
	`size
(); i++) {

71 
VeùÜ
<
SŒšg
> 
wÜds
;

72 
	`ı_¥aûvec
(
cÚf
[
i
], 
wÜds
);

73 ià(
wÜds
.
	`size
(è=ğ0 || !wÜds[0].
	`equ®s
("CHECK_OVERLAP", 13))

76 
off£t
;

77 
VeùÜ
<> 
	`off£ts
(
wÜds
.
	`size
(), -1);

78 
i
 = 1; i < 
wÜds
.
	`size
(); ++i)

79 ià(
	`ı_ªno
(
wÜds
[
i
], 0, &
off£t
, 
this
))

80 
off£ts
[
i
] = 
off£t
;

82 
”rh
->
	`”rÜ
("bad ANNO %<%s%>", 
wÜds
[
i
].
	`c_¡r
());

84 
i
 = 1; i < 
wÜds
.
	`size
(); ++i)

85 
j
 = 
i
 + 1; j < 
wÜds
.
	`size
(); ++j) {

86 
isize
 = 
	`ANNOTATIONINFO_SIZE
(
off£ts
[
i
]);

87 
jsize
 = 
	`ANNOTATIONINFO_SIZE
(
off£ts
[
j
]);

88 
isize
 = (isize <= 0 ? 1 : isize);

89 
jsize
 = (jsize <= 0 ? 1 : jsize);

90 ià(
off£ts
[
i
] == -1

91 || 
off£ts
[
j
] == -1

92 || (
	`ANNOTATIONINFO_OFFSET
(
off£ts
[
i
]è+ 
isize
 <ğANNOTATIONINFO_OFFSET(off£ts[
j
]))

93 || (
	`ANNOTATIONINFO_OFFSET
(
off£ts
[
j
]è+ 
jsize
 <ğANNOTATIONINFO_OFFSET(off£ts[
i
])))

96 
”rh
->
	`”rÜ
("ªnÙ©iÚ %<%s%>‡nd %<%s%> cÚæiù", 
wÜds
[
i
].
	`c_¡r
(), wÜds[
j
].c_str());

100  
”rh
->
	`Ã¼Üs
() ? -1 : 0;

101 
	}
}

103 
	$EXPORT_ELEMENT
(
AÂÙ©iÚInfo
)

104 
CLICK_ENDDECLS


	@standard/annotationinfo.hh

1 #iâdeà
CLICK_ANNOTATIONINFO_HH


2 
	#CLICK_ANNOTATIONINFO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


29 şas 
	cAÂÙ©iÚInfo
 : 
public
 
EËm’t
 {…ublic:

31 
	$AÂÙ©iÚInfo
(è
CLICK_COLD
;

33 cÚ¡ *
	$şass_Çme
() const {  "AnnotationInfo"; }

35 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_FIRST
; 
	}
}

36 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

37 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

39 
	}
};

41 
	gCLICK_ENDDECLS


	@standard/averagecounter.cc

18 
	~<şick/cÚfig.h
>

19 
	~"av”agecouÁ”.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/¡¿ccum.hh
>

22 
	~<şick/sync.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şick/”rÜ.hh
>

25 
CLICK_DECLS


27 
	gAv”ageCouÁ”
::
	$Av”ageCouÁ”
()

29 
	}
}

32 
Av”ageCouÁ”
::
	$»£t
()

34 
_couÁ
 = 0;

35 
_by‹_couÁ
 = 0;

36 
_fœ¡
 = 0;

37 
_Ï¡
 = 0;

38 
	}
}

41 
	gAv”ageCouÁ”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

43 
	g_ignÜe
 = 0;

44 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("IGNORE", 
_ignÜe
).
com¶‘e
() < 0)

46 
	g_ignÜe
 *ğ
CLICK_HZ
;

51 
	gAv”ageCouÁ”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

53 
	`»£t
();

55 
	}
}

57 
Pack‘
 *

58 
	gAv”ageCouÁ”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

60 
ušt32_t
 
j·¹
 = 
	`şick_jiff›s
();

61 
_fœ¡
.
	`com·»_sw­
(0, 
j·¹
);

62 ià(
j·¹
 - 
_fœ¡
 >ğ
_ignÜe
) {

63 
_couÁ
++;

64 
_by‹_couÁ
 +ğ
p
->
	`Ëngth
();

66 
_Ï¡
 = 
j·¹
;

67  
p
;

68 
	}
}

70 
SŒšg


71 
	$av”agecouÁ”_»ad_couÁ_hªdËr
(
EËm’t
 *
e
, *
thunk
)

73 
Av”ageCouÁ”
 *
c
 = (Av”ageCouÁ” *)
e
;

74  
	`SŒšg
(
thunk
 ? 
c
->
	`by‹_couÁ
(è: c->
	`couÁ
());

75 
	}
}

77 
SŒšg


78 
	$av”agecouÁ”_»ad_¿‹_hªdËr
(
EËm’t
 *
e
, *
thunk
)

80 
Av”ageCouÁ”
 *
c
 = (Av”ageCouÁ” *)
e
;

81 
ušt32_t
 
d
 = 
c
->
	`Ï¡
(è- c->
	`fœ¡
();

82 
d
 -ğ
c
->
	`ignÜe
();

83 ià(
d
 < 1) d = 1;

84 
ušt32_t
 
couÁ
 = (
thunk
 ? 
c
->
	`by‹_couÁ
(è: c->
	`couÁ
());

85 #ià
CLICK_USERLEVEL


86  
	`SŒšg
(((è
couÁ
 * 
CLICK_HZ
è/ 
d
);

88 
ušt32_t
 
¿‹
;

89 ià(
couÁ
 < (
ušt32_t
è(0xFFFFFFFFU / 
CLICK_HZ
))

90 
¿‹
 = (
couÁ
 * 
CLICK_HZ
è/ 
d
;

92 
¿‹
 = (
couÁ
 / 
d
è* 
CLICK_HZ
;

93  
	`SŒšg
(
¿‹
);

95 
	}
}

98 
	gav”agecouÁ”_»£t_wr™e_hªdËr


99 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *)

101 
Av”ageCouÁ”
 *
	gc
 = (Av”ageCouÁ” *)
e
;

102 
	gc
->
»£t
();

107 
	gAv”ageCouÁ”
::
	$add_hªdËrs
()

109 
	`add_»ad_hªdËr
("couÁ", 
av”agecouÁ”_»ad_couÁ_hªdËr
, 0);

110 
	`add_»ad_hªdËr
("by‹_couÁ", 
av”agecouÁ”_»ad_couÁ_hªdËr
, 1);

111 
	`add_»ad_hªdËr
("¿‹", 
av”agecouÁ”_»ad_¿‹_hªdËr
, 0);

112 
	`add_»ad_hªdËr
("by‹_¿‹", 
av”agecouÁ”_»ad_¿‹_hªdËr
, 1);

113 
	`add_wr™e_hªdËr
("»£t", 
av”agecouÁ”_»£t_wr™e_hªdËr
, 0, 
HªdËr
::
BUTTON
);

114 
	}
}

116 
CLICK_ENDDECLS


117 
	$EXPORT_ELEMENT
(
Av”ageCouÁ”
)

118 
	`ELEMENT_MT_SAFE
(
Av”ageCouÁ”
)

	@standard/averagecounter.hh

1 #iâdeà
CLICK_AVERAGECOUNTER_HH


2 
	#CLICK_AVERAGECOUNTER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/ewma.hh
>

5 
	~<şick/©omic.hh
>

6 
	~<şick/tim”.hh
>

7 
CLICK_DECLS


43 şas 
	cAv”ageCouÁ”
 : 
public
 
EËm’t
 {…ublic:

45 
	$Av”ageCouÁ”
(è
CLICK_COLD
;

47 cÚ¡ *
	$şass_Çme
() const {  "AverageCounter"; }

48 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

49 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

51 
ušt32_t
 
	$couÁ
(ècÚ¡ {  
_couÁ
; 
	}
}

52 
ušt32_t
 
	$by‹_couÁ
(ècÚ¡ {  
_by‹_couÁ
; 
	}
}

53 
ušt32_t
 
	$fœ¡
(ècÚ¡ {  
_fœ¡
; 
	}
}

54 
ušt32_t
 
	$Ï¡
(ècÚ¡ {  
_Ï¡
; 
	}
}

55 
ušt32_t
 
	$ignÜe
(ècÚ¡ {  
_ignÜe
; 
	}
}

56 
»£t
();

58 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

59 
	$add_hªdËrs
(è
CLICK_COLD
;

61 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

63 
´iv©e
:

65 
©omic_ušt32_t
 
_couÁ
;

66 
©omic_ušt32_t
 
_by‹_couÁ
;

67 
©omic_ušt32_t
 
_fœ¡
;

68 
©omic_ušt32_t
 
_Ï¡
;

69 
ušt32_t
 
_ignÜe
;

71 
	}
};

73 
	gCLICK_ENDDECLS


	@standard/bandwidthmeter.cc

19 
	~<şick/cÚfig.h
>

20 
	~"bªdwidthm‘”.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/¬gs.hh
>

23 
CLICK_DECLS


25 
	gBªdwidthM‘”
::
	$BªdwidthM‘”
()

26 : 
	`_m‘”s
(0), 
	$_nm‘”s
(0)

28 
	}
}

30 
	gBªdwidthM‘”
::~
	$BªdwidthM‘”
()

32 
d–‘e
[] 
_m‘”s
;

33 
	}
}

36 
	gBªdwidthM‘”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

38 
	gd–‘e
[] 
	g_m‘”s
;

39 
	g_m‘”s
 = 0;

40 
	g_nm‘”s
 = 0;

42 ià(
	gcÚf
.
size
() == 0)

43  
”rh
->
”rÜ
("too few‡rgumentso BandwidthMeter(bandwidth, ...)");

45 
	gVeùÜ
<> 
v®s
(
cÚf
.
size
(), 0);

46 
BªdwidthArg
 
	gba
;

47 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++)

48 ià(!
	gba
.
·r£
(
cÚf
[
i
], 
v®s
[i]))

49  
	g”rh
->
”rÜ
("¬gum’ˆ%d syÁaxƒ¼Ü", 
i
+1);

50 ià(
	gi
 > 0 && 
	gv®s
[
i
] <ğ
v®s
[i-1])

51  
”rh
->
”rÜ
("¿‹ %d mu¡ b>„©%d", 
i
+1, i);

52 ià(
	gba
.
	g¡©us
 =ğ
NumArg
::
¡©us_un™Ëss
)

53 
”rh
->
w¬nšg
("nØun™ fÜ bªdwidth‡rgum’ˆ%d,‡ssumšg Bps", 
i
+1);

55 
	gmax_v®ue
 = 0xFFFFFFFF >> 
_¿‹
.
sÿË
();

56 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

57 ià(
	gv®s
[
i
] > 
	gmax_v®ue
)

58  
	g”rh
->
”rÜ
("¿‹ %doØÏrg(max %u)", 
i
+1, 
max_v®ue
);

59 
	gv®s
[
i
] = (
v®s
[i]<<
_¿‹
.
sÿË
()è/ _¿‹.
•och_äequ’cy
();

62 ià(
	gv®s
.
size
() == 1) {

63 
_m‘”1
 = 
v®s
[0];

64 
	g_nm‘”s
 = 1;

66 
	g_m‘”s
 = 
Ãw
 [
v®s
.
size
()];

67 
memıy
(
_m‘”s
, &
v®s
[0], v®s.
size
() * ());

68 
	g_nm‘”s
 = 
v®s
.
size
();

71 ià(
	g_nm‘”s
 + 1 !ğ
nouuts
())

72  
”rh
->
”rÜ
("Ãed %d‡rgum’ts, oÃ†es thªhnumb” oàouuˆpÜts", 
nouuts
() - 1);

77 
	gBªdwidthM‘”
::
	$push
(, 
Pack‘
 *
p
)

79 
_¿‹
.
	`upd©e
(
p
->
	`Ëngth
());

81 
r
 = 
_¿‹
.
	`sÿËd_av”age
();

82 ià(
_nm‘”s
 < 2) {

83 
n
 = (
r
 >ğ
_m‘”1
);

84 
	`ouut
(
n
).
	`push
(
p
);

86 *
m‘”s
 = 
_m‘”s
;

87 
nm‘”s
 = 
_nm‘”s
;

88 
i
 = 0; i < 
nm‘”s
; i++)

89 ià(
r
 < 
m‘”s
[
i
]) {

90 
	`ouut
(
i
).
	`push
(
p
);

93 
	`ouut
(
nm‘”s
).
	`push
(
p
);

95 
	}
}

97 
SŒšg


98 
	gBªdwidthM‘”
::
	$m‘”s_»ad_hªdËr
(
EËm’t
 *
f
, *)

100 
BªdwidthM‘”
 *
m
 = (BªdwidthM‘” *)
f
;

101 ià(
m
->
_nm‘”s
 == 1)

102  
	`ı_uÅ¬£_»®2
(
m
->
_m‘”1
*m->
	`¿‹_äeq
(), m->
	`¿‹_sÿË
());

104 
SŒšg
 
s
;

105 
i
 = 0; i < 
m
->
_nm‘”s
; i++)

106 
s
 = s + 
	`ı_uÅ¬£_»®2
(
m
->
_m‘”s
[
i
]*m->
	`¿‹_äeq
(), m->
	`¿‹_sÿË
());

107  
s
;

109 
	}
}

111 
SŒšg


112 
	gBªdwidthM‘”
::
	$»ad_¿‹_hªdËr
(
EËm’t
 *
f
, *)

114 
BªdwidthM‘”
 *
c
 = (BªdwidthM‘” *)
f
;

115 
c
->
_¿‹
.
	`upd©e
(0);

116  
	`ı_uÅ¬£_»®2
(
c
->
	`sÿËd_¿‹
()*c->
	`¿‹_äeq
(), c->
	`¿‹_sÿË
());

117 
	}
}

120 
	gBªdwidthM‘”
::
	$add_hªdËrs
()

122 
	`add_»ad_hªdËr
("¿‹", 
»ad_¿‹_hªdËr
, 0);

123 
	`add_»ad_hªdËr
("m‘”s", 
BªdwidthM‘”
::
m‘”s_»ad_hªdËr
, 0);

124 
	}
}

126 
CLICK_ENDDECLS


127 
EXPORT_ELEMENT
(
BªdwidthM‘”
)

	@standard/bandwidthmeter.hh

1 #iâdeà
CLICK_BANDWIDTHMETER_HH


2 
	#CLICK_BANDWIDTHMETER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/ewma.hh
>

5 
CLICK_DECLS


38 şas 
	cBªdwidthM‘”
 : 
public
 
EËm’t
 { 
´Ùeùed
:

40 
R©eEWMA
 
_¿‹
;

42 
	m_m‘”1
;

43 *
	m_m‘”s
;

44 
	m_nm‘”s
;

46 
SŒšg
 
	$m‘”s_»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

47 
SŒšg
 
	`»ad_¿‹_hªdËr
(
EËm’t
 *, *);

49 
public
:

51 
	$BªdwidthM‘”
(è
CLICK_COLD
;

52 ~
	$BªdwidthM‘”
(è
CLICK_COLD
;

54 cÚ¡ *
	$şass_Çme
() const {  "BandwidthMeter"; }

55 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/2-"; 
	}
}

56 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

58 
	$sÿËd_¿‹
(ècÚ¡ {  
_¿‹
.
	`sÿËd_av”age
(); 
	}
}

59 
	$¿‹_sÿË
(ècÚ¡ {  
_¿‹
.
	`sÿË
(); 
	}
}

60 
	$¿‹_äeq
(ècÚ¡ {  
_¿‹
.
	`•och_äequ’cy
(); 
	}
}

62 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

63 
	$add_hªdËrs
(è
CLICK_COLD
;

65 
	`push
(
pÜt
, 
Pack‘
 *);

67 
	}
};

69 
	gCLICK_ENDDECLS


	@standard/bandwidthshaper.cc

21 
	~<şick/cÚfig.h
>

22 
	~"bªdwidthsh­”.hh
"

23 
CLICK_DECLS


25 
	gBªdwidthSh­”
::
	$BªdwidthSh­”
()

27 
	}
}

29 
Pack‘
 *

30 
BªdwidthSh­”
::
	$puÎ
()

32 
Pack‘
 *
p
 = 0;

33 ià(
_¿‹
.
	`Ãed_upd©e
(
Time¡amp
::
	`now
())) {

34 ià((
p
 = 
	`šput
(0).
	`puÎ
()))

35 
_¿‹
.
	`upd©e_w™h
(
p
->
	`Ëngth
());

37  
p
;

38 
	}
}

40 
CLICK_ENDDECLS


41 
	$ELEMENT_REQUIRES
(
Sh­”
)

42 
	`EXPORT_ELEMENT
(
BªdwidthSh­”
)

	@standard/bandwidthshaper.hh

2 #iâdeà
CLICK_BANDWIDTHSHAPER_HH


3 
	#CLICK_BANDWIDTHSHAPER_HH


	)

4 
	~"sh­”.hh
"

5 
CLICK_DECLS


28 şas 
	cBªdwidthSh­”
 : 
public
 
Sh­”
 {…ublic:

30 
	$BªdwidthSh­”
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "BandwidthShaper"; }

34 
Pack‘
 *
	`puÎ
();

36 
	}
};

38 
	gCLICK_ENDDECLS


	@standard/block.cc

18 
	~<şick/cÚfig.h
>

19 
	~"block.hh
"

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
CLICK_DECLS


25 
	gBlock
::
	$Block
()

27 
	}
}

30 
Block
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

32  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("THRESH", 
_th»sh
).
com¶‘e
();

36 
	gBlock
::
	$push
(, 
Pack‘
 *
·ck‘
)

38 if(
_th»sh
 =ğ0 || 
	`FWD_RATE_ANNO
(
·ck‘
) <= _thresh)

39 
	`ouut
(0).
	`push
(
·ck‘
);

41 
	`ouut
(1).
	`push
(
·ck‘
);

42 
	}
}

46 
	gBlock
::
	$th»sh_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

48 
VeùÜ
<
SŒšg
> 
¬gs
;

49 
	`ı_¬gvec
(
cÚf
, 
¬gs
);

50 
Block
* 
me
 = (Block *è
e
;

52 if(
¬gs
.
	`size
() != 1) {

53 
”rh
->
	`”rÜ
("expecting 1 integer");

56 
th»sh
;

57 if(!
	`IÁArg
().
	`·r£
(
¬gs
[0], 
th»sh
)) {

58 
”rh
->
	`”rÜ
("not‡n integer");

61 
me
->
_th»sh
 = 
th»sh
;

63 
	}
}

65 
SŒšg


66 
	gBlock
::
	$th»sh_»ad_hªdËr
(
EËm’t
 *
e
, *)

68 
Block
 *
me
 = (Block *è
e
;

69  
	`SŒšg
(
me
->
_th»sh
);

70 
	}
}

73 
	gBlock
::
	$add_hªdËrs
()

75 
	`add_»ad_hªdËr
("th»sh", 
th»sh_»ad_hªdËr
, 0);

76 
	`add_wr™e_hªdËr
("th»sh", 
th»sh_wr™e_hªdËr
, 0);

77 
	}
}

79 
CLICK_ENDDECLS


80 
	$EXPORT_ELEMENT
(
Block
)

81 
	`ELEMENT_MT_SAFE
(
Block
)

	@standard/block.hh

1 #iâdeà
CLICK_BLOCK_HH


2 
	#CLICK_BLOCK_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


35 şas 
	cBlock
 : 
public
 
EËm’t
 {

37 
public
:

39 
	$Block
(è
CLICK_COLD
;

41 cÚ¡ *
	$şass_Çme
() const {  "Block"; }

42 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/2"; 
	}
}

43 
	$add_hªdËrs
(è
CLICK_COLD
;

45 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

48 
	`push
(
pÜt
, 
Pack‘
 *);

51 
´iv©e
:

53 
_th»sh
;

55 
	$th»sh_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

56 
SŒšg
 
	$th»sh_»ad_hªdËr
(
EËm’t
 *
e
, *è
CLICK_COLD
;

58 
	}
};

60 
	gCLICK_ENDDECLS


	@standard/burster.cc

20 
	~<şick/cÚfig.h
>

21 
	~"bur¡”.hh
"

22 
CLICK_DECLS


24 
	gBur¡”
::
	$Bur¡”
()

26 
_bur¡
 = 8;

27 
	}
}

30 
	gBur¡”
::
	$ÿ¡
(cÚ¡ *
Çme
)

32 ià(
	`¡rcmp
(
Çme
, "TimedUnqueue") == 0)

33  (
TimedUnqueue
 *è
this
;

35  
EËm’t
::
	`ÿ¡
(
Çme
);

36 
	}
}

38 
CLICK_ENDDECLS


39 
	$ELEMENT_REQUIRES
(
TimedUnqueue
)

40 
	`EXPORT_ELEMENT
(
Bur¡”
)

	@standard/burster.hh

1 #iâdeà
CLICK_BURSTER_HH


2 
	#CLICK_BURSTER_HH


	)

3 
	~"timedunqueue.hh
"

4 
CLICK_DECLS


19 şas 
	cBur¡”
 : 
public
 
TimedUnqueue
 {…ublic:

21 
	$Bur¡”
(è
CLICK_COLD
;

23 cÚ¡ *
	$şass_Çme
() const {  "Burster"; }

24 *
	`ÿ¡
(cÚ¡ *
Çme
);

26 
	}
};

28 
	gCLICK_ENDDECLS


	@standard/bwratedsplitter.cc

20 
	~<şick/cÚfig.h
>

21 
	~"bw¿‹d¥l™‹r.hh
"

22 
	~"¿‹dunqueue.hh
"

23 
CLICK_DECLS


25 
	gBªdwidthR©edS¶™‹r
::
	$BªdwidthR©edS¶™‹r
()

27 
	}
}

30 
BªdwidthR©edS¶™‹r
::
	$push
(, 
Pack‘
 *
p
)

32 
_tb
.
	`»fl
();

33 ià(
_tb
.
	`cÚšs
(
R©edUnqueue
::
tb_bªdwidth_th»sh
)) {

34 
_tb
.
	`»move
(
p
->
	`Ëngth
());

35 
	`ouut
(0).
	`push
(
p
);

37 
	`checked_ouut_push
(1, 
p
);

38 
	}
}

40 
CLICK_ENDDECLS


41 
	$ELEMENT_REQUIRES
(
R©edS¶™‹r
)

42 
	`EXPORT_ELEMENT
(
BªdwidthR©edS¶™‹r
)

	@standard/bwratedsplitter.hh

2 #iâdeà
CLICK_BWRATEDSPLITTER_HH


3 
	#CLICK_BWRATEDSPLITTER_HH


	)

4 
	~"–em’ts/¡ªd¬d/¿‹d¥l™‹r.hh
"

5 
CLICK_DECLS


49 şas 
	cBªdwidthR©edS¶™‹r
 : 
public
 
R©edS¶™‹r
 {…ublic:

51 
	$BªdwidthR©edS¶™‹r
(è
CLICK_COLD
;

53 cÚ¡ *
	$şass_Çme
() const {  "BandwidthRatedSplitter"; }

55 
	`push
(
pÜt
, 
Pack‘
 *);

57 
	}
};

59 
	gCLICK_ENDDECLS


	@standard/bwratedunqueue.cc

21 
	~<şick/cÚfig.h
>

22 
	~"bw¿‹dunqueue.hh
"

23 
CLICK_DECLS


25 
	gBªdwidthR©edUnqueue
::
	$BªdwidthR©edUnqueue
()

27 
	}
}

29 
boŞ


30 
BªdwidthR©edUnqueue
::
	$run_sk
(
Task
 *)

32 
boŞ
 
wÜked
 = 
çl£
;

33 
_runs
++;

35 ià(!
_aùive
)

36  
çl£
;

38 
_tb
.
	`»fl
();

40 ià(
_tb
.
	`cÚšs
(
tb_bªdwidth_th»sh
)) {

41 ià(
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
()) {

42 
_tb
.
	`»move
(
p
->
	`Ëngth
());

43 
_pushes
++;

44 
wÜked
 = 
Œue
;

45 
	`ouut
(0).
	`push
(
p
);

47 
_çed_puÎs
++;

48 ià(!
_sigÇl
)

49  
çl£
;

52 
_tim”
.
	`scheduË_aá”
(
Time¡amp
::
	`make_jiff›s
(
_tb
.
	`time_uÁ_cÚšs
(
tb_bªdwidth_th»sh
)));

53 
_em±y_runs
++;

54  
çl£
;

56 
_sk
.
	`ç¡_»scheduË
();

57 ià(!
wÜked
)

58 
_em±y_runs
++;

59  
wÜked
;

60 
	}
}

62 
CLICK_ENDDECLS


63 
	$ELEMENT_REQUIRES
(
R©edUnqueue
)

64 
	$EXPORT_ELEMENT
(
BªdwidthR©edUnqueue
)

65 
	`ELEMENT_MT_SAFE
(
BªdwidthR©edUnqueue
)

	@standard/bwratedunqueue.hh

2 #iâdeà
CLICK_BWRATEDUNQUEUE_HH


3 
	#CLICK_BWRATEDUNQUEUE_HH


	)

4 
	~"–em’ts/¡ªd¬d/¿‹dunqueue.hh
"

5 
CLICK_DECLS


41 şas 
	cBªdwidthR©edUnqueue
 : 
public
 
R©edUnqueue
 {…ublic:

43 
	$BªdwidthR©edUnqueue
(è
CLICK_COLD
;

45 cÚ¡ *
	$şass_Çme
() const {  "BandwidthRatedUnqueue"; }

47 
boŞ
 
	`run_sk
(
Task
 *);

49 
	}
};

51 
	gCLICK_ENDDECLS


	@standard/bypass.cc

18 
	~<şick/cÚfig.h
>

19 
	~"by·ss.hh
"

20 
	~<şick/rou‹r.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gBy·ss
::
	$By·ss
()

26 : 
	`_aùive
(
çl£
), 
	$_šlše
(
çl£
)

28 
	}
}

31 
	gBy·ss
::
	$ÿ¡
(cÚ¡ *
Çme
)

33 ià(
	`¡rcmp
(
Çme
, "Bypass") == 0)

34  
this
;

35  
EËm’t
::
	`ÿ¡
(
Çme
);

36 
	}
}

39 
	gBy·ss
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41 ià(
Args
(
cÚf
, 
this
, 
”rh
)

42 .
»ad_p
("ACTIVE", 
_aùive
)

43 .
»ad
("INLINE", 
_šlše
)

44 .
com¶‘e
() < 0)

50 
	gBy·ss
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

52 
	`fix
();

54 
	}
}

57 
	gBy·ss
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

59 
	`ouut
(
_aùive
 && !
pÜt
 && 
	`nouuts
(è> 1).
	`push
(
p
);

60 
	}
}

62 
Pack‘
 *

63 
	gBy·ss
::
	$puÎ
(
pÜt
)

65  
	`šput
(
_aùive
 && !
pÜt
 && 
	`nšputs
(è> 1).
	`puÎ
();

66 
	}
}

68 
	gBy·ss
::
LoÿtÜ
::
	$LoÿtÜ
(
äom_pÜt
)

69 : 
	`_e
(0), 
	`_pÜt
(0), 
	$_äom_pÜt
(
äom_pÜt
) {

70 
	}
}

72 
boŞ


73 
	gBy·ss
::
LoÿtÜ
::
	$vis™
(
EËm’t
* 
e
, 
boŞ
 
isouut
, 
pÜt
,

74 
EËm’t
*, 
äom_pÜt
, )

77 ià(
äom_pÜt
 !ğ
_äom_pÜt
)

78  
çl£
;

79 ià(
By·ss
* 
b
 = 
¡©ic_ÿ¡
<By·ss*>(
e
->
	`ÿ¡
("Bypass")))

80 ià(!
b
->
_šlše
) {

81 
_äom_pÜt
 = 
b
->
_aùive
 && 
pÜt
 =ğ0 && b->
	`ÅÜts
(!
isouut
) > 1;

82  
Œue
;

84 
_e
 = 
e
;

85 
_pÜt
 = 
pÜt
;

86  
çl£
;

87 
	}
}

89 
	gBy·ss
::
AssigÃr
::
	$AssigÃr
(
EËm’t
* 
e
, 
pÜt
)

90 : 
	`_e
(
e
), 
	$_pÜt
(
pÜt
) {

91 
	}
}

93 
boŞ


94 
	gBy·ss
::
AssigÃr
::
	$vis™
(
EËm’t
* 
e
, 
boŞ
 
isouut
, 
pÜt
,

95 
EËm’t
* 
äom_e
, 
äom_pÜt
, )

97 ià(
_š‹»¡šg
.
	`em±y
()) {

98 
_š‹»¡šg
.
	`push_back
(
äom_e
->
	`ešdex
());

99 
_š‹»¡šg
.
	`push_back
(3);

101 
i
 = 0; i !ğ
_š‹»¡šg
.
	`size
(); i += 2)

102 ià(
_š‹»¡šg
[
i
] =ğ
äom_e
->
	`ešdex
()

103 && (
_š‹»¡šg
[
i
+1] & (1 << 
äom_pÜt
)))

104 
found
;

105  
çl£
;

106 
found
:

107 ià(
By·ss
* 
b
 = 
¡©ic_ÿ¡
<By·ss*>(
e
->
	`ÿ¡
("Bypass")))

108 ià(!
b
->
_šlše
) {

109 
_š‹»¡šg
.
	`push_back
(
b
->
	`ešdex
());

110 
_š‹»¡šg
.
	`push_back
(((
b
->
_aùive
 =ğ
pÜt
 || b->
	`ÅÜts
(
isouut
) == 1) ? 1 : 0)

111 | (
pÜt
 == 0 ? 2 : 0));

112  
Œue
;

116 
cÚ¡_ÿ¡
<
EËm’t
::
PÜt
&>(
e
->
	`pÜt
(
isouut
, 
pÜt
)).
	`assign
(isouut, 
_e
, 
_pÜt
);

117  
çl£
;

118 
	}
}

121 
	gBy·ss
::
	$fix
()

123 ià(!
_šlše
) {

124 
boŞ
 
dœeùiÚ
 = 
	`ouut_is_push
(0);

125 
LoÿtÜ
 
	`loc
(
_aùive
);

126 
	`rou‹r
()->
	`vis™
(
this
, 
dœeùiÚ
, 
_aùive
, &
loc
);

127 ià(
loc
.
_e
) {

128 
AssigÃr
 
	`ass
(
loc
.
_e
,†oc.
_pÜt
);

130 
	`rou‹r
()->
	`vis™
(
this
, !
dœeùiÚ
, 
_aùive
 ? 0 : -1, &
ass
);

132 ià(
_aùive
 && 
	`ÅÜts
(!
dœeùiÚ
) > 1) {

133 
LoÿtÜ
 
	`loc
(0);

134 
	`rou‹r
()->
	`vis™
(
this
, 
dœeùiÚ
, 0, &
loc
);

135 ià(
loc
.
_e
) {

136 
AssigÃr
 
	`ass
(
loc
.
_e
,†oc.
_pÜt
);

137 
	`rou‹r
()->
	`vis™
(
this
, !
dœeùiÚ
, 1, &
ass
);

141 
	}
}

144 
	gBy·ss
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

146 
By·ss
 *
b
 = 
¡©ic_ÿ¡
<By·s *>(
e
);

147 
boŞ
 
aùive
;

148 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
aùive
))

149  
”rh
->
	`”rÜ
("syntaxƒrror");

150 ià(
aùive
 !ğ
b
->
_aùive
) {

151 
b
->
_aùive
 = 
aùive
;

152 
b
->
	`fix
();

155 
	}
}

158 
	gBy·ss
::
	$add_hªdËrs
()

160 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
OP_READ
, &
_aùive
);

161 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 0);

162 
	}
}

164 
CLICK_ENDDECLS


165 
EXPORT_ELEMENT
(
By·ss
)

	@standard/bypass.hh

1 #iâdeà
CLICK_BYPASS_HH


2 
	#CLICK_BYPASS_HH
 1

	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/rou‹rvis™Ü.hh
>

5 
CLICK_DECLS


80 şas 
	cBy·ss
 : 
public
 
EËm’t
 {…ublic:

82 
	$By·ss
(è
CLICK_COLD
;

84 cÚ¡ *
	$şass_Çme
() const {  "Bypass"; }

85 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1-2/1-2"; 
	}
}

86 cÚ¡ *
	$æow_code
(ècÚ¡ {  "xy/[xy]x"; 
	}
}

87 *
ÿ¡
(cÚ¡ *
Çme
);

89 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

90 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

91 
	$add_hªdËrs
(è
CLICK_COLD
;

93 
	`push
(
pÜt
, 
Pack‘
 *
p
);

94 
Pack‘
 *
	`puÎ
(
pÜt
);

96 
´iv©e
:

97 
LoÿtÜ
 : 
public
 
Rou‹rVis™Ü
 {

98 
EËm’t
* 
_e
;

99 
_pÜt
;

100 
_äom_pÜt
;

101 
	`LoÿtÜ
(
äom_pÜt
);

102 
boŞ
 
	`vis™
(
EËm’t
 *
e
, boŞ 
isouut
, 
pÜt
,

103 
EËm’t
 *
äom_e
, 
äom_pÜt
, 
di¡ªû
);

104 
	}
};

106 
	gAssigÃr
 : 
public
 
Rou‹rVis™Ü
 {

107 
EËm’t
* 
_e
;

108 
	g_pÜt
;

109 
	gVeùÜ
<> 
	g_š‹»¡šg
;

110 
AssigÃr
(
EËm’t
 *
e
, 
pÜt
);

111 
boŞ
 
vis™
(
EËm’t
 *
e
, boŞ 
isouut
, 
pÜt
,

112 
EËm’t
 *
äom_e
, 
äom_pÜt
, 
di¡ªû
);

115 
boŞ
 
	g_aùive
;

116 
boŞ
 
	g_šlše
;

118 
fix
();

119 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *
u£r_d©a
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

120 
ä›nd
 
LoÿtÜ
;

121 
ä›nd
 
AssigÃr
;

123 
	}
};

125 
	gCLICK_ENDDECLS


	@standard/checkcrc32.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/üc32.h
>

20 
	~"checküc32.hh
"

21 
CLICK_DECLS


23 
	gCheckCRC32
::
	$CheckCRC32
()

25 
_drİs
 = 0;

26 
	}
}

28 
Pack‘
 *

29 
	gCheckCRC32
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

31 
üc
;

33 
Ën
 = 
p
->
	`Ëngth
();

34 if(
Ën
 < 4)

35 
drİ
;

37 
üc
 = 
	`upd©e_üc
(0xffffffff, (*è
p
->
	`d©a
(), 
Ën
 - 4);

39 
püc
;

40 
	`memıy
(&
püc
, 
p
->
	`d©a
(è+ 
Ën
 - 4, 4);

41 if(
püc
 !ğ
üc
)

42 
drİ
;

44 
p
->
	`ke
(4);

45  
p
;

47 
drİ
:

48 
	`şick_ch©‹r
("CRC32 failed,†en %d",

49 
p
->
	`Ëngth
());

50 
p
->
	`kl
();

51 
_drİs
++;

53 
	}
}

55 
CLICK_ENDDECLS


56 
	$EXPORT_ELEMENT
(
CheckCRC32
)

57 
	`ELEMENT_MT_SAFE
(
CheckCRC32
)

	@standard/checkcrc32.hh

1 #iâdeà
CLICK_CHECKCRC32_HH


2 
	#CLICK_CHECKCRC32_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/©omic.hh
>

5 
CLICK_DECLS


18 şas 
	cCheckCRC32
 : 
public
 
EËm’t
 {…ublic:

20 
CheckCRC32
();

22 cÚ¡ *
	$şass_Çme
() const {  "CheckCRC32"; }

23 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

25 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

27 
	g´iv©e
:

29 
©omic_ušt32_t
 
_drİs
;

33 
	gCLICK_ENDDECLS


	@standard/checklength.cc

18 
	~<şick/cÚfig.h
>

19 
	~"checkËngth.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
CLICK_DECLS


24 
	gCheckL’gth
::
	$CheckL’gth
()

26 
	}
}

29 
CheckL’gth
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

31  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("LENGTH", 
_max
).
com¶‘e
();

35 
	gCheckL’gth
::
	$push
(, 
Pack‘
 *
p
)

37 ià(
p
->
	`Ëngth
(è> 
_max
)

38 
	`checked_ouut_push
(1, 
p
);

40 
	`ouut
(0).
	`push
(
p
);

41 
	}
}

43 
Pack‘
 *

44 
	gCheckL’gth
::
	$puÎ
()

46 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

47 ià(
p
 &&…->
	`Ëngth
(è> 
_max
) {

48 
	`checked_ouut_push
(1, 
p
);

51  
p
;

52 
	}
}

55 
	gCheckL’gth
::
	$add_hªdËrs
()

57 
	`add_d©a_hªdËrs
("Ëngth", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_max
);

58 
	}
}

60 
CLICK_ENDDECLS


61 
	$EXPORT_ELEMENT
(
CheckL’gth
)

62 
	`ELEMENT_MT_SAFE
(
CheckL’gth
)

	@standard/checklength.hh

1 #iâdeà
CLICK_CHECKLENGTH_HH


2 
	#CLICK_CHECKLENGTH_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


22 şas 
	cCheckL’gth
 : 
public
 
EËm’t
 {…ublic:

24 
	$CheckL’gth
(è
CLICK_COLD
;

26 cÚ¡ *
	$şass_Çme
() const {  "CheckLength"; }

27 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

28 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

30 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

32 
push
(, 
Pack‘
 *);

33 
Pack‘
 *
puÎ
();

35 
	$add_hªdËrs
(è
CLICK_COLD
;

37 
´Ùeùed
:

39 
_max
;

41 
	}
};

43 
	gCLICK_ENDDECLS


	@standard/checkpaint.cc

19 
	~<şick/cÚfig.h
>

20 
	~"check·št.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
CLICK_DECLS


26 
	gCheckPašt
::
	$CheckPašt
()

28 
	}
}

31 
CheckPašt
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

33 
	gªno
 = 
PAINT_ANNO_OFFSET
;

34 ià(
Args
(
cÚf
, 
this
, 
”rh
)

35 .
»ad_mp
("COLOR", 
_cŞÜ
)

36 .
»ad_p
("ANNO", 
AÂoArg
(1), 
ªno
)

37 .
com¶‘e
() < 0)

39 
	g_ªno
 = 
ªno
;

44 
	gCheckPašt
::
	$push
(, 
Pack‘
 *
p
)

46 ià(
p
->
	`ªno_u8
(
_ªno
è!ğ
_cŞÜ
)

47 
	`checked_ouut_push
(1, 
p
);

49 
	`ouut
(0).
	`push
(
p
);

50 
	}
}

52 
Pack‘
 *

53 
	gCheckPašt
::
	$puÎ
()

55 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

56 ià(
p
 &&…->
	`ªno_u8
(
_ªno
è!ğ
_cŞÜ
) {

57 
	`checked_ouut_push
(1, 
p
);

58 
p
 = 0;

60  
p
;

61 
	}
}

64 
	gCheckPašt
::
	$add_hªdËrs
()

66 
	`add_d©a_hªdËrs
("cŞÜ", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_cŞÜ
);

67 
	}
}

69 
CLICK_ENDDECLS


70 
EXPORT_ELEMENT
(
CheckPašt
)

	@standard/checkpaint.hh

1 #iâdeà
CLICK_CHECKPAINT_HH


2 
	#CLICK_CHECKPAINT_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


26 şas 
	cCheckPašt
 : 
public
 
EËm’t
 {…ublic:

28 
	$CheckPašt
(è
CLICK_COLD
;

30 cÚ¡ *
	$şass_Çme
() const {  "CheckPaint"; }

31 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

32 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

34 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

35 
	$add_hªdËrs
(è
CLICK_COLD
;

37 
	`push
(, 
Pack‘
 *);

38 
Pack‘
 *
	`puÎ
();

40 
´iv©e
:

42 
ušt8_t
 
_ªno
;

43 
ušt8_t
 
_cŞÜ
;

45 
	}
};

47 
	gCLICK_ENDDECLS


	@standard/classification.cc

21 
	~<şick/cÚfig.h
>

22 
	~"şassifiÿtiÚ.hh
"

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

26 
CLICK_DECLS


27 
Çme¥aû
 
	gCÏssifiÿtiÚ
 {

28 
Çme¥aû
 
	gWÜdwi£
 {

34 
boŞ


35 
	gIn¢
::
h¬d_im¶›s_shÜt_ok
(
boŞ
 
dœeùiÚ
, cÚ¡ 
In¢
 &
x
,

36 
boŞ
 
Ãxt_dœeùiÚ
, 
known_Ëngth
) const

38 ià(
	gshÜt_ouut
 !ğ
dœeùiÚ
)

39  
Œue
;

40 
	gr
 = 
»quœed_Ëngth
();

41  
	gr
 <ğ
known_Ëngth


42 || (
r
 <ğ
x
.
»quœed_Ëngth
(è&& 
Ãxt_dœeùiÚ
 =ğx.
shÜt_ouut
);

45 
boŞ


46 
	gIn¢
::
im¶›s
(cÚ¡ 
In¢
 &
x
, 
known_Ëngth
) const

48 ià(!
	gx
.
	gmask
.
	gu
)

49  
	gŒue
;

50 ià(
	gx
.
	goff£t
 !ğ
off£t
 || !
im¶›s_shÜt_ok
(
Œue
, 
x
,rue, 
known_Ëngth
))

51  
	gçl£
;

52 
ušt32_t
 
	gbÙh_mask
 = 
mask
.
u
 & 
x
.mask.u;

53  
	gbÙh_mask
 =ğ
x
.
mask
.
u
 && (
v®ue
.u & 
bÙh_mask
) == x.value.u;

56 
boŞ


57 
	gIn¢
::
nÙ_im¶›s
(cÚ¡ 
In¢
 &
x
, 
known_Ëngth
) const

59 ià(!
	gx
.
	gmask
.
	gu
)

60  
	gŒue
;

61 ià(
	gx
.
	goff£t
 !ğ
off£t
 || !
im¶›s_shÜt_ok
(
çl£
, 
x
, 
Œue
, 
known_Ëngth
))

62  
	gçl£
;

63  (
	gmask
.
	gu
 & (mask.u - 1)è=ğ0 && 
mask
.
u
 =ğ
x
.mask.u

64 && 
v®ue
.
u
 !ğ
x
.value.u;

67 
boŞ


68 
	gIn¢
::
im¶›s_nÙ
(cÚ¡ 
In¢
 &
x
, 
known_Ëngth
) const

70 ià(!
	gx
.
	gmask
.
	gu
 || x.
	goff£t
 !ğ
off£t


71 || !
im¶›s_shÜt_ok
(
Œue
, 
x
, 
çl£
, 
known_Ëngth
))

72  
	gçl£
;

73 
ušt32_t
 
	gbÙh_mask
 = 
mask
.
u
 & 
x
.mask.u;

74  
	gbÙh_mask
 =ğ
x
.
mask
.
u
 && (
v®ue
.u & 
bÙh_mask
) != x.value.u;

77 
boŞ


78 
	gIn¢
::
nÙ_im¶›s_nÙ
(cÚ¡ 
In¢
 &
x
, 
known_Ëngth
) const

80 ià(!
	gmask
.
	gu
)

81  
	gŒue
;

82 ià(
	gx
.
	goff£t
 !ğ
off£t
 || !
im¶›s_shÜt_ok
(
çl£
, 
x
, f®£, 
known_Ëngth
))

83  
	gçl£
;

84 
ušt32_t
 
	gbÙh_mask
 = 
mask
.
u
 & 
x
.mask.u;

85  
	gbÙh_mask
 =ğ
mask
.
u
 && 
v®ue
.u =ğ(
x
.v®ue.u & 
bÙh_mask
);

88 
boŞ


89 
	gIn¢
::
com·tibË
(cÚ¡ 
In¢
 &
x
, 
boŞ
 
cÚsid”_shÜt
) const

91 ià(!
	gmask
.
	gu
 || !
	gx
.mask.u)

92  
	gŒue
;

93 ià(
	gx
.
	goff£t
 !ğ
off£t


94 || (
cÚsid”_shÜt
 && 
x
.
shÜt_ouut
 != short_output

95 && 
»quœed_Ëngth
(è< 
x
.required_length()))

96  
çl£
;

97 
ušt32_t
 
	gbÙh_mask
 = 
mask
.
u
 & 
x
.mask.u;

98  (
	gv®ue
.
	gu
 & 
	gbÙh_mask
è=ğ(
x
.
v®ue
.
u
 & 
bÙh_mask
);

101 
boŞ


102 
	gIn¢
::
g’”®izabË_Ü_·œ
(cÚ¡ 
In¢
 &
x
) const

104 
ušt32_t
 
v®ue_diff
 = 
v®ue
.
u
 ^ 
x
.value.u;

105 ià(
	goff£t
 && 
	gx
.off£ˆ=ğ
off£t
 && 
mask
.
u
 && 
x
.mask.u == mask.u

106 && (
shÜt_ouut
 || !
x
.shÜt_ouutè&& 
yes
() == x.yes()

107 && (
v®ue_diff
 & (value_diff - 1)) == 0) {

108 
In¢
 
‹¡
(
off£t
, 
v®ue
.
u
 & ~
v®ue_diff
, 
mask
.u & ~value_diff);

109  
	g‹¡
.
»quœed_Ëngth
() ==„equired_length();

111  
	gçl£
;

114 
boŞ


115 
	gIn¢
::
æ·bË
() const

117 ià(!
mask
.
u
)

118  
çl£
;

120  (
	gmask
.
	gu
 & (mask.u - 1)) == 0;

124 
	gIn¢
::
æ
()

126 
as£¹
(
æ·bË
());

127 
	gv®ue
.
	gu
 ^ğ
mask
.
u
;

128 
	gtmp
 = 
j
[0];

129 
	gj
[0] = 
j
[1];

130 
	gj
[1] = 
tmp
;

131 
	gshÜt_ouut
 = !
shÜt_ouut
;

135 
jump_accum
(
SŒšgAccum
 &
§
, 
j
)

137 ià(
	gj
 <ğ
j_sucûss
)

138 
§
 << '[' << ("X-+"[
j
 - 
j_Ãv”
]) << ']';

139 ià(
	gj
 <= 0)

140 
§
 << '[' << (-
j
) << ']';

142 
	g§
 << "¡• " << 
	gj
;

145 
	gSŒšgAccum
 &

146 
	gİ”©Ü
<<(
	gSŒšgAccum
 &
	g§
, cÚ¡ 
	gIn¢
 &
	ge
)

148 
	gbuf
[20];

149 
	goff£t
 = 
e
.
off£t
;

150 
¥rštf
(
buf
, "%3d/", 
off£t
);

151 
	g§
 << 
	gbuf
;

152 
	gi
 = 0; i < 4; i++)

153 
¥rštf
(
buf
 + 2*
i
, "%02x", 
e
.
v®ue
.
c
[i]);

154 
¥rštf
(
buf
 + 8, "%%");

155 
	gi
 = 0; i < 4; i++)

156 
¥rštf
(
buf
 + 9 + 2*
i
, "%02x", 
e
.
mask
.
c
[i]);

157 
	g§
 << 
	gbuf
 << " yes->";

158 
jump_accum
(
§
, 
e
.
yes
());

159 
	g§
 << "‚o->";

160 
jump_accum
(
§
, 
e
.
no
());

161 ià(
	ge
.
	gshÜt_ouut
)

162 
	g§
 << " short->yes";

163  
	g§
;

166 
SŒšg


167 
	gIn¢
::
uÅ¬£
() const

169 
SŒšgAccum
 
§
;

170 
	g§
 << *
	gthis
;

171  
	g§
.
ke_¡ršg
();

183 
	gVeùÜ
<>

184 
	gProg¿m
::
š™_subŒ“
() const

186 
VeùÜ
<> 
Œ“
(
_š¢
.
size
() + 1, -1);

187 
	gŒ“
[0] = 0;

188  
	gŒ“
;

192 
	gProg¿m
::
¡¬t_subŒ“
(
VeùÜ
<> &
Œ“
) const

194 ++
Œ“
[0];

198 
	gProg¿m
::
add_š¢
(
VeùÜ
<> &
Œ“
, 
off£t
, 
ušt32_t
 
v®ue
, ušt32_ˆ
mask
)

200 
	g_š¢
.
push_back
(
In¢
(
off£t
, 
v®ue
, 
mask
));

201 
	gŒ“
.
push_back
(
Œ“
[0]);

202 
	g_ouut_ev”ythšg
 = -1;

206 
	gProg¿m
::
»dœeù_subŒ“
(
fœ¡
, 
Ï¡
, 
sucûss
, 
çu»
)

208 
	gi
 = 
fœ¡
; i < 
	gÏ¡
; ++i) {

209 
	gIn¢
 &
	gš
 = 
_š¢
[
i
];

210 
	gk
 = 0; k < 2; ++k)

211 ià(
	gš
.
	gj
[
k
] =ğ
j_sucûss
)

212 
š
.
j
[
k
] = 
sucûss
;

213 ià(
	gš
.
	gj
[
k
] =ğ
j_çu»
)

214 
š
.
j
[
k
] = 
çu»
;

219 
	gProg¿m
::
fšish_subŒ“
(
VeùÜ
<> &
Œ“
, 
Combš”
 
combš”
,

220 
sucûss
, 
çu»
)

222 
	gËv–
 = 
Œ“
[0];

225 
	gVeùÜ
<> 
	gsubŒ“s
;

228 
	g±r
 = 
_š¢
.
size
();

229 
	g±r
 > 0 && (
	gŒ“
[
±r
] < 0 ||»e[±r] >ğ
Ëv–
))

230 --
±r
;

232 ++
	g±r
;…Œ <ğ
_š¢
.
size
(); ++ptr)

233 ià(
	gŒ“
[
±r
] =ğ
Ëv–
)

234 
subŒ“s
.
push_back
(
±r
 - 1);

237 ià(
	gsubŒ“s
.
size
()) {

242 
	gŒ“
[
subŒ“s
[0] + 1] = 
Ëv–
 - 1;

243 
	ge
 = 
subŒ“s
[0] + 2;ƒ <ğ
_š¢
.
size
();ƒ++)

244 
	gŒ“
[
e
] = -1;

247 
	gt
;

248 
	gt
 = 0; < 
	gsubŒ“s
.
size
() - 1;++) {

249 
	gfœ¡
 = 
subŒ“s
[
t
];

250 
	gÃxt
 = 
subŒ“s
[
t
+1];

252 ià(
	gcombš”
 =ğ
c_ªd
)

253 
»dœeù_subŒ“
(
fœ¡
, 
Ãxt
,‚ext, 
çu»
);

254 ià(
	gcombš”
 =ğ
c_Ü
)

255 
»dœeù_subŒ“
(
fœ¡
, 
Ãxt
, 
sucûss
,‚ext);

256 ià(
	gcombš”
 =ğ
c_‹º¬y
) {

257 ià(
t
 < 
subŒ“s
.
size
() - 2) {

258 
Ãxt2
 = 
subŒ“s
[
t
+2];

259 
»dœeù_subŒ“
(
fœ¡
, 
Ãxt
,‚ext, 
Ãxt2
);

260 
»dœeù_subŒ“
(
Ãxt
, 
Ãxt2
, 
sucûss
, 
çu»
);

261 
	gt
++;

263 
»dœeù_subŒ“
(
fœ¡
, 
Ãxt
,‚ext, 
çu»
);

265 
»dœeù_subŒ“
(
fœ¡
, 
Ãxt
, 
sucûss
, 
çu»
);

268 ià(
	gt
 < 
	gsubŒ“s
.
size
()) {

269 
as£¹
(
t
 =ğ
subŒ“s
.
size
() - 1);

270 
»dœeù_subŒ“
(
subŒ“s
[
t
], 
_š¢
.
size
(), 
sucûss
, 
çu»
);

274 --
	gŒ“
[0];

278 
	gProg¿m
::
Ãg©e_subŒ“
(
VeùÜ
<> &
Œ“
, 
boŞ
 
æ_shÜt
)

281 
	gËv–
 = 
Œ“
[0];

282 
	gfœ¡
 = 
_š¢
.
size
() - 1;

283 
	gfœ¡
 >ğ0 && 
Œ“
[
fœ¡
+1] !ğ
Ëv–
)

284 --
fœ¡
;

286 
	gi
 = 
fœ¡
; i >ğ0 && 
i
 < 
_š¢
.
size
(); i++) {

287 
	gIn¢
 &
	ge
 = 
_š¢
[
i
];

288 ià(
	ge
.
yes
(è=ğ
j_çu»
)

289 
e
.
£t_yes
(
j_sucûss
);

290 ià(
	ge
.
yes
(è=ğ
j_sucûss
)

291 
e
.
£t_yes
(
j_çu»
);

292 ià(
	ge
.
no
(è=ğ
j_çu»
)

293 
e
.
£t_no
(
j_sucûss
);

294 ià(
	ge
.
no
(è=ğ
j_sucûss
)

295 
e
.
£t_no
(
j_çu»
);

296 ià(
	gæ_shÜt
)

297 
	ge
.
	gshÜt_ouut
 = !
e
.
shÜt_ouut
;

341 
š¢_³rmu‹_com·»
(cÚ¡ *
­
, cÚ¡ *
bp
, *
u£r_d©a
)

343 
	ga
 = *
»š‹½»t_ÿ¡
<cÚ¡ *>(
­
);

344 
	gb
 = *
»š‹½»t_ÿ¡
<cÚ¡ *>(
bp
);

345 cÚ¡ 
In¢
 *
	gš
 = 
»š‹½»t_ÿ¡
<cÚ¡ In¢ *>(
u£r_d©a
);

346 
	gcmp
 = 
In¢
::
com·»
(
š
[
a
], in[
b
]);

347  
	gcmp
 ? cm°: 
a
 - 
b
;

350 
	gDomš©ÜO±imiz”
::
Domš©ÜO±imiz”
(
Prog¿m
 *
p
)

351 : 
_p
(
p
), 
_known_Ëngth
(_p->
nš¢
(), 0x7FFFFFFF), 
_š¢_id
(_p->ninsn(), 0),

352 
_dom_¡¬t
(1, 0), 
_domli¡_¡¬t
(1, 0)

354 ià(
	g_p
->
nš¢
())

355 
	g_known_Ëngth
[0] = 0;

356 
	gi
 = 0; i < 
	g_p
->
nš¢
(); ++i) {

357 cÚ¡ 
	gIn¢
 &
	gš¢
 = 
_p
->
š¢
(
i
);

358 
	g‹¡ed_Ëngth
 = 
š¢
.
»quœed_Ëngth
();

359 ià(
	g‹¡ed_Ëngth
 < 
	g_known_Ëngth
[
i
])

360 
	g‹¡ed_Ëngth
 = 
_known_Ëngth
[
i
];

361 
boŞ
 
	gso
 = 
š¢
.
shÜt_ouut
;

362 ià(
	gš¢
.
	gj
[!
so
] > 0 && 
	g‹¡ed_Ëngth
 < 
	g_known_Ëngth
[
š¢
.
j
[!so]])

363 
	g_known_Ëngth
[
š¢
.
j
[!
so
]] = 
‹¡ed_Ëngth
;

364 ià(
	gš¢
.
	gj
[
so
] > 0 && 
	g_known_Ëngth
[
i
] < _known_Ëngth[
š¢
.
j
[so]])

365 
	g_known_Ëngth
[
š¢
.
j
[
so
]] = 
_known_Ëngth
[
i
];

369 
	gVeùÜ
<> 
	gš¢_³rmu‹
;

370 
	gi
 = 0; i < 
	g_p
->
nš¢
(); ++i)

371 
	gš¢_³rmu‹
.
push_back
(
i
);

372 
şick_qsÜt
(
š¢_³rmu‹
.
begš
(), in¢_³rmu‹.
size
(), (),

373 
š¢_³rmu‹_com·»
, (*è
_p
->
begš
());

374 
	gi
 = 0; i < 
	g_p
->
nš¢
(); ++i)

375 ià(
	gi
 > 0 && 
	gIn¢
::
com·»
(
_p
->
š¢
(
š¢_³rmu‹
[
i
]), _p->insn(insn_permute[i-1])) == 0)

376 
_š¢_id
[
š¢_³rmu‹
[
i
]] = _insn_id[insn_permute[i-1]];

378 
	g_š¢_id
[
š¢_³rmu‹
[
i
]] = insn_permute[i];

382 
	gDomš©ÜO±imiz”
::
fšd_´edeûssÜs
(
¡©e
, 
VeùÜ
<> &
v
) const

384 #ià
CLICK_CLASSIFICATION_WORDWISE_DOMINATOR_FASTPRED


385 ià(!
	g_´ed_fœ¡
.
size
()) {

386 
	g_´ed_fœ¡
.
assign
(
nš¢
(), -1);

387 
	g_´ed_Ãxt
.
assign
(
nš¢
() * 2, -1);

388 
	g_´ed_´ev
.
assign
(
nš¢
() * 2, -1);

389 
	gi
 = 0; i < 
nš¢
(); ++i) {

390 cÚ¡ 
	gIn¢
 &
	gš
 = 
š¢
(
i
);

391 
	gk
 = 0; k < 2; ++k)

392 ià(
	gš
.
	gj
[
k
] > 0) {

393 
	gÃxts
 = 
š
.
j
[
k
], 
	gbr
 = 
bºo
(
i
, k);

394 
	g_´ed_Ãxt
[
br
] = 
_´ed_fœ¡
[
Ãxts
];

395 ià(
	g_´ed_fœ¡
[
Ãxts
] >= 0)

396 
_´ed_´ev
[
_´ed_fœ¡
[
Ãxts
]] = 
br
;

397 
	g_´ed_fœ¡
[
Ãxts
] = 
br
;

402 
	gbr
 = 
_´ed_fœ¡
[
¡©e
]; b¸>ğ0; b¸ğ
_´ed_Ãxt
[
br
])

403 
v
.
push_back
(
br
);

406 
	gVeùÜ
<> 
	gvv
;

407 
	gi
 = 0; i < 
	g¡©e
; i++) {

408 cÚ¡ 
	gIn¢
 &
	gš
 = 
š¢
(
i
);

409 
	gk
 = 0; k < 2; ++k)

410 ià(
	gš
.
	gj
[
k
] =ğ
¡©e
)

411 
vv
.
push_back
(
bºo
(
i
, 
k
));

414 
as£¹
(
v
.
size
(è=ğ
vv
.size(è&& 
memcmp
(v.
begš
(), vv.begin(), () * v.size()) == 0);

417 
	gi
 = 0; i < 
	g¡©e
; i++) {

418 cÚ¡ 
	gIn¢
 &
	gš
 = 
š¢
(
i
);

419 
	gk
 = 0; k < 2; ++k)

420 ià(
	gš
.
	gj
[
k
] =ğ
¡©e
)

421 
vv
.
push_back
(
bºo
(
i
, 
k
));

426 #ià
CLICK_USERLEVEL


428 
	gDomš©ÜO±imiz”
::
´št
()

430 
SŒšg
 
s
 = 
_p
->
uÅ¬£
();

431 
årštf
(
¡d”r
, "%s\n", 
s
.
c_¡r
());

432 
	gi
 = 0; i < 
	g_domli¡_¡¬t
.
size
() - 1; i++) {

433 ià(
	g_š¢_id
[
i
] == i)

434 
årštf
(
¡d”r
, "S%d ", 
i
);

436 
årštf
(
¡d”r
, "S%d[=%d]", 
i
, 
_š¢_id
[i]);

437 ià(
	g_domli¡_¡¬t
[
i
] =ğ
_domli¡_¡¬t
[i+1])

438 
årštf
(
¡d”r
, " : NO DOMINATORS\n");

440 
årštf
(
¡d”r
, " : ");

441 
	gj
 = 
_domli¡_¡¬t
[
i
]; j < 
	g_domli¡_¡¬t
[i+1]; ++j) {

442 ià(
	gj
 > 
	g_domli¡_¡¬t
[
i
])

443 
årštf
(
¡d”r
, " : ");

444 
	g’dk
 = 
_dom_¡¬t
[
j
+1];

445 
	gk
 = 
_dom_¡¬t
[
j
]; k < 
	g’dk
; ++k)

446 
årštf
(
¡d”r
, 
k
 =ğ
’dk
 - 1 ? " (%d.%c)" : " %d.%c",

447 
¡©’o
(
_dom
[
k
]), 
br_yes
(_dom[k]) ? 'Y' : 'N');

448 
årštf
(
¡d”r
, "\n");

456 
	gDomš©ÜO±imiz”
::
ÿlcuÏ‹_dom
(
¡©e
)

458 
as£¹
(
_domli¡_¡¬t
.
size
(è=ğ
¡©e
 + 1);

459 
as£¹
(
_dom_¡¬t
.
size
(è- 1 =ğ
_domli¡_¡¬t
.
back
());

460 
as£¹
(
_dom
.
size
(è=ğ
_dom_¡¬t
.
back
());

463 
	gVeùÜ
<> 
	g´edeûssÜs
;

464 
fšd_´edeûssÜs
(
¡©e
, 
´edeûssÜs
);

467 
	gVeùÜ
<> 
	gpdom
, 
	gpdom_’d
;

468 
	gi
 = 0; i < 
	g´edeûssÜs
.
size
(); i++) {

469 
	g´ed_br
 = 
´edeûssÜs
[
i
], 
	gs
 = 
¡©’o
(
´ed_br
);

473 ià(
	gi
 > 0 && 
¡©’o
(
´edeûssÜs
[
i
-1]è=ğ
s
) {

474 
as£¹
(
i
 =ğ
´edeûssÜs
.
size
(è- 1 || 
¡©’o
Õ»deûssÜs[i+1]è!ğ
_š¢_id
[
s
]);

475 
as£¹
(
pdom_’d
.
back
(è> 
pdom
.back());

476 
as£¹
(
¡©’o
(
_dom
[
pdom_’d
.
back
(è- 1]è=ğ
_š¢_id
[
s
]);

477 
	gpdom_’d
.
back
()--;

483 
	g´ed_brid
 = 
bºo
(
_š¢_id
[
s
], 
br_yes
(
´ed_br
));

484 
	gj
 = 
_domli¡_¡¬t
[
s
]; j < 
	g_domli¡_¡¬t
[s+1]; j++) {

485 
	gpos1
 = 
_dom_¡¬t
[
j
], 
	gpos2
 = _dom_start[j+1];

486 
	gk
 = 
pos1
; k < 
	gpos2
 - 1; ++k)

487 ià((
	g_dom
[
k
] ^ 
	g´ed_brid
) == 1)

488 
ignÜe_impossibË_·th
;

489 
	gpdom
.
push_back
(
pos1
);

490 
	gpdom_’d
.
push_back
(
pos2
);

491 
as£¹
(
¡©’o
(
_dom
[
pos2
 - 1]è=ğ
_š¢_id
[
s
]);

492 
	g_dom
[
pos2
 - 1] = 
´ed_brid
;

493 
	gignÜe_impossibË_·th
: ;

502 
	gdom_¡¬t_Şdsize
 = 
_dom_¡¬t
.
size
();

504 ià(
	gpdom
.
size
(è> 
	gMAX_DOMLIST
) {

506 
š‹r£ù_li¡s
(
_dom
, 
pdom
, 
pdom_’d
, 0,…dom.
size
(), _dom);

507 
	g_dom
.
push_back
(
bºo
(
_š¢_id
[
¡©e
], 
çl£
));

508 
	g_dom_¡¬t
.
push_back
(
_dom
.
size
());

509 } ià(!
	gpdom
.
em±y
()) {

514 
	gmybr
 = 
bºo
(
_š¢_id
[
¡©e
], 
çl£
), 
	gnum_mybr
 = 0;

517 
	gp
 = 0;… < 
	gpdom
.
size
();…++) {

518 
	g’dpos
 = 
pdom_’d
[
p
] - 1, 
	gÏ¡_pdom_br
 = 
_dom
[
’dpos
],

519 
	g´ed_mybr
 = -1;

520 
	gi
 = 
pdom
[
p
]; i <ğ
’dpos
; ++i) {

521 
	gthisbr
 = 
_dom
[
i
];

523 ià(
	gi
 < 
	g’dpos
 && (
	gthisbr
 ^ 
	gÏ¡_pdom_br
) <= 1)

526 ià((
	gthisbr
 ^ 
	gmybr
) <= 1)

527 
´ed_mybr
 = 
thisbr
;

528 
	g_dom
.
push_back
(
thisbr
);

530 ià(
	gnum_mybr
 >ğ0 && 
´ed_mybr
 >= 0

531 && (
num_mybr
 =ğ0 || 
mybr
 =ğ
´ed_mybr
))

532 
mybr
 = 
´ed_mybr
, ++
	gnum_mybr
;

534 
	gnum_mybr
 = -1;

535 
	g_dom
.
push_back
(
mybr
);

536 
	g_dom_¡¬t
.
push_back
(
_dom
.
size
());

540 ià(
	gnum_mybr
 > 0) {

541 
	gÃw_¡©e
 = 
š¢
(
¡©e
).
j
[
mybr
 & 1];

542 
	gi
 = 0; i < 
	g´edeûssÜs
.
size
(); ++i)

543 
£t_b¿nch
(
¡©’o
(
´edeûssÜs
[
i
]), 
br_yes
(predecessors[i]),

544 
Ãw_¡©e
);

545 
	gpdom
.
ş—r
();

550 ià(
	gpdom
.
em±y
()) {

552 
	g_dom
.
»size
(
_dom_¡¬t
[
dom_¡¬t_Şdsize
 - 1]);

553 
	g_dom_¡¬t
.
»size
(
dom_¡¬t_Şdsize
);

555 ià(
	g¡©e
 > 0) {

556 
	gk
 = 0; k < 2; ++k)

557 
£t_b¿nch
(
¡©e
, 
k
, 
CÏssifiÿtiÚ
::
j_Ãv”
);

559 
as£¹
(
¡©e
 == 0);

560 
	g_dom
.
push_back
(
bºo
(
¡©e
, 
çl£
));

561 
	g_dom_¡¬t
.
push_back
(
_dom
.
size
());

565 
	g_domli¡_¡¬t
.
push_back
(
_dom_¡¬t
.
size
() - 1);

570 
	gDomš©ÜO±imiz”
::
š‹r£ù_li¡s
(cÚ¡ 
VeùÜ
<> &
š
, cÚ¡ VeùÜ<> &
¡¬t
, cÚ¡ VeùÜ<> &
’d
, 
pos1
, 
pos2
, VeùÜ<> &
out
)

574 
as£¹
(
pos1
 <ğ
pos2
 &&…os2 <ğ
¡¬t
.
size
(è&&…os2 <ğ
’d
.size());

575 ià(
	gpos1
 =ğ
pos2
)

577 ià(
	gpos2
 - 
	gpos1
 == 1) {

578 
i
 = 
¡¬t
[
pos1
]; 
	gi
 < 
	g’d
[pos1]; i++)

579 
	gout
.
push_back
(
š
[
i
]);

581 
	gVeùÜ
<> 
pos
(
¡¬t
);

584 
	gx
 = -1;

587 
	gp
 = 
pos1
, 
	gk
 = 0;

591 
	gk
 < 
	gpos2
 - 
	gpos1
) {

592 
	gpos
[
p
] < 
	g’d
[p] && 
	gš
[
pos
[p]] < 
	gx
)

593 
	gpos
[
p
]++;

594 ià(
	gpos
[
p
] >ğ
’d
[p])

595 
dÚe
;

597 ià(
	gš
[
pos
[
p
]] > 
	gx
)

598 
	gx
 = 
š
[
pos
[
p
]], 
	gk
 = 0;

599 
	gp
++;

600 ià(
	gp
 =ğ
pos2
)

601 
p
 = 
pos1
;

602 
	gk
++;

607 
	gout
.
push_back
(
x
);

608 
	gx
++;

610 
	gdÚe
: ;

615 
	gDomš©ÜO±imiz”
::
dom_shiá_b¿nch
(
bºo
, 
to_¡©e
, 
dom
, 
dom_’d
, 
VeùÜ
<> *
cŞËùÜ
)

619 
	gbºo
 = 
Domš©ÜO±imiz”
::
bºo
(
_š¢_id
[
¡©’o
(bºo)], 
br_yes
(brno));

620 
as£¹
(
dom_’d
 > 
dom
 && 
¡©’o
(
_dom
[dom_’d - 1]è=ğ¡©’o(
bºo
));

621 
	g_dom
[
dom_’d
 - 1] = 
bºo
;

622 ià(
	gcŞËùÜ
)

623 
	gcŞËùÜ
->
push_back
(
to_¡©e
);

625 
	gto_¡©e
 > 0) {

626 
	gj
 = 
dom_’d
 - 1; j >ğ
dom
; j--)

627 ià(
br_im¶›s
(
_dom
[
j
], 
to_¡©e
)) {

628 
	gto_¡©e
 = 
š¢
(
to_¡©e
).
yes
();

629 
	gfound
;

630 } ià(
br_im¶›s_nÙ
(
_dom
[
j
], 
to_¡©e
)) {

631 
	gto_¡©e
 = 
š¢
(
to_¡©e
).
no
();

632 
	gfound
;

636 
	gfound
:

637 ià(
cŞËùÜ
)

638 
cŞËùÜ
->
push_back
(
to_¡©e
);

641  
	gto_¡©e
;

645 
	gDomš©ÜO±imiz”
::
Ï¡_commÚ_¡©e_š_li¡s
(cÚ¡ 
VeùÜ
<> &
š
, cÚ¡ VeùÜ<> &
¡¬t
, cÚ¡ VeùÜ<> &
’d
)

647 
as£¹
(
¡¬t
.
size
(è=ğ
’d
.size() && start.size() > 1);

648 ià(
	gš
[
’d
[0] - 1] <= 0) {

649 
s
 = 
š
[
’d
[0] - 1];

650 
	gj
 = 1; j < 
	g¡¬t
.
size
(); j++)

651 ià(
	gš
[
’d
[
j
] - 1] !ğ
s
)

652 
nÙ_’d
;

653  
	gs
;

655 
	gnÙ_’d
:

656 
VeùÜ
<> 
š‹r£ùiÚ
;

657 
š‹r£ù_li¡s
(
š
, 
¡¬t
, 
’d
, 0, s¹.
size
(), 
š‹r£ùiÚ
);

658  
	gš‹r£ùiÚ
.
back
();

662 
	gDomš©ÜO±imiz”
::
shiá_b¿nch
(
¡©e
, 
boŞ
 
b¿nch
)

666 
št32_t
 
	gÃxts
 = 
š¢
(
¡©e
).
j
[
b¿nch
], 
	gÃw_Ãxts
,

667 
	gbr
 = 
bºo
(
¡©e
, 
b¿nch
);

669 ià(
	g_domli¡_¡¬t
[
¡©e
] =ğ
_domli¡_¡¬t
[¡©e+1] || 
Ãxts
 <= 0)

671 
Ãw_Ãxts
 = 
Ãxts
;

672 ià(
	g_domli¡_¡¬t
[
¡©e
] + 1 =ğ
_domli¡_¡¬t
[state+1]) {

674 
d
 = 
_domli¡_¡¬t
[
¡©e
];

675 
	gÃw_Ãxts
 = 
dom_shiá_b¿nch
(
br
, 
Ãxts
, 
_dom_¡¬t
[
d
], _dom_start[d+1], 0);

677 
	gVeùÜ
<> 
	gv®s
, 
	g¡¬t
, 
	g’d
;

678 
	gd
 = 
_domli¡_¡¬t
[
¡©e
]; d < 
	g_domli¡_¡¬t
[state+1]; d++) {

679 
	g¡¬t
.
push_back
(
v®s
.
size
());

680 (è
dom_shiá_b¿nch
(
br
, 
Ãxts
, 
_dom_¡¬t
[
d
], _dom_¡¬t[d+1], &
v®s
);

681 
	g’d
.
push_back
(
v®s
.
size
());

683 
	gÃw_Ãxts
 = 
Ï¡_commÚ_¡©e_š_li¡s
(
v®s
, 
¡¬t
, 
’d
);

686 ià(
	gÃw_Ãxts
 !ğ
Ãxts
)

687 
£t_b¿nch
(
¡©e
, 
b¿nch
, 
Ãw_Ãxts
);

691 
	gDomš©ÜO±imiz”
::
run
(
¡©e
)

693 
as£¹
(
_domli¡_¡¬t
.
size
(è=ğ
¡©e
 + 1);

694 
ÿlcuÏ‹_dom
(
¡©e
);

695 
shiá_b¿nch
(
¡©e
, 
Œue
);

696 
shiá_b¿nch
(
¡©e
, 
çl£
);

704 
	gProg¿m
::
»move_unu£d_¡©es
()

706 ià(!
_š¢
.
size
())

711 
	gVeùÜ
<> 
de¡š©iÚ
(
_š¢
.
size
(), -1);

712 
	gi
 = 
_š¢
.
size
() - 1; i >= 0; --i) {

713 
	gIn¢
 &
	gš
 = 
_š¢
[
i
];

715 
	gk
 = 0; k < 2; ++k)

716 ià(
	gš
.
	gj
[
k
] > 0)

717 
	gš
.
	gj
[
k
] = 
de¡š©iÚ
[
š
.
j
[k]];

719 ià(
	gš
.
yes
(è!ğ
š
.
no
(è&& in.
mask
.
u
 != 0)

720 
de¡š©iÚ
[
i
] = i;

721 ià(
	gš
.
yes
() <= 0)

722 
de¡š©iÚ
[
i
] = 
š
.
yes
();

724 
	gde¡š©iÚ
[
i
] = 
de¡š©iÚ
[
š
.
yes
()];

730 
	g_ouut_ev”ythšg
 = -1;

731 ià(
	gde¡š©iÚ
[0] > 0)

732 
	g_š¢
[0] = 
_š¢
[
de¡š©iÚ
[0]];

733 ià(
	gde¡š©iÚ
[0] < 0)

734 
	g_ouut_ev”ythšg
 = -
de¡š©iÚ
[0];

735 ià(
	g_š¢
[0].
yes
(è=ğ0 && (
_š¢
[0].
no
(è=ğ0 || !_š¢[0].
mask
.
u
))

736 
_ouut_ev”ythšg
 = 0;

740 
	gde¡š©iÚ
.
assign
(
_š¢
.
size
(), -1);

741 ià(
	g_ouut_ev”ythšg
 < 0)

742 
	gde¡š©iÚ
[0] = 0;

743 
	gÃw_š¢_šdex
 = 0;

744 
	gi
 = 0; i < 
	g_š¢
.
size
(); ++i)

745 ià(
	gde¡š©iÚ
[
i
] >= 0) {

746 
de¡š©iÚ
[
i
] = 
Ãw_š¢_šdex
;

747 
	gÃw_š¢_šdex
++;

748 cÚ¡ 
	gIn¢
 &
	gš
 = 
_š¢
[
i
];

749 
	gk
 = 0; k < 2; ++k)

750 ià(
	gš
.
	gj
[
k
] > 0)

751 
	gde¡š©iÚ
[
š
.
j
[
k
]] = 0;

755 
	gi
 = 0; i < 
	g_š¢
.
size
(); ++i)

756 ià(
	gde¡š©iÚ
[
i
] >= 0) {

757 
j
 = 
de¡š©iÚ
[
i
];

758 ià(
	gj
 !ğ
i
)

759 
_š¢
[
j
] = _š¢[
i
];

760 
	gIn¢
 &
	gš
 = 
_š¢
[
j
];

761 
	gk
 = 0; k < 2; ++k)

762 ià(
	gš
.
	gj
[
k
] > 0)

763 
	gš
.
	gj
[
k
] = 
de¡š©iÚ
[
š
.
j
[k]];

765 
	g_š¢
.
”a£
(
_š¢
.
begš
(è+ 
Ãw_š¢_šdex
, _š¢.
’d
());

769 
	gProg¿m
::
combše_com·tibË_¡©es
()

771 
i
 = 
_š¢
.
size
(è- 1; 
	gi
 >= 0; --i) {

772 
	gIn¢
 &
	gš
 = 
_š¢
[
i
];

773 ià(
	gš
.
no
() > 0) {

774 
	gIn¢
 &
	gno_š
 = 
_š¢
[
š
.
no
()];

775 ià(
	gno_š
.
com·tibË
(
š
, 
çl£
è&& 
	gš
.
æ·bË
())

776 
	gš
.
æ
();

777 ià(
	gš
.
g’”®izabË_Ü_·œ
(
no_š
)) {

778 
ušt32_t
 
	gthe_b™
 = 
š
.
v®ue
.
u
 ^ 
no_š
.value.u;

779 
	gš
.
	gv®ue
.
	gu
 &ğ~
the_b™
;

780 
	gš
.
	gmask
.
	gu
 &ğ~
the_b™
;

781 
	gš
.
£t_no
(
no_š
.
no
());

782 ++
	gi
;

786 ià(
	gš
.
yes
() <= 0)

788 
	gIn¢
 &
	gyes_š
 = 
_š¢
[
š
.
yes
()];

789 ià(
	gš
.
no
(è=ğ
yes_š
.
yes
(è&& yes_š.
æ·bË
())

790 
yes_š
.
æ
();

791 ià(
	gš
.
no
(è=ğ
yes_š
.no(è&& yes_š.
com·tibË
(
š
, 
Œue
)) {

792 
	gš
.
£t_yes
(
yes_š
.
yes
());

793 ià(!
	gš
.
	gmask
.
	gu
)

794 
	gš
.
	goff£t
 = 
yes_š
.
off£t
;

795 
	gš
.
	gv®ue
.
	gu
 = (
š
.
v®ue
.
u
 & in.
mask
.uè| (
yes_š
.value.u & yes_in.mask.u);

796 
	gš
.
	gmask
.
	gu
 |ğ
yes_š
.
mask
.
u
;

797 ++
	gi
;

803 
	gProg¿m
::
couÁ_šb¿nches
(
VeùÜ
<> &
šb¿nches
) const

805 
šb¿nches
.
assign
(
_š¢
.
size
(), -1);

806 
	gi
 = 0; i < 
	g_š¢
.
size
(); i++) {

807 cÚ¡ 
	gIn¢
 &
	ge
 = 
_š¢
[
i
];

808 
	gk
 = 0; k < 2; k++)

809 ià(
	ge
.
	gj
[
k
] > 0)

810 
	gšb¿nches
[
e
.
j
[
k
]] = (
šb¿nches
[e.j[k]] >ğ0 ? 0 : 
i
);

814 
šlše
 

815 
	gProg¿m
::
m­_off£t
(
off£t
, cÚ¡ *
begš
, cÚ¡ *
’d
)

817 ià(
	gbegš
 =ğ
’d
 || 
off£t
 < 
begš
[0] || offset >ƒnd[-2])

818  
off£t
;

820  
h¬d_m­_off£t
(
off£t
, 
begš
, 
’d
);

824 
	gProg¿m
::
h¬d_m­_off£t
(
off£t
, cÚ¡ *
begš
, cÚ¡ *
’d
)

826 
	gbegš
 !ğ
’d
) {

827 cÚ¡ *
mid
 = 
begš
 + (((
’d
 - begin) >> 2) << 1);

828 ià(
	gmid
[0] =ğ
off£t
)

829  
mid
[1];

830 ià(
	gmid
[0] < 
	goff£t
)

831 
	gbegš
 = 
mid
 + 2;

833 
	g’d
 = 
begš
;

835  
	goff£t
;

839 
	gProg¿m
::
bubbË_sÜt_ªd_ex´s
(cÚ¡ *
off£t_m­_begš
,

840 cÚ¡ *
off£t_m­_’d
,

841 
Ï¡_off£t
)

843 
	gVeùÜ
<> 
	gšb¿nch
;

844 
couÁ_šb¿nches
(
šb¿nch
);

847 
	gi
 = 0; i < 
	g_š¢
.
size
(); i++) {

848 
	gIn¢
 &
	ge1
 = 
_š¢
[
i
];

849 
	gk
 = 0; k < 2; k++) {

850 
	gj
 = 
e1
.
j
[
k
];

851 ià(
	gj
 <= 0

852 || 
e1
.
off£t
 >ğ
¡©ic_ÿ¡
<>(
Ï¡_off£t
)

853 || 
šb¿nch
[
j
] <= 0)

855 
	gIn¢
 &
	ge2
 = 
_š¢
[
j
];

856 ià(
	ge1
.
	gj
[!
k
] !ğ
e2
.
j
[!k])

858 
	go1
 = 
m­_off£t
(
e1
.
off£t
, 
off£t_m­_begš
, 
off£t_m­_’d
),

859 
	go2
 = 
m­_off£t
(
e2
.
off£t
, 
off£t_m­_begš
, 
off£t_m­_’d
);

860 ià(
	go1
 > 
	go2


861 || (
	go1
 =ğ
o2


862 && (
Áohl
(
e1
.
mask
.
u
è>‚tohl(
e2
.mask.u)

863 || (
e1
.
mask
.
u
 =ğ
e2
.mask.u

864 && 
Áohl
(
e1
.
v®ue
.
u
è>‚tohl(
e2
.value.u))))) {

865 
In¢
 
‹mp
(
e2
);

866 
	ge2
 = 
e1
;

867 
	ge2
.
	gj
[
k
] = 
‹mp
.
j
[k];

868 
	ge1
 = 
‹mp
;

869 
	ge1
.
	gj
[
k
] = 
j
;

871 
	gi
 = (
šb¿nch
[
i
] > 0 ? inbranch[i] - 1 : i - 1);

879 
	gProg¿m
::
İtimize
(cÚ¡ *
off£t_m­_begš
,

880 cÚ¡ *
off£t_m­_’d
,

881 
Ï¡_off£t
)

884 
bubbË_sÜt_ªd_ex´s
(
off£t_m­_begš
, 
off£t_m­_’d
, 
Ï¡_off£t
);

890 
Domš©ÜO±imiz”
 
dom
(
this
);

891 
	gi
 = 0; i < 
	g_š¢
.
size
(); i++)

892 
	gdom
.
run
(
i
);

895 
combše_com·tibË_¡©es
();

896 
»move_unu£d_¡©es
();

903 ià(
	g_š¢
.
size
(è=ğ0 && 
_ouut_ev”ythšg
 < 0)

904 
_ouut_ev”ythšg
 = -
CÏssifiÿtiÚ
::
j_Ãv”
;

905 ià(
	g_ouut_ev”ythšg
 >= 0)

906 
_š¢
.
ş—r
();

909 
	g_§ã_Ëngth
 = 0;

910 
	gi
 = 0; i < 
	g_š¢
.
size
(); i++) {

911 
	g»q_Ën
 = 
_š¢
[
i
].
»quœed_Ëngth
();

912 ià(
	g»q_Ën
 > 
	g_§ã_Ëngth
)

913 
	g_§ã_Ëngth
 = 
»q_Ën
;

915 
	g_§ã_Ëngth
 -ğ
_®ign_off£t
;

921 
	gProg¿m
::
£t_çu»
(
çu»
)

923 ià(
_ouut_ev”ythšg
 =ğ-
j_çu»
) {

924 
as£¹
(
çu»
 <= 0);

925 
	g_ouut_ev”ythšg
 = -
çu»
;

927 
	gi
 = 0; i < 
nš¢
(); ++i) {

928 
	gIn¢
& 
	gš¢
 = 
_š¢
[
i
];

929 
	gk
 = 0; k < 2; ++k)

930 ià(
	gš¢
.
	gj
[
k
] =ğ
j_çu»
)

931 
š¢
.
j
[
k
] = 
çu»
;

936 
	gProg¿m
::
add_Ü_´og¿m
(cÚ¡ 
Prog¿m
& 
Ãxt_´og¿m
)

943 ià(
_ouut_ev”ythšg
 < 0 || _ouut_ev”ythšg =ğ-
j_çu»
) {

945 
çu»
 = -
Ãxt_´og¿m
.
ouut_ev”ythšg
();

946 ià(
	gçu»
 > 0)

947 
	gçu»
 = 
nš¢
();

948 
£t_çu»
(
çu»
);

951 
	goff£t
 = 
nš¢
();

952 
	gi
 = 0; i < 
	gÃxt_´og¿m
.
nš¢
(); ++i)

953 
	g_š¢
.
push_back
(
Ãxt_´og¿m
.
_š¢
[
i
].
off£t_by
(
off£t
));

961 
	gProg¿m
::
w¬n_unu£d_ouuts
(
nouuts
, 
E¼ÜHªdËr
 *
”rh
) const

963 
	gVeùÜ
<> 
u£d
(
nouuts
, 0);

964 ià(
	g_ouut_ev”ythšg
 >ğ0 && 
_ouut_ev”ythšg
 < 
nouuts
)

965 
u£d
[
_ouut_ev”ythšg
] = 1;

967 
	gi
 = 0; i < 
	g_š¢
.
size
(); ++i)

968 
	gk
 = 0; k < 2; ++k)

969 ià(
	g_š¢
[
i
].
	gj
[
k
] <ğ0 && -
_š¢
[i].
j
[k] < 
nouuts
)

970 
u£d
[-
_š¢
[
i
].
j
[
k
]] = 1;

972 
	gi
 = 0; i < 
	gnouuts
; ++i)

973 ià(!
	gu£d
[
i
])

974 
	g”rh
->
w¬nšg
("ouuˆ%d m©che nØ·ck‘s", 
i
);

977 
SŒšg


978 
	gProg¿m
::
uÅ¬£
() const

980 
SŒšgAccum
 
§
;

981 
	gi
 = 0; i < 
	g_š¢
.
size
(); i++) {

982 
In¢
 
	gš
 = 
_š¢
[
i
];

983 
	gš
.
	goff£t
 -ğ
_®ign_off£t
;

984 
	g§
 << (
	gi
 < 10 ? " " : ""è<< 
i
 << ' ' << 
š
 << '\n';

986 ià(
	g_š¢
.
size
() == 0)

987 
§
 << "®l->[" << 
_ouut_ev”ythšg
 << "]\n";

988 
	g§
 << "§ã†’gth " << 
	g_§ã_Ëngth
 << "\n";

989 
	g§
 << "®ignm’ˆoff£ˆ" << 
	g_®ign_off£t
 << "\n";

990  
	g§
.
ke_¡ršg
();

999 
	gCom´es£dProg¿m
::
compe
(cÚ¡ 
Prog¿m
 &
´og
, 
boŞ
 
³rfÜm_bš¬y_£¬ch
,

1000 
mš_bš¬y_£¬ch
)

1032 
	g_z´og
.
ş—r
();

1033 
	g_ouut_ev”ythšg
 = 
´og
.
ouut_ev”ythšg
();

1034 
	g_§ã_Ëngth
 = 
´og
.
§ã_Ëngth
();

1035 
	g_®ign_off£t
 = 
´og
.
®ign_off£t
();

1037 
	gVeùÜ
<> 
wª‹d
(
´og
.
nš¢
() + 1, 0);

1038 
	gwª‹d
[0] = 1;

1039 cÚ¡ 
In¢
 *
	gš
 = 
´og
.
begš
(); iÀ!ğ´og.
’d
(); ++in)

1040 ià(
	gwª‹d
[
š
 - 
´og
.
begš
()])

1041 
	gj
 = 0; j < 2; j++)

1042 ià(
	gš
->
	gj
[
j
] > 0)

1043 
	gwª‹d
[
š
->
j
[j]]++;

1045 
	gVeùÜ
<> 
	goff£ts
;

1046 
	gi
 = 0; i < 
	g´og
.
nš¢
(); i++) {

1047 
	goff
 = 
_z´og
.
size
();

1048 
	goff£ts
.
push_back
(
off
);

1049 ià(
	gwª‹d
[
i
] == 0)

1051 cÚ¡ 
	gIn¢
 &
	gš
 = 
´og
.
š¢
(
i
);

1052 
	g_z´og
.
push_back
(
š
.
off£t
 + (š.
shÜt_ouut
 ? 0x10000 : 0) + 0x20000);

1053 
	g_z´og
.
push_back
(
š
.
no
());

1054 
	g_z´og
.
push_back
(
š
.
yes
());

1055 
	g_z´og
.
push_back
(
š
.
mask
.
u
);

1056 
	g_z´og
.
push_back
(
š
.
v®ue
.
u
);

1057 
	gno
;

1058 (
	gno
 = (
št32_t
è
_z´og
[
off
+1]è> 0 && 
wª‹d
[
no
] == 1

1059 && 
´og
.
š¢
(
no
).
yes
(è=ğ
š
.yes()

1060 && 
´og
.
š¢
(
no
).
off£t
 =ğ
š
.offset

1061 && 
´og
.
š¢
(
no
).
mask
.
u
 =ğ
š
.mask.u) {

1062 
_z´og
[
off
] += 0x20000;

1063 
	g_z´og
[
off
+1] = 
´og
.
š¢
(
no
).no();

1064 
	g_z´og
.
push_back
(
´og
.
š¢
(
no
).
v®ue
.
u
);

1065 
	gwª‹d
[
no
]--;

1067 ià(
	g³rfÜm_bš¬y_£¬ch
 && (
	g_z´og
[
off
] >> 17è>ğ
mš_bš¬y_£¬ch
)

1068 
şick_qsÜt
(&
_z´og
[
off
+4], _zprog[off] >> 17);

1070 
	goff£ts
.
push_back
(
_z´og
.
size
());

1072 
	gi
 = 0; i < 
	g´og
.
nš¢
(); i++)

1073 ià(
	goff£ts
[
i
] < 
	g_z´og
.
size
() && offsets[i] < offsets[i+1]) {

1074 
	goff
 = 
off£ts
[
i
];

1075 ià((
	gšt32_t
è
	g_z´og
[
off
+1] > 0)

1076 
	g_z´og
[
off
+1] = 
off£ts
[
_z´og
[off+1]] - off;

1077 ià((
	gšt32_t
è
	g_z´og
[
off
+2] > 0)

1078 
	g_z´og
[
off
+2] = 
off£ts
[
_z´og
[off+2]] - off;

1083 
	gCom´es£dProg¿m
::
w¬n_unu£d_ouuts
(
nouuts
, 
E¼ÜHªdËr
 *
”rh
) const

1085 
	gVeùÜ
<> 
u£d
(
nouuts
, 0);

1086 ià(
	g_ouut_ev”ythšg
 >ğ0 && 
_ouut_ev”ythšg
 < 
nouuts
)

1087 
u£d
[
_ouut_ev”ythšg
] = 1;

1089 
	gi
 = 0; i < 
	g_z´og
.
size
(); ) {

1090 
	gk
 = 1; k < 3; ++k) {

1091 
št32_t
 
	gouut
 = 
_z´og
[
i
+
k
];

1092 ià(
	gouut
 <ğ0 && -
ouut
 < 
nouuts
)

1093 
u£d
[-
ouut
] = 1;

1095 
	gi
 +ğ4 + (
_z´og
[
i
] >> 17);

1098 
	gi
 = 0; i < 
	gnouuts
; ++i)

1099 ià(!
	gu£d
[
i
])

1100 
	g”rh
->
w¬nšg
("ouuˆ%d m©che nØ·ck‘s", 
i
);

1103 
SŒšg


1104 
	gCom´es£dProg¿m
::
uÅ¬£
() const

1106 
VeùÜ
<> 
¡•no
(
_z´og
.
size
(), 0);

1107 
	gi
 = 0; i < 
	g_z´og
.
size
(); ) {

1108 
	gÅ¬ts
 = 
_z´og
[
i
] >> 17;

1109 ià(
	gi
 + 4 + 
	gÅ¬ts
 < 
	g_z´og
.
size
())

1110 
	g¡•no
[
i
 + 4 + 
Å¬ts
] = 
¡•no
[i] +‚parts;

1111 
	gi
 +ğ4 + 
Å¬ts
;

1114 
SŒšgAccum
 
	g§
;

1115 
	gi
 = 0; i < 
	g_z´og
.
size
(); ) {

1116 
	gÅ¬ts
 = 
_z´og
[
i
] >> 17;

1117 
	gj
 = 0; j < 
	gÅ¬ts
; ++j) {

1118 
	gmy¡•
 = 
¡•no
[
i
] + 
j
;

1119 
št32_t
 
	gno
, 
	gyes
;

1120 ià(
	gj
 + 1 < 
	gÅ¬ts
)

1121 
	gno
 = 
my¡•
 + 1;

1122 ià((
	gno
 = 
_z´og
[
i
 + 1]) > 0)

1123 
no
 = 
¡•no
[
i
 +‚o];

1124 ià((
	gyes
 = 
_z´og
[
i
 + 2]) > 0)

1125 
yes
 = 
¡•no
[
i
 + yes];

1126 
In¢
 
š
((
ušt16_t
è
_z´og
[
i
] - 
_®ign_off£t
,

1127 
_z´og
[
i
 + 4 + 
j
], _z´og[˜+ 3], 
no
, 
yes
,

1128 
_z´og
[
i
] & 0x10000);

1129 
	g§
 << (
	gmy¡•
 < 10 ? " " : ""è<< 
my¡•
 << ' ' << 
š
 << '\n';

1131 
	gi
 +ğ4 + 
Å¬ts
;

1133 ià(
	g_z´og
.
size
() == 0)

1134 
§
 << "®l->[" << 
_ouut_ev”ythšg
 << "]\n";

1135 
	g§
 << "§ã†’gth " << 
	g_§ã_Ëngth
 << "\n";

1136 
	g§
 << "®ignm’ˆoff£ˆ" << 
	g_®ign_off£t
 << "\n";

1137  
	g§
.
ke_¡ršg
();

1146 
	gProg¿m
::
Ëngth_checked_m©ch
(cÚ¡ 
Pack‘
 *
p
)

1148 cÚ¡ *
·ck‘_d©a
 = 
p
->
d©a
(è- 
_®ign_off£t
;

1149 
	g·ck‘_Ëngth
 = 
p
->
Ëngth
(è+ 
_®ign_off£t
;

1150 
In¢
 *
	gex
 = &
_š¢
[0];

1151 
	gpos
 = 0;

1152 
ušt32_t
 
	gd©a
;

1155 
	goff£t
 = 
ex
[
pos
].
off£t
;

1156 ià(
	goff£t
 + 
	gIn¢
::
width
 > 
·ck‘_Ëngth
)

1157 
check_Ëngth
;

1159 
	gËngth_ok
:

1160 
d©a
 = *(cÚ¡ 
ušt32_t
 *)(
·ck‘_d©a
 + 
off£t
);

1161 
	gd©a
 &ğ
ex
[
pos
].
mask
.
u
;

1162 
	gpos
 = 
ex
[
pos
].
j
[
d©a
 =ğex[pos].
v®ue
.
u
];

1165 
	gcheck_Ëngth
:

1166 ià(
off£t
 < 
·ck‘_Ëngth
) {

1167 
avaabË
 = 
·ck‘_Ëngth
 - 
off£t
;

1168 ià(!(
	gex
[
pos
].
	gmask
.
	gc
[3]

1169 || (
	gex
[
pos
].
	gmask
.
	gc
[2] && 
	gavaabË
 <= 2)

1170 || (
ex
[
pos
].
mask
.
c
[1] && 
avaabË
 == 1)))

1171 
Ëngth_ok
;

1173 
	gpos
 = 
ex
[
pos
].
j
[ex[pos].
shÜt_ouut
];

1174 } 
	gpos
 > 0);

1176  -
	gpos
;

1180 
CLICK_ENDDECLS


1181 
ELEMENT_PROVIDES
(
CÏssifiÿtiÚ
)

	@standard/classification.hh

1 #iâdeà
CLICK_CLASSIFICATION_HH


2 
	#CLICK_CLASSIFICATION_HH
 1

	)

3 
	#CLICK_CLASSIFICATION_WORDWISE_DOMINATOR_FASTPRED
 1

	)

4 
	~<şick/·ck‘.hh
>

5 
	~<şick/veùÜ.hh
>

6 
CLICK_DECLS


7 
şass
 
	gE¼ÜHªdËr
;

8 
Çme¥aû
 
	gCÏssifiÿtiÚ
 {

10 
	eJumps
 {

11 
	gj_Ãv”
 = -2147483647,

12 
	gj_çu»
,

13 
	gj_sucûss


16 
	eCombš”
 {

17 
	gc_ªd
,

18 
	gc_Ü
,

19 
	gc_‹º¬y


23 
	goff£t_max
 = 0x7FFFFFFF

26 
Çme¥aû
 
	gWÜdwi£
 {

28 
şass
 
	gDomš©ÜO±imiz”
;

31 
	sIn¢
 {

32 
ušt16_t
 
	goff£t
;

33 
ušt8_t
 
	g·ddšg
;

34 
ušt8_t
 
	gshÜt_ouut
;

36 
	gc
[4];

37 
ušt32_t
 
	gu
;

38 } 
	gmask
;

40 
	gc
[4];

41 
ušt32_t
 
	gu
;

42 } 
	gv®ue
;

43 
št32_t
 
	gj
[2];

46 
	gwidth
 = 4

49 
In¢
(
off£t_
, 
ušt32_t
 
v®ue_
, ušt32_ˆ
mask_
,

50 
št32_t
 
çu»_
 = 
j_çu»
, iÁ32_ˆ
sucûss_
 = 
j_sucûss
,

51 
boŞ
 
shÜt_ouut_
 = 
çl£
)

52 : 
off£t
(
off£t_
), 
·ddšg
(0), 
shÜt_ouut
(
shÜt_ouut_
) {

53 
	gmask
.
	gu
 = 
mask_
;

54 
	gv®ue
.
	gu
 = 
v®ue_
 & 
mask_
;

55 
	gj
[0] = 
çu»_
;

56 
	gj
[1] = 
sucûss_
;

59 
št32_t
 
yes
(ècÚ¡ {  
	gj
[1]; }

60 
št32_t
 
no
(ècÚ¡ {  
	gj
[0]; }

62 
£t_yes
(
d¡
è{ 
	gj
[1] = dst; }

63 
£t_no
(
d¡
è{ 
	gj
[0] = dst; }

65 
»quœed_Ëngth
() const {

66 ià(
	gmask
.
	gu
 == 0)

68 ià(
	gmask
.
	gc
[3])

69  
	goff£t
 + 4;

70 ià(
	gmask
.
	gc
[2])

71  
	goff£t
 + 3;

72 ià(
	gmask
.
	gc
[1])

73  
	goff£t
 + 2;

75  
	goff£t
 + 1;

81 
boŞ
 
im¶›s
(cÚ¡ 
In¢
 &
x
, 
known_Ëngth
) const;

89 
boŞ
 
nÙ_im¶›s
(cÚ¡ 
In¢
 &
x
, 
known_Ëngth
) const;

93 
boŞ
 
im¶›s_nÙ
(cÚ¡ 
In¢
 &
x
, 
known_Ëngth
) const;

98 
boŞ
 
nÙ_im¶›s_nÙ
(cÚ¡ 
In¢
 &
x
, 
known_Ëngth
) const;

105 
boŞ
 
com·tibË
(cÚ¡ 
In¢
 &
x
, boŞ 
cÚsid”_shÜt
) const;

111 
boŞ
 
g’”®izabË_Ü_·œ
(cÚ¡ 
In¢
 &
x
) const;

117 
boŞ
 
æ·bË
() const;

120 
æ
();

124 
In¢
 
off£t_by
(
off£t
) const {

125 
In¢
 
	gi
 = *
this
;

126 
	gk
 = 0; k < 2; ++k)

127 ià(
	gi
.
	gj
[
k
] > 0)

128 
	gi
.
	gj
[
k
] +ğ
off£t
;

129  
	gi
;

132 
SŒšg
 
uÅ¬£
() const;

134 
com·»
(cÚ¡ 
In¢
 &
a
, cÚ¡ In¢ &
b
) {

135  
memcmp
(&
a
, &
b
, 12);

138 
	g´iv©e
:

140 
šlše
 
boŞ
 
im¶›s_shÜt_ok
(boŞ 
dœeùiÚ
, cÚ¡ 
In¢
 &
x
, boŞ 
Ãxt_dœeùiÚ
, 
known_Ëngth
) const {

142 ià(
	gshÜt_ouut
 !ğ
dœeùiÚ
 || 
off£t
 + 4 <ğ(è
known_Ëngth
)

143  
Œue
;

145  
h¬d_im¶›s_shÜt_ok
(
dœeùiÚ
, 
x
, 
Ãxt_dœeùiÚ
, 
known_Ëngth
);

148 
boŞ
 
h¬d_im¶›s_shÜt_ok
(boŞ 
dœeùiÚ
, cÚ¡ 
In¢
 &
x
, boŞ 
Ãxt_dœeùiÚ
, 
known_Ëngth
) const;

152 
	gSŒšgAccum
 &
	gİ”©Ü
<<(SŒšgAccum &
	g§
, cÚ¡ 
	gIn¢
 &
	gš¢
);

155 şas 
	cProg¿m
 { 
	gpublic
:

157 
Prog¿m
(
®ign_off£t
 = 0)

158 : 
_ouut_ev”ythšg
(-
j_Ãv”
), 
_§ã_Ëngth
(() -1),

159 
_®ign_off£t
(
®ign_off£t
) {

162 
®ign_off£t
() const {

163  
	g_®ign_off£t
;

165 
ouut_ev”ythšg
() const {

166  
	g_ouut_ev”ythšg
;

168 
§ã_Ëngth
() const {

169  
	g_§ã_Ëngth
;

172 
nš¢
() const {

173  
	g_š¢
.
size
();

175 cÚ¡ 
	gIn¢
 &
š¢
(
i
) const {

176  
	g_š¢
[
i
];

178 cÚ¡ 
In¢
 *
begš
() const {

179  
	g_š¢
.
begš
();

181 cÚ¡ 
In¢
 *
’d
() const {

182  
	g_š¢
.
’d
();

185 
	gIn¢
 &
back
() {

186  
	g_š¢
.
back
();

189 
add_š¢
(
VeùÜ
<> &
Œ“
, 
off£t
, 
ušt32_t
 
v®ue
, ušt32_ˆ
mask
);

191 
	gVeùÜ
<> 
š™_subŒ“
() const;

192 
¡¬t_subŒ“
(
VeùÜ
<> &
Œ“
) const;

198 
Ãg©e_subŒ“
(
VeùÜ
<> &
Œ“
, 
boŞ
 
æ_shÜt
 = 
çl£
);

199 
šlše
 
fšish_subŒ“
(
VeùÜ
<>& 
Œ“
, 
Combš”
 
İ
) {

200 
fšish_subŒ“
(
Œ“
, 
İ
, 
j_sucûss
, 
j_çu»
);

202 
fšish_subŒ“
(
VeùÜ
<>& 
Œ“
, 
Combš”
 
İ
, 
sucûss
, 
çu»
);

204 
£t_çu»
(
çu»
);

205 
add_Ü_´og¿m
(cÚ¡ 
Prog¿m
& 
Ãxt_´og¿m
);

207 
combše_com·tibË_¡©es
();

208 
»move_unu£d_¡©es
();

209 
uÇligÃd_İtimize
();

210 
couÁ_šb¿nches
(
VeùÜ
<> &
šb¿nches
) const;

211 
bubbË_sÜt_ªd_ex´s
(cÚ¡ *
off£t_m­_begš
, cÚ¡ *
off£t_m­_’d
, 
Ï¡_off£t
);

212 
İtimize
(cÚ¡ *
off£t_m­_begš
, cÚ¡ *
off£t_m­_’d
, 
Ï¡_off£t
);

214 
w¬n_unu£d_ouuts
(
nouuts
, 
E¼ÜHªdËr
 *
”rh
) const;

216 
m©ch
(cÚ¡ 
Pack‘
 *
p
);

218 
SŒšg
 
uÅ¬£
() const;

220 
	g´iv©e
:

222 
VeùÜ
<
In¢
> 
_š¢
;

223 
	g_ouut_ev”ythšg
;

224 
	g_§ã_Ëngth
;

225 
	g_®ign_off£t
;

227 
»dœeù_subŒ“
(
fœ¡
, 
Ãxt
, 
sucûss
, 
çu»
);

229 
Ëngth_checked_m©ch
(cÚ¡ 
Pack‘
 *
p
);

230 
šlše
 
m­_off£t
(
off£t
, cÚ¡ *
begš
, cÚ¡ *
’d
);

231 
h¬d_m­_off£t
(
off£t
, cÚ¡ *
begš
, cÚ¡ *
’d
);

233 
ä›nd
 
şass
 
	gDomš©ÜO±imiz”
;

238 şas 
	cCom´es£dProg¿m
 { 
	gpublic
:

240 
Com´es£dProg¿m
()

241 : 
_ouut_ev”ythšg
(-
j_Ãv”
), 
_§ã_Ëngth
(() -1),

242 
_®ign_off£t
(0) {

245 
®ign_off£t
() const {

246  
	g_®ign_off£t
;

248 
ouut_ev”ythšg
() const {

249  
	g_ouut_ev”ythšg
;

251 
§ã_Ëngth
() const {

252  
	g_§ã_Ëngth
;

255 cÚ¡ 
ušt32_t
 *
begš
() const {

256  
	g_z´og
.
begš
();

258 cÚ¡ 
ušt32_t
 *
’d
() const {

259  
	g_z´og
.
’d
();

262 
compe
(cÚ¡ 
Prog¿m
 &
´og
, 
boŞ
 
³rfÜm_bš¬y_£¬ch
,

263 
mš_bš¬y_£¬ch
);

265 
w¬n_unu£d_ouuts
(
nouuts
, 
E¼ÜHªdËr
 *
”rh
) const;

267 
SŒšg
 
uÅ¬£
() const;

269 
	g´iv©e
:

271 
VeùÜ
<
ušt32_t
> 
_z´og
;

272 
	g_ouut_ev”ythšg
;

273 
	g_§ã_Ëngth
;

274 
	g_®ign_off£t
;

279 şas 
	cDomš©ÜO±imiz”
 { 
	gpublic
:

281 
Domš©ÜO±imiz”
(
Prog¿m
 *
p
);

283 
bºo
(
¡©e
, 
boŞ
 
br
è{  (
	g¡©e
 << 1è+ 
	gbr
; }

284 
¡©’o
(
bºo
è{  
	gbºo
 >> 1; }

285 
boŞ
 
br_yes
(
bºo
è{  
	gbºo
 & 1; }

287 
boŞ
 
br_im¶›s
(
bºo
, 
¡©e
) const {

288 
as£¹
(
¡©e
 > 0);

289 
	gäom_¡©e
 = 
¡©’o
(
bºo
);

290 
	gkl
 = 
_known_Ëngth
[
äom_¡©e
];

291 ià(
br_yes
(
bºo
))

292  
š¢
(
äom_¡©e
).
im¶›s
(š¢(
¡©e
), 
kl
);

294  
š¢
(
äom_¡©e
).
nÙ_im¶›s
(š¢(
¡©e
), 
kl
);

297 
boŞ
 
br_im¶›s_nÙ
(
bºo
, 
¡©e
) const {

298 
as£¹
(
¡©e
 > 0);

299 
	gäom_¡©e
 = 
¡©’o
(
bºo
);

300 
	gkl
 = 
_known_Ëngth
[
äom_¡©e
];

301 ià(
br_yes
(
bºo
))

302  
š¢
(
äom_¡©e
).
im¶›s_nÙ
(š¢(
¡©e
), 
kl
);

304  
š¢
(
äom_¡©e
).
nÙ_im¶›s_nÙ
(š¢(
¡©e
), 
kl
);

307 
run
(
¡©e
);

309 
´št
();

311 
	g´iv©e
:

313 
Prog¿m
 *
_p
;

314 
	gVeùÜ
<> 
	g_known_Ëngth
;

315 
	gVeùÜ
<> 
	g_š¢_id
;

316 
	gVeùÜ
<> 
	g_dom
;

317 
	gVeùÜ
<> 
	g_dom_¡¬t
;

318 
	gVeùÜ
<> 
	g_domli¡_¡¬t
;

319 #ià
CLICK_CLASSIFICATION_WORDWISE_DOMINATOR_FASTPRED


320 
mubË
 
	gVeùÜ
<> 
	g_´ed_fœ¡
;

321 
mubË
 
	gVeùÜ
<> 
	g_´ed_Ãxt
;

322 
mubË
 
	gVeùÜ
<> 
	g_´ed_´ev
;

325 ’um { 
	gMAX_DOMLIST
 = 4 };

327 
	gIn¢
 &
š¢
(
¡©e
) const {

328  
	g_p
->
	g_š¢
[
¡©e
];

330 
nš¢
() const {

331  
	g_p
->
	g_š¢
.
size
();

334 
š‹r£ù_li¡s
(cÚ¡ 
VeùÜ
<> &, cÚ¡ VeùÜ<> &, cÚ¡ VeùÜ<> &, 
pos1
, 
pos2
, Vector<> &);

335 
Ï¡_commÚ_¡©e_š_li¡s
(cÚ¡ 
VeùÜ
<> &, const Vector<> &, const Vector<> &);

336 
fšd_´edeûssÜs
(
¡©e
, 
VeùÜ
<> &) const;

337 
dom_shiá_b¿nch
(
bºo
, 
to_¡©e
, 
dom
, 
dom_’d
, 
VeùÜ
<> *
cŞËùÜ
);

338 
shiá_b¿nch
(
¡©e
, 
boŞ
 
b¿nch
);

339 
ÿlcuÏ‹_dom
(
¡©e
);

341 
šlše
 
£t_b¿nch
(
äom_¡©e
, 
boŞ
 
b¿nch
, 
to_¡©e
) {

342 
	gIn¢
 &
	gš
 = 
š¢
(
äom_¡©e
);

343 #ià
CLICK_CLASSIFICATION_WORDWISE_DOMINATOR_FASTPRED


344 
	gbr
 = 
bºo
(
äom_¡©e
, 
b¿nch
);

345 ià(
	gš
.
	gj
[
b¿nch
] > 0) {

346 ià(
	g_´ed_´ev
[
br
] >= 0)

347 
_´ed_Ãxt
[
_´ed_´ev
[
br
]] = _pred_next[br];

349 
	g_´ed_fœ¡
[
š
.
j
[
b¿nch
]] = 
_´ed_Ãxt
[
br
];

350 ià(
	g_´ed_Ãxt
[
br
] >= 0)

351 
_´ed_´ev
[
_´ed_Ãxt
[
br
]] = _pred_prev[br];

353 ià(
	gto_¡©e
 > 0) {

354 
	g´ev
 = -1, *
	g²ext
 = &
_´ed_fœ¡
[
to_¡©e
];

355 *
	g²ext
 >ğ0 && *
²ext
 < 
br
) {

356 
´ev
 = *
²ext
;

357 
	g²ext
 = &
_´ed_Ãxt
[*
²ext
];

359 
	g_´ed_´ev
[
br
] = 
´ev
;

360 
	g_´ed_Ãxt
[
br
] = *
²ext
;

361 *
	g²ext
 = 
br
;

362 ià(
	g_´ed_Ãxt
[
br
] >= 0)

363 
_´ed_´ev
[
_´ed_Ãxt
[
br
]] = br;

366 
	gš
.
	gj
[
b¿nch
] = 
to_¡©e
;

372 
šlše
 

373 
	gProg¿m
::
m©ch
(cÚ¡ 
Pack‘
 *
p
)

375 ià(
_ouut_ev”ythšg
 >= 0)

376  
_ouut_ev”ythšg
;

377 ià(
	gp
->
Ëngth
(è< 
	g_§ã_Ëngth
)

379  
Ëngth_checked_m©ch
(
p
);

381 cÚ¡ *
	g·ck‘_d©a
 = 
p
->
d©a
(è- 
_®ign_off£t
;

382 
	gpos
 = 0;

383 
In¢
 *
	gex
 = &
_š¢
[0];

386 
ušt32_t
 
	gd©a
 = *((cÚ¡ ušt32_ˆ*)(
·ck‘_d©a
 + 
ex
[
pos
].
off£t
));

387 
	gd©a
 &ğ
ex
[
pos
].
mask
.
u
;

388 
	gpos
 = 
ex
[
pos
].
j
[
d©a
 =ğex[pos].
v®ue
.
u
];

389 } 
	gpos
 > 0);

391  -
	gpos
;

395 
	gCLICK_ENDDECLS


	@standard/classifier.cc

21 
	~<şick/cÚfig.h
>

22 
	~"şassif›r.hh
"

23 
	~<şick/glue.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/cÚå¬£.hh
>

26 
	~<şick/¡¿ccum.hh
>

27 #ià!
HAVE_INDIFFERENT_ALIGNMENT


28 
	~<şick/rou‹r.hh
>

30 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

31 
CLICK_DECLS


33 
	gCÏssif›r
::
	$CÏssif›r
()

35 
	}
}

37 
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m


38 
CÏssif›r
::
	$em±y_´og¿m
(
E¼ÜHªdËr
 *
”rh
) const

41 
c
, 
o
;

42 ià(
Alignm’tInfo
::
	`qu”y
(
this
, 0, 
c
, 
o
) && c >= 4)

44 
o
 = (4 - (o % 4)) % 4;

46 #ià!
HAVE_INDIFFERENT_ALIGNMENT


47 ià(
”rh
) {

48 
”rh
->
	`w¬nšg
("alignment unknown, but machine is sensitiveo‡lignment");

49 *&
x
 = 
	`rou‹r
()->
	`fÜû_©chm’t
("Classifier‡lignment warning");

50 ià(!
x
) {

51 
x
 = (*è
this
;

52 
”rh
->
	`mes§ge
("(%s must beold how its input…ackets‡re‡ligned in memory.\n"

55 "oà%<Alignm’tInfo(% 4 0)%>.)", 
	`şass_Çme
(), 
	`Çme
().
	`c_¡r
());

59 (è
”rh
;

61 
o
 = 0;

63  
CÏssifiÿtiÚ
::
WÜdwi£
::
	`Prog¿m
(
o
);

64 
	}
}

67 
	$upd©e_v®ue_mask
(
c
, 
shiá
, &
v®ue
, &
mask
)

69 
v
 = 0, 
m
 = 0xF;

70 ià(
c
 == '?')

71 
v
 = 
m
 = 0;

72 ià(
c
 >= '0' && c <= '9')

73 
v
 = 
c
 - '0';

74 ià(
c
 >= 'A' && c <= 'F')

75 
v
 = 
c
 - 'A' + 10;

76 ià(
c
 >= 'a' && c <= 'f')

77 
v
 = 
c
 - 'a' + 10;

78 
v®ue
 |ğ(
v
 << 
shiá
);

79 
mask
 |ğ(
m
 << 
shiá
);

80 
	}
}

83 
	gCÏssif›r
::
·r£_´og¿m
(
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 &
´og
,

84 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

86 
	gVeùÜ
<> 
	gŒ“
 = 
´og
.
š™_subŒ“
();

87 
	g´og
.
¡¬t_subŒ“
(
Œ“
);

89 
	g¦Ù
 = 0; slÙ < 
	gcÚf
.
size
(); slot++) {

90 
	gi
 = 0;

91 
	gËn
 = 
cÚf
[
¦Ù
].
Ëngth
();

92 cÚ¡ *
	gs
 = 
cÚf
[
¦Ù
].
d©a
();

93 
boŞ
 
	gem±y
 = 
Œue
;

95 
	g´og
.
¡¬t_subŒ“
(
Œ“
);

97 ià(
	gs
[0] =ğ'-' && 
Ën
 == 1)

99 
i
 = 1;

101 
	gi
 < 
	gËn
) {

103 
	gi
 < 
	gËn
 && 
is¥aû
((è
s
[
i
]))

104 
	gi
++;

105 ià(
	gi
 >ğ
Ën
)

109 
boŞ
 
	gÃg©ed
 = 
çl£
;

110 ià(
	gs
[
i
] == '!') {

111 
Ãg©ed
 = 
Œue
;

112 
	gi
++;

113 
	gi
 < 
	gËn
 && 
is¥aû
((è
s
[
i
]))

114 
	gi
++;

117 ià(
	gi
 >ğ
Ën
 || !
isdig™
((è
s
[
i
])) {

118 
”rh
->
”rÜ
("·‰”À%d:ƒx³ùed‡ dig™", 
¦Ù
);

123 
	goff£t
 = 0;

124 
	gi
 < 
	gËn
 && 
isdig™
((è
s
[
i
])) {

125 
	goff£t
 *= 10;

126 
	goff£t
 +ğ
s
[
i
] - '0';

127 
	gi
++;

130 ià(
	gi
 >ğ
Ën
 || 
s
[
i
] != '/') {

131 
”rh
->
”rÜ
("·‰”À%d:ƒx³ùed %</%>", 
¦Ù
);

134 
	gi
++;

137 
	gv®ue_pos
 = 
i
;

138 
	gi
 < 
	gËn
 && (
isxdig™
((è
s
[
i
]è|| 
	gs
[i] == '?'))

139 
i
++;

140 
	gv®ue_’d
 = 
i
;

143 
	gmask_pos
 = -1;

144 
	gmask_’d
 = -1;

145 ià(
	gi
 < 
	gËn
 && 
	gs
[
i
] == '%') {

146 
i
++;

147 
	gmask_pos
 = 
i
;

148 
	gi
 < 
	gËn
 && (
isxdig™
((è
s
[
i
]è|| 
	gs
[i] == '?'))

149 
i
++;

150 
	gmask_’d
 = 
i
;

154 ià(
	gv®ue_’d
 - 
	gv®ue_pos
 < 2) {

155 
	g”rh
->
”rÜ
("·‰”À%d: v®uha Ës thª 2 hex dig™s", 
¦Ù
);

156 
	gv®ue_’d
 = 
v®ue_pos
;

157 
	gmask_’d
 = 
mask_pos
;

159 ià((
	gv®ue_’d
 - 
	gv®ue_pos
) % 2 != 0) {

160 
”rh
->
”rÜ
("·‰”À%d: v®uha odd‚umb” oàhex dig™s", 
¦Ù
);

161 
	gv®ue_’d
--;

162 
	gmask_’d
--;

164 ià(
	gmask_pos
 >ğ0 && (
mask_’d
 - 
mask_pos
è!ğ(
v®ue_’d
 - 
v®ue_pos
)) {

165 
boŞ
 
too_mªy
 = (
mask_’d
 - 
mask_pos
è> (
v®ue_’d
 - 
v®ue_pos
);

166 
	g”rh
->
”rÜ
("·‰”À%d: mask ha toØ% hex dig™s", 
¦Ù
,

167 (
too_mªy
 ? "many" : "few"));

168 ià(
	gtoo_mªy
)

169 
	gmask_’d
 = 
mask_pos
 + 
v®ue_’d
 - 
v®ue_pos
;

171 
	gv®ue_’d
 = 
v®ue_pos
 + 
mask_’d
 - 
mask_pos
;

175 
	g´og
.
¡¬t_subŒ“
(
Œ“
);

177 
boŞ
 
	gfœ¡
 = 
Œue
;

178 
	goff£t
 +ğ
´og
.
®ign_off£t
();

179 
	gv®ue_pos
 < 
	gv®ue_’d
) {

180 
	gv
 = 0, 
	gm
 = 0;

181 
upd©e_v®ue_mask
(
s
[
v®ue_pos
], 4, 
v
, 
m
);

182 
upd©e_v®ue_mask
(
s
[
v®ue_pos
+1], 0, 
v
, 
m
);

183 
	gv®ue_pos
 += 2;

184 ià(
	gmask_pos
 >= 0) {

185 
mv
 = 0, 
	gmm
 = 0;

186 
upd©e_v®ue_mask
(
s
[
mask_pos
], 4, 
mv
, 
mm
);

187 
upd©e_v®ue_mask
(
s
[
mask_pos
+1], 0, 
mv
, 
mm
);

188 
	gmask_pos
 += 2;

189 
	gm
 = 
m
 & 
mv
 & 
mm
;

191 ià(
	gfœ¡
 || 
	goff£t
 % 4 == 0) {

192 
´og
.
add_š¢
(
Œ“
, (
off£t
 / 4) * 4, 0, 0);

193 
	gfœ¡
 = 
em±y
 = 
çl£
;

195 
	g´og
.
back
().
	gmask
.
	gc
[
off£t
 % 4] = 
m
;

196 
	g´og
.
back
().
	gv®ue
.
	gc
[
off£t
 % 4] = 
v
 & 
m
;

197 
	goff£t
++;

201 
	g´og
.
fšish_subŒ“
(
Œ“
, 
CÏssifiÿtiÚ
::
c_ªd
);

203 ià(
	gÃg©ed
)

204 
	g´og
.
Ãg©e_subŒ“
(
Œ“
);

208 ià(
	gem±y
)

209 
	g´og
.
add_š¢
(
Œ“
, 0, 0, 0);

211 
	g´og
.
fšish_subŒ“
(
Œ“
, 
CÏssifiÿtiÚ
::
c_ªd
,

212 -
¦Ù
, 
CÏssifiÿtiÚ
::
j_çu»
);

215 
	g´og
.
fšish_subŒ“
(
Œ“
, 
CÏssifiÿtiÚ
::
c_Ü
, CÏssifiÿtiÚ::
j_Ãv”
, Classification::j_never);

218 
	g´og
.
İtimize
(0, 0, 
CÏssifiÿtiÚ
::
off£t_max
);

223 
	gCÏssif›r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

225 ià(
	gcÚf
.
size
(è!ğ
nouuts
())

226  
”rh
->
”rÜ
("Ãed %d‡rgum’ts, oÃ…” ouuˆpÜt", 
nouuts
());

228 
	gCÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 
´og
 = 
em±y_´og¿m
(
”rh
);

229 
·r£_´og¿m
(
´og
, 
cÚf
, 
”rh
);

231 ià(!
	g”rh
->
Ã¼Üs
()) {

232 
	g´og
.
w¬n_unu£d_ouuts
(
nouuts
(), 
”rh
);

233 
	g_´og
 = 
´og
;

239 
SŒšg


240 
	gCÏssif›r
::
	$´og¿m_¡ršg
(
EËm’t
 *
–em’t
, *)

242 
CÏssif›r
 *
c
 = 
¡©ic_ÿ¡
<CÏssif›¸*>(
–em’t
);

243  
c
->
_´og
.
	`uÅ¬£
();

244 
	}
}

247 
	gCÏssif›r
::
	$add_hªdËrs
()

249 
	`add_»ad_hªdËr
("´og¿m", 
CÏssif›r
::
´og¿m_¡ršg
, 0, 
HªdËr
::
CALM
);

250 
	}
}

253 
	gCÏssif›r
::
	$push
(, 
Pack‘
 *
p
)

255 
	`checked_ouut_push
(
_´og
.
	`m©ch
(
p
),…);

256 
	}
}

258 
CLICK_ENDDECLS


259 
	$ELEMENT_REQUIRES
(
Alignm’tInfo
 
CÏssifiÿtiÚ
)

260 
	$EXPORT_ELEMENT
(
CÏssif›r
)

261 
	`ELEMENT_MT_SAFE
(
CÏssif›r
)

	@standard/classifier.hh

1 #iâdeà
CLICK_CLASSIFIER_HH


2 
	#CLICK_CLASSIFIER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"şassifiÿtiÚ.hh
"

5 
CLICK_DECLS


75 şas 
	cCÏssif›r
 : 
public
 
EËm’t
 {…ublic:

77 
	$CÏssif›r
(è
CLICK_COLD
;

79 cÚ¡ *
	$şass_Çme
() const {  "Classifier"; }

80 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

81 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

83 cÚ¡ *
	$æags
(ècÚ¡ {  "A"; 
	}
}

84 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

86 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

87 
	$add_hªdËrs
(è
CLICK_COLD
;

89 
	`push
(
pÜt
, 
Pack‘
 *);

91 
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 
	$em±y_´og¿m
(
E¼ÜHªdËr
 *
”rh
) const;

92 
	`·r£_´og¿m
(
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 &
´og
,

93 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
);

95 
´Ùeùed
:

97 
CÏssifiÿtiÚ
::
WÜdwi£
::
Prog¿m
 
_´og
;

99 
SŒšg
 
	`´og¿m_¡ršg
(
EËm’t
 *, *);

101 
	}
};

103 
	gCLICK_ENDDECLS


	@standard/clickyinfo.cc

18 
	~<şick/cÚfig.h
>

19 
	~"şickyšfo.hh
"

20 
CLICK_DECLS


22 
	gClickyInfo
::
	$ClickyInfo
()

24 
	}
}

27 
ClickyInfo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *)

32 
CLICK_ENDDECLS


33 
EXPORT_ELEMENT
(
ClickyInfo
)

	@standard/clickyinfo.hh

1 #iâdeà
CLICK_CLICKYINFO_HH


2 
	#CLICK_CLICKYINFO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


20 şas 
	cClickyInfo
 : 
public
 
EËm’t
 {…ublic:

22 
	$ClickyInfo
(è
CLICK_COLD
;

24 cÚ¡ *
	$şass_Çme
() const {  "ClickyInfo"; }

25 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

27 
	}
};

29 
	gCLICK_ENDDECLS


	@standard/clipboard.cc

5 
	~<şick/cÚfig.h
>

6 
	~"şbßrd.hh
"

7 
	~<şick/¬gs.hh
>

8 
	~<şick/”rÜ.hh
>

9 
CLICK_DECLS


12 
	gClbßrd
::
	$Clbßrd
()

14 
	}
}

18 
Clbßrd
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

20 
	gVeùÜ
<
	gRªge
> 
	g¿nges
 = 
VeùÜ
<
Rªge
>();

21 
Rªge
 
	g¿nge
;

22 
	gşbßrdSize
 = 0;

23 
	g_mšPack‘L’gth
 = 0;

25 
	g¬gNo
 = 0;‡rgNØ< 
	gcÚf
.
size
();‡rgNo++) {

26 
SŒšg
 
	g¬g
 = 
cÚf
[
¬gNo
];

27 
	gi
 = 
¬g
.
fšd_Ëá
('/');

28 ià(
	gi
 <ğ0 || 
i
 >ğ
¬g
.
Ëngth
() - 1) {

29 
”rh
->
”rÜ
("¿ng%d:ƒx³ùed '/' b‘w“Àoff£ˆªd†’gth", 
¬gNo
);

33 ià(
Args
(
this
, 
”rh
)

34 .
push_back
(
¬g
.
sub¡ršg
(0, 
i
))

35 .
push_back
(
¬g
.
sub¡ršg
(
i
 + 1))

36 .
»ad_mp
("OFFSET", 
¿nge
.
off£t
)

37 .
»ad_mp
("LENGTH", 
¿nge
.
Ëngth
)

38 .
com¶‘e
() < 0) {

39 
	g”rh
->
”rÜ
("¿ng%d: inv®id off£ˆÜ†’gth", 
¬gNo
);

43 
	g¿nges
.
push_back
(
¿nge
);

44 
	gşbßrdSize
 +ğ
¿nge
.
Ëngth
;

45 ià(
	g¿nge
.
	goff£t
 +„ªge.
	gËngth
 > 
	g_mšPack‘L’gth
)

46 
	g_mšPack‘L’gth
 = 
¿nge
.
off£t
 +„ªge.
Ëngth
;

49 
	g_¿nges
 = 
¿nges
;

50 
	g_şbßrd
.
»size
(
şbßrdSize
);

55 
Pack‘
 *

56 
	gClbßrd
::
	$puÎ
(
pÜt
)

58 
Pack‘
 *
p
 = 
	`šput
(
pÜt
).
	`puÎ
();

59 ià(!
p
è 
NULL
;

60 ià(
pÜt
 =ğ0è
	`cİy
(
p
);

61 
p
 = 
	`·¡e
(p);

62  
p
;

63 
	}
}

67 
	gClbßrd
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

69 ià(
pÜt
 =ğ0è
	`cİy
(
p
);

71 
p
 = 
	`·¡e
(p);

72 ià(!
p
) ;

74 
	`ouut
(
pÜt
).
	`push
(
p
);

75 
	}
}

79 
	gClbßrd
::
	$cİy
(
Pack‘
 *
p
)

82 *
d¡
 = &
_şbßrd
[0];

83 
i
 = 0; i < 
_¿nges
.
	`size
(); i++) {

84 
Rªge
 
¿nge
 = 
_¿nges
[
i
];

85 cÚ¡ *
¤c
 = 
p
->
	`d©a
(è+ 
¿nge
.
off£t
;

86 
	`memıy
(
d¡
, 
¤c
, 
¿nge
.
Ëngth
);

87 
d¡
 +ğ
¿nge
.
Ëngth
;

89 
	}
}

92 
Pack‘
 *

93 
	gClbßrd
::
	$·¡e
(
Pack‘
 *
p
)

95 ià(
p
->
	`Ëngth
(è< 
_mšPack‘L’gth
) …;

97 
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
();

98 ià(!
q
è 
NULL
;

100 cÚ¡ *
¤c
 = &
_şbßrd
[0];

101 *
d¡
 = 
q
->
	`d©a
();

103 
i
 = 0; i < 
_¿nges
.
	`size
(); i++) {

104 
Rªge
 
¿nge
 = 
_¿nges
[
i
];

105 
	`memıy
(
d¡
 + 
¿nge
.
off£t
, 
¤c
,„ªge.
Ëngth
);

106 
¤c
 +ğ
¿nge
.
Ëngth
;

108  
q
;

109 
	}
}

112 
CLICK_ENDDECLS


113 
EXPORT_ELEMENT
(
Clbßrd
)

	@standard/clipboard.hh

2 #iâdeà
CLICK_CLIPBOARD_HH


3 
	#CLICK_CLIPBOARD_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


40 
	sRªge
 {

41 
ušt32_t
 
	moff£t
;

42 
ušt32_t
 
	mËngth
;

46 şas 
	cClbßrd
 : 
public
 
EËm’t
 {

47 
public
:

48 
	$Clbßrd
(è
CLICK_COLD
;

50 cÚ¡ *
	$şass_Çme
() const {  "Clipboard"; }

51 cÚ¡ *
	$æags
(ècÚ¡ {  "S0"; 
	}
}

52 cÚ¡ *
	$æow_code
(ècÚ¡ {  "#/#"; 
	}
}

53 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/2"; 
	}
}

55 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

56 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

58 
Pack‘
 *
puÎ
(
pÜt
);

59 
push
(
pÜt
, 
Pack‘
 *
p
);

61 
	g´iv©e
:

62 
VeùÜ
<> 
_şbßrd
;

63 
	gVeùÜ
<
	gRªge
> 
	g_¿nges
;

64 
ušt32_t
 
	g_mšPack‘L’gth
;

66 
cİy
(
Pack‘
 *
p
);

67 
Pack‘
 *
·¡e
(Pack‘ *
p
);

71 
	gCLICK_ENDDECLS


	@standard/compblock.cc

19 
	~<şick/cÚfig.h
>

20 
	~"compblock.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
CLICK_DECLS


26 
	gCom·»Block
::
	$Com·»Block
()

27 : 
	`_fwd_weight
(0), 
	$_»v_weight
(1)

29 
	}
}

32 
	gCom·»Block
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

34 
	g_bad
 = 0;

35  
Args
(
cÚf
, 
this
, 
”rh
)

36 .
»ad_mp
("FWD_WEIGHT", 
_fwd_weight
)

37 .
»ad_mp
("REV_WEIGHT", 
_»v_weight
)

38 .
»ad_mp
("THRESH", 
_th»sh
).
com¶‘e
();

42 
	gCom·»Block
::
	$push
(, 
Pack‘
 *
p
)

45 
fwd
 = 
	`FWD_RATE_ANNO
(
p
);

46 ià(
fwd
 < 1) fwd = 1;

47 
»v
 = 
	`REV_RATE_ANNO
(
p
);

48 ià(
»v
 < 1)„ev = 1;

49 ià((
fwd
 > 
_th»sh
 || 
»v
 > _thresh) &&

50 
_fwd_weight
 * 
fwd
 > 
_»v_weight
 * 
»v
) {

51 
	`ouut
(1).
	`push
(
p
);

53 
	`ouut
(0).
	`push
(
p
);

54 
	}
}

59 
	gCom·»Block
::
	$fwd_weight_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
,

60 *, 
E¼ÜHªdËr
 *
”rh
)

62 
VeùÜ
<
SŒšg
> 
¬gs
;

63 
	`ı_¬gvec
(
cÚf
, 
¬gs
);

64 
Com·»Block
* 
me
 = (Com·»Block *è
e
;

66 if(
¬gs
.
	`size
() != 1) {

67  
”rh
->
	`”rÜ
("expecting one integer");

69 
weight
;

70 if(!
	`IÁArg
().
	`·r£
(
¬gs
[0], 
weight
)) {

71  
”rh
->
	`”rÜ
("not‡n integer");

73 
me
->
_fwd_weight
 = 
weight
;

75 
	}
}

78 
	gCom·»Block
::
	$»v_weight_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
,

79 *, 
E¼ÜHªdËr
 *
”rh
)

81 
VeùÜ
<
SŒšg
> 
¬gs
;

82 
	`ı_¬gvec
(
cÚf
, 
¬gs
);

83 
Com·»Block
* 
me
 = (Com·»Block *è
e
;

85 if(
¬gs
.
	`size
() != 1) {

86  
”rh
->
	`”rÜ
("expecting one integer");

88 
weight
;

89 if(!
	`IÁArg
().
	`·r£
(
¬gs
[0], 
weight
)) {

90  
”rh
->
	`”rÜ
("not‡n integer");

92 
me
->
_»v_weight
 = 
weight
;

94 
	}
}

97 
	gCom·»Block
::
	$th»sh_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
,

98 *, 
E¼ÜHªdËr
 *
”rh
)

100 
VeùÜ
<
SŒšg
> 
¬gs
;

101 
	`ı_¬gvec
(
cÚf
, 
¬gs
);

102 
Com·»Block
* 
me
 = (Com·»Block *è
e
;

104 if(
¬gs
.
	`size
() != 1) {

105  
”rh
->
	`”rÜ
("expecting one integer");

107 
th»sh
;

108 if(!
	`IÁArg
().
	`·r£
(
¬gs
[0], 
th»sh
)) {

109  
”rh
->
	`”rÜ
("not‡n integer");

111 
me
->
_th»sh
 = 
th»sh
;

113 
	}
}

115 
SŒšg


116 
	gCom·»Block
::
	$fwd_weight_»ad_hªdËr
(
EËm’t
 *
e
, *)

118 
Com·»Block
 *
me
 = (Com·»Block *è
e
;

119  
	`SŒšg
(
me
->
_fwd_weight
);

120 
	}
}

122 
SŒšg


123 
	gCom·»Block
::
	$»v_weight_»ad_hªdËr
(
EËm’t
 *
e
, *)

125 
Com·»Block
 *
me
 = (Com·»Block *è
e
;

126  
	`SŒšg
(
me
->
_»v_weight
);

127 
	}
}

129 
SŒšg


130 
	gCom·»Block
::
	$th»sh_»ad_hªdËr
(
EËm’t
 *
e
, *)

132 
Com·»Block
 *
me
 = (Com·»Block *è
e
;

133  
	`SŒšg
(
me
->
_th»sh
);

134 
	}
}

137 
	gCom·»Block
::
	$add_hªdËrs
()

139 
	`add_»ad_hªdËr
("fwd_weight", 
fwd_weight_»ad_hªdËr
, 0);

140 
	`add_wr™e_hªdËr
("fwd_weight", 
fwd_weight_wr™e_hªdËr
, 0);

141 
	`add_»ad_hªdËr
("»v_weight", 
»v_weight_»ad_hªdËr
, 0);

142 
	`add_wr™e_hªdËr
("»v_weight", 
»v_weight_wr™e_hªdËr
, 0);

143 
	}
}

145 
CLICK_ENDDECLS


146 
	$EXPORT_ELEMENT
(
Com·»Block
)

147 
	`ELEMENT_MT_SAFE
(
Com·»Block
)

	@standard/compblock.hh

1 #iâdeà
CLICK_COMPBLOCK_HH


2 
	#CLICK_COMPBLOCK_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


36 şas 
	cCom·»Block
 : 
public
 
EËm’t
 {…ublic:

38 
	$Com·»Block
(è
CLICK_COLD
;

40 cÚ¡ *
	$şass_Çme
() const {  "CompareBlock"; }

41 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/2"; 
	}
}

42 
	$add_hªdËrs
(è
CLICK_COLD
;

44 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

45 
	`push
(
pÜt
, 
Pack‘
 *);

47 
´iv©e
:

49 
_fwd_weight
;

50 
_»v_weight
;

51 
_th»sh
;

52 
_bad
;

54 
»v_weight_wr™e_hªdËr


55 (cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
);

56 
fwd_weight_wr™e_hªdËr


57 (cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
);

58 
th»sh_wr™e_hªdËr


59 (cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
);

61 
SŒšg
 
	$»v_weight_»ad_hªdËr
(
EËm’t
 *
e
, *è
CLICK_COLD
;

62 
SŒšg
 
	$fwd_weight_»ad_hªdËr
(
EËm’t
 *
e
, *è
CLICK_COLD
;

63 
SŒšg
 
	$th»sh_»ad_hªdËr
(
EËm’t
 *
e
, *è
CLICK_COLD
;

64 
	}
};

66 
	gCLICK_ENDDECLS


	@standard/counter.cc

19 
	~<şick/cÚfig.h
>

20 
	~"couÁ”.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/cÚå¬£.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/hªdËrÿÎ.hh
>

25 
CLICK_DECLS


27 
	gCouÁ”
::
	$CouÁ”
()

28 : 
	`_couÁ_Œigg”_h
(0), 
	$_by‹_Œigg”_h
(0)

30 
	}
}

32 
	gCouÁ”
::~
	$CouÁ”
()

34 
d–‘e
 
_couÁ_Œigg”_h
;

35 
d–‘e
 
_by‹_Œigg”_h
;

36 
	}
}

39 
	gCouÁ”
::
	$»£t
()

41 
_couÁ
 = 
_by‹_couÁ
 = 0;

42 
_couÁ_Œigg”ed
 = 
_by‹_Œigg”ed
 = 
çl£
;

43 
	}
}

46 
	gCouÁ”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

48 
SŒšg
 
	gcouÁ_ÿÎ
, 
	gby‹_couÁ_ÿÎ
;

49 ià(
Args
(
cÚf
, 
this
, 
”rh
)

50 .
»ad
("COUNT_CALL", 
AnyArg
(), 
couÁ_ÿÎ
)

51 .
»ad
("BYTE_COUNT_CALL", 
AnyArg
(), 
by‹_couÁ_ÿÎ
).
com¶‘e
() < 0)

54 ià(
	gcouÁ_ÿÎ
) {

55 
IÁArg
 
	gŸ
;

56 ià(!
	gŸ
.
·r£_§tu¿tšg
(
ı_shiá_¥aûvec
(
couÁ_ÿÎ
), 
_couÁ_Œigg”
))

57  
	g”rh
->
”rÜ
("COUNT_CALLype mismatch");

58 ià(
	gŸ
.
	g¡©us
 =ğ
IÁArg
::
¡©us_¿nge
)

59 
”rh
->
”rÜ
("COUNT_CALL ov”æow, max %s", 
SŒšg
(
_couÁ_Œigg”
).
c_¡r
());

60 
	g_couÁ_Œigg”_h
 = 
Ãw
 
HªdËrC®l
(
couÁ_ÿÎ
);

62 
	g_couÁ_Œigg”
 = (
couÁ”_t
)(-1);

64 ià(
	gby‹_couÁ_ÿÎ
) {

65 
IÁArg
 
	gŸ
;

66 ià(!
	gŸ
.
·r£_§tu¿tšg
(
ı_shiá_¥aûvec
(
by‹_couÁ_ÿÎ
), 
_by‹_Œigg”
))

67  
	g”rh
->
”rÜ
("BYTE_COUNT_CALLype mismatch");

68 ià(
	gŸ
.
	g¡©us
 =ğ
IÁArg
::
¡©us_¿nge
)

69 
”rh
->
”rÜ
("BYTE_COUNT_CALL ov”æow, max %s", 
SŒšg
(
_couÁ_Œigg”
).
c_¡r
());

70 
	g_by‹_Œigg”_h
 = 
Ãw
 
HªdËrC®l
(
by‹_couÁ_ÿÎ
);

72 
	g_by‹_Œigg”
 = (
couÁ”_t
)(-1);

78 
	gCouÁ”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

80 ià(
_couÁ_Œigg”_h
 && _couÁ_Œigg”_h->
	`š™Ÿlize_wr™e
(
this
, 
”rh
) < 0)

82 ià(
_by‹_Œigg”_h
 && _by‹_Œigg”_h->
	`š™Ÿlize_wr™e
(
this
, 
”rh
) < 0)

84 
	`»£t
();

86 
	}
}

88 
Pack‘
 *

89 
	gCouÁ”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

91 
_couÁ
++;

92 
_by‹_couÁ
 +ğ
p
->
	`Ëngth
();

93 
_¿‹
.
	`upd©e
(1);

94 
_by‹_¿‹
.
	`upd©e
(
p
->
	`Ëngth
());

96 ià(
_couÁ
 =ğ
_couÁ_Œigg”
 && !
_couÁ_Œigg”ed
) {

97 
_couÁ_Œigg”ed
 = 
Œue
;

98 ià(
_couÁ_Œigg”_h
)

99 (è
_couÁ_Œigg”_h
->
	`ÿÎ_wr™e
();

101 ià(
_by‹_couÁ
 >ğ
_by‹_Œigg”
 && !
_by‹_Œigg”ed
) {

102 
_by‹_Œigg”ed
 = 
Œue
;

103 ià(
_by‹_Œigg”_h
)

104 (è
_by‹_Œigg”_h
->
	`ÿÎ_wr™e
();

107  
p
;

108 
	}
}

111 ’um { 
	mH_COUNT
, 
	mH_BYTE_COUNT
, 
	mH_RATE
, 
	mH_BIT_RATE
, 
	mH_BYTE_RATE
, 
	mH_RESET
,

112 
	mH_COUNT_CALL
, 
	mH_BYTE_COUNT_CALL
 };

114 
SŒšg


115 
	gCouÁ”
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

117 
CouÁ”
 *
c
 = (CouÁ” *)
e
;

118 (
šŒ_t
)
thunk
) {

119 
H_COUNT
:

120  
	`SŒšg
(
c
->
_couÁ
);

121 
H_BYTE_COUNT
:

122  
	`SŒšg
(
c
->
_by‹_couÁ
);

123 
H_RATE
:

124 
c
->
_¿‹
.
	`upd©e
(0);

125  
c
->
_¿‹
.
	`uÅ¬£_¿‹
();

126 
H_BIT_RATE
:

127 
c
->
_by‹_¿‹
.
	`upd©e
(0);

130 ià(
c
->
_by‹_¿‹
.
	`sÿË
() >= 3)

131  
	`ı_uÅ¬£_»®2
(
c
->
_by‹_¿‹
.
	`sÿËd_av”age
(è* c->_by‹_¿‹.
	`•och_äequ’cy
(), c->_by‹_¿‹.
	`sÿË
() - 3);

133  
	`ı_uÅ¬£_»®2
(
c
->
_by‹_¿‹
.
	`sÿËd_av”age
(è* c->_by‹_¿‹.
	`•och_äequ’cy
(è* 8, c->_by‹_¿‹.
	`sÿË
());

134 
H_BYTE_RATE
:

135 
c
->
_by‹_¿‹
.
	`upd©e
(0);

136  
c
->
_by‹_¿‹
.
	`uÅ¬£_¿‹
();

137 
H_COUNT_CALL
:

138 ià(
c
->
_couÁ_Œigg”_h
)

139  
	`SŒšg
(
c
->
_couÁ_Œigg”
);

141  
	`SŒšg
();

145 
	}
}

148 
	gCouÁ”
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
š_¡r
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

150 
CouÁ”
 *
c
 = (CouÁ” *)
e
;

151 
SŒšg
 
¡r
 = 
š_¡r
;

152 (
šŒ_t
)
thunk
) {

153 
H_COUNT_CALL
:

154 ià(!
	`IÁArg
().
	`·r£
(
	`ı_shiá_¥aûvec
(
¡r
), 
c
->
_couÁ_Œigg”
))

155  
”rh
->
	`”rÜ
("'count_call' first word should be unsigned (count)");

156 ià(
HªdËrC®l
::
	`»£t_wr™e
(
c
->
_couÁ_Œigg”_h
, 
¡r
, c, 
”rh
) < 0)

158 
c
->
_couÁ_Œigg”ed
 = 
çl£
;

160 
H_BYTE_COUNT_CALL
:

161 ià(!
	`IÁArg
().
	`·r£
(
	`ı_shiá_¥aûvec
(
¡r
), 
c
->
_by‹_Œigg”
))

162  
”rh
->
	`”rÜ
("'byte_count_call' first word should be unsigned (count)");

163 ià(
HªdËrC®l
::
	`»£t_wr™e
(
c
->
_by‹_Œigg”_h
, 
¡r
, c, 
”rh
) < 0)

165 
c
->
_by‹_Œigg”ed
 = 
çl£
;

167 
H_RESET
:

168 
c
->
	`»£t
();

171  
”rh
->
	`”rÜ
("<internal>");

173 
	}
}

176 
	gCouÁ”
::
	$add_hªdËrs
()

178 
	`add_»ad_hªdËr
("couÁ", 
»ad_hªdËr
, 
H_COUNT
);

179 
	`add_»ad_hªdËr
("by‹_couÁ", 
»ad_hªdËr
, 
H_BYTE_COUNT
);

180 
	`add_»ad_hªdËr
("¿‹", 
»ad_hªdËr
, 
H_RATE
);

181 
	`add_»ad_hªdËr
("b™_¿‹", 
»ad_hªdËr
, 
H_BIT_RATE
);

182 
	`add_»ad_hªdËr
("by‹_¿‹", 
»ad_hªdËr
, 
H_BYTE_RATE
);

183 
	`add_wr™e_hªdËr
("»£t", 
wr™e_hªdËr
, 
H_RESET
, 
HªdËr
::
f_bu‰Ú
);

184 
	`add_wr™e_hªdËr
("»£t_couÁs", 
wr™e_hªdËr
, 
H_RESET
, 
HªdËr
::
f_bu‰Ú
 | HªdËr::
f_uncommÚ
);

185 
	`add_»ad_hªdËr
("couÁ_ÿÎ", 
»ad_hªdËr
, 
H_COUNT_CALL
);

186 
	`add_wr™e_hªdËr
("couÁ_ÿÎ", 
wr™e_hªdËr
, 
H_COUNT_CALL
);

187 
	`add_wr™e_hªdËr
("by‹_couÁ_ÿÎ", 
wr™e_hªdËr
, 
H_BYTE_COUNT_CALL
);

188 
	}
}

191 
	gCouÁ”
::
	$Î½c
(
commªd
, *
d©a
)

193 ià(
commªd
 =ğ
CLICK_LLRPC_GET_RATE
) {

194 
ušt32_t
 *
v®
 = 
»š‹½»t_ÿ¡
<ušt32_ˆ*>(
d©a
);

195 ià(*
v®
 != 0)

196  -
EINVAL
;

197 
_¿‹
.
	`upd©e
(0);

198 *
v®
 = 
_¿‹
.
	`¿‹
();

201 } ià(
commªd
 =ğ
CLICK_LLRPC_GET_COUNT
) {

202 
ušt32_t
 *
v®
 = 
»š‹½»t_ÿ¡
<ušt32_ˆ*>(
d©a
);

203 ià(*
v®
 != 0 && *val != 1)

204  -
EINVAL
;

205 *
v®
 = (*v® =ğ0 ? 
_couÁ
 : 
_by‹_couÁ
);

208 } ià(
commªd
 =ğ
CLICK_LLRPC_GET_COUNTS
) {

209 
şick_Î½c_couÁs_¡
 *
u£r_cs
 = (şick_Î½c_couÁs_¡ *)
d©a
;

210 
şick_Î½c_couÁs_¡
 
cs
;

211 ià(
	`CLICK_LLRPC_GET_DATA
(&
cs
, 
d©a
, (cs.
n
è+ (cs.
keys
)) < 0

212 || 
cs
.
n
 >ğ
CLICK_LLRPC_COUNTS_SIZE
)

213  -
EINVAL
;

214 
i
 = 0; i < 
cs
.
n
; i++) {

215 ià(
cs
.
keys
[
i
] == 0)

216 
cs
.
v®ues
[
i
] = 
_couÁ
;

217 ià(
cs
.
keys
[
i
] == 1)

218 
cs
.
v®ues
[
i
] = 
_by‹_couÁ
;

220  -
EINVAL
;

222  
	`CLICK_LLRPC_PUT_DATA
(&
u£r_cs
->
v®ues
, &
cs
.values, (cs.values));

225  
EËm’t
::
	`Î½c
(
commªd
, 
d©a
);

226 
	}
}

228 
CLICK_ENDDECLS


229 
EXPORT_ELEMENT
(
CouÁ”
)

	@standard/counter.hh

2 #iâdeà
CLICK_COUNTER_HH


3 
	#CLICK_COUNTER_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/ewma.hh
>

6 
	~<şick/Î½c.h
>

7 
CLICK_DECLS


8 
şass
 
	gHªdËrC®l
;

101 şas 
	cCouÁ”
 : 
public
 
EËm’t
 {…ublic:

102 #ifdeà
HAVE_INT64_TYPES


103 
ušt64_t
 
	tcouÁ”_t
;

105 
ušt32_t
 
	tcouÁ”_t
;

108 
	$CouÁ”
(è
CLICK_COLD
;

109 ~
	$CouÁ”
(è
CLICK_COLD
;

111 cÚ¡ *
	$şass_Çme
() const {  "Counter"; }

112 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

114 
couÁ”_t
 
	$couÁ
(ècÚ¡ {  
_couÁ
; 
	}
}

115 
couÁ”_t
 
	$by‹_couÁ
(ècÚ¡ {  
_by‹_couÁ
; 
	}
}

116 
»£t
();

118 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

119 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

120 
	$add_hªdËrs
(è
CLICK_COLD
;

121 
	`Î½c
(, *);

123 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

125 
´iv©e
:

127 #ifdeà
HAVE_INT64_TYPES


129 
R©eEWMAX
<
	tR©eEWMAXP¬am‘”s
<4, 10, 
	tušt64_t
, 
	tšt64_t
> > 
	t¿‹_t
;

130 
R©eEWMAX
<
	tR©eEWMAXP¬am‘”s
<4, 4, 
	tušt64_t
, 
	tšt64_t
> > 
	tby‹_¿‹_t
;

132 
R©eEWMAX
<
	tR©eEWMAXP¬am‘”s
<4, 10> > 
	t¿‹_t
;

133 
R©eEWMAX
<
	tR©eEWMAXP¬am‘”s
<4, 4> > 
	tby‹_¿‹_t
;

136 
couÁ”_t
 
_couÁ
;

137 
couÁ”_t
 
_by‹_couÁ
;

138 
¿‹_t
 
_¿‹
;

139 
by‹_¿‹_t
 
_by‹_¿‹
;

141 
couÁ”_t
 
_couÁ_Œigg”
;

142 
HªdËrC®l
 *
_couÁ_Œigg”_h
;

144 
couÁ”_t
 
_by‹_Œigg”
;

145 
HªdËrC®l
 *
_by‹_Œigg”_h
;

147 
boŞ
 
_couÁ_Œigg”ed
 : 1;

148 
boŞ
 
_by‹_Œigg”ed
 : 1;

150 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

151 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*è
CLICK_COLD
;

153 
	}
};

155 
	gCLICK_ENDDECLS


	@standard/cpuqueue.cc

1 
	~<şick/cÚfig.h
>

2 
	~"ıuqueue.hh
"

3 
	~<şick/”rÜ.hh
>

4 
	~<şick/¬gs.hh
>

6 
CLICK_DECLS


8 
	gCPUQueue
::
	$CPUQueue
()

9 : 
	`_Ï¡
(0), 
	$_drİs
(0)

11 
	`mem£t
(&
_q
, 0, (_q));

12 
	}
}

14 
	gCPUQueue
::~
	$CPUQueue
()

16 
	}
}

19 
CPUQueue
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

21 ià(
şick_max_ıu_ids
() > 256)

22  
	g”rh
->
”rÜ
("too many CPUs for CPUQueue");

23 
	gÃw_ÿ·c™y
 = 128;

24 ià(
Args
(
cÚf
, 
this
, 
”rh
)

25 .
»ad_p
("CAPACITY", 
Ãw_ÿ·c™y
)

26 .
com¶‘e
() < 0)

28 
	g_ÿ·c™y
 = 
Ãw_ÿ·c™y
;

33 
	gCPUQueue
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

35 
i
=0; i<
	`şick_max_ıu_ids
(); i++)

36 ià(!(
_q
[
i
]._q = 
Ãw
 
Pack‘
*[
_ÿ·c™y
+1]))

37  
”rh
->
	`”rÜ
("out of memory!");

38 
_drİs
 = 0;

39 
_Ï¡
 = 0;

41 
	}
}

44 
	gCPUQueue
::
	$ş—nup
(
CËªupSge
)

46 
i
=0; i<
	`şick_max_ıu_ids
(); i++) {

47 
j
 = 
_q
[
i
].
_h—d
; j !ğ_q[i].
_
; j = 
	`Ãxt_i
(j))

48 
_q
[
i
]._q[
j
]->
	`kl
();

49 
d–‘e
[] 
_q
[
i
]._q;

50 
_q
[
i
]._q = 0;

52 
	}
}

54 
šlše
 
Pack‘
 *

55 
	gCPUQueue
::
	$deq
(
n
)

57 ià(
_q
[
n
].
_h—d
 !ğ_q[n].
_
) {

58 
Pack‘
 *
p
 = 
_q
[
n
]._q[_q[n].
_h—d
];

59 
_q
[
n
].
_h—d
 = 
	`Ãxt_i
(_q[n]._head);

60  
p
;

63 
	}
}

66 
	gCPUQueue
::
	$push
(, 
Pack‘
 *
p
)

68 
n
 = 
	`şick_cu¼’t_ıu_id
();

69 
Ãxt
 = 
	`Ãxt_i
(
_q
[
n
].
_
);

70 ià(
Ãxt
 !ğ
_q
[
n
].
_h—d
) {

71 
_q
[
n
]._q[_q[n].
_
] = 
p
;

72 
_q
[
n
].
_
 = 
Ãxt
;

74 
p
->
	`kl
();

75 
_drİs
++;

77 
	}
}

79 
Pack‘
 *

80 
	gCPUQueue
::
	$puÎ
()

82 
n
 = 
_Ï¡
;

83 
Pack‘
 *
p
 = 0;

84 
i
 = 0; i < 
	`şick_max_ıu_ids
(); i++) {

85 
p
 = 
	`deq
(
n
);

86 
n
++;

87 ià(
n
 =ğ
	`şick_max_ıu_ids
())

88 
n
 = 0;

89 ià(
p
) {

90 
_Ï¡
 = 
n
;

91  
p
;

95 
	}
}

97 
SŒšg


98 
	gCPUQueue
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

100 
CPUQueue
 *
q
 = 
¡©ic_ÿ¡
<CPUQueu*>(
e
);

101 
»š‹½»t_ÿ¡
<
šŒ_t
>(
thunk
)) {

103  
	`SŒšg
(
q
->
	`ÿ·c™y
());

105  
	`SŒšg
(
q
->
	`drİs
());

109 
	}
}

112 
	gCPUQueue
::
	$add_hªdËrs
()

114 
	`add_»ad_hªdËr
("ÿ·c™y", 
»ad_hªdËr
, 0);

115 
	`add_»ad_hªdËr
("drİs", 
»ad_hªdËr
, 1);

116 
	}
}

118 
CLICK_ENDDECLS


119 
	$EXPORT_ELEMENT
(
CPUQueue
)

120 
	`ELEMENT_MT_SAFE
(
CPUQueue
)

	@standard/cpuqueue.hh

1 #iâdeà
CPUQUEUE_HH


2 
	#CPUQUEUE_HH


	)

3 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


22 şas 
	cCPUQueue
 : 
public
 
EËm’t
 {

24 
Pack‘
 **
_q
;

25 
	m_h—d
;

26 
	m_
;

27 
	m_·d
[5];

28 } 
	g_q
[
CLICK_CPU_MAX
];

30 
	g_Ï¡
;

31 
	g_ÿ·c™y
;

32 
	g_drİs
;

34 
	$Ãxt_i
(
i
ècÚ¡ {  (i!=
_ÿ·c™y
 ? i+1 : 0); 
	}
}

35 
	$´ev_i
(
i
ècÚ¡ {  (i!=0 ? i-1 : 
_ÿ·c™y
); 
	}
}

36 
Pack‘
 *
deq
();

38 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

40 
public
:

42 
	$CPUQueue
(è
CLICK_COLD
;

43 ~
	$CPUQueue
(è
CLICK_COLD
;

45 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "CPUQueue"; 
	}
}

46 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-"; 
	}
}

47 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH_TO_PULL
; 
	}
}

48 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

49 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

51 
	$drİs
(ècÚ¡ {  
_drİs
; 
	}
}

52 
	$ÿ·c™y
(ècÚ¡ {  
_ÿ·c™y
; 
	}
}

54 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

56 
push
(
pÜt
, 
Pack‘
 *);

57 
Pack‘
 *
puÎ
(
pÜt
);

59 
	$add_hªdËrs
(è
CLICK_COLD
;

60 
	}
};

62 
	gCLICK_ENDDECLS


	@standard/cpuswitch.cc

15 
	~<şick/cÚfig.h
>

16 
	~"ıusw™ch.hh
"

17 
	~<şick/”rÜ.hh
>

19 
CLICK_DECLS


21 
	gCPUSw™ch
::
	$CPUSw™ch
()

23 
	}
}

25 
CPUSw™ch
::~
	$CPUSw™ch
()

27 
	}
}

30 
CPUSw™ch
::
	$push
(, 
Pack‘
 *
p
)

32 
n
 = 
	`şick_cu¼’t_ıu_id
(è% 
	`nouuts
();

33 
	`ouut
(
n
).
	`push
(
p
);

34 
	}
}

36 
CLICK_ENDDECLS


37 
	$EXPORT_ELEMENT
(
CPUSw™ch
)

38 
	`ELEMENT_MT_SAFE
(
CPUSw™ch
)

	@standard/cpuswitch.hh

1 #iâdeà
CPUSWITCH_HH


2 
	#CPUSWITCH_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


18 şas 
	cCPUSw™ch
 : 
public
 
EËm’t
 {

20 
public
:

22 
	$CPUSw™ch
(è
CLICK_COLD
;

23 ~
	$CPUSw™ch
(è
CLICK_COLD
;

25 cÚ¡ *
	$şass_Çme
() const {  "CPUSwitch"; }

26 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-"; 
	}
}

27 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

29 
push
(
pÜt
, 
Pack‘
 *);

33 
	gCLICK_ENDDECLS


	@standard/delayshaper.cc

20 
	~<şick/cÚfig.h
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/glue.hh
>

24 
	~"d–aysh­”.hh
"

25 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

26 
CLICK_DECLS


28 
	gD–aySh­”
::
	$D–aySh­”
()

29 : 
	`_p
(0), 
	`_tim”
(
this
), 
	$_nÙif›r
(
NÙif›r
::
SEARCH_CONTINUE_WAKE
)

31 
	}
}

34 
D–aySh­”
::
	$ÿ¡
(cÚ¡ *
n
)

36 ià(
	`¡rcmp
(
n
, "DelayShaper") == 0)

37  (
D–aySh­”
 *)
this
;

38 ià(
	`¡rcmp
(
n
, 
NÙif›r
::
EMPTY_NOTIFIER
) == 0)

39  &
_nÙif›r
;

41  
EËm’t
::
	`ÿ¡
(
n
);

42 
	}
}

45 
	gD–aySh­”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

47 
	g_nÙif›r
.
š™Ÿlize
(
NÙif›r
::
EMPTY_NOTIFIER
, 
rou‹r
());

48  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("DELAY", 
_d–ay
).
com¶‘e
();

52 
	gD–aySh­”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

54 
_tim”
.
	`š™Ÿlize
(
this
);

55 
_up¡»am_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_nÙif›r
);

57 
	}
}

60 
	gD–aySh­”
::
	$ş—nup
(
CËªupSge
)

62 ià(
_p
)

63 
_p
->
	`kl
();

64 
	}
}

66 
Pack‘
 *

67 
	gD–aySh­”
::
	$puÎ
()

70 ià(!
_p
 && (_°ğ
	`šput
(0).
	`puÎ
())) {

71 ià(!
_p
->
	`time¡amp_ªno
().
	`£c
())

72 
_p
->
	`time¡amp_ªno
().
	`assign_now
();

73 
_p
->
	`time¡amp_ªno
(è+ğ
_d–ay
;

76 ià(
_p
) {

77 
Time¡amp
 
now
 = Time¡amp::
	`now
();

78 ià(
_p
->
	`time¡amp_ªno
(è<ğ
now
) {

80 
Pack‘
 *
p
 = 
_p
;

81 
p
->
	`time¡amp_ªno
(èğ
now
;

82 
_p
 = 0;

83  
p
;

87 
Time¡amp
 
expœy
 = 
_p
->
	`time¡amp_ªno
(è- 
Tim”
::
	`adju¡m’t
();

88 ià(
expœy
 <ğ
now
) {

91 
_nÙif›r
.
	`wake
();

94 
_tim”
.
	`scheduË_©
(
expœy
);

95 
_nÙif›r
.
	`¦“p
();

97 } ià(!
_up¡»am_sigÇl
) {

99 
_nÙif›r
.
	`¦“p
();

103 
	}
}

106 
	gD–aySh­”
::
	$run_tim”
(
Tim”
 *)

108 
_nÙif›r
.
	`wake
();

109 
	}
}

111 
SŒšg


112 
	gD–aySh­”
::
	$»ad_·¿m
(
EËm’t
 *
e
, *)

114 
D–aySh­”
 *
u
 = (D–aySh­” *)
e
;

115  
u
->
_d–ay
.
	`uÅ¬£_š‹rv®
();

116 
	}
}

119 
	gD–aySh­”
::
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

121 
D–aySh­”
 *
u
 = (D–aySh­” *)
e
;

122 ià(!
	`ı_time
(
s
, &
u
->
_d–ay
))

123  
”rh
->
	`”rÜ
("delay must be‡imestamp");

125 
	}
}

128 
	gD–aySh­”
::
	$add_hªdËrs
()

130 
	`add_»ad_hªdËr
("d–ay", 
»ad_·¿m
, 0, 
HªdËr
::
h_ÿlm
);

131 
	`add_wr™e_hªdËr
("d–ay", 
wr™e_·¿m
, 0, 
HªdËr
::
h_nÚexşusive
);

132 
	}
}

134 
CLICK_ENDDECLS


135 
	$EXPORT_ELEMENT
(
D–aySh­”
)

136 
	`ELEMENT_MT_SAFE
(
D–aySh­”
)

	@standard/delayshaper.hh

2 #iâdeà
CLICK_DELAYSHAPER_HH


3 
	#CLICK_DELAYSHAPER_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/tim”.hh
>

6 
	~<şick/nÙif›r.hh
>

7 
CLICK_DECLS


38 
şass
 
	gD–aySh­”
 : 
public
 
EËm’t
,…ubliø
	gAùiveNÙif›r
 { 
	gpublic
:

40 
D–aySh­”
(è
CLICK_COLD
;

42 cÚ¡ *
şass_Çme
() const {  "DelayShaper"; }

43 cÚ¡ *
pÜt_couÁ
(ècÚ¡ {  
	gPORTS_1_1
; }

44 cÚ¡ *
´oûssšg
(ècÚ¡ {  
	gPULL
; }

45 *
ÿ¡
(const *);

47 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

48 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

49 
ş—nup
(
CËªupSge
è
	gCLICK_COLD
;

50 
add_hªdËrs
(è
	gCLICK_COLD
;

52 
Pack‘
 *
puÎ
();

53 
run_tim”
(
Tim”
 *);

55 
	g´iv©e
:

57 
Pack‘
 *
_p
;

58 
Time¡amp
 
	g_d–ay
;

59 
Tim”
 
	g_tim”
;

60 
NÙif›rSigÇl
 
	g_up¡»am_sigÇl
;

61 
AùiveNÙif›r
 
	g_nÙif›r
;

63 
SŒšg
 
»ad_·¿m
(
EËm’t
 *, *è
	gCLICK_COLD
;

64 
wr™e_·¿m
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

68 
	gCLICK_ENDDECLS


	@standard/delayunqueue.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/glue.hh
>

23 
	~"d–ayunqueue.hh
"

24 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

25 
CLICK_DECLS


27 
	gD–ayUnqueue
::
	$D–ayUnqueue
()

28 : 
	`_p
(0), 
	`_sk
(
this
), 
	$_tim”
(&
_sk
)

30 
	}
}

33 
	gD–ayUnqueue
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

35  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("DELAY", 
_d–ay
).
com¶‘e
();

39 
	gD–ayUnqueue
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

41 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
”rh
);

42 
_tim”
.
	`š™Ÿlize
(
this
);

43 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

45 
	}
}

48 
	gD–ayUnqueue
::
	$ş—nup
(
CËªupSge
)

50 ià(
_p
)

51 
_p
->
	`kl
();

52 
	}
}

54 
boŞ


55 
	gD–ayUnqueue
::
	$run_sk
(
Task
 *)

57 
boŞ
 
wÜked
 = 
çl£
;

59 
»Œy
:

61 ià(!
_p
 && (_°ğ
	`šput
(0).
	`puÎ
())) {

62 ià(!
_p
->
	`time¡amp_ªno
().
	`£c
())

63 
_p
->
	`time¡amp_ªno
().
	`assign_now
();

64 
_p
->
	`time¡amp_ªno
(è+ğ
_d–ay
;

67 ià(
_p
) {

68 
Time¡amp
 
now
 = Time¡amp::
	`now
();

69 ià(
_p
->
	`time¡amp_ªno
(è<ğ
now
) {

71 
	`ouut
(0).
	`push
(
_p
);

72 
_p
 = 0;

73 
wÜked
 = 
Œue
;

74 
»Œy
;

77 
Time¡amp
 
expœy
 = 
_p
->
	`time¡amp_ªno
(è- 
Tim”
::
	`adju¡m’t
();

78 ià(
expœy
 <ğ
now
)

83 
_tim”
.
	`scheduË_©
(
expœy
);

84  
çl£
;

88 ià(!
_sigÇl
)

89  
çl£
;

92 
_sk
.
	`ç¡_»scheduË
();

93  
wÜked
;

94 
	}
}

97 
	gD–ayUnqueue
::
	$add_hªdËrs
()

99 
	`add_d©a_hªdËrs
("d–ay", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_d–ay
, 
Œue
);

100 
	`add_sk_hªdËrs
(&
_sk
);

101 
	}
}

103 
CLICK_ENDDECLS


104 
EXPORT_ELEMENT
(
D–ayUnqueue
)

	@standard/delayunqueue.hh

1 #iâdeà
CLICK_DELAYUNQUEUE_HH


2 
	#CLICK_DELAYUNQUEUE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/sk.hh
>

5 
	~<şick/tim”.hh
>

6 
	~<şick/nÙif›r.hh
>

7 
CLICK_DECLS


35 şas 
	cD–ayUnqueue
 : 
public
 
EËm’t
 {…ublic:

37 
	$D–ayUnqueue
(è
CLICK_COLD
;

39 cÚ¡ *
	$şass_Çme
() const {  "DelayUnqueue"; }

40 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

41 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL_TO_PUSH
; 
	}
}

43 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

44 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

45 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

46 
	$add_hªdËrs
(è
CLICK_COLD
;

48 
boŞ
 
	`run_sk
(
Task
 *);

50 
´iv©e
:

52 
Pack‘
 *
_p
;

53 
Time¡amp
 
_d–ay
;

54 
Task
 
_sk
;

55 
Tim”
 
_tim”
;

56 
NÙif›rSigÇl
 
_sigÇl
;

58 
	}
};

60 
	gCLICK_ENDDECLS


	@standard/devirtualizeinfo.cc

18 
	~<şick/cÚfig.h
>

19 
	~"devœtu®izešfo.hh
"

20 
	~<şick/glue.hh
>

21 
CLICK_DECLS


23 
	gDevœtu®izeInfo
::
	$Devœtu®izeInfo
()

25 
	}
}

28 
Devœtu®izeInfo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *)

33 
CLICK_ENDDECLS


34 
EXPORT_ELEMENT
(
Devœtu®izeInfo
)

	@standard/devirtualizeinfo.hh

1 #iâdeà
CLICK_DEVIRTUALIZEINFO_HH


2 
	#CLICK_DEVIRTUALIZEINFO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


6 şas 
	cDevœtu®izeInfo
 : 
public
 
EËm’t
 {

8 
public
:

10 
	$Devœtu®izeInfo
(è
CLICK_COLD
;

12 cÚ¡ *
	$şass_Çme
() const {  "DevirtualizeInfo"; }

13 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

15 
	}
};

17 
	gCLICK_ENDDECLS


	@standard/discard.cc

18 
	~<şick/cÚfig.h
>

19 
	~"disÿrd.hh
"

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

23 
CLICK_DECLS


25 
	gDisÿrd
::
	$Disÿrd
()

26 : 
	`_sk
(
this
), 
	`_couÁ
(0), 
	`_bur¡
(1), 
	$_aùive
(
Œue
)

28 
	}
}

31 
	gDisÿrd
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

33 ià(
Args
(
cÚf
, 
this
, 
”rh
)

34 .
»ad
("ACTIVE", 
_aùive
)

35 .
»ad
("BURST", 
_bur¡
)

36 .
com¶‘e
() < 0)

38 ià(!
	g_aùive
 && 
šput_is_push
(0))

39  
	g”rh
->
”rÜ
("ACTIVE is meaningless in…ush context");

40 ià(
	g_bur¡
 == 0)

41 
_bur¡
 = ~() 0;

46 
	gDisÿrd
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

48 ià(
	`šput_is_puÎ
(0)) {

49 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_aùive
, 
”rh
);

50 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

53 
	}
}

56 
	gDisÿrd
::
	$push
(, 
Pack‘
 *
p
)

58 
_couÁ
++;

59 
p
->
	`kl
();

60 
	}
}

62 
boŞ


63 
	gDisÿrd
::
	$run_sk
(
Task
 *)

65 
x
 = 
_bur¡
;

66 
Pack‘
 *
p
;

67 
x
 && (
p
 = 
	`šput
(0).
	`puÎ
())) {

68 
p
->
	`kl
();

69 --
x
;

71 
£Á
 = 
_bur¡
 - 
x
;

73 
_couÁ
 +ğ
£Á
;

74 ià(
_aùive
 && (
£Á
 || 
_sigÇl
))

75 
_sk
.
	`ç¡_»scheduË
();

76  
£Á
 != 0;

77 
	}
}

80 
	gDisÿrd
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *
u£r_d©a
,

81 
E¼ÜHªdËr
 *
”rh
)

83 
Disÿrd
 *
d
 = 
¡©ic_ÿ¡
<Disÿrd *>(
e
);

84 ià(!
u£r_d©a
)

85 
d
->
_couÁ
 = 0;

87 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
d
->
_aùive
))

88  
”rh
->
	`”rÜ
("syntaxƒrror");

89 ià(
d
->
_aùive
)

90 
d
->
_sk
.
	`»scheduË
();

92 
d
->
_sk
.
	`unscheduË
();

95 
	}
}

98 
	gDisÿrd
::
	$add_hªdËrs
()

100 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
OP_READ
, &
_couÁ
);

101 
	`add_wr™e_hªdËr
("»£t_couÁs", 
wr™e_hªdËr
, 
h_»£t_couÁs
, 
HªdËr
::
BUTTON
);

102 ià(
	`šput_is_puÎ
(0)) {

103 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
OP_READ
 | HªdËr::
CHECKBOX
, &
_aùive
);

104 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 
h_aùive
);

105 
	`add_sk_hªdËrs
(&
_sk
);

107 
	}
}

109 
CLICK_ENDDECLS


110 
	$EXPORT_ELEMENT
(
Disÿrd
)

111 
	`ELEMENT_MT_SAFE
(
Disÿrd
)

	@standard/discard.hh

1 #iâdeà
CLICK_DISCARD_HH


2 
	#CLICK_DISCARD_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/sk.hh
>

5 
	~<şick/nÙif›r.hh
>

6 
CLICK_DECLS


54 şas 
	cDisÿrd
 : 
public
 
EËm’t
 {…ublic:

56 
	$Disÿrd
(è
CLICK_COLD
;

58 cÚ¡ *
	$şass_Çme
() const {  "Discard"; }

59 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_0
; 
	}
}

61 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

62 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

63 
	$add_hªdËrs
(è
CLICK_COLD
;

65 
	`push
(, 
Pack‘
 *);

66 
boŞ
 
	`run_sk
(
Task
 *);

68 
´Ùeùed
:

70 
Task
 
_sk
;

71 
NÙif›rSigÇl
 
_sigÇl
;

73 #ià
HAVE_INT64_TYPES


74 
ušt64_t
 
	tcouÁ”_t
;

76 
ušt32_t
 
	tcouÁ”_t
;

78 
couÁ”_t
 
_couÁ
;

80 
_bur¡
;

81 
boŞ
 
_aùive
;

83 ’um { 
h_»£t_couÁs
 = 0, 
h_aùive
 = 1 
	}
};

84 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

86 
	}
};

88 
	gCLICK_ENDDECLS


	@standard/discardnofree.cc

18 
	~<şick/cÚfig.h
>

19 
	~"disÿrdnoä“.hh
"

20 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

21 
CLICK_DECLS


23 
	gDisÿrdNoF»e
::
	$DisÿrdNoF»e
()

24 : 
	$_sk
(
this
)

26 
	}
}

29 
DisÿrdNoF»e
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

31 ià(
	`šput_is_puÎ
(0))

32 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
”rh
);

34 
	}
}

37 
	gDisÿrdNoF»e
::
	$push
(, 
Pack‘
 *)

40 
	}
}

42 
boŞ


43 
	gDisÿrdNoF»e
::
	$run_sk
(
Task
 *)

45 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

46 
_sk
.
	`ç¡_»scheduË
();

47  
p
 != 0;

48 
	}
}

51 
	gDisÿrdNoF»e
::
	$add_hªdËrs
()

53 ià(
	`šput_is_puÎ
(0))

54 
	`add_sk_hªdËrs
(&
_sk
);

55 
	}
}

57 
CLICK_ENDDECLS


58 
	$EXPORT_ELEMENT
(
DisÿrdNoF»e
)

59 
	`ELEMENT_MT_SAFE
(
DisÿrdNoF»e
)

	@standard/discardnofree.hh

1 #iâdeà
CLICK_DISCARDNOFREE_HH


2 
	#CLICK_DISCARDNOFREE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/sk.hh
>

5 
CLICK_DECLS


17 şas 
	cDisÿrdNoF»e
 : 
public
 
EËm’t
 {…ublic:

19 
	$DisÿrdNoF»e
(è
CLICK_COLD
;

21 cÚ¡ *
	$şass_Çme
() const {  "DiscardNoFree"; }

22 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_0
; 
	}
}

24 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

25 
	$add_hªdËrs
(è
CLICK_COLD
;

27 
	`push
(, 
Pack‘
 *);

28 
boŞ
 
	`run_sk
(
Task
 *);

30 
´iv©e
:

32 
Task
 
_sk
;

34 
	}
};

36 
	gCLICK_ENDDECLS


	@standard/drivermanager.cc

21 
	~<şick/cÚfig.h
>

22 
	~"driv”mªag”.hh
"

23 
	~<şick/cÚå¬£.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/rou‹r.hh
>

26 
	~<şick/¡¿ccum.hh
>

27 
	~<şick/hªdËrÿÎ.hh
>

28 
CLICK_DECLS


30 
	gDriv”Mªag”
::
	$Driv”Mªag”
()

32 
_ty³
 = 
ty³_driv”
;

33 
	}
}

35 
CLICK_ENDDECLS


36 
	$EXPORT_ELEMENT
(
Driv”Mªag”
)

37 
	`ELEMENT_REQUIRES
(
Süt
)

	@standard/drivermanager.hh

2 #iâdeà
CLICK_DRIVERMANAGER_HH


3 
	#CLICK_DRIVERMANAGER_HH


	)

4 
	~"süt.hh
"

5 
CLICK_DECLS


46 şas 
	cDriv”Mªag”
 : 
public
 
Süt
 {…ublic:

48 
	$Driv”Mªag”
(è
CLICK_COLD
;

50 cÚ¡ *
	$şass_Çme
() const {  "DriverManager"; }

52 
	}
};

75 
	gCLICK_ENDDECLS


	@standard/dropbroadcasts.cc

1 
	~<şick/cÚfig.h
>

2 
	~"drİbrßdÿ¡s.hh
"

3 
	~<şick/glue.hh
>

4 
CLICK_DECLS


6 
	gDrİBrßdÿ¡s
::
	$DrİBrßdÿ¡s
()

8 
_drİs
 = 0;

9 
	}
}

12 
	gDrİBrßdÿ¡s
::
	$drİ_™
(
Pack‘
 *
p
)

14 ià(
_drİs
 == 0)

15 
	`şick_ch©‹r
("DropBroadcasts: dropped‡…acket");

16 
_drİs
++;

17 ià(
	`nouuts
() == 2)

18 
	`ouut
(1).
	`push
(
p
);

20 
p
->
	`kl
();

21 
	}
}

23 
Pack‘
 *

24 
	gDrİBrßdÿ¡s
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

26 ià(
p
->
	`·ck‘_ty³_ªno
(è=ğ
Pack‘
::
BROADCAST
 ||…->·ck‘_ty³_ªno(è=ğPack‘::
MULTICAST
) {

27 
	`drİ_™
(
p
);

30  
p
;

31 
	}
}

33 
SŒšg


34 
	$drİbrßdÿ¡s_»ad_drİs
(
EËm’t
 *
f
, *)

36 
DrİBrßdÿ¡s
 *
q
 = (DrİBrßdÿ¡ *)
f
;

37  
	`SŒšg
(
q
->
	`drİs
());

38 
	}
}

41 
	gDrİBrßdÿ¡s
::
	$add_hªdËrs
()

43 
	`add_»ad_hªdËr
("drİs", 
drİbrßdÿ¡s_»ad_drİs
, 0);

44 
	}
}

46 
CLICK_ENDDECLS


47 
	$EXPORT_ELEMENT
(
DrİBrßdÿ¡s
)

48 
	`ELEMENT_MT_SAFE
(
DrİBrßdÿ¡s
)

	@standard/dropbroadcasts.hh

1 #iâdeà
CLICK_DROPBROADCASTS_HH


2 
	#CLICK_DROPBROADCASTS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/©omic.hh
>

5 
CLICK_DECLS


20 şas 
	cDrİBrßdÿ¡s
 : 
public
 
EËm’t
 {

21 
public
:

23 
	$DrİBrßdÿ¡s
(è
CLICK_COLD
;

25 cÚ¡ *
	$şass_Çme
() const {  "DropBroadcasts"; }

26 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

27 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

28 
	$add_hªdËrs
(è
CLICK_COLD
;

30 
ušt32_t
 
	$drİs
(ècÚ¡ {  
_drİs
; 
	}
}

32 
drİ_™
(
Pack‘
 *);

33 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

35 
	g´iv©e
:

36 
©omic_ušt32_t
 
_drİs
;

39 
	gCLICK_ENDDECLS


	@standard/drr.cc

20 
	~<şick/cÚfig.h
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~"d¼.hh
"

24 
CLICK_DECLS


26 
	gDRRSched
::
	$DRRSched
()

27 : 
	`_quªtum
(500), 
	`_pi
(0),

28 
	`_nÙif›r
(
NÙif›r
::
SEARCH_CONTINUE_WAKE
), 
	$_Ãxt
(0)

30 
	}
}

33 
	gDRRSched
::
	$ÿ¡
(cÚ¡ *
n
)

35 ià(
	`¡rcmp
(
n
, 
NÙif›r
::
EMPTY_NOTIFIER
) == 0)

36  &
_nÙif›r
;

38  
EËm’t
::
	`ÿ¡
(
n
);

39 
	}
}

42 
	gDRRSched
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

44 
	g_nÙif›r
.
š™Ÿlize
(
NÙif›r
::
EMPTY_NOTIFIER
, 
rou‹r
());

45 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("QUANTUM", 
_quªtum
).
com¶‘e
() < 0)

47 ià(
	g_quªtum
 <= 0)

48  
”rh
->
”rÜ
("bad QUANTUM");

53 
	gDRRSched
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

55 ià(!(
_pi
 = 
Ãw
 
pÜtšfo
[
	`nšputs
()]))

56  
”rh
->
	`”rÜ
("out of memory!");

57 
i
 = 0; i < 
	`nšputs
(); i++) {

58 
_pi
[
i
].
h—d
 = 0;

59 
_pi
[
i
].
defic™
 = 0;

60 
_pi
[
i
].
sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, i, &
_nÙif›r
);

62 
_Ãxt
 = 0;

64 
	}
}

67 
	gDRRSched
::
	$ş—nup
(
CËªupSge
)

69 ià(
_pi
) {

70 
j
 = 0; j < 
	`nšputs
(); j++)

71 ià(
_pi
[
j
].
h—d
)

72 
_pi
[
j
].
h—d
->
	`kl
();

73 
d–‘e
[] 
_pi
;

75 
	}
}

77 
Pack‘
 *

78 
	gDRRSched
::
	$puÎ
()

80 
n
 = 
	`nšputs
();

81 
boŞ
 
sigÇls_Ú
 = 
çl£
;

85 
j
 = 0; j < 
n
; j++) {

86 
pÜtšfo
 &
pi
 = 
_pi
[
_Ãxt
];

87 
Pack‘
 *
p
;

88 ià((
p
 = 
pi
.
h—d
)) {

89 
pi
.
h—d
 = 0;

90 
sigÇls_Ú
 = 
Œue
;

91 } ià(
pi
.
sigÇl
) {

92 
p
 = 
	`šput
(
_Ãxt
).
	`puÎ
();

93 
sigÇls_Ú
 = 
Œue
;

95 
p
 = 0;

97 ià(
p
 == 0)

98 
pi
.
defic™
 = 0;

99 ià(
p
->
	`Ëngth
(è<ğ
pi
.
defic™
) {

100 
pi
.
defic™
 -ğ
p
->
	`Ëngth
();

101 
_nÙif›r
.
	`£t_aùive
(
Œue
);

102  
p
;

104 
pi
.
h—d
 = 
p
;

106 
_Ãxt
++;

107 ià(
_Ãxt
 >ğ
n
)

108 
_Ãxt
 = 0;

109 
_pi
[
_Ãxt
].
defic™
 +ğ
_quªtum
;

112 
_nÙif›r
.
	`£t_aùive
(
sigÇls_Ú
);

114 
	}
}

116 
CLICK_ENDDECLS


117 
EXPORT_ELEMENT
(
DRRSched
)

	@standard/drr.hh

2 #iâdeà
CLICK_DRR_HH


3 
	#CLICK_DRR_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/nÙif›r.hh
>

6 
CLICK_DECLS


41 şas 
	cDRRSched
 : 
public
 
EËm’t
 {…ublic:

43 
	$DRRSched
(è
CLICK_COLD
;

45 cÚ¡ *
	$şass_Çme
() const {  "DRRSched"; }

46 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/1"; 
	}
}

47 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

48 cÚ¡ *
	$æags
(ècÚ¡ {  "S0"; 
	}
}

49 *
ÿ¡
(const *);

51 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

52 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

53 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

55 
Pack‘
 *
	`puÎ
(
pÜt
);

57 
´iv©e
:

59 
	spÜtšfo
 {

60 
Pack‘
 *
h—d
;

61 
defic™
;

62 
NÙif›rSigÇl
 
sigÇl
;

63 
	}
};

65 
	g_quªtum
;

66 
pÜtšfo
 *
	g_pi
;

67 
NÙif›r
 
	g_nÙif›r
;

68 
	g_Ãxt
;

72 
	gCLICK_ENDDECLS


	@standard/errorelement.cc

20 
	~<şick/cÚfig.h
>

21 
	~<şick/¡ªd¬d/”rÜ–em’t.hh
>

22 
CLICK_DECLS


24 
	gE¼ÜEËm’t
::
	$E¼ÜEËm’t
()

26 
	}
}

29 
E¼ÜEËm’t
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *)

36 
	gE¼ÜEËm’t
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

40 
	}
}

42 
CLICK_ENDDECLS


43 
	$EXPORT_ELEMENT
(
E¼ÜEËm’t
)

44 
	`ELEMENT_HEADER
(<
şick
/
¡ªd¬d
/
”rÜ–em’t
.
hh
>)

	@standard/flowinfo.cc

19 
	~<şick/cÚfig.h
>

20 
	~"æowšfo.hh
"

21 
	~<şick/cÚå¬£.hh
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/”rÜ.hh
>

24 
CLICK_DECLS


26 
	gFlowInfo
::
	$FlowInfo
()

28 
	}
}

31 
FlowInfo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

33 
SŒšg
 *
	g™
 = 
cÚf
.
begš
(); iˆ!ğcÚf.
’d
(); ++it) {

34 
SŒšg
 
	gÇme
 = 
ı_shiá_¥aûvec
(*
™
);

35 
SŒšg
 
	gcode
 = 
ı_shiá_¥aûvec
(*
™
);

36 
EËm’t
 *
	ge
;

37 ià(!
	gÇme
 || !
	gcode
 || *
	g™
)

38 
	g”rh
->
”rÜ
("expected %<ELEMENT CODE%>");

39 ià((
	ge
 = 
ı_–em’t
(
Çme
, 
this
, 
”rh
)))

40 
rou‹r
()->
£t_æow_code_ov”ride
(
e
->
ešdex
(), 
code
);

45 
CLICK_ENDDECLS


46 
EXPORT_ELEMENT
(
FlowInfo
)

	@standard/flowinfo.hh

2 #iâdeà
CLICK_FLOWINFO_HH


3 
	#CLICK_FLOWINFO_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


27 şas 
	cFlowInfo
 : 
public
 
EËm’t
 {…ublic:

29 
	$FlowInfo
(è
CLICK_COLD
;

31 cÚ¡ * 
	$şass_Çme
() const {  "FlowInfo"; }

33 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_INFO
; 
	}
}

34 
cÚfigu»
(
VeùÜ
<
SŒšg
>&, 
E¼ÜHªdËr
*è
	gCLICK_COLD
;

38 
	gCLICK_ENDDECLS


	@standard/frontdropqueue.cc

19 
	~<şick/cÚfig.h
>

20 
	~"äÚtdrİqueue.hh
"

21 
	~<şick/cÚå¬£.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gFrÚtDrİQueue
::
	$FrÚtDrİQueue
()

27 
	}
}

30 
FrÚtDrİQueue
::
	$ÿ¡
(cÚ¡ *
n
)

32 ià(
	`¡rcmp
(
n
, "FrontDropQueue") == 0)

33  (
FrÚtDrİQueue
 *)
this
;

35  
NÙif›rQueue
::
	`ÿ¡
(
n
);

36 
	}
}

39 
	gFrÚtDrİQueue
::
live_»cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

42 
	gStÜage
::
šdex_ty³
 
Şd_ÿ·c™y
 = 
_ÿ·c™y
;

43 ià(
cÚfigu»
(
cÚf
, 
”rh
) < 0)

45 ià(
	g_ÿ·c™y
 =ğ
Şd_ÿ·c™y
 || !
_q
)

47 
	gStÜage
::
šdex_ty³
 
Ãw_ÿ·c™y
 = 
_ÿ·c™y
;

48 
	g_ÿ·c™y
 = 
Şd_ÿ·c™y
;

50 
Pack‘
 **
	gÃw_q
 = (Pack‘ **è
CLICK_LALLOC
((Pack‘ *è* (
Ãw_ÿ·c™y
 + 1));

51 ià(
	gÃw_q
 == 0)

52  
”rh
->
”rÜ
("out of memory");

54 
	gStÜage
::
šdex_ty³
 
i
 = 

(), 
	gj
 = 
Ãw_ÿ·c™y
;

55 
	gj
 !ğ0 && 
i
 !ğ
h—d
()) {

56 
i
 = 
´ev_i
(i);

57 --
	gj
;

58 
	gÃw_q
[
j
] = 
_q
[
i
];

60 
	gi
 !ğ
h—d
()) {

61 
i
 = 
´ev_i
(i);

62 
	g_q
[
i
]->
kl
();

65 
CLICK_LFREE
(
_q
, (
Pack‘
 *è* (
_ÿ·c™y
 + 1));

66 
	g_q
 = 
Ãw_q
;

67 
£t_h—d
(
j
);

68 
£t_
(
Ãw_ÿ·c™y
);

69 
	g_ÿ·c™y
 = 
Ãw_ÿ·c™y
;

74 
	gFrÚtDrİQueue
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *
”rh
)

76 
Sim¶eQueue
 *
q
 = (Sim¶eQueu*)
e
->
	`ÿ¡
("SimpleQueue");

77 ià(!
q
)

80 ià(
	`
(è!ğ
	`h—d
() || head() != 0) {

81 
”rh
->
	`”rÜ
("already have…acketsƒnqueued, can%,take state");

85 
	`£t_
(
_ÿ·c™y
);

86 
StÜage
::
šdex_ty³
 
i
 = 
_ÿ·c™y
, 
j
 = 
q
->
	`
();

87 
i
 > 0 && 
j
 !ğ
q
->
	`h—d
()) {

88 
i
--;

89 
j
 = 
q
->
	`´ev_i
(j);

90 
_q
[
i
] = 
q
->
	`·ck‘
(
j
);

92 
	`£t_h—d
(
i
);

93 
_highw©”_Ëngth
 = 
	`size
();

95 ià(
j
 !ğ
q
->
	`h—d
())

96 
”rh
->
	`w¬nšg
("some…ackets†ost (old†ength %d,‚ew capacity %d)",

97 
q
->
	`size
(), 
_ÿ·c™y
);

98 
j
 !ğ
q
->
	`h—d
()) {

99 
j
 = 
q
->
	`´ev_i
(j);

100 
q
->
	`·ck‘
(
j
)->
	`kl
();

102 
q
->
	`£t_h—d
(0);

103 
q
->
	`£t_
(0);

104 
	}
}

107 
	gFrÚtDrİQueue
::
	$push
(, 
Pack‘
 *
p
)

109 
	`as£¹
(
p
);

112 
StÜage
::
šdex_ty³
 
t
 = 
	`
(), 
Á
 = 
	`Ãxt_i
(t);

115 ià(
Á
 =ğ
	`h—d
()) {

116 ià(
_drİs
 =ğ0 && 
_ÿ·c™y
 > 0)

117 
	`şick_ch©‹r
("%p{–em’t}: ov”æow", 
this
);

118 
	`checked_ouut_push
(1, 
_q
[
Á
]);

119 
_drİs
++;

120 
	`£t_h—d
(
	`Ãxt_i
(
Á
));

123 
_q
[
t
] = 
p
;

124 
	`£t_
(
Á
);

126 
s
 = 
	`size
();

127 ià(
s
 > 
_highw©”_Ëngth
)

128 
_highw©”_Ëngth
 = 
s
;

129 ià(
s
 =ğ1 && !
_em±y_nÙe
.
	`aùive
())

130 
_em±y_nÙe
.
	`wake
();

131 
	}
}

133 
CLICK_ENDDECLS


134 
	$ELEMENT_REQUIRES
(
NÙif›rQueue
)

135 
	`EXPORT_ELEMENT
(
FrÚtDrİQueue
)

	@standard/frontdropqueue.hh

1 #iâdeà
CLICK_FRONTDROPQUEUE_HH


2 
	#CLICK_FRONTDROPQUEUE_HH


	)

3 
	~"nÙif›rqueue.hh
"

4 
CLICK_DECLS


50 şas 
	cFrÚtDrİQueue
 : 
public
 
NÙif›rQueue
 {…ublic:

52 
	$FrÚtDrİQueue
(è
CLICK_COLD
;

54 cÚ¡ *
	$şass_Çme
() const {  "FrontDropQueue"; }

55 *
	`ÿ¡
(const *);

57 
	`live_»cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *);

58 
	`ke_¡©e
(
EËm’t
 *, 
E¼ÜHªdËr
 *);

60 
	`push
(
pÜt
, 
Pack‘
 *);

62 
	}
};

64 
	gCLICK_ENDDECLS


	@standard/fullnotequeue.cc

19 
	~<şick/cÚfig.h
>

20 
	~"fuÎnÙequeue.hh
"

21 
CLICK_DECLS


23 
	gFuÎNÙeQueue
::
	$FuÎNÙeQueue
()

25 
	}
}

28 
FuÎNÙeQueue
::
	$ÿ¡
(cÚ¡ *
n
)

30 ià(
	`¡rcmp
(
n
, "FullNoteQueue") == 0)

31  (
FuÎNÙeQueue
 *)
this
;

32 ià(
	`¡rcmp
(
n
, 
NÙif›r
::
FULL_NOTIFIER
) == 0)

33  
¡©ic_ÿ¡
<
NÙif›r
*>(&
_fuÎ_nÙe
);

35  
NÙif›rQueue
::
	`ÿ¡
(
n
);

36 
	}
}

39 
	gFuÎNÙeQueue
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41 
	g_fuÎ_nÙe
.
š™Ÿlize
(
NÙif›r
::
FULL_NOTIFIER
, 
rou‹r
());

42 
	g_fuÎ_nÙe
.
£t_aùive
(
Œue
, 
çl£
);

43  
	gNÙif›rQueue
::
cÚfigu»
(
cÚf
, 
”rh
);

47 
	gFuÎNÙeQueue
::
live_»cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

49 
	gr
 = 
NÙif›rQueue
::
live_»cÚfigu»
(
cÚf
, 
”rh
);

50 ià(
	gr
 >ğ0 && 
size
(è< 
ÿ·c™y
(è&& 
_q
)

51 
_fuÎ_nÙe
.
wake
();

52  
	gr
;

56 
	gFuÎNÙeQueue
::
	$push
(, 
Pack‘
 *
p
)

59 
StÜage
::
šdex_ty³
 
h
 = 
	`h—d
(), 
t
 = 
	`
(), 
Á
 = 
	`Ãxt_i
(t);

61 ià(
Á
 !ğ
h
)

62 
	`push_sucûss
(
h
, 
t
, 
Á
, 
p
);

64 
	`push_çu»
(
p
);

65 
	}
}

67 
Pack‘
 *

68 
	gFuÎNÙeQueue
::
	$puÎ
()

71 
StÜage
::
šdex_ty³
 
h
 = 
	`h—d
(), 
t
 = 
	`
(), 
nh
 = 
	`Ãxt_i
(h);

73 ià(
h
 !ğ
t
)

74  
	`puÎ_sucûss
(
h
, 
nh
);

76  
	`puÎ_çu»
();

77 
	}
}

79 #ià
CLICK_DEBUG_SCHEDULING


80 
SŒšg


81 
	gFuÎNÙeQueue
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *)

83 
FuÎNÙeQueue
 *
fq
 = 
¡©ic_ÿ¡
<FuÎNÙeQueu*>(
e
);

84  "nÚem±y " + 
fq
->
_em±y_nÙe
.
	`uÅ¬£
(fq->
	`rou‹r
())

85 + "\ÂÚfuÎ " + 
fq
->
_fuÎ_nÙe
.
	`uÅ¬£
(fq->
	`rou‹r
());

86 
	}
}

89 
	gFuÎNÙeQueue
::
	$add_hªdËrs
()

91 
NÙif›rQueue
::
	`add_hªdËrs
();

92 
	`add_»ad_hªdËr
("nÙif›r_¡©e", 
»ad_hªdËr
, 0);

93 
	}
}

96 
CLICK_ENDDECLS


97 
	$ELEMENT_REQUIRES
(
NÙif›rQueue
)

98 
	`EXPORT_ELEMENT
(
FuÎNÙeQueue
 FullNoteQueue-FullNoteQueue)

	@standard/fullnotequeue.hh

2 #iâdeà
CLICK_FULLNOTEQUEUE_HH


3 
	#CLICK_FULLNOTEQUEUE_HH


	)

4 
	~"nÙif›rqueue.hh
"

5 
CLICK_DECLS


68 şas 
	cFuÎNÙeQueue
 : 
public
 
NÙif›rQueue
 {…ublic:

70 
	$FuÎNÙeQueue
(è
CLICK_COLD
;

72 cÚ¡ *
	$şass_Çme
() const {  "Queue"; }

73 *
	`ÿ¡
(const *);

75 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

76 
	`live_»cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
);

77 #ià
CLICK_DEBUG_SCHEDULING


78 
	$add_hªdËrs
(è
CLICK_COLD
;

81 
	`push
(
pÜt
, 
Pack‘
 *
p
);

82 
Pack‘
 *
	`puÎ
(
pÜt
);

84 
´Ùeùed
:

86 
AùiveNÙif›r
 
_fuÎ_nÙe
;

88 
šlše
 
	`push_sucûss
(
StÜage
::
šdex_ty³
 
h
, StÜage::šdex_ty³ 
t
,

89 
StÜage
::
šdex_ty³
 
Á
, 
Pack‘
 *
p
);

90 
šlše
 
	`push_çu»
(
Pack‘
 *
p
);

91 
šlše
 
Pack‘
 *
	`puÎ_sucûss
(
StÜage
::
šdex_ty³
 
h
,

92 
StÜage
::
šdex_ty³
 
nh
);

93 
šlše
 
Pack‘
 *
	`puÎ_çu»
();

95 #ià
CLICK_DEBUG_SCHEDULING


96 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
è
CLICK_COLD
;

99 
	}
};

101 
šlše
 

102 
	gFuÎNÙeQueue
::
	$push_sucûss
(
StÜage
::
šdex_ty³
 
h
, StÜage::šdex_ty³ 
t
,

103 
StÜage
::
šdex_ty³
 
Á
, 
Pack‘
 *
p
)

105 
_q
[
t
] = 
p
;

106 
	`£t_
(
Á
);

108 
s
 = 
	`size
(
h
, 
Á
);

109 ià(
s
 > 
_highw©”_Ëngth
)

110 
_highw©”_Ëngth
 = 
s
;

112 
_em±y_nÙe
.
	`wake
();

114 ià(
s
 =ğ
	`ÿ·c™y
()) {

115 
_fuÎ_nÙe
.
	`¦“p
();

116 #ià
HAVE_MULTITHREAD


120 ià(
	`size
(è< 
	`ÿ·c™y
())

121 
_fuÎ_nÙe
.
	`wake
();

124 
	}
}

126 
šlše
 

127 
	gFuÎNÙeQueue
::
	$push_çu»
(
Pack‘
 *
p
)

129 ià(
_drİs
 =ğ0 && 
_ÿ·c™y
 > 0)

130 
	`şick_ch©‹r
("%p{–em’t}: ov”æow", 
this
);

131 
_drİs
++;

132 
	`checked_ouut_push
(1, 
p
);

133 
	}
}

135 
šlše
 
Pack‘
 *

136 
	gFuÎNÙeQueue
::
	$puÎ_sucûss
(
StÜage
::
šdex_ty³
 
h
,

137 
StÜage
::
šdex_ty³
 
nh
)

139 
Pack‘
 *
p
 = 
_q
[
h
];

140 
	`£t_h—d
(
nh
);

142 
_¦“pšess
 = 0;

143 
_fuÎ_nÙe
.
	`wake
();

144  
p
;

145 
	}
}

147 
šlše
 
Pack‘
 *

148 
	gFuÎNÙeQueue
::
	$puÎ_çu»
()

150 ià(
_¦“pšess
 >ğ
SLEEPINESS_TRIGGER
) {

151 
_em±y_nÙe
.
	`¦“p
();

152 #ià
HAVE_MULTITHREAD


156 ià(
	`size
())

157 
_em±y_nÙe
.
	`wake
();

160 ++
_¦“pšess
;

162 
	}
}

164 
	gCLICK_ENDDECLS


	@standard/hashswitch.cc

19 
	~<şick/cÚfig.h
>

20 
	~"hashsw™ch.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/¬gs.hh
>

23 
CLICK_DECLS


25 
	gHashSw™ch
::
	$HashSw™ch
()

26 : 
	`_off£t
(-1)

28 
	}
}

31 
HashSw™ch
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

33 ià(
Args
(
cÚf
, 
this
, 
”rh
)

34 .
»ad_mp
("OFFSET", 
_off£t
)

35 .
»ad_mp
("LENGTH", 
_Ëngth
).
com¶‘e
() < 0)

37 ià(
	g_Ëngth
 == 0)

38  
”rh
->
”rÜ
("length must be > 0");

43 
	gHashSw™ch
::
	$push
(, 
Pack‘
 *
p
)

45 cÚ¡ *
d©a
 = 
p
->
	`d©a
();

46 
o
 = 
_off£t
, 
l
 = 
_Ëngth
;

47 ià(()
p
->
	`Ëngth
(è< 
o
 + 
l
)

48 
	`ouut
(0).
	`push
(
p
);

50 
d
 = 0;

51 
i
 = 
o
; i < o + 
l
; i++)

52 
d
 +ğ
d©a
[
i
];

53 
n
 = 
	`nouuts
();

54 ià(
n
 == 2 ||‚ == 4 ||‚ == 8)

55 
	`ouut
((
d
 ^ (d>>4)è& (
n
-1)).
	`push
(
p
);

57 
	`ouut
(
d
 % 
n
).
	`push
(
p
);

59 
	}
}

61 
CLICK_ENDDECLS


62 
	$EXPORT_ELEMENT
(
HashSw™ch
)

63 
	`ELEMENT_MT_SAFE
(
HashSw™ch
)

	@standard/hashswitch.hh

1 #iâdeà
CLICK_HASHSWITCH_HH


2 
	#CLICK_HASHSWITCH_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


25 şas 
	cHashSw™ch
 : 
public
 
EËm’t
 {

27 
_off£t
;

28 
	m_Ëngth
;

30 
	mpublic
:

32 
	$HashSw™ch
(è
CLICK_COLD
;

34 cÚ¡ *
	$şass_Çme
() const {  "HashSwitch"; }

35 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-"; 
	}
}

36 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

38 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

40 
push
(
pÜt
, 
Pack‘
 *);

44 
	gCLICK_ENDDECLS


	@standard/hub.cc

18 
	~<şick/cÚfig.h
>

19 
	~"hub.hh
"

20 
CLICK_DECLS


22 
	gHub
::
	$Hub
()

24 
	}
}

27 
Hub
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

29 
n
 = 0, 
nout
 = 
	`nouuts
();

30 
i
 = 0; i < 
nout
; ++i) {

31 
Pack‘
 *
q
;

32 ià(
i
 =ğ
pÜt
)

33 
q
 = 0;

34 ià(++
n
 =ğ
nout
 - 1)

35 
q
 = 
p
;

37 
q
 = 
p
->
	`şÚe
();

38 ià(
q
)

39 
	`ouut
(
i
).
	`push
(
q
);

41 ià(
n
 == 0)

42 
p
->
	`kl
();

43 
	}
}

45 
CLICK_ENDDECLS


46 
EXPORT_ELEMENT
(
Hub
)

	@standard/hub.hh

1 #iâdeà
CLICK_HUB_HH


2 
	#CLICK_HUB_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


26 şas 
	cHub
 : 
public
 
EËm’t
 {…ublic:

28 
	$Hub
(è
CLICK_COLD
;

30 cÚ¡ *
	$şass_Çme
() const {  "Hub"; }

31 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/="; 
	}
}

32 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

33 cÚ¡ *
	$æow_code
(ècÚ¡ {  "#/[^#]"; 
	}
}

35 
push
(
pÜt
, 
Pack‘
* 
p
);

39 
	gCLICK_ENDDECLS


	@standard/idle.cc

18 
	~<şick/cÚfig.h
>

19 
	~"idË.hh
"

20 
CLICK_DECLS


22 
	gIdË
::
	$IdË
()

23 : 
	`_nÙif›r
(
NÙif›rSigÇl
::
	$idË_sigÇl
())

25 
	}
}

28 
IdË
::
	$ÿ¡
(cÚ¡ *
Çme
)

30 ià(
	`¡rcmp
(
Çme
, 
NÙif›r
::
EMPTY_NOTIFIER
) == 0)

31  &
_nÙif›r
;

33  
EËm’t
::
	`ÿ¡
(
Çme
);

34 
	}
}

37 
	gIdË
::
	$push
(, 
Pack‘
 *
p
)

39 
p
->
	`kl
();

40 
	}
}

42 
Pack‘
 *

43 
	gIdË
::
	$puÎ
()

46 
	}
}

48 
CLICK_ENDDECLS


49 
	$EXPORT_ELEMENT
(
IdË
)

50 
	`ELEMENT_MT_SAFE
(
IdË
)

	@standard/idle.hh

1 #iâdeà
CLICK_IDLE_HH


2 
	#CLICK_IDLE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/nÙif›r.hh
>

5 
CLICK_DECLS


29 şas 
	cIdË
 : 
public
 
EËm’t
 {…ublic:

31 
	$IdË
(è
CLICK_COLD
;

33 cÚ¡ *
	$şass_Çme
() const {  "Idle"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/-"; 
	}
}

35 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "a/a"; 
	}
}

36 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

37 *
ÿ¡
(const *);

38 cÚ¡ *
	$æags
(ècÚ¡ {  "S0"; 
	}
}

40 
push
(, 
Pack‘
 *);

41 
Pack‘
 *
puÎ
();

43 
	g´iv©e
:

45 
NÙif›r
 
_nÙif›r
;

49 
	gCLICK_ENDDECLS


	@standard/infinitesource.cc

21 
	~<şick/cÚfig.h
>

22 
	~"šfš™esourû.hh
"

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/rou‹r.hh
>

26 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

27 
	~<şick/glue.hh
>

28 
	~<şick/¡¿ccum.hh
>

29 
	~<şick/hªdËrÿÎ.hh
>

30 
CLICK_DECLS


32 
	gInfš™eSourû
::
	$Infš™eSourû
()

33 : 
	`_·ck‘
(0), 
	`_sk
(
this
), 
	$_’d_h
(0)

35 
	}
}

38 
	gInfš™eSourû
::
	$ÿ¡
(cÚ¡ *
n
)

40 ià(
	`¡rcmp
(
n
, 
	`şass_Çme
()) == 0)

41  
¡©ic_ÿ¡
<
EËm’t
 *>(
this
);

42 ià(
	`¡rcmp
(
n
, 
NÙif›r
::
EMPTY_NOTIFIER
) == 0)

43  
¡©ic_ÿ¡
<
NÙif›r
 *>(
this
);

46 
	}
}

49 
	gInfš™eSourû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

51 
	gAùiveNÙif›r
::
š™Ÿlize
(
NÙif›r
::
EMPTY_NOTIFIER
, 
rou‹r
());

52 
SŒšg
 
	gd©a
 = "Random bullshit in‡…acket,‡t†east 64 bytes†ong. Well,‚ow it is.";

53 
couÁ”_t
 
	glim™
 = -1;

54 
	gbur¡size
 = 1;

55 
	gd©asize
 = -1;

56 
boŞ
 
	gaùive
 = 
Œue
, 
	g¡İ
 = 
çl£
, 
	gtime¡amp
 =rue;

57 
HªdËrC®l
 
	g’d_h
;

59 ià(
Args
(
cÚf
, 
this
, 
”rh
)

60 .
»ad_p
("DATA", 
d©a
)

61 .
»ad_p
("LIMIT", 
lim™
)

62 .
»ad_p
("BURST", 
bur¡size
)

63 .
»ad_p
("ACTIVE", 
aùive
)

64 .
»ad
("TIMESTAMP", 
time¡amp
)

65 .
»ad
("LENGTH", 
d©asize
)

66 .
»ad
("DATASIZE", 
d©asize
)

67 .
»ad
("STOP", 
¡İ
)

68 .
»ad
("END_CALL", 
HªdËrC®lArg
(
HªdËrC®l
::
wr™abË
), 
’d_h
)

69 .
com¶‘e
() < 0)

71 ià(
	gbur¡size
 < 1)

72  
	g”rh
->
”rÜ
("burst size must be >= 1");

73 ià(
	g¡İ
 && 
	g’d_h
)

74  
	g”rh
->
”rÜ
("END_CALL‡nd STOP‡re mutuallyƒxclusive");

76 
	g_d©a
 = 
d©a
;

77 
	g_d©asize
 = 
d©asize
;

78 
	g_lim™
 = 
lim™
;

79 
	g_bur¡size
 = 
bur¡size
;

80 
	g_couÁ
 = 0;

81 
	g_aùive
 = 
aùive
;

82 
	g_time¡amp
 = 
time¡amp
;

83 
d–‘e
 
	g_’d_h
;

84 ià(
	g’d_h
)

85 
	g_’d_h
 = 
Ãw
 
HªdËrC®l
(
’d_h
);

86 ià(
	g¡İ
)

87 
	g_’d_h
 = 
Ãw
 
HªdËrC®l
("stop");

89 
	g_’d_h
 = 0;

91 
£tup_·ck‘
();

97 
	gInfš™eSourû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

99 ià(
	`ouut_is_push
(0)) {

100 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
”rh
);

101 
_nÚfuÎ_sigÇl
 = 
NÙif›r
::
	`down¡»am_fuÎ_sigÇl
(
this
, 0, &
_sk
);

103 ià(
_’d_h
 && _’d_h->
	`š™Ÿlize_wr™e
(
this
, 
”rh
) < 0)

106 
	}
}

109 
	gInfš™eSourû
::
	$ş—nup
(
CËªupSge
)

111 ià(
_·ck‘
)

112 
_·ck‘
->
	`kl
();

113 
d–‘e
 
_’d_h
;

114 
	}
}

116 
boŞ


117 
	gInfš™eSourû
::
	$run_sk
(
Task
 *)

119 ià(!
_aùive
 || !
_nÚfuÎ_sigÇl
)

120  
çl£
;

121 
n
 = 
_bur¡size
;

122 ià(
_lim™
 >ğ0 && 
_couÁ
 + 
n
 >ğ(
ucouÁ”_t
) _limit)

123 
n
 = (
_couÁ
 > (
ucouÁ”_t
è
_lim™
 ? 0 : _limit - _count);

124 
i
 = 0; i < 
n
; i++) {

125 
Pack‘
 *
p
 = 
_·ck‘
->
	`şÚe
();

126 ià(
_time¡amp
)

127 
p
->
	`time¡amp_ªno
().
	`assign_now
();

128 
	`ouut
(0).
	`push
(
p
);

130 
_couÁ
 +ğ
n
;

131 ià(
n
 > 0)

132 
_sk
.
	`ç¡_»scheduË
();

133 ià(
_’d_h
 && 
_lim™
 >ğ0 && 
_couÁ
 >ğ(
ucouÁ”_t
) _limit)

134 (è
_’d_h
->
	`ÿÎ_wr™e
();

135  
n
 > 0;

136 
	}
}

138 
Pack‘
 *

139 
	gInfš™eSourû
::
	$puÎ
()

141 ià(!
_aùive
) {

142 
dÚe
:

143 ià(
NÙif›r
::
	`aùive
())

144 
	`¦“p
();

147 ià(
_lim™
 >ğ0 && 
_couÁ
 >ğ(
ucouÁ”_t
) _limit) {

148 ià(
_’d_h
)

149 (è
_’d_h
->
	`ÿÎ_wr™e
();

150 
dÚe
;

152 
_couÁ
++;

153 
Pack‘
 *
p
 = 
_·ck‘
->
	`şÚe
();

154 ià(
_time¡amp
)

155 
p
->
	`time¡amp_ªno
().
	`assign_now
();

156  
p
;

157 
	}
}

160 
	gInfš™eSourû
::
	$£tup_·ck‘
()

162 ià(
_·ck‘
)

163 
_·ck‘
->
	`kl
();

165 ià(
_d©asize
 < 0)

166 
_·ck‘
 = 
Pack‘
::
	`make
(
_d©a
.
	`d©a
(), _d©a.
	`Ëngth
());

167 ià(
_d©asize
 <ğ
_d©a
.
	`Ëngth
())

168 
_·ck‘
 = 
Pack‘
::
	`make
(
_d©a
.
	`d©a
(), 
_d©asize
);

171 
SŒšgAccum
 
§
;

172 
§
.
	`Ëngth
(è< 
_d©asize
)

173 
§
 << 
_d©a
;

174 
_·ck‘
 = 
Pack‘
::
	`make
(
§
.
	`d©a
(), 
_d©asize
);

176 
	}
}

179 
	gInfš™eSourû
::
	$chªge_·¿m
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *
v·¿m
,

180 
E¼ÜHªdËr
 *
”rh
)

182 
Infš™eSourû
 *
is
 = (Infš™eSourû *)
e
;

183 (
šŒ_t
)
v·¿m
) {

185 
h_d©a
:

186 
is
->
_d©a
 = 
s
;

187 
is
->
	`£tup_·ck‘
();

190 
h_lim™
: {

191 
lim™
;

192 ià(!
	`IÁArg
().
	`·r£
(
s
, 
lim™
))

193  
”rh
->
	`”rÜ
("limit…arameter must be integer");

194 
is
->
_lim™
 = 
lim™
;

198 
h_bur¡
: {

199 
bur¡size
;

200 ià(!
	`IÁArg
().
	`·r£
(
s
, 
bur¡size
) || burstsize < 1)

201  
”rh
->
	`”rÜ
("burstsize…arameter must be integer >= 1");

202 
is
->
_bur¡size
 = 
bur¡size
;

206 
h_aùive
: {

207 
boŞ
 
aùive
;

208 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
aùive
))

209  
”rh
->
	`”rÜ
("active…arameter must be boolean");

210 
is
->
_aùive
 = 
aùive
;

214 
h_»£t
: {

215 
is
->
_couÁ
 = 0;

219 
h_Ëngth
: {

220 
d©asize
;

221 ià(!
	`IÁArg
().
	`·r£
(
s
, 
d©asize
))

222  
”rh
->
	`”rÜ
("length must be integer");

223 
is
->
_d©asize
 = 
d©asize
;

224 
is
->
	`£tup_·ck‘
();

229 ià(
is
->
_aùive


230 && (
is
->
_lim™
 < 0 || is->
_couÁ
 < (
ucouÁ”_t
) is->_limit)) {

231 ià(
is
->
	`ouut_is_push
(0è&& !is->
_sk
.
	`scheduËd
())

232 
is
->
_sk
.
	`»scheduË
();

233 ià(
is
->
	`ouut_is_puÎ
(0è&& !is->
NÙif›r
::
	`aùive
())

234 
is
->
	`wake
();

237 
	}
}

240 
	gInfš™eSourû
::
	$add_hªdËrs
()

242 
	`add_d©a_hªdËrs
("d©a", 
HªdËr
::
f_»ad
 | HªdËr::
f_¿w
 | HªdËr::
f_ÿlm
, &
_d©a
);

243 
	`add_wr™e_hªdËr
("d©a", 
chªge_·¿m
, 
h_d©a
, 
HªdËr
::
f_¿w
);

244 
	`add_d©a_hªdËrs
("lim™", 
HªdËr
::
f_»ad
 | HªdËr::
f_ÿlm
, &
_lim™
);

245 
	`add_wr™e_hªdËr
("lim™", 
chªge_·¿m
, 
h_lim™
);

246 
	`add_d©a_hªdËrs
("bur¡", 
HªdËr
::
f_»ad
 | HªdËr::
f_ÿlm
, &
_bur¡size
);

247 
	`add_wr™e_hªdËr
("bur¡", 
chªge_·¿m
, 
h_bur¡
);

248 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
f_»ad
 | HªdËr::
CHECKBOX
, &
_aùive
);

249 
	`add_wr™e_hªdËr
("aùive", 
chªge_·¿m
, 
h_aùive
);

250 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
f_»ad
, &
_couÁ
);

251 
	`add_wr™e_hªdËr
("»£t", 
chªge_·¿m
, 
h_»£t
, 
HªdËr
::
f_bu‰Ú
);

252 
	`add_d©a_hªdËrs
("Ëngth", 
HªdËr
::
f_»ad
 | HªdËr::
f_ÿlm
, &
_d©asize
);

253 
	`add_wr™e_hªdËr
("Ëngth", 
chªge_·¿m
, 
h_Ëngth
);

255 
	`add_d©a_hªdËrs
("bur¡size", 
HªdËr
::
f_»ad
 | HªdËr::
f_ÿlm
 | HªdËr::
f_d•»ÿ‹d
, &
_bur¡size
);

256 
	`add_wr™e_hªdËr
("bur¡size", 
chªge_·¿m
, 
h_bur¡
);

257 
	`add_d©a_hªdËrs
("d©asize", 
HªdËr
::
f_»ad
 | HªdËr::
f_ÿlm
 | HªdËr::
f_d•»ÿ‹d
, &
_d©asize
);

258 
	`add_wr™e_hªdËr
("d©asize", 
chªge_·¿m
, 
h_Ëngth
);

260 ià(
	`ouut_is_push
(0))

261 
	`add_sk_hªdËrs
(&
_sk
, &
_nÚfuÎ_sigÇl
);

262 
	}
}

264 
CLICK_ENDDECLS


265 
EXPORT_ELEMENT
(
Infš™eSourû
)

	@standard/infinitesource.hh

1 #iâdeà
CLICK_INFINITESOURCE_HH


2 
	#CLICK_INFINITESOURCE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/sk.hh
>

5 
	~<şick/nÙif›r.hh
>

6 
CLICK_DECLS


7 
şass
 
	gHªdËrC®l
;

102 
şass
 
	gInfš™eSourû
 : 
public
 
EËm’t
,…ubliø
	gAùiveNÙif›r
 { 
	gpublic
:

104 
Infš™eSourû
(è
CLICK_COLD
;

106 cÚ¡ *
şass_Çme
() const {  "InfiniteSource"; }

107 *
ÿ¡
(const *);

108 cÚ¡ *
pÜt_couÁ
(ècÚ¡ {  
	gPORTS_0_1
; }

109 cÚ¡ *
æags
() const {  "S1"; }

110 
add_hªdËrs
(è
	gCLICK_COLD
;

112 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

113 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

114 
boŞ
 
ÿn_live_»cÚfigu»
(ècÚ¡ {  
	gŒue
; }

115 
ş—nup
(
CËªupSge
è
	gCLICK_COLD
;

117 
boŞ
 
run_sk
(
Task
 *);

118 
Pack‘
 *
puÎ
();

120 
	g´Ùeùed
:

122 #ià
HAVE_INT64_TYPES


123 
ušt64_t
 
	tucouÁ”_t
;

124 
št64_t
 
	tcouÁ”_t
;

126 
ušt32_t
 
	tucouÁ”_t
;

127 
št32_t
 
	tcouÁ”_t
;

130 
£tup_·ck‘
();

132 
Pack‘
 *
	g_·ck‘
;

133 
	g_bur¡size
;

134 
couÁ”_t
 
	g_lim™
;

135 
ucouÁ”_t
 
	g_couÁ
;

136 
	g_d©asize
;

137 
boŞ
 
	g_aùive
;

138 
boŞ
 
	g_time¡amp
;

139 
Task
 
	g_sk
;

140 
SŒšg
 
	g_d©a
;

141 
NÙif›rSigÇl
 
	g_nÚfuÎ_sigÇl
;

142 
HªdËrC®l
 *
	g_’d_h
;

145 
	gh_d©a
, 
	gh_lim™
, 
	gh_bur¡
, 
	gh_aùive
, 
	gh_»£t
, 
	gh_couÁ
, 
	gh_Ëngth
,

146 
	gh_nÙif›r


148 
chªge_·¿m
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

152 
	gCLICK_ENDDECLS


	@standard/inputswitch.cc

1 
	~<şick/cÚfig.h
>

2 
	~"šputsw™ch.hh
"

3 
	~<şick/¬gs.hh
>

4 
	~<şick/”rÜ.hh
>

5 
CLICK_DECLS


7 
	gIÅutSw™ch
::
	$IÅutSw™ch
()

9 
	}
}

12 
IÅutSw™ch
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

14 
	gšput
 = 0;

15 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("OUTPUT", 
šput
).
com¶‘e
() < 0)

17 ià(
	gšput
 >ğ
nšputs
())

18  
”rh
->
”rÜ
("špuˆmu¡ b< %d", 
nšputs
());

19 
	g_šput
 = 
šput
;

24 
	gIÅutSw™ch
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

26 ià(
pÜt
 =ğ
_šput
)

27 
	`ouut
(0).
	`push
(
p
);

29 
p
->
	`kl
();

30 
	}
}

32 
SŒšg


33 
	gIÅutSw™ch
::
	$»ad_·¿m
(
EËm’t
 *
e
, *)

35 
IÅutSw™ch
 *
sw
 = (IÅutSw™ch *)
e
;

36  
	`SŒšg
(
sw
->
_šput
);

37 
	}
}

40 
	gIÅutSw™ch
::
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

42 
IÅutSw™ch
 *
sw
 = (IÅutSw™ch *)
e
;

43 
sw_šput
;

44 ià(!
	`IÁArg
().
	`·r£
(
s
, 
sw_šput
))

45  
”rh
->
	`”rÜ
("InputSwitch input must be integer");

46 ià(
sw_šput
 >ğ
sw
->
	`nšputs
())

47 
sw_šput
 = -1;

48 
sw
->
_šput
 = 
sw_šput
;

50 
	}
}

53 
	gIÅutSw™ch
::
	$add_hªdËrs
()

55 
	`add_»ad_hªdËr
("sw™ch", 
»ad_·¿m
, 0);

56 
	`add_wr™e_hªdËr
("sw™ch", 
wr™e_·¿m
, 0, 
HªdËr
::
h_nÚexşusive
);

57 
	`add_»ad_hªdËr
("cÚfig", 
»ad_·¿m
, 0);

58 
	`£t_hªdËr_æags
("cÚfig", 0, 
HªdËr
::
CALM
);

59 
	}
}

61 
CLICK_ENDDECLS


62 
	$EXPORT_ELEMENT
(
IÅutSw™ch
)

63 
	`ELEMENT_MT_SAFE
(
IÅutSw™ch
)

	@standard/inputswitch.hh

1 #iâdeà
CLICK_INPUTSWITCH_HH


2 
	#CLICK_INPUTSWITCH_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


28 şas 
	cIÅutSw™ch
 : 
public
 
EËm’t
 {…ublic:

30 
	$IÅutSw™ch
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "InputSwitch"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/1"; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

35 
	$add_hªdËrs
(è
CLICK_COLD
;

37 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

38 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

40 
push
(, 
Pack‘
 *);

42 
	g´iv©e
:

44 
_šput
;

46 
SŒšg
 
	$»ad_·¿m
(
EËm’t
 *, *è
CLICK_COLD
;

47 
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

48 
	}
};

50 
	gCLICK_ENDDECLS


	@standard/linkunqueue.cc

23 
	~<şick/cÚfig.h
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/¬gs.hh
>

26 
	~<şick/glue.hh
>

27 
	~"lškunqueue.hh
"

28 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

29 
	~<şick/·ck‘_ªno.hh
>

30 
CLICK_DECLS


32 
	gLškUnqueue
::
	$LškUnqueue
()

33 : 
	`_qh—d
(0), 
	`_q
(0), 
	`_sk
(
this
), 
	$_tim”
(&
_sk
)

35 
	}
}

38 
	gLškUnqueue
::
	$ÿ¡
(cÚ¡ *
n
)

40 ià(
	`¡rcmp
(
n
, "Storage") == 0)

41  (
StÜage
 *)
this
;

43  
EËm’t
::
	`ÿ¡
(
n
);

44 
	}
}

47 
	gLškUnqueue
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

49 ià(
Args
(
cÚf
, 
this
, 
”rh
)

50 .
»ad_mp
("LATENCY", 
_Ï‹ncy
)

51 .
»ad_mp
("BANDWIDTH", 
BªdwidthArg
(), 
_bªdwidth
).
com¶‘e
() < 0)

53 ià(
	g_bªdwidth
 < 100)

54  
	g”rh
->
”rÜ
("bandwidthoo small, minimum 100Bps");

55 
	g_bªdwidth
 /= 100;

60 
	gLškUnqueue
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

62 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
”rh
);

63 
_tim”
.
	`š™Ÿlize
(
this
);

64 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

65 
StÜage
::
_ÿ·c™y
 = 0x7FFFFFFF;

67 
_back_to_back
 = 
çl£
;

69 
	}
}

72 
	gLškUnqueue
::
	$ş—nup
(
CËªupSge
)

74 
_qh—d
) {

75 
Pack‘
 *
p
 = 
_qh—d
;

76 
_qh—d
 = 
p
->
	`Ãxt
();

77 
p
->
	`kl
();

79 
	}
}

82 
	gLškUnqueue
::
	$d–ay_by_bªdwidth
(
Pack‘
 *
p
, cÚ¡ 
Time¡amp
 &
tv
) const

84 
ušt32_t
 
Ëngth
 = 
p
->
	`Ëngth
(è+ 
	`EXTRA_LENGTH_ANNO
(p);

85 
ušt32_t
 
d–ay
 = (
Ëngth
 * 10000è/ 
_bªdwidth
;

86 
p
->
	`£t_time¡amp_ªno
(
tv
 + 
Time¡amp
::
	`make_u£c
(
d–ay
));

87 
	}
}

90 
	~<şick/¡¿ccum.hh
>

91 
	$´št_queue
(
Pack‘
 *
h—d
) {

92 
Time¡amp
 
fœ¡
;

93 ià(!
fœ¡
 && 
h—d
)

94 
fœ¡
 = 
h—d
->
	`time¡amp_ªno
();

95 
SŒšgAccum
 
§
;

96 
§
 << '[';

97 
h—d
) {

98 
Time¡amp
 
diff
 = 
h—d
->
	`time¡amp_ªno
(è- 
fœ¡
;

99 
§
 << ' ' << 
diff
;

100 
h—d
 = h—d->
	`Ãxt
();

102 
§
 << ' ' << ']' << ' ' << '@' << (
Time¡amp
::
	`now
(è- 
fœ¡
);

103 
	`şick_ch©‹r
("%s", 
§
.
	`c_¡r
());

104 
	}
}

107 
boŞ


108 
	gLškUnqueue
::
	$run_sk
(
Task
 *)

110 
boŞ
 
wÜked
 = 
çl£
;

111 
Time¡amp
 
now
 = Time¡amp::
	`now
();

112 
Time¡amp
 
now_d–ayed
 = 
now
 + 
_Ï‹ncy
;

115 !
_q
 || _q->
	`time¡amp_ªno
(è<ğ
now_d–ayed
) {

117 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

118 ià(!
p
) {

119 
_back_to_back
 = 
çl£
;

124 ià(
_q
) {

125 
_q
->
	`£t_Ãxt
(
p
);

126 
	`d–ay_by_bªdwidth
(
p
, (
_back_to_back
 ? 
_q
->
	`time¡amp_ªno
(è: 
now_d–ayed
));

128 
_qh—d
 = 
p
;

129 
	`d–ay_by_bªdwidth
(
p
, 
now_d–ayed
);

133 
_q
 = 
p
;

134 
p
->
	`£t_Ãxt
(0);

135 
StÜage
::
	`£t_
(StÜage::
	`
() + 1);

136 
wÜked
 = 
_back_to_back
 = 
Œue
;

140 
_qh—d
 && _qh—d->
	`time¡amp_ªno
(è<ğ
now
) {

141 
Pack‘
 *
p
 = 
_qh—d
;

142 
_qh—d
 = 
p
->
	`Ãxt
();

143 ià(!
_qh—d
)

144 
_q
 = 0;

145 
p
->
	`£t_Ãxt
(0);

147 
	`ouut
(0).
	`push
(
p
);

148 
StÜage
::
	`£t_
(StÜage::
	`
() - 1);

149 
wÜked
 = 
Œue
;

154 ià(
_qh—d
) {

155 
Time¡amp
 
expœy
 = 
_qh—d
->
	`time¡amp_ªno
();

156 ià(
_sigÇl
) {

157 
Time¡amp
 
expœy2
 = 
_q
->
	`time¡amp_ªno
(è- 
_Ï‹ncy
;

158 ià(
expœy2
 < 
expœy
)

159 
expœy
 = 
expœy2
;

162 
expœy
 -ğ
Tim”
::
	`adju¡m’t
();

163 ià(
expœy
 <ğ
now
) {

166 
_sk
.
	`ç¡_»scheduË
();

170 
_tim”
.
	`scheduË_©
(
expœy
);

172 } ià(
_sigÇl
) {

174 
_sk
.
	`ç¡_»scheduË
();

179  
wÜked
;

180 
	}
}

182 ’um { 
	mH_LATENCY
, 
	mH_BANDWIDTH
, 
	mH_SIZE
, 
	mH_RESET
 };

184 
SŒšg


185 
	gLškUnqueue
::
	$»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

187 
LškUnqueue
 *
u
 = (LškUnqueu*)
e
;

188 (
šŒ_t
è
thunk
) {

189 
H_LATENCY
:

190  
u
->
_Ï‹ncy
.
	`uÅ¬£_š‹rv®
();

191 
H_BANDWIDTH
:

192  
	`SŒšg
(
u
->
_bªdwidth
 * 100);

193 
H_SIZE
:

194  
	`SŒšg
(
u
->
StÜage
::
	`size
());

198 
	}
}

201 
	gLškUnqueue
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

203 
LškUnqueue
 *
u
 = (LškUnqueu*)
e
;

204 (
šŒ_t
è
thunk
) {

205 
H_LATENCY
: {

206 
Time¡amp
 
l
;

207 ià(!
	`ı_time
(
s
, &
l
)) {

208  
”rh
->
	`”rÜ
("latency must be‡imestamp");

210 
u
->
_Ï‹ncy
 = 
l
;

213 
H_BANDWIDTH
: {

214 
ušt32_t
 
bw
;

215 ià(!
	`ı_bªdwidth
(
s
, &
bw
)) {

216  
”rh
->
	`”rÜ
("invalid bandwidth");

217 } ià(
bw
 < 100) {

218  
”rh
->
	`”rÜ
("bandwidthoo small, minimum 100Bps");

220 
u
->
_bªdwidth
 = 
bw
 / 100;

223 
H_RESET
:

226  
”rh
->
	`”rÜ
("unknown handler");

229 
u
->
	`ş—nup
(
CLEANUP_MANUAL
);

230 
u
->
_qh—d
 = u->
_q
 = 0;

231 
u
->
StÜage
::
	`£t_
(0);

232 
u
->
_tim”
.
	`unscheduË
();

233 
u
->
_sk
.
	`»scheduË
();

235 
	}
}

238 
	gLškUnqueue
::
	$add_hªdËrs
()

240 
	`add_»ad_hªdËr
("Ï‹ncy", 
»ad_·¿m
, 
H_LATENCY
, 
HªdËr
::
CALM
);

241 
	`add_»ad_hªdËr
("bªdwidth", 
»ad_·¿m
, 
H_BANDWIDTH
, 
HªdËr
::
CALM
);

242 
	`add_»ad_hªdËr
("size", 
»ad_·¿m
, 
H_SIZE
);

243 
	`add_wr™e_hªdËr
("»£t", 
wr™e_hªdËr
, 
H_RESET
, 
HªdËr
::
BUTTON
);

244 
	`add_wr™e_hªdËr
("Ï‹ncy", 
wr™e_hªdËr
, 
H_LATENCY
);

245 
	`add_wr™e_hªdËr
("bªdwidth", 
wr™e_hªdËr
, 
H_BANDWIDTH
);

246 
	`add_sk_hªdËrs
(&
_sk
);

247 
	}
}

249 
CLICK_ENDDECLS


250 
EXPORT_ELEMENT
(
LškUnqueue
)

	@standard/linkunqueue.hh

2 #iâdeà
CLICK_LINKUNQUEUE_HH


3 
	#CLICK_LINKUNQUEUE_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şick/tim”.hh
>

7 
	~<şick/nÙif›r.hh
>

8 
	~<şick/¡ªd¬d/¡Üage.hh
>

9 
CLICK_DECLS


59 
şass
 
	gLškUnqueue
 : 
public
 
EËm’t
,…ubliø
	gStÜage
 { 
	gpublic
:

61 
LškUnqueue
(è
CLICK_COLD
;

63 cÚ¡ *
şass_Çme
() const {  "LinkUnqueue"; }

64 cÚ¡ *
pÜt_couÁ
(ècÚ¡ {  
	gPORTS_1_1
; }

65 cÚ¡ *
´oûssšg
(ècÚ¡ {  
	gPULL_TO_PUSH
; }

66 *
ÿ¡
(const *);

68 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

69 
š™Ÿlize
(
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

70 
ş—nup
(
CËªupSge
è
	gCLICK_COLD
;

71 
add_hªdËrs
(è
	gCLICK_COLD
;

73 
boŞ
 
run_sk
(
Task
 *);

75 
	g´iv©e
:

77 
Pack‘
 *
_qh—d
;

78 
Pack‘
 *
	g_q
;

79 
Time¡amp
 
	g_Ï‹ncy
;

81 
boŞ
 
	g_back_to_back
;

82 
ušt32_t
 
	g_bªdwidth
;

83 
Task
 
	g_sk
;

84 
Tim”
 
	g_tim”
;

85 
NÙif›rSigÇl
 
	g_sigÇl
;

87 
d–ay_by_bªdwidth
(
Pack‘
 *, cÚ¡ 
Time¡amp
 &) const;

88 
SŒšg
 
»ad_·¿m
(
EËm’t
 *, *è
	gCLICK_COLD
;

89 
wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

93 
	gCLICK_ENDDECLS


	@standard/markmacheader.cc

19 
	~<şick/cÚfig.h
>

20 
	~"m¬kmach—d”.hh
"

21 
	~<şick/¬gs.hh
>

22 
CLICK_DECLS


24 
	gM¬kMACH—d”
::
	$M¬kMACH—d”
()

26 
	}
}

29 
M¬kMACH—d”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

31 
ušt32_t
 
	goff£t
 = 0, 
	gËngth
 = 0;

32 ià(
Args
(
cÚf
, 
this
, 
”rh
)

33 .
»ad_p
("OFFSET", 
off£t
)

34 .
»ad_p
("LENGTH", 
Ëngth
).
com¶‘e
() < 0)

36 
	g_off£t
 = 
off£t
;

37 
	g_Ëngth
 = 
Ëngth
;

41 
Pack‘
 *

42 
	gM¬kMACH—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

44 ià(
_Ëngth
)

45 
p
->
	`£t_mac_h—d”
Õ->
	`d©a
(è+ 
_off£t
, 
_Ëngth
);

47 
p
->
	`£t_mac_h—d”
Õ->
	`d©a
(è+ 
_off£t
);

48  
p
;

49 
	}
}

51 
CLICK_ENDDECLS


52 
	$EXPORT_ELEMENT
(
M¬kMACH—d”
)

53 
	`ELEMENT_MT_SAFE
(
M¬kMACH—d”
)

	@standard/markmacheader.hh

1 #iâdeà
CLICK_MARKMACHEADER_HH


2 
	#CLICK_MARKMACHEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


21 şas 
	cM¬kMACH—d”
 : 
public
 
EËm’t
 {…ublic:

23 
	$M¬kMACH—d”
(è
CLICK_COLD
;

25 cÚ¡ *
	$şass_Çme
() const {  "MarkMACHeader"; }

26 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

27 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

28 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

30 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

32 
	g´iv©e
:

34 
_off£t
;

35 
	g_Ëngth
;

39 
	gCLICK_ENDDECLS


	@standard/messageelement.cc

19 
	~<şick/cÚfig.h
>

20 
	~"mes§g“Ëm’t.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gMes§geEËm’t
::
	$Mes§geEËm’t
()

27 
	}
}

30 
Mes§geEËm’t
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

32 
SŒšg
 
	gmes§ge
, 
	gty³
 = "MESSAGE";

33 ià(
Args
(
cÚf
, 
this
, 
”rh
)

34 .
»ad_mp
("MESSAGE", 
mes§ge
)

35 .
»ad_p
("TYPE", 
KeywÜdArg
(), 
ty³
).
com¶‘e
() < 0)

37 cÚ¡ *
	g”r
;

38 ià(
	gty³
 == "MESSAGE")

39 
”r
 = 
E¼ÜHªdËr
::
e_šfo
;

40 ià(
	gty³
 == "WARNING")

41 
”r
 = 
E¼ÜHªdËr
::
e_w¬nšg_ªnÙ©ed
;

42 ià(
	gty³
 == "ERROR")

43 
”r
 = 
E¼ÜHªdËr
::
e_”rÜ
;

45  
	g”rh
->
”rÜ
("unrecognized messageype");

46  
	g”rh
->
xmes§ge
(
”r
, 
mes§ge
);

49 
CLICK_ENDDECLS


50 
EXPORT_ELEMENT
(
Mes§geEËm’t
)

	@standard/messageelement.hh

2 #iâdeà
CLICK_MESSAGEELEMENT_HH


3 
	#CLICK_MESSAGEELEMENT_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


36 şas 
	cMes§geEËm’t
 : 
public
 
EËm’t
 {…ublic:

38 
	$Mes§geEËm’t
(è
CLICK_COLD
;

40 cÚ¡ *
	$şass_Çme
() const {  "Message"; }

41 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

43 
	}
};

45 
	gCLICK_ENDDECLS


	@standard/meter.cc

19 
	~<şick/cÚfig.h
>

20 
	~"m‘”.hh
"

21 
CLICK_DECLS


23 
	gM‘”
::
	$M‘”
()

25 
	}
}

28 
M‘”
::
	$push
(, 
Pack‘
 *
p
)

30 
_¿‹
.
	`upd©e
(1);

32 
r
 = 
_¿‹
.
	`sÿËd_av”age
();

33 ià(
_nm‘”s
 < 2) {

34 
n
 = (
r
 >ğ
_m‘”1
);

35 
	`ouut
(
n
).
	`push
(
p
);

37 *
m‘”s
 = 
_m‘”s
;

38 
nm‘”s
 = 
_nm‘”s
;

39 
i
 = 0; i < 
nm‘”s
; i++)

40 ià(
r
 < 
m‘”s
[
i
]) {

41 
	`ouut
(
i
).
	`push
(
p
);

44 
	`ouut
(
nm‘”s
).
	`push
(
p
);

46 
	}
}

48 
CLICK_ENDDECLS


49 
	$ELEMENT_REQUIRES
(
BªdwidthM‘”
)

50 
	`EXPORT_ELEMENT
(
M‘”
)

	@standard/meter.hh

1 #iâdeà
CLICK_METER_HH


2 
	#CLICK_METER_HH


	)

3 
	~"bªdwidthm‘”.hh
"

4 
CLICK_DECLS


43 şas 
	cM‘”
 : 
public
 
BªdwidthM‘”
 {…ublic:

45 
	$M‘”
(è
CLICK_COLD
;

47 cÚ¡ *
	$şass_Çme
() const {  "Meter"; }

49 
	`push
(
pÜt
, 
Pack‘
 *);

51 
	}
};

53 
	gCLICK_ENDDECLS


	@standard/mixedqueue.cc

19 
	~<şick/cÚfig.h
>

20 
	~"mixedqueue.hh
"

21 
CLICK_DECLS


23 
	gMixedQueue
::
	$MixedQueue
()

25 
	}
}

28 
MixedQueue
::
	$ÿ¡
(cÚ¡ *
n
)

30 ià(
	`¡rcmp
(
n
, "MixedQueue") == 0)

31  (
MixedQueue
 *)
this
;

33  
NÙif›rQueue
::
	`ÿ¡
(
n
);

34 
	}
}

37 
	gMixedQueue
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

39 
Pack‘
 *
Şdp
 = 0;

41 ià(
pÜt
 == 0) {

42 
h
 = 
	`h—d
(), 
t
 = 
	`
(), 
Á
 = 
	`Ãxt_i
(t);

43 ià(
Á
 =ğ
h
) {

44 ià(
_drİs
 =ğ0 && 
_ÿ·c™y
 > 0)

45 
	`şick_ch©‹r
("%p{–em’t}: ov”æow", 
this
);

46 
_drİs
++;

47 
	`checked_ouut_push
(1, 
p
);

49 
_q
[
t
] = 
p
;

50 
	`£t_
(
Á
);

53 
h
 = 
	`h—d
(), 
t
 = 
	`
(), 
ph
 = 
	`´ev_i
(h);

54 ià(
ph
 =ğ
t
) {

55 ià(
_drİs
 =ğ0 && 
_ÿ·c™y
 > 0)

56 
	`şick_ch©‹r
("%p{–em’t}: ov”æow", 
this
);

57 
_drİs
++;

58 
t
 = 
	`´ev_i
(t);

59 
Şdp
 = 
_q
[
t
];

60 
	`£t__acquœe
(
t
);

62 
_q
[
ph
] = 
p
;

63 
	`£t_h—d_»Ëa£
(
ph
);

66 
s
 = 
	`size
();

67 ià(
s
 > 
_highw©”_Ëngth
)

68 
_highw©”_Ëngth
 = 
s
;

69 ià(
s
 =ğ1 && !
_em±y_nÙe
.
	`aùive
())

70 
_em±y_nÙe
.
	`wake
();

72 ià(
Şdp
)

73 
	`checked_ouut_push
(1, 
Şdp
);

74 
	}
}

76 
CLICK_ENDDECLS


77 
	$ELEMENT_REQUIRES
(
NÙif›rQueue
)

78 
	`EXPORT_ELEMENT
(
MixedQueue
)

	@standard/mixedqueue.hh

2 #iâdeà
CLICK_MIXEDQUEUE_HH


3 
	#CLICK_MIXEDQUEUE_HH


	)

4 
	~"nÙif›rqueue.hh
"

5 
CLICK_DECLS


75 şas 
	cMixedQueue
 : 
public
 
NÙif›rQueue
 {…ublic:

77 
	$MixedQueue
(è
CLICK_COLD
;

79 cÚ¡ *
	$şass_Çme
() const {  "MixedQueue"; }

80 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/1-2"; 
	}
}

81 *
ÿ¡
(const *);

83 
push
(
pÜt
, 
Pack‘
 *);

87 
	gCLICK_ENDDECLS


	@standard/msqueue.cc

1 
	~<şick/cÚfig.h
>

2 
	~"msqueue.hh
"

3 
	~<şick/”rÜ.hh
>

4 
	gCLICK_DECLS


6 
	#PREFETCH
 1

	)

8 
	gMSQueue
::
	$MSQueue
()

10 
	}
}

13 
MSQueue
::
	$ÿ¡
(cÚ¡ *
n
)

15 ià(
	`¡rcmp
(
n
, "MSQueue") == 0)

16  (
EËm’t
 *)
this
;

18  
Th»adSaãQueue
::
	`ÿ¡
(
n
);

19 
	}
}

22 
	gMSQueue
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

24 
	gr
 = 
Th»adSaãQueue
::
cÚfigu»
(
cÚf
, 
”rh
);

25 ià(
	gr
 >= 0)

26 
”rh
->
w¬nšg
("MSQueue is deprecated, use ThreadSafeQueue instead");

27  
	gr
;

30 
CLICK_ENDDECLS


31 
	$ELEMENT_REQUIRES
(
muÉ™h»ad
)

32 
	`EXPORT_ELEMENT
(
MSQueue
)

	@standard/msqueue.hh

1 #iâdeà
CLICK_MSQUEUE_HH


2 
	#CLICK_MSQUEUE_HH


	)

3 
	~"th»ad§ãqueue.hh
"

4 
CLICK_DECLS


28 şas 
	cMSQueue
 : 
public
 
Th»adSaãQueue
 {…ublic:

30 
	$MSQueue
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "MSQueue"; }

33 *
	`ÿ¡
(const *);

35 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

37 #ià
CLICK_LINUXMODULE
 && 
__i386__
 && 
HAVE_INTEL_CPU


38 
	`´eãtch_·ck‘
(
Pack‘
 *
p
);

41 
	}
};

43 #ià
CLICK_LINUXMODULE
 && 
__i386__
 && 
HAVE_INTEL_CPU


44 
šlše
 

45 
	gMSQueue
::
	$´eãtch_·ck‘
(
Pack‘
 *
p
)

47 
sk_buff
 *
skb
 = 
p
->
	`skb
();

48 
asm
 vŞ©e("´eãtcht0 %0" : : "m" (
skb
->
d©a
));

49 
	}
}

52 
	gCLICK_ENDDECLS


	@standard/notifierqueue.cc

20 
	~<şick/cÚfig.h
>

21 
	~"nÙif›rqueue.hh
"

22 
CLICK_DECLS


24 
	gNÙif›rQueue
::
	$NÙif›rQueue
()

25 : 
	$_¦“pšess
(0)

27 
	}
}

30 
NÙif›rQueue
::
	$ÿ¡
(cÚ¡ *
n
)

32 ià(
	`¡rcmp
(
n
, "NotifierQueue") == 0)

33  (
NÙif›rQueue
 *)
this
;

34 ià(
	`¡rcmp
(
n
, 
NÙif›r
::
EMPTY_NOTIFIER
) == 0)

35  
¡©ic_ÿ¡
<
NÙif›r
 *>(&
_em±y_nÙe
);

37  
Sim¶eQueue
::
	`ÿ¡
(
n
);

38 
	}
}

41 
	gNÙif›rQueue
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

43 
	g_em±y_nÙe
.
š™Ÿlize
(
NÙif›r
::
EMPTY_NOTIFIER
, 
rou‹r
());

44  
	gSim¶eQueue
::
cÚfigu»
(
cÚf
, 
”rh
);

48 
	gNÙif›rQueue
::
	$push
(, 
Pack‘
 *
p
)

51 
h
 = 
	`h—d
(), 
t
 = 
	`
(), 
Á
 = 
	`Ãxt_i
(t);

53 ià(
Á
 !ğ
h
) {

54 
_q
[
t
] = 
p
;

55 
	`£t_
(
Á
);

57 
s
 = 
	`size
(
h
, 
Á
);

58 ià(
s
 > 
_highw©”_Ëngth
)

59 
_highw©”_Ëngth
 = 
s
;

61 
_em±y_nÙe
.
	`wake
();

64 ià(
_drİs
 =ğ0 && 
_ÿ·c™y
 > 0)

65 
	`şick_ch©‹r
("%p{–em’t}: ov”æow", 
this
);

66 
_drİs
++;

67 
	`checked_ouut_push
(1, 
p
);

69 
	}
}

71 
Pack‘
 *

72 
	gNÙif›rQueue
::
	$puÎ
()

74 
Pack‘
 *
p
 = 
	`deq
();

76 ià(
p
)

77 
_¦“pšess
 = 0;

78 ià(
_¦“pšess
 >ğ
SLEEPINESS_TRIGGER
) {

79 
_em±y_nÙe
.
	`¦“p
();

80 #ià
HAVE_MULTITHREAD


84 ià(
	`size
())

85 
_em±y_nÙe
.
	`wake
();

88 ++
_¦“pšess
;

90  
p
;

91 
	}
}

93 #ià
CLICK_DEBUG_SCHEDULING


94 
SŒšg


95 
	gNÙif›rQueue
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *)

97 
NÙif›rQueue
 *
nq
 = 
¡©ic_ÿ¡
<NÙif›rQueu*>(
e
);

98  "nÚem±y " + 
nq
->
_em±y_nÙe
.
	`uÅ¬£
Òq->
	`rou‹r
());

99 
	}
}

102 
	gNÙif›rQueue
::
	$add_hªdËrs
()

104 
	`add_»ad_hªdËr
("nÙif›r_¡©e", 
»ad_hªdËr
, 0);

105 
Sim¶eQueue
::
	`add_hªdËrs
();

106 
	}
}

109 
CLICK_ENDDECLS


110 
	$ELEMENT_REQUIRES
(
Sim¶eQueue
)

111 
	`EXPORT_ELEMENT
(
NÙif›rQueue
)

	@standard/notifierqueue.hh

2 #iâdeà
CLICK_NOTIFIERQUEUE_HH


3 
	#CLICK_NOTIFIERQUEUE_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/nÙif›r.hh
>

6 
	~"sim¶equeue.hh
"

7 
CLICK_DECLS


71 şas 
	cNÙif›rQueue
 : 
public
 
Sim¶eQueue
 {…ublic:

73 
	$NÙif›rQueue
(è
CLICK_COLD
;

75 cÚ¡ *
	$şass_Çme
() const {  "NotifierQueue"; }

76 *
	`ÿ¡
(const *);

78 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

80 
	`push
(
pÜt
, 
Pack‘
 *);

81 
Pack‘
 *
	`puÎ
(
pÜt
);

83 #ià
CLICK_DEBUG_SCHEDULING


84 
	$add_hªdËrs
(è
CLICK_COLD
;

87 
´Ùeùed
:

89 ’um { 
SLEEPINESS_TRIGGER
 = 9 
	}
};

90 
	g_¦“pšess
;

91 
AùiveNÙif›r
 
	g_em±y_nÙe
;

93 
ä›nd
 
şass
 
	gMixedQueue
;

94 
ä›nd
 
şass
 
	gInOrd”Queue
;

95 
ä›nd
 
şass
 
	gECNQueue
;

96 
ä›nd
 
şass
 
	gTok’Queue
;

97 #ià
CLICK_DEBUG_SCHEDULING


98 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

101 
	}
};

103 
	gCLICK_ENDDECLS


	@standard/nullelement.cc

18 
	~<şick/cÚfig.h
>

19 
	~"nuÎ–em’t.hh
"

20 
CLICK_DECLS


22 
	gNuÎEËm’t
::
	$NuÎEËm’t
()

24 
	}
}

26 
Pack‘
 *

27 
NuÎEËm’t
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

29  
p
;

30 
	}
}

32 
	gPushNuÎEËm’t
::
	$PushNuÎEËm’t
()

34 
	}
}

37 
PushNuÎEËm’t
::
	$push
(, 
Pack‘
 *
p
)

39 
	`ouut
(0).
	`push
(
p
);

40 
	}
}

42 
	gPuÎNuÎEËm’t
::
	$PuÎNuÎEËm’t
()

44 
	}
}

46 
Pack‘
 *

47 
PuÎNuÎEËm’t
::
	$puÎ
()

49  
	`šput
(0).
	`puÎ
();

50 
	}
}

52 
CLICK_ENDDECLS


53 
	$EXPORT_ELEMENT
(
NuÎEËm’t
)

54 
	$EXPORT_ELEMENT
(
PushNuÎEËm’t
)

55 
	$EXPORT_ELEMENT
(
PuÎNuÎEËm’t
)

56 
	$ELEMENT_MT_SAFE
(
NuÎEËm’t
)

57 
	$ELEMENT_MT_SAFE
(
PushNuÎEËm’t
)

58 
	`ELEMENT_MT_SAFE
(
PuÎNuÎEËm’t
)

	@standard/nullelement.hh

1 #iâdeà
CLICK_NULLELEMENT_HH


2 
	#CLICK_NULLELEMENT_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


45 şas 
	cNuÎEËm’t
 : 
public
 
EËm’t
 {…ublic:

47 
	$NuÎEËm’t
(è
CLICK_COLD
;

49 cÚ¡ *
	$şass_Çme
() const {  "Null"; }

50 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

52 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

70 şas 
	cPushNuÎEËm’t
 : 
public
 
EËm’t
 {…ublic:

72 
	$PushNuÎEËm’t
(è
CLICK_COLD
;

74 cÚ¡ *
	$şass_Çme
() const {  "PushNull"; }

75 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

76 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

78 
push
(, 
Pack‘
 *);

96 şas 
	cPuÎNuÎEËm’t
 : 
public
 
EËm’t
 {…ublic:

98 
	$PuÎNuÎEËm’t
(è
CLICK_COLD
;

100 cÚ¡ *
	$şass_Çme
() const {  "PullNull"; }

101 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

102 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

104 
Pack‘
 *
puÎ
();

108 
	gCLICK_ENDDECLS


	@standard/nulls.cc

18 
	~<şick/cÚfig.h
>

19 
	~"nuÎs.hh
"

21 
	$EXPORT_ELEMENT
(
NuÎ1
)

22 
	$EXPORT_ELEMENT
(
NuÎ2
)

23 
	$EXPORT_ELEMENT
(
NuÎ3
)

24 
	$EXPORT_ELEMENT
(
NuÎ4
)

25 
	$EXPORT_ELEMENT
(
NuÎ5
)

26 
	$EXPORT_ELEMENT
(
NuÎ6
)

27 
	$EXPORT_ELEMENT
(
NuÎ7
)

28 
	`EXPORT_ELEMENT
(
NuÎ8
)

	@standard/nulls.hh

1 #iâdeà
CLICK_NULLS_HH


2 
	#CLICK_NULLS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


23 şas 
	cNuÎ1
 : 
public
 
EËm’t
 {

25 
public
:

27 
	$NuÎ1
() { }

29 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "NuÎ1"; 
	}
}

30 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

32 
Pack‘
 *
	$sim¶e_aùiÚ
(
Pack‘
 *
p
è{ …; 
	}
}

36 şas 
	cNuÎ2
 : 
public
 
EËm’t
 {

38 
public
:

40 
	$NuÎ2
() { }

42 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "NuÎ2"; 
	}
}

43 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

45 
Pack‘
 *
	$sim¶e_aùiÚ
(
Pack‘
 *
p
è{ …; 
	}
}

49 şas 
	cNuÎ3
 : 
public
 
EËm’t
 {

51 
public
:

53 
	$NuÎ3
() { }

55 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "NuÎ3"; 
	}
}

56 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

58 
Pack‘
 *
	$sim¶e_aùiÚ
(
Pack‘
 *
p
è{ …; 
	}
}

62 şas 
	cNuÎ4
 : 
public
 
EËm’t
 {

64 
public
:

66 
	$NuÎ4
() { }

68 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "NuÎ4"; 
	}
}

69 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

71 
Pack‘
 *
	$sim¶e_aùiÚ
(
Pack‘
 *
p
è{ …; 
	}
}

75 şas 
	cNuÎ5
 : 
public
 
EËm’t
 {

77 
public
:

79 
	$NuÎ5
() { }

81 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "NuÎ5"; 
	}
}

82 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

84 
Pack‘
 *
	$sim¶e_aùiÚ
(
Pack‘
 *
p
è{ …; 
	}
}

88 şas 
	cNuÎ6
 : 
public
 
EËm’t
 {

90 
public
:

92 
	$NuÎ6
() { }

94 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "NuÎ6"; 
	}
}

95 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

97 
Pack‘
 *
	$sim¶e_aùiÚ
(
Pack‘
 *
p
è{ …; 
	}
}

101 şas 
	cNuÎ7
 : 
public
 
EËm’t
 {

103 
public
:

105 
	$NuÎ7
() { }

107 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "NuÎ7"; 
	}
}

108 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

110 
Pack‘
 *
	$sim¶e_aùiÚ
(
Pack‘
 *
p
è{ …; 
	}
}

114 şas 
	cNuÎ8
 : 
public
 
EËm’t
 {

116 
public
:

118 
	$NuÎ8
() { }

120 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "NuÎ8"; 
	}
}

121 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

123 
Pack‘
 *
	$sim¶e_aùiÚ
(
Pack‘
 *
p
è{ …; 
	}
}

127 
	gCLICK_ENDDECLS


	@standard/pad.cc

19 
	~<şick/cÚfig.h
>

20 
	~"·d.hh
"

21 
	~<şick/·ck‘_ªno.hh
>

22 
	~<şick/¬gs.hh
>

23 
CLICK_DECLS


25 
	gPad
::
	$Pad
()

27 
	}
}

30 
Pad
::
cÚfigu»
(
VeùÜ
<
SŒšg
>& 
cÚf
, 
E¼ÜHªdËr
* 
”rh
)

32 
	g_nby‹s
 = 0;

33 
	g_z”o
 = 
Œue
;

34  
Args
(
cÚf
, 
this
, 
”rh
)

35 .
»ad_p
("LENGTH", 
_nby‹s
)

36 .
»ad
("ZERO", 
_z”o
)

37 .
com¶‘e
();

40 
Pack‘
*

41 
	gPad
::
	$sim¶e_aùiÚ
(
Pack‘
* 
p
)

43 
ušt32_t
 
Åut
;

44 ià(
	`uÆik–y
(
_nby‹s
))

45 
Åut
 = 
p
->
	`Ëngth
(è< 
_nby‹s
 ? _nbytes -…->length() : 0;

47 
Åut
 = 
	`EXTRA_LENGTH_ANNO
(
p
);

48 ià(
Åut
) {

49 
Wr™abËPack‘
* 
q
 = 
p
->
	`put
(
Åut
);

50 ià(!
q
)

52 ià(
_z”o
)

53 
	`mem£t
(
q
->
	`’d_d©a
(è- 
Åut
, 0,‚put);

54 
p
 = 
q
;

56 
	`SET_EXTRA_LENGTH_ANNO
(
p
, 0);

57  
p
;

58 
	}
}

60 
CLICK_ENDDECLS


61 
	$EXPORT_ELEMENT
(
Pad
)

62 
	`ELEMENT_MT_SAFE
(
Pad
)

	@standard/pad.hh

2 #iâdeà
CLICK_PAD_HH


3 
	#CLICK_PAD_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


39 şas 
	cPad
 : 
public
 
EËm’t
 {…ublic:

41 
	$Pad
(è
CLICK_COLD
;

43 cÚ¡ *
	$şass_Çme
() const {  "Pad"; }

44 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

46 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

47 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

49 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

51 
	g´iv©e
:

53 
_nby‹s
;

54 
boŞ
 
	g_z”o
;

58 
	gCLICK_ENDDECLS


	@standard/paint.cc

19 
	~<şick/cÚfig.h
>

20 
	~"·št.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
CLICK_DECLS


27 
	gPašt
::
	$Pašt
()

29 
	}
}

32 
Pašt
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

34 
	gªno
 = 
PAINT_ANNO_OFFSET
;

35 ià(
Args
(
cÚf
, 
this
, 
”rh
)

36 .
»ad_mp
("COLOR", 
_cŞÜ
)

37 .
»ad_p
("ANNO", 
AÂoArg
(1), 
ªno
).
com¶‘e
() < 0)

39 
	g_ªno
 = 
ªno
;

43 
Pack‘
 *

44 
	gPašt
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

46 
p
->
	`£t_ªno_u8
(
_ªno
, 
_cŞÜ
);

47  
p
;

48 
	}
}

51 
	gPašt
::
	$add_hªdËrs
()

53 
	`add_d©a_hªdËrs
("cŞÜ", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_cŞÜ
);

54 
	}
}

56 
CLICK_ENDDECLS


57 
	$EXPORT_ELEMENT
(
Pašt
)

58 
	`ELEMENT_MT_SAFE
(
Pašt
)

	@standard/paint.hh

1 #iâdeà
CLICK_PAINT_HH


2 
	#CLICK_PAINT_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


28 şas 
	cPašt
 : 
public
 
EËm’t
 {…ublic:

30 
	$Pašt
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "Paint"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

35 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

36 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

37 
	$add_hªdËrs
(è
CLICK_COLD
;

39 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

41 
´iv©e
:

43 
ušt8_t
 
_ªno
;

44 
ušt8_t
 
_cŞÜ
;

46 
	}
};

48 
	gCLICK_ENDDECLS


	@standard/paintswitch.cc

19 
	~<şick/cÚfig.h
>

20 
	~"·štsw™ch.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
CLICK_DECLS


26 
	gPaštSw™ch
::
	$PaštSw™ch
()

28 
	}
}

31 
PaštSw™ch
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

33 
	gªno
 = 
PAINT_ANNO_OFFSET
;

34 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("ANNO", 
AÂoArg
(1), 
ªno
).
com¶‘e
() < 0)

36 
	g_ªno
 = 
ªno
;

41 
	gPaštSw™ch
::
	$push
(, 
Pack‘
 *
p
)

43 
ouut_pÜt
 = 
¡©ic_ÿ¡
<>(
p
->
	`ªno_u8
(
_ªno
));

44 ià(
ouut_pÜt
 != 0xFF)

45 
	`checked_ouut_push
(
ouut_pÜt
, 
p
);

47 
n
 = 
	`nouuts
();

48 
i
 = 0; i < 
n
 - 1; i++)

49 ià(
Pack‘
 *
q
 = 
p
->
	`şÚe
())

50 
	`ouut
(
i
).
	`push
(
q
);

51 
	`ouut
(
n
 - 1).
	`push
(
p
);

53 
	}
}

55 
CLICK_ENDDECLS


56 
	$EXPORT_ELEMENT
(
PaštSw™ch
)

57 
	`ELEMENT_MT_SAFE
(
PaštSw™ch
)

	@standard/paintswitch.hh

1 #iâdeà
CLICK_PAINTSWITCH_HH


2 
	#CLICK_PAINTSWITCH_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


31 şas 
	cPaštSw™ch
 : 
public
 
EËm’t
 {…ublic:

33 
	$PaštSw™ch
(è
CLICK_COLD
;

35 cÚ¡ *
	$şass_Çme
() const {  "PaintSwitch"; }

36 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

37 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

39 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

41 
push
(, 
Pack‘
 *);

43 
	g´iv©e
:

45 
ušt8_t
 
_ªno
;

49 
	gCLICK_ENDDECLS


	@standard/painttee.cc

19 
	~<şick/cÚfig.h
>

20 
	~"·š‰“.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
CLICK_DECLS


26 
	gPaštT“
::
	$PaštT“
()

28 
	}
}

31 
PaštT“
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

33 
	gªno
 = 
PAINT_ANNO_OFFSET
;

34 ià(
Args
(
cÚf
, 
this
, 
”rh
)

35 .
»ad_mp
("COLOR", 
_cŞÜ
)

36 .
»ad_p
("ANNO", 
AÂoArg
(1), 
ªno
).
com¶‘e
() < 0)

38 
	g_ªno
 = 
ªno
;

42 
Pack‘
 *

43 
	gPaštT“
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

45 ià(
p
->
	`ªno_u8
(
_ªno
è=ğ
_cŞÜ
)

46 
	`ouut
(1).
	`push
(
p
->
	`şÚe
());

47 (
p
);

48 
	}
}

51 
	gPaštT“
::
	$add_hªdËrs
()

53 
	`add_d©a_hªdËrs
("cŞÜ", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_cŞÜ
);

54 
	}
}

56 
CLICK_ENDDECLS


57 
	$EXPORT_ELEMENT
(
PaštT“
)

58 
	`ELEMENT_MT_SAFE
(
PaštT“
)

	@standard/painttee.hh

1 #iâdeà
CLICK_PAINTTEE_HH


2 
	#CLICK_PAINTTEE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


31 şas 
	cPaštT“
 : 
public
 
EËm’t
 {…ublic:

33 
	$PaštT“
(è
CLICK_COLD
;

35 cÚ¡ *
	$şass_Çme
() const {  "PaintTee"; }

36 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/2"; 
	}
}

37 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

39 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

40 
	$add_hªdËrs
(è
CLICK_COLD
;

42 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

44 
´iv©e
:

46 
ušt8_t
 
_ªno
;

47 
ušt8_t
 
_cŞÜ
;

49 
	}
};

51 
	gCLICK_ENDDECLS


	@standard/portinfo.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/¡ªd¬d/pÜtšfo.hh
>

21 
	~<şick/Çmešfo.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/cÚå¬£.hh
>

24 
	~<şick/rou‹r.hh
>

25 
	~<şick/”rÜ.hh
>

26 
CLICK_DECLS


29 
	gPÜtInfo
::
	$PÜtInfo
()

31 
	}
}

34 
PÜtInfo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

37 
SŒšg
 
	g¡r
 = 
cÚf
[
i
];

38 
SŒšg
 
	gÇme_¡r
 = 
ı_shiá_¥aûvec
(
¡r
);

39 ià(!
	gÇme_¡r


40 || 
	gÇme_¡r
[0] == '#')

43 
SŒšg
 
	gpÜt_¡r
 = 
ı_shiá_¥aûvec
(
¡r
);

44 
ušt32_t
 
	gpÜt
;

45 
št32_t
 
	g´Ùo
 = 
IP_PROTO_TCP_OR_UDP
;

46 cÚ¡ *
	g¦ash
 = 
ı_š‹g”
(
pÜt_¡r
.
begš
(),…Üt_¡r.
’d
(), 0, &
pÜt
);

47 ià(
	g¦ash
 !ğ
pÜt_¡r
.
’d
(è&& *
¦ash
 == '/') {

48 ià(
¦ash
 + 4 =ğ
pÜt_¡r
.
’d
(è&& 
memcmp
(slash, "/tcp", 4) == 0)

49 
´Ùo
 = 
IP_PROTO_TCP
;

50 ià(
	g¦ash
 + 4 =ğ
pÜt_¡r
.
’d
(è&& 
memcmp
(
¦ash
, "/udp", 4) == 0)

51 
´Ùo
 = 
IP_PROTO_UDP
;

52 ià(
	gNameInfo
::
qu”y_št
(
NameInfo
::
T_IP_PROTO
, 
this
, 
pÜt_¡r
.
sub¡ršg
(
¦ash
 + 1,…Üt_¡r.
’d
()), &
´Ùo
))

56 } ià(
	g¦ash
 =ğ
pÜt_¡r
.
begš
(è|| 
¦ash
 !ğpÜt_¡r.
’d
()) {

57 
”rh
->
”rÜ
("expected %<NAME PORT/PROTO%>");

62 ià(
	g´Ùo
 =ğ
IP_PROTO_TCP_OR_UDP
) {

63 
NameInfo
::
defše
(NameInfo::
T_TCP_PORT
, 
this
, 
Çme_¡r
, &
pÜt
, 4);

64 
	gNameInfo
::
defše
(
NameInfo
::
T_UDP_PORT
, 
this
, 
Çme_¡r
, &
pÜt
, 4);

66 
	gNameInfo
::
defše
(
NameInfo
::
T_IP_PORT
 + 
´Ùo
, 
this
, 
Çme_¡r
, &
pÜt
, 4);

67 
	gÇme_¡r
 = 
ı_shiá_¥aûvec
(
¡r
);

68 } 
	gÇme_¡r
 &&‚ame_str[0] != '#');

71  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

74 
CLICK_ENDDECLS


75 
	$EXPORT_ELEMENT
(
PÜtInfo
)

76 
	`ELEMENT_HEADER
(<
şick
/
¡ªd¬d
/
pÜtšfo
.
hh
>)

	@standard/print.cc

19 
	~<şick/cÚfig.h
>

20 
	~"´št.hh
"

21 
	~<şick/glue.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 #ifdeà
CLICK_LINUXMODULE


26 
	~<şick/cxx´Ùeù.h
>

27 
	gCLICK_CXX_PROTECT


28 
	~<lšux/sched.h
>

29 
	gCLICK_CXX_UNPROTECT


30 
	~<şick/cxxuÅrÙeù.h
>

32 
CLICK_DECLS


34 
	gPršt
::
	$Pršt
()

36 
	}
}

39 
Pršt
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
* 
”rh
)

41 
boŞ
 
	gtime¡amp
 = 
çl£
;

42 #ifdeà
CLICK_LINUXMODULE


43 
boŞ
 
	g´št_ıu
 = 
çl£
;

45 
boŞ
 
	g´št_ªno
 = 
çl£
, 
	gh—droom
 = f®£, 
	gbcÚ‹Ás
;

46 
	g_aùive
 = 
Œue
;

47 
SŒšg
 
	gÏb–
, 
	gcÚ‹Ás
 = "HEX";

48 
	gby‹s
 = 24;

50 ià(
Args
(
cÚf
, 
this
, 
”rh
)

51 .
»ad_p
("LABEL", 
Ïb–
)

52 .
»ad_p
("MAXLENGTH", 
by‹s
)

53 .
»ad
("LENGTH", 
Args
::
d•»ÿ‹d
, 
by‹s
)

54 .
»ad
("NBYTES", 
Args
::
d•»ÿ‹d
, 
by‹s
)

55 .
»ad
("CONTENTS", 
WÜdArg
(), 
cÚ‹Ás
)

56 .
»ad
("TIMESTAMP", 
time¡amp
)

57 .
»ad
("PRINTANNO", 
´št_ªno
)

58 .
»ad
("ACTIVE", 
_aùive
)

59 .
»ad
("HEADROOM", 
h—droom
)

60 #ià
CLICK_LINUXMODULE


61 .
»ad
("CPU", 
´št_ıu
)

63 .
com¶‘e
() < 0)

66 ià(
BoŞArg
().
·r£
(
cÚ‹Ás
, 
bcÚ‹Ás
))

67 
	g_cÚ‹Ás
 = 
bcÚ‹Ás
;

68 ià((
	gcÚ‹Ás
 = 
cÚ‹Ás
.
uµ”
()), contents == "NONE")

69 
_cÚ‹Ás
 = 0;

70 ià(
	gcÚ‹Ás
 == "HEX")

71 
_cÚ‹Ás
 = 1;

72 ià(
	gcÚ‹Ás
 == "ASCII")

73 
_cÚ‹Ás
 = 2;

75  
	g”rh
->
”rÜ
("bad cÚ‹Á v®u'%s'; should b'NONE', 'HEX', o¸'ASCII'", 
cÚ‹Ás
.
c_¡r
());

77 
	g_Ïb–
 = 
Ïb–
;

78 
	g_by‹s
 = 
by‹s
;

79 
	g_time¡amp
 = 
time¡amp
;

80 
	g_h—droom
 = 
h—droom
;

81 
	g_´št_ªno
 = 
´št_ªno
;

82 #ifdeà
CLICK_LINUXMODULE


83 
	g_ıu
 = 
´št_ıu
;

88 
Pack‘
 *

89 
	gPršt
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

91 ià(!
_aùive
)

92  
p
;

94 
by‹s
 = (
_cÚ‹Ás
 ? 
_by‹s
 : 0);

95 ià(
by‹s
 < 0 || (è
p
->
	`Ëngth
() < bytes)

96 
by‹s
 = 
p
->
	`Ëngth
();

97 
SŒšgAccum
 
	`§
(
_Ïb–
.
	`Ëngth
() + 2

101 + (
_h—droom
 ? 17 : 0)

102 + 
Pack‘
::
ªno_size
*2 + 3

103 + 3 * 
by‹s
);

104 ià(
§
.
	`out_of_memÜy
()) {

105 
	`şick_ch©‹r
("no memory for Print");

106  
p
;

109 cÚ¡ *
£p
 = "";

110 ià(
_Ïb–
) {

111 
§
 << 
_Ïb–
;

112 
£p
 = ": ";

114 #ifdeà
CLICK_LINUXMODULE


115 ià(
_ıu
) {

116 
şick_´oûssÜ_t
 
my_ıu
 = 
	`şick_g‘_´oûssÜ
();

117 
§
 << '(' << 
my_ıu
 << ')';

118 
	`şick_put_´oûssÜ
();

119 
£p
 = ": ";

122 ià(
_time¡amp
) {

123 
§
 << 
£p
 << 
p
->
	`time¡amp_ªno
();

124 
£p
 = ": ";

128 
Ën
;

129 
Ën
 = 
	`¥rštf
(
§
.
	`»£rve
(11), "%s%4d", 
£p
, 
p
->
	`Ëngth
());

130 
§
.
	`adju¡_Ëngth
(
Ën
);

133 ià(
_h—droom
) {

134 
Ën
 = 
	`¥rštf
(
§
.
	`»£rve
(16), " (h%d%d)", 
p
->
	`h—droom
(),…->
	`room
());

135 
§
.
	`adju¡_Ëngth
(
Ën
);

138 ià(
_´št_ªno
) {

139 
§
 << " | ";

140 *
buf
 = 
§
.
	`»£rve
(
Pack‘
::
ªno_size
 * 2);

141 
pos
 = 0;

142 
j
 = 0; j < 
Pack‘
::
ªno_size
; j++, 
pos
 += 2)

143 
	`¥rštf
(
buf
 + 
pos
, "%02x", 
p
->
	`ªno_u8
(
j
));

144 
§
.
	`adju¡_Ëngth
(
pos
);

147 ià(
by‹s
) {

148 
§
 << " | ";

149 *
buf
 = 
§
.
	`d©a
(è+ sa.
	`Ëngth
();

150 cÚ¡ *
d©a
 = 
p
->
	`d©a
();

151 ià(
_cÚ‹Ás
 == 1) {

152 
i
 = 0; i < 
by‹s
; i++, 
d©a
++) {

153 ià(
i
 && (i % 4) == 0)

154 *
buf
++ = ' ';

155 
	`¥rštf
(
buf
, "%02x", *
d©a
 & 0xff);

156 
buf
 += 2;

158 } ià(
_cÚ‹Ás
 == 2) {

159 
i
 = 0; i < 
by‹s
; i++, 
d©a
++) {

160 ià((
i
 % 8) == 0)

161 *
buf
++ = ' ';

162 ià(*
d©a
 < 32 || *data > 126)

163 *
buf
++ = '.';

165 *
buf
++ = *
d©a
;

168 
§
.
	`adju¡_Ëngth
(
buf
 - (§.
	`d©a
(è+ sa.
	`Ëngth
()));

171 
	`şick_ch©‹r
("%s", 
§
.
	`c_¡r
());

173  
p
;

174 
	}
}

177 
	gPršt
::
	$add_hªdËrs
()

179 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
 | HªdËr::
CHECKBOX
 | HªdËr::
CALM
, &
_aùive
);

180 
	}
}

182 
CLICK_ENDDECLS


183 
	$EXPORT_ELEMENT
(
Pršt
)

184 
	`ELEMENT_MT_SAFE
(
Pršt
)

	@standard/print.hh

1 #iâdeà
CLICK_PRINT_HH


2 
	#CLICK_PRINT_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/¡ršg.hh
>

5 
CLICK_DECLS


70 şas 
	cPršt
 : 
public
 
EËm’t
 {…ublic:

72 
	$Pršt
(è
CLICK_COLD
;

74 cÚ¡ *
	$şass_Çme
() const {  "Print"; }

75 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

77 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

78 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

79 
	$add_hªdËrs
(è
CLICK_COLD
;

81 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

83 
´iv©e
:

85 
SŒšg
 
_Ïb–
;

86 
_by‹s
;

87 
boŞ
 
_aùive
;

88 
boŞ
 
_time¡amp
 : 1;

89 
boŞ
 
_h—droom
 : 1;

90 #ifdeà
CLICK_LINUXMODULE


91 
boŞ
 
_ıu
 : 1;

93 
boŞ
 
_´št_ªno
;

94 
ušt8_t
 
_cÚ‹Ás
;

96 
	}
};

98 
	gCLICK_ENDDECLS


	@standard/priosched.cc

20 
	~<şick/cÚfig.h
>

21 
	~<şick/”rÜ.hh
>

22 
	~"´iosched.hh
"

23 
CLICK_DECLS


25 
	gPrioSched
::
	$PrioSched
()

26 : 
	$_sigÇls
(0)

28 
	}
}

31 
PrioSched
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

33 ià(!(
_sigÇls
 = 
Ãw
 
NÙif›rSigÇl
[
	`nšputs
()]))

34  
”rh
->
	`”rÜ
("out of memory!");

35 
i
 = 0; i < 
	`nšputs
(); i++)

36 
_sigÇls
[
i
] = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, i);

38 
	}
}

41 
	gPrioSched
::
	$ş—nup
(
CËªupSge
)

43 
d–‘e
[] 
_sigÇls
;

44 
	}
}

46 
Pack‘
 *

47 
	gPrioSched
::
	$puÎ
()

49 
Pack‘
 *
p
;

50 
i
 = 0; i < 
	`nšputs
(); i++)

51 ià(
_sigÇls
[
i
] && (
p
 = 
	`šput
(i).
	`puÎ
()))

52  
p
;

54 
	}
}

56 
CLICK_ENDDECLS


57 
	$EXPORT_ELEMENT
(
PrioSched
)

58 
	`ELEMENT_MT_SAFE
(
PrioSched
)

	@standard/priosched.hh

2 #iâdeà
CLICK_PRIOSCHED_HH


3 
	#CLICK_PRIOSCHED_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/nÙif›r.hh
>

6 
CLICK_DECLS


25 şas 
	cPrioSched
 : 
public
 
EËm’t
 {…ublic:

27 
	$PrioSched
(è
CLICK_COLD
;

29 cÚ¡ *
	$şass_Çme
() const {  "PrioSched"; }

30 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/1"; 
	}
}

31 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

32 cÚ¡ *
	$æags
(ècÚ¡ {  "S0"; 
	}
}

34 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

35 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

37 
Pack‘
 *
	`puÎ
(
pÜt
);

39 
´iv©e
:

41 
NÙif›rSigÇl
 *
_sigÇls
;

43 
	}
};

45 
	gCLICK_ENDDECLS


	@standard/pullswitch.cc

18 
	~<şick/cÚfig.h
>

19 
	~"puÎsw™ch.hh
"

20 
	~<şick/cÚå¬£.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/Î½c.h
>

23 
CLICK_DECLS


25 
	gPuÎSw™ch
::
	$PuÎSw™ch
()

26 : 
	$_sigÇls
(0)

28 
	}
}

31 
PuÎSw™ch
::
	$ÿ¡
(cÚ¡ *
Çme
)

33 ià(
	`¡rcmp
(
Çme
, "SimplePullSwitch") == 0)

34  
¡©ic_ÿ¡
<
Sim¶ePuÎSw™ch
 *>(
this
);

35 ià(
	`¡rcmp
(
Çme
, 
NÙif›r
::
EMPTY_NOTIFIER
) == 0)

36  
¡©ic_ÿ¡
<
NÙif›r
 *>(&
_nÙif›r
);

38  
EËm’t
::
	`ÿ¡
(
Çme
);

39 
	}
}

42 
	gPuÎSw™ch
::
	$wake_ÿÎback
(*
u£r_d©a
, 
NÙif›r
 *)

44 
PuÎSw™ch
 *
ps
 = 
¡©ic_ÿ¡
<PuÎSw™ch *>(
u£r_d©a
);

45 ià(
ps
->
_šput
 >ğ0 && !ps->
_nÙif›r
.
	`aùive
()

46 && 
ps
->
_sigÇls
[ps->
_šput
].
	`aùive
())

47 
ps
->
_nÙif›r
.
	`wake
();

48 
	}
}

51 
	gPuÎSw™ch
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

53 
_nÙif›r
.
	`š™Ÿlize
(
NÙif›r
::
EMPTY_NOTIFIER
, 
	`rou‹r
());

54 
_nÙif›r
.
	`£t_aùive
(
_šput
 >ğ0, 
çl£
);

55 ià(!(
_sigÇls
 = 
Ãw
 
NÙif›rSigÇl
[
	`nšputs
()]))

56  
”rh
->
	`”rÜ
("out of memory!");

57 
i
 = 0; i < 
	`nšputs
(); ++i)

58 
_sigÇls
[
i
] = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, i, 
wake_ÿÎback
,his);

60 
	}
}

63 
	gPuÎSw™ch
::
	$ş—nup
(
CËªupSge
)

65 
d–‘e
[] 
_sigÇls
;

66 
_sigÇls
 = 0;

67 
	}
}

69 
Pack‘
 *

70 
	gPuÎSw™ch
::
	$puÎ
()

72 ià(
_šput
 < 0) {

73 
_nÙif›r
.
	`£t_aùive
(
çl£
, false);

75 } ià(
Pack‘
 *
p
 = 
	`šput
(
_šput
).
	`puÎ
()) {

76 
_nÙif›r
.
	`£t_aùive
(
Œue
, 
çl£
);

77  
p
;

79 ià(!
_sigÇls
[
_šput
])

80 
_nÙif›r
.
	`£t_aùive
(
çl£
, false);

83 
	}
}

86 
	gPuÎSw™ch
::
	$£t_šput
(
šput
)

88 
_šput
 = (
šput
 < 0 || iÅuˆ>ğ
	`nšputs
() ? -1 : input);

89 ià(!
_nÙif›r
.
	`š™Ÿlized
())

91 ià(
_šput
 < 0)

92 
_nÙif›r
.
	`£t_aùive
(
çl£
, false);

93 ià(
_sigÇls
[
_šput
])

94 
_nÙif›r
.
	`£t_aùive
(
Œue
,rue);

95 
	}
}

97 
CLICK_ENDDECLS


98 
	$ELEMENT_REQUIRES
(
Sim¶ePuÎSw™ch
)

99 
	$EXPORT_ELEMENT
(
PuÎSw™ch
)

100 
	`ELEMENT_MT_SAFE
(
PuÎSw™ch
)

	@standard/pullswitch.hh

1 #iâdeà
CLICK_PULLSWITCH_HH


2 
	#CLICK_PULLSWITCH_HH


	)

3 
	~"–em’ts/sim¶e/sim¶•uÎsw™ch.hh
"

4 
	~<şick/nÙif›r.hh
>

5 
CLICK_DECLS


44 şas 
	cPuÎSw™ch
 : 
public
 
Sim¶ePuÎSw™ch
 {…ublic:

46 
	$PuÎSw™ch
(è
CLICK_COLD
;

48 cÚ¡ *
	$şass_Çme
() const {  "PullSwitch"; }

49 *
	`ÿ¡
(cÚ¡ *
Çme
);

51 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

52 
	$ş—nup
(
CËªupSge
 
¡age
è
CLICK_COLD
;

54 
	`£t_šput
(
šput
);

56 
Pack‘
 *
	`puÎ
();

58 
´Ùeùed
:

60 
AùiveNÙif›r
 
_nÙif›r
;

61 
NÙif›rSigÇl
 *
_sigÇls
;

63 
	`wake_ÿÎback
(*, 
NÙif›r
 *);

65 
	}
};

67 
	gCLICK_ENDDECLS


	@standard/quicknotequeue.cc

19 
	~<şick/cÚfig.h
>

20 
	~"quicknÙequeue.hh
"

21 
CLICK_DECLS


23 
	gQuickNÙeQueue
::
	$QuickNÙeQueue
()

25 
	}
}

28 
QuickNÙeQueue
::
	$ÿ¡
(cÚ¡ *
n
)

30 ià(
	`¡rcmp
(
n
, "QuickNoteQueue") == 0)

31  (
QuickNÙeQueue
 *)
this
;

33  
FuÎNÙeQueue
::
	`ÿ¡
(
n
);

34 
	}
}

36 
Pack‘
 *

37 
	gQuickNÙeQueue
::
	$puÎ
()

39 
h
 = 
	`h—d
(), 
t
 = 
	`
();

40 
Pack‘
 *
p
;

42 ià(
h
 !ğ
t
) {

43 
p
 = 
_q
[
h
];

44 
h
 = 
	`Ãxt_i
(h);

45 
	`£t_h—d
(
h
);

46 
_fuÎ_nÙe
.
	`wake
();

48 
p
 = 0;

50 ià(
h
 =ğ
t
) {

51 
_em±y_nÙe
.
	`¦“p
();

52 #ià
HAVE_MULTITHREAD


56 ià(
	`size
())

57 
_em±y_nÙe
.
	`wake
();

61  
p
;

62 
	}
}

64 
CLICK_ENDDECLS


65 
	$ELEMENT_REQUIRES
(
FuÎNÙeQueue
)

66 
	`EXPORT_ELEMENT
(
QuickNÙeQueue
)

	@standard/quicknotequeue.hh

2 #iâdeà
CLICK_QUICKNOTEQUEUE_HH


3 
	#CLICK_QUICKNOTEQUEUE_HH


	)

4 
	~"fuÎnÙequeue.hh
"

5 
CLICK_DECLS


66 şas 
	cQuickNÙeQueue
 : 
public
 
FuÎNÙeQueue
 {…ublic:

68 
	$QuickNÙeQueue
(è
CLICK_COLD
;

70 cÚ¡ *
	$şass_Çme
() const {  "QuickNoteQueue"; }

71 *
	`ÿ¡
(cÚ¡ *
Çme
);

76 
Pack‘
 *
	`puÎ
(
pÜt
);

78 
	}
};

80 
	gCLICK_ENDDECLS


	@standard/quitwatcher.cc

19 
	~<şick/cÚfig.h
>

20 
	~"qu™w©ch”.hh
"

21 
	~<şick/glue.hh
>

22 
	~<şick/cÚå¬£.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/hªdËrÿÎ.hh
>

26 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

27 
CLICK_DECLS


29 
	gQu™W©ch”
::
	$Qu™W©ch”
()

30 : 
	$_tim”
(
this
)

32 
	}
}

35 
Qu™W©ch”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *)

42 
	gQu™W©ch”
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

45 
VeùÜ
<
SŒšg
> 
cÚf
;

46 
	`ı_¬gvec
(
	`cÚfigu¿tiÚ
(), 
cÚf
);

48 
i
 = 0; i < 
cÚf
.
	`size
(); i++) {

49 
HªdËrC®l
 
	`hc
(
cÚf
[
i
] + ".scheduled");

50 ià(
hc
.
	`š™Ÿlize_»ad
(
this
, 
”rh
) >= 0) {

51 
_e
.
	`push_back
(
hc
.
	`–em’t
());

52 
_hªdËrs
.
	`push_back
(
hc
.
	`hªdËr
());

56 ià(
_e
.
	`size
(è< 
cÚf
.size())

59 
_tim”
.
	`š™Ÿlize
(
this
);

60 
_tim”
.
	`scheduË_aá”_m£c
(10);

62 
	}
}

65 
	gQu™W©ch”
::
	$run_tim”
(
Tim”
 *)

67 
i
 = 0; i < 
_e
.
	`size
(); i++) {

68 
SŒšg
 
s
 = 
_hªdËrs
[
i
]->
	`ÿÎ_»ad
(
_e
[i]);

69 ià(!
s
.
	`Ëngth
() || s[0] == 'f') {

70 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

74 
_tim”
.
	`scheduË_aá”_m£c
(10);

75 
	}
}

77 
CLICK_ENDDECLS


78 
EXPORT_ELEMENT
(
Qu™W©ch”
)

	@standard/quitwatcher.hh

1 #iâdeà
CLICK_QUITWATCHER_HH


2 
	#CLICK_QUITWATCHER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tim”.hh
>

5 
CLICK_DECLS


6 
şass
 
	gHªdËr
;

24 şas 
	cQu™W©ch”
 : 
public
 
EËm’t
 {…ublic:

26 
	$Qu™W©ch”
(è
CLICK_COLD
;

28 cÚ¡ *
	$şass_Çme
() const {  "QuitWatcher"; }

29 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

30 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

32 
	`run_tim”
(
Tim”
 *);

34 
´iv©e
:

36 
VeùÜ
<
EËm’t
*> 
_e
;

37 
VeùÜ
<cÚ¡ 
HªdËr
*> 
_hªdËrs
;

38 
Tim”
 
_tim”
;

40 
	}
};

42 
	gCLICK_ENDDECLS


	@standard/randomerror.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¿ndom”rÜ.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gb™_æ_¬¿y_idx
[] = {

29 
	gb™_æ_¬¿y
[] = {

76 
	gRªdomB™E¼Üs
::
	$RªdomB™E¼Üs
()

78 
	}
}

81 
RªdomB™E¼Üs
::
	$£t_b™_”rÜ
(
b™_”rÜ
)

83 
	`as£¹
(
b™_”rÜ
 <= 0x10000000);

84 
_p_b™_”rÜ
 = 
b™_”rÜ
;

85 
nÚ_b™_”rÜ
 = (0xFFFFFFF - 
b™_”rÜ
) + 1;

88 
ušt64_t
 
accum
 = 0;

89 
i
 = 0; i < 8; i++) {

93 
ušt64_t
 
p
 = 0x800000000LL;

94 
j
 = 0; j < 
i
; j++)

95 
p
 = (°* 
b™_”rÜ
) >> 28;

96 
j
 = 
i
; j < 8; j++)

97 
p
 = (°* 
nÚ_b™_”rÜ
) >> 28;

98 
p
 *ğ
b™_æ_¬¿y_idx
[
i
+1] - bit_flip_array_idx[i];

100 
accum
 +ğ
p
;

102 
_p_”rÜ
[
i
] = (
accum
 >> 7) & 0x1FFFFFFF;

103 ià((
accum
 & 0x7F) >= 0x40)

104 
_p_”rÜ
[
i
]++;

109 
_p_”rÜ
[8] = 0x10000000;

110 
	}
}

113 
	gRªdomB™E¼Üs
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

115 
	gb™_”rÜ
;

116 
SŒšg
 
	gkšd_¡r
 = "flip";

117 
boŞ
 
	gÚ
 = 
Œue
;

118 ià(
Args
(
cÚf
, 
this
, 
”rh
)

119 .
»ad_mp
("P", 
FixedPoštArg
(28), 
b™_”rÜ
)

120 .
»ad_p
("KIND", 
kšd_¡r
)

121 .
»ad_p
("ACTIVE", 
Ú
)

122 .
com¶‘e
() < 0)

125 
	gkšd
;

126 ià(
	gkšd_¡r
 =ğ"æ" || 
kšd_¡r
 == "")

127 
kšd
 = 2;

128 ià(
	gkšd_¡r
 == "set")

129 
kšd
 = 1;

130 ià(
	gkšd_¡r
 == "clear")

131 
kšd
 = 0;

133  
	g”rh
->
”rÜ
("bad‡ction %<%s%> (must be %<set%>, %<clear%>, or %<flip%>)",

134 
kšd_¡r
.
c_¡r
());

136 ià(
	gb™_”rÜ
 > 0x10000000)

137  
	g”rh
->
”rÜ
("drop…robability must be between 0‡nd 1");

138 ià(
	gb™_”rÜ
 == 0)

139 
”rh
->
w¬nšg
("zero bitƒrror…robability (underflow?)");

142 
£t_b™_”rÜ
(
b™_”rÜ
);

143 
	g_kšd
 = 
kšd
;

144 
	g_Ú
 = 
Ú
;

149 
Pack‘
 *

150 
	gRªdomB™E¼Üs
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

153 ià(!
_Ú
 || 
_p_”rÜ
[0] >= 0x10000000)

154  
p_š
;

156 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

157 *
d©a
 = 
p
->
	`d©a
();

158 
Ën
 = 
p
->
	`Ëngth
();

159 *
p_”rÜ
 = 
_p_”rÜ
;

160 
kšd
 = 
_kšd
;

162 
i
 = 0; i < 
Ën
; i++) {

163 
v
 = (
	`şick_¿ndom
() >> 3) & 0xFFFFFFF;

164 ià(
v
 <ğ
p_”rÜ
[0])

167 
nb
 = 1;

168 
v
 > 
p_”rÜ
[
nb
])

169 
nb
++;

171 
idx
 = 
b™_æ_¬¿y_idx
[
nb
];

172 
n
 = 
b™_æ_¬¿y_idx
[
nb
+1] - 
idx
;

173 
”rÜs
 = 
b™_æ_¬¿y
[ ((
	`şick_¿ndom
(è>> 5è% 
n
è+ 
idx
 ];

175 ià(
kšd
 == 0)

176 
d©a
[
i
] &ğ~
”rÜs
;

177 ià(
kšd
 == 1)

178 
d©a
[
i
] |ğ
”rÜs
;

180 
d©a
[
i
] ^ğ
”rÜs
;

183  
p
;

184 
	}
}

186 
SŒšg


187 
	$¿ndom_b™_”rÜs_»ad
(
EËm’t
 *
f
, *
vwhich
)

189 
which
 = (
šŒ_t
)
vwhich
;

190 
RªdomB™E¼Üs
 *
los§ge
 = (RªdomB™E¼Ü *)
f
;

191 ià(
which
 == 0)

192  
	`ı_uÅ¬£_»®2
(
los§ge
->
	`p_b™_”rÜ
(), 28);

194 
los§ge
->
	`kšd
()) {

201 
	}
}

204 
	gRªdomB™E¼Üs
::
	$add_hªdËrs
()

206 
	`add_»ad_hªdËr
("p_b™_”rÜ", 
¿ndom_b™_”rÜs_»ad
, 0);

207 
	`add_wr™e_hªdËr
("p_b™_”rÜ", 
»cÚfigu»_keywÜd_hªdËr
, "0 P");

208 
	`add_»ad_hªdËr
("”rÜ_kšd", 
¿ndom_b™_”rÜs_»ad
, 1);

209 
	`add_wr™e_hªdËr
("”rÜ_kšd", 
»cÚfigu»_keywÜd_hªdËr
, "1 KIND");

210 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_Ú
);

211 
	}
}

213 
CLICK_ENDDECLS


214 
	$EXPORT_ELEMENT
(
RªdomB™E¼Üs
)

215 
	$ELEMENT_MT_SAFE
(
RªdomB™E¼Üs
)

216 
	`ELEMENT_REQUIRES
(
št64
)

	@standard/randomerror.hh

1 #iâdeà
CLICK_RANDOMERROR_HH


2 
	#CLICK_RANDOMERROR_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


30 şas 
	cRªdomB™E¼Üs
 : 
public
 
EËm’t
 {

32 
_p_”rÜ
[9];

33 
	m_p_b™_”rÜ
;

34 
	m_kšd
;

35 
boŞ
 
	m_Ú
;

37 
	mpublic
:

39 
	$RªdomB™E¼Üs
(è
CLICK_COLD
;

41 cÚ¡ *
	$şass_Çme
() const {  "RandomBitErrors"; }

42 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

44 
	$p_b™_”rÜ
(ècÚ¡ {  
_p_b™_”rÜ
; 
	}
}

45 
	$kšd
(ècÚ¡ {  
_kšd
; 
	}
}

46 
boŞ
 
	$Ú
(ècÚ¡ {  
_Ú
; 
	}
}

47 
£t_b™_”rÜ
();

49 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

50 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

51 
	$add_hªdËrs
(è
CLICK_COLD
;

53 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

55 
	}
};

57 
	gCLICK_ENDDECLS


	@standard/randomsample.cc

20 
	~<şick/cÚfig.h
>

21 
	~"¿ndom§m¶e.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şick/”rÜ.hh
>

25 
CLICK_DECLS


27 
	gRªdomSam¶e
::
	$RªdomSam¶e
()

29 
	}
}

32 
RªdomSam¶e
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

34 
ušt32_t
 
	g§m¶šg_´ob
 = 0xFFFFFFFFU;

35 
ušt32_t
 
	gdrİ_´ob
 = 0xFFFFFFFFU;

36 
boŞ
 
	gaùive
 = 
Œue
, 
	ghave_§m¶e
 = 
çl£
, 
	ghave_drİ
 = false;

37 ià(
Args
(
cÚf
, 
this
, 
”rh
)

38 .
»ad_p
("P", 
FixedPoštArg
(
SAMPLING_SHIFT
), 
§m¶šg_´ob
)

39 .
»ad
("SAMPLE", 
FixedPoštArg
(
SAMPLING_SHIFT
), 
§m¶šg_´ob
).
»ad_¡©us
(
have_§m¶e
)

40 .
»ad
("DROP", 
FixedPoštArg
(
SAMPLING_SHIFT
), 
drİ_´ob
).
»ad_¡©us
(
have_drİ
)

41 .
»ad
("ACTIVE", 
aùive
)

42 .
com¶‘e
() < 0)

44 ià(
	ghave_§m¶e
 && 
	ghave_drİ
)

45  
	g”rh
->
”rÜ
("give‡t most one of SAMPLE‡nd DROP");

46 ià(
	ghave_drİ
)

47 
	g§m¶šg_´ob
 = (1 << 
SAMPLING_SHIFT
è- 
drİ_´ob
;

48 ià(
	g§m¶šg_´ob
 > (1 << 
	gSAMPLING_SHIFT
))

49  
	g”rh
->
”rÜ
("sampling…robability must be between 0‡nd 1");

52 
	g_§m¶šg_´ob
 = 
§m¶šg_´ob
;

53 
	g_aùive
 = 
aùive
;

59 
	gRªdomSam¶e
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

61 
_drİs
 = 0;

63 
	}
}

66 
	gRªdomSam¶e
::
	$push
(, 
Pack‘
 *
p
)

68 ià(!
_aùive
 || (
	`şick_¿ndom
(è& 
SAMPLING_MASK
è< 
_§m¶šg_´ob
)

69 
	`ouut
(0).
	`push
(
p
);

71 
	`checked_ouut_push
(1, 
p
);

72 
_drİs
++;

74 
	}
}

76 
Pack‘
 *

77 
	gRªdomSam¶e
::
	$puÎ
()

79 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

80 ià(!
p
)

82 ià(!
_aùive
 || (
	`şick_¿ndom
(è& 
SAMPLING_MASK
è< 
_§m¶šg_´ob
)

83  
p
;

85 
	`checked_ouut_push
(1, 
p
);

86 
_drİs
++;

89 
	}
}

91 
SŒšg


92 
	gRªdomSam¶e
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

94 
RªdomSam¶e
 *
rs
 = 
¡©ic_ÿ¡
<RªdomSam¶*>(
e
);

95 (
šŒ_t
)
thunk
) {

96 
h_§m¶e
:

97  
	`ı_uÅ¬£_»®2
(
rs
->
_§m¶šg_´ob
, 
SAMPLING_SHIFT
);

98 
h_drİ
:

99  
	`ı_uÅ¬£_»®2
((1 << 
SAMPLING_SHIFT
è- 
rs
->
_§m¶šg_´ob
, SAMPLING_SHIFT);

100 
h_cÚfig
: {

101 
SŒšgAccum
 
§
;

102 
§
 << "SAMPLE " << 
	`ı_uÅ¬£_»®2
(
rs
->
_§m¶šg_´ob
, 
SAMPLING_SHIFT
)

103 << ", ACTIVE " << 
rs
->
_aùive
;

104  
§
.
	`ke_¡ršg
();

109 
	}
}

112 
	gRªdomSam¶e
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

114 
RªdomSam¶e
 *
rs
 = 
¡©ic_ÿ¡
<RªdomSam¶*>(
e
);

115 
ušt32_t
 
p
;

116 ià(!
	`FixedPoštArg
(
SAMPLING_SHIFT
).
	`·r£
(
	`ı_uncomm’t
(
¡r
), 
p
) ||… > (1 << SAMPLING_SHIFT))

117  
”rh
->
	`”rÜ
("Must be given‡‚umber between 0.0‡nd 1.0");

118 ià((
šŒ_t
)
thunk
 =ğ
h_drİ
)

119 
p
 = (1 << 
SAMPLING_SHIFT
) -…;

120 
rs
->
_§m¶šg_´ob
 = 
p
;

122 
	}
}

125 
	gRªdomSam¶e
::
	$add_hªdËrs
()

127 
	`add_»ad_hªdËr
("§m¶šg_´ob", 
»ad_hªdËr
, 
h_§m¶e
);

128 
	`add_wr™e_hªdËr
("§m¶šg_´ob", 
wr™e_hªdËr
, 
h_§m¶e
);

129 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
 | HªdËr::
CHECKBOX
, &
_aùive
);

130 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

131 
	`add_»ad_hªdËr
("drİ_´ob", 
»ad_hªdËr
, 
h_drİ
);

132 
	`add_wr™e_hªdËr
("drİ_´ob", 
wr™e_hªdËr
, 
h_drİ
);

133 
	`add_»ad_hªdËr
("cÚfig", 
»ad_hªdËr
, 
h_cÚfig
);

134 
	`£t_hªdËr_æags
("cÚfig", 0, 
HªdËr
::
CALM
);

135 
	}
}

137 
CLICK_ENDDECLS


138 
	$EXPORT_ELEMENT
(
RªdomSam¶e
)

139 
	`ELEMENT_MT_SAFE
(
RªdomSam¶e
)

	@standard/randomsample.hh

2 #iâdeà
CLICK_RANDOMSAMPLE_HH


3 
	#CLICK_RANDOMSAMPLE_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/©omic.hh
>

6 
CLICK_DECLS


65 şas 
	cRªdomSam¶e
 : 
public
 
EËm’t
 {…ublic:

67 
	$RªdomSam¶e
(è
CLICK_COLD
;

69 cÚ¡ *
	$şass_Çme
() const {  "RandomSample"; }

70 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

71 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

73 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

74 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

75 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

76 
	$add_hªdËrs
(è
CLICK_COLD
;

78 
	`push
(
pÜt
, 
Pack‘
 *);

79 
Pack‘
 *
	`puÎ
(
pÜt
);

81 
´iv©e
:

83 ’um { 
SAMPLING_SHIFT
 = 28 
	}
};

84 ’um { 
	gSAMPLING_MASK
 = (1 << 
SAMPLING_SHIFT
) - 1 };

86 ’um { 
	gh_§m¶e
, 
	gh_drİ
, 
	gh_cÚfig
 };

88 
ušt32_t
 
	g_§m¶šg_´ob
;

89 
boŞ
 
	g_aùive
;

90 
©omic_ušt32_t
 
	g_drİs
;

92 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

93 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

94 
	}
};

96 
	gCLICK_ENDDECLS


	@standard/randomsource.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¿ndomsourû.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/glue.hh
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/hªdËrÿÎ.hh
>

27 
CLICK_DECLS


29 
	gRªdomSourû
::
	$RªdomSourû
()

31 
	}
}

34 
RªdomSourû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
	gAùiveNÙif›r
::
š™Ÿlize
(
NÙif›r
::
EMPTY_NOTIFIER
, 
rou‹r
());

37 
couÁ”_t
 
	glim™
 = -1;

38 
	gbur¡size
 = 1;

39 
	gd©asize
 = -1;

40 
boŞ
 
	gaùive
 = 
Œue
, 
	g¡İ
 = 
çl£
, 
	gtime¡amp
 =rue;

41 
HªdËrC®l
 
	g’d_h
;

43 ià(
Args
(
cÚf
, 
this
, 
”rh
)

44 .
»ad_mp
("LENGTH", 
d©asize
)

45 .
»ad_p
("LIMIT", 
lim™
)

46 .
»ad_p
("BURST", 
bur¡size
)

47 .
»ad_p
("ACTIVE", 
aùive
)

48 .
»ad
("TIMESTAMP", 
time¡amp
)

49 .
»ad
("STOP", 
¡İ
)

50 .
»ad
("END_CALL", 
HªdËrC®lArg
(
HªdËrC®l
::
wr™abË
), 
’d_h
)

51 .
com¶‘e
() < 0)

53 ià(
	gd©asize
 < 0 || datasize >= 64*1024)

54  
”rh
->
”rÜ
("bad†’gth %d", 
d©asize
);

55 ià(
	gbur¡size
 < 1)

56  
	g”rh
->
”rÜ
("burst size must be >= 1");

57 ià(
	g¡İ
 && 
	g’d_h
)

58  
	g”rh
->
”rÜ
("END_CALL‡nd STOP‡re mutuallyƒxclusive");

60 
	g_d©asize
 = 
d©asize
;

61 
	g_lim™
 = 
lim™
;

62 
	g_bur¡size
 = 
bur¡size
;

63 
	g_couÁ
 = 0;

64 
	g_aùive
 = 
aùive
;

65 
	g_time¡amp
 = 
time¡amp
;

66 
d–‘e
 
	g_’d_h
;

67 ià(
	g’d_h
)

68 
	g_’d_h
 = 
Ãw
 
HªdËrC®l
(
’d_h
);

69 ià(
	g¡İ
)

70 
	g_’d_h
 = 
Ãw
 
HªdËrC®l
("stop");

72 
	g_’d_h
 = 0;

77 
boŞ


78 
	gRªdomSourû
::
	$run_sk
(
Task
 *)

80 ià(!
_aùive
 || !
_nÚfuÎ_sigÇl
)

81  
çl£
;

82 
n
 = 
_bur¡size
;

83 ià(
_lim™
 >ğ0 && 
_couÁ
 + 
n
 >ğ(
ucouÁ”_t
) _limit)

84 
n
 = (
_couÁ
 > (
ucouÁ”_t
è
_lim™
 ? 0 : _limit - _count);

85 
i
 = 0; i < 
n
; i++) {

86 
Pack‘
 *
p
 = 
	`make_·ck‘
();

87 
	`ouut
(0).
	`push
(
p
);

89 
_couÁ
 +ğ
n
;

90 ià(
n
 > 0)

91 
_sk
.
	`ç¡_»scheduË
();

92 ià(
_’d_h
 && 
_lim™
 >ğ0 && 
_couÁ
 >ğ(
ucouÁ”_t
) _limit)

93 (è
_’d_h
->
	`ÿÎ_wr™e
();

94  
n
 > 0;

95 
	}
}

97 
Pack‘
 *

98 
	gRªdomSourû
::
	$puÎ
()

100 ià(!
_aùive
) {

101 
dÚe
:

102 ià(
NÙif›r
::
	`aùive
())

103 
	`¦“p
();

106 ià(
_lim™
 >ğ0 && 
_couÁ
 >ğ(
ucouÁ”_t
) _limit) {

107 ià(
_’d_h
)

108 (è
_’d_h
->
	`ÿÎ_wr™e
();

109 
dÚe
;

111 
_couÁ
++;

112 
Pack‘
 *
p
 = 
	`make_·ck‘
();

113  
p
;

114 
	}
}

116 
Pack‘
 *

117 
	gRªdomSourû
::
	$make_·ck‘
()

119 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(36, (cÚ¡ *)0, 
_d©asize
, 0);

121 
i
;

122 *
d
 = (*è
p
->
	`d©a
();

123 
i
 = 0; i < 
_d©asize
; i += ())

124 *(*)(
d
 + 
i
èğ
	`şick_¿ndom
();

125  ; 
i
 < 
_d©asize
; i++)

126 *(
d
 + 
i
èğ
	`şick_¿ndom
();

128 ià(
_time¡amp
)

129 
p
->
	`time¡amp_ªno
().
	`assign_now
();

130  
p
;

131 
	}
}

134 
	gRªdomSourû
::
	$add_hªdËrs
()

136 
	`add_d©a_hªdËrs
("lim™", 
HªdËr
::
OP_READ
 | HªdËr::
CALM
, &
_lim™
);

137 
	`add_wr™e_hªdËr
("lim™", 
chªge_·¿m
, 
h_lim™
);

138 
	`add_d©a_hªdËrs
("bur¡", 
HªdËr
::
OP_READ
 | HªdËr::
CALM
, &
_bur¡size
);

139 
	`add_wr™e_hªdËr
("bur¡", 
chªge_·¿m
, 
h_bur¡
);

140 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
OP_READ
 | HªdËr::
CHECKBOX
, &
_aùive
);

141 
	`add_wr™e_hªdËr
("aùive", 
chªge_·¿m
, 
h_aùive
);

142 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
OP_READ
, &
_couÁ
);

143 
	`add_wr™e_hªdËr
("»£t", 
chªge_·¿m
, 
h_»£t
, 
HªdËr
::
BUTTON
);

144 
	`add_d©a_hªdËrs
("Ëngth", 
HªdËr
::
OP_READ
 | HªdËr::
CALM
, &
_d©asize
);

145 
	`add_wr™e_hªdËr
("Ëngth", 
chªge_·¿m
, 
h_Ëngth
);

146 ià(
	`ouut_is_push
(0))

147 
	`add_sk_hªdËrs
(&
_sk
);

148 
	}
}

150 
CLICK_ENDDECLS


151 
	$EXPORT_ELEMENT
(
RªdomSourû
)

152 
	`ELEMENT_MT_SAFE
(
RªdomSourû
)

	@standard/randomsource.hh

1 #iâdeà
CLICK_RANDOMSOURCE_HH


2 
	#CLICK_RANDOMSOURCE_HH


	)

3 
	~"šfš™esourû.hh
"

4 
CLICK_DECLS


85 şas 
	cRªdomSourû
 : 
public
 
Infš™eSourû
 {…ublic:

87 
	$RªdomSourû
(è
CLICK_COLD
;

89 cÚ¡ *
	$şass_Çme
() const {  "RandomSource"; }

90 
	$add_hªdËrs
(è
CLICK_COLD
;

92 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

94 
boŞ
 
	`run_sk
(
Task
 *);

95 
Pack‘
 *
	`puÎ
();

97 
´Ùeùed
:

99 
Pack‘
 *
	`make_·ck‘
();

101 
	}
};

103 
	gCLICK_ENDDECLS


	@standard/randomswitch.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¿ndomsw™ch.hh
"

21 
CLICK_DECLS


23 
	gRªdomSw™ch
::
	$RªdomSw™ch
()

25 
	}
}

28 
RªdomSw™ch
::
	$push
(, 
Pack‘
 *
p
)

30 
o
 = 
	`şick_¿ndom
(0, 
	`nouuts
() - 1);

31 
	`ouut
(
o
).
	`push
(
p
);

32 
	}
}

34 
CLICK_ENDDECLS


35 
	$EXPORT_ELEMENT
(
RªdomSw™ch
)

36 
	`ELEMENT_MT_SAFE
(
RªdomSw™ch
)

	@standard/randomswitch.hh

2 #iâdeà
CLICK_RANDOMSWITCH_HH


3 
	#CLICK_RANDOMSWITCH_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/©omic.hh
>

6 
CLICK_DECLS


21 şas 
	cRªdomSw™ch
 : 
public
 
EËm’t
 {…ublic:

23 
	$RªdomSw™ch
(è
CLICK_COLD
;

25 cÚ¡ *
	$şass_Çme
() const {  "RandomSwitch"; }

26 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-"; 
	}
}

27 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

29 
push
(, 
Pack‘
 *);

33 
	gCLICK_ENDDECLS


	@standard/ratedsource.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¿‹dsourû.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

26 
	~<şick/glue.hh
>

27 
CLICK_DECLS


29 cÚ¡ 
	gR©edSourû
::
NO_LIMIT
;

31 
	gR©edSourû
::
	$R©edSourû
()

32 : 
	`_·ck‘
(0), 
	`_sk
(
this
), 
	$_tim”
(&
_sk
)

34 
	}
}

37 
	gR©edSourû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39 
SŒšg
 
	gd©a
 =

41 
	g¿‹
 = 10;

42 
	gbªdwidth
 = 0;

43 
	glim™
 = -1;

44 
	gd©asize
 = -1;

45 
boŞ
 
	gaùive
 = 
Œue
, 
	g¡İ
 = 
çl£
;

47 ià(
Args
(
cÚf
, 
this
, 
”rh
)

48 .
»ad_p
("DATA", 
d©a
)

49 .
»ad_p
("RATE", 
¿‹
)

50 .
»ad_p
("LIMIT", 
lim™
)

51 .
»ad_p
("ACTIVE", 
aùive
)

52 .
»ad
("LENGTH", 
d©asize
)

53 .
»ad
("DATASIZE", 
d©asize
)

54 .
»ad
("STOP", 
¡İ
)

55 .
»ad
("BANDWIDTH", 
BªdwidthArg
(), 
bªdwidth
)

56 .
com¶‘e
() < 0)

59 
	g_d©a
 = 
d©a
;

60 
	g_d©asize
 = 
d©asize
;

61 ià(
	gbªdwidth
 > 0)

62 
	g¿‹
 = 
bªdwidth
 / (
_d©asize
 < 0 ? 
_d©a
.
Ëngth
() : _datasize);

63 
	gbur¡
 = 
¿‹
 < 200 ? 2 :„ate / 100;

64 ià(
	gbªdwidth
 > 0 && 
	gbur¡
 < 2 * 
	gd©asize
)

65 
	gbur¡
 = 2 * 
d©asize
;

66 
	g_tb
.
assign
(
¿‹
, 
bur¡
);

67 
	g_lim™
 = (
lim™
 >ğ0 ? Öim™è: 
NO_LIMIT
);

68 
	g_aùive
 = 
aùive
;

69 
	g_¡İ
 = 
¡İ
;

71 
£tup_·ck‘
();

77 
	gR©edSourû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

79 
_couÁ
 = 0;

80 ià(
	`ouut_is_push
(0))

81 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
”rh
);

82 
_tb
.
	`£t
(1);

83 
_tim”
.
	`š™Ÿlize
(
this
);

85 
	}
}

88 
	gR©edSourû
::
	$ş—nup
(
CËªupSge
)

90 ià(
_·ck‘
)

91 
_·ck‘
->
	`kl
();

92 
_·ck‘
 = 0;

93 
	}
}

95 
boŞ


96 
	gR©edSourû
::
	$run_sk
(
Task
 *)

98 ià(!
_aùive
)

99  
çl£
;

100 ià(
_lim™
 !ğ
NO_LIMIT
 && 
_couÁ
 >= _limit) {

101 ià(
_¡İ
)

102 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

103  
çl£
;

106 
_tb
.
	`»fl
();

107 ià(
_tb
.
	`»move_if
(1)) {

108 
Pack‘
 *
p
 = 
_·ck‘
->
	`şÚe
();

109 
p
->
	`£t_time¡amp_ªno
(
Time¡amp
::
	`now
());

110 
	`ouut
(0).
	`push
(
p
);

111 
_couÁ
++;

112 
_sk
.
	`ç¡_»scheduË
();

113  
Œue
;

115 
_tim”
.
	`scheduË_aá”
(
Time¡amp
::
	`make_jiff›s
(
_tb
.
	`time_uÁ_cÚšs
(1)));

116  
çl£
;

118 
	}
}

120 
Pack‘
 *

121 
	gR©edSourû
::
	$puÎ
()

123 ià(!
_aùive
)

125 ià(
_lim™
 !ğ
NO_LIMIT
 && 
_couÁ
 >= _limit) {

126 ià(
_¡İ
)

127 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

131 
_tb
.
	`»fl
();

132 ià(
_tb
.
	`»move_if
(1)) {

133 
_couÁ
++;

134 
Pack‘
 *
p
 = 
_·ck‘
->
	`şÚe
();

135 
p
->
	`£t_time¡amp_ªno
(
Time¡amp
::
	`now
());

136  
p
;

139 
	}
}

142 
	gR©edSourû
::
	$£tup_·ck‘
()

144 ià(
_·ck‘
)

145 
_·ck‘
->
	`kl
();

148 
h—droom
 = 16+20+24;

150 ià(
_d©asize
 < 0)

151 
_·ck‘
 = 
Pack‘
::
	`make
(
h—droom
, (*è
_d©a
.
	`d©a
(), _d©a.
	`Ëngth
(), 0);

152 ià(
_d©asize
 <ğ
_d©a
.
	`Ëngth
())

153 
_·ck‘
 = 
Pack‘
::
	`make
(
h—droom
, (*è
_d©a
.
	`d©a
(), 
_d©asize
, 0);

156 
SŒšgAccum
 
§
;

157 
§
.
	`Ëngth
(è< 
_d©asize
)

158 
§
 << 
_d©a
;

159 
_·ck‘
 = 
Pack‘
::
	`make
(
h—droom
, (*è
§
.
	`d©a
(), 
_d©asize
, 0);

161 
	}
}

163 
SŒšg


164 
	gR©edSourû
::
	$»ad_·¿m
(
EËm’t
 *
e
, *
v·¿m
)

166 
R©edSourû
 *
rs
 = (R©edSourû *)
e
;

167 (
šŒ_t
)
v·¿m
) {

169  
rs
->
_d©a
;

171  
	`SŒšg
(
rs
->
_tb
.
	`¿‹
());

173  (
rs
->
_lim™
 !ğ
NO_LIMIT
 ? 
	`SŒšg
(rs->_limit) : String("-1"));

177 
	}
}

180 
	gR©edSourû
::
	$chªge_·¿m
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *
v·¿m
,

181 
E¼ÜHªdËr
 *
”rh
)

183 
R©edSourû
 *
rs
 = (R©edSourû *)
e
;

184 (
šŒ_t
)
v·¿m
) {

187 
rs
->
_d©a
 = 
s
;

188 ià(
rs
->
_·ck‘
)

189 
rs
->
_·ck‘
->
	`kl
();

190 
rs
->
_·ck‘
 = 
Pack‘
::
	`make
Ôs->
_d©a
.
	`d©a
(),„s->_d©a.
	`Ëngth
());

194 
¿‹
;

195 ià(!
	`IÁArg
().
	`·r£
(
s
, 
¿‹
))

196  
”rh
->
	`”rÜ
("syntaxƒrror");

197 
rs
->
_tb
.
	`assign_adju¡
(
¿‹
,„ate < 200 ? 2 :„ate / 100);

202 
lim™
;

203 ià(!
	`IÁArg
().
	`·r£
(
s
, 
lim™
))

204  
”rh
->
	`”rÜ
("syntaxƒrror");

205 
rs
->
_lim™
 = (
lim™
 >ğ0 ? Öim™è: 
NO_LIMIT
);

210 
boŞ
 
aùive
;

211 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
aùive
))

212  
”rh
->
	`”rÜ
("syntaxƒrror");

213 
rs
->
_aùive
 = 
aùive
;

214 ià(
rs
->
	`ouut_is_push
(0è&& !rs->
_sk
.
	`scheduËd
(è&& 
aùive
) {

215 
rs
->
_tb
.
	`£t
(1);

216 
rs
->
_sk
.
	`»scheduË
();

222 
rs
->
_couÁ
 = 0;

223 
rs
->
_tb
.
	`£t
(1);

224 ià(
rs
->
	`ouut_is_push
(0è&& !rs->
_sk
.
	`scheduËd
(è&&„s->
_aùive
)

225 
rs
->
_sk
.
	`»scheduË
();

230 
d©asize
;

231 ià(!
	`IÁArg
().
	`·r£
(
s
, 
d©asize
))

232  
”rh
->
	`”rÜ
("syntaxƒrror");

233 
rs
->
_d©asize
 = 
d©asize
;

234 
rs
->
	`£tup_·ck‘
();

239 
	}
}

242 
	gR©edSourû
::
	$add_hªdËrs
()

244 
	`add_»ad_hªdËr
("d©a", 
»ad_·¿m
, 0, 
HªdËr
::
f_ÿlm
);

245 
	`add_wr™e_hªdËr
("d©a", 
chªge_·¿m
, 0, 
HªdËr
::
f_¿w
);

246 
	`add_»ad_hªdËr
("¿‹", 
»ad_·¿m
, 1);

247 
	`add_wr™e_hªdËr
("¿‹", 
chªge_·¿m
, 1);

248 
	`add_»ad_hªdËr
("lim™", 
»ad_·¿m
, 2, 
HªdËr
::
f_ÿlm
);

249 
	`add_wr™e_hªdËr
("lim™", 
chªge_·¿m
, 2);

250 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
f_»ad
 | HªdËr::
f_checkbox
, &
_aùive
);

251 
	`add_wr™e_hªdËr
("aùive", 
chªge_·¿m
, 3);

252 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
f_»ad
, &
_couÁ
);

253 
	`add_wr™e_hªdËr
("»£t", 
chªge_·¿m
, 5, 
HªdËr
::
f_bu‰Ú
);

254 
	`add_d©a_hªdËrs
("Ëngth", 
HªdËr
::
f_»ad
, &
_d©asize
);

255 
	`add_wr™e_hªdËr
("Ëngth", 
chªge_·¿m
, 6);

257 
	`add_d©a_hªdËrs
("d©asize", 
HªdËr
::
f_»ad
 | HªdËr::
f_d•»ÿ‹d
, &
_d©asize
);

258 
	`add_wr™e_hªdËr
("d©asize", 
chªge_·¿m
, 6);

260 ià(
	`ouut_is_push
(0))

261 
	`add_sk_hªdËrs
(&
_sk
);

262 
	}
}

264 
CLICK_ENDDECLS


265 
EXPORT_ELEMENT
(
R©edSourû
)

	@standard/ratedsource.hh

1 #iâdeà
CLICK_RATEDSOURCE_HH


2 
	#CLICK_RATEDSOURCE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tok’buck‘.hh
>

5 
	~<şick/sk.hh
>

6 
CLICK_DECLS


90 şas 
	cR©edSourû
 : 
public
 
EËm’t
 {…ublic:

92 
	$R©edSourû
(è
CLICK_COLD
;

94 cÚ¡ *
	$şass_Çme
() const {  "RatedSource"; }

95 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

96 
	$add_hªdËrs
(è
CLICK_COLD
;

98 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

99 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

100 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

102 
boŞ
 
	`run_sk
(
Task
 *
sk
);

103 
Pack‘
 *
	`puÎ
();

105 
´Ùeùed
:

107 cÚ¡ 
NO_LIMIT
 = 0xFFFFFFFFU;

109 
Tok’Buck‘
 
_tb
;

110 
_couÁ
;

111 
_lim™
;

112 
_d©asize
;

113 
boŞ
 
_aùive
;

114 
boŞ
 
_¡İ
;

115 
Pack‘
 *
_·ck‘
;

116 
Task
 
_sk
;

117 
Tim”
 
_tim”
;

118 
SŒšg
 
_d©a
;

120 
	`£tup_·ck‘
();

122 
SŒšg
 
	$»ad_·¿m
(
EËm’t
 *, *è
CLICK_COLD
;

123 
	`chªge_·¿m
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

125 
	}
};

127 
	gCLICK_ENDDECLS


	@standard/ratedsplitter.cc

20 
	~<şick/cÚfig.h
>

21 
	~"¿‹d¥l™‹r.hh
"

22 
	~<şick/glue.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~"¿‹dunqueue.hh
"

26 
CLICK_DECLS


28 
	gR©edS¶™‹r
::
	$R©edS¶™‹r
()

30 
	}
}

33 
R©edS¶™‹r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

35  
	gR©edUnqueue
::
cÚfigu»_h–³r
(&
_tb
, 
is_bªdwidth
(), 
this
, 
cÚf
, 
”rh
);

39 
	gR©edS¶™‹r
::
	$push
(, 
Pack‘
 *
p
)

41 
_tb
.
	`»fl
();

42 ià(
_tb
.
	`»move_if
(1))

43 
	`ouut
(0).
	`push
(
p
);

45 
	`checked_ouut_push
(1, 
p
);

46 
	}
}

51 
SŒšg


52 
	gR©edS¶™‹r
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *)

54 
R©edS¶™‹r
 *
rs
 = 
¡©ic_ÿ¡
<R©edS¶™‹¸*>(
e
);

55 ià(
rs
->
	`is_bªdwidth
())

56  
BªdwidthArg
::
	`uÅ¬£
(
rs
->
_tb
.
	`¿‹
());

58  
	`SŒšg
(
rs
->
_tb
.
	`¿‹
());

59 
	}
}

62 
	gR©edS¶™‹r
::
	$add_hªdËrs
()

64 
	`add_»ad_hªdËr
("¿‹", 
»ad_hªdËr
, 0);

65 
	`add_wr™e_hªdËr
("¿‹", 
»cÚfigu»_keywÜd_hªdËr
, "0 RATE");

66 
	`add_»ad_hªdËr
("cÚfig", 
»ad_hªdËr
, 0);

67 
	`£t_hªdËr_æags
("cÚfig", 0, 
HªdËr
::
CALM
);

68 
	}
}

70 
CLICK_ENDDECLS


71 
	$EXPORT_ELEMENT
(
R©edS¶™‹r
)

72 
	`ELEMENT_REQUIRES
(
R©edUnqueue
)

	@standard/ratedsplitter.hh

2 #iâdeà
CLICK_RATEDSPLITTER_HH


3 
	#CLICK_RATEDSPLITTER_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/tok’buck‘.hh
>

6 
CLICK_DECLS


65 şas 
	cR©edS¶™‹r
 : 
public
 
EËm’t
 {…ublic:

67 
	$R©edS¶™‹r
(è
CLICK_COLD
;

69 cÚ¡ *
	$şass_Çme
() const {  "RatedSplitter"; }

70 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

71 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

72 
boŞ
 
	$is_bªdwidth
(ècÚ¡ {  
	`şass_Çme
()[0] =ğ'B'; 
	}
}

74 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

75 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

76 
	$add_hªdËrs
(è
CLICK_COLD
;

78 
	`push
(
pÜt
, 
Pack‘
 *);

80 
´Ùeùed
:

82 
Tok’Buck‘
 
_tb
;

84 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

86 
	}
};

88 
	gCLICK_ENDDECLS


	@standard/ratedunqueue.cc

21 
	~<şick/cÚfig.h
>

22 
	~"¿‹dunqueue.hh
"

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

27 
CLICK_DECLS


29 
	gR©edUnqueue
::
	$R©edUnqueue
()

30 : 
	`_sk
(
this
), 
	`_tim”
(&
_sk
), 
	`_runs
(0), 
	`_pushes
(0), 
	`_çed_puÎs
(0), 
	`_em±y_runs
(0), 
	$_aùive
(
Œue
)

32 
	}
}

35 
	gR©edUnqueue
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37  
cÚfigu»_h–³r
(&
_tb
, 
is_bªdwidth
(), 
this
, 
cÚf
, 
”rh
);

41 
	gR©edUnqueue
::
cÚfigu»_h–³r
(
Tok’Buck‘
 *
tb
, 
boŞ
 
is_bªdwidth
, 
EËm’t
 *
–t
, 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

43 
	gr
;

44 
	gdur_m£c
 = 20;

45 
	gtok’s
;

46 
boŞ
 
	gdur_¥ecif›d
, 
	gtok’s_¥ecif›d
;

47 cÚ¡ *
	gbur¡_size
 = 
is_bªdwidth
 ? "BURST_BYTES" : "BURST_SIZE";

49 
Args
 
¬gs
(
cÚf
, 
–t
, 
”rh
);

50 ià(
	gis_bªdwidth
)

51 
	g¬gs
.
»ad_mp
("RATE", 
BªdwidthArg
(), 
r
);

53 
	g¬gs
.
»ad_mp
("RATE", 
r
);

54 ià(
	g¬gs
.
»ad
("BURST_DURATION", 
SecÚdsArg
(3), 
dur_m£c
).
»ad_¡©us
(
dur_¥ecif›d
)

55 .
»ad
(
bur¡_size
, 
tok’s
).
»ad_¡©us
(
tok’s_¥ecif›d
)

56 .
com¶‘e
() < 0)

59 ià(
	gdur_¥ecif›d
 && 
	gtok’s_¥ecif›d
)

60  
	g”rh
->
”rÜ
("cannot specify both BURST_DURATION‡nd BURST_SIZE");

61 ià(!
	gtok’s_¥ecif›d
) {

62 
	gbigšt
::
limb_ty³
 
»s
[2];

63 
	gbigšt
::
muÉly
(
»s
[1],„es[0], 
r
, 
dur_m£c
);

64 
	gbigšt
::
divide
(
»s
,„es, 2, 1000);

65 
	gtok’s
 = 
»s
[1] ? 
UINT_MAX
 :„es[0];

68 ià(
	gis_bªdwidth
) {

69 
	gÃw_tok’s
 = 
tok’s
 + 
tb_bªdwidth_th»sh
;

70 
	gtok’s
 = (
tok’s
 < 
Ãw_tok’s
 ?‚ew_tok’ : 
UINT_MAX
);

73 
	gtb
->
assign
(
r
, 
tok’s
 ?okens : 1);

78 
	gR©edUnqueue
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

80 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
”rh
);

81 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

82 
_tim”
.
	`š™Ÿlize
(
this
);

84 
	}
}

86 
boŞ


87 
	gR©edUnqueue
::
	$run_sk
(
Task
 *)

89 
boŞ
 
wÜked
 = 
çl£
;

90 
_runs
++;

91 ià(!
_aùive
)

92  
çl£
;

93 
_tb
.
	`»fl
();

94 ià(
_tb
.
	`cÚšs
(1)) {

95 ià(
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
()) {

96 
_tb
.
	`»move
(1);

97 
	`ouut
(0).
	`push
(
p
);

98 
_pushes
++;

99 
wÜked
 = 
Œue
;

101 
_çed_puÎs
++;

102 ià(!
_sigÇl
)

103  
çl£
;

106 
_tim”
.
	`scheduË_aá”
(
Time¡amp
::
	`make_jiff›s
(
_tb
.
	`time_uÁ_cÚšs
(1)));

107 
_em±y_runs
++;

108  
çl£
;

110 
_sk
.
	`ç¡_»scheduË
();

111 ià(!
wÜked
)

112 
_em±y_runs
++;

113  
wÜked
;

114 
	}
}

116 
SŒšg


117 
	gR©edUnqueue
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

119 
R©edUnqueue
 *
ru
 = (R©edUnqueu*)
e
;

120 (
ušŒ_t
è
thunk
) {

121 
h_¿‹
:

122 ià(
ru
->
	`is_bªdwidth
())

123  
BªdwidthArg
::
	`uÅ¬£
(
ru
->
_tb
.
	`¿‹
());

125  
	`SŒšg
(
ru
->
_tb
.
	`¿‹
());

126 
h_ÿÎs
: {

127 
SŒšgAccum
 
§
;

128 
§
 << 
ru
->
_runs
 << " callso„un_task()\n"

129 << 
ru
->
_em±y_runs
 << "ƒmpty„uns\n"

130 << 
ru
->
_pushes
 << "…ushes\n"

131 << 
ru
->
_çed_puÎs
 << " failed…ulls\n";

132  
§
.
	`ke_¡ršg
();

135  
	`SŒšg
();

136 
	}
}

139 
	gR©edUnqueue
::
	$add_hªdËrs
()

141 
	`add_»ad_hªdËr
("ÿÎs", 
»ad_hªdËr
, 
h_ÿÎs
);

142 
	`add_»ad_hªdËr
("¿‹", 
»ad_hªdËr
, 
h_¿‹
);

143 
	`add_wr™e_hªdËr
("¿‹", 
»cÚfigu»_keywÜd_hªdËr
, "0 RATE");

144 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
 | HªdËr::
CHECKBOX
, &
_aùive
);

145 
	`add_sk_hªdËrs
(&
_sk
);

146 
	`add_»ad_hªdËr
("cÚfig", 
»ad_hªdËr
, 
h_¿‹
);

147 
	`£t_hªdËr_æags
("cÚfig", 0, 
HªdËr
::
CALM
);

148 
	}
}

150 
CLICK_ENDDECLS


151 
	$EXPORT_ELEMENT
(
R©edUnqueue
)

152 
	`ELEMENT_MT_SAFE
(
R©edUnqueue
)

	@standard/ratedunqueue.hh

2 #iâdeà
CLICK_RATEDUNQUEUE_HH


3 
	#CLICK_RATEDUNQUEUE_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/tok’buck‘.hh
>

6 
	~<şick/sk.hh
>

7 
	~<şick/tim”.hh
>

8 
	~<şick/nÙif›r.hh
>

9 
CLICK_DECLS


45 şas 
	cR©edUnqueue
 : 
public
 
EËm’t
 {…ublic:

47 
	$R©edUnqueue
(è
CLICK_COLD
;

49 cÚ¡ *
	$şass_Çme
() const {  "RatedUnqueue"; }

50 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

51 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL_TO_PUSH
; 
	}
}

52 
boŞ
 
	$is_bªdwidth
(ècÚ¡ {  
	`şass_Çme
()[0] =ğ'B'; 
	}
}

54 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

55 
cÚfigu»_h–³r
(
Tok’Buck‘
 *
tb
, 
boŞ
 
is_bªdwidth
, 
EËm’t
 *
–t
, 
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
);

56 ’um { 
	gtb_bªdwidth_th»sh
 = 131072 };

58 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

59 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

60 
	$add_hªdËrs
(è
CLICK_COLD
;

62 
boŞ
 
	`run_sk
(
Task
 *);

64 
´Ùeùed
:

66 
Tok’Buck‘
 
_tb
;

67 
Task
 
_sk
;

68 
Tim”
 
_tim”
;

69 
NÙif›rSigÇl
 
_sigÇl
;

70 
ušt32_t
 
_runs
;

71 
ušt32_t
 
_pushes
;

72 
ušt32_t
 
_çed_puÎs
;

73 
ušt32_t
 
_em±y_runs
;

75 ’um { 
h_ÿÎs
, 
h_¿‹
 
	}
};

77 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
è
CLICK_COLD
;

79 
boŞ
 
_aùive
;

80 
	}
};

82 
	gCLICK_ENDDECLS


	@standard/resize.cc

6 
	~<şick/cÚfig.h
>

7 
	~"»size.hh
"

8 
	~<şick/¬gs.hh
>

9 
	~<şick/”rÜ.hh
>

10 
	~<şick/glue.hh
>

11 
CLICK_DECLS


13 
	gResize
::
	$Resize
()

15 
	}
}

19 
Resize
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

22 
	g_h—d
 = 0;

23 
	g_
 = 0;

24  
Args
(
cÚf
, 
this
, 
”rh
)

25 .
»ad_p
("HEAD", 
_h—d
)

26 .
»ad_p
("TAIL", 
_
)

27 .
com¶‘e
();

31 
šlše
 
ušt32_t
 
	$check_Ëngth
(
ušt32_t
 
amouÁ
, ušt32_ˆ
max
)

33 ià(
amouÁ
 > 
max
)  max;

34  
amouÁ
;

35 
	}
}

38 
Pack‘
 *

39 
	gResize
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

41 ià(
_h—d
 > 0) {

42 
p
 =…->
	`nÚunique_push
(
_h—d
);

43 ià(!
p
è 
NULL
;

45 ià(
_h—d
 < 0) {

46 
p
->
	`puÎ
(
	`check_Ëngth
(-
_h—d
,…->
	`Ëngth
()));

48 ià(
_
 > 0) {

49 
p
 =…->
	`nÚunique_put
(
_
);

50 ià(!
p
è 
NULL
;

52 ià(
_
 < 0) {

53 
p
->
	`ke
(
	`check_Ëngth
(-
_
,…->
	`Ëngth
()));

55  
p
;

56 
	}
}

60 
	gResize
::
	$add_hªdËrs
()

62 
	`add_d©a_hªdËrs
("h—d", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_h—d
);

63 
	`add_d©a_hªdËrs
("", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_
);

64 
	}
}

67 
CLICK_ENDDECLS


68 
	$EXPORT_ELEMENT
(
Resize
)

69 
	`ELEMENT_MT_SAFE
(
Resize
)

	@standard/resize.hh

2 #iâdeà
CLICK_RESIZE_HH


3 
	#CLICK_RESIZE_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


25 şas 
	cResize
 : 
public
 
EËm’t
 {

26 
public
:

27 
	$Resize
(è
CLICK_COLD
;

29 cÚ¡ *
	$şass_Çme
() const {  "Resize"; }

30 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

33 cÚ¡ *
	$æags
(ècÚ¡ {  "S0"; 
	}
}

35 
	$add_hªdËrs
(è
CLICK_COLD
;

36 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

37 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

39 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

41 
	g´iv©e
:

42 
_h—d
;

43 
	g_
;

47 
	gCLICK_ENDDECLS


	@standard/rrsched.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/”rÜ.hh
>

21 
	~"¼sched.hh
"

22 
CLICK_DECLS


24 
	gRRSched
::
	$RRSched
()

25 : 
	`_Ãxt
(0), 
	$_sigÇls
(0)

27 
	}
}

30 
	gRRSched
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

32 ià(!(
_sigÇls
 = 
Ãw
 
NÙif›rSigÇl
[
	`nšputs
()]))

33  
”rh
->
	`”rÜ
("out of memory!");

34 
i
 = 0; i < 
	`nšputs
(); i++)

35 
_sigÇls
[
i
] = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, i);

37 
	}
}

40 
	gRRSched
::
	$ş—nup
(
CËªupSge
)

42 
d–‘e
[] 
_sigÇls
;

43 
	}
}

45 
Pack‘
 *

46 
	gRRSched
::
	$puÎ
()

48 
n
 = 
	`nšputs
();

49 
i
 = 
_Ãxt
;

50 
j
 = 0; j < 
n
; j++) {

51 
Pack‘
 *
p
 = (
_sigÇls
[
i
] ? 
	`šput
(i).
	`puÎ
() : 0);

52 
i
++;

53 ià(
i
 >ğ
n
)

54 
i
 = 0;

55 ià(
p
) {

56 
_Ãxt
 = 
i
;

57  
p
;

61 
	}
}

63 
CLICK_ENDDECLS


64 
EXPORT_ELEMENT
(
RRSched
)

	@standard/rrsched.hh

2 #iâdeà
CLICK_RRSCHED_HH


3 
	#CLICK_RRSCHED_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/nÙif›r.hh
>

6 
CLICK_DECLS


28 şas 
	cRRSched
 : 
public
 
EËm’t
 {…ublic:

30 
	$RRSched
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "RoundRobinSched"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/1"; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

35 cÚ¡ *
	$æags
(ècÚ¡ {  "S0"; 
	}
}

37 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

38 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

40 
Pack‘
 *
	`puÎ
(
pÜt
);

42 
´iv©e
:

44 
_Ãxt
;

45 
NÙif›rSigÇl
 *
_sigÇls
;

47 
	}
};

49 
	gCLICK_ENDDECLS


	@standard/rrswitch.cc

18 
	~<şick/cÚfig.h
>

19 
	~"¼sw™ch.hh
"

20 
CLICK_DECLS


22 
	gRoundRobšSw™ch
::
	$RoundRobšSw™ch
()

24 
_Ãxt
 = 0;

25 
	}
}

28 
	gRoundRobšSw™ch
::
	$push
(, 
Pack‘
 *
p
)

30 
i
 = 
_Ãxt
;

31 #iâdeà
__MTCLICK__


32 
_Ãxt
++;

33 ià(
_Ãxt
 >ğ(
ušt32_t
)
	`nouuts
())

34 
_Ãxt
 = 0;

38 
Ãwv®
 = 
i
+1;

39 ià(
Ãwv®
 >ğ
	`nouuts
())

40 
Ãwv®
 = 0;

41 
_Ãxt
.
	`com·»_sw­
(
i
, 
Ãwv®
);

43 
	`ouut
(
i
).
	`push
(
p
);

44 
	}
}

46 
CLICK_ENDDECLS


47 
	$EXPORT_ELEMENT
(
RoundRobšSw™ch
)

48 
	`ELEMENT_MT_SAFE
(
RoundRobšSw™ch
)

	@standard/rrswitch.hh

1 #iâdeà
CLICK_RRSWITCH_HH


2 
	#CLICK_RRSWITCH_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/©omic.hh
>

5 
CLICK_DECLS


21 şas 
	cRoundRobšSw™ch
 : 
public
 
EËm’t
 {

23 
©omic_ušt32_t
 
_Ãxt
;

25 
	mpublic
:

27 
	$RoundRobšSw™ch
(è
CLICK_COLD
;

29 cÚ¡ *
	$şass_Çme
() const {  "RoundRobinSwitch"; }

30 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-"; 
	}
}

31 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

33 
push
(, 
Pack‘
 *);

37 
	gCLICK_ENDDECLS


	@standard/scheduleinfo.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

21 
	~<şick/Çmešfo.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/cÚå¬£.hh
>

24 
	~<şick/rou‹r.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/Çmešfo.hh
>

27 
CLICK_DECLS


29 
	gScheduËInfo
::
	$ScheduËInfo
()

31 #ià
HAVE_STRIDE_SCHED


32 
	`¡©ic_as£¹
((1 << 
FRAC_BITS
è=ğ
Task
::
DEFAULT_TICKETS
, "Stride scheduler constant issue.");

34 
	}
}

37 
	gScheduËInfo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39 
NameDB
* 
	gdb
 = 
NameInfo
::
g‘db
(NameInfo::
T_SCHEDULEINFO
, 
this
, 4, 
Œue
);

42 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

43 
	gVeùÜ
<
	gSŒšg
> 
	g·¹s
;

44 
ušt32_t
 
	gmt
;

45 
ı_¥aûvec
(
cÚf
[
i
], 
·¹s
);

46 ià(
	g·¹s
.
size
() == 0)

48 ià(
	g·¹s
.
size
(è!ğ2 || !
FixedPoštArg
(
FRAC_BITS
).
·r£
(
·¹s
[1], 
mt
))

49 
	g”rh
->
”rÜ
("expected %<ELEMENTNAME PARAM%>");

51 
	gdb
->
defše
(
·¹s
[0], &
mt
, 4);

58 
	gScheduËInfo
::
	$qu”y
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *
”rh
)

60 #ià
HAVE_STRIDE_SCHED


62 
SŒšg
 
id
 = 
e
->
	`Çme
();

64 
VeùÜ
<
SŒšg
> 
´efixes
;

65 
´efixes
.
	`push_back
(
	`SŒšg
());

66 cÚ¡ *
¦ash
 = 
id
.
	`begš
();

67 (
¦ash
 = 
	`fšd
(¦ash, 
id
.
	`’d
(), '/')) < id.end()) {

68 
´efixes
.
	`push_back
(
id
.
	`sub¡ršg
(id.
	`begš
(), 
¦ash
 + 1));

69 
¦ash
++;

71 
´efixes
.
	`push_back
(
id
);

73 
VeùÜ
<
ušt32_t
> 
	`tick‘s
(
´efixes
.
	`size
(), 
Task
::
DEFAULT_TICKETS
);

75 
NameDB
 *
db
 = 
NameInfo
::
	`g‘db
(NameInfo::
T_SCHEDULEINFO
, 
e
, 4, 
çl£
);

76 
db
) {

77 
boŞ
 
äobbed
 = 
çl£
;

78 
i
 = 
´efixes
.
	`size
() - 1;

79 
i
 >ğ0 && 
´efixes
[i].
	`Ëngth
(è>ğ
db
->
	`cÚ‹xt
().length();

80 
i
--)

81 ià(
db
->
	`qu”y
(
´efixes
[
i
].
	`sub¡ršg
(db->
	`cÚ‹xt
().
	`Ëngth
()), &
tick‘s
[i], 4))

82 
äobbed
 = 
Œue
;

83 ià(
äobbed
)

84 
tick‘s
[
i
] = 
Task
::
DEFAULT_TICKETS
;

85 
db
 = db->
	`cÚ‹xt_·»Á
();

89 
tick‘s_out
 = 
tick‘s
[0];

90 
i
 = 1; i < 
tick‘s
.
	`size
(); i++)

91 ià(
tick‘s
[
i
] !ğ
Task
::
DEFAULT_TICKETS
)

92 #ifdeà
HAVE_INT64_TYPES


93 
tick‘s_out
 = ((
št64_t
ètick‘s_ouˆ* 
tick‘s
[
i
]è>> 
FRAC_BITS
;

95 
tick‘s_out
 = (tick‘s_ouˆ* 
tick‘s
[
i
]è>> 
FRAC_BITS
;

99 ià(
tick‘s_out
 > 
Task
::
MAX_TICKETS
) {

100 
tick‘s_out
 = 
Task
::
MAX_TICKETS
;

101 
SŒšg
 
m
 = 
	`ı_uÅ¬£_»®2
(
tick‘s_out
, 
FRAC_BITS
);

102 
”rh
->
	`w¬nšg
("ScheduËInfØtoØhigh;„eduûdØ%s", 
m
.
	`c_¡r
());

106  
tick‘s_out
;

108 (è
e
, (è
”rh
;

111 
	}
}

114 
	gScheduËInfo
::
	$š™Ÿlize_sk
(
EËm’t
 *
e
, 
Task
 *
sk
, 
boŞ
 
scheduË
,

115 
E¼ÜHªdËr
 *
”rh
)

117 #ià
HAVE_STRIDE_SCHED


118 
tick‘s
 = 
	`qu”y
(
e
, 
”rh
);

119 ià(
tick‘s
 > 0) {

120 
sk
->
	`š™Ÿlize
(
e
, 
scheduË
);

121 
sk
->
	`£t_tick‘s
(
tick‘s
);

124 (è
”rh
;

125 
sk
->
	`š™Ÿlize
(
e
, 
scheduË
);

127 
	}
}

129 
CLICK_ENDDECLS


130 
	$EXPORT_ELEMENT
(
ScheduËInfo
)

131 
	`ELEMENT_HEADER
(<
şick
/
¡ªd¬d
/
scheduËšfo
.
hh
>)

	@standard/script.cc

23 
	~<şick/cÚfig.h
>

24 
	~"süt.hh
"

25 
	~<şick/cÚå¬£.hh
>

26 
	~<şick/”rÜ.hh
>

27 
	~<şick/rou‹r.hh
>

28 
	~<şick/¡¿ccum.hh
>

29 
	~<şick/hªdËrÿÎ.hh
>

30 
	~<şick/Çmešfo.hh
>

31 #ià
CLICK_USERLEVEL


32 
	~<sigÇl.h
>

33 
	~<şick/ma¡”.hh
>

34 
	~<şick/u£ruts.hh
>

36 
CLICK_DECLS


38 cÚ¡ 
	gSticNameDB
::
EÁry
 
š¡ruùiÚ_’Œ›s
[] = {

39 #ià
CLICK_USERLEVEL


40 { "­³nd", 
Süt
::
š¢_­³nd
 },

42 { "’d", (
ušt32_t
è
Süt
::
š¢_’d
 },

43 { "”rÜ", (
ušt32_t
è
Süt
::
š¢_”rÜ
 },

44 { "”rÜq", (
ušt32_t
è
Süt
::
š¢_”rÜq
 },

45 { "ex™", (
ušt32_t
è
Süt
::
š¢_ex™
 },

46 { "expÜt", 
Süt
::
š¢_expÜt
 },

47 { "expÜtq", 
Süt
::
š¢_expÜtq
 },

48 { "gÙo", 
Süt
::
INSN_GOTO
 },

49 { "š™", 
Süt
::
š¢_š™
 },

50 { "š™q", 
Süt
::
š¢_š™q
 },

51 { "Ïb–", 
Süt
::
INSN_LABEL
 },

52 { "loİ", 
Süt
::
INSN_LOOP_PSEUDO
 },

53 { "·u£", 
Süt
::
INSN_WAIT_STEP
 },

54 { "´št", 
Süt
::
INSN_PRINT
 },

55 { "´šŠ", 
Süt
::
INSN_PRINTN
 },

56 { "´šŠq", 
Süt
::
INSN_PRINTNQ
 },

57 { "´štq", 
Süt
::
INSN_PRINTQ
 },

58 { "»ad", 
Süt
::
INSN_READ
 },

59 { "»adq", 
Süt
::
INSN_READQ
 },

60 { "»tuº", 
Süt
::
INSN_RETURN
 },

61 { "»tuºq", 
Süt
::
š¢_»tuºq
 },

62 #ià
CLICK_USERLEVEL


63 { "§ve", 
Süt
::
š¢_§ve
 },

65 { "£t", 
Süt
::
INSN_SET
 },

66 { "£tq", 
Süt
::
š¢_£tq
 },

67 { "¡İ", (
ušt32_t
è
Süt
::
š¢_¡İ
 },

68 { "wa™", 
Süt
::
INSN_WAIT_PSEUDO
 },

69 { "wa™_fÜ", 
Süt
::
INSN_WAIT_TIME
 },

70 { "wa™_¡•", 
Süt
::
INSN_WAIT_STEP
 },

71 { "wa™_¡İ", 
Süt
::
INSN_WAIT_STEP
 },

72 { "wa™_time", 
Süt
::
INSN_WAIT_TIME
 },

73 { "wr™e", 
Süt
::
INSN_WRITE
 },

74 { "wr™eq", 
Süt
::
INSN_WRITEQ
 }

77 #ià
CLICK_USERLEVEL


78 cÚ¡ 
	gSticNameDB
::
EÁry
 
sigÇl_’Œ›s
[] = {

79 { "ABRT", 
SIGABRT
 },

80 { "ALRM", 
SIGALRM
 },

81 { "HUP", 
SIGHUP
 },

82 { "INT", 
SIGINT
 },

83 #ifdeà
SIGIO


84 { "IO", 
SIGIO
 },

86 { "PIPE", 
SIGPIPE
 },

87 { "QUIT", 
SIGQUIT
 },

88 { "TERM", 
SIGTERM
 },

89 { "TSTP", 
SIGTSTP
 },

90 { "USR1", 
SIGUSR1
 },

91 { "USR2", 
SIGUSR2
 }

95 
NameDB
 *
	gdbs
[2];

98 
	gSüt
::
	$¡©ic_š™Ÿlize
()

100 
dbs
[0] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_SCRIPT_INSN
, 
	`SŒšg
(), 
š¡ruùiÚ_’Œ›s
, (instruction_entries) / (instruction_entries[0]));

101 
NameInfo
::
	`š¡®ldb
(
dbs
[0], 0);

102 #ià
CLICK_USERLEVEL


103 
dbs
[1] = 
Ãw
 
	`SticNameDB
(
NameInfo
::
T_SIGNO
, 
	`SŒšg
(), 
sigÇl_’Œ›s
, (signal_entries) / (signal_entries[0]));

104 
NameInfo
::
	`š¡®ldb
(
dbs
[1], 0);

106 
	}
}

109 
	gSüt
::
	$¡©ic_ş—nup
()

111 
d–‘e
 
dbs
[0];

112 #ià
CLICK_USERLEVEL


113 
d–‘e
 
dbs
[1];

115 
	}
}

117 
	gSüt
::
	$Süt
()

118 : 
	`_ty³
(-1), 
	`_wr™e_¡©us
(0), 
	`_tim”
(
this
), 
	$_cur_¡•s
(0)

120 
	}
}

123 
	gSüt
::
	$add_š¢
(
š¢
, 
¬g
, 
¬g2
, cÚ¡ 
SŒšg
 &
¬g3
)

127 ià(
_š¢s
.
	`size
(è=ğ0 && 
š¢
 !ğ
INSN_INITIAL
 && in¢ !ğ
INSN_WAIT_STEP


128 && 
š¢
 !ğ
INSN_WAIT_TIME
)

129 
	`add_š¢
(
INSN_INITIAL
, 0);

130 
_š¢s
.
	`push_back
(
š¢
);

131 
_¬gs
.
	`push_back
(
¬g
);

132 
_¬gs2
.
	`push_back
(
¬g2
);

133 
_¬gs3
.
	`push_back
(
¬g3
);

134 
	}
}

137 
	gSüt
::
	$fšd_Ïb–
(cÚ¡ 
SŒšg
 &
Ïb–
) const

139 
i
 = 0; i < 
_š¢s
.
	`size
(); i++)

140 ià(
_š¢s
[
i
] =ğ
INSN_LABEL
 && 
_¬gs3
[i] =ğ
Ïb–
)

141  
i
;

142 
št32_t
 
š¢
;

143 ià(
NameInfo
::
	`qu”y_št
(NameInfo::
T_SCRIPT_INSN
, 
this
, 
Ïb–
, &
š¢
)

144 && 
š¢
 < 0)

145  
š¢
;

146 ià(
Ïb–
.
	`equ®s
("begin", 5) ||†abel.equals("loop", 4))

148  
_š¢s
.
	`size
();

149 
	}
}

152 
	gSüt
::
	$fšd_v¬ŸbË
(cÚ¡ 
SŒšg
 &
Çme
, 
boŞ
 
add
)

154 
i
;

155 
i
 = 0; i < 
_v¬s
.
	`size
(); i += 2)

156 ià(
_v¬s
[
i
] =ğ
Çme
)

157 
found
;

158 ià(
add
) {

159 
_v¬s
.
	`push_back
(
Çme
);

160 
_v¬s
.
	`push_back
(
	`SŒšg
());

162 
found
:

163  
i
;

164 
	}
}

167 
	gSüt
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

169 
SŒšg
 
	gty³_¬g
;

170 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

171 .
»ad
("TYPE", 
AnyArg
(), 
ty³_¬g
)

172 .
cÚsume
() < 0)

175 
SŒšg
 
	gty³_wÜd
 = 
ı_shiá_¥aûvec
(
ty³_¬g
);

176 ià(
	gty³_wÜd
 =ğ"ACTIVE" && !
ty³_¬g
)

177 
_ty³
 = 
ty³_aùive
;

178 ià(
	gty³_wÜd
 =ğ"PASSIVE" && !
ty³_¬g
)

179 
_ty³
 = 
ty³_·ssive
;

180 ià((
	gty³_wÜd
 =ğ"PACKET" || 
ty³_wÜd
 =ğ"PUSH"è&& !
ty³_¬g
)

181 
_ty³
 = 
ty³_push
;

182 ià(
	gty³_wÜd
 =ğ"PROXY" && !
ty³_¬g
)

183 
_ty³
 = 
ty³_´oxy
;

184 ià(
	gty³_wÜd
 =ğ"DRIVER" && !
ty³_¬g
)

185 
_ty³
 = 
ty³_driv”
;

186 #ià
CLICK_USERLEVEL


187 ià(
	gty³_wÜd
 == "SIGNAL") {

188 
_ty³
 = 
ty³_sigÇl
;

189 
št32_t
 
	gsigno
;

190 (
	gty³_wÜd
 = 
ı_shiá_¥aûvec
(
ty³_¬g
))

191 && 
NameInfo
::
qu”y_št
(NameInfo::
T_SIGNO
, 
this
, 
ty³_wÜd
, &
signo
)

192 && 
	gsigno
 >ğ0 && 
signo
 < 32)

193 
_signos
.
push_back
(
signo
);

194 ià(
	gty³_wÜd
 || !
	g_signos
.
size
())

195  
	g”rh
->
”rÜ
("bad signal‚umber");

198 ià(
	gty³_wÜd
)

199  
	g”rh
->
”rÜ
("bad TYPE");

200 ià(
	g_ty³
 < 0)

201 
	g_ty³
 = (
nšputs
(è|| 
nouuts
(è? 
ty³_push
 : 
ty³_aùive
);

203 ià(
	g_ty³
 =ğ
ty³_driv”
) {

204 ià(
rou‹r
()->
©chm’t
("Script"))

205  
”rh
->
”rÜ
("router has morehan one driver script");

206 
rou‹r
()->
£t_©chm’t
("Süt", 
this
);

209 ià(
	g_ty³
 =ğ
ty³_push
 && 
nšputs
() == 0)

210  
”rh
->
”rÜ
("PACKET script must have inputs");

211 ià(
	g_ty³
 !ğ
ty³_push
 && (
nšputs
(è|| 
nouuts
()))

212  
”rh
->
”rÜ
("ports‡llowed only on PACKET scripts");

214 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

215 
SŒšg
 
	gš¢_Çme
 = 
ı_shiá_¥aûvec
(
cÚf
[
i
]);

216 
št32_t
 
	gš¢
;

217 ià(!
	gš¢_Çme
)

219 ià(!
	gNameInfo
::
qu”y_št
(
NameInfo
::
T_SCRIPT_INSN
, 
this
, 
š¢_Çme
, &
š¢
)) {

220 
	g”rh
->
”rÜ
("syÁaxƒ¼Ü‡ˆ%<%s%>", 
š¢_Çme
.
c_¡r
());

224 
	gš¢
) {

226 
	gINSN_WAIT_PSEUDO
:

227 ià(!
cÚf
[
i
])

228 
wa™_¡•
;

230 
	gwa™_time
;

232 
	gwa™_¡•
:

233 
INSN_WAIT_STEP
: {

234 
n
 = 1;

235 ià(!
	gcÚf
[
i
] || 
IÁArg
().
·r£
(
cÚf
[i], 
n
))

236 
add_š¢
(
INSN_WAIT_STEP
, 
n
, 0);

238 
	gsyÁax_”rÜ
;

242 
	gINSN_WRITE
:

243 
INSN_WRITEQ
:

244 
INSN_READ
:

245 
INSN_READQ
:

246 
INSN_PRINT
:

247 
INSN_PRINTQ
:

248 
INSN_PRINTN
:

249 
INSN_PRINTNQ
:

250 #ià
CLICK_USERLEVEL


251 
š¢_§ve
:

252 
š¢_­³nd
:

254 
INSN_GOTO
:

255 
add_š¢
(
š¢
, 0, 0, 
cÚf
[
i
]);

258 
	gINSN_RETURN
:

259 
š¢_»tuºq
:

260 
cÚf
[
i
] = "_ " + conf[i];

262 
	gš¢_š™
:

263 
š¢_š™q
:

264 
š¢_expÜt
:

265 
š¢_expÜtq
:

266 
INSN_SET
:

267 
š¢_£tq
: {

268 
SŒšg
 
wÜd
 = 
ı_shiá_¥aûvec
(
cÚf
[
i
]);

269 ià(!
	gwÜd


270 || ((
	gš¢
 =ğ
INSN_SET
 || 
š¢
 =ğ
š¢_£tq
è&& !
cÚf
[
i
]))

271 
syÁax_”rÜ
;

272 
add_š¢
(
š¢
, 
fšd_v¬ŸbË
(
wÜd
, 
Œue
), 0, 
cÚf
[
i
]);

276 
	gwa™_time
:

277 
INSN_WAIT_TIME
:

278 
add_š¢
(
INSN_WAIT_TIME
, 0, 0, 
cÚf
[
i
]);

281 
	gINSN_LABEL
: {

282 
SŒšg
 
wÜd
 = 
ı_shiá_¥aûvec
(
cÚf
[
i
]);

283 ià(!
	gwÜd
 || 
	gcÚf
[
i
])

284 
	gsyÁax_”rÜ
;

285 
add_š¢
(
š¢
, 0, 0, 
wÜd
);

289 
	gINSN_LOOP_PSEUDO
:

290 
š¢
 = 
INSN_GOTO
;

292 
	gš¢_’d
:

293 
š¢_ex™
:

294 
š¢_¡İ
:

295 
š¢_”rÜ
:

296 
š¢_”rÜq
:

297 ià(
cÚf
[
i
] && 
š¢
 !ğ
š¢_”rÜ
 && in¢ !ğ
š¢_”rÜq
)

298 
syÁax_”rÜ
;

299 
add_š¢
(
š¢
, 0, 0, 
cÚf
[
i
]);

303 
syÁax_”rÜ
:

304 
”rh
->
”rÜ
("syÁaxƒ¼Ü‡ˆ%<%s%>", 
š¢_Çme
.
c_¡r
());

311 
	gi
 = 0; i < 
	g_š¢s
.
size
(); i++)

312 ià(
	g_š¢s
[
i
] =ğ
INSN_GOTO
 && 
_¬gs3
[i]) {

313 
SŒšg
 
wÜd
 = 
ı_shiá_¥aûvec
(
_¬gs3
[
i
]);

314 ià((
	g_¬gs
[
i
] = 
fšd_Ïb–
(
wÜd
)è>ğ
_š¢s
.
size
())

315 
”rh
->
”rÜ
("nØsuch†ab– %<%s%>", 
wÜd
.
c_¡r
());

318 ià(
	g_š¢s
.
size
(è=ğ0 && 
_ty³
 =ğ
ty³_driv”
)

319 
add_š¢
(
INSN_WAIT_STEP
, 1, 0);

320 
add_š¢
(
_ty³
 =ğ
ty³_driv”
 ? 
š¢_¡İ
 : 
š¢_’d
, 0);

322  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

326 
	gSüt
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

328 
_š¢_pos
 = 0;

329 
_¡•_couÁ
 = 0;

330 
_tim”
.
	`š™Ÿlize
(
this
);

332 
Ex·nd”
 
ex·nd”
;

333 
ex·nd”
.
süt
 = 
this
;

334 
ex·nd”
.
”rh
 =ƒrrh;

335 
i
 = 0; i < 
_š¢s
.
	`size
(); i++)

336 ià(
_š¢s
[
i
] =ğ
š¢_š™
 || _š¢s[i] =ğ
š¢_expÜt
)

337 
_v¬s
[
_¬gs
[
i
] + 1] = 
	`ı_ex·nd
(
_¬gs3
[i], 
ex·nd”
);

338 ià(
_š¢s
[
i
] =ğ
š¢_š™q
 || _š¢s[i] =ğ
š¢_expÜtq
)

339 
_v¬s
[
_¬gs
[
i
] + 1] = 
	`ı_unquÙe
(
	`ı_ex·nd
(
_¬gs3
[i], 
ex·nd”
));

341 
š¢
 = 
_š¢s
[
_š¢_pos
];

342 
	`as£¹
(
š¢
 =ğ
INSN_INITIAL
 || in¢ =ğ
INSN_WAIT_STEP
 || 
INSN_WAIT_TIME
);

343 ià(
_ty³
 =ğ
ty³_sigÇl
 || _ty³ =ğ
ty³_·ssive
 || _ty³ =ğ
ty³_push


344 || 
_ty³
 =ğ
ty³_´oxy
)

346 ià(
š¢
 =ğ
INSN_WAIT_TIME
) {

347 
Time¡amp
 
ts
;

348 ià(
	`ı_time
(
	`ı_ex·nd
(
_¬gs3
[
_š¢_pos
], 
ex·nd”
), &
ts
))

349 
_tim”
.
	`scheduË_aá”
(
ts
);

351 
”rh
->
	`”rÜ
("syntaxƒrror‡t %<wait%>");

352 } ià(
š¢
 =ğ
INSN_INITIAL
) {

354 ià(
_ty³
 =ğ
ty³_driv”
)

355 
	`rou‹r
()->
	`adju¡_runcouÁ
(-1);

357 
_tim”
.
	`scheduË_now
();

358 
_¬gs
[0] = 1;

361 #ià
CLICK_USERLEVEL


362 ià(
_ty³
 =ğ
ty³_sigÇl
)

363 
i
 = 0; i < 
_signos
.
	`size
(); i++)

364 
	`ma¡”
()->
	`add_sigÇl_hªdËr
(
_signos
[
i
], 
	`rou‹r
(), 
	`Çme
() + ".run");

368 
	}
}

371 
	gSüt
::
	$¡•
(
n¡•s
, 
¡•_ty³
, 
njumps
, 
E¼ÜHªdËr
 *
”rh
)

373 
Ex·nd”
 
ex·nd”
;

374 
ex·nd”
.
süt
 = 
this
;

375 
ex·nd”
.
”rh
 =ƒrrh;

377 
n¡•s
 +ğ
_¡•_couÁ
;

378 (
n¡•s
 - 
_¡•_couÁ
è>ğ0 && 
_š¢_pos
 < 
_š¢s
.
	`size
()

379 && 
njumps
 < 
max_jumps
) {

384 
os
 = 
_š¢_pos
++;

385 
š¢
 = 
_š¢s
[
os
];

387 
š¢
) {

389 
š¢_¡İ
:

390 
_¡•_couÁ
++;

391 
_š¢_pos
--;

392 ià(
¡•_ty³
 !ğ
STEP_ROUTER
)

393 
	`rou‹r
()->
	`adju¡_runcouÁ
(-1);

394  
njumps
 + 1;

396 
INSN_WAIT_STEP
:

397 
_¡•_couÁ
 < 
n¡•s
 && 
_¬gs2
[
os
] < 
_¬gs
[ipos]) {

398 
_¬gs2
[
os
]++;

399 
_¡•_couÁ
++;

401 ià(
_¡•_couÁ
 =ğ
n¡•s
 && 
_¬gs2
[
os
] < 
_¬gs
[ipos]) {

402 
_š¢_pos
--;

403 
dÚe
;

407 
INSN_WAIT_TIME
:

408 ià(
_¡•_couÁ
 =ğ
n¡•s
) {

409 
Time¡amp
 
ts
;

410 ià(
	`ı_time
(
	`ı_ex·nd
(
_¬gs3
[
os
], 
ex·nd”
), &
ts
)) {

411 
_tim”
.
	`scheduË_aá”
(
ts
);

412 
_š¢_pos
--;

414 
”rh
->
	`”rÜ
("syntaxƒrror‡t %<wait%>");

415 
dÚe
;

417 
_¡•_couÁ
++;

418 
_tim”
.
	`unscheduË
();

421 
INSN_INITIAL
:

422 ià(
_¬gs
[
os
]) {

423 
_¡•_couÁ
++;

424 
_¬gs
[
os
] = 0;

428 #ià
CLICK_USERLEVEL


429 
š¢_§ve
:

430 
š¢_­³nd
: {

431 
SŒšg
 
wÜd
 = 
	`ı_shiá_¥aûvec
(
_¬gs3
[
os
]);

432 
SŒšg
 
fe
 = (
_¬gs3
[
os
] ? _args3[ipos] : "-");

433 
_¬gs3
[
os
] = (&">>"[
š¢
 =ğ
š¢_§ve
]è+ 
fe
 + " " + 
wÜd
;

437 
INSN_PRINT
:

438 
INSN_PRINTQ
:

439 
INSN_PRINTN
:

440 
INSN_PRINTNQ
: {

441 
SŒšg
 
‹xt
 = 
_¬gs3
[
os
];

443 #ià
CLICK_USERLEVEL


444 
FILE
 *
f
 = 
¡dout
;

445 ià(
‹xt
.
	`Ëngth
() &&ext[0] == '>') {

446 
boŞ
 
­³nd
 = (
‹xt
.
	`Ëngth
() > 1 &&ext[1] == '>');

447 
‹xt
 =ext.
	`sub¡ršg
(1 + 
­³nd
);

448 
SŒšg
 
f’ame
 = 
	`ı_shiá_¥aûvec
(
‹xt
);

449 ià(
f’ame
 && filename != "-"

450 && !(
f
 = 
	`fİ’
(
f’ame
.
	`c_¡r
(), 
­³nd
 ? "ab" : "wb"))) {

451 
”rh
->
	`”rÜ
("%s: %s", 
f’ame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

456 ià(
‹xt
.
	`Ëngth
() &&ext[0] == '>') {

457 
”rh
->
	`”rÜ
("file„edirection‚ot supported here");

458 (è
	`ı_shiá_¥aûvec
(
‹xt
);

462 
befÜe
 = 
”rh
->
	`Ã¼Üs
();

463 
SŒšg
 
»suÉ
;

464 ià(
‹xt
 && (
	`i§Íha
(()ext[0]) ||ext[0] == '@' ||ext[0] == '_')) {

465 
HªdËrC®l
 
	`hc
(
	`ı_ex·nd
(
‹xt
, 
ex·nd”
));

466 
æags
 = 
HªdËrC®l
::
f_»ad
 + ((
š¢
 =ğ
INSN_PRINTQ
 || in¢ =ğ
INSN_PRINTNQ
è? HªdËrC®l::
UNQUOTE_PARAM
 : 0);

467 ià(
hc
.
	`š™Ÿlize
(
æags
, 
this
, 
”rh
) >= 0) {

468 
CÚ‹xtE¼ÜHªdËr
 
	`c_”rh
(
”rh
, "WhÿÎšg %<%s%>:", 
hc
.
	`uÅ¬£
().
	`c_¡r
());

469 
»suÉ
 = 
hc
.
	`ÿÎ_»ad
(&
c_”rh
);

472 
»suÉ
 = 
	`ı_unquÙe
(
	`ı_ex·nd
(
‹xt
, 
ex·nd”
, 
Œue
));

473 ià(
”rh
->
	`Ã¼Üs
(è=ğ
befÜe


474 && (!
»suÉ
 ||„esuÉ.
	`back
() != '\n')

475 && 
š¢
 !ğ
INSN_PRINTN


476 && 
š¢
 !ğ
INSN_PRINTNQ
)

477 
»suÉ
 += "\n";

479 #ià
CLICK_USERLEVEL


480 
	`ignÜe_»suÉ
(
	`fwr™e
(
»suÉ
.
	`d©a
(), 1,„esuÉ.
	`Ëngth
(), 
f
));

481 ià(
f
 =ğ
¡dout
)

482 
	`fæush
(
f
);

484 
	`fşo£
(
f
);

486 
	`şick_ch©‹r
("{}%.*s", 
»suÉ
.
	`Ëngth
(),„esuÉ.
	`d©a
());

491 
INSN_READ
:

492 
INSN_READQ
: {

493 
HªdËrC®l
 
	`hc
(
	`ı_ex·nd
(
_¬gs3
[
os
], 
ex·nd”
));

494 
æags
 = 
HªdËrC®l
::
f_»ad
 + (
š¢
 =ğ
INSN_READQ
 ? HªdËrC®l::
UNQUOTE_PARAM
 : 0);

495 ià(
hc
.
	`š™Ÿlize
(
æags
, 
this
, 
”rh
) >= 0) {

496 
CÚ‹xtE¼ÜHªdËr
 
	`c_”rh
(
”rh
, "WhÿÎšg %<%s%>:", 
hc
.
	`uÅ¬£
().
	`c_¡r
());

497 
SŒšg
 
»suÉ
 = 
hc
.
	`ÿÎ_»ad
(&
c_”rh
);

498 
E¼ÜHªdËr
 *
d_”rh
 = E¼ÜHªdËr::
	`deçuÉ_hªdËr
();

499 
d_”rh
->
	`mes§ge
("%s:\n%.*s\n", 
hc
.
	`hªdËr
()->
	`uÅ¬£_Çme
(hc.
	`–em’t
()).
	`c_¡r
(), 
»suÉ
.
	`Ëngth
(),„esuÉ.
	`d©a
());

504 
INSN_WRITE
:

505 
INSN_WRITEQ
: {

506 
HªdËrC®l
 
	`hc
(
	`ı_ex·nd
(
_¬gs3
[
os
], 
ex·nd”
));

507 
æags
 = 
HªdËrC®l
::
f_wr™e
 + (
š¢
 =ğ
INSN_WRITEQ
 ? HªdËrC®l::
UNQUOTE_PARAM
 : 0);

508 ià(
hc
.
	`š™Ÿlize
(
æags
, 
this
, 
”rh
) >= 0) {

509 
CÚ‹xtE¼ÜHªdËr
 
	`c_”rh
(
”rh
, "WhÿÎšg %<%s%>:", 
hc
.
	`uÅ¬£
().
	`c_¡r
());

510 
_wr™e_¡©us
 = 
hc
.
	`ÿÎ_wr™e
(&
c_”rh
);

515 
INSN_RETURN
:

516 
š¢_»tuºq
:

517 
INSN_SET
:

518 
š¢_£tq
: {

519 
ex·nd”
.
”rh
 =ƒrrh;

520 
_v¬s
[
_¬gs
[
os
] + 1] = 
	`ı_ex·nd
(
_¬gs3
[os], 
ex·nd”
);

521 ià(
š¢
 =ğ
š¢_£tq
 || in¢ =ğ
š¢_»tuºq
)

522 
_v¬s
[
_¬gs
[
os
] + 1] = 
	`ı_unquÙe
(_vars[_args[ipos] + 1]);

523 ià((
š¢
 =ğ
INSN_RETURN
 || in¢ =ğ
š¢_»tuºq
)

524 && 
_š¢_pos
 =ğ
os
 + 1) {

525 
_š¢_pos
--;

526 
dÚe
;

531 
INSN_GOTO
: {

533 
SŒšg
 
cÚd_‹xt
 = 
	`ı_ex·nd
(
_¬gs3
[
os
], 
ex·nd”
);

534 
boŞ
 
cÚd
;

535 ià(
cÚd_‹xt
 && !
	`BoŞArg
().
	`·r£
(cÚd_‹xt, 
cÚd
))

536 
”rh
->
	`”rÜ
("bad cÚd™iÚ %<%s%>", 
cÚd_‹xt
.
	`c_¡r
());

537 ià(!
cÚd_‹xt
 || 
cÚd
) {

538 ià(
_¬gs
[
os
] < 0)

539 
š¢_fšish
;

540 
i
 = 
_¬gs
[
os
]; i < ipos; i++)

541 ià(
_š¢s
[
i
] =ğ
INSN_WAIT_STEP
)

542 
_¬gs2
[
i
] = 0;

543 
_š¢_pos
 = 
_¬gs
[
os
];

548 
š¢_”rÜ
:

549 
š¢_”rÜq
: {

550 
SŒšg
 
msg
 = 
	`ı_ex·nd
(
_¬gs3
[
os
], 
ex·nd”
);

551 ià(
š¢
 =ğ
š¢_”rÜq
)

552 
msg
 = 
	`ı_unquÙe
(msg);

553 ià(
msg
)

554 
”rh
->
	`”rÜ
("%.*s", 
msg
.
	`Ëngth
(), msg.
	`d©a
());

557 
š¢_’d
:

558 
š¢_ex™
:

559 
š¢_fšish
:

560 
_š¢_pos
--;

561  
njumps
 + 1;

565 ià(
_š¢_pos
 !ğ
os
 + 1)

566 
njumps
++;

569 
dÚe
:

570 ià(
njumps
 >ğ
max_jumps
) {

571 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
()->
	`”rÜ
("%p{–em’t}:oØmªy jumps, givšg up", 
this
);

572 
_š¢_pos
 = 
_š¢s
.
	`size
();

573 
_tim”
.
	`unscheduË
();

575 ià(
¡•_ty³
 =ğ
STEP_ROUTER
)

576 
	`rou‹r
()->
	`adju¡_runcouÁ
(1);

577  
njumps
 + 1;

578 
	}
}

581 
	gSüt
::
	$com¶‘e_¡•
(
SŒšg
 *
»tv®
)

583 
Ï¡_š¢
;

584 ià(
_š¢_pos
 < 0 || _š¢_po >ğ
_š¢s
.
	`size
())

585 
Ï¡_š¢
 = -1;

587 
Ï¡_š¢
 = 
_š¢s
[
_š¢_pos
];

588 ià(
Ï¡_š¢
 =ğ
INSN_GOTO
 && 
_¬gs
[
_š¢_pos
] < 0)

589 
Ï¡_š¢
 = 
_¬gs
[
_š¢_pos
];

592 #ià
CLICK_USERLEVEL


593 ià(
Ï¡_š¢
 =ğ
š¢_’d
 && 
_ty³
 =ğ
ty³_sigÇl
)

594 
i
 = 0; i < 
_signos
.
	`size
(); i++)

595 
	`ma¡”
()->
	`add_sigÇl_hªdËr
(
_signos
[
i
], 
	`rou‹r
(), 
	`Çme
() + ".run");

598 ià(
»tv®
) {

599 
x
;

600 *
»tv®
 = 
	`SŒšg
();

601 ià(
Ï¡_š¢
 =ğ
INSN_RETURN
 ||†a¡_š¢ =ğ
š¢_»tuºq
) {

602 
x
 = 
	`fšd_v¬ŸbË
(
SŒšg
::
	`make_¡abË
("_", 1), 
çl£
);

603 ià(
x
 < 
_v¬s
.
	`size
())

604 *
»tv®
 = 
_v¬s
[
x
 + 1];

605 } ià(
Ï¡_š¢
 =ğ
š¢_’d
 && 
_ty³
 =ğ
ty³_push
)

606 *
»tv®
 = 
SŒšg
::
	`make_¡abË
("0", 1);

609 ià(
Ï¡_š¢
 =ğ
š¢_”rÜ
 ||†a¡_š¢ =ğ
š¢_”rÜq
)

611 ià(
Ï¡_š¢
 =ğ
š¢_¡İ
)

615 
	}
}

618 
	gSüt
::
	$run_tim”
(
Tim”
 *)

621 
	`as£¹
(
_š¢s
[
_š¢_pos
] =ğ
INSN_WAIT_TIME
 || _š¢s[_š¢_pos] =ğ
INSN_INITIAL
);

622 
E¼ÜHªdËr
 *
”rh
 = E¼ÜHªdËr::
	`deçuÉ_hªdËr
();

623 
CÚ‹xtE¼ÜHªdËr
 
	`û¼h
(
”rh
, "Whexecutšg %<%p{–em’t}%>:", 
this
);

624 
	`¡•
(1, 
STEP_TIMER
, 0, &
û¼h
);

625 
	`com¶‘e_¡•
(0);

626 
	}
}

629 
	gSüt
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

631 
E¼ÜHªdËr
 *
”rh
 = E¼ÜHªdËr::
	`deçuÉ_hªdËr
();

632 
CÚ‹xtE¼ÜHªdËr
 
	`û¼h
(
”rh
, "Whexecutšg %<%p{–em’t}%>:", 
this
);

635 
i
 = 
	`fšd_v¬ŸbË
(
SŒšg
::
	`make_¡abË
("šput", 5), 
Œue
);

636 
_v¬s
[
i
 + 1] = 
	`SŒšg
(
pÜt
);

638 
_š¢_pos
 = 0;

639 
	`¡•
(0, 
STEP_JUMP
, 0, &
û¼h
);

640 
SŒšg
 
out
;

641 
	`com¶‘e_¡•
(&
out
);

643 
pÜt
 = -1;

644 (è
	`IÁArg
().
	`·r£
(
out
, 
pÜt
);

645 
	`checked_ouut_push
(
pÜt
, 
p
);

646 
	}
}

648 
Pack‘
 *

649 
	gSüt
::
	$puÎ
()

651 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

652 ià(!
p
)

655 
E¼ÜHªdËr
 *
”rh
 = E¼ÜHªdËr::
	`deçuÉ_hªdËr
();

656 
CÚ‹xtE¼ÜHªdËr
 
	`û¼h
(
”rh
, "Whexecutšg %<%p{–em’t}%>:", 
this
);

659 
i
 = 
	`fšd_v¬ŸbË
(
SŒšg
::
	`make_¡abË
("šput", 5), 
Œue
);

660 
_v¬s
[
i
 + 1] = 
SŒšg
::
	`make_¡abË
("0", 1);

662 
_š¢_pos
 = 0;

663 
	`¡•
(0, 
STEP_JUMP
, 0, &
û¼h
);

664 
SŒšg
 
out
;

665 
	`com¶‘e_¡•
(&
out
);

667 
pÜt
 = -1;

668 (è
	`IÁArg
().
	`·r£
(
out
, 
pÜt
);

669 ià(
pÜt
 == 0)

670  
p
;

672 
	`checked_ouut_push
(
pÜt
, 
p
);

675 
	}
}

678 
	gSüt
::
Ex·nd”
::
	$ex·nd
(cÚ¡ 
SŒšg
 &
vÇme
, SŒšg &
out
, 
v¬ty³
, ) const

680 ià(
v¬ty³
 == '(') {

681 
HªdËrC®l
 
	`hc
(
vÇme
);

682 ià(
hc
.
	`š™Ÿlize_»ad
(
süt
, 
”rh
) >= 0) {

683 
out
 = 
hc
.
	`ÿÎ_»ad
(
”rh
);

684  
Œue
;

686  
çl£
;

689 
x
 = 
süt
->
	`fšd_v¬ŸbË
(
vÇme
, 
çl£
);

690 ià(
x
 < 
süt
->
_v¬s
.
	`size
()) {

691 
out
 = 
süt
->
_v¬s
[
x
 + 1];

692  
Œue
;

695 ià(
vÇme
.
	`Ëngth
() == 1 && vname[0] == '?') {

696 
out
 = 
	`SŒšg
(
süt
->
_wr™e_¡©us
);

697  
Œue
;

700 ià(
vÇme
.
	`equ®s
("args", 4)) {

701 
out
 = 
süt
->
_run_¬gs
;

702  
Œue
;

705 ià(
vÇme
.
	`Ëngth
() == 1 && vname[0] == '$') {

706 #ià
CLICK_USERLEVEL


707 
out
 = 
	`SŒšg
(
	`g‘pid
());

708 #–ià
CLICK_BSDMODULE


709 
out
 = 
	`SŒšg
(
cu½roc
->
p_pid
);

711 
out
 = 
	`SŒšg
(
cu¼’t
->
pid
);

713  
Œue
;

716 ià(
vÇme
.
	`Ëngth
() == 1 && vname[0] == '0') {

717 
out
 = 
süt
->
_run_hªdËr_Çme
;

718  
Œue
;

721 ià(
vÇme
.
	`Ëngth
() > 0 && vname[0] >= '1' && vname[0] <= '9'

722 && 
	`IÁArg
().
	`·r£
(
vÇme
, 
x
)) {

723 
SŒšg
 
¬g
, 
run_¬gs
 = 
süt
->
_run_¬gs
;

724 ; 
x
 > 0; --x)

725 
¬g
 = 
	`ı_shiá_¥aûvec
(
run_¬gs
);

726 
out
 = 
¬g
;

727  
Œue
;

730 ià(
vÇme
.
	`Ëngth
() == 1 && vname[0] == '#') {

731 
SŒšg
 
run_¬gs
 = 
süt
->
_run_¬gs
;

732 
x
 = 0; 
	`ı_shiá_¥aûvec
(
run_¬gs
); )

733 ++
x
;

734 
out
 = 
	`SŒšg
(
x
);

735  
Œue
;

738 ià(
vÇme
.
	`equ®s
("write", 5)) {

739 
out
 = 
BoŞArg
::
	`uÅ¬£
(
süt
->
_run_İ
 & 
HªdËr
::
f_wr™e
);

740  
Œue
;

743  
çl£
;

744 
	}
}

747 
	gSüt
::
	$¡•_hªdËr
(
İ
, 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
)

749 
Süt
 *
sü
 = (Süˆ*è
e
;

750 
SŒšg
 
d©a
 = 
	`ı_uncomm’t
(
¡r
);

751 
n¡•s
, 
¡•ty³
;

752 
wh©
 = (
ušŒ_t
è
h
->
	`wr™e_u£r_d©a
();

753 
sü
->
_run_hªdËr_Çme
 = 
h
->
	`Çme
();

754 
sü
->
_run_İ
 = 
İ
;

755 
»t
;

757 ià(
wh©
 =ğ
ST_GOTO
) {

758 
¡•
 = 
sü
->
	`fšd_Ïb–
(
	`ı_uncomm’t
(
d©a
));

759 ià(
¡•
 >ğ
sü
->
_š¢s
.
	`size
() || step < 0)

760  
”rh
->
	`”rÜ
("jumpo‚onexistent†abel");

761 
i
 = 
¡•
; i < 
sü
->
_š¢s
.
	`size
(); i++)

762 ià(
sü
->
_š¢s
[
i
] =ğ
INSN_WAIT_STEP
)

763 
sü
->
_¬gs2
[
i
] = 0;

764 
sü
->
_š¢_pos
 = 
¡•
;

765 
n¡•s
 = 0, 
¡•ty³
 = 
STEP_JUMP
;

766 } ià(
wh©
 =ğ
ST_RUN
) {

767 
sü
->
_š¢_pos
 = 0;

768 
sü
->
_run_¬gs
 = 
¡r
;

769 
n¡•s
 = 0, 
¡•ty³
 = 
STEP_JUMP
;

771 ià(
d©a
 == "router")

772 
n¡•s
 = 1, 
¡•ty³
 = 
STEP_ROUTER
;

773 ià(!
d©a
)

774 
n¡•s
 = 1, 
¡•ty³
 = 
STEP_NORMAL
;

775 ià(
	`IÁArg
().
	`·r£
(
d©a
, 
n¡•s
))

776 
¡•ty³
 = 
STEP_NORMAL
;

778 
»t
 = 
”rh
->
	`”rÜ
("syntaxƒrror");

779 
out
;

783 ià(!
sü
->
_cur_¡•s
) {

784 
cur_¡•s
 = 
n¡•s
, 
njumps
 = 0;

785 
sü
->
_cur_¡•s
 = &
cur_¡•s
;

786 (
n¡•s
 = 
cur_¡•s
) >= 0) {

787 
cur_¡•s
 = -1;

788 
njumps
 = 
sü
->
	`¡•
(
n¡•s
, 
¡•ty³
,‚jumps, 
”rh
);

789 
¡•ty³
 = 
ST_STEP
;

791 
sü
->
_cur_¡•s
 = 0;

792 } ià(
wh©
 =ğ
ST_STEP
)

793 *
sü
->
_cur_¡•s
 +ğ
n¡•s
;

795 
»t
 = 
sü
->
	`com¶‘e_¡•
(&
¡r
);

797 
out
:

798 
sü
->
_run_hªdËr_Çme
 = 
	`SŒšg
();

799 ià(
»t
 || !
sü
->
_run_¬gs
)

800 
sü
->
_run_¬gs
 = 
	`SŒšg
();

802 
sü
->
_run_¬gs
 = sü->_run_¬gs.
	`unsh¬ed
();

803 
sü
->
_run_İ
 = 0;

804  
»t
;

805 
	}
}

807 #ià
HAVE_INT64_TYPES


808 
	#şick_štmax_t
 
št64_t


	)

809 
	#şick_uštmax_t
 
ušt64_t


	)

810 
	#CLICK_INTMAX_CVT
 "Î"

	)

812 
	#şick_štmax_t
 
št32_t


	)

813 
	#şick_uštmax_t
 
ušt32_t


	)

814 
	#CLICK_INTMAX_CVT
 'l'

	)

818 
	gSüt
::
	$¬™hm‘ic_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
)

820 
wh©
 = (
ušŒ_t
è
h
->
	`»ad_u£r_d©a
();

822 
şick_štmax_t
 
accum
 = (
wh©
 =ğ
¬_add
 || wh© =ğ
¬_sub
 ? 0 : 1), 
¬g
;

823 
boŞ
 
fœ¡
 = 
Œue
;

824 #ià
CLICK_USERLEVEL


825 
daccum
 = (
wh©
 =ğ
¬_add
 || wh© =ğ
¬_sub
 ? 0 : 1), 
d¬g
;

826 
boŞ
 
u£_daccum
 = (
wh©
 =ğ
¬_div
 || wh© =ğ
¬_idiv
);

829 
SŒšg
 
wÜd
 = 
	`ı_shiá_¥aûvec
(
¡r
);

830 ià(!
wÜd
 && 
	`ı_is_¥aû
(
¡r
))

832 #ià
CLICK_USERLEVEL


833 ià(!
u£_daccum
 && !
	`IÁArg
().
	`·r£
(
wÜd
, 
¬g
)) {

834 
u£_daccum
 = 
Œue
;

835 
daccum
 = 
accum
;

837 ià(
u£_daccum
 && !
	`DoubËArg
().
	`·r£
(
wÜd
, 
d¬g
))

838  
”rh
->
	`”rÜ
("expected†ist of‚umbers");

839 ià(
u£_daccum
) {

840 ià(
fœ¡
)

841 
daccum
 = 
d¬g
;

842 ià(
wh©
 =ğ
¬_add
)

843 
daccum
 +ğ
d¬g
;

844 ià(
wh©
 =ğ
¬_sub
)

845 
daccum
 -ğ
d¬g
;

846 ià(
wh©
 =ğ
¬_mš
)

847 
daccum
 = (daccum < 
d¬g
 ? daccum : darg);

848 ià(
wh©
 =ğ
¬_max
)

849 
daccum
 = (daccum > 
d¬g
 ? daccum : darg);

850 ià(
wh©
 =ğ
¬_mul
)

851 
daccum
 *ğ
d¬g
;

853 
daccum
 /ğ
d¬g
;

854 
£t_fœ¡
;

857 ià(!
	`IÁArg
().
	`·r£
(
wÜd
, 
¬g
))

858  
”rh
->
	`”rÜ
("expected†ist of‚umbers");

860 ià(
fœ¡
)

861 
accum
 = 
¬g
;

862 ià(
wh©
 =ğ
¬_add
)

863 
accum
 +ğ
¬g
;

864 ià(
wh©
 =ğ
¬_sub
)

865 
accum
 -ğ
¬g
;

866 ià(
wh©
 =ğ
¬_mš
)

867 
accum
 = (accum < 
¬g
 ?‡ccum :‡rg);

868 ià(
wh©
 =ğ
¬_max
)

869 
accum
 = (accum > 
¬g
 ?‡ccum :‡rg);

870 ià(
wh©
 =ğ
¬_mul
)

871 
accum
 *ğ
¬g
;

873 #ià
CLICK_USERLEVEL
 || !
HAVE_INT64_TYPES


874 
accum
 /ğ
¬g
;

875 #–ià
CLICK_LINUXMODULE
 && 
BITS_PER_LONG
 >= 64

876 
accum
 /ğ
¬g
;

877 #–ià
CLICK_LINUXMODULE
 && 
	`defšed
(
do_div
)

878 ià((
şick_uštmax_t
è
¬g
 > 0x7FFFFFFF) {

879 
”rh
->
	`w¬nšg
("int64 divideruncated");

880 
accum
 = 0;

882 
accum
 = 
	`št_divide
×ccum, 
¬g
);

885 ià((
şick_uštmax_t
è
accum
 > 0x7FFFFFFF

886 || (
şick_uštmax_t
è
¬g
 > 0x7FFFFFFF)

887 
accum
 = 0;

889 
accum
 = (
št32_t
èaccum / (št32_tè
¬g
;

892 #ià
CLICK_USERLEVEL


893 
£t_fœ¡
:

895 
fœ¡
 = 
çl£
;

897 #ià
CLICK_USERLEVEL


898 ià(
wh©
 =ğ
¬_idiv
) {

899 
u£_daccum
 = 
çl£
;

900 
accum
 = (
şick_štmax_t
è
daccum
;

902 
¡r
 = (
u£_daccum
 ? 
	`SŒšg
(
daccum
è: SŒšg(
accum
));

904 
¡r
 = 
	`SŒšg
(
accum
);

907 
	}
}

910 
	gSüt
::
	$nÜm®_”rÜ
(
mes§ge
, 
E¼ÜHªdËr
 *
”rh
)

912 cÚ¡ * cÚ¡ 
mes§ges
[] = {

915  
”rh
->
	`”rÜ
(
mes§ges
[
mes§ge
]);

916 
	}
}

919 
	gSüt
::
	$mod»m_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
)

921 
wh©
 = (
ušŒ_t
è
h
->
	`»ad_u£r_d©a
();

922 (è
wh©
;

924 
SŒšg
 
a¡r
 = 
	`ı_shiá_¥aûvec
(
¡r
), 
b¡r
 = cp_shift_spacevec(str);

925 
şick_štmax_t
 
a
, 
b
;

926 ià(
¡r
 || !
a¡r
 || !
b¡r
)

927  
	`nÜm®_”rÜ
(
”rÜ_two_numb”s
, 
”rh
);

928 ià(!
	`IÁArg
().
	`·r£
(
a¡r
, 
a
è|| !IÁArg().·r£(
b¡r
, 
b
)) {

929 #ià
CLICK_USERLEVEL


930 
da
, 
db
;

931 ià(
wh©
 =ğ
¬_mod
 || !
	`DoubËArg
().
	`·r£
(
a¡r
, 
da
)

932 || !
	`DoubËArg
().
	`·r£
(
b¡r
, 
db
))

933  
	`nÜm®_”rÜ
(
”rÜ_two_numb”s
, 
”rh
);

934 
¡r
 = 
	`SŒšg
(
	`fmod
(
da
, 
db
));

937  
	`nÜm®_”rÜ
(
”rÜ_two_numb”s
, 
”rh
);

940 #ià
CLICK_LINUXMODULE


941 ià((
št32_t
è
a
 !ğ¨|| (št32_tè
b
 != b)

942 
”rh
->
	`w¬nšg
("int64 divideruncated");

943 
a
 = (
št32_t
è¨% (št32_tè
b
;

945 
a
 %ğ
b
;

947 
¡r
 = 
	`SŒšg
(
a
);

950 
	}
}

953 
	gSüt
::
	$Ãgabs_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
)

955 
wh©
 = (
ušŒ_t
è
h
->
	`»ad_u£r_d©a
();

957 
şick_štmax_t
 
x
;

958 ià(!
	`IÁArg
().
	`·r£
(
¡r
, 
x
)) {

959 #ià
CLICK_USERLEVEL


960 
dx
;

961 ià(!
	`DoubËArg
().
	`·r£
(
¡r
, 
dx
))

962  
	`nÜm®_”rÜ
(
”rÜ_Úe_numb”
, 
”rh
);

963 
¡r
 = 
	`SŒšg
(
wh©
 =ğ
¬_Ãg
 ? -
dx
 : 
	`çbs
(dx));

966  
	`nÜm®_”rÜ
(
”rÜ_Úe_numb”
, 
”rh
);

969 
¡r
 = 
	`SŒšg
(
wh©
 =ğ
¬_Ãg
 || 
x
 < 0 ? -x : x);

972 
	}
}

975 
	gSüt
::
	$com·»_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
)

977 
wh©
 = (
ušŒ_t
è
h
->
	`»ad_u£r_d©a
();

979 
SŒšg
 
a¡r
 = 
	`ı_shiá_¥aûvec
(
¡r
), 
b¡r
 = cp_shift_spacevec(str);

980 
şick_štmax_t
 
a
, 
b
;

981 
com·risÚ
;

982 ià(
¡r
 || !
a¡r
 || !
b¡r
)

983  
	`nÜm®_”rÜ
(
”rÜ_two_numb”s
, 
”rh
);

984 #ià
CLICK_USERLEVEL


985 ià(!
	`IÁArg
().
	`·r£
(
a¡r
, 
a
è|| !IÁArg().·r£(
b¡r
, 
b
)) {

986 
da
, 
db
;

987 ià(!
	`DoubËArg
().
	`·r£
(
a¡r
, 
da
è|| !DoubËArg().·r£(
b¡r
, 
db
))

988 
com·»_¡ršgs
;

989 
com·risÚ
 = (
da
 < 
db
 ? 
AR_LT
 : (d¨=ğdb ? 
AR_EQ
 : 
AR_GT
));

990 
com·»_»tuº
;

993 ià(!
	`IÁArg
().
	`·r£
(
a¡r
, 
a
è|| !IÁArg().·r£(
b¡r
, 
b
))

994 
com·»_¡ršgs
;

996 
com·risÚ
 = (
a
 < 
b
 ? 
AR_LT
 : (¨=ğb ? 
AR_EQ
 : 
AR_GT
));

997 
com·»_»tuº
:

998 
¡r
 = 
BoŞArg
::
	`uÅ¬£
(
wh©
 =ğ
com·risÚ


999 || (
wh©
 >ğ
AR_GE
 && wh© !ğ
com·risÚ
 + 3));

1001 
com·»_¡ršgs
:

1002 
a
 = 
SŒšg
::
	`com·»
(
	`ı_unquÙe
(
a¡r
), cp_unquÙe(
b¡r
));

1003 
com·risÚ
 = (
a
 < 0 ? 
AR_LT
 : (¨=ğ0 ? 
AR_EQ
 : 
AR_GT
));

1004 
com·»_»tuº
;

1005 
	}
}

1008 
	gSüt
::
	$¥rštf_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *, cÚ¡ 
HªdËr
 *, 
E¼ÜHªdËr
 *
”rh
)

1010 
SŒšg
 
fÜm©
 = 
	`ı_unquÙe
(
	`ı_shiá_¥aûvec
(
¡r
));

1011 cÚ¡ *
s
 = 
fÜm©
.
	`begš
(), *
pù
, *
’d
 = fÜm©.
	`’d
();

1012 
SŒšgAccum
 
»suÉ
;

1013 (
pù
 = 
	`fšd
(
s
, 
’d
, '%')) <ƒnd) {

1014 
»suÉ
 << 
fÜm©
.
	`sub¡ršg
(
s
, 
pù
);

1015 
SŒšgAccum
 
pf
;

1018 
pf
 << *
pù
++;

1019 } 
pù
 < 
’d
 && (*pct == '0' || *pct == '#'

1020 || *
pù
 == '-' || *pct == ' ' || *pct == '+'));

1022 
fw
 = 0;

1023 ià(
pù
 < 
’d
 && *pct == '*') {

1024 ià(!
	`IÁArg
().
	`·r£
(
	`ı_shiá_¥aûvec
(
¡r
), 
fw
))

1025  
”rh
->
	`”rÜ
("syntaxƒrror");

1026 
pf
 << 
fw
;

1028 
pù
 < 
’d
 && *pct >= '0' && *pct <= '9')

1029 
pf
 << *
pù
++;

1031 ià(
pù
 < 
’d
 && *pct == '.') {

1032 
pù
++;

1033 ià(
pù
 < 
’d
 && *pct == '*') {

1034 ià(!
	`IÁArg
().
	`·r£
(
	`ı_shiá_¥aûvec
(
¡r
), 
fw
) || fw < 0)

1035  
”rh
->
	`”rÜ
("syntaxƒrror");

1036 
pf
 << '.' << 
fw
;

1037 } ià(
pù
 < 
’d
 && *pct >= '0' && *pct <= '9') {

1038 
pf
 << '.';

1039 
pù
 < 
’d
 && *pct >= '0' && *pct <= '9')

1040 
pf
 << *
pù
++;

1044 
width_æag
 = 0;

1046 ià(
pù
 < 
’d
 && *pct == 'h')

1047 
width_æag
 = 'h', 
pù
++;

1048 ià(
pù
 < 
’d
 && *pct == 'l')

1049 
width_æag
 = (width_æag =ğ'l' ? 'q' : 'l'), 
pù
++;

1050 ià(
pù
 < 
’d
 && (*pct == 'L' || *pct == 'q'))

1051 
width_æag
 = 'q', 
pù
++;

1056 ià(
pù
 < 
’d
 && (*pct == 'o' || *pct == 'x' || *pct == 'X' || *pct == 'u')) {

1057 
şick_uštmax_t
 
iv®
;

1058 
SŒšg
 
x
 = 
	`ı_shiá_¥aûvec
(
¡r
);

1059 ià(!
	`IÁArg
().
	`·r£
(
x
, 
iv®
))

1060  
”rh
->
	`”rÜ
("syntaxƒrror");

1061 ià(
width_æag
 == 'h')

1062 
iv®
 = () ival;

1063 ià(
width_æag
 == 0 || width_flag == 'l')

1064 
iv®
 = () ival;

1065 
pf
 << 
CLICK_INTMAX_CVT
 << *
pù
;

1066 
»suÉ
 << 
E¼ÜHªdËr
::
	`xfÜm©
(
pf
.
	`c_¡r
(), 
iv®
);

1067 } ià(
pù
 < 
’d
 && (*pct == 'd' || *pct == 'i')) {

1068 
şick_štmax_t
 
iv®
 = 0;

1069 ià(!
	`IÁArg
().
	`·r£
(
	`ı_shiá_¥aûvec
(
¡r
), 
iv®
))

1070  
”rh
->
	`”rÜ
("syntaxƒrror");

1071 ià(
width_æag
 == 'h')

1072 
iv®
 = () ival;

1073 ià(
width_æag
 == 0 || width_flag == 'l')

1074 
iv®
 = () ival;

1075 
pf
 << 
CLICK_INTMAX_CVT
 << *
pù
;

1076 
»suÉ
 << 
E¼ÜHªdËr
::
	`xfÜm©
(
pf
.
	`c_¡r
(), 
iv®
);

1077 } ià(
pù
 < 
’d
 && *pct == '%') {

1078 
pf
 << '%';

1079 
»suÉ
 << 
E¼ÜHªdËr
::
	`xfÜm©
(
pf
.
	`c_¡r
());

1080 } ià(
pù
 < 
’d
 && *pct == 's') {

1081 
SŒšg
 
s
;

1082 ià(!
	`ı_¡ršg
(
	`ı_shiá_¥aûvec
(
¡r
), &
s
))

1083  
”rh
->
	`”rÜ
("syntaxƒrror");

1084 
pf
 << *
pù
;

1085 
»suÉ
 << 
E¼ÜHªdËr
::
	`xfÜm©
(
pf
.
	`c_¡r
(), 
s
.c_str());

1087  
”rh
->
	`”rÜ
("syntaxƒrror");

1088 
s
 = 
pù
 + 1;

1090 ià(
¡r
)

1091  
”rh
->
	`”rÜ
("syntaxƒrror");

1092 
»suÉ
 << 
fÜm©
.
	`sub¡ršg
(
s
, 
pù
);

1093 
¡r
 = 
»suÉ
.
	`ke_¡ršg
();

1095 
	}
}

1098 
	gSüt
::
	$basic_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
)

1100 
wh©
 = (
ušŒ_t
è
h
->
	`»ad_u£r_d©a
();

1102 
wh©
) {

1104 
AR_FIRST
:

1105 
¡r
 = 
	`ı_shiá_¥aûvec
(str);

1108 
AR_NOT
: {

1109 
boŞ
 
x
;

1110 ià(!
	`BoŞArg
().
	`·r£
(
¡r
, 
x
))

1111  
”rh
->
	`”rÜ
("syntaxƒrror");

1112 
¡r
 = 
BoŞArg
::
	`uÅ¬£
(!
x
);

1116 
¬_ªd
:

1117 
¬_Çnd
:

1118 
¬_Ü
:

1119 
¬_nÜ
: {

1120 
boŞ
 
z”o
 = (
wh©
 =ğ
¬_ªd
 || wh© =ğ
¬_Çnd
), 
cu¼’t_v®ue
 = zero;

1121 
cu¼’t_v®ue
 =ğ
z”o
 && 
¡r
) {

1122 
boŞ
 
x
;

1123 ià(!
	`BoŞArg
().
	`·r£
(
	`ı_shiá_¥aûvec
(
¡r
), 
x
))

1124  
”rh
->
	`”rÜ
("syntaxƒrror");

1125 
cu¼’t_v®ue
 = (
wh©
 =ğ
¬_ªd
 ? cu¼’t_v®u&& 
x
 : current_value || x);

1127 ià(
wh©
 =ğ
¬_Çnd
 || wh© =ğ
¬_nÜ
)

1128 
cu¼’t_v®ue
 = !current_value;

1129 
¡r
 = 
BoŞArg
::
	`uÅ¬£
(
cu¼’t_v®ue
);

1133 
¬_if
: {

1134 
boŞ
 
x
;

1135 ià(!
	`BoŞArg
().
	`·r£
(
	`ı_shiá_¥aûvec
(
¡r
), 
x
))

1136  
”rh
->
	`”rÜ
("syntaxƒrror");

1137 ià(
x
)

1138 
¡r
 = 
	`ı_shiá_¥aûvec
(str);

1140 (è
	`ı_shiá_¥aûvec
(
¡r
);

1141 
¡r
 = 
	`ı_shiá_¥aûvec
(str);

1146 
¬_š
: {

1147 
SŒšg
 
wÜd
 = 
	`ı_unquÙe
(
	`ı_shiá_¥aûvec
(
¡r
));

1148 
boŞ
 
ªsw”
 = 
çl£
;

1149 
wÜd
 && 
¡r
 && !
ªsw”
)

1150 
ªsw”
 = (
wÜd
 =ğ
	`ı_unquÙe
(
	`ı_shiá_¥aûvec
(
¡r
)));

1151 
¡r
 = 
BoŞArg
::
	`uÅ¬£
(
ªsw”
);

1155 
¬_now
:

1156 
¡r
 = 
Time¡amp
::
	`now
().
	`uÅ¬£
();

1159 
¬_¿ndom
: {

1160 ià(!
¡r
)

1161 
¡r
 = 
	`SŒšg
(
	`şick_¿ndom
());

1163 
ušt32_t
 
n1
, 
n2
;

1164 
boŞ
 
have_n2
 = 
çl£
;

1165 ià(
	`Args
(
e
, 
”rh
).
	`push_back_wÜds
(
¡r
)

1166 .
	`»ad_mp
("N1", 
n1
)

1167 .
	`»ad_mp
("N2", 
n2
).
	`»ad_¡©us
(
have_n2
)

1168 .
	`com¶‘e
() < 0)

1170 ià((
have_n2
 && 
n2
 < 
n1
) || (!have_n2 &&‚1 == 0))

1171  
”rh
->
	`”rÜ
("bad N");

1172 ià(
have_n2
)

1173 
¡r
 = 
	`SŒšg
(
	`şick_¿ndom
(
n1
, 
n2
));

1175 
¡r
 = 
	`SŒšg
(
	`şick_¿ndom
(0, 
n1
 - 1));

1180 
	#ARITH_BYTE_ORDER
(
o
è
¬_
##o: { \

1181 
x
; \

1182 ià(!
	`ı_š‹g”
(
¡r
, &
x
)) \

1183  
”rh
->
	`”rÜ
("syntaxƒrror"); \

1184 
¡r
 = 
	`SŒšg
Ğ
	`o
 (
x
)); \

1186 }

	)

1187 
	`ARITH_BYTE_ORDER
(
htÚs
)

1188 
	`ARITH_BYTE_ORDER
(
htÚl
)

1189 
	`ARITH_BYTE_ORDER
(
Áohs
)

1190 
	`ARITH_BYTE_ORDER
(
Áohl
)

1191 #undeà
ARITH_BYTE_ORDER


1193 #ià
CLICK_USERLEVEL


1194 
¬_ÿt
:

1195 
¬_ÿtq
: {

1196 
SŒšg
 
f’ame
;

1197 ià(!
	`F’ameArg
().
	`·r£
(
¡r
, 
f’ame
))

1198  
”rh
->
	`”rÜ
("bad FILE");

1199 
Ã¼Üs
 = 
”rh
->
	`Ã¼Üs
();

1200 
¡r
 = 
	`fe_¡ršg
(
f’ame
, 
”rh
);

1201 ià(
wh©
 =ğ
¬_ÿtq
)

1202 
¡r
 = 
	`ı_quÙe
(str);

1203  (
”rh
->
	`Ã¼Üs
(è=ğ
Ã¼Üs
 ? 0 : -
”ºo
);

1206 
¬_kl
: {

1207 
SŒšg
 
wÜd
 = 
	`ı_shiá_¥aûvec
(
¡r
);

1208 
št32_t
 
signo
;

1209 ià(!
wÜd
 || !
NameInfo
::
	`qu”y_št
(NameInfo::
T_SIGNO
, 
e
, wÜd, &
signo
)

1210 || 
signo
 < 0 || signo > 32)

1211  
”rh
->
	`”rÜ
("bad SIGNO");

1212 
¡r
) {

1213 
pid_t
 
pid
 = 0;

1214 ià(!
	`IÁArg
().
	`·r£
(
	`ı_shiá_¥aûvec
(
¡r
), 
pid
))

1215  
”rh
->
	`”rÜ
("bad PID");

1216 ià(
	`kl
(
pid
, 
signo
) != 0) {

1217 
e
 = 
”ºo
;

1218 
”rh
->
	`”rÜ
("kl(%ld, %d): %s", (è
pid
, (è
signo
, 
	`¡»¼Ü
(
e
));

1219  
e
;

1226 
¬_»adabË
:

1227 
¬_wr™abË
: {

1228 
EËm’t
 *
–
;

1229 cÚ¡ 
HªdËr
 *
h
;

1230 
f
 = (
wh©
 =ğ
¬_»adabË
 ? 
HªdËr
::
f_»ad
 : HªdËr::
f_wr™e
);

1231 
SŒšg
 
hÇme
 = 
	`ı_shiá_¥aûvec
(
¡r
))

1232 ià(!
	`ı_hªdËr
(
hÇme
, 
f
, &
–
, &
h
, 
e
)) {

1233 
¡r
 = 
	`SŒšg
(
çl£
);

1236 
¡r
 = 
	`SŒšg
(
Œue
);

1240 
¬_Ëngth
:

1241 
¡r
 = 
	`SŒšg
(¡r.
	`Ëngth
());

1244 
¬_unquÙe
:

1245 
¡r
 = 
	`ı_unquÙe
(str);

1251 
	}
}

1254 
	gSüt
::
	$¡¬_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

1256 
Süt
 *
s
 = 
¡©ic_ÿ¡
<Süˆ*>(
e
);

1257 
s
->
	`£t_hªdËr
(
¡r
, 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
 | HªdËr::
f_wr™e
, 
¡•_hªdËr
, 0, 
ST_RUN
);

1258  
Rou‹r
::
	`hšdex
(
s
, 
¡r
);

1259 
	}
}

1261 
SŒšg


1262 
	gSüt
::
	$»ad_expÜt_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
)

1264 
Süt
 *
sü
 = 
¡©ic_ÿ¡
<Süˆ*>(
e
);

1265  
sü
->
_v¬s
[(
šŒ_t
è
u£r_d©a
 + 1];

1266 
	}
}

1269 
	gSüt
::
	$v¬_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
)

1271 
Süt
 *
s
 = 
¡©ic_ÿ¡
<Süˆ*>(
e
);

1272 
wh©
 = (
ušŒ_t
è
h
->
	`»ad_u£r_d©a
();

1273 
r
 = 0;

1274 
SŒšg
 *
v¬v®
 = 0;

1276 
SŒšg
 
v¬Çme
 = 
	`ı_shiá_¥aûvec
(
¡r
);

1277 ià(!
v¬Çme
 && 
wh©
 =ğ
vh_shiá
)

1278 
v¬Çme
 = "args";

1279 ià(!
v¬Çme
)

1280 
r
 = 
”rh
->
	`”rÜ
("no variable");

1281 ià(
¡r
 && (
wh©
 =ğ
vh_g‘
 || wh© =ğ
vh_shiá
))

1282 
r
 = 
”rh
->
	`”rÜ
("too many‡rguments");

1284 
i
;

1285 ià(
v¬Çme
.
	`equ®s
("args", 4))

1286 
v¬v®
 = &
s
->
_run_¬gs
;

1287 ià((
i
 = 
s
->
	`fšd_v¬ŸbË
(
v¬Çme
, 
wh©
 =ğ
vh_£t
)),

1288 
i
 !ğ
s
->
_v¬s
.
	`size
())

1289 
v¬v®
 = &
s
->
_v¬s
[
i
 + 1];

1291 
r
 = 
”rh
->
	`”rÜ
("undefšed v¬ŸbË %<%#s%>", 
v¬Çme
.
	`c_¡r
());

1294 ià(
r
 >= 0) {

1295 ià(
wh©
 =ğ
vh_g‘
)

1296 
¡r
 = *
v¬v®
;

1297 ià(
wh©
 =ğ
vh_£t
) {

1298 *
v¬v®
 = 
¡r
;

1299 
¡r
 = 
	`SŒšg
();

1301 
¡r
 = 
	`ı_shiá_¥aûvec
(*
v¬v®
);

1303 
¡r
 = 
	`SŒšg
();

1305  
r
;

1306 
	}
}

1309 
	gSüt
::
	$add_hªdËrs
()

1311 
	`£t_hªdËr
("¡•", 
HªdËr
::
f_wr™e
, 
¡•_hªdËr
, 0, 
ST_STEP
);

1312 
	`£t_hªdËr
("gÙo", 
HªdËr
::
f_wr™e
, 
¡•_hªdËr
, 0, 
ST_GOTO
);

1313 
	`£t_hªdËr
("run", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
 | HªdËr::
f_wr™e
, 
¡•_hªdËr
, 0, 
ST_RUN
);

1314 
	`£t_hªdËr
("add", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
¬™hm‘ic_hªdËr
, 
¬_add
, 0);

1315 
	`£t_hªdËr
("sub", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
¬™hm‘ic_hªdËr
, 
¬_sub
, 0);

1316 
	`£t_hªdËr
("mš", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
¬™hm‘ic_hªdËr
, 
¬_mš
, 0);

1317 
	`£t_hªdËr
("max", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
¬™hm‘ic_hªdËr
, 
¬_max
, 0);

1318 
	`£t_hªdËr
("mul", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
¬™hm‘ic_hªdËr
, 
¬_mul
, 0);

1319 
	`£t_hªdËr
("div", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
¬™hm‘ic_hªdËr
, 
¬_div
, 0);

1320 
	`£t_hªdËr
("idiv", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
¬™hm‘ic_hªdËr
, 
¬_idiv
, 0);

1321 
	`£t_hªdËr
("mod", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
mod»m_hªdËr
, 
¬_mod
, 0);

1322 
	`£t_hªdËr
("»m", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
mod»m_hªdËr
, 
¬_»m
, 0);

1323 
	`£t_hªdËr
("Ãg", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
Ãgabs_hªdËr
, 
¬_Ãg
, 0);

1324 
	`£t_hªdËr
("abs", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
Ãgabs_hªdËr
, 
¬_abs
, 0);

1325 
	`£t_hªdËr
("eq", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
com·»_hªdËr
, 
AR_EQ
, 0);

1326 
	`£t_hªdËr
("Ã", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
com·»_hªdËr
, 
AR_NE
, 0);

1327 
	`£t_hªdËr
("gt", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
com·»_hªdËr
, 
AR_GT
, 0);

1328 
	`£t_hªdËr
("ge", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
com·»_hªdËr
, 
AR_GE
, 0);

1329 
	`£t_hªdËr
("É", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
com·»_hªdËr
, 
AR_LT
, 0);

1330 
	`£t_hªdËr
("Ë", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
com·»_hªdËr
, 
AR_LE
, 0);

1331 
	`£t_hªdËr
("nÙ", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
AR_NOT
, 0);

1332 
	`£t_hªdËr
("¥rštf", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
¥rštf_hªdËr
, 
AR_SPRINTF
, 0);

1333 
	`£t_hªdËr
("fœ¡", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
AR_FIRST
, 0);

1334 
	`£t_hªdËr
("¿ndom", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_¿ndom
, 0);

1335 
	`£t_hªdËr
("ªd", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_ªd
, 0);

1336 
	`£t_hªdËr
("Ü", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_Ü
, 0);

1337 
	`£t_hªdËr
("Çnd", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_Çnd
, 0);

1338 
	`£t_hªdËr
("nÜ", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_nÜ
, 0);

1339 
	`£t_hªdËr
("if", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_if
, 0);

1340 
	`£t_hªdËr
("š", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_š
, 0);

1341 
	`£t_hªdËr
("now", 
HªdËr
::
f_»ad
, 
basic_hªdËr
, 
¬_now
, 0);

1342 
	`£t_hªdËr
("»adabË", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_»adabË
, 0);

1343 
	`£t_hªdËr
("wr™abË", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_wr™abË
, 0);

1344 
	`£t_hªdËr
("Ëngth", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_Ëngth
, 0);

1345 
	`£t_hªdËr
("unquÙe", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_unquÙe
, 0);

1346 
	`£t_hªdËr
("htÚs", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_htÚs
, 0);

1347 
	`£t_hªdËr
("htÚl", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_htÚl
, 0);

1348 
	`£t_hªdËr
("Áohs", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_Áohs
, 0);

1349 
	`£t_hªdËr
("Áohl", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
basic_hªdËr
, 
¬_Áohl
, 0);

1350 #ià
CLICK_USERLEVEL


1351 
	`£t_hªdËr
("ÿt", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
 | HªdËr::
f_»ad_´iv©e
, 
basic_hªdËr
, 
¬_ÿt
, 0);

1352 
	`£t_hªdËr
("ÿtq", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
 | HªdËr::
f_»ad_´iv©e
, 
basic_hªdËr
, 
¬_ÿtq
, 0);

1353 
	`£t_hªdËr
("kl", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
 | HªdËr::
f_»ad_´iv©e
, 
basic_hªdËr
, 
¬_kl
, 0);

1355 
	`£t_hªdËr
("g‘", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
v¬_hªdËr
, 
vh_g‘
, 0);

1356 
	`£t_hªdËr
("£t", 
HªdËr
::
f_wr™e
, 
v¬_hªdËr
, 
vh_£t
, 0);

1357 
	`£t_hªdËr
("shiá", 
HªdËr
::
f_»ad
 | HªdËr::
f_»ad_·¿m
, 
v¬_hªdËr
, 
vh_shiá
, 0);

1358 ià(
_ty³
 =ğ
ty³_´oxy
)

1359 
	`add_wr™e_hªdËr
("*", 
¡¬_wr™e_hªdËr
, 0);

1360 
i
 = 0; i < 
_š¢s
.
	`size
(); ++i)

1361 ià(
_š¢s
[
i
] =ğ
š¢_expÜt
 || _š¢s[i] =ğ
š¢_expÜtq
)

1362 
	`add_»ad_hªdËr
(
_v¬s
[
_¬gs
[
i
]], 
»ad_expÜt_hªdËr
, _args[i]);

1363 
	}
}

1365 
	$EXPORT_ELEMENT
(
Süt
)

1366 
CLICK_ENDDECLS


	@standard/script.hh

2 #iâdeà
CLICK_SCRIPT_HH


3 
	#CLICK_SCRIPT_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/tim”.hh
>

6 
	~<şick/v¬ŸbË’v.hh
>

7 
CLICK_DECLS


444 şas 
	cSüt
 : 
public
 
EËm’t
 {…ublic:

446 
	$Süt
(è
CLICK_COLD
;

448 
	`¡©ic_š™Ÿlize
();

449 
	`¡©ic_ş—nup
();

451 cÚ¡ *
	$şass_Çme
() const {  "Script"; }

452 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/-"; 
	}
}

453 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "ah/ah"; 
	}
}

454 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

455 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

456 
	$add_hªdËrs
(è
CLICK_COLD
;

458 
	`push
(
pÜt
, 
Pack‘
 *
p
);

459 
Pack‘
 *
	`puÎ
(
pÜt
);

460 
	`run_tim”
(
Tim”
 *);

462 
	eIn¢
 {

463 
INSN_INITIAL
, 
INSN_WAIT_STEP
, 
INSN_WAIT_TIME
,

464 
INSN_PRINT
, 
INSN_PRINTQ
, 
INSN_PRINTN
, 
INSN_PRINTNQ
,

465 
INSN_READ
, 
INSN_READQ
, 
INSN_WRITE
, 
INSN_WRITEQ
,

466 
INSN_SET
, 
š¢_£tq
, 
š¢_š™
, 
š¢_š™q
, 
š¢_expÜt
, 
š¢_expÜtq
,

467 #ià
CLICK_USERLEVEL


468 
š¢_§ve
, 
š¢_­³nd
,

470 
INSN_LABEL
, 
INSN_GOTO
, 
INSN_RETURN
, 
š¢_»tuºq
,

471 
INSN_WAIT_PSEUDO
, 
INSN_LOOP_PSEUDO
,

473 
š¢_ex™
 = -1, 
š¢_’d
 = -2, 
š¢_¡İ
 = -3, 
š¢_”rÜ
 = -4,

474 
š¢_”rÜq
 = -5

475 
	}
};

477 
	g´iv©e
:

479 
	eTy³
 {

480 
ty³_aùive
, 
	gty³_driv”
, 
	gty³_sigÇl
, 
	gty³_·ssive
, 
	gty³_´oxy
,

481 
	gty³_push


485 
	gmax_jumps
 = 1000, 
	gSTEP_NORMAL
 = 0, 
	gSTEP_ROUTER
, 
	gSTEP_TIMER
, 
	gSTEP_JUMP


488 
	gVeùÜ
<> 
	g_š¢s
;

489 
	gVeùÜ
<> 
	g_¬gs
;

490 
	gVeùÜ
<> 
	g_¬gs2
;

491 
	gVeùÜ
<
	gSŒšg
> 
	g_¬gs3
;

493 
	gVeùÜ
<
	gSŒšg
> 
	g_v¬s
;

494 
SŒšg
 
	g_run_hªdËr_Çme
;

495 
SŒšg
 
	g_run_¬gs
;

496 
	g_run_İ
;

498 
	g_š¢_pos
;

499 
	g_¡•_couÁ
;

500 
	g_ty³
;

501 
	g_wr™e_¡©us
;

502 #ià
CLICK_USERLEVEL


503 
	gVeùÜ
<> 
	g_signos
;

506 
Tim”
 
	g_tim”
;

507 *
	g_cur_¡•s
;

509 şas 
	cEx·nd”
 : 
public
 
V¬ŸbËEx·nd”
 {…ublic:

510 
Süt
 *
süt
;

511 
E¼ÜHªdËr
 *
	g”rh
;

512 
ex·nd
(cÚ¡ 
SŒšg
 &
v¬
, SŒšg &
ex·nsiÚ
, 
v¬ty³
, 
d•th
) const;

516 
	gST_STEP
 = 0, 
	gST_RUN
, 
	gST_GOTO
,

517 
	g¬_add
 = 0, 
	g¬_sub
, 
	g¬_mš
, 
	g¬_max
, 
	g¬_mul
, 
	g¬_div
, 
	g¬_idiv
, 
	g¬_mod
, 
	g¬_»m
,

518 
	g¬_Ãg
, 
	g¬_abs
,

519 
	gAR_LT
, 
	gAR_EQ
, 
	gAR_GT
, 
	gAR_GE
, 
	gAR_NE
, 
	gAR_LE
,

520 
	gAR_FIRST
, 
	gAR_NOT
, 
	gAR_SPRINTF
, 
	g¬_¿ndom
, 
	g¬_ÿt
, 
	g¬_ÿtq
,

521 
	g¬_ªd
, 
	g¬_Ü
, 
	g¬_Çnd
, 
	g¬_nÜ
, 
	g¬_now
, 
	g¬_if
, 
	g¬_š
,

522 
	g¬_»adabË
, 
	g¬_wr™abË
, 
	g¬_Ëngth
, 
	g¬_unquÙe
, 
	g¬_kl
,

523 
	g¬_htÚs
, 
	g¬_htÚl
, 
	g¬_Áohs
, 
	g¬_Áohl
,

524 
	gvh_g‘
, 
	gvh_£t
, 
	gvh_shiá


527 
add_š¢
(, , ğ0, cÚ¡ 
SŒšg
 & = String());

528 
¡•
(
n¡•s
, 
¡•_ty³
, 
njumps
, 
E¼ÜHªdËr
 *
”rh
);

529 
com¶‘e_¡•
(
SŒšg
 *
»tv®
);

530 
	$fšd_Ïb–
(cÚ¡ 
SŒšg
 &) const;

531 
	`fšd_v¬ŸbË
(cÚ¡ 
SŒšg
 &
Çme
, 
boŞ
 
add
);

533 
	`¡•_hªdËr
(, 
SŒšg
&, 
EËm’t
*, cÚ¡ 
HªdËr
*, 
E¼ÜHªdËr
*);

534 ’um { 
”rÜ_Úe_numb”
, 
”rÜ_two_numb”s
 
	}
};

535 
nÜm®_”rÜ
(
mes§ge
, 
E¼ÜHªdËr
 *
”rh
);

536 
¬™hm‘ic_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
);

537 
mod»m_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
);

538 
Ãgabs_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
);

539 
com·»_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
);

540 
¥rštf_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
);

541 
basic_hªdËr
(, 
SŒšg
&, 
EËm’t
*, cÚ¡ 
HªdËr
*, 
E¼ÜHªdËr
*);

542 
SŒšg
 
»ad_expÜt_hªdËr
(
EËm’t
*, *);

543 
v¬_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
);

544 
	$¡¬_wr™e_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*è
CLICK_COLD
;

546 
ä›nd
 
şass
 
Driv”Mªag”
;

547 
ä›nd
 
şass
 
Ex·nd”
;

549 
	}
};

551 
	gCLICK_ENDDECLS


	@standard/setannobyte.cc

18 
	~<şick/cÚfig.h
>

19 
	~"£Âoby‹.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
	~<şick/·ck‘.hh
>

26 
CLICK_DECLS


28 
	gS‘AÂoBy‹
::
	$S‘AÂoBy‹
()

29 : 
	`_off£t
(0), 
	$_v®ue
(0)

31 
	}
}

34 
	gS‘AÂoBy‹
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
	g”rh
->
w¬nšg
("SetAnnoByte(ANNO, VALUE) is obsolete, use Paint(VALUE, ANNO) instead");

37  
Args
(
cÚf
, 
this
, 
”rh
)

38 .
»ad_mp
("ANNO", 
AÂoArg
(1), 
_off£t
)

39 .
»ad_mp
("VALUE", 
_v®ue
).
com¶‘e
();

42 
Pack‘
 *

43 
	gS‘AÂoBy‹
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

45 
p
->
	`£t_ªno_u8
(
_off£t
, 
_v®ue
);

46  
p
;

47 
	}
}

50 
	gS‘AÂoBy‹
::
	$add_hªdËrs
()

52 
	`add_d©a_hªdËrs
("ªno", 
HªdËr
::
OP_READ
, &
_off£t
);

53 
	`add_d©a_hªdËrs
("v®ue", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_v®ue
);

54 
	}
}

56 
CLICK_ENDDECLS


57 
	$EXPORT_ELEMENT
(
S‘AÂoBy‹
)

58 
	`ELEMENT_MT_SAFE
(
S‘AÂoBy‹
)

	@standard/setannobyte.hh

1 #iâdeà
CLICK_SETANNOBYTE_HH


2 
	#CLICK_SETANNOBYTE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


28 şas 
	cS‘AÂoBy‹
 : 
public
 
EËm’t
 {…ublic:

30 
	$S‘AÂoBy‹
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "SetAnnoByte"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

35 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

36 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

37 
	$add_hªdËrs
(è
CLICK_COLD
;

39 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

41 
´iv©e
:

43 
_off£t
;

44 
_v®ue
;

46 
	}
};

48 
	gCLICK_ENDDECLS


	@standard/setcrc32.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/üc32.h
>

20 
	~"£tüc32.hh
"

21 
CLICK_DECLS


23 
	gS‘CRC32
::
	$S‘CRC32
()

25 
	}
}

27 
Pack‘
 *

28 
S‘CRC32
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

30 
Ën
 = 
p
->
	`Ëngth
();

31 
üc
 = 0xffffffff;

32 
üc
 = 
	`upd©e_üc
(üc, (*è
p
->
	`d©a
(), 
Ën
);

34 
Wr™abËPack‘
 *
q
 = 
p
->
	`put
(4);

35 
	`memıy
(
q
->
	`d©a
(è+ 
Ën
, &
üc
, 4);

37 (
q
);

38 
	}
}

40 
CLICK_ENDDECLS


41 
	$EXPORT_ELEMENT
(
S‘CRC32
)

42 
	`ELEMENT_MT_SAFE
(
S‘CRC32
)

	@standard/setcrc32.hh

1 #iâdeà
CLICK_SETCRC32_HH


2 
	#CLICK_SETCRC32_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


17 
şass
 
	gEth”Add»ss
;

19 şas 
	cS‘CRC32
 : 
public
 
EËm’t
 {…ublic:

21 
S‘CRC32
();

23 cÚ¡ *
	$şass_Çme
() const {  "SetCRC32"; }

24 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

26 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

30 
	gCLICK_ENDDECLS


	@standard/setpackettype.cc

19 
	~<şick/cÚfig.h
>

20 
	~"£ack‘ty³.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gS‘Pack‘Ty³
::
	$S‘Pack‘Ty³
()

27 
	}
}

30 
S‘Pack‘Ty³
::
	$·r£_ty³
(cÚ¡ 
SŒšg
 &
s
)

32 ià(
s
 == "HOST")

33  
Pack‘
::
HOST
;

34 ià(
s
 == "BROADCAST")

35  
Pack‘
::
BROADCAST
;

36 ià(
s
 == "MULTICAST")

37  
Pack‘
::
MULTICAST
;

38 ià(
s
 == "OTHERHOST")

39  
Pack‘
::
OTHERHOST
;

40 ià(
s
 == "OUTGOING")

41  
Pack‘
::
OUTGOING
;

42 ià(
s
 == "LOOPBACK")

43  
Pack‘
::
LOOPBACK
;

46 
	}
}

49 
	gS‘Pack‘Ty³
::
	$uÅ¬£_ty³
(
p
)

51 
p
) {

52 
Pack‘
::
HOST
:  "HOST";

53 
Pack‘
::
BROADCAST
:  "BROADCAST";

54 
Pack‘
::
MULTICAST
:  "MULTICAST";

55 
Pack‘
::
OTHERHOST
:  "OTHERHOST";

56 
Pack‘
::
OUTGOING
:  "OUTGOING";

57 
Pack‘
::
LOOPBACK
:  "LOOPBACK";

60 
	}
}

63 
	gS‘Pack‘Ty³
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

65 
SŒšg
 
	g±y³
;

66 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("TYPE", 
WÜdArg
(), 
±y³
).
com¶‘e
() < 0)

68 
	g±y³_v®
 = 
·r£_ty³
(
±y³
.
uµ”
());

69 ià(
	g±y³_v®
 < 0)

70  
	g”rh
->
”rÜ
("uÄecognized…ack‘y³ %<%s%>", 
±y³
.
c_¡r
());

71 
	g_±y³
 = (
Pack‘
::
Pack‘Ty³
)
±y³_v®
;

75 
Pack‘
 *

76 
	gS‘Pack‘Ty³
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

78 
p
->
	`£t_·ck‘_ty³_ªno
(
_±y³
);

79  
p
;

80 
	}
}

82 
CLICK_ENDDECLS


83 
	$EXPORT_ELEMENT
(
S‘Pack‘Ty³
)

84 
	`ELEMENT_MT_SAFE
(
S‘Pack‘Ty³
)

	@standard/setpackettype.hh

2 #iâdeà
CLICK_SETPACKETTYPE_HH


3 
	#CLICK_SETPACKETTYPE_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


24 şas 
	cS‘Pack‘Ty³
 : 
public
 
EËm’t
 {…ublic:

26 
	$S‘Pack‘Ty³
(è
CLICK_COLD
;

28 cÚ¡ *
	$şass_Çme
() const {  "SetPacketType"; }

29 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

31 
·r£_ty³
(cÚ¡ 
SŒšg
 &);

32 cÚ¡ *
uÅ¬£_ty³
();

34 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

35 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

37 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

39 
	g´Ùeùed
:

41 
Pack‘
::
Pack‘Ty³
 
_±y³
;

45 
	gCLICK_ENDDECLS


	@standard/settimestamp.cc

21 
	~<şick/cÚfig.h
>

22 
	~"£‰ime¡amp.hh
"

23 
	~<şick/¬gs.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
	~<şick/”rÜ.hh
>

26 
CLICK_DECLS


28 
	gS‘Time¡amp
::
	$S‘Time¡amp
()

30 
	}
}

33 
S‘Time¡amp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

35 
boŞ
 
	gfœ¡
 = 
çl£
, 
	gd–
 = false;

36 
	g_tv
.
£t_£c
(-1);

37 
	g_aùiÚ
 = 
ACT_NOW
;

38 ià(
Args
(
cÚf
, 
this
, 
”rh
)

39 .
»ad_p
("TIMESTAMP", 
_tv
)

40 .
»ad
("FIRST", 
fœ¡
)

41 .
»ad
("DELTA", 
d–
).
com¶‘e
() < 0)

43 ià(
	gd–
)

44  
	g”rh
->
”rÜ
("SetTimestamp(DELTA) is deprecated, use SetTimestampDelta(TYPE FIRST)");

45 
	g_aùiÚ
 = (
_tv
.
£c
(è< 0 ? 
ACT_NOW
 : 
ACT_TIME
è+ (
fœ¡
 ? 
ACT_FIRST_NOW
 : ACT_NOW);

49 
Pack‘
 *

50 
	gS‘Time¡amp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

52 ià(
_aùiÚ
 =ğ
ACT_NOW
)

53 
p
->
	`time¡amp_ªno
().
	`assign_now
();

54 ià(
_aùiÚ
 =ğ
ACT_TIME
)

55 
p
->
	`time¡amp_ªno
(èğ
_tv
;

56 ià(
_aùiÚ
 =ğ
ACT_FIRST_NOW
)

57 
	`FIRST_TIMESTAMP_ANNO
(
p
).
	`assign_now
();

59 
	`FIRST_TIMESTAMP_ANNO
(
p
èğ
_tv
;

60  
p
;

61 
	}
}

63 
CLICK_ENDDECLS


64 
EXPORT_ELEMENT
(
S‘Time¡amp
)

	@standard/settimestamp.hh

2 #iâdeà
CLICK_SETTIMESTAMP_HH


3 
	#CLICK_SETTIMESTAMP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


35 şas 
	cS‘Time¡amp
 : 
public
 
EËm’t
 {…ublic:

37 
	$S‘Time¡amp
(è
CLICK_COLD
;

39 cÚ¡ *
	$şass_Çme
() const {  "SetTimestamp"; }

40 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

41 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

43 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

45 
	g´iv©e
:

47 ’um { 
ACT_NOW
, 
	gACT_TIME
, 
	gACT_FIRST_NOW
, 
	gACT_FIRST_TIME
 };

48 
	g_aùiÚ
;

49 
Time¡amp
 
	g_tv
;

53 
	gCLICK_ENDDECLS


	@standard/shaper.cc

21 
	~<şick/cÚfig.h
>

22 
	~"sh­”.hh
"

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/glue.hh
>

26 
CLICK_DECLS


28 
	gSh­”
::
	$Sh­”
()

30 
	}
}

33 
Sh­”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

35 
ušt32_t
 
	g¿‹
;

36 
Args
 
¬gs
(
cÚf
, 
this
, 
”rh
);

37 ià(
is_bªdwidth
())

38 
	g¬gs
.
»ad_mp
("RATE", 
BªdwidthArg
(), 
¿‹
);

40 
	g¬gs
.
»ad_mp
("RATE", 
¿‹
);

41 ià(
	g¬gs
.
com¶‘e
() < 0)

43 
	g_¿‹
.
£t_¿‹
(
¿‹
, 
”rh
);

47 
Pack‘
 *

48 
	gSh­”
::
	$puÎ
(
pÜt
)

50 
Pack‘
 *
p
 = 0;

51 
boŞ
 
Ãed_upd©e
 = 
_¿‹
.
	`Ãed_upd©e
(
Time¡amp
::
	`now
());

52 ià(
pÜt
 =ğ0 && 
Ãed_upd©e
) {

53 ià((
p
 = 
	`šput
(0).
	`puÎ
()))

54 
_¿‹
.
	`upd©e
();

55 } ià(
pÜt
 =ğ1 && !
Ãed_upd©e
)

56 
p
 = 
	`šput
(0).
	`puÎ
();

57  
p
;

58 
	}
}

60 
SŒšg


61 
	gSh­”
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *)

63 
Sh­”
 *
s
 = 
¡©ic_ÿ¡
<Sh­” *>(
e
);

64 ià(
s
->
	`is_bªdwidth
())

65  
BªdwidthArg
::
	`uÅ¬£
(
s
->
_¿‹
.
	`¿‹
());

67  
	`SŒšg
(
s
->
_¿‹
.
	`¿‹
());

68 
	}
}

71 
	gSh­”
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

73 
Sh­”
 *
s
 = 
¡©ic_ÿ¡
<Sh­” *>(
e
);

74 
s
->
_¿‹
.
	`»£t
();

76 
	}
}

79 
	gSh­”
::
	$add_hªdËrs
()

81 
	`add_»ad_hªdËr
("¿‹", 
»ad_hªdËr
);

82 
	`add_wr™e_hªdËr
("¿‹", 
»cÚfigu»_keywÜd_hªdËr
, "0 RATE");

83 
	`add_»ad_hªdËr
("cÚfig", 
»ad_hªdËr
);

84 
	`£t_hªdËr_æags
("cÚfig", 0, 
HªdËr
::
CALM
);

85 
	`add_wr™e_hªdËr
("»£t", 
wr™e_hªdËr
);

86 
	}
}

88 
CLICK_ENDDECLS


89 
EXPORT_ELEMENT
(
Sh­”
)

	@standard/shaper.hh

2 #iâdeà
CLICK_SHAPER_HH


3 
	#CLICK_SHAPER_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/g­¿‹.hh
>

6 
CLICK_DECLS


57 şas 
	cSh­”
 : 
public
 
EËm’t
 {…ublic:

59 
	$Sh­”
(è
CLICK_COLD
;

61 cÚ¡ *
	$şass_Çme
() const {  "Shaper"; }

62 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

63 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

64 
boŞ
 
	$is_bªdwidth
(ècÚ¡ {  
	`şass_Çme
()[0] =ğ'B'; 
	}
}

66 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

67 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

68 
	$add_hªdËrs
(è
CLICK_COLD
;

70 
Pack‘
 *
	`puÎ
();

72 
´Ùeùed
:

74 
G­R©e
 
_¿‹
;

76 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

77 
	`wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *);

79 
	}
};

81 
	gCLICK_ENDDECLS


	@standard/simplequeue.cc

19 
	~<şick/cÚfig.h
>

20 
	~"sim¶equeue.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gSim¶eQueue
::
	$Sim¶eQueue
()

26 : 
	$_q
(0)

28 
	}
}

31 
Sim¶eQueue
::
	$ÿ¡
(cÚ¡ *
n
)

33 ià(
	`¡rcmp
(
n
, "Storage") == 0)

34  (
StÜage
 *)
this
;

35 ià(
	`¡rcmp
(
n
, "SimpleQueue") == 0

36 || 
	`¡rcmp
(
n
, "Queue") == 0)

37  (
EËm’t
 *)
this
;

40 
	}
}

43 
	gSim¶eQueue
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

45 
	gÃw_ÿ·c™y
 = 1000;

46 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("CAPACITY", 
Ãw_ÿ·c™y
).
com¶‘e
() < 0)

48 
	g_ÿ·c™y
 = 
Ãw_ÿ·c™y
;

53 
	gSim¶eQueue
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

55 
	`as£¹
(!
_q
 && 
	`h—d
(è=ğ0 && 
	`
() == 0);

56 
_q
 = (
Pack‘
 **è
	`CLICK_LALLOC
((Pack‘ *è* (
_ÿ·c™y
 + 1));

57 ià(
_q
 == 0)

58  
”rh
->
	`”rÜ
("out of memory");

59 
_drİs
 = 0;

60 
_highw©”_Ëngth
 = 0;

62 
	}
}

65 
	gSim¶eQueue
::
live_»cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

68 
	gStÜage
::
šdex_ty³
 
Şd_ÿ·c™y
 = 
_ÿ·c™y
;

70 ià(
	gSim¶eQueue
::
cÚfigu»
(
cÚf
, 
”rh
) < 0)

72 ià(
	g_ÿ·c™y
 =ğ
Şd_ÿ·c™y
 || !
_q
)

74 
	gStÜage
::
šdex_ty³
 
Ãw_ÿ·c™y
 = 
_ÿ·c™y
;

75 
	g_ÿ·c™y
 = 
Şd_ÿ·c™y
;

77 
Pack‘
 **
	gÃw_q
 = (Pack‘ **è
CLICK_LALLOC
((Pack‘ *è* (
Ãw_ÿ·c™y
 + 1));

78 ià(
	gÃw_q
 == 0)

79  
”rh
->
”rÜ
("out of memory");

81 
	gStÜage
::
šdex_ty³
 
i
, 
	gj
;

82 
	gi
 = 
h—d
(), 
	gj
 = 0; i !ğ

(è&& 
j
 !ğ
Ãw_ÿ·c™y
; i = 
Ãxt_i
(
i
))

83 
Ãw_q
[
j
++] = 
_q
[
i
];

84 ; 
	gi
 !ğ

(); i = 
Ãxt_i
(
i
))

85 
_q
[
i
]->
kl
();

87 
CLICK_LFREE
(
_q
, (
Pack‘
 *è* (
_ÿ·c™y
 + 1));

88 
	g_q
 = 
Ãw_q
;

89 
£t_h—d
(0);

90 
£t_
(
j
);

91 
	g_ÿ·c™y
 = 
Ãw_ÿ·c™y
;

96 
	gSim¶eQueue
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *
”rh
)

98 
Sim¶eQueue
 *
q
 = (Sim¶eQueu*)
e
->
	`ÿ¡
("SimpleQueue");

99 ià(!
q
)

102 ià(
	`
(è!ğ
	`h—d
() || head() != 0) {

103 
”rh
->
	`”rÜ
("already have…acketsƒnqueued, can%,take state");

107 
	`£t_h—d
(0);

108 
StÜage
::
šdex_ty³
 
i
 = 0, 
j
 = 
q
->
	`h—d
();

109 
i
 < 
_ÿ·c™y
 && 
j
 !ğ
q
->
	`
()) {

110 
_q
[
i
] = 
q
->_q[
j
];

111 
i
++;

112 
j
 = 
q
->
	`Ãxt_i
(j);

114 
	`£t_
(
i
);

115 
_highw©”_Ëngth
 = 
	`size
();

117 ià(
j
 !ğ
q
->
	`
())

118 
”rh
->
	`w¬nšg
("some…ackets†ost (old†ength %d,‚ew capacity %d)",

119 
q
->
	`size
(), 
_ÿ·c™y
);

120 
j
 !ğ
q
->
	`
()) {

121 
q
->
_q
[
j
]->
	`kl
();

122 
j
 = 
q
->
	`Ãxt_i
(j);

124 
q
->
	`£t_h—d
(0);

125 
q
->
	`£t_
(0);

126 
	}
}

129 
	gSim¶eQueue
::
	$ş—nup
(
CËªupSge
)

131 
StÜage
::
šdex_ty³
 
i
 = 
	`h—d
(); i !ğ
	`
(); i = 
	`Ãxt_i
(i))

132 
_q
[
i
]->
	`kl
();

133 
	`CLICK_LFREE
(
_q
, (
Pack‘
 *è* (
_ÿ·c™y
 + 1));

134 
_q
 = 0;

135 
	}
}

138 
	gSim¶eQueue
::
	$push
(, 
Pack‘
 *
p
)

142 
StÜage
::
šdex_ty³
 
h
 = 
	`h—d
(), 
t
 = 
	`
(), 
Á
 = 
	`Ãxt_i
(t);

145 ià(
Á
 !ğ
h
) {

146 
_q
[
t
] = 
p
;

147 
	`£t_
(
Á
);

149 
s
 = 
	`size
(
h
, 
Á
);

150 ià(
s
 > 
_highw©”_Ëngth
)

151 
_highw©”_Ëngth
 = 
s
;

155 ià(
_drİs
 =ğ0 && 
_ÿ·c™y
 > 0)

156 
	`şick_ch©‹r
("%p{–em’t}: ov”æow", 
this
);

157 
_drİs
++;

158 
	`checked_ouut_push
(1, 
p
);

160 
	}
}

162 
Pack‘
 *

163 
	gSim¶eQueue
::
	$puÎ
()

165  
	`deq
();

166 
	}
}

169 
SŒšg


170 
	gSim¶eQueue
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

172 
Sim¶eQueue
 *
q
 = 
¡©ic_ÿ¡
<Sim¶eQueu*>(
e
);

173 
which
 = 
»š‹½»t_ÿ¡
<
šŒ_t
>(
thunk
);

174 
which
) {

176  
	`SŒšg
(
q
->
	`size
());

178  
	`SŒšg
(
q
->
	`highw©”_Ëngth
());

180  
	`SŒšg
(
q
->
	`ÿ·c™y
());

182  
	`SŒšg
(
q
->
_drİs
);

186 
	}
}

189 
	gSim¶eQueue
::
	$»£t
()

191 
Pack‘
 *
p
 = 
	`puÎ
(0))

192 
	`checked_ouut_push
(1, 
p
);

193 
	}
}

196 
	gSim¶eQueue
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

198 
Sim¶eQueue
 *
q
 = 
¡©ic_ÿ¡
<Sim¶eQueu*>(
e
);

199 
which
 = 
»š‹½»t_ÿ¡
<
šŒ_t
>(
thunk
);

200 
which
) {

202 
q
->
_drİs
 = 0;

203 
q
->
_highw©”_Ëngth
 = q->
	`size
();

206 
q
->
	`»£t
();

209  
”rh
->
	`”rÜ
("internalƒrror");

211 
	}
}

214 
	gSim¶eQueue
::
	$add_hªdËrs
()

216 
	`add_»ad_hªdËr
("Ëngth", 
»ad_hªdËr
, 0);

217 
	`add_»ad_hªdËr
("highw©”_Ëngth", 
»ad_hªdËr
, 1);

218 
	`add_»ad_hªdËr
("ÿ·c™y", 
»ad_hªdËr
, 2, 
HªdËr
::
h_ÿlm
);

219 
	`add_»ad_hªdËr
("drİs", 
»ad_hªdËr
, 3);

220 
	`add_wr™e_hªdËr
("ÿ·c™y", 
»cÚfigu»_keywÜd_hªdËr
, "0 CAPACITY");

221 
	`add_wr™e_hªdËr
("»£t_couÁs", 
wr™e_hªdËr
, 0, 
HªdËr
::
h_bu‰Ú
 | HªdËr::
h_nÚexşusive
);

222 
	`add_wr™e_hªdËr
("»£t", 
wr™e_hªdËr
, 1, 
HªdËr
::
h_bu‰Ú
);

223 
	}
}

225 
CLICK_ENDDECLS


226 
	$ELEMENT_PROVIDES
(
StÜage
)

227 
	`EXPORT_ELEMENT
(
Sim¶eQueue
)

	@standard/simplequeue.hh

2 #iâdeà
CLICK_SIMPLEQUEUE_HH


3 
	#CLICK_SIMPLEQUEUE_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/¡ªd¬d/¡Üage.hh
>

6 
CLICK_DECLS


65 
şass
 
	gSim¶eQueue
 : 
public
 
EËm’t
,…ubliø
	gStÜage
 { 
	gpublic
:

67 
Sim¶eQueue
(è
CLICK_COLD
;

69 
drİs
(ècÚ¡ {  
	g_drİs
; }

70 
highw©”_Ëngth
(ècÚ¡ {  
	g_highw©”_Ëngth
; }

72 
šlše
 
boŞ
 
’q
(
Pack‘
*);

73 
šlše
 
lifo_’q
(
Pack‘
*);

74 
šlše
 
Pack‘
* 
deq
();

77 
Pack‘
* 
·ck‘
(
i
ècÚ¡ {  
	g_q
[i]; }

78 
»£t
();

80 
	g‹m¶©e
 <
ty³Çme
 
	gF‹r
> 
Pack‘
* 
yªk1
(
F‹r
);

81 
	g‹m¶©e
 <
ty³Çme
 
	gF‹r
> 
Pack‘
* 
yªk1_³ek
(
F‹r
);

82 
	g‹m¶©e
 <
ty³Çme
 
	gF‹r
> 
yªk
(
F‹r
, 
VeùÜ
<
Pack‘
 *> &);

84 cÚ¡ *
şass_Çme
() const {  "SimpleQueue"; }

85 cÚ¡ *
pÜt_couÁ
(ècÚ¡ {  
	gPORTS_1_1X2
; }

86 cÚ¡ *
´oûssšg
() const {  "h/lh"; }

87 * 
ÿ¡
(const *);

89 
cÚfigu»
(
VeùÜ
<
SŒšg
>&, 
E¼ÜHªdËr
*è
	gCLICK_COLD
;

90 
š™Ÿlize
(
E¼ÜHªdËr
*è
	gCLICK_COLD
;

91 
ş—nup
(
CËªupSge
è
	gCLICK_COLD
;

92 
boŞ
 
ÿn_live_»cÚfigu»
(ècÚ¡ {  
	gŒue
; }

93 
live_»cÚfigu»
(
VeùÜ
<
SŒšg
>&, 
E¼ÜHªdËr
*);

94 
ke_¡©e
(
EËm’t
*, 
E¼ÜHªdËr
*);

95 
add_hªdËrs
(è
	gCLICK_COLD
;

97 
push
(
pÜt
, 
Pack‘
*);

98 
Pack‘
* 
puÎ
(
pÜt
);

100 
	g´Ùeùed
:

102 
Pack‘
* vŞ©* 
_q
;

103 vŞ©
	g_drİs
;

104 
	g_highw©”_Ëngth
;

106 
ä›nd
 
şass
 
	gMixedQueue
;

107 
ä›nd
 
şass
 
	gTok’Queue
;

108 
ä›nd
 
şass
 
	gInOrd”Queue
;

109 
ä›nd
 
şass
 
	gECNQueue
;

111 
SŒšg
 
»ad_hªdËr
(
EËm’t
*, *è
	gCLICK_COLD
;

112 
wr™e_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*è
	gCLICK_COLD
;

117 
šlše
 
boŞ


118 
	gSim¶eQueue
::
	$’q
(
Pack‘
 *
p
)

120 
	`as£¹
(
p
);

121 
StÜage
::
šdex_ty³
 
h
 = 
	`h—d
(), 
t
 = 
	`
(), 
Á
 = 
	`Ãxt_i
(t);

122 ià(
Á
 !ğ
h
) {

123 
_q
[
t
] = 
p
;

124 
	`£t_
(
Á
);

125 
s
 = 
	`size
(
h
, 
Á
);

126 ià(
s
 > 
_highw©”_Ëngth
)

127 
_highw©”_Ëngth
 = 
s
;

128  
Œue
;

130 
p
->
	`kl
();

131 
_drİs
++;

132  
çl£
;

134 
	}
}

136 
šlše
 

137 
	gSim¶eQueue
::
	$lifo_’q
(
Pack‘
 *
p
)

141 
	`as£¹
(
p
);

142 
StÜage
::
šdex_ty³
 
h
 = 
	`h—d
(), 
t
 = 
	`
(), 
ph
 = 
	`´ev_i
(h);

143 ià(
ph
 =ğ
t
) {

144 
t
 = 
	`´ev_i
(t);

145 
_q
[
t
]->
	`kl
();

146 
	`£t_
(
t
);

148 
_q
[
ph
] = 
p
;

149 
	`£t_h—d_»Ëa£
(
ph
);

150 
	}
}

152 
šlše
 
Pack‘
 *

153 
	gSim¶eQueue
::
	$deq
()

155 
StÜage
::
šdex_ty³
 
h
 = 
	`h—d
(), 
t
 = 
	`
();

156 ià(
h
 !ğ
t
) {

157 
Pack‘
 *
p
 = 
_q
[
h
];

158 
	`£t_h—d
(
	`Ãxt_i
(
h
));

159 
	`as£¹
(
p
);

160  
p
;

163 
	}
}

165 
	g‹m¶©e
 <
ty³Çme
 
	gF‹r
>

166 
Pack‘
 *

167 
	gSim¶eQueue
::
	$yªk1
(
F‹r
 
f‹r
)

172 
StÜage
::
šdex_ty³
 
Œav
 = 
	`h—d
();¿v !ğ
	`
();¿v = 
	`Ãxt_i
(trav))

173 ià(
	`f‹r
(
_q
[
Œav
])) {

174 
Pack‘
 *
p
 = 
_q
[
Œav
];

175 
´ev
 = 
	`´ev_i
(
Œav
);

176 
Œav
 !ğ
	`h—d
()) {

177 
_q
[
Œav
] = _q[
´ev
];

178 
Œav
 = 
´ev
;

179 
´ev
 = 
	`´ev_i
(prev);

181 
	`£t_h—d
(
	`Ãxt_i
(
	`h—d
()));

182  
p
;

185 
	}
}

187 
	g‹m¶©e
 <
ty³Çme
 
	gF‹r
>

188 
Pack‘
 *

189 
	gSim¶eQueue
::
	$yªk1_³ek
(
F‹r
 
f‹r
)

194 
StÜage
::
šdex_ty³
 
Œav
 = 
	`h—d
();¿v !ğ
	`
();¿v = 
	`Ãxt_i
(trav))

195 ià(
	`f‹r
(
_q
[
Œav
])) {

196 
Pack‘
 *
p
 = 
_q
[
Œav
];

197  
p
;

200 
	}
}

202 
	g‹m¶©e
 <
ty³Çme
 
	gF‹r
>

204 
	gSim¶eQueue
::
yªk
(
F‹r
 
f‹r
, 
VeùÜ
<
Pack‘
 *> &
yªk_vec
)

211 
	gStÜage
::
šdex_ty³
 
wr™e_±r
 = 

();

212 
	gnyªked
 = 0;

213 
	gStÜage
::
šdex_ty³
 
Œav
 = 

(); 
	gŒav
 !ğ
h—d
(); ) {

214 
	gŒav
 = 
´ev_i
(
Œav
);

215 ià(
f‹r
(
_q
[
Œav
])) {

216 
	gyªk_vec
.
push_back
(
_q
[
Œav
]);

217 
	gnyªked
++;

219 
	gwr™e_±r
 = 
´ev_i
(
wr™e_±r
);

220 
	g_q
[
wr™e_±r
] = 
_q
[
Œav
];

223 
£t_h—d
(
wr™e_±r
);

224  
	gnyªked
;

227 
	gCLICK_ENDDECLS


	@standard/staticpullswitch.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¡©iıuÎsw™ch.hh
"

21 
	~<şick/¬gs.hh
>

22 
CLICK_DECLS


24 
	gSticPuÎSw™ch
::
	$SticPuÎSw™ch
()

26 
	}
}

29 
SticPuÎSw™ch
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

31 
	g_šput
 = 0;

32 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("INPUT", 
_šput
).
com¶‘e
() < 0)

34 ià(
	g_šput
 >ğ
nšputs
())

35 
_šput
 = -1;

39 
Pack‘
 *

40 
	gSticPuÎSw™ch
::
	$puÎ
()

42 ià(
_šput
 < 0)

45  
	`šput
(
_šput
).
	`puÎ
();

46 
	}
}

48 
CLICK_ENDDECLS


49 
	$EXPORT_ELEMENT
(
SticPuÎSw™ch
)

50 
	`ELEMENT_MT_SAFE
(
SticPuÎSw™ch
)

	@standard/staticpullswitch.hh

1 #iâdeà
CLICK_STATICPULLSWITCH_HH


2 
	#CLICK_STATICPULLSWITCH_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


24 şas 
	cSticPuÎSw™ch
 : 
public
 
EËm’t
 {

26 
_šput
;

28 
	mpublic
:

30 
	$SticPuÎSw™ch
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "StaticPullSwitch"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/1"; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

36 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

38 
Pack‘
 *
puÎ
();

42 
	gCLICK_ENDDECLS


	@standard/staticswitch.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¡©icsw™ch.hh
"

21 
	~<şick/¬gs.hh
>

22 
CLICK_DECLS


24 
	gSticSw™ch
::
	$SticSw™ch
()

26 
	}
}

29 
SticSw™ch
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

31 
	g_ouut
 = 0;

32 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("OUTPUT", 
_ouut
).
com¶‘e
() < 0)

34 ià(
	g_ouut
 >ğ
nouuts
())

35 
_ouut
 = -1;

40 
	gSticSw™ch
::
	$push
(, 
Pack‘
 *
p
)

42 ià(
_ouut
 < 0)

43 
p
->
	`kl
();

45 
	`ouut
(
_ouut
).
	`push
(
p
);

46 
	}
}

48 
CLICK_ENDDECLS


49 
	$EXPORT_ELEMENT
(
SticSw™ch
)

50 
	`ELEMENT_MT_SAFE
(
SticSw™ch
)

	@standard/staticswitch.hh

1 #iâdeà
CLICK_STATICSWITCH_HH


2 
	#CLICK_STATICSWITCH_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


24 şas 
	cSticSw™ch
 : 
public
 
EËm’t
 {

26 
_ouut
;

28 
	mpublic
:

30 
	$SticSw™ch
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "StaticSwitch"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

36 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

38 
push
(, 
Pack‘
 *);

42 
	gCLICK_ENDDECLS


	@standard/storedata.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¡Üed©a.hh
"

21 
	~<şick/¬gs.hh
>

22 
CLICK_DECLS


24 
	gStÜeD©a
::
	$StÜeD©a
()

26 
	}
}

29 
StÜeD©a
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

31  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("OFFSET", 
_off£t
)

32 .
»ad_mp
("DATA", 
_d©a
).
com¶‘e
();

35 
Pack‘
 *

36 
	gStÜeD©a
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

38 ià(
p
->
	`Ëngth
(è<ğ
_off£t
)

39  
p
;

40 ià(
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
()) {

41 
Ën
 = 
q
->
	`Ëngth
(è- 
_off£t
;

42 
	`memıy
(
q
->
	`d©a
(è+ 
_off£t
, 
_d©a
.d©a(), (_d©a.
	`Ëngth
(è< 
Ën
 ? _data.length() :†en));

43  
q
;

46 
	}
}

48 
CLICK_ENDDECLS


49 
	$EXPORT_ELEMENT
(
StÜeD©a
)

50 
	`ELEMENT_MT_SAFE
(
StÜeD©a
)

	@standard/storedata.hh

2 #iâdeà
CLICK_STOREDATA_HH


3 
	#CLICK_STOREDATA_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


17 şas 
	cStÜeD©a
 : 
public
 
EËm’t
 {…ublic:

19 
	$StÜeD©a
(è
CLICK_COLD
;

21 cÚ¡ *
	$şass_Çme
() const {  "StoreData"; }

22 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

23 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

25 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

27 
	g´iv©e
:

29 
_off£t
;

30 
SŒšg
 
	g_d©a
;

34 
	gCLICK_ENDDECLS


	@standard/stridesched.cc

20 
	~<şick/cÚfig.h
>

21 
	~"¡ridesched.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şick/”rÜ.hh
>

25 
CLICK_DECLS


27 
	gSŒideSched
::
	$SŒideSched
()

28 : 
	`_®l
(0), 
	$_li¡
(0)

30 
	}
}

33 
	gSŒideSched
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

35 ià(
	gcÚf
.
size
(è!ğ
nş›Ás
())

36  
”rh
->
”rÜ
("Ãed %d‡rgum’ts, oÃ…” % pÜt", 
nş›Ás
(),

37 (
´oûssšg
(è=ğ
PULL
 ? "input" : "output"));

39 
boŞ
 
	gfœ¡
 = !
_®l
;

40 ià(
	gfœ¡
 && !(
	g_®l
 = 
Ãw
 
Cl›Á
[
nş›Ás
()]))

41  
”rh
->
”rÜ
("out of memory");

43 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

44 
	gv
;

45 ià(!
IÁArg
().
·r£
(
cÚf
[
i
], 
v
))

46 
	g”rh
->
”rÜ
("¬gum’ˆ%d should bnumb” oàtick‘ (š‹g”)", 
i
);

47 ià(
	gv
 < 0)

48 
	g”rh
->
”rÜ
("¬gum’ˆ%d (numb” oàtick‘sèmu¡ b>ğ0", 
i
);

50 ià(
	gv
 > 
	gMAX_TICKETS
) {

51 
	g”rh
->
w¬nšg
("špuˆ%d%, tick‘ »duûdØ%d", 
i
, 
MAX_TICKETS
);

52 
	gv
 = 
MAX_TICKETS
;

54 
	g_®l
[
i
].
£t_tick‘s
(
v
);

55 ià(
	gfœ¡
)

56 
	g_®l
[
i
].
¡ride
();

61 
	g_li¡
 = 0;

62 
	gi
 = 
nş›Ás
() - 1; i >= 0; i--)

63 ià(
	g_®l
[
i
].
	g_tick‘s
)

64 
	g_®l
[
i
].
š£¹
(&
_li¡
);

66  
	g”rh
->
Ã¼Üs
() ? -1 : 0;

70 
	gSŒideSched
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

72 ià(
	`šput_is_puÎ
(0))

73 
i
 = 0; i < 
	`nş›Ás
(); ++i)

74 
_®l
[
i
].
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, i);

76 
	}
}

79 
	gSŒideSched
::
	$ş—nup
(
CËªupSge
)

81 
d–‘e
[] 
_®l
;

82 
	}
}

84 
Pack‘
 *

85 
	gSŒideSched
::
	$puÎ
()

88 
Cl›Á
 *
¡ridd’
 = 
_li¡
, *
c
;

89 
Pack‘
 *
p
 = 0;

90 
c
 = 
_li¡
; c && !
p
; c = c->
_Ãxt
) {

91 ià(
c
->
_sigÇl
)

92 
p
 = 
	`šput
(
c
 - 
_®l
).
	`puÎ
();

93 
c
->
	`¡ride
();

97 ià((
_li¡
 = 
c
))

98 
c
->
_µ»v
 = &
_li¡
;

101 
¡ridd’
 !ğ
c
) {

102 
Cl›Á
 *
Ãxt
 = 
¡ridd’
->
_Ãxt
;

103 
¡ridd’
->
	`š£¹
(&
_li¡
);

104 
¡ridd’
 = 
Ãxt
;

107  
p
;

108 
	}
}

111 
	gSŒideSched
::
	$tick‘s
(
pÜt
) const

113 ià((è
pÜt
 < (è
	`nş›Ás
())

114  
_®l
[
pÜt
].
_tick‘s
;

117 
	}
}

120 
	gSŒideSched
::
	$£t_tick‘s
(
pÜt
, 
tick‘s
, 
E¼ÜHªdËr
 *
”rh
)

122 ià((è
pÜt
 >ğ(è
	`nş›Ás
())

123  
”rh
->
	`”rÜ
("pÜˆ%d ouˆoà¿nge", 
pÜt
);

124 ià(
tick‘s
 < 0)

125  
”rh
->
	`”rÜ
("number ofickets must be >= 0");

126 ià(
tick‘s
 > 
MAX_TICKETS
) {

127 
”rh
->
	`w¬nšg
("pÜˆ%d%, tick‘ »duûdØ%d", 
pÜt
, 
MAX_TICKETS
);

128 
tick‘s
 = 
MAX_TICKETS
;

131 
Şd_tick‘s
 = 
_®l
[
pÜt
].
_tick‘s
;

132 
_®l
[
pÜt
].
	`£t_tick‘s
(
tick‘s
);

134 ià(
tick‘s
 =ğ0 && 
Şd_tick‘s
 != 0)

135 
_®l
[
pÜt
].
	`»move
();

136 ià(
tick‘s
 !ğ0 && 
Şd_tick‘s
 == 0) {

137 
_®l
[
pÜt
].
_·ss
 = (
_li¡
 ? _li¡->_·s + _®l[pÜt].
_¡ride
 : 0);

138 
_®l
[
pÜt
].
	`š£¹
(&
_li¡
);

141 
	}
}

143 
SŒšg


144 
	$»ad_tick‘s_hªdËr
(
EËm’t
 *
e
, *
thunk
)

146 
SŒideSched
 *
ss
 = (SŒideSched *)
e
;

147 
pÜt
 = (
šŒ_t
)
thunk
;

148  
	`SŒšg
(
ss
->
	`tick‘s
(
pÜt
));

149 
	}
}

152 
	$wr™e_tick‘s_hªdËr
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

154 
SŒideSched
 *
ss
 = (SŒideSched *)
e
;

155 
pÜt
 = (
šŒ_t
)
thunk
;

156 
tick‘s
;

157 ià(!
	`IÁArg
().
	`·r£
(
s
, 
tick‘s
))

158  
”rh
->
	`”rÜ
("tickets value must be integer");

160  
ss
->
	`£t_tick‘s
(
pÜt
, 
tick‘s
, 
”rh
);

161 
	}
}

163 
SŒšg


164 
	gSŒideSched
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *)

166 
SŒideSched
 *
ss
 = 
¡©ic_ÿ¡
<SŒideSched *>(
e
);

167 
SŒšgAccum
 
§
;

168 
i
 = 0; i < 
ss
->
	`nş›Ás
(); i++)

169 
§
 << (
i
 ? ", " : ""è<< 
ss
->
_®l
[i].
_tick‘s
;

170  
§
.
	`ke_¡ršg
();

171 
	}
}

174 
	gSŒideSched
::
	$add_hªdËrs
()

177 
šŒ_t
 
i
 = 0; i < 
	`nş›Ás
(); i++) {

178 
SŒšg
 
s
 = "tick‘s" + 
	`SŒšg
(
i
);

179 
	`add_»ad_hªdËr
(
s
, 
»ad_tick‘s_hªdËr
, 
i
);

180 
	`add_wr™e_hªdËr
(
s
, 
wr™e_tick‘s_hªdËr
, 
i
);

182 
	`add_»ad_hªdËr
("cÚfig", 
»ad_hªdËr
);

183 
	`£t_hªdËr_æags
("cÚfig", 0, 
HªdËr
::
CALM
);

184 
	}
}

186 
CLICK_ENDDECLS


187 
EXPORT_ELEMENT
(
SŒideSched
)

	@standard/stridesched.hh

2 #iâdeà
CLICK_STRIDESCHED_HH


3 
	#CLICK_STRIDESCHED_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şick/nÙif›r.hh
>

7 
CLICK_DECLS


35 şas 
	cSŒideSched
 : 
public
 
EËm’t
 {…ublic:

37 
	$SŒideSched
(è
CLICK_COLD
;

39 cÚ¡ *
	$şass_Çme
() const {  "StrideSched"; }

40 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1-/1"; 
	}
}

41 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

42 cÚ¡ *
	$æags
(ècÚ¡ {  "S0"; 
	}
}

44 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

45 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

46 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

47 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

48 
	$add_hªdËrs
(è
CLICK_COLD
;

50 ’um { 
STRIDE1
 = 1U<<16, 
MAX_TICKETS
 = 1U<<15 
	}
};

51 
	$tick‘s
() const;

52 
	`£t_tick‘s
(, , 
E¼ÜHªdËr
 *);

54 
Pack‘
 *
	`puÎ
(
pÜt
);

56 
´Ùeùed
:

58 
	sCl›Á
 {

59 
Cl›Á
 **
_µ»v
;

60 
Cl›Á
 *
_Ãxt
;

61 
_·ss
;

62 
_¡ride
;

63 
_tick‘s
;

64 
NÙif›rSigÇl
 
_sigÇl
;

66 
	`Cl›Á
()

67 : 
	`_µ»v
(0), 
	`_Ãxt
(0), 
	`_·ss
(0), 
	`_¡ride
(0), 
	`_tick‘s
(-1) {

70 
	`£t_tick‘s
(
t
) {

71 
_tick‘s
 = 
t
;

72 
_¡ride
 = 
t
 ? 
STRIDE1
 / : 0;

74 
	`¡ride
() {

75 
_·ss
 +ğ
_¡ride
;

78 
	`š£¹
(
Cl›Á
 **
li¡
) {

79 
_µ»v
 = 
li¡
;

80 (
_Ãxt
 = *
_µ»v
è&& 
	`PASS_GT
(
_·ss
, _next->_pass))

81 
_µ»v
 = &
_Ãxt
->_next;

82 *
_µ»v
 = 
this
;

83 ià(
_Ãxt
)

84 
_Ãxt
->
_µ»v
 = &_next;

86 
	`»move
() {

87 ià((*
_µ»v
 = 
_Ãxt
))

88 
_Ãxt
->
_µ»v
 = _pprev;

90 
	}
};

92 
Cl›Á
 *
	g_®l
;

93 
Cl›Á
 *
	g_li¡
;

95 
	$nş›Ás
() const {

96  
	`šput_is_puÎ
(0è? 
	`nšputs
(è: 
	`nouuts
();

97 
	}
}

98 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

100 
	}
};

102 
	gCLICK_ENDDECLS


	@standard/strideswitch.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¡ridesw™ch.hh
"

21 
	~<şick/cÚå¬£.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gSŒideSw™ch
::
	$SŒideSw™ch
()

27 
	}
}

30 
SŒideSw™ch
::
	$push
(, 
Pack‘
 *
p
)

32 ià(
_li¡
) {

33 
Cl›Á
 *
¡ridd’
 = 
_li¡
;

34 ià((
_li¡
 = 
¡ridd’
->
_Ãxt
))

35 
_li¡
->
_µ»v
 = &_list;

36 
¡ridd’
->
	`¡ride
();

37 
¡ridd’
->
	`š£¹
(&
_li¡
);

38 
	`ouut
(
¡ridd’
 - 
_®l
).
	`push
(
p
);

40 
p
->
	`kl
();

41 
	}
}

43 
CLICK_ENDDECLS


44 
	$ELEMENT_REQUIRES
(
SŒideSched
)

45 
	`EXPORT_ELEMENT
(
SŒideSw™ch
)

	@standard/strideswitch.hh

1 #iâdeà
CLICK_STRIDESWITCH_HH


2 
	#CLICK_STRIDESWITCH_HH


	)

3 
	~"–em’ts/¡ªd¬d/¡ridesched.hh
"

4 
CLICK_DECLS


24 şas 
	cSŒideSw™ch
 : 
public
 
SŒideSched
 {…ublic:

26 
	$SŒideSw™ch
(è
CLICK_COLD
;

28 cÚ¡ *
	$şass_Çme
() const {  "StrideSwitch"; }

29 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-"; 
	}
}

30 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

32 
push
(, 
Pack‘
 *);

36 
	gCLICK_ENDDECLS


	@standard/strip.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¡r.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
CLICK_DECLS


26 
	gSŒ
::
	$SŒ
()

28 
	}
}

31 
SŒ
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

33  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("LENGTH", 
_nby‹s
).
com¶‘e
();

36 
Pack‘
 *

37 
	gSŒ
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

39 
p
->
	`puÎ
(
_nby‹s
);

40  
p
;

41 
	}
}

43 
CLICK_ENDDECLS


44 
	$EXPORT_ELEMENT
(
SŒ
)

45 
	`ELEMENT_MT_SAFE
(
SŒ
)

	@standard/strip.hh

2 #iâdeà
CLICK_STRIP_HH


3 
	#CLICK_STRIP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


21 şas 
	cSŒ
 : 
public
 
EËm’t
 {…ublic:

23 
	$SŒ
(è
CLICK_COLD
;

25 cÚ¡ *
	$şass_Çme
() const {  "Strip"; }

26 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

28 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

30 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

32 
	g´iv©e
:

34 
_nby‹s
;

38 
	gCLICK_ENDDECLS


	@standard/striptonet.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¡rtÚ‘.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
CLICK_DECLS


25 
	gSŒToN‘wÜkH—d”
::
	$SŒToN‘wÜkH—d”
()

27 
	}
}

29 
Pack‘
 *

30 
SŒToN‘wÜkH—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

32 
off
 = 
p
->
	`ÃtwÜk_h—d”_off£t
();

33 ià(
off
 >= 0) {

34 
p
->
	`puÎ
(
off
);

35  
p
;

37  
p
->
	`nÚunique_push
(-
off
);

38 
	}
}

40 
CLICK_ENDDECLS


41 
	$EXPORT_ELEMENT
(
SŒToN‘wÜkH—d”
)

42 
	`ELEMENT_MT_SAFE
(
SŒToN‘wÜkH—d”
)

	@standard/striptonet.hh

2 #iâdeà
CLICK_STRIPTONET_HH


3 
	#CLICK_STRIPTONET_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


28 şas 
	cSŒToN‘wÜkH—d”
 : 
public
 
EËm’t
 {…ublic:

30 
	$SŒToN‘wÜkH—d”
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "StripToNetworkHeader"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

35 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

39 
	gCLICK_ENDDECLS


	@standard/suppressor.cc

18 
	~<şick/cÚfig.h
>

19 
	~"suµ»ssÜ.hh
"

20 
	~<şick/b™veùÜ.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gSuµ»ssÜ
::
	$Suµ»ssÜ
()

27 
	}
}

30 
Suµ»ssÜ
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *)

32 
	g_suµ»s£d
.
assign
(
nouuts
(), 
çl£
);

37 
	gSuµ»ssÜ
::
	$push
(
sourû
, 
Pack‘
 *
p
)

39 ià(
	`suµ»s£d
(
sourû
))

40 
p
->
	`kl
();

42 
	`ouut
(
sourû
).
	`push
(
p
);

43 
	}
}

45 
Pack‘
 *

46 
	gSuµ»ssÜ
::
	$puÎ
(
sourû
)

48 ià(
	`suµ»s£d
(
sourû
))

51  
	`šput
(
sourû
).
	`puÎ
();

52 
	}
}

54 
SŒšg


55 
	$»ad_aùive
(
EËm’t
 *
e
, *
thunk
)

57 
Suµ»ssÜ
 *
sup
 = 
¡©ic_ÿ¡
<Suµ»ssÜ *>(
e
);

58 
pÜt
 = (è
»š‹½»t_ÿ¡
<
šŒ_t
>(
thunk
);

59  (
sup
->
	`suµ»s£d
(
pÜt
) ? "false" : "true");

60 
	}
}

63 
	$wr™e_aùive
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

65 
Suµ»ssÜ
 *
sup
 = 
¡©ic_ÿ¡
<Suµ»ssÜ *>(
e
);

66 
pÜt
 = (è
»š‹½»t_ÿ¡
<
šŒ_t
>(
thunk
);

67 
boŞ
 
aùive
;

68 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
aùive
))

69  
”rh
->
	`”rÜ
("type mismatch");

71 
sup
->
	`£t
(
pÜt
, !
aùive
);

74 
	}
}

77 
	$wr™e_»£t
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

79 
Suµ»ssÜ
 *
sup
 = 
¡©ic_ÿ¡
<Suµ»ssÜ *>(
e
);

80 
sup
->
	`®low_®l
();

82 
	}
}

85 
	gSuµ»ssÜ
::
	$add_hªdËrs
()

87 
i
 = 0; i < 
	`nšputs
(); i++) {

88 
SŒšg
 
s
 = "aùive" + 
	`SŒšg
(
i
);

89 
	`add_»ad_hªdËr
(
s
, 
»ad_aùive
, 
i
, 
HªdËr
::
CHECKBOX
);

90 
	`add_wr™e_hªdËr
(
s
, 
wr™e_aùive
, 
i
);

92 
	`add_wr™e_hªdËr
("»£t", 
wr™e_»£t
, 0, 
HªdËr
::
BUTTON
);

93 
	}
}

95 
CLICK_ENDDECLS


96 
EXPORT_ELEMENT
(
Suµ»ssÜ
)

	@standard/suppressor.hh

1 #iâdeà
CLICK_SUPPRESSOR_HH


2 
	#CLICK_SUPPRESSOR_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/b™veùÜ.hh
>

5 
CLICK_DECLS


27 şas 
	cSuµ»ssÜ
 : 
public
 
EËm’t
 {…ublic:

29 
	$Suµ»ssÜ
(è
CLICK_COLD
;

31 cÚ¡ *
	$şass_Çme
() const {  "Suppressor"; }

32 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/="; 
	}
}

33 cÚ¡ *
	$æow_code
(ècÚ¡ {  "#/#"; 
	}
}

35 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

36 
	$add_hªdËrs
(è
CLICK_COLD
;

38 
	`push
(
pÜt
, 
Pack‘
 *
p
);

39 
Pack‘
 *
	`puÎ
(
pÜt
);

41 
boŞ
 
	$suµ»s£d
(
ouut
ècÚ¡ {  
_suµ»s£d
[ouut]; 
	}
}

42 
	$suµ»ss
(
ouut
è{ 
_suµ»s£d
[ouut] = 
Œue
; 
	}
}

43 
	$®low
(
ouut
è{ 
_suµ»s£d
[ouut] = 
çl£
; 
	}
}

44 
	$®low_®l
(è{ 
_suµ»s£d
.
	`ş—r
(); 
	}
}

45 
	$£t
(
ouut
, 
boŞ
 
suµ»s£d
è{ 
_suµ»s£d
[ouut] = suµ»s£d; 
	}
}

47 
	g´iv©e
:

49 
B™veùÜ
 
_suµ»s£d
;

53 
	gCLICK_ENDDECLS


	@standard/switch.cc

18 
	~<şick/cÚfig.h
>

19 
	~"sw™ch.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/Î½c.h
>

23 
CLICK_DECLS


25 
	gSw™ch
::
	$Sw™ch
()

27 
	}
}

30 
Sw™ch
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

32 
	gouut
 = 0;

33 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("OUTPUT", 
ouut
).
com¶‘e
() < 0)

35 ià(
	gouut
 >ğ
nouuts
())

36  
”rh
->
”rÜ
("ouuˆmu¡ b< %d", 
nouuts
());

37 
	g_ouut
 = 
ouut
;

42 
	gSw™ch
::
	$push
(, 
Pack‘
 *
p
)

44 
	`checked_ouut_push
(
_ouut
, 
p
);

45 
	}
}

47 
SŒšg


48 
	gSw™ch
::
	$»ad_·¿m
(
EËm’t
 *
e
, *)

50 
Sw™ch
 *
sw
 = (Sw™ch *)
e
;

51  
	`SŒšg
(
sw
->
_ouut
);

52 
	}
}

55 
	gSw™ch
::
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

57 
Sw™ch
 *
sw
 = (Sw™ch *)
e
;

58 
sw_ouut
;

59 ià(!
	`IÁArg
().
	`·r£
(
s
, 
sw_ouut
))

60  
”rh
->
	`”rÜ
("Switch output must be integer");

61 ià(
sw_ouut
 >ğ
sw
->
	`nouuts
())

62 
sw_ouut
 = -1;

63 
sw
->
_ouut
 = 
sw_ouut
;

65 
	}
}

68 
	gSw™ch
::
	$add_hªdËrs
()

70 
	`add_»ad_hªdËr
("sw™ch", 
»ad_·¿m
, 0);

71 
	`add_wr™e_hªdËr
("sw™ch", 
wr™e_·¿m
, 0, 
HªdËr
::
h_nÚexşusive
);

72 
	`add_»ad_hªdËr
("cÚfig", 
»ad_·¿m
, 0);

73 
	`£t_hªdËr_æags
("cÚfig", 0, 
HªdËr
::
CALM
);

74 
	}
}

77 
	gSw™ch
::
	$Î½c
(
commªd
, *
d©a
)

79 ià(
commªd
 =ğ
CLICK_LLRPC_SET_SWITCH
) {

80 
št32_t
 *
v®
 = 
»š‹½»t_ÿ¡
<št32_ˆ*>(
d©a
);

81 ià(*
v®
 >ğ
	`nouuts
())

82  -
EINVAL
;

83 
_ouut
 = *
v®
;

86 } ià(
commªd
 =ğ
CLICK_LLRPC_GET_SWITCH
) {

87 
št32_t
 *
v®
 = 
»š‹½»t_ÿ¡
<št32_ˆ*>(
d©a
);

88 *
v®
 = 
_ouut
;

92  
EËm’t
::
	`Î½c
(
commªd
, 
d©a
);

93 
	}
}

95 
CLICK_ENDDECLS


96 
	$EXPORT_ELEMENT
(
Sw™ch
)

97 
	`ELEMENT_MT_SAFE
(
Sw™ch
)

	@standard/switch.hh

1 #iâdeà
CLICK_SWITCH_HH


2 
	#CLICK_SWITCH_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


38 şas 
	cSw™ch
 : 
public
 
EËm’t
 {…ublic:

40 
	$Sw™ch
(è
CLICK_COLD
;

42 cÚ¡ *
	$şass_Çme
() const {  "Switch"; }

43 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

44 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

45 
	$add_hªdËrs
(è
CLICK_COLD
;

47 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

48 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

50 
push
(, 
Pack‘
 *);

52 
Î½c
(, *);

54 
	g´iv©e
:

56 
_ouut
;

58 
SŒšg
 
	$»ad_·¿m
(
EËm’t
 *, *è
CLICK_COLD
;

59 
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

61 
	}
};

63 
	gCLICK_ENDDECLS


	@standard/tee.cc

18 
	~<şick/cÚfig.h
>

19 
	~"‹e.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
CLICK_DECLS


24 
	gT“
::
	$T“
()

26 
	}
}

29 
T“
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

31 
	gn
 = 
nouuts
();

32 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("N", 
n
).
com¶‘e
() < 0)

34 ià(
	gn
 !ğ(è
nouuts
())

35  
”rh
->
”rÜ
("%d ouut im¶› %d‡rms", 
nouuts
(),‚outputs());

40 
	gT“
::
	$push
(, 
Pack‘
 *
p
)

42 
n
 = 
	`nouuts
();

43 
i
 = 0; i < 
n
 - 1; i++)

44 ià(
Pack‘
 *
q
 = 
p
->
	`şÚe
())

45 
	`ouut
(
i
).
	`push
(
q
);

46 
	`ouut
(
n
 - 1).
	`push
(
p
);

47 
	}
}

53 
	gPuÎT“
::
	$PuÎT“
()

55 
	}
}

58 
PuÎT“
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

60 
	gn
 = 
nouuts
();

61 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("N", 
n
).
com¶‘e
() < 0)

63 ià(
	gn
 !ğ(è
nouuts
())

64  
”rh
->
”rÜ
("%d ouut im¶› %d‡rms", 
nouuts
(),‚outputs());

68 
Pack‘
 *

69 
	gPuÎT“
::
	$puÎ
()

71 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

72 ià(
p
) {

73 
n
 = 
	`nouuts
();

74 
i
 = 1; i < 
n
; i++)

75 ià(
Pack‘
 *
q
 = 
p
->
	`şÚe
())

76 
	`ouut
(
i
).
	`push
(
q
);

78  
p
;

79 
	}
}

81 
CLICK_ENDDECLS


82 
	$EXPORT_ELEMENT
(
T“
 
PuÎT“
)

83 
	$ELEMENT_MT_SAFE
(
T“
)

84 
	`ELEMENT_MT_SAFE
(
PuÎT“
)

	@standard/tee.hh

1 #iâdeà
CLICK_TEE_HH


2 
	#CLICK_TEE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


25 şas 
	cT“
 : 
public
 
EËm’t
 {

27 
public
:

29 
	$T“
(è
CLICK_COLD
;

31 cÚ¡ *
	$şass_Çme
() const {  "Tee"; }

32 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-"; 
	}
}

33 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

35 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

37 
push
(, 
Pack‘
 *);

41 şas 
	cPuÎT“
 : 
public
 
EËm’t
 {

43 
public
:

45 
	$PuÎT“
(è
CLICK_COLD
;

47 cÚ¡ *
	$şass_Çme
() const {  "PullTee"; }

48 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-"; 
	}
}

49 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "l/lh"; 
	}
}

51 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

53 
Pack‘
 *
puÎ
();

57 
	gCLICK_ENDDECLS


	@standard/threadsafequeue.cc

19 
	~<şick/cÚfig.h
>

20 
	~"th»ad§ãqueue.hh
"

21 
CLICK_DECLS


23 
	gTh»adSaãQueue
::
	$Th»adSaãQueue
()

25 
_xh—d
 = 
_x
 = 0;

26 
	}
}

29 
	gTh»adSaãQueue
::
	$ÿ¡
(cÚ¡ *
n
)

31 ià(
	`¡rcmp
(
n
, "ThreadSafeQueue") == 0)

32  (
Th»adSaãQueue
 *)
this
;

34  
FuÎNÙeQueue
::
	`ÿ¡
(
n
);

35 
	}
}

38 
	gTh»adSaãQueue
::
live_»cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40 
	gr
 = 
NÙif›rQueue
::
live_»cÚfigu»
(
cÚf
, 
”rh
);

41 ià(
	gr
 >ğ0 && 
size
(è< 
ÿ·c™y
(è&& 
_q
)

42 
_fuÎ_nÙe
.
wake
();

43 
	g_xh—d
 = 
h—d
();

44 
	g_x
 = 

();

45  
	gr
;

49 
	gTh»adSaãQueue
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *
”rh
)

51 
Sim¶eQueue
 *
q
 = (Sim¶eQueu*)
e
->
	`ÿ¡
("SimpleQueue");

52 ià(!
q
)

55 
Sim¶eQueue
::
	`ke_¡©e
(
e
, 
”rh
);

56 
_xh—d
 = 
	`h—d
();

57 
_x
 = 
	`
();

58 
	}
}

61 
	gTh»adSaãQueue
::
	$push
(, 
Pack‘
 *
p
)

66 
StÜage
::
šdex_ty³
 
t
, 
Á
;

68 
t
 = 
	`
();

69 
Á
 = 
	`Ãxt_i
(
t
);

70 } 
_x
.
	`com·»_sw­
(
t
, 
Á
) !=);

73 
StÜage
::
šdex_ty³
 
h
 = 
	`h—d
();

74 ià(
Á
 !ğ
h
)

75 
	`push_sucûss
(
h
, 
t
, 
Á
, 
p
);

77 
_x
 = 
t
;

78 
	`push_çu»
(
p
);

80 
	}
}

82 
Pack‘
 *

83 
	gTh»adSaãQueue
::
	$puÎ
()

88 
StÜage
::
šdex_ty³
 
h
, 
nh
;

90 
h
 = 
	`h—d
();

91 
nh
 = 
	`Ãxt_i
(
h
);

92 } 
_xh—d
.
	`com·»_sw­
(
h
, 
nh
) != h);

95 
StÜage
::
šdex_ty³
 
t
 = 
	`
();

96 ià(
t
 !ğ
h
)

97  
	`puÎ_sucûss
(
h
, 
nh
);

99 
_xh—d
 = 
h
;

100  
	`puÎ_çu»
();

102 
	}
}

104 
CLICK_ENDDECLS


105 
	$ELEMENT_REQUIRES
(
FuÎNÙeQueue
)

106 
	`EXPORT_ELEMENT
(
Th»adSaãQueue
)

	@standard/threadsafequeue.hh

2 #iâdeà
CLICK_THREADSAFEQUEUE_HH


3 
	#CLICK_THREADSAFEQUEUE_HH


	)

4 
	~"fuÎnÙequeue.hh
"

5 
CLICK_DECLS


54 şas 
	cTh»adSaãQueue
 : 
public
 
FuÎNÙeQueue
 {…ublic:

56 
	$Th»adSaãQueue
(è
CLICK_COLD
;

58 cÚ¡ *
	$şass_Çme
() const {  "ThreadSafeQueue"; }

59 *
	`ÿ¡
(const *);

61 
	`live_»cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
);

62 
	`ke_¡©e
(
EËm’t
*, 
E¼ÜHªdËr
*);

64 
	`push
(
pÜt
, 
Pack‘
 *);

65 
Pack‘
 *
	`puÎ
(
pÜt
);

67 
´iv©e
:

69 
©omic_ušt32_t
 
_xh—d
;

70 
©omic_ušt32_t
 
_x
;

72 
	}
};

74 
	gCLICK_ENDDECLS


	@standard/timedsink.cc

18 
	~<şick/cÚfig.h
>

19 
	~"timedsšk.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
CLICK_DECLS


25 
	gTimedSšk
::
	$TimedSšk
()

26 : 
	`_tim”
(
this
), 
	`_š‹rv®
(0, 
Time¡amp
::
sub£c_³r_£c
 / 2)

28 
	}
}

31 
TimedSšk
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

33  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("INTERVAL", 
_š‹rv®
).
com¶‘e
();

37 
	gTimedSšk
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

39 
_tim”
.
	`š™Ÿlize
(
this
);

40 
_tim”
.
	`scheduË_aá”
(
_š‹rv®
);

42 
	}
}

45 
	gTimedSšk
::
	$run_tim”
(
Tim”
 *)

47 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

48 ià(
p
)

49 
p
->
	`kl
();

50 
_tim”
.
	`»scheduË_aá”
(
_š‹rv®
);

51 
	}
}

53 ’um { 
	mH_INTERVAL
 };

55 
SŒšg


56 
	gTimedSšk
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
v·¿m
)

58 
TimedSšk
 *
ts
 = 
¡©ic_ÿ¡
<TimedSšk *>(
e
);

59 (
šŒ_t
)
v·¿m
) {

60 
H_INTERVAL
:

61  
ts
->
_š‹rv®
.
	`uÅ¬£_š‹rv®
();

65 
	}
}

68 
	gTimedSšk
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *
v·¿m
,

69 
E¼ÜHªdËr
 *
”rh
)

71 
TimedSšk
 *
ts
 = 
¡©ic_ÿ¡
<TimedSšk *>(
e
);

72 (
šŒ_t
)
v·¿m
) {

73 
H_INTERVAL
: {

74 
Time¡amp
 
š‹rv®
;

75 ià(!
	`ı_time
(
s
, &
š‹rv®
) || !interval)

76  
”rh
->
	`”rÜ
("bad interval");

77 
ts
->
_š‹rv®
 = 
š‹rv®
;

82 
	}
}

85 
	gTimedSšk
::
	$add_hªdËrs
()

87 
	`add_»ad_hªdËr
("š‹rv®", 
»ad_hªdËr
, 
H_INTERVAL
, 
HªdËr
::
CALM
);

88 
	`add_wr™e_hªdËr
("š‹rv®", 
wr™e_hªdËr
, 
H_INTERVAL
);

89 
	}
}

91 
CLICK_ENDDECLS


92 
	$EXPORT_ELEMENT
(
TimedSšk
)

93 
	`ELEMENT_MT_SAFE
(
TimedSšk
)

	@standard/timedsink.hh

1 #iâdeà
CLICK_TIMEDSINK_HH


2 
	#CLICK_TIMEDSINK_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tim”.hh
>

5 
CLICK_DECLS


20 şas 
	cTimedSšk
 : 
public
 
EËm’t
 {…ublic:

22 
	$TimedSšk
(è
CLICK_COLD
;

24 cÚ¡ *
	$şass_Çme
() const {  "TimedSink"; }

25 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_0
; 
	}
}

26 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

28 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

30 
	$add_hªdËrs
(è
CLICK_COLD
;

32 
	`run_tim”
(
Tim”
 *);

34 
´iv©e
:

36 
Tim”
 
_tim”
;

37 
Time¡amp
 
_š‹rv®
;

39 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

40 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

42 
	}
};

44 
	gCLICK_ENDDECLS


	@standard/timedsource.cc

18 
	~<şick/cÚfig.h
>

19 
	~"timedsourû.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/rou‹r.hh
>

24 
CLICK_DECLS


26 
	gTimedSourû
::
	$TimedSourû
()

27 : 
	`_·ck‘
(0), 
	`_š‹rv®
(0, 
Time¡amp
::
sub£c_³r_£c
 / 2), 
	`_lim™
(-1),

28 
	`_couÁ
(0), 
	`_aùive
(
Œue
), 
	`_¡İ
(
çl£
), 
	`_tim”
(
this
),

29 
	$_h—droom
(
Pack‘
::
deçuÉ_h—droom
)

31 
	}
}

34 
TimedSourû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
SŒšg
 
	gd©a
 = "Random bullshit in‡…acket,‡t†east 64 bytes†ong. Well,‚ow it is.";

38 ià(
Args
(
cÚf
, 
this
, 
”rh
)

39 .
»ad_p
("INTERVAL", 
_š‹rv®
)

40 .
»ad_p
("DATA", 
d©a
)

41 .
»ad
("LIMIT", 
_lim™
)

42 .
»ad
("ACTIVE", 
_aùive
)

43 .
»ad
("STOP", 
_¡İ
)

44 .
»ad
("HEADROOM", 
_h—droom
)

45 .
com¶‘e
() < 0)

48 
	g_d©a
 = 
d©a
;

49 ià(
	g_·ck‘
)

50 
	g_·ck‘
->
kl
();

51 
	g_·ck‘
 = 
Pack‘
::
make
(
_h—droom
, 
_d©a
.
d©a
(), _d©a.
Ëngth
(), 0);

56 
	gTimedSourû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

58 
_tim”
.
	`š™Ÿlize
(
this
);

59 ià(
_aùive
)

60 
_tim”
.
	`scheduË_aá”
(
_š‹rv®
);

62 
	}
}

65 
	gTimedSourû
::
	$ş—nup
(
CËªupSge
)

67 ià(
_·ck‘
)

68 
_·ck‘
->
	`kl
();

69 
_·ck‘
 = 0;

70 
	}
}

73 
	gTimedSourû
::
	$run_tim”
(
Tim”
 *)

75 ià(!
_aùive
)

77 ià(
_lim™
 < 0 || 
_couÁ
 < _limit) {

78 
Pack‘
 *
p
 = 
_·ck‘
->
	`şÚe
();

79 
p
->
	`time¡amp_ªno
().
	`assign_now
();

80 
	`ouut
(0).
	`push
(
p
);

81 
_couÁ
++;

82 
_tim”
.
	`»scheduË_aá”
(
_š‹rv®
);

83 } ià(
_¡İ
)

84 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

85 
	}
}

87 
SŒšg


88 
	gTimedSourû
::
	$»ad_·¿m
(
EËm’t
 *
e
, *
v·¿m
)

90 
TimedSourû
 *
ts
 = (TimedSourû *)
e
;

91 (
šŒ_t
)
v·¿m
) {

92 
h_š‹rv®
:

93  
ts
->
_š‹rv®
.
	`uÅ¬£_š‹rv®
();

97 
	}
}

100 
	gTimedSourû
::
	$chªge_·¿m
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *
v·¿m
,

101 
E¼ÜHªdËr
 *
”rh
)

103 
TimedSourû
 *
ts
 = (TimedSourû *)
e
;

104 (
šŒ_t
)
v·¿m
) {

106 
h_d©a
:

107 
ts
->
_d©a
 = 
s
;

108 
»make_·ck‘
;

110 
h_h—droom
:

111 ià(!
	`IÁArg
().
	`·r£
(
s
, 
ts
->
_h—droom
))

112  
”rh
->
	`”rÜ
("bad headroom");

113 
»make_·ck‘
;

115 
»make_·ck‘
: {

116 
Pack‘
 *
p
 = Pack‘::
	`make
(
ts
->
_h—droom
,s->
_d©a
.
	`d©a
(),s->_d©a.
	`Ëngth
(), 0);

117 ià(!
p
)

118  
”rh
->
	`”rÜ
("ouˆoàmemÜy"), -
ENOMEM
;

119 ià(
ts
->
_·ck‘
)

120 
ts
->
_·ck‘
->
	`kl
();

121 
ts
->
_·ck‘
 = 
p
;

125 
h_š‹rv®
: {

126 
Time¡amp
 
š‹rv®
;

127 ià(!
	`ı_time
(
s
, &
š‹rv®
) || !interval)

128  
”rh
->
	`”rÜ
("bad interval");

129 
ts
->
_š‹rv®
 = 
š‹rv®
;

133 
h_aùive
: {

134 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
ts
->
_aùive
))

135  
”rh
->
	`”rÜ
("bad‡ctive");

136 ià(!
ts
->
_tim”
.
	`scheduËd
(è&&s->
_aùive
)

137 
ts
->
_tim”
.
	`scheduË_now
();

141 
h_»£t
: {

142 
ts
->
_couÁ
 = 0;

143 ià(!
ts
->
_tim”
.
	`scheduËd
(è&&s->
_aùive
)

144 
ts
->
_tim”
.
	`scheduË_now
();

150 
	}
}

153 
	gTimedSourû
::
	$add_hªdËrs
()

155 
	`add_d©a_hªdËrs
("d©a", 
HªdËr
::
OP_READ
 | HªdËr::
CALM
, &
_d©a
);

156 
	`add_wr™e_hªdËr
("d©a", 
chªge_·¿m
, 
h_d©a
, 
HªdËr
::
RAW
);

157 
	`add_d©a_hªdËrs
("lim™", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
 | HªdËr::
CALM
, &
_lim™
);

158 
	`add_»ad_hªdËr
("š‹rv®", 
»ad_·¿m
, 
h_š‹rv®
, 
HªdËr
::
CALM
);

159 
	`add_wr™e_hªdËr
("š‹rv®", 
chªge_·¿m
, 
h_š‹rv®
);

160 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
OP_READ
 | HªdËr::
CALM
 | HªdËr::
CHECKBOX
, &
_aùive
);

161 
	`add_wr™e_hªdËr
("aùive", 
chªge_·¿m
, 
h_aùive
);

162 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
OP_READ
, &
_couÁ
);

163 
	`add_d©a_hªdËrs
("h—droom", 
HªdËr
::
OP_READ
 | HªdËr::
CALM
, &
_h—droom
);

164 
	`add_wr™e_hªdËr
("h—droom", 
chªge_·¿m
, 
h_h—droom
);

165 
	`add_wr™e_hªdËr
("»£t", 
chªge_·¿m
, 
h_»£t
, 
HªdËr
::
BUTTON
);

166 
	}
}

168 
CLICK_ENDDECLS


169 
	$EXPORT_ELEMENT
(
TimedSourû
)

170 
	`ELEMENT_MT_SAFE
(
TimedSourû
)

	@standard/timedsource.hh

1 #iâdeà
CLICK_TIMEDSOURCE_HH


2 
	#CLICK_TIMEDSOURCE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tim”.hh
>

5 
CLICK_DECLS


65 şas 
	cTimedSourû
 : 
public
 
EËm’t
 {…ublic:

67 
	$TimedSourû
(è
CLICK_COLD
;

69 cÚ¡ *
	$şass_Çme
() const {  "TimedSource"; }

70 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

71 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

73 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

74 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

75 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

76 
	$add_hªdËrs
(è
CLICK_COLD
;

78 
	`run_tim”
(
Tim”
 *);

80 
´iv©e
:

82 
Pack‘
 *
_·ck‘
;

83 
Time¡amp
 
_š‹rv®
;

84 
_lim™
;

85 
_couÁ
;

86 
boŞ
 
_aùive
;

87 
boŞ
 
_¡İ
;

88 
Tim”
 
_tim”
;

89 
SŒšg
 
_d©a
;

90 
ušt32_t
 
_h—droom
;

92 ’um { 
h_d©a
, 
h_š‹rv®
, 
h_aùive
, 
h_»£t
, 
h_h—droom
 
	}
};

93 
SŒšg
 
	$»ad_·¿m
(
EËm’t
 *, *è
CLICK_COLD
;

94 
	`chªge_·¿m
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *);

96 
	}
};

98 
	gCLICK_ENDDECLS


	@standard/timedunqueue.cc

20 
	~<şick/cÚfig.h
>

21 
	~"timedunqueue.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

24 
	~<şick/”rÜ.hh
>

25 
CLICK_DECLS


27 
	gTimedUnqueue
::
	$TimedUnqueue
()

28 : 
	`_bur¡
(1), 
	`_sk
(
this
), 
	$_tim”
(&
_sk
)

30 
	}
}

33 
	gTimedUnqueue
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

35 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("INTERVAL", 
SecÚdsArg
(3), 
_š‹rv®
)

36 .
»ad_p
("BURST", 
_bur¡
).
com¶‘e
() < 0)

38 ià(
	g_bur¡
 <= 0)

39  
”rh
->
”rÜ
("bad BURST");

44 
	gTimedUnqueue
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

46 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
Œue
, 
”rh
);

47 
_tim”
.
	`š™Ÿlize
(
this
);

48 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

50 
	}
}

52 
boŞ


53 
	gTimedUnqueue
::
	$run_sk
(
Task
 *)

57 ià(
_tim”
.
	`scheduËd
())

58  
çl£
;

60 
i
 = 0; i < 
_bur¡
; i++) {

61 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

62 ià(!
p
) {

63 ià(
u£_sigÇl
 && !
_sigÇl
 && 
i
 == 0) {

64 
_tim”
.
	`ş—r
();

65  
çl£
;

69 
	`ouut
(0).
	`push
(
p
);

73 ià(
_tim”
.
	`expœy
())

74 
_tim”
.
	`»scheduË_aá”_m£c
(
_š‹rv®
);

76 
_tim”
.
	`scheduË_aá”_m£c
(
_š‹rv®
);

77  
Œue
;

78 
	}
}

80 
CLICK_ENDDECLS


81 
EXPORT_ELEMENT
(
TimedUnqueue
)

	@standard/timedunqueue.hh

1 #iâdeà
CLICK_TIMEDUNQUEUE_HH


2 
	#CLICK_TIMEDUNQUEUE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/sk.hh
>

5 
	~<şick/tim”.hh
>

6 
	~<şick/nÙif›r.hh
>

7 
CLICK_DECLS


36 şas 
	cTimedUnqueue
 : 
public
 
EËm’t
 {…ublic:

38 
	$TimedUnqueue
(è
CLICK_COLD
;

40 cÚ¡ *
	$şass_Çme
() const {  "TimedUnqueue"; }

41 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

42 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL_TO_PUSH
; 
	}
}

44 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

45 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

47 
boŞ
 
	`run_sk
(
Task
 *
sk
);

49 
´Ùeùed
:

51 
_bur¡
;

52 
Task
 
_sk
;

53 
Tim”
 
_tim”
;

54 
_š‹rv®
;

55 ’um { 
u£_sigÇl
 = 1 
	}
};

56 
NÙif›rSigÇl
 
	g_sigÇl
;

60 
	gCLICK_ENDDECLS


	@standard/truncate.cc

19 
	~<şick/cÚfig.h
>

20 
	~"Œunÿ‹.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
CLICK_DECLS


27 
	gTrunÿ‹
::
	$Trunÿ‹
()

29 
	}
}

32 
Trunÿ‹
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

34 
	g_exŒa_ªno
 = 
Œue
;

35  
Args
(
cÚf
, 
this
, 
”rh
)

36 .
»ad_mp
("LENGTH", 
_nby‹s
)

37 .
»ad
("EXTRA_LENGTH", 
_exŒa_ªno
)

38 .
com¶‘e
();

41 
Pack‘
 *

42 
	gTrunÿ‹
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

44 ià(
p
->
	`Ëngth
(è> 
_nby‹s
) {

45 
nby‹s
 = 
p
->
	`Ëngth
(è- 
_nby‹s
;

46 ià(
_exŒa_ªno
)

47 
	`SET_EXTRA_LENGTH_ANNO
(
p
, 
	`EXTRA_LENGTH_ANNO
Õè+ 
nby‹s
);

48 
p
->
	`ke
(
nby‹s
);

50  
p
;

51 
	}
}

54 
	gTrunÿ‹
::
	$add_hªdËrs
()

56 
	`add_d©a_hªdËrs
("nby‹s", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_nby‹s
);

57 
	}
}

59 
CLICK_ENDDECLS


60 
	$EXPORT_ELEMENT
(
Trunÿ‹
)

61 
	`ELEMENT_MT_SAFE
(
Trunÿ‹
)

	@standard/truncate.hh

2 #iâdeà
CLICK_TRUNCATE_HH


3 
	#CLICK_TRUNCATE_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


20 şas 
	cTrunÿ‹
 : 
public
 
EËm’t
 {…ublic:

22 
	$Trunÿ‹
(è
CLICK_COLD
;

24 cÚ¡ *
	$şass_Çme
() const {  "Truncate"; }

25 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

27 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

28 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

30 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

32 
	$add_hªdËrs
(è
CLICK_COLD
;

34 
´iv©e
:

36 
_nby‹s
;

37 
boŞ
 
_exŒa_ªno
;

39 
	}
};

41 
	gCLICK_ENDDECLS


	@standard/unqueue.cc

21 
	~<şick/cÚfig.h
>

22 
	~"unqueue.hh
"

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

26 
CLICK_DECLS


28 
	gUnqueue
::
	$Unqueue
()

29 : 
	$_sk
(
this
)

31 
	}
}

34 
Unqueue
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
	g_bur¡
 = 1;

37 
	g_lim™
 = -1;

38 
	g_aùive
 = 
Œue
;

39  
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad_p
("BURST", 
_bur¡
)

41 .
»ad
("ACTIVE", 
_aùive
)

42 .
»ad
("LIMIT", 
_lim™
).
com¶‘e
();

46 
	gUnqueue
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

48 
_couÁ
 = 0;

49 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_aùive
, 
”rh
);

50 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

51 ià(
_bur¡
 < 0)

52 
_bur¡
 = 0x7FFFFFFFU;

53 ià(
_bur¡
 == 0)

54 
”rh
->
	`w¬nšg
("BURST size 0,‚o…ackets will be…ulled");

56 
	}
}

58 
boŞ


59 
	gUnqueue
::
	$run_sk
(
Task
 *)

61 ià(!
_aùive
)

62  
çl£
;

64 
wÜked
 = 0, 
lim™
 = 
_bur¡
;

65 ià(
_lim™
 >ğ0 && 
_couÁ
 + 
lim™
 >ğ(
ušt32_t
) _limit) {

66 
lim™
 = 
_lim™
 - 
_couÁ
;

67 ià(
lim™
 <= 0)

68  
çl£
;

71 
wÜked
 < 
lim™
 && 
_aùive
) {

72 ià(
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
()) {

73 ++
wÜked
;

74 ++
_couÁ
;

75 
	`ouut
(0).
	`push
(
p
);

76 } ià(!
_sigÇl
)

77 
out
;

82 
_sk
.
	`ç¡_»scheduË
();

83 
out
:

84  
wÜked
 > 0;

85 
	}
}

87 #ià0 && 
defšed
(
CLICK_LINUXMODULE
)

88 #ià
__i386__
 && 
HAVE_INTEL_CPU


90 ià(
	gp_Ãxt
) {

91 
sk_buff
 *
	gskb
 = 
p_Ãxt
->
skb
();

92 
asm
 vŞ©e("´eãtcht0 %0" : : "m" (
skb
->
Ën
));

93 
asm
 vŞ©e("´eãtcht0 %0" : : "m" (
skb
->
cb
[0]));

99 
	gUnqueue
::
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *
u£r_d©a
,

100 
E¼ÜHªdËr
 *
”rh
)

102 
Unqueue
 *
u
 = 
¡©ic_ÿ¡
<Unqueu*>(
e
);

103 
»š‹½»t_ÿ¡
<
šŒ_t
>(
u£r_d©a
)) {

104 
h_aùive
:

105 ià(!
	`BoŞArg
().
	`·r£
(
cÚf
, 
u
->
_aùive
))

106  
”rh
->
	`”rÜ
("syntaxƒrror");

108 
h_»£t
:

109 
u
->
_couÁ
 = 0;

111 
h_lim™
:

112 ià(!
	`IÁArg
().
	`·r£
(
cÚf
, 
u
->
_lim™
))

113  
”rh
->
	`”rÜ
("syntaxƒrror");

115 
h_bur¡
:

116 ià(!
	`IÁArg
().
	`·r£
(
cÚf
, 
u
->
_bur¡
))

117  
”rh
->
	`”rÜ
("syntaxƒrror");

118 ià(
u
->
_bur¡
 < 0)

119 
u
->
_bur¡
 = 0x7FFFFFFF;

122 ià(
u
->
_aùive
 && !u->
_sk
.
	`scheduËd
()

123 && (
u
->
_lim™
 < 0 || u->
_couÁ
 < (
ušt32_t
) u->_limit))

124 
u
->
_sk
.
	`»scheduË
();

126 
	}
}

129 
	gUnqueue
::
	$add_hªdËrs
()

131 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
f_»ad
 | HªdËr::
f_checkbox
, &
_aùive
);

132 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
f_»ad
, &
_couÁ
);

133 
	`add_d©a_hªdËrs
("bur¡", 
HªdËr
::
f_»ad
, &
_bur¡
);

134 
	`add_d©a_hªdËrs
("lim™", 
HªdËr
::
f_»ad
, &
_lim™
);

135 
	`add_wr™e_hªdËr
("aùive", 
wr™e_·¿m
, 
h_aùive
);

136 
	`add_wr™e_hªdËr
("»£t", 
wr™e_·¿m
, 
h_»£t
, 
HªdËr
::
f_bu‰Ú
);

137 
	`add_wr™e_hªdËr
("»£t_couÁs", 
wr™e_·¿m
, 
h_»£t
, 
HªdËr
::
f_bu‰Ú
 | HªdËr::
f_uncommÚ
);

138 
	`add_wr™e_hªdËr
("bur¡", 
wr™e_·¿m
, 
h_bur¡
);

139 
	`add_wr™e_hªdËr
("lim™", 
wr™e_·¿m
, 
h_lim™
);

140 
	`add_sk_hªdËrs
(&
_sk
, &
_sigÇl
);

141 
	}
}

143 
CLICK_ENDDECLS


144 
	$EXPORT_ELEMENT
(
Unqueue
)

145 
	`ELEMENT_MT_SAFE
(
Unqueue
)

	@standard/unqueue.hh

1 #iâdeà
CLICK_UNQUEUE_HH


2 
	#CLICK_UNQUEUE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/sk.hh
>

5 
	~<şick/nÙif›r.hh
>

6 
CLICK_DECLS


66 şas 
	cUnqueue
 : 
public
 
EËm’t
 {…ublic:

68 
	$Unqueue
(è
CLICK_COLD
;

70 cÚ¡ *
	$şass_Çme
() const {  "Unqueue"; }

71 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

72 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL_TO_PUSH
; 
	}
}

74 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

75 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

76 
	$add_hªdËrs
(è
CLICK_COLD
;

78 
boŞ
 
	`run_sk
(
Task
 *);

80 
´iv©e
:

82 
boŞ
 
_aùive
;

83 
št32_t
 
_bur¡
;

84 
št32_t
 
_lim™
;

85 
ušt32_t
 
_couÁ
;

86 
Task
 
_sk
;

87 
NÙif›rSigÇl
 
_sigÇl
;

90 
h_aùive
, 
h_»£t
, 
h_bur¡
, 
h_lim™


91 
	}
};

92 
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

94 
	}
};

96 
	gCLICK_ENDDECLS


	@standard/unqueue2.cc

20 
	~<şick/cÚfig.h
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/rou‹rvis™Ü.hh
>

24 
	~<şick/¡ªd¬d/¡Üage.hh
>

25 
	~"unqueue2.hh
"

26 
	~<şick/¬gs.hh
>

27 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

28 
CLICK_DECLS


30 
	gUnqueue2
::
	$Unqueue2
()

31 : 
	`_bur¡
(1), 
	`_couÁ
(0), 
	$_sk
(
this
)

33 
	}
}

36 
	gUnqueue2
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

38 
SŒšg
 
	gqueues_¡ršg
;

39 
boŞ
 
	gqu›t
 = 
çl£
;

40 ià(
Args
(
cÚf
, 
this
, 
”rh
)

41 .
»ad_p
("BURST", 
_bur¡
)

42 .
»ad
("QUEUES", 
AnyArg
(), 
queues_¡ršg
).
»ad_¡©us
(
_ex¶ic™_queues
)

43 .
»ad
("QUIET", 
qu›t
)

44 .
com¶‘e
() < 0)

46 
SŒšg
 
	gwÜd
 = 
ı_shiá_¥aûvec
(
queues_¡ršg
)) {

47 
_queues
.
push_back
(0);

48 ià(!
EËm’tCa¡Arg
("StÜage").
·r£
(
wÜd
, 
_queues
.
back
(), 
this
))

49  
	g”rh
->
”rÜ
("bad QUEUES");

51 ià(
	g_bur¡
 == 0)

52 
_bur¡
 = 
INT_MAX
;

53 ià(!
	gqu›t
)

54 
	g”rh
->
”rÜ
("Unqueue2 is deprecated, you should…robably use Unqueue");

59 
	gUnqueue2
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

61 ià(!
_ex¶ic™_queues
) {

62 
EËm’tCa¡T¿ck”
 
	`f‹r
(
	`rou‹r
(), "Storage");

63 ià(
	`rou‹r
()->
	`vis™_down¡»am
(
this
, 0, &
f‹r
) < 0)

64  
”rh
->
	`”rÜ
("flow-based„outer context failure");

65 
EËm’t
 * cÚ¡ *
™
 = 
f‹r
.
	`begš
(); iˆ!ğf‹r.
	`’d
(); ++it)

66 
_queues
.
	`push_back
((
StÜage
 *è(*
™
)->
	`ÿ¡
("Storage"));

68 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
”rh
);

69 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

71 
	}
}

73 
boŞ


74 
	gUnqueue2
::
	$run_sk
(
Task
 *)

76 
wÜked
 = 0, 
lim™
 = 
_bur¡
;

77 
StÜage
 **
™
 = 
_queues
.
	`begš
(); iˆ!ğ_queues.
	`’d
(); ++it) {

78 
¥aû
 = (*
™
)->
	`ÿ·c™y
(è- (*™)->
	`size
();

79 ià(
lim™
 < 0 || 
¥aû
 <†imit)

80 
lim™
 = 
¥aû
;

83 
wÜked
 < 
lim™
) {

84 ià(
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
()) {

85 ++
wÜked
;

86 ++
_couÁ
;

87 
	`ouut
(0).
	`push
(
p
);

88 } ià(!
_sigÇl
)

89 
out
;

94 
_sk
.
	`ç¡_»scheduË
();

95 
out
:

96  
wÜked
 > 0;

97 
	}
}

99 #ià
CLICK_LINUXMODULE
 && 
__i386__
 && 
HAVE_INTEL_CPU
 && 0

100 ià(
	gp_Ãxt
) {

101 
sk_buff
 *
	gskb
 = 
p_Ãxt
->
skb
();

102 
asm
 vŞ©e("´eãtcht0 %0" : : "m" (
skb
->
Ën
));

103 
asm
 vŞ©e("´eãtcht0 %0" : : "m" (
skb
->
cb
[0]));

107 
SŒšg


108 
	gUnqueue2
::
	$»ad_·¿m
(
EËm’t
 *
e
, *)

110 
Unqueue2
 *
u
 = (Unqueue2 *)
e
;

111  
	`SŒšg
(
u
->
_couÁ
) + "…ackets\n";

112 
	}
}

115 
	gUnqueue2
::
	$add_hªdËrs
()

117 
	`add_»ad_hªdËr
("·ck‘s", 
»ad_·¿m
, 0);

118 
	`add_sk_hªdËrs
(&
_sk
);

119 
	}
}

121 
CLICK_ENDDECLS


122 
	$EXPORT_ELEMENT
(
Unqueue2
)

123 
	`ELEMENT_MT_SAFE
(
Unqueue2
)

	@standard/unqueue2.hh

1 #iâdeà
CLICK_UNQUEUE2_HH


2 
	#CLICK_UNQUEUE2_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/sk.hh
>

5 
	~<şick/nÙif›r.hh
>

6 
CLICK_DECLS


43 şas 
	cUnqueue2
 : 
public
 
EËm’t
 {…ublic:

45 
Unqueue2
();

47 cÚ¡ *
	$şass_Çme
() const {  "Unqueue2"; }

48 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

49 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL_TO_PUSH
; 
	}
}

51 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

52 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

53 
	$add_hªdËrs
(è
CLICK_COLD
;

55 
boŞ
 
	`run_sk
(
Task
 *);

57 
SŒšg
 
	$»ad_·¿m
(
EËm’t
 *
e
, *è
CLICK_COLD
;

59 
´iv©e
:

61 
_bur¡
;

62 
_couÁ
;

63 
Task
 
_sk
;

64 
VeùÜ
<
StÜage
 *> 
_queues
;

65 
boŞ
 
_ex¶ic™_queues
;

66 
NÙif›rSigÇl
 
_sigÇl
;

68 
	}
};

70 
	gCLICK_ENDDECLS


	@standard/unstrip.cc

18 
	~<şick/cÚfig.h
>

19 
	~"un¡r.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
CLICK_DECLS


25 
	gUn¡r
::
	$Un¡r
(
nby‹s
)

26 : 
	$_nby‹s
(
nby‹s
)

28 
	}
}

31 
Un¡r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

33  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("LENGTH", 
_nby‹s
).
com¶‘e
();

36 
Pack‘
 *

37 
	gUn¡r
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

39  
p
->
	`push
(
_nby‹s
);

40 
	}
}

42 
CLICK_ENDDECLS


43 
	$EXPORT_ELEMENT
(
Un¡r
)

44 
	`ELEMENT_MT_SAFE
(
Un¡r
)

	@standard/unstrip.hh

1 #iâdeà
CLICK_UNSTRIP_HH


2 
	#CLICK_UNSTRIP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


21 şas 
	cUn¡r
 : 
public
 
EËm’t
 {

23 
_nby‹s
;

25 
	mpublic
:

27 
Un¡r
(
nby‹s
 = 0);

29 cÚ¡ *
	$şass_Çme
() const {  "Unstrip"; }

30 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

32 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

34 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

38 
	gCLICK_ENDDECLS


	@tcpudp/checktcpheader.cc

19 
	~<şick/cÚfig.h
>

20 
	~"checktıh—d”.hh
"

21 
	~<şickÃt/.h
>

22 
	~<şickÃt/tı.h
>

23 
	~<şick/glue.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/b™veùÜ.hh
>

27 
	~<şick/¡¿ccum.hh
>

28 
CLICK_DECLS


30 cÚ¡ *
	gCheckTCPH—d”
::
»asÚ_‹xts
[
NREASONS
] = {

34 
	gCheckTCPH—d”
::
	$CheckTCPH—d”
()

35 : 
	$_»asÚ_drİs
(0)

37 
_drİs
 = 0;

38 
	}
}

40 
	gCheckTCPH—d”
::~
	$CheckTCPH—d”
()

42 
d–‘e
[] 
_»asÚ_drİs
;

43 
	}
}

46 
	gCheckTCPH—d”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

48 
boŞ
 
	gv”bo£
 = 
çl£
;

49 
boŞ
 
	gd‘as
 = 
çl£
;

51 ià(
Args
(
cÚf
, 
this
, 
”rh
)

52 .
»ad
("VERBOSE", 
v”bo£
)

53 .
»ad
("DETAILS", 
d‘as
)

54 .
com¶‘e
() < 0)

57 
	g_v”bo£
 = 
v”bo£
;

58 ià(
	gd‘as
) {

59 
	g_»asÚ_drİs
 = 
Ãw
 
©omic_ušt32_t
[
NREASONS
];

60 
	gi
 = 0; i < 
	gNREASONS
; ++i)

61 
	g_»asÚ_drİs
[
i
] = 0;

67 
Pack‘
 *

68 
	gCheckTCPH—d”
::
	$drİ
(
R—sÚ
 
»asÚ
, 
Pack‘
 *
p
)

70 ià(
_drİs
 =ğ0 || 
_v”bo£
)

71 
	`şick_ch©‹r
("%p{–em’t}: TCP h—d” check faed: %s", 
this
, 
»asÚ_‹xts
[
»asÚ
]);

72 
_drİs
++;

74 ià(
_»asÚ_drİs
)

75 
_»asÚ_drİs
[
»asÚ
]++;

77 ià(
	`nouuts
() == 2)

78 
	`ouut
(1).
	`push
(
p
);

80 
p
->
	`kl
();

83 
	}
}

85 
Pack‘
 *

86 
	gCheckTCPH—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

88 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

89 cÚ¡ 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

90 
Ën
, 
h_Ën
, 
tıh_Ën
, 
csum
;

92 ià(!
p
->
	`has_ÃtwÜk_h—d”
(è|| 
h
->
_p
 !ğ
IP_PROTO_TCP
)

93  
	`drİ
(
NOT_TCP
, 
p
);

95 
h_Ën
 = 
h
->
_hl
 << 2;

96 
Ën
 = 
	`Áohs
(
h
->
_Ën
è- 
h_Ën
;

97 
tıh_Ën
 = 
tıh
->
th_off
 << 2;

98 ià(
tıh_Ën
 < (
şick_tı
è|| 
Ën
 <cph_len

99 || 
p
->
	`Ëngth
(è< 
Ën
 + 
h_Ën
 +…->
	`ÃtwÜk_h—d”_off£t
())

100  
	`drİ
(
BAD_LENGTH
, 
p
);

102 
csum
 = 
	`şick_š_cksum
((*)
tıh
, 
Ën
);

103 ià(
	`şick_š_cksum_p£udohdr
(
csum
, 
h
, 
Ën
) != 0)

104  
	`drİ
(
BAD_CHECKSUM
, 
p
);

106  
p
;

107 
	}
}

109 
SŒšg


110 
	gCheckTCPH—d”
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

112 
CheckTCPH—d”
 *
c
 = 
»š‹½»t_ÿ¡
<CheckTCPH—d” *>(
e
);

113 (
šŒ_t
)
thunk
) {

116  
	`SŒšg
(
c
->
_drİs
);

119 
SŒšgAccum
 
§
;

120 
i
 = 0; i < 
NREASONS
; i++)

121 
§
 << 
c
->
_»asÚ_drİs
[
i
] << '\t' << 
»asÚ_‹xts
[i] << '\n';

122  
§
.
	`ke_¡ršg
();

126  
	`SŒšg
("<error>");

129 
	}
}

132 
	gCheckTCPH—d”
::
	$add_hªdËrs
()

134 
	`add_»ad_hªdËr
("drİs", 
»ad_hªdËr
, 0);

135 ià(
_»asÚ_drİs
)

136 
	`add_»ad_hªdËr
("drİ_d‘as", 
»ad_hªdËr
, 1);

137 
	}
}

139 
CLICK_ENDDECLS


140 
EXPORT_ELEMENT
(
CheckTCPH—d”
)

	@tcpudp/checktcpheader.hh

1 #iâdeà
CLICK_CHECKTCPHEADER_HH


2 
	#CLICK_CHECKTCPHEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/©omic.hh
>

5 
CLICK_DECLS


54 şas 
	cCheckTCPH—d”
 : 
public
 
EËm’t
 {…ublic:

56 
	$CheckTCPH—d”
(è
CLICK_COLD
;

57 ~
	$CheckTCPH—d”
(è
CLICK_COLD
;

59 cÚ¡ *
	$şass_Çme
() const {  "CheckTCPHeader"; }

60 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

61 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

63 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

64 
	$add_hªdËrs
(è
CLICK_COLD
;

66 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

71 
´iv©e
:

73 
boŞ
 
_v”bo£
 : 1;

74 
©omic_ušt32_t
 
_drİs
;

75 
©omic_ušt32_t
 *
_»asÚ_drİs
;

77 
	eR—sÚ
 {

78 
NOT_TCP
,

79 
BAD_LENGTH
,

80 
BAD_CHECKSUM
,

81 
NREASONS


82 
	}
};

83 cÚ¡ *
	g»asÚ_‹xts
[
NREASONS
];

85 
Pack‘
 *
drİ
(
R—sÚ
, Packet *);

86 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

88 
	}
};

90 
	gCLICK_ENDDECLS


	@tcpudp/checkudpheader.cc

19 
	~<şick/cÚfig.h
>

20 
	~"checkudph—d”.hh
"

21 
	~<şickÃt/.h
>

22 
	~<şickÃt/udp.h
>

23 
	~<şick/glue.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/¡¿ccum.hh
>

27 
CLICK_DECLS


29 cÚ¡ *
	gCheckUDPH—d”
::
»asÚ_‹xts
[
NREASONS
] = {

33 
	gCheckUDPH—d”
::
	$CheckUDPH—d”
()

34 : 
	$_»asÚ_drİs
(0)

36 
_drİs
 = 0;

37 
	}
}

39 
	gCheckUDPH—d”
::~
	$CheckUDPH—d”
()

41 
d–‘e
[] 
_»asÚ_drİs
;

42 
	}
}

45 
	gCheckUDPH—d”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

47 
boŞ
 
	gv”bo£
 = 
çl£
;

48 
boŞ
 
	gd‘as
 = 
çl£
;

50 ià(
Args
(
cÚf
, 
this
, 
”rh
)

51 .
»ad
("VERBOSE", 
v”bo£
)

52 .
»ad
("DETAILS", 
d‘as
)

53 .
com¶‘e
() < 0)

56 
	g_v”bo£
 = 
v”bo£
;

57 ià(
	gd‘as
) {

58 
	g_»asÚ_drİs
 = 
Ãw
 
©omic_ušt32_t
[
NREASONS
];

59 
	gi
 = 0; i < 
	gNREASONS
; ++i)

60 
	g_»asÚ_drİs
[
i
] = 0;

66 
Pack‘
 *

67 
	gCheckUDPH—d”
::
	$drİ
(
R—sÚ
 
»asÚ
, 
Pack‘
 *
p
)

69 ià(
_drİs
 =ğ0 || 
_v”bo£
)

70 
	`şick_ch©‹r
("UDP h—d” check faed: %s", 
»asÚ_‹xts
[
»asÚ
]);

71 
_drİs
++;

73 ià(
_»asÚ_drİs
)

74 
_»asÚ_drİs
[
»asÚ
]++;

76 ià(
	`nouuts
() == 2)

77 
	`ouut
(1).
	`push
(
p
);

79 
p
->
	`kl
();

82 
	}
}

84 
Pack‘
 *

85 
	gCheckUDPH—d”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

87 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

88 cÚ¡ 
şick_udp
 *
udph
 = 
p
->
	`udp_h—d”
();

89 
Ën
, 
h_Ën
;

91 ià(!
p
->
	`has_ÃtwÜk_h—d”
(è|| 
h
->
_p
 !ğ
IP_PROTO_UDP
)

92  
	`drİ
(
NOT_UDP
, 
p
);

94 
h_Ën
 = 
h
->
_hl
 << 2;

95 
Ën
 = 
	`Áohs
(
udph
->
uh_uËn
);

96 ià(
Ën
 < (
şick_udp
)

97 || 
p
->
	`Ëngth
(è< 
Ën
 + 
h_Ën
 +…->
	`ÃtwÜk_h—d”_off£t
())

98  
	`drİ
(
BAD_LENGTH
, 
p
);

100 ià(
udph
->
uh_sum
 != 0) {

101 
csum
 = 
	`şick_š_cksum
((*)
udph
, 
Ën
);

102 ià(
	`şick_š_cksum_p£udohdr
(
csum
, 
h
, 
Ën
) != 0)

103  
	`drİ
(
BAD_CHECKSUM
, 
p
);

106  
p
;

107 
	}
}

109 
SŒšg


110 
	gCheckUDPH—d”
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

112 
CheckUDPH—d”
 *
c
 = 
»š‹½»t_ÿ¡
<CheckUDPH—d” *>(
e
);

113 (
šŒ_t
)
thunk
) {

116  
	`SŒšg
(
c
->
_drİs
);

119 
SŒšgAccum
 
§
;

120 
i
 = 0; i < 
NREASONS
; i++)

121 
§
 << 
c
->
_»asÚ_drİs
[
i
] << '\t' << 
»asÚ_‹xts
[i] << '\n';

122  
§
.
	`ke_¡ršg
();

126  
	`SŒšg
("<error>");

129 
	}
}

132 
	gCheckUDPH—d”
::
	$add_hªdËrs
()

134 
	`add_»ad_hªdËr
("drİs", 
»ad_hªdËr
, 0);

135 ià(
_»asÚ_drİs
)

136 
	`add_»ad_hªdËr
("drİ_d‘as", 
»ad_hªdËr
, 1);

137 
	}
}

139 
CLICK_ENDDECLS


140 
EXPORT_ELEMENT
(
CheckUDPH—d”
)

	@tcpudp/checkudpheader.hh

1 #iâdeà
CLICK_CHECKUDPHEADER_HH


2 
	#CLICK_CHECKUDPHEADER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/©omic.hh
>

5 
CLICK_DECLS


54 şas 
	cCheckUDPH—d”
 : 
public
 
EËm’t
 {…ublic:

56 
	$CheckUDPH—d”
(è
CLICK_COLD
;

57 ~
	$CheckUDPH—d”
(è
CLICK_COLD
;

59 cÚ¡ *
	$şass_Çme
() const {  "CheckUDPHeader"; }

60 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

61 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

63 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

64 
	$add_hªdËrs
(è
CLICK_COLD
;

66 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

71 
´iv©e
:

73 
boŞ
 
_v”bo£
 : 1;

74 
©omic_ušt32_t
 
_drİs
;

75 
©omic_ušt32_t
 *
_»asÚ_drİs
;

77 
	eR—sÚ
 {

78 
NOT_UDP
,

79 
BAD_LENGTH
,

80 
BAD_CHECKSUM
,

81 
NREASONS


82 
	}
};

83 cÚ¡ *
	g»asÚ_‹xts
[
NREASONS
];

85 
Pack‘
 *
drİ
(
R—sÚ
, Packet *);

86 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

88 
	}
};

90 
	gCLICK_ENDDECLS


	@tcpudp/dynudpipencap.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şickÃt/.h
>

20 
	~"dynudp’ÿp.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

25 
CLICK_DECLS


27 
	gDyÇmicUDPIPEnÿp
::
	$DyÇmicUDPIPEnÿp
()

29 
	}
}

31 
DyÇmicUDPIPEnÿp
::~
	$DyÇmicUDPIPEnÿp
()

33 
	}
}

36 
DyÇmicUDPIPEnÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

38 
boŞ
 
	gdo_cksum
 = 
Œue
;

39 
	g_š‹rv®
 = 0;

40 ià(
Args
(
cÚf
, 
this
, 
”rh
)

41 .
»ad_mp
("SRC", 
_§ddr
)

42 .
»ad_mp
("SPORT", 
IPPÜtArg
(
IP_PROTO_UDP
), 
_¥Üt
)

43 .
»ad_mp
("DST", 
_daddr
)

44 .
»ad_mp
("DPORT", 
IPPÜtArg
(
IP_PROTO_UDP
), 
_dpÜt
)

45 .
»ad_p
("CHECKSUM", 
do_cksum
)

46 .
»ad_p
("INTERVAL", 
_š‹rv®
)

47 .
com¶‘e
() < 0)

50 
	g_id
 = 0;

51 
	g_cksum
 = 
do_cksum
;

52 
	g_couÁ
 = 0;

54 #ifdeà
CLICK_LINUXMODULE


57 
	gªs
, 
	gc
, 
	go
;

58 
	gªs
 = 
Alignm’tInfo
::
qu”y
(
this
, 0, 
c
, 
o
);

59 
	g_®igÃd
 = (
ªs
 && 
c
 =ğ4 && 
o
 == 0);

60 ià(!
	g_®igÃd
)

61 
	g”rh
->
w¬nšg
("IP header unaligned, cannot use fast IP checksum");

62 ià(!
	gªs
)

63 
	g”rh
->
mes§ge
("(Try…assinghe configurationhrough `click-align'.)");

70 
Pack‘
 *

71 
	gDyÇmicUDPIPEnÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

73 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`push
((
şick_udp
è+ (
şick_
));

74 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
p
->
	`d©a
());

75 
şick_udp
 *
udp
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(

 + 1);

78 

->
_v
 = 4;

79 

->
_hl
 = (
şick_
) >> 2;

80 

->
_Ën
 = 
	`htÚs
(
p
->
	`Ëngth
());

81 

->
_id
 = 
	`htÚs
(
_id
.
	`ãtch_ªd_add
(1));

82 

->
_p
 = 
IP_PROTO_UDP
;

83 

->
_¤c
 = 
_§ddr
;

84 

->
_d¡
 = 
_daddr
;

85 

->
_tos
 = 0;

86 

->
_off
 = 0;

87 

->
_‰l
 = 250;

89 

->
_sum
 = 0;

90 #ifdeà
CLICK_LINUXMODULE


91 ià(
_®igÃd
) {

92 

->
_sum
 = 
	`_ç¡_csum
((*), (
şick_
) >> 2);

95 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

96 #ifdeà
CLICK_LINUXMODULE


100 
p
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(
_daddr
));

101 
p
->
	`£t__h—d”
(

, (
şick_
));

104 
udp
->
uh_¥Üt
 = 
	`htÚs
(
_¥Üt
);

105 
udp
->
uh_dpÜt
 = 
	`htÚs
(
_dpÜt
);

106 
Ën
 = 
p
->
	`Ëngth
(è- (
şick_
);

107 
udp
->
uh_uËn
 = 
	`htÚs
(
Ën
);

108 
udp
->
uh_sum
 = 0;

109 ià(
_cksum
) {

110 
csum
 = 
	`şick_š_cksum
((*)
udp
, 
Ën
);

111 
udp
->
uh_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
Ën
);

114 
Şd_couÁ
 = 
_couÁ
.
	`ãtch_ªd_add
(1);

115 ià(
Şd_couÁ
 =ğ
_š‹rv®
-1 && _interval > 0) {

116 
_¥Üt
 ++;

117 
_dpÜt
 ++;

118 
_couÁ
 = 0;

120  
p
;

121 
	}
}

123 
CLICK_ENDDECLS


124 
	$EXPORT_ELEMENT
(
DyÇmicUDPIPEnÿp
)

125 
	`ELEMENT_MT_SAFE
(
UDPIPEnÿp
)

	@tcpudp/dynudpipencap.hh

1 #iâdeà
CLICK_DYNUDPIPENCAP_HH


2 
	#CLICK_DYNUDPIPENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/©omic.hh
>

6 
	~<şickÃt/udp.h
>

7 
CLICK_DECLS


35 şas 
	cDyÇmicUDPIPEnÿp
 : 
public
 
EËm’t
 {

37 
š_addr
 
_§ddr
;

38 
š_addr
 
	m_daddr
;

39 
ušt16_t
 
	m_¥Üt
;

40 
ušt16_t
 
	m_dpÜt
;

41 
boŞ
 
	m_cksum
 : 1;

42 #ifdeà
CLICK_LINUXMODULE


43 
boŞ
 
	m_®igÃd
 : 1;

45 
©omic_ušt32_t
 
	m_id
;

46 
©omic_ušt32_t
 
	m_couÁ
;

47 
	m_š‹rv®
;

49 
	mpublic
:

51 
	$DyÇmicUDPIPEnÿp
(è
CLICK_COLD
;

52 ~
	$DyÇmicUDPIPEnÿp
(è
CLICK_COLD
;

54 cÚ¡ *
	$şass_Çme
() const {  "DynamicUDPIPEncap"; }

55 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

56 cÚ¡ *
	$æags
(ècÚ¡ {  "A"; 
	}
}

58 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

60 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

64 
	gCLICK_ENDDECLS


	@tcpudp/fasttcpflows.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şickÃt/.h
>

20 
	~"ç¡tıæows.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/‘h”add»ss.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/glue.hh
>

25 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

27 
CLICK_DECLS


29 cÚ¡ 
	gFa¡TCPFlows
::
NO_LIMIT
;

31 
	gFa¡TCPFlows
::
	$Fa¡TCPFlows
()

32 : 
	$_æows
(0)

34 
_¿‹_lim™ed
 = 
Œue
;

35 
_fœ¡
 = 
_Ï¡
 = 0;

36 
_couÁ
 = 0;

37 
	}
}

39 
	gFa¡TCPFlows
::~
	$Fa¡TCPFlows
()

41 
	}
}

44 
Fa¡TCPFlows
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

46 
	g_cksum
 = 
Œue
;

47 
	g_aùive
 = 
Œue
;

48 
	g¿‹
;

49 
	glim™
;

50 ià(
Args
(
cÚf
, 
this
, 
”rh
)

51 .
»ad_mp
("RATE", 
¿‹
)

52 .
»ad_mp
("LIMIT", 
lim™
)

53 .
»ad_mp
("LENGTH", 
_Ën
)

54 .
»ad_mp
("SRCETH", 
Eth”Add»ssArg
(), 
_‘hh
.
‘h”_sho¡
)

55 .
»ad_mp
("SRCIP", 
_saddr
)

56 .
»ad_mp
("DSTETH", 
Eth”Add»ssArg
(), 
_‘hh
.
‘h”_dho¡
)

57 .
»ad_mp
("DSTIP", 
_daddr
)

58 .
»ad_mp
("FLOWS", 
_næows
)

59 .
»ad_mp
("FLOWSIZE", 
_æowsize
)

60 .
»ad_p
("ACTIVE", 
_aùive
)

61 .
com¶‘e
() < 0)

63 ià(
	g_æowsize
 < 3) {

64 
şick_ch©‹r
("warning: flow size < 3, defaultingo 3");

65 
	g_æowsize
 = 3;

67 ià(
	g_Ën
 < 60) {

68 
şick_ch©‹r
("warning:…acket†ength < 60, defaultingo 60");

69 
	g_Ën
 = 60;

71 
	g_‘hh
.
	g‘h”_ty³
 = 
htÚs
(0x0800);

72 if(
	g¿‹
 != 0){

73 
_¿‹_lim™ed
 = 
Œue
;

74 
	g_¿‹
.
£t_¿‹
(
¿‹
, 
”rh
);

76 
	g_¿‹_lim™ed
 = 
çl£
;

78 
	g_lim™
 = (
lim™
 >ğ0 ?†im™ : 
NO_LIMIT
);

83 
	gFa¡TCPFlows
::
	$chªge_pÜts
(
æow
)

85 
¥Üt
 = (
	`şick_¿ndom
() >> 2) % 0xFFFF;

86 
dpÜt
 = (
	`şick_¿ndom
() >> 2) % 0xFFFF;

87 
Wr™abËPack‘
 *
q
 = 
_æows
[
æow
].
syn_·ck‘
->
	`uniqueify
();

88 
_æows
[
æow
].
syn_·ck‘
 = 
q
;

89 
şick_
 *

 =

90 
»š‹½»t_ÿ¡
<
şick_
 *>(
q
->
	`d©a
()+14);

91 
şick_tı
 *
tı
 = 
»š‹½»t_ÿ¡
<şick_tı *>(

 + 1);

92 
tı
->
th_¥Üt
 = 
¥Üt
;

93 
tı
->
th_dpÜt
 = 
dpÜt
;

94 
tı
->
th_sum
 = 0;

95 
Ën
 = 
_Ën
-14-(
şick_
);

96 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
tı
, 
Ën
);

97 
tı
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
Ën
);

99 
q
 = 
_æows
[
æow
].
d©a_·ck‘
->
	`uniqueify
();

100 
_æows
[
æow
].
d©a_·ck‘
 = 
q
;

101 

 = 
»š‹½»t_ÿ¡
<
şick_
 *>(
q
->
	`d©a
()+14);

102 
tı
 = 
»š‹½»t_ÿ¡
<
şick_tı
 *>(

 + 1);

103 
tı
->
th_¥Üt
 = 
¥Üt
;

104 
tı
->
th_dpÜt
 = 
dpÜt
;

105 
tı
->
th_sum
 = 0;

106 
Ën
 = 
_Ën
-14-(
şick_
);

107 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
tı
, 
Ën
);

108 
tı
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
Ën
);

110 
q
 = 
_æows
[
æow
].
fš_·ck‘
->
	`uniqueify
();

111 
_æows
[
æow
].
fš_·ck‘
 = 
q
;

112 

 = 
»š‹½»t_ÿ¡
<
şick_
 *>(
q
->
	`d©a
()+14);

113 
tı
 = 
»š‹½»t_ÿ¡
<
şick_tı
 *>(

 + 1);

114 
tı
->
th_¥Üt
 = 
¥Üt
;

115 
tı
->
th_dpÜt
 = 
dpÜt
;

116 
tı
->
th_sum
 = 0;

117 
Ën
 = 
_Ën
-14-(
şick_
);

118 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
tı
, 
Ën
);

119 
tı
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
Ën
);

120 
	}
}

122 
Pack‘
 *

123 
	gFa¡TCPFlows
::
	$g‘_·ck‘
()

125 ià(
_lim™
 !ğ
NO_LIMIT
 && 
_couÁ
 >= _limit) {

126 
i
=0; i<
_næows
; i++) {

127 ià(
_æows
[
i
].
æow_couÁ
 !ğ
_æowsize
) {

128 
_æows
[
i
].
æow_couÁ
 = 
_æowsize
;

129  
_æows
[
i
].
fš_·ck‘
->
	`şÚe
();

132 
_£Á_®l_fšs
 = 
Œue
;

136 
æow
 = (
	`şick_¿ndom
(è>> 2è% 
_næows
;

137 ià(
_æows
[
æow
].
æow_couÁ
 =ğ
_æowsize
) {

138 
	`chªge_pÜts
(
æow
);

139 
_æows
[
æow
].
æow_couÁ
 = 0;

141 
_æows
[
æow
].
æow_couÁ
++;

142 ià(
_æows
[
æow
].
æow_couÁ
 == 1) {

143  
_æows
[
æow
].
syn_·ck‘
->
	`şÚe
();

144 } ià(
_æows
[
æow
].
æow_couÁ
 =ğ
_æowsize
) {

145  
_æows
[
æow
].
fš_·ck‘
->
	`şÚe
();

147  
_æows
[
æow
].
d©a_·ck‘
->
	`şÚe
();

150 
	}
}

154 
	gFa¡TCPFlows
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

156 
_couÁ
 = 0;

157 
_£Á_®l_fšs
 = 
çl£
;

158 
_æows
 = 
Ãw
 
æow_t
[
_næows
];

160 
i
=0; i<
_næows
; i++) {

161 
¥Üt
 = (
	`şick_¿ndom
() >> 2) % 0xFFFF;

162 
dpÜt
 = (
	`şick_¿ndom
() >> 2) % 0xFFFF;

165 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(
_Ën
);

166 
_æows
[
i
].
syn_·ck‘
 = 
q
;

167 
	`memıy
((*)
_æows
[
i
].
syn_·ck‘
->
	`d©a
(), &
_‘hh
, 14);

168 
şick_
 *

 =

169 
»š‹½»t_ÿ¡
<
şick_
 *>(
q
->
	`d©a
()+14);

170 
şick_tı
 *
tı
 = 
»š‹½»t_ÿ¡
<şick_tı *>(

 + 1);

172 

->
_v
 = 4;

173 

->
_hl
 = (
şick_
) >> 2;

174 

->
_Ën
 = 
	`htÚs
(
_Ën
-14);

175 

->
_id
 = 0;

176 

->
_p
 = 
IP_PROTO_TCP
;

177 

->
_¤c
 = 
_saddr
;

178 

->
_d¡
 = 
_daddr
;

179 

->
_tos
 = 0;

180 

->
_off
 = 0;

181 

->
_‰l
 = 250;

182 

->
_sum
 = 0;

183 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

184 
_æows
[
i
].
syn_·ck‘
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(
_daddr
));

185 
_æows
[
i
].
syn_·ck‘
->
	`£t__h—d”
(

, (
şick_
));

187 
tı
->
th_¥Üt
 = 
¥Üt
;

188 
tı
->
th_dpÜt
 = 
dpÜt
;

189 
tı
->
th_£q
 = 
	`şick_¿ndom
();

190 
tı
->
th_ack
 = 
	`şick_¿ndom
();

191 
tı
->
th_off
 = (
şick_tı
) >> 2;

192 
tı
->
th_æags
 = 
TH_SYN
;

193 
tı
->
th_wš
 = 65535;

194 
tı
->
th_u½
 = 0;

195 
tı
->
th_sum
 = 0;

196 
Ën
 = 
_Ën
-14-(
şick_
);

197 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
tı
, 
Ën
);

198 
tı
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
Ën
);

201 
q
 = 
Pack‘
::
	`make
(
_Ën
);

202 
_æows
[
i
].
d©a_·ck‘
 = 
q
;

203 
	`memıy
(
q
->
	`d©a
(), &
_‘hh
, 14);

204 

 = 
»š‹½»t_ÿ¡
<
şick_
 *>(
q
->
	`d©a
()+14);

205 
tı
 = 
»š‹½»t_ÿ¡
<
şick_tı
 *>(

 + 1);

207 

->
_v
 = 4;

208 

->
_hl
 = (
şick_
) >> 2;

209 

->
_Ën
 = 
	`htÚs
(
_Ën
-14);

210 

->
_id
 = 0;

211 

->
_p
 = 
IP_PROTO_TCP
;

212 

->
_¤c
 = 
_saddr
;

213 

->
_d¡
 = 
_daddr
;

214 

->
_tos
 = 0;

215 

->
_off
 = 0;

216 

->
_‰l
 = 250;

217 

->
_sum
 = 0;

218 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

219 
_æows
[
i
].
d©a_·ck‘
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(
_daddr
));

220 
_æows
[
i
].
d©a_·ck‘
->
	`£t__h—d”
(

, (
şick_
));

222 
tı
->
th_¥Üt
 = 
¥Üt
;

223 
tı
->
th_dpÜt
 = 
dpÜt
;

224 
tı
->
th_£q
 = 
	`şick_¿ndom
();

225 
tı
->
th_ack
 = 
	`şick_¿ndom
();

226 
tı
->
th_off
 = (
şick_tı
) >> 2;

227 
tı
->
th_æags
 = 
TH_PUSH
 | 
TH_ACK
;

228 
tı
->
th_wš
 = 65535;

229 
tı
->
th_u½
 = 0;

230 
tı
->
th_sum
 = 0;

231 
Ën
 = 
_Ën
-14-(
şick_
);

232 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
tı
, 
Ën
);

233 
tı
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
Ën
);

236 
q
 = 
Pack‘
::
	`make
(
_Ën
);

237 
_æows
[
i
].
fš_·ck‘
 = 
q
;

238 
	`memıy
(
q
->
	`d©a
(), &
_‘hh
, 14);

239 

 = 
»š‹½»t_ÿ¡
<
şick_
 *>(
q
->
	`d©a
()+14);

240 
tı
 = 
»š‹½»t_ÿ¡
<
şick_tı
 *>(

 + 1);

242 

->
_v
 = 4;

243 

->
_hl
 = (
şick_
) >> 2;

244 

->
_Ën
 = 
	`htÚs
(
_Ën
-14);

245 

->
_id
 = 0;

246 

->
_p
 = 
IP_PROTO_TCP
;

247 

->
_¤c
 = 
_saddr
;

248 

->
_d¡
 = 
_daddr
;

249 

->
_tos
 = 0;

250 

->
_off
 = 0;

251 

->
_‰l
 = 250;

252 

->
_sum
 = 0;

253 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

254 
_æows
[
i
].
fš_·ck‘
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(
_daddr
));

255 
_æows
[
i
].
fš_·ck‘
->
	`£t__h—d”
(

, (
şick_
));

257 
tı
->
th_¥Üt
 = 
¥Üt
;

258 
tı
->
th_dpÜt
 = 
dpÜt
;

259 
tı
->
th_£q
 = 
	`şick_¿ndom
();

260 
tı
->
th_ack
 = 
	`şick_¿ndom
();

261 
tı
->
th_off
 = (
şick_tı
) >> 2;

262 
tı
->
th_æags
 = 
TH_FIN
;

263 
tı
->
th_wš
 = 65535;

264 
tı
->
th_u½
 = 0;

265 
tı
->
th_sum
 = 0;

266 
Ën
 = 
_Ën
-14-(
şick_
);

267 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
tı
, 
Ën
);

268 
tı
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
Ën
);

270 
_æows
[
i
].
æow_couÁ
 = 0;

272 
_Ï¡_æow
 = 0;

274 
	}
}

277 
	gFa¡TCPFlows
::
	$ş—nup
(
CËªupSge
)

279 ià(
_æows
) {

280 
i
=0; i<
_næows
; i++) {

281 
_æows
[
i
].
syn_·ck‘
->
	`kl
();

282 
_æows
[
i
].
d©a_·ck‘
->
	`kl
();

283 
_æows
[
i
].
fš_·ck‘
->
	`kl
();

285 
d–‘e
[] 
_æows
;

286 
_æows
 = 0;

288 
	}
}

290 
Pack‘
 *

291 
	gFa¡TCPFlows
::
	$puÎ
()

293 
Pack‘
 *
p
 = 0;

295 ià(!
_aùive
)

297 ià(
_lim™
 !ğ
NO_LIMIT
 && 
_couÁ
 >ğ_lim™ && 
_£Á_®l_fšs
)

300 if(
_¿‹_lim™ed
){

301 ià(
_¿‹
.
	`Ãed_upd©e
(
Time¡amp
::
	`now
())) {

302 
_¿‹
.
	`upd©e
();

303 
p
 = 
	`g‘_·ck‘
();

306 
p
 = 
	`g‘_·ck‘
();

308 if(
p
) {

309 
_couÁ
++;

310 if(
_couÁ
 == 1)

311 
_fœ¡
 = 
	`şick_jiff›s
();

312 if(
_lim™
 !ğ
NO_LIMIT
 && 
_couÁ
 >= _limit)

313 
_Ï¡
 = 
	`şick_jiff›s
();

316 (
p
);

317 
	}
}

320 
	gFa¡TCPFlows
::
	$»£t
()

322 
_couÁ
 = 0;

323 
_fœ¡
 = 0;

324 
_Ï¡
 = 0;

325 
_£Á_®l_fšs
 = 
çl£
;

326 
	}
}

328 
SŒšg


329 
	$Fa¡TCPFlows_»ad_couÁ_hªdËr
(
EËm’t
 *
e
, *)

331 
Fa¡TCPFlows
 *
c
 = (Fa¡TCPFlow *)
e
;

332  
	`SŒšg
(
c
->
	`couÁ
());

333 
	}
}

335 
SŒšg


336 
	$Fa¡TCPFlows_»ad_¿‹_hªdËr
(
EËm’t
 *
e
, *)

338 
Fa¡TCPFlows
 *
c
 = (Fa¡TCPFlow *)
e
;

339 if(
c
->
	`Ï¡
() != 0){

340 
d
 = 
c
->
	`Ï¡
(è- c->
	`fœ¡
();

341 ià(
d
 < 1) d = 1;

342 
¿‹
 = 
c
->
	`couÁ
(è* 
CLICK_HZ
 / 
d
;

343  
	`SŒšg
(
¿‹
);

345  
	`SŒšg
("0");

347 
	}
}

350 
	gFa¡TCPFlows_»£t_wr™e_hªdËr


351 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *)

353 
Fa¡TCPFlows
 *
	gc
 = (Fa¡TCPFlow *)
e
;

354 
	gc
->
»£t
();

359 
	gFa¡TCPFlows_lim™_wr™e_hªdËr


360 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

362 
Fa¡TCPFlows
 *
	gc
 = (Fa¡TCPFlow *)
e
;

363 
	glim™
;

364 ià(!
IÁArg
().
·r£
(
s
, 
lim™
))

365  
	g”rh
->
”rÜ
("limit…arameter must be integer >= 0");

366 
	gc
->
	g_lim™
 = (
lim™
 >ğ0 ?†im™ : 
c
->
NO_LIMIT
);

371 
	gFa¡TCPFlows_¿‹_wr™e_hªdËr


372 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

374 
Fa¡TCPFlows
 *
	gc
 = (Fa¡TCPFlow *)
e
;

375 
	g¿‹
;

376 ià(!
IÁArg
().
·r£
(
s
, 
¿‹
))

377  
	g”rh
->
”rÜ
("rate…arameter must be integer >= 0");

378 ià(
	g¿‹
 > 
	gG­R©e
::
MAX_RATE
)

380  
”rh
->
”rÜ
("¿‹oØÏrge; max i %u", 
G­R©e
::
MAX_RATE
);

381 
	gc
->
	g_¿‹
.
£t_¿‹
(
¿‹
);

386 
	gFa¡TCPFlows_aùive_wr™e_hªdËr


387 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

389 
Fa¡TCPFlows
 *
	gc
 = (Fa¡TCPFlow *)
e
;

390 
boŞ
 
	gaùive
;

391 ià(!
BoŞArg
().
·r£
(
s
, 
aùive
))

392  
	g”rh
->
”rÜ
("active…arameter must be boolean");

393 
	gc
->
	g_aùive
 = 
aùive
;

394 ià(
	gaùive
è
	gc
->
»£t
();

399 
	gFa¡TCPFlows
::
	$add_hªdËrs
()

401 
	`add_»ad_hªdËr
("couÁ", 
Fa¡TCPFlows_»ad_couÁ_hªdËr
, 0);

402 
	`add_»ad_hªdËr
("¿‹", 
Fa¡TCPFlows_»ad_¿‹_hªdËr
, 0);

403 
	`add_wr™e_hªdËr
("¿‹", 
Fa¡TCPFlows_¿‹_wr™e_hªdËr
, 0);

404 
	`add_wr™e_hªdËr
("»£t", 
Fa¡TCPFlows_»£t_wr™e_hªdËr
, 0, 
HªdËr
::
BUTTON
);

405 
	`add_wr™e_hªdËr
("aùive", 
Fa¡TCPFlows_aùive_wr™e_hªdËr
, 0, 
HªdËr
::
CHECKBOX
);

406 
	`add_wr™e_hªdËr
("lim™", 
Fa¡TCPFlows_lim™_wr™e_hªdËr
, 0);

407 
	}
}

409 
CLICK_ENDDECLS


410 
EXPORT_ELEMENT
(
Fa¡TCPFlows
)

	@tcpudp/fasttcpflows.hh

1 #iâdeà
FASTTCPFLOWS_HH


2 
	#FASTTCPFLOWS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/g­¿‹.hh
>

6 
	~<şick/·ck‘.hh
>

7 
	~<şickÃt/‘h”.h
>

8 
	~<şickÃt/tı.h
>

10 
CLICK_DECLS


60 şas 
	cFa¡TCPFlows
 : 
public
 
EËm’t
 {

62 
boŞ
 
_¿‹_lim™ed
;

63 
boŞ
 
	m_£Á_®l_fšs
;

64 
	m_Ën
;

65 
şick_‘h”
 
	m_‘hh
;

66 
š_addr
 
	m_saddr
;

67 
š_addr
 
	m_daddr
;

68 
	m_næows
;

69 
	m_Ï¡_æow
;

70 
	m_æowsize
;

71 
boŞ
 
	m_cksum
;

72 
şick_jiff›s_t
 
	m_fœ¡
;

73 
şick_jiff›s_t
 
	m_Ï¡
;

75 
	sæow_t
 {

76 
Pack‘
 *
	msyn_·ck‘
;

77 
Pack‘
 *
	mfš_·ck‘
;

78 
Pack‘
 *
	md©a_·ck‘
;

79 
	mæow_couÁ
;

81 
æow_t
 *
	g_æows
;

82 
chªge_pÜts
();

83 
Pack‘
 *
g‘_·ck‘
();

85 
	gpublic
:

87 cÚ¡ 
NO_LIMIT
 = 0xFFFFFFFFU;

89 
G­R©e
 
	g_¿‹
;

90 
	g_couÁ
;

91 
	g_lim™
;

92 
boŞ
 
	g_aùive
;

94 
	$Fa¡TCPFlows
(è
CLICK_COLD
;

95 ~
	$Fa¡TCPFlows
(è
CLICK_COLD
;

97 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "Fa¡TCPFlows"; 
	}
}

98 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

99 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

101 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

102 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

103 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

104 
Pack‘
 *
	`puÎ
();

106 
	$add_hªdËrs
(è
CLICK_COLD
;

107 
	`»£t
();

108 
	$couÁ
(è{  
_couÁ
; 
	}
}

109 
şick_jiff›s_t
 
	$fœ¡
(è{  
_fœ¡
; 
	}
}

110 
şick_jiff›s_t
 
	$Ï¡
(è{  
_Ï¡
; 
	}
}

113 
	gCLICK_ENDDECLS


	@tcpudp/fastudpflows.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şickÃt/.h
>

20 
	~"ç¡udpæows.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/‘h”add»ss.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/glue.hh
>

25 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

27 
CLICK_DECLS


29 cÚ¡ 
	gFa¡UDPFlows
::
NO_LIMIT
;

31 
	gFa¡UDPFlows
::
	$Fa¡UDPFlows
()

32 : 
	$_æows
(0)

34 
_¿‹_lim™ed
 = 
Œue
;

35 
_fœ¡
 = 
_Ï¡
 = 0;

36 
_couÁ
 = 0;

37 
	}
}

39 
	gFa¡UDPFlows
::~
	$Fa¡UDPFlows
()

41 
	}
}

44 
Fa¡UDPFlows
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

46 
	g_cksum
 = 
Œue
;

47 
	g_aùive
 = 
Œue
;

48 
	g¿‹
;

49 
	glim™
;

50 
	gËn
;

51 ià(
Args
(
cÚf
, 
this
, 
”rh
)

52 .
»ad_mp
("RATE", 
¿‹
)

53 .
»ad_mp
("LIMIT", 
lim™
)

54 .
»ad_mp
("LENGTH", 
Ën
)

55 .
»ad_mp
("SRCETH", 
Eth”Add»ssArg
(), 
_‘hh
.
‘h”_sho¡
)

56 .
»ad_mp
("SRCIP", 
_saddr
)

57 .
»ad_mp
("DSTETH", 
Eth”Add»ssArg
(), 
_‘hh
.
‘h”_dho¡
)

58 .
»ad_mp
("DSTIP", 
_daddr
)

59 .
»ad_mp
("FLOWS", 
_næows
)

60 .
»ad_mp
("FLOWSIZE", 
_æowsize
)

61 .
»ad_p
("CHECKSUM", 
_cksum
)

62 .
»ad_p
("ACTIVE", 
_aùive
)

63 .
com¶‘e
() < 0)

65 
£t_Ëngth
(
Ën
);

66 
	g_‘hh
.
	g‘h”_ty³
 = 
htÚs
(0x0800);

67 if(
	g¿‹
 != 0){

68 
_¿‹_lim™ed
 = 
Œue
;

69 
	g_¿‹
.
£t_¿‹
(
¿‹
, 
”rh
);

71 
	g_¿‹_lim™ed
 = 
çl£
;

73 
	g_lim™
 = (
lim™
 >ğ0 ?†im™ : 
NO_LIMIT
);

78 
	gFa¡UDPFlows
::
	$chªge_pÜts
(
æow
)

80 
Wr™abËPack‘
 *
q
 = 
_æows
[
æow
].
·ck‘
->
	`uniqueify
();

81 
_æows
[
æow
].
·ck‘
 = 
q
;

82 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
q
->
	`d©a
()+14);

83 
şick_udp
 *
udp
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(

 + 1);

85 
udp
->
uh_¥Üt
 = (
	`şick_¿ndom
() >> 2) % 0xFFFF;

86 
udp
->
uh_dpÜt
 = (
	`şick_¿ndom
() >> 2) % 0xFFFF;

87 
udp
->
uh_sum
 = 0;

88 
Ën
 = 
_Ën
-14-(
şick_
);

89 ià(
_cksum
) {

90 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
udp
, 
Ën
);

91 
udp
->
uh_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
Ën
);

93 
udp
->
uh_sum
 = 0;

94 
	}
}

96 
Pack‘
 *

97 
	gFa¡UDPFlows
::
	$g‘_·ck‘
()

100 
æow
 = 
_Ï¡_æow
;

101 
_Ï¡_æow
 = _last_flow+1;

102 ià(
_Ï¡_æow
 >ğ
_næows
) _last_flow = 0;

104 
æow
 = (
	`şick_¿ndom
(è>> 2è% 
_næows
;

107 ià(
_æows
[
æow
].
æow_couÁ
 =ğ
_æowsize
) {

108 
	`chªge_pÜts
(
æow
);

109 
_æows
[
æow
].
æow_couÁ
 = 0;

111 
_æows
[
æow
].
æow_couÁ
++;

112  
_æows
[
æow
].
·ck‘
->
	`şÚe
();

113 
	}
}

117 
	gFa¡UDPFlows
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

119 
_couÁ
 = 0;

120 
_æows
 = 
Ãw
 
æow_t
[
_næows
];

122 
i
=0; i<
_næows
; i++) {

123 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(
_Ën
);

124 
_æows
[
i
].
·ck‘
 = 
q
;

125 
	`memıy
(
q
->
	`d©a
(), &
_‘hh
, 14);

126 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
q
->
	`d©a
()+14);

127 
şick_udp
 *
udp
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(

 + 1);

130 

->
_v
 = 4;

131 

->
_hl
 = (
şick_
) >> 2;

132 

->
_Ën
 = 
	`htÚs
(
_Ën
-14);

133 

->
_id
 = 0;

134 

->
_p
 = 
IP_PROTO_UDP
;

135 

->
_¤c
 = 
_saddr
;

136 

->
_d¡
 = 
_daddr
;

137 

->
_tos
 = 0;

138 

->
_off
 = 0;

139 

->
_‰l
 = 250;

140 

->
_sum
 = 0;

141 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

142 
_æows
[
i
].
·ck‘
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(
_daddr
));

143 
_æows
[
i
].
·ck‘
->
	`£t__h—d”
(

, (
şick_
));

146 
udp
->
uh_¥Üt
 = (
	`şick_¿ndom
() >> 2) % 0xFFFF;

147 
udp
->
uh_dpÜt
 = (
	`şick_¿ndom
() >> 2) % 0xFFFF;

148 
udp
->
uh_sum
 = 0;

149 
Ën
 = 
_Ën
-14-(
şick_
);

150 
udp
->
uh_uËn
 = 
	`htÚs
(
Ën
);

151 ià(
_cksum
) {

152 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
udp
, 
Ën
);

153 
udp
->
uh_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
Ën
);

155 
udp
->
uh_sum
 = 0;

156 
_æows
[
i
].
æow_couÁ
 = 0;

158 
_Ï¡_æow
 = 0;

160 
	}
}

163 
	gFa¡UDPFlows
::
	$ş—nup_æows
() {

164 ià(
_æows
) {

165 
i
=0; i<
_næows
; i++) {

166 
_æows
[
i
].
·ck‘
->
	`kl
();

167 
_æows
[
i
].
·ck‘
=0;

169 
d–‘e
[] 
_æows
;

170 
_æows
 = 0;

172 
	}
}

175 
	gFa¡UDPFlows
::
	$ş—nup
(
CËªupSge
)

177 
	`ş—nup_æows
();

178 
	}
}

180 
Pack‘
 *

181 
	gFa¡UDPFlows
::
	$puÎ
()

183 
Pack‘
 *
p
 = 0;

185 ià(!
_aùive
 || (
_lim™
 !ğ
NO_LIMIT
 && 
_couÁ
 >= _limit))  0;

187 if(
_¿‹_lim™ed
){

188 ià(
_¿‹
.
	`Ãed_upd©e
(
Time¡amp
::
	`now
())) {

189 
_¿‹
.
	`upd©e
();

190 
p
 = 
	`g‘_·ck‘
();

193 
p
 = 
	`g‘_·ck‘
();

195 if(
p
) {

196 
_couÁ
++;

197 if(
_couÁ
 == 1)

198 
_fœ¡
 = 
	`şick_jiff›s
();

199 if(
_lim™
 !ğ
NO_LIMIT
 && 
_couÁ
 >= _limit)

200 
_Ï¡
 = 
	`şick_jiff›s
();

203 (
p
);

204 
	}
}

207 
	gFa¡UDPFlows
::
	$»£t
()

209 
_couÁ
 = 0;

210 
_fœ¡
 = 0;

211 
_Ï¡
 = 0;

212 
	}
}

214 
SŒšg


215 
	$Fa¡UDPFlows_»ad_couÁ_hªdËr
(
EËm’t
 *
e
, *)

217 
Fa¡UDPFlows
 *
c
 = (Fa¡UDPFlow *)
e
;

218  
	`SŒšg
(
c
->
	`couÁ
());

219 
	}
}

221 
SŒšg


222 
	$Fa¡UDPFlows_»ad_¿‹_hªdËr
(
EËm’t
 *
e
, *)

224 
Fa¡UDPFlows
 *
c
 = (Fa¡UDPFlow *)
e
;

225 if(
c
->
	`Ï¡
() != 0){

226 
d
 = 
c
->
	`Ï¡
(è- c->
	`fœ¡
();

227 ià(
d
 < 1) d = 1;

228 
¿‹
 = 
c
->
	`couÁ
(è* 
CLICK_HZ
 / 
d
;

229  
	`SŒšg
(
¿‹
);

231  
	`SŒšg
("0");

233 
	}
}

236 
	gFa¡UDPFlows_»£t_wr™e_hªdËr


237 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *)

239 
Fa¡UDPFlows
 *
	gc
 = (Fa¡UDPFlow *)
e
;

240 
	gc
->
»£t
();

245 
	gFa¡UDPFlows_lim™_wr™e_hªdËr


246 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

248 
Fa¡UDPFlows
 *
	gc
 = (Fa¡UDPFlow *)
e
;

249 
	glim™
;

250 ià(!
IÁArg
().
·r£
(
s
, 
lim™
))

251  
	g”rh
->
”rÜ
("limit…arameter must be integer >= 0");

252 
	gc
->
	g_lim™
 = (
lim™
 >ğ0 ?†im™ : 
c
->
NO_LIMIT
);

257 
	gFa¡UDPFlows_¿‹_wr™e_hªdËr


258 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

260 
Fa¡UDPFlows
 *
	gc
 = (Fa¡UDPFlow *)
e
;

261 
	g¿‹
;

262 ià(!
IÁArg
().
·r£
(
s
, 
¿‹
))

263  
	g”rh
->
”rÜ
("rate…arameter must be integer >= 0");

264 ià(
	g¿‹
 > 
	gG­R©e
::
MAX_RATE
)

266  
”rh
->
”rÜ
("¿‹oØÏrge; max i %u", 
G­R©e
::
MAX_RATE
);

267 
	gc
->
	g_¿‹
.
£t_¿‹
(
¿‹
);

272 
	gFa¡UDPFlows_aùive_wr™e_hªdËr


273 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

275 
Fa¡UDPFlows
 *
	gc
 = (Fa¡UDPFlow *)
e
;

276 
boŞ
 
	gaùive
;

277 ià(!
BoŞArg
().
·r£
(
s
, 
aùive
))

278  
	g”rh
->
”rÜ
("active…arameter must be boolean");

279 
	gc
->
	g_aùive
 = 
aùive
;

280 ià(
	gaùive
è
	gc
->
»£t
();

285 
	gFa¡UDPFlows
::
Ëngth_wr™e_hªdËr


286 (cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

288 
Fa¡UDPFlows
 *
	gc
 = (Fa¡UDPFlow *)
e
;

289 
	gËn
;

290 ià(!
IÁArg
().
·r£
(
s
, 
Ën
))

291  
	g”rh
->
”rÜ
("length…arameter must be integer");

292 ià(
	gËn
 !ğ
c
->
_Ën
) {

293 
c
->
£t_Ëngth
(
Ën
);

294 
	gc
->
ş—nup_æows
();

295 
	gc
->
š™Ÿlize
(0);

301 
	gFa¡UDPFlows
::
	$add_hªdËrs
()

303 
	`add_»ad_hªdËr
("couÁ", 
Fa¡UDPFlows_»ad_couÁ_hªdËr
, 0);

304 
	`add_»ad_hªdËr
("¿‹", 
Fa¡UDPFlows_»ad_¿‹_hªdËr
, 0);

305 
	`add_wr™e_hªdËr
("¿‹", 
Fa¡UDPFlows_¿‹_wr™e_hªdËr
, 0);

306 
	`add_wr™e_hªdËr
("»£t", 
Fa¡UDPFlows_»£t_wr™e_hªdËr
, 0, 
HªdËr
::
BUTTON
);

307 
	`add_wr™e_hªdËr
("aùive", 
Fa¡UDPFlows_aùive_wr™e_hªdËr
, 0, 
HªdËr
::
CHECKBOX
);

308 
	`add_wr™e_hªdËr
("lim™", 
Fa¡UDPFlows_lim™_wr™e_hªdËr
, 0);

309 
	`add_d©a_hªdËrs
("Ëngth", 
HªdËr
::
OP_READ
, &
_Ën
);

310 
	`add_wr™e_hªdËr
("Ëngth", 
Ëngth_wr™e_hªdËr
, 0);

311 
	}
}

313 
CLICK_ENDDECLS


314 
EXPORT_ELEMENT
(
Fa¡UDPFlows
)

	@tcpudp/fastudpflows.hh

1 #iâdeà
FASTUDPFLOWS_HH


2 
	#FASTUDPFLOWS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/g­¿‹.hh
>

6 
	~<şick/·ck‘.hh
>

7 
	~<şickÃt/‘h”.h
>

8 
	~<şickÃt/udp.h
>

10 
CLICK_DECLS


59 şas 
	cFa¡UDPFlows
 : 
public
 
EËm’t
 {

61 
boŞ
 
_¿‹_lim™ed
;

62 
	m_Ën
;

63 
şick_‘h”
 
	m_‘hh
;

64 
š_addr
 
	m_saddr
;

65 
š_addr
 
	m_daddr
;

66 
	m_næows
;

67 
	m_Ï¡_æow
;

68 
	m_æowsize
;

69 
boŞ
 
	m_cksum
;

70 
şick_jiff›s_t
 
	m_fœ¡
;

71 
şick_jiff›s_t
 
	m_Ï¡
;

73 
	sæow_t
 {

74 
Pack‘
 *
	m·ck‘
;

75 
	mæow_couÁ
;

77 
æow_t
 *
	g_æows
;

78 
chªge_pÜts
();

79 
Pack‘
 *
g‘_·ck‘
();

81 
	$£t_Ëngth
(
Ën
) {

82 ià(
Ën
 < 60) {

83 
	`şick_ch©‹r
("warning:…acket†ength < 60, defaultingo 60");

84 
Ën
 = 60;

86 
_Ën
 = 
Ën
;

87 
	}
}

89 
	gpublic
:

91 cÚ¡ 
NO_LIMIT
 = 0xFFFFFFFFU;

93 
G­R©e
 
	g_¿‹
;

94 
	g_couÁ
;

95 
	g_lim™
;

96 
boŞ
 
	g_aùive
;

98 
	$Fa¡UDPFlows
(è
CLICK_COLD
;

99 ~
	$Fa¡UDPFlows
(è
CLICK_COLD
;

101 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "Fa¡UDPFlows"; 
	}
}

102 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

103 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

105 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

106 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

107 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

108 
Pack‘
 *
	`puÎ
();

110 
	`ş—nup_æows
();

111 
	`Ëngth_wr™e_hªdËr
 (cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
);

113 
	$add_hªdËrs
(è
CLICK_COLD
;

114 
	`»£t
();

115 
	$couÁ
(è{  
_couÁ
; 
	}
}

116 
şick_jiff›s_t
 
	$fœ¡
(è{  
_fœ¡
; 
	}
}

117 
şick_jiff›s_t
 
	$Ï¡
(è{  
_Ï¡
; 
	}
}

120 
	gCLICK_ENDDECLS


	@tcpudp/fastudpsrcip6.cc

17 
	~<şick/cÚfig.h
>

18 
	~<şickÃt/6.h
>

19 
	~"ç¡udp¤c6.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

25 cÚ¡ 
	gFa¡UDPSourûIP6
::
NO_LIMIT
;

27 
	gFa¡UDPSourûIP6
::
	$Fa¡UDPSourûIP6
()

28 : 
	$_·ck‘
(0)

30 
_¿‹_lim™ed
 = 
Œue
;

31 
_fœ¡
 = 
_Ï¡
 = 0;

32 
_couÁ
 = 0;

33 
	}
}

35 
	gFa¡UDPSourûIP6
::~
	$Fa¡UDPSourûIP6
()

37 
	}
}

40 
Fa¡UDPSourûIP6
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

42 
	g_cksum
 = 
Œue
;

43 
	g_aùive
 = 
Œue
;

44 
	g_š‹rv®
 = 0;

45 
	g¿‹
;

46 
	glim™
;

47 ià(
Args
(
cÚf
, 
this
, 
”rh
)

48 .
»ad_mp
("RATE", 
¿‹
)

49 .
»ad_mp
("LIMIT", 
lim™
)

50 .
»ad_mp
("LENGTH", 
_Ën
)

51 .
»ad_mp
("SRCETH", 
Eth”Add»ssArg
(), 
_‘hh
.
‘h”_sho¡
)

52 .
»ad_mp
("SRCIP6", 
_s6addr
)

53 .
»ad_mp
("SPORT", 
IPPÜtArg
(
IP_PROTO_UDP
), 
_¥Üt
)

54 .
»ad_mp
("DSTETH", 
Eth”Add»ssArg
(), 
_‘hh
.
‘h”_dho¡
)

55 .
»ad_mp
("DSTIP6", 
_d6addr
)

56 .
»ad_mp
("DPORT", 
IPPÜtArg
(
IP_PROTO_UDP
), 
_dpÜt
)

57 .
»ad_p
("CHECKSUM", 
_cksum
)

58 .
»ad_p
("INTERVAL", 
_š‹rv®
)

59 .
»ad_p
("ACTIVE", 
_aùive
)

60 .
com¶‘e
() < 0)

62 ià(
	g_Ën
 < 60) {

63 
şick_ch©‹r
("warning:…acket†ength < 60, defaultingo 60");

64 
	g_Ën
 = 60;

66 
	g_‘hh
.
	g‘h”_ty³
 = 
htÚs
(0x86DD);

67 if(
	g¿‹
 != 0){

68 
_¿‹_lim™ed
 = 
Œue
;

69 
	g_¿‹
.
£t_¿‹
(
¿‹
, 
”rh
);

71 
	g_¿‹_lim™ed
 = 
çl£
;

73 
	g_lim™
 = (
lim™
 >ğ0 ?†im™ : 
NO_LIMIT
);

78 
	gFa¡UDPSourûIP6
::
	$šü_pÜts
()

80 
Wr™abËPack‘
 *
q
 = 
_·ck‘
->
	`uniqueify
();

81 
_·ck‘
 = 
q
;

82 
şick_6
 *
6
 = 
»š‹½»t_ÿ¡
<şick_6 *>(
q
->
	`d©a
()+14);

83 
şick_udp
 *
udp
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(
6
 + 1);

84 
_šü
++;

85 
udp
->
uh_¥Üt
 = 
	`htÚs
(
_¥Üt
+
_šü
);

86 
udp
->
uh_dpÜt
 = 
	`htÚs
(
_dpÜt
+
_šü
);

87 
udp
->
uh_sum
 = 0;

89 ià(
_cksum
) {

94 
udp
->
uh_sum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6
->
6_¤c
, &6->
6_d¡
, ip6->
6_¶’
, ip6->
6_nxt
, udp->uh_sum, (*)udp, ip6->ip6_plen));

96 
udp
->
uh_sum
 = 0;

97 
	}
}

100 
	gFa¡UDPSourûIP6
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

102 
_couÁ
 = 0;

103 
_šü
 = 0;

104 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(
_Ën
);

105 
_·ck‘
 = 
q
;

106 
	`memıy
(
q
->
	`d©a
(), &
_‘hh
, 14);

107 
şick_6
 *
6
 = 
»š‹½»t_ÿ¡
<şick_6 *>(
q
->
	`d©a
()+14);

108 
şick_udp
 *
udp
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(
6
 + 1);

111 
6
->
6_æow
 = 0;

112 
6
->
6_v
 = 6;

113 
6
->
6_¶’
 = 
	`htÚs
(
_Ën
 - 14 - (
şick_6
));

114 
6
->
6_nxt
 = 
IP_PROTO_UDP
;

115 
6
->
6_hlim
 = 250;

116 
6
->
6_¤c
 = 
_s6addr
;

117 
6
->
6_d¡
 = 
_d6addr
;

118 
	`SET_DST_IP6_ANNO
(
_·ck‘
, 
_d6addr
);

119 
_·ck‘
->
	`£t_6_h—d”
(
6
, (
şick_6
));

122 
udp
->
uh_¥Üt
 = 
	`htÚs
(
_¥Üt
);

123 
udp
->
uh_dpÜt
 = 
	`htÚs
(
_dpÜt
);

124 
udp
->
uh_sum
 = 0;

125 
Ën
 = 
_Ën
-14-(
şick_6
);

126 
udp
->
uh_uËn
 = 
	`htÚs
(
Ën
);

127 ià(
_cksum
) {

132 
udp
->
uh_sum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6
->
6_¤c
, &6->
6_d¡
, ip6->
6_¶’
, ip6->
6_nxt
, udp->uh_sum, (*)udp, ip6->ip6_plen));

135 
udp
->
uh_sum
 = 0;

138 
	}
}

141 
	gFa¡UDPSourûIP6
::
	$ş—nup
(
CËªupSge
)

143 ià(
_·ck‘
) {

144 
_·ck‘
->
	`kl
();

145 
_·ck‘
=0;

147 
	}
}

149 
Pack‘
 *

150 
	gFa¡UDPSourûIP6
::
	$puÎ
()

152 
Pack‘
 *
p
 = 0;

154 ià(!
_aùive
 || (
_lim™
 !ğ
NO_LIMIT
 && 
_couÁ
 >= _limit))  0;

156 if(
_¿‹_lim™ed
){

157 ià(
_¿‹
.
	`Ãed_upd©e
(
Time¡amp
::
	`now
())) {

158 
_¿‹
.
	`upd©e
();

159 
p
 = 
_·ck‘
->
	`şÚe
();

162 
p
 = 
_·ck‘
->
	`şÚe
();

165 if(
p
) {

166 
_couÁ
++;

167 if(
_couÁ
 == 1)

168 
_fœ¡
 = 
	`şick_jiff›s
();

169 if(
_lim™
 !ğ
NO_LIMIT
 && 
_couÁ
 >= _limit)

170 
_Ï¡
 = 
	`şick_jiff›s
();

171 if(
_š‹rv®
>0 && !(
_couÁ
%_interval))

172 
	`šü_pÜts
();

175 (
p
);

176 
	}
}

179 
	gFa¡UDPSourûIP6
::
	$»£t
()

181 
_couÁ
 = 0;

182 
_fœ¡
 = 0;

183 
_Ï¡
 = 0;

184 
_šü
 = 0;

185 
	}
}

187 
SŒšg


188 
	$Fa¡UDPSourûIP6_»ad_couÁ_hªdËr
(
EËm’t
 *
e
, *)

190 
Fa¡UDPSourûIP6
 *
c
 = (Fa¡UDPSourûIP6 *)
e
;

191  
	`SŒšg
(
c
->
	`couÁ
());

192 
	}
}

194 
SŒšg


195 
	$Fa¡UDPSourûIP6_»ad_¿‹_hªdËr
(
EËm’t
 *
e
, *)

197 
Fa¡UDPSourûIP6
 *
c
 = (Fa¡UDPSourûIP6 *)
e
;

198 if(
c
->
	`Ï¡
() != 0){

199 
d
 = 
c
->
	`Ï¡
(è- c->
	`fœ¡
();

200 ià(
d
 < 1) d = 1;

201 
¿‹
 = 
c
->
	`couÁ
(è* 
CLICK_HZ
 / 
d
;

202  
	`SŒšg
(
¿‹
);

204  
	`SŒšg
("0");

206 
	}
}

209 
	gFa¡UDPSourûIP6_»£t_wr™e_hªdËr


210 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *)

212 
Fa¡UDPSourûIP6
 *
	gc
 = (Fa¡UDPSourûIP6 *)
e
;

213 
	gc
->
»£t
();

218 
	gFa¡UDPSourûIP6_lim™_wr™e_hªdËr


219 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

221 
Fa¡UDPSourûIP6
 *
	gc
 = (Fa¡UDPSourûIP6 *)
e
;

222 
	glim™
;

223 ià(!
IÁArg
().
·r£
(
s
, 
lim™
))

224  
	g”rh
->
”rÜ
("limit…arameter must be integer >= 0");

225 
	gc
->
	g_lim™
 = (
lim™
 >ğ0 ?†im™ : 
c
->
NO_LIMIT
);

230 
	gFa¡UDPSourûIP6_¿‹_wr™e_hªdËr


231 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

233 
Fa¡UDPSourûIP6
 *
	gc
 = (Fa¡UDPSourûIP6 *)
e
;

234 
	g¿‹
;

235 ià(!
IÁArg
().
·r£
(
s
, 
¿‹
))

236  
	g”rh
->
”rÜ
("rate…arameter must be integer >= 0");

237 ià(
	g¿‹
 > 
	gG­R©e
::
MAX_RATE
)

239  
”rh
->
”rÜ
("¿‹oØÏrge; max i %u", 
G­R©e
::
MAX_RATE
);

240 
	gc
->
	g_¿‹
.
£t_¿‹
(
¿‹
);

245 
	gFa¡UDPSourûIP6_aùive_wr™e_hªdËr


246 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

248 
Fa¡UDPSourûIP6
 *
	gc
 = (Fa¡UDPSourûIP6 *)
e
;

249 
boŞ
 
	gaùive
;

250 ià(!
BoŞArg
().
·r£
(
s
, 
aùive
))

251  
	g”rh
->
”rÜ
("active…arameter must be boolean");

252 
	gc
->
	g_aùive
 = 
aùive
;

253 ià(
	gaùive
è
	gc
->
»£t
();

258 
	gFa¡UDPSourûIP6
::
	$add_hªdËrs
()

260 
	`add_»ad_hªdËr
("couÁ", 
Fa¡UDPSourûIP6_»ad_couÁ_hªdËr
, 0);

261 
	`add_»ad_hªdËr
("¿‹", 
Fa¡UDPSourûIP6_»ad_¿‹_hªdËr
, 0);

262 
	`add_wr™e_hªdËr
("¿‹", 
Fa¡UDPSourûIP6_¿‹_wr™e_hªdËr
, 0);

263 
	`add_wr™e_hªdËr
("»£t", 
Fa¡UDPSourûIP6_»£t_wr™e_hªdËr
, 0, 
HªdËr
::
BUTTON
);

264 
	`add_wr™e_hªdËr
("aùive", 
Fa¡UDPSourûIP6_aùive_wr™e_hªdËr
, 0, 
HªdËr
::
CHECKBOX
);

265 
	`add_wr™e_hªdËr
("lim™", 
Fa¡UDPSourûIP6_lim™_wr™e_hªdËr
, 0);

266 
	}
}

268 
	$ELEMENT_REQUIRES
(
6
)

269 
	`EXPORT_ELEMENT
(
Fa¡UDPSourûIP6
)

	@tcpudp/fastudpsrcip6.hh

1 #iâdeà
FASTUDPSRCIP6_HH


2 
	#FASTUDPSRCIP6_HH


	)

53 
	~<şick/–em’t.hh
>

54 
	~<şick/glue.hh
>

55 
	~<şick/g­¿‹.hh
>

56 
	~<şick/·ck‘.hh
>

57 
	~<şickÃt/‘h”.h
>

58 
	~<şickÃt/udp.h
>

59 
	~<şick/6add»ss.hh
>

61 şas 
	cFa¡UDPSourûIP6
 : 
public
 
EËm’t
 {

63 
boŞ
 
_¿‹_lim™ed
;

64 
	m_Ën
;

65 
şick_‘h”
 
	m_‘hh
;

66 
IP6Add»ss
 
	m_s6addr
;

67 
IP6Add»ss
 
	m_d6addr
;

68 
ušt16_t
 
	m_¥Üt
;

69 
ušt16_t
 
	m_dpÜt
;

70 
	m_šü
;

71 
	m_š‹rv®
;

72 
boŞ
 
	m_cksum
;

73 
Pack‘
 *
	m_·ck‘
;

74 
şick_jiff›s_t
 
	m_fœ¡
;

75 
şick_jiff›s_t
 
	m_Ï¡
;

77 
šü_pÜts
();

79 
	mpublic
:

81 cÚ¡ 
NO_LIMIT
 = 0xFFFFFFFFU;

83 
G­R©e
 
	m_¿‹
;

84 
	m_couÁ
;

85 
	m_lim™
;

86 
boŞ
 
	m_aùive
;

88 
Fa¡UDPSourûIP6
();

89 ~
Fa¡UDPSourûIP6
();

91 cÚ¡ *
	$şass_Çme
() const {  "FastUDPSourceIP6"; }

92 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

93 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

95 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

96 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

97 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

98 
Pack‘
 *
	`puÎ
();

100 
	$add_hªdËrs
(è
CLICK_COLD
;

101 
	`»£t
();

102 
	$couÁ
(è{  
_couÁ
; 
	}
}

103 
şick_jiff›s_t
 
	$fœ¡
(è{  
_fœ¡
; 
	}
}

104 
şick_jiff›s_t
 
	$Ï¡
(è{  
_Ï¡
; 
	}
}

107 
ä›nd
 
	gFa¡UDPSourûIP6_lim™_wr™e_hªdËr


108 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *);

109 
ä›nd
 
	gFa¡UDPSourûIP6_¿‹_wr™e_hªdËr


110 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *);

111 
ä›nd
 
	gFa¡UDPSourûIP6_aùive_wr™e_hªdËr


112 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *);

	@tcpudp/iprewriter.cc

19 
	~<şick/cÚfig.h
>

20 
	~"»wr™”.hh
"

21 
	~<şickÃt/.h
>

22 
	~<şickÃt/tı.h
>

23 
	~<şickÃt/udp.h
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/”rÜ.hh
>

27 
	~<şick/tim”.hh
>

28 
	~<şick/rou‹r.hh
>

29 
CLICK_DECLS


31 
	gIPRewr™”
::
	$IPRewr™”
()

32 : 
	$_udp_m­
(0)

34 
	}
}

36 
IPRewr™”
::~
	$IPRewr™”
()

38 
	}
}

41 
IPRewr™”
::
	$ÿ¡
(cÚ¡ *
n
)

43 ià(
	`¡rcmp
(
n
, "IPRewriterBase") == 0)

44  (
IPRewr™”Ba£
 *)
this
;

45 ià(
	`¡rcmp
(
n
, "TCPRewriter") == 0)

46  (
TCPRewr™”
 *)
this
;

47 ià(
	`¡rcmp
(
n
, "IPRewriter") == 0)

48  
this
;

51 
	}
}

54 
	gIPRewr™”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

56 
boŞ
 
	ghas_udp_¡»amšg_timeout
 = 
çl£
;

57 
	g_udp_timeouts
[0] = 60 * 5;

58 
	g_udp_timeouts
[1] = 5;

60 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

61 .
»ad
("UDP_TIMEOUT", 
SecÚdsArg
(), 
_udp_timeouts
[0])

62 .
»ad
("UDP_STREAMING_TIMEOUT", 
SecÚdsArg
(), 
_udp_¡»amšg_timeout
).
»ad_¡©us
(
has_udp_¡»amšg_timeout
)

63 .
»ad
("UDP_GUARANTEE", 
SecÚdsArg
(), 
_udp_timeouts
[1])

64 .
cÚsume
() < 0)

67 ià(!
	ghas_udp_¡»amšg_timeout
)

68 
	g_udp_¡»amšg_timeout
 = 
_udp_timeouts
[0];

69 
	g_udp_timeouts
[0] *ğ
CLICK_HZ
;

70 
	g_udp_timeouts
[1] *ğ
CLICK_HZ
;

71 
	g_udp_¡»amšg_timeout
 *ğ
CLICK_HZ
;

73  
	gTCPRewr™”
::
cÚfigu»
(
cÚf
, 
”rh
);

76 
šlše
 
IPRewr™”EÁry
 *

77 
	gIPRewr™”
::
	$g‘_’Œy
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
, 
šput
)

79 ià(
_p
 =ğ
IP_PROTO_TCP
)

80  
TCPRewr™”
::
	`g‘_’Œy
(
_p
, 
æowid
, 
šput
);

81 ià(
_p
 !ğ
IP_PROTO_UDP
)

83 
IPRewr™”EÁry
 *
m
 = 
_udp_m­
.
	`g‘
(
æowid
);

84 ià(!
m
 && (è
šput
 < (è
_šput_¥ecs
.
	`size
()) {

85 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
[
šput
];

86 
IPFlowID
 
»wr™‹n_æowid
 = IPFlowID::
	`unš™Ÿlized_t
();

87 ià(
is
.
	`»wr™e_æowid
(
æowid
, 
»wr™‹n_æowid
, 0, 
IPRewr™”IÅut
::
m­id_»wr™”_udp
è=ğ
rw_addm­
)

88 
m
 = 
IPRewr™”
::
	`add_æow
(0, 
æowid
, 
»wr™‹n_æowid
, 
šput
);

90  
m
;

91 
	}
}

93 
IPRewr™”EÁry
 *

94 
	gIPRewr™”
::
	$add_æow
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
,

95 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
, 
šput
)

97 ià(
_p
 =ğ
IP_PROTO_TCP
)

98  
TCPRewr™”
::
	`add_æow
(
_p
, 
æowid
, 
»wr™‹n_æowid
, 
šput
);

100 *
d©a
;

101 ià(!(
d©a
 = 
_udp_®loÿtÜ
.
	`®loÿ‹
()))

104 
IPRewr™”IÅut
 *
rwšput
 = &
_šput_¥ecs
[
šput
];

105 
IPRewr™”Flow
 *
æow
 = 
	`Ãw
(
d©a
) IPRewriterFlow

106 (
rwšput
, 
æowid
, 
»wr™‹n_æowid
, 
_p
,

107 !!
_udp_timeouts
[1], 
	`şick_jiff›s
(è+ 
	`»Ëvªt_timeout
(_udp_timeouts));

109  
	`¡Üe_æow
(
æow
, 
šput
, 
_udp_m­
, &
	`»¶y_udp_m­
(
rwšput
));

110 
	}
}

113 
	gIPRewr™”
::
	$push
(
pÜt
, 
Pack‘
 *
p_š
)

115 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

116 
şick_
 *
h
 = 
p
->
	`_h—d”
();

119 ià((
h
->
_p
 !ğ
IP_PROTO_TCP
 && iph->_°!ğ
IP_PROTO_UDP
)

120 || !
	`IP_FIRSTFRAG
(
h
)

121 || 
p
->
	`Œª¥Üt_Ëngth
() < 8) {

122 cÚ¡ 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
[
pÜt
];

123 ià(
is
.
kšd
 =ğ
IPRewr™”IÅut
::
i_nochªge
)

124 
	`ouut
(
is
.
fouut
).
	`push
(
p
);

126 
p
->
	`kl
();

130 
IPFlowID
 
	`æowid
(
p
);

131 
HashCÚš”
<
IPRewr™”EÁry
> *
m­
 = (
h
->
_p
 =ğ
IP_PROTO_TCP
 ? &
_m­
 : &
_udp_m­
);

132 
IPRewr™”EÁry
 *
m
 = 
m­
->
	`g‘
(
æowid
);

134 ià(!
m
) {

135 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
.
	`unchecked_©
(
pÜt
);

136 
IPFlowID
 
»wr™‹n_æowid
 = IPFlowID::
	`unš™Ÿlized_t
();

137 
»suÉ
 = 
is
.
	`»wr™e_æowid
(
æowid
, 
»wr™‹n_æowid
, 
p
, 
h
->
_p
 =ğ
IP_PROTO_TCP
 ? 0 : 
IPRewr™”IÅut
::
m­id_»wr™”_udp
);

138 ià(
»suÉ
 =ğ
rw_addm­
)

139 
m
 = 
IPRewr™”
::
	`add_æow
(
h
->
_p
, 
æowid
, 
»wr™‹n_æowid
, 
pÜt
);

140 ià(!
m
) {

141 
	`checked_ouut_push
(
»suÉ
, 
p
);

143 } ià(
_ªnos
 & 2)

144 
m
->
	`æow
()->
	`£t_»¶y_ªno
(
p
->
	`ªno_u8
(
_ªnos
 >> 2));

147 
şick_jiff›s_t
 
now_j
 = 
	`şick_jiff›s
();

148 
IPRewr™”Flow
 *
mf
 = 
m
->
	`æow
();

149 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
) {

150 
TCPFlow
 *
tımf
 = 
¡©ic_ÿ¡
<TCPFlow *>(
mf
);

151 
tımf
->
	`­¶y
(
p
, 
m
->
	`dœeùiÚ
(), 
_ªnos
);

152 ià(
_timeouts
[1])

153 
tımf
->
	`chªge_expœy
(
_h—p
, 
Œue
, 
now_j
 + 
_timeouts
[1]);

155 
tımf
->
	`chªge_expœy
(
_h—p
, 
çl£
, 
now_j
 + 
	`tı_æow_timeout
(tcpmf));

157 
UDPFlow
 *
udpmf
 = 
¡©ic_ÿ¡
<UDPFlow *>(
mf
);

158 
udpmf
->
	`­¶y
(
p
, 
m
->
	`dœeùiÚ
(), 
_ªnos
);

159 ià(
_udp_timeouts
[1])

160 
udpmf
->
	`chªge_expœy
(
_h—p
, 
Œue
, 
now_j
 + 
_udp_timeouts
[1]);

162 
udpmf
->
	`chªge_expœy
(
_h—p
, 
çl£
, 
now_j
 + 
	`udp_æow_timeout
(udpmf));

165 
	`ouut
(
m
->ouut()).
	`push
(
p
);

166 
	}
}

168 
SŒšg


169 
	gIPRewr™”
::
	$udp_m­pšgs_hªdËr
(
EËm’t
 *
e
, *)

171 
IPRewr™”
 *
rw
 = (IPRewr™” *)
e
;

172 
şick_jiff›s_t
 
now
 = 
	`şick_jiff›s
();

173 
SŒšgAccum
 
§
;

174 
M­
::
™”©Ü
 
™”
 = 
rw
->
_udp_m­
.
	`begš
(); i‹r.
	`live
(); ++iter) {

175 
™”
->
	`æow
()->
	`uÅ¬£
(
§
, i‹r->
	`dœeùiÚ
(), 
now
);

176 
§
 << '\n';

178  
§
.
	`ke_¡ršg
();

179 
	}
}

182 
	gIPRewr™”
::
	$add_hªdËrs
()

184 
	`add_»ad_hªdËr
("tı_bË", 
tı_m­pšgs_hªdËr
);

185 
	`add_»ad_hªdËr
("udp_bË", 
udp_m­pšgs_hªdËr
);

186 
	`add_»ad_hªdËr
("tı_m­pšgs", 
tı_m­pšgs_hªdËr
, 0, 
HªdËr
::
h_d•»ÿ‹d
);

187 
	`add_»ad_hªdËr
("udp_m­pšgs", 
udp_m­pšgs_hªdËr
, 0, 
HªdËr
::
h_d•»ÿ‹d
);

188 
	`£t_hªdËr
("tı_lookup", 
HªdËr
::
OP_READ
 | HªdËr::
READ_PARAM
, 
tı_lookup_hªdËr
, 0);

189 
	`add_»wr™”_hªdËrs
(
Œue
);

190 
	}
}

192 
CLICK_ENDDECLS


193 
	$ELEMENT_REQUIRES
(
TCPRewr™”
 
UDPRewr™”
)

194 
	`EXPORT_ELEMENT
(
IPRewr™”
)

	@tcpudp/iprewriter.hh

1 #iâdeà
CLICK_IPREWRITER_HH


2 
	#CLICK_IPREWRITER_HH


	)

3 
	~"tı»wr™”.hh
"

4 
	~"ud´ewr™”.hh
"

5 
CLICK_DECLS


6 
şass
 
	gUDPRewr™”
;

219 şas 
	cIPRewr™”
 : 
public
 
TCPRewr™”
 {…ublic:

221 
UDPRewr™”
::
	tUDPFlow
 UDPFlow;

223 
	$IPRewr™”
(è
CLICK_COLD
;

224 ~
	$IPRewr™”
(è
CLICK_COLD
;

226 cÚ¡ *
	$şass_Çme
() const {  "IPRewriter"; }

227 *
	`ÿ¡
(const *);

229 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

231 
IPRewr™”EÁry
 *
	`g‘_’Œy
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
, 
šput
);

232 
HashCÚš”
<
IPRewr™”EÁry
> *
	$g‘_m­
(
m­id
) {

233 ià(
m­id
 =ğ
IPRewr™”IÅut
::
m­id_deçuÉ
)

234  &
_m­
;

235 ià(
m­id
 =ğ
IPRewr™”IÅut
::
m­id_»wr™”_udp
)

236  &
_udp_m­
;

239 
	}
}

240 
IPRewr™”EÁry
 *
add_æow
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
,

241 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
, 
šput
);

242 
de¡roy_æow
(
IPRewr™”Flow
 *
æow
);

243 
şick_jiff›s_t
 
	$be¡_effÜt_expœy
(cÚ¡ 
IPRewr™”Flow
 *
æow
) {

244 ià(
æow
->
	`_p
(è=ğ
IP_PROTO_TCP
)

245  
TCPRewr™”
::
	`be¡_effÜt_expœy
(
æow
);

247  
æow
->
	`expœy
(è+ 
	`udp_æow_timeout
(
¡©ic_ÿ¡
<cÚ¡ 
UDPFlow
 *>(æow)è- 
_udp_timeouts
[1];

248 
	}
}

250 
push
(, 
Pack‘
 *);

252 
	$add_hªdËrs
(è
CLICK_COLD
;

254 
´iv©e
:

256 
M­
 
_udp_m­
;

257 
SizedHashAÎoÿtÜ
<(
UDPFlow
)> 
_udp_®loÿtÜ
;

258 
ušt32_t
 
_udp_timeouts
[2];

259 
ušt32_t
 
_udp_¡»amšg_timeout
;

261 
	$udp_æow_timeout
(cÚ¡ 
UDPFlow
 *
mf
) const {

262 ià(
mf
->
	`¡»amšg
())

263  
_udp_¡»amšg_timeout
;

265  
_udp_timeouts
[0];

266 
	}
}

268 
šlše
 
	gM­
 &
	$»¶y_udp_m­
(
IPRewr™”IÅut
 *
rwšput
) {

269 
IPRewr™”
 *
x
 = 
¡©ic_ÿ¡
<IPRewr™” *>(
rwšput
->
»¶y_–em’t
);

270  
x
->
_udp_m­
;

271 
	}
}

272 
SŒšg
 
udp_m­pšgs_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
);

277 
šlše
 

278 
	gIPRewr™”
::
	$de¡roy_æow
(
IPRewr™”Flow
 *
æow
)

280 ià(
æow
->
	`_p
(è=ğ
IP_PROTO_TCP
)

281 
TCPRewr™”
::
	`de¡roy_æow
(
æow
);

283 
	`unm­_æow
(
æow
, 
_udp_m­
, &
	`»¶y_udp_m­
(æow->
	`owÃr
()));

284 
æow
->~
	`IPRewr™”Flow
();

285 
_udp_®loÿtÜ
.
	`d—Îoÿ‹
(
æow
);

287 
	}
}

289 
	gCLICK_ENDDECLS


	@tcpudp/settcpchecksum.cc

18 
	~<şick/cÚfig.h
>

19 
	~"£‰ıchecksum.hh
"

20 
	~<şick/glue.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şickÃt/.h
>

24 
	~<şickÃt/tı.h
>

25 
CLICK_DECLS


27 
	gS‘TCPChecksum
::
	$S‘TCPChecksum
()

28 : 
	$_fixoff
(
çl£
)

30 
	}
}

32 
S‘TCPChecksum
::~
	$S‘TCPChecksum
()

34 
	}
}

37 
S‘TCPChecksum
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39  
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad_p
("FIXOFF", 
_fixoff
)

41 .
com¶‘e
();

44 
Pack‘
 *

45 
	gS‘TCPChecksum
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

47 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

48 
şick_
 *
h
 = 
p
->
	`_h—d”
();

49 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

50 
¶’
 = 
	`Áohs
(
h
->
_Ën
è- (h->
_hl
 << 2);

51 
csum
;

53 ià(!
p
->
	`has_Œª¥Üt_h—d”
(è|| 
¶’
 < (
şick_tı
)

54 || 
¶’
 > ()
p
->
	`Œª¥Üt_Ëngth
())

55 
bad
;

57 ià(
_fixoff
) {

58 
off
 = 
tıh
->
th_off
 << 2;

59 ià(
off
 < (
şick_tı
))

60 
tıh
->
th_off
 = (
şick_tı
) >> 2;

61 ià(
off
 > 
¶’
 && !
	`IP_ISFRAG
(
h
))

62 
tıh
->
th_off
 = 
¶’
 >> 2;

65 
tıh
->
th_sum
 = 0;

66 
csum
 = 
	`şick_š_cksum
((*)
tıh
, 
¶’
);

67 
tıh
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 
h
, 
¶’
);

69  
p
;

71 
bad
:

72 
	`şick_ch©‹r
("SetTCPChecksum: bad†engths");

73 
p
->
	`kl
();

75 
	}
}

77 
CLICK_ENDDECLS


78 
	$EXPORT_ELEMENT
(
S‘TCPChecksum
)

79 
	`ELEMENT_MT_SAFE
(
S‘TCPChecksum
)

	@tcpudp/settcpchecksum.hh

1 #iâdeà
CLICK_SETTCPCHECKSUM_HH


2 
	#CLICK_SETTCPCHECKSUM_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


21 şas 
	cS‘TCPChecksum
 : 
public
 
EËm’t
 {…ublic:

23 
	$S‘TCPChecksum
(è
CLICK_COLD
;

24 ~
	$S‘TCPChecksum
(è
CLICK_COLD
;

26 cÚ¡ *
	$şass_Çme
() const {  "SetTCPChecksum"; }

27 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

28 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
	gCLICK_COLD
;

30 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

32 
	g´iv©e
:

33 
boŞ
 
_fixoff
;

36 
	gCLICK_ENDDECLS


	@tcpudp/setudpchecksum.cc

20 
	~<şick/cÚfig.h
>

21 
	~"£tudpchecksum.hh
"

22 
	~<şick/glue.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/rou‹r.hh
>

25 
	~<şickÃt/.h
>

26 
	~<şickÃt/udp.h
>

27 
CLICK_DECLS


29 
	gS‘UDPChecksum
::
	$S‘UDPChecksum
()

31 
	}
}

33 
S‘UDPChecksum
::~
	$S‘UDPChecksum
()

35 
	}
}

37 
Pack‘
 *

38 
S‘UDPChecksum
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

40 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

41 ià(!
p
)

45 
şick_
 *
h
 = 
p
->
	`_h—d”
();

46 
şick_udp
 *
udph
 = 
p
->
	`udp_h—d”
();

47 
Ën
;

48 ià(
	`IP_ISFRAG
(
h
)

49 || 
p
->
	`Œª¥Üt_Ëngth
(è< (è(
şick_udp
)

50 || (
Ën
 = 
	`Áohs
(
udph
->
uh_uËn
),

51 
p
->
	`Œª¥Üt_Ëngth
(è< 
Ën
)) {

53 ià(
	`nouuts
() == 1) {

54 *&
x
 = 
	`rou‹r
()->
	`fÜû_©chm’t
("SetUDPChecksum_message");

55 ià(!
x
) {

56 
	`şick_ch©‹r
("%p{–em’t}: f¿gm’ˆÜ shÜˆ·ck‘", 
this
);

57 
x
 = 
this
;

60 
	`checked_ouut_push
(1, 
p
);

64 
udph
->
uh_sum
 = 0;

65 
csum
 = 
	`şick_š_cksum
((*)
udph
, 
Ën
);

66 
udph
->
uh_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 
h
, 
Ën
);

68  
p
;

69 
	}
}

71 
CLICK_ENDDECLS


72 
	$EXPORT_ELEMENT
(
S‘UDPChecksum
)

73 
	`ELEMENT_MT_SAFE
(
S‘UDPChecksum
)

	@tcpudp/setudpchecksum.hh

2 #iâdeà
CLICK_SETUDPCHECKSUM_HH


3 
	#CLICK_SETUDPCHECKSUM_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/glue.hh
>

6 
CLICK_DECLS


25 şas 
	cS‘UDPChecksum
 : 
public
 
EËm’t
 {…ublic:

27 
	$S‘UDPChecksum
(è
CLICK_COLD
;

28 ~
	$S‘UDPChecksum
(è
CLICK_COLD
;

30 cÚ¡ *
	$şass_Çme
() const {  "SetUDPChecksum"; }

31 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

32 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

34 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

38 
	gCLICK_ENDDECLS


	@tcpudp/snooptcp.cc

18 
	~<şick/cÚfig.h
>

19 #ifdeà
__lšux__


20 
	#_BSD_SOURCE


	)

22 
	~"¢oİtı.hh
"

23 
	~<şick/add»ss.hh
>

24 
	~<şick/cÚå¬£.hh
>

25 
	~<şick/”rÜ.hh
>

26 
	~<şick/glue.hh
>

27 
	~<şick/b™veùÜ.hh
>

28 #ifdeà
DEBUG


29 
	#DEBUG_CHATTER
(
¬gs
...è
	`şick_ch©‹r
×rgs)

	)

31 
	#DEBUG_CHATTER
(
¬gs
...è

	)

33 
CLICK_DECLS


35 
	gSnoİTCP
::
	$SnoİTCP
()

37 
	}
}

39 
SnoİTCP
::~
	$SnoİTCP
()

41 
	}
}

44 
SnoİTCP
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

46  
”rh
->
	`”rÜ
("SnoopTCP is‚ot„eadyo use");

47 
	}
}

50 
šlše
 

51 
	gSnoİTCP
::
SCacheEÁry
::
	$ş—r
()

53 
	`as£¹
(
·ck‘
);

54 
·ck‘
->
	`kl
();

55 
·ck‘
 = 0;

56 
	}
}

59 
	gSnoİTCP
::
PCB
::
	$PCB
()

60 : 
	`_h—d
(0), 
	`_
(0), 
	`_s_exi¡s
(0), 
	`_s_®ive
(0), 
	`_mh_exi¡s
(0), 
	$_mh_®ive
(0)

62 
	}
}

64 
	gSnoİTCP
::
PCB
::~
	$PCB
()

66 
i
 = 
_
; i !ğ
_h—d
; i = 
	`Ãxt_i
(i))

67 
_s_ÿche
[
i
].
·ck‘
->
	`kl
();

68 
	}
}

71 
	gSnoİTCP
::
PCB
::
	$ş—r
(
boŞ
 
is_s
)

73 ià(
is_s
 && 
_s_exi¡s
) {

75 
i
 = 
_
; i !ğ
_h—d
; i = 
	`Ãxt_i
(i))

76 
_s_ÿche
[
i
].
·ck‘
->
	`kl
();

77 
_h—d
 = 
_
 = 0;

79 
_s_exi¡s
 = 
_s_®ive
 = 
çl£
;

80 } ià(!
is_s
 && 
_mh_exi¡s
) {

81 
_mh_exi¡s
 = 
_mh_®ive
 = 
çl£
;

84 
	}
}

87 
	gSnoİTCP
::
PCB
::
	$š™Ÿlize
(
boŞ
 
is_s
, cÚ¡ 
şick_tı
 *
tıh
, 
d©®’
)

89 
£q
 = 
	`Áohl
(
tıh
->
th_£q
);

91 ià(
is_s
) {

92 
	`as£¹
(!
_s_exi¡s
);

93 
_s_exi¡s
 = 
_s_®ive
 = 
Œue
;

95 
_s_max
 = 
£q
 + 
d©®’
;

96 
_mh_Ï¡_ack
 = 
£q
 - 1;

97 
_mh_ex³ùed_dup_acks
 = 0;

98 
_mh_dup_acks
 = 0;

113 
_mh_exi¡s
 = 
_mh_®ive
 = 
Œue
;

115 
	}
}

118 
	gSnoİTCP
::
PCB
::
	$ş—n
(
ack
)

121 
Time¡amp
 
Ï¡_ş—Ãd_time
;

123 
i
 = 
_
;

124 
i
 !ğ
_h—d
 && 
	`SEQ_LEQ
(
_s_ÿche
[i].
£q
 + _s_ÿche[i].
size
, 
ack
)) {

125 
SCacheEÁry
 &
ÿche
 = 
_s_ÿche
[
i
];

126 ià(
ÿche
.
¢d_time
 > 
Ï¡_ş—Ãd_time
)

127 
Ï¡_ş—Ãd_time
 = 
ÿche
.
¢d_time
;

128 
ÿche
.
	`ş—r
();

129 
i
 = 
	`Ãxt_i
(i);

131 
_
 = 
i
;

134 
	}
}

138 
	gSnoİTCP
::
PCB
::
	$s_ack
(
Pack‘
 *, cÚ¡ 
şick_tı
 *, )

141 
	}
}

144 
Pack‘
 *

145 
	gSnoİTCP
::
PCB
::
	$s_d©a
(
Pack‘
 *
p
, cÚ¡ 
şick_tı
 *
tıh
, 
d©®’
)

149 ià(!
_s_exi¡s
)

150 
	`š™Ÿlize
(
Œue
, 
tıh
, 
d©®’
);

152 
_s_®ive
 = 
Œue
;

154 
boŞ
 
fuÎ
 = 
	`Ãxt_i
(
_h—d
è=ğ
_
;

155 
’Œy
 = -1;

156 
boŞ
 
š_£qu’û
 = 
çl£
;

157 
boŞ
 
»³©_·ck‘
 = 
çl£
;

158 
£q
 = 
	`Áohl
(
tıh
->
th_£q
);

161 ià(
	`SEQ_GEQ
(
£q
, 
_s_max
)) {

165 ià(
	`s_ÿche_size
(è>ğ
S_CACHE_HIGHWATER
è 
p
;

166 
_s_max
 = 
£q
 + 
d©®’
;

167 
’Œy
 = 
_h—d
;

168 
_h—d
 = 
	`Ãxt_i
(_head);

169 
š_£qu’û
 = 
Œue
;

172 
i
 = 
_
; i !ğ
_h—d
; i = 
	`Ãxt_i
(i))

173 ià(
_s_ÿche
[
i
].
£q
 == seq) {

177 
_s_ÿche
[
i
].
·ck‘
->
	`kl
();

178 
»³©_·ck‘
 = 
Œue
;

179 
’Œy
 = 
i
;

182 } ià(
	`SEQ_GT
(
_s_ÿche
[
i
].
£q
, seq)) {

184 ià(
fuÎ
è 
p
;

186 
j
 = 
_
; j !ğ
i
; j = 
	`Ãxt_i
(j))

187 
_s_ÿche
[
	`´ev_i
(
j
)] = _s_cache[j];

188 
’Œy
 = 
	`´ev_i
(
i
);

189 
_
 = 
	`´ev_i
(_tail);

195 
	`as£¹
(
’Œy
 >= 0 && 0);

196 
_s_ÿche
[
’Œy
].
·ck‘
 = 
p
->
	`şÚe
();

197 
_s_ÿche
[
’Œy
].
£q
 = seq;

198 
_s_ÿche
[
’Œy
].
num_rxm™
 = 0;

201 ià(
»³©_·ck‘
 || (!
š_£qu’û
 && 
’Œy
 =ğ
_
))

202 
_s_ÿche
[
’Œy
].
£nd”_rxm™
 = 1;

204 
_s_ÿche
[
’Œy
].
£nd”_rxm™
 = 0;

205 
_s_ÿche
[
’Œy
].
¢d_time
.
	`assign_now
();

206 
	`DEBUG_CHATTER
("\t%d‡ˆ%d\n", 
£q
, 
’Œy
);

211  
p
;

212 
	}
}

217 
	gSnoİTCP
::
PCB
::
	$mh_Ãw_ack
(
ack
)

219 
Şd_
 = -1;

220 ià(
_
 !ğ
_h—d
 && 
_s_ÿche
[_].
num_rxm™
)

221 
Şd_
 = 
_
;

223 
	`ş—n
(
ack
);

229 ià(
Şd_
 >ğ0 && 
	`s_ÿche_size
(è> 1 && 
	`Ãxt_i
(Şd_è=ğ
_


230 && 
_s_ÿche
[
_
].
num_rxm™
 == 0)

237 
_mh_ex³ùed_dup_acks
 = 0;

238 
_mh_dup_acks
 = 0;

239 
_mh_Ï¡_ack
 = 
ack
;

240 
	}
}

242 
	#SNOOP_RTX_THRESH
 1

	)

244 
Pack‘
 *

245 
	gSnoİTCP
::
PCB
::
	$mh_dup_ack
(
Pack‘
 *
p
, cÚ¡ 
şick_tı
 *
tıh
, 
ack
)

248 ià(
_h—d
 =ğ
_
)

249  
p
;

252 ià(
_mh_Ï¡_wš
 !ğ
	`Áohs
(
tıh
->
th_wš
))

253  
p
;

256 
SCacheEÁry
 &
ÿche
 = 
_s_ÿche
[
_
];

257 ià(
	`SEQ_LT
(
ack
, 
ÿche
.
£q
))

258  
p
;

261 ià(
ÿche
.
£nd”_rxm™
)

262  
p
;

265 
_mh_dup_acks
++;

267 ià(
_mh_dup_acks
 <ğ
SNOOP_RTX_THRESH
) {

269 
p
->
	`kl
();

272 } ià(
_mh_dup_acks
 =ğ
SNOOP_RTX_THRESH
 + 1) {

275 
_mh_ex³ùed_dup_acks
 = 
	`s_ÿche_size
(è- 
_mh_dup_acks
;

276 ià(!
ÿche
.
num_rxm™
)

278 
p
->
	`kl
();

281 } ià(
_mh_dup_acks
 < 
_mh_ex³ùed_dup_acks
) {

283 
p
->
	`kl
();

290 ià(
ÿche
.
num_rxm™
 < 2) {

292 
p
->
	`kl
();

295  
p
;

297 
	}
}

299 
Pack‘
 *

300 
	gSnoİTCP
::
PCB
::
	$mh_ack
(
Pack‘
 *
p
, cÚ¡ 
şick_tı
 *
tıh
, 
d©®’
)

303 ià(!
_s_exi¡s
)

304  
p
;

306 
ack
 = 
	`Áohl
(
tıh
->
th_ack
);

307 ià(
	`SEQ_GT
(
ack
, 
_mh_Ï¡_ack
))

309 
	`mh_Ãw_ack
(
ack
);

311 ià(
ack
 =ğ
_mh_Ï¡_ack
 && 
d©®’
 == 0)

314 
p
 = 
	`mh_dup_ack
Õ, 
tıh
, 
ack
);

316 ià(
	`SEQ_LT
(
ack
, 
_mh_Ï¡_ack
))

318  
p
;

320 
_mh_Ï¡_wš
 = 
	`Áohs
(
tıh
->
th_wš
);

321  
p
;

322 
	}
}

326 
	gSnoİTCP
::
PCB
::
	$mh_d©a
(
Pack‘
 *, cÚ¡ 
şick_tı
 *
tıh
, 
d©®’
)

330 ià(
d©®’
) {

331 ià(!
_mh_exi¡s
)

332 
	`š™Ÿlize
(
çl£
, 
tıh
, 
d©®’
);

334 
_mh_®ive
 = 
Œue
;

337 
	}
}

341 
	gSnoİTCP
::
PCB
 *

342 
SnoİTCP
::
	$fšd
(
s_
, 
s_pÜt
,

343 
mh_
, 
mh_pÜt
, 
boŞ
 
ü—‹
)

345 
IPFlowID
 
	`q
(
s_
, 
s_pÜt
, 
mh_
, 
mh_pÜt
);

347 ià(
PCB
 **
pcbp
 = 
_m­
.
	`fšdp
(
q
))

348  *
pcbp
;

349 ià(
ü—‹
) {

350 
PCB
 *
pcb
 = 
Ãw
 
	`PCB
();

351 ià(
pcb
è
_m­
.
	`š£¹
(
q
,…cb);

352  
pcb
;

355 
	}
}

357 
Pack‘
 *

358 
	gSnoİTCP
::
	$hªdË_·ck‘
(
pÜt
, 
Pack‘
 *
p
)

360 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

361 ià(
p
->
	`Ëngth
(è< 40 || 
h
->
_p
 !ğ
IPPROTO_TCP
) {

362 
	`DEBUG_CHATTER
("Non TCP");

364  
p
;

367 cÚ¡ 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

368 
h—d”_Ën
 = (
h
->
_hl
 << 2è+ (
tıh
->
th_off
 << 2);

369 
d©®’
 = 
p
->
	`Ëngth
(è- 
h—d”_Ën
;

373 
PCB
 *
pcb
;

374 ià(
pÜt
 == 0)

375 
pcb
 = 
	`fšd
(
h
->
_¤c
.
s_addr
, 
tıh
->
th_¥Üt
,

376 
h
->
_d¡
.
s_addr
, 
tıh
->
th_dpÜt
, 
d©®’
 > 0);

378 
pcb
 = 
	`fšd
(
h
->
_d¡
.
s_addr
, 
tıh
->
th_dpÜt
,

379 
h
->
_¤c
.
s_addr
, 
tıh
->
th_¥Üt
, 
d©®’
 > 0);

380 ià(!
pcb
)

382  
p
;

385 ià(
tıh
->
th_æags
 & 
TH_SYN
) {

386 
	`DEBUG_CHATTER
("SYN…acket");

387 
pcb
->
	`ş—r
(
pÜt
 == 0);

388 
pcb
->
	`š™Ÿlize
(
pÜt
 =ğ0, 
tıh
, 
d©®’
);

389  
p
;

393 ià(
tıh
->
th_æags
 & (
TH_FIN
 | 
TH_RST
)) {

394 
pcb
->
	`ş—r
(
pÜt
 == 0);

395  
p
;

398 ià(
pÜt
 == 0) {

399 ià(
tıh
->
th_æags
 & 
TH_ACK
)

400 
pcb
->
	`s_ack
(
p
, 
tıh
, 
d©®’
);

401 ià(
d©®’
 > 0)

402 
p
 = 
pcb
->
	`s_d©a
Õ, 
tıh
, 
d©®’
);

405 ià(
tıh
->
th_æags
 & 
TH_ACK
)

406 
p
 = 
pcb
->
	`mh_ack
Õ, 
tıh
, 
d©®’
);

407 ià(
d©®’
 > 0)

408 
pcb
->
	`mh_d©a
(
p
, 
tıh
, 
d©®’
);

411  
p
;

412 
	}
}

415 
	gSnoİTCP
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

417 
p
 = 
	`hªdË_·ck‘
(
pÜt
,…);

418 ià(
p
è
	`ouut
(
pÜt
).
	`push
(p);

419 
	}
}

421 
Pack‘
 *

422 
	gSnoİTCP
::
	$puÎ
(
pÜt
)

424 
Pack‘
 *
p
 = 
	`šput
(
pÜt
).
	`puÎ
();

425 ià(
p
)

426 
p
 = 
	`hªdË_·ck‘
(
pÜt
,…);

427  
p
;

428 
	}
}

432 
Pack‘
 *

433 
	gSnoİTCP
::
PCB
::
	$add_d©a
(
Pack‘
 *
p
, 
th_£q
)

435 
boŞ
 
fuÎ
 = 
	`Ãxt_i
(
_h—d
è=ğ
_
;

436 
’Œy
 = -1;

438 ià(
	`SEQ_GT
(
th_£q
, 
_max
)) {

440 ià(
fuÎ
) {

442 
	`DEBUG_CHATTER
("buffer full");

443  
p
;

445 
_max
 = 
th_£q
;

446 
’Œy
 = 
_ex³ùed_ack
 = 
_h—d
;

447 
_h—d
 = 
	`Ãxt_i
(_head);

449 } ià(
	`SEQ_LT
(
th_£q
, 
_ÿche
[
_
].
£q
)) {

450 ià(
	`SEQ_LT
(
th_£q
, 
_uÇ
)) {

452 
	`DEBUG_CHATTER
("\tway out-of-order…kt %d,†astack %d\n",

453 
th_£q
, 
_uÇ
);

454  
p
;

458 ià(
fuÎ
) {

460 
	`DEBUG_CHATTER
("buffer full");

461  
p
;

463 
_
 = 
	`´ev_i
(_tail);

464 
’Œy
 = 
_
;

466 } ià(
_
 =ğ
_h—d
)

468  
p
;

472 
i
 = 
_
; i !ğ
_h—d
; i = 
	`Ãxt_i
(i)) {

473 ià(
_ÿche
[
i
].
£q
 =ğ
th_£q
) {

475 
	`DEBUG_CHATTER
("havpkˆ%d‡ˆ%d", 
th_£q
, 
i
);

476 ià(
_ÿche
[
i
].
·ck‘
->
	`Ëngth
(è<ğ
p
->length()) {

478 
_ÿche
[
i
].
·ck‘
->
	`kl
();

479 
_ÿche
[
i
].
·ck‘
 = 
p
->
	`şÚe
();

481 
_ÿche
[
i
].
num_rxm™
 = 0;

482 
_ÿche
[
i
].
£nd”_rxm™
 = 1;

484  
p
;

486 } ià(
	`SEQ_GT
(
_ÿche
[
i
].
£q
, 
th_£q
)) {

488 ià(
fuÎ
) {

490 
	`DEBUG_CHATTER
("buffer full");

491  
p
;

493 
j
 = 
_
; j !ğ
i
; j = 
	`Ãxt_i
(j))

494 
_ÿche
[
	`´ev_i
(
j
)] = _cache[j];

495 
’Œy
 = 
i
;

496 
_
 = 
	`´ev_i
(_tail);

497 
	`DEBUG_CHATTER
("\tcache„eorg;…kt %d, head %d,ail %d",

498 
th_£q
, 
_h—d
, 
_
);

505 
	`as£¹
(
’Œy
 >= 0);

506 
p
->
	`u£
();

507 
_ÿche
[
’Œy
].
·ck‘
 = 
p
;

508 
_ÿche
[
’Œy
].
£q
 = 
th_£q
;

509 
_ÿche
[
’Œy
].
num_rxm™
 = 0;

510 
_ÿche
[
’Œy
].
£nd”_rxm™
 = 0;

511 
	`DEBUG_CHATTER
("\t%d‡ˆ%d\n", 
th_£q
, 
’Œy
);

513 ià(
	`SEQ_LT
(
th_£q
, 
_max
)) {

515 
	`DEBUG_CHATTER
("\kˆ%x ouˆoàÜd”,†a¡ %x\n", 
th_£q
, 
_max
);

516 ià(
_
 =ğ
’Œy
) {

517 
_ÿche
[
’Œy
].
£nd”_rxm™
 = 1;

518 
_ÿche
[
’Œy
].
num_rxm™
 = 0;

520 
_ex³ùed_ack
 = 
_
;

523  
p
;

524 
	}
}

528 
Pack‘
 *

529 
	gSnoİTCP
::
PCB
::
	$add_ack
(
Pack‘
 *
p
, 
th_ack
, 
d©a_Ën
,

530 
wš
, 
SnoİTCP
 *
¢p
)

533 
	`DEBUG_CHATTER
("ack %d,ƒxpect %d, dacks %d, seen %d dups\tcached %d-%d",

534 
th_ack
, 
_ex³ùed_ack
, 
_ex³ùed_dup_acks
,

535 
_dup_acks
, 
_ÿche
[
_
].
£q
, _ÿche[
	`´ev_i
(
_h—d
)].seq);

537 ià(
	`SEQ_GT
(
th_ack
, 
_uÇ
)) {

539 
	`DEBUG_CHATTER
("Ãw‡ck %d", 
th_ack
);

541 
i
 = 
_
;

542 
i
 !ğ
_h—d
 && 
	`SEQ_LT
(
_ÿche
[i].
£q
, 
th_ack
)) {

543 
_ÿche
[
i
].
·ck‘
->
	`kl
();

544 
i
 = 
	`Ãxt_i
(i);

546 
_
 = 
i
;

547 
_uÇ
 = 
th_ack
;

548 
_dup_acks
 = 0;

549 
_Ï¡_wš
 = 
wš
;

550  
p
;

552 } ià(
	`SEQ_LT
(
th_ack
, 
_uÇ
)) {

554 
	`DEBUG_CHATTER
("¥uriou ack %d", 
th_ack
);

555  
p
;

559 ià(
_Ï¡_wš
 !ğ
wš
 || 
d©a_Ën
 > 0) {

561 
	`DEBUG_CHATTER
("data/window‡d");

562 
_Ï¡_wš
 = 
wš
;

563  
p
;

567 
’Œy
 = -1;

568 
i
 = 
_
; i !ğ
_h—d
; i = 
	`Ãxt_i
(i))

569 ià(
_ÿche
[
i
].
£q
 =ğ
th_ack
) {

570 
’Œy
 = 
i
;

575 ià(
’Œy
 < 0 || 
_ÿche
[’Œy].
£nd”_rxm™
)

576  
p
;

578 ià(
_ex³ùed_dup_acks
 > 0) {

579 --
_ex³ùed_dup_acks
;

580 
	`DEBUG_CHATTER
("expected, discarding");

582 ià(
d©a_Ën
)

583  
p
;

586 } ià(!
_ex³ùed_dup_acks
) {

588 
_ex³ùed_dup_acks
 = 
_h—d
 - 
_ex³ùed_ack
;

589 ià(
_ex³ùed_dup_acks
 < 0)

590 
_ex³ùed_dup_acks
 +ğ
SNOOP_MAX_BUF
;

591 
_ex³ùed_dup_acks
--;

592 
_ex³ùed_ack
 = 
	`Ãxt_i
(
_
);

594 
	`DEBUG_CHATTER
("‡ck %dƒxpect %d more\n",

595 
th_ack
, 
_ex³ùed_dup_acks
);

598 
_dup_acks
++;

599 
_ÿche
[
’Œy
].
num_rxm™
++;

600 
	`şick_ch©‹r
("du°ack %d,„‘¿nsm™tšg", 
_uÇ
);

601 
¢p
->
	`ouut
(2).
	`push
(
_ÿche
[
’Œy
].
·ck‘
);

604 ià(
d©a_Ën
)

605  
p
;

609 
	`DEBUG_CHATTER
("Help! Inconsistent state");

610  
p
;

613 
	}
}

616 
CLICK_ENDDECLS


617 
	$ELEMENT_REQUIRES
(
çl£
)

618 
	`EXPORT_ELEMENT
(
SnoİTCP
)

	@tcpudp/snooptcp.hh

1 #iâdeà
CLICK_SNOOPTCP_HH


2 
	#CLICK_SNOOPTCP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/add»ss.hh
>

5 
	~<şick/æowid.hh
>

6 
	~<şick/hashm­.hh
>

7 
	~<şickÃt/.h
>

8 
	~<şickÃt/tı.h
>

9 
	gCLICK_DECLS


25 
	#DEBUG


	)

27 şas 
	cSnoİTCP
 : 
public
 
EËm’t
 {…ublic:

29 
	$SnoİTCP
(è
CLICK_COLD
;

30 ~
	$SnoİTCP
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "SnoopTCP"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/4"; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "¯/¯hh"; 
	}
}

35 cÚ¡ *
	$æow_code
(ècÚ¡ {  "xyz/xy"; 
	}
}

37 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

39 
	`push
(
pÜt
, 
Pack‘
 *);

40 
Pack‘
 *
	`puÎ
(
pÜt
);

42 
´iv©e
:

44 
Pack‘
 *
	`hªdË_·ck‘
(, Packet *);

46 
	sSCacheEÁry
 {

47 
Pack‘
 *
·ck‘
;

48 
£q
;

49 
size
;

50 
Time¡amp
 
¢d_time
;

51 
num_rxm™
;

52 
£nd”_rxm™
;

54 
	`ş—r
();

55 
	}
};

57 
	gPCB
;

59 
	gHashM­
<
	gIPFlowID
, 
	gPCB
 *> 
	g_m­
;

61 
PCB
 *
fšd
(
s_
, 
s_pÜt
,

62 
mh_
, 
mh_pÜt
, 
boŞ
);

67 
	gSnoİTCP
::
PCB
 {

69 ’um { 
S_CACHE_SIZE
 = 1024,

70 
	gS_CACHE_HIGHWATER
 = (9*
S_CACHE_SIZE
 / 10) };

72 
SCacheEÁry
 
	g_s_ÿche
[
S_CACHE_SIZE
];

73 
	g_h—d
;

74 
	g_
;

76 
	g_s_uÇ
;

77 
	g_s_max
;

78 
	g_mh_Ï¡_ack
;

79 
	g_mh_Ï¡_wš
;

81 
	g_mh_ex³ùed_dup_acks
;

82 
	g_mh_dup_acks
;

83 
	g_dup_acks
;

85 
boŞ
 
	g_s_exi¡s
 : 1;

86 
boŞ
 
	g_s_®ive
 : 1;

87 
boŞ
 
	g_mh_exi¡s
 : 1;

88 
boŞ
 
	g_mh_®ive
 : 1;

90 
Ãxt_i
(
i
ècÚ¡ {  (
	gi
+1è% 
	gS_CACHE_SIZE
; }

91 
´ev_i
(
i
ècÚ¡ {  (
	gi
 ? i-1 : 
S_CACHE_SIZE
-1); }

93 
PCB
(è
	gCLICK_COLD
;

94 ~
PCB
(è
	gCLICK_COLD
;

96 
ş—r
(
boŞ
 
is_s
);

97 
š™Ÿlize
(
boŞ
 
is_s
, cÚ¡ 
şick_tı
 *, 
d©®’
è
	gCLICK_COLD
;

99 
s_ÿche_size
(ècÚ¡ {  (
	g_h—d
 >ğ
_
 ? 
_h—d
 - _ : 
S_CACHE_SIZE
 - (_tail - _head)); }

101 
ş—n
();

103 
Pack‘
 *
s_d©a
(Pack‘ *, cÚ¡ 
şick_tı
 *, 
d©®’
);

104 
s_ack
(
Pack‘
 *, cÚ¡ 
şick_tı
 *, 
d©®’
);

106 
mh_d©a
(
Pack‘
 *, cÚ¡ 
şick_tı
 *, 
d©®’
);

108 
mh_Ãw_ack
(
ack
);

109 
Pack‘
 *
mh_dup_ack
(Pack‘ *, cÚ¡ 
şick_tı
 *, 
ack
);

110 
Pack‘
 *
mh_ack
(Pack‘ *, cÚ¡ 
şick_tı
 *, 
d©®’
);

114 
	gCLICK_ENDDECLS


	@tcpudp/statelesstcpresp.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¡©–es¡ı»¥.hh
"

21 
	~<şick/cÚå¬£.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


26 
	gS‹ËssTCPRe¥Úd”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

31 
Pack‘
 *

32 
	gS‹ËssTCPRe¥Úd”
::
	$hªdË_syn
(
Pack‘
 *
p
, cÚ¡ 
şick_tı
 *
tıh
)

35 
ušt16_t
 
mss
 = 576;

36 cÚ¡ 
ušt8_t
 *
o
 = (cÚ¡ ušt8_ˆ*è(
tıh
 + 1);

37 cÚ¡ 
ušt8_t
 *
’do
 = (cÚ¡ ušt8_ˆ*è
tıh
 + (tıh->
th_off
 << 2);

38 ià(
’do
 > 
p
->
	`’d_d©a
())

39 
’do
 = 
p
->
	`’d_d©a
();

40 
o
 < 
’do
) {

41 ià(*
o
 =ğ
TCPOPT_EOL
)

43 ià(*
o
 =ğ
TCPOPT_NOP
)

45 ià(
o
[1] < 2 || o + o[1] > 
’do
)

47 ià(*
o
 =ğ
TCPOPT_MAXSEG
 && o[1] =ğ
TCPOLEN_MAXSEG
) {

48 
mss
 = (
o
[2] << 8) | o[3];

49 
o
 +ğ
TCPOLEN_MAXSEG
;

51 
o
 += o[1];

55  (
max£g
 << 16è+ (
tıh
->
th_¥Üt
 << 8);

56 
	}
}

58 
Pack‘
 *

59 
	gS‹ËssTCPRe¥Úd”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

61 cÚ¡ 
şick_
 *
h
 = 
p
->
	`_h—d”
();

62 ià(!
p
->
	`has_ÃtwÜk_h—d”
()

63 || 
h
->
_p
 !ğ
IP_PROTO_TCP
 || !
	`IP_FIRSTFRAG
(iph)

64 || 
p
->
	`Œª¥Üt_Ëngth
(è< (
şick_tı
)) {

65 
	`checked_ouut_push
(1, 
p
);

69 cÚ¡ 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

70 
tı_£q_t
 
ackno
;

71 
ušt32_t
 
Áı_hl
;

72 ià(
tıh
->
th_æags
 & 
TH_RST
) {

73 
_»£ts
++;

74 
p
->
	`kl
();

76 } ià((
tıh
->
th_æags
 & (
TH_SYN
 | 
TH_ACK
)) == TH_SYN) {

78 
ackno
 = 
	`hªdË_syn
(
p
, 
tıh
);

79 
Áı_hl
 = (
şick_tı
) + 4;

80 } ià((
tıh
->
th_æags
 & (
TH_SYN
 | 
TH_ACK
)) != TH_ACK) {

81 
ev
:

82 
_ev
++;

83 
p
->
	`kl
();

86 
ackno
 = 
	`Áohl
(
tıh
->
th_ack
);

87 
Áı_hl
 = (
şick_tı
);

91 
tı_£q_t
 
ackno_ba£
 = 
ackno
 - (
tıh
->
th_¥Üt
 << 8);

92 
ušt32_t
 
mss
 = (
ackno_ba£
 >> 16);

93 
ušt32_t
 
pos
 = (
ackno_ba£
 & 0xFFFFU);

94 ià(
mss
 < 20 || 
pos
 > 
_d©a
.
	`Ëngth
() + 2)

95 
ev
;

96 ià(
mss
 > 
	`Áohs
(
tıh
->
th_wš
))

97 
mss
 = 
	`Áohs
(
tıh
->
th_wš
);

98 ià(
tıh
->
th_æags
 & 
TH_SYN
)

99 
mss
 = 0;

100 ià(
pos
 + 
mss
 > 
_d©a
.
	`Ëngth
() + 2)

101 
mss
 = 
_d©a
.
	`Ëngth
(è+ 2 - 
pos
;

103 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((
şick_
è+ 
Áı_hl
 + 
mss
);

104 
q
->
	`£t_ÃtwÜk_h—d”
(q->
	`d©a
(), (
şick_
));

106 
şick_
 *
n
 = 
q
->
	`_h—d”
();

107 
n
->
_v
 = 4;

108 
n
->
_hl
 = (
şick_
) >> 2;

109 
n
->
_tos
 = 0;

110 
n
->
_id
 = 
	`htÚs
(
_id
);

111 
_id
 += 2;

112 
n
->
_off
 = 0;

113 
n
->
_‰l
 = 200;

114 
n
->
_p
 = 
IP_PROTO_TCP
;

115 
n
->
_sum
 = 0;

116 
n
->
_¤c
 = 

->
_d¡
;

117 
n
->
_d¡
 = 

->
_¤c
;

119 
şick_tı
 *
Áı
 = 
q
->
	`tı_h—d”
();

120 
Áı
->
th_¥Üt
 = 
tı
->
th_dpÜt
;

121 
Áı
->
th_dpÜt
 = 
tı
->
th_¥Üt
;

122 
Áı
->
th_£q
 = 
	`Áohl
(
ackno
);

123 
Áı
->
th_ack
 = 
tı
->
th_£q
;

124 
Áı
->
th_æags2
 = 0;

125 
Áı
->
th_off
 = (
Áı_hl
 >> 2);

126 
Áı
->
th_æags
 = (
tıh
->th_æag & 
TH_SYN
 ? TH_SYN | 
TH_ACK
 : TH_ACK);

127 ià(
pos
 < 
_d©a
.
	`Ëngth
(è+ 2 &&…o + 
mss
 == _data.length() + 2)

128 
Áı
->
th_æags
 |ğ
TH_FIN
;

129 
Áı
->
th_wš
 = 0xFFFF;

130 
Áı
->
th_sum
 = 0;

131 
Áı
->
th_u½
 = 0;

133 ià(
tıh
->
th_æags
 & 
TH_SYN
) {

134 
ušt8_t
 *
o
 = (ušt8_ˆ*è(
Áı
 + 1);

135 
o
[0] = 
TCPOPT_MAXSEG
;

136 
o
[1] = 4;

137 
o
[2] = (1460 / 256);

138 
o
[3] = (1460 % 256);

141 ià(
pos
 + 
mss
 =ğ
_d©a
.
	`Ëngth
() + 2)

142 
mss
--;

143 ià(
mss
 > 0)

144 
	`memıy
((
ušt8_t
 *è
Áı
 + 
Áı_hl
, 
_d©a
.
	`d©a
(è+ 
pos
 - 1, 
mss
);

147 
ušt32_t
 
Ën
 = (
şick_
è+ 
Áı_hl
 + 
mss
;

148 
n
->
_Ën
 = 
	`htÚs
(
Ën
);

149 
n
->
_sum
 = 
	`şick_š_cksum
Ò,‚->
_hl
 << 2);

150 
ušt32_t
 
sum1
 = 
	`şick_š_cksum
(
Áı
, 
Áı_hl
 + 
mss
);

151 
Áı
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
sum1
, 
n
, 
Ën
);

153 
p
->
	`kl
();

154  
q
;

155 
	}
}

157 
CLICK_ENDDECLS


158 
	$ELEMENT_REQUIRES
(
çl£
)

159 
	`EXPORT_ELEMENT
(
S‹ËssTCPRe¥Úd”
)

	@tcpudp/statelesstcpresp.hh

1 #iâdeà
CLICK_STATELESSTCPRESP_HH


2 
	#CLICK_STATELESSTCPRESP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/tim”.hh
>

5 
	~<şickÃt/tı.h
>

6 
CLICK_DECLS


8 şas 
	cS‹ËssTCPRe¥Úd”
 : 
public
 
EËm’t
 {…ublic:

10 
	$S‹ËssTCPRe¥Úd”
() { }

11 ~
	$S‹ËssTCPRe¥Úd”
(è{ 
	}
}

13 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "S‹ËssTCPRe¥Úd”"; 
	}
}

15 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

17 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

19 
	g´iv©e
:

21 
SŒšg
 
_d©a
;

25 
	gCLICK_ENDDECLS


	@tcpudp/tcpfragmenter.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şickÃt/.h
>

20 
	~<şickÃt/tı.h
>

21 
	~"tıäagm’‹r.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/glue.hh
>

25 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

26 
CLICK_DECLS


28 
	gTCPF¿gm’‹r
::
	$TCPF¿gm’‹r
()

29 : 
	`_mtu
(0), 
	`_mtu_ªno
(-1)

31 
_äagm’ts
 = 0;

32 
_äagm’‹d_couÁ
 = 0;

33 
_couÁ
 = 0;

34 
	}
}

36 
	gTCPF¿gm’‹r
::~
	$TCPF¿gm’‹r
()

38 
	}
}

41 
TCPF¿gm’‹r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

43 
ušt16_t
 
	gmtu
;

44 
	gmtu_ªno
 = -1;

46 ià(
Args
(
cÚf
, 
this
, 
”rh
)

47 .
»ad
("MTU", 
mtu
)

48 .
»ad
("MTU_ANNO", 
AÂoArg
(2), 
mtu_ªno
)

49 .
com¶‘e
() < 0)

52 ià(
	gmtu
 =ğ0 && 
mtu_ªno
 == -1)

53  
”rh
->
”rÜ
("At†east one of MTU‡nd MTU_ANNO must be set");

55 
	g_mtu
 = 
mtu
;

56 
	g_mtu_ªno
 = 
mtu_ªno
;

61 
	gTCPF¿gm’‹r
::
	$push
(, 
Pack‘
 *
p
)

63 
mtu
 = 
_mtu
;

64 ià(
_mtu_ªno
 >ğ0 && 
p
->
	`ªno_u16
(_mtu_anno) &&

65 (!
mtu
 || mtu > 
p
->
	`ªno_u16
(
_mtu_ªno
)))

66 
mtu
 = 
p
->
	`ªno_u16
(
_mtu_ªno
);

68 
št32_t
 
hËn
;

69 
št32_t
 
tı_Ën
;

71 cÚ¡ 
şick_
 *

 = 
p
->
	`_h—d”
();

72 cÚ¡ 
şick_tı
 *
tı
 = 
p
->
	`tı_h—d”
();

73 
hËn
 = (

->
_hl
<<2è+ (
tı
->
th_off
<<2);

74 
tı_Ën
 = 
	`Áohs
(

->
_Ën
è- 
hËn
;

77 
max_tı_Ën
 = 
mtu
 - 
hËn
;

79 
_couÁ
++;

80 ià(!
mtu
 || 
max_tı_Ën
 <ğ0 || 
tı_Ën
 < max_tcp_len) {

81 
	`ouut
(0).
	`push
(
p
);

85 
_äagm’‹d_couÁ
++;

86 
off£t
 = 0; off£ˆ< 
tı_Ën
; off£ˆ+ğ
max_tı_Ën
) {

87 
Pack‘
 *
p_şÚe
;

88 ià(
off£t
 + 
max_tı_Ën
 < 
tı_Ën
)

89 
p_şÚe
 = 
p
->
	`şÚe
();

91 
p_şÚe
 = 
p
;

92 
p
 = 0;

94 ià(!
p_şÚe
)

96 
Wr™abËPack‘
 *
q
 = 
p_şÚe
->
	`uniqueify
();

97 
p_şÚe
 = 0;

98 
şick_
 *

 = 
q
->
	`_h—d”
();

99 
şick_tı
 *
tı
 = 
q
->
	`tı_h—d”
();

100 
ušt8_t
 *
tı_d©a
 = ((ušt8_ˆ*)
tı
è+ (tı->
th_off
<<2);

101 
this_Ën
 = 
tı_Ën
 - 
off£t
 > 
max_tı_Ën
 ? max_tcp_len :cp_len - offset;

102 ià(
off£t
 != 0)

103 
	`memıy
(
tı_d©a
,ı_d©¨+ 
off£t
, 
this_Ën
);

104 
q
->
	`ke
(
tı_Ën
 - 
this_Ën
);

105 

->
_Ën
 = 
	`htÚs
(
q
->
	`’d_d©a
(è- q->
	`ÃtwÜk_h—d”
());

106 

->
_sum
 = 0;

107 #ià
HAVE_FAST_CHECKSUM


108 

->
_sum
 = 
	`_ç¡_csum
((*), 
q
->
	`ÃtwÜk_h—d”_Ëngth
() >> 2);

110 

->
_sum
 = 
	`şick_š_cksum
((*), 
q
->
	`ÃtwÜk_h—d”_Ëngth
());

113 ià((
tı
->
th_æags
 & 
TH_FIN
è&& 
off£t
 + 
mtu
 < 
tı_Ën
)

114 
tı
->
th_æags
 ^ğ
TH_FIN
;

116 
tı
->
th_£q
 = 
	`htÚl
(
	`Áohl
Ñı->th_£qè+ 
off£t
);

117 
tı
->
th_sum
 = 0;

120 
¶’
 = 
q
->
	`’d_d©a
(è- (
ušt8_t
*)
tı
;

121 
csum
 = 
	`şick_š_cksum
((*)
tı
, 
¶’
);

122 
tı
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
¶’
);

123 
_äagm’ts
++;

124 
	`ouut
(0).
	`push
(
q
);

126 
	}
}

129 
	gTCPF¿gm’‹r
::
	$add_hªdËrs
()

131 
	`add_d©a_hªdËrs
("äagm’ts", 
HªdËr
::
OP_READ
, &
_äagm’ts
);

132 
	`add_d©a_hªdËrs
("äagm’‹d_couÁ", 
HªdËr
::
OP_READ
, &
_äagm’‹d_couÁ
);

133 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
OP_READ
, &
_couÁ
);

134 
	}
}

136 
CLICK_ENDDECLS


137 
	$EXPORT_ELEMENT
(
TCPF¿gm’‹r
)

138 
	`ELEMENT_MT_SAFE
(
TCPF¿gm’‹r
)

	@tcpudp/tcpfragmenter.hh

1 #iâdeà
CLICK_TCPFRAGMENTER_HH


2 
	#CLICK_TCPFRAGMENTER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


34 şas 
	cTCPF¿gm’‹r
 : 
public
 
EËm’t
 {…ublic:

36 
	$TCPF¿gm’‹r
(è
CLICK_COLD
;

37 ~
	$TCPF¿gm’‹r
(è
CLICK_COLD
;

39 cÚ¡ *
	$şass_Çme
() const {  "TCPFragmenter"; }

40 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

41 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

42 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

44 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

46 
	$add_hªdËrs
(è
CLICK_COLD
;

48 
	`push
(, 
Pack‘
 *);

50 
´iv©e
:

51 
ušt16_t
 
_mtu
;

52 
št8_t
 
_mtu_ªno
;

54 
©omic_ušt32_t
 
_äagm’ts
;

55 
©omic_ušt32_t
 
_äagm’‹d_couÁ
;

56 
©omic_ušt32_t
 
_couÁ
;

57 
	}
};

59 
	gCLICK_ENDDECLS


	@tcpudp/tcpipsend.cc

18 
	~<şick/cÚfig.h
>

19 
	~"tı£nd.hh
"

20 
	~<şickÃt/.h
>

21 
	~<şickÃt/tı.h
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/glue.hh
>

25 
	~<şick/rou‹r.hh
>

26 
CLICK_DECLS


28 
	gTCPIPS’d
::
	$TCPIPS’d
()

30 
	}
}

32 
TCPIPS’d
::~
	$TCPIPS’d
()

34 
	}
}

37 
TCPIPS’d
::
	$£nd_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

39 
VeùÜ
<
SŒšg
> 
¬gs
;

40 
TCPIPS’d
* 
me
 = (TCPIPS’d *è
e
;

42 
§ddr
, 
daddr
;

43 
ušt16_t
 
¥Üt
, 
dpÜt
;

44 
b™s
;

45 
£qn
, 
ackn
;

46 
lim™
 = 1;

47 
boŞ
 
¡İ
 = 
çl£
;

48 ià(
	`Args
(
me
, 
”rh
).
	`push_back_wÜds
(
cÚf
)

49 .
	`»ad_mp
("SRC", 
§ddr
)

50 .
	`»ad_mp
("SPORT", 
	`IPPÜtArg
(
IP_PROTO_TCP
), 
¥Üt
)

51 .
	`»ad_mp
("DST", 
daddr
)

52 .
	`»ad_mp
("DPORT", 
	`IPPÜtArg
(
IP_PROTO_TCP
), 
dpÜt
)

53 .
	`»ad_mp
("SEQNO", 
£qn
)

54 .
	`»ad_mp
("ACKNO", 
ackn
)

55 .
	`»ad_mp
("FLAGS", 
b™s
)

56 .
	`»ad_p
("COUNT", 
lim™
)

57 .
	`»ad_p
("STOP", 
¡İ
)

58 .
	`com¶‘e
() < 0)

61 ià(
lim™
 > 0) {

62 
Pack‘
 *
p
 = 
me
->
	`make_·ck‘
(
§ddr
, 
daddr
, 
¥Üt
, 
dpÜt
, 
£qn
, 
ackn
, 
b™s
);

63 
i
 = 0; i < 
lim™
; i++)

64 
me
->
	`ouut
(0).
	`push
(
i
 + 1 < 
lim™
 ? 
p
->
	`şÚe
() :…);

66 ià(
¡İ
)

67 
me
->
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

69 
	}
}

73 
Pack‘
 *

74 
	gTCPIPS’d
::
	$make_·ck‘
(
§ddr
, 
daddr
,

75 
¥Üt
, 
dpÜt
,

76 
£qn
, 
ackn
,

77 
b™s
)

79 
şick_
 *

;

80 
şick_tı
 *
tı
;

81 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
((*

è+ (*
tı
));

82 ià(
q
 == 0) {

83 
	`şick_ch©‹r
("in TCPIPSend: cannot make…acket!");

84 
	`as£¹
(0);

86 
	`mem£t
(
q
->
	`d©a
(), '\0', q->
	`Ëngth
());

87 

 = (
şick_
 *è
q
->
	`d©a
();

88 
tı
 = (
şick_tı
 *è(

 + 1);

89 
q
->
	`£t__h—d”
(

, (
şick_
));

92 

->
_v
 = 4;

93 

->
_hl
 = 5;

94 

->
_tos
 = 0;

95 

->
_Ën
 = 
	`htÚs
(
q
->
	`Ëngth
());

96 

->
_id
 = 
	`htÚs
(0);

97 

->
_off
 = 
	`htÚs
(
IP_DF
);

98 

->
_‰l
 = 255;

99 

->
_p
 = 
IP_PROTO_TCP
;

100 

->
_sum
 = 0;

101 
	`memıy
((*è&(

->
_¤c
), (*è&
§ddr
, (saddr));

102 
	`memıy
((*è&(

->
_d¡
), (*è&
daddr
, (daddr));

103 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

106 
¥Üt
 = 
	`htÚs
(sport);

107 
dpÜt
 = 
	`htÚs
(dport);

108 
	`memıy
((*è&(
tı
->
th_¥Üt
), (*è&
¥Üt
, (sport));

109 
	`memıy
((*è&(
tı
->
th_dpÜt
), (*è&
dpÜt
, (dport));

110 
tı
->
th_£q
 = 
	`htÚl
(
£qn
);

111 
tı
->
th_ack
 = 
	`htÚl
(
ackn
);

112 
tı
->
th_off
 = 5;

113 
tı
->
th_æags
 = 
b™s
;

114 
tı
->
th_wš
 = 
	`htÚs
(32120);

115 
tı
->
th_sum
 = 
	`htÚs
(0);

116 
tı
->
th_u½
 = 
	`htÚs
(0);

119 
csum
 = 
	`şick_š_cksum
((*)
tı
, (
şick_tı
));

120 
tı
->
th_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, (
şick_tı
));

122  
q
;

123 
	}
}

127 
	gTCPIPS’d
::
	$add_hªdËrs
()

129 
	`add_wr™e_hªdËr
("£nd", 
£nd_wr™e_hªdËr
, 0);

130 
	}
}

132 
CLICK_ENDDECLS


133 
EXPORT_ELEMENT
(
TCPIPS’d
)

	@tcpudp/tcpipsend.hh

1 #iâdeà
CLICK_TCPIPSEND_HH


2 
	#CLICK_TCPIPSEND_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şickÃt/tı.h
>

6 
CLICK_DECLS


28 şas 
	cTCPIPS’d
 : 
public
 
EËm’t
 {

29 
public
:

30 
	$TCPIPS’d
(è
CLICK_COLD
;

31 ~
	$TCPIPS’d
(è
CLICK_COLD
;

33 cÚ¡ *
	$şass_Çme
() const {  "TCPIPSend"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

35 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

37 
	g´iv©e
:

38 
	$add_hªdËrs
(è
CLICK_COLD
;

39 
£nd_wr™e_hªdËr


40 (cÚ¡ 
SŒšg
 &
cÚf
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
);

41 
Pack‘
 * 
	`make_·ck‘
(, , ,

43 
	}
};

45 
	gCLICK_ENDDECLS


	@tcpudp/tcprewriter.cc

21 
	~<şick/cÚfig.h
>

22 
	~"tı»wr™”.hh
"

23 
	~<şickÃt/.h
>

24 
	~<şickÃt/tı.h
>

25 
	~<şick/¬gs.hh
>

26 
	~<şick/¡¿ccum.hh
>

27 
	~<şick/”rÜ.hh
>

28 
CLICK_DECLS


33 
	gTCPRewr™”
::
TCPFlow
::
	$upd©e_£qno_d–
(
boŞ
 
dœeùiÚ
,

34 
tı_£q_t
 
Œigg”
, 
št32_t
 
d
)

37 ià(
_dt
 && (_dt->
ÃxŒ
 & (1 << 
dœeùiÚ
))

38 && !
	`SEQ_GEQ
(
Œigg”
, 
_dt
->Œigg”[
dœeùiÚ
]))

43 ià(!
_dt
 || (_dt->
ÃxŒ
 & (1 << 
dœeùiÚ
)

44 ? 
Œigg”
 !ğ
_dt
->Œigg”[
dœeùiÚ
]

45 : 
_dt
->
d–
[
dœeùiÚ
])) {

46 
d–_Œªs™iÚ
 *
ndt
 = 
Ãw
 delta_transition;

47 ià(!
ndt
)

49 
ndt
->
ÃxŒ
 = 
»š‹½»t_ÿ¡
<
ušŒ_t
>(
_dt
);

50 
_dt
 = 
ndt
;

51 
d–_Œªs™iÚ
 *
x
 = 
ndt
->
	`Ãxt
()) {

52 
ndt
->
d–
[!
dœeùiÚ
] = 
x
->delta[!direction];

53 
ndt
->
Œigg”
[!
dœeùiÚ
] = 
x
->trigger[!direction];

54 ià(
x
->
ÃxŒ
 & (1 << !
dœeùiÚ
)) {

55 
ndt
->
ÃxŒ
 |ğ1 << !
dœeùiÚ
;

56 
ndt
 = 
x
;

58 
ndt
->
ÃxŒ
 -ğndt->ÃxŒ & (1 << !
dœeùiÚ
);

65 
_dt
->
Œigg”
[
dœeùiÚ
] =rigger;

66 
d–_Œªs™iÚ
 *
ndt
 = 
_dt
->
	`Ãxt
();

67 
_dt
->
d–
[
dœeùiÚ
] = (
ndt
 ?‚dt->d–[dœeùiÚ] : 0è+ 
d
;

68 
_dt
->
ÃxŒ
 |ğ1 << 
dœeùiÚ
;

71 
ndt
 &&‚dt->
	`has_Œigg”
(
dœeùiÚ
)

72 && !
	`SEQ_GEQ
(
Œigg”
, 
ndt
->Œigg”[
dœeùiÚ
] + (1U << 30)))

73 
ndt
 =‚dt->
	`Ãxt
();

74 ià(
ndt
 &&‚dt->
	`has_Œigg”
(
dœeùiÚ
)) {

75 
ndt
->
ÃxŒ
 -ğ1 << 
dœeùiÚ
;

76 ià(!(
ndt
->
ÃxŒ
 & 3))

77 
d–_Œªs™iÚ
 *
x
 = 
ndt
->
	`Ãxt
()) {

78 
ndt
->
ÃxŒ
 = 
x
->nextptr - (x->nextptr & 3);

79 
d–‘e
 
x
;

84 
	}
}

87 
	gTCPRewr™”
::
TCPFlow
::
	$­¶y_§ck
(
boŞ
 
dœeùiÚ
, 
şick_tı
 *
tıh
, 
Ën
)

89 ià(()(
tıh
->
th_off
 << 2è< 
Ën
)

90 
Ën
 = 
tıh
->
th_off
 << 2;

91 
ušt8_t
 *
begš_İt
 = 
»š‹½»t_ÿ¡
<ušt8_ˆ*>(
tıh
 + 1);

92 
ušt8_t
 *
’d_İt
 = 
»š‹½»t_ÿ¡
<ušt8_ˆ*>(
tıh
è+ 
Ën
;

93 
ušt32_t
 
csum_d–
 = 0;

95 
ušt8_t
 *
İt
 = 
begš_İt
;

96 
İt
 < 
’d_İt
)

97 *
İt
) {

98 
TCPOPT_EOL
:

99 
dÚe
;

100 
TCPOPT_NOP
:

101 
İt
++;

103 
TCPOPT_SACK
:

104 ià(
İt
 + o±[1] > 
’d_İt
 || (opt[1] % 8) != 2) {

105 
dÚe
;

107 
ušt8_t
 *
’d_§ck
 = 
İt
 + opt[1];

110 
ušt16_t
 *
csum_begš
 = 
»š‹½»t_ÿ¡
<ušt16_ˆ*>(
begš_İt
 + ((
İt
 + 2 - begin_opt) & ~1));

111 
ušt16_t
 *
csum
 = 
csum_begš
; 
»š‹½»t_ÿ¡
<
ušt8_t
 *>(csumè< 
’d_§ck
; csum++)

112 
csum_d–
 +ğ~*
csum
 & 0xFFFF;

114 
İt
 +ğ2; o± < 
’d_§ck
; opt += 8) {

115 #ià
HAVE_INDIFFERENT_ALIGNMENT


116 
ušt32_t
 *
uİt
 = 
»š‹½»t_ÿ¡
<ušt32_ˆ*>(
İt
);

117 
uİt
[0] = 
	`htÚl
(
	`Ãw_ack
(
dœeùiÚ
, 
	`Áohl
(uopt[0])));

118 
uİt
[1] = 
	`htÚl
(
	`Ãw_ack
(
dœeùiÚ
, 
	`Áohl
(uopt[1])));

120 
ušt32_t
 
buf
[2];

121 
	`memıy
(&
buf
[0], 
İt
, 8);

122 
buf
[0] = 
	`htÚl
(
	`Ãw_ack
(
dœeùiÚ
, 
	`Áohl
(buf[0])));

123 
buf
[1] = 
	`htÚl
(
	`Ãw_ack
(
dœeùiÚ
, 
	`Áohl
(buf[1])));

124 
	`memıy
(
İt
, &
buf
[0], 8);

129 
ušt16_t
 *
csum
 = 
csum_begš
; 
»š‹½»t_ÿ¡
<
ušt8_t
 *>(csumè< 
’d_§ck
; csum++)

130 
csum_d–
 +ğ*
csum
;

134 ià(
İt
[1] < 2)

135 
dÚe
;

136 
İt
 += opt[1];

140 
dÚe
:

141 ià(
csum_d–
) {

142 
ušt32_t
 
sum
 = (~
tıh
->
th_sum
 & 0xFFFFè+ 
csum_d–
;

143 
sum
 = (sum & 0xFFFF) + (sum >> 16);

144 
tıh
->
th_sum
 = ~(
sum
 + (sum >> 16));

146 
	}
}

149 
	gTCPRewr™”
::
TCPFlow
::
	$­¶y
(
Wr™abËPack‘
 *
p
, 
boŞ
 
dœeùiÚ
, 
ªnos
)

151 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

152 
şick_
 *
h
 = 
p
->
	`_h—d”
();

155 cÚ¡ 
IPFlowID
 &
»væow
 = 
_e
[!
dœeùiÚ
].
	`æowid
();

156 
h
->
_¤c
 = 
»væow
.
	`daddr
();

157 
h
->
_d¡
 = 
»væow
.
	`§ddr
();

158 ià(
ªnos
 & 1)

159 
p
->
	`£t_d¡__ªno
(
»væow
.
	`§ddr
());

160 ià(
dœeùiÚ
 && (
ªnos
 & 2))

161 
p
->
	`£t_ªno_u8
(
ªnos
 >> 2, 
_»¶y_ªno
);

162 
	`upd©e_csum
(&
h
->
_sum
, 
dœeùiÚ
, 
__csum_d–
);

165 ià(!
	`IP_FIRSTFRAG
(
h
è|| 
p
->
	`Œª¥Üt_Ëngth
() < 18)

169 
şick_tı
 *
tıh
 = 
p
->
	`tı_h—d”
();

170 
tıh
->
th_¥Üt
 = 
»væow
.
	`dpÜt
();

171 
tıh
->
th_dpÜt
 = 
»væow
.
	`¥Üt
();

172 
	`upd©e_csum
(&
tıh
->
th_sum
, 
dœeùiÚ
, 
_udp_csum_d–
);

175 
boŞ
 
have_·ylßd
 = ((
h
->
_hl
 + 
tıh
->
th_off
è<< 2è< 
	`Áohs
(h->
_Ën
);

176 ià(
tıh
->
th_æags
 & 
TH_RST
)

177 
_tæags
 |ğ
s_bÙh_dÚe
;

178 ià(
tıh
->
th_æags
 & 
TH_FIN
)

179 
_tæags
 |ğ
s_fÜw¬d_dÚe
 << 
dœeùiÚ
;

180 ià((
tıh
->
th_æags
 & 
TH_SYN
è|| 
have_·ylßd
)

181 
_tæags
 &ğ~(
s_fÜw¬d_dÚe
 << 
dœeùiÚ
);

182 ià(
have_·ylßd
)

183 
_tæags
 |ğ
s_fÜw¬d_d©a
 << 
dœeùiÚ
;

186 ià(
p
->
	`Œª¥Üt_Ëngth
(è< (
tıh
->
th_off
 << 2))

190 ià(!
_dt
)

194 ià(
_dt
->
	`has_Œigg”
(
dœeùiÚ
)

195 && 
	`SEQ_GEQ
(
	`Áohl
(
tıh
->
th_£q
), 
_dt
->
Œigg”
[
dœeùiÚ
] + (1U << 30))) {

196 
_dt
->
ÃxŒ
 -ğ1 << 
dœeùiÚ
;

197 ià(!(
_dt
->
ÃxŒ
 & 3))

198 
d–_Œªs™iÚ
 *
ndt
 = 
_dt
->
	`Ãxt
()) {

199 
_dt
->
ÃxŒ
 = 
ndt
->nextptr - (ndt->nextptr & 3);

200 
d–‘e
 
ndt
;

204 ià(
_dt
->
d–
[
dœeùiÚ
] || _dt->
	`has_Œigg”
(direction)) {

205 
ušt32_t
 
Ãwv®
 = 
	`htÚl
(
	`Ãw_£q
(
dœeùiÚ
, 
	`Áohl
(
tıh
->
th_£q
)));

206 
	`şick_upd©e_š_cksum
(&
tıh
->
th_sum
,ıh->
th_£q
 >> 16, 
Ãwv®
 >> 16);

207 
	`şick_upd©e_š_cksum
(&
tıh
->
th_sum
,ıh->
th_£q
, 
Ãwv®
);

208 
tıh
->
th_£q
 = 
Ãwv®
;

211 ià(
_dt
->
d–
[!
dœeùiÚ
] || _dt->
	`has_Œigg”
(!direction)) {

212 
ušt32_t
 
Ãwv®
 = 
	`htÚl
(
	`Ãw_ack
(
dœeùiÚ
, 
	`Áohl
(
tıh
->
th_ack
)));

213 
	`şick_upd©e_š_cksum
(&
tıh
->
th_sum
,ıh->
th_ack
 >> 16, 
Ãwv®
 >> 16);

214 
	`şick_upd©e_š_cksum
(&
tıh
->
th_sum
,ıh->
th_ack
, 
Ãwv®
);

215 
tıh
->
th_ack
 = 
Ãwv®
;

218 ià(
tıh
->
th_off
 > 8

219 || (
tıh
->
th_off
 == 8

220 && *(
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(
tıh
 + 1)è!ğ
	`htÚl
(0x0101080A)))

221 
	`­¶y_§ck
(
dœeùiÚ
, 
tıh
, 
p
->
	`Œª¥Üt_Ëngth
());

223 
	}
}

226 
	gTCPRewr™”
::
TCPFlow
::
	$uÅ¬£
(
SŒšgAccum
 &
§
, 
boŞ
 
dœeùiÚ
, 
şick_jiff›s_t
 
now
) const

228 
§
 << 
_e
[
dœeùiÚ
].
	`æowid
(è<< " => " << _e[dœeùiÚ].
	`»wr™‹n_æowid
();

229 ià(
_dt
 && _dt->
d–
[
dœeùiÚ
] != 0)

230 
§
 << " seq " << (
_dt
->
d–
[
dœeùiÚ
] > 0 ? "+" : "") << _dt->delta[direction];

231 
	`uÅ¬£_pÜts
(
§
, 
dœeùiÚ
, 
now
);

232 
	}
}

237 
	gTCPRewr™”
::
	$TCPRewr™”
()

239 
	}
}

241 
TCPRewr™”
::~
	$TCPRewr™”
()

243 
	}
}

246 
TCPRewr™”
::
	$ÿ¡
(cÚ¡ *
n
)

248 ià(
	`¡rcmp
(
n
, "IPRewriterBase") == 0)

249  (
IPRewr™”Ba£
 *)
this
;

250 ià(
	`¡rcmp
(
n
, "TCPRewriter") == 0)

251  (
TCPRewr™”
 *)
this
;

254 
	}
}

257 
	gTCPRewr™”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

260 
	g_timeouts
[0] = 300;

261 
	g_tı_d©a_timeout
 = 86400;

262 
	g_tı_dÚe_timeout
 = 240;

263 
boŞ
 
	gd¡_ªno
 = 
Œue
, 
	ghas_»¶y_ªno
 = 
çl£
;

264 
	g»¶y_ªno
;

266 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

267 .
»ad
("TCP_NODATA_TIMEOUT", 
SecÚdsArg
(), 
_timeouts
[0])

268 .
»ad
("TCP_GUARANTEE", 
SecÚdsArg
(), 
_timeouts
[1])

269 .
»ad
("TIMEOUT", 
SecÚdsArg
(), 
_tı_d©a_timeout
)

270 .
»ad
("TCP_TIMEOUT", 
SecÚdsArg
(), 
_tı_d©a_timeout
)

271 .
»ad
("TCP_DONE_TIMEOUT", 
SecÚdsArg
(), 
_tı_dÚe_timeout
)

272 .
»ad
("DST_ANNO", 
d¡_ªno
)

273 .
»ad
("REPLY_ANNO", 
AÂoArg
(1), 
»¶y_ªno
).
»ad_¡©us
(
has_»¶y_ªno
)

274 .
cÚsume
() < 0)

277 
	g_ªnos
 = (
d¡_ªno
 ? 1 : 0è+ (
has_»¶y_ªno
 ? 2 + (
»¶y_ªno
 << 2) : 0);

278 
	g_tı_d©a_timeout
 *ğ
CLICK_HZ
;

279 
	g_tı_dÚe_timeout
 *ğ
CLICK_HZ
;

281  
	gIPRewr™”Ba£
::
cÚfigu»
(
cÚf
, 
”rh
);

284 
IPRewr™”EÁry
 *

285 
	gTCPRewr™”
::
	$add_æow
(, cÚ¡ 
IPFlowID
 &
æowid
,

286 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
, 
šput
)

288 *
d©a
;

289 ià(!(
d©a
 = 
_®loÿtÜ
.
	`®loÿ‹
()))

292 
TCPFlow
 *
æow
 = 
	`Ãw
(
d©a
) TCPFlow

293 (&
_šput_¥ecs
[
šput
], 
æowid
, 
»wr™‹n_æowid
,

294 !!
_timeouts
[1], 
	`şick_jiff›s
(è+ 
	`»Ëvªt_timeout
(_timeouts));

296  
	`¡Üe_æow
(
æow
, 
šput
, 
_m­
);

297 
	}
}

300 
	gTCPRewr™”
::
	$push
(
pÜt
, 
Pack‘
 *
p_š
)

302 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

303 
şick_
 *
h
 = 
p
->
	`_h—d”
();

306 ià(
h
->
_p
 !ğ
IP_PROTO_TCP


307 || !
	`IP_FIRSTFRAG
(
h
)

308 || 
p
->
	`Œª¥Üt_Ëngth
() < 8) {

309 cÚ¡ 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
[
pÜt
];

310 ià(
is
.
kšd
 =ğ
IPRewr™”IÅut
::
i_nochªge
)

311 
	`ouut
(
is
.
fouut
).
	`push
(
p
);

313 
p
->
	`kl
();

317 
IPFlowID
 
	`æowid
(
p
);

318 
IPRewr™”EÁry
 *
m
 = 
_m­
.
	`g‘
(
æowid
);

320 ià(!
m
) {

321 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
.
	`unchecked_©
(
pÜt
);

322 
IPFlowID
 
»wr™‹n_æowid
 = IPFlowID::
	`unš™Ÿlized_t
();

323 
»suÉ
 = 
is
.
	`»wr™e_æowid
(
æowid
, 
»wr™‹n_æowid
, 
p
);

324 ià(
»suÉ
 =ğ
rw_addm­
)

325 
m
 = 
TCPRewr™”
::
	`add_æow
(
IP_PROTO_TCP
, 
æowid
, 
»wr™‹n_æowid
, 
pÜt
);

326 ià(!
m
) {

327 
	`checked_ouut_push
(
»suÉ
, 
p
);

329 } ià(
_ªnos
 & 2)

330 
m
->
	`æow
()->
	`£t_»¶y_ªno
(
p
->
	`ªno_u8
(
_ªnos
 >> 2));

333 
TCPFlow
 *
mf
 = 
¡©ic_ÿ¡
<TCPFlow *>(
m
->
	`æow
());

334 
mf
->
	`­¶y
(
p
, 
m
->
	`dœeùiÚ
(), 
_ªnos
);

336 
şick_jiff›s_t
 
now_j
 = 
	`şick_jiff›s
();

337 ià(
_timeouts
[1])

338 
mf
->
	`chªge_expœy
(
_h—p
, 
Œue
, 
now_j
 + 
_timeouts
[1]);

340 
mf
->
	`chªge_expœy
(
_h—p
, 
çl£
, 
now_j
 + 
	`tı_æow_timeout
(mf));

342 
	`ouut
(
m
->ouut()).
	`push
(
p
);

343 
	}
}

346 
SŒšg


347 
	gTCPRewr™”
::
	$tı_m­pšgs_hªdËr
(
EËm’t
 *
e
, *)

349 
TCPRewr™”
 *
rw
 = (TCPRewr™” *)
e
;

350 
şick_jiff›s_t
 
now
 = 
	`şick_jiff›s
();

351 
SŒšgAccum
 
§
;

352 
M­
::
™”©Ü
 
™”
 = 
rw
->
_m­
.
	`begš
(); i‹r.
	`live
(); ++iter) {

353 
TCPFlow
 *
f
 = 
¡©ic_ÿ¡
<TCPFlow *>(
™”
->
	`æow
());

354 
f
->
	`uÅ¬£
(
§
, 
™”
->
	`dœeùiÚ
(), 
now
);

355 
§
 << '\n';

357  
§
.
	`ke_¡ršg
();

358 
	}
}

361 
	gTCPRewr™”
::
	$tı_lookup_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, cÚ¡ 
HªdËr
 *, 
E¼ÜHªdËr
 *
”rh
)

363 
TCPRewr™”
 *
rw
 = (TCPRewr™” *)
e
;

364 
IPAdd»ss
 
§ddr
, 
daddr
;

365 
¥Üt
, 
dpÜt
;

367 ià(
	`Args
(
rw
, 
”rh
).
	`push_back_wÜds
(
¡r
)

368 .
	`»ad_mp
("SADDR", 
§ddr
)

369 .
	`»ad_mp
("SPORT", 
	`IPPÜtArg
(
IP_PROTO_TCP
), 
¥Üt
)

370 .
	`»ad_mp
("DADDR", 
daddr
)

371 .
	`»ad_mp
("DPORT", 
	`IPPÜtArg
(
IP_PROTO_TCP
), 
dpÜt
)

372 .
	`com¶‘e
() < 0)

375 
HashCÚš”
<
IPRewr™”EÁry
> *
m­
 = 
rw
->
	`g‘_m­
(
IPRewr™”IÅut
::
m­id_deçuÉ
);

376 ià(!
m­
)

377  
”rh
->
	`”rÜ
("no map!");

379 
SŒšgAccum
 
§
;

380 
IPFlowID
 
	`æow
(
§ddr
, 
	`htÚs
(
¥Üt
), 
daddr
, htÚs(
dpÜt
));

381 ià(
M­
::
™”©Ü
 
™”
 = 
m­
->
	`fšd
(
æow
)) {

382 
TCPFlow
 *
f
 = 
¡©ic_ÿ¡
<TCPFlow *>(
™”
->
	`æow
());

383 cÚ¡ 
IPFlowID
 &
æowid
 = 
f
->
	`’Œy
(
™”
->
	`dœeùiÚ
()).
	`»wr™‹n_æowid
();

385 
§
 << 
æowid
.
	`§ddr
(è<< " " << 
	`Áohs
(æowid.
	`¥Üt
()) << " "

386 << 
æowid
.
	`daddr
(è<< " " << 
	`Áohs
(æowid.
	`dpÜt
());

389 
¡r
 = 
§
.
	`ke_¡ršg
();

391 
	}
}

394 
	gTCPRewr™”
::
	$add_hªdËrs
()

396 
	`add_»ad_hªdËr
("bË", 
tı_m­pšgs_hªdËr
, 0);

397 
	`add_»ad_hªdËr
("m­pšgs", 
tı_m­pšgs_hªdËr
, 0, 
HªdËr
::
h_d•»ÿ‹d
);

398 
	`£t_hªdËr
("lookup", 
HªdËr
::
OP_READ
 | HªdËr::
READ_PARAM
, 
tı_lookup_hªdËr
, 0);

399 
	`add_»wr™”_hªdËrs
(
Œue
);

400 
	}
}

402 
CLICK_ENDDECLS


403 
	$ELEMENT_REQUIRES
(
IPRewr™”Ba£
)

404 
	`EXPORT_ELEMENT
(
TCPRewr™”
)

	@tcpudp/tcprewriter.hh

1 #iâdeà
CLICK_TCPREWRITER_HH


2 
	#CLICK_TCPREWRITER_HH


	)

3 
	~"–em’ts//»wr™”ba£.hh
"

4 
	~"–em’ts//rwm­pšg.hh
"

5 
	~<şickÃt/tı.h
>

6 
CLICK_DECLS


95 şas 
	cTCPRewr™”
 : 
public
 
IPRewr™”Ba£
 {…ublic:

97 şas 
	cTCPFlow
 : 
public
 
IPRewr™”Flow
 {…ublic:

99 
TCPFlow
(
IPRewr™”IÅut
 *
owÃr
, cÚ¡ 
IPFlowID
 &
æowid
,

100 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
,

101 
boŞ
 
gu¬ª‹ed
, 
şick_jiff›s_t
 
expœy_j
)

102 : 
IPRewr™”Flow
(
owÃr
, 
æowid
, 
»wr™‹n_æowid
,

103 
IP_PROTO_TCP
, 
gu¬ª‹ed
, 
expœy_j
), 
_dt
(0) {

106 ~
TCPFlow
() {

107 
d–_Œªs™iÚ
 *
	mx
 = 
_dt
) {

108 
_dt
 = 
x
->
Ãxt
();

109 
d–‘e
 
	mx
;

114 
	ms_fÜw¬d_dÚe
 = 1, 
	ms_»¶y_dÚe
 = 2,

115 
	ms_bÙh_dÚe
 = (
s_fÜw¬d_dÚe
 | 
s_»¶y_dÚe
),

116 
	ms_fÜw¬d_d©a
 = 4, 
	ms_»¶y_d©a
 = 8,

117 
	ms_bÙh_d©a
 = (
s_fÜw¬d_d©a
 | 
s_»¶y_d©a
)

119 
boŞ
 
bÙh_dÚe
() const {

120  (
	m_tæags
 & 
	ms_bÙh_dÚe
è=ğ
s_bÙh_dÚe
;

122 
boŞ
 
bÙh_d©a
() const {

123  (
	m_tæags
 & 
	ms_bÙh_d©a
è=ğ
s_bÙh_d©a
;

126 
upd©e_£qno_d–
(
boŞ
 
dœeùiÚ
, 
tı_£q_t
 
Şd_£qno
, 
št32_t
 
d–
);

127 
tı_£q_t
 
Ãw_£q
(
boŞ
 
dœeùiÚ
,ı_£q_ˆ
£qno
) const;

128 
tı_£q_t
 
Ãw_ack
(
boŞ
 
dœeùiÚ
,ı_£q_ˆ
£qno
) const;

130 
­¶y
(
Wr™abËPack‘
 *
p
, 
boŞ
 
dœeùiÚ
, 
ªnos
);

132 
uÅ¬£
(
SŒšgAccum
 &
§
, 
boŞ
 
dœeùiÚ
, 
şick_jiff›s_t
 
now
) const;

134 
	m´iv©e
:

136 
	sd–_Œªs™iÚ
 {

137 
št32_t
 
d–
[2];

138 
tı_£q_t
 
	mŒigg”
[2];

139 
ušŒ_t
 
	mÃxŒ
;

140 
d–_Œªs™iÚ
() {

141 
mem£t
(
this
, 0, (
d–_Œªs™iÚ
));

143 
d–_Œªs™iÚ
 *
Ãxt
() const {

144  
	m»š‹½»t_ÿ¡
<
	md–_Œªs™iÚ
 *>(
	mÃxŒ
 - (nextptr & 3));

146 
boŞ
 
has_Œigg”
(boŞ 
dœeùiÚ
) const {

147  
	mÃxŒ
 & (1 << 
	mdœeùiÚ
);

151 
d–_Œªs™iÚ
 *
	m_dt
;

153 
­¶y_§ck
(
boŞ
 
dœeùiÚ
, 
şick_tı
 *
tı
, 
Œª¥Üt_Ën
);

157 
	$TCPRewr™”
(è
CLICK_COLD
;

158 ~
	$TCPRewr™”
(è
CLICK_COLD
;

160 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "TCPRewr™”"; 
	}
}

161 *
ÿ¡
(const *);

163 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

165 
IPRewr™”EÁry
 *
add_æow
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
,

166 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
, 
šput
);

167 
de¡roy_æow
(
IPRewr™”Flow
 *
æow
);

168 
şick_jiff›s_t
 
	$be¡_effÜt_expœy
(cÚ¡ 
IPRewr™”Flow
 *
æow
) {

169  
æow
->
	`expœy
(è+ 
	`tı_æow_timeout
(
¡©ic_ÿ¡
<cÚ¡ 
TCPFlow
 *>(æow)è- 
_timeouts
[1];

170 
	}
}

172 
push
(, 
Pack‘
 *);

174 
	$add_hªdËrs
(è
CLICK_COLD
;

176 
´Ùeùed
:

178 
SizedHashAÎoÿtÜ
<(
TCPFlow
)> 
_®loÿtÜ
;

179 
_ªnos
;

180 
ušt32_t
 
_tı_d©a_timeout
;

181 
ušt32_t
 
_tı_dÚe_timeout
;

183 
	$tı_æow_timeout
(cÚ¡ 
TCPFlow
 *
mf
) const {

184 ià(
mf
->
	`bÙh_dÚe
())

185  
_tı_dÚe_timeout
;

186 ià(
mf
->
	`bÙh_d©a
())

187  
_tı_d©a_timeout
;

189  
_timeouts
[0];

190 
	}
}

192 
SŒšg
 
tı_m­pšgs_hªdËr
(
EËm’t
 *, *);

193 
tı_lookup_hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, cÚ¡ 
HªdËr
 *
h
, 
E¼ÜHªdËr
 *
”rh
);

197 
šlše
 

198 
	gTCPRewr™”
::
	$de¡roy_æow
(
IPRewr™”Flow
 *
æow
)

200 
	`unm­_æow
(
æow
, 
_m­
);

201 
¡©ic_ÿ¡
<
TCPFlow
 *>(
æow
)->~
	`TCPFlow
();

202 
_®loÿtÜ
.
	`d—Îoÿ‹
(
æow
);

203 
	}
}

205 
šlše
 
tı_£q_t


206 
	gTCPRewr™”
::
TCPFlow
::
	$Ãw_£q
(
boŞ
 
dœeùiÚ
, 
tı_£q_t
 
£qno
) const

208 
d–_Œªs™iÚ
 *
dt
 = 
_dt
;

209 
dt
 && dt->
	`has_Œigg”
(
dœeùiÚ
)

210 && !
	`SEQ_GEQ
(
£qno
, 
dt
->
Œigg”
[
dœeùiÚ
]))

211 
dt
 = dt->
	`Ãxt
();

212  
dt
 ? 
£qno
 + dt->
d–
[
dœeùiÚ
] : seqno;

213 
	}
}

215 
šlše
 
tı_£q_t


216 
	gTCPRewr™”
::
TCPFlow
::
	$Ãw_ack
(
boŞ
 
dœeùiÚ
, 
tı_£q_t
 
ackno
) const

218 
d–_Œªs™iÚ
 *
dt
 = 
_dt
;

219 
dt
 && dt->
	`has_Œigg”
(!
dœeùiÚ
)

220 && !
	`SEQ_GEQ
(
ackno
 - 
dt
->
d–
[!
dœeùiÚ
], dt->
Œigg”
[!direction]))

221 
dt
 = dt->
	`Ãxt
();

222  
dt
 ? 
ackno
 - dt->
d–
[!
dœeùiÚ
] :‡ckno;

223 
	}
}

225 
	gCLICK_ENDDECLS


	@tcpudp/udpip6encap.cc

24 
	~<şick/cÚfig.h
>

25 
	~<şickÃt/6.h
>

26 
	~"udp6’ÿp.hh
"

27 
	~<şick/¬gs.hh
>

28 
	~<şick/”rÜ.hh
>

29 
	~<şick/glue.hh
>

30 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

31 
	~<şick/6add»ss.hh
>

32 
CLICK_DECLS


34 
	gUDPIP6Enÿp
::
	$UDPIP6Enÿp
()

35 : 
	$_u£_d¡_ªno
(
çl£
)

37 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


38 
_checked_®igÃd
 = 
çl£
;

40 
	}
}

42 
	gUDPIP6Enÿp
::~
	$UDPIP6Enÿp
()

44 
	}
}

47 
UDPIP6Enÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

49 
IP6Add»ss
 
	g§ddr
;

50 
ušt16_t
 
	g¥Üt
, 
	gdpÜt
;

51 
SŒšg
 
	gdaddr_¡r
;

53 ià(
Args
(
cÚf
, 
this
, 
”rh
)

54 .
»ad_mp
("SRC", 
§ddr
)

55 .
»ad_mp
("SPORT", 
IPPÜtArg
(
IP_PROTO_UDP
), 
¥Üt
)

56 .
»ad_mp
("DST", 
AnyArg
(), 
daddr_¡r
)

57 .
»ad_mp
("DPORT", 
IPPÜtArg
(
IP_PROTO_UDP
), 
dpÜt
)

58 .
com¶‘e
() < 0)

61 ià(
	gdaddr_¡r
.
equ®s
("DST_ANNO", 8)) {

62 
	g_daddr
 = 
IP6Add»ss
();

63 
	g_u£_d¡_ªno
 = 
Œue
;

64 } ià(
ı_6_add»ss
(
daddr_¡r
, &
_daddr
, 
this
))

65 
	g_u£_d¡_ªno
 = 
çl£
;

67  
	g”rh
->
”rÜ
("bad DST");

69 
	g_§ddr
 = 
§ddr
;

70 
	g_¥Üt
 = 
htÚs
(
¥Üt
);

71 
	g_dpÜt
 = 
htÚs
(
dpÜt
);

73 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


74 ià(!
	g_checked_®igÃd
) {

75 
	gªs
, 
	gc
, 
	go
;

76 
	gªs
 = 
Alignm’tInfo
::
qu”y
(
this
, 0, 
c
, 
o
);

77 
	g_®igÃd
 = (
ªs
 && 
c
 =ğ4 && 
o
 == 0);

78 ià(!
	g_®igÃd
)

79 
	g”rh
->
w¬nšg
("IP header unaligned, cannot use fast IP checksum");

80 ià(!
	gªs
)

81 
	g”rh
->
mes§ge
("(Try…assinghe configurationhrough %<click-align%>.)");

82 
	g_checked_®igÃd
 = 
Œue
;

89 
Pack‘
 *

90 
	gUDPIP6Enÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

92 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`push
((
şick_udp
è+ (
şick_6
));

93 
şick_6
 *
6
 = 
»š‹½»t_ÿ¡
<şick_6 *>(
p
->
	`d©a
());

94 
şick_udp
 *
udp
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(
6
 + 1);

96 #ià!
HAVE_INDIFFERENT_ALIGNMENT


97 
	`as£¹
((
ušŒ_t
è
6
 % 4 == 0);

101 
6
->
6_æow
 = 0;

102 
6
->
6_v
 = 6;

103 
ušt16_t
 
¶’
 = 
	`htÚs
(
p
->
	`Ëngth
(è- (
şick_6
));

104 
6
->
6_¶’
 = 
¶’
;

105 
6
->
6_nxt
 = 
IP_PROTO_UDP
;

106 
6
->
6_hlim
 = 0xff;

107 
6
->
6_¤c
 = 
_§ddr
;

108 ià(
_u£_d¡_ªno
)

109 
6
->
6_d¡
 = 
	`DST_IP6_ANNO
(
p
);

111 
6
->
6_d¡
 = 
_daddr
;

112 
	`SET_DST_IP6_ANNO
(
p
,
_daddr
);

114 
p
->
	`£t_6_h—d”
(
6
, (
şick_6
));

117 
udp
->
uh_¥Üt
 = 
_¥Üt
;

118 
udp
->
uh_dpÜt
 = 
_dpÜt
;

119 
udp
->
uh_uËn
 = 
¶’
;

120 
udp
->
uh_sum
 = 0;

122 
udp
->
uh_sum
 = 
	`htÚs
(
	`š6_ç¡_cksum
(&
6
->
6_¤c
, &6->
6_d¡
, udp->
uh_uËn
, ip6->
6_nxt
, udp->uh_sum, (*)(udp), udp->uh_ulen));

124  
p
;

125 
	}
}

127 
SŒšg
 
	gUDPIP6Enÿp
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

129 
UDPIP6Enÿp
 *
u
 = 
¡©ic_ÿ¡
<UDPIP6Enÿ°*>(
e
);

130 (
ušŒ_t
è
thunk
) {

132  
	`IP6Add»ss
(
u
->
_§ddr
).
	`uÅ¬£
();

134  
	`SŒšg
(
	`Áohs
(
u
->
_¥Üt
));

136  
	`IP6Add»ss
(
u
->
_daddr
).
	`uÅ¬£
();

138  
	`SŒšg
(
	`Áohs
(
u
->
_dpÜt
));

140  
	`SŒšg
();

142 
	}
}

144 
	gUDPIP6Enÿp
::
	$add_hªdËrs
()

146 
	`add_»ad_hªdËr
("¤c", 
»ad_hªdËr
, 0);

147 
	`add_wr™e_hªdËr
("¤c", 
»cÚfigu»_keywÜd_hªdËr
, "0 SRC");

148 
	`add_»ad_hªdËr
("¥Üt", 
»ad_hªdËr
, 1);

149 
	`add_wr™e_hªdËr
("¥Üt", 
»cÚfigu»_keywÜd_hªdËr
, "1 SPORT");

150 
	`add_»ad_hªdËr
("d¡", 
»ad_hªdËr
, 2);

151 
	`add_wr™e_hªdËr
("d¡", 
»cÚfigu»_keywÜd_hªdËr
, "2 DST");

152 
	`add_»ad_hªdËr
("dpÜt", 
»ad_hªdËr
, 3);

153 
	`add_wr™e_hªdËr
("dpÜt", 
»cÚfigu»_keywÜd_hªdËr
, "3 DPORT");

154 
	}
}

156 
CLICK_ENDDECLS


157 
	$ELEMENT_REQUIRES
(
6
)

158 
	$EXPORT_ELEMENT
(
UDPIP6Enÿp
)

159 
	`ELEMENT_MT_SAFE
(
UDPIP6Enÿp
)

	@tcpudp/udpip6encap.hh

1 #iâdeà
CLICK_UDPIP6ENCAP_HH


2 
	#CLICK_UDPIP6ENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/©omic.hh
>

6 
	~<şickÃt/udp.h
>

7 
	~<şickÃt/6.h
>

8 
	~<şick/6add»ss.hh
>

9 
CLICK_DECLS


56 şas 
	cUDPIP6Enÿp
 : 
public
 
EËm’t
 {…ublic:

58 
UDPIP6Enÿp
();

59 ~
UDPIP6Enÿp
();

61 cÚ¡ *
	$şass_Çme
() const {  "UDPIP6Encap"; }

62 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

63 cÚ¡ *
	$æags
(ècÚ¡ {  "A"; 
	}
}

65 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

66 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

67 
	$add_hªdËrs
(è
CLICK_COLD
;

69 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

71 
´iv©e
:

73 
š6_addr
 
_§ddr
;

74 
š6_addr
 
_daddr
;

75 
ušt16_t
 
_¥Üt
;

76 
ušt16_t
 
_dpÜt
;

77 
boŞ
 
_u£_d¡_ªno
;

78 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


79 
boŞ
 
_®igÃd
;

80 
boŞ
 
_checked_®igÃd
;

83 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

86 
	}
};

88 
	gCLICK_ENDDECLS


	@tcpudp/udpipencap.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şickÃt/.h
>

21 
	~"udp’ÿp.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/glue.hh
>

25 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

26 
CLICK_DECLS


28 
	gUDPIPEnÿp
::
	$UDPIPEnÿp
()

29 : 
	`_cksum
(
Œue
), 
	$_u£_d¡_ªno
(
çl£
)

31 
_id
 = 0;

32 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


33 
_checked_®igÃd
 = 
çl£
;

35 
	}
}

37 
	gUDPIPEnÿp
::~
	$UDPIPEnÿp
()

39 
	}
}

42 
UDPIPEnÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

44 
IPAdd»ss
 
	g§ddr
;

45 
ušt16_t
 
	g¥Üt
, 
	gdpÜt
;

46 
SŒšg
 
	gdaddr_¡r
;

47 
boŞ
 
	gcksum
;

49 ià(
Args
(
cÚf
, 
this
, 
”rh
)

50 .
»ad_mp
("SRC", 
§ddr
)

51 .
»ad_mp
("SPORT", 
IPPÜtArg
(
IP_PROTO_UDP
), 
¥Üt
)

52 .
»ad_mp
("DST", 
AnyArg
(), 
daddr_¡r
)

53 .
»ad_mp
("DPORT", 
IPPÜtArg
(
IP_PROTO_UDP
), 
dpÜt
)

54 .
»ad_p
("CHECKSUM", 
BoŞArg
(), 
cksum
)

55 .
com¶‘e
() < 0)

58 ià(
	gdaddr_¡r
.
equ®s
("DST_ANNO", 8)) {

59 
	g_daddr
 = 
IPAdd»ss
();

60 
	g_u£_d¡_ªno
 = 
Œue
;

61 } ià(
IPAdd»ssArg
().
·r£
(
daddr_¡r
, 
_daddr
, 
this
))

62 
	g_u£_d¡_ªno
 = 
çl£
;

64  
	g”rh
->
”rÜ
("bad DST");

66 
	g_§ddr
 = 
§ddr
;

67 
	g_¥Üt
 = 
htÚs
(
¥Üt
);

68 
	g_dpÜt
 = 
htÚs
(
dpÜt
);

69 
	g_cksum
 = 
cksum
;

71 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


72 ià(!
	g_checked_®igÃd
) {

73 
	gªs
, 
	gc
, 
	go
;

74 
	gªs
 = 
Alignm’tInfo
::
qu”y
(
this
, 0, 
c
, 
o
);

75 
	g_®igÃd
 = (
ªs
 && 
c
 =ğ4 && 
o
 == 0);

76 ià(!
	g_®igÃd
)

77 
	g”rh
->
w¬nšg
("IP header unaligned, cannot use fast IP checksum");

78 ià(!
	gªs
)

79 
	g”rh
->
mes§ge
("(Try…assinghe configurationhrough %<click-align%>.)");

80 
	g_checked_®igÃd
 = 
Œue
;

87 
Pack‘
 *

88 
	gUDPIPEnÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

90 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`push
((
şick_udp
è+ (
şick_
));

91 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
p
->
	`d©a
());

92 
şick_udp
 *
udp
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(

 + 1);

94 #ià!
HAVE_INDIFFERENT_ALIGNMENT


95 
	`as£¹
((
ušŒ_t
)

 % 4 == 0);

98 

->
_v
 = 4;

99 

->
_hl
 = (
şick_
) >> 2;

100 

->
_Ën
 = 
	`htÚs
(
p
->
	`Ëngth
());

101 

->
_id
 = 
	`htÚs
(
_id
.
	`ãtch_ªd_add
(1));

102 

->
_p
 = 
IP_PROTO_UDP
;

103 

->
_¤c
 = 
_§ddr
;

104 ià(
_u£_d¡_ªno
)

105 

->
_d¡
 = 
p
->
	`d¡__ªno
();

107 

->
_d¡
 = 
_daddr
;

108 
p
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(
_daddr
));

110 

->
_tos
 = 0;

111 

->
_off
 = 0;

112 

->
_‰l
 = 250;

114 

->
_sum
 = 0;

115 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


116 ià(
_®igÃd
)

117 

->
_sum
 = 
	`_ç¡_csum
((*), (
şick_
) >> 2);

119 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

120 #–ià
HAVE_FAST_CHECKSUM


121 

->
_sum
 = 
	`_ç¡_csum
((*), (
şick_
) >> 2);

123 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

126 
p
->
	`£t__h—d”
(

, (
şick_
));

129 
udp
->
uh_¥Üt
 = 
_¥Üt
;

130 
udp
->
uh_dpÜt
 = 
_dpÜt
;

131 
ušt16_t
 
Ën
 = 
p
->
	`Ëngth
(è- (
şick_
);

132 
udp
->
uh_uËn
 = 
	`htÚs
(
Ën
);

133 
udp
->
uh_sum
 = 0;

134 ià(
_cksum
) {

135 
csum
 = 
	`şick_š_cksum
((*)
udp
, 
Ën
);

136 
udp
->
uh_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
Ën
);

139  
p
;

140 
	}
}

142 
SŒšg
 
	gUDPIPEnÿp
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

144 
UDPIPEnÿp
 *
u
 = 
¡©ic_ÿ¡
<UDPIPEnÿ°*>(
e
);

145 (
ušŒ_t
è
thunk
) {

147  
	`IPAdd»ss
(
u
->
_§ddr
).
	`uÅ¬£
();

149  
	`SŒšg
(
	`Áohs
(
u
->
_¥Üt
));

151  
	`IPAdd»ss
(
u
->
_daddr
).
	`uÅ¬£
();

153  
	`SŒšg
(
	`Áohs
(
u
->
_dpÜt
));

155  
	`SŒšg
();

157 
	}
}

159 
	gUDPIPEnÿp
::
	$add_hªdËrs
()

161 
	`add_»ad_hªdËr
("¤c", 
»ad_hªdËr
, 0);

162 
	`add_wr™e_hªdËr
("¤c", 
»cÚfigu»_keywÜd_hªdËr
, "0 SRC");

163 
	`add_»ad_hªdËr
("¥Üt", 
»ad_hªdËr
, 1);

164 
	`add_wr™e_hªdËr
("¥Üt", 
»cÚfigu»_keywÜd_hªdËr
, "1 SPORT");

165 
	`add_»ad_hªdËr
("d¡", 
»ad_hªdËr
, 2);

166 
	`add_wr™e_hªdËr
("d¡", 
»cÚfigu»_keywÜd_hªdËr
, "2 DST");

167 
	`add_»ad_hªdËr
("dpÜt", 
»ad_hªdËr
, 3);

168 
	`add_wr™e_hªdËr
("dpÜt", 
»cÚfigu»_keywÜd_hªdËr
, "3 DPORT");

169 
	}
}

171 
CLICK_ENDDECLS


172 
	$EXPORT_ELEMENT
(
UDPIPEnÿp
)

173 
	`ELEMENT_MT_SAFE
(
UDPIPEnÿp
)

	@tcpudp/udpipencap.hh

1 #iâdeà
CLICK_UDPIPENCAP_HH


2 
	#CLICK_UDPIPENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/©omic.hh
>

6 
	~<şickÃt/udp.h
>

7 
CLICK_DECLS


55 şas 
	cUDPIPEnÿp
 : 
public
 
EËm’t
 {…ublic:

57 
	$UDPIPEnÿp
(è
CLICK_COLD
;

58 ~
	$UDPIPEnÿp
(è
CLICK_COLD
;

60 cÚ¡ *
	$şass_Çme
() const {  "UDPIPEncap"; }

61 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

62 cÚ¡ *
	$æags
(ècÚ¡ {  "A"; 
	}
}

64 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

65 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

66 
	$add_hªdËrs
(è
CLICK_COLD
;

68 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

70 
´iv©e
:

72 
š_addr
 
_§ddr
;

73 
š_addr
 
_daddr
;

74 
ušt16_t
 
_¥Üt
;

75 
ušt16_t
 
_dpÜt
;

76 
boŞ
 
_cksum
;

77 
boŞ
 
_u£_d¡_ªno
;

78 #ià
HAVE_FAST_CHECKSUM
 && 
FAST_CHECKSUM_ALIGNED


79 
boŞ
 
_®igÃd
;

80 
boŞ
 
_checked_®igÃd
;

82 
©omic_ušt32_t
 
_id
;

84 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

86 
	}
};

88 
	gCLICK_ENDDECLS


	@tcpudp/udprewriter.cc

19 
	~<şick/cÚfig.h
>

20 
	~"ud´ewr™”.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/tim”.hh
>

25 
	~<şickÃt/tı.h
>

26 
	~<şickÃt/udp.h
>

27 
CLICK_DECLS


30 
	gUDPRewr™”
::
UDPFlow
::
	$­¶y
(
Wr™abËPack‘
 *
p
, 
boŞ
 
dœeùiÚ
, 
ªnos
)

32 
	`as£¹
(
p
->
	`has_ÃtwÜk_h—d”
());

33 
şick_
 *
h
 = 
p
->
	`_h—d”
();

36 cÚ¡ 
IPFlowID
 &
»væow
 = 
_e
[!
dœeùiÚ
].
	`æowid
();

37 
h
->
_¤c
 = 
»væow
.
	`daddr
();

38 
h
->
_d¡
 = 
»væow
.
	`§ddr
();

39 ià(
ªnos
 & 1)

40 
p
->
	`£t_d¡__ªno
(
»væow
.
	`§ddr
());

41 ià(
dœeùiÚ
 && (
ªnos
 & 2))

42 
p
->
	`£t_ªno_u8
(
ªnos
 >> 2, 
_»¶y_ªno
);

43 
	`upd©e_csum
(&
h
->
_sum
, 
dœeùiÚ
, 
__csum_d–
);

46 ià(!
	`IP_FIRSTFRAG
(
h
))

50 
şick_udp
 *
udph
 = 
p
->
	`udp_h—d”
();

51 
udph
->
uh_¥Üt
 = 
»væow
.
	`dpÜt
();

52 
udph
->
uh_dpÜt
 = 
»væow
.
	`¥Üt
();

53 ià(
h
->
_p
 =ğ
IP_PROTO_TCP
) {

54 ià(
p
->
	`Œª¥Üt_Ëngth
() >= 18)

55 
	`upd©e_csum
(&
»š‹½»t_ÿ¡
<
şick_tı
 *>(
udph
)->
th_sum
, 
dœeùiÚ
, 
_udp_csum_d–
);

56 } ià(
h
->
_p
 =ğ
IP_PROTO_UDP
) {

57 ià(
p
->
	`Œª¥Üt_Ëngth
(è>ğ8 && 
udph
->
uh_sum
)

59 
	`upd©e_csum
(&
udph
->
uh_sum
, 
dœeùiÚ
, 
_udp_csum_d–
);

63 ià(
dœeùiÚ
)

64 
_tæags
 |= 1;

65 ià(
_tæags
 < 6)

66 
_tæags
 += 2;

67 
	}
}

69 
	gUDPRewr™”
::
	$UDPRewr™”
()

71 
	}
}

73 
UDPRewr™”
::~
	$UDPRewr™”
()

75 
	}
}

78 
UDPRewr™”
::
	$ÿ¡
(cÚ¡ *
n
)

80 ià(
	`¡rcmp
(
n
, "IPRewriterBase") == 0)

81  (
IPRewr™”Ba£
 *)
this
;

82 ià(
	`¡rcmp
(
n
, "UDPRewriter") == 0)

83  (
UDPRewr™”
 *)
this
;

86 
	}
}

89 
	gUDPRewr™”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

91 
boŞ
 
	gd¡_ªno
 = 
Œue
, 
	ghas_»¶y_ªno
 = 
çl£
,

92 
	ghas_udp_¡»amšg_timeout
, 
	ghas_¡»amšg_timeout
;

93 
	g»¶y_ªno
;

94 
	g_timeouts
[0] = 300;

96 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

97 .
»ad
("DST_ANNO", 
d¡_ªno
)

98 .
»ad
("REPLY_ANNO", 
AÂoArg
(1), 
»¶y_ªno
).
»ad_¡©us
(
has_»¶y_ªno
)

99 .
»ad
("UDP_TIMEOUT", 
SecÚdsArg
(), 
_timeouts
[0])

100 .
»ad
("TIMEOUT", 
SecÚdsArg
(), 
_timeouts
[0])

101 .
»ad
("UDP_STREAMING_TIMEOUT", 
SecÚdsArg
(), 
_udp_¡»amšg_timeout
).
»ad_¡©us
(
has_udp_¡»amšg_timeout
)

102 .
»ad
("STREAMING_TIMEOUT", 
SecÚdsArg
(), 
_udp_¡»amšg_timeout
).
»ad_¡©us
(
has_¡»amšg_timeout
)

103 .
»ad
("UDP_GUARANTEE", 
SecÚdsArg
(), 
_timeouts
[1])

104 .
cÚsume
() < 0)

107 
	g_ªnos
 = (
d¡_ªno
 ? 1 : 0è+ (
has_»¶y_ªno
 ? 2 + (
»¶y_ªno
 << 2) : 0);

108 ià(!
	ghas_udp_¡»amšg_timeout
 && !
	ghas_¡»amšg_timeout
)

109 
	g_udp_¡»amšg_timeout
 = 
_timeouts
[0];

110 
	g_udp_¡»amšg_timeout
 *ğ
CLICK_HZ
;

112  
	gIPRewr™”Ba£
::
cÚfigu»
(
cÚf
, 
”rh
);

115 
IPRewr™”EÁry
 *

116 
	gUDPRewr™”
::
	$add_æow
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
,

117 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
, 
šput
)

119 *
d©a
;

120 ià(!(
d©a
 = 
_®loÿtÜ
.
	`®loÿ‹
()))

123 
UDPFlow
 *
æow
 = 
	`Ãw
(
d©a
) UDPFlow

124 (&
_šput_¥ecs
[
šput
], 
æowid
, 
»wr™‹n_æowid
, 
_p
,

125 !!
_timeouts
[1], 
	`şick_jiff›s
(è+ 
	`»Ëvªt_timeout
(_timeouts));

127  
	`¡Üe_æow
(
æow
, 
šput
, 
_m­
);

128 
	}
}

131 
	gUDPRewr™”
::
	$push
(
pÜt
, 
Pack‘
 *
p_š
)

133 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

134 ià(!
p
)

136 
şick_
 *
h
 = 
p
->
	`_h—d”
();

139 
_p
 = 
h
->ip_p;

140 ià((
_p
 !ğ
IP_PROTO_TCP
 && ip_°!ğ
IP_PROTO_UDP
 && ip_°!ğ
IP_PROTO_DCCP
)

141 || !
	`IP_FIRSTFRAG
(
h
)

142 || 
p
->
	`Œª¥Üt_Ëngth
() < 8) {

143 cÚ¡ 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
[
pÜt
];

144 ià(
is
.
kšd
 =ğ
IPRewr™”IÅut
::
i_nochªge
)

145 
	`ouut
(
is
.
fouut
).
	`push
(
p
);

147 
p
->
	`kl
();

151 
IPFlowID
 
	`æowid
(
p
);

152 
IPRewr™”EÁry
 *
m
 = 
_m­
.
	`g‘
(
æowid
);

154 ià(!
m
) {

155 
IPRewr™”IÅut
 &
is
 = 
_šput_¥ecs
.
	`unchecked_©
(
pÜt
);

156 
IPFlowID
 
»wr™‹n_æowid
 = IPFlowID::
	`unš™Ÿlized_t
();

157 
»suÉ
 = 
is
.
	`»wr™e_æowid
(
æowid
, 
»wr™‹n_æowid
, 
p
);

158 ià(
»suÉ
 =ğ
rw_addm­
)

159 
m
 = 
UDPRewr™”
::
	`add_æow
(
_p
, 
æowid
, 
»wr™‹n_æowid
, 
pÜt
);

160 ià(!
m
) {

161 
	`checked_ouut_push
(
»suÉ
, 
p
);

163 } ià(
_ªnos
 & 2)

164 
m
->
	`æow
()->
	`£t_»¶y_ªno
(
p
->
	`ªno_u8
(
_ªnos
 >> 2));

167 
UDPFlow
 *
mf
 = 
¡©ic_ÿ¡
<UDPFlow *>(
m
->
	`æow
());

168 
mf
->
	`­¶y
(
p
, 
m
->
	`dœeùiÚ
(), 
_ªnos
);

170 
şick_jiff›s_t
 
now_j
 = 
	`şick_jiff›s
();

171 ià(
_timeouts
[1])

172 
mf
->
	`chªge_expœy
(
_h—p
, 
Œue
, 
now_j
 + 
_timeouts
[1]);

174 
mf
->
	`chªge_expœy
(
_h—p
, 
çl£
, 
now_j
 + 
	`udp_æow_timeout
(mf));

176 
	`ouut
(
m
->ouut()).
	`push
(
p
);

177 
	}
}

180 
SŒšg


181 
	gUDPRewr™”
::
	$dump_m­pšgs_hªdËr
(
EËm’t
 *
e
, *)

183 
UDPRewr™”
 *
rw
 = (UDPRewr™” *)
e
;

184 
şick_jiff›s_t
 
now
 = 
	`şick_jiff›s
();

185 
SŒšgAccum
 
§
;

186 
M­
::
™”©Ü
 
™”
 = 
rw
->
_m­
.
	`begš
(); i‹r.
	`live
(); ++iter) {

187 
™”
->
	`æow
()->
	`uÅ¬£
(
§
, i‹r->
	`dœeùiÚ
(), 
now
);

188 
§
 << '\n';

190  
§
.
	`ke_¡ršg
();

191 
	}
}

194 
	gUDPRewr™”
::
	$add_hªdËrs
()

196 
	`add_»ad_hªdËr
("bË", 
dump_m­pšgs_hªdËr
);

197 
	`add_»ad_hªdËr
("m­pšgs", 
dump_m­pšgs_hªdËr
, 0, 
HªdËr
::
h_d•»ÿ‹d
);

198 
	`add_»wr™”_hªdËrs
(
Œue
);

199 
	}
}

201 
CLICK_ENDDECLS


202 
	$ELEMENT_REQUIRES
(
IPRewr™”Ba£
)

203 
	`EXPORT_ELEMENT
(
UDPRewr™”
)

	@tcpudp/udprewriter.hh

1 #iâdeà
CLICK_UDPREWRITER_HH


2 
	#CLICK_UDPREWRITER_HH


	)

3 
	~"–em’ts//»wr™”ba£.hh
"

4 
	~"–em’ts//rwm­pšg.hh
"

5 
	~<şick/sync.hh
>

6 
CLICK_DECLS


163 şas 
	cUDPRewr™”
 : 
public
 
IPRewr™”Ba£
 {…ublic:

165 şas 
	cUDPFlow
 : 
public
 
IPRewr™”Flow
 {…ublic:

167 
UDPFlow
(
IPRewr™”IÅut
 *
owÃr
, cÚ¡ 
IPFlowID
 &
æowid
,

168 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
, 
_p
,

169 
boŞ
 
gu¬ª‹ed
, 
şick_jiff›s_t
 
expœy_j
)

170 : 
IPRewr™”Flow
(
owÃr
, 
æowid
, 
»wr™‹n_æowid
,

171 
_p
, 
gu¬ª‹ed
, 
expœy_j
) {

174 
boŞ
 
¡»amšg
() const {

175  
	m_tæags
 > 6;

178 
­¶y
(
Wr™abËPack‘
 *
p
, 
boŞ
 
dœeùiÚ
, 
ªnos
);

182 
	$UDPRewr™”
(è
CLICK_COLD
;

183 ~
	$UDPRewr™”
(è
CLICK_COLD
;

185 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "UDPRewr™”"; 
	}
}

186 *
ÿ¡
(const *);

188 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

190 
IPRewr™”EÁry
 *
add_æow
(
_p
, cÚ¡ 
IPFlowID
 &
æowid
,

191 cÚ¡ 
IPFlowID
 &
»wr™‹n_æowid
, 
šput
);

192 
de¡roy_æow
(
IPRewr™”Flow
 *
æow
);

193 
şick_jiff›s_t
 
	$be¡_effÜt_expœy
(cÚ¡ 
IPRewr™”Flow
 *
æow
) {

194  
æow
->
	`expœy
(è+ 
	`udp_æow_timeout
(
¡©ic_ÿ¡
<cÚ¡ 
UDPFlow
 *>(æow)è- 
_timeouts
[1];

195 
	}
}

197 
push
(, 
Pack‘
 *);

199 
	$add_hªdËrs
(è
CLICK_COLD
;

201 
´iv©e
:

203 
SizedHashAÎoÿtÜ
<(
UDPFlow
)> 
_®loÿtÜ
;

204 
_ªnos
;

205 
ušt32_t
 
_udp_¡»amšg_timeout
;

207 
	$udp_æow_timeout
(cÚ¡ 
UDPFlow
 *
mf
) const {

208 ià(
mf
->
	`¡»amšg
())

209  
_udp_¡»amšg_timeout
;

211  
_timeouts
[0];

212 
	}
}

214 
SŒšg
 
dump_m­pšgs_hªdËr
(
EËm’t
 *, *);

216 
ä›nd
 
şass
 
	gIPRewr™”
;

221 
šlše
 

222 
	gUDPRewr™”
::
	$de¡roy_æow
(
IPRewr™”Flow
 *
æow
)

224 
	`unm­_æow
(
æow
, 
_m­
);

225 
æow
->~
	`IPRewr™”Flow
();

226 
_®loÿtÜ
.
	`d—Îoÿ‹
(
æow
);

227 
	}
}

229 
	gCLICK_ENDDECLS


	@test/bhmtest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"bhm‹¡.hh
"

21 
	~<şick/bighashm­.hh
>

22 
	~<şick/hashm­.hh
>

23 
	~<şick/”rÜ.hh
>

24 #ià
CLICK_USERLEVEL


25 
	~<sys/time.h
>

26 
	~<sys/»sourû.h
>

27 
	~<uni¡d.h
>

29 
CLICK_DECLS


31 
	gBigHashM­Te¡
::
	$BigHashM­Te¡
()

33 
	}
}

35 
	#CHECK
(
x
èià(!(x)è 
”rh
->
	`”rÜ
("%s:%d:e¡ `%s' faed", 
__FILE__
, 
__LINE__
, #x);

	)

36 
	#CHECK_DATA
(
x
, 
y
, 
l
è
	`CHECK
(
	`memcmp
((x), (y), (l)è=ğ0)

	)

39 
check1
(
HashM­
<
SŒšg
, > &
h
, 
E¼ÜHªdËr
 *
”rh
)

41 
CHECK
(
h
.
size
() == 4);

42 
CHECK
(!
h
.
em±y
());

44 
	gx
[4] = "\0\0\0";

45 
	gn
 = 0;

46 
	gHashM­
<
	gSŒšg
, >::
cÚ¡_™”©Ü
 
i
 = 
h
.
begš
(); 
	gi
.
live
(); i++) {

47 
CHECK
(
i
.
v®ue
() >= 1 && i.value() <= 4);

48 
CHECK
(
x
[
i
.
v®ue
() - 1] == 0);

49 
	gx
[
i
.
v®ue
() - 1] = 1;

50 
	gn
++;

52 
CHECK
(
n
 == 4);

54 
mem£t
(
x
, 0, 4);

55 
	gn
 = 0;

56 
	gHashM­
<
	gSŒšg
, >::
™”©Ü
 
i
 = 
h
.
begš
(); 
	gi
.
live
(); i++) {

57 
	gŞdv
 = 
i
.
v®ue
();

58 
CHECK
(
i
.
v®ue
() >= 1 && i.value() <= 4);

59 
	gi
.
v®ue
() = 5;

60 
CHECK
(
i
.
v®ue
() == 5);

61 
	gi
.
v®ue
(èğ
Şdv
;

62 
CHECK
(
x
[
i
.
v®ue
() - 1] == 0);

63 
	gx
[
i
.
v®ue
() - 1] = 1;

64 
	gn
++;

66 
CHECK
(
n
 == 4);

71 #ià
CLICK_USERLEVEL


72 cÚ¡ * cÚ¡ 
	gşas£s
[] = {

331 cÚ¡ * cÚ¡ 
	gnÚşas£s
[] = {

412 
	gBigHashM­Te¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

414 
HashM­
<
SŒšg
, > 
	`h
(-1);

416 
h
.
	`š£¹
("Foo", 1);

417 
h
.
	`š£¹
("bar", 2);

418 
h
.
	`š£¹
("facker", 3);

419 
h
.
	`š£¹
("Anne Elizabeth Dudfield", 4);

421 
	`CHECK
(
	`check1
(
h
, 
”rh
) == 0);

425 
HashM­
<
SŒšg
, > 
	`hh
(
h
);

426 
	`CHECK
(
	`check1
(
hh
, 
”rh
) == 0);

427 
hh
.
	`š£¹
("crap", 5);

430 
	`CHECK
(
	`check1
(
h
, 
”rh
) == 0);

432 #ià
CLICK_USERLEVEL


433 
HashM­
<
SŒšg
, > 
	`m­
(-1);

435 
ru§ge
 
ru0
, 
ru1
;

436 
Time¡amp
 
ts0
, 
ts1
;

437 ià(
	`g‘ru§ge
(
RUSAGE_SELF
, &
ru0
) < 0)

438  
”rh
->
	`”rÜ
("ru§ge: %s", 
	`¡»¼Ü
(
”ºo
));

439 
ts0
.
	`assign_now
();

441 
i
 = 0; i < 100; i++) {

442 
m­
.
	`ş—r
();

443 cÚ¡ * cÚ¡ *
s
 = 
şas£s
; *s; s++)

444 
m­
.
	`š£¹
(*
s
, s - 
şas£s
);

445 
v®ue
 = 0;

446 cÚ¡ * cÚ¡ *
s
 = 
şas£s
; *s; s++)

447 
v®ue
 +ğ
m­
.
	`fšd
(*
s
);

448 cÚ¡ * cÚ¡ *
s
 = 
nÚşas£s
; *s; s++)

449 
v®ue
 +ğ
m­
.
	`fšd
(*
s
);

452 ià(
	`g‘ru§ge
(
RUSAGE_SELF
, &
ru1
) < 0)

453  
”rh
->
	`”rÜ
("ru§ge: %s", 
	`¡»¼Ü
(
”ºo
));

454 
ts1
.
	`assign_now
();

456 
Time¡amp
 
ru_d–
 = 
	`Time¡amp
(
ru1
.
ru_utime
è- Time¡amp(
ru0
.ru_utime);

457 
ts1
 -ğ
ts0
;

458 
”rh
->
	`mes§ge
("%p{time¡amp}u %p{time¡amp}Ù®", &
ru_d–
, &
ts1
);

461 
”rh
->
	`mes§ge
("Allests…ass!");

463 
	}
}

465 
	$EXPORT_ELEMENT
(
BigHashM­Te¡
)

466 
CLICK_ENDDECLS


	@test/bhmtest.hh

2 #iâdeà
CLICK_BIGHASHMAPTEST_HH


3 
	#CLICK_BIGHASHMAPTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


23 şas 
	cBigHashM­Te¡
 : 
public
 
EËm’t
 {…ublic:

25 
	$BigHashM­Te¡
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "BigHashMapTest"; }

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

31 
	}
};

33 
	gCLICK_ENDDECLS


	@test/biginttest.cc

20 
	~<şick/cÚfig.h
>

21 
	~"bigš‰e¡.hh
"

22 
	~<şick/hashbË.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/bigšt.hh
>

25 #ià
CLICK_USERLEVEL


26 
	~<sys/time.h
>

27 
	~<sys/»sourû.h
>

28 
	~<uni¡d.h
>

30 
CLICK_DECLS


32 
	gBigštTe¡
::
	$BigštTe¡
()

34 
	}
}

36 
	#CHECK
(
x
, 
a
, 
b
èià(!(x)è 
”rh
->
	`”rÜ
("%s:%d:e¡ `%s' faed [%Îu, %u]", 
__FILE__
, 
__LINE__
, #x,‡, b);

	)

37 
	#CHECK0
(
x
èià(!(x)è 
”rh
->
	`”rÜ
("%s:%d:e¡ `%s' faed", 
__FILE__
, 
__LINE__
, #x);

	)

39 
boŞ
 
	$‹¡_muÉly
(
ušt32_t
 
a
, ušt32_ˆ
b
, 
E¼ÜHªdËr
 *
”rh
) {

40 
ušt32_t
 
x
[2];

41 
bigšt
::
	`muÉly
(
x
[1], x[0], 
a
, 
b
);

42 
ušt64_t
 
c
 = (((ušt64_tè
x
[1]) << 32) | x[0];

43 ià(
c
 !ğ(
ušt64_t
è
a
 * 
b
) {

44 
”rh
->
	`”rÜ
("%u * %u =ğ%Îu,‚Ù %Îu", 
a
, 
b
, (
ušt64_t
è¨* b, 
c
);

45  
çl£
;

47  
Œue
;

48 
	}
}

50 
boŞ
 
	$‹¡_mul
(
ušt64_t
 
a
, 
ušt32_t
 
b
, 
E¼ÜHªdËr
 *
”rh
) {

51 
ušt32_t
 
ax
[2];

52 
ax
[0] = 
a
;

53 
ax
[1] = 
a
 >> 32;

54 
ušt32_t
 
cx
[2];

55 
cx
[0] = cx[1] = 0;

56 
bigšt
::
	`muÉly_add
(
cx
, 
ax
, 2, 
b
);

57 
ušt64_t
 
c
 = (((ušt64_tè
cx
[1]) << 32) | cx[0];

58 ià(
c
 !ğ
a
 * 
b
) {

59 
”rh
->
	`”rÜ
("%Îu * %u =ğ%Îu,‚Ù %Îu", 
a
, 
b
,‡ * b, 
c
);

60  
çl£
;

62  
Œue
;

63 
	}
}

65 
boŞ
 
	$‹¡_div
(
ušt64_t
 
a
, 
ušt32_t
 
b
, 
E¼ÜHªdËr
 *
”rh
) {

66 
ušt32_t
 
ax
[4];

67 
ax
[0] = 
a
;

68 
ax
[1] = 
a
 >> 32;

69 
ušt32_t
 
r
 = 
bigšt
::
	`divide
(
ax
+2,‡x, 2, 
b
);

70 
ušt64_t
 
c
 = ((ušt64_tè
ax
[3] << 32) |‡x[2];

71 ià(
c
 !ğ
a
 / 
b
) {

72 
”rh
->
	`”rÜ
("%Îu / %u =ğ%Îu,‚Ù %Îu", 
a
, 
b
,‡ * b, 
c
);

73  
çl£
;

75 ià(
r
 !ğ
a
 % 
b
) {

76 
”rh
->
	`”rÜ
("%Îu %% %u =ğ%Îu,‚Ù %u", 
a
, 
b
,‡ % b, 
r
);

77  
çl£
;

79  
Œue
;

80 
	}
}

82 
boŞ
 
	$‹¡_šv”£
(
ušt32_t
 
a
, 
E¼ÜHªdËr
 *
”rh
) {

83 
	`as£¹
(
a
 & (1 << 31));

84 
ušt32_t
 
a_šv”£
 = 
bigšt
::
	`šv”£
(
a
);

86 
ušt64_t
 
b
 = (uint64_t) 1 << 32;

87 
ušt64_t
 
wªt_šv”£
 = (
b
 * (b - 
a
) - 1) /‡;

88 
	`as£¹
(
wªt_šv”£
 < 
b
);

89 ià(
a_šv”£
 !ğ
wªt_šv”£
) {

90 
”rh
->
	`”rÜ
("šv”£(%uè=ğ%u,‚Ù %u", 
a
, (
ušt32_t
è
wªt_šv”£
, 
a_šv”£
);

91  
çl£
;

93  
Œue
;

94 
	}
}

96 
boŞ
 
	$‹¡_add
(
ušt64_t
 
a
, ušt64_ˆ
b
, 
E¼ÜHªdËr
 *
”rh
) {

97 
ušt32_t
 
ax
[6];

98 
ax
[2] = 
a
;

99 
ax
[3] = 
a
 >> 32;

100 
ax
[4] = 
b
;

101 
ax
[5] = 
b
 >> 32;

102 
bigšt
::
	`add
(
ax
[1],‡x[0],‡x[3],‡x[2],‡x[5],‡x[4]);

103 
ušt64_t
 
c
 = ((ušt64_tè
ax
[1] << 32) |‡x[0];

104 ià(
c
 !ğ
a
 + 
b
) {

105 
”rh
->
	`”rÜ
("%Îu + %Îu =ğ%Îu,‚Ù %Îu", 
a
, 
b
,‡ + b, 
c
);

106  
çl£
;

108  
Œue
;

109 
	}
}

112 
	gBigštTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

114 
i
 = 0; i < 3000; i++) {

115 
ušt32_t
 
a
 = 
	`şick_¿ndom
() | (click_random() << 31);

116 
ušt32_t
 
b
 = 
	`şick_¿ndom
() | (click_random() << 31);

117 
	`CHECK
(
	`‹¡_muÉly
(
a
, 
b
, 
”rh
),‡, b);

118 
	`CHECK
(
	`‹¡_mul
(
a
, 
b
, 
”rh
),‡, b);

120 
i
 = 0; i < 8000; i++) {

121 
ušt32_t
 
a
 = 
	`şick_¿ndom
();

122 
	`CHECK0
(
	`‹¡_šv”£
(
a
 | 0x80000000, 
”rh
));

124 
	`CHECK0
(
	`‹¡_šv”£
(0x80000000, 
”rh
));

125 
i
 = 0; i < 8000; i++) {

126 
ušt64_t
 
a
 = 
	`şick_¿ndom
() | ((uint64_t) click_random() << 31) | ((uint64_t) click_random() << 62);

127 
ušt64_t
 
b
 = 
	`şick_¿ndom
() | ((uint64_t) click_random() << 31) | ((uint64_t) click_random() << 62);

128 
	`CHECK0
(
	`‹¡_add
(
a
, 
b
, 
”rh
));

130 
	`CHECK0
(
	`‹¡_div
(12884758640815563913ULL, 2506284098U, 
”rh
));

131 
i
 = 0; i < 3000; i++) {

132 
ušt64_t
 
a
 = 
	`şick_¿ndom
() | ((uint64_t) click_random() << 31) | ((uint64_t) click_random() << 62);

133 
ušt32_t
 
b
 = 
	`şick_¿ndom
();

134 
	`CHECK
(
	`‹¡_div
(
a
, 
b
 | 0x80000000, 
”rh
),‡, b | 0x80000000);

136 
i
 = 0; i < 3000; i++) {

137 
ušt64_t
 
a
 = 
	`şick_¿ndom
() | ((uint64_t) click_random() << 31) | ((uint64_t) click_random() << 62);

138 
ušt32_t
 
b
 = 
	`şick_¿ndom
();

139 
	`CHECK
(
	`‹¡_div
(
a
, 
b
 & ~0x80000000, 
”rh
),‡, b & ~0x80000000);

140 
	`CHECK
(
	`‹¡_div
(
a
, 
b
 | 0x80000000, 
”rh
),‡, b | 0x80000000);

143 
ušt32_t
 
x
[3] = { 3481, 592182, 3024921038U };

144 
	`CHECK0
(
bigšt
::
	`uÅ¬£_ş—r
(
x
, 3) == "55799944231168388787108580761");

146 
x
[0] = 10;

147 
x
[1] = 0;

148 
	`CHECK0
(
bigšt
::
	`muÉly
(
x
, x, 2, 10) == 0 && x[0] == 100 && x[1] == 0);

149 
	`CHECK0
(
bigšt
::
	`muÉly
(
x
, x, 2, 4191384139U) == 0 && x[0] == 0x9698A54CU && x[1] == 0x61U);

152 
št32_t
 
quÙ
, 
»m
;

153 
»m
 = 
	`št_»mašd”
((
št32_t
è0x80000000, 2, 
quÙ
);

154 
	`CHECK0
(
quÙ
 =ğ-0x40000000 && 
»m
 == 0);

155 
»m
 = 
	`št_»mašd”
((
št32_t
è0x80000000, 3, 
quÙ
);

156 
	`CHECK0
(
quÙ
 =ğ-715827883 && 
»m
 == 1);

159 
”rh
->
	`mes§ge
("Allests…ass!");

161 
	}
}

163 
	$EXPORT_ELEMENT
(
BigštTe¡
)

164 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
št64
)

165 
CLICK_ENDDECLS


	@test/biginttest.hh

2 #iâdeà
CLICK_BIGINTTEST_HH


3 
	#CLICK_BIGINTTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


22 şas 
	cBigštTe¡
 : 
public
 
EËm’t
 {…ublic:

24 
	$BigštTe¡
(è
CLICK_COLD
;

26 cÚ¡ *
	$şass_Çme
() const {  "BigintTest"; }

28 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

30 
	}
};

32 
	gCLICK_ENDDECLS


	@test/bitvectortest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"b™veùÜ‹¡.hh
"

21 
	~<şick/b™veùÜ.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gB™veùÜTe¡
::
	$B™veùÜTe¡
()

27 
	}
}

29 
	#CHECK
(
x
èià(!(x)è 
”rh
->
	`”rÜ
("%s:%d:e¡ %<%s%> faed", 
__FILE__
, 
__LINE__
, #x);

	)

30 
	#CHECK_DATA
(
x
, 
y
, 
l
è
	`CHECK
(
	`memcmp
((x), (y), (l)è=ğ0)

	)

33 
	gB™veùÜTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

35 
B™veùÜ
 
bv
;

36 
	`CHECK
(
bv
.
	`size
() == 0);

37 
	`CHECK
(
bv
.
	`z”o
());

38 
	`CHECK
(!
bv
);

40 
bv
.
	`»size
(40);

41 
bv
[39] = 
Œue
;

42 
	`CHECK
(
bv
.
	`size
() == 40);

43 
	`CHECK
(
bv
[39]);

44 
	`CHECK
(
bv
);

46 
bv
.
	`»size
(10);

47 
	`CHECK
(!
bv
);

49 
bv
.
	`»size
(40);

50 
	`CHECK
(!
bv
);

51 
	`CHECK
(!
bv
[39]);

53 
bv
[0] = 
Œue
;

54 
bv
.
	`»size
(0);

55 
	`CHECK
(
bv
.
	`wÜds
()[0] == 0);

57 
”rh
->
	`mes§ge
("Allests…ass!");

59 
	}
}

61 
	$EXPORT_ELEMENT
(
B™veùÜTe¡
)

62 
CLICK_ENDDECLS


	@test/bitvectortest.hh

2 #iâdeà
CLICK_BITVECTORTEST_HH


3 
	#CLICK_BITVECTORTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


23 şas 
	cB™veùÜTe¡
 : 
public
 
EËm’t
 {…ublic:

25 
	$B™veùÜTe¡
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "BitvectorTest"; }

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

31 
	}
};

33 
	gCLICK_ENDDECLS


	@test/blockthread.cc

19 
	~<şick/cÚfig.h
>

20 
	~"blockth»ad.hh
"

21 
	~<şick/cÚå¬£.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<sys/£Ëù.h
>

24 
CLICK_DECLS


26 
	gBlockTh»ad
::
	$BlockTh»ad
()

28 
	}
}

31 
BlockTh»ad
::
	$hªdËr
(, 
SŒšg
 &
¡r
, 
EËm’t
 *, cÚ¡ 
HªdËr
 *, 
E¼ÜHªdËr
 *
”rh
)

33 
timev®
 
tv
;

34 ià(!
	`ı_time
(
¡r
, &
tv
))

35  
”rh
->
	`”rÜ
("bad TIME");

36 
r
 = 
	`£Ëù
(0, 0, 0, 0, &
tv
);

37 
¡r
 = 
	`SŒšg
(
r
);

39 
	}
}

42 
	gBlockTh»ad
::
	$add_hªdËrs
()

44 
	`£t_hªdËr
("block", 
HªdËr
::
h_wr™e
 | HªdËr::
h_wr™e_´iv©e
, 
hªdËr
, 0, 0);

45 
	}
}

47 
CLICK_ENDDECLS


48 
	$EXPORT_ELEMENT
(
BlockTh»ad
)

49 
	`ELEMENT_REQUIRES
(
u£¾ev–
)

	@test/blockthread.hh

2 #iâdeà
CLICK_BLOCKTHREAD_HH


3 
	#CLICK_BLOCKTHREAD_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


27 şas 
	cBlockTh»ad
 : 
public
 
EËm’t
 {…ublic:

29 
	$BlockTh»ad
(è
CLICK_COLD
;

31 cÚ¡ *
	$şass_Çme
() const {  "BlockThread"; }

33 
	$add_hªdËrs
(è
CLICK_COLD
;

35 
´iv©e
:

37 
	`hªdËr
(, 
SŒšg
&, 
EËm’t
*, cÚ¡ 
HªdËr
*, 
E¼ÜHªdËr
*);

39 
	}
};

41 
	gCLICK_ENDDECLS


	@test/checkpacket.cc

19 
	~<şick/cÚfig.h
>

20 
	~"check·ck‘.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gCheckPack‘
::
	$CheckPack‘
()

27 
	}
}

30 
CheckPack‘
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

32 
	g_d©a
 = 
SŒšg
::
make_out_of_memÜy
();

33 
	g_d©a_off£t
 = 0;

34 
SŒšg
 
	g®ignm’t
;

35 
	gËngth_eq
 = -1, 
	gËngth_ge
 = -1, 
	gËngth_Ë
 = -1;

37 ià(
Args
(
cÚf
, 
this
, 
”rh
)

38 .
»ad
("DATA", 
_d©a
)

39 .
»ad
("DATA_OFFSET", 
_d©a_off£t
)

40 .
»ad
("LENGTH", 
Ëngth_eq
)

41 .
»ad
("LENGTH_EQ", 
Ëngth_eq
)

42 .
»ad
("LENGTH_GE", 
Ëngth_ge
)

43 .
»ad
("LENGTH_LE", 
Ëngth_Ë
)

44 .
»ad
("ALIGNMENT", 
AnyArg
(), 
®ignm’t
)

45 .
com¶‘e
() < 0)

48 ià((
	gËngth_eq
 >ğ0è+ (
Ëngth_ge
 >ğ0è+ (
Ëngth_Ë
 >= 0) > 1)

49  
”rh
->
”rÜ
("specify‡t most one of LENGTH_EQ, LENGTH_GE,‡nd LENGTH_LE");

50 ià(
	gËngth_eq
 >= 0)

51 
_Ëngth
 = 
Ëngth_eq
, 
	g_Ëngth_İ
 = '=';

52 ià(
	gËngth_ge
 >= 0)

53 
_Ëngth
 = 
Ëngth_ge
 - 1, 
	g_Ëngth_İ
 = '>';

54 ià(
	gËngth_Ë
 >= 0)

55 
_Ëngth
 = 
Ëngth_Ë
 + 1, 
	g_Ëngth_İ
 = '<';

57 
	g_Ëngth_İ
 = 0;

59 
	g_d©a_İ
 = (
_d©a
.
out_of_memÜy
() ? 0 : '=');

61 ià(
	g®ignm’t
) {

62 ià(
Args
(
this
, 
”rh
).
push_back_wÜds
(
®ignm’t
)

63 .
»ad_mp
("MODULUS", 
_®ignm’t_chunk
)

64 .
»ad_mp
("OFFSET", 
_®ignm’t_off£t
)

65 .
com¶‘e
() < 0)

67 ià(
	g_®ignm’t_chunk
 <ğ1 || 
_®ignm’t_off£t
 < 0 || _®ignm’t_off£ˆ>ğ
_®ignm’t_chunk
)

68  
”rh
->
”rÜ
("bad‡lignment modulus‡nd/or offset");

74 
Pack‘
 *

75 
	gCheckPack‘
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

77 
E¼ÜHªdËr
 *
”rh
 = E¼ÜHªdËr::
	`deçuÉ_hªdËr
();

80 ià(
_Ëngth_İ
 == '=') {

81 ià(
p
->
	`Ëngth
(è!ğ
_Ëngth
)

82 
”rh
->
	`”rÜ
("%s: bad†’gth %d (wª‹d %d)", 
	`deş¬©iÚ
().
	`c_¡r
(), 
p
->
	`Ëngth
(), 
_Ëngth
);

83 } ià(
_Ëngth_İ
 == '>') {

84 ià(
p
->
	`Ëngth
(è<ğ
_Ëngth
)

85 
”rh
->
	`”rÜ
("%s: bad†’gth %d (wª‹d > %d)", 
	`deş¬©iÚ
().
	`c_¡r
(), 
p
->
	`Ëngth
(), 
_Ëngth
);

86 } ià(
_Ëngth_İ
 == '<') {

87 ià(
p
->
	`Ëngth
(è>ğ
_Ëngth
)

88 
”rh
->
	`”rÜ
("%s: bad†’gth %d (wª‹d < %d)", 
	`deş¬©iÚ
().
	`c_¡r
(), 
p
->
	`Ëngth
(), 
_Ëngth
);

92 ià(
_d©a_İ
) {

93 ià(
p
->
	`Ëngth
(è< 
_d©a
.Ëngth(è+ 
_d©a_off£t
)

94 
”rh
->
	`”rÜ
("%s: d©¨toØshÜˆ(%d by‹s, wª‹d %d)", 
	`deş¬©iÚ
().
	`c_¡r
(), 
p
->
	`Ëngth
(), 
_d©a
.Ëngth(è+ 
_d©a_off£t
);

95 ià(
_d©a_İ
 =ğ'=' && 
p
->
	`Ëngth
(è> 
_d©a
.Ëngth(è+ 
_d©a_off£t
)

96 
”rh
->
	`”rÜ
("%s: d©¨toØlÚg (%d by‹s, wª‹d %d)", 
	`deş¬©iÚ
().
	`c_¡r
(), 
p
->
	`Ëngth
(), 
_d©a
.Ëngth(è+ 
_d©a_off£t
);

97 ià(
	`memcmp
(
p
->
	`d©a
(è+ 
_d©a_off£t
, 
_d©a
.d©a(), _d©a.
	`Ëngth
()) != 0)

98 
”rh
->
	`”rÜ
("%s: bad d©¨(dÛ nÙ m©ch)", 
	`deş¬©iÚ
().
	`c_¡r
());

102 ià(
_®ignm’t_chunk
 >= 0) {

103 
®ignm’t
 = 
»š‹½»t_ÿ¡
<
ušŒ_t
>(
p
->
	`d©a
()è& (
_®ignm’t_chunk
 - 1);

104 ià(
®ignm’t
 !ğ
_®ignm’t_off£t
)

105 
”rh
->
	`”rÜ
("%s: bad‡lignm’ˆ(%d/%d,ƒx³ùed %d/%d)", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_®ignm’t_chunk
, 
®ignm’t
, _®ignm’t_chunk, 
_®ignm’t_off£t
);

109 
	}
}

111 
CLICK_ENDDECLS


112 
EXPORT_ELEMENT
(
CheckPack‘
)

	@test/checkpacket.hh

2 #iâdeà
CLICK_CHECKPACKET_HH


3 
	#CLICK_CHECKPACKET_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


60 şas 
	cCheckPack‘
 : 
public
 
EËm’t
 {…ublic:

62 
	$CheckPack‘
(è
CLICK_COLD
;

64 cÚ¡ *
	$şass_Çme
() const {  "CheckPacket"; }

65 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

67 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

69 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

71 
	g´iv©e
:

73 
SŒšg
 
_d©a
;

74 
ušt32_t
 
	g_d©a_off£t
;

75 
	g_®ignm’t_chunk
;

76 
	g_®ignm’t_off£t
;

77 
ušt32_t
 
	g_Ëngth
;

78 
ušt8_t
 
	g_d©a_İ
;

79 
ušt8_t
 
	g_Ëngth_İ
;

83 
	gCLICK_ENDDECLS


	@test/clptest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"ş±e¡.hh
"

21 
	~<şick/glue.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/şp.h
>

25 
	gCLICK_DECLS


27 
	#CÍ_V®Anim®
 
CÍ_V®Fœ¡U£r


	)

29 
	gCLPTe¡
::
	$CLPTe¡
()

31 
	}
}

33 cÚ¡ 
CÍ_O±iÚ
 
İtiÚs_x1
[] = {

38 cÚ¡ * cÚ¡ 
	g¬gs_x1
[] = {

44 cÚ¡ 
CÍ_O±iÚ
 
	gİtiÚs_x2
[] = {

50 cÚ¡ * cÚ¡ 
	g¬gs_x2
[] = {

58 cÚ¡ 
CÍ_O±iÚ
 
	gİtiÚs_x3
[] = {

65 cÚ¡ * cÚ¡ 
	g¬gs_x3
[] = {

74 cÚ¡ 
CÍ_O±iÚ
 
	gİtiÚs_x4
[] = {

79 cÚ¡ * cÚ¡ 
	g¬gs_x4
[] = {

87 cÚ¡ 
CÍ_O±iÚ
 
	gİtiÚs_x5
[] = {

88 { "a", 'a', 1, 
CÍ_V®IÁ
, 0 },

89 { "b", 'b', 2, 
CÍ_V®IÁ
, 
CÍ_O±iÚ®
 },

93 cÚ¡ * cÚ¡ 
	g¬gs_x5
[] = {

114 cÚ¡ 
CÍ_O±iÚ
 
	gİtiÚs_x6
[] = {

115 { "¬t", 'a', 1, 
CÍ_V®IÁ
, 
CÍ_Neg©e
 },

116 { "b", 'b', 2, 
CÍ_V®IÁ
, 0 }

119 cÚ¡ * cÚ¡ 
	g¬gs_x6
[] = {

131 cÚ¡ 
CÍ_O±iÚ
 
	gİtiÚs_x7
[] = {

132 { "¬t", 'a', 1, 
CÍ_V®SŒšgNÙO±iÚ
, 
CÍ_P»ã¼edM©ch
 },

137 cÚ¡ * cÚ¡ 
	g¬gs_x7
[] = {

149 cÚ¡ 
CÍ_O±iÚ
 
	gİtiÚs_x8
[] = {

150 { "ªim®", 'a', 1, 
CÍ_V®Anim®
, 0 }

153 cÚ¡ * cÚ¡ 
	g¬gs_x8
[] = {

164 
ş±e¡_”rh
(
CÍ_P¬£r
 *
şp
, cÚ¡ *
”rÜ
) {

165 
SŒšgAccum
 *
§
 = (SŒšgAccum *è
şp
->
u£r_d©a
;

166 *
§
 << 
”rÜ
;

170 
	#CHECK
(
x
èià(!(x)è
”rh
->
	`”rÜ
("%s:%d:e¡ %<%s%> faed", 
__FILE__
, 
__LINE__
, #x);

	)

171 
	#CHECK_INTEQ
(
x
, 
v
èdØ{ 
v®__
 = (x); ià(v®__ !ğ(v)è
”rh
->
	`”rÜ
("%s:%d:e¡ %<%s%> gÙ %d,ƒx³ùed %d", 
__FILE__
, 
__LINE__
, #x, v®__, (v)); } 0)

	)

172 
	#CHECK_STREQ
(
x
, 
v
èdØ{ 
SŒšg
 
v®__
 = (x); ià(v®__ !ğ(v)è
”rh
->
	`”rÜ
("%s:%d:e¡ %<%s%> gÙ %<%s%>,ƒx³ùed %<%s%>", 
__FILE__
, 
__LINE__
, #x, v®__.
	`c_¡r
(), (v)); } 0)

	)

173 
	#CHECK_DATA
(
x
, 
y
, 
l
è
	`CHECK
(
	`memcmp
((x), (y), (l)è=ğ0)

	)

174 
	#ÃËm
(
x
è((xè/ ((x)[0]))

	)

177 
	gCLPTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

179 
CÍ_P¬£r
 *
şp
 = 
	`CÍ_NewP¬£r
(0, 0, 0, 0);

180 
SŒšgAccum
 
§
;

181 
şp
->
u£r_d©a
 = &
§
;

182 
	`CÍ_S‘UTF8
(
şp
, 1);

183 
	`CÍ_S‘E¼ÜHªdËr
(
şp
, 
ş±e¡_”rh
);

186 
	`CÍ_S‘O±iÚs
(
şp
, 
	`ÃËm
(
İtiÚs_x1
), options_x1);

187 
	`CÍ_S‘Argum’ts
(
şp
, 
	`ÃËm
(
¬gs_x1
),‡rgs_x1);

188 
	`CHECK
(
§
.
	`ke_¡ršg
() == "");

189 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

190 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 2);

191 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_DÚe
);

194 
	`CÍ_S‘O±iÚCh¬
(
şp
, '-', 
CÍ_ShÜt
 | 
CÍ_LÚg
);

195 
	`CHECK
(
§
.
	`ke_¡ršg
().
	`fšd_Ëá
("1-char†ong‚ame conflicts") >= 0);

198 
	`CÍ_S‘O±iÚCh¬
(
şp
, '-', 
CÍ_ShÜt
);

199 
	`CÍ_S‘O±iÚs
(
şp
, 
	`ÃËm
(
İtiÚs_x2
), options_x2);

200 
	`CÍ_S‘Argum’ts
(
şp
, 
	`ÃËm
(
¬gs_x2
),‡rgs_x2);

201 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "");

202 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 2);

203 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

204 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 3);

205 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_BadO±iÚ
);

206 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "unrecognized option \342\200\230-b\342\200\231\n");

207 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_BadO±iÚ
);

208 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "unrecognized option \342\200\230-\357\277\275\342\200\231\n");

209 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 2);

210 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

211 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_DÚe
);

214 
	`CÍ_S‘O±iÚs
(
şp
, 
	`ÃËm
(
İtiÚs_x3
), options_x3);

215 
	`CÍ_S‘Argum’ts
(
şp
, 
	`ÃËm
(
¬gs_x3
),‡rgs_x3);

216 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "");

217 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

218 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_BadO±iÚ
);

219 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "option \342\200\230--ab\342\200\231 is‡mbiguous\n(Possibilities‡re \342\200\230--abc\342\200\231, \342\200\230--abd\342\200\231,‡nd \342\200\230--abde\342\200\231.)\n");

220 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 2);

221 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 3);

222 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 4);

223 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_DÚe
);

226 
	`CÍ_S‘O±iÚs
(
şp
, 
	`ÃËm
(
İtiÚs_x4
), options_x4);

227 
	`CÍ_S‘Argum’ts
(
şp
, 
	`ÃËm
(
¬gs_x4
),‡rgs_x4);

228 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "");

229 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

230 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 2);

231 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

232 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 2);

233 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_BadO±iÚ
);

234 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "unrecognized option \342\200\230-b\342\200\231\n");

235 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_DÚe
);

238 
	`CÍ_S‘O±iÚCh¬
(
şp
, '-', 
CÍ_LÚg
 | 
CÍ_ShÜt
);

239 
	`CÍ_S‘Argum’ts
(
şp
, 
	`ÃËm
(
¬gs_x4
),‡rgs_x4);

240 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "");

241 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

242 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 2);

243 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

244 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

245 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_DÚe
);

248 
	`CÍ_S‘O±iÚCh¬
(
şp
, '-', 
CÍ_ShÜt
);

249 
	`CÍ_S‘O±iÚs
(
şp
, 
	`ÃËm
(
İtiÚs_x5
), options_x5);

250 
	`CÍ_S‘Argum’ts
(
şp
, 
	`ÃËm
(
¬gs_x5
),‡rgs_x5);

251 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "");

252 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

253 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v®
.
i
 == 1);

254 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

255 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v®
.
i
 == 2);

256 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_BadO±iÚ
);

257 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "unrecognized option \342\200\230--a3\342\200\231\n");

258 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

259 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v®
.
i
 == 4);

260 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

261 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v®
.
i
 == 5);

262 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_BadO±iÚ
);

263 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "\342\200\230-a\342\200\231ƒxpects‡n integer,‚ot \342\200\230x\342\200\231\n");

264 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 2);

265 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v®
.
i
 == 1);

266 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 2);

267 
	`CHECK
(!
şp
->
have_v®
);

268 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_NÙO±iÚ
);

269 
	`CHECK
(
	`SŒšg
(
şp
->
v¡r
) == "2");

270 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 2);

271 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v®
.
i
 == 3);

272 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 2);

273 
	`CHECK
(!
şp
->
have_v®
);

274 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_NÙO±iÚ
);

275 
	`CHECK
(
	`SŒšg
(
şp
->
v¡r
) == "4");

276 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_BadO±iÚ
);

277 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "unrecognized option \342\200\230--c\342\200\231\n");

278 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 3);

279 
	`CHECK
(
şp
->
Ãg©ed
);

280 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 3);

281 
	`CHECK
(
şp
->
Ãg©ed
);

282 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_DÚe
);

285 
	`CÍ_S‘O±iÚCh¬
(
şp
, '+', 
CÍ_LÚgNeg©ed
);

286 
	`CÍ_S‘O±iÚs
(
şp
, 
	`ÃËm
(
İtiÚs_x6
), options_x6);

287 
	`CÍ_S‘Argum’ts
(
şp
, 
	`ÃËm
(
¬gs_x6
),‡rgs_x6);

288 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "");

289 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

290 
	`CHECK
(!
şp
->
Ãg©ed
 && cÍ->
have_v®
 && cÍ->
v®
.
i
 == 1);

291 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

292 
	`CHECK
(
şp
->
Ãg©ed
 && !şp->
have_v®
);

293 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_BadO±iÚ
);

294 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "\342\200\230--no-art\342\200\231 can\342\200\231take‡n‡rgument\n");

295 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

296 
	`CHECK
(
şp
->
Ãg©ed
 && !şp->
have_v®
);

297 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

298 
	`CHECK
(
şp
->
Ãg©ed
 && !şp->
have_v®
);

299 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 2);

300 
	`CHECK
(!
şp
->
Ãg©ed
 && cÍ->
have_v®
 && cÍ->
v®
.
i
 == 2);

301 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_BadO±iÚ
);

302 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "unrecognized option \342\200\230+b\342\200\231\n");

303 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_BadO±iÚ
);

304 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "unrecognized option \342\200\230--no-b\342\200\231\n");

305 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_DÚe
);

308 
	`CÍ_S‘O±iÚs
(
şp
, 
	`ÃËm
(
İtiÚs_x7
), options_x7);

309 
	`CÍ_S‘Argum’ts
(
şp
, 
	`ÃËm
(
¬gs_x7
),‡rgs_x7);

310 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "");

311 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

312 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v¡r
 =ğ
	`SŒšg
("--ar"));

313 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

314 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v¡r
 =ğ
	`SŒšg
("ar"));

315 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_BadO±iÚ
);

316 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "\342\200\230-a\342\200\231„equires‡‚on-option‡rgument\n");

317 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 2);

318 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

319 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v¡r
 =ğ
	`SŒšg
("--ar"));

320 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

321 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v¡r
 =ğ
	`SŒšg
("ar"));

322 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_BadO±iÚ
);

323 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "\342\200\230--art\342\200\231„equires‡‚on-option‡rgument\n");

324 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 3);

325 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_DÚe
);

328 
	`CÍ_AddSŒšgLi¡Ty³
(
şp
, 
CÍ_V®Anim®
, 
CÍ_AÎowNumb”s
,

330 
	`CÍ_S‘O±iÚs
(
şp
, 
	`ÃËm
(
İtiÚs_x8
), options_x8);

331 
	`CÍ_S‘Argum’ts
(
şp
, 
	`ÃËm
(
¬gs_x8
),‡rgs_x8);

332 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "");

333 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

334 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v®
.
i
 == 1);

335 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

336 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v®
.
i
 == 2);

337 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

338 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v®
.
i
 == 3);

339 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

340 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v®
.
i
 == 3);

341 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_BadO±iÚ
);

342 
	`CHECK_STREQ
(
§
.
	`ke_¡ršg
(), "option \342\200\230--animal=c\342\200\231 is‡mbiguous\n(Possibilities‡re \342\200\230cat\342\200\231‡nd \342\200\230cattle\342\200\231.)\n");

343 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 1);

344 
	`CHECK
(
şp
->
have_v®
 && cÍ->
v®
.
i
 == 4);

345 
	`CHECK_INTEQ
(
	`CÍ_Next
(
şp
), 
CÍ_DÚe
);

347 
	`CÍ_D–‘eP¬£r
(
şp
);

348 ià(!
”rh
->
	`Ã¼Üs
()) {

349 
”rh
->
	`mes§ge
("Allests…ass!");

353 
	}
}

355 
	$EXPORT_ELEMENT
(
CLPTe¡
)

356 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

357 
CLICK_ENDDECLS


	@test/clptest.hh

2 #iâdeà
CLICK_CLPTEST_HH


3 
	#CLICK_CLPTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


23 şas 
	cCLPTe¡
 : 
public
 
EËm’t
 {…ublic:

25 
	$CLPTe¡
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "CLPTest"; }

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

31 
	}
};

33 
	gCLICK_ENDDECLS


	@test/comparepackets.cc

19 
	~<şick/cÚfig.h
>

20 
	~"com·»·ck‘s.hh
"

21 
	~<şick/¡¿ccum.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/¬gs.hh
>

24 
CLICK_DECLS


26 
	gCom·»Pack‘s
::
	$Com·»Pack‘s
()

27 : 
	$_ndiff
(0)

29 
_p
[0] = _p[1] = 0;

30 
_avaabË
[0] = _avaabË[1] = 
Œue
;

31 
	`mem£t
(
_diff_d‘as
, 0, (_diff_details));

32 
	}
}

35 
	gCom·»Pack‘s
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

37 
boŞ
 
	gtime¡amp
 = 
Œue
;

38 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad
("TIMESTAMP", 
time¡amp
).
com¶‘e
() < 0)

40 
	g_time¡amp
 = 
time¡amp
;

45 
	gCom·»Pack‘s
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

47 
_sigÇl
[0] = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0);

48 
_sigÇl
[1] = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 1);

50 
	}
}

53 
	gCom·»Pack‘s
::
	$ş—nup
(
CËªupSge
)

55 ià(
_p
[0])

56 
_p
[0]->
	`kl
();

57 ià(
_p
[1])

58 
_p
[1]->
	`kl
();

59 
	}
}

62 
	gCom·»Pack‘s
::
	$check
(
Pack‘
 *
p
, Pack‘ *
q
)

64 
boŞ
 
difã»Á
 = 
çl£
;

66 ià(
p
->
	`Ëngth
(è!ğ
q
->length())

67 
_diff_d‘as
[
D_LEN
]++, 
difã»Á
 = 
Œue
;

68 ià(
	`memcmp
(
p
->
	`d©a
(), 
q
->d©a(),…->
	`Ëngth
()) != 0)

69 
_diff_d‘as
[
D_DATA
]++, 
difã»Á
 = 
Œue
;

70 ià(
p
->
	`time¡amp_ªno
(è!ğ
q
->time¡amp_ªno(è&& 
_time¡amp
)

71 
_diff_d‘as
[
D_TIMESTAMP
]++, 
difã»Á
 = 
Œue
;

73 ià(
p
->
	`has_ÃtwÜk_h—d”
(è&& 
q
->has_network_header()) {

74 ià(
p
->
	`ÃtwÜk_h—d”_off£t
(è!ğ
q
->network_header_offset())

75 
_diff_d‘as
[
D_NETOFF
]++, 
difã»Á
 = 
Œue
;

76 ià(
p
->
	`ÃtwÜk_h—d”_Ëngth
(è!ğ
q
->network_header_length())

77 
_diff_d‘as
[
D_NETLEN
]++, 
difã»Á
 = 
Œue
;

78 } ià(
p
->
	`has_ÃtwÜk_h—d”
(è!ğ
q
->has_network_header())

79 
_diff_d‘as
[
D_NETHDR
]++, 
difã»Á
 = 
Œue
;

81 ià(
difã»Á
)

82 
_ndiff
++;

83 
	}
}

85 
Pack‘
 *

86 
	gCom·»Pack‘s
::
	$puÎ
(
pÜt
)

88 
	`as£¹
(
_avaabË
[0] || _available[1]);

89 
Pack‘
 *
»tv®
 = 0;

90 ià(
_p
[
pÜt
]) {

91 ià(
_avaabË
[
pÜt
])

94 
»tv®
 = 
_p
[
pÜt
];

95 
_avaabË
[
pÜt
] = 
Œue
;

98 
_p
[
pÜt
] = 
	`šput
ÕÜt).
	`puÎ
();

99 ià(!
_p
[
pÜt
]) {

101 ià(!
_sigÇl
[
pÜt
] && 
_p
[!pÜt] && 
_avaabË
[!port]) {

102 
_diff_d‘as
[
D_MORE_PACKETS_0
 + !
pÜt
]++, 
_ndiff
++;

103 
_avaabË
[!
pÜt
] = 
çl£
;

105 } ià(
_p
[!
pÜt
] && 
_avaabË
[!port]) {

106 
	`check
(
_p
[0], _p[1]);

107 ià(
»tv®
)

108 
_avaabË
[
pÜt
] = 
çl£
;

110 
»tv®
 = 
_p
[
pÜt
];

111 
_p
[
pÜt
] = 0;

113 
_avaabË
[!
pÜt
] = 
çl£
;

115  
»tv®
;

116 
	}
}

118 ’um { 
	mH_DIFFS
, 
	mH_DIFF_DETAILS
, 
	mH_ALL_SAME
 };

120 cÚ¡ * cÚ¡ 
	g»asÚ_‹xts
[] = {

127 
SŒšg


128 
	gCom·»Pack‘s
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

130 
Com·»Pack‘s
 *
ı
 = 
¡©ic_ÿ¡
<Com·»Pack‘ *>(
e
);

131 (
ušŒ_t
è
thunk
) {

132 
H_DIFFS
:

133  
	`SŒšg
(
ı
->
_ndiff
);

134 
H_DIFF_DETAILS
: {

135 
SŒšgAccum
 
§
;

136 
i
 = 0; i < 
D_LAST
; i++)

137 
§
 << 
ı
->
_diff_d‘as
[
i
] << '\t' << 
»asÚ_‹xts
[i] << '\n';

138  
§
.
	`ke_¡ršg
();

140 
H_ALL_SAME
:

141  
BoŞArg
::
	`uÅ¬£
(
ı
->
_ndiff
 == 0);

145 
	}
}

148 
	gCom·»Pack‘s
::
	$add_hªdËrs
()

150 
	`add_»ad_hªdËr
("diffs", 
»ad_hªdËr
, 
H_DIFFS
);

151 
	`add_»ad_hªdËr
("diff_d‘as", 
»ad_hªdËr
, 
H_DIFF_DETAILS
);

152 
	`add_»ad_hªdËr
("®l_§me", 
»ad_hªdËr
, 
H_ALL_SAME
);

153 
	}
}

155 
CLICK_ENDDECLS


156 
EXPORT_ELEMENT
(
Com·»Pack‘s
)

	@test/comparepackets.hh

2 #iâdeà
CLICK_COMPAREPACKETS_HH


3 
	#CLICK_COMPAREPACKETS_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/nÙif›r.hh
>

6 
CLICK_DECLS


51 şas 
	cCom·»Pack‘s
 : 
public
 
EËm’t
 {…ublic:

53 
	$Com·»Pack‘s
(è
CLICK_COLD
;

55 cÚ¡ *
	$şass_Çme
() const {  "ComparePackets"; }

56 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/2"; 
	}
}

57 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

58 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

59 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

60 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

61 
	$add_hªdËrs
(è
CLICK_COLD
;

63 
Pack‘
 *
	`puÎ
();

65 
´iv©e
:

67 
Pack‘
 *
_p
[2];

68 
boŞ
 
_avaabË
[2];

69 
NÙif›rSigÇl
 
_sigÇl
[2];

71 
boŞ
 
_time¡amp
 : 1;

73 
ušt32_t
 
_ndiff
;

74 ’um { 
D_LEN
, 
D_DATA
, 
D_TIMESTAMP
, 
D_NETOFF
, 
D_NETLEN
, 
D_NETHDR
,

75 
D_MORE_PACKETS_0
, 
D_MORE_PACKETS_1
, 
D_LAST
 
	}
};

76 
ušt32_t
 
	g_diff_d‘as
[
D_LAST
];

78 
check
(
Pack‘
 *, Packet *);

79 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

81 
	}
};

83 
	gCLICK_ENDDECLS


	@test/confparsetest.cc

20 
	~<şick/cÚfig.h
>

21 
	~"cÚå¬£‹¡.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 #ià
HAVE_IP6


26 
	~<şick/6add»ss.hh
>

28 #ià
CLICK_USERLEVEL


29 
	~<şick/u£ruts.hh
>

31 
CLICK_DECLS


33 
	gÇme¥aû
 {

34 şas 
	cRecÜdE¼ÜHªdËr
 : 
public
 
E¼ÜHªdËr
 {…ublic:

35 
RecÜdE¼ÜHªdËr
() {

37 *
em™
(cÚ¡ 
SŒšg
 &
¡r
, *, 
boŞ
) {

38 
	g_§
.
­³nd
(
sk_ªno
(
¡r
.
begš
(), sŒ.
’d
()), str.end());

41 
SŒšg
 
ke_¡ršg
() {

42  
	g_§
.
ke_¡ršg
();

44 
SŒšgAccum
 
	g_§
;

48 
	gCÚfP¬£Te¡
::
	$CÚfP¬£Te¡
()

50 
	}
}

52 
	#CHECK
(
x
) do { \

53 ià(!(
x
)) \

54  
”rh
->
	`”rÜ
("%s:%d:e¡ %<%s%> faed", 
__FILE__
, 
__LINE__
, #x); \

55 } 0)

	)

56 
	#CHECK_ERR
(
x
, 
”r¡r
) do { \

57 ià(!(
x
)) \

58  
”rh
->
	`”rÜ
("%s:%d:e¡ %<%s%> faed", 
__FILE__
, 
__LINE__
, #x); \

59 
SŒšg
 
	`msg
(
»¼h
.
	`ke_¡ršg
()); \

60 ià(!
msg
.
	`equ®s
(
”r¡r
, -1)) \

61  
”rh
->
	`”rÜ
("%s:%d:e¡ %<%s%>…roduû uÃx³ùedƒ¼Ü mes§g%<%s%>", 
__FILE__
, 
__LINE__
, #x, 
msg
.
	`c_¡r
()); \

62 } 0)

	)

65 
	gCÚfP¬£Te¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

67 
	`CHECK
(
	`ı_uncomm’t
("‡ b ") == "a b");

68 
	`CHECK
(
	`ı_uncomm’t
("‡ /* whatever */ // whatever\n b ") == "a b");

69 
	`CHECK
(
	`ı_uncomm’t
(" \" /*??? */ \" ") == "\" /*??? */ \"");

70 
	`CHECK
(
	`ı_unquÙe
("\"\\n\"‡bc /* 123 */ '/* def */'") == "\n‡bc /* def */");

72 
VeùÜ
<
SŒšg
> 
v
;

73 
	`ı_¬gvec
("a, b, c", 
v
);

74 
	`CHECK
(
v
.
	`size
() == 3);

75 
	`CHECK
(
v
[0] == "a");

76 
	`CHECK
(
v
[1] == "b");

77 
	`CHECK
(
v
[2] == "c");

78 
	`ı_¬gvec
("‡ /*?*/ b, c, ", 
v
);

79 
	`CHECK
(
v
.
	`size
() == 5);

80 
	`CHECK
(
v
[3] == "a b");

81 
	`CHECK
(
v
[4] == "c");

82 
	`ı_¬gvec
("\"x, y\" // ?", 
v
);

83 
	`CHECK
(
v
.
	`size
() == 6);

84 
	`CHECK
(
v
[5] == "\"x, y\"");

85 
	`ı_¥aûvec
("¨ b, c", 
v
);

86 
	`CHECK
(
v
.
	`size
() == 9);

87 
	`CHECK
(
v
[6] == "a");

88 
	`CHECK
(
v
[7] == "b,");

89 
	`CHECK
(
v
[8] == "c");

90 
	`ı_¥aûvec
(" '¨/*?*/ b'c", 
v
);

91 
	`CHECK
(
v
.
	`size
() == 10);

92 
	`CHECK
(
v
[9] == "'a /*?*/ b'c");

95 
št32_t
 
i32
;

96 
ušt32_t
 
u32
;

97 
u32
 = 97;

98 
	`CHECK
(
	`ı_š‹g”
("0", &
i32
è=ğ
Œue
 && i32 == 0);

99 
	`CHECK
(
	`ı_š‹g”
("-0", &
i32
è=ğ
Œue
 && i32 == 0);

100 
	`CHECK
(
u32
 == 97);

101 
	`CHECK
(
	`ı_š‹g”
("0", &
u32
è=ğ
Œue
 && u32 == 0);

102 
	`CHECK
(
	`ı_š‹g”
("-0", &
u32
è=ğ
çl£
);

103 
	`CHECK
(
	`ı_š‹g”
("4294967294", &
u32
è=ğ
Œue
 && u32 == 4294967294U);

104 
	`CHECK
(
	`ı_š‹g”
("0xFFFFFFFE", &
u32
è=ğ
Œue
 && u32 == 4294967294U);

105 
	`CHECK
(
	`ı_š‹g”
("4294967296", &
u32
è=ğ
Œue
 && u32 =ğ4294967295U && 
ı_”ºo
 =ğ
CPE_OVERFLOW
);

106 
	`CHECK
(
	`ı_š‹g”
("42949672961939", &
u32
è=ğ
Œue
 && u32 =ğ4294967295U && 
ı_”ºo
 =ğ
CPE_OVERFLOW
);

107 
	`CHECK
(
	`ı_š‹g”
("0xFFFFFFFFF", &
u32
è=ğ
Œue
 && u32 =ğ4294967295U && 
ı_”ºo
 =ğ
CPE_OVERFLOW
);

108 
	`CHECK
(
	`ı_š‹g”
("4294967296", &
i32
è=ğ
Œue
 && i32 =ğ2147483647 && 
ı_”ºo
 =ğ
CPE_OVERFLOW
);

109 
	`CHECK
(
	`ı_š‹g”
("2147483647", &
i32
è=ğ
Œue
 && i32 =ğ2147483647 && 
ı_”ºo
 =ğ
CPE_OK
);

110 
	`CHECK
(
	`ı_š‹g”
("2147483648", &
i32
è=ğ
Œue
 && i32 =ğ2147483647 && 
ı_”ºo
 =ğ
CPE_OVERFLOW
);

111 
	`CHECK
(
	`ı_š‹g”
("-2147483648", &
i32
è=ğ
Œue
 && i32 =ğ-2147483647 - 1 && 
ı_”ºo
 =ğ
CPE_OK
);

112 
	`CHECK
(
	`ı_š‹g”
("-4294967296", &
i32
è=ğ
Œue
 && i32 =ğ-2147483647 - 1 && 
ı_”ºo
 =ğ
CPE_OVERFLOW
);

113 cÚ¡ *
s
 = "-127 ";

114 
	`CHECK
(
	`ı_š‹g”
(
s
, s + 
	`¡¾’
(sè- 1, 10, &
i32
) == s + 4 && i32 == -127);

115 
	`CHECK
(
	`ı_š‹g”
(
	`SŒšg
(
s
), &
i32
è=ğ
çl£
 && 
ı_”ºo
 =ğ
CPE_FORMAT
);

116 #ià
HAVE_LONG_LONG
 && 
SIZEOF_LONG_LONG
 == 8

118 
Î
;

119 
uÎ
;

120 
	`CHECK
(
	`ı_š‹g”
("9223372036854775807", &
Î
è=ğ
Œue
 &&†l == 0x7FFFFFFFFFFFFFFFULL);

121 
	`CHECK
(
	`ı_š‹g”
("-9223372036854775808", &
Î
è=ğ
Œue
 &&†l == () 0x8000000000000000ULL);

122 
	`CHECK
(
	`ı_š‹g”
("18446744073709551616", &
uÎ
è=ğ
Œue
 && uÎ =ğ0xFFFFFFFFFFFFFFFFULL && 
ı_”ºo
 =ğ
CPE_OVERFLOW
);

127 
RecÜdE¼ÜHªdËr
 
»¼h
;

128 
Args
 
	`¬gs
(0, &
»¼h
);

129 
u32
 = 97;

130 
IÁArg
 
Ÿ
;

131 
	`CHECK
(
	`IÁArg
().
	`·r£
("0", 
i32
è=ğ
Œue
 && i32 == 0);

132 
	`CHECK
(
	`IÁArg
().
	`·r£
("-0", 
i32
è=ğ
Œue
 && i32 == 0);

133 
	`CHECK
(
	`IÁArg
().
	`·r£
("-5", 
i32
è=ğ
Œue
 && i32 == -5);

134 
	`CHECK
(
u32
 == 97);

135 
	`CHECK_ERR
(
	`IÁArg
().
	`·r£
("aÛu", 
u32
, 
¬gs
è=ğ
çl£
 && u32 == 97, "invalid‚umber");

136 
	`CHECK
(
	`IÁArg
().
	`·r£
("0", 
u32
è=ğ
Œue
 && u32 == 0);

137 
	`CHECK
(
	`IÁArg
().
	`·r£
("-0", 
u32
è=ğ
çl£
);

138 
	`CHECK
(
	`IÁArg
().
	`·r£
("4294967294", 
u32
è=ğ
Œue
 && u32 == 4294967294U);

139 
	`CHECK
(
	`IÁArg
().
	`·r£
("0xFFFFFFFE", 
u32
è=ğ
Œue
 && u32 == 4294967294U);

140 
	`CHECK_ERR
(
Ÿ
.
	`·r£
("4294967296", 
u32
, 
¬gs
è=ğ
çl£
 && u32 == 4294967294U, "out of„ange, bound 4294967295");

141 
	`CHECK
(
	`IÁArg
().
	`·r£_§tu¿tšg
("4294967296", 
u32
è=ğ
Œue
 && u32 == 4294967295U);

142 
u32
 = 97;

143 
	`CHECK_ERR
(
Ÿ
.
	`·r£
("42949672961939", 
u32
, 
¬gs
è=ğ
çl£
 && u32 == 97, "out of„ange, bound 4294967295");

144 
	`CHECK_ERR
(
Ÿ
.
	`·r£_§tu¿tšg
("42949672961939", 
u32
, 
¬gs
è=ğ
Œue
 && u32 == 4294967295U, "");

145 
	`CHECK
(
	`IÁArg
().
	`·r£
("0xFFFFFFFFF", 
u32
è=ğ
çl£
);

146 
	`CHECK
(
	`IÁArg
().
	`·r£_§tu¿tšg
("0xFFFFFFFFF", 
u32
è=ğ
Œue
 && u32 == 0xFFFFFFFFU);

147 
	`CHECK_ERR
(
Ÿ
.
	`·r£
("4294967296", 
i32
, 
¬gs
è=ğ
çl£
, "out of„ange, bound 2147483647");

148 
	`CHECK_ERR
(
Ÿ
.
	`·r£_§tu¿tšg
("4294967296", 
i32
, 
¬gs
è=ğ
Œue
 && i32 == 2147483647, "");

149 
	`CHECK_ERR
(
Ÿ
.
	`·r£
("2147483647", 
i32
, 
¬gs
è=ğ
Œue
 && i32 == 2147483647, "");

150 
	`CHECK_ERR
(
Ÿ
.
	`·r£
("2147483648", 
i32
, 
¬gs
è=ğ
çl£
 && i32 == 2147483647, "out of„ange, bound 2147483647");

151 
	`CHECK_ERR
(
Ÿ
.
	`·r£_§tu¿tšg
("2147483648", 
i32
, 
¬gs
è=ğ
Œue
 && i32 == 2147483647, "");

152 
	`CHECK_ERR
(
Ÿ
.
	`·r£
("-2147483648", 
i32
, 
¬gs
è=ğ
Œue
 && i32 == -2147483647 - 1, "");

153 
	`CHECK_ERR
(
Ÿ
.
	`·r£
("-2147483649", 
i32
, 
¬gs
è=ğ
çl£
 && i32 == -2147483647 - 1, "out of„ange, bound -2147483648");

154 
i32
 = 0;

155 
	`CHECK_ERR
(
Ÿ
.
	`·r£_§tu¿tšg
("-2147483649", 
i32
, 
¬gs
è=ğ
Œue
 && i32 == -2147483647 - 1, "");

156 
	`CHECK_ERR
(
Ÿ
.
	`·r£
("-4294967296", 
i32
, 
¬gs
è=ğ
çl£
 && i32 == -2147483647 - 1, "out of„ange, bound -2147483648");

157 
št8_t
 
i8
 = 0;

158 
	`CHECK_ERR
(
Ÿ
.
	`·r£
("97", 
i8
, 
¬gs
è=ğ
Œue
 && i8 == 97, "");

159 
	`CHECK_ERR
(
Ÿ
.
	`·r£
("128", 
i8
, 
¬gs
è=ğ
çl£
 && i8 == 97, "out of„ange, bound 127");

160 
	`CHECK_ERR
(
Ÿ
.
	`·r£_§tu¿tšg
("128", 
i8
, 
¬gs
è=ğ
Œue
 && i8 == 127, "");

161 #ià
HAVE_INT64_TYPES


162 
št64_t
 
i64
;

163 
ušt64_t
 
u64
 = 0;

164 
	`CHECK_ERR
(
Ÿ
.
	`·r£
("9223372036854775807", 
i64
, 
¬gs
è=ğ
Œue
 && i64 =ğ
	`št64_t
(0x7FFFFFFFFFFFFFFFULL), "");

165 
	`CHECK_ERR
(
Ÿ
.
	`·r£
("-9223372036854775808", 
i64
, 
¬gs
è=ğ
Œue
 && i64 =ğ
	`št64_t
(0x8000000000000000ULL), "");

166 
	`CHECK_ERR
(
Ÿ
.
	`·r£
("-5", 
i64
, 
¬gs
è=ğ
Œue
 && i64 == -5, "");

167 
	`CHECK_ERR
(
Ÿ
.
	`·r£
("18446744073709551616", 
u64
, 
¬gs
è=ğ
çl£
 && u64 == 0, "out of„ange, bound 18446744073709551615");

168 
	`CHECK_ERR
(
Ÿ
.
	`·r£_§tu¿tšg
("18446744073709551616", 
u64
, 
¬gs
è=ğ
Œue
 && u64 == 0xFFFFFFFFFFFFFFFFULL, "");

171 
	`CHECK_ERR
(
	`BoundedIÁArg
(0, 10).
	`·r£
("10", 
i32
, 
¬gs
è=ğ
Œue
 && i32 == 10, "");

172 
	`CHECK_ERR
(
	`BoundedIÁArg
(0, 9).
	`·r£
("10", 
i32
, 
¬gs
è=ğ
çl£
 && i32 == 10, "out of„ange, bound 9");

173 
	`CHECK_ERR
(
	`BoundedIÁArg
(-1, 9).
	`·r£
("-10", 
i32
, 
¬gs
è=ğ
çl£
 && i32 == 10, "out of„ange, bound -1");

174 
	`CHECK_ERR
(
	`BoundedIÁArg
(-1000, -90).
	`·r£
("0xFFFFFF00", 
u32
, 
¬gs
è=ğ
çl£
 && 
i32
 == 10, "out of„ange, bound -90");

175 
	`CHECK_ERR
(
	`BoundedIÁArg
(0U, 100U).
	`·r£
("-1", 
i32
, 
¬gs
è=ğ
çl£
 && i32 == 10, "out of„ange, bound 0");

176 
	`CHECK_ERR
(
	`BoundedIÁArg
(0U, 100U).
	`·r£
("-1", 
i32
, 
¬gs
è=ğ
çl£
 && i32 == 10, "out of„ange, bound 0");

177 
	`CHECK_ERR
(
	`BoundedIÁArg
(0U, ~0U).
	`·r£
("-1", 
i32
, 
¬gs
è=ğ
çl£
 && i32 == 10, "out of„ange, bound 0");

178 
	`CHECK_ERR
(
	`BoundedIÁArg
(-1, 9).
	`·r£
("aÛu", 
i32
, 
¬gs
è=ğ
çl£
 && i32 == 10, "invalid‚umber");

180 
boŞ
 
b
; () b;

181 
	`CHECK
(
	`FixedPoštArg
(1).
	`·r£
("0.5", 
i32
è=ğ
Œue
 && i32 == 1);

182 
	`CHECK
(
	`FixedPoštArg
(1).
	`·r£
("-0.5", 
i32
è=ğ
Œue
 && i32 == -1);

183 
	#CHECK_FIXEDPOINT
(
s
, 
äac_b™s
, 
»suÉ
è{ 
SŒšg
 
q
 = (#s); 
ušt32_t
 
r
; \

184 ià(!
	`FixedPoštArg
((
äac_b™s
)).
	`·r£
(
q
, 
r
)) \

185  
”rh
->
	`”rÜ
("%s:%d: %<%s%> uÅ¬£abË", 
__FILE__
, 
__LINE__
, 
q
.
	`c_¡r
()); \

186 
SŒšg
 
qq
 = 
	`ı_uÅ¬£_»®2
(
r
, (
äac_b™s
)); \

187 ià(
qq
 !ğ(
»suÉ
)) \

188  
”rh
->
	`”rÜ
("%s:%d: %<%s%>…¬£d‡nd uÅ¬£d i %<%s%>, should b%<%s%>", 
__FILE__
, 
__LINE__
, 
q
.
	`c_¡r
(), 
qq
.c_¡r(), 
»suÉ
); \

189 }

	)

190 
	`CHECK_FIXEDPOINT
(0.418, 8, "0.418");

191 
	`CHECK_FIXEDPOINT
(0.417, 8, "0.418");

192 
	`CHECK_FIXEDPOINT
(0.416, 8, "0.414");

193 
	`CHECK_FIXEDPOINT
(0.42, 8, "0.42");

194 
	`CHECK_FIXEDPOINT
(0.3, 16, "0.3");

195 
	`CHECK_FIXEDPOINT
(0.49, 16, "0.49");

196 
	`CHECK_FIXEDPOINT
(0.499, 16, "0.499");

197 
	`CHECK_FIXEDPOINT
(0.4999, 16, "0.4999");

198 
	`CHECK_FIXEDPOINT
(0.49999, 16, "0.49998");

199 
	`CHECK_FIXEDPOINT
(0.499999, 16, "0.5");

200 
	`CHECK_FIXEDPOINT
(0.49998, 16, "0.49998");

201 
	`CHECK_FIXEDPOINT
(0.999999, 16, "1");

202 #undeà
CHECK_FIXEDPOINT


204 
	`CHECK
(
	`ı_»®2
("-0.5", 1, &
i32
è=ğ
Œue
 && i32 == -1);

205 
	`CHECK
(
	`SecÚdsArg
().
	`·r£
("3600", 
u32
è=ğ
Œue
 && u32 == 3600);

206 
	`CHECK
(
	`ı_£cÚds_as
("3600", 0, &
u32
è=ğ
Œue
 && u32 == 3600);

207 
	`CHECK
(
	`SecÚdsArg
().
	`·r£
("3600s", 
u32
è=ğ
Œue
 && u32 == 3600);

208 
	`CHECK
(
	`SecÚdsArg
().
	`·r£
("3.6e6 m£c", 
u32
è=ğ
Œue
 && u32 == 3600);

209 
	`CHECK
(
	`SecÚdsArg
().
	`·r£
("60m", 
u32
è=ğ
Œue
 && u32 == 3600);

210 
	`CHECK
(
	`SecÚdsArg
().
	`·r£
("1 hr", 
u32
è=ğ
Œue
 && u32 == 3600);

211 
	`CHECK
(
	`SecÚdsArg
().
	`·r£
("1.99 hr", 
u32
è=ğ
Œue
 && u32 == 7164);

212 
	`CHECK
(
	`SecÚdsArg
().
	`·r£
("1.99 s", 
u32
è=ğ
Œue
 && u32 == 2);

213 
	`CHECK
(
	`SecÚdsArg
(1).
	`·r£
("1.99 s", 
u32
è=ğ
Œue
 && u32 == 20);

214 
	`CHECK
(
	`SecÚdsArg
(2).
	`·r£
("1.99 s", 
u32
è=ğ
Œue
 && u32 == 199);

215 
	`CHECK
(
	`SecÚdsArg
().
	`·r£
("1ms", 
u32
è=ğ
Œue
 && u32 == 0);

216 
	`CHECK
(
	`SecÚdsArg
(3).
	`·r£
("1ms", 
u32
è=ğ
Œue
 && u32 == 1);

217 
	`CHECK
(
	`SecÚdsArg
(3).
	`·r£
("1.9ms", 
u32
è=ğ
Œue
 && u32 == 2);

218 
	`CHECK
(
	`SecÚdsArg
(6).
	`·r£
("1ms", 
u32
è=ğ
Œue
 && u32 == 1000);

219 
	`CHECK
(
	`SecÚdsArg
(6).
	`·r£
("1.9ms", 
u32
è=ğ
Œue
 && u32 == 1900);

221 #ià
HAVE_FLOAT_TYPES


222 
d
;

223 
	`CHECK
(
	`SecÚdsArg
().
	`·r£
("3600", 
d
è=ğ
Œue
 && d == 3600);

224 
	`CHECK
(
	`SecÚdsArg
().
	`·r£
("3600s", 
d
è=ğ
Œue
 && d == 3600);

225 
	`CHECK
(
	`SecÚdsArg
().
	`·r£
("3.6e6 m£c", 
d
è=ğ
Œue
 && d == 3600);

226 
	`CHECK
(
	`SecÚdsArg
().
	`·r£
("60m", 
d
è=ğ
Œue
 && d == 3600);

227 
	`CHECK
(
	`SecÚdsArg
().
	`·r£
("1 hr", 
d
è=ğ
Œue
 && d == 3600);

230 
BªdwidthArg
 
bw¬g
;

231 
	`CHECK
(
bw¬g
.
	`·r£
("8", 
u32
è=ğ
Œue
 && bw¬g.
¡©us
 =ğ
NumArg
::
¡©us_un™Ëss
 && u32 == 8);

232 
	`CHECK
(
bw¬g
.
	`·r£
("8 baud", 
u32
è=ğ
Œue
 && bw¬g.
¡©us
 =ğ
NumArg
::
¡©us_ok
 && u32 == 1);

233 
	`CHECK
(
bw¬g
.
	`·r£
("8Kbps", 
u32
è=ğ
Œue
 && bw¬g.
¡©us
 =ğ
NumArg
::
¡©us_ok
 && u32 == 1000);

234 
	`CHECK
(
bw¬g
.
	`·r£
("8KBps", 
u32
è=ğ
Œue
 && bw¬g.
¡©us
 =ğ
NumArg
::
¡©us_ok
 && u32 == 8000);

237 
IPAdd»ss
 
a
, 
m
;

238 
	`CHECK
(
	`IPP»fixArg
().
	`·r£
("18.26.4/24", 
a
, 
m
, 
this
è=ğ
Œue


239 && 
a
.
	`uÅ¬£_w™h_mask
(
m
) == "18.26.4.0/24");

240 
	`CHECK
(
	`IPP»fixArg
().
	`·r£
("18.26.4/28", 
a
, 
m
, 
this
è=ğ
çl£
);

243 #ià
HAVE_IP6


245 
IP6Add»ss
 
a
;

246 
	`CHECK
(
	`ı_6_add»ss
("1080:0:0:0:8:800:200C:417a", &
a
, 
this
è=ğ
Œue
);

247 
	`CHECK
(
a
.
	`d©a32
()[0] =ğ
	`Áohl
(0x10800000)

248 && 
a
.
	`d©a32
()[1] =ğ
	`Áohl
(0x00000000)

249 && 
a
.
	`d©a32
()[2] =ğ
	`Áohl
(0x00080800)

250 && 
a
.
	`d©a32
()[3] =ğ
	`Áohl
(0x200C417a));

251 
	`CHECK
(
	`ı_6_add»ss
("1080::8:800:200C:417a", &
a
, 
this
è=ğ
Œue


252 && 
a
.
	`d©a32
()[0] =ğ
	`Áohl
(0x10800000)

253 && 
a
.
	`d©a32
()[1] =ğ
	`Áohl
(0x00000000)

254 && 
a
.
	`d©a32
()[2] =ğ
	`Áohl
(0x00080800)

255 && 
a
.
	`d©a32
()[3] =ğ
	`Áohl
(0x200C417a));

256 
	`CHECK
(
	`ı_6_add»ss
("::13.1.68.3", &
a
, 
this
è=ğ
Œue


257 && 
a
.
	`d©a32
()[0] == 0x00000000

258 && 
a
.
	`d©a32
()[1] == 0x00000000

259 && 
a
.
	`d©a32
()[2] == 0x00000000

260 && 
a
.
	`d©a32
()[3] =ğ
	`Áohl
(0x0D014403));

261 
	`CHECK
(
	`ı_6_add»ss
("::ffff:129.144.52.38", &
a
, 
this
è=ğ
Œue


262 && 
a
.
	`d©a32
()[0] == 0x00000000

263 && 
a
.
	`d©a32
()[1] == 0x00000000

264 && 
a
.
	`d©a32
()[2] =ğ
	`Áohl
(0x0000FFFF)

265 && 
a
.
	`d©a32
()[3] =ğ
	`Áohl
(0x81903426));

266 
IPAdd»ss
 
a4
;

267 ià(
	`IPAdd»ssArg
().
	`·r£
("4_addr", 
a4
, 
this
è=ğ
Œue
)

268 
	`CHECK
(
	`ı_6_add»ss
("0::4_addr", &
a
, 
this
è=ğ
Œue


269 && 
a
.
	`d©a32
()[0] == 0x00000000 &&‡.data32()[1] == 0x00000000

270 && 
a
.
	`d©a32
()[2] == 0x00000000

271 && 
a
.
	`d©a32
()[3] =ğ
a4
.
	`addr
());

272 ià(
	`IPAdd»ssArg
().
	`·r£
("4_addr", 
a4
, 
this
è=ğ
Œue
)

273 
	`CHECK
(
	`ı_6_add»ss
("0::ffff:4_addr", &
a
, 
this
è=ğ
Œue


274 && 
a
.
	`d©a32
()[0] == 0x00000000 &&‡.data32()[1] == 0x00000000

275 && 
a
.
	`d©a32
()[2] =ğ
	`htÚl
(0x0000FFFFU)

276 && 
a
.
	`d©a32
()[3] =ğ
a4
.
	`addr
());

277 
IPAdd»ss
 
	`b4
("18.26.4.9");

278 
	`CHECK
(
	`IP6Add»ss
(
b4
).
	`is_4_m­³d
());

279 
	`CHECK
(
	`IP6Add»ss
(
b4
).
	`4_add»ss
() == b4);

280 
a
 = 
	`IP6Add»ss
("::ffff:18.26.4.9");

281 
	`CHECK
(
a
.
	`is_4_m­³d
());

282 
	`CHECK
(
a
.
	`4_add»ss
(è=ğ
b4
);

283 
	`CHECK
(
	`ı_6_add»ss
("ffff:ffff:ffff:ffff:ffff:ffff::", &
a
, 
this
è=ğ
Œue


284 && 
a
.
	`d©a32
()[0] == 0xFFFFFFFF

285 && 
a
.
	`d©a32
()[1] == 0xFFFFFFFF

286 && 
a
.
	`d©a32
()[2] == 0xFFFFFFFF

287 && 
a
.
	`d©a32
()[3] == 0);

288 
	`CHECK
(
a
.
	`mask_to_´efix_Ën
() == 96);

289 
	`CHECK
(
	`ı_6_add»ss
("ffff:ffff:ffff:ffff:ffff:ffff:8000:0", &
a
, 
this
è=ğ
Œue


290 && 
a
.
	`d©a32
()[0] == 0xFFFFFFFF

291 && 
a
.
	`d©a32
()[1] == 0xFFFFFFFF

292 && 
a
.
	`d©a32
()[2] == 0xFFFFFFFF

293 && 
a
.
	`d©a32
()[3] =ğ
	`htÚl
(0x80000000));

294 
	`CHECK
(
a
.
	`mask_to_´efix_Ën
() == 97);

295 
	`CHECK
(
	`ı_6_add»ss
("ffff:ffff:ffff:ffff:ffff:ffff:8000:", &
a
, 
this
è=ğ
çl£
);

296 
	`CHECK
(
	`ı_6_add»ss
("ffff:ffff:ffff:ffff:ffff:ffff:ffff:ffff", &
a
, 
this
è=ğ
Œue


297 && 
a
.
	`d©a32
()[0] == 0xFFFFFFFF

298 && 
a
.
	`d©a32
()[1] == 0xFFFFFFFF

299 && 
a
.
	`d©a32
()[2] == 0xFFFFFFFF

300 && 
a
.
	`d©a32
()[3] == 0xFFFFFFFF);

301 
	`CHECK
(
a
.
	`mask_to_´efix_Ën
() == 128);

302 
	`CHECK
(
	`ı_6_add»ss
("::", &
a
, 
this
è=ğ
Œue


303 && 
a
.
	`d©a32
()[0] == 0

304 && 
a
.
	`d©a32
()[1] == 0

305 && 
a
.
	`d©a32
()[2] == 0

306 && 
a
.
	`d©a32
()[3] == 0);

307 
	`CHECK
(
a
.
	`mask_to_´efix_Ën
() == 0);

308 
	`CHECK
(
	`ı_6_add»ss
(":::", &
a
, 
this
è=ğ
çl£
);

309 
	`CHECK
(
	`ı_6_add»ss
("8000::1:1:1:1:1:1:1", &
a
, 
this
è=ğ
çl£
);

310 
	`CHECK
(
	`ı_6_add»ss
("8000::", &
a
, 
this
è=ğ
Œue


311 && 
a
.
	`d©a32
()[0] =ğ
	`htÚl
(0x80000000)

312 && 
a
.
	`d©a32
()[1] == 0

313 && 
a
.
	`d©a32
()[2] == 0

314 && 
a
.
	`d©a32
()[3] == 0);

315 
	`CHECK
(
	`ı_6_add»ss
("::8000", &
a
, 
this
è=ğ
Œue


316 && 
a
.
	`d©a32
()[0] == 0

317 && 
a
.
	`d©a32
()[1] == 0

318 && 
a
.
	`d©a32
()[2] == 0

319 && 
a
.
	`d©a32
()[3] =ğ
	`htÚl
(0x00008000));

320 
	`CHECK
(
a
.
	`mask_to_´efix_Ën
() == -1);

321 
a
 = 
IP6Add»ss
::
	`make_šv”‹d_´efix
(17);

322 
	`CHECK
(
a
.
	`d©a32
()[0] =ğ
	`htÚl
(0x00007FFF)

323 && 
a
.
	`d©a32
()[1] == 0xFFFFFFFF

324 && 
a
.
	`d©a32
()[2] == 0xFFFFFFFF

325 && 
a
.
	`d©a32
()[3] == 0xFFFFFFFF);

326 
a
 = 
IP6Add»ss
::
	`make_šv”‹d_´efix
(128);

327 
	`CHECK
(
a
.
	`d©a32
()[0] == 0

328 && 
a
.
	`d©a32
()[1] == 0

329 && 
a
.
	`d©a32
()[2] == 0

330 && 
a
.
	`d©a32
()[3] == 0);

334 
Time¡amp
 
t
 = 
	`Time¡amp
(0, 0è- Time¡amp::
	`make_m£c
(1001);

335 
	`CHECK
(
t
.
	`£c
(è=ğ-2 &&.
	`u£c
() == 999000);

336 
	`CHECK
(
t
.
	`uÅ¬£
() == "-1.001000");

337 #ià
CLICK_HZ
 == 1000

338 
	`CHECK
(
t
 =ğ
Time¡amp
::
	`make_jiff›s
((
şick_jiff›s_difã»nû_t
) -1001));

339 
	`CHECK
(
t
 < 
Time¡amp
::
	`make_jiff›s
((
şick_jiff›s_t
) -1001));

340 
	`CHECK
(-
t
 =ğ
Time¡amp
::
	`make_jiff›s
((
şick_jiff›s_t
) 1001));

341 
	`CHECK
(-
t
 =ğ
Time¡amp
::
	`make_jiff›s
((
şick_jiff›s_difã»nû_t
) 1001));

343 
Time¡amp
 
t2
 = 
	`Time¡amp
(-10, 0);

344 
	`CHECK
(
t2
.
	`£c
(è=ğ-10 &&2.
	`sub£c
() == 0);

345 
	`CHECK
(
t2
.
	`uÅ¬£
() == "-10.000000");

346 
	`CHECK
(
t2
 < 
t
);

347 
	`CHECK
((-
t2
).
	`uÅ¬£
() == "10.000000");

348 
	`CHECK
((-
t
).
	`uÅ¬£
() == "1.001000");

349 
	`CHECK
(-
t2
 > 
t
);

350 
	`CHECK
((-
t
 + 
t2
).
	`uÅ¬£
() == "-8.999000");

351 
t
 = 
Time¡amp
::
	`make_m£c
(999);

352 
	`CHECK
((
t
 +).
	`uÅ¬£
() == "1.998000");

353 
	`CHECK
((-
t
 -).
	`uÅ¬£
() == "-1.998000");

354 
	`CHECK
(-
t
 =ğ
Time¡amp
::
	`make_m£c
(-999));

355 
	`CHECK
(
t
 =ğ
Time¡amp
::
	`make_u£c
(999000));

356 
	`CHECK
(-
t
 =ğ
Time¡amp
::
	`make_u£c
(-999000));

357 
	`CHECK
(
t
 =ğ
Time¡amp
::
	`make_n£c
(999000000));

358 
	`CHECK
(-
t
 =ğ
Time¡amp
::
	`make_n£c
(-999000000));

359 
	`CHECK
(
t
.
	`m£cv®
() == 999);

360 
	`CHECK
(
t
.
	`u£cv®
() == 999000);

361 
	`CHECK
(
t
.
	`n£cv®
() == 999000000);

362 
	`CHECK
((-
t
).
	`m£cv®
() == -999);

363 
	`CHECK
((-
t
).
	`u£cv®
() == -999000);

364 
	`CHECK
((-
t
).
	`n£cv®
() == -999000000);

365 
t
 = 
	`Time¡amp
(0, 0è- 
Time¡amp
::
	`make_m£c
(10000001);

366 
	`CHECK
(
t
.
	`£c
(è=ğ-10001 &&.
	`u£c
() == 999000);

367 
	`CHECK
(
t
.
	`sub£c
(è=ğ999 * 
Time¡amp
::
sub£c_³r_m£c
);

369 
	`CHECK
(
	`Time¡amp
(
Time¡amp
::
	`make_n£c
(0, 999).
	`timev®
()è=ğTime¡amp::
	`make_u£c
(0, 0));

370 #ià
TIMESTAMP_NANOSEC


371 
	`CHECK
(
	`Time¡amp
(
Time¡amp
::
	`make_n£c
(0, 1).
	`timev®_û
()è=ğTime¡amp::
	`make_u£c
(0, 1));

372 
	`CHECK
(
	`Time¡amp
(
Time¡amp
::
	`make_n£c
(0, 0).
	`timev®_û
()è=ğTime¡amp::
	`make_u£c
(0, 0));

376 
	`CHECK
(
	`SŒšg
("abcdef").
	`sub¡ršg
(-3) == "def");

377 
	`CHECK
(
	`SŒšg
("abc").
	`sub¡ršg
(-3) == "abc");

378 
	`CHECK
(
	`SŒšg
("ab").
	`sub¡ršg
(-3) == "ab");

379 
	`CHECK
(
	`SŒšg
("abcdef").
	`sub¡ršg
(-3, -2) == "d");

380 
	`CHECK
(
	`SŒšg
("abcdef").
	`sub¡ršg
(-3, 2) == "de");

381 
	`CHECK
(
	`SŒšg
("abcdef").
	`sub¡ršg
(2, -3) == "c");

382 
	`CHECK
(
	`SŒšg
("abcdef").
	`sub¡ršg
(2, 3) == "cde");

383 
	`CHECK
(
	`SŒšg
("abcdef").
	`sub¡ršg
(2, 10) == "cdef");

384 
	`CHECK
(
	`SŒšg
("abcdef").
	`sub¡ršg
(-2, 10) == "ef");

385 
	`CHECK
(
	`SŒšg
("abcdef").
	`sub¡ršg
(-10, -3) == "abc");

386 
	`CHECK
(
	`SŒšg
("abcdef").
	`sub¡ršg
(-10, -9) == "");

387 
	`CHECK
(
	`SŒšg
("abcdef").
	`sub¡ršg
(10, -9) == "");

389 
SŒšg
 
	`x
("abcdefghijklmn");

390 
x
.
	`­³nd
(x.
	`d©a
() + 1, 12);

391 
	`CHECK
(
x
 == "abcdefghijklmnbcdefghijklm");

392 
x
 += x;

393 
	`CHECK
(
x
 == "abcdefghijklmnbcdefghijklmabcdefghijklmnbcdefghijklm");

396 
SŒšg
 
z
;

397 
z
 +ğ
x
;

398 
	`CHECK
(
z
 == "abcdefghijklmnbcdefghijklmabcdefghijklmnbcdefghijklm");

399 
	`CHECK
(
z
.
	`d©a
(è=ğ
x
.data());

400 
z
 = 
	`SŒšg
();

401 
z
 +ğ
x
.
	`sub¡ršg
(0, 5);

402 
	`CHECK
(
z
.
	`d©a
(è=ğ
x
.data());

403 
z
 +ğ
x
.
	`sub¡ršg
(0, 5);

404 
	`CHECK
(
z
 == "abcdeabcde");

405 
	`CHECK
(
z
.
	`d©a
(è!ğ
x
.data());

406 
z
 = 
SŒšg
::
	`make_out_of_memÜy
();

407 
z
 +ğ
x
;

408 
	`CHECK
(
z
.
	`out_of_memÜy
());

411 
SŒšgAccum
 
	`xx
(24);

412 
xx
 << "abcdefghijklmn";

413 
	`CHECK
(
xx
.
	`ÿ·c™y
(è- xx.
	`Ëngth
() < 12);

414 
xx
.
	`­³nd
(xx.
	`d©a
() + 1, 12);

415 
	`CHECK
(
	`¡rcmp
(
xx
.
	`c_¡r
(), "abcdefghijklmnbcdefghijklm") == 0);

416 
xx
 << xx;

417 
	`CHECK
(
	`¡rcmp
(
xx
.
	`c_¡r
(), "abcdefghijklmnbcdefghijklmabcdefghijklmnbcdefghijklm") == 0);

418 
xx
 << 
SŒšg
::
	`make_out_of_memÜy
();

419 
	`CHECK
(!
xx
.
	`out_of_memÜy
());

420 
xx
.
	`assign_out_of_memÜy
();

421 
xx
.
	`­³nd
("X", 1);

422 
	`CHECK
(
xx
.
	`out_of_memÜy
());

423 
	`CHECK
(
xx
.
	`ke_¡ršg
(è=ğ
SŒšg
::
	`make_out_of_memÜy
());

427 cÚ¡ 
hash1
[] = "boot_countXXXXXXYboot_countYYYYYZZboot_countZZZZWWWboot_countWWW";

428 
SŒšg
 
s1
 = SŒšg::
	`make_¡abË
(
hash1
, 10);

429 
SŒšg
 
s2
 = SŒšg::
	`make_¡abË
(
hash1
 + 17, 10);

430 
SŒšg
 
s3
 = SŒšg::
	`make_¡abË
(
hash1
 + 34, 10);

431 
SŒšg
 
s4
 = SŒšg::
	`make_¡abË
(
hash1
 + 51, 10);

432 
	`CHECK
(
s1
 =ğ
s2
 && s2 =ğ
s3
 && s3 =ğ
s4
 && s4 == s1);

433 
	`CHECK
(
s1
.
	`hashcode
(è=ğ
s2
.hashcode());

434 
	`CHECK
(
s1
.
	`hashcode
(è=ğ
s3
.hashcode());

435 
	`CHECK
(
s1
.
	`hashcode
(è=ğ
s4
.hashcode());

436 
	`CHECK
(((
ušŒ_t
è
s1
.
	`d©a
(è& 3è!ğ((ušŒ_tè
s2
.data() & 3));

437 
	`CHECK
(((
ušŒ_t
è
s1
.
	`d©a
(è& 3è!ğ((ušŒ_tè
s3
.data() & 3));

438 
	`CHECK
(((
ušŒ_t
è
s2
.
	`d©a
(è& 3è!ğ((ušŒ_tè
s3
.data() & 3));

439 
	`CHECK
(((
ušŒ_t
è
s1
.
	`d©a
(è& 3è!ğ((ušŒ_tè
s4
.data() & 3));

440 
	`CHECK
(((
ušŒ_t
è
s2
.
	`d©a
(è& 3è!ğ((ušŒ_tè
s4
.data() & 3));

441 
	`CHECK
(((
ušŒ_t
è
s3
.
	`d©a
(è& 3è!ğ((ušŒ_tè
s4
.data() & 3));

446 
SŒšg
 
s1
 = SŒšg::
	`make_¡abË
("click-align");

447 
	`CHECK
(
s1
.
	`fšd_Ëá
('c') == 0);

448 
	`CHECK
(
s1
.
	`fšd_Ëá
('c', 1) == 3);

449 
	`CHECK
(
s1
.
	`fšd_Ëá
('c', 3) == 3);

450 
	`CHECK
(
s1
.
	`fšd_Ëá
('c', 4) == -1);

451 
	`CHECK
(
s1
.
	`fšd_Ëá
("c") == 0);

452 
	`CHECK
(
s1
.
	`fšd_Ëá
("c", 1) == 3);

453 
	`CHECK
(
s1
.
	`fšd_Ëá
("c", 3) == 3);

454 
	`CHECK
(
s1
.
	`fšd_Ëá
("c", 5) == -1);

455 
	`CHECK
(
s1
.
	`fšd_Ëá
("li") == 1);

456 
	`CHECK
(
s1
.
	`fšd_Ëá
("li", 2) == 7);

457 
	`CHECK
(
s1
.
	`fšd_Ëá
("li", 8) == -1);

458 
	`CHECK
(
s1
.
	`fšd_Ëá
("", 0) == 0);

459 
	`CHECK
(
s1
.
	`fšd_Ëá
("", 10) == 10);

460 
	`CHECK
(
s1
.
	`fšd_Ëá
("", 11) == 11);

461 
	`CHECK
(
s1
.
	`fšd_Ëá
("", 12) == -1);

462 
	`CHECK
(
s1
.
	`fšd_Ëá
("a") == 6);

463 
	`CHECK
(
s1
.
	`sub¡ršg
(0, -1).
	`fšd_Ëá
('n') == -1);

466 #ià
CLICK_USERLEVEL


468 
	`CHECK
(
	`şick_¡rcmp
("a", "b") < 0);

469 
	`CHECK
(
	`şick_¡rcmp
("a9", "a10") < 0);

470 
	`CHECK
(
	`şick_¡rcmp
("a001", "a2") < 0);

471 
	`CHECK
(
	`şick_¡rcmp
("a001", "a1") > 0);

472 
	`CHECK
(
	`şick_¡rcmp
("a", "B") < 0);

473 
	`CHECK
(
	`şick_¡rcmp
("Baa", "baa") < 0);

474 
	`CHECK
(
	`şick_¡rcmp
("Baa", "caa") < 0);

475 
	`CHECK
(
	`şick_¡rcmp
("baa", "Caa") < 0);

476 
	`CHECK
(
	`şick_¡rcmp
("baa", "Baa") > 0);

477 
	`CHECK
(
	`şick_¡rcmp
("baA", "baA") == 0);

478 
	`CHECK
(
	`şick_¡rcmp
("a9x", "a10") < 0);

479 
	`CHECK
(
	`şick_¡rcmp
("a9x", "a9xy") < 0);

480 
	`CHECK
(
	`şick_¡rcmp
("0", "0.1") < 0);

481 
	`CHECK
(
	`şick_¡rcmp
("0", "0.") < 0);

482 
	`CHECK
(
	`şick_¡rcmp
("0", "-0.1") > 0);

483 
	`CHECK
(
	`şick_¡rcmp
("-0", "-0.1") > 0);

484 
	`CHECK
(
	`şick_¡rcmp
("-9", "-0.1") < 0);

485 
	`CHECK
(
	`şick_¡rcmp
("9", "0.1") > 0);

486 
	`CHECK
(
	`şick_¡rcmp
("-0.2", "-0.1") < 0);

487 
	`CHECK
(
	`şick_¡rcmp
("-2.2", "-2") < 0);

488 
	`CHECK
(
	`şick_¡rcmp
("2.2", "2") > 0);

489 
	`CHECK
(
	`şick_¡rcmp
("0.2", "0.1") > 0);

490 
	`CHECK
(
	`şick_¡rcmp
("0.2", "0.39") < 0);

491 
	`CHECK
(
	`şick_¡rcmp
(".2", "0.2") < 0);

492 
	`CHECK
(
	`şick_¡rcmp
("a-2", "a-23") < 0);

493 
	`CHECK
(
	`şick_¡rcmp
("a-2", "a-3") < 0);

494 
	`CHECK
(
	`şick_¡rcmp
("a1.2", "a1a") > 0);

495 
	`CHECK
(
	`şick_¡rcmp
("1.2.3.4", "10.2.3.4") < 0);

496 
	`CHECK
(
	`şick_¡rcmp
("1.12", "1.2") < 0);

497 
	`CHECK
(
	`şick_¡rcmp
("1.012", "1.2") < 0);

498 
	`CHECK
(
	`şick_¡rcmp
("1.012.", "1.2.") < 0);

499 
	`CHECK
(
	`şick_¡rcmp
("1.12.3.4", "1.2.3.4") > 0);

500 
	`CHECK
(
	`şick_¡rcmp
("1.2.10.4", "1.2.9.4") > 0);

501 
	`CHECK
(
	`şick_¡rcmp
("1.2.10.4:100", "1.2.10.4:2") > 0);

504 
VeùÜ
<
SŒšg
> 
cÚf
;

505 
cÚf
.
	`push_back
("SIZE 123456789");

506 
size_t
 
‹¡_size
;

507 
	`CHECK
(
	`ı_va_k·r£
(
cÚf
, 
this
, 
”rh
,

508 "SIZE", 0, 
ıSize
, &
‹¡_size
,

509 
ıEnd
è=ğ1 && 
‹¡_size
 == 123456789);

510 
	`CHECK
(
	`Args
(
cÚf
, 
this
, 
”rh
)

511 .
	`»ad
("SIZE", 
‹¡_size
).
	`»ad_¡©us
(
b
)

512 .
	`com¶‘e
(è>ğ0 && 
b
 =ğ
Œue
 && 
‹¡_size
 == 123456789);

514 
VeùÜ
<
SŒšg
> 
»suÉs
;

515 
boŞ
 
b2
;

516 
	`CHECK
(
	`Args
(
this
, 
”rh
).
	`push_back_¬gs
("A 1, B 2, A 3, A 4 , A 5")

517 .
	`»ad_®l_w™h
("A", 
	`AnyArg
(), 
»suÉs
).
	`»ad_¡©us
(
b
)

518 .
	`»ad
("B", 
i32
).
	`»ad_¡©us
(
b2
)

519 .
	`com¶‘e
() >= 0);

520 
	`CHECK
(
b
 =ğ
Œue
);

521 
	`CHECK
(
b2
 =ğ
Œue
);

522 
	`CHECK
(
i32
 == 2);

523 
	`CHECK
(
»suÉs
.
	`size
() == 4);

524 
	`CHECK
(
»suÉs
[0] == "1" &&„esults[1] == "3" &&„esults[2] == "4" &&„esults[3] == "5");

526 
»suÉs
.
	`ş—r
();

527 
	`CHECK
(
	`Args
(
this
, 
”rh
).
	`push_back_¬gs
("B 3")

528 .
	`»ad_®l_w™h
("A", 
	`AnyArg
(), 
»suÉs
).
	`»ad_¡©us
(
b
)

529 .
	`»ad
("B", 
i32
).
	`»ad_¡©us
(
b2
)

530 .
	`com¶‘e
() >= 0

531 && 
b
 =ğ
çl£
 && 
b2
 =ğ
Œue
 && 
i32
 == 3

532 && 
»suÉs
.
	`size
() == 0);

535 
	`CHECK
(
	`SŒšg
(
Œue
è+ " " + SŒšg(
çl£
) == "true false");

536 
SŒšgAccum
 
§
;

537 
§
 << 
Œue
 << ' ' << 
çl£
;

538 
	`CHECK
(
§
.
	`ke_¡ršg
() == "true false");

541 
»suÉs
.
	`ş—r
();

542 
	`CHECK
(
	`Args
(
this
, 
”rh
).
	`push_back_¬gs
("A 1, B 2, A 3, A 4, A 5")

543 .
	`»ad_®l
("A", 
	`AnyArg
(), 
»suÉs
).
	`»ad_¡©us
(
b
)

544 .
	`cÚsume
() >= 0);

545 
	`CHECK
(
b
 =ğ
Œue
);

546 
	`CHECK
(
»suÉs
.
	`size
() == 4);

547 
	`CHECK
(
»suÉs
[0] == "1" &&„esults[1] == "3" &&„esults[2] == "4" &&„esults[3] == "5");

549 
št32_t
 
i32b
;

550 
i32
 = 
i32b
 = 99;

551 
	`CHECK
(
	`Args
(
this
, 
”rh
).
	`push_back_¬gs
("A 1")

552 .
	`»ad_Ü_£t
("A", 
i32
, 9).
	`»ad_¡©us
(
b
)

553 .
	`»ad_Ü_£t
("B", 
i32b
, 3).
	`»ad_¡©us
(
b2
)

554 .
	`cÚsume
() >= 0);

555 
	`CHECK
(
b
 =ğ
Œue
);

556 
	`CHECK
(
b2
 =ğ
çl£
);

557 
	`CHECK
(
i32
 == 1);

558 
	`CHECK
(
i32b
 == 3);

560 
	`CHECK
(
	`Args
(
this
, 
”rh
).
	`push_back
("1").push_back("2")

561 .
	`»ad_mp
("A", 
i32
).
	`»ad_¡©us
(
b
)

562 .
	`»ad_mp
("B", 
i32b
).
	`»ad_¡©us
(
b2
)

563 .
	`com¶‘e
() >= 0);

564 
	`CHECK
(
b
 =ğ
Œue
);

565 
	`CHECK
(
b2
 =ğ
Œue
);

566 
	`CHECK
(
i32
 == 1);

567 
	`CHECK
(
i32b
 == 2);

569 
”rh
->
	`mes§ge
("Allests…ass!");

571 
	}
}

573 
	$EXPORT_ELEMENT
(
CÚfP¬£Te¡
)

574 
CLICK_ENDDECLS


	@test/confparsetest.hh

2 #iâdeà
CLICK_CONFPARSETEST_HH


3 
	#CLICK_CONFPARSETEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


23 şas 
	cCÚfP¬£Te¡
 : 
public
 
EËm’t
 {…ublic:

25 
	$CÚfP¬£Te¡
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "ConfParseTest"; }

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

31 
	}
};

33 
	gCLICK_ENDDECLS


	@test/cryptotest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"üy±Ùe¡.hh
"

21 
	~<şick/md5.h
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gCry±oTe¡
::
	$Cry±oTe¡
()

27 
	}
}

30 
	$md5_‹¡
(cÚ¡ *
s
, 
size_t
 
Ën
, cÚ¡ *
ex³ùed_dige¡
,

31 
E¼ÜHªdËr
 *
”rh
, cÚ¡ *
fe
, 
lše
)

33 
md5_¡©e_t
 
md5s
;

34 ià(
	`md5_š™
(&
md5s
) < 0) {

35 
”rh
->
	`w¬nšg
("%s:%d: MD5 in™Ÿliz©iÚ faed", 
fe
, 
lše
);

41 *
x
 = 
Ãw
 [
Ën
];

42 
	`memıy
(
x
, 
s
, 
Ën
);

43 
	`md5_­³nd
(&
md5s
, 
»š‹½»t_ÿ¡
<cÚ¡ *>(
x
), 
Ën
);

44 
d–‘e
[] 
x
;

46 
dige¡
[16];

47 
	`md5_fšish
(&
md5s
, 
dige¡
);

48 
	`md5_ä“
(&
md5s
);

50 ià(
	`memcmp
(
dige¡
, 
ex³ùed_dige¡
, 16) != 0)

51  
”rh
->
	`”rÜ
("%s:%d: bad MD5 dige¡ fÜ %<%#.16s...%>, gÙ %s", 
fe
, 
lše
, 
s
, 
	`SŒšg
(
dige¡
, 16).
	`quÙed_hex
().
	`low”
().
	`sub¡ršg
(2, -1).
	`c_¡r
());

53 
	}
}

56 
	gCry±oTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

58 ià(
	`md5_‹¡
("M¬rŸge\n\n\nThi š¡™utiÚ,\Å”h­ Úshould sayƒÁ”´i£\nouˆoà»¥eù fÜ which\nÚ§y ÚÃed‚Ù chªgÚe' mšd\n", 128, "\x93\x48\x6a\xc6\xe0\x32\x44\xf0\x32\xb3\x24\xba\x4a\xde\x28\x43", 
”rh
, 
__FILE__
, 
__LINE__
) < 0)

61 ià(
	`md5_‹¡
("Thi i ¨‹¡\n", 15, "\xff\x22\x94\x13\x36\x95\x60\x98\x«\x9a\x56\x42\x89\xd1\xbf\x1b", 
”rh
, 
__FILE__
, 
__LINE__
) < 0)

64 
”rh
->
	`mes§ge
("Allests…ass!");

66 
	}
}

68 
	$EXPORT_ELEMENT
(
Cry±oTe¡
)

69 
CLICK_ENDDECLS


	@test/cryptotest.hh

2 #iâdeà
CLICK_CRYPTOTEST_HH


3 
	#CLICK_CRYPTOTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


23 şas 
	cCry±oTe¡
 : 
public
 
EËm’t
 {…ublic:

25 
	$Cry±oTe¡
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "CryptoTest"; }

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

31 
	}
};

33 
	gCLICK_ENDDECLS


	@test/dequetest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"dequ‘e¡.hh
"

21 
	~<şick/deque.hh
>

22 
	~<şick/”rÜ.hh
>

23 #ià
CLICK_USERLEVEL


24 
	~<sys/time.h
>

25 
	~<sys/»sourû.h
>

26 
	~<uni¡d.h
>

28 
CLICK_DECLS


30 
	gDequeTe¡
::
	$DequeTe¡
()

32 
	}
}

34 
	#CHECK
(
x
èià(!(x)è 
”rh
->
	`”rÜ
("%s:%d:e¡ %<%s%> faed", 
__FILE__
, 
__LINE__
, #x);

	)

37 
	gDequeTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

39 
Deque
<> 
v
;

40 
v
.
	`push_back
(0);

41 
v
.
	`push_back
(1);

42 
v
.
	`push_back
(2);

43 
v
.
	`push_back
(4);

44 
	`CHECK
(
v
.
	`size
() == 4);

45 
	`CHECK
(
v
.
	`size
(è<ğv.
	`ÿ·c™y
());

46 
	`CHECK
(
v
[0] == 0);

47 
	`CHECK
(
v
[1] == 1);

48 
	`CHECK
(
v
[2] == 2);

49 
	`CHECK
(
v
[3] == 4);

51 
Deque
<>::
™”©Ü
 
i
 = 
v
.
	`š£¹
(v.
	`’d
() - 1, 3);

52 
	`CHECK
(
i
 - 
v
.
	`begš
() == 3);

53 
	`CHECK
(*
i
 == 3);

54 
	`CHECK
(
v
.
	`size
() == 5 && v[0] == 0 && v[1] == 1 && v[2] == 2 && v[3] == 3 && v[4] == 4);

56 
i
 = 
v
.
	`š£¹
(v.
	`’d
(), 5);

57 
	`CHECK
(
i
 =ğ
v
.
	`’d
() - 1);

58 
	`CHECK
(*
i
 == 5);

59 
	`CHECK
(
v
.
	`back
() == 5);

61 
i
 = 
v
.
	`š£¹
(v.
	`begš
(), -1);

62 
	`CHECK
(
v
.
	`size
() == 7);

63 
	`CHECK
(
i
 =ğ
v
.
	`’d
() - 7);

64 
	`CHECK
(*
i
 == -1);

66 
i
 = 
v
.
	`”a£
(v.
	`begš
(), v.begin() + 2);

67 
	`CHECK
(*
i
 == 1);

68 
	`CHECK
(
v
.
	`size
() == 5);

69 
	`CHECK
(
i
[1] == 2);

71 
i
 = 
v
.
	`”a£
(v.
	`’d
() - 2, v.end());

72 
	`CHECK
(
i
 =ğ
v
.
	`’d
());

73 
	`CHECK
(
i
[-1] == 3);

74 
	`CHECK
(
v
.
	`size
() == 3);

76 
i
 = 
v
.
	`”a£
(v.
	`begš
(è+ 1, v.
	`’d
() - 1);

77 
	`CHECK
(
i
 =ğ
v
.
	`’d
() - 1);

78 
	`CHECK
(*
i
 == 3);

79 
	`CHECK
(
i
[-1] == 1);

81 
v
.
	`ş—r
();

82 
i
 = 10; i >= 0; --i)

83 
v
.
	`push_äÚt
(
i
);

84 
	`CHECK
(
v
[0] == 0);

85 
	`CHECK
(
v
[1] == 1);

86 
	`CHECK
(
v
[10] == 10);

87 
v
.
	`”a£
(v.
	`begš
() + 1, v.begin() + 3);

88 
	`CHECK
(
v
[0] == 0);

89 
	`CHECK
(
v
[1] == 3);

90 
	`CHECK
(
v
[8] == 10);

91 
v
.
	`”a£
(v.
	`begš
() + 6, v.begin() + 8);

92 
	`CHECK
(
v
[5] == 7);

93 
	`CHECK
(
v
[6] == 10);

94 
	`CHECK
(
v
.
	`size
() == 7);

97 
Deque
<> 
v2
;

98 
v
.
	`ş—r
();

99 
	`CHECK
(
v
.
	`size
() == 0);

100 
	`CHECK
(
v2
.
	`size
() == 0);

101 
i
 = 0; i < 10000; i++)

102 
v
 = 
v2
;

104 
Deque
<
SŒšg
> 
sd
;

105 
i
 = 10; i >= 0; --i)

106 
sd
.
	`push_äÚt
(
	`SŒšg
(
i
));

107 
	`CHECK
(
sd
[0] == "0");

108 
	`CHECK
(
sd
[1] == "1");

109 
	`CHECK
(
sd
[10] == "10");

110 
sd
.
	`”a£
(sd.
	`begš
() + 1, sd.begin() + 3);

111 
	`CHECK
(
sd
[0] == "0");

112 
	`CHECK
(
sd
[1] == "3");

113 
	`CHECK
(
sd
[8] == "10");

114 
sd
.
	`”a£
(sd.
	`begš
() + 6, sd.begin() + 8);

115 
	`CHECK
(
sd
[5] == "7");

116 
	`CHECK
(
sd
[6] == "10");

117 
	`CHECK
(
sd
.
	`size
() == 7);

118 
sd
.
	`size
(è< sd.
	`ÿ·c™y
())

119 
sd
.
	`push_back
(
	`SŒšg
(sd.
	`size
()));

120 
	`CHECK
(
sd
[0] == "0");

121 
sd
.
	`š£¹
(sd.
	`begš
() + 5, sd[0]);

122 
	`CHECK
(
sd
[5] == "0");

123 
	`CHECK
(
sd
[0] == "0");

125 
”rh
->
	`mes§ge
("Allests…ass!");

127 
	}
}

129 
CLICK_ENDDECLS


130 
EXPORT_ELEMENT
(
DequeTe¡
)

	@test/dequetest.hh

2 #iâdeà
CLICK_DEQUETEST_HH


3 
	#CLICK_DEQUETEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


23 şas 
	cDequeTe¡
 : 
public
 
EËm’t
 {…ublic:

25 
	$DequeTe¡
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "DequeTest"; }

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

31 
	}
};

33 
	gCLICK_ENDDECLS


	@test/errortest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"”rÜ‹¡.hh
"

21 
	~<şick/cÚå¬£.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şick/‘h”add»ss.hh
>

25 
CLICK_DECLS


27 
	gÇme¥aû
 {

28 şas 
	cE¼ÜTe¡HªdËr
 : 
public
 
E¼ÜHªdËr
 {…ublic:

29 
E¼ÜTe¡HªdËr
() { }

30 *
em™
(cÚ¡ 
SŒšg
 &
¡r
, *, 
boŞ
) {

31 
	g_‹xt
 << 
	g¡r
 << '\n';

34 
boŞ
 
check
(cÚ¡ 
SŒšg
 &
‹xt
) {

35 
	g_Ï¡_‹xt
 = 
_‹xt
.
ke_¡ršg
();

36  
	g‹xt
 =ğ
_Ï¡_‹xt
;

38 
SŒšgAccum
 
	g_‹xt
;

39 
SŒšg
 
	g_Ï¡_‹xt
;

43 
	gE¼ÜTe¡
::
	$E¼ÜTe¡
()

45 
	}
}

47 
	#CHECK
(
‹xt
èià(!
”rh
.
	`check
(Ñext))è 
š™_”rh
->
	`”rÜ
("%s:%d:e¡ %<%s%> faed, gÙ %<%.*s%>", 
__FILE__
, 
__LINE__
, (‹xt),ƒ¼h.
_Ï¡_‹xt
.
	`Ëngth
(),ƒ¼h._Ï¡_‹xt.
	`d©a
());

	)

50 
	gE¼ÜTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
š™_”rh
)

52 
E¼ÜTe¡HªdËr
 
”rh
;

54 
IPAdd»ss
 
	`a
(
	`SŒšg
("1.0.2.3"));

55 
Eth”Add»ss
 
‘ha
;

56 
	`Eth”Add»ssArg
().
	`·r£
("0:1:3:5:A:B", 
‘ha
);

57 
”rh
.
	`”rÜ
("IP %p{_±r} %% ETH %p{‘h”_±r}", &
a
, &
‘ha
);

58 
	`CHECK
("<3>IP 1.0.2.3 % ETH 00-01-03-05-0A-0B\n");

61 
CÚ‹xtE¼ÜHªdËr
 
	`û¼h
(&
”rh
, "Context:");

62 
û¼h
.
	`”rÜ
("Testing context 1");

63 
	`CHECK
("<3>{context:context}Context:\n<3> Testing context 1\n");

64 
û¼h
.
	`”rÜ
("Testing context 2");

65 
	`CHECK
("<3> Testing context 2\n");

69 
CÚ‹xtE¼ÜHªdËr
 
	`û¼h
(&
”rh
, "Context:");

70 
P»fixE¼ÜHªdËr
 
	`³¼h
(&
”rh
, "{context:no}");

71 
³¼h
.
	`”rÜ
("Testing context 1");

72 
	`CHECK
("{context:no}<3>Testing context 1\n");

73 
³¼h
.
	`”rÜ
("Testing context 2");

74 
	`CHECK
("{context:no}<3>Testing context 2\n");

78 
CÚ‹xtE¼ÜHªdËr
 
	`û¼h
(&
”rh
, "Context:");

79 
û¼h
.
	`”rÜ
("{context:no}Testing context 1");

80 
	`CHECK
("<3>{context:no}Testing context 1\n");

81 
û¼h
.
	`”rÜ
("Testing context 2");

82 
	`CHECK
("<3>{context:context}Context:\n<3> Testing context 2\n");

86 
CÚ‹xtE¼ÜHªdËr
 
	`û¼h
(&
”rh
, "Context:");

87 
û¼h
.
	`”rÜ
("{context:nocontext}Testing context 1");

88 
	`CHECK
("<3>{context:nocontext} Testing context 1\n");

89 
û¼h
.
	`”rÜ
("{context:noindent}Testing context 2");

90 
	`CHECK
("<3>{context:context}Context:\n<3>{context:noindent}Testing context 2\n");

94 
CÚ‹xtE¼ÜHªdËr
 
	`û¼h
(&
”rh
, "Context %<foo%>:");

95 
û¼h
.
	`”rÜ
("Testing context 1");

96 
	`CHECK
("<3>{context:context}Context 'foo':\n<3> Testing context 1\n");

97 
û¼h
.
	`”rÜ
("Testing context 2");

98 
	`CHECK
("<3> Testing context 2\n");

102 *
x
 = 
Ãw
 [4];

103 
	`memıy
(
x
, "Hi!!", 4);

104 
”rh
.
	`”rÜ
("Thi should‚Ù cau£ memÜyƒ¼Üs: %<%.*s%>", 4, 
x
);

105 
	`CHECK
("<3>This should‚ot cause memoryƒrrors: 'Hi!!'\n");

108 
š™_”rh
->
	`mes§ge
("Allests…ass!");

110 
	}
}

112 
	$EXPORT_ELEMENT
(
E¼ÜTe¡
)

113 
CLICK_ENDDECLS


	@test/errortest.hh

2 #iâdeà
CLICK_ERRORTEST_HH


3 
	#CLICK_ERRORTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


23 şas 
	cE¼ÜTe¡
 : 
public
 
EËm’t
 {…ublic:

25 
	$E¼ÜTe¡
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "ErrorTest"; }

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

31 
	}
};

33 
	gCLICK_ENDDECLS


	@test/functiontest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"funùiÚ‹¡.hh
"

21 
	~<şick/cÚå¬£.hh
>

22 
	~<şick/š‹g”s.hh
>

23 #ià
CLICK_USERLEVEL


24 
	~<şick/u£ruts.hh
>

26 
	~<şick/”rÜ.hh
>

27 
CLICK_DECLS


29 
	gFunùiÚTe¡
::
	$FunùiÚTe¡
()

31 
	}
}

33 
	#CHECK
(
x
èià(!(x)è 
”rh
->
	`”rÜ
("%s:%d:e¡ %<%s%> faed", 
__FILE__
, 
__LINE__
, #x);

	)

36 
	gFunùiÚTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

38 
	`CHECK
((
§me_ty³
<, >::
v®ue
));

39 
	`CHECK
((!
§me_ty³
<, >::
v®ue
));

40 
	`CHECK
((!
§me_ty³
<, cÚ¡ >::
v®ue
));

41 
	`CHECK
((!
§me_ty³
<, *>::
v®ue
));

42 
	`CHECK
((
ty³s_com·tibË
<, >::
v®ue
));

43 
	`CHECK
((!
ty³s_com·tibË
<, >::
v®ue
));

44 
	`CHECK
((
ty³s_com·tibË
<, cÚ¡ >::
v®ue
));

45 
	`CHECK
((!
ty³s_com·tibË
<, *>::
v®ue
));

47 
	`CHECK
(
	`ffs_msb
(0U) == 0);

48 
	`CHECK
(
	`ffs_msb
(1U) == 32);

49 
	`CHECK
(
	`ffs_msb
(0x80000000U) == 1);

50 
	`CHECK
(
	`ffs_msb
(0x00010000U) == 16);

52 
	`CHECK
(
	`ffs_lsb
(0U) == 0);

53 
	`CHECK
(
	`ffs_lsb
(1U) == 1);

54 
	`CHECK
(
	`ffs_lsb
(0x80000000U) == 32);

55 
	`CHECK
(
	`ffs_lsb
(0x00010000U) == 17);

57 
	`CHECK
(
	`št_sq¹
(0U) == 0);

58 
	`CHECK
(
	`št_sq¹
(1U) == 1);

59 
	`CHECK
(
	`št_sq¹
(3U) == 1);

60 
	`CHECK
(
	`št_sq¹
(4U) == 2);

61 
	`CHECK
(
	`št_sq¹
(5U) == 2);

62 
	`CHECK
(
	`št_sq¹
(120U) == 10);

63 
	`CHECK
(
	`št_sq¹
(121U) == 11);

64 
	`CHECK
(
	`št_sq¹
(0x40000000U) == 0x8000);

65 
	`CHECK
(
	`št_sq¹
(0xFFFFFFFEU) == 0xFFFF);

66 
	`CHECK
(
	`št_sq¹
(0xFFFFFFFFU) == 0xFFFF);

68 #ià
HAVE_INT64_TYPES
 && 
HAVE_INT64_DIVIDE


69 
	`CHECK
(
	`št_sq¹
((
ušt64_t
) 0xFFFFFFFFU) == 0xFFFF);

70 
	`CHECK
(
	`št_sq¹
((
ušt64_t
) 1 << 32) == 0x10000);

71 
	`CHECK
(
	`št_sq¹
(~((
ušt64_t
) 0)) == 0xFFFFFFFFU);

74 #ià
CLICK_USERLEVEL


75 
	`CHECK
(
	`glob_m©ch
("", "*"));

76 
	`CHECK
(
	`glob_m©ch
("a", "\\a"));

77 
	`CHECK
(
	`glob_m©ch
("*", "\\*"));

78 
	`CHECK
(!
	`glob_m©ch
("a", "\\*"));

79 
	`CHECK
(
	`glob_m©ch
("Q", "*"));

80 
	`CHECK
(
	`glob_m©ch
("QX", "*"));

81 
	`CHECK
(
	`glob_m©ch
("Q", "Q*"));

82 
	`CHECK
(
	`glob_m©ch
("QX", "Q*"));

83 
	`CHECK
(!
	`glob_m©ch
("Q.x", "Q*.o"));

84 
	`CHECK
(
	`glob_m©ch
("QXajdsifds.o", "Q*.o"));

85 
	`CHECK
(
	`glob_m©ch
("x.o", "?.o"));

86 
	`CHECK
(!
	`glob_m©ch
("x.c", "?.o"));

87 
	`CHECK
(!
	`glob_m©ch
("xx.o", "?.o"));

88 
	`CHECK
(
	`glob_m©ch
("x.o.d", "x*.?*.*"));

89 
	`CHECK
(!
	`glob_m©ch
("aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaacba", "*aa*aa*aa*aa*aa*aa*aa*aa*aa*aa*aa*aa*aa*b*c*"));

92 
”rh
->
	`mes§ge
("Allests…ass!");

94 
	}
}

96 
	$EXPORT_ELEMENT
(
FunùiÚTe¡
)

97 
CLICK_ENDDECLS


	@test/functiontest.hh

2 #iâdeà
CLICK_FUNCTIONTEST_HH


3 
	#CLICK_FUNCTIONTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


23 şas 
	cFunùiÚTe¡
 : 
public
 
EËm’t
 {…ublic:

25 
	$FunùiÚTe¡
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "FunctionTest"; }

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

31 
	}
};

33 
	gCLICK_ENDDECLS


	@test/handlertask.cc

19 
	~<şick/cÚfig.h
>

20 
	~"hªdË¹ask.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/hªdËrÿÎ.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

26 
CLICK_DECLS


28 
	gHªdËrTask
::
	$HªdËrTask
()

29 : 
	`_sk
(
this
), 
	`_couÁ
(0), 
	`_aùive
(
Œue
), 
	$_»scheduË
(
çl£
)

31 
	}
}

34 
	gHªdËrTask
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36  
Args
(
cÚf
, 
this
, 
”rh
)

37 .
»ad_mp
("HANDLER", 
HªdËrC®lArg
(
HªdËrC®l
::
wr™abË
), 
_h
)

38 .
»ad
("ACTIVE", 
_aùive
)

39 .
»ad
("RESCHEDULE", 
_»scheduË
)

40 .
com¶‘e
();

44 
	gHªdËrTask
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

46 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_aùive
, 
”rh
);

47  
_h
.
	`š™Ÿlize_wr™e
(
this
, 
”rh
);

48 
	}
}

50 
boŞ


51 
	gHªdËrTask
::
	$run_sk
(
Task
 *)

53 ++
_couÁ
;

54 
_h
.
	`ÿÎ_wr™e
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

55 ià(
_»scheduË
)

56 
_sk
.
	`ç¡_»scheduË
();

57  
Œue
;

58 
	}
}

61 
	gHªdËrTask
::
	$add_hªdËrs
()

63 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
OP_READ
, &
_couÁ
);

64 
	`add_d©a_hªdËrs
("»scheduË", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_»scheduË
);

65 
	`add_sk_hªdËrs
(&
_sk
, 0, 
TASKHANDLER_WRITE_ALL
);

66 
	}
}

68 
CLICK_ENDDECLS


69 
EXPORT_ELEMENT
(
HªdËrTask
)

	@test/handlertask.hh

2 #iâdeà
CLICK_HANDLERTASK_HH


3 
	#CLICK_HANDLERTASK_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şick/hªdËrÿÎ.hh
>

7 
CLICK_DECLS


47 şas 
	cHªdËrTask
 : 
public
 
EËm’t
 {…ublic:

49 
	$HªdËrTask
(è
CLICK_COLD
;

51 cÚ¡ *
	$şass_Çme
() const {  "HandlerTask"; }

53 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

54 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

55 
	$add_hªdËrs
(è
CLICK_COLD
;

57 
boŞ
 
	`run_sk
(
Task
 *);

59 
´iv©e
:

61 
Task
 
_sk
;

62 
HªdËrC®l
 
_h
;

63 
ušt32_t
 
_couÁ
;

64 
boŞ
 
_aùive
;

65 
boŞ
 
_»scheduË
;

67 
	}
};

69 
	gCLICK_ENDDECLS


	@test/hashtabletest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"hashbË‹¡.hh
"

21 
	~<şick/hashbË.hh
>

22 
	~<şick/”rÜ.hh
>

23 #ià
CLICK_USERLEVEL


24 
	~<sys/time.h
>

25 
	~<sys/»sourû.h
>

26 
	~<uni¡d.h
>

28 
CLICK_DECLS


30 
	gHashTabËTe¡
::
	$HashTabËTe¡
()

32 
	}
}

35 
	#MAP_S2I
 
HashM­
<
SŒšg
, >

	)

36 
	#MAP_VALUE
(
m
, 
k
è(m).
	`fšd
((k))

	)

37 
	#IT_VALUE
(
™
è(™).
	`v®ue
()

	)

38 
	#MAP_INSERT
(
m
, 
k
, 
v
è(m).
	`š£¹
((k), (v))

	)

39 
	#MAP_FIND_VALUE
(
m
, 
k
è(m).
	`fšd
((k))

	)

41 
	#MAP_S2I
 
HashTabË
<
SŒšg
, >

	)

42 
	#MAP_VALUE
(
m
, 
k
è(m)[(k)]

	)

43 
	#IT_VALUE
(
™
è(™)->
£cÚd


	)

44 
	#MAP_INSERT
(
m
, 
k
, 
v
è(m).
	`£t
((k), (v))

	)

45 
	#MAP_FIND_VALUE
(
m
, 
k
è({ 
MAP_S2I
::
™”©Ü
 
™
 = (m).
	`fšd
((k)); iˆ? it->
£cÚd
 : 0; })

	)

47 
	#MAP_S2I
 
HashTabË
<
Paœ
<
SŒšg
, > >

	)

48 
	#MAP_VALUE
(
m
, 
k
è(m).
	`fšd
((k))->
£cÚd


	)

49 
	#IT_VALUE
(
™
è(™)->
£cÚd


	)

50 
	#MAP_INSERT
(
m
, 
k
, 
v
è(m).
	`£t
(
	`make_·œ
((k), (v)))

	)

51 
	#MAP_FIND_VALUE
(
m
, 
k
è({ 
MAP_S2I
::
™”©Ü
 
™
 = (m).
	`fšd
((k)); iˆ? it->
£cÚd
 : 0; })

	)

54 
	#CHECK
(
x
èià(!(x)è 
”rh
->
	`”rÜ
("%s:%d:e¡ `%s' faed", 
__FILE__
, 
__LINE__
, #x);

	)

55 
	#CHECK_DATA
(
x
, 
y
, 
l
è
	`CHECK
(
	`memcmp
((x), (y), (l)è=ğ0)

	)

58 
	$check1
(
MAP_S2I
 &
h
, 
E¼ÜHªdËr
 *
”rh
)

60 
	`CHECK
(
h
.
	`size
() == 4);

61 
	`CHECK
(!
h
.
	`em±y
());

63 
x
[4] = "\0\0\0";

64 
n
 = 0;

65 
MAP_S2I
::
cÚ¡_™”©Ü
 
i
 = 
h
.
	`begš
(); i.
	`live
(); i++) {

66 
	`CHECK
(
	`IT_VALUE
(
i
) >= 1 && IT_VALUE(i) <= 4);

67 
	`CHECK
(
x
[
	`IT_VALUE
(
i
) - 1] == 0);

68 
x
[
	`IT_VALUE
(
i
) - 1] = 1;

69 
n
++;

71 
	`CHECK
(
n
 == 4);

73 
	`mem£t
(
x
, 0, 4);

74 
n
 = 0;

75 
MAP_S2I
::
™”©Ü
 
i
 = 
h
.
	`begš
(); i.
	`live
(); i++) {

76 
Şdv
 = 
	`IT_VALUE
(
i
);

77 
	`CHECK
(
	`IT_VALUE
(
i
) >= 1 && IT_VALUE(i) <= 4);

78 
	`IT_VALUE
(
i
) = 5;

79 
	`CHECK
(
	`IT_VALUE
(
i
) == 5);

80 
	`IT_VALUE
(
i
èğ
Şdv
;

81 
	`CHECK
(
x
[
	`IT_VALUE
(
i
) - 1] == 0);

82 
x
[
	`IT_VALUE
(
i
) - 1] = 1;

83 
n
++;

85 
	`CHECK
(
n
 == 4);

88 
	}
}

90 #ià
CLICK_USERLEVEL


91 cÚ¡ * cÚ¡ 
	gşas£s
[] = {

350 cÚ¡ * cÚ¡ 
	gnÚşas£s
[] = {

430 
	sMyHashCÚš”EÁry
 {

431 
	m_key
;

432 
MyHashCÚš”EÁry
 *
	m_hashÃxt
;

434 
	tkey_ty³
;

435 
	tkey_cÚ¡_»ã»nû
;

437 
key_cÚ¡_»ã»nû
 
hashkey
() const {

438  
	m_key
;

441 
MyHashCÚš”EÁry
(
key
è: 
_key
(key), 
_hashÃxt
(0) {};

444 
	gHashCÚš”
<
	tMyHashCÚš”EÁry
> 
	tMyHashCÚš”
;

447 
	gHashTabËTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

449 
MyHashCÚš”
 
my_hashcÚš”
;

450 
SizedHashAÎoÿtÜ
<(
MyHashCÚš”EÁry
)> 
my_®loc
;

451 
my_num_to_š£¹
 = 1000;

452 
i
 = 0; i < 
my_num_to_š£¹
; ++i) {

453 *
p
 = 
my_®loc
.
	`®loÿ‹
();

454 
MyHashCÚš”EÁry
 *
e
 = 
	`Ãw
(
p
è
	`MyHashCÚš”EÁry
(
i
);

455 
MyHashCÚš”
::
™”©Ü
 
š£¹_™
 = 
my_hashcÚš”
.
	`fšd
(
i
);

456 
	`CHECK
(!
š£¹_™
.
	`g‘
());

457 
my_hashcÚš”
.
	`š£¹_©
(
š£¹_™
, 
e
);

458 
my_hashcÚš”
.
	`b®ªû
();

460 
	`CHECK
(
my_hashcÚš”
.
	`size
() == 1000);

461 
MyHashCÚš”
::
™”©Ü
 
™
 = 
my_hashcÚš”
.
	`begš
(); it.
	`live
();) {

462 
MyHashCÚš”EÁry
 *
e
 = 
™
.
	`g‘
();

463 
my_hashcÚš”
.
	`”a£
(
™
);

464 
e
->~
	`MyHashCÚš”EÁry
();

465 
my_®loc
.
	`d—Îoÿ‹
(
e
);

467 
	`CHECK
(
my_hashcÚš”
.
	`size
() == 0);

469 
MAP_S2I
 
h
;

471 
	`MAP_INSERT
(
h
, "Foo", 1);

472 
	`MAP_INSERT
(
h
, "bar", 2);

473 
	`MAP_INSERT
(
h
, "facker", 3);

474 
	`MAP_INSERT
(
h
, "Anne Elizabeth Dudfield", 4);

476 
	`CHECK
(
	`check1
(
h
, 
”rh
) == 0);

480 
MAP_S2I
 
	`hh
(
h
);

481 
	`CHECK
(
	`check1
(
hh
, 
”rh
) == 0);

482 
	`MAP_INSERT
(
hh
, "crap", 5);

485 
	`CHECK
(
	`check1
(
h
, 
”rh
) == 0);

487 
h
.
	`”a£
("Foo");

488 
h
.
	`”a£
("Anne Fuckfuckabeth Fuckfield");

490 
	`CHECK
(
h
.
	`size
() == 3);

491 
	`CHECK
(
	`MAP_VALUE
(
h
, "bar") == 2);

492 
	`CHECK
(
	`MAP_VALUE
(
h
, "facker") == 3);

493 
	`CHECK
(
	`MAP_VALUE
(
h
, "Anne Elizabeth Dudfield") == 4);

495 
MAP_S2I
 
hh
;

496 
h
.
	`ş—r
();

497 
h
["Crap"] = 1;

498 
h
["Crud"] = 2;

499 
h
["Crang"] = 3;

500 
h
["Dumb"] = 3;

501 
MAP_S2I
::
™”©Ü
 
™
 = 
h
.
	`begš
(); it; )

502 ià(
™
.
	`key
() == "Crud")

503 
™
 = 
h
.
	`”a£
(it);

505 
hh
[
™
.
	`key
()] = it.
	`v®ue
();

506 ++
™
;

508 
	`CHECK
(
hh
["Crap"] == 1);

509 
	`CHECK
(
hh
["Crang"] == 3);

510 
	`CHECK
(
hh
["Dumb"] == 3);

511 
	`CHECK
(
h
.
	`fšd
("Crud"è=ğh.
	`’d
());

512 
	`CHECK
(
hh
.
	`fšd
("Crud"è=ğhh.
	`’d
());

514 #ià
CLICK_USERLEVEL


515 
MAP_S2I
 
m­
;

517 
ru§ge
 
ru0
, 
ru1
;

518 
Time¡amp
 
ts0
, 
ts1
;

519 ià(
	`g‘ru§ge
(
RUSAGE_SELF
, &
ru0
) < 0)

520  
”rh
->
	`”rÜ
("ru§ge: %s", 
	`¡»¼Ü
(
”ºo
));

521 
ts0
.
	`assign_now
();

523 
i
 = 0; i < 100; i++) {

524 
m­
.
	`ş—r
();

525 cÚ¡ * cÚ¡ *
s
 = 
şas£s
; *s; s++)

526 
	`MAP_INSERT
(
m­
, *
s
, s - 
şas£s
);

527 cÚ¡ * cÚ¡ *
s
 = 
şas£s
; *s; s++)

528 
	`MAP_INSERT
(
m­
, *
s
 + 1, s - 
şas£s
 + 1000);

529 cÚ¡ * cÚ¡ *
s
 = 
şas£s
; *s; s++)

530 
	`MAP_INSERT
(
m­
, *
s
 + 2, s - 
şas£s
 + 2000);

531 
v®ue
 = 0;

532 cÚ¡ * cÚ¡ *
s
 = 
şas£s
; *s; s++)

533 
v®ue
 +ğ
	`MAP_FIND_VALUE
(
m­
, *
s
);

534 cÚ¡ * cÚ¡ *
s
 = 
şas£s
; *s; s++)

535 
v®ue
 +ğ
	`MAP_FIND_VALUE
(
m­
, *
s
 + 1);

536 cÚ¡ * cÚ¡ *
s
 = 
şas£s
; *s; s++)

537 
v®ue
 +ğ
	`MAP_FIND_VALUE
(
m­
, *
s
 + 2);

538 cÚ¡ * cÚ¡ *
s
 = 
nÚşas£s
; *s; s++)

539 
v®ue
 +ğ
	`MAP_FIND_VALUE
(
m­
, *
s
);

542 ià(
	`g‘ru§ge
(
RUSAGE_SELF
, &
ru1
) < 0)

543  
”rh
->
	`”rÜ
("ru§ge: %s", 
	`¡»¼Ü
(
”ºo
));

544 
ts1
.
	`assign_now
();

546 
Time¡amp
 
ru_d–
 = 
	`Time¡amp
(
ru1
.
ru_utime
è- Time¡amp(
ru0
.ru_utime);

547 
ts1
 -ğ
ts0
;

548 
”rh
->
	`mes§ge
("Time: %p{time¡amp}u %p{time¡amp}Ù® %u/%u", &
ru_d–
, &
ts1
, 
m­
.
	`size
(), m­.
	`buck‘_couÁ
());

552 
bÏh
[] = "Hello,his is‡ story I willell.\0\0\0\0";

553 
size_t
 
l
 = 
	`¡¾’
(
bÏh
);

554 
hashcode_t
 
a
 = 
SŒšg
::
	`hashcode
(
bÏh
, bÏh + 
l
);

555 
	`memmove
(
bÏh
 + 1, bÏh, 
l
);

556 
hashcode_t
 
b
 = 
SŒšg
::
	`hashcode
(
bÏh
 + 1, bÏh + 
l
 + 1);

557 
	`memmove
(
bÏh
 + 2, bÏh + 1, 
l
);

558 
hashcode_t
 
c
 = 
SŒšg
::
	`hashcode
(
bÏh
 + 2, bÏh + 
l
 + 2);

559 
	`memmove
(
bÏh
 + 3, bÏh + 2, 
l
);

560 
hashcode_t
 
d
 = 
SŒšg
::
	`hashcode
(
bÏh
 + 3, bÏh + 
l
 + 3);

561 
	`CHECK
(
a
 =ğ
b
);

562 
	`CHECK
(
a
 =ğ
c
);

563 
	`CHECK
(
a
 =ğ
d
);

567 
HashTabË
<
SŒšg
, > 
htx
;

568 
htx
["Hello"] = 1;

569 ià(!
htx
["Goodbye"])

570 
htx
["Goodbye"] = 2;

571 
	`CHECK
(
htx
["NOT IN TABLE"] == 0);

572 
	`CHECK
(
htx
["Hello"] == 1);

573 
	`CHECK
(
htx
["Goodbye"] == 2);

576 
”rh
->
	`mes§ge
("Allests…ass!");

578 
	}
}

580 
	$EXPORT_ELEMENT
(
HashTabËTe¡
)

581 
CLICK_ENDDECLS


	@test/hashtabletest.hh

2 #iâdeà
CLICK_HASHTABLETEST_HH


3 
	#CLICK_HASHTABLETEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


23 şas 
	cHashTabËTe¡
 : 
public
 
EËm’t
 {…ublic:

25 
	$HashTabËTe¡
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "HashTableTest"; }

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

31 
	}
};

33 
	gCLICK_ENDDECLS


	@test/heaptest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"h—±e¡.hh
"

21 
	~<şick/h—p.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/·œ.hh
>

24 
CLICK_DECLS


26 
	gH—pTe¡
::
	$H—pTe¡
()

28 
	}
}

30 
	#CHECK
(
x
èià(!(x)è 
”rh
->
	`”rÜ
("%s:%d:e¡ %<%s%> faed", 
__FILE__
, 
__LINE__
, #x);

	)

31 
	#CHECK_PLACE
(
v
è
iii
 = 0; ii˜< (v).
	`size
(); ++iiièià((v)[iii].
£cÚd
 !ğiiiè 
”rh
->
	`”rÜ
("%s:%d:…Ïû faed‡ˆpos™iÚ %d", 
__FILE__
, 
__LINE__
, iii);

	)

33 
	gÇme¥aû
 {

34 
	s¶aû_šaœ
 {

35 
İ”©Ü
()(
	gPaœ
<, > *
	gbegš
, Paœ<, > *
	gx
) {

36 
	gx
->
	g£cÚd
 = 
x
 - 
begš
;

42 
	gH—pTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

44 
VeùÜ
<> 
v
;

45 
Ëss
<> 
l
;

47 
v
.
	`push_back
(0);

48 
	`push_h—p
(
v
.
	`begš
(), v.
	`’d
(), 
l
);

50 
v
.
	`push_back
(-1);

51 
	`push_h—p
(
v
.
	`begš
(), v.
	`’d
(), 
l
);

52 
	`CHECK
(
v
[0] == -1);

53 
	`CHECK
(
v
[1] == 0);

55 
v
.
	`push_back
(1);

56 
	`push_h—p
(
v
.
	`begš
(), v.
	`’d
(), 
l
);

57 
	`CHECK
(
v
[0] == -1);

58 
	`CHECK
(
v
[1] == 0);

59 
	`CHECK
(
v
[2] == 1);

61 
	`pİ_h—p
(
v
.
	`begš
(), v.
	`’d
(), 
l
);

62 
	`CHECK
(
v
[0] == 0);

63 
	`CHECK
(
v
[1] == 1);

64 
	`CHECK
(
v
[2] == -1);

65 
v
.
	`pİ_back
();

67 
v
.
	`push_back
(10);

68 
	`push_h—p
(
v
.
	`begš
(), v.
	`’d
(), 
l
);

69 
v
.
	`push_back
(8);

70 
	`push_h—p
(
v
.
	`begš
(), v.
	`’d
(), 
l
);

71 
	`CHECK
(
v
[0] == 0);

72 
	`CHECK
(
v
[1] == 1);

73 
	`CHECK
(
v
[2] == 10);

74 
	`CHECK
(
v
[3] == 8);

76 
v
[2] = -2;

77 
	`chªge_h—p
(
v
.
	`begš
(), v.
	`’d
(), v.begš(è+ 2, 
l
);

78 
	`CHECK
(
v
[0] == -2);

79 
	`CHECK
(
v
[1] == 1);

80 
	`CHECK
(
v
[2] == 0);

81 
	`CHECK
(
v
[3] == 8);

83 
	`pİ_h—p
(
v
.
	`begš
(), v.
	`’d
(), 
l
);

84 
	`CHECK
(
v
[0] == 0);

85 
	`CHECK
(
v
[1] == 1);

86 
	`CHECK
(
v
[2] == 8);

87 
	`CHECK
(
v
[3] == -2);

90 
VeùÜ
<
Paœ
<, > > 
vv
;

91 
Ëss
<
Paœ
<, > > 
Î
;

92 
¶aû_šaœ
 
¶aû
;

94 
vv
.
	`push_back
(
	`make_·œ
(0, -9));

95 
	`push_h—p
(
vv
.
	`begš
(), vv.
	`’d
(), 
Î
, 
¶aû
);

96 
	`CHECK_PLACE
(
vv
);

98 
vv
.
	`push_back
(
	`make_·œ
(-1, -9));

99 
	`push_h—p
(
vv
.
	`begš
(), vv.
	`’d
(), 
Î
, 
¶aû
);

100 
	`CHECK
(
vv
[0].
fœ¡
 == -1);

101 
	`CHECK
(
vv
[1].
fœ¡
 == 0);

102 
	`CHECK_PLACE
(
vv
);

104 
vv
.
	`push_back
(
	`make_·œ
(1, -9));

105 
	`push_h—p
(
vv
.
	`begš
(), vv.
	`’d
(), 
Î
, 
¶aû
);

106 
	`CHECK
(
vv
[0].
fœ¡
 == -1);

107 
	`CHECK
(
vv
[1].
fœ¡
 == 0);

108 
	`CHECK
(
vv
[2].
fœ¡
 == 1);

109 
	`CHECK_PLACE
(
vv
);

111 
	`pİ_h—p
(
vv
.
	`begš
(), vv.
	`’d
(), 
Î
, 
¶aû
);

112 
	`CHECK
(
vv
[0].
fœ¡
 == 0);

113 
	`CHECK
(
vv
[1].
fœ¡
 == 1);

114 
	`CHECK
(
vv
[2].
fœ¡
 == -1);

115 
vv
.
	`pİ_back
();

116 
	`CHECK_PLACE
(
vv
);

118 
vv
.
	`push_back
(
	`make_·œ
(10, -9));

119 
	`push_h—p
(
vv
.
	`begš
(), vv.
	`’d
(), 
Î
, 
¶aû
);

120 
	`CHECK_PLACE
(
vv
);

121 
vv
.
	`push_back
(
	`make_·œ
(8, -9));

122 
	`push_h—p
(
vv
.
	`begš
(), vv.
	`’d
(), 
Î
, 
¶aû
);

123 
	`CHECK
(
vv
[0].
fœ¡
 == 0);

124 
	`CHECK
(
vv
[1].
fœ¡
 == 1);

125 
	`CHECK
(
vv
[2].
fœ¡
 == 10);

126 
	`CHECK
(
vv
[3].
fœ¡
 == 8);

127 
	`CHECK_PLACE
(
vv
);

129 
vv
[2].
fœ¡
 = -2;

130 
	`chªge_h—p
(
vv
.
	`begš
(), vv.
	`’d
(), vv.begš(è+ 2, 
Î
, 
¶aû
);

131 
	`CHECK
(
vv
[0].
fœ¡
 == -2);

132 
	`CHECK
(
vv
[1].
fœ¡
 == 1);

133 
	`CHECK
(
vv
[2].
fœ¡
 == 0);

134 
	`CHECK
(
vv
[3].
fœ¡
 == 8);

135 
	`CHECK_PLACE
(
vv
);

137 
	`pİ_h—p
(
vv
.
	`begš
(), vv.
	`’d
(), 
Î
, 
¶aû
);

138 
	`CHECK
(
vv
[0].
fœ¡
 == 0);

139 
	`CHECK
(
vv
[1].
fœ¡
 == 1);

140 
	`CHECK
(
vv
[2].
fœ¡
 == 8);

141 
	`CHECK
(
vv
[3].
fœ¡
 == -2);

142 
vv
.
	`pİ_back
();

143 
	`CHECK_PLACE
(
vv
);

145 
	`»move_h—p
(
vv
.
	`begš
(), vv.
	`’d
(), vv.begš(è+ 1, 
Î
, 
¶aû
);

146 
	`CHECK
(
vv
[0].
fœ¡
 == 0);

147 
	`CHECK
(
vv
[1].
fœ¡
 == 8);

148 
	`CHECK
(
vv
[2].
fœ¡
 == 1);

149 
vv
.
	`pİ_back
();

150 
	`CHECK_PLACE
(
vv
);

153 
VeùÜ
<> 
pq
;

155 
pq
.
	`push_back
(0);

156 
	`push_h—p
(
pq
.
	`begš
(),…q.
	`’d
(), 
l
);

158 
pq
.
	`push_back
(-1);

159 
	`push_h—p
(
pq
.
	`begš
(),…q.
	`’d
(), 
l
);

160 
	`CHECK
(
pq
[0] == -1);

161 
	`CHECK
(
pq
[1] == 0);

163 
pq
.
	`push_back
(1);

164 
	`push_h—p
(
pq
.
	`begš
(),…q.
	`’d
(), 
l
);

165 
	`CHECK
(
pq
[0] == -1);

166 
	`CHECK
(
pq
[1] == 0);

167 
	`CHECK
(
pq
[2] == 1);

169 
	`pİ_h—p
(
pq
.
	`begš
(),…q.
	`’d
(), 
l
);

170 
pq
.
	`pİ_back
();

171 
	`CHECK
(
pq
[0] == 0);

172 
	`CHECK
(
pq
[1] == 1);

173 
	`CHECK
(
pq
.
	`size
() == 2);

175 
pq
.
	`push_back
(10);

176 
	`push_h—p
(
pq
.
	`begš
(),…q.
	`’d
(), 
l
);

177 
pq
.
	`push_back
(8);

178 
	`push_h—p
(
pq
.
	`begš
(),…q.
	`’d
(), 
l
);

179 
	`CHECK
(
pq
[0] == 0);

180 
	`CHECK
(
pq
[1] == 1);

181 
	`CHECK
(
pq
[2] == 10);

182 
	`CHECK
(
pq
[3] == 8);

183 
	`CHECK
(
pq
.
	`size
() == 4);

185 
pq
[2] = -2;

186 
	`chªge_h—p
(
pq
.
	`begš
(),…q.
	`’d
(),…q.begš(è+ 2, 
l
);

187 
	`CHECK
(
pq
[0] == -2);

188 
	`CHECK
(
pq
[1] == 1);

189 
	`CHECK
(
pq
[2] == 0);

190 
	`CHECK
(
pq
[3] == 8);

192 
	`pİ_h—p
(
pq
.
	`begš
(),…q.
	`’d
(), 
l
);

193 
pq
.
	`pİ_back
();

194 
	`CHECK
(
pq
[0] == 0);

195 
	`CHECK
(
pq
[1] == 1);

196 
	`CHECK
(
pq
[2] == 8);

197 
	`CHECK
(
pq
.
	`size
() == 3);

200 
”rh
->
	`mes§ge
("Allests…ass!");

202 
	}
}

204 
	$EXPORT_ELEMENT
(
H—pTe¡
)

205 
CLICK_ENDDECLS


	@test/heaptest.hh

2 #iâdeà
CLICK_HEAPTEST_HH


3 
	#CLICK_HEAPTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


23 şas 
	cH—pTe¡
 : 
public
 
EËm’t
 {…ublic:

25 
	$H—pTe¡
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "HeapTest"; }

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

31 
	}
};

33 
	gCLICK_ENDDECLS


	@test/jsontest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"jsÚ‹¡.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~"–em’ts/jsÚ/jsÚ.hh
"

23 
CLICK_DECLS


25 
	gJsÚTe¡
::
	$JsÚTe¡
()

27 
	}
}

29 
	#CHECK
(
x
èià(!(x)è 
”rh
->
	`”rÜ
("%s:%d:e¡ %<%s%> faed", 
__FILE__
, 
__LINE__
, #x);

	)

32 
	gJsÚTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

34 
JsÚ
 
j
;

35 
	`CHECK
(
j
.
	`em±y
());

36 
	`CHECK
(!
j
);

38 
j
 = 
JsÚ
::
	`make_objeù
();

39 
	`CHECK
(
j
.
	`em±y
());

40 
	`CHECK
(
j
);

42 
j
.
	`£t
("foo", "bar");

43 
	`CHECK
(
j
["foo"]);

44 
	`CHECK
(
j
["foo"].
	`to_s
() == "bar");

45 
	`CHECK
(
j
.
	`size
() == 1);

47 
j
.
	`£t
("baz", "flim");

48 
	`CHECK
(
j
.
	`size
() == 2);

49 
	`CHECK
(
j
.
	`uÅ¬£
() == "{\"foo\":\"bar\",\"baz\":\"flim\"}");

51 
j
.
	`”a£
("foo");

52 
	`CHECK
(
j
.
	`size
() == 1);

54 
j
.
	`assign_·r£
("2");

55 
	`CHECK
(
j
 == 2);

57 
j
.
	`assign_·r£
("null");

58 
	`CHECK
(
j
 =ğ
	`JsÚ
());

60 
j
.
	`assign_·r£
("\"a\"");

61 
	`CHECK
(
j
 == "a");

63 
j
.
	`assign_·r£
("[1,2]");

64 
	`CHECK
(
j
.
	`uÅ¬£
() == "[1,2]");

66 
j
.
	`assign_·r£
("[[[]],{\"a\":{}}]");

67 
	`CHECK
(
j
.
	`uÅ¬£
() == "[[[]],{\"a\":{}}]");

69 
j
 = 
JsÚ
::
	`·r£
("{\"x22\":{\n\
\"git-revision\":\"ebbd3d4767847300f552b181a10bda57a926f554M\",\n\
\"time\":\"Tue Feb 7 20:20:33 2012\",\n\
\"machine\":\"rtshanks-laptop\",\n\
\"cores\":2,\n\
\"runs\":[\"x22\\/rw2\\/mb\\/0\"]\n\
},\n\
\"x23\":{\n\
\"git-revision\":\"ebbd3d4767847300f552b181a10bda57a926f554M\",\n\
\"time\":\"Tue Feb 7 20:31:05 2012\",\n\
\"machine\":\"rtshanks-laptop\",\n\
\"cores\":2,\n\
\"runs\":[\"x23\\/rw2\\/mb\\/0\",\"x23\\/rw1\\/mb\\/0\",\"x23\\/rw3\\/mb\\/0\"]\n\
},\n\
\"x24\":{\n\
\"git-revision\":\"62e9970ca8ae9c6eebf2d71b7065ea694fb25282M\",\n\
\"time\":\"Sat Feb 11 15:54:01 2012\",\n\
\"machine\":\"rtshanks-laptop\",\n\
\"cores\":2,\n\
\"runs\":[\"x24\\/rw1\\/b\\/0\"]\n\
},\"b\":\"c\",\"c\":\"d\"}");

90 
	`CHECK
(
j
["x22"]["time"] == "Tue Feb 7 20:20:33 2012");

91 
	`CHECK
(
j
["x22"]["cores"] == 2);

93 
JsÚ
::
objeù_™”©Ü
 
™
 = 
j
.
	`obegš
();

94 
	`CHECK
(
™
.
	`key
() == "x22");

95 ++
™
;

96 
	`CHECK
(
™
.
	`key
() == "x23");

97 ++
™
;

98 
	`CHECK
(
™
.
	`key
() == "x24");

99 ++
™
;

100 
	`CHECK
(
™
.
	`key
() == "b");

101 ++
™
;

102 
	`CHECK
(
™
.
	`key
() == "c");

106 
JsÚ
 
jcİy
 = 
j
;

107 
	`CHECK
(
j
.
	`size
() == 5);

108 
couÁ
 = 0;

109 
JsÚ
::
™”©Ü
 
™
 = 
jcİy
.
	`begš
(); iˆ!ğjcİy.
	`’d
(); ++it) {

110 
™
->
£cÚd
 = 
	`JsÚ
();

111 ++
couÁ
;

113 
	`CHECK
(!
jcİy
["x22"]);

114 
	`CHECK
(
j
["x22"]["cores"] == 2);

115 
	`CHECK
(
couÁ
 =ğ
jcİy
.
	`size
());

118 
	`CHECK
(!
j
["x49"]);

119 
	`CHECK
(
j
.
	`size
() == 5);

120 
	`CHECK
(!
j
["x49"]["45"][2]["a"]);

121 
	`CHECK
(
j
.
	`size
() == 5);

122 
j
["x49"]["45"][2]["a"] = 1;

123 
	`CHECK
(
j
.
	`size
() == 6);

124 
	`CHECK
(
j
["x22"].
	`is_objeù
(è&& j.
	`g‘
("x22").is_object());

125 
	`CHECK
(
j
["x23"].
	`is_objeù
(è&& j.
	`g‘
("x23").is_object());

126 
	`CHECK
(
j
["b"].
	`is_¡ršg
(è&& j.
	`g‘
("b").is_string());

127 
	`CHECK
(
j
["x49"].
	`is_objeù
(è&& j.
	`g‘
("x49").is_object());

128 
	`CHECK
(
j
["x49"]["45"].
	`is_¬¿y
());

129 
	`CHECK
(
j
["x49"]["45"].
	`size
(è=ğ3 && j["x49"]["45"][2].
	`is_objeù
());

131 
j
 = 
JsÚ
::
	`make_objeù
();

132 
j
["a"] = j["b"];

133 
	`CHECK
(
j
.
	`size
() == 1);

134 
	`CHECK
(
j
["a"].
	`is_nuÎ
());

135 
	`CHECK
(
j
.
	`couÁ
("a") == 1);

137 
JsÚ
 
k
 = JsÚ::
	`make_¬¿y
();

139 
	`CHECK
(
k
.
	`size
() == 0);

140 
JsÚ
::
¬¿y_™”©Ü
 
™
 = 
k
.
	`abegš
();

141 
	`CHECK
(!
™
.
	`live
());

143 
j
 = 
JsÚ
::
	`make_objeù
();

144 
j
["a"] = 
k
[2];

145 
	`CHECK
(
j
.
	`size
() == 1);

146 
	`CHECK
(
k
.
	`size
() == 0);

147 
	`CHECK
(
j
["a"].
	`is_nuÎ
());

148 
	`CHECK
(
j
.
	`couÁ
("a") == 1);

150 
j
 = 
	`JsÚ
(1);

151 
	`CHECK
(
j
.
	`g‘
("a").
	`is_nuÎ
());

153 
j
.
	`assign_·r£
("{\"a\":1,\"b\":true,\"c\":\"\"}");

155 
i
 = 0;

156 
boŞ
 
b
 = 
çl£
;

157 
SŒšg
 
s
;

158 
	`CHECK
(
j
.
	`g‘
("a", 
i
));

159 
	`CHECK
(
i
 == 1);

160 
	`CHECK
(
j
.
	`g‘
("a", 
i
).g‘("b", 
b
));

161 
	`CHECK
(
b
 =ğ
Œue
);

162 
	`CHECK
(!
j
.
	`g‘
("a", 
s
).
	`¡©us
());

163 
	`CHECK
(!
j
.
	`g‘
("a", 
s
).
	`¡©us
(
b
));

164 
	`CHECK
(
b
 =ğ
çl£
);

165 
	`CHECK
(
j
.
	`g‘
("a", 
k
));

166 
	`CHECK
(
k
 =ğ
	`JsÚ
(1));

167 
	`CHECK
(!
j
.
	`g‘
("cc", 
k
));

170 
j
["a"] = 
	`JsÚ
(5);

171 
j
.
	`£t
("a", 
	`JsÚ
(5));

172 
j
["b"] = 
JsÚ
::
	`·r£
("[]");

175 
JsÚ
 
j1
 = JsÚ::
	`make_objeù
(), 
j2
 = Json::make_object();

176 
j1
.
	`£t
("a", 
j2
);

177 
j2
.
	`£t
("b", 1);

178 
	`CHECK
(
j1
.
	`uÅ¬£
() == "{\"a\":{}}");

179 
	`CHECK
(
j2
.
	`uÅ¬£
() == "{\"b\":1}");

183 
JsÚ
 
j
 = JsÚ::
	`·r£
("{\"a\":true}");

184 ià(
j
["foo"]["bar"])

185 
	`CHECK
(
çl£
);

186 
	`CHECK
(
j
.
	`uÅ¬£
() == "{\"a\":true}");

187 
j
["foo"]["b¬"] = 
Œue
;

188 
	`CHECK
(
j
.
	`uÅ¬£
() == "{\"a\":true,\"foo\":{\"bar\":true}}");

189 
j
["a"]["2"] = 
çl£
;

190 
	`CHECK
(
j
.
	`uÅ¬£
() == "{\"a\":{\"2\":false},\"foo\":{\"bar\":true}}");

191 
j
[3] = 
Œue
;

192 
	`CHECK
(
j
.
	`uÅ¬£
() == "{\"a\":{\"2\":false},\"foo\":{\"bar\":true},\"3\":true}");

193 
	`CHECK
(
j
[3] =ğ
	`JsÚ
(
Œue
));

194 
j
 = 
JsÚ
::
	`·r£
("[1,2,3,4]");

195 
	`CHECK
(
j
["2"] =ğ
	`JsÚ
(3));

196 
	`CHECK
(
j
.
	`uÅ¬£
() == "[1,2,3,4]");

197 
j
["a"] = 
Œue
;

198 
	`CHECK
(
j
.
	`uÅ¬£
() == "{\"0\":1,\"1\":2,\"2\":3,\"3\":4,\"a\":true}");

199 
	`CHECK
(
j
["2"] =ğ
	`JsÚ
(3));

203 
JsÚ
 
j
 = JsÚ::
	`·r£
("{}");

204 
j
.
	`£t
("foo", 
SŒšg
::
	`make_out_of_memÜy
()).set(String::make_out_of_memory(), 2);

205 
	`CHECK
(
j
.
	`uÅ¬£
() == "{\"foo\":\"\360\237\222\243ENOMEM\360\237\222\243\",\"\360\237\222\243ENOMEM\360\237\222\243\":2}");

208 
”rh
->
	`mes§ge
("Allests…ass!");

210 
	}
}

212 
CLICK_ENDDECLS


213 
	$ELEMENT_REQUIRES
(
JsÚ
)

214 
	`EXPORT_ELEMENT
(
JsÚTe¡
)

	@test/jsontest.hh

2 #iâdeà
CLICK_JSONTEST_HH


3 
	#CLICK_JSONTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


23 şas 
	cJsÚTe¡
 : 
public
 
EËm’t
 {…ublic:

25 
	$JsÚTe¡
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "JsonTest"; }

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

31 
	}
};

33 
	gCLICK_ENDDECLS


	@test/listtest.cc

18 
	~<şick/cÚfig.h
>

19 
	~"li¡‹¡.hh
"

20 
	~<şick/li¡.hh
>

21 
	~<şick/”rÜ.hh
>

22 #ià
CLICK_USERLEVEL


23 
	~<sys/time.h
>

24 
	~<sys/»sourû.h
>

25 
	~<uni¡d.h
>

27 
CLICK_DECLS


29 
	gLi¡Te¡
::
	$Li¡Te¡
()

31 
	}
}

33 
Çme¥aû
 {

34 
	s¡ršgli¡’Œy
 {

35 
SŒšg
 
s
;

36 
	gLi¡_memb”
<
	g¡ršgli¡’Œy
> 
	glšk
;

37 
¡ršgli¡’Œy
() {

39 
¡ršgli¡’Œy
(cÚ¡ 
SŒšg
 &
¡r
)

40 : 
s
(
¡r
) {

44 
	gLi¡
<
	t¡ršgli¡’Œy
, &¡ršgli¡’Œy::
	tlšk
> 
	t¡ršgli¡
;

47 
	#CHECK
(
x
èià(!(x)è 
”rh
->
	`”rÜ
("%s:%d:e¡ `%s' faed", 
__FILE__
, 
__LINE__
, #x)

	)

48 
	#CHECKI
(
x
, 
i
èià(!(x)è 
”rh
->
	`”rÜ
("%s:%d:e¡ `%s' (%dèçed", 
__FILE__
, 
__LINE__
, #x, i)

	)

51 
	gLi¡Te¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

53 
¡ršgli¡’Œy
 
x
[12];

54 
x
[0].
s
 = "A";

55 
x
[1].
s
 = "B";

56 
x
[2].
s
 = "Anne Elizabeth Dudfield";

57 
x
[3].
s
 = "facker";

58 
x
[4].
s
 = "McArdle";

59 
x
[5].
s
 = "Zoom";

60 
x
[6].
s
 = "==++";

62 
¡ršgli¡
 
l
;

63 
i
 = 0; i < 7; ++i)

64 
l
.
	`push_back
(&
x
[
i
]);

66 
i
 = 0;

67 
¡ršgli¡
::
™”©Ü
 
™
 = 
l
.
	`begš
(); iˆ!ğl.
	`’d
(); ++™, ++
i
)

68 
	`CHECKI
(
™
->
s
 =ğ
x
[
i
].s, i);

69 
	`CHECK
(
l
.
	`size
() == 7);

70 
	`CHECK
(
i
 == 7);

72 
l
.
	`pİ_back
();

73 
i
 = 0;

74 
¡ršgli¡
::
™”©Ü
 
™
 = 
l
.
	`begš
(); iˆ!ğl.
	`’d
(); ++™, ++
i
)

75 
	`CHECKI
(
™
->
s
 =ğ
x
[
i
].s, i);

76 
	`CHECK
(
l
.
	`size
() == 6);

77 
	`CHECK
(
i
 == 6);

79 
l
.
	`pİ_äÚt
();

80 
i
 = 0;

81 
¡ršgli¡
::
™”©Ü
 
™
 = 
l
.
	`begš
(); iˆ!ğl.
	`’d
(); ++™, ++
i
)

82 
	`CHECKI
(
™
->
s
 =ğ
x
[
i
 + 1].s, i);

83 
	`CHECK
(
l
.
	`size
() == 5);

84 
	`CHECK
(
i
 == 5);

86 
l
.
	`”a£
Ö.
	`begš
() + 2);

87 
i
 = 0;

88 
¡ršgli¡
::
™”©Ü
 
™
 = 
l
.
	`begš
(); iˆ!ğl.
	`’d
(); ++™, ++
i
)

89 
	`CHECKI
(
™
->
s
 =ğ
x
[
i
 < 2 ? i + 1 : i + 2].s, i);

90 
	`CHECK
(
l
.
	`size
() == 4);

91 
	`CHECK
(
i
 == 4);

93 
l
.
	`ş—r
();

94 
	`CHECK
(
l
.
	`size
() == 0);

96 
i
 = 3; i >= 0; --i)

97 
l
.
	`push_äÚt
(&
x
[
i
]);

98 
	`CHECK
(
l
.
	`size
() == 4);

100 
i
 = 0;

101 
¡ršgli¡
::
™”©Ü
 
™
 = 
l
.
	`’d
(è- 1; iˆ!ğl.
	`begš
(); ++
i
) {

102 --
™
;

103 
	`CHECKI
(
™
->
s
 =ğ
x
[2 - 
i
].s, i);

105 
	`CHECK
(
i
 == 3);

107 
”rh
->
	`mes§ge
("Allests…ass!");

109 
	}
}

111 
	$EXPORT_ELEMENT
(
Li¡Te¡
)

112 
CLICK_ENDDECLS


	@test/listtest.hh

1 #iâdeà
CLICK_LISTTEST_HH


2 
	#CLICK_LISTTEST_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


22 şas 
	cLi¡Te¡
 : 
public
 
EËm’t
 {…ublic:

24 
	$Li¡Te¡
(è
CLICK_COLD
;

26 cÚ¡ *
	$şass_Çme
() const {  "ListTest"; }

28 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

30 
	}
};

32 
	gCLICK_ENDDECLS


	@test/mtdietest.cc

20 
	~<şick/cÚfig.h
>

21 
	~"mtd›‹¡.hh
"

22 
	~<şick/glue.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/ma¡”.hh
>

26 
CLICK_DECLS


28 
	gMTD›Te¡
::
	$MTD›Te¡
()

29 : 
	$_sk
()

31 
	}
}

34 
MTD›Te¡
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

36 
	g_Áh»ads
 = 
ma¡”
()->
Áh»ads
();

37 ià(
Args
(
cÚf
, 
this
, 
”rh
)

38 .
»ad
("NTHREADS", 
_Áh»ads
)

39 .
com¶‘e
() < 0)

45 
	gMTD›Te¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

47 
_sk
.
	`»size
(
_Áh»ads
);

48 
i
 = 0; i < 
_Áh»ads
; i++) {

49 
_sk
[
i
] = 
Ãw
 
	`Task
(
this
);

50 
_sk
[
i
]->
	`š™Ÿlize
(
this
, 
çl£
);

51 
_sk
[
i
]->
	`move_th»ad
(i);

52 
_sk
[
i
]->
	`»scheduË
();

55 
	}
}

58 
	gMTD›Te¡
::
	$ş—nup
(
CËªupSge
) {

59 
i
 = 0; i < 
_sk
.
	`size
(); ++i)

60 
d–‘e
 
_sk
[
i
];

61 
	}
}

63 
boŞ


64 
	gMTD›Te¡
::
	$run_sk
(
Task
 *)

66 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

67  
çl£
;

68 
	}
}

71 
CLICK_ENDDECLS


72 
EXPORT_ELEMENT
(
MTD›Te¡
)

	@test/mtdietest.hh

2 #iâdeà
CLICK_MTDIETEST_HH


3 
	#CLICK_MTDIETEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
CLICK_DECLS


19 şas 
	cMTD›Te¡
 : 
public
 
EËm’t
 {…ublic:

21 
	$MTD›Te¡
(è
CLICK_COLD
;

23 cÚ¡ *
	$şass_Çme
() const {  "MTDieTest"; }

25 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

26 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

27 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

28 
boŞ
 
	`run_sk
(
Task
 *
t
);

30 
´iv©e
:

31 
VeùÜ
<
Task
*> 
_sk
;

32 
_Áh»ads
;

33 
	}
};

35 
	gCLICK_ENDDECLS


	@test/neighborhoodtest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"ÃighbÜhood‹¡.hh
"

21 
	~<şick/¡¿ccum.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/rou‹rvis™Ü.hh
>

25 
	~<şick/”rÜ.hh
>

26 
CLICK_DECLS


28 
	gNeighbÜhoodTe¡
::
	$NeighbÜhoodTe¡
()

30 
	}
}

32 
Pack‘
 *

33 
NeighbÜhoodTe¡
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

35 
p
->
	`kl
();

37 
	}
}

40 
	gNeighbÜhoodTe¡
::
	$hªdËr
(, 
SŒšg
 &
d©a
, 
EËm’t
 *
–em’t
,

41 cÚ¡ 
HªdËr
 *
hªdËr
, 
E¼ÜHªdËr
 *
”rh
)

43 
	`ı_uncomm’t
(
d©a
);

44 
dŸm‘”
 = 1;

45 ià(
d©a
 && !
	`IÁArg
().
	`·r£
(d©a, 
dŸm‘”
))

46  
”rh
->
	`”rÜ
("syntaxƒrror");

47 
EËm’tNeighbÜhoodT¿ck”
 
	`Œack”
(
–em’t
->
	`rou‹r
(), 
dŸm‘”
);

48 
šŒ_t
 
pÜt
 = (šŒ_tè
hªdËr
->
	`wr™e_u£r_d©a
();

49 ià(
hªdËr
->
	`»ad_u£r_d©a
())

50 
–em’t
->
	`rou‹r
()->
	`vis™_down¡»am
ÓËm’t, 
pÜt
, &
Œack”
);

52 
–em’t
->
	`rou‹r
()->
	`vis™_up¡»am
ÓËm’t, 
pÜt
, &
Œack”
);

53 
SŒšgAccum
 
§
;

54 
i
 = 0; i < 
Œack”
.
	`size
(); ++i)

55 
§
 << 
Œack”
[
i
]->
	`Çme
() << '\n';

56 
d©a
 = 
§
.
	`ke_¡ršg
();

58 
	}
}

61 
	gNeighbÜhoodTe¡
::
	$add_hªdËrs
()

63 
i
 = -1; i < 
	`nšputs
(); ++i)

64 
	`£t_hªdËr
("up¡»am" + (
i
 < 0 ? 
	`SŒšg
(è: SŒšg(i)), 
HªdËr
::
OP_READ
 | HªdËr::
READ_PARAM
, 
hªdËr
, 0, i);

65 
o
 = -1; o < 
	`nouuts
(); ++o)

66 
	`£t_hªdËr
("down¡»am" + (
o
 < 0 ? 
	`SŒšg
(è: SŒšg(o)), 
HªdËr
::
OP_READ
 | HªdËr::
READ_PARAM
, 
hªdËr
, 1, o);

67 
	}
}

69 
CLICK_ENDDECLS


70 
EXPORT_ELEMENT
(
NeighbÜhoodTe¡
)

	@test/neighborhoodtest.hh

2 #iâdeà
CLICK_NEIGHBORHOODTEST_HH


3 
	#CLICK_NEIGHBORHOODTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/tim”.hh
>

6 
CLICK_DECLS


26 şas 
	cNeighbÜhoodTe¡
 : 
public
 
EËm’t
 {…ublic:

28 
	$NeighbÜhoodTe¡
(è
CLICK_COLD
;

30 cÚ¡ *
	$şass_Çme
() const {  "NeighborhoodTest"; }

31 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "-/-"; 
	}
}

32 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

34 
	$add_hªdËrs
(è
CLICK_COLD
;

36 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

38 
´iv©e
:

40 
	`hªdËr
(
İ”©iÚ
, 
SŒšg
 &
d©a
, 
EËm’t
 *
–em’t
,

41 cÚ¡ 
HªdËr
 *
hªdËr
, 
E¼ÜHªdËr
 *
”rh
);

43 
	}
};

45 
	gCLICK_ENDDECLS


	@test/notifierdebug.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/cÚå¬£.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~"nÙif›rdebug.hh
"

24 
CLICK_DECLS


26 
	gNÙif›rDebug
::
	$NÙif›rDebug
()

28 
	}
}

31 
NÙif›rDebug
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

33 ià(
	`šput_is_push
(0))

34 
_sigÇl
 = 
NÙif›r
::
	`down¡»am_fuÎ_sigÇl
(
this
, 0);

36 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0);

38 
	}
}

40 
Pack‘
 *

41 
	gNÙif›rDebug
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

43  
p
;

44 
	}
}

46 
SŒšg


47 
	gNÙif›rDebug
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *)

49 
NÙif›rDebug
 *
nd
 = 
¡©ic_ÿ¡
<NÙif›rDebug *>(
e
);

50  
nd
->
_sigÇl
.
	`uÅ¬£
Òd->
	`rou‹r
());

51 
	}
}

54 
	gNÙif›rDebug
::
	$add_hªdËrs
()

56 
	`add_»ad_hªdËr
("sigÇl", 
»ad_hªdËr
);

57 
	}
}

59 
CLICK_ENDDECLS


60 
EXPORT_ELEMENT
(
NÙif›rDebug
)

	@test/notifierdebug.hh

1 #iâdeà
CLICK_NOTIFIERDEBUG_HH


2 
	#CLICK_NOTIFIERDEBUG_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/nÙif›r.hh
>

5 
CLICK_DECLS


25 şas 
	cNÙif›rDebug
 : 
public
 
EËm’t
 {…ublic:

27 
	$NÙif›rDebug
(è
CLICK_COLD
;

29 cÚ¡ *
	$şass_Çme
() const {  "NotifierDebug"; }

30 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

32 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

34 
	$add_hªdËrs
(è
CLICK_COLD
;

35 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

37 
´iv©e
:

39 
NÙif›rSigÇl
 
_sigÇl
;

41 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

43 
	}
};

45 
	gCLICK_ENDDECLS


	@test/notifiertest.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/cÚå¬£.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~"nÙif›¹e¡.hh
"

24 
CLICK_DECLS


26 
	gNÙif›rTe¡
::
	$NÙif›rTe¡
()

28 
	}
}

30 
	#CHECK
(
x
) do { \

31 ià(!(
x
)) \

32  
”rh
->
	`”rÜ
("%s:%d:e¡ %<%s%> faed", 
__FILE__
, 
__LINE__
, #x); \

33 } 0)

	)

36 
	gNÙif›rTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

38 
	`CHECK
(
NÙif›rSigÇl
::
	`busy_sigÇl
(è+ NÙif›rSigÇl::
	`ov”d”ived_sigÇl
() == NotifierSignal::busy_signal());

39 
	`CHECK
(
NÙif›rSigÇl
::
	`ov”d”ived_sigÇl
(è+ NÙif›rSigÇl::
	`busy_sigÇl
() == NotifierSignal::busy_signal());

40 
”rh
->
	`mes§ge
("Allests…ass!");

42 
	}
}

44 
CLICK_ENDDECLS


45 
EXPORT_ELEMENT
(
NÙif›rTe¡
)

	@test/notifiertest.hh

1 #iâdeà
CLICK_NOTIFIERTEST_HH


2 
	#CLICK_NOTIFIERTEST_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/nÙif›r.hh
>

5 
CLICK_DECLS


19 şas 
	cNÙif›rTe¡
 : 
public
 
EËm’t
 {…ublic:

21 
	$NÙif›rTe¡
(è
CLICK_COLD
;

23 cÚ¡ *
	$şass_Çme
() const {  "NotifierTest"; }

24 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

26 
	}
};

28 
	gCLICK_ENDDECLS


	@test/nulltask.cc

19 
	~<şick/cÚfig.h
>

20 
	~"nuÎsk.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

24 
CLICK_DECLS


26 
	gNuÎTask
::
	$NuÎTask
()

27 : 
	`_couÁ
(0), 
	`_lim™
(0), 
	`_sk
(
this
), 
	`_¡İ
(
çl£
), 
	$_aùive
(
Œue
)

29 
	}
}

32 
	gNuÎTask
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

34  
Args
(
cÚf
, 
this
, 
”rh
)

35 .
»ad
("STOP", 
_¡İ
)

36 .
»ad
("LIMIT", 
_lim™
)

37 .
»ad
("ACTIVE", 
_aùive
)

38 .
com¶‘e
();

42 
	gNuÎTask
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

44 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_aùive
, 
”rh
);

46 
	}
}

48 
boŞ


49 
	gNuÎTask
::
	$run_sk
(
Task
 *)

51 ++
_couÁ
;

52 ià(
_lim™
 =ğ0 || 
_couÁ
 < _limit)

53 
_sk
.
	`ç¡_»scheduË
();

54 ià(
_lim™
 !ğ0 && 
_couÁ
 >ğ_lim™ && 
_¡İ
)

55 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

56  
Œue
;

57 
	}
}

60 
	gNuÎTask
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

62 
NuÎTask
 *
Á
 = 
¡©ic_ÿ¡
<NuÎTask *>(
e
);

63 
Á
->
_couÁ
 = 0;

65 
	}
}

68 
	gNuÎTask
::
	$add_hªdËrs
()

70 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
OP_READ
, &
_couÁ
);

71 
	`add_d©a_hªdËrs
("lim™", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_lim™
);

72 
	`add_wr™e_hªdËr
("»£t", 
wr™e_hªdËr
);

73 
	`add_sk_hªdËrs
(&
_sk
, 0, 
TASKHANDLER_WRITE_ALL
);

74 
	}
}

76 
CLICK_ENDDECLS


77 
EXPORT_ELEMENT
(
NuÎTask
)

	@test/nulltask.hh

2 #iâdeà
CLICK_NULLTASK_HH


3 
	#CLICK_NULLTASK_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
CLICK_DECLS


55 şas 
	cNuÎTask
 : 
public
 
EËm’t
 {…ublic:

57 
	$NuÎTask
(è
CLICK_COLD
;

59 cÚ¡ *
	$şass_Çme
() const {  "NullTask"; }

61 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

62 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

63 
	$add_hªdËrs
(è
CLICK_COLD
;

65 
boŞ
 
	`run_sk
(
Task
 *);

67 
´iv©e
:

69 
ušt32_t
 
_couÁ
;

70 
ušt32_t
 
_lim™
;

71 
Task
 
_sk
;

72 
boŞ
 
_¡İ
;

73 
boŞ
 
_aùive
;

75 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

77 
	}
};

79 
	gCLICK_ENDDECLS


	@test/packettest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"·ck‘‹¡.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şickÃt/.h
>

23 
	~<şickÃt/6.h
>

24 
CLICK_DECLS


26 
	gPack‘Te¡
::
	$Pack‘Te¡
()

28 
	}
}

30 
	#CHECK
(
x
èià(!(x)è 
”rh
->
	`”rÜ
("%s:%d:e¡ `%s' faed", 
__FILE__
, 
__LINE__
, #x);

	)

31 
	#CHECK_DATA
(
x
, 
y
, 
l
è
	`CHECK
(
	`memcmp
((x), (y), (l)è=ğ0)

	)

32 
	#CHECK_ALIGNED
(
x
è
	`CHECK
((
»š‹½»t_ÿ¡
<
ušŒ_t
>((x)è& 3è=ğ0)

	)

35 
	gPack‘Te¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

37 cÚ¡ *
low”s
 = (const *)"abcdefghijklmnopqrstuvwxyzabcdefghijklmnopqrstuvwxyz";

38 
IPAdd»ss
 
	`addr
(
	`SŒšg
("1.2.3.4"));

40 
Pack‘
 *
p
 = Pack‘::
	`make
(10, 
low”s
, 20, 30);

41 
	`CHECK
(
p
->
	`h—droom
() >= 10);

42 
	`CHECK
(
p
->
	`room
() >= 30);

43 
	`CHECK
(
p
->
	`Ëngth
() == 20);

44 
	`CHECK
(
p
->
	`bufãr_Ëngth
() >= 60);

45 
	`CHECK_DATA
(
p
->
	`d©a
(), 
low”s
, 20);

46 
	`CHECK
(!
p
->
	`mac_h—d”
());

47 
	`CHECK
(!
p
->
	`ÃtwÜk_h—d”
());

48 
	`CHECK
(!
p
->
	`Œª¥Üt_h—d”
());

49 
p
->
	`£t_mac_h—d”
Õ->
	`d©a
(), 10);

50 
	`CHECK
(
p
->
	`ÃtwÜk_h—d”
(è=ğp->
	`d©a
() + 10);

51 
p
->
	`£t_d¡__ªno
(
addr
);

53 
Wr™abËPack‘
 *
p1
 = 
p
->
	`push
(5);

55 
	`CHECK
(
p
 =ğ
p1
);

56 
	`CHECK
(
p1
->
	`h—droom
() >= 5);

57 
	`CHECK
(
p1
->
	`room
() >= 30);

58 
	`CHECK
(
p1
->
	`Ëngth
() == 25);

59 
	`CHECK_DATA
(
p1
->
	`d©a
(è+ 5, 
low”s
, 20);

60 
	`CHECK
(
p1
->
	`mac_h—d”
(è=ğ
p
->
	`d©a
() + 5);

61 
	`CHECK
(
p1
->
	`ÃtwÜk_h—d”
(è=ğ
p
->
	`d©a
() + 15);

62 
	`CHECK
(
p1
->
	`d¡__ªno
(è=ğ
addr
);

64 
Pack‘
 *
p2
 = 
p1
->
	`şÚe
();

65 
	`CHECK
(
p2
 !ğ
p1
);

66 
	`CHECK
(
p2
->
	`d©a
(è=ğ
p1
->data());

67 
	`CHECK
(
p2
->
	`Ëngth
() == 25);

68 
	`CHECK
(
p1
->
	`sh¬ed
(è&& 
p2
->shared());

69 
	`CHECK
(
p1
->
	`mac_h—d”
(è=ğ
p2
->mac_header());

70 
	`CHECK
(
p2
->
	`d¡__ªno
(è=ğ
addr
);

72 
Wr™abËPack‘
 *
p3
 = 
p2
->
	`push
(5);

74 
	`CHECK
(
p3
 !ğ
p1
);

75 
	`CHECK
(
p3
->
	`Ëngth
() == 30);

76 
	`CHECK_DATA
(
p3
->
	`d©a
(è+ 10, 
low”s
, 20);

77 
	`memıy
(
p3
->
	`d©a
(), 
low”s
, 10);

78 
	`memıy
(
p1
->
	`d©a
(), 
low”s
, 5);

79 
	`CHECK_DATA
(
p3
->
	`d©a
(), 
low”s
, 10);

80 
	`CHECK_DATA
(
p1
->
	`d©a
(), 
low”s
, 5);

81 
	`CHECK
(
p3
->
	`mac_h—d”
(è!ğ
p1
->mac_header());

82 
	`CHECK
(
p3
->
	`mac_h—d”
(è=ğp3->
	`d©a
() + 10);

83 
	`CHECK
(
p3
->
	`ÃtwÜk_h—d”
(è=ğp3->
	`d©a
() + 20);

84 
	`CHECK
(!
p1
->
	`sh¬ed
(è&& !
p3
->shared());

85 
	`CHECK
(
p3
->
	`d¡__ªno
(è=ğ
addr
);

87 
p1
->
	`kl
();

88 
p3
->
	`kl
();

92 
p
 = 
Pack‘
::
	`make
(4);

93 
i
 = 0; i < 40000000; i++)

94 
p
->
	`şÚe
()->
	`kl
();

95 
p
->
	`kl
();

99 
p
 = 
Pack‘
::
	`make
(10, 
low”s
, 60, 4);

100 
	`CHECK
(
p
->
	`h—droom
(è=ğ10 &&…->
	`room
() == 4);

101 
p
 =…->
	`shiá_d©a
(-2);

102 
	`CHECK
(
p
->
	`h—droom
(è=ğ8 &&…->
	`room
() == 6);

103 
	`CHECK
(
p
->
	`Ëngth
() == 60);

104 
	`CHECK_DATA
(
p
->
	`d©a
(), 
low”s
, 60);

105 
	`CHECK_ALIGNED
(
p
->
	`d©a
());

106 
p
->
	`kl
();

108 
p
 = 
Pack‘
::
	`make
(9, 
low”s
, 60, 4);

109 
p
 =…->
	`shiá_d©a
(3);

110 
	`CHECK
(
p
->
	`h—droom
(è=ğ12 &&…->
	`room
(è=ğ1 &&…->
	`Ëngth
() == 60);

111 
	`CHECK_DATA
(
p
->
	`d©a
(), 
low”s
, 60);

112 
	`CHECK_ALIGNED
(
p
->
	`d©a
());

113 
p
->
	`kl
();

115 
p
 = 
Pack‘
::
	`make
(1, 
low”s
, 60, 4);

116 
p
 =…->
	`shiá_d©a
(-5);

117 
	`CHECK
(
p
->
	`room
(è>ğ9 &&…->
	`Ëngth
() == 60);

118 
	`CHECK_DATA
(
p
->
	`d©a
(), 
low”s
, 60);

119 
	`CHECK_ALIGNED
(
p
->
	`d©a
());

120 
p
->
	`kl
();

122 
p
 = 
Pack‘
::
	`make
(5, 
low”s
, 60, 2);

123 
p
 =…->
	`shiá_d©a
(3);

124 
	`CHECK
(
p
->
	`h—droom
(è>ğ8 &&…->
	`Ëngth
() == 60);

125 
	`CHECK_DATA
(
p
->
	`d©a
(), 
low”s
, 60);

126 
	`CHECK_ALIGNED
(
p
->
	`d©a
());

127 
p
->
	`kl
();

129 
p
 = 
Pack‘
::
	`make
(5, 
low”s
, 60, 2);

130 
p
->
	`£t_mac_h—d”
Õ->
	`d©a
(), 2);

131 
p
->
	`puÎ
(2);

132 
p
 =…->
	`shiá_d©a
(-3);

133 
	`CHECK
(
p
->
	`mac_h—d”
(è=ğp->
	`d©a
() - 2);

134 
	`CHECK
(
p
->
	`h—droom
(è>ğ2 &&…->
	`Ëngth
() == 58);

135 
	`CHECK_DATA
(
p
->
	`mac_h—d”
(), 
low”s
, 2);

136 
	`CHECK_DATA
(
p
->
	`d©a
(), 
low”s
 + 2, 58);

137 
	`CHECK_ALIGNED
(
p
->
	`d©a
());

138 
p
->
	`kl
();

142 
şick_
 
4
;

143 
şick_6
 
6
;

144 
ušt32_t
 
u32
[10];

145 } 
çkehdr
;

146 
çkehdr
.
u32
[0] = 
	`htÚl
(0x456789AB);

147 
	`CHECK
(
çkehdr
.
4
.
_v
 == 4);

148 
	`CHECK
(
çkehdr
.
4
.
_hl
 == 5);

149 
	`CHECK
(
çkehdr
.
4
.
_tos
 == 0x67);

150 
	`CHECK
(
çkehdr
.
4
.
_Ën
 =ğ
	`htÚs
(0x89AB));

151 
	`CHECK
(
çkehdr
.
6
.
6_v
 == 4);

152 
	`CHECK
(
çkehdr
.
6
.
6_vfc
 == 0x45);

153 
	`CHECK
(
çkehdr
.
6
.
6_æow
 =ğ
	`htÚl
(0x456789AB));

155 
”rh
->
	`mes§ge
("Allests…ass!");

157 
	}
}

159 
CLICK_ENDDECLS


160 
EXPORT_ELEMENT
(
Pack‘Te¡
)

	@test/packettest.hh

2 #iâdeà
CLICK_PACKETTEST_HH


3 
	#CLICK_PACKETTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


25 şas 
	cPack‘Te¡
 : 
public
 
EËm’t
 {…ublic:

27 
	$Pack‘Te¡
(è
CLICK_COLD
;

29 cÚ¡ *
	$şass_Çme
() const {  "PacketTest"; }

31 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

33 
	}
};

35 
	gCLICK_ENDDECLS


	@test/queuethreadtest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"queu‘h»ad‹¡.hh
"

21 
	~<şick/cÚå¬£.hh
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/”rÜ.hh
>

24 
CLICK_DECLS


26 
	gQueueTh»adTe¡1
::
	$QueueTh»adTe¡1
()

28 
	}
}

31 *
queue_th»ad_push”
(*
¬g
)

33 
Sim¶eQueue
 *
sq
 = 
¡©ic_ÿ¡
<Sim¶eQueu*>(
¬g
);

34 !
sq
->
rou‹r
()->
ruÂšg
())

37 
ušt32_t
 
v®ue
 = 0;

38 
Pack‘
 *
p
 = Pack‘::
make
(4);

41 
Wr™abËPack‘
 *
q
 = 
p
->
uniqueify
();

42 *
»š‹½»t_ÿ¡
<
ušt32_t
 *>(
q
->
d©a
()èğ
v®ue
;

43 
befÜe_drİs
 = 
sq
->
drİs
();

44 
sq
->
push
(0, 
q
->
şÚe
());

45 ià(
sq
->
drİs
(è=ğ
befÜe_drİs
)

46 
v®ue
++;

47 
p
 = 
q
;

55 
QueueTh»adTe¡1
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

57 
Sim¶eQueue
 *
sq
 = 
¡©ic_ÿ¡
<Sim¶eQueu*>(
	`ouut
(0).
	`–em’t
());

58 ià(!
sq
)

59  
”rh
->
	`”rÜ
("downstreamƒlement must be‡ype of Queue");

60 
±h»ad_©Œ_t
 
©Œ
;

61 
	`±h»ad_©Œ_š™
(&
©Œ
);

62 
”r
 = 
	`±h»ad_ü—‹
(&
_push_th»ad
, &
©Œ
, 
queue_th»ad_push”
, 
sq
);

63 ià(
”r
 != 0)

64  
”rh
->
	`”rÜ
("ÿÂÙ s¹h»ad: %s", 
	`¡»¼Ü
(
”r
));

67 
	}
}

70 
QueueTh»adTe¡1
::
	$ş—nup
(
CËªupSge
 
¡age
)

72 ià(
¡age
 >ğ
CLEANUP_INITIALIZED
)

73 
	`±h»ad_ÿnûl
(
_push_th»ad
);

74 
	}
}

77 
QueueTh»adTe¡2
::
	$QueueTh»adTe¡2
()

78 : 
	$_sk
(
this
)

80 
	}
}

83 
QueueTh»adTe¡2
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

85 
_sk
.
	`š™Ÿlize
(
this
, 
Œue
);

86 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

87 
_Ãxt
 = 
_Ï¡_msg
 = 0;

89 
	}
}

91 
	#CHECK
(
x
èià(!(x)è
”rh
->
	`”rÜ
("%s:%d:e¡ `%s' faed", 
__FILE__
, 
__LINE__
, #x);

	)

93 
boŞ


94 
	gQueueTh»adTe¡2
::
	$run_sk
(
Task
 *)

96 
E¼ÜHªdËr
 *
”rh
 = E¼ÜHªdËr::
	`deçuÉ_hªdËr
();

97 
i
;

98 
i
 = 0; i < 100; i++)

99 ià(
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
()) {

100 
	`CHECK
(
p
->
	`Ëngth
() == 4);

101 
	`CHECK
(* 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt32_t
 *>(
p
->
	`d©a
()è=ğ
_Ãxt
);

102 
p
->
	`kl
();

103 
_Ãxt
++;

106 ià(
¡©ic_ÿ¡
<
št32_t
>(
_Ï¡_msg
 + 1000000 - 
_Ãxt
) < 0) {

107 
”rh
->
	`mes§ge
("%de¡ sucûeded...", 
_Ãxt
);

108 
_Ï¡_msg
 += 1000000;

111 
_sk
.
	`ç¡_»scheduË
();

112  
Œue
;

113 
	}
}

115 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
umuÉ™h»ad
)

116 
	$EXPORT_ELEMENT
(
QueueTh»adTe¡1
 
QueueTh»adTe¡2
)

117 
CLICK_ENDDECLS


	@test/queuethreadtest.hh

2 #iâdeà
CLICK_QUEUETHREADTEST_HH


3 
	#CLICK_QUEUETHREADTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~"–em’ts/¡ªd¬d/sim¶equeue.hh
"

6 
	~<±h»ad.h
>

7 
	~<şick/sk.hh
>

8 
	~<şick/nÙif›r.hh
>

9 
CLICK_DECLS


26 şas 
	cQueueTh»adTe¡1
 : 
public
 
EËm’t
 {…ublic:

28 
QueueTh»adTe¡1
();

30 cÚ¡ *
	$şass_Çme
() const {  "QueueThreadTest1"; }

31 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

33 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

34 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

36 
´iv©e
:

38 
±h»ad_t
 
_push_th»ad
;

40 
	}
};

59 şas 
	cQueueTh»adTe¡2
 : 
public
 
EËm’t
 {…ublic:

61 
QueueTh»adTe¡2
();

63 cÚ¡ *
	$şass_Çme
() const {  "QueueThreadTest2"; }

64 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_0
; 
	}
}

65 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

67 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

68 
boŞ
 
	`run_sk
(
Task
 *);

70 
´iv©e
:

72 
Task
 
_sk
;

73 
ušt32_t
 
_Ãxt
;

74 
ušt32_t
 
_Ï¡_msg
;

75 
NÙif›rSigÇl
 
_sigÇl
;

77 
	}
};

79 
	gCLICK_ENDDECLS


	@test/queueyanktest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"queueyªk‹¡.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gQueueYªkTe¡
::
	$QueueYªkTe¡
()

26 : 
	$_t
(
this
)

28 
	}
}

31 
QueueYªkTe¡
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

33 
EËm’t
 *
	ge
;

35 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("QUEUE", 
e
).
com¶‘e
() < 0)

38 ià(!(
	g_q
 = 
¡©ic_ÿ¡
<
Sim¶eQueue
 *>(
e
->
ÿ¡
("SimpleQueue"))))

39  
”rh
->
”rÜ
("QUEUE‡rgument must be‡ Queueƒlement");

45 
	gQueueYªkTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

47 
_t
.
	`š™Ÿlize
(
this
);

48 
_t
.
	`scheduË_now
();

50 
	}
}

52 
	#CHECK
(
x
èià(!(x)è{ 
”rh
->
	`”rÜ
("%s:%d:e¡ `%s' faed", 
__FILE__
, 
__LINE__
, #x); ; }

	)

53 
	#CHECK_PKT
(
p
, 
c
èdØ{ 
Pack‘
 *
p_
 = (p); ià(!p_ ||…_->
	`d©a
()[0] !ğ(c)è{ 
”rh
->
	`”rÜ
("%s:%d:e¡ '%s'…roduûd % ·ck‘ (ex³ùed '%c')", 
__FILE__
, 
__LINE__
, #p, (p_ ? "wrÚg" : "no"), (c)); ; }…_->
	`kl
(); } 0)

	)

54 
	#CHECK_NOPKT
(
p
èdØ{ 
Pack‘
 *
p_
 = (p); iàÕ_è{ 
”rh
->
	`”rÜ
("%s:%d:e¡ '%s'…roduûd‡…ack‘ (ex³ùed‚Ùhšg)", 
__FILE__
, 
__LINE__
, #p); ; } } 0)

	)

55 
	#CHECK_DEQ
(
s
èdØ{ cÚ¡ *
s_
 = (s); *s_; s_++è
	`CHECK_PKT
(
_q
->
	`deq
(), *s_); } 0)

	)

56 
	#PREPARE_Q
(èdØ{ 
_q
->
	`’q
(
a
->
	`şÚe
()); _q->’q(
b
->şÚe()); _q->’q(
c
->şÚe()); _q->’q(
d
->şÚe()); _q->’q(
e
->şÚe()); 
	`CHECK
(_q->
	`size
(è=ğ5); } 0)

	)

58 
	gÇme¥aû
 {

60 
	sFoo
 {

61 cÚ¡ *
	gs
;

62 
Foo
(cÚ¡ *
ss
è: 
s
(
»š‹½»t_ÿ¡
<const *>(ss)) { }

63 
boŞ
 
İ”©Ü
()(cÚ¡ 
Pack‘
 *
p
) {

64 cÚ¡ *
ss
 = 
s
; *
	gss
; ss++)

65 ià(
	gp
->
d©a
()[0] =ğ*
ss
)

66  
Œue
;

67  
	gçl£
;

74 
	gQueueYªkTe¡
::
	$run_tim”
(
Tim”
 *)

76 
P»fixE¼ÜHªdËr
 
	`³¼h
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
(), 
	`deş¬©iÚ
() + ": ");

77 
E¼ÜHªdËr
 *
”rh
 = &
³¼h
;

79 
Pack‘
 *
a
 = Pack‘::
	`make
("a", 1);

80 
Pack‘
 *
b
 = Pack‘::
	`make
("b", 1);

81 
Pack‘
 *
c
 = Pack‘::
	`make
("c", 1);

82 
Pack‘
 *
d
 = Pack‘::
	`make
("d", 1);

83 
Pack‘
 *
e
 = Pack‘::
	`make
("e", 1);

85 
	`CHECK
(
_q
->
	`size
() == 0);

87 
	`PREPARE_Q
();

88 
	`CHECK_DEQ
("abcde");

90 
	`PREPARE_Q
();

91 
	`CHECK_PKT
(
_q
->
	`yªk1
(
	`Foo
("c")), 'c');

92 
	`CHECK
(
_q
->
	`size
() == 4);

93 
	`CHECK_DEQ
("abde");

95 
	`PREPARE_Q
();

96 
	`CHECK_NOPKT
(
_q
->
	`yªk1
(
	`Foo
("f")));

97 
	`CHECK_DEQ
("abcde");

99 
	`PREPARE_Q
();

100 
	`CHECK_DEQ
("abcd");

101 
	`CHECK_PKT
(
_q
->
	`yªk1
(
	`Foo
("hgkje")), 'e');

102 
	`CHECK
(
_q
->
	`size
() == 0);

104 
VeùÜ
<
Pack‘
 *> 
v
;

105 
	`PREPARE_Q
();

106 
_q
->
	`yªk
(
	`Foo
("ade"), 
v
);

107 
	`CHECK
(
v
.
	`size
() == 3);

108 
	`CHECK
(
_q
->
	`size
() == 2);

109 
	`CHECK_PKT
(
v
[0], 'e');

110 
	`CHECK_PKT
(
v
[1], 'd');

111 
	`CHECK_PKT
(
v
[2], 'a');

112 
	`CHECK_DEQ
("bc");

114 
v
.
	`ş—r
();

115 
	`PREPARE_Q
();

116 
_q
->
	`yªk
(
	`Foo
("fhq"), 
v
);

117 
	`CHECK
(
v
.
	`size
() == 0);

118 
	`CHECK_DEQ
("abcde");

120 
v
.
	`ş—r
();

121 
	`PREPARE_Q
();

122 
_q
->
	`yªk
(
	`Foo
("edcba"), 
v
);

123 
	`CHECK
(
v
.
	`size
() == 5);

124 
	`CHECK
(
_q
->
	`size
() == 0);

125 
	`CHECK_PKT
(
v
[0], 'e');

126 
	`CHECK_PKT
(
v
[1], 'd');

127 
	`CHECK_PKT
(
v
[2], 'c');

128 
	`CHECK_PKT
(
v
[3], 'b');

129 
	`CHECK_PKT
(
v
[4], 'a');

131 
	`CHECK
(
_q
->
	`size
() == 0);

132 
a
->
	`kl
();

133 
b
->
	`kl
();

134 
c
->
	`kl
();

135 
d
->
	`kl
();

136 
e
->
	`kl
();

137 
”rh
->
	`mes§ge
("Allests…ass!");

138 
	}
}

140 
CLICK_ENDDECLS


141 
EXPORT_ELEMENT
(
QueueYªkTe¡
)

	@test/queueyanktest.hh

2 #iâdeà
CLICK_QUEUEYANKTEST_HH


3 
	#CLICK_QUEUEYANKTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/tim”.hh
>

6 
	~"–em’ts/¡ªd¬d/sim¶equeue.hh
"

7 
CLICK_DECLS


62 şas 
	cQueueYªkTe¡
 : 
public
 
EËm’t
 {…ublic:

64 
	$QueueYªkTe¡
(è
CLICK_COLD
;

66 cÚ¡ *
	$şass_Çme
() const {  "QueueYankTest"; }

68 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

69 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

71 
	`run_tim”
(
Tim”
 *);

73 
´iv©e
:

75 
Sim¶eQueue
 *
_q
;

76 
Tim”
 
_t
;

78 
	}
};

80 
	gCLICK_ENDDECLS


	@test/randomseed.cc

19 
	~<şick/cÚfig.h
>

20 
	~"¿ndom£ed.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
CLICK_DECLS


25 
	gRªdomS“d
::
	$RªdomS“d
()

27 
	}
}

30 
RªdomS“d
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

32 
boŞ
 
	g£ed_giv’
 = 
çl£
;

33 
ušt32_t
 
	g£ed
;

34 ià(
Args
(
cÚf
, 
this
, 
”rh
)

35 .
»ad_p
("SEED", 
£ed
).
»ad_¡©us
(
£ed_giv’
)

36 .
com¶‘e
() < 0)

38 ià(!
	g£ed_giv’
)

39 
şick_¿ndom_¤ªdom
();

41 
şick_¤ªdom
(
£ed
);

46 
	gRªdomS“d
::
	$add_hªdËrs
()

48 
	`add_»ad_hªdËr
("£ed", 
»ad_keywÜd_hªdËr
, "0 SEED", 
HªdËr
::
CALM
);

49 
	`add_wr™e_hªdËr
("£ed", 
»cÚfigu»_keywÜd_hªdËr
, "0 SEED");

50 
	}
}

52 
CLICK_ENDDECLS


53 
EXPORT_ELEMENT
(
RªdomS“d
)

	@test/randomseed.hh

2 #iâdeà
CLICK_RANDOMSEED_HH


3 
	#CLICK_RANDOMSEED_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


30 şas 
	cRªdomS“d
 : 
public
 
EËm’t
 {…ublic:

32 
	$RªdomS“d
(è
CLICK_COLD
;

34 cÚ¡ *
	$şass_Çme
() const {  "RandomSeed"; }

36 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_FIRST
; 
	}
}

37 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

38 
cÚfigu»
(
VeùÜ
<
SŒšg
>&, 
E¼ÜHªdËr
*è
	gCLICK_COLD
;

39 
	$add_hªdËrs
(è
CLICK_COLD
;

41 
	}
};

43 
	gCLICK_ENDDECLS


	@test/schedordertest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"schedÜd”‹¡.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şick/rou‹r.hh
>

25 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

26 
CLICK_DECLS


28 
	gSchedOrd”Te¡
::
	$SchedOrd”Te¡
()

29 : 
	`_couÁ
(0), 
	`_lim™
(0), 
	`_buf_begš
(0), 
	`_bufsiz
(0),

30 
	`_sk
(
this
), 
	$_¡İ
(
çl£
)

32 
	}
}

34 
	gSchedOrd”Te¡
::~
	$SchedOrd”Te¡
()

36 ià(
_buåos_±r
 =ğ&
_buåos
)

37 
d–‘e
[] 
_buf_begš
;

38 
	}
}

41 
	gSchedOrd”Te¡
::
cÚfigu»
(
VeùÜ
<
SŒšg
>& 
cÚf
, 
E¼ÜHªdËr
* 
”rh
)

43 ià(
Args
(
cÚf
, 
this
, 
”rh
)

44 .
»ad_mp
("ID", 
_id
)

45 .
»ad
("SIZE", 
_bufsiz
)

46 .
»ad
("STOP", 
_¡İ
)

47 .
»ad
("LIMIT", 
_lim™
)

48 .
com¶‘e
() < 0)

51 *& 
	gmaš
 = 
rou‹r
()->
fÜû_©chm’t
("SchedOrderTest");

52 ià(!
	gmaš
)

53 
	gmaš
 = 
this
;

55 
SchedOrd”Te¡
* 
	gsÙ
 = (SchedOrd”Te¡*è
maš
;

56 ià(
	gsÙ
->
	g_bufsiz
 < _bufsiz)

57 
	gsÙ
->
	g_bufsiz
 = 
_bufsiz
;

63 
	gSchedOrd”Te¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
* 
”rh
)

65 
SchedOrd”Te¡
* 
sÙ
 = (SchedOrd”Te¡*è
	`rou‹r
()->
	`©chm’t
("SchedOrderTest");

66 ià(!
sÙ
->
_buf_begš
) {

67 ià(
sÙ
->
_bufsiz
 == 0)

68 
sÙ
->
_bufsiz
 = 1024;

69 ià(!(
sÙ
->
_buf_begš
 = 
Ãw
 [sÙ->
_bufsiz
]))

70  
”rh
->
	`”rÜ
("out of memory!");

71 
sÙ
->
_buf_’d
 = sÙ->
_buf_begš
 + sÙ->
_bufsiz
;

72 
sÙ
->
_buåos
 = sÙ->
_buf_begš
;

75 
_buf_begš
 = 
sÙ
->_buf_begin;

76 
_buåos_±r
 = &
sÙ
->
_buåos
;

77 
_buf_’d
 = 
sÙ
->_buf_end;

78 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
Œue
, 
”rh
);

80 
	}
}

82 
boŞ


83 
	gSchedOrd”Te¡
::
	$run_sk
(
Task
 *)

85 ià(*
_buåos_±r
 < 
_buf_’d
) {

86 *((*
_buåos_±r
)++èğ
_id
;

87 } ià(
_¡İ
)

88 
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

89 ià(
_lim™
 =ğ0 || ++
_couÁ
 < _limit)

90 
_sk
.
	`ç¡_»scheduË
();

91  
Œue
;

92 
	}
}

94 
SŒšg


95 
	gSchedOrd”Te¡
::
	$»ad_hªdËr
(
EËm’t
* 
e
, *)

97 
SchedOrd”Te¡
* 
sÙ
 = (SchedOrd”Te¡*è
e
;

98 
SŒšgAccum
 
§
;

99 * 
x
 = 
sÙ
->
_buf_begš
; x < *sÙ->
_buåos_±r
; x++)

100 
§
 << *
x
 << ' ';

101 
§
.
	`back
() = '\n';

102  
§
.
	`ke_¡ršg
();

103 
	}
}

106 
	gSchedOrd”Te¡
::
	$add_hªdËrs
()

108 
	`add_»ad_hªdËr
("Üd”", 
»ad_hªdËr
);

109 
	`add_sk_hªdËrs
(&
_sk
);

110 
	}
}

112 
CLICK_ENDDECLS


113 
EXPORT_ELEMENT
(
SchedOrd”Te¡
)

	@test/schedordertest.hh

2 #iâdeà
CLICK_SCHEDORDERTEST_HH


3 
	#CLICK_SCHEDORDERTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~"–em’ts/¡ªd¬d/sim¶equeue.hh
"

7 
CLICK_DECLS


54 şas 
	cSchedOrd”Te¡
 : 
public
 
EËm’t
 {…ublic:

56 
	$SchedOrd”Te¡
(è
CLICK_COLD
;

57 ~
	$SchedOrd”Te¡
(è
CLICK_COLD
;

59 cÚ¡ *
	$şass_Çme
() const {  "SchedOrderTest"; }

61 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

62 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

63 
	$add_hªdËrs
(è
CLICK_COLD
;

65 
boŞ
 
	`run_sk
(
Task
 *);

67 
´iv©e
:

69 
_id
;

70 
ušt32_t
 
_couÁ
;

71 
ušt32_t
 
_lim™
;

72 ** 
_buåos_±r
;

73 * 
_buf_begš
;

74 * 
_buåos
;

75 * 
_buf_’d
;

76 
_bufsiz
;

77 
Task
 
_sk
;

78 
boŞ
 
_¡İ
;

80 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
*, *è
CLICK_COLD
;

82 
	}
};

84 
	gCLICK_ENDDECLS


	@test/sorttest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"sÜ‰e¡.hh
"

21 
	~<şick/glue.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/¬gs.hh
>

24 #ià
CLICK_USERLEVEL


25 
	~<şick/äomfe.hh
>

27 
CLICK_DECLS


29 
	gSÜtTe¡
::
	$SÜtTe¡
()

31 
	}
}

33 cÚ¡ * cÚ¡ 
unsÜ‹d_şas£s
[] = {

291 cÚ¡ 
size_t
 
	gnşas£s
 = (
unsÜ‹d_şas£s
) / (unsorted_classes[0]);

293 cÚ¡ * cÚ¡ 
	gsÜ‹d_şas£s
[] = {

551 
	gVeùÜ
<
	gSŒšg
> *
	g¡rvec
;

552 
	gVeùÜ
<
	gsize_t
> *
	gsizevec
;

554 (*
	tqsÜt_com·r_t
)(const *, const *);

556 
	$com·r
(cÚ¡ *
xa
, cÚ¡ *
xb
, *)

558 cÚ¡ *
a
 = * (cÚ¡ **è
xa
;

559 cÚ¡ *
b
 = * (cÚ¡ **è
xb
;

560  
	`¡rcmp
(
a
, 
b
);

561 
	}
}

563 
	$¡ršg_com·r
(cÚ¡ *
xa
, cÚ¡ *
xb
, *)

565 cÚ¡ 
SŒšg
 *
a
 = (cÚ¡ SŒšg *è
xa
;

566 cÚ¡ 
SŒšg
 *
b
 = (cÚ¡ SŒšg *è
xb
;

567  
SŒšg
::
	`com·»
(*
a
, *
b
);

568 
	}
}

570 
	$size_t_com·r
(cÚ¡ *
xa
, cÚ¡ *
xb
, *)

572 cÚ¡ 
size_t
 *
a
 = (cÚ¡ size_ˆ*è
xa
;

573 cÚ¡ 
size_t
 *
b
 = (cÚ¡ size_ˆ*è
xb
;

574  (*
a
 > *
b
 ? 1 : (*a == *b ? 0 : -1));

575 
	}
}

577 
	$¡ršg_³rmu‹_com·r
(cÚ¡ *
xa
, cÚ¡ *
xb
, *)

579 cÚ¡ *
a
 = (cÚ¡ *è
xa
;

580 cÚ¡ *
b
 = (cÚ¡ *è
xb
;

581 
diff
 = 
SŒšg
::
	`com·»
((*
¡rvec
)[*
a
], (*¡rvec)[*
b
]);

582  (
diff
 ? difà: *
a
 - *
b
);

583 
	}
}

585 
	$size_t_³rmu‹_com·r
(cÚ¡ *
xa
, cÚ¡ *
xb
, *)

587 cÚ¡ *
a
 = (cÚ¡ *è
xa
;

588 cÚ¡ *
b
 = (cÚ¡ *è
xb
;

589 
ssize_t
 
diff
 = (*
sizevec
)[*
a
] - (*sizevec)[*
b
];

590  (
diff
 < 0 ? -1 : (difà=ğ0 ? *
a
 - *
b
 : 1));

591 
	}
}

593 
	$¡ršg_»v_com·r
(cÚ¡ *
xa
, cÚ¡ *
xb
, *)

595 cÚ¡ 
SŒšg
 *
a
 = (cÚ¡ SŒšg *è
xa
;

596 cÚ¡ 
SŒšg
 *
b
 = (cÚ¡ SŒšg *è
xb
;

597  
SŒšg
::
	`com·»
(*
b
, *
a
);

598 
	}
}

600 
	$size_t_»v_com·r
(cÚ¡ *
xa
, cÚ¡ *
xb
, *)

602 cÚ¡ 
size_t
 *
a
 = (cÚ¡ size_ˆ*è
xa
;

603 cÚ¡ 
size_t
 *
b
 = (cÚ¡ size_ˆ*è
xb
;

604  (*
b
 > *
a
 ? 1 : (*a == *b ? 0 : -1));

605 
	}
}

607 
	$¡ršg_³rmu‹_»v_com·r
(cÚ¡ *
xa
, cÚ¡ *
xb
, *)

609 cÚ¡ *
a
 = (cÚ¡ *è
xa
;

610 cÚ¡ *
b
 = (cÚ¡ *è
xb
;

611 
diff
 = 
SŒšg
::
	`com·»
((*
¡rvec
)[*
b
], (*¡rvec)[*
a
]);

612  (
diff
 ? difà: *
a
 - *
b
);

613 
	}
}

615 
	$size_t_³rmu‹_»v_com·r
(cÚ¡ *
xa
, cÚ¡ *
xb
, *)

617 cÚ¡ *
a
 = (cÚ¡ *è
xa
;

618 cÚ¡ *
b
 = (cÚ¡ *è
xb
;

619 
ssize_t
 
diff
 = (*
sizevec
)[*
b
] - (*sizevec)[*
a
];

620  (
diff
 < 0 ? -1 : (difà=ğ0 ? *
a
 - *
b
 : 1));

621 
	}
}

623 
	$¡ršg_bogus_com·r
(const *, const *, *)

626 
	}
}

630 
	gSÜtTe¡
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

632 #ià
CLICK_USERLEVEL


633 
	g_ouut
 = 
_¡dc
 = 
çl£
;

634 
SŒšg
 
	gf’ame
;

636 
boŞ
 
	gnum”ic
 = 
çl£
, 
	g³rmu‹
 = false;

637 
	g_»v”£
 = 
çl£
;

638 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

639 .
»ad
("NUMERIC", 
num”ic
)

640 .
»ad
("REVERSE", 
_»v”£
)

641 .
»ad
("PERMUTE", 
³rmu‹
)

642 #ià
CLICK_USERLEVEL


643 .
»ad
("FILE", 
F’ameArg
(), 
f’ame
)

644 .
»ad
("OUTPUT", 
_ouut
)

645 .
»ad
("STDC", 
_¡dc
)

647 .
cÚsume
() < 0)

650 #ià
CLICK_USERLEVEL


651 ià(
	gf’ame
) {

652 
FromFe
 
	gff
;

653 
	gr
, 
	gcom¶aš
 = 0;

654 
SŒšg
 
	gs
;

655 
size_t
 
	gsz
 = 0;

656 
	gff
.
f’ame
() = filename;

657 ià(
	gff
.
š™Ÿlize
(
”rh
) < 0)

659 (
	gr
 = 
ff
.
»ad_lše
(
s
, 
”rh
, 
çl£
)) > 0) {

660 ià(!
	gnum”ic
)

661 
	g_¡rvec
.
push_back
(
s
);

662 ià((
	gs
 = 
ı_uncomm’t
(
s
)è&& 
IÁArg
().
·r£
(s, 
sz
))

663 
	g_sizevec
.
push_back
(
sz
);

664 ià(
	gs
 && s[0] !ğ'#' && !
com¶aš
)

665 
com¶aš
 = 
”rh
->
lw¬nšg
(
ff
.
Ïndm¬k
(), "not integer");

669 ià(
	gnum”ic
) {

670 
	gcom¶aš
 = 0;

671 
size_t
 
	gsz
;

672 
SŒšg
 *
	g¥
 = 
cÚf
.
begš
(); s°!ğcÚf.
’d
(); sp++)

673 ià(*
	g¥
 && 
IÁArg
().
·r£
(*
¥
, 
sz
))

674 
	g_sizevec
.
push_back
(
sz
);

675 ià(*
	g¥
 && !
	gcom¶aš
)

676 
	gcom¶aš
 = 
”rh
->
w¬nšg
("argument‚ot integer");

678 
SŒšg
 *
	g¥
 = 
cÚf
.
begš
(); s°!ğcÚf.
’d
(); sp++)

679 
	g_¡rvec
.
push_back
(
ı_unquÙe
(*
¥
) + "\n");

681 ià(
	g³rmu‹
) {

682 
	gs
 = (
_¡rvec
.
size
(è? _¡rvec.size(è: 
_sizevec
.size());

683 
	gi
 = 0; i < 
	gs
; i++)

684 
	g_³rmu‹
.
push_back
(
i
);

691 
	gSÜtTe¡
::
	$š™Ÿlize_vec
(
E¼ÜHªdËr
 *)

693 *
begš
;

694 
size_t
 
n
, 
size
;

695 ià(
_³rmu‹
.
	`size
())

696 
begš
 = 
_³rmu‹
.
	`begš
(), 
n
 = _³rmu‹.
	`size
(), 
size
 = ();

697 ià(
_¡rvec
.
	`size
())

698 
begš
 = 
_¡rvec
.
	`begš
(), 
n
 = _¡rvec.
	`size
(), 
size
 = (
SŒšg
);

700 
begš
 = 
_sizevec
.
	`begš
(), 
n
 = _sizevec.
	`size
(), 
size
 = (
size_t
);

702 (*
com·r
)(const *, const *, *);

703 ià(
_¡rvec
.
	`size
()) {

704 
¡rvec
 = &
_¡rvec
;

705 ià(
_³rmu‹
.
	`size
())

706 
com·r
 = (
_»v”£
 ? 
¡ršg_³rmu‹_»v_com·r
 : 
¡ršg_³rmu‹_com·r
);

708 
com·r
 = (
_»v”£
 ? 
¡ršg_»v_com·r
 : 
¡ršg_com·r
);

710 #ià
CLICK_USERLEVEL


711 ià(
_¡dc
)

712 
	`qsÜt
(
begš
, 
n
, 
size
, (
qsÜt_com·r_t
è
com·r
);

715 
	`şick_qsÜt
(
begš
, 
n
, 
size
, 
com·r
);

717 #ià
CLICK_USERLEVEL


718 ià(
_ouut
 && 
_³rmu‹
.
	`size
())

719 *
a
 = 
_³rmu‹
.
	`begš
();‡ !ğ_³rmu‹.
	`’d
();‡++)

720 
	`ignÜe_»suÉ
(
	`fwr™e
(
_¡rvec
[*
a
].
	`d©a
(), _¡rvec[*a].
	`Ëngth
(), 1, 
¡dout
));

721 ià(
_ouut
)

722 
SŒšg
 *
a
 = 
_¡rvec
.
	`begš
();‡ !ğ_¡rvec.
	`’d
();‡++)

723 
	`ignÜe_»suÉ
(
	`fwr™e
(
a
->
	`d©a
(),‡->
	`Ëngth
(), 1, 
¡dout
));

726 ià(
_sizevec
.
	`size
()) {

727 
sizevec
 = &
_sizevec
;

728 ià(
_³rmu‹
.
	`size
())

729 
com·r
 = (
_»v”£
 ? 
size_t_³rmu‹_»v_com·r
 : 
size_t_³rmu‹_com·r
);

731 
com·r
 = (
_»v”£
 ? 
size_t_»v_com·r
 : 
size_t_com·r
);

733 #ià
CLICK_USERLEVEL


734 ià(
_¡dc
)

735 
	`qsÜt
(
begš
, 
n
, 
size
, (
qsÜt_com·r_t
è
com·r
);

738 
	`şick_qsÜt
(
begš
, 
n
, 
size
, 
com·r
);

740 #ià
CLICK_USERLEVEL


741 ià(
_ouut
 && 
_³rmu‹
.
	`size
())

742 *
a
 = 
_³rmu‹
.
	`begš
();‡ !ğ_³rmu‹.
	`’d
();‡++)

743 
	`´štf
("%zu\n", 
_sizevec
[*
a
]);

744 ià(
_ouut
)

745 
size_t
 *
a
 = 
_sizevec
.
	`begš
();‡ !ğ_sizevec.
	`’d
();‡++)

746 
	`´štf
("%zu\n", *
a
);

751 
	}
}

754 
	gSÜtTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

756 ià(
_¡rvec
.
	`size
(è|| 
_sizevec
.size())

757  
	`š™Ÿlize_vec
(
”rh
);

759 cÚ¡ **
şas£s
 = 
Ãw
 cÚ¡ *[
nşas£s
];

761 
	`memıy
(
şas£s
, 
unsÜ‹d_şas£s
, (unsorted_classes));

762 
	`şick_qsÜt
(
şas£s
, 
nşas£s
, (şas£s[0]), 
com·r
);

764 
i
 = 0; i < 20; i++) {

765 
size_t
 
x
 = 0; x < 
nşas£s
; x++)

766 ià(
	`¡rcmp
(
şas£s
[
x
], 
sÜ‹d_şas£s
[x]) != 0) {

767 
d–‘e
[] 
şas£s
;

768  
”rh
->
	`”rÜ
("sÜˆ%d,ƒËm’ˆ%u difãr (% vs. %s)", 
i
, 
x
, 
şas£s
[x], 
sÜ‹d_şas£s
[x]);

771 
size_t
 
³rmu‹
 = 0;…”mu‹ < 
nşas£s
 * 2;…ermute++) {

772 
size_t
 
a
 = 
	`şick_¿ndom
(è% 
nşas£s
;

773 
size_t
 
b
 = 
	`şick_¿ndom
(è% 
nşas£s
;

774 cÚ¡ *
xa
 = 
şas£s
[
a
];

775 
şas£s
[
a
] = cÏs£s[
b
];

776 
şas£s
[
b
] = 
xa
;

779 
	`şick_qsÜt
(
şas£s
, 
nşas£s
, (şas£s[0]), 
com·r
);

782 
	`memıy
(
şas£s
, 
sÜ‹d_şas£s
, (sorted_classes));

783 
	`şick_qsÜt
(
şas£s
, 
nşas£s
, (şas£s[0]), 
com·r
);

785 
	`memıy
(
şas£s
, 
unsÜ‹d_şas£s
, (unsorted_classes));

786 
	`şick_qsÜt
(
şas£s
, 
nşas£s
, (şas£s[0]), 
¡ršg_bogus_com·r
);

788 
”rh
->
	`mes§ge
("Allests…ass!");

789 
d–‘e
[] 
şas£s
;

791 
	}
}

793 
CLICK_ENDDECLS


794 
EXPORT_ELEMENT
(
SÜtTe¡
)

	@test/sorttest.hh

2 #iâdeà
CLICK_SORTTEST_HH


3 
	#CLICK_SORTTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


58 şas 
	cSÜtTe¡
 : 
public
 
EËm’t
 {…ublic:

60 
	$SÜtTe¡
(è
CLICK_COLD
;

62 cÚ¡ *
	$şass_Çme
() const {  "SortTest"; }

64 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

65 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

67 
´iv©e
:

69 
VeùÜ
<
SŒšg
> 
_¡rvec
;

70 
VeùÜ
<
size_t
> 
_sizevec
;

71 
VeùÜ
<> 
_³rmu‹
;

72 
boŞ
 
_»v”£
;

73 #ià
CLICK_USERLEVEL


74 
boŞ
 
_ouut
;

75 
boŞ
 
_¡dc
;

78 
	`š™Ÿlize_vec
(
E¼ÜHªdËr
 *);

80 
	}
};

82 
	gCLICK_ENDDECLS


	@test/taskthreadtest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"skth»ad‹¡.hh
"

21 
	~<şick/glue.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/ma¡”.hh
>

26 
CLICK_DECLS


28 
	gTaskTh»adTe¡
::
	$TaskTh»adTe¡
()

29 : 
	`_maš_sk
(
maš_sk_ÿÎback
, 
this
), 
	`_sks
(), 
	`_‰t_¡©s
(),

30 
	`_Áasks
(4096), 
	`_ä“_b©ch
(128), 
	`_chªge_b©ch
(1024),

31 
	`_maš_tick‘s
(
Task
::
DEFAULT_TICKETS
), 
	`_maš_runs
(0),

32 
	`_ä“_cyşes
(0), 
	`_ü—‹_cyşes
(0), 
	`_chªge_cyşes
(0),

33 
	$_´og»ss
(0)

35 
	}
}

37 
boŞ
 
	gTaskTh»adTe¡
::
	$maš_sk_ÿÎback
(
Task
* 
t
, * 
ÿÎback
) {

38 
TaskTh»adTe¡
* 
e
 = 
¡©ic_ÿ¡
<TaskTh»adTe¡*>(
ÿÎback
);

40 
şick_cyşes_t
 
cyşes0
 = 
	`şick_g‘_cyşes
();

41 
n
 = 
	`şick_¿ndom
(è% 
e
->
_Áasks
;

42 
i
 = 0; i < 
e
->
_ä“_b©ch
; ++i)

43 
e
->
_sks
[(
n
 + 
i
è%ƒ->
_Áasks
].~
	`Task
();

44 
şick_cyşes_t
 
cyşes1
 = 
	`şick_g‘_cyşes
();

45 
e
->
_ä“_cyşes
 +ğ
cyşes1
 - 
cyşes0
;

46 
cyşes0
 = 
cyşes1
;

48 
Áh»ads
 = 
e
->
	`ma¡”
()->
	`Áh»ads
();

49 
e
->
	`rou‹r
()->
	`£t_home_th»ad_id
Ó, 
	`şick_¿ndom
(è% 
Áh»ads
);

50 
i
 = 0; i < 
e
->
_ä“_b©ch
; ++i) {

51 
j
 = (
n
 + 
i
è% 
e
->
_Áasks
;

52 
	`Ãw
(
»š‹½»t_ÿ¡
<*>(&
e
->
_sks
[
j
])è
	`Task
(e);

53 
e
->
_sks
[
j
].
	`š™Ÿlize
Ó, 
Œue
);

55 
cyşes1
 = 
	`şick_g‘_cyşes
();

56 
e
->
_ü—‹_cyşes
 +ğ
cyşes1
 - 
cyşes0
;

57 
cyşes0
 = 
cyşes1
;

60 
i
 = 0; i < 
e
->
_chªge_b©ch
; ++i) {

61 
j
 = 
	`şick_¿ndom
(è% 
e
->
_Áasks
;

62 
e
->
_sks
[
j
].
	`move_th»ad
(Ó->_sks[j].
	`home_th»ad_id
(è+ 1è% 
Áh»ads
);

64 
cyşes1
 = 
	`şick_g‘_cyşes
();

65 
e
->
_chªge_cyşes
 +ğ
cyşes1
 - 
cyşes0
;

67 
t
->
	`ç¡_»scheduË
();

68 ++
e
->
_maš_runs
;

69 ià(
e
->
_´og»ss
 &&ƒ->
_maš_runs
 %ƒ->_progress == 0) {

70 
şick_cyşes_t
 
t
 = 
e
->
_ä“_cyşes
 +ƒ->
_ü—‹_cyşes
 +ƒ->
_chªge_cyşes
;

71 
	`şick_ch©‹r
("%{–em’t}: %Îu„un (%Îu f»e, %Îu c»©e, %Îu chªge)", 
e
,ƒ->
_maš_runs
,

72 (
e
->
_ä“_cyşes
 * 1000è/ 
t
,

73 (
e
->
_ü—‹_cyşes
 * 1000è/ 
t
,

74 (
e
->
_chªge_cyşes
 * 1000è/ 
t
);

75 
SŒšgAccum
 
§
;

76 
i
 = 0; i < 
e
->
	`ma¡”
()->
	`Áh»ads
(); ++i)

77 
§
 << (
i
 ? " " : ""è<< 
e
->
_‰t_¡©s
[i].
runs
;

78 
	`şick_ch©‹r
("%{–em’t}: %s", 
e
, 
§
.
	`c_¡r
());

80  
Œue
;

81 
	}
}

84 
	gTaskTh»adTe¡
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

86 ià(
Args
(
cÚf
, 
this
, 
”rh
)

87 .
»ad
("N", 
_Áasks
)

88 .
»ad
("FREE", 
_ä“_b©ch
)

89 .
»ad
("CHANGE", 
_chªge_b©ch
)

90 #ià
HAVE_STRIDE_SCHED


91 .
»ad
("MAIN_TICKETS", 
_maš_tick‘s
)

93 .
»ad
("PROGRESS", 
_´og»ss
)

94 .
com¶‘e
() < 0)

96 ià(
	g_ä“_b©ch
 > 
	g_Áasks
)

97  
	g”rh
->
”rÜ
("FREE must be‚o greaterhan N");

98 ià(
	g_chªge_b©ch
 > 
	g_Áasks
)

99  
	g”rh
->
”rÜ
("CHANGE must be‚o greaterhan N");

104 
	gTaskTh»adTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
*)

106 
_sks
 = 
»š‹½»t_ÿ¡
<
Task
*>(
Ãw
 [(Taskè* 
_Áasks
]);

107 
i
 = 0; i < 
_Áasks
; ++i) {

108 
	`Ãw
(
»š‹½»t_ÿ¡
<*>(&
_sks
[
i
])è
	`Task
(
this
);

109 
_sks
[
i
].
	`š™Ÿlize
(
this
, 
Œue
);

111 
_‰t_¡©s
 = 
Ãw
 
‰t_¡©
[
	`ma¡”
()->
	`Áh»ads
()];

112 
_maš_sk
.
	`š™Ÿlize
(
this
, 
Œue
);

113 #ià
HAVE_STRIDE_SCHED


114 
_maš_sk
.
	`£t_tick‘s
(
_maš_tick‘s
);

116 (è
_maš_tick‘s
;

119 
	}
}

122 
	gTaskTh»adTe¡
::
	$ş—nup
(
CËªupSge
)

124 ià(
_sks
) {

125 
i
 = 0; i < 
_Áasks
; ++i)

126 
_sks
[
i
].~
	`Task
();

127 
d–‘e
[] 
»š‹½»t_ÿ¡
<*>(
_sks
);

128 
_sks
 = 0;

130 
d–‘e
[] 
_‰t_¡©s
;

131 
	}
}

133 
boŞ


134 
	gTaskTh»adTe¡
::
	$run_sk
(
Task
* 
t
)

136 
_‰t_¡©s
[
t
->
	`th»ad
()->
	`th»ad_id
()].
runs
 += 1;

137 
t
->
	`ç¡_»scheduË
();

138  
Œue
;

139 
	}
}

141 
SŒšg


142 
	gTaskTh»adTe¡
::
	$»ad_hªdËr
(
EËm’t
* 
e
, *)

144 
TaskTh»adTe¡
* 
t
 = 
¡©ic_ÿ¡
<TaskTh»adTe¡*>(
e
);

145 
SŒšgAccum
 
§
;

146 
i
 = 0; i < 
t
->
	`ma¡”
()->
	`Áh»ads
(); ++i)

147 
§
 << (
i
 ? " " : ""è<< 
t
->
_‰t_¡©s
[i].
runs
;

148 
§
 << "\n";

149  
§
.
	`ke_¡ršg
();

150 
	}
}

153 
	gTaskTh»adTe¡
::
	$add_hªdËrs
()

155 
	`add_»ad_hªdËr
("runs", 
»ad_hªdËr
, 
H_RUNS
);

156 
	}
}

158 
CLICK_ENDDECLS


159 
EXPORT_ELEMENT
(
TaskTh»adTe¡
)

	@test/taskthreadtest.hh

2 #iâdeà
CLICK_TASKTHREADTEST_HH


3 
	#CLICK_TASKTHREADTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
CLICK_DECLS


62 şas 
	cTaskTh»adTe¡
 : 
public
 
EËm’t
 {…ublic:

63 
	$TaskTh»adTe¡
(è
CLICK_COLD
;

65 cÚ¡ * 
	$şass_Çme
() const {  "TaskThreadTest"; }

67 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

68 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

69 
	$ş—nup
(
CËªupSge
 
¡age
è
CLICK_COLD
;

70 
	$add_hªdËrs
(è
CLICK_COLD
;

72 
boŞ
 
	`run_sk
(
Task
* 
t
);

74 
´iv©e
:

75 
	s‰t_¡©
 {

76 
ušt64_t
 
runs
;

77 
ušt64_t
 
·ddšg
[15];

78 
	`‰t_¡©
(è: 
	`runs
(0) {}

79 
	}
};

80 
Task
 
	g_maš_sk
;

81 
Task
* 
	g_sks
;

82 
‰t_¡©
* 
	g_‰t_¡©s
;

83 
	g_Áasks
;

84 
	g_ä“_b©ch
;

85 
	g_chªge_b©ch
;

86 
	g_maš_tick‘s
;

87 
ušt64_t
 
	g_maš_runs
;

88 
ušt64_t
 
	g_ä“_cyşes
;

89 
ušt64_t
 
	g_ü—‹_cyşes
;

90 
ušt64_t
 
	g_chªge_cyşes
;

91 
	g_´og»ss
;

93 
boŞ
 
maš_sk_ÿÎback
(
Task
*, *);

94 ’um { 
	gH_RUNS
 };

95 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
*, *è
CLICK_COLD
;

96 
	}
};

98 
	gCLICK_ENDDECLS


	@test/timertest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"tim”‹¡.hh
"

21 
	~<şick/glue.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/ma¡”.hh
>

25 
CLICK_DECLS


27 
	gTim”Te¡
::
	$Tim”Te¡
()

28 : 
	`_tim”
(
this
), 
	$_b’chm¬k
(0)

30 
	}
}

33 
	gTim”Te¡
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

35 
Time¡amp
 
	gd–ay
;

36 
boŞ
 
	gscheduË
 = 
çl£
;

37 ià(
Args
(
cÚf
, 
this
, 
”rh
)

38 .
»ad
("BENCHMARK", 
_b’chm¬k
)

39 .
»ad
("DELAY", 
d–ay
)

40 .
»ad
("SCHEDULE", 
scheduË
)

41 .
com¶‘e
() < 0)

43 
	g_tim”
.
š™Ÿlize
(
this
);

44 ià(
	gscheduË
 || 
	gd–ay
)

45 
	g_tim”
.
scheduË_aá”
(
d–ay
);

50 
	gTim”Te¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

52 ià(
_tim”
.
	`scheduËd
())

54 ià(
_b’chm¬k
 <= 0) {

55 
Tim”
 
deçuÉ_cÚ¡ruùÜ_tim”
;

56 
Tim”
 
ex¶ic™_do_nÙhšg_tim”
 = Tim”::
	`do_nÙhšg_t
();

58 
	`şick_ch©‹r
("Initializing default_constructor_timer");

59 
deçuÉ_cÚ¡ruùÜ_tim”
.
	`š™Ÿlize
(
this
);

60 
	`şick_ch©‹r
("Initializingƒxplicit_do_nothing_timer");

61 
ex¶ic™_do_nÙhšg_tim”
.
	`š™Ÿlize
(
this
);

63 
Time¡amp
 
now
 = Time¡amp::
	`now_¡—dy
();

64 
Tim”
 *
ts
 = 
Ãw
 Tim”[
_b’chm¬k
];

65 
i
 = 0; i < 
_b’chm¬k
; ++i) {

66 
ts
[
i
].
	`assign
();

67 
ts
[
i
].
	`š™Ÿlize
(
this
);

69 
	`b’chm¬k_scheduËs
(
ts
, 
_b’chm¬k
, 
now
);

70 
	`b’chm¬k_chªges
(
ts
, 
_b’chm¬k
, 
now
);

71 
	`b’chm¬k_fœes
(
ts
, 
_b’chm¬k
, 
now
);

72 
d–‘e
[] 
ts
;

76 
	}
}

79 
	gTim”Te¡
::
	$run_tim”
(
Tim”
 *
t
)

81 
	`şick_ch©‹r
("%p{time¡amp}: %p{–em’t} fœed", &
t
->
	`expœy_¡—dy
(), 
this
);

82 
	}
}

85 
	gTim”Te¡
::
	$b’chm¬k_scheduËs
(
Tim”
 *
ts
, 
Ás
, cÚ¡ 
Time¡amp
 &
now
)

87 
i
 = 0; i < 
Ás
; ++i)

88 
ts
[
i
].
	`scheduË_©_¡—dy
(
now
 + 
Time¡amp
::
	`make_m£c
(
	`şick_¿ndom
(0, 10000)));

89 
	}
}

92 
	gTim”Te¡
::
	$b’chm¬k_chªges
(
Tim”
 *
ts
, 
Ás
, cÚ¡ 
Time¡amp
 &
now
)

94 
Rou‹rTh»ad
 *
th
 = 
ts
->
	`th»ad
();

95 
i
 = 0; i < 6 * 
Ás
; ++i) {

96 
Tim”
 *
t
;

97 ià(
	`şick_¿ndom
(0, 8) < 6) {

98 
t
 = 
th
->
	`tim”_£t
().
	`Ãxt_tim”
();

99 
t
->
	`unscheduË
();

101 
t
 = &
ts
[
	`şick_¿ndom
(0, 
Ás
 - 1)];

102 
t
->
	`scheduË_©_¡—dy
(
now
 + 
Time¡amp
::
	`make_m£c
(
	`şick_¿ndom
(0, 10000)));

104 
	}
}

107 
	gTim”Te¡
::
	$b’chm¬k_fœes
(
Tim”
 *
ts
, , cÚ¡ 
Time¡amp
 &)

109 
Rou‹rTh»ad
 *
th
 = 
ts
->
	`th»ad
();

110 
Tim”
 *
t
 = 
th
->
	`tim”_£t
().
	`Ãxt_tim”
())

111 
t
->
	`unscheduË
();

112 
	}
}

114 
SŒšg


115 
	gTim”Te¡
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
)

117 
Tim”Te¡
 *
‰
 = 
¡©ic_ÿ¡
<Tim”Te¡ *>(
e
);

118 (
ušŒ_t
è
u£r_d©a
) {

119 
h_scheduËd
:

120  
	`SŒšg
(
‰
->
_tim”
.
	`scheduËd
());

121 
h_expœy
:

123  
	`SŒšg
(
‰
->
_tim”
.
	`expœy_¡—dy
());

125 
	}
}

128 
	gTim”Te¡
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
u£r_d©a
, 
E¼ÜHªdËr
 *
”rh
)

130 
Tim”Te¡
 *
‰
 = 
¡©ic_ÿ¡
<Tim”Te¡ *>(
e
);

131 (
ušŒ_t
è
u£r_d©a
) {

132 
h_scheduËd
: {

133 
boŞ
 
scheduË
;

134 ià(!
	`BoŞArg
().
	`·r£
(
¡r
, 
scheduË
))

135  
”rh
->
	`”rÜ
("syntaxƒrror");

136 ià(
scheduË
)

137 
‰
->
_tim”
.
	`scheduË_©_¡—dy
Ñt->_tim”.
	`expœy_¡—dy
());

139 
‰
->
_tim”
.
	`unscheduË
();

142 
h_scheduË_aá”
: {

143 
Time¡amp
 
d–ay
;

144 ià(!
	`Time¡ampArg
().
	`·r£
(
¡r
, 
d–ay
))

145  
”rh
->
	`”rÜ
("syntaxƒrror");

146 
‰
->
_tim”
.
	`scheduË_aá”
(
d–ay
);

149 
h_unscheduË
:

150 
‰
->
_tim”
.
	`unscheduË
();

154 
	}
}

157 
	gTim”Te¡
::
	$add_hªdËrs
()

159 
	`add_»ad_hªdËr
("scheduËd", 
»ad_hªdËr
, 
h_scheduËd
);

160 
	`add_wr™e_hªdËr
("scheduËd", 
wr™e_hªdËr
, 
h_scheduËd
);

161 
	`add_»ad_hªdËr
("expœy", 
»ad_hªdËr
, 
h_expœy
);

162 
	`add_wr™e_hªdËr
("scheduË_aá”", 
wr™e_hªdËr
, 
h_scheduË_aá”
);

163 
	`add_wr™e_hªdËr
("unscheduË", 
wr™e_hªdËr
, 
h_unscheduË
);

164 
	}
}

166 
CLICK_ENDDECLS


167 
EXPORT_ELEMENT
(
Tim”Te¡
)

	@test/timertest.hh

2 #iâdeà
CLICK_TIMERTEST_HH


3 
	#CLICK_TIMERTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/tim”.hh
>

6 
CLICK_DECLS


64 şas 
	cTim”Te¡
 : 
public
 
EËm’t
 {…ublic:

66 
	$Tim”Te¡
(è
CLICK_COLD
;

68 cÚ¡ *
	$şass_Çme
() const {  "TimerTest"; }

70 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

71 
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

72 
	$add_hªdËrs
(è
CLICK_COLD
;

74 
	`run_tim”
(
Tim”
 *
t
);

76 
´iv©e
:

78 
Tim”
 
_tim”
;

79 
_b’chm¬k
;

81 
	`b’chm¬k_scheduËs
(
Tim”
 *
ts
, 
Ás
, cÚ¡ 
Time¡amp
 &
now
);

82 
	`b’chm¬k_chªges
(
Tim”
 *
ts
, 
Ás
, cÚ¡ 
Time¡amp
 &
now
);

83 
	`b’chm¬k_fœes
(
Tim”
 *
ts
, 
Ás
, cÚ¡ 
Time¡amp
 &
now
);

85 ’um { 
h_scheduËd
, 
h_expœy
, 
h_scheduË_aá”
, 
h_unscheduË
 
	}
};

86 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *
e
, *
u£r_d©a
è
CLICK_COLD
;

87 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *
u£r_d©a
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

89 
	}
};

91 
	gCLICK_ENDDECLS


	@test/tokenbuckettest.cc

18 
	~<şick/cÚfig.h
>

19 
	~"tok’buck‘‹¡.hh
"

20 
	~<şick/tok’buck‘.hh
>

21 
	~<şick/”rÜ.hh
>

22 
CLICK_DECLS


24 
	gTok’Buck‘Te¡
::
	$Tok’Buck‘Te¡
()

26 
	}
}

28 
	#CHECK
(
x
èià(!(x)è 
”rh
->
	`”rÜ
("%s:%d:e¡ `%s' faed", 
__FILE__
, 
__LINE__
, #x);

	)

31 
	gTok’Buck‘Te¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

33 
Tok’Buck‘
 
tb
;

34 
tb
.
	`assign
(1024, 2048);

35 
	`CHECK
(
tb
.
	`¿‹
() >= 1022 &&b.rate() <= 1026);

36 
	`CHECK
(
tb
.
	`ÿ·c™y
() >= 2046 &&b.capacity() <= 2050);

37 
tb
.
	`£t_fuÎ
();

38 
tb
.
	`»fl
((
şick_jiff›s_t
)0);

39 
	`CHECK
(
tb
.
	`»move_if
(1024));

40 
	`CHECK
(
tb
.
	`»move_if
(1024));

41 
	`CHECK
(!
tb
.
	`»move_if
(1024));

42 
tb
.
	`»fl
((
şick_jiff›s_t
)
CLICK_HZ
 * 99 / 100);

43 
	`CHECK
(!
tb
.
	`»move_if
(1024));

44 
tb
.
	`»fl
((
şick_jiff›s_t
)
CLICK_HZ
);

45 
	`CHECK
(
tb
.
	`»move_if
(1024));

46 
	`CHECK
(!
tb
.
	`»move_if
(1024));

48 
Tok’Buck‘
 
	`tb2
(1024*1024*1024, 1);

49 
	`CHECK
(
tb2
.
	`fuÎ
());

50 
	`CHECK
(
tb2
.
	`»move_if
(1000));

52 
Tok’Buck‘
 
	`tb3
(1, 1024*1024*1024);

53 
	`CHECK
(
tb3
.
	`»move_if
(2*(
UINT_MAX
/
CLICK_HZ
)));

55 
Tok’Buck‘
 
	`tb4
(2, 1);

56 
tb4
.
	`»fl
(0);

57 
tb4
.
	`ş—r
();

58 
tb4
.
	`»fl
Ñb4.
	`time_uÁ_cÚšs
(1));

59 
	`CHECK
(
tb4
.
	`cÚšs
(1));

61 
tb4
.
	`»fl
(0);

62 
tb4
.
	`ş—r
();

63 
şick_jiff›s_t
 
dÚe_©
 = 
tb4
.
	`time_uÁ_cÚšs
(1);

64 
şick_jiff›s_t
 
cur_time
 = 0;

65 
cur_time
 < 
dÚe_©
) {

66 
	`CHECK
(
cur_time
 =ğ
dÚe_©
 - 1 || !
tb4
.
	`cÚšs
(1));

67 
	`CHECK
(
tb4
.
	`time_uÁ_cÚšs
(1è<ğ(
Tok’Buck‘
::
ticks_ty³
è(
dÚe_©
 - 
cur_time
));

68 ++
cur_time
;

69 
tb4
.
	`»fl
(
cur_time
);

71 
	`CHECK
(
tb4
.
	`cÚšs
(1));

73 
tb4
.
	`assign
(
Œue
);

74 
	`CHECK
(
tb4
.
	`¿‹
(è=ğ
Tok’Buck‘
::
max_tok’s
);

75 
	`CHECK
(
tb4
.
	`ÿ·c™y
(è=ğ
Tok’Buck‘
::
max_tok’s
);

77 
tb4
.
	`assign
(
çl£
);

78 
tb4
.
	`ş—r
();

79 
tb4
.
	`»fl
();

80 
	`CHECK
(
tb4
.
	`¿‹
() == 0);

81 
	`CHECK
(
tb4
.
	`ÿ·c™y
(è=ğ
Tok’Buck‘
::
max_tok’s
);

82 
	`CHECK
(
tb4
.
	`em±y
());

84 
tb4
.
	`assign
(0, 1024);

85 
	`CHECK
(
tb4
.
	`¿‹
() == 0);

86 
	`CHECK
(
tb4
.
	`ÿ·c™y
() == 1024);

88 
tb4
.
	`assign
(
çl£
);

89 
tb4
.
	`ş—r
();

90 
tb4
.
	`»fl
();

91 
	`CHECK
(
tb4
.
	`¿‹
() == 0);

92 
	`CHECK
(
tb4
.
	`ÿ·c™y
(è=ğ
Tok’Buck‘
::
max_tok’s
);

93 
	`CHECK
(
tb4
.
	`em±y
());

95 
tb4
.
	`assign
(0, 1024);

96 
	`CHECK
(
tb4
.
	`¿‹
() == 0);

97 
	`CHECK
(
tb4
.
	`ÿ·c™y
() == 1024);

99 
”rh
->
	`mes§ge
("Allests…ass!");

101 
	}
}

103 
	$EXPORT_ELEMENT
(
Tok’Buck‘Te¡
)

104 
CLICK_ENDDECLS


	@test/tokenbuckettest.hh

2 #iâdeà
CLICK_TOKENBUCKETTEST_HH


3 
	#CLICK_TOKENBUCKETTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


23 şas 
	cTok’Buck‘Te¡
 : 
public
 
EËm’t
 {…ublic:

25 
	$Tok’Buck‘Te¡
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "TokenBucketTest"; }

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

31 
	}
};

33 
	gCLICK_ENDDECLS


	@test/upstreamnotifier.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~"up¡»amnÙif›r.hh
"

24 
CLICK_DECLS


26 
	gUp¡»amNÙif›r
::
	$Up¡»amNÙif›r
()

28 
	}
}

31 
Up¡»amNÙif›r
::
	$ÿ¡
(cÚ¡ *
n
)

33 ià(
	`¡rcmp
(
n
, "UpstreamNotifier") == 0)

34  (
EËm’t
 *è
this
;

35 ià(
	`¡rcmp
(
n
, 
NÙif›r
::
FULL_NOTIFIER
) == 0)

36  
¡©ic_ÿ¡
<
NÙif›r
 *>(&
_nÙif›r
);

39 
	}
}

42 
	gUp¡»amNÙif›r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

44 
boŞ
 
	gsigÇl
;

45 
	g_nÙif›r
.
š™Ÿlize
(
NÙif›r
::
FULL_NOTIFIER
, 
rou‹r
());

47 ià(
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("SIGNAL", 
sigÇl
).
com¶‘e
() < 0)

50 
	g_nÙif›r
.
£t_aùive
(
sigÇl
, 
çl£
);

55 
	gUp¡»amNÙif›r
::
	$push
(
p
, 
Pack‘
 *
p_š
)

57 
	`ouut
(
p
).
	`push
(
p_š
);

58 
	}
}

60 ’um { 
	mH_SIGNAL
 };

62 
SŒšg


63 
	$»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

65 
Up¡»amNÙif›r
 *
f
 = (Up¡»amNÙif›¸*)
e
;

66 (
ušŒ_t
è
thunk
) {

67 
H_SIGNAL
:  
	`SŒšg
(
f
->
_nÙif›r
.
	`aùive
());

69  
	`SŒšg
();

70 
	}
}

73 
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
s
, 
EËm’t
 *
e
, *
v·¿m
,

74 
E¼ÜHªdËr
 *
”rh
)

76 
Up¡»amNÙif›r
 *
f
 = (Up¡»amNÙif›¸*)
e
;

77 (
šŒ_t
è
v·¿m
) {

78 
H_SIGNAL
: {

79 
boŞ
 
sigÇl
;

80 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
sigÇl
))

81  
”rh
->
	`”rÜ
("signal…arameter must be boolean");

82 
f
->
_nÙif›r
.
	`£t_aùive
(
sigÇl
, 
Œue
);

87 
	}
}

90 
	gUp¡»amNÙif›r
::
	$add_hªdËrs
()

92 
	`add_wr™e_hªdËr
("sigÇl", 
wr™e_·¿m
, 
H_SIGNAL
, 
HªdËr
::
CHECKBOX
);

93 
	`add_»ad_hªdËr
("sigÇl", 
»ad_·¿m
, 
H_SIGNAL
);

94 
	}
}

96 
CLICK_ENDDECLS


97 
EXPORT_ELEMENT
(
Up¡»amNÙif›r
)

	@test/upstreamnotifier.hh

1 #iâdeà
CLICK_UPSTREAMNOTIFIER_HH


2 
	#CLICK_UPSTREAMNOTIFIER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/nÙif›r.hh
>

5 
CLICK_DECLS


34 şas 
	cUp¡»amNÙif›r
 : 
public
 
EËm’t
 {…ublic:

36 
	$Up¡»amNÙif›r
(è
CLICK_COLD
;

38 cÚ¡ *
	$şass_Çme
() const {  "UpstreamNotifier"; }

39 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

40 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

42 *
ÿ¡
(const *);

43 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

45 
	$add_hªdËrs
(è
CLICK_COLD
;

46 
	`push
(, 
Pack‘
 *);

48 
AùiveNÙif›r
 
_nÙif›r
;

49 
	}
};

51 
	gCLICK_ENDDECLS


	@test/vectortest.cc

19 
	~<şick/cÚfig.h
>

20 
	~"veùÜ‹¡.hh
"

21 
	~<şick/veùÜ.hh
>

22 
	~<şick/”rÜ.hh
>

23 #ià
CLICK_USERLEVEL


24 
	~<sys/time.h
>

25 
	~<sys/»sourû.h
>

26 
	~<uni¡d.h
>

28 
CLICK_DECLS


30 
	gVeùÜTe¡
::
	$VeùÜTe¡
()

32 
	}
}

34 
	#CHECK
(
x
èià(!(x)è 
”rh
->
	`”rÜ
("%s:%d:e¡ %<%s%> faed", 
__FILE__
, 
__LINE__
, #x);

	)

37 
	gVeùÜTe¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

39 
VeùÜ
<> 
v
;

40 
v
.
	`push_back
(0);

41 
v
.
	`push_back
(1);

42 
v
.
	`push_back
(2);

43 
v
.
	`push_back
(4);

44 
	`CHECK
(
v
.
	`size
() == 4);

45 
	`CHECK
(
v
.
	`size
(è<ğv.
	`ÿ·c™y
());

47 
VeùÜ
<>::
™”©Ü
 
i
 = 
v
.
	`š£¹
(v.
	`’d
() - 1, 3);

48 
	`CHECK
(
i
 - 
v
.
	`begš
() == 3);

49 
	`CHECK
(*
i
 == 3);

50 
	`CHECK
(
v
.
	`size
() == 5 && v[0] == 0 && v[1] == 1 && v[2] == 2 && v[4] == 4);

52 
i
 = 
v
.
	`š£¹
(v.
	`’d
(), 5);

53 
	`CHECK
(
i
 =ğ
v
.
	`’d
() - 1);

54 
	`CHECK
(*
i
 == 5);

55 
	`CHECK
(
v
.
	`back
() == 5);

58 
VeùÜ
<> 
v2
;

59 
v
.
	`ş—r
();

60 
	`CHECK
(
v
.
	`size
() == 0);

61 
	`CHECK
(
v2
.
	`size
() == 0);

62 
i
 = 0; i < 10000; i++)

63 
v
 = 
v2
;

65 
”rh
->
	`mes§ge
("Allests…ass!");

67 
	}
}

69 
CLICK_ENDDECLS


70 
EXPORT_ELEMENT
(
VeùÜTe¡
)

	@test/vectortest.hh

2 #iâdeà
CLICK_VECTORTEST_HH


3 
	#CLICK_VECTORTEST_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


23 şas 
	cVeùÜTe¡
 : 
public
 
EËm’t
 {…ublic:

25 
	$VeùÜTe¡
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "VectorTest"; }

29 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

31 
	}
};

33 
	gCLICK_ENDDECLS


	@userlevel/changeuid.cc

19 
	~<şick/cÚfig.h
>

20 
	~"chªgeuid.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<uni¡d.h
>

23 
CLICK_DECLS


25 
	gChªgeUID
::
	$ChªgeUID
()

27 
	}
}

29 
ChªgeUID
::~
	$ChªgeUID
()

31 
	}
}

34 
ChªgeUID
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

36 ià(
	`£tgid
(
	`g‘gid
()è!ğ0 || 
	`£tuid
(
	`g‘uid
()) != 0)

37  
”rh
->
	`”rÜ
("could‚Ù drİ…rivege: %s", 
	`¡»¼Ü
(
”ºo
));

39 
	}
}

41 
CLICK_ENDDECLS


42 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

43 
	`EXPORT_ELEMENT
(
ChªgeUID
)

	@userlevel/changeuid.hh

2 #iâdeà
CLICK_CHANGEUID_HH


3 
	#CLICK_CHANGEUID_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/tim”.hh
>

6 
CLICK_DECLS


38 şas 
	cChªgeUID
 : 
public
 
EËm’t
 {…ublic:

40 
	$ChªgeUID
(è
CLICK_COLD
;

41 ~
	$ChªgeUID
(è
CLICK_COLD
;

43 cÚ¡ *
	$şass_Çme
() const {  "ChangeUID"; }

45 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_PRIVILEGED
+1; 
	}
}

46 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

48 
	}
};

50 
	gCLICK_ENDDECLS


	@userlevel/chattersocket.cc

19 
	~<şick/cÚfig.h
>

20 
	~"ch©‹rsock‘.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şickÃt/tı.h
>

26 
	~<uni¡d.h
>

27 
	~<sys/sock‘.h
>

28 
	~<sys/un.h
>

29 
	~<¬·/š‘.h
>

30 
	~<fú.h
>

31 
CLICK_DECLS


33 cÚ¡ 
	gCh©‹rSock‘
::
´ÙocŞ_v”siÚ
[] = "1.0";

35 
	gCh©‹rSock‘E¼ÜHªdËr
 : 
public
 
E¼ÜV’“r
 {

37 
VeùÜ
<
Ch©‹rSock‘
 *> 
_ch©‹r_sock‘s
;

39 
	gpublic
:

41 
Ch©‹rSock‘E¼ÜHªdËr
(
E¼ÜHªdËr
 *
”rh
)

42 : 
E¼ÜV’“r
(
”rh
) {

45 
nch©‹r_sock‘s
(ècÚ¡ {  
_ch©‹r_sock‘s
.
size
(); }

47 
add_ch©‹r_sock‘
(
Ch©‹rSock‘
 *);

48 
»move_ch©‹r_sock‘
(
Ch©‹rSock‘
 *);

50 *
em™
(cÚ¡ 
SŒšg
 &
¡r
, *
u£r_d©a
, 
boŞ
 
mÜe
);

55 
	gCh©‹rSock‘E¼ÜHªdËr
::
	$add_ch©‹r_sock‘
(
Ch©‹rSock‘
 *
cs
)

57 
i
 = 0; i < 
_ch©‹r_sock‘s
.
	`size
(); i++)

58 ià(
_ch©‹r_sock‘s
[
i
] =ğ
cs
)

60 
_ch©‹r_sock‘s
.
	`push_back
(
cs
);

61 
	}
}

64 
	gCh©‹rSock‘E¼ÜHªdËr
::
	$»move_ch©‹r_sock‘
(
Ch©‹rSock‘
 *
cs
)

66 
i
 = 0; i < 
_ch©‹r_sock‘s
.
	`size
(); i++)

67 ià(
_ch©‹r_sock‘s
[
i
] =ğ
cs
) {

68 
_ch©‹r_sock‘s
[
i
] = _ch©‹r_sock‘s.
	`back
();

69 
_ch©‹r_sock‘s
.
	`pİ_back
();

72 
	}
}

75 
	gCh©‹rSock‘E¼ÜHªdËr
::
	$em™
(cÚ¡ 
SŒšg
 &
¡r
, *
u£r_d©a
, 
boŞ
 
mÜe
)

77 
u£r_d©a
 = 
E¼ÜV’“r
::
	`em™
(
¡r
, u£r_d©a, 
mÜe
);

79 
SŒšg
 
Ïndm¬k
;

80 cÚ¡ *
s
 = 
	`·r£_ªno
(
¡r
, sŒ.
	`begš
(), sŒ.
	`’d
(),

81 "l", &
Ïndm¬k
, (const *) 0);

82 
SŒšg
 
x
 = 
	`ş—n_Ïndm¬k
(
Ïndm¬k
, 
Œue
è+ 
¡r
.
	`sub¡ršg
(
s
, sŒ.
	`’d
())

83 + 
	`SŒšg
("\n");

85 
i
 = 0; i < 
_ch©‹r_sock‘s
.
	`size
(); i++)

86 
_ch©‹r_sock‘s
[
i
]->
	`em™
(
x
);

87  
u£r_d©a
;

88 
	}
}

91 
Ch©‹rSock‘E¼ÜHªdËr
 *
	gch©‹r_sock‘_”rh
;

92 
E¼ÜHªdËr
 *
	gba£_deçuÉ_”rh
;

94 
	gCh©‹rSock‘
::
	$Ch©‹rSock‘
()

95 : 
	`_sock‘_fd
(-1), 
	`_chªÃl
("deçuÉ"), 
	$_»Œy_tim”
(0)

97 
	}
}

99 
	gCh©‹rSock‘
::~
	$Ch©‹rSock‘
()

101 
	}
}

104 
Ch©‹rSock‘
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

106 
SŒšg
 
	gsockty³
;

107 
Args
 
	g¬gs
 = Args(
this
, 
”rh
).
bšd
(
cÚf
);

108 ià(
	g¬gs
.
»ad_mp
("TYPE", 
sockty³
).
execu‹
() < 0)

112 
boŞ
 
	gqu›t_chªÃl
 = 
Œue
, 
	gg»‘šg
 =rue, 
	g»Œy_w¬nšgs
 =rue;

113 
	g_»Œ›s
 = 0;

114 ià(
	g¬gs
.
»ad
("CHANNEL", 
WÜdArg
(), 
_chªÃl
)

115 .
»ad
("QUIET_CHANNEL", 
qu›t_chªÃl
)

116 .
»ad
("GREETING", 
g»‘šg
)

117 .
»ad
("RETRIES", 
_»Œ›s
)

118 .
»ad
("RETRY_WARNINGS", 
»Œy_w¬nšgs
)

119 .
cÚsume
() < 0)

121 
	g_g»‘šg
 = 
g»‘šg
;

122 
	g_»Œy_w¬nšgs
 = 
»Œy_w¬nšgs
;

124 
	gsockty³
 = 
sockty³
.
uµ”
();

125 ià(
	gsockty³
 == "TCP") {

126 
_tı_sock‘
 = 
Œue
;

127 
ušt16_t
 
	gpÜŠo
;

128 ià(
	g¬gs
.
»ad_mp
("PORT", 
IPPÜtArg
(
IP_PROTO_TCP
), 
pÜŠo
)

129 .
com¶‘e
() < 0)

131 
	g_unix_·thÇme
 = 
SŒšg
(
pÜŠo
);

133 } ià(
	gsockty³
 == "UNIX") {

134 
_tı_sock‘
 = 
çl£
;

135 ià(
	g¬gs
.
»ad_mp
("FILENAME", 
F’ameArg
(), 
_unix_·thÇme
)

136 .
com¶‘e
() < 0)

138 ià(
	g_unix_·thÇme
.
Ëngth
(è>ğ()(((
sockaddr_un
 *)0)->
sun_·th
))

139  
”rh
->
”rÜ
("filenameoo†ong");

142  
	g”rh
->
”rÜ
("unknowÀsock‘y³ `%s'", 
sockty³
.
c_¡r
());

145 
Ch©‹rSock‘E¼ÜHªdËr
 *
	gc£¼h
;

146 ià(
	g_chªÃl
 =ğ"deçuÉ" && 
ch©‹r_sock‘_”rh
)

147 
c£¼h
 = 
ch©‹r_sock‘_”rh
;

148 ià(
	g_chªÃl
 == "default") {

149 
ba£_deçuÉ_”rh
 = 
E¼ÜHªdËr
::
deçuÉ_hªdËr
();

150 
	gch©‹r_sock‘_”rh
 = 
Ãw
 
Ch©‹rSock‘E¼ÜHªdËr
(
ba£_deçuÉ_”rh
);

151 
	gE¼ÜHªdËr
::
£t_deçuÉ_hªdËr
(
ch©‹r_sock‘_”rh
);

152 
	gc£¼h
 = 
ch©‹r_sock‘_”rh
;

153 } ià(*
	gv
 = 
rou‹r
()->
©chm’t
("Ch©‹rChªÃl." + 
_chªÃl
))

154 
c£¼h
 = (
Ch©‹rSock‘E¼ÜHªdËr
 *)
v
;

156 
E¼ÜHªdËr
 *
	gba£
 = (
qu›t_chªÃl
 ? E¼ÜHªdËr::
s’t_hªdËr
(è: 
ba£_deçuÉ_”rh
);

157 ià(!
	gba£
èba£ = 
E¼ÜHªdËr
::
deçuÉ_hªdËr
();

158 
	gc£¼h
 = 
Ãw
 
Ch©‹rSock‘E¼ÜHªdËr
(
ba£
);

159 
rou‹r
()->
£t_©chm’t
("Ch©‹rChªÃl." + 
_chªÃl
, 
c£¼h
);

163 
	gc£¼h
->
add_ch©‹r_sock‘
(
this
);

170 
	gCh©‹rSock‘
::
	$š™Ÿlize_sock‘_”rÜ
(
E¼ÜHªdËr
 *
”rh
, cÚ¡ *
sysÿÎ
)

172 
e
 = 
”ºo
;

174 ià(
_sock‘_fd
 >= 0) {

175 
	`şo£
(
_sock‘_fd
);

176 
_sock‘_fd
 = -1;

179 ià(
_»Œ›s
 >= 0) {

180 ià(
_»Œy_w¬nšgs
)

181 
”rh
->
	`w¬nšg
("%s: % (%d % Ëá)", 
sysÿÎ
, 
	`¡»¼Ü
(
e
), 
_»Œ›s
 + 1, (_retries == 0 ? "try" : "tries"));

182  -
EINVAL
;

184  
”rh
->
	`”rÜ
("%s: %s", 
sysÿÎ
, 
	`¡»¼Ü
(
e
));

185 
	}
}

188 
	gCh©‹rSock‘
::
	$š™Ÿlize_sock‘
(
E¼ÜHªdËr
 *
”rh
)

190 
_»Œ›s
--;

193 ià(
_tı_sock‘
) {

194 
_sock‘_fd
 = 
	`sock‘
(
PF_INET
, 
SOCK_STREAM
, 0);

195 ià(
_sock‘_fd
 < 0)

196  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "socket");

197 
sockİt
 = 1;

198 ià(
	`£tsockİt
(
_sock‘_fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, (*)&
sockİt
, (sockopt)) < 0)

199 
”rh
->
	`w¬nšg
("£tsockİt: %s", 
	`¡»¼Ü
(
”ºo
));

202 
pÜŠo
 = -1;

203 (è
	`IÁArg
().
	`·r£
(
_unix_·thÇme
, 
pÜŠo
);

204 
sockaddr_š
 
§
;

205 
§
.
sš_çmy
 = 
AF_INET
;

206 
§
.
sš_pÜt
 = 
	`htÚs
(
pÜŠo
);

207 
§
.
sš_addr
 = 
	`IPAdd»ss
().
	`š_addr
();

208 ià(
	`bšd
(
_sock‘_fd
, (
sockaddr
 *)&
§
, (sa)) < 0)

209  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "bind");

212 
_sock‘_fd
 = 
	`sock‘
(
PF_UNIX
, 
SOCK_STREAM
, 0);

213 ià(
_sock‘_fd
 < 0)

214  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "socket");

217 
sockaddr_un
 
§
;

218 
§
.
sun_çmy
 = 
AF_UNIX
;

219 
	`memıy
(
§
.
sun_·th
, 
_unix_·thÇme
.
	`c_¡r
(), _unix_·thÇme.
	`Ëngth
() + 1);

220 ià(
	`bšd
(
_sock‘_fd
, (
sockaddr
 *)&
§
, (sa)) < 0)

221  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "bind");

225 ià(
	`li¡’
(
_sock‘_fd
, 2) < 0)

226  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "listen");

229 
	`fú
(
_sock‘_fd
, 
F_SETFL
, 
O_NONBLOCK
);

230 
	`fú
(
_sock‘_fd
, 
F_SETFD
, 
FD_CLOEXEC
);

232 
	`add_£Ëù
(
_sock‘_fd
, 
SELECT_READ
);

234 
	}
}

237 
	gCh©‹rSock‘
::
	$»Œy_hook
(
Tim”
 *
t
, *
thunk
)

239 
Ch©‹rSock‘
 *
cs
 = (Ch©‹rSock‘ *)
thunk
;

240 ià(
cs
->
_sock‘_fd
 >= 0)

242 ià(
cs
->
	`š™Ÿlize_sock‘
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
()) >= 0)

244 ià(
cs
->
_»Œ›s
 >= 0)

245 
t
->
	`»scheduË_aá”_£c
(1);

247 
cs
->
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

248 
	}
}

251 
	gCh©‹rSock‘
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

253 
_max_pos
 = 0;

254 
_live_fds
 = 0;

256 ià(
	`š™Ÿlize_sock‘
(
”rh
) >= 0)

258 ià(
_»Œ›s
 >= 0) {

259 
_»Œy_tim”
 = 
Ãw
 
	`Tim”
(
»Œy_hook
, 
this
);

260 
_»Œy_tim”
->
	`š™Ÿlize
(
this
);

261 
_»Œy_tim”
->
	`scheduË_aá”_£c
(1);

265 
	}
}

268 
	gCh©‹rSock‘
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *
”rh
)

270 
Ch©‹rSock‘
 *
cs
 = (Ch©‹rSock‘ *)
e
->
	`ÿ¡
("ChatterSocket");

271 ià(!
cs
)

274 ià(
_sock‘_fd
 >= 0) {

275 
”rh
->
	`”rÜ
("already initialized, can'take state");

277 } ià(
_tı_sock‘
 !ğ
cs
->_tcp_socket

278 || 
_unix_·thÇme
 !ğ
cs
->_unix_pathname

279 || 
_chªÃl
 !ğ
cs
->_channel) {

280 
”rh
->
	`”rÜ
("incompatible ChatterSockets");

284 
_sock‘_fd
 = 
cs
->_socket_fd;

285 
cs
->
_sock‘_fd
 = -1;

286 
_mes§ges
.
	`sw­
(
cs
->_messages);

287 
_mes§ge_pos
.
	`sw­
(
cs
->_message_pos);

288 
_max_pos
 = 
cs
->_max_pos;

289 
_fd_®ive
.
	`sw­
(
cs
->_fd_alive);

290 
_fd_pos
.
	`sw­
(
cs
->_fd_pos);

291 
_live_fds
 = 
cs
->_live_fds;

292 
cs
->
_live_fds
 = 0;

294 ià(
_sock‘_fd
 >= 0)

295 
	`add_£Ëù
(
_sock‘_fd
, 
SELECT_READ
);

296 
i
 = 0; i < 
_fd_®ive
.
	`size
(); i++)

297 ià(
_fd_®ive
[
i
])

298 
	`add_£Ëù
(
i
, 
SELECT_WRITE
);

299 
	}
}

302 
	$»move_ch©‹r_chªÃl
(
Ch©‹rSock‘E¼ÜHªdËr
 *&
c£¼h
, 
Ch©‹rSock‘
 *
cs
)

304 ià(
c£¼h
) {

305 
c£¼h
->
	`»move_ch©‹r_sock‘
(
cs
);

306 ià(!
c£¼h
->
	`nch©‹r_sock‘s
()) {

307 ià(
c£¼h
 =ğ
ch©‹r_sock‘_”rh
)

308 
E¼ÜHªdËr
::
	`£t_deçuÉ_hªdËr
(
ba£_deçuÉ_”rh
);

309 
d–‘e
 
c£¼h
;

310 
c£¼h
 = 0;

313 
	}
}

316 
	gCh©‹rSock‘
::
	$ş—nup
(
CËªupSge
)

318 ià(
_sock‘_fd
 >= 0) {

320 #ifdeà
SHUT_RDWR


321 
	`shutdown
(
_sock‘_fd
, 
SHUT_RDWR
);

323 
	`shutdown
(
_sock‘_fd
, 2);

325 
	`şo£
(
_sock‘_fd
);

326 ià(!
_tı_sock‘
)

327 
	`uÆšk
(
_unix_·thÇme
.
	`c_¡r
());

328 
_sock‘_fd
 = -1;

331 
i
 = 0; i < 
_fd_®ive
.
	`size
(); i++)

332 ià(
_fd_®ive
[
i
]) {

333 
	`şo£
(
i
);

334 
_fd_®ive
[
i
] = 0;

336 
_live_fds
 = 0;

338 ià(
_»Œy_tim”
) {

339 
d–‘e
 
_»Œy_tim”
;

340 
_»Œy_tim”
 = 0;

344 ià(
_chªÃl
 == "default")

345 
	`»move_ch©‹r_chªÃl
(
ch©‹r_sock‘_”rh
, 
this
);

347 
»move_ch©‹r_chªÃl


348 ((
Ch©‹rSock‘E¼ÜHªdËr
 *&)(
	`rou‹r
()->
	`fÜû_©chm’t
("Ch©‹rChªÃl." + 
_chªÃl
)), 
this
);

349 
	}
}

352 
	gCh©‹rSock‘
::
	$æush
(
fd
)

355 ià(
fd
 >ğ
_fd_®ive
.
	`size
() || !_fd_alive[fd])

356  
_mes§ges
.
	`size
();

359 ià(
_fd_pos
[
fd
] =ğ
_max_pos
)

360  
_mes§ges
.
	`size
();

363 
ušt32_t
 
fd_pos
 = 
_fd_pos
[
fd
];

364 
l
 = 0, 
r
 = 
_mes§ges
.
	`size
(è- 1, 
u£ful_mes§ge
 = -1;

365 
l
 <ğ
r
) {

366 
m
 = (
l
 + 
r
) >> 1;

367 ià(
	`SEQ_LT
(
fd_pos
, 
_mes§ge_pos
[
m
]))

368 
r
 = 
m
 - 1;

369 ià(
	`SEQ_GEQ
(
fd_pos
, 
_mes§ge_pos
[
m
] + 
_mes§ges
[m].
	`Ëngth
()))

370 
l
 = 
m
 + 1;

372 
u£ful_mes§ge
 = 
m
;

378 ià(
u£ful_mes§ge
 >= 0) {

379 
u£ful_mes§ge
 < 
_mes§ge_pos
.
	`size
()) {

380 cÚ¡ 
SŒšg
 &
m
 = 
_mes§ges
[
u£ful_mes§ge
];

381 
mpos
 = 
_mes§ge_pos
[
u£ful_mes§ge
];

382 cÚ¡ *
d©a
 = 
m
.
	`d©a
(è+ (
fd_pos
 - 
mpos
);

383 
Ën
 = 
m
.
	`Ëngth
(è- (
fd_pos
 - 
mpos
);

384 
w
 = 
	`wr™e
(
fd
, 
d©a
, 
Ën
);

385 ià(
w
 < 0 && 
”ºo
 !ğ
EINTR
) {

386 ià(
”ºo
 !ğ
EAGAIN
)

387 
u£ful_mes§ge
 = -1;

389 } ià(
w
 > 0)

390 
fd_pos
 +ğ
w
;

391 ià(
	`SEQ_GEQ
(
fd_pos
, 
mpos
 + 
m
.
	`Ëngth
()))

392 
u£ful_mes§ge
++;

397 
_fd_pos
[
fd
] = 
fd_pos
;

400 ià(
u£ful_mes§ge
 < 0 || 
	`SEQ_LT
(
fd_pos
, 
_max_pos
 - 
MAX_BACKLOG
)) {

401 
	`şo£
(
fd
);

402 
	`»move_£Ëù
(
fd
, 
SELECT_WRITE
);

403 
_fd_®ive
[
fd
] = 0;

404 
_live_fds
--;

405 } ià(
fd_pos
 =ğ
_max_pos
)

406 
	`»move_£Ëù
(
fd
, 
SELECT_WRITE
);

408 
	`add_£Ëù
(
fd
, 
SELECT_WRITE
);

410  
u£ful_mes§ge
;

411 
	}
}

414 
	gCh©‹rSock‘
::
	$æush
()

416 
mš_u£ful_mes§ge
 = 
_mes§ges
.
	`size
();

417 ià(
mš_u£ful_mes§ge
)

418 
i
 = 0; i < 
_fd_®ive
.
	`size
(); i++)

419 ià(
_fd_®ive
[
i
] >= 0) {

420 
m
 = 
	`æush
(
i
);

421 ià(
m
 < 
mš_u£ful_mes§ge
)

422 
mš_u£ful_mes§ge
 = 
m
;

426 ià(
mš_u£ful_mes§ge
 >= 10) {

427 
_mes§ges
.
	`”a£
(_mes§ges.
	`begš
(), _mes§ges.begš(è+ 
mš_u£ful_mes§ge
);

428 
_mes§ge_pos
.
	`”a£
(_mes§ge_pos.
	`begš
(), _mes§ge_pos.begš(è+ 
mš_u£ful_mes§ge
);

430 
	}
}

433 
	gCh©‹rSock‘
::
	$£Ëùed
(
fd
, )

435 ià(
fd
 =ğ
_sock‘_fd
) {

436 uniÚ { 
sockaddr_š
 
š
; 
sockaddr_un
 
un
; } 
§
;

437 #ià
HAVE_ACCEPT_SOCKLEN_T


438 
sockËn_t
 
§_Ën
;

440 
§_Ën
;

442 
§_Ën
 = (
§
);

443 
Ãw_fd
 = 
	`acû±
(
_sock‘_fd
, (
sockaddr
 *)&
§
, &
§_Ën
);

445 ià(
Ãw_fd
 < 0) {

446 ià(
”ºo
 !ğ
EAGAIN
)

447 
	`şick_ch©‹r
("%s:‡cû±: %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

451 
	`fú
(
Ãw_fd
, 
F_SETFL
, 
O_NONBLOCK
);

452 
	`fú
(
Ãw_fd
, 
F_SETFD
, 
FD_CLOEXEC
);

454 
Ãw_fd
 >ğ
_fd_®ive
.
	`size
()) {

455 
_fd_®ive
.
	`push_back
(0);

456 
_fd_pos
.
	`push_back
(0);

458 
_fd_®ive
[
Ãw_fd
] = 1;

459 
_fd_pos
[
Ãw_fd
] = 
_max_pos
;

460 
_live_fds
++;

462 
fd
 = 
Ãw_fd
;

465 ià(
_g»‘šg
) {

467 
SŒšg
 
s
 = 
	`SŒšg
("Click::Ch©‹rSock‘/"è+ 
´ÙocŞ_v”siÚ
 + "\r\n";

468 
w
 = 
	`wr™e
(
fd
, 
s
.
	`d©a
(), s.
	`Ëngth
());

469 ià(
w
 !ğ
s
.
	`Ëngth
())

470 
	`şick_ch©‹r
("% fd %d: uÇbËØwr™g»‘šg!", 
	`deş¬©iÚ
().
	`c_¡r
(), 
fd
);

474 
	`æush
(
fd
);

475 
	}
}

477 
CLICK_ENDDECLS


478 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

479 
	`EXPORT_ELEMENT
(
Ch©‹rSock‘
)

	@userlevel/chattersocket.hh

1 #iâdeà
CLICK_CHATTERSOCKET_HH


2 
	#CLICK_CHATTERSOCKET_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/”rÜ.hh
>

5 
CLICK_DECLS


95 
şass
 
	gTim”
;

97 şas 
	cCh©‹rSock‘
 : 
public
 
EËm’t
 {…ublic:

99 
	$Ch©‹rSock‘
(è
CLICK_COLD
;

100 ~
	$Ch©‹rSock‘
(è
CLICK_COLD
;

102 cÚ¡ *
	$şass_Çme
() const {  "ChatterSocket"; }

104 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_INFO
; 
	}
}

105 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

106 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

107 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

108 
	`ke_¡©e
(
EËm’t
 *, 
E¼ÜHªdËr
 *);

110 
	`£Ëùed
(
fd
, 
mask
);

112 
	`em™
(cÚ¡ 
SŒšg
 &);

113 
	`æush
();

115 
´iv©e
:

117 
SŒšg
 
_unix_·thÇme
;

118 
_sock‘_fd
;

119 
SŒšg
 
_chªÃl
;

120 
boŞ
 
_g»‘šg
 : 1;

121 
boŞ
 
_»Œy_w¬nšgs
 : 1;

122 
boŞ
 
_tı_sock‘
 : 1;

124 
VeùÜ
<
SŒšg
> 
_mes§ges
;

125 
VeùÜ
<
ušt32_t
> 
_mes§ge_pos
;

126 
ušt32_t
 
_max_pos
;

128 
VeùÜ
<> 
_fd_®ive
;

129 
VeùÜ
<
ušt32_t
> 
_fd_pos
;

130 
_live_fds
;

132 
_»Œ›s
;

133 
Tim”
 *
_»Œy_tim”
;

135 cÚ¡ 
´ÙocŞ_v”siÚ
[];

136 ’um { 
MAX_BACKLOG
 = 500000 
	}
};

138 
š™Ÿlize_sock‘_”rÜ
(
E¼ÜHªdËr
 *, const *);

139 
š™Ÿlize_sock‘
(
E¼ÜHªdËr
 *);

140 
»Œy_hook
(
Tim”
 *, *);

142 
æush
(
fd
);

146 
šlše
 

147 
	gCh©‹rSock‘
::
	$em™
(cÚ¡ 
SŒšg
 &
mes§ge
)

149 ià(
_live_fds
 && 
mes§ge
.
	`Ëngth
()) {

150 
_mes§ges
.
	`push_back
(
mes§ge
);

151 
_mes§ge_pos
.
	`push_back
(
_max_pos
);

152 
_max_pos
 +ğ
mes§ge
.
	`Ëngth
();

153 
	`æush
();

155 
	}
}

157 
	gCLICK_ENDDECLS


	@userlevel/controlsocket.cc

21 
	~<şick/cÚfig.h
>

22 
	~"cÚŒŞsock‘.hh
"

23 
	~<şick/¬gs.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/tim”.hh
>

26 
	~<şick/rou‹r.hh
>

27 
	~<şick/¡¿ccum.hh
>

28 
	~<şick/Î½c.h
>

29 
	~<uni¡d.h
>

30 
	~<sys/sock‘.h
>

31 
	~<sys/un.h
>

32 
	~<¬·/š‘.h
>

33 
	~<fú.h
>

34 
CLICK_DECLS


36 cÚ¡ 
	gCÚŒŞSock‘
::
´ÙocŞ_v”siÚ
[] = "1.3";

38 şas 
	cCÚŒŞSock‘E¼ÜHªdËr
 : 
public
 
E¼ÜHªdËr
 {…ublic:

40 
	$CÚŒŞSock‘E¼ÜHªdËr
()

41 : 
	`_”rÜ_code
(
CÚŒŞSock‘
::
CSERR_OK
), 
	$_nw¬nšgs
(0) {

44 cÚ¡ 
VeùÜ
<
SŒšg
> &
	$mes§ges
() const {

45  
_mes§ges
;

46 
	}
}

47 
	$”rÜ_code
() const {

48  
_”rÜ_code
;

49 
	}
}

50 
	$nw¬nšgs
() const {

51  
_nw¬nšgs
;

52 
	}
}

54 *
em™
(cÚ¡ 
SŒšg
 &
¡r
, *
u£r_d©a
, 
boŞ
 
mÜe
);

55 
accouÁ
(
Ëv–
);

57 
	g´iv©e
:

59 
VeùÜ
<
SŒšg
> 
_mes§ges
;

60 
	g_”rÜ_code
;

61 
	g_nw¬nšgs
;

66 
	gCÚŒŞSock‘E¼ÜHªdËr
::
	$em™
(cÚ¡ 
SŒšg
 &
¡r
, *, 
boŞ
)

68 
SŒšg
 
Ïndm¬k
;

69 cÚ¡ *
s
 = 
	`·r£_ªno
(
¡r
, sŒ.
	`begš
(), sŒ.
	`’d
(), "l", &
Ïndm¬k
,

70 "#c£¼", &
_”rÜ_code
, (const *) 0);

71 
_mes§ges
.
	`push_back
(
	`ş—n_Ïndm¬k
(
Ïndm¬k
, 
Œue
)

72 + 
¡r
.
	`sub¡ršg
(
s
, sŒ.
	`’d
()));

74 
	}
}

77 
	gCÚŒŞSock‘E¼ÜHªdËr
::
	$accouÁ
(
Ëv–
)

79 
E¼ÜHªdËr
::
	`accouÁ
(
Ëv–
);

80 ià(
Ëv–
 =ğ
–_w¬nšg
)

81 ++
_nw¬nšgs
;

82 
	}
}

85 
	gCÚŒŞSock‘
::
	$CÚŒŞSock‘
()

86 : 
	`_sock‘_fd
(-1), 
	`_´oxy
(0), 
	`_fuÎ_´oxy
(0), 
	$_»Œy_tim”
(0)

88 
	}
}

90 
	gCÚŒŞSock‘
::~
	$CÚŒŞSock‘
()

92 
	}
}

95 
CÚŒŞSock‘
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

97 
SŒšg
 
	gsockty³
;

98 
Args
 
	g¬gs
 = Args(
this
, 
”rh
).
bšd
(
cÚf
);

99 ià(
	g¬gs
.
»ad_mp
("TYPE", 
sockty³
).
execu‹
() < 0)

103 
boŞ
 
	g»ad_Úly
 = 
çl£
, 
	gv”bo£
 = f®£, 
	g»Œy_w¬nšgs
 = 
Œue
, 
	gloÿlho¡
 = false;

104 
	g_»Œ›s
 = 0;

105 ià(
	g¬gs
.
»ad
("READONLY", 
»ad_Úly
)

106 .
»ad
("PROXY", 
_´oxy
)

107 .
»ad
("VERBOSE", 
v”bo£
)

108 .
»ad
("RETRIES", 
_»Œ›s
)

109 .
»ad
("RETRY_WARNINGS", 
»Œy_w¬nšgs
)

110 .
»ad
("LOCALHOST", 
loÿlho¡
)

111 .
cÚsume
() < 0)

113 
	g_»ad_Úly
 = 
»ad_Úly
;

114 
	g_v”bo£
 = 
v”bo£
;

115 
	g_»Œy_w¬nšgs
 = 
»Œy_w¬nšgs
;

116 
	g_loÿlho¡
 = 
loÿlho¡
;

118 
	gsockty³
 = 
sockty³
.
uµ”
();

119 ià(
	gsockty³
 == "TCP") {

120 
_ty³
 = 
ty³_tı
;

121 ià(
	g¬gs
.
»ad_mp
("PORT", 
WÜdArg
(), 
_unix_·thÇme
)

122 .
com¶‘e
() < 0)

124 
ušt16_t
 
	gpÜŠo
;

125 
	gpÜŠo_št
 = 0;

126 ià(
IPPÜtArg
(
IP_PROTO_TCP
).
·r£
(
_unix_·thÇme
, 
pÜŠo
, 
this
))

127 
	g_unix_·thÇme
 = 
SŒšg
(
pÜŠo
);

128 ià(
	g_unix_·thÇme
 && _unix_·thÇme.
back
() == '+'

129 && 
IÁArg
().
·r£
(
_unix_·thÇme
.
sub¡ršg
(0, -1), 
pÜŠo_št
)

130 && 
	gpÜŠo_št
 > 0 &&…ortno_int < 65536)

131 
	g_unix_·thÇme
 = 
SŒšg
(
pÜŠo_št
) + "+";

133  
	g”rh
->
”rÜ
("PORT„equires TCP…ort");

135 } ià(
	gsockty³
 == "UNIX") {

136 
_ty³
 = 
ty³_unix
;

137 ià(
	g¬gs
.
»ad_mp
("FILENAME", 
F’ameArg
(), 
_unix_·thÇme
)

138 .
com¶‘e
() < 0)

140 ià(
	g_unix_·thÇme
.
Ëngth
(è>ğ()(((
sockaddr_un
 *)0)->
sun_·th
))

141  
”rh
->
”rÜ
("filenameoo†ong");

143 } ià(
	gsockty³
 == "SOCKET") {

144 
_ty³
 = 
ty³_sock‘
;

145 
	gfd
;

146 ià(
	g¬gs
.
»ad_mp
("FD", 
fd
).
com¶‘e
() < 0)

148 
	g_unix_·thÇme
 = 
SŒšg
(
fd
);

151  
	g”rh
->
”rÜ
("unknowÀsock‘y³ %<%s%>", 
sockty³
.
c_¡r
());

158 
	gCÚŒŞSock‘
::
	$š™Ÿlize_sock‘_”rÜ
(
E¼ÜHªdËr
 *
”rh
, cÚ¡ *
sysÿÎ
)

160 
e
 = 
”ºo
;

162 ià(
_sock‘_fd
 >= 0) {

163 
	`şo£
(
_sock‘_fd
);

164 
_sock‘_fd
 = -1;

167 ià(
_»Œ›s
 >= 0) {

168 ià(
_»Œy_w¬nšgs
)

169 
”rh
->
	`w¬nšg
("%s: % (%d % Ëá)", 
sysÿÎ
, 
	`¡»¼Ü
(
e
), 
_»Œ›s
 + 1, (_retries == 0 ? "try" : "tries"));

170  -
EINVAL
;

172  
”rh
->
	`”rÜ
("%s: %s", 
sysÿÎ
, 
	`¡»¼Ü
(
e
));

173 
	}
}

176 
	gCÚŒŞSock‘
::
	$š™Ÿlize_sock‘
(
E¼ÜHªdËr
 *
”rh
)

178 
_»Œ›s
--;

181 ià(
_ty³
 =ğ
ty³_tı
) {

182 
_sock‘_fd
 = 
	`sock‘
(
PF_INET
, 
SOCK_STREAM
, 0);

183 ià(
_sock‘_fd
 < 0)

184  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "socket");

185 
sockİt
 = 1;

186 ià(
	`£tsockİt
(
_sock‘_fd
, 
SOL_SOCKET
, 
SO_REUSEADDR
, (*)&
sockİt
, (sockopt)) < 0)

187 
”rh
->
	`w¬nšg
("£tsockİt: %s", 
	`¡»¼Ü
(
”ºo
));

190 
pÜŠo
;

191 (è
	`ı_š‹g”
(
_unix_·thÇme
.
	`begš
(), _unix_·thÇme.
	`’d
(), 0, &
pÜŠo
);

192 
sockaddr_š
 
§
;

193 
§
.
sš_çmy
 = 
AF_INET
;

194 
§
.
sš_pÜt
 = 
	`htÚs
(
pÜŠo
);

195 ià(
_loÿlho¡
)

196 
§
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_LOOPBACK
);

198 
§
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

199 
Œ›s
 = 0;

200 
	`bšd
(
_sock‘_fd
, (
sockaddr
 *)&
§
, (sa)) < 0) {

201 ià(
Œ›s
 > 10 || 
_unix_·thÇme
.
	`back
(è!ğ'+' || 
pÜŠo
 >= 65534

202 || (
_»Œ›s
 >ğ0 && 
	`hÙsw­_–em’t
()))

203  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "bind");

204 ++
pÜŠo
, ++
Œ›s
;

205 
§
.
sš_pÜt
 = 
	`htÚs
(
pÜŠo
);

207 
_unix_·thÇme
 = 
	`SŒšg
(
pÜŠo
);

209 } ià(
_ty³
 =ğ
ty³_unix
) {

210 
_sock‘_fd
 = 
	`sock‘
(
PF_UNIX
, 
SOCK_STREAM
, 0);

211 ià(
_sock‘_fd
 < 0)

212  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "socket");

215 
sockaddr_un
 
§
;

216 
§
.
sun_çmy
 = 
AF_UNIX
;

217 
	`memıy
(
§
.
sun_·th
, 
_unix_·thÇme
.
	`c_¡r
(), _unix_·thÇme.
	`Ëngth
() + 1);

218 ià(
	`bšd
(
_sock‘_fd
, (
sockaddr
 *)&
§
, (sa)) < 0)

219  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "bind");

221 } ià(
_ty³
 =ğ
ty³_sock‘
) {

222 ià(!
	`hÙsw­_–em’t
()) {

223 
fd
;

224 (è
	`Args
().
	`push_back_wÜds
(
_unix_·thÇme
).
	`»ad_mp
("FD", 
fd
).
	`execu‹
();

225 
	`š™Ÿlize_cÚÃùiÚ
(
fd
);

231 ià(
	`li¡’
(
_sock‘_fd
, 2) < 0)

232  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "listen");

235 
	`fú
(
_sock‘_fd
, 
F_SETFL
, 
O_NONBLOCK
);

236 
	`fú
(
_sock‘_fd
, 
F_SETFD
, 
FD_CLOEXEC
);

238 
	`add_£Ëù
(
_sock‘_fd
, 
SELECT_READ
);

240 
	}
}

243 
	gCÚŒŞSock‘
::
	$»Œy_hook
(
Tim”
 *
t
, *
thunk
)

245 
CÚŒŞSock‘
 *
cs
 = (CÚŒŞSock‘ *)
thunk
;

246 ià(
cs
->
_sock‘_fd
 >= 0)

248 ià(
cs
->
	`š™Ÿlize_sock‘
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
()) >= 0)

250 ià(
cs
->
_»Œ›s
 >= 0)

251 
t
->
	`»scheduË_aá”_£c
(1);

253 
cs
->
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

254 
	}
}

257 
	gCÚŒŞSock‘
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

260 ià(
_´oxy
)

261 
_fuÎ_´oxy
 = 
¡©ic_ÿ¡
<
HªdËrProxy
 *>(
_´oxy
->
	`ÿ¡
("HandlerProxy"));

264 ià(
_fuÎ_´oxy
)

265 
_fuÎ_´oxy
->
	`add_”rÜ_»ûiv”
(
´oxy_”rÜ_funùiÚ
, 
this
);

267 ià(
	`š™Ÿlize_sock‘
(
”rh
) >= 0)

269 ià(
_»Œ›s
 >= 0) {

270 
_»Œy_tim”
 = 
Ãw
 
	`Tim”
(
»Œy_hook
, 
this
);

271 
_»Œy_tim”
->
	`š™Ÿlize
(
this
);

272 
_»Œy_tim”
->
	`scheduË_aá”_£c
(1);

276 
	}
}

278 
EËm’t
 *

279 
	gCÚŒŞSock‘
::
	$hÙsw­_–em’t
() const

281 ià(
EËm’t
 *
e
 = EËm’t::
	`hÙsw­_–em’t
())

282 ià(
CÚŒŞSock‘
 *
cs
 = (CÚŒŞSock‘ *)
e
->
	`ÿ¡
("ControlSocket"))

283 ià(
cs
->
_ty³
 == _type

284 && (
cs
->
_unix_·thÇme
 == _unix_pathname

285 || (
_ty³
 =ğ
ty³_tı
 && 
_unix_·thÇme
.
	`back
() == '+')))

286  
cs
;

288 
	}
}

291 
	gCÚŒŞSock‘
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *
”rh
)

293 
CÚŒŞSock‘
 *
cs
 = (CÚŒŞSock‘ *è
e
->
	`ÿ¡
("ControlSocket");

295 ià(
_sock‘_fd
 >= 0) {

296 
”rh
->
	`”rÜ
("already initialized, can'take state");

300 
_sock‘_fd
 = 
cs
->_socket_fd;

301 
_unix_·thÇme
 = 
cs
->_unix_pathname;

302 
cs
->
_sock‘_fd
 = -1;

303 
_cÚns
.
	`sw­
(
cs
->_conns);

305 ià(
_sock‘_fd
 >= 0)

306 
	`add_£Ëù
(
_sock‘_fd
, 
SELECT_READ
);

307 
cÚÃùiÚ
 **
™
 = 
_cÚns
.
	`begš
(); iˆ!ğ_cÚns.
	`’d
(); ++it) {

308 ià(*
™
 && !(*™)->
š_şo£d
)

309 
	`add_£Ëù
((*
™
)->
fd
, 
SELECT_READ
);

310 ià(*
™
 && !(*™)->
out_şo£d
)

311 
	`add_£Ëù
((*
™
)->
fd
, 
SELECT_WRITE
);

313 
	}
}

316 
	gCÚŒŞSock‘
::
	$ş—nup
(
CËªupSge
)

318 ià(
_fuÎ_´oxy
)

319 
_fuÎ_´oxy
->
	`»move_”rÜ_»ûiv”
(
´oxy_”rÜ_funùiÚ
, 
this
);

320 ià(
_sock‘_fd
 >= 0) {

322 #ifdeà
SHUT_RDWR


323 
	`shutdown
(
_sock‘_fd
, 
SHUT_RDWR
);

325 
	`shutdown
(
_sock‘_fd
, 2);

327 
	`şo£
(
_sock‘_fd
);

328 ià(
_ty³
 =ğ
ty³_unix
)

329 
	`uÆšk
(
_unix_·thÇme
.
	`c_¡r
());

330 
_sock‘_fd
 = -1;

332 
cÚÃùiÚ
 **
™
 = 
_cÚns
.
	`begš
(); iˆ!ğ_cÚns.
	`’d
(); ++it)

333 ià(*
™
) {

334 (*
™
)->
	`æush_wr™e
(
this
, 
çl£
);

335 
	`şo£
((*
™
)->
fd
);

336 
d–‘e
 *
™
;

338 ià(
_»Œy_tim”
) {

339 
d–‘e
 
_»Œy_tim”
;

340 
_»Œy_tim”
 = 0;

342 
	}
}

345 
	gCÚŒŞSock‘
::
cÚÃùiÚ
::
	$mes§ge
(
code
, cÚ¡ 
SŒšg
 &
msg
, 
boŞ
 
cÚtšu©iÚ
)

347 
	`as£¹
(
code
 >= 100 && code <= 999);

348 ià(
fd
 >ğ0 && !
out_şo£d
)

349 
out_‹xt
 << 
code
 << (
cÚtšu©iÚ
 ? '-' : ' 'è<< 
msg
.
	`´šbË
() << '\r' << '\n';

350  
ANY_ERR
;

351 
	}
}

354 
	gCÚŒŞSock‘
::
cÚÃùiÚ
::
	$Œªsãr_mes§ges
(
deçuÉ_code
, cÚ¡ 
SŒšg
 &
msg
,

355 
CÚŒŞSock‘E¼ÜHªdËr
 *
”rh
)

357 
code
 = 
”rh
->
	`”rÜ_code
();

358 ià(
code
 =ğ
CSERR_OK
)

359 
code
 = 
deçuÉ_code
;

360 cÚ¡ 
VeùÜ
<
SŒšg
> &
mes§ges
 = 
”rh
->
	`mes§ges
();

362 ià(
msg
) {

363 ià(
mes§ges
.
	`size
() > 0)

364 
	`mes§ge
(
code
, 
msg
 + ":", 
Œue
);

366 
	`mes§ge
(
code
, 
msg
, 
çl£
);

369 
i
 = 0; i < 
mes§ges
.
	`size
(); i++)

370 
	`mes§ge
(
code
, 
mes§ges
[
i
], i < mes§ges.
	`size
() - 1);

372  
ANY_ERR
;

373 
	}
}

376 
	gCÚŒŞSock‘
::
cÚÃùiÚ
::
	$cÚŒaù
(
SŒšgAccum
 &
§
, &
pos
)

378 ià(
pos
 =ğ
§
.
	`Ëngth
()) {

379 
§
.
	`ş—r
();

380 
pos
 = 0;

381 } ià(
pos
 > 8192) {

382 
	`memmove
(
§
.
	`d©a
(), sa.d©a(è+ 
pos
, sa.
	`Ëngth
() -…os);

383 
§
.
	`»size
(§.
	`Ëngth
(è- 
pos
);

384 
pos
 = 0;

386 
	}
}

389 
	gCÚŒŞSock‘
::
cÚÃùiÚ
::
	$»ad_šsuffic›Á
()

391 ià(
š_şo£d
)

392  
	`mes§ge
(
CSERR_SYNTAX
, "Notƒnough data");

395 
	}
}

398 
	gCÚŒŞSock‘
::
cÚÃùiÚ
::
	$»ad
(
Ën
, 
SŒšg
 &
d©a
)

400 ià(
š_‹xt
.
	`Ëngth
(è< 
špos
 + 
Ën
)

401  
	`»ad_šsuffic›Á
();

402 
d©a
 = 
	`SŒšg
(
š_‹xt
.
	`begš
(è+ 
špos
, in_‹xt.begš(è+ iÅo + 
Ën
);

403 
špos
 +ğ
Ën
;

405 
	}
}

408 
	gCÚŒŞSock‘
::
cÚÃùiÚ
::
	$æush_wr™e
(
CÚŒŞSock‘
 *
cs
, 
boŞ
 
»ad_Ãeds_´oûssšg
)

410 ià(!
out_şo£d
) {

411 
ssize_t
 
w
 = 0;

412 
ouos
 < 
out_‹xt
.
	`Ëngth
()) {

413 
w
 = 
	`wr™e
(
fd
, 
out_‹xt
.
	`d©a
(è+ 
ouos
, out_‹xt.
	`Ëngth
() - outpos);

414 ià(
w
 =ğ-1 && 
”ºo
 !ğ
EINTR
)

416 ià(
w
 != 0 && w != -1)

417 
ouos
 +ğ
w
;

419 ià(
w
 =ğ-1 && 
”ºo
 =ğ
EPIPE
)

420 
out_şo£d
 = 
Œue
;

421 
	`cÚŒaù
(
out_‹xt
, 
ouos
);

424 ià(
out_‹xt
.
	`Ëngth
(è|| 
»ad_Ãeds_´oûssšg
)

425 
cs
->
	`add_£Ëù
(
fd
, 
EËm’t
::
SELECT_WRITE
);

427 
cs
->
	`»move_£Ëù
(
fd
, 
EËm’t
::
SELECT_WRITE
);

429 
	}
}

431 
SŒšg


432 
	$ÿnÚiÿl_hªdËr_Çme
(cÚ¡ 
SŒšg
 &
n
)

434 cÚ¡ *
dÙ
 = 
	`fšd
(
n
, '.');

435 ià(
dÙ
 =ğ
n
.
	`begš
(è|| (dÙ =ğn.begš(è+ 1 &&‚.
	`äÚt
() == '0'))

436  
n
.
	`sub¡ršg
(
dÙ
 + 1,‚.
	`’d
());

438  
n
;

439 
	}
}

441 
SŒšg


442 
	gCÚŒŞSock‘
::
	$´ox›d_hªdËr_Çme
(cÚ¡ 
SŒšg
 &
n
) const

444 ià(
_fuÎ_´oxy
 && 
	`fšd
(
n
, '.'è=ğn.
	`’d
())

445  "." + 
n
;

447  
n
;

448 
	}
}

450 cÚ¡ 
HªdËr
*

451 
	gCÚŒŞSock‘
::
	$·r£_hªdËr
(
cÚÃùiÚ
 &
cÚn
, cÚ¡ 
SŒšg
 &
fuÎ_Çme
, 
EËm’t
 **
es
)

454 
SŒšg
 
ÿnÚiÿl_Çme
 = 
	`ÿnÚiÿl_hªdËr_Çme
(
fuÎ_Çme
);

457 ià(
_´oxy
) {

459 
CÚŒŞSock‘E¼ÜHªdËr
 
”rh
;

460 
_´ox›d_hªdËr
 = 
	`´ox›d_hªdËr_Çme
(
ÿnÚiÿl_Çme
);

461 
_´ox›d_”rh
 = &
”rh
;

462 cÚ¡ 
HªdËr
* 
h
 = 
Rou‹r
::
	`hªdËr
(
_´oxy
, 
_´ox›d_hªdËr
);

463 
_´ox›d_”rh
 = 0;

465 ià(
”rh
.
	`Ã¼Üs
() > 0) {

466 
cÚn
.
	`Œªsãr_mes§ges
(
CSERR_NO_SUCH_HANDLER
, 
	`SŒšg
(), &
”rh
);

468 } ià(!
h
) {

469 
cÚn
.
	`mes§ge
(
CSERR_NO_SUCH_HANDLER
, "NØ´ox›d hªdË¸Çmed '" + 
fuÎ_Çme
 + "'");

472 *
es
 = 
_´oxy
;

473  
h
;

478 
EËm’t
 *
e
;

479 cÚ¡ *
dÙ
 = 
	`fšd
(
ÿnÚiÿl_Çme
, '.');

480 
SŒšg
 
hÇme
;

482 ià(
dÙ
 !ğ
ÿnÚiÿl_Çme
.
	`’d
()) {

483 
SŒšg
 
’ame
 = 
ÿnÚiÿl_Çme
.
	`sub¡ršg
(ÿnÚiÿl_Çme.
	`begš
(), 
dÙ
);

484 
e
 = 
	`rou‹r
()->
	`fšd
(
’ame
);

485 ià(!
e
) {

486 
num
;

487 ià(
	`IÁArg
().
	`·r£
(
’ame
, 
num
è&&‚um > 0 &&‚um <ğ
	`rou‹r
()->
	`ÃËm’ts
())

488 
e
 = 
	`rou‹r
()->
	`–em’t
(
num
 - 1);

490 ià(!
e
) {

491 
cÚn
.
	`mes§ge
(
CSERR_NO_SUCH_ELEMENT
, "NØ–em’ˆÇmed '" + 
’ame
 + "'");

494 
hÇme
 = 
ÿnÚiÿl_Çme
.
	`sub¡ršg
(
dÙ
 + 1, cªÚiÿl_Çme.
	`’d
());

496 
e
 = 
	`rou‹r
()->
	`roÙ_–em’t
();

497 
hÇme
 = 
ÿnÚiÿl_Çme
;

501 cÚ¡ 
HªdËr
* 
h
 = 
Rou‹r
::
	`hªdËr
(
e
, 
hÇme
);

502 ià(
h
 && h->
	`visibË
()) {

503 *
es
 = 
e
;

504  
h
;

506 
cÚn
.
	`mes§ge
(
CSERR_NO_SUCH_HANDLER
, "NØhªdË¸Çmed '" + 
fuÎ_Çme
 + "'");

509 
	}
}

512 
	gCÚŒŞSock‘
::
	$»ad_commªd
(
cÚÃùiÚ
 &
cÚn
, cÚ¡ 
SŒšg
 &
hªdËºame
, SŒšg 
·¿m
)

514 
EËm’t
 *
e
;

515 cÚ¡ 
HªdËr
* 
h
 = 
	`·r£_hªdËr
(
cÚn
, 
hªdËºame
, &
e
);

516 ià(!
h
)

517  
ANY_ERR
;

518 ià(!
h
->
	`»ad_visibË
())

519  
cÚn
.
	`mes§ge
(
CSERR_PERMISSION
, "HªdË¸'" + 
hªdËºame
 + "' write-only");

522 
CÚŒŞSock‘E¼ÜHªdËr
 
”rh
;

523 
_´ox›d_hªdËr
 = 
h
->
	`Çme
();

524 
_´ox›d_”rh
 = &
”rh
;

525 
SŒšg
 
d©a
 = 
h
->
	`ÿÎ_»ad
(
e
, 
·¿m
, &
”rh
);

526 
_´ox›d_”rh
 = 0;

529 ià(
”rh
.
	`Ã¼Üs
() > 0)

530  
cÚn
.
	`Œªsãr_mes§ges
(
CSERR_UNSPECIFIED
, "R—d hªdË¸'" + 
hªdËºame
 + "'ƒ¼Ü", &
”rh
);

532 
cÚn
.
	`mes§ge
(
CSERR_OK
, "R—d hªdË¸'" + 
hªdËºame
 + "' OK");

533 
cÚn
.
out_‹xt
 << "DATA " << 
d©a
.
	`Ëngth
() << '\r' << '\n' << data;

535 
	}
}

538 
	gCÚŒŞSock‘
::
	$wr™e_commªd
(
cÚÃùiÚ
 &
cÚn
, cÚ¡ 
SŒšg
 &
hªdËºame
, SŒšg 
d©a
)

540 
EËm’t
 *
e
;

541 cÚ¡ 
HªdËr
* 
h
 = 
	`·r£_hªdËr
(
cÚn
, 
hªdËºame
, &
e
);

542 ià(!
h
)

543  
ANY_ERR
;

544 ià(!
h
->
	`wr™abË
())

545  
cÚn
.
	`mes§ge
(
CSERR_PERMISSION
, "HªdË¸'" + 
hªdËºame
 + "'„ead-only");

547 ià(
_»ad_Úly
)

548  
cÚn
.
	`mes§ge
(
CSERR_PERMISSION
, "P”missiÚ d’›d fÜ '" + 
hªdËºame
 + "'");

550 #ifdeà
LARGEST_HANDLER_WRITE


551 ià(
d©a
.
	`Ëngth
(è> 
LARGEST_HANDLER_WRITE
)

552  
cÚn
.
	`mes§ge
(
CSERR_DATA_TOO_BIG
, "D©¨toØÏrgfÜ wr™hªdË¸'" + 
hªdËºame
 + "'");

555 
CÚŒŞSock‘E¼ÜHªdËr
 
”rh
;

558 
»suÉ
 = 
h
->
	`ÿÎ_wr™e
(
d©a
, 
e
, &
”rh
);

561 
code
 = 
”rh
.
	`”rÜ_code
();

562 ià(
code
 =ğ
CSERR_OK
) {

563 ià(
”rh
.
	`Ã¼Üs
(è> 0 || 
»suÉ
 < 0)

564 
code
 = 
CSERR_HANDLER_ERROR
;

565 ià(
”rh
.
	`nw¬nšgs
() > 0)

566 
code
 = 
CSERR_OK_HANDLER_WARNING
;

569 
SŒšg
 
msg
;

570 ià(
code
 =ğ
CSERR_OK
)

571 
msg
 = "Wr™hªdË¸'" + 
hªdËºame
 + "' OK";

572 ià(
code
 =ğ
CSERR_OK_HANDLER_WARNING
)

573 
msg
 = "Wr™hªdË¸'" + 
hªdËºame
 + "' OK with warnings";

574 ià(
code
 =ğ
CSERR_HANDLER_ERROR
)

575 
msg
 = "Wr™hªdË¸'" + 
hªdËºame
 + "'ƒrror";

576 
cÚn
.
	`Œªsãr_mes§ges
(
code
, 
msg
, &
”rh
);

578 
	}
}

581 
	gCÚŒŞSock‘
::
	$check_commªd
(
cÚÃùiÚ
 &
cÚn
, cÚ¡ 
SŒšg
 &
hÇme
, 
boŞ
 
wr™e
)

583 
ok
 = 0;

584 
ªy_visibË
 = 0;

585 
CÚŒŞSock‘E¼ÜHªdËr
 
”rh
;

587 ià(
_fuÎ_´oxy
) {

588 
SŒšg
 
phÇme
 = 
	`ÿnÚiÿl_hªdËr_Çme
(
hÇme
);

589 ià(
	`fšd
(
phÇme
, '.'è=ğphÇme.
	`’d
())

590 
phÇme
 = "." +…hname;

591 
ok
 = 
_fuÎ_´oxy
->
	`check_hªdËr
(
phÇme
, 
wr™e
, &
”rh
);

593 
EËm’t
 *
e
;

594 cÚ¡ 
HªdËr
* 
h
 = 
	`·r£_hªdËr
(
cÚn
, 
hÇme
, &
e
);

595 ià(!
h
)

597 
ok
 = (
h
->
	`visibË
(è&& (
wr™e
 ? h->
	`wr™e_visibË
(è: h->
	`»ad_visibË
()));

598 
ªy_visibË
 = 
h
->
	`visibË
();

602 ià(
wr™e
 && 
_»ad_Úly
 && 
ok
)

603  
cÚn
.
	`mes§ge
(
CSERR_PERMISSION
, "P”missiÚ d’›d fÜ '" + 
hÇme
 + "'");

604 ià(
”rh
.
	`mes§ges
().
	`size
() > 0)

605 
cÚn
.
	`Œªsãr_mes§ges
(
CSERR_OK
, 
	`SŒšg
(), &
”rh
);

606 ià(
ok
)

607 
cÚn
.
	`mes§ge
(
CSERR_OK
, 
	`SŒšg
(
wr™e
 ? "Wr™e" : "R—d"è+ " hªdË¸'" + 
hÇme
 + "' OK");

608 ià(
ªy_visibË
)

609 
cÚn
.
	`mes§ge
(
CSERR_NO_SUCH_HANDLER
, "HªdË¸'" + 
hÇme
 + (
wr™e
 ? "'‚ot writable" : "'‚ot„eadable"));

611 
cÚn
.
	`mes§ge
(
CSERR_NO_SUCH_HANDLER
, "NØ" + 
	`SŒšg
(
wr™e
 ? "wr™e" : "»ad"è+ " hªdË¸Çmed '" + 
hÇme
 + "'");

613 
	}
}

616 
	gCÚŒŞSock‘
::
	$Î½c_commªd
(
cÚÃùiÚ
 &
cÚn
, cÚ¡ 
SŒšg
 &
Î½úame
, SŒšg 
d©a
)

618 cÚ¡ *
oùÙhÜp
 = 
	`fšd
(
Î½úame
, '#');

619 
ušt32_t
 
commªd
 = 0;

620 ià(!
	`IÁArg
(16).
	`·r£
(
Î½úame
.
	`sub¡ršg
(
oùÙhÜp
 + 1,†Ìpúame.
	`’d
()), 
commªd
))

621  
cÚn
.
	`mes§ge
(
CSERR_SYNTAX
, "SyÁaxƒ¼Ü iÀLLRPC‚am'" + 
Î½úame
 + "'");

623 
commªd
 = 
	`CLICK_LLRPC_NTOH
(command);

625 
EËm’t
 *
e
;

626 cÚ¡ 
HªdËr
* 
h
 = 
	`·r£_hªdËr
(
cÚn
, 
Î½úame
.
	`sub¡ršg
ÖÌpúame.
	`begš
(), 
oùÙhÜp
è+ ".Çme", &
e
);

627 ià(!
h
)

628  
ANY_ERR
;

630 
size
 = 
	`_CLICK_IOC_SIZE
(
commªd
);

631 ià(!
size
 || !(
commªd
 & (
_CLICK_IOC_IN
 | 
_CLICK_IOC_OUT
)è|| !(commªd & 
_CLICK_IOC_FLAT
))

632  
cÚn
.
	`mes§ge
(
CSERR_UNIMPLEMENTED
, "CªnÙ c®ÈLLRPC '" + 
Î½úame
 + "'„emotely");

634 ià(
_»ad_Úly
)

636  
cÚn
.
	`mes§ge
(
CSERR_PERMISSION
, "P”missiÚ d’›d fÜ '" + 
Î½úame
 + "'");

638 ià((
commªd
 & 
_CLICK_IOC_IN
è&& 
d©a
.
	`Ëngth
(è!ğ
size
)

639  
cÚn
.
	`mes§ge
(
CSERR_LLRPC_ERROR
, "LLRPC '" + 
Î½úame
 + "'„equœe " + 
	`SŒšg
(
size
) + " bytes input data");

640 ià(!(
commªd
 & 
_CLICK_IOC_IN
))

641 
d©a
 = 
SŒšg
::
	`make_unš™Ÿlized
(
size
);

644 
CÚŒŞSock‘E¼ÜHªdËr
 
”rh
;

645 
_´ox›d_hªdËr
 = 
Î½úame
;

646 
_´ox›d_”rh
 = &
”rh
;

648 
»tv®
;

649 ià(
_´oxy
) {

650 
şick_Î½c_´oxy_¡
 
p¡
;

651 
p¡
.
´ox›d_hªdËr
 = (*è
h
;

652 
p¡
.
´ox›d_commªd
 = 
commªd
;

653 
p¡
.
´ox›d_d©a
 = 
d©a
.
	`mubË_d©a
();

654 
»tv®
 = 
_´oxy
->
	`Î½c
(
CLICK_LLRPC_PROXY
, &
p¡
);

656 
»tv®
 = 
e
->
	`Î½c
(
commªd
, 
d©a
.
	`mubË_d©a
());

658 
_´ox›d_”rh
 = 0;

661 
SŒšg
 
msg
;

662 ià(
»tv®
 < 0)

663 
msg
 = "LLRPC '" + 
Î½úame
 + "'ƒ¼Ü: " + 
	`SŒšg
(
	`¡»¼Ü
(-
»tv®
));

664 ià(
”rh
.
	`Ã¼Üs
() > 0)

665 
msg
 = "LLRPC '" + 
Î½úame
 + "'ƒrror";

667 
msg
 = "LLRPC '" + 
Î½úame
 + "' OK";

668 
code
 = (
»tv®
 < 0 || 
”rh
.
	`Ã¼Üs
(è> 0 ? 
CSERR_LLRPC_ERROR
 : 
CSERR_OK
);

669 
cÚn
.
	`Œªsãr_mes§ges
(
code
, 
msg
, &
”rh
);

671 ià(
code
 =ğ
CSERR_OK
) {

672 ià(!(
commªd
 & 
_CLICK_IOC_OUT
))

673 
d©a
 = 
	`SŒšg
();

674 
cÚn
.
out_‹xt
 << "DATA " << 
d©a
.
	`Ëngth
() << '\r' << '\n' << data;

677 
	}
}

680 
	gCÚŒŞSock‘
::
	$·r£_commªd
(
cÚÃùiÚ
 &
cÚn
, cÚ¡ 
SŒšg
 &
lše
)

683 
VeùÜ
<
SŒšg
> 
wÜds
;

684 cÚ¡ *
d©a
 = 
lše
.
	`d©a
();

685 
Ën
 = 
lše
.
	`Ëngth
();

686 
pos
 = 0;…o < 
Ën
; ) {

687 
pos
 < 
Ën
 && 
	`is¥aû
((è
d©a
[pos]))

688 
pos
++;

689 
fœ¡
 = 
pos
;

690 
pos
 < 
Ën
 && !
	`is¥aû
((è
d©a
[pos]))

691 
pos
++;

692 ià(
fœ¡
 < 
pos
)

693 
wÜds
.
	`push_back
(
lše
.
	`sub¡ršg
(
fœ¡
, 
pos
 - first));

695 ià(
wÜds
.
	`size
() == 0)

699 
SŒšg
 
commªd
 = 
wÜds
[0].
	`uµ”
();

700 ià(
commªd
 == "READ" || command == "GET" || command == "WRITE"

701 || 
commªd
 == "SET") {

702 ià(
wÜds
.
	`size
() < 2)

703  
cÚn
.
	`mes§ge
(
CSERR_SYNTAX
, "Wrong‚umber of‡rguments");

704 
SŒšg
 
d©a
;

705 ià(
wÜds
.
	`size
() > 2)

706 
d©a
 = 
lše
.
	`sub¡ršg
(
wÜds
[2].
	`begš
(), wÜds.
	`back
().
	`’d
());

707 ià(
commªd
[0] == 'R' || command[0] == 'G')

708  
	`»ad_commªd
(
cÚn
, 
wÜds
[1], 
d©a
);

710  
	`wr™e_commªd
(
cÚn
, 
wÜds
[1], 
d©a
);

712 } ià(
commªd
 == "READDATA" || command == "WRITEDATA"

713 || 
commªd
 == "SETDATA") {

714 ià(
wÜds
.
	`size
() != 3)

715  
cÚn
.
	`mes§ge
(
CSERR_SYNTAX
, "Wrong‚umber of‡rguments");

716 
d©®’
, 
r
;

717 ià(!
	`IÁArg
().
	`·r£
(
wÜds
[2], 
d©®’
) || datalen < 0)

718  
cÚn
.
	`mes§ge
(
CSERR_SYNTAX
, "SyÁaxƒ¼Ü iÀ'%s'", 
commªd
.
	`c_¡r
());

719 
SŒšg
 
d©a
;

720 ià((
r
 = 
cÚn
.
	`»ad
(
d©®’
, 
d©a
)) != 0)

721  
r
;

722 ià(
commªd
[0] == 'R')

723  
	`»ad_commªd
(
cÚn
, 
wÜds
[1], 
d©a
);

725  
	`wr™e_commªd
(
cÚn
, 
wÜds
[1], 
d©a
);

727 } ià(
commªd
 == "READUNTIL" || command == "WRITEUNTIL") {

728 ià(
wÜds
.
	`size
() < 2)

729  
cÚn
.
	`mes§ge
(
CSERR_SYNTAX
, "Wrong‚umber of‡rguments");

730 
SŒšg
 
uÁ
;

731 ià(
wÜds
.
	`size
() > 2)

732 
uÁ
 = 
lše
.
	`sub¡ršg
(
wÜds
[2].
	`begš
(), wÜds.
	`back
().
	`’d
());

733 cÚ¡ *
s
 = 
cÚn
.
š_‹xt
.
	`begš
(è+ cÚn.
špos
,

734 *
’d
 = 
cÚn
.
š_‹xt
.
	`’d
(), *
lšebegš
, *
lš“nd
;

736 
lšebegš
 = 
lš“nd
 = 
s
;

737 ; 
s
 !ğ
’d
 && *s != '\n' && *s != '\r'; ++s)

738 ià(!
	`is¥aû
((è*
s
))

739 
lš“nd
 = 
s
 + 1;

740 ià(
s
 =ğ
’d
)

741  
cÚn
.
	`»ad_šsuffic›Á
();

742 ià(*
s
 =ğ'\r' && s + 1 !ğ
’d
 && s[1] == '\n')

743 
s
 += 2;

745 ++
s
;

746 ià(
lš“nd
 - 
lšebegš
 =ğ
uÁ
.
	`Ëngth
()

747 && 
	`memcmp
(
lšebegš
, 
uÁ
.
	`begš
(), uÁ.
	`Ëngth
()) == 0)

750 
SŒšg
 
	`d©a
(
cÚn
.
š_‹xt
.
	`begš
(è+ cÚn.
špos
, 
lšebegš
);

751 
cÚn
.
špos
 = 
s
 - cÚn.
š_‹xt
.
	`begš
();

752 ià(
commªd
[0] == 'R')

753  
	`»ad_commªd
(
cÚn
, 
wÜds
[1], 
d©a
);

755  
	`wr™e_commªd
(
cÚn
, 
wÜds
[1], 
d©a
);

757 } ià(
commªd
 == "CHECKREAD" || command == "CHECKWRITE") {

758 ià(
wÜds
.
	`size
() != 2)

759  
cÚn
.
	`mes§ge
(
CSERR_SYNTAX
, "Wrong‚umber of‡rguments");

760  
	`check_commªd
(
cÚn
, 
wÜds
[1], 
commªd
[5] == 'W');

762 } ià(
commªd
 == "LLRPC") {

763 ià(
wÜds
.
	`size
() != 2 && words.size() != 3)

764  
cÚn
.
	`mes§ge
(
CSERR_SYNTAX
, "Wrong‚umber of‡rguments");

765 
d©®’
 = 0, 
r
;

766 ià(
wÜds
.
	`size
(è=ğ3 && (!
	`IÁArg
().
	`·r£
(wÜds[2], 
d©®’
) || datalen < 0))

767  
cÚn
.
	`mes§ge
(
CSERR_SYNTAX
, "Syntaxƒrror in 'llrpc'");

768 
SŒšg
 
d©a
;

769 ià((
r
 = 
cÚn
.
	`»ad
(
d©®’
, 
d©a
)) != 0)

770  
r
;

771  
	`Î½c_commªd
(
cÚn
, 
wÜds
[1], 
d©a
);

773 } ià(
commªd
 == "CLOSE" || command == "QUIT") {

774 ià(
wÜds
.
	`size
() != 1)

775 
cÚn
.
	`mes§ge
(
CSERR_SYNTAX
, "Bad command syntax");

776 
cÚn
.
	`mes§ge
(
CSERR_OK
, "Goodbye!");

777 
cÚn
.
š_şo£d
 = 
Œue
;

778 
cÚn
.
š_‹xt
.
	`ş—r
();

779 
cÚn
.
špos
 = 0;

782 } ià(
commªd
 == "HELP") {

783 
cÚn
.
	`mes§ge
(
CSERR_OK
, "Commªd suµÜ‹d:", 
Œue
);

784 
cÚn
.
	`mes§ge
(
CSERR_OK
, "READ hªdË¸[¬g...] c®È»ad hªdËr,„‘uº DATA", 
Œue
);

785 
cÚn
.
	`mes§ge
(
CSERR_OK
, "READDATA hªdË¸ËÀ c®È»ad hªdË¸w™h†’ d©¨by‹s,„‘uº DATA", 
Œue
);

786 
cÚn
.
	`mes§ge
(
CSERR_OK
, "READUNTIL hªdË¸‹rm c®È»ad hªdËr,akd©¨uÁ”m,„‘uº DATA", 
Œue
);

787 
cÚn
.
	`mes§ge
(
CSERR_OK
, "WRITE hªdË¸[¬g...] c®Èwr™hªdËr", 
Œue
);

788 
cÚn
.
	`mes§ge
(
CSERR_OK
, "WRITEDATA hªdË¸ËÀ c®Èwr™hªdËr,…as ËÀd©¨by‹s", 
Œue
);

789 
cÚn
.
	`mes§ge
(
CSERR_OK
, "WRITEUNTIL hªdË¸‹rm c®Èwr™hªdËr,akd©¨uÁ”m", 
Œue
);

790 
cÚn
.
	`mes§ge
(
CSERR_OK
, "CHECKREAD hªdË¸ check ià»ad hªdË¸i v®id", 
Œue
);

791 
cÚn
.
	`mes§ge
(
CSERR_OK
, "CHECKWRITE hªdË¸ check iàwr™hªdË¸i v®id", 
Œue
);

792 
cÚn
.
	`mes§ge
(
CSERR_OK
, "LLRPCƒÉ#numb” [Ën] c®ÈLLRPC,…as ËÀd©¨by‹s,„‘uº DATA", 
Œue
);

793 
cÚn
.
	`mes§ge
(
CSERR_OK
, "QUIT close connection");

797  
cÚn
.
	`mes§ge
(
CSERR_UNIMPLEMENTED
, "Commªd '" + 
commªd
 + "' unimplemented");

798 
	}
}

801 
	gCÚŒŞSock‘
::
	$š™Ÿlize_cÚÃùiÚ
(
fd
)

803 
	`fú
(
fd
, 
F_SETFL
, 
O_NONBLOCK
);

804 
	`fú
(
fd
, 
F_SETFD
, 
FD_CLOEXEC
);

805 
	`add_£Ëù
(
fd
, 
SELECT_READ
 | 
SELECT_WRITE
);

806 ià(
_cÚns
.
	`size
(è<ğ
fd
)

807 
_cÚns
.
	`»size
(
fd
 + 1);

808 
_cÚns
[
fd
] = 
Ãw
 
	`cÚÃùiÚ
(fd);

809 
_cÚns
[
fd
]->
out_‹xt
 << "Click::CÚŒŞSock‘/" << 
´ÙocŞ_v”siÚ
 << '\r' << '\n';

810 
	}
}

813 
	gCÚŒŞSock‘
::
	$£Ëùed
(
fd
, )

815 ià(
fd
 =ğ
_sock‘_fd
) {

816 uniÚ { 
sockaddr_š
 
š
; 
sockaddr_un
 
un
; } 
§
;

817 #ià
HAVE_ACCEPT_SOCKLEN_T


818 
sockËn_t
 
§_Ën
;

820 
§_Ën
;

822 
§_Ën
 = (
§
);

823 
Ãw_fd
 = 
	`acû±
(
_sock‘_fd
, (
sockaddr
 *)&
§
, &
§_Ën
);

825 ià(
Ãw_fd
 < 0) {

826 ià(
”ºo
 !ğ
EAGAIN
)

827 
	`şick_ch©‹r
("%s:‡cû±: %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

831 ià(
_v”bo£
) {

832 ià(
_ty³
 =ğ
ty³_tı
)

833 
	`şick_ch©‹r
("%s: o³Ãd cÚÃùiÚ %d from %s.%d", 
	`deş¬©iÚ
().
	`c_¡r
(), 
Ãw_fd
, 
	`IPAdd»ss
(
§
.
š
.
sš_addr
).
	`uÅ¬£
().c_¡r(), 
	`Áohs
(§.š.
sš_pÜt
));

835 
	`şick_ch©‹r
("%s: o³Ãd cÚÃùiÚ %d", 
	`deş¬©iÚ
().
	`c_¡r
(), 
Ãw_fd
);

838 
	`š™Ÿlize_cÚÃùiÚ
(
Ãw_fd
);

839 
fd
 = 
Ãw_fd
;

843 ià(
fd
 >ğ
_cÚns
.
	`size
() || !_conns[fd])

845 
cÚÃùiÚ
 *
cÚn
 = 
_cÚns
[
fd
];

848 ià(!
cÚn
->
š_şo£d
)

849 ià(*
buf
 = 
cÚn
->
š_‹xt
.
	`»£rve
(2048)) {

850 
ssize_t
 
r
 = 
	`»ad
(
cÚn
->
fd
, 
buf
, 2048);

851 ià(
r
 != 0 &&„ != -1)

852 
cÚn
->
š_‹xt
.
	`adju¡_Ëngth
(
r
);

853 ià(
r
 =ğ0 || (¸=ğ-1 && 
”ºo
 !ğ
EAGAIN
 &&ƒ¼nØ!ğ
EINTR
))

854 
cÚn
->
š_şo£d
 = 
Œue
;

859 
boŞ
 
blocked
 = 
çl£
;

860 ià(
cÚn
->
š_‹xt
.
	`Ëngth
()) {

861 cÚ¡ *
š_‹xt
 = 
cÚn
->š_‹xt.
	`begš
(è+ cÚn->
špos
;

862 cÚ¡ *
š_’d
 = 
cÚn
->
š_‹xt
.
	`’d
();

863 cÚ¡ *
lše_’d
 = 
š_‹xt
;

864 
lše_’d
 !ğ
š_’d
 && *line_end != '\r' && *line_end != '\n')

865 ++
lše_’d
;

866 ià(
lše_’d
 !ğ
š_’d
 || 
cÚn
->
š_şo£d
) {

870 ià(
lše_’d
 + 2 <ğ
š_’d
 && *line_end == '\r' &&†ine_end[1] == '\n')

871 
lše_’d
 += 2;

872 ià(
lše_’d
 !ğ
š_’d
)

873 ++
lše_’d
;

876 
Şdpos
 = 
cÚn
->
špos
;

877 
SŒšg
 
	`lše
(
š_‹xt
, 
lše_’d
);

878 
cÚn
->
špos
 = 
lše_’d
 - cÚn->
š_‹xt
.
	`begš
();

881 ià(
	`·r£_commªd
(*
cÚn
, 
lše
) > 0) {

883 
cÚn
->
špos
 = 
Şdpos
;

884 
blocked
 = 
Œue
;

886 
cÚÃùiÚ
::
	`cÚŒaù
(
cÚn
->
š_‹xt
, cÚn->
špos
);

889 
blocked
 = 
Œue
;

895 
cÚn
->
	`æush_wr™e
(
this
, cÚn->
š_‹xt
.
	`Ëngth
(è&& !
blocked
);

898 ià((
cÚn
->
š_şo£d
 && !cÚn->
š_‹xt
.
	`Ëngth
(è&& !cÚn->
out_‹xt
.length())

899 || 
cÚn
->
out_şo£d
) {

900 
	`»move_£Ëù
(
cÚn
->
fd
, 
SELECT_READ
 | 
SELECT_WRITE
);

901 
	`şo£
(
cÚn
->
fd
);

902 ià(
_v”bo£
)

903 
	`şick_ch©‹r
("%s: clo£d cÚÃùiÚ %d", 
	`deş¬©iÚ
().
	`c_¡r
(), 
fd
);

904 
_cÚns
[
cÚn
->
fd
] = 0;

905 
d–‘e
 
cÚn
;

907 
	}
}

909 
E¼ÜHªdËr
 *

910 
	gCÚŒŞSock‘
::
	$´oxy_”rÜ_funùiÚ
(cÚ¡ 
SŒšg
 &
h
, *
thunk
)

912 
CÚŒŞSock‘
 *
cs
 = 
¡©ic_ÿ¡
<CÚŒŞSock‘ *>(
thunk
);

913  (
h
 =ğ
cs
->
_´ox›d_hªdËr
 ? cs->
_´ox›d_”rh
 : 0);

914 
	}
}

917 
	gCÚŒŞSock‘
::
	$add_hªdËrs
()

919 ià(
_ty³
 =ğ
ty³_tı
)

920 
	`add_d©a_hªdËrs
("pÜt", 
HªdËr
::
OP_READ
, &
_unix_·thÇme
);

921 ià(
_ty³
 =ğ
ty³_unix
)

922 
	`add_d©a_hªdËrs
("f’ame", 
HªdËr
::
OP_READ
, &
_unix_·thÇme
);

923 
	}
}

925 
CLICK_ENDDECLS


926 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

927 
	`EXPORT_ELEMENT
(
CÚŒŞSock‘
)

	@userlevel/controlsocket.hh

1 #iâdeà
CLICK_CONTROLSOCKET_HH


2 
	#CLICK_CONTROLSOCKET_HH


	)

3 
	~"–em’ts/u£¾ev–/hªdË½roxy.hh
"

4 
	~<şick/¡¿ccum.hh
>

5 
CLICK_DECLS


6 
şass
 
	gCÚŒŞSock‘E¼ÜHªdËr
;

7 
şass
 
	gTim”
;

8 
şass
 
	gHªdËr
;

225 şas 
	cCÚŒŞSock‘
 : 
public
 
EËm’t
 {…ublic:

227 
	$CÚŒŞSock‘
(è
CLICK_COLD
;

228 ~
	$CÚŒŞSock‘
(è
CLICK_COLD
;

230 cÚ¡ *
	$şass_Çme
() const {  "ControlSocket"; }

232 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

233 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

234 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

235 
EËm’t
 *
	$hÙsw­_–em’t
() const;

236 
	`ke_¡©e
(
EËm’t
 *, 
E¼ÜHªdËr
 *);

237 
	$add_hªdËrs
(è
CLICK_COLD
;

239 
	`£Ëùed
(
fd
, 
mask
);

242 
CSERR_OK
 = 
HªdËrProxy
::CSERR_OK,

243 
CSERR_OK_HANDLER_WARNING
 = 220,

244 
CSERR_SYNTAX
 = 
HªdËrProxy
::CSERR_SYNTAX,

245 
CSERR_UNIMPLEMENTED
 = 501,

246 
CSERR_NO_SUCH_ELEMENT
 = 
HªdËrProxy
::CSERR_NO_SUCH_ELEMENT,

247 
CSERR_NO_SUCH_HANDLER
 = 
HªdËrProxy
::CSERR_NO_SUCH_HANDLER,

248 
CSERR_HANDLER_ERROR
 = 
HªdËrProxy
::CSERR_HANDLER_ERROR,

249 
CSERR_DATA_TOO_BIG
 = 521,

250 
CSERR_LLRPC_ERROR
 = 522,

251 
CSERR_PERMISSION
 = 
HªdËrProxy
::CSERR_PERMISSION,

252 
CSERR_NO_ROUTER
 = 
HªdËrProxy
::CSERR_NO_ROUTER,

253 
CSERR_UNSPECIFIED
 = 
HªdËrProxy
::CSERR_UNSPECIFIED

254 
	}
};

256 
	g´iv©e
:

258 ’um { 
ty³_tı
, 
	gty³_unix
, 
	gty³_sock‘
 };

260 
SŒšg
 
	g_unix_·thÇme
;

261 
	g_sock‘_fd
;

262 
boŞ
 
	g_»ad_Úly
 : 1;

263 
boŞ
 
	g_v”bo£
 : 1;

264 
boŞ
 
	g_»Œy_w¬nšgs
 : 1;

265 
boŞ
 
	g_loÿlho¡
 : 1;

266 
ušt8_t
 
	g_ty³
;

267 
EËm’t
 *
	g_´oxy
;

268 
HªdËrProxy
 *
	g_fuÎ_´oxy
;

270 
	scÚÃùiÚ
 {

271 
	gfd
;

272 
SŒšgAccum
 
	gš_‹xt
;

273 
	gšpos
;

274 
SŒšgAccum
 
	gout_‹xt
;

275 
	gouos
;

276 
boŞ
 
	gš_şo£d
;

277 
boŞ
 
	gout_şo£d
;

278 
cÚÃùiÚ
(
fd_
)

279 : 
fd
(
fd_
), 
špos
(0), 
ouos
(0),

280 
š_şo£d
(
çl£
), 
out_şo£d
(false) {

282 
mes§ge
(
code
, cÚ¡ 
SŒšg
 &
msg
, 
boŞ
 
cÚtšu©iÚ
 = 
çl£
);

283 
Œªsãr_mes§ges
(
deçuÉ_code
, cÚ¡ 
SŒšg
 &
msg
, 
CÚŒŞSock‘E¼ÜHªdËr
 *);

284 
cÚŒaù
(
SŒšgAccum
 &
§
, &
pos
);

285 
æush_wr™e
(
CÚŒŞSock‘
 *
cs
, 
boŞ
 
»ad_Ãeds_´oûssšg
);

286 
»ad
(
Ën
, 
SŒšg
 &
d©a
);

287 
»ad_šsuffic›Á
();

289 
	gVeùÜ
<
	gcÚÃùiÚ
 *> 
	g_cÚns
;

291 
SŒšg
 
	g_´ox›d_hªdËr
;

292 
E¼ÜHªdËr
 *
	g_´ox›d_”rh
;

294 
	g_»Œ›s
;

295 
Tim”
 *
	g_»Œy_tim”
;

297 ’um { 
	gREAD_CLOSED
 = 1, 
	gWRITE_CLOSED
 = 2, 
	gANY_ERR
 = -1 };

299 cÚ¡ 
	g´ÙocŞ_v”siÚ
[];

301 
š™Ÿlize_sock‘_”rÜ
(
E¼ÜHªdËr
 *, const *);

302 
š™Ÿlize_sock‘
(
E¼ÜHªdËr
 *);

303 
»Œy_hook
(
Tim”
 *, *);

304 
š™Ÿlize_cÚÃùiÚ
(
fd
);

306 
SŒšg
 
	$´ox›d_hªdËr_Çme
(cÚ¡ 
SŒšg
 &) const;

307 cÚ¡ 
HªdËr
* 
	`·r£_hªdËr
(
cÚÃùiÚ
 &
cÚn
, cÚ¡ 
SŒšg
 &, 
EËm’t
 **);

308 
	`»ad_commªd
(
cÚÃùiÚ
 &
cÚn
, cÚ¡ 
SŒšg
 &, String);

309 
	`wr™e_commªd
(
cÚÃùiÚ
 &
cÚn
, cÚ¡ 
SŒšg
 &, String);

310 
	`check_commªd
(
cÚÃùiÚ
 &
cÚn
, cÚ¡ 
SŒšg
 &, 
boŞ
 
wr™e
);

311 
	`Î½c_commªd
(
cÚÃùiÚ
 &
cÚn
, cÚ¡ 
SŒšg
 &, String);

312 
	`·r£_commªd
(
cÚÃùiÚ
 &
cÚn
, cÚ¡ 
SŒšg
 &);

314 
E¼ÜHªdËr
 *
	`´oxy_”rÜ_funùiÚ
(cÚ¡ 
SŒšg
 &, *);

316 
	}
};

318 
	gCLICK_ENDDECLS


	@userlevel/dpdkinfo.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/¬gs.hh
>

21 
	~"dpdkšfo.hh
"

23 
CLICK_DECLS


25 
	gDPDKInfo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
) {

26 ià(
	gš¡ªû
) {

27  
	g”rh
->
”rÜ
(

30 
	gš¡ªû
 = 
this
;

31 ià(
Args
(
cÚf
, 
this
, 
”rh
)

32 .
»ad_p
("NB_MBUF", 
DPDKDeviû
::
NB_MBUF
)

33 .
»ad
("MBUF_SIZE", 
DPDKDeviû
::
MBUF_SIZE
)

34 .
»ad
("MBUF_CACHE_SIZE", 
DPDKDeviû
::
MBUF_CACHE_SIZE
)

35 .
»ad
("RX_PTHRESH", 
DPDKDeviû
::
RX_PTHRESH
)

36 .
»ad
("RX_HTHRESH", 
DPDKDeviû
::
RX_HTHRESH
)

37 .
»ad
("RX_WTHRESH", 
DPDKDeviû
::
RX_WTHRESH
)

38 .
»ad
("TX_PTHRESH", 
DPDKDeviû
::
TX_PTHRESH
)

39 .
»ad
("TX_HTHRESH", 
DPDKDeviû
::
TX_HTHRESH
)

40 .
»ad
("TX_WTHRESH", 
DPDKDeviû
::
TX_WTHRESH
)

41 .
com¶‘e
() < 0)

47 
DPDKInfo
* 
	gDPDKInfo
::
š¡ªû
 = 0;

49 
CLICK_ENDDECLS


51 
	$ELEMENT_REQUIRES
(
dpdk
)

52 
	`EXPORT_ELEMENT
(
DPDKInfo
)

	@userlevel/dpdkinfo.hh

1 #iâdeà
CLICK_DPDKINFO_HH


2 
	#CLICK_DPDKINFO_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/dpdkdeviû.hh
>

7 
CLICK_DECLS


78 şas 
	cDPDKInfo
 : 
public
 
EËm’t
 {

79 
public
:

81 cÚ¡ *
	$şass_Çme
() const {  "DPDKInfo"; }

83 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_FIRST
; 
	}
}

85 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
);

87 
DPDKInfo
 *
	gš¡ªû
;

90 
	gCLICK_ENDDECLS


	@userlevel/ensuredpdkbuffer.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/dpdkdeviû.hh
>

22 
	~"’su»dpdkbufãr.hh
"

24 
CLICK_DECLS


27 
	gEnsu»DPDKBufãr
::
	$Ensu»DPDKBufãr
(è: 
	`_fÜû
(
çl£
), 
	`_exŒa_h—droom
(0), 
	$_w¬n_couÁ
(0)

29 
	}
}

31 
	gEnsu»DPDKBufãr
::~
	$Ensu»DPDKBufãr
()

33 
	}
}

37 
Ensu»DPDKBufãr
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39 ià(
Args
(
cÚf
, 
this
, 
”rh
)

40 .
»ad_p
("FORCE_COPY", 
_fÜû
)

41 .
»ad_p
("EXTRA_HEADROOM", 
_exŒa_h—droom
)

42 .
com¶‘e
() < 0)

48 
šlše
 
Pack‘
*

49 
	gEnsu»DPDKBufãr
::
	$smaùiÚ
(
Pack‘
* 
p
) {

50 ià(!
_fÜû
 && (
DPDKDeviû
::
	`is_dpdk_·ck‘
(
p
))) {

51  
p
;

53 
¹e_mbuf
* 
mbuf
 = 
DPDKDeviû
::
	`g‘_pkt
();

54 ià(!
mbuf
) {

55 
p
->
	`kl
();

56 ià(
_w¬n_couÁ
++ < 5)

57 
	`şick_ch©‹r
("% : NØmÜDPDK Bufã¸! Drİpšg…ack‘.",
	`Çme
().
	`c_¡r
());

60 
Wr™abËPack‘
* 
q
 = Wr™abËPack‘::
	`make
(

61 (*)
mbuf
->
buf_addr
,

62 
DPDKDeviû
::
MBUF_DATA_SIZE
,

63 
DPDKDeviû
::
ä“_pkt
,

64 (*)
mbuf
);

65 ià(
q
->
	`cİy
(
p
,
	`¹e_pktmbuf_h—droom
(
mbuf
è+ 
_exŒa_h—droom
)) {

66 
p
->
	`kl
();

67  
q
;

69 
p
->
	`kl
();

73 
	}
}

75 
Pack‘
*

76 
	gEnsu»DPDKBufãr
::
	$sim¶e_aùiÚ
(
Pack‘
* 
p
) {

77  
	`smaùiÚ
(
p
);

78 
	}
}

83 
CLICK_ENDDECLS


84 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
dpdk
)

85 
	`EXPORT_ELEMENT
(
Ensu»DPDKBufãr
)

	@userlevel/ensuredpdkbuffer.hh

2 #iâdeà
CLICK_ENSUREDPDKBUFFER_HH


3 
	#CLICK_ENSUREDPDKBUFFER_HH


	)

4 
	~<şick/cÚfig.h
>

5 
	~<şick/–em’t.hh
>

7 
CLICK_DECLS


30 şas 
	cEnsu»DPDKBufãr
: 
public
 
EËm’t
 {

32 
public
:

33 
	$Ensu»DPDKBufãr
(è
CLICK_COLD
;

34 ~
	$Ensu»DPDKBufãr
(è
CLICK_COLD
;

36 cÚ¡ *
	$şass_Çme
() const {  "EnsureDPDKBuffer"; }

37 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

38 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

39 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
);

41 
Pack‘
* 
smaùiÚ
(Packet*);

42 
Pack‘
* 
sim¶e_aùiÚ
(Packet*);

44 
	g´iv©e
:

45 
boŞ
 
_fÜû
;

46 
	g_exŒa_h—droom
;

47 
	g_w¬n_couÁ
;

50 
	gCLICK_ENDDECLS


	@userlevel/fakepcap.cc

19 
	~<şick/cÚfig.h
>

20 
	~"çk•ÿp.hh
"

21 
	~<şickÃt/.h
>

22 
	~<şickÃt/6.h
>

23 
	~<şickÃt/‘h”.h
>

24 
	~<şickÃt/fddi.h
>

25 
	~<şickÃt/rfc1483.h
>

26 
	~<şickÃt/wifi.h
>

27 
	~<şickÃt/Îc.h
>

28 
	~<şickÃt/µp.h
>

29 
	~<şick/¬gs.hh
>

30 
CLICK_DECLS


32 cÚ¡ 
	sdÉ_Çme
 {

33 cÚ¡ * 
	mÇme
;

34 
	mdÉ
;

35 } 
	gdÉ_Çmes
[] = {

36 { "NULL", 
FAKE_DLT_NULL
 },

37 { "IP", 
FAKE_DLT_RAW
 },

38 { "ETHER", 
FAKE_DLT_EN10MB
 },

39 { "FDDI", 
FAKE_DLT_FDDI
 },

40 { "ATM", 
FAKE_DLT_ATM_RFC1483
 },

41 { "RFC1483", 
FAKE_DLT_ATM_RFC1483
 },

42 { "ATM_RFC1483", 
FAKE_DLT_ATM_RFC1483
 },

43 { "802_11", 
FAKE_DLT_IEEE802_11
 },

44 { "802.11", 
FAKE_DLT_IEEE802_11
 },

45 { "802_11_RADIO", 
FAKE_DLT_IEEE802_11_RADIO
 },

46 { "802.11_RADIO", 
FAKE_DLT_IEEE802_11_RADIO
 },

47 { "SLL", 
FAKE_DLT_LINUX_SLL
 },

48 { "AIRONET", 
FAKE_DLT_AIRONET_HEADER
 },

49 { "HDLC", 
FAKE_DLT_C_HDLC
 },

50 { "PPP_HDLC", 
FAKE_DLT_PPP_HDLC
 },

51 { "PPP", 
FAKE_DLT_PPP
 },

52 { "SUNATM", 
FAKE_DLT_SUNATM
 },

53 { "PRISM", 
FAKE_DLT_PRISM_HEADER
 }

57 
	$çke_pÿp_·r£_dÉ
(cÚ¡ 
SŒšg
 &
¡r
)

59 cÚ¡ 
dÉ_Çme
* 
d
 = 
dÉ_Çmes
; d < dlt_names + ((dlt_names) / (dlt_names[0])); d++)

60 ià(
¡r
 =ğ
d
->
Çme
)

61  
d
->
dÉ
;

62 
ušt32_t
 
dÉ
 = 0;

63 ià(
¡r
.
	`Ëngth
(è>ğ2 && sŒ[0] =ğ'#' && 
	`IÁArg
().
	`·r£
(¡r.
	`sub¡ršg
(1), 
dÉ
) && dlt < 0x7FFFFFFF)

64  
dÉ
;

67 
	}
}

69 
SŒšg


70 
	$çke_pÿp_uÅ¬£_dÉ
(
dÉ
)

72 cÚ¡ 
dÉ_Çme
* 
d
 = 
dÉ_Çmes
; d < dlt_names + ((dlt_names) / (dlt_names[0])); d++)

73 ià(
dÉ
 =ğ
d
->dlt)

74  
SŒšg
::
	`make_¡abË
(
d
->
Çme
);

75 ià(
dÉ
 < 0)

76  
SŒšg
::
	`make_¡abË
("<none>");

77  "#" + 
	`SŒšg
(
dÉ
);

78 
	}
}

82 
boŞ


83 
	$çke_pÿp_dÉ_fÜû_abË
(
dÉ
)

85  (
dÉ
 =ğ
FAKE_DLT_RAW
 || dÉ =ğ
FAKE_DLT_HOST_RAW


86 || 
dÉ
 =ğ
FAKE_DLT_EN10MB
 || dÉ =ğ
FAKE_DLT_SUNATM


87 || 
dÉ
 =ğ
FAKE_DLT_FDDI
 || dÉ =ğ
FAKE_DLT_ATM_RFC1483


88 || 
dÉ
 =ğ
FAKE_DLT_LINUX_SLL
 || dÉ =ğ
FAKE_DLT_C_HDLC


89 || 
dÉ
 =ğ
FAKE_DLT_IEEE802_11
 || dÉ =ğ
FAKE_DLT_PRISM_HEADER


90 || 
dÉ
 =ğ
FAKE_DLT_PPP_HDLC
 || dÉ =ğ
FAKE_DLT_PPP


91 || 
dÉ
 =ğ
FAKE_DLT_NULL
 || dÉ =ğ
FAKE_DLT_IEEE802_11_RADIO
);

92 
	}
}

95 
	$çke_pÿp_ÿnÚiÿl_dÉ
(
dÉ
, 
boŞ
)

97 ià(
dÉ
 =ğ
FAKE_DLT_HOST_RAW
)

98  
FAKE_DLT_RAW
;

100  
dÉ
;

101 
	}
}

103 #ià
HAVE_INDIFFERENT_ALIGNMENT


104 
	#uÇligÃd_Ãt_shÜt
(
v
è(
	`Áohs
(*
»š‹½»t_ÿ¡
<cÚ¡ 
ušt16_t
*>(v)))

	)

105 
	#UNALIGNED_NET_SHORT_EQ
(
x
, 
y
è((xè=ğ
	`htÚs
((y)))

	)

107 
šlše
 
ušt16_t


108 
	$uÇligÃd_Ãt_shÜt
(cÚ¡ *
v
)

110 cÚ¡ 
ušt8_t
 *
d
 = 
»š‹½»t_ÿ¡
<cÚ¡ ušt8_ˆ*>(
v
);

111  (
d
[0] << 8) | d[1];

112 
	}
}

113 
	#UNALIGNED_NET_SHORT_EQ
(
x
, 
y
è(
	`uÇligÃd_Ãt_shÜt
(&(x)è=ğ(y))

	)

116 
	#IP_ETHERTYPE
(
‘
è(
	`UNALIGNED_NET_SHORT_EQ
(Ót), 
ETHERTYPE_IP
è|| UNALIGNED_NET_SHORT_EQ(Ót), 
ETHERTYPE_IP6
))

	)

120 
boŞ


121 
	$çke_pÿp_fÜû_
(
Pack‘
 *&
p
, 
dÉ
)

123 cÚ¡ 
şick_
 *
h
 = 0;

124 cÚ¡ 
ušt8_t
 *
d©a
 = 
p
->
	`d©a
();

125 cÚ¡ 
ušt8_t
 *
’d_d©a
 = 
p
->
	`’d_d©a
();

127 
dÉ
) {

129 
FAKE_DLT_RAW
:

130 
FAKE_DLT_HOST_RAW
: {

131 
h
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
şick_
*>(
d©a
);

135 
‘h”Ãt
:

136 
FAKE_DLT_EN10MB
: {

137 cÚ¡ 
şick_‘h”
* 
‘hh
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_‘h”*>(
d©a
);

138 ià(
d©a
 + (
şick_‘h”
è<ğ
’d_d©a
) {

139 ià(
	`IP_ETHERTYPE
(
‘hh
->
‘h”_ty³
))

140 
h
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
şick_
*>(
‘hh
 + 1);

141 ià(
	`UNALIGNED_NET_SHORT_EQ
(
‘hh
->
‘h”_ty³
, 
ETHERTYPE_8021Q
)

142 && 
d©a
 + (
şick_‘h”_vÏn
è<ğ
’d_d©a
) {

144 cÚ¡ 
şick_‘h”_vÏn
* 
‘hvh
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_‘h”_vÏn*>(
‘hh
);

145 ià(
	`IP_ETHERTYPE
(
‘hvh
->
‘h”_vÏn_’ÿp_´Ùo
))

146 
h
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
şick_
*>(
‘hvh
 + 1);

152 
fddi
:

153 
FAKE_DLT_FDDI
: {

154 cÚ¡ 
şick_fddi
* 
fh
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_fddi*>(
d©a
);

155 ià(
d©a
 + (
şick_fddi_¢­
è> 
’d_d©a


156 || (
fh
->
fc
 & 
FDDI_FC_LLCMASK
è!ğ
FDDI_FC_LLC_ASYNC
)

158 
d©a
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
*>(
fh
 + 1);

159 
rfc1483
;

162 
FAKE_DLT_SUNATM
:

163 
d©a
 += 4;

164 
rfc1483
;

166 
rfc1483
:

167 
FAKE_DLT_ATM_RFC1483
: {

168 cÚ¡ 
şick_rfc1483
* 
rh
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_rfc1483*>(
d©a
);

169 ià(
d©a
 + (
şick_rfc1483
è<ğ
’d_d©a


170 && 
	`memcmp
(&
rh
->
d§p
, 
RFC1483_SNAP_IP_EXPECTED
, 
RFC1483_SNAP_IP_EXPECTED_LEN
) == 0

171 && 
	`IP_ETHERTYPE
(
rh
->
‘h”_ty³
))

172 
h
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
şick_
*>(
rh
 + 1);

173 ià(
d©a
 + 4 <ğ
’d_d©a


174 && 
rh
->
d§p
 =ğ
LLC_IP_LSAP
 &&„h->
s§p
 == LLC_IP_LSAP)

175 
h
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
şick_
*>(
d©a
 + 4);

176 ià(
d©a
 + (
şick_rfc1483
è<ğ
’d_d©a


177 && 
rh
->
d§p
 =ğ
LLC_SNAP_LSAP
 &&„h->
s§p
 == LLC_SNAP_LSAP) {

178 
	#OUI_ENCAP_ETHER
 0x000000

	)

179 
	#OUI_CISCO_90
 0x0000f8

	)

180 
	#OUI_RFC2684
 0x0080c2

	)

181 
	#PID_RFC2684_ETH_FCS
 0x0001

	)

182 
	#PID_RFC2684_ETH_NOFCS
 0x0007

	)

183 
	#PID_RFC2684_FDDI_FCS
 0x0004

	)

184 
	#PID_RFC2684_FDDI_NOFCS
 0x000¨

	)

185 
ušt32_t
 
Ügcode
 = (
rh
->orgcode[0]<<16) + (rh->orgcode[1]<<8) +„h->orgcode[2];

186 ià(
Ügcode
 =ğ
OUI_ENCAP_ETHER
 || orgcod=ğ
OUI_CISCO_90
) {

187 
d©a
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
*>(&
rh
->
‘h”_ty³
) - 12;

188 
‘h”Ãt
;

189 } ià(
Ügcode
 =ğ
OUI_RFC2684
) {

190 
ušt32_t
 
‘h”ty³
 = 
	`uÇligÃd_Ãt_shÜt
(&
rh
->
‘h”_ty³
);

191 ià(
‘h”ty³
 =ğ
PID_RFC2684_ETH_FCS
 ||ƒth”ty³ =ğ
PID_RFC2684_ETH_NOFCS
) {

192 
d©a
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
*>(
rh
 + 1);

193 
‘h”Ãt
;

194 } ià(
‘h”ty³
 =ğ
PID_RFC2684_FDDI_FCS
 ||ƒth”ty³ =ğ
PID_RFC2684_FDDI_NOFCS
) {

195 
d©a
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
*>(
rh
 + 1) + 1;

196 
fddi
;

203 
FAKE_DLT_LINUX_SLL
: {

204 
	sşick_lšux_¦l
 {

205 
ušt16_t
 
¦l_pk‰y³
;

206 
ušt16_t
 
¦l_h©y³
;

207 
ušt16_t
 
¦l_h®’
;

208 
ušt8_t
 
¦l_addr
[8];

209 
ušt16_t
 
¦l_´ÙocŞ
;

210 } 
CLICK_SIZE_PACKED_ATTRIBUTE
;

211 cÚ¡ 
şick_lšux_¦l
* 
¦lh
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_lšux_¦l*>(
d©a
);

212 ià(
d©a
 + (
şick_lšux_¦l
è<ğ
’d_d©a
 &&

213 
	`IP_ETHERTYPE
(
¦lh
->
¦l_´ÙocŞ
))

214 
h
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
şick_
*>(
¦lh
 + 1);

218 
c_hdlc
:

219 
FAKE_DLT_C_HDLC
: {

220 
	sşick_pÿp_hdlc
 {

221 
ušt16_t
 
hdlc_add»ss
;

222 
ušt16_t
 
hdlc_´ÙocŞ
;

224 cÚ¡ 
şick_pÿp_hdlc
* 
hdlch
 = 
»š‹½»t_ÿ¡
<cÚ¡ click_pÿp_hdlc*>(
d©a
);

225 ià(
d©a
 + (
şick_pÿp_hdlc
è<ğ
’d_d©a


226 && 
	`IP_ETHERTYPE
(
hdlch
->
hdlc_´ÙocŞ
))

227 
h
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
şick_
*>(
hdlch
 + 1);

231 
FAKE_DLT_PPP_HDLC
: {

232 ià(
d©a
 + 4 > 
’d_d©a
)

234 ià(
d©a
[0] =ğ
PPP_ADDRESS
) {

235 ià(
d©a
[2] =ğ0 && (d©a[3] =ğ
PPP_IP
 || d©a[3] =ğ
PPP_IPV6
))

236 
h
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
şick_
*>(
d©a
 + 4);

237 } ià(
d©a
[0] == 0x0F

238 || 
d©a
[0] == 0x8F )

239 
c_hdlc
;

243 
FAKE_DLT_PPP
: {

244 ià(
d©a
 + 2 <ğ
’d_d©a
 && d©a[0] =ğ
PPP_ADDRESS
 && d©a[1] =ğ
PPP_CONTROL
)

245 
d©a
 += 2;

246 ià(
d©a
 + 2 > 
’d_d©a
)

248 ià(
d©a
[0] =ğ
PPP_IP
 || d©a[0] =ğ
PPP_IPV6
)

249 
h
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
şick_
*>(
d©a
 + 1);

250 ià(
d©a
[0] =ğ0 && (d©a[1] =ğ
PPP_IP
 || d©a[1] =ğ
PPP_IPV6
))

251 
h
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
şick_
*>(
d©a
 + 2);

255 
FAKE_DLT_PRISM_HEADER
:

256 
d©a
 += 144;

257 
›“802_11
;

259 
›“802_11
:

260 
FAKE_DLT_IEEE802_11
:

261 ià(
d©a
 + 24 <ğ
’d_d©a


262 && (
d©a
[0] & 
WIFI_FC0_TYPE_MASK
è=ğ
WIFI_FC0_TYPE_DATA
) {

263 
d©a
 += ((data[1] & 0x03) == 0x03 ? 30 : 24);

264 
rfc1483
;

268 
FAKE_DLT_IEEE802_11_RADIO
: {

269 
ušt16_t
 
Ën
;

270 ià(
d©a
 + 4 <ğ
’d_d©a


271 && (
Ën
 = (
d©a
[3] << 8) | (data[2])) >= 8) {

272 
d©a
 +ğ
Ën
;

273 
›“802_11
;

278 
FAKE_DLT_NULL
: {

279 ià(
d©a
 + 4 > 
’d_d©a
)

281 
çmy
 = 
d©a
[0] | (data[1] << 8);

282 ià(
çmy
 == 0)

283 
çmy
 = (
d©a
[2] << 8) | data[3];

284 ià(
çmy
 == 2

285 || 
çmy
 == 24

286 || 
çmy
 == 28

287 || 
çmy
 == 30 )

288 
h
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
şick_
*>(
d©a
 + 4);

297 ià(!
h
)

298  
çl£
;

300 #ià!
HAVE_INDIFFERENT_ALIGNMENT


303 
ušŒ_t
 
h—d”_±r
 = 
»š‹½»t_ÿ¡
<ušŒ_t>(
h
);

304 ià(
h—d”_±r
 & 3) {

305 
h—d”_off
 = 
h—d”_±r
 - 
»š‹½»t_ÿ¡
<
ušŒ_t
>(
p
->
	`d©a
());

306 ià(
Pack‘
 *
q
 = 
p
->
	`shiá_d©a
(-(
h—d”_±r
 & 3), 
çl£
)) {

307 
p
 = 
q
;

308 
h
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
şick_
 *>(
q
->
	`d©a
(è+ 
h—d”_off
);

309 
’d_d©a
 = 
p
->
	`’d_d©a
();

311  
çl£
;

315 ià(
h
->
_v
 == 4) {

316 ià(
h
->
_hl
 >= 5

317 && 
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
*>(
h
è+ (h->
_hl
 << 2è<ğ
’d_d©a
) {

318 
p
->
	`£t__h—d”
(
h
, iph->
_hl
 << 2);

319 
p
->
	`£t_d¡__ªno
(
h
->
_d¡
);

320  
Œue
;

322 } ià(
h
->
_v
 == 6) {

323 ià(
»š‹½»t_ÿ¡
<cÚ¡ 
ušt8_t
*>(
h
è+ (
şick_6
è<ğ
’d_d©a
) {

324 
p
->
	`£t_6_h—d”
(
»š‹½»t_ÿ¡
<cÚ¡ 
şick_6
*>(
h
));

325  
Œue
;

329  
çl£
;

330 
	}
}

332 
CLICK_ENDDECLS


333 
ELEMENT_REQUIRES
(
u£¾ev–
|
ns
)

334 
ELEMENT_PROVIDES
(
FakePÿp
)

	@userlevel/fakepcap.hh

1 #iâdeà
CLICK_FAKEPCAP_HH


2 
	#CLICK_FAKEPCAP_HH


	)

3 
	~<şick/¡ršg.hh
>

4 
	~<şick/·ck‘.hh
>

5 
	gCLICK_DECLS


7 
	#FAKE_PCAP_MAGIC
 0xA1B2C3D4

	)

8 
	#FAKE_PCAP_MAGIC_NANO
 0xA1B23C4D

	)

9 
	#FAKE_MODIFIED_PCAP_MAGIC
 0xA1B2CD34

	)

10 
	#FAKE_PCAP_VERSION_MAJOR
 2

	)

11 
	#FAKE_PCAP_VERSION_MINOR
 4

	)

14 
	#FAKE_DLT_NONE
 (-1è

	)

15 
	#FAKE_DLT_NULL
 0

	)

16 
	#FAKE_DLT_EN10MB
 1

	)

17 
	#FAKE_DLT_PPP
 9

	)

18 
	#FAKE_DLT_FDDI
 10

	)

19 
	#FAKE_DLT_PPP_HDLC
 50

	)

20 
	#FAKE_DLT_ATM_RFC1483
 100

	)

21 
	#FAKE_DLT_RAW
 101

	)

22 
	#FAKE_DLT_C_HDLC
 104

	)

23 
	#FAKE_DLT_IEEE802_11
 105

	)

24 
	#FAKE_DLT_LINUX_SLL
 113

	)

25 
	#FAKE_DLT_PRISM_HEADER
 119

	)

26 
	#FAKE_DLT_AIRONET_HEADER
 120

	)

27 
	#FAKE_DLT_SUNATM
 123

	)

28 
	#FAKE_DLT_IEEE802_11_RADIO
 127

	)

31 
	#FAKE_DLT_HOST_RAW
 12

	)

39 
	sçke_pÿp_fe_h—d”
 {

40 
ušt32_t
 
	mmagic
;

41 
ušt16_t
 
	mv”siÚ_majÜ
;

42 
ušt16_t
 
	mv”siÚ_mšÜ
;

43 
št32_t
 
	mthiszÚe
;

44 
ušt32_t
 
	msigfigs
;

45 
ušt32_t
 
	m¢­Ën
;

46 
ušt32_t
 
	mlškty³
;

49 
	sçke_bpf_timev®
 {

50 
št32_t
 
	mtv_£c
;

51 
št32_t
 
	mtv_u£c
;

54 
	uçke_bpf_timev®_uniÚ
 {

55 
çke_bpf_timev®
 
	mtv
;

56 
	mTime¡amp
::
»p_t
 
time¡amp_»p
;

57 
šlše
 
Time¡amp
 
make_time¡amp
(cÚ¡ 
çke_bpf_timev®_uniÚ
* 
x
, 
boŞ
 
Çno
);

65 
	sçke_pÿp_pkthdr
 {

66 
çke_bpf_timev®_uniÚ
 
	mts
;

67 
ušt32_t
 
	mÿ¶’
;

68 
ušt32_t
 
	mËn
;

72 
	sçke_modif›d_pÿp_pkthdr
 {

73 
çke_pÿp_pkthdr
 
	mhdr
;

74 
ušt32_t
 
	mifšdex
;

77 
ušt16_t
 
	m´ÙocŞ
;

78 
ušt8_t
 
	mpkt_ty³
;

79 
ušt8_t
 
	m·d
;

83 
çke_pÿp_·r£_dÉ
(cÚ¡ 
SŒšg
&);

84 
SŒšg
 
çke_pÿp_uÅ¬£_dÉ
();

85 
çke_pÿp_ÿnÚiÿl_dÉ
(, 
boŞ
 
äom_fe
);

88 
boŞ
 
çke_pÿp_dÉ_fÜû_abË
();

89 
boŞ
 
çke_pÿp_fÜû_
(
Pack‘
*&, );

90 
boŞ
 
çke_pÿp_fÜû_
(
Wr™abËPack‘
*&, );

93 
šlše
 
boŞ


94 
	$çke_pÿp_fÜû_
(
Wr™abËPack‘
*& 
p
, 
dÉ
)

96  
	`çke_pÿp_fÜû_
(
»š‹½»t_ÿ¡
<
Pack‘
*&>(
p
), 
dÉ
);

97 
	}
}

99 
šlše
 
Time¡amp


100 
	gçke_bpf_timev®_uniÚ
::
	$make_time¡amp
(cÚ¡ 
çke_bpf_timev®_uniÚ
* 
x
, 
boŞ
 
Çno
)

102 ià(
Çno
) {

103 #ià
TIMESTAMP_REP_BIG_ENDIAN
 && 
TIMESTAMP_NANOSEC


104  
	`Time¡amp
(
x
->
time¡amp_»p
);

106  
Time¡amp
::
	`make_n£c
(
x
->
tv
.
tv_£c
, x->tv.
tv_u£c
);

109 #ià
TIMESTAMP_REP_BIG_ENDIAN
 && !
TIMESTAMP_NANOSEC


110  
	`Time¡amp
(
x
->
time¡amp_»p
);

112  
Time¡amp
::
	`make_u£c
(
x
->
tv
.
tv_£c
, x->tv.
tv_u£c
);

115 
	}
}

117 
	gCLICK_ENDDECLS


	@userlevel/fastudpsrc.cc

17 
	~<şick/cÚfig.h
>

18 
	~<şickÃt/.h
>

19 
	~"ç¡udp¤c.hh
"

20 
	~<şick/¬gs.hh
>

21 
	~<şick/‘h”add»ss.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şick/¡ªd¬d/®ignm’tšfo.hh
>

26 cÚ¡ 
	gFa¡UDPSourû
::
NO_LIMIT
;

28 
	gFa¡UDPSourû
::
	$Fa¡UDPSourû
()

29 : 
	$_·ck‘
(0)

31 
_¿‹_lim™ed
 = 
Œue
;

32 
_fœ¡
 = 
_Ï¡
 = 0;

33 
_couÁ
 = 0;

34 
	}
}

36 
	gFa¡UDPSourû
::~
	$Fa¡UDPSourû
()

38 
	}
}

41 
Fa¡UDPSourû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

43 
	g_cksum
 = 
Œue
;

44 
	g_aùive
 = 
Œue
;

45 
	g_š‹rv®
 = 0;

46 
	g¿‹
;

47 
	glim™
;

48 ià(
Args
(
cÚf
, 
this
, 
”rh
)

49 .
»ad_mp
("RATE", 
¿‹
)

50 .
»ad_mp
("LIMIT", 
lim™
)

51 .
»ad_mp
("LENGTH", 
_Ën
)

52 .
»ad_mp
("SRCETH", 
Eth”Add»ssArg
(), 
_‘hh
.
‘h”_sho¡
)

53 .
»ad_mp
("SRCIP", 
_saddr
)

54 .
»ad_mp
("SPORT", 
IPPÜtArg
(
IP_PROTO_UDP
), 
_¥Üt
)

55 .
»ad_mp
("DSTETH", 
Eth”Add»ssArg
(), 
_‘hh
.
‘h”_dho¡
)

56 .
»ad_mp
("DSTIP", 
_daddr
)

57 .
»ad_mp
("DPORT", 
IPPÜtArg
(
IP_PROTO_UDP
), 
_dpÜt
)

58 .
»ad_p
("CHECKSUM", 
_cksum
)

59 .
»ad_p
("INTERVAL", 
_š‹rv®
)

60 .
»ad_p
("ACTIVE", 
_aùive
)

61 .
com¶‘e
() < 0)

63 ià(
	g_Ën
 < 60) {

64 
şick_ch©‹r
("warning:…acket†ength < 60, defaultingo 60");

65 
	g_Ën
 = 60;

67 
	g_‘hh
.
	g‘h”_ty³
 = 
htÚs
(0x0800);

68 if(
	g¿‹
 != 0){

69 
_¿‹_lim™ed
 = 
Œue
;

70 
	g_¿‹
.
£t_¿‹
(
¿‹
, 
”rh
);

72 
	g_¿‹_lim™ed
 = 
çl£
;

74 
	g_lim™
 = (
lim™
 >ğ0 ?†im™ : 
NO_LIMIT
);

79 
	gFa¡UDPSourû
::
	$šü_pÜts
()

81 
Wr™abËPack‘
 *
q
 = 
_·ck‘
->
	`uniqueify
();

82 
_·ck‘
 = 
q
;

83 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
q
->
	`d©a
()+14);

84 
şick_udp
 *
udp
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(

 + 1);

85 
_šü
++;

86 
udp
->
uh_¥Üt
 = 
	`htÚs
(
_¥Üt
+
_šü
);

87 
udp
->
uh_dpÜt
 = 
	`htÚs
(
_dpÜt
+
_šü
);

88 
udp
->
uh_sum
 = 0;

89 
Ën
 = 
_Ën
-14-(
şick_
);

90 ià(
_cksum
) {

91 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
udp
, 
Ën
);

92 
udp
->
uh_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
Ën
);

94 
udp
->
uh_sum
 = 0;

95 
	}
}

98 
	gFa¡UDPSourû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

100 
_couÁ
 = 0;

101 
_šü
 = 0;

102 
Wr™abËPack‘
 *
q
 = 
Pack‘
::
	`make
(
_Ën
);

103 
_·ck‘
 = 
q
;

104 
	`memıy
(
q
->
	`d©a
(), &
_‘hh
, 14);

105 
şick_
 *

 = 
»š‹½»t_ÿ¡
<şick_ *>(
q
->
	`d©a
()+14);

106 
şick_udp
 *
udp
 = 
»š‹½»t_ÿ¡
<şick_ud°*>(

 + 1);

109 

->
_v
 = 4;

110 

->
_hl
 = (
şick_
) >> 2;

111 

->
_Ën
 = 
	`htÚs
(
_Ën
-14);

112 

->
_id
 = 0;

113 

->
_p
 = 
IP_PROTO_UDP
;

114 

->
_¤c
 = 
_saddr
;

115 

->
_d¡
 = 
_daddr
;

116 

->
_tos
 = 0;

117 

->
_off
 = 0;

118 

->
_‰l
 = 250;

119 

->
_sum
 = 0;

120 

->
_sum
 = 
	`şick_š_cksum
((*), (
şick_
));

121 
_·ck‘
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(
_daddr
));

122 
_·ck‘
->
	`£t__h—d”
(

, (
şick_
));

125 
udp
->
uh_¥Üt
 = 
	`htÚs
(
_¥Üt
);

126 
udp
->
uh_dpÜt
 = 
	`htÚs
(
_dpÜt
);

127 
udp
->
uh_sum
 = 0;

128 
Ën
 = 
_Ën
-14-(
şick_
);

129 
udp
->
uh_uËn
 = 
	`htÚs
(
Ën
);

130 ià(
_cksum
) {

131 
csum
 = 
	`şick_š_cksum
((
ušt8_t
 *)
udp
, 
Ën
);

132 
udp
->
uh_sum
 = 
	`şick_š_cksum_p£udohdr
(
csum
, 

, 
Ën
);

134 
udp
->
uh_sum
 = 0;

137 
	}
}

140 
	gFa¡UDPSourû
::
	$ş—nup
(
CËªupSge
)

142 ià(
_·ck‘
) {

143 
_·ck‘
->
	`kl
();

144 
_·ck‘
=0;

146 
	}
}

148 
Pack‘
 *

149 
	gFa¡UDPSourû
::
	$puÎ
()

151 
Pack‘
 *
p
 = 0;

153 ià(!
_aùive
 || (
_lim™
 !ğ
NO_LIMIT
 && 
_couÁ
 >= _limit))  0;

155 if(
_¿‹_lim™ed
){

156 ià(
_¿‹
.
	`Ãed_upd©e
(
Time¡amp
::
	`now
())) {

157 
_¿‹
.
	`upd©e
();

158 
p
 = 
_·ck‘
->
	`şÚe
();

161 
p
 = 
_·ck‘
->
	`şÚe
();

164 if(
p
) {

165 
_couÁ
++;

166 if(
_couÁ
 == 1)

167 
_fœ¡
 = 
	`şick_jiff›s
();

168 if(
_lim™
 !ğ
NO_LIMIT
 && 
_couÁ
 >= _limit)

169 
_Ï¡
 = 
	`şick_jiff›s
();

170 if(
_š‹rv®
>0 && !(
_couÁ
%_interval))

171 
	`šü_pÜts
();

174 (
p
);

175 
	}
}

178 
	gFa¡UDPSourû
::
	$»£t
()

180 
_couÁ
 = 0;

181 
_fœ¡
 = 0;

182 
_Ï¡
 = 0;

183 
_šü
 = 0;

184 
	}
}

186 
SŒšg


187 
	$Fa¡UDPSourû_»ad_couÁ_hªdËr
(
EËm’t
 *
e
, *)

189 
Fa¡UDPSourû
 *
c
 = (Fa¡UDPSourû *)
e
;

190  
	`SŒšg
(
c
->
	`couÁ
());

191 
	}
}

193 
SŒšg


194 
	$Fa¡UDPSourû_»ad_¿‹_hªdËr
(
EËm’t
 *
e
, *)

196 
Fa¡UDPSourû
 *
c
 = (Fa¡UDPSourû *)
e
;

197 if(
c
->
	`Ï¡
() != 0){

198 
d
 = 
c
->
	`Ï¡
(è- c->
	`fœ¡
();

199 ià(
d
 < 1) d = 1;

200 
¿‹
 = 
c
->
	`couÁ
(è* 
CLICK_HZ
 / 
d
;

201  
	`SŒšg
(
¿‹
);

203  
	`SŒšg
("0");

205 
	}
}

208 
	gFa¡UDPSourû_»£t_wr™e_hªdËr


209 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *)

211 
Fa¡UDPSourû
 *
	gc
 = (Fa¡UDPSourû *)
e
;

212 
	gc
->
»£t
();

217 
	gFa¡UDPSourû_lim™_wr™e_hªdËr


218 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

220 
Fa¡UDPSourû
 *
	gc
 = (Fa¡UDPSourû *)
e
;

221 
	glim™
;

222 ià(!
IÁArg
().
·r£
(
s
, 
lim™
))

223  
	g”rh
->
”rÜ
("limit…arameter must be integer >= 0");

224 
	gc
->
	g_lim™
 = (
lim™
 >ğ0 ?†im™ : 
c
->
NO_LIMIT
);

229 
	gFa¡UDPSourû_¿‹_wr™e_hªdËr


230 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

232 
Fa¡UDPSourû
 *
	gc
 = (Fa¡UDPSourû *)
e
;

233 
	g¿‹
;

234 ià(!
IÁArg
().
·r£
(
s
, 
¿‹
))

235  
	g”rh
->
”rÜ
("rate…arameter must be integer >= 0");

236 ià(
	g¿‹
 > 
	gG­R©e
::
MAX_RATE
)

238  
”rh
->
”rÜ
("¿‹oØÏrge; max i %u", 
G­R©e
::
MAX_RATE
);

239 
	gc
->
	g_¿‹
.
£t_¿‹
(
¿‹
);

244 
	gFa¡UDPSourû_aùive_wr™e_hªdËr


245 (cÚ¡ 
	gSŒšg
 &
	gs
, 
EËm’t
 *
	ge
, *, 
E¼ÜHªdËr
 *
	g”rh
)

247 
Fa¡UDPSourû
 *
	gc
 = (Fa¡UDPSourû *)
e
;

248 
boŞ
 
	gaùive
;

249 ià(!
BoŞArg
().
·r£
(
s
, 
aùive
))

250  
	g”rh
->
”rÜ
("active…arameter must be boolean");

251 
	gc
->
	g_aùive
 = 
aùive
;

252 ià(
	gaùive
è
	gc
->
»£t
();

257 
	gFa¡UDPSourû
::
	$add_hªdËrs
()

259 
	`add_»ad_hªdËr
("couÁ", 
Fa¡UDPSourû_»ad_couÁ_hªdËr
, 0);

260 
	`add_»ad_hªdËr
("¿‹", 
Fa¡UDPSourû_»ad_¿‹_hªdËr
, 0);

261 
	`add_wr™e_hªdËr
("¿‹", 
Fa¡UDPSourû_¿‹_wr™e_hªdËr
, 0);

262 
	`add_wr™e_hªdËr
("»£t", 
Fa¡UDPSourû_»£t_wr™e_hªdËr
, 0, 
HªdËr
::
BUTTON
);

263 
	`add_wr™e_hªdËr
("aùive", 
Fa¡UDPSourû_aùive_wr™e_hªdËr
, 0, 
HªdËr
::
CHECKBOX
);

264 
	`add_wr™e_hªdËr
("lim™", 
Fa¡UDPSourû_lim™_wr™e_hªdËr
, 0);

265 
	}
}

266 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

267 
	`EXPORT_ELEMENT
(
Fa¡UDPSourû
)

	@userlevel/fastudpsrc.hh

1 #iâdeà
FASTUDPSRCUSERLEVEL_HH


2 
	#FASTUDPSRCUSERLEVEL_HH


	)

53 
	~<şick/–em’t.hh
>

54 
	~<şick/glue.hh
>

55 
	~<şick/g­¿‹.hh
>

56 
	~<şick/·ck‘.hh
>

57 
	~<şickÃt/‘h”.h
>

58 
	~<şickÃt/udp.h
>

60 şas 
	cFa¡UDPSourû
 : 
public
 
EËm’t
 {

62 
boŞ
 
_¿‹_lim™ed
;

63 
	m_Ën
;

64 
şick_‘h”
 
	m_‘hh
;

65 
š_addr
 
	m_saddr
;

66 
š_addr
 
	m_daddr
;

67 
ušt16_t
 
	m_¥Üt
;

68 
ušt16_t
 
	m_dpÜt
;

69 
	m_šü
;

70 
	m_š‹rv®
;

71 
boŞ
 
	m_cksum
;

72 
Pack‘
 *
	m_·ck‘
;

73 
şick_jiff›s_t
 
	m_fœ¡
;

74 
şick_jiff›s_t
 
	m_Ï¡
;

76 
šü_pÜts
();

78 
	mpublic
:

80 cÚ¡ 
NO_LIMIT
 = 0xFFFFFFFFU;

82 
G­R©e
 
	m_¿‹
;

83 
	m_couÁ
;

84 
	m_lim™
;

85 
boŞ
 
	m_aùive
;

87 
	$Fa¡UDPSourû
(è
CLICK_COLD
;

88 ~
	$Fa¡UDPSourû
(è
CLICK_COLD
;

90 cÚ¡ *
	$şass_Çme
() const {  "FastUDPSource"; }

91 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

92 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

94 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

95 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

96 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

97 
Pack‘
 *
	`puÎ
();

99 
	$add_hªdËrs
(è
CLICK_COLD
;

100 
	`»£t
();

101 
	$couÁ
(è{  
_couÁ
; 
	}
}

102 
şick_jiff›s_t
 
	$fœ¡
(è{  
_fœ¡
; 
	}
}

103 
şick_jiff›s_t
 
	$Ï¡
(è{  
_Ï¡
; 
	}
}

106 
ä›nd
 
	gFa¡UDPSourû_lim™_wr™e_hªdËr


107 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *);

108 
ä›nd
 
	gFa¡UDPSourû_¿‹_wr™e_hªdËr


109 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *);

110 
ä›nd
 
	gFa¡UDPSourû_aùive_wr™e_hªdËr


111 (cÚ¡ 
	gSŒšg
 &, 
EËm’t
 *
	ge
, *, 
	gE¼ÜHªdËr
 *);

	@userlevel/fromdevice.cc

23 
	~<şick/cÚfig.h
>

24 
	~<sys/ty³s.h
>

25 
	~<sys/time.h
>

26 #ià!
defšed
(
__sun
)

27 
	~<sys/ioùl.h
>

29 
	~<sys/ioccom.h
>

31 #ià
HAVE_NET_BPF_H


32 
	~<Ãt/bpf.h
>

33 
	#PCAP_DONT_INCLUDE_PCAP_BPF_H
 1

	)

35 
	~"äomdeviû.hh
"

36 
	~<şick/‘h”add»ss.hh
>

37 
	~<şick/”rÜ.hh
>

38 
	~<şick/¡¿ccum.hh
>

39 
	~<şick/¬gs.hh
>

40 
	~<şick/glue.hh
>

41 
	~<şick/·ck‘_ªno.hh
>

42 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

43 
	~<şick/u£ruts.hh
>

44 
	~<uni¡d.h
>

45 
	~<fú.h
>

46 
	~"çk•ÿp.hh
"

48 #ià
FROMDEVICE_ALLOW_LINUX


49 
	~<sys/sock‘.h
>

50 
	~<Ãt/if.h
>

51 
	~<ã©u»s.h
>

52 
	~<lšux/if_·ck‘.h
>

53 
	~<Ãt/‘h”Ãt.h
>

56 
CLICK_DECLS


58 
	gFromDeviû
::
	$FromDeviû
()

60 #ià
FROMDEVICE_ALLOW_NETMAP
 || 
FROMDEVICE_ALLOW_PCAP


61 
	`_sk
(
this
),

63 #ià
FROMDEVICE_ALLOW_PCAP


64 
	`_pÿp
(0), 
	`_pÿp_com¶ašts
(0),

66 
	`_d©®šk
(-1), 
	`_couÁ
(0), 
	`_´omisc
(0), 
	$_¢­Ën
(0)

68 #ià
FROMDEVICE_ALLOW_LINUX
 || 
FROMDEVICE_ALLOW_PCAP
 || 
FROMDEVICE_ALLOW_NETMAP


69 
_fd
 = -1;

71 
	}
}

73 
	gFromDeviû
::~
	$FromDeviû
()

75 
	}
}

78 
FromDeviû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

80 
boŞ
 
	g´omisc
 = 
çl£
, 
	goutbound
 = f®£, 
	g¢ifãr
 = 
Œue
, 
	gtime¡amp
 =rue;

81 
	g_´ÙocŞ
 = 0;

82 
	g_¢­Ën
 = 
deçuÉ_¢­Ën
;

83 
	g_h—droom
 = 
Pack‘
::
deçuÉ_h—droom
;

84 
	g_h—droom
 +ğ(4 - (
_h—droom
 + 2) % 4) % 4;

85 
	g_fÜû_
 = 
çl£
;

86 
	g_bur¡
 = 1;

87 
SŒšg
 
	gbpf_f‹r
, 
	gÿ±u»
, 
	g’ÿp_ty³
;

88 
boŞ
 
	ghas_’ÿp
;

89 ià(
Args
(
cÚf
, 
this
, 
”rh
)

90 .
»ad_mp
("DEVNAME", 
_iâame
)

91 .
»ad_p
("PROMISC", 
´omisc
)

92 .
»ad_p
("SNAPLEN", 
_¢­Ën
)

93 .
»ad
("SNIFFER", 
¢ifãr
)

94 .
»ad
("FORCE_IP", 
_fÜû_
)

95 .
»ad
("METHOD", 
WÜdArg
(), 
ÿ±u»
)

96 .
»ad
("CAPTURE", 
WÜdArg
(), 
ÿ±u»
)

97 .
»ad
("BPF_FILTER", 
bpf_f‹r
)

98 .
»ad
("PROTOCOL", 
_´ÙocŞ
)

99 .
»ad
("OUTBOUND", 
outbound
)

100 .
»ad
("HEADROOM", 
_h—droom
)

101 .
»ad
("ENCAP", 
WÜdArg
(), 
’ÿp_ty³
).
»ad_¡©us
(
has_’ÿp
)

102 .
»ad
("BURST", 
_bur¡
)

103 .
»ad
("TIMESTAMP", 
time¡amp
)

104 .
com¶‘e
() < 0)

106 ià(
	g_¢­Ën
 > 65535 || _snaplen < 14)

107  
	g”rh
->
”rÜ
("SNAPLEN out of„ange");

108 ià(
	g_h—droom
 > 8190)

109  
	g”rh
->
”rÜ
("HEADROOM out of„ange");

110 ià(
	g_bur¡
 <= 0)

111  
”rh
->
”rÜ
("BURST out of„ange");

112 
	g_´ÙocŞ
 = 
htÚs
(
_´ÙocŞ
);

114 #ià
FROMDEVICE_ALLOW_PCAP


115 
	g_bpf_f‹r
 = 
bpf_f‹r
;

116 ià(
	ghas_’ÿp
) {

117 
	g_d©®šk
 = 
çke_pÿp_·r£_dÉ
(
’ÿp_ty³
);

118 ià(
	g_d©®šk
 < 0)

119  
	g”rh
->
”rÜ
("badƒncapsulationype");

124 ià(
	gÿ±u»
 == "") {

125 #ià
FROMDEVICE_ALLOW_NETMAP
 || 
FROMDEVICE_ALLOW_PCAP
 || 
FROMDEVICE_ALLOW_LINUX


126 #ià
FROMDEVICE_ALLOW_PCAP


127 
_m‘hod
 = 
_bpf_f‹r
 ? 
m‘hod_pÿp
 : 
m‘hod_deçuÉ
;

129 
	g_m‘hod
 = 
m‘hod_deçuÉ
;

132  
	g”rh
->
”rÜ
("cannot„eceive…ackets onhis…latform");

135 #ià
FROMDEVICE_ALLOW_LINUX


136 ià(
	gÿ±u»
 == "LINUX")

137 
_m‘hod
 = 
m‘hod_lšux
;

139 #ià
FROMDEVICE_ALLOW_PCAP


140 ià(
	gÿ±u»
 == "PCAP")

141 
_m‘hod
 = 
m‘hod_pÿp
;

143 #ià
FROMDEVICE_ALLOW_NETMAP


144 ià(
	gÿ±u»
 == "NETMAP")

145 
_m‘hod
 = 
m‘hod_Ãtm­
;

148  
	g”rh
->
”rÜ
("bad METHOD");

150 ià(
	gbpf_f‹r
 && 
	g_m‘hod
 !ğ
m‘hod_pÿp
)

151 
”rh
->
w¬nšg
("not using METHOD PCAP, BPF filter ignored");

153 
	g_¢ifãr
 = 
¢ifãr
;

154 
	g_´omisc
 = 
´omisc
;

155 
	g_outbound
 = 
outbound
;

156 
	g_time¡amp
 = 
time¡amp
;

160 #ià
FROMDEVICE_ALLOW_LINUX


162 
	gFromDeviû
::
	$İ’_·ck‘_sock‘
(
SŒšg
 
iâame
, 
E¼ÜHªdËr
 *
”rh
)

164 
fd
 = 
	`sock‘
(
PF_PACKET
, 
SOCK_RAW
, 
	`htÚs
(
ETH_P_ALL
));

165 ià(
fd
 == -1)

166  
”rh
->
	`”rÜ
("%s: sock‘: %s", 
iâame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

169 
iäeq
 
iä
;

170 
	`mem£t
(&
iä
, 0, (ifr));

171 
	`¡ºıy
(
iä
.
iä_Çme
, 
iâame
.
	`c_¡r
(), (ifr.ifr_name));

172 
»s
 = 
	`ioùl
(
fd
, 
SIOCGIFINDEX
, &
iä
);

173 ià(
»s
 != 0) {

174 
	`şo£
(
fd
);

175  
”rh
->
	`”rÜ
("%s: SIOCGIFINDEX: %s", 
iâame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

177 
ifšdex
 = 
iä
.
iä_ifšdex
;

182 
sockaddr_Î
 
§
;

183 
	`mem£t
(&
§
, 0, (sa));

184 
§
.
¦l_çmy
 = 
AF_PACKET
;

185 
§
.
¦l_´ÙocŞ
 = 
	`htÚs
(
ETH_P_ALL
);

186 
§
.
¦l_ifšdex
 = 
ifšdex
;

187 
»s
 = 
	`bšd
(
fd
, (
sockaddr
 *)&
§
, (sa));

188 ià(
»s
 != 0) {

189 
	`şo£
(
fd
);

190  
”rh
->
	`”rÜ
("%s: bšd: %s", 
iâame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

194 
	`fú
(
fd
, 
F_SETFL
, 
O_NONBLOCK
);

196  
fd
;

197 
	}
}

200 
	gFromDeviû
::
	$£t_´omiscuous
(
fd
, 
SŒšg
 
iâame
, 
boŞ
 
´omisc
)

203 
iäeq
 
iä
;

204 
	`mem£t
(&
iä
, 0, (ifr));

205 
	`¡ºıy
(
iä
.
iä_Çme
, 
iâame
.
	`c_¡r
(), (ifr.ifr_name));

206 ià(
	`ioùl
(
fd
, 
SIOCGIFFLAGS
, &
iä
) != 0)

208 
was_´omisc
 = (
iä
.
iä_æags
 & 
IFF_PROMISC
 ? 1 : 0);

211 #ifdeà
SOL_PACKET


212 ià(
	`ioùl
(
fd
, 
SIOCGIFINDEX
, &
iä
) != 0)

214 
·ck‘_m»q
 
mr
;

215 
	`mem£t
(&
mr
, 0, (mr));

216 
mr
.
mr_ifšdex
 = 
iä
.
iä_ifšdex
;

217 
mr
.
mr_ty³
 = (
´omisc
 ? 
PACKET_MR_PROMISC
 : 
PACKET_MR_ALLMULTI
);

218 ià(
	`£tsockİt
(
fd
, 
SOL_PACKET
, 
PACKET_ADD_MEMBERSHIP
, &
mr
, (mr)) < 0)

221 ià(
was_´omisc
 !ğ
´omisc
) {

222 
iä
.
iä_æags
 = (
´omisc
 ? iä.iä_æag | 
IFF_PROMISC
 : ifr.ifr_flags & ~IFF_PROMISC);

223 ià(
	`ioùl
(
fd
, 
SIOCSIFFLAGS
, &
iä
) < 0)

228  
was_´omisc
;

229 
	}
}

232 #ià
FROMDEVICE_ALLOW_PCAP


234 
	gFromDeviû
::
	$ãtch_pÿp_”rÜ
(
pÿp_t
* 
pÿp
, cÚ¡ *
ebuf
)

236 ià((!
ebuf
 || !ebuf[0]è&& 
pÿp
)

237 
ebuf
 = 
	`pÿp_g‘”r
(
pÿp
);

238 ià(!
ebuf
 || !ebuf[0])

241  
ebuf
;

242 
	}
}

244 
pÿp_t
 *

245 
	gFromDeviû
::
	$İ’_pÿp
(
SŒšg
 
iâame
, 
¢­Ën
, 
boŞ
 
´omisc
,

246 
E¼ÜHªdËr
 *
”rh
)

249 
ebuf
[
PCAP_ERRBUF_SIZE
];

250 
ebuf
[0] = 0;

251 
pÿp_t
* 
p
 = 
	`pÿp_ü—‹
(
iâame
.
	`c_¡r
(), 
ebuf
);

252 ià(!
p
) {

254 
”rh
->
	`”rÜ
("%s: %s", 
iâame
.
	`c_¡r
(), 
	`ãtch_pÿp_”rÜ
(0, 
ebuf
));

259 ià(
	`pÿp_£t_¢­Ën
(
p
, 
¢­Ën
))

260 
”rh
->
	`w¬nšg
("%s:ƒ¼Ü wh£‰šg sÇ¶’", 
iâame
.
	`c_¡r
());

261 ià(
	`pÿp_£t_´omisc
(
p
, 
´omisc
))

262 
”rh
->
	`w¬nšg
("%s:ƒ¼Ü wh£‰šg…romisc", 
iâame
.
	`c_¡r
());

265 
timeout_m£c
 = 1;

266 #ià
HAVE_PCAP_SETNONBLOCK


268 
timeout_m£c
 = 500;

270 ià(
	`pÿp_£t_timeout
(
p
, 
timeout_m£c
))

271 
”rh
->
	`w¬nšg
("%s:ƒ¼Ü wh£‰šgimeout", 
iâame
.
	`c_¡r
());

273 #ià
TIMESTAMP_NANOSEC
 && 
	`defšed
(
PCAP_TSTAMP_PRECISION_NANO
)

275 (è
	`pÿp_£t_t¡amp_´ecisiÚ
(
p
, 
PCAP_TSTAMP_PRECISION_NANO
);

278 #ià
HAVE_PCAP_SET_IMMEDIATE_MODE


279 ià(
	`pÿp_£t_immedŸ‹_mode
(
p
, 1))

280 
”rh
->
	`w¬nšg
("%s:ƒ¼Ü wh£‰šg immedŸ‹ mode", 
iâame
.
	`c_¡r
());

284 
r
 = 
	`pÿp_aùiv©e
(
p
);

285 ià(
r
 < 0) {

286 
”rh
->
	`”rÜ
("%s: %s", 
iâame
.
	`c_¡r
(), 
	`ãtch_pÿp_”rÜ
(
p
, 0));

287 
	`pÿp_şo£
(
p
);

288 
p
 = 0;

289 } ià(
r
 > 0)

290 
”rh
->
	`w¬nšg
("%s: %s", 
iâame
.
	`c_¡r
(), 
	`ãtch_pÿp_”rÜ
(
p
, 0));

293 #ià
HAVE_PCAP_SETNONBLOCK


294 ià(
	`pÿp_£ŠÚblock
(
p
, 1, 
ebuf
) < 0)

295 
”rh
->
	`w¬nšg
("nÚblockšg %s: %s", 
iâame
.
	`c_¡r
(), 
	`ãtch_pÿp_”rÜ
(
p
, 
ebuf
));

297 ià(
	`fú
(
	`pÿp_f’o
(
p
), 
F_SETFL
, 
O_NONBLOCK
) < 0)

298 
”rh
->
	`w¬nšg
("nÚblockšg %s: %s", 
iâame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

301  
p
;

302 
	}
}

306 
	gFromDeviû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

308 ià(!
_iâame
)

309  
”rh
->
	`”rÜ
("interface‚ot set");

311 #ià
FROMDEVICE_ALLOW_NETMAP


312 ià(
_m‘hod
 =ğ
m‘hod_deçuÉ
 || _m‘hod =ğ
m‘hod_Ãtm­
) {

313 
_fd
 = 
_Ãtm­
.
	`İ’
(
_iâame
, 
_m‘hod
 =ğ
m‘hod_Ãtm­
, 
”rh
);

314 ià(
_fd
 >= 0) {

315 
_d©®šk
 = 
FAKE_DLT_EN10MB
;

316 
_m‘hod
 = 
m‘hod_Ãtm­
;

317 
_Ãtm­
.
	`š™Ÿlize_ršgs_rx
(
_time¡amp
);

322 #ià
FROMDEVICE_ALLOW_PCAP


323 ià(
_m‘hod
 =ğ
m‘hod_deçuÉ
 || _m‘hod =ğ
m‘hod_pÿp
) {

324 
	`as£¹
(!
_pÿp
);

325 
_pÿp
 = 
	`İ’_pÿp
(
_iâame
, 
_¢­Ën
, 
_´omisc
, 
”rh
);

326 ià(!
_pÿp
)

328 
_fd
 = 
	`pÿp_f’o
(
_pÿp
);

329 *
iâame
 = 
_iâame
.
	`mubË_c_¡r
();

331 #ià
TIMESTAMP_NANOSEC
 && 
	`defšed
(
PCAP_TSTAMP_PRECISION_NANO
)

332 
_pÿp_Çno£c
 = 
çl£
;

333 ià(
	`pÿp_g‘_t¡amp_´ecisiÚ
(
_pÿp
è=ğ
PCAP_TSTAMP_PRECISION_NANO
)

334 
_pÿp_Çno£c
 = 
Œue
;

337 #ià
HAVE_PCAP_SETDIRECTION


338 
	`pÿp_£tdœeùiÚ
(
_pÿp
, 
_outbound
 ? 
PCAP_D_INOUT
 : 
PCAP_D_IN
);

339 #–ià
	`defšed
(
BIOCSSEESENT
)

341 
r
, 
acû±
 = 
_outbound
;

342 ià((
r
 = 
	`ioùl
(
_fd
, 
BIOCSSEESENT
, &
acû±
)) == -1)

343  
”rh
->
	`”rÜ
("%s: BIOCSSEESENT: %s", 
iâame
, 
	`¡»¼Ü
(
”ºo
));

344 ià(
r
 != 0)

345 
”rh
->
	`w¬nšg
("%s: BIOCSSEESENT„‘uº %d", 
iâame
, 
r
);

349 #ià
	`defšed
(
BIOCIMMEDIATE
è&& !defšed(
__sun
)

351 
r
, 
yes
 = 1;

352 ià((
r
 = 
	`ioùl
(
_fd
, 
BIOCIMMEDIATE
, &
yes
)) == -1)

353  
”rh
->
	`”rÜ
("%s: BIOCIMMEDIATE: %s", 
iâame
, 
	`¡»¼Ü
(
”ºo
));

354 ià(
r
 != 0)

355 
”rh
->
	`w¬nšg
("%s: BIOCIMMEDIATE„‘uº %d", 
iâame
, 
r
);

359 ià(
_d©®šk
 == -1) {

360 
_d©®šk
 = 
	`pÿp_d©®šk
(
_pÿp
);

362 ià(
	`pÿp_£t_d©®šk
(
_pÿp
, 
_d©®šk
) == -1)

363  
”rh
->
	`”rÜ
("%s:…ÿp_£t_d©®šk: %s", 
iâame
, 
	`pÿp_g‘”r
(
_pÿp
));

366 
bpf_u_št32
 
Ãtmask
;

367 
bpf_u_št32
 
loÿÊ‘
;

368 
ebuf
[
PCAP_ERRBUF_SIZE
];

369 
ebuf
[0] = 0;

370 ià(
	`pÿp_looku²‘
(
iâame
, &
loÿÊ‘
, &
Ãtmask
, 
ebuf
) < 0 ||ƒbuf[0] != 0)

371 
”rh
->
	`w¬nšg
("%s", 
	`ãtch_pÿp_”rÜ
(0, 
ebuf
));

378 
bpf_´og¿m
 
fcode
;

379 ià(
	`pÿp_compe
(
_pÿp
, &
fcode
, 
_bpf_f‹r
.
	`mubË_c_¡r
(), 0, 
Ãtmask
) < 0)

380  
”rh
->
	`”rÜ
("%s: %s", 
iâame
, 
	`ãtch_pÿp_”rÜ
(
_pÿp
, 0));

381 ià(
	`pÿp_£tf‹r
(
_pÿp
, &
fcode
) < 0)

382  
”rh
->
	`”rÜ
("%s: %s", 
iâame
, 
	`ãtch_pÿp_”rÜ
(
_pÿp
, 0));

384 
_d©®šk
 = 
	`pÿp_d©®šk
(
_pÿp
);

385 ià(
_fÜû_
 && !
	`çke_pÿp_dÉ_fÜû_abË
(
_d©®šk
))

386 
”rh
->
	`w¬nšg
("%s: sŒªgd©¨lšky³ %d, FORCE_IP wÈnÙ wÜk", 
iâame
, 
_d©®šk
);

388 
_m‘hod
 = 
m‘hod_pÿp
;

392 #ià
FROMDEVICE_ALLOW_LINUX


393 ià(
_m‘hod
 =ğ
m‘hod_deçuÉ
 || _m‘hod =ğ
m‘hod_lšux
) {

394 
_fd
 = 
	`İ’_·ck‘_sock‘
(
_iâame
, 
”rh
);

395 ià(
_fd
 < 0)

398 
´omisc_ok
 = 
	`£t_´omiscuous
(
_fd
, 
_iâame
, 
_´omisc
);

399 ià(
´omisc_ok
 < 0) {

400 ià(
_´omisc
)

401 
”rh
->
	`w¬nšg
("cannot set…romiscuous mode");

402 
_was_´omisc
 = -1;

404 
_was_´omisc
 = 
´omisc_ok
;

406 
_d©®šk
 = 
FAKE_DLT_EN10MB
;

407 
_m‘hod
 = 
m‘hod_lšux
;

411 #ià
FROMDEVICE_ALLOW_PCAP
 || 
FROMDEVICE_ALLOW_NETMAP


412 ià(
_m‘hod
 =ğ
m‘hod_pÿp
 || _m‘hod =ğ
m‘hod_Ãtm­
)

413 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
çl£
, 
”rh
);

415 #ià
FROMDEVICE_ALLOW_PCAP
 || 
FROMDEVICE_ALLOW_LINUX
 || 
FROMDEVICE_ALLOW_NETMAP


416 ià(
_fd
 >= 0)

417 
	`add_£Ëù
(
_fd
, 
SELECT_READ
);

420 ià(!
_¢ifãr
)

421 ià(
K”ÃlF‹r
::
	`deviû_f‹r
(
_iâame
, 
Œue
, 
”rh
) < 0)

422 
_¢ifãr
 = 
Œue
;

425 
	}
}

428 
	gFromDeviû
::
	$ş—nup
(
CËªupSge
 
¡age
)

430 ià(
¡age
 >ğ
CLEANUP_INITIALIZED
 && !
_¢ifãr
)

431 
K”ÃlF‹r
::
	`deviû_f‹r
(
_iâame
, 
çl£
, 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

432 #ià
FROMDEVICE_ALLOW_NETMAP


433 ià(
_fd
 >ğ0 && 
_m‘hod
 =ğ
m‘hod_Ãtm­
)

434 
_Ãtm­
.
	`şo£
(
_fd
);

436 #ià
FROMDEVICE_ALLOW_LINUX


437 ià(
_fd
 >ğ0 && 
_m‘hod
 =ğ
m‘hod_lšux
) {

438 ià(
_was_´omisc
 >= 0)

439 
	`£t_´omiscuous
(
_fd
, 
_iâame
, 
_was_´omisc
);

440 
	`şo£
(
_fd
);

443 #ià
FROMDEVICE_ALLOW_PCAP


444 ià(
_pÿp
)

445 
	`pÿp_şo£
(
_pÿp
);

446 
_pÿp
 = 0;

448 #ià
FROMDEVICE_ALLOW_NETMAP
 || 
FROMDEVICE_ALLOW_PCAP
 || 
FROMDEVICE_ALLOW_LINUX


449 
_fd
 = -1;

451 
	}
}

453 #ià
FROMDEVICE_ALLOW_PCAP
 || 
FROMDEVICE_ALLOW_NETMAP


455 
	gFromDeviû
::
	$em™_·ck‘
(
Wr™abËPack‘
 *
p
, 
exŒa_Ën
, cÚ¡ 
Time¡amp
 &
ts
)

458 ià(
p
->
	`d©a
()[0] & 1) {

459 ià(
Eth”Add»ss
::
	`is_brßdÿ¡
(
p
->
	`d©a
()))

460 
p
->
	`£t_·ck‘_ty³_ªno
(
Pack‘
::
BROADCAST
);

462 
p
->
	`£t_·ck‘_ty³_ªno
(
Pack‘
::
MULTICAST
);

466 
p
->
	`£t_time¡amp_ªno
(
ts
);

467 
p
->
	`£t_mac_h—d”
Õ->
	`d©a
());

468 
	`SET_EXTRA_LENGTH_ANNO
(
p
, 
exŒa_Ën
);

470 ià(!
_fÜû_
 || 
	`çke_pÿp_fÜû_
(
p
, 
_d©®šk
))

471 
	`ouut
(0).
	`push
(
p
);

473 
	`checked_ouut_push
(1, 
p
);

474 
	}
}

477 #ià
FROMDEVICE_ALLOW_PCAP
 || 
FROMDEVICE_ALLOW_NETMAP


478 
CLICK_ENDDECLS


481 
FromDeviû_g‘_·ck‘
(
u_ch¬
* 
ş›Ád©a
,

482 cÚ¡ 
pÿp_pkthdr
* 
pkthdr
,

483 cÚ¡ 
u_ch¬
* 
d©a
)

485 
FromDeviû
 *
fd
 = (FromDeviû *è
ş›Ád©a
;

486 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
make
(
fd
->
_h—droom
, 
d©a
, 
pkthdr
->
ÿ¶’
, 0);

487 
Time¡amp
 
ts
 = Time¡amp::
unš™Ÿlized_t
();

488 #ià
TIMESTAMP_NANOSEC
 && 
defšed
(
PCAP_TSTAMP_PRECISION_NANO
)

489 ià(
fd
->
_pÿp_Çno£c
)

490 
ts
 = 
Time¡amp
::
make_n£c
(
pkthdr
->ts.
tv_£c
,…kthdr->ts.
tv_u£c
);

493 
ts
 = 
Time¡amp
::
make_u£c
(
pkthdr
->ts.
tv_£c
,…kthdr->ts.
tv_u£c
);

494 
fd
->
em™_·ck‘
(
p
, 
pkthdr
->
Ën
 -…kthdr->
ÿ¶’
, 
ts
);

497 
CLICK_DECLS


502 
FromDeviû
::
	$£Ëùed
(, )

507 #ià
FROMDEVICE_ALLOW_NETMAP


508 ià(
_m‘hod
 =ğ
m‘hod_Ãtm­
) {

510 
r
 = 
_Ãtm­
.
	`di¥©ch
(
_bur¡
,

511 
»š‹½»t_ÿ¡
<
nm_cb_t
>(
FromDeviû_g‘_·ck‘
), (
u_ch¬
 *è
this
);

512 ià(
r
 > 0) {

513 
_couÁ
 +ğ
r
;

514 
_sk
.
	`»scheduË
();

515 } ià(
r
 < 0 && ++
_pÿp_com¶ašts
 < 5)

516 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
()->
	`”rÜ
("%p{element}: %s",

517 
this
, "nm_dispatch failed");

520 #ià
FROMDEVICE_ALLOW_PCAP


521 ià(
_m‘hod
 =ğ
m‘hod_pÿp
) {

523 
r
 = 
	`pÿp_di¥©ch
(
_pÿp
, 
_bur¡
, 
FromDeviû_g‘_·ck‘
, (
u_ch¬
 *è
this
);

524 ià(
r
 > 0) {

525 
_couÁ
 +ğ
r
;

526 
_sk
.
	`»scheduË
();

527 } ià(
r
 < 0 && ++
_pÿp_com¶ašts
 < 5)

528 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
()->
	`”rÜ
("%p{–em’t}: %s", 
this
, 
	`pÿp_g‘”r
(
_pÿp
));

531 #ià
FROMDEVICE_ALLOW_LINUX


532 
Æšux
 = 0;

533 
_m‘hod
 =ğ
m‘hod_lšux
 && 
Æšux
 < 
_bur¡
) {

534 
sockaddr_Î
 
§
;

535 
sockËn_t
 
äomËn
 = (
§
);

536 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
_h—droom
, 0, 
_¢­Ën
, 0);

537 
Ën
 = 
	`»cväom
(
_fd
, 
p
->
	`d©a
(),…->
	`Ëngth
(), 
MSG_TRUNC
, (
sockaddr
 *)&
§
, &
äomËn
);

538 ià(
Ën
 > 0 && (
§
.
¦l_pk‰y³
 !ğ
PACKET_OUTGOING
 || 
_outbound
)

539 && (
_´ÙocŞ
 =ğ0 || _´ÙocŞ =ğ
§
.
¦l_´ÙocŞ
)) {

540 ià(
Ën
 > 
_¢­Ën
) {

541 
	`as£¹
(
p
->
	`Ëngth
(è=ğ(
ušt32_t
)
_¢­Ën
);

542 
	`SET_EXTRA_LENGTH_ANNO
(
p
, 
Ën
 - 
_¢­Ën
);

544 
p
->
	`ke
(
_¢­Ën
 - 
Ën
);

545 
p
->
	`£t_·ck‘_ty³_ªno
((
Pack‘
::
Pack‘Ty³
)
§
.
¦l_pk‰y³
);

546 
p
->
	`time¡amp_ªno
().
	`£t_timev®_ioùl
(
_fd
, 
SIOCGSTAMP
);

547 
p
->
	`£t_mac_h—d”
Õ->
	`d©a
());

548 ++
Æšux
;

549 ++
_couÁ
;

550 ià(!
_fÜû_
 || 
	`çke_pÿp_fÜû_
(
p
, 
_d©®šk
))

551 
	`ouut
(0).
	`push
(
p
);

553 
	`checked_ouut_push
(1, 
p
);

555 
p
->
	`kl
();

556 ià(
Ën
 <ğ0 && 
”ºo
 !ğ
EAGAIN
)

557 
	`şick_ch©‹r
("FromDeviû(%s):„ecväom: %s", 
_iâame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

562 
	}
}

564 #ià
FROMDEVICE_ALLOW_PCAP
 || 
FROMDEVICE_ALLOW_NETMAP


565 
boŞ


566 
FromDeviû
::
	$run_sk
(
Task
 *)

569 
r
 = 0;

570 #ià
FROMDEVICE_ALLOW_NETMAP


571 ià(
_m‘hod
 =ğ
m‘hod_Ãtm­
) {

573 
r
 = 
_Ãtm­
.
	`di¥©ch
(
_bur¡
,

574 
»š‹½»t_ÿ¡
<
nm_cb_t
>(
FromDeviû_g‘_·ck‘
), (
u_ch¬
 *è
this
);

575 ià(
r
 < 0 && ++
_pÿp_com¶ašts
 < 5)

576 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
()->
	`”rÜ
("%p{element}: %s",

577 
this
, "nm_dispatch failed");

580 #ià
FROMDEVICE_ALLOW_PCAP


581 ià(
_m‘hod
 =ğ
m‘hod_pÿp
) {

582 
r
 = 
	`pÿp_di¥©ch
(
_pÿp
, 
_bur¡
, 
FromDeviû_g‘_·ck‘
, (
u_ch¬
 *è
this
);

583 ià(
r
 < 0 && ++
_pÿp_com¶ašts
 < 5)

584 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
()->
	`”rÜ
("%p{–em’t}: %s", 
this
, 
	`pÿp_g‘”r
(
_pÿp
));

587 ià(
r
 > 0) {

588 
_couÁ
 +ğ
r
;

589 
_sk
.
	`ç¡_»scheduË
();

590  
Œue
;

592  
çl£
;

593 
	}
}

597 
FromDeviû
::
	$k”Ãl_drİs
(
boŞ
& 
known
, & 
max_drİs
) const

599 
known
 = 
çl£
, 
max_drİs
 = -1;

600 #ià
FROMDEVICE_ALLOW_PCAP


601 ià(
_m‘hod
 =ğ
m‘hod_pÿp
) {

602 
pÿp_¡©
 
¡©s
;

603 ià(
	`pÿp_¡©s
(
_pÿp
, &
¡©s
) >= 0)

604 
known
 = 
Œue
, 
max_drİs
 = 
¡©s
.
ps_drİ
;

607 #ià
FROMDEVICE_ALLOW_LINUX
 && 
	`defšed
(
PACKET_STATISTICS
)

608 ià(
_m‘hod
 =ğ
m‘hod_lšux
) {

609 
ack‘_¡©s
 
¡©s
;

610 
sockËn_t
 
¡©size
 = (
¡©s
);

611 ià(
	`g‘sockİt
(
_fd
, 
SOL_PACKET
, 
PACKET_STATISTICS
, &
¡©s
, &
¡©size
) >= 0)

612 
known
 = 
Œue
, 
max_drİs
 = 
¡©s
.
_drİs
;

615 
	}
}

617 
SŒšg


618 
FromDeviû
::
	$»ad_hªdËr
(
EËm’t
* 
e
, *
thunk
)

620 
FromDeviû
* 
fd
 = 
¡©ic_ÿ¡
<FromDeviû*>(
e
);

621 ià(
thunk
 == (*) 0) {

622 
max_drİs
;

623 
boŞ
 
known
;

624 
fd
->
	`k”Ãl_drİs
(
known
, 
max_drİs
);

625 ià(
known
)

626  
	`SŒšg
(
max_drİs
);

627 ià(
max_drİs
 >= 0)

628  "<" + 
	`SŒšg
(
max_drİs
);

631 } ià(
thunk
 == (*) 1)

632  
	`SŒšg
(
	`çke_pÿp_uÅ¬£_dÉ
(
fd
->
_d©®šk
));

634  
	`SŒšg
(
fd
->
_couÁ
);

635 
	}
}

638 
FromDeviû
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

640 
FromDeviû
* 
fd
 = 
¡©ic_ÿ¡
<FromDeviû*>(
e
);

641 
fd
->
_couÁ
 = 0;

643 
	}
}

646 
FromDeviû
::
	$add_hªdËrs
()

648 
	`add_»ad_hªdËr
("k”Ãl_drİs", 
»ad_hªdËr
, 0);

649 
	`add_»ad_hªdËr
("’ÿp", 
»ad_hªdËr
, 1);

650 
	`add_»ad_hªdËr
("couÁ", 
»ad_hªdËr
, 2);

651 
	`add_wr™e_hªdËr
("»£t_couÁs", 
wr™e_hªdËr
, 0, 
HªdËr
::
BUTTON
);

652 
	}
}

654 
CLICK_ENDDECLS


655 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
FakePÿp
 
K”ÃlF‹r
 
N‘m­Info
)

656 
	`EXPORT_ELEMENT
(
FromDeviû
)

	@userlevel/fromdevice.hh

1 #iâdeà
CLICK_FROMDEVICE_USERLEVEL_HH


2 
	#CLICK_FROMDEVICE_USERLEVEL_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~"–em’ts/u£¾ev–/k”Ãlf‹r.hh
"

6 #ifdeà
__lšux__


7 
	#FROMDEVICE_ALLOW_LINUX
 1

	)

10 #ià
HAVE_PCAP


11 
	#FROMDEVICE_ALLOW_PCAP
 1

	)

13 
	~<pÿp.h
>

15 #ià
HAVE_PCAP_SETNONBLOCK
 && !
HAVE_DECL_PCAP_SETNONBLOCK


16 
pÿp_£ŠÚblock
(
pÿp_t
 *
p
, 
nÚblock
, *
”rbuf
);

21 #ià
HAVE_NET_NETMAP_H


22 
	#FROMDEVICE_ALLOW_NETMAP
 1

	)

23 
	~"–em’ts/u£¾ev–/Ãtm­šfo.hh
"

26 #ià
FROMDEVICE_ALLOW_NETMAP
 || 
FROMDEVICE_ALLOW_PCAP


27 
	~<şick/sk.hh
>

29 
FromDeviû_g‘_·ck‘
(
u_ch¬
*, cÚ¡ 
pÿp_pkthdr
*, const u_char*);

33 
CLICK_DECLS


168 şas 
	cFromDeviû
 : 
public
 
EËm’t
 {…ublic:

170 
	$FromDeviû
(è
CLICK_COLD
;

171 ~
	$FromDeviû
(è
CLICK_COLD
;

173 cÚ¡ *
	$şass_Çme
() const {  "FromDevice"; }

174 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "0/1-2"; 
	}
}

175 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

177 ’um { 
deçuÉ_¢­Ën
 = 2046 };

178 
	$cÚfigu»_pha£
(ècÚ¡ {  
K”ÃlF‹r
::
CONFIGURE_PHASE_FROMDEVICE
; 
	}
}

179 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

180 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

181 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

182 
	$add_hªdËrs
(è
CLICK_COLD
;

184 
šlše
 
SŒšg
 
	$iâame
(ècÚ¡ {  
_iâame
; 
	}
}

185 #ià
FROMDEVICE_ALLOW_LINUX
 || 
FROMDEVICE_ALLOW_PCAP
 || 
FROMDEVICE_ALLOW_NETMAP


186 
šlše
 
	$fd
(ècÚ¡ {  
_fd
; 
	}
}

188 
šlše
 
	$fd
(ècÚ¡ {  -1; 
	}
}

191 
£Ëùed
(
fd
, 
mask
);

193 #ià
FROMDEVICE_ALLOW_PCAP


194 
pÿp_t
 *
	$pÿp
(ècÚ¡ {  
_pÿp
; 
	}
}

195 cÚ¡ * 
ãtch_pÿp_”rÜ
(
pÿp_t
* 
pÿp
, cÚ¡ * 
ebuf
);

196 
pÿp_t
 *
İ’_pÿp
(
SŒšg
 
iâame
, 
¢­Ën
, 
boŞ
 
´omisc
, 
E¼ÜHªdËr
 *
”rh
);

199 #ià
FROMDEVICE_ALLOW_LINUX


200 
	$lšux_fd
(ècÚ¡ {  
_m‘hod
 =ğ
m‘hod_lšux
 ? 
_fd
 : -1; 
	}
}

201 
İ’_·ck‘_sock‘
(
SŒšg
, 
E¼ÜHªdËr
 *);

202 
£t_´omiscuous
(, 
SŒšg
, 
boŞ
);

205 #ià
FROMDEVICE_ALLOW_NETMAP


206 cÚ¡ 
N‘m­Info
 *
	$Ãtm­
(ècÚ¡ {  
_m‘hod
 =ğ
m‘hod_Ãtm­
 ? &
_Ãtm­
 : 0; 
	}
}

209 #ià
FROMDEVICE_ALLOW_NETMAP
 || 
FROMDEVICE_ALLOW_PCAP


210 
boŞ
 
run_sk
(
Task
 *
sk
);

213 
	$k”Ãl_drİs
(
boŞ
& 
known
, & 
max_drİs
) const;

215 
´iv©e
:

217 #ià
FROMDEVICE_ALLOW_LINUX
 || 
FROMDEVICE_ALLOW_PCAP
 || 
FROMDEVICE_ALLOW_NETMAP


218 
_fd
;

220 #ià
FROMDEVICE_ALLOW_NETMAP
 || 
FROMDEVICE_ALLOW_PCAP


221 
Task
 
_sk
;

223 #ià
FROMDEVICE_ALLOW_PCAP
 || 
FROMDEVICE_ALLOW_NETMAP


224 
	`em™_·ck‘
(
Wr™abËPack‘
 *
p
, 
exŒa_Ën
, cÚ¡ 
Time¡amp
 &
ts
);

226 #ià
FROMDEVICE_ALLOW_PCAP


227 
pÿp_t
 *
_pÿp
;

228 
_pÿp_com¶ašts
;

230 #ià
FROMDEVICE_ALLOW_NETMAP


231 
N‘m­Info
 
_Ãtm­
;

232 
	`Ãtm­_di¥©ch
();

234 #ià
FROMDEVICE_ALLOW_PCAP
 || 
FROMDEVICE_ALLOW_NETMAP


235 
ä›nd
 
	`FromDeviû_g‘_·ck‘
(
u_ch¬
*, cÚ¡ 
pÿp_pkthdr
*,

236 cÚ¡ 
u_ch¬
*);

239 
boŞ
 
_fÜû_
;

240 #ià
FROMDEVICE_ALLOW_PCAP
 && 
TIMESTAMP_NANOSEC
 && 
	$defšed
(
PCAP_TSTAMP_PRECISION_NANO
)

241 
boŞ
 
_pÿp_Çno£c
;

243 
_bur¡
;

244 
_d©®šk
;

246 #ià
HAVE_INT64_TYPES


247 
ušt64_t
 
	tcouÁ”_t
;

249 
ušt32_t
 
	tcouÁ”_t
;

251 
couÁ”_t
 
_couÁ
;

253 
SŒšg
 
_iâame
;

254 
boŞ
 
_¢ifãr
 : 1;

255 
boŞ
 
_´omisc
 : 1;

256 
boŞ
 
_outbound
 : 1;

257 
boŞ
 
_time¡amp
 : 1;

258 
_was_´omisc
 : 2;

259 
_¢­Ën
;

260 
ušt16_t
 
_´ÙocŞ
;

261 
_h—droom
;

262 ’um { 
m‘hod_deçuÉ
, 
m‘hod_Ãtm­
, 
m‘hod_pÿp
, 
m‘hod_lšux
 
	}
};

263 
_m‘hod
;

264 #ià
FROMDEVICE_ALLOW_PCAP


265 
SŒšg
 
_bpf_f‹r
;

268 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
*, *è
CLICK_COLD
;

269 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*è
CLICK_COLD
;

271 
	}
};

273 
	gCLICK_ENDDECLS


	@userlevel/fromdpdkdevice.cc

20 
	~<şick/cÚfig.h
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

26 
	~"äomdpdkdeviû.hh
"

28 
CLICK_DECLS


30 
	gFromDPDKDeviû
::
	$FromDPDKDeviû
() :

31 
	`_dev
(0), 
	`_queue_id
(0), 
	`_´omisc
(
Œue
), 
	`_bur¡_size
(32),

32 
	`_couÁ
(0), 
	$_sk
(
this
)

34 
	}
}

36 
	gFromDPDKDeviû
::~
	$FromDPDKDeviû
()

38 
	}
}

40 
FromDPDKDeviû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

42 
	gn_desc
 = -1;

43 
SŒšg
 
	gdev
;

44 
boŞ
 
	g®low_nÚexi¡’t
 = 
çl£
;

46 ià(
Args
(
cÚf
, 
this
, 
”rh
)

47 .
»ad_mp
("PORT", 
dev
)

48 .
»ad_p
("QUEUE", 
_queue_id
)

49 .
»ad
("PROMISC", 
_´omisc
)

50 .
»ad
("BURST", 
_bur¡_size
)

51 .
»ad
("NDESC", 
n_desc
)

52 .
»ad
("ALLOW_NONEXISTENT", 
®low_nÚexi¡’t
)

53 .
com¶‘e
() < 0)

56 ià(!
	gDPDKDeviûArg
::
·r£
(
dev
, 
_dev
)) {

57 ià(
	g®low_nÚexi¡’t
)

60  
	g”rh
->
”rÜ
("% : UnknowÀÜ inv®id PORT", 
dev
.
c_¡r
());

63  
	g_dev
->
add_rx_queue
(
_queue_id
, 
_´omisc
, (
n_desc
 > 0è?‚_desø: 256, 
”rh
);

66 
	gFromDPDKDeviû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

68 ià(!
_dev
)

71 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
Œue
, 
”rh
);

73  
DPDKDeviû
::
	`š™Ÿlize
(
”rh
);

74 
	}
}

76 
	gFromDPDKDeviû
::
	$ş—nup
(
CËªupSge
)

78 
	}
}

80 
boŞ
 
FromDPDKDeviû
::
	$run_sk
(
Task
 * 
t
)

82 
¹e_mbuf
 *
pkts
[
_bur¡_size
];

84 
n
 = 
	`¹e_‘h_rx_bur¡
(
_dev
->
pÜt_id
, 
_queue_id
, 
pkts
, 
_bur¡_size
);

85 
i
 = 0; i < 
n
; ++i) {

86 * 
d©a
 = 
	`¹e_pktmbuf_mtod
(
pkts
[
i
], *);

87 
	`¹e_´eãtch0
(
d©a
);

88 
Wr™abËPack‘
 *
p
 =

89 
Pack‘
::
	`make
(
d©a
,

90 
	`¹e_pktmbuf_d©a_Ën
(
pkts
[
i
]), 
DPDKDeviû
::
ä“_pkt
,

91 
pkts
[
i
],

92 
	`¹e_pktmbuf_h—droom
(
pkts
[
i
]),

93 
	`¹e_pktmbuf_room
(
pkts
[
i
]));

94 
p
->
	`£t_·ck‘_ty³_ªno
(
Pack‘
::
HOST
);

95 
p
->
	`£t_mac_h—d”
(
d©a
);

97 
	`ouut
(0).
	`push
(
p
);

99 
_couÁ
 +ğ
n
;

103 
t
->
	`ç¡_»scheduË
();

105  
n
;

106 
	}
}

108 
SŒšg
 
	gFromDPDKDeviû
::
	$couÁ_hªdËr
(
EËm’t
 *
e
, *)

110 
FromDPDKDeviû
 *
âd
 = 
¡©ic_ÿ¡
<FromDPDKDeviû *>(
e
);

111  
	`SŒšg
(
âd
->
_couÁ
);

112 
	}
}

114 
	gFromDPDKDeviû
::
	$»£t_couÁ_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *,

115 
E¼ÜHªdËr
 *)

117 
FromDPDKDeviû
 *
âd
 = 
¡©ic_ÿ¡
<FromDPDKDeviû *>(
e
);

118 
âd
->
_couÁ
 = 0;

120 
	}
}

122 
	gFromDPDKDeviû
::
	$add_hªdËrs
()

124 
	`add_»ad_hªdËr
("couÁ", 
couÁ_hªdËr
, 0);

125 
	`add_wr™e_hªdËr
("»£t_couÁ", 
»£t_couÁ_hªdËr
, 0,

126 
HªdËr
::
BUTTON
);

127 
	}
}

129 
CLICK_ENDDECLS


130 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
dpdk
)

131 
	$EXPORT_ELEMENT
(
FromDPDKDeviû
)

132 
	`ELEMENT_MT_SAFE
(
FromDPDKDeviû
)

	@userlevel/fromdpdkdevice.hh

1 #iâdeà
CLICK_FROMDPDKDEVICE_HH


2 
	#CLICK_FROMDPDKDEVICE_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/nÙif›r.hh
>

6 
	~<şick/sk.hh
>

7 
	~<şick/dpdkdeviû.hh
>

9 
CLICK_DECLS


89 şas 
	cFromDPDKDeviû
 : 
public
 
EËm’t
 {

90 
public
:

92 
	$FromDPDKDeviû
(è
CLICK_COLD
;

93 ~
	$FromDPDKDeviû
(è
CLICK_COLD
;

95 cÚ¡ *
	$şass_Çme
() const {  "FromDPDKDevice"; }

96 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

97 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

98 
	$cÚfigu»_pha£
() const {

99  
CONFIGURE_PHASE_PRIVILEGED
;

100 
	}
}

101 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
çl£
; 
	}
}

103 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

104 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

105 
	$add_hªdËrs
(è
CLICK_COLD
;

106 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

107 
boŞ
 
	`run_sk
(
Task
 *);

109 
´iv©e
:

111 
SŒšg
 
	$couÁ_hªdËr
(
EËm’t
*, *è
CLICK_COLD
;

112 
	$»£t_couÁ_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *,

113 
E¼ÜHªdËr
*è
CLICK_COLD
;

115 
DPDKDeviû
* 
_dev
;

116 
_queue_id
;

117 
boŞ
 
_´omisc
;

118 
_bur¡_size
;

119 
_couÁ
;

121 
Task
 
_sk
;

122 
	}
};

124 
	gCLICK_ENDDECLS


	@userlevel/fromdump.cc

20 
	~<şick/cÚfig.h
>

21 
	~"äomdump.hh
"

22 
	~<şick/¬gs.hh
>

23 
	~<şick/rou‹r.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

26 
	~<şick/”rÜ.hh
>

27 
	~<şick/glue.hh
>

28 
	~<şick/hªdËrÿÎ.hh
>

29 
	~<şick/·ck‘_ªno.hh
>

30 
	~<şick/u£ruts.hh
>

31 #ià
CLICK_NS


32 
	~<şick/ma¡”.hh
>

34 
	~"çk•ÿp.hh
"

35 
	~<uni¡d.h
>

36 
	~<sys/ty³s.h
>

37 
	~<sys/¡©.h
>

38 
	~<fú.h
>

39 #ifdeà
ALLOW_MMAP


40 
	~<sys/mmª.h
>

42 
	gCLICK_DECLS


44 
	#SWAPLONG
(
y
) \

45 ((((
y
)&0xff)<<24è| (((y)&0xff00)<<8è| (((y)&0xff0000)>>8è| (((y)>>24)&0xff))

	)

46 
	#SWAPSHORT
(
y
) \

47 Ğ(((
y
)&0xff)<<8è| ((
u_shÜt
)((y)&0xff00)>>8è)

	)

49 
	gFromDump
::
	$FromDump
()

50 : 
	`_·ck‘
(0), 
	`_’d_h
(0), 
	`_couÁ
(0), 
	`_tim”
(
this
), 
	$_sk
(
this
)

52 
	}
}

54 
	gFromDump
::~
	$FromDump
()

56 
d–‘e
 
_’d_h
;

57 
	}
}

60 
	gFromDump
::
	$ÿ¡
(cÚ¡ *
n
)

62 ià(
	`¡rcmp
(
n
, 
NÙif›r
::
EMPTY_NOTIFIER
è=ğ0 && !
	`ouut_is_push
(0))

63  
¡©ic_ÿ¡
<
NÙif›r
 *>(&
_nÙif›r
);

65  
EËm’t
::
	`ÿ¡
(
n
);

66 
	}
}

68 
SŒšg


69 
	gFromDump
::
	$deş¬©iÚ
() const

71 
SŒšgAccum
 
§
;

72 
§
 << 
	`Çme
(è<< " :: " << 
	`şass_Çme
();

73 ià(
_ff
.
	`š™Ÿlized
())

74 
§
 << '(' << 
_ff
.
	`´št_f’ame
() << ')';

75  
§
.
	`ke_¡ršg
();

76 
	}
}

79 
	gFromDump
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

81 
boŞ
 
	gtimšg
 = 
çl£
, 
	g¡İ
 = f®£, 
	gaùive
 = 
Œue
, 
	gfÜû_
 = false;

82 
Time¡amp
 
	gfœ¡_time
, 
	gfœ¡_time_off
, 
	gÏ¡_time
, 
	gÏ¡_time_off
, 
	gš‹rv®
;

83 
HªdËrC®l
 
	g’d_h
;

84 
	g_§m¶šg_´ob
 = (1 << 
SAMPLING_SHIFT
);

85 #ià
CLICK_NS


86 
boŞ
 
	g³r_node
 = 
çl£
;

88 
	g_·ck‘_f•os
 = 0;

90 ià(
	g_ff
.
cÚfigu»_keywÜds
(
cÚf
, 
this
, 
”rh
) < 0)

92 ià(
Args
(
cÚf
, 
this
, 
”rh
)

93 .
»ad_mp
("FILENAME", 
F’ameArg
(), 
_ff
.
f’ame
())

94 .
»ad_p
("TIMING", 
timšg
)

95 .
»ad
("STOP", 
¡İ
)

96 .
»ad
("ACTIVE", 
aùive
)

97 .
»ad
("SAMPLE", 
FixedPoštArg
(
SAMPLING_SHIFT
), 
_§m¶šg_´ob
)

98 .
»ad
("FORCE_IP", 
fÜû_
)

99 .
»ad
("START", 
fœ¡_time
)

100 .
»ad
("START_AFTER", 
fœ¡_time_off
)

101 .
»ad
("END", 
Ï¡_time
)

102 .
»ad
("END_AFTER", 
Ï¡_time_off
)

103 .
»ad
("INTERVAL", 
š‹rv®
)

104 .
»ad
("END_CALL", 
HªdËrC®lArg
(
HªdËrC®l
::
wr™abË
), 
’d_h
)

105 #ià
CLICK_NS


106 .
»ad
("PER_NODE", 
³r_node
)

108 .
»ad
("FILEPOS", 
_·ck‘_f•os
)

109 .
com¶‘e
() < 0)

113 ià(
	g_§m¶šg_´ob
 > (1 << 
	gSAMPLING_SHIFT
)) {

114 
	g”rh
->
w¬nšg
("SAMPLE…robability„educedo 1");

115 
	g_§m¶šg_´ob
 = (1 << 
SAMPLING_SHIFT
);

116 } ià(
	g_§m¶šg_´ob
 == 0)

117 
”rh
->
w¬nšg
("SAMPLE…robability is 0;ƒmitting‚o…ackets");

120 
	g_have_fœ¡_time
 = 
_have_Ï¡_time
 = 
Œue
;

121 
	g_fœ¡_time_»Ïtive
 = 
_Ï¡_time_»Ïtive
 = 
_Ï¡_time_š‹rv®
 = 
çl£
;

123 ià((
	gboŞ
è
	gfœ¡_time
 + (boŞè
	gfœ¡_time_off
 > 1)

124  
	g”rh
->
”rÜ
("START‡nd START_AFTER‡re mutuallyƒxclusive");

125 ià(
	gfœ¡_time
)

126 
	g_fœ¡_time
 = 
fœ¡_time
;

127 ià(
	gfœ¡_time_off
)

128 
	g_fœ¡_time
 = 
fœ¡_time_off
, 
	g_fœ¡_time_»Ïtive
 = 
Œue
;

130 
	g_have_fœ¡_time
 = 
çl£
, 
	g_fœ¡_time_»Ïtive
 = 
Œue
;

132 ià((
	gboŞ
è
	gÏ¡_time
 + (boŞè
	gÏ¡_time_off
 + (boŞè
	gš‹rv®
 > 1)

133  
	g”rh
->
”rÜ
("END, END_AFTER,‡nd INTERVAL‡re mutuallyƒxclusive");

134 ià(
	gÏ¡_time
)

135 
	g_Ï¡_time
 = 
Ï¡_time
;

136 ià(
	gÏ¡_time_off
)

137 
	g_Ï¡_time
 = 
Ï¡_time_off
, 
	g_Ï¡_time_»Ïtive
 = 
Œue
;

138 ià(
	gš‹rv®
)

139 
	g_Ï¡_time
 = 
š‹rv®
, 
	g_Ï¡_time_š‹rv®
 = 
Œue
;

141 
	g_have_Ï¡_time
 = 
çl£
;

143 ià(
	g¡İ
 && 
	g’d_h
)

144  
	g”rh
->
”rÜ
("END_CALL‡nd STOP‡re mutuallyƒxclusive");

145 ià(
	g’d_h
)

146 
	g_’d_h
 = 
Ãw
 
HªdËrC®l
(
’d_h
);

147 ià(
	g¡İ
)

148 
	g_’d_h
 = 
Ãw
 
HªdËrC®l
(
Çme
() + ".stop");

149 ià(
	g_have_Ï¡_time
)

150 
	g_’d_h
 = 
Ãw
 
HªdËrC®l
(
Çme
() + ".active false");

153 
	g_have_ªy_times
 = 
çl£
;

154 
	g_timšg
 = 
timšg
;

155 
	g_fÜû_
 = 
fÜû_
;

157 #ià
CLICK_NS


158 ià(
	g³r_node
) {

159 
	gtmp
[255];

160 
	gr
 = 
simşick_sim_commªd
(
rou‹r
()->
simnode
(), 
SIMCLICK_GET_NODE_NAME
, 
tmp
,255);

161 ià(
	gr
 >= 0)

162 
_ff
.
f’ame
(èğ
SŒšg
(
tmp
) + String("_") + _ff.filename();

166 
	g_aùive
 = 
aùive
;

171 
	$sw­_fe_h—d”
(cÚ¡ 
çke_pÿp_fe_h—d”
 *
hp
, fake_pÿp_fe_h—d” *
ou
)

173 
ou
->
magic
 = 
	`SWAPLONG
(
hp
->magic);

174 
ou
->
v”siÚ_majÜ
 = 
	`SWAPSHORT
(
hp
->version_major);

175 
ou
->
v”siÚ_mšÜ
 = 
	`SWAPSHORT
(
hp
->version_minor);

176 
ou
->
thiszÚe
 = 
	`SWAPLONG
(
hp
->thiszone);

177 
ou
->
sigfigs
 = 
	`SWAPLONG
(
hp
->sigfigs);

178 
ou
->
¢­Ën
 = 
	`SWAPLONG
(
hp
->snaplen);

179 
ou
->
lškty³
 = 
	`SWAPLONG
(
hp
->linktype);

180 
	}
}

183 
	$sw­_·ck‘_h—d”
(cÚ¡ 
çke_pÿp_pkthdr
 *
hp
, fake_pÿp_pkthd¸*
ou
)

185 
ou
->
ts
.
tv
.
tv_£c
 = 
	`SWAPLONG
(
hp
->ts.tv.tv_sec);

186 
ou
->
ts
.
tv
.
tv_u£c
 = 
	`SWAPLONG
(
hp
->ts.tv.tv_usec);

187 
ou
->
ÿ¶’
 = 
	`SWAPLONG
(
hp
->caplen);

188 
ou
->
Ën
 = 
	`SWAPLONG
(
hp
->len);

189 
	}
}

191 
FromDump
 *

192 
	gFromDump
::
	$hÙsw­_–em’t
() const

194 ià(
EËm’t
 *
e
 = EËm’t::
	`hÙsw­_–em’t
())

195 ià(
FromDump
 *
fd
 = 
¡©ic_ÿ¡
<FromDum°*>(
e
->
	`ÿ¡
("FromDump")))

196 ià(
fd
->
_ff
.
	`f’ame
() == _ff.filename())

197  
fd
;

199 
	}
}

202 
	gFromDump
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

205 ià(!
	`ouut_is_push
(0))

206 
_nÙif›r
.
	`š™Ÿlize
(
NÙif›r
::
EMPTY_NOTIFIER
, 
	`rou‹r
());

209 ià(
_’d_h
 && _’d_h->
	`š™Ÿlize_wr™e
(
this
, 
”rh
) < 0)

211 ià(
	`ouut_is_push
(0))

212 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
_aùive
, 
”rh
);

213 
_tim”
.
	`š™Ÿlize
(
this
);

216 ià(
	`hÙsw­_–em’t
())

220 ià(
_ff
.
	`š™Ÿlize
(
”rh
) < 0)

224 
çke_pÿp_fe_h—d”
 
sw­³d_fh
;

225 cÚ¡ 
çke_pÿp_fe_h—d”
 *
fh
 = (cÚ¡ fake_pÿp_fe_h—d” *)
_ff
.
	`g‘_®igÃd
((çke_pÿp_fe_h—d”), &
sw­³d_fh
);

226 ià(!
fh
)

227  
_ff
.
	`”rÜ
(
”rh
, "not‡cpdump file (too short)");

229 ià(
fh
->
magic
 =ğ
FAKE_PCAP_MAGIC
 || fh->magiø=ğ
FAKE_PCAP_MAGIC_NANO
 || fh->magiø=ğ
FAKE_MODIFIED_PCAP_MAGIC
)

230 
_sw­³d
 = 
çl£
;

232 
	`sw­_fe_h—d”
(
fh
, &
sw­³d_fh
);

233 
_sw­³d
 = 
Œue
;

234 
fh
 = &
sw­³d_fh
;

236 ià(
fh
->
magic
 !ğ
FAKE_PCAP_MAGIC
 && fh->magiø!ğ
FAKE_PCAP_MAGIC_NANO
 && fh->magiø!ğ
FAKE_MODIFIED_PCAP_MAGIC
)

237  
_ff
.
	`”rÜ
(
”rh
, "not‡cpdump file (bad magic‚umber)");

239 ià(
fh
->
magic
 =ğ
FAKE_PCAP_MAGIC
 || fh->magiø=ğ
FAKE_PCAP_MAGIC_NANO
)

240 
_exŒa_pkthdr_ü­
 = 0;

242 
_exŒa_pkthdr_ü­
 = (
çke_modif›d_pÿp_pkthdr
è- (
çke_pÿp_pkthdr
);

243 
_have_Çno£cÚd_time¡amps
 = 
fh
->
magic
 =ğ
FAKE_PCAP_MAGIC_NANO
;

245 ià(
fh
->
v”siÚ_majÜ
 !ğ
FAKE_PCAP_VERSION_MAJOR
)

246  
_ff
.
	`”rÜ
(
”rh
, "unknowÀmajÜ v”siÚ %d", 
fh
->
v”siÚ_majÜ
);

247 
_mšÜ_v”siÚ
 = 
fh
->
v”siÚ_mšÜ
;

249 
_lškty³
 = 
	`çke_pÿp_ÿnÚiÿl_dÉ
(
fh
->
lškty³
, 
Œue
);

252 ià(
_fÜû_
) {

253 ià(!
	`çke_pÿp_dÉ_fÜû_abË
(
_lškty³
))

254  
_ff
.
	`”rÜ
(
”rh
, "unknowÀlškty³ %d; cª'ˆfÜû IP…ack‘s", 
_lškty³
);

255 } ià(
_lškty³
 =ğ
FAKE_DLT_RAW
)

257 
_fÜû_
 = 
Œue
;

260 ià(
_·ck‘_f•os
 != 0) {

261 
»suÉ
 = 
_ff
.
	`£ek
(
_·ck‘_f•os
, 
”rh
);

262 
_·ck‘_f•os
 = 0;

263  
»suÉ
;

266 
	}
}

269 
	gFromDump
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *
”rh
)

271 
FromDump
 *
o
 = 
¡©ic_ÿ¡
<FromDum°*>(
e
);

273 
_ff
.
	`ke_¡©e
(
o
->_ff, 
”rh
);

275 
_·ck‘
 = 
o
->_packet;

276 
o
->
_·ck‘
 = 0;

278 
_sw­³d
 = 
o
->_swapped;

279 
_exŒa_pkthdr_ü­
 = 
o
->_extra_pkthdr_crap;

280 
_mšÜ_v”siÚ
 = 
o
->_minor_version;

282 
_lškty³
 = 
o
->_linktype;

283 ià(
_lškty³
 =ğ
FAKE_DLT_RAW
)

284 
_fÜû_
 = 
Œue
;

285 ià(
_fÜû_
 && !
	`çke_pÿp_dÉ_fÜû_abË
(
_lškty³
))

286 
_ff
.
	`w¬nšg
(
”rh
, "unknowÀlškty³ %d; cª'ˆfÜû IP…ack‘s", 
_lškty³
);

288 
_timšg_off£t
 = 
o
->_timing_offset;

289 
_·ck‘_f•os
 = 
o
->_packet_filepos;

290 
	}
}

293 
	gFromDump
::
	$ş—nup
(
CËªupSge
)

295 
_ff
.
	`ş—nup
();

296 ià(
_·ck‘
)

297 
_·ck‘
->
	`kl
();

298 
_·ck‘
 = 0;

299 
	}
}

302 
	gFromDump
::
	$£t_aùive
(
boŞ
 
aùive
)

304 
_aùive
 = 
aùive
;

305 ià(
aùive
) {

306 ià(
	`ouut_is_push
(0è&& !
_sk
.
	`scheduËd
())

307 
_sk
.
	`»scheduË
();

308 ià(!
	`ouut_is_push
(0))

309 
_nÙif›r
.
	`wake
();

311 
	}
}

314 
	gFromDump
::
	$´•¬e_times
(cÚ¡ 
Time¡amp
 &
ts
)

316 ià(
_fœ¡_time_»Ïtive
)

317 
_fœ¡_time
 +ğ
ts
;

318 ià(
_Ï¡_time_»Ïtive
)

319 
_Ï¡_time
 +ğ
ts
;

320 ià(
_Ï¡_time_š‹rv®
)

321 
_Ï¡_time
 +ğ
_fœ¡_time
;

322 ià(
_timšg
)

323 
_timšg_off£t
 = 
Time¡amp
::
	`now_¡—dy
(è- 
ts
;

324 
_have_ªy_times
 = 
Œue
;

325 
	}
}

327 
boŞ


328 
	gFromDump
::
	$»ad_·ck‘
(
E¼ÜHªdËr
 *
”rh
)

330 
çke_pÿp_pkthdr
 
sw­³d_ph
;

331 cÚ¡ 
çke_pÿp_pkthdr
 *
ph
;

332 
Time¡amp
 
ts
 = Time¡amp::
	`unš™Ÿlized_t
();

333 
Ën
, 
ÿ¶’
, 
skËn
 = 0;

334 
Pack‘
 *
p
;

335 
	`as£¹
(!
_·ck‘
);

338 
_·ck‘_f•os
 = 
_ff
.
	`fe_pos
();

341 ià(!(
ph
 = 
»š‹½»t_ÿ¡
<cÚ¡ 
çke_pÿp_pkthdr
 *>(
_ff
.
	`g‘_®igÃd
((*ph), &
sw­³d_ph
))))

342  
çl£
;

343 ià(
_sw­³d
) {

344 
	`sw­_·ck‘_h—d”
(
ph
, &
sw­³d_ph
);

345 
ph
 = &
sw­³d_ph
;

349 ià(
_mšÜ_v”siÚ
 > 3 || (_mšÜ_v”siÚ =ğ3 && 
ph
->
ÿ¶’
 <ğph->
Ën
)) {

350 
Ën
 = 
ph
->len;

351 
ÿ¶’
 = 
ph
->caplen;

353 
Ën
 = 
ph
->
ÿ¶’
;

354 
ÿ¶’
 = 
ph
->
Ën
;

362 ià(
ÿ¶’
 > 65535) {

363 
_ff
.
	`”rÜ
(
”rh
, "bad…acket header; giving up");

364  
çl£
;

365 } ià(
ÿ¶’
 > 
Ën
) {

366 
skËn
 = 
ÿ¶’
 - 
Ën
;

367 
ÿ¶’
 = 
Ën
;

371 
_ff
.
	`shiá_pos
(
_exŒa_pkthdr_ü­
);

374 
check_times
:

375 
ts
 = 
çke_bpf_timev®_uniÚ
::
	`make_time¡amp
(&
ph
->ts, 
_have_Çno£cÚd_time¡amps
);

376 ià(!
_have_ªy_times
)

377 
	`´•¬e_times
(
ts
);

378 ià(
_have_fœ¡_time
) {

379 ià(
ts
 < 
_fœ¡_time
) {

380 
_ff
.
	`shiá_pos
(
ÿ¶’
 + 
skËn
);

381  
Œue
;

383 
_have_fœ¡_time
 = 
çl£
;

385 ià(
_have_Ï¡_time
 && 
ts
 >ğ
_Ï¡_time
) {

386 
_have_Ï¡_time
 = 
çl£
;

387 (è
_’d_h
->
	`ÿÎ_wr™e
(
”rh
);

388 ià(!
_aùive
) {

389 
_ff
.
	`shiá_pos
(
ÿ¶’
 + 
skËn
);

390  
çl£
;

393 
check_times
;

397 ià(
_§m¶šg_´ob
 < (1 << 
SAMPLING_SHIFT
)

398 && (
	`şick_¿ndom
(è& ((1<<
SAMPLING_SHIFT
)-1)è>ğ
_§m¶šg_´ob
) {

399 
_ff
.
	`shiá_pos
(
ÿ¶’
 + 
skËn
);

400  
Œue
;

404 
p
 = 
_ff
.
	`g‘_·ck‘
(
ÿ¶’
, 
ts
.
	`£c
(),s.
	`sub£c
(), 
”rh
);

405 ià(!
p
)

406  
çl£
;

407 
	`SET_EXTRA_LENGTH_ANNO
(
p
, 
Ën
 - 
ÿ¶’
);

408 
_ff
.
	`shiá_pos
(
skËn
);

410 
p
->
	`£t_mac_h—d”
Õ->
	`d©a
());

411 
_·ck‘
 = 
p
;

412  
Œue
;

413 
	}
}

415 
boŞ


416 
	gFromDump
::
	$check_timšg
(
Pack‘
 *
p
)

418 
Time¡amp
 
now_s
 = Time¡amp::
	`now_¡—dy
();

419 
Time¡amp
 
t
 = 
p
->
	`time¡amp_ªno
(è+ 
_timšg_off£t
;

420 ià(
now_s
 < 
t
) {

421 
t
 -ğ
Tim”
::
	`adju¡m’t
();

422 ià(
now_s
 < 
t
) {

423 
_tim”
.
	`scheduË_©_¡—dy
(
t
);

424 ià(
	`ouut_is_puÎ
(0))

425 
_nÙif›r
.
	`¦“p
();

427 ià(
	`ouut_is_push
(0))

428 
_sk
.
	`ç¡_»scheduË
();

430  
çl£
;

432  
Œue
;

433 
	}
}

436 
	gFromDump
::
	$run_tim”
(
Tim”
 *)

438 ià(
_aùive
) {

439 ià(
	`ouut_is_push
(0))

440 
_sk
.
	`»scheduË
();

442 
_nÙif›r
.
	`wake
();

444 
	}
}

446 
boŞ


447 
	gFromDump
::
	$run_sk
(
Task
 *)

449 ià(!
_aùive
)

450  
çl£
;

452 
»Œy_couÁ
 = 0;

453 
agaš
:

454 ià(!
_·ck‘
 && !
	`»ad_·ck‘
(0)) {

455 ià(
_’d_h
)

456 
_’d_h
->
	`ÿÎ_wr™e
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

457  
çl£
;

459 ià(
_·ck‘
 && 
_timšg
 && !
	`check_timšg
(_packet))

460  
çl£
;

461 ià(
_·ck‘
 && 
_fÜû_
 && !
	`çke_pÿp_fÜû_
(_·ck‘, 
_lškty³
)) {

462 
	`checked_ouut_push
(1, 
_·ck‘
);

463 
_·ck‘
 = 0;

465 ià(!
_·ck‘
 && ++
»Œy_couÁ
 < 16)

466 
agaš
;

468 
_sk
.
	`ç¡_»scheduË
();

469 ià(
_·ck‘
) {

470 
	`ouut
(0).
	`push
(
_·ck‘
);

471 
_couÁ
++;

472 
_·ck‘
 = 0;

473  
Œue
;

475  
çl£
;

476 
	}
}

478 
Pack‘
 *

479 
	gFromDump
::
	$puÎ
()

481 ià(!
_aùive
) {

482 
_nÙif›r
.
	`¦“p
();

486 
boŞ
 
mÜe
 = 
Œue
;

487 ià(!
_·ck‘
)

488 
mÜe
 = 
	`»ad_·ck‘
(0);

489 ià(
_·ck‘
 && 
_timšg
 && !
	`check_timšg
(_packet))

491 ià(
_·ck‘
 && 
_fÜû_
 && !
	`çke_pÿp_fÜû_
(_·ck‘, 
_lškty³
)) {

492 
	`checked_ouut_push
(1, 
_·ck‘
);

493 
_·ck‘
 = 0;

497 
_nÙif›r
.
	`£t_aùive
(
mÜe
, 
Œue
);

498 ià(!
mÜe
 && 
_’d_h
)

499 
_’d_h
->
	`ÿÎ_wr™e
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

501 ià(
Pack‘
 *
p
 = 
_·ck‘
) {

502 
_couÁ
++;

503 
_·ck‘
 = 0;

504  
p
;

507 
	}
}

510 
	mH_SAMPLING_PROB
, 
	mH_ACTIVE
, 
	mH_ENCAP
, 
	mH_STOP
, 
	mH_PACKET_FILEPOS
,

511 
	mH_EXTEND_INTERVAL
, 
	mH_COUNT
, 
	mH_RESET_COUNTS
, 
	mH_RESET_TIMING


514 
SŒšg


515 
	gFromDump
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

517 
FromDump
 *
fd
 = 
¡©ic_ÿ¡
<FromDum°*>(
e
);

518 (
šŒ_t
)
thunk
) {

519 
H_SAMPLING_PROB
:

520  
	`ı_uÅ¬£_»®2
(
fd
->
_§m¶šg_´ob
, 
SAMPLING_SHIFT
);

521 
H_ENCAP
:

522  
	`SŒšg
(
	`çke_pÿp_uÅ¬£_dÉ
(
fd
->
_lškty³
));

526 
	}
}

529 
	gFromDump
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s_š
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

531 
FromDump
 *
fd
 = 
¡©ic_ÿ¡
<FromDum°*>(
e
);

532 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
s_š
);

533 (
šŒ_t
)
thunk
) {

534 
H_ACTIVE
: {

535 
boŞ
 
aùive
;

536 ià(
	`BoŞArg
().
	`·r£
(
s
, 
aùive
)) {

537 
fd
->
	`£t_aùive
(
aùive
);

540  
”rh
->
	`”rÜ
("type mismatch");

542 
H_STOP
:

543 
fd
->
	`£t_aùive
(
çl£
);

544 
fd
->
	`rou‹r
()->
	`¶—£_¡İ_driv”
();

546 
H_EXTEND_INTERVAL
: {

547 
Time¡amp
 
ts
;

548 ià(
	`ı_time
(
s
, &
ts
)) {

549 
fd
->
_Ï¡_time
 +ğ
ts
;

550 ià(
fd
->
_’d_h
)

551 
fd
->
_have_Ï¡_time
 = 
Œue
, fd->
	`£t_aùive
(true);

554  
”rh
->
	`”rÜ
("'extend_interval'akes‡ime interval");

556 
H_RESET_COUNTS
:

557 
fd
->
_couÁ
 = 0;

559 
H_RESET_TIMING
:

560 
fd
->
_fœ¡_time_»Ïtive
 = 
çl£
;

561 
fd
->
_Ï¡_time_»Ïtive
 = fd->
_Ï¡_time_š‹rv®
 = 
çl£
;

562 
fd
->
_have_ªy_times
 = 
çl£
;

565  -
EINVAL
;

567 
	}
}

570 
	gFromDump
::
	$add_hªdËrs
()

572 
_ff
.
	`add_hªdËrs
(
this
, 
Œue
);

573 
	`add_»ad_hªdËr
("§m¶šg_´ob", 
»ad_hªdËr
, 
H_SAMPLING_PROB
);

574 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
OP_READ
 | HªdËr::
CHECKBOX
, &
_aùive
);

575 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 
H_ACTIVE
);

576 
	`add_»ad_hªdËr
("’ÿp", 
»ad_hªdËr
, 
H_ENCAP
);

577 
	`add_wr™e_hªdËr
("¡İ", 
wr™e_hªdËr
, 
H_STOP
, 
HªdËr
::
BUTTON
);

578 
	`add_d©a_hªdËrs
("·ck‘_f•os", 
HªdËr
::
OP_READ
, &
_·ck‘_f•os
);

579 
	`add_wr™e_hªdËr
("ex‹nd_š‹rv®", 
wr™e_hªdËr
, 
H_EXTEND_INTERVAL
);

580 
	`add_d©a_hªdËrs
("couÁ", 
HªdËr
::
OP_READ
, &
_couÁ
);

581 
	`add_wr™e_hªdËr
("»£t_couÁs", 
wr™e_hªdËr
, 
H_RESET_COUNTS
, 
HªdËr
::
BUTTON
);

582 
	`add_wr™e_hªdËr
("»£t_timšg", 
wr™e_hªdËr
, 
H_RESET_TIMING
, 
HªdËr
::
BUTTON
);

583 ià(
	`ouut_is_push
(0))

584 
	`add_sk_hªdËrs
(&
_sk
);

585 
	}
}

587 
CLICK_ENDDECLS


588 
ELEMENT_REQUIRES
(
u£¾ev–
|
ns
 
FakePÿp
)

589 
EXPORT_ELEMENT
(
FromDump
)

	@userlevel/fromdump.hh

2 #iâdeà
CLICK_FROMDUMP_HH


3 
	#CLICK_FROMDUMP_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şick/tim”.hh
>

7 
	~<şick/nÙif›r.hh
>

8 
	~<şick/äomfe.hh
>

9 
CLICK_DECLS


10 
şass
 
	gHªdËrC®l
;

189 şas 
	cFromDump
 : 
public
 
EËm’t
 {…ublic:

191 
	$FromDump
(è
CLICK_COLD
;

192 ~
	$FromDump
(è
CLICK_COLD
;

194 cÚ¡ *
	$şass_Çme
() const {  "FromDump"; }

195 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "0/1-2"; 
	}
}

196 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

197 *
ÿ¡
(const *);

198 
SŒšg
 
	$deş¬©iÚ
() const;

200 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

201 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

202 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

203 
	$add_hªdËrs
(è
CLICK_COLD
;

204 
FromDump
 *
	$hÙsw­_–em’t
() const;

205 
	`ke_¡©e
(
EËm’t
 *, 
E¼ÜHªdËr
 *);

207 
	`run_tim”
(
Tim”
 *);

208 
boŞ
 
	`run_sk
(
Task
 *);

209 
Pack‘
 *
	`puÎ
();

211 
	`£t_aùive
(
boŞ
);

213 
´iv©e
:

215 ’um { 
BUFFER_SIZE
 = 32768, 
SAMPLING_SHIFT
 = 28 
	}
};

217 
FromFe
 
	g_ff
;

219 
Pack‘
 *
	g_·ck‘
;

221 
boŞ
 
	g_sw­³d
 : 1;

222 
boŞ
 
	g_timšg
 : 1;

223 
boŞ
 
	g_fÜû_
 : 1;

224 
boŞ
 
	g_have_fœ¡_time
 : 1;

225 
boŞ
 
	g_have_Ï¡_time
 : 1;

226 
boŞ
 
	g_have_ªy_times
 : 1;

227 
boŞ
 
	g_fœ¡_time_»Ïtive
 : 1;

228 
boŞ
 
	g_Ï¡_time_»Ïtive
 : 1;

229 
boŞ
 
	g_Ï¡_time_š‹rv®
 : 1;

230 
boŞ
 
	g_have_Çno£cÚd_time¡amps
 : 1;

231 
boŞ
 
	g_aùive
;

232 
	g_exŒa_pkthdr_ü­
;

233 
	g_§m¶šg_´ob
;

234 
	g_mšÜ_v”siÚ
;

235 
	g_lškty³
;

237 
Time¡amp
 
	g_fœ¡_time
;

238 
Time¡amp
 
	g_Ï¡_time
;

239 
HªdËrC®l
 *
	g_’d_h
;

241 #ià
HAVE_INT64_TYPES


242 
ušt64_t
 
	tcouÁ”_t
;

244 
ušt32_t
 
	tcouÁ”_t
;

246 
couÁ”_t
 
	g_couÁ
;

248 
Tim”
 
	g_tim”
;

249 
Task
 
	g_sk
;

250 
AùiveNÙif›r
 
	g_nÙif›r
;

252 
Time¡amp
 
	g_timšg_off£t
;

253 
off_t
 
	g_·ck‘_f•os
;

255 
boŞ
 
»ad_·ck‘
(
E¼ÜHªdËr
 *);

257 
´•¬e_times
(cÚ¡ 
Time¡amp
 &);

258 
boŞ
 
check_timšg
(
Pack‘
 *
p
);

260 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

261 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

263 
	}
};

265 
	gCLICK_ENDDECLS


	@userlevel/fromhost.cc

20 
	~<şick/cÚfig.h
>

21 
	~"äomho¡.hh
"

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/b™veùÜ.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/glue.hh
>

27 
	~<şickÃt/‘h”.h
>

28 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

29 
	~<uni¡d.h
>

30 
	~<fú.h
>

31 
	~<sys/ioùl.h
>

32 
	~<¬·/š‘.h
>

34 
	~<Ãt/if.h
>

35 
	~<lšux/if_tun.h
>

37 #ifdeà
HAVE_PROPER


38 
	~<´İ”/´İ.h
>

40 
CLICK_DECLS


42 
	gFromHo¡
::
	$FromHo¡
()

43 : 
	`_fd
(-1), 
	$_sk
(
this
)

45 #ià
HAVE_IP6


46 
_´efix6
 = 0;

48 
	}
}

50 
	gFromHo¡
::~
	$FromHo¡
()

52 
	}
}

55 
FromHo¡
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

57 
	g_h—droom
 = 
Pack‘
::
deçuÉ_h—droom
;

58 
	g_h—droom
 +ğ(4 - (
_h—droom
 + 2) % 4) % 4;

59 
	g_mtu_out
 = 
DEFAULT_MTU
;

61 ià(
Args
(
cÚf
, 
this
, 
”rh
)

62 .
»ad_mp
("DEVNAME", 
_dev_Çme
)

63 .
»ad_p
("DST", 
IPP»fixArg
(), 
_Ã¬
, 
_mask
)

64 .
»ad
("GATEWAY", 
_gw
)

65 #ià
HAVE_IP6
 && 0

67 "DST6", 0, 
	gıIP6P»fixL’
, &
	g_Ã¬6
, &
	g_´efix6
,

69 .
»ad
("ETHER", 
_maÿddr
)

70 .
»ad
("HEADROOM", 
_h—droom
)

71 .
»ad
("MTU", 
_mtu_out
)

72 .
com¶‘e
() < 0)

75 ià(
	g_Ã¬
 && 
	g_gw
 && !_gw.
m©ches_´efix
(
_Ã¬
, 
_mask
))

76  
	g”rh
->
”rÜ
("bad GATEWAY");

77 ià(!
	g_dev_Çme
)

78  
	g”rh
->
”rÜ
("must specify device‚ame");

79 ià(
	g_h—droom
 > 8192)

80  
	g”rh
->
”rÜ
("HEADROOMoo†arge");

85 
	gFromHo¡
::
	$Œy_lšux_univ”§l
(
E¼ÜHªdËr
 *
”rh
)

87 
fd
;

88 #ifdeà
HAVE_PROPER


89 
fd
 = 
	`´İ_İ’
("/dev/Ãt/tun", 
O_RDWR
);

90 ià(
fd
 >= 0) {

91 ià(
	`fú
(
fd
, 
F_SETFL
, 
O_NONBLOCK
) < 0) {

92 
e
 = 
”ºo
;

93 
”rh
->
	`”rÜ
("fú /dev/Ãt/tun: %s", 
	`¡»¼Ü
(
e
));

94 
	`şo£
(
fd
);

95  -
e
;

98 
”rh
->
	`w¬nšg
("´İ_İ’ /dev/Ãt/tun: %s", 
	`¡»¼Ü
(
”ºo
));

99 ià(
fd
 < 0)

101 
fd
 = 
	`İ’
("/dev/Ãt/tun", 
O_RDWR
 | 
O_NONBLOCK
);

102 ià(
fd
 < 0) {

103 
e
 = 
”ºo
;

104 
”rh
->
	`”rÜ
("İ’ /dev/Ãt/tun: %s", 
	`¡»¼Ü
(
e
));

105  -
e
;

108 
iäeq
 
iä
;

109 
	`mem£t
(&
iä
, 0, (ifr));

111 
iä
.
iä_æags
 = 
IFF_TAP
;

117 
	`¡rıy
(
iä
.
iä_Çme
, 
_dev_Çme
.
	`c_¡r
());

119 
”r
 = 
	`ioùl
(
fd
, 
TUNSETIFF
, (*)&
iä
);

120 ià(
”r
 < 0) {

121 
”rh
->
	`w¬nšg
("Linux universalun failed for %s: %s",

122 
_dev_Çme
.
	`c_¡r
(),

123 
	`¡»¼Ü
(
”ºo
));

124 
	`şo£
(
fd
);

125  -
”ºo
;

128 
_dev_Çme
 = 
iä
.
iä_Çme
;

129 
_fd
 = 
fd
;

131 
	}
}

134 
	gFromHo¡
::
	$£tup_tun
(
E¼ÜHªdËr
 *
”rh
)

136 
SŒšgAccum
 
§
;

137 cÚ¡ *
up
 = " up";

139 ià(
_maÿddr
) {

140 
§
.
	`ş—r
();

141 
§
 << "/sbš/ifcÚfig " << 
_dev_Çme
 << " hwƒth” " << 
_maÿddr
.
	`uÅ¬£_cŞÚ
();

142 ià(
	`sy¡em
(
§
.
	`c_¡r
()) != 0)

143 
”rh
->
	`”rÜ
("%s: %s", 
§
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

145 
§
.
	`ş—r
();

146 
§
 << "/sbš/ifcÚfig " << 
_dev_Çme
 << "‡rp";

147 ià(
	`sy¡em
(
§
.
	`c_¡r
()) != 0)

148  
”rh
->
	`”rÜ
("%s: couldn'ˆ£ˆ¬°æags: %s", 
§
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

151 ià(
_Ã¬
) {

152 
§
.
	`ş—r
();

153 
§
 << "/sbš/ifcÚfig " << 
_dev_Çme
 << " " << 
_Ã¬
 << "‚‘mask " << 
_mask
 << 
up
 << " 2>/dev/null";

154 ià(
	`sy¡em
(
§
.
	`c_¡r
()) != 0)

155  
”rh
->
	`”rÜ
("%s: %<%s%> faed\n(P”h­ Eth”°i š‡ k”ÃÈmoduËh© you hav’'ˆlßded y‘?)", 
_dev_Çme
.
	`c_¡r
(), 
§
.c_str());

156 
up
 = "";

159 ià(
_gw
) {

160 
§
.
	`ş—r
();

161 
§
 << "/sbin/route -n‡dd default ";

162 #ià
	`defšed
(
__lšux__
)

163 
§
 << "gw ";

165 
§
 << 
_gw
;

166 ià(
	`sy¡em
(
§
.
	`c_¡r
()) != 0)

167  
”rh
->
	`”rÜ
("%s: %<%s%> faed", 
_dev_Çme
.
	`c_¡r
(), 
§
.c_str());

170 #ià
HAVE_IP6


171 ià(
_Ã¬6
) {

172 
§
.
	`ş—r
();

173 
§
 << "/sbš/ifcÚfig " << 
_dev_Çme
 << " iÃt6‡dd " << 
_Ã¬6
 << "/" << 
_´efix6
 << 
up
 << " 2>/dev/null";

174 ià(
	`sy¡em
(
§
.
	`c_¡r
()) != 0)

175  
”rh
->
	`”rÜ
("%s: %<%s%> faed", 
_dev_Çme
.
	`c_¡r
(), 
§
.c_str());

176 
up
 = "";

182 
_mtu_š
 = 
_mtu_out
 + 4;

184 
	}
}

187 
	gFromHo¡
::
	$d—Îoc_tun
()

189 ià(
_Ã¬
) {

190 
SŒšg
 
cmd
 = "/sbš/ifcÚfig " + 
_dev_Çme
 + " down";

191 ià(
	`sy¡em
(
cmd
.
	`c_¡r
()) != 0)

192 
	`şick_ch©‹r
("%s: faed: %s", 
	`Çme
().
	`c_¡r
(), 
cmd
.c_str());

194 
	}
}

197 
	gFromHo¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

199 ià(
	`Œy_lšux_univ”§l
(
”rh
) < 0)

201 ià(
	`£tup_tun
(
”rh
) < 0)

204 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

205 
_nÚfuÎ_sigÇl
 = 
NÙif›r
::
	`down¡»am_fuÎ_sigÇl
(
this
, 0, &
_sk
);

207 
	`add_£Ëù
(
_fd
, 
SELECT_READ
);

209 
	}
}

212 
	gFromHo¡
::
	$ş—nup
(
CËªupSge
)

214 ià(
_fd
 >= 0) {

215 
	`şo£
(
_fd
);

216 
	`»move_£Ëù
(
_fd
, 
SELECT_READ
);

218 
	}
}

221 
	gFromHo¡
::
	$£Ëùed
(
fd
, )

223 ià(
fd
 !ğ
_fd
)

226 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
_h—droom
, 0, 
_mtu_š
, 0);

227 ià(!
p
) {

228 
	`şick_ch©‹r
("out of memory!");

232 
cc
 = 
	`»ad
(
_fd
, 
p
->
	`d©a
(), 
_mtu_š
);

233 ià(
cc
 > 0) {

234 
p
->
	`ke
(
_mtu_š
 - 
cc
);

236 
p
->
	`puÎ
(4);

237 
p
->
	`£t_mac_h—d”
Õ->
	`d©a
());

238 cÚ¡ 
şick_
 *

 = 
»š‹½»t_ÿ¡
<cÚ¡ click_ *>(
p
->
	`d©a
(è+ (
şick_‘h”
));

239 
p
->
	`£t_d¡__ªno
(
	`IPAdd»ss
(

->
_d¡
));

240 
p
->
	`£t__h—d”
(

, ip->
_hl
 << 2);

241 
p
->
	`time¡amp_ªno
().
	`assign_now
();

242 
	`ouut
(0).
	`push
(
p
);

244 
p
->
	`kl
();

245 
	`³¼Ü
("FromHost„ead");

248 ià(!
_nÚfuÎ_sigÇl
) {

249 
	`»move_£Ëù
(
_fd
, 
SELECT_READ
);

254 
	}
}

256 
boŞ


257 
	gFromHo¡
::
	$run_sk
(
Task
 *)

259 ià(!
_nÚfuÎ_sigÇl
)

260  
çl£
;

262 
	`add_£Ëù
(
_fd
, 
SELECT_READ
);

263  
Œue
;

265 
	}
}

267 
SŒšg


268 
	gFromHo¡
::
	$»ad_·¿m
(
EËm’t
 *
e
, *)

270 
FromHo¡
 *
fh
 = 
¡©ic_ÿ¡
<FromHo¡ *>(
e
);

271  
	`SŒšg
(
fh
->
_nÚfuÎ_sigÇl
.
	`aùive
());

272 
	}
}

275 
	gFromHo¡
::
	$add_hªdËrs
()

277 
	`add_d©a_hªdËrs
("dev_Çme", 
HªdËr
::
OP_READ
, &
_dev_Çme
);

278 
	`add_»ad_hªdËr
("sigÇl", 
»ad_·¿m
, 0);

279 
	}
}

281 
CLICK_ENDDECLS


282 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
lšux
)

283 
	`EXPORT_ELEMENT
(
FromHo¡
)

	@userlevel/fromhost.hh

2 #iâdeà
CLICK_FROMHOST_USERLEVEL_HH


3 
	#CLICK_FROMHOST_USERLEVEL_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/add»ss.hh
>

6 
	~<şick/‘h”add»ss.hh
>

7 
	~<şick/sk.hh
>

8 
	~<şick/nÙif›r.hh
>

9 #ià
HAVE_IP6


10 
	~<şick/6add»ss.hh
>

12 
CLICK_DECLS


95 şas 
	cFromHo¡
 : 
public
 
EËm’t
 {…ublic:

98 
	eCÚfigu»Pha£
 {

99 
CONFIGURE_PHASE_FROMHOST
 = 
CONFIGURE_PHASE_DEFAULT
,

100 
	mCONFIGURE_PHASE_TOHOST
 = 
CONFIGURE_PHASE_FROMHOST
 + 1

103 
	$FromHo¡
(è
CLICK_COLD
;

104 ~
	$FromHo¡
(è
CLICK_COLD
;

106 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "FromHo¡"; 
	}
}

107 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

108 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

110 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_FROMHOST
; 
	}
}

111 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

112 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

113 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

114 
	$add_hªdËrs
(è
CLICK_COLD
;

116 
	$fd
(ècÚ¡ {  
_fd
; 
	}
}

117 
SŒšg
 
	$dev_Çme
(ècÚ¡ {  
_dev_Çme
; 
	}
}

119 
£Ëùed
(
fd
, 
mask
);

120 
boŞ
 
run_sk
(
Task
 *);

122 
	g´iv©e
:

123 ’um { 
DEFAULT_MTU
 = 2048 };

125 
	g_fd
;

126 
	g_mtu_š
;

127 
	g_mtu_out
;

128 
SŒšg
 
	g_dev_Çme
;

130 
Eth”Add»ss
 
	g_maÿddr
;

132 
IPAdd»ss
 
	g_Ã¬
;

133 
IPAdd»ss
 
	g_mask
;

134 
IPAdd»ss
 
	g_gw
;

136 #ià
HAVE_IP6


137 
IP6Add»ss
 
	g_Ã¬6
;

138 
	g_´efix6
;

141 
	g_h—droom
;

142 
Task
 
	g_sk
;

143 
NÙif›rSigÇl
 
	g_nÚfuÎ_sigÇl
;

145 
Œy_lšux_univ”§l
(
E¼ÜHªdËr
 *);

146 
Œy_tun
(cÚ¡ 
SŒšg
 &, 
E¼ÜHªdËr
 *);

147 
®loc_tun
(
E¼ÜHªdËr
 *);

148 
£tup_tun
(
E¼ÜHªdËr
 *);

149 
d—Îoc_tun
();

151 
SŒšg
 
	$»ad_·¿m
(
EËm’t
 *, *è
CLICK_COLD
;

153 
	}
};

155 
	gCLICK_ENDDECLS


	@userlevel/fromrawsocket.cc

20 
	~<şick/cÚfig.h
>

21 
	~"äom¿wsock‘.hh
"

23 
CLICK_DECLS


25 
	gFromRawSock‘
::
	$FromRawSock‘
()

27 
	`şick_ch©‹r
("warning: FromRawSocket is deprecated, use RawSocket instead");

28 
	}
}

30 
	gFromRawSock‘
::~
	$FromRawSock‘
()

32 
	}
}

34 
CLICK_ENDDECLS


35 
	$ELEMENT_REQUIRES
(
RawSock‘
)

36 
	`EXPORT_ELEMENT
(
FromRawSock‘
)

	@userlevel/fromrawsocket.hh

2 #iâdeà
CLICK_FROMRAWSOCKET_HH


3 
	#CLICK_FROMRAWSOCKET_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~"¿wsock‘.hh
"

6 
CLICK_DECLS


39 şas 
	cFromRawSock‘
 : 
public
 
RawSock‘
 {…ublic:

41 
	$FromRawSock‘
(è
CLICK_COLD
;

42 ~
	$FromRawSock‘
(è
CLICK_COLD
;

44 cÚ¡ *
	$şass_Çme
() const {  "FromRawSocket"; }

45 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

46 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

50 
	gCLICK_ENDDECLS


	@userlevel/fromsocket.cc

19 
	~<şick/cÚfig.h
>

20 
	~"äomsock‘.hh
"

22 
CLICK_DECLS


24 
	gFromSock‘
::
	$FromSock‘
()

26 
	`şick_ch©‹r
("warning: FromSocket is deprecated, use Socket instead");

27 
	}
}

29 
	gFromSock‘
::~
	$FromSock‘
()

31 
	}
}

33 
CLICK_ENDDECLS


34 
	$ELEMENT_REQUIRES
(
Sock‘
)

35 
	`EXPORT_ELEMENT
(
FromSock‘
)

	@userlevel/fromsocket.hh

2 #iâdeà
CLICK_FROMSOCKET_HH


3 
	#CLICK_FROMSOCKET_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~"sock‘.hh
"

6 
CLICK_DECLS


36 şas 
	cFromSock‘
 : 
public
 
Sock‘
 {…ublic:

38 
	$FromSock‘
(è
CLICK_COLD
;

39 ~
	$FromSock‘
(è
CLICK_COLD
;

41 cÚ¡ *
	$şass_Çme
() const {  "FromSocket"; }

42 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

43 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

47 
	gCLICK_ENDDECLS


	@userlevel/handlerproxy.cc

18 
	~<şick/cÚfig.h
>

19 
	~"hªdË½roxy.hh
"

20 
	~<şick/”rÜ.hh
>

21 
CLICK_DECLS


23 
	gHªdËrProxy
::
	$HªdËrProxy
()

24 : 
	`_”r_rcvs
(0), 
	$_Ã¼_rcvs
(0)

26 
	}
}

28 
	gHªdËrProxy
::~
	$HªdËrProxy
()

30 
	}
}

33 
HªdËrProxy
::
	$add_”rÜ_»ûiv”
(
E¼ÜReûiv”Hook
 
hook
, *
thunk
)

35 
E¼ÜReûiv”
 *
Ãw_”r_rcvs
 = 
Ãw
 E¼ÜReûiv”[
_Ã¼_rcvs
 + 1];

36 ià(!
Ãw_”r_rcvs
è -
ENOMEM
;

37 
	`memıy
(
Ãw_”r_rcvs
, 
_”r_rcvs
, (
E¼ÜReûiv”
è* 
_Ã¼_rcvs
);

38 
Ãw_”r_rcvs
[
_Ã¼_rcvs
].
hook
 = hook;

39 
Ãw_”r_rcvs
[
_Ã¼_rcvs
].
thunk
 =hunk;

40 
d–‘e
[] 
_”r_rcvs
;

41 
_”r_rcvs
 = 
Ãw_”r_rcvs
;

42 
_Ã¼_rcvs
++;

44 
	}
}

47 
	gHªdËrProxy
::
	$»move_”rÜ_»ûiv”
(
E¼ÜReûiv”Hook
 
hook
, *
thunk
)

49 
i
 = 0; i < 
_Ã¼_rcvs
; i++)

50 ià(
_”r_rcvs
[
i
].
hook
 =ğhook && _”r_rcvs[i].
thunk
 ==hunk) {

51 
	`memıy
(&
_”r_rcvs
[
i
], &_”r_rcvs[
_Ã¼_rcvs
 - 1], (
E¼ÜReûiv”
));

52 
_Ã¼_rcvs
--;

56 
	}
}

59 
	gHªdËrProxy
::
	$check_hªdËr
(cÚ¡ 
SŒšg
 &
hÇme
, 
boŞ
, 
E¼ÜHªdËr
 *
”rh
)

61 
”rh
->
	`”rÜ
("{ec:%d}HªdË¸'%#s' stu unknown", 
CSERR_UNSPECIFIED
, 
hÇme
.
	`´šbË
().
	`c_¡r
());

63 
	}
}

65 
CLICK_ENDDECLS


66 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

67 
	`ELEMENT_PROVIDES
(
HªdËrProxy
)

	@userlevel/handlerproxy.hh

1 #iâdeà
CLICK_HANDLERPROXY_HH


2 
	#CLICK_HANDLERPROXY_HH


	)

3 
	~<şick/–em’t.hh
>

4 
CLICK_DECLS


6 şas 
	cHªdËrProxy
 : 
public
 
EËm’t
 {…ublic:

8 
E¼ÜHªdËr
* (*
	tE¼ÜReûiv”Hook
)(cÚ¡ 
	tSŒšg
&, *);

10 
	$HªdËrProxy
(è
CLICK_COLD
;

11 ~
	$HªdËrProxy
(è
CLICK_COLD
;

13 
vœtu®
 
	`add_”rÜ_»ûiv”
(
E¼ÜReûiv”Hook
, *);

14 
vœtu®
 
	`»move_”rÜ_»ûiv”
(
E¼ÜReûiv”Hook
, *);

16 
vœtu®
 
	`check_hªdËr
(cÚ¡ 
SŒšg
&, 
boŞ
 
wr™e
, 
E¼ÜHªdËr
*);

19 
CSERR_OK
 = 200,

20 
CSERR_SYNTAX
 = 500,

21 
CSERR_NO_SUCH_ELEMENT
 = 510,

22 
CSERR_NO_SUCH_HANDLER
 = 511,

23 
CSERR_HANDLER_ERROR
 = 520,

24 
CSERR_PERMISSION
 = 530,

25 
CSERR_NO_ROUTER
 = 540,

26 
CSERR_UNSPECIFIED
 = 590

29 
´Ùeùed
:

31 
	sE¼ÜReûiv”
 {

32 
E¼ÜReûiv”Hook
 
hook
;

33 * 
thunk
;

34 
	}
};

36 
E¼ÜReûiv”
* 
	g_”r_rcvs
;

37 
	g_Ã¼_rcvs
;

41 
	gCLICK_ENDDECLS


	@userlevel/ipflowrawsockets.cc

19 
	~<şick/cÚfig.h
>

20 
	~"æow¿wsock‘s.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
	~<şick/rou‹r.hh
>

25 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

26 
	~<şickÃt/tı.h
>

27 
	~<uni¡d.h
>

28 
	~<fú.h
>

29 
	~<sys/ty³s.h
>

30 
	~<sys/sock‘.h
>

31 
	~<Ãtš‘/š.h
>

32 
	~<sys/ioùl.h
>

33 
	~<¬·/š‘.h
>

34 
	~<sys/ioùl.h
>

36 
	~<şick/¡¿ccum.hh
>

39 
	~<pÿp.h
>

42 
	~"çk•ÿp.hh
"

43 
	~<şickÃt/udp.h
>

45 
CLICK_DECLS


47 
IPFlowRawSock‘s
::
Flow
::
	$Flow
(cÚ¡ 
Pack‘
 *
p
)

48 : 
	`_Ãxt
(0),

49 
	`_æowid
(
p
), 
	`__p
Õ->
	`_h—d”
()->
_p
),

50 
	`_agg»g©e
(
	`AGGREGATE_ANNO
(
p
)),

51 
	`_wd
(-1), 
	`_rd
(-1), 
	$_pÿp
(0)

53 ià(
	`PAINT_ANNO
(
p
) & 1)

54 
_æowid
 = _æowid.
	`»v”£
();

57 
	`as£¹
(
_agg»g©e
 && (
__p
 =ğ
IP_PROTO_TCP
 || __°=ğ
IP_PROTO_UDP
));

58 
	}
}

60 
IPFlowRawSock‘s
::
Flow
::~
	$Flow
()

62 ià(
_wd
 >= 0)

63 
	`şo£
(
_wd
);

64 ià(
_pÿp
)

65 
	`pÿp_şo£
(
_pÿp
);

66 
	}
}

69 
IPFlowRawSock‘s
::
Flow
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
, 
¢­Ën
, 
boŞ
 
u£pÿp
)

71 
sockaddr_š
 
sš
;

74 
_wd
 = 
	`sock‘
(
PF_INET
, 
SOCK_RAW
, 
__p
);

75 ià(
_wd
 < 0)

76  
”rh
->
	`”rÜ
("sock‘: %s", 
	`¡»¼Ü
(
”ºo
));

78 
	`mem£t
(&
sš
, 0, (sin));

79 
sš
.
sš_çmy
 = 
PF_INET
;

80 
sš
.
sš_pÜt
 = 
_æowid
.
	`¥Üt
();

81 
sš
.
sš_addr
 = 
	`IPAdd»ss
().
	`š_addr
();

84 ià(
	`bšd
(
_wd
, (
sockaddr
 *)&
sš
, (sin)) < 0)

85  
”rh
->
	`”rÜ
("bšd: %s", 
	`¡»¼Ü
(
”ºo
));

88 
Úe
 = 1;

89 ià(
	`£tsockİt
(
_wd
, 
IPPROTO_IP
, 
IP_HDRINCL
, &
Úe
, (one)) < 0)

90  
”rh
->
	`”rÜ
("£tsockİt: %s", 
	`¡»¼Ü
(
”ºo
));

93 
	`fú
(
_wd
, 
F_SETFL
, 
O_NONBLOCK
);

94 
	`fú
(
_wd
, 
F_SETFD
, 
FD_CLOEXEC
);

97 ià(!
u£pÿp
) {

98 
_rd
 = 
_wd
;

102 
ebuf
[
PCAP_ERRBUF_SIZE
];

103 
_pÿp
 = 
	`pÿp_İ’_live
("ªy", 
¢­Ën
, 
çl£
,

105 
ebuf
);

107 ià(!
_pÿp
) {

108 
”rh
->
	`w¬nšg
("pÿp_İ’_live: %s", 
ebuf
);

109 
_rd
 = 
_wd
;

114 
_rd
 = 
	`pÿp_f’o
(
_pÿp
);

115 
	`fú
(
_rd
, 
F_SETFL
, 
O_NONBLOCK
);

117 #ifdeà
BIOCSSEESENT


119 
acû±
 = 0;

120 ià(
	`ioùl
(
_rd
, 
BIOCSSEESENT
, &
acû±
) != 0)

121  
”rh
->
	`”rÜ
("ioùl: %s", 
	`¡»¼Ü
(
”ºo
));

126 
SŒšgAccum
 
ss
;

127 
ss
 << "ip src host ";

128 
ss
 << 
_æowid
.
	`daddr
().
	`uÅ¬£
().
	`c_¡r
();

129 
ss
 << "‡nd ";

130 
ss
 << (
__p
 =ğ
IP_PROTO_TCP
 ? "tcp" : "udp");

131 
ss
 << " src…ort ";

132 
ss
 << 
	`Áohs
(
_æowid
.
	`dpÜt
());

133 
ss
 << "‡nd ";

134 
ss
 << (
__p
 =ğ
IP_PROTO_TCP
 ? "tcp" : "udp");

135 
ss
 << " dst…ort ";

136 
ss
 << 
	`Áohs
(
_æowid
.
	`¥Üt
());

139 
bpf_´og¿m
 
fcode
;

140 ià(
	`pÿp_compe
(
_pÿp
, &
fcode
, (*)
ss
.
	`c_¡r
(), 0, 0) < 0)

141  
”rh
->
	`”rÜ
("pÿp_compe: %s", 
	`pÿp_g‘”r
(
_pÿp
));

142 ià(
	`pÿp_£tf‹r
(
_pÿp
, &
fcode
) < 0)

143  
”rh
->
	`”rÜ
("pÿp_£tf‹r: %s", 
	`pÿp_g‘”r
(
_pÿp
));

145 
_d©®šk
 = 
	`pÿp_d©®šk
(
_pÿp
);

146 ià(!
	`çke_pÿp_dÉ_fÜû_abË
(
_d©®šk
))

147 
”rh
->
	`w¬nšg
("¡¿ngd©¨lšky³ %d", 
_d©®šk
);

150 
	}
}

153 
IPFlowRawSock‘s
::
Flow
::
	$£nd_pkt
(
Pack‘
 *
p
, 
E¼ÜHªdËr
 *
”rh
)

155 
sockaddr_š
 
sš
;

157 
sš
.
sš_çmy
 = 
PF_INET
;

158 
sš
.
sš_pÜt
 = 
_æowid
.
	`dpÜt
();

159 
sš
.
sš_addr
 = 
_æowid
.
	`daddr
().
	`š_addr
();

162 
w
 = 0;

163 
p
->
	`Ëngth
()) {

164 
w
 = 
	`£ndto
(
_wd
, 
p
->
	`d©a
(),…->
	`Ëngth
(), 0, (cÚ¡ 
sockaddr
*)&
sš
, (sin));

165 ià(
w
 < 0 && 
”ºo
 !ğ
EINTR
)

167 
p
->
	`puÎ
(
w
);

169 ià(
w
 < 0 && 
”ºo
 !ğ
EAGAIN
)

170 
”rh
->
	`”rÜ
("£ndto: %s", 
	`¡»¼Ü
(
”ºo
));

172 
p
->
	`kl
();

173 
	}
}

175 
IPFlowRawSock‘s
::
	$IPFlowRawSock‘s
()

176 : 
	`_Âßgg
(0), 
	`_Çgg
(0), 
	`_agg_nÙif›r
(0), 
	`_sk
(
this
),

177 
	`_gc_tim”
(
gc_hook
, 
this
), 
	$_h—droom
(
Pack‘
::
deçuÉ_h—droom
)

179 
i
 = 0; i < 
NFLOWMAP
; i++)

180 
_æowm­
[
i
] = 0;

181 
	}
}

183 
IPFlowRawSock‘s
::~
	$IPFlowRawSock‘s
()

185 
	}
}

188 
IPFlowRawSock‘s
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

190 
EËm’t
 *
e
 = 0;

192 
_¢­Ën
 = 2046;

193 
_u£pÿp
 = 
Œue
;

194 ià(
Args
(
cÚf
, 
this
, 
”rh
)

195 .
»ad
("NOTIFIER", 
e
)

196 .
»ad
("SNAPLEN", 
_¢­Ën
)

197 .
»ad
("PCAP", 
_u£pÿp
)

198 .
»ad
("HEADROOM", 
_h—droom
)

199 .
com¶‘e
() < 0)

202 ià(
e
 && !(
_agg_nÙif›r
 = (
Agg»g©eNÙif›r
 *ë->
ÿ¡
("AggregateNotifier")))

203  
”rh
->
”rÜ
("% i nÙ‡ÀAgg»g©eNÙif›r", 
e
->
Çme
().
c_¡r
());

210 
IPFlowRawSock‘s
::
	$’d_æow
(
Flow
 *
f
, 
E¼ÜHªdËr
 *)

212 
	`»move_£Ëù
(
f
->
	`rd
(), 
SELECT_READ
);

213 
_æows
[
f
->
	`rd
()] = 0;

214 
d–‘e
 
f
;

215 
_næows
--;

216 
	}
}

219 
IPFlowRawSock‘s
::
	$ş—nup
(
CËªupSge
)

221 
E¼ÜHªdËr
 *
”rh
 = E¼ÜHªdËr::
	`deçuÉ_hªdËr
();

222 
i
 = 0; i < 
NFLOWMAP
; i++)

223 
Flow
 *
f
 = 
_æowm­
[
i
]) {

224 
_æowm­
[
i
] = 
f
->
	`Ãxt
();

225 
	`’d_æow
(
f
, 
”rh
);

227 ià(
_Âßgg
 > 0 && 
_Çgg
 == 0)

228 
”rh
->
	`lw¬nšg
(
	`deş¬©iÚ
(), "saw‚o…ackets with‡ggregate‡nnotations");

229 
	}
}

232 
IPFlowRawSock‘s
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

234 ià(
	`šput_is_puÎ
(0)) {

235 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

236 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

238 ià(
_agg_nÙif›r
)

239 
_agg_nÙif›r
->
	`add_li¡’”
(
this
);

240 
_gc_tim”
.
	`š™Ÿlize
(
this
);

242 
	}
}

244 
IPFlowRawSock‘s
::
Flow
 *

245 
IPFlowRawSock‘s
::
	$fšd_agg»g©e
(
ušt32_t
 
agg
, cÚ¡ 
Pack‘
 *
p
)

247 ià(
agg
 == 0)

250 
buck‘
 = (
agg
 & (
NFLOWMAP
 - 1));

251 
Flow
 *
´ev
 = 0, *
f
 = 
_æowm­
[
buck‘
];

252 
f
 && f->
	`agg»g©e
(è!ğ
agg
) {

253 
´ev
 = 
f
;

254 
f
 = f->
	`Ãxt
();

257 ià(
f
)

259 ià(
p
 && (
f
 = 
Ãw
 
	`Flow
(p))) {

260 ià(
f
->
	`š™Ÿlize
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
(), 
_¢­Ën
, 
_u£pÿp
)) {

261 
d–‘e
 
f
;

264 
f
->
	`rd
(è>ğ
_æows
.
	`size
())

265 
_æows
.
	`push_back
(0);

266 
_æows
[
f
->
	`rd
()] = f;

267 
	`add_£Ëù
(
f
->
	`rd
(), 
SELECT_READ
);

268 
´ev
 = 
f
;

269 
_næows
++;

273 ià(
´ev
) {

274 
´ev
->
	`£t_Ãxt
(
f
->
	`Ãxt
());

275 
f
->
	`£t_Ãxt
(
_æowm­
[
buck‘
]);

276 
_æowm­
[
buck‘
] = 
f
;

279  
f
;

280 
	}
}

283 
IPFlowRawSock‘s
::
	$push
(, 
Pack‘
 *
p
)

285 ià(
Flow
 *
f
 = 
	`fšd_agg»g©e
(
	`AGGREGATE_ANNO
(
p
),…)) {

286 
_Çgg
++;

287 
f
->
	`£nd_pkt
(
p
, 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

289 
_Âßgg
++;

290 
	}
}

292 
CLICK_ENDDECLS


295 
IPFlowRawSock‘s_g‘_·ck‘
(
u_ch¬
* 
ş›Ád©a
,

296 cÚ¡ 
pÿp_pkthdr
* 
pkthdr
,

297 cÚ¡ 
u_ch¬
* 
d©a
)

299 
Wr™abËPack‘
 *
p
 = (Wr™abËPack‘ *è
ş›Ád©a
;

300 
Ëngth
 = 
pkthdr
->
ÿ¶’
;

302 
memıy
(
p
->
d©a
(), d©a, 
Ëngth
);

303 
p
 =…->
put
(
Ëngth
);

304 
as£¹
(
p
);

307 
p
->
time¡amp_ªno
().
assign_u£c
(
pkthdr
->
ts
.
tv_£c
,…kthdr->ts.
tv_u£c
);

308 
SET_EXTRA_LENGTH_ANNO
(
p
, 
pkthdr
->
Ën
 - 
Ëngth
);

311 
CLICK_DECLS


314 
IPFlowRawSock‘s
::
	$£Ëùed
(
fd
, )

316 
E¼ÜHªdËr
 *
”rh
 = E¼ÜHªdËr::
	`deçuÉ_hªdËr
();

317 
Wr™abËPack‘
 *
p
;

318 
Ën
;

320 
	`as£¹
(
fd
 < 
_æows
.
	`size
());

321 
Flow
 *
f
 = 
_æows
[
fd
];

322 
	`as£¹
(
f
);

325 
p
 = 
Pack‘
::
	`make
(
_h—droom
, (*)0, 
_¢­Ën
, 0);

326 ià(!
p
)

328 
p
->
	`ke
Õ->
	`Ëngth
());

330 ià(
f
->
	`pÿp
()) {

331 
	`pÿp_di¥©ch
(
f
->
	`pÿp
(), 1, 
IPFlowRawSock‘s_g‘_·ck‘
, (
u_ch¬
 *è
p
);

332 ià(
p
->
	`Ëngth
(è&& 
	`çke_pÿp_fÜû_
Õ, 
f
->
	`d©®šk
())) {

334 
p
->
	`puÎ
((
ušŒ_t
í->
	`_h—d”
(è- (ušŒ_tí->
	`d©a
());

335 
	`ouut
(0).
	`push
(
p
);

337 
p
->
	`kl
();

340 
Ën
 = 
	`»ad
(
fd
, 
p
->
	`’d_d©a
(),…->
	`room
());

342 ià(
Ën
 > 0) {

343 
p
 =…->
	`put
(
Ën
);

344 ià(!
p
)

347 #ifdeà
SIOCGSTAMP


349 
p
->
	`time¡amp_ªno
().
	`£t_timev®_ioùl
(
fd
, 
SIOCGSTAMP
);

352 ià(
	`çke_pÿp_fÜû_
(
p
, 
FAKE_DLT_RAW
)) {

353 
p
->
	`_h—d”
()->
_p
) {

354 
IPPROTO_TCP
:

357 ià(
f
->
	`¥Üt
(è!ğ
p
->
	`tı_h—d”
()->
th_dpÜt
)

358 
drİ
;

360 
IPPROTO_UDP
:

363 ià(
f
->
	`¥Üt
(è!ğ
p
->
	`udp_h—d”
()->
uh_dpÜt
)

364 
drİ
;

369 
	`ouut
(0).
	`push
(
p
);

374 
drİ
:

375 
p
->
	`kl
();

376 ià(
Ën
 <ğ0 && 
”ºo
 !ğ
EAGAIN
)

377 
”rh
->
	`”rÜ
("%s:„—d: %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

379 
	}
}

381 
boŞ


382 
IPFlowRawSock‘s
::
	$run_sk
(
Task
 *)

384 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

385 ià(
p
)

386 
	`push
(0, 
p
);

387 ià(!
_sigÇl
)

388  
çl£
;

389 
_sk
.
	`ç¡_»scheduË
();

390  
p
 != 0;

391 
	}
}

394 
IPFlowRawSock‘s
::
	$agg»g©e_nÙify
(
ušt32_t
 
agg
, 
Agg»g©eEv’t
 
ev’t
, cÚ¡ 
Pack‘
 *)

396 ià(
ev’t
 =ğ
DELETE_AGG
 && 
	`fšd_agg»g©e
(
agg
, 0)) {

397 
_gc_aggs
.
	`push_back
(
agg
);

398 
_gc_aggs
.
	`push_back
(
	`şick_jiff›s
());

399 ià(!
_gc_tim”
.
	`scheduËd
())

400 
_gc_tim”
.
	`scheduË_aá”_m£c
(250);

402 
	}
}

405 
IPFlowRawSock‘s
::
	$gc_hook
(
Tim”
 *
t
, *
thunk
)

407 
IPFlowRawSock‘s
 *
fs
 = 
¡©ic_ÿ¡
<IPFlowRawSock‘ *>(
thunk
);

408 
ušt32_t
 
lim™_jiff
 = 
	`şick_jiff›s
(è- (
CLICK_HZ
 / 4);

409 
i
;

410 
i
 = 0; i < 
fs
->
_gc_aggs
.
	`size
(è&& 
	`SEQ_LEQ
(fs->_gc_aggs[i+1], 
lim™_jiff
); i += 2)

411 ià(
Flow
 *
f
 = 
fs
->
	`fšd_agg»g©e
(fs->
_gc_aggs
[
i
], 0)) {

412 
buck‘
 = (
f
->
	`agg»g©e
(è& (
NFLOWMAP
 - 1));

413 
	`as£¹
(
fs
->
_æowm­
[
buck‘
] =ğ
f
);

414 
fs
->
_æowm­
[
buck‘
] = 
f
->
	`Ãxt
();

415 
fs
->
	`’d_æow
(
f
, 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

417 ià(
i
 < 
fs
->
_gc_aggs
.
	`size
()) {

418 
fs
->
_gc_aggs
.
	`”a£
(fs->_gc_aggs.
	`begš
(), fs->_gc_aggs.begš(è+ 
i
);

419 
t
->
	`scheduË_aá”_m£c
(250);

421 
	}
}

423 ’um { 
H_CLEAR
 };

426 
	gIPFlowRawSock‘s
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

428 
IPFlowRawSock‘s
 *
fs
 = 
¡©ic_ÿ¡
<IPFlowRawSock‘ *>(
e
);

429 (
šŒ_t
)
thunk
) {

430 
H_CLEAR
:

431 
i
 = 0; i < 
NFLOWMAP
; i++)

432 
Flow
 *
f
 = 
fs
->
_æowm­
[
i
]) {

433 
fs
->
_æowm­
[
i
] = 
f
->
	`Ãxt
();

434 
fs
->
	`’d_æow
(
f
, 
”rh
);

440 
	}
}

443 
	gIPFlowRawSock‘s
::
	$add_hªdËrs
()

445 
	`add_wr™e_hªdËr
("ş—r", 
wr™e_hªdËr
, 
H_CLEAR
);

446 ià(
	`šput_is_puÎ
(0))

447 
	`add_sk_hªdËrs
(&
_sk
);

448 
	}
}

450 
CLICK_ENDDECLS


451 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
Agg»g©eNÙif›r
 
pÿp
)

452 
	`EXPORT_ELEMENT
(
IPFlowRawSock‘s
)

	@userlevel/ipflowrawsockets.hh

19 #iâdeà
CLICK_IPFLOWRAWSOCKETS_HH


20 
	#CLICK_IPFLOWRAWSOCKETS_HH


	)

21 
	~<şick/–em’t.hh
>

22 
	~<şick/æowid.hh
>

23 
	~<şick/tim”.hh
>

24 
	~<şick/nÙif›r.hh
>

25 
	~"../ª®ysis/agg»g©’Ùif›r.hh
"

27 
	~<pÿp.h
>

29 
CLICK_DECLS


136 
şass
 
IPFlowRawSock‘s
 : 
public
 
EËm’t
,…ubliø
Agg»g©eLi¡’”
 {…ublic:

138 
IPFlowRawSock‘s
(è
CLICK_COLD
;

139 ~
IPFlowRawSock‘s
(è
CLICK_COLD
;

141 cÚ¡ *
şass_Çme
() const {  "IPFlowRawSockets"; }

142 cÚ¡ *
pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; }

143 cÚ¡ *
´oûssšg
() const {  "a/h"; }

144 cÚ¡ *
æow_code
() const {  "x/y"; }

146 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

147 
š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

148 
ş—nup
(
CËªupSge
è
CLICK_COLD
;

149 
add_hªdËrs
(è
CLICK_COLD
;

151 
push
(, 
Pack‘
 *);

152 
boŞ
 
run_sk
(
Task
 *);

154 
agg»g©e_nÙify
(
ušt32_t
, 
Agg»g©eEv’t
, cÚ¡ 
Pack‘
 *);

156 
´iv©e
:

158 şas 
	cFlow
 { 
public
:

160 
Flow
(cÚ¡ 
Pack‘
 *);

161 ~
Flow
();

163 
š™Ÿlize
(
E¼ÜHªdËr
 *, 
¢­Ën
, 
boŞ
 
u£pÿp
è
CLICK_COLD
;

165 
ušt32_t
 
agg»g©e
(ècÚ¡ {  
_agg»g©e
; }

166 
Flow
 *
Ãxt
(ècÚ¡ {  
_Ãxt
; }

167 
£t_Ãxt
(
Flow
 *
f
è{ 
_Ãxt
 = f; }

168 
rd
(è{  
_rd
; }

169 
pÿp_t
 *
pÿp
(è{  
_pÿp
; }

170 
d©®šk
(è{  
_d©®šk
; }

171 
¥Üt
(è{  
_æowid
.sport(); }

172 
£nd_pkt
(
Pack‘
 *, 
E¼ÜHªdËr
 *);

174 
´iv©e
:

176 ’um { 
NPKT
 = 128, 
NNOTE
 = 32 };

178 
Flow
 *
_Ãxt
;

179 
IPFlowID
 
_æowid
;

180 
__p
;

181 
ušt32_t
 
_agg»g©e
;

182 
_wd
, 
_rd
;

183 
pÿp_t
 *
_pÿp
;

184 
_d©®šk
;

188 ’um { 
FLOWMAP_BITS
 = 10, 
NFLOWMAP
 = 1 << FLOWMAP_BITS };

189 
Flow
 *
_æowm­
[
NFLOWMAP
];

190 
VeùÜ
<
Flow
 *> 
_æows
;

191 
_næows
;

193 
ušt32_t
 
_Âßgg
;

194 
ušt32_t
 
_Çgg
;

195 
Agg»g©eNÙif›r
 *
_agg_nÙif›r
;

197 
Task
 
_sk
;

198 
NÙif›rSigÇl
 
_sigÇl
;

200 
Tim”
 
_gc_tim”
;

201 
VeùÜ
<
ušt32_t
> 
_gc_aggs
;

203 
_¢­Ën
;

204 
boŞ
 
_u£pÿp
;

205 
_h—droom
;

207 
Flow
 *
fšd_agg»g©e
(
ušt32_t
, cÚ¡ 
Pack‘
 * = 0);

208 
’d_æow
(
Flow
 *, 
E¼ÜHªdËr
 *);

209 
£Ëùed
(
fd
, 
mask
);

210 
gc_hook
(
Tim”
 *, *);

211 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
*è
CLICK_COLD
;

213 
	}
};

215 
	gCLICK_ENDDECLS


	@userlevel/kernelfilter.cc

19 
	~<şick/cÚfig.h
>

20 
	~"k”Ãlf‹r.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şick/u£ruts.hh
>

25 
	~<uni¡d.h
>

26 
CLICK_DECLS


28 
	gK”ÃlF‹r
::
	$K”ÃlF‹r
()

30 
	}
}

32 
K”ÃlF‹r
::~
	$K”ÃlF‹r
()

34 
	}
}

37 
K”ÃlF‹r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39 ià(
Args
(
this
, 
”rh
).
bšd
(
cÚf
)

40 .
»ad
("IPTABLES_COMMAND", 
_bËs_commªd
)

41 .
cÚsume
() < 0)

43 
SŒšg
 
	gaùiÚ
, 
	gty³
, 
	g¬g
;

44 
	gi
 = 0; i < 
	gcÚf
.
size
(); i++) {

45 ià(
Args
(
this
, 
”rh
).
push_back_wÜds
(
cÚf
[
i
])

46 .
»ad_mp
("ACTION", 
WÜdArg
(), 
aùiÚ
)

47 .
»ad_mp
("TYPE", 
WÜdArg
(), 
ty³
)

48 .
»ad_mp
("ARG", 
AnyArg
(), 
¬g
)

49 .
com¶‘e
() < 0)

51 ià(
	gaùiÚ
 !ğ"drİ" || 
ty³
 !ğ"dev" || !
¬g
)

52  
”rh
->
”rÜ
("arguments must follow 'drop dev DEVNAME'");

53 
	g_drİ_deviûs
.
push_back
(
¬g
);

59 
	gK”ÃlF‹r
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

62 
i
 = 0; i < 
_drİ_deviûs
.
	`size
(); ++i)

63 ià(
	`deviû_f‹r
(
_drİ_deviûs
[
i
], 
Œue
, 
”rh
, 
_bËs_commªd
) < 0)

64 
_drİ_deviûs
[
i
] = 
	`SŒšg
();

65  
”rh
->
	`Ã¼Üs
() ? -1 : 0;

66 
	}
}

69 
	gK”ÃlF‹r
::
	$ş—nup
(
CËªupSge
 
¡age
)

71 ià(
¡age
 >ğ
CLEANUP_INITIALIZED
) {

72 
E¼ÜHªdËr
 *
”rh
 = E¼ÜHªdËr::
	`deçuÉ_hªdËr
();

73 
i
 = 
_drİ_deviûs
.
	`size
() - 1; i >= 0; --i)

74 ià(
_drİ_deviûs
[
i
])

75 
	`deviû_f‹r
(
_drİ_deviûs
[
i
], 
çl£
, 
”rh
);

77 
	}
}

80 
	gK”ÃlF‹r
::
	$deviû_f‹r
(cÚ¡ 
SŒšg
 &
devÇme
, 
boŞ
 
add_f‹r
,

81 
E¼ÜHªdËr
 *
”rh
,

82 cÚ¡ 
SŒšg
 &
bËs_commªd
)

84 
SŒšgAccum
 
cmda
;

85 ià(
bËs_commªd
)

86 
cmda
 << 
bËs_commªd
;

87 ià(
	`acûss
("/sbš/bËs", 
X_OK
) == 0)

88 
cmda
 << "/sbin/iptables";

89 ià(
	`acûss
("/u¤/sbš/bËs", 
X_OK
) == 0)

90 
cmda
 << "/usr/sbin/iptables";

92  
”rh
->
	`”rÜ
("no %<iptables%>ƒxecutable found");

93 
cmda
 << " " << (
add_f‹r
 ? "-A" : "-D") << " INPUT -i "

94 << 
	`sh–l_quÙe
(
devÇme
) << " -j DROP";

95 
SŒšg
 
cmd
 = 
cmda
.
	`ke_¡ršg
();

96 
befÜe
 = 
”rh
->
	`Ã¼Üs
();

97 
SŒšg
 
out
 = 
	`sh–l_commªd_ouut_¡ršg
(
cmd
, "", 
”rh
);

98 ià(
out
)

99 
”rh
->
	`”rÜ
("%s: %s", 
cmd
.
	`c_¡r
(), 
out
.c_str());

100  
”rh
->
	`Ã¼Üs
(è=ğ
befÜe
 ? 0 : -1;

101 
	}
}

103 
CLICK_ENDDECLS


104 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

105 
	`EXPORT_ELEMENT
(
K”ÃlF‹r
)

	@userlevel/kernelfilter.hh

2 #iâdeà
CLICK_KERNELFILTER_HH


3 
	#CLICK_KERNELFILTER_HH


	)

4 
	~<şick/–em’t.hh
>

5 
CLICK_DECLS


48 şas 
	cK”ÃlF‹r
 : 
public
 
EËm’t
 {…ublic:

50 
	eCÚfigu»Pha£
 {

51 
CONFIGURE_PHASE_FROMDEVICE
 = 
CONFIGURE_PHASE_PRIVILEGED
 - 1,

52 
	mCONFIGURE_PHASE_TODEVICE
 = 
CONFIGURE_PHASE_FROMDEVICE
 + 1,

53 
	mCONFIGURE_PHASE_KERNELFILTER
 = 
CONFIGURE_PHASE_FROMDEVICE
 + 1

56 
	$K”ÃlF‹r
(è
CLICK_COLD
;

57 ~
	$K”ÃlF‹r
(è
CLICK_COLD
;

59 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "K”ÃlF‹r"; 
	}
}

60 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_0
; 
	}
}

61 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_KERNELFILTER
; 
	}
}

63 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

64 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

65 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

67 
	`deviû_f‹r
(cÚ¡ 
SŒšg
 &
devÇme
, 
boŞ
 
add_f‹r
,

68 
E¼ÜHªdËr
 *
”rh
,

69 cÚ¡ 
SŒšg
 &
bËs_commªd
 = 
	`SŒšg
());

71 
´iv©e
:

73 
VeùÜ
<
SŒšg
> 
_drİ_deviûs
;

74 
SŒšg
 
_bËs_commªd
;

76 
	}
};

78 
	gCLICK_ENDDECLS


	@userlevel/kerneltap.cc

20 
	~<şick/cÚfig.h
>

21 
	~"k”ÃÉ­.hh
"

23 
CLICK_DECLS


25 
	gK”ÃlT­
::
	$K”ÃlT­
()

27 
_p
 = 
Œue
;

28 
	}
}

30 
CLICK_ENDDECLS


31 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
K”ÃlTun
)

32 
	`EXPORT_ELEMENT
(
K”ÃlT­
)

	@userlevel/kerneltap.hh

2 #iâdeà
CLICK_KERNELTAP_HH


3 
	#CLICK_KERNELTAP_HH


	)

4 
	~"k”ÃÉun.hh
"

5 
CLICK_DECLS


81 şas 
	cK”ÃlT­
 : 
public
 
K”ÃlTun
 {…ublic:

83 
	$K”ÃlT­
(è
CLICK_COLD
;

85 cÚ¡ *
	$şass_Çme
() const {  "KernelTap"; }

87 
	}
};

89 
	gCLICK_ENDDECLS


	@userlevel/kerneltun.cc

20 
	~<şick/cÚfig.h
>

21 
	~"k”ÃÉun.hh
"

22 
	~"çk•ÿp.hh
"

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/b™veùÜ.hh
>

25 
	~<şick/¬gs.hh
>

26 
	~<şick/¡¿ccum.hh
>

27 
	~<şick/glue.hh
>

28 
	~<şickÃt/‘h”.h
>

29 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

30 
	~<uni¡d.h
>

31 
	~<fú.h
>

32 
	~<sys/ioùl.h
>

33 
	~<¬·/š‘.h
>

35 #ià
defšed
(
__lšux__
è&& defšed(
HAVE_LINUX_IF_TUN_H
)

36 
	#KERNELTUN_LINUX
 1

	)

37 #–ià
defšed
(
HAVE_NET_IF_TUN_H
)

38 
	#KERNELTUN_NET
 1

	)

39 #–ià
defšed
(
__APPLE__
)

40 
	#KERNELTUN_OSX
 1

	)

43 
	~<Ãt/rou‹.h
>

45 #ià
defšed
(
HAVE_NET_IF_TAP_H
)

46 
	#KERNELTAP_NET
 1

	)

49 
	~<Ãt/if.h
>

50 #ià
HAVE_NET_IF_TUN_H


51 
	~<Ãt/if_tun.h
>

52 #–ià
HAVE_LINUX_IF_TUN_H


53 
	~<lšux/if_tun.h
>

55 #ià
HAVE_NET_IF_TAP_H


56 
	~<Ãt/if_p.h
>

59 #ià
defšed
(
__N‘BSD__
)

60 
	~<sys/·¿m.h
>

61 
	~<sys/sysùl.h
>

64 #ià
defšed
(
__F»eBSD__
)

65 
	~<Ãt/‘h”Ãt.h
>

68 
CLICK_DECLS


70 
	gK”ÃlTun
::
	$K”ÃlTun
()

71 : 
	`_fd
(-1), 
	`_p
(
çl£
), 
	`_sk
(
this
), 
	`_ignÜe_q_”rs
(false),

72 
	`_´š‹d_wr™e_”r
(
çl£
), 
	`_´š‹d_»ad_”r
(false),

73 
	`_£Ëùed_ÿÎs
(0), 
	$_·ck‘s
(0)

75 
	}
}

77 
	gK”ÃlTun
::~
	$K”ÃlTun
()

79 
	}
}

82 
K”ÃlTun
::
	$ÿ¡
(cÚ¡ *
n
)

84 ià(
	`¡rcmp
(
n
, "KernelTun") == 0)

85  
this
;

87  
EËm’t
::
	`ÿ¡
(
n
);

88 
	}
}

91 
	gK”ÃlTun
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

93 
	g_gw
 = 
IPAdd»ss
();

94 
	g_h—droom
 = 
Pack‘
::
deçuÉ_h—droom
;

95 
	g_adju¡_h—droom
 = 
çl£
;

96 
	g_h—droom
 +ğ(4 - 
_h—droom
 % 4) % 4;

97 
	g_mtu_out
 = 
DEFAULT_MTU
;

98 
	g_bur¡
 = 1;

99 ià(
Args
(
cÚf
, 
this
, 
”rh
)

100 .
»ad_mp
("ADDR", 
IPP»fixArg
(), 
_Ã¬
, 
_mask
)

101 .
»ad_p
("GATEWAY", 
_gw
)

102 .
»ad
("TAP", 
_p
)

103 .
»ad
("HEADROOM", 
_h—droom
).
»ad_¡©us
(
_adju¡_h—droom
)

104 .
»ad
("BURST", 
_bur¡
)

105 .
»ad
("ETHER", 
_maÿddr
)

106 .
»ad
("IGNORE_QUEUE_OVERFLOWS", 
_ignÜe_q_”rs
)

107 .
»ad
("MTU", 
_mtu_out
)

108 #ià
KERNELTUN_LINUX


109 .
»ad
("DEV_NAME", 
Args
::
d•»ÿ‹d
, 
_dev_Çme
)

110 .
»ad
("DEVNAME", 
_dev_Çme
)

112 .
com¶‘e
() < 0)

115 ià(
	g_gw
 && !_gw.
m©ches_´efix
(
_Ã¬
, 
_mask
))

116  
	g”rh
->
”rÜ
("bad GATEWAY");

117 ià(
	g_bur¡
 < 1)

118  
	g”rh
->
”rÜ
("BURST must be >= 1");

119 ià(
	g_mtu_out
 < (è(
	gşick_
))

120  
	g”rh
->
”rÜ
("MTU mu¡ bg»©”hª %d", (
şick_
));

121 ià(
	g_h—droom
 > 8192)

122  
	g”rh
->
”rÜ
("HEADROOMoo big");

123 
	g_adju¡_h—droom
 = !
_adju¡_h—droom
;

127 #ià
KERNELTUN_LINUX


129 
	gK”ÃlTun
::
	$Œy_lšux_univ”§l
()

131 
fd
 = 
	`İ’
("/dev/Ãt/tun", 
O_RDWR
 | 
O_NONBLOCK
);

132 ià(
fd
 < 0)

133  -
”ºo
;

135 
iäeq
 
iä
;

136 
	`mem£t
(&
iä
, 0, (ifr));

137 
iä
.
iä_æags
 = (
_p
 ? 
IFF_TAP
 : 
IFF_TUN
);

138 ià(
_dev_Çme
)

140 
	`¡ºıy
(
iä
.
iä_Çme
, 
_dev_Çme
.
	`c_¡r
(), (ifr.ifr_name));

141 
”r
 = 
	`ioùl
(
fd
, 
TUNSETIFF
, (*)&
iä
);

142 ià(
”r
 < 0) {

143 
	`şo£
(
fd
);

144  -
”ºo
;

147 
_dev_Çme
 = 
iä
.
iä_Çme
;

148 
_fd
 = 
fd
;

149 
_ty³
 = 
LINUX_UNIVERSAL
;

151 
	}
}

155 
	gK”ÃlTun
::
	$Œy_tun
(cÚ¡ 
SŒšg
 &
dev_Çme
, 
E¼ÜHªdËr
 *)

157 
SŒšg
 
f’ame
 = "/dev/" + 
dev_Çme
;

158 
fd
 = 
	`İ’
(
f’ame
.
	`c_¡r
(), 
O_RDWR
 | 
O_NONBLOCK
);

159 ià(
fd
 < 0)

160  -
”ºo
;

162 
_dev_Çme
 = 
dev_Çme
;

163 
_fd
 = 
fd
;

165 
	}
}

173 
	gK”ÃlTun
::
	$®loc_tun
(
E¼ÜHªdËr
 *
”rh
)

175 #ià!
KERNELTUN_LINUX
 && !
KERNELTUN_NET
 && !
KERNELTUN_OSX
 && !
KERNELTAP_NET


176  
”rh
->
	`”rÜ
("% i nÙ y‘ suµÜ‹d oÀthi sy¡em.\n(PËa£„•Üˆthi mes§gtØşick@lib»li¡.com.)", 
	`şass_Çme
());

179 
”rÜ
, 
§ved_”rÜ
 = 0;

180 
SŒšg
 
§ved_deviû
, 
§ved_mes§ge
;

181 
SŒšgAccum
 
Œ›d
;

183 #ià
KERNELTUN_LINUX


184 ià((
”rÜ
 = 
	`Œy_lšux_univ”§l
()) >= 0)

185  
”rÜ
;

186 ià(!
§ved_”rÜ
 || 
”rÜ
 !ğ-
ENOENT
) {

187 
§ved_”rÜ
 = 
”rÜ
, 
§ved_deviû
 = "net/tun";

188 ià(
”rÜ
 =ğ-
ENODEV
)

189 
§ved_mes§ge
 = "\n(Perhaps you‚eedoƒnableun in your kernel or†oadhe 'tun' module.)";

191 
Œ›d
 << "/dev/net/tun, ";

194 
SŒšg
 
dev_´efix
;

195 #ifdeà
__lšux__


196 
_ty³
 = 
LINUX_ETHERTAP
;

197 
dev_´efix
 = "tap";

198 #–ià
	`defšed
(
KERNELTUN_OSX
)

199 
_ty³
 = 
OSX_TUN
;

200 
dev_´efix
 = "tun";

201 #–ià
	`defšed
(
__N‘BSD__
è&& !defšed(
TUNSIFHEAD
)

202 
_ty³
 = (
_p
 ? 
NETBSD_TAP
 : 
NETBSD_TUN
);

203 
dev_´efix
 = (
_p
 ? "tap" : "tun");

205 
_ty³
 = (
_p
 ? 
BSD_TAP
 : 
BSD_TUN
);

206 
dev_´efix
 = (
_p
 ? "tap" : "tun");

209 #ià
	`defšed
(
__N‘BSD__
è&& !defšed(
TUNSIFHEAD
)

210 ià(
_ty³
 =ğ
NETBSD_TAP
) {

215 ià((
”rÜ
 = 
	`Œy_tun
(
dev_´efix
, 
”rh
)) >= 0) {

216 
iäeq
 
iä
;

217 
	`mem£t
(&
iä
, 0, (ifr));

218 ià(
	`ioùl
(
_fd
, 
TAPGIFNAME
, &
iä
) != 0)

219  
”rh
->
	`”rÜ
("TAPGIFNAME faed: %s", 
	`¡»¼Ü
(
”ºo
));

220 
_dev_Çme
 = 
iä
.
iä_Çme
;

221  
”rÜ
;

222 } ià(!
§ved_”rÜ
 || 
”rÜ
 !ğ-
ENOENT
)

223 
§ved_”rÜ
 = 
”rÜ
, 
§ved_deviû
 = 
dev_´efix
, 
§ved_mes§ge
 = 
	`SŒšg
();

224 
Œ›d
 << "/dev/" << 
dev_´efix
;

225 
”rÜ_out
;

229 
i
 = 0; i < 6; i++) {

230 ià((
”rÜ
 = 
	`Œy_tun
(
dev_´efix
 + 
	`SŒšg
(
i
), 
”rh
)) >= 0)

231  
”rÜ
;

232 ià(!
§ved_”rÜ
 || 
”rÜ
 !ğ-
ENOENT
)

233 
§ved_”rÜ
 = 
”rÜ
, 
§ved_deviû
 = 
dev_´efix
 + 
	`SŒšg
(
i
), 
§ved_mes§ge
 = String();

234 
Œ›d
 << "/dev/" << 
dev_´efix
 << 
i
 << ", ";

237 #ià
	`defšed
(
__N‘BSD__
è&& !defšed(
TUNSIFHEAD
)

238 
”rÜ_out
:

240 ià(
§ved_”rÜ
 =ğ-
ENOENT
) {

241 
Œ›d
.
	`pİ_back
(2);

242  
”rh
->
	`”rÜ
("could‚Ù fšd‡­ deviû\n(checked %s)\nYou may‚“dØlßd‡ k”ÃÈmoduËØsuµÜˆp.", 
Œ›d
.
	`c_¡r
());

244  
”rh
->
	`”rÜ
("/dev/%s: %s%s", 
§ved_deviû
.
	`c_¡r
(), 
	`¡»¼Ü
(-
§ved_”rÜ
), 
§ved_mes§ge
.c_str());

245 
	}
}

248 
	gK”ÃlTun
::
	$updown
(
IPAdd»ss
 
addr
, IPAdd»s 
mask
, 
E¼ÜHªdËr
 *
”rh
)

250 
befÜe
 = 
”rh
->
	`Ã¼Üs
();

251 
s
 = 
	`sock‘
(
PF_INET
, 
SOCK_DGRAM
, 
IPPROTO_IP
);

252 ià(
s
 < 0)

253  
”rh
->
	`”rÜ
("sock‘(èçed: %s", 
	`¡»¼Ü
(
”ºo
));

254 
iäeq
 
iä
;

255 
	`mem£t
(&
iä
, 0, (ifr));

256 
	`¡ºıy
(
iä
.
iä_Çme
, 
_dev_Çme
.
	`c_¡r
(), (ifr.ifr_name));

257 
sockaddr_š
 
iä_sš
;

258 
iä_sš
.
sš_çmy
 = 
AF_INET
;

259 #ià
HAVE_SOCKADDR_IN_SIN_LEN


260 
iä_sš
.
sš_Ën
 = (
sockaddr_š
);

262 
iä_sš
.
sš_pÜt
 = 0;

263 #ià
	`defšed
(
SIOCSIFADDR
è&& defšed(
SIOCSIFNETMASK
)

264 
Œynum
 = 0;rynum < 2;rynum++) {

270 
iä_sš
.
sš_addr
 = 
mask
;

271 
	`memıy
(&
iä
.
iä_addr
, &
iä_sš
, (ifr_sin));

272 ià(
	`ioùl
(
s
, 
SIOCSIFNETMASK
, &
iä
) == 0)

273 
Œynum
++;

274 ià(
Œynum
 == 1) {

275 
”rh
->
	`”rÜ
("SIOCSIFNETMASK faed: %s", 
	`¡»¼Ü
(
”ºo
));

276 
out
;

278 
iä_sš
.
sš_addr
 = 
addr
;

279 
	`memıy
(&
iä
.
iä_addr
, &
iä_sš
, (ifr_sin));

280 ià(
Œynum
 < 2 && 
	`ioùl
(
s
, 
SIOCSIFADDR
, &
iä
) != 0) {

281 
”rh
->
	`”rÜ
("SIOCSIFADDR faed: %s", 
	`¡»¼Ü
(
”ºo
));

282 
out
;

288 #ià
	`defšed
(
KERNELTUN_OSX
)

291 
£q
 = 0;

293 
¹_msghdr
 
msghdr
;

294 
sockaddr_š
 
sš
[3];

295 } 
msg
;

297 
	`mem£t
(&
msg
, 0, (msg));

298 
msg
.
msghdr
.
¹m_msgËn
 = (msg);

299 
msg
.
msghdr
.
¹m_v”siÚ
 = 
RTM_VERSION
;

300 
msg
.
msghdr
.
¹m_ty³
 = 
RTM_ADD
;

301 
msg
.
msghdr
.
¹m_šdex
 = 0;

302 
msg
.
msghdr
.
¹m_pid
 = 0;

303 
msg
.
msghdr
.
¹m_addrs
 = 
RTA_DST
 | 
RTA_GATEWAY
 | 
RTA_NETMASK
;

304 
msg
.
msghdr
.
¹m_£q
 = ++
£q
;

305 
msg
.
msghdr
.
¹m_”ºo
 = 0;

306 
msg
.
msghdr
.
¹m_æags
 = 
RTF_UP
 | 
RTF_GATEWAY
;

308 
i
 = 0; i < (
msg
.
sš
) / (msg.sin[0]); i++) {

309 
msg
.
sš
[
i
].
sš_Ën
 = (msg.sin[0]);

310 
msg
.
sš
[
i
].
sš_çmy
 = 
AF_INET
;

313 
msg
.
sš
[0].
sš_addr
 = 
addr
 & 
mask
;

314 
msg
.
sš
[1].
sš_addr
 = 
addr
;

315 
msg
.
sš
[2].
sš_addr
 = 
mask
;

317 
s
 = 
	`sock‘
(
PF_ROUTE
, 
SOCK_RAW
, 
AF_INET
);

318 ià(
s
 < 0) {

319 
”rh
->
	`w¬nšg
("O³nšg‡ PF_ROUTE sock‘ faed: %s", 
	`¡»¼Ü
(
”ºo
));

320 
out
;

322 
r
 = 
	`wr™e
(
s
, (*)&
msg
, (msg));

323 ià(
r
 < 0) {

324 
”rh
->
	`w¬nšg
("Wr™šgØthPF_ROUTE sock‘ faed: %s", 
	`¡»¼Ü
(
”ºo
));

326 
r
 = 
	`şo£
(
s
);

327 ià(
r
 < 0) {

328 
”rh
->
	`w¬nšg
("ClosšghPF_ROUTE sock‘ faed: %s", 
	`¡»¼Ü
(
”ºo
));

332 #ià
	`defšed
(
SIOCSIFHWADDR
)

333 ià(
_maÿddr
) {

334 
iä
.
iä_hwaddr
.
§_çmy
 = 
ARPHRD_ETHER
;

335 
	`memıy
(
iä
.
iä_hwaddr
.
§_d©a
, 
_maÿddr
.
	`d©a
(), (_macaddr));

336 ià(
	`ioùl
(
s
, 
SIOCSIFHWADDR
, &
iä
) != 0)

337 
”rh
->
	`w¬nšg
("could‚Ù s‘ iÁ”çû Eth”Ãˆadd»ss: %s", 
	`¡»¼Ü
(
”ºo
));

339 #–ià
	`defšed
(
__N‘BSD__
)

340 ià(
_maÿddr
 && 
_p
) {

341 
SŒšg
 
p
 = "Ãt.lšk.p." + 
_dev_Çme
, 
mac
 = 
_maÿddr
.
	`uÅ¬£_cŞÚ
();

342 
r
 = 
	`sysùlbyÇme
(
p
.
	`c_¡r
(), (*è0, (
size_t
 *è0, (*è
mac
.c_¡r(), mac.
	`Ëngth
());

343 ià(
r
 < 0)

344 
”rh
->
	`w¬nšg
("could‚Ù s‘ iÁ”çû Eth”Ãˆadd»ss: %s", 
	`¡»¼Ü
(
”ºo
));

345 } ià(
_maÿddr
)

346 
”rh
->
	`w¬nšg
("could‚ot set interface Ethernet‡ddress:‚o support for /dev/tun");

347 #–ià
	`defšed
(
__F»eBSD__
)

348 ià(
_maÿddr
 && 
_p
) {

349 
iä
.
iä_addr
.
§_Ën
 = 
ETHER_ADDR_LEN
;

350 
iä
.
iä_addr
.
§_çmy
 = 
AF_LINK
;

351 
	`memıy
(
iä
.
iä_addr
.
§_d©a
, 
_maÿddr
.
	`d©a
(), 
ETHER_ADDR_LEN
);

352 ià(
	`ioùl
(
s
, 
SIOCSIFLLADDR
, &
iä
) != 0)

353 
”rh
->
	`w¬nšg
("could‚Ù s‘ iÁ”çû Eth”Ãˆadd»ss: %s", 
	`¡»¼Ü
(
”ºo
));

354 } ià(
_maÿddr
)

355 
”rh
->
	`w¬nšg
("could‚ot set interface Ethernet‡ddress:‚o support for /dev/tun");

357 ià(
_maÿddr
)

358 
”rh
->
	`w¬nšg
("could‚ot set interface Ethernet‡ddress:‚o support");

360 #ià
	`defšed
(
SIOCSIFMTU
)

361 ià(
_mtu_out
 !ğ
DEFAULT_MTU
) {

362 
iä
.
iä_mtu
 = 
_mtu_out
;

363 ià(
	`ioùl
(
s
, 
SIOCSIFMTU
, &
iä
) != 0)

364 
”rh
->
	`w¬nšg
("could‚Ù s‘ iÁ”çû MTU: %s", 
	`¡»¼Ü
(
”ºo
));

367 #ià
	`defšed
(
SIOCGIFFLAGS
è&& defšed(
SIOCSIFFLAGS
)

368 ià(
	`ioùl
(
s
, 
SIOCGIFFLAGS
, &
iä
) != 0) {

369 
”rh
->
	`”rÜ
("SIOCGIFFLAGS faed: %s", 
	`¡»¼Ü
(
”ºo
));

370 
out
;

372 ià(
_p
)

373 
iä
.
iä_æags
 = (
addr
 ? iä.iä_æag & ~
IFF_NOARP
 : ifr.ifr_flags | IFF_NOARP);

374 
iä
.
iä_æags
 = (
addr
 ? iä.iä_æag | 
IFF_UP
 | 
IFF_PROMISC
 : ifr.ifr_flags & ~IFF_UP & ~IFF_PROMISC);

375 ià(
	`ioùl
(
s
, 
SIOCSIFFLAGS
, &
iä
) != 0) {

376 
”rh
->
	`”rÜ
("SIOCSIFFLAGS faed: %s", 
	`¡»¼Ü
(
”ºo
));

377 
out
;

382 
out
:

383 
	`şo£
(
s
);

384  (
”rh
->
	`Ã¼Üs
(è=ğ
befÜe
 ? 0 : -1);

385 
	}
}

388 
	gK”ÃlTun
::
	$£tup_tun
(
E¼ÜHªdËr
 *
”rh
)

394 #ià
	`defšed
(
TUNSIFMODE
è|| defšed(
__F»eBSD__
)

395 ià(!
_p
) {

396 
mode
 = 
IFF_BROADCAST
;

397 ià(
	`ioùl
(
_fd
, 
TUNSIFMODE
, &
mode
) != 0)

398  
”rh
->
	`”rÜ
("TUNSIFMODE faed: %s", 
	`¡»¼Ü
(
”ºo
));

401 #ià
	`defšed
(
__O³nBSD__
)

402 ià(!
_p
) {

403 
tunšfo
 
ti
;

404 
	`mem£t
(&
ti
, 0, (
tunšfo
));

405 ià(
	`ioùl
(
_fd
, 
TUNGIFINFO
, &
ti
) != 0)

406  
”rh
->
	`”rÜ
("TUNGIFINFO faed: %s", 
	`¡»¼Ü
(
”ºo
));

407 
ti
.
æags
 &ğ
IFF_BROADCAST
;

408 ià(
	`ioùl
(
_fd
, 
TUNSIFINFO
, &
ti
) != 0)

409  
”rh
->
	`”rÜ
("TUNSIFINFO faed: %s", 
	`¡»¼Ü
(
”ºo
));

413 #ià
	`defšed
(
TUNSIFHEAD
è|| defšed(
__F»eBSD__
)

416 ià(!
_p
 && 
_ty³
 =ğ
BSD_TUN
) {

417 
yes
 = 1;

418 ià(
	`ioùl
(
_fd
, 
TUNSIFHEAD
, &
yes
) != 0)

419  
”rh
->
	`”rÜ
("TUNSIFHEAD faed: %s", 
	`¡»¼Ü
(
”ºo
));

424 ià(
	`updown
(
_Ã¬
, 
_mask
, 
”rh
) < 0)

427 ià(
_gw
) {

428 
SŒšg
 
cmd
 = "/sbin/route -n‡dd default ";

429 #ià
	`defšed
(
__lšux__
)

430 
cmd
 +ğ"gw " + 
_gw
.
	`uÅ¬£
();

432 
cmd
 +ğ
_gw
.
	`uÅ¬£
();

434 ià(
	`sy¡em
(
cmd
.
	`c_¡r
()) != 0)

435  
”rh
->
	`”rÜ
("%s: %s", 
cmd
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

440 ià(
_p
) {

441 ià(
_ty³
 =ğ
LINUX_UNIVERSAL
)

442 
_mtu_š
 = 
_mtu_out
 + 18;

443 ià(
_ty³
 =ğ
LINUX_ETHERTAP
)

444 
_mtu_š
 = 
_mtu_out
 + 16;

446 
_mtu_š
 = 
_mtu_out
 + 14;

447 } ià(
_ty³
 =ğ
LINUX_UNIVERSAL
)

448 
_mtu_š
 = 
_mtu_out
 + 4;

449 ià(
_ty³
 =ğ
BSD_TUN
)

450 
_mtu_š
 = 
_mtu_out
 + 4;

451 ià(
_ty³
 =ğ
BSD_TAP
 || _ty³ =ğ
NETBSD_TAP
 || _ty³ =ğ
NETBSD_TUN
)

452 
_mtu_š
 = 
_mtu_out
;

453 ià(
_ty³
 =ğ
OSX_TUN
)

454 
_mtu_š
 = 
_mtu_out
 + 4;

456 
_mtu_š
 = 
_mtu_out
 + 16;

459 
	}
}

462 
	gK”ÃlTun
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

464 ià(
	`®loc_tun
(
”rh
) < 0)

466 ià(
	`£tup_tun
(
”rh
) < 0)

468 ià(
	`šput_is_puÎ
(0)) {

469 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

470 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

472 ià(
_adju¡_h—droom
) {

473 ià(
_p
 && 
_ty³
 =ğ
LINUX_UNIVERSAL
)

474 
_h—droom
 += (4 - (_headroom + 2) % 4) % 4;

476 
_h—droom
 += (4 - _headroom % 4) % 4;

478 
	`add_£Ëù
(
_fd
, 
SELECT_READ
);

480 
	}
}

483 
	gK”ÃlTun
::
	$ş—nup
(
CËªupSge
)

485 ià(
_fd
 >= 0) {

486 ià(
_ty³
 !ğ
LINUX_UNIVERSAL
 && _ty³ !ğ
NETBSD_TAP
)

487 
	`updown
(0, ~0, 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

488 
	`şo£
(
_fd
);

489 
	`»move_£Ëù
(
_fd
, 
SELECT_READ
);

491 
	}
}

494 
	gK”ÃlTun
::
	$£Ëùed
(
fd
, )

496 
Time¡amp
 
now
 = Time¡amp::
	`now
();

497 ià(
fd
 !ğ
_fd
)

499 ++
_£Ëùed_ÿÎs
;

500 
n
 = 
_bur¡
;

501 
n
 > 0 && 
	`Úe_£Ëùed
(
now
))

502 --
n
;

503 
	}
}

505 
boŞ


506 
	gK”ÃlTun
::
	$Úe_£Ëùed
(cÚ¡ 
Time¡amp
 &
now
)

508 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
_h—droom
, 0, 
_mtu_š
, 0);

509 ià(!
p
) {

510 
	`şick_ch©‹r
("out of memory!");

511  
çl£
;

514 
cc
 = 
	`»ad
(
_fd
, 
p
->
	`d©a
(), 
_mtu_š
);

515 ià(
cc
 > 0) {

516 ++
_·ck‘s
;

517 
p
->
	`ke
(
_mtu_š
 - 
cc
);

518 
boŞ
 
ok
 = 
çl£
;

520 ià(
_p
) {

521 ià(
_ty³
 =ğ
LINUX_UNIVERSAL
)

523 
p
->
	`puÎ
(4);

524 ià(
_ty³
 =ğ
LINUX_ETHERTAP
)

526 
p
->
	`puÎ
(2);

527 
ok
 = 
Œue
;

528 } ià(
_ty³
 =ğ
LINUX_UNIVERSAL
) {

530 
ušt16_t
 
‘y³
 = *(ušt16_ˆ*)(
p
->
	`d©a
() + 2);

531 
p
->
	`puÎ
(4);

532 ià(
‘y³
 !ğ
	`htÚs
(
ETHERTYPE_IP
è&&ƒty³ !ğhtÚs(
ETHERTYPE_IP6
))

533 
	`checked_ouut_push
(1, 
p
->
	`şÚe
());

535 
ok
 = 
	`çke_pÿp_fÜû_
(
p
, 
FAKE_DLT_RAW
);

536 } ià(
_ty³
 =ğ
BSD_TUN
) {

538 
af
 = 
	`Áohl
(*(*)
p
->
	`d©a
());

539 
p
->
	`puÎ
(4);

540 ià(
af
 !ğ
AF_INET
 &&‡à!ğ
AF_INET6
) {

541 
	`şick_ch©‹r
("K”ÃlTun(%s): dÚ'ˆknow AF %d", 
_dev_Çme
.
	`c_¡r
(), 
af
);

542 
	`checked_ouut_push
(1, 
p
->
	`şÚe
());

544 
ok
 = 
	`çke_pÿp_fÜû_
(
p
, 
FAKE_DLT_RAW
);

545 } ià(
_ty³
 =ğ
OSX_TUN
 || _ty³ =ğ
NETBSD_TUN
) {

546 
ok
 = 
	`çke_pÿp_fÜû_
(
p
, 
FAKE_DLT_RAW
);

549 
ušt16_t
 
‘y³
 = *(ušt16_ˆ*)(
p
->
	`d©a
() + 14);

550 
p
->
	`puÎ
(16);

551 ià(
‘y³
 !ğ
	`htÚs
(
ETHERTYPE_IP
è&&ƒty³ !ğhtÚs(
ETHERTYPE_IP6
))

552 
	`checked_ouut_push
(1, 
p
->
	`şÚe
());

554 
ok
 = 
	`çke_pÿp_fÜû_
(
p
, 
FAKE_DLT_RAW
);

557 ià(
ok
) {

558 
p
->
	`£t_time¡amp_ªno
(
now
);

559 
	`ouut
(0).
	`push
(
p
);

561 
	`checked_ouut_push
(1, 
p
);

562  
Œue
;

564 
p
->
	`kl
();

565 ià(
”ºo
 !ğ
EAGAIN
 &&ƒ¼nØ!ğ
EWOULDBLOCK


566 && (!
_ignÜe_q_”rs
 || !
_´š‹d_»ad_”r
 || 
”ºo
 !ğ
ENOBUFS
)) {

567 
_´š‹d_»ad_”r
 = 
Œue
;

568 
	`³¼Ü
("KernelTun„ead");

570  
çl£
;

572 
	}
}

574 
boŞ


575 
	gK”ÃlTun
::
	$run_sk
(
Task
 *)

577 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

578 ià(
p
)

579 
	`push
(0, 
p
);

580 ià(!
_sigÇl
)

581  
çl£
;

582 
_sk
.
	`ç¡_»scheduË
();

583  
p
 != 0;

584 
	}
}

587 
	gK”ÃlTun
::
	$push
(, 
Pack‘
 *
p
)

589 cÚ¡ 
şick_
 *
h
 = 0;

590 
check_Ëngth
;

593 ià(
_p
) {

594 ià(
p
->
	`Ëngth
(è< (
şick_‘h”
)) {

595 
	`şick_ch©‹r
("%s(%s):…ack‘oØsm®l", 
	`şass_Çme
(), 
_dev_Çme
.
	`c_¡r
());

596 
kl
;

599 
check_Ëngth
 = 
p
->
	`Ëngth
(è- (
şick_‘h”
);

602 
h
 = 
p
->
	`_h—d”
();

604 ià(!
p
->
	`has_ÃtwÜk_h—d”
()

605 || 
p
->
	`ÃtwÜk_Ëngth
(è< (è(
şick_
)) {

606 
	`şick_ch©‹r
("%s(%s):‚ØÃtwÜk h—d”", 
	`şass_Çme
(), 
_dev_Çme
.
	`c_¡r
());

607 
kl
:

608 
p
->
	`kl
();

610 } ià(
h
->
_v
 != 4 && iph->ip_v != 6) {

611 
	`şick_ch©‹r
("%s(%s): unknowÀIP v”siÚ %d", 
	`şass_Çme
(), 
_dev_Çme
.
	`c_¡r
(), 
h
->
_v
);

612 
kl
;

615 
p
->
	`chªge_h—droom_ªd_Ëngth
Õ->
	`h—droom
(è+…->
	`ÃtwÜk_h—d”_off£t
(),…->
	`ÃtwÜk_Ëngth
());

616 
check_Ëngth
 = 
p
->
	`Ëngth
();

620 ià(
check_Ëngth
 > 
_mtu_out
) {

621 
	`şick_ch©‹r
("%s(%s):…ack‘†¬g”hª MTU (%d)", 
	`şass_Çme
(), 
_dev_Çme
.
	`c_¡r
(), 
_mtu_out
);

622 
kl
;

625 
Wr™abËPack‘
 *
q
;

626 ià(
_p
) {

627 ià(
_ty³
 =ğ
LINUX_UNIVERSAL
) {

629 
ušt16_t
 
‘h”ty³
 = ((cÚ¡ 
şick_‘h”
 *è
p
->
	`d©a
())->
‘h”_ty³
;

630 ià((
q
 = 
p
->
	`push
(4)))

631 ((
ušt16_t
 *è
q
->
	`d©a
())[1] = 
‘h”ty³
;

632 
p
 = 
q
;

633 } ià(
_ty³
 =ğ
LINUX_ETHERTAP
) {

635 
p
 =…->
	`push
(2);

639 } ià(
_ty³
 =ğ
LINUX_UNIVERSAL
) {

641 
ušt32_t
 
‘h”ty³
 = (
h
->
_v
 =ğ4 ? 
	`htÚl
(
ETHERTYPE_IP
è: htÚl(
ETHERTYPE_IP6
));

642 ià((
q
 = 
p
->
	`push
(4)))

643 *(
ušt32_t
 *)(
q
->
	`d©a
()èğ
‘h”ty³
;

644 
p
 = 
q
;

645 } ià(
_ty³
 =ğ
BSD_TUN
) {

646 
ušt32_t
 
af
 = (
h
->
_v
 =ğ4 ? 
	`htÚl
(
AF_INET
è: htÚl(
AF_INET6
));

647 ià((
q
 = 
p
->
	`push
(4)))

648 *(
ušt32_t
 *)(
q
->
	`d©a
()èğ
af
;

649 
p
 = 
q
;

650 } ià(
_ty³
 =ğ
LINUX_ETHERTAP
) {

651 
ušt16_t
 
‘h”ty³
 = (
h
->
_v
 =ğ4 ? 
	`htÚs
(
ETHERTYPE_IP
è: htÚs(
ETHERTYPE_IP6
));

652 ià((
q
 = 
p
->
	`push
(16))) {

657 
	`memıy
(
q
->
	`d©a
(), "\x00\x00\xFE\xFD\x00\x00\x00\x00\xFE\xFD\x00\x00\x00\x00", 14);

658 *(
ušt16_t
 *)(
q
->
	`d©a
(è+ 14èğ
‘h”ty³
;

660 
p
 = 
q
;

665 ià(
p
) {

666 
w
 = 
	`wr™e
(
_fd
, 
p
->
	`d©a
(),…->
	`Ëngth
());

667 ià(
w
 !ğ(è
p
->
	`Ëngth
(è&& (
”ºo
 !ğ
ENOBUFS
 || !
_ignÜe_q_”rs
 || !
_´š‹d_wr™e_”r
)) {

668 
_´š‹d_wr™e_”r
 = 
Œue
;

669 
	`şick_ch©‹r
("%s(%s): wr™çed: %s", 
	`şass_Çme
(), 
_dev_Çme
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

671 
p
->
	`kl
();

673 
	`şick_ch©‹r
("%s(%s): ouˆoàmemÜy", 
	`şass_Çme
(), 
_dev_Çme
.
	`c_¡r
());

674 
	}
}

677 
	gK”ÃlTun
::
	$add_hªdËrs
()

679 ià(
	`šput_is_puÎ
(0))

680 
	`add_sk_hªdËrs
(&
_sk
);

681 
	`add_d©a_hªdËrs
("dev_Çme", 
HªdËr
::
OP_READ
, &
_dev_Çme
);

682 
	`add_d©a_hªdËrs
("£Ëùed_ÿÎs", 
HªdËr
::
OP_READ
, &
_£Ëùed_ÿÎs
);

683 
	`add_d©a_hªdËrs
("·ck‘s", 
HªdËr
::
OP_READ
, &
_·ck‘s
);

684 
	}
}

686 
CLICK_ENDDECLS


687 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
FakePÿp
)

688 
	`EXPORT_ELEMENT
(
K”ÃlTun
)

	@userlevel/kerneltun.hh

2 #iâdeà
CLICK_KERNELTUN_HH


3 
	#CLICK_KERNELTUN_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<şick/sk.hh
>

7 
	~<şick/nÙif›r.hh
>

8 
CLICK_DECLS


107 şas 
	cK”ÃlTun
 : 
public
 
EËm’t
 {…ublic:

109 
	$K”ÃlTun
(è
CLICK_COLD
;

110 ~
	$K”ÃlTun
(è
CLICK_COLD
;

112 cÚ¡ *
	$şass_Çme
() const {  "KernelTun"; }

113 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "0-1/1-2"; 
	}
}

114 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "a/h"; 
	}
}

115 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

116 cÚ¡ *
	$æags
(ècÚ¡ {  "S3"; 
	}
}

118 *
ÿ¡
(const *);

119 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_PRIVILEGED
 - 1; 
	}
}

120 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

121 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

122 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

123 
	$add_hªdËrs
(è
CLICK_COLD
;

125 
	`£Ëùed
(
fd
, 
mask
);

127 
	`push
(
pÜt
, 
Pack‘
 *);

128 
boŞ
 
	`run_sk
(
Task
 *);

130 
´iv©e
:

132 ’um { 
DEFAULT_MTU
 = 1500 
	}
};

133 
	eTy³
 { 
	gLINUX_UNIVERSAL
, 
	gLINUX_ETHERTAP
, 
	gBSD_TUN
, 
	gBSD_TAP
, 
	gOSX_TUN
,

134 
	gNETBSD_TUN
, 
	gNETBSD_TAP
 };

136 
	g_fd
;

137 
	g_mtu_š
;

138 
	g_mtu_out
;

139 
Ty³
 
	g_ty³
;

140 
boŞ
 
	g_p
;

141 
SŒšg
 
	g_dev_Çme
;

142 
IPAdd»ss
 
	g_Ã¬
;

143 
IPAdd»ss
 
	g_mask
;

144 
IPAdd»ss
 
	g_gw
;

145 
Eth”Add»ss
 
	g_maÿddr
;

146 
	g_h—droom
;

147 
	g_bur¡
;

148 
Task
 
	g_sk
;

149 
NÙif›rSigÇl
 
	g_sigÇl
;

151 
boŞ
 
	g_ignÜe_q_”rs
;

152 
boŞ
 
	g_´š‹d_wr™e_”r
;

153 
boŞ
 
	g_´š‹d_»ad_”r
;

154 
boŞ
 
	g_adju¡_h—droom
;

156 
şick_ušt_Ïrge_t
 
	g_£Ëùed_ÿÎs
;

157 
şick_ušt_Ïrge_t
 
	g_·ck‘s
;

159 #ià
HAVE_LINUX_IF_TUN_H


160 
Œy_lšux_univ”§l
();

162 
Œy_tun
(cÚ¡ 
SŒšg
 &, 
E¼ÜHªdËr
 *);

163 
®loc_tun
(
E¼ÜHªdËr
 *);

164 
£tup_tun
(
E¼ÜHªdËr
 *);

165 
updown
(
IPAdd»ss
, IPAdd»ss, 
E¼ÜHªdËr
 *);

166 
boŞ
 
Úe_£Ëùed
(cÚ¡ 
Time¡amp
 &
now
);

168 
ä›nd
 
şass
 
	gK”ÃlT­
;

172 
	gCLICK_ENDDECLS


	@userlevel/khandlerproxy.cc

19 
	~<şick/cÚfig.h
>

20 
	~"khªdË½roxy.hh
"

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/¬gs.hh
>

24 
	~<şick/u£ruts.hh
>

25 
	~<şick/Î½c.h
>

26 
	~<uni¡d.h
>

27 
	~<sys/ty³s.h
>

28 
	~<sys/¡©.h
>

29 
	~<fú.h
>

30 
CLICK_DECLS


32 
	gK”ÃlHªdËrProxy
::
	$K”ÃlHªdËrProxy
()

33 : 
	`_d‘aed_”rÜ_mes§ge
(
çl£
), 
	`_dÙ_h_checked
(çl£), 
	$_dÙ_h
(
çl£
)

35 
	}
}

37 
	gK”ÃlHªdËrProxy
::~
	$K”ÃlHªdËrProxy
()

39 
	}
}

42 
K”ÃlHªdËrProxy
::
	$ÿ¡
(cÚ¡ *
n
)

44 ià(
	`¡rcmp
(
n
, "HandlerProxy") == 0)

45  (
HªdËrProxy
 *)
this
;

46 ià(
	`¡rcmp
(
n
, "KernelHandlerProxy") == 0)

47  (
EËm’t
 *)
this
;

50 
	}
}

53 
	gK”ÃlHªdËrProxy
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

55 
	g_v”bo£
 = 
çl£
;

56  
Args
(
cÚf
, 
this
, 
”rh
).
»ad
("VERBOSE", 
_v”bo£
).
com¶‘e
();

60 
	gK”ÃlHªdËrProxy
::
	$add_hªdËrs
()

62 
	`add_wr™e_hªdËr
("*", 
¡¬_wr™e_hªdËr
, 0);

63 
	}
}

67 
	$com¶aš_to
(
E¼ÜHªdËr
 *
”rh
, 
”rcode
, cÚ¡ 
SŒšg
 &
com¶ašt
)

69 
SŒšg
 
csc
;

70 ià(
”rcode
 >= 0)

71 
csc
 = 
E¼ÜHªdËr
::
	`make_ªno
("c£¼", 
	`SŒšg
(
”rcode
));

72 
”rh
->
	`xmes§ge
(
E¼ÜHªdËr
::
e_”rÜ
 + 
csc
, 
com¶ašt
);

73 
	}
}

76 
	gK”ÃlHªdËrProxy
::
	$com¶aš
(
E¼ÜHªdËr
 *
”rh
, cÚ¡ 
SŒšg
 &
hÇme
,

77 
”rcode
, cÚ¡ 
SŒšg
 &
com¶ašt
)

79 ià(
”rh
)

80 
	`com¶aš_to
(
”rh
, 
”rcode
, 
com¶ašt
);

82 
i
 = 0; i < 
_Ã¼_rcvs
; i++)

83 ià((
”rh
 = 
_”r_rcvs
[
i
].
	`hook
(
hÇme
, _”r_rcvs[i].
thunk
)))

84 
	`com¶aš_to
(
”rh
, 
”rcode
, 
com¶ašt
);

86  -
EINVAL
;

87 
	}
}

90 
	gK”ÃlHªdËrProxy
::
	$com¶aš_about_İ’
(
E¼ÜHªdËr
 *
”rh
,

91 cÚ¡ 
SŒšg
 &
hÇme
, 
”ºo_v®
)

93 cÚ¡ *
dÙ
 = 
	`fšd
(
hÇme
, '.');

94 
SŒšg
 
k_–t
 = 
hÇme
.
	`sub¡ršg
(hÇme.
	`begš
(), 
dÙ
);

96 ià(
”ºo_v®
 =ğ
ENOENT
) {

97 
SŒšg
 
Œy_â
 = "/şick/" + 
k_–t
;

98 ià(
	`acûss
("/şick", 
F_OK
) < 0)

99 
	`com¶aš
(
”rh
, 
hÇme
, 
CSERR_NO_ROUTER
, "No„outer installed");

100 ià(
k_–t
 !ğ"" && 
	`acûss
(
Œy_â
.
	`c_¡r
(), 
F_OK
) < 0)

101 
	`com¶aš
(
”rh
, 
hÇme
, 
CSERR_NO_SUCH_ELEMENT
, "NØ–em’ˆÇmed '" + 
k_–t
.
	`´šbË
() + "'");

103 
	`com¶aš
(
”rh
, 
hÇme
, 
CSERR_NO_SUCH_HANDLER
, "NØhªdË¸Çmed '" + hÇme.
	`´šbË
() + "'");

104 } ià(
”ºo_v®
 =ğ
EACCES
)

105 
	`com¶aš
(
”rh
, 
hÇme
, 
CSERR_PERMISSION
, "P”missiÚ d’›d fÜ '" + hÇme.
	`´šbË
() + "'");

107 
	`com¶aš
(
”rh
, 
hÇme
, 
CSERR_UNSPECIFIED
, "HªdË¸'" + hÇme.
	`´šbË
(è+ "'ƒ¼Ü: " + 
	`SŒšg
(
	`¡»¼Ü
(
”ºo_v®
)));

109  -
”ºo_v®
;

110 
	}
}

113 
	gK”ÃlHªdËrProxy
::
	$check_hªdËr_Çme
(cÚ¡ 
SŒšg
 &
hÇme
, 
E¼ÜHªdËr
 *
”rh
)

115 cÚ¡ *
dÙ
 = 
	`fšd
(
hÇme
, '.');

116 ià(
dÙ
 >ğ
hÇme
.
	`’d
() - 1)

117  
	`com¶aš
(
”rh
, 
hÇme
, 
CSERR_SYNTAX
, "Bad hªdË¸Çm'" + hÇme.
	`´šbË
() + "'");

120 cÚ¡ *
s
 = 
hÇme
.
	`begš
(); s < 
dÙ
; s++)

121 ià(!
	`i§Êum
((è*
s
) && *s != '_' && *s != '/' && *s != '@')

122  
	`com¶aš
(
”rh
, 
hÇme
, 
CSERR_SYNTAX
, "Bad ch¬aù” iÀ–em’ˆÇm'" + hÇme.
	`sub¡ršg
(hÇme.
	`begš
(), 
dÙ
).
	`´šbË
() + "'");

123 cÚ¡ *
s
 = 
dÙ
 + 1; s < 
hÇme
.
	`’d
(); s++)

124 ià(*
s
 < 32 || *s >= 127 || *s == '/')

125  
	`com¶aš
(
”rh
, 
hÇme
, 
CSERR_SYNTAX
, "Bad ch¬aù” iÀhªdË¸Çm'" + hÇme.
	`´šbË
() + "'");

126 ià((
dÙ
 =ğ
hÇme
.
	`’d
() - 2 && dot[1] == '.')

127 || (
dÙ
 =ğ
hÇme
.
	`’d
() - 3 && dot[1] == '.' && dot[2] == '.'))

128  
	`com¶aš
(
”rh
, 
hÇme
, 
CSERR_SYNTAX
, "Bad hªdË¸Çm'" + hÇme.
	`´šbË
() + "'");

131 
	}
}

133 
SŒšg


134 
	gK”ÃlHªdËrProxy
::
	$hªdËr_Çme_to_fe_Çme
(cÚ¡ 
SŒšg
 &
¡r
)

136 ià(!
_dÙ_h_checked
) {

137 
_dÙ_h_checked
 = 
Œue
;

138 
_dÙ_h
 = (
	`acûss
("/şick/.h", 
F_OK
) >= 0);

141 cÚ¡ *
dÙ
 = 
	`fšd
(
¡r
, '.');

142 
SŒšg
 
h·¹
 = 
¡r
.
	`sub¡ršg
(
dÙ
 + 1, sŒ.
	`’d
());

143 ià(
_dÙ_h
)

144 
h·¹
 = 
SŒšg
::
	`make_¡abË
(".h/", 3) + hpart;

146 ià(
dÙ
 =ğ
¡r
.
	`begš
())

147  "/şick/" + 
h·¹
;

149  "/şick/" + 
¡r
.
	`sub¡ršg
(¡r.
	`begš
(), 
dÙ
è+ "/" + 
h·¹
;

150 
	}
}

153 
	gK”ÃlHªdËrProxy
::
	$¡¬_wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¡r
, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *
”rh
)

155 
K”ÃlHªdËrProxy
 *
khp
 = 
¡©ic_ÿ¡
<K”ÃlHªdËrProxy *>(
e
);

156 ià(
khp
->
	`check_hªdËr_Çme
(
¡r
, 
”rh
) < 0)

158 
khp
->
	`£t_hªdËr
(
¡r
, 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, 
hªdËr_hook
);

159  
Rou‹r
::
	`hšdex
(
e
, 
¡r
);

160 
	}
}

163 
	gK”ÃlHªdËrProxy
::
	$check_hªdËr
(cÚ¡ 
SŒšg
 &
hÇme
, 
boŞ
 
wr™e
, 
E¼ÜHªdËr
 *
”rh
)

165 ià(
	`check_hªdËr_Çme
(
hÇme
, 
”rh
) < 0)

168 
SŒšg
 
â
 = 
	`hªdËr_Çme_to_fe_Çme
(
hÇme
);

169 ià(
	`acûss
(
â
.
	`c_¡r
(), (
wr™e
 ? 
W_OK
 : 
R_OK
)) < 0) {

170 
	`com¶aš_about_İ’
(
”rh
, 
hÇme
, 
”ºo
);

175 
¡©
 
buf
;

176 
	`¡©
(
â
.
	`c_¡r
(), &
buf
);

177 ià(
	`S_ISDIR
(
buf
.
¡_mode
)) {

178 
”rh
->
	`”rÜ
("{c£¼:%d}NØhªdË¸Çmed '%#s'", 
CSERR_NO_SUCH_HANDLER
, 
hÇme
.
	`´šbË
().
	`c_¡r
());

181 
”rh
->
	`mes§ge
("% hªdË¸'%s' OK", (
wr™e
 ? "Wr™e" : "R—d"), 
hÇme
.
	`´šbË
().
	`c_¡r
());

184 
	}
}

187 
	gK”ÃlHªdËrProxy
::
	$hªdËr_hook
(
İ
, 
SŒšg
& 
¡r
, 
EËm’t
* 
e
, cÚ¡ 
HªdËr
* 
hªdËr
, 
E¼ÜHªdËr
* 
”rh
)

189 
K”ÃlHªdËrProxy
 *
khp
 = 
¡©ic_ÿ¡
<K”ÃlHªdËrProxy *>(
e
);

190 cÚ¡ 
SŒšg
& 
hÇme
 = 
hªdËr
->
	`Çme
();

191 
SŒšg
 
â
 = 
khp
->
	`hªdËr_Çme_to_fe_Çme
(
hÇme
);

193 ià(
İ
 =ğ
HªdËr
::
OP_READ
) {

194 
”ºo
 = 0;

195 
¡r
 = 
	`fe_¡ršg
(
â
, 0);

196 
”r
 = 
”ºo
;

197 ià(!
¡r
 && 
”r
 != 0) {

198 ià(
khp
->
_v”bo£
)

199 
khp
->
	`com¶aš_about_İ’
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
(), 
hÇme
, 
”r
);

201 
khp
->
	`com¶aš_about_İ’
(0, 
hÇme
, 
”r
);

203  -
”r
;

205 } ià(
İ
 =ğ
HªdËr
::
OP_WRITE
) {

206 
fd
 = 
	`İ’
(
â
.
	`c_¡r
(), 
O_WRONLY
 | 
O_TRUNC
);

207 ià(
fd
 < 0)

208  
khp
->
	`com¶aš_about_İ’
(
”rh
, 
hÇme
, 
”ºo
);

210 cÚ¡ * 
s
 = 
¡r
.
	`begš
();

211 cÚ¡ * 
’d
 = 
¡r
.
	`’d
();

212 
s
 < 
’d
) {

213 
ssize_t
 
wr™‹n
 = 
	`wr™e
(
fd
, 
s
, 
’d
 - s);

214 ià(
wr™‹n
 < 0 && 
”ºo
 !ğ
EINTR
) {

215 
	`şo£
(
fd
);

216  
khp
->
	`com¶aš
(
”rh
, 
hÇme
, 
CSERR_UNSPECIFIED
, 
â
 + ": " + 
	`SŒšg
(
	`¡»¼Ü
(
”ºo
)));

217 } ià(
wr™‹n
 >= 0)

218 
s
 +ğ
wr™‹n
;

221 ià(
	`şo£
(
fd
) < 0) {

222 
”r
 = 
”ºo
;

223 
khp
->
	`com¶aš
(
”rh
, 
hÇme
, 
CSERR_HANDLER_ERROR
, "E¼Üƒxecutšg k”ÃÈwr™hªdË¸'" + 
	`SŒšg
(hname) + "'");

224 ià(!
khp
->
_d‘aed_”rÜ_mes§ge
) {

225 
khp
->
	`com¶aš
(
”rh
, 
hÇme
, 
CSERR_HANDLER_ERROR
, "(Check /click/errors for details.)");

226 
khp
->
_d‘aed_”rÜ_mes§ge
 = 
Œue
;

228  -
”r
;

233  
”rh
->
	`”rÜ
("odd operation");

234 
	}
}

237 
	gK”ÃlHªdËrProxy
::
	$Î½c
(
commªd
, *
d©a
)

239 ià(
commªd
 =ğ
CLICK_LLRPC_PROXY
) {

240 
şick_Î½c_´oxy_¡
* 
´oxy
 = 
¡©ic_ÿ¡
<şick_Î½c_´oxy_¡*>(
d©a
);

241 cÚ¡ 
HªdËr
* 
h
 = 
¡©ic_ÿ¡
<HªdËr*>(
´oxy
->
´ox›d_hªdËr
);

243 
SŒšg
 
â
 = 
	`hªdËr_Çme_to_fe_Çme
(
h
->
	`Çme
());

244 
fd
 = 
	`İ’
(
â
.
	`c_¡r
(), 
O_RDONLY
);

245 
”r
 = 
”ºo
;

247 ià(
fd
 < 0) {

248 ià(
_v”bo£
)

249 
	`com¶aš_about_İ’
(
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
(), 
h
->
	`Çme
(), 
”r
);

251  
	`com¶aš_about_İ’
(0, 
h
->
	`Çme
(), 
”r
);

254 
»tv®
 = 
	`ioùl
(
fd
, 
´oxy
->
´ox›d_commªd
,…roxy->
´ox›d_d©a
);

255 
”r
 = 
”ºo
;

257 
	`şo£
(
fd
);

258  (
»tv®
 >ğ0 ?„‘v® : -
”r
);

261  
EËm’t
::
	`Î½c
(
commªd
, 
d©a
);

262 
	}
}

264 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
HªdËrProxy
)

265 
	$EXPORT_ELEMENT
(
K”ÃlHªdËrProxy
)

266 
CLICK_ENDDECLS


	@userlevel/khandlerproxy.hh

1 #iâdeà
CLICK_KERNELHANDLERPROXY_HH


2 
	#CLICK_KERNELHANDLERPROXY_HH


	)

3 
	~"–em’ts/u£¾ev–/hªdË½roxy.hh
"

4 
CLICK_DECLS


70 şas 
	cK”ÃlHªdËrProxy
 : 
public
 
HªdËrProxy
 {…ublic:

72 
	$K”ÃlHªdËrProxy
(è
CLICK_COLD
;

73 ~
	$K”ÃlHªdËrProxy
(è
CLICK_COLD
;

75 cÚ¡ * 
	$şass_Çme
() const {  "KernelHandlerProxy"; }

76 * 
	`ÿ¡
(const *);

78 
	`cÚfigu»
(
VeùÜ
<
SŒšg
>&, 
E¼ÜHªdËr
*è
CLICK_COLD
;

80 
	`check_hªdËr
(cÚ¡ 
SŒšg
&, 
boŞ
 
wr™e
, 
E¼ÜHªdËr
* 
”rh
);

82 
	$add_hªdËrs
(è
CLICK_COLD
;

83 
	`Î½c
(, *);

85 
´iv©e
:

87 
boŞ
 
_d‘aed_”rÜ_mes§ge
;

88 
boŞ
 
_v”bo£
;

89 
boŞ
 
_dÙ_h_checked
;

90 
boŞ
 
_dÙ_h
;

92 
SŒšg
 
	`hªdËr_Çme_to_fe_Çme
(cÚ¡ SŒšg &
¡r
);

93 
	`hªdËr_hook
(, 
SŒšg
&, 
EËm’t
*, cÚ¡ 
HªdËr
*, 
E¼ÜHªdËr
*);

94 
	$¡¬_wr™e_hªdËr
(cÚ¡ 
SŒšg
&, 
EËm’t
*, *, 
E¼ÜHªdËr
*è
CLICK_COLD
;

95 
	`com¶aš
(
E¼ÜHªdËr
*, cÚ¡ 
SŒšg
&, 
”rcode
, const String&);

96 
	`com¶aš_about_İ’
(
E¼ÜHªdËr
*, cÚ¡ 
SŒšg
&, );

97 
	`check_hªdËr_Çme
(cÚ¡ 
SŒšg
&, 
E¼ÜHªdËr
*);

99 
	}
};

101 
	gCLICK_ENDDECLS


	@userlevel/mcastsocket.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/”rÜ.hh
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

23 
	~<şick/·ck‘_ªno.hh
>

24 
	~<şick/·ck‘.hh
>

25 
	~<uni¡d.h
>

26 
	~<sys/ioùl.h
>

27 
	~<sys/sock‘.h
>

28 
	~<sys/un.h
>

29 
	~<¬·/š‘.h
>

30 
	~<Ãtš‘/tı.h
>

31 
	~<fú.h
>

32 
	~"mÿ¡sock‘.hh
"

34 
CLICK_DECLS


37 
	gMÿ¡Sock‘
::
	$Mÿ¡Sock‘
()

38 : 
	`_sk
(
this
),
	`_»cv_sock
(-1), 
	`_£nd_sock
(-1), 
	`_rq
(
NULL
), 
	`_wq
(NULL),

39 
	`_loİ
(
Œue
), 
	`_time¡amp
Ñrue), 
	`_rcvbuf
(-1), 
	`_¢­Ën
(2048),

40 
	`_¢dbuf
(-1), 
	$_h—droom
(
Pack‘
::
deçuÉ_h—droom
)

42 
	}
}

45 
Mÿ¡Sock‘
::~
	$Mÿ¡Sock‘
()

47 
	}
}

51 
Mÿ¡Sock‘
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

53 
IPAdd»ss
 
	gmÿ¡_
;

54 
ušt16_t
 
	gmÿ¡_pÜt
;

56 
IPAdd»ss
 
	gsourû_
;

57 
ušt16_t
 
	gsourû_pÜt
;

59 
Args
 
	g¬gs
 = Args(
this
, 
”rh
).
bšd
(
cÚf
);

60 ià(
	g¬gs


61 .
»ad_mp
("MCASTIP", 
mÿ¡_
)

62 .
»ad_mp
("MCASTPORT", 
IPPÜtArg
(
IPPROTO_UDP
), 
mÿ¡_pÜt
)

63 .
»ad_p
("SOURCEIP", 
sourû_
)

64 .
»ad_p
("SOURCEPORT", 
IPPÜtArg
(
IPPROTO_UDP
), 
sourû_pÜt
)

65 .
»ad
("SNAPLEN", 
_¢­Ën
)

66 .
»ad
("HEADROOM", 
_h—droom
)

67 .
»ad
("TIMESTAMP", 
_time¡amp
)

68 .
»ad
("RCVBUF", 
_rcvbuf
)

69 .
»ad
("SNDBUF", 
_¢dbuf
)

70 .
»ad
("LOOP", 
_loİ
)

71 .
com¶‘e
() < 0)

74 
	g_mÿ¡
.
	gsš_çmy
 = 
AF_INET
;

75 
	g_mÿ¡
.
	gsš_pÜt
 = 
htÚs
(
mÿ¡_pÜt
);

76 
	g_mÿ¡
.
	gsš_addr
 = 
mÿ¡_
.
š_addr
();

78 
	g_sourû
.
	gsš_çmy
 = 
AF_INET
;

79 
	g_sourû
.
	gsš_pÜt
 = 
htÚs
(
sourû_pÜt
);

80 
	g_sourû
.
	gsš_addr
 = 
sourû_
.
š_addr
();

87 
	gMÿ¡Sock‘
::
	$š™Ÿlize_sock‘_”rÜ
(
E¼ÜHªdËr
 *
”rh
, cÚ¡ *
sysÿÎ
)

89 
e
 = 
”ºo
;

90 
	`ş—nup
();

91  
”rh
->
	`”rÜ
("%s: %s", 
sysÿÎ
, 
	`¡»¼Ü
(
e
));

92 
	}
}

96 
	gMÿ¡Sock‘
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

98 
	#SETSOCKOPT
(
sockfd
, 
Ëv–
, 
İŠame
, 
İtv®
) \

99 ià(
	`£tsockİt
(
sockfd
, 
Ëv–
, 
İŠame
, &
İtv®
,  optval) < 0) \

100  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "£tsockİt(" #İŠam")")

	)

103 
_»cv_sock
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 
IPPROTO_UDP
);

104 
_£nd_sock
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 
IPPROTO_UDP
);

105 ià(
_»cv_sock
 < 0 || 
_£nd_sock
 < 0)

106  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "socket");

109 ià(
_¢dbuf
 >= 0)

110 
	`SETSOCKOPT
(
_£nd_sock
, 
SOL_SOCKET
, 
SO_SNDBUF
, 
_¢dbuf
);

113 ià(
_rcvbuf
 >= 0)

114 
	`SETSOCKOPT
(
_»cv_sock
, 
SOL_SOCKET
, 
SO_RCVBUF
, 
_rcvbuf
);

117 
Úe
 = 1;

118 
	`SETSOCKOPT
(
_»cv_sock
, 
SOL_SOCKET
, 
SO_REUSEADDR
, 
Úe
);

121 ià(
	`bšd
(
_»cv_sock
, (
sockaddr
 *)&
_mÿ¡
,  _mcast) < 0)

122  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "bind");

124 ià(
_sourû
.
sš_addr
.
s_addr
) {

126 ià(
	`bšd
(
_£nd_sock
, (
sockaddr
 *)&
_sourû
,  _source) < 0)

127  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "bind");

130 ià(
_sourû
.
sš_pÜt
 == 0) {

131 
sockËn_t
 
Ën
 =  
_sourû
;

132 ià(
	`g‘sockÇme
(
_£nd_sock
, (
sockaddr
 *)&
_sourû
, &
Ën
) != 0 ||†en !=  _source)

133  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "getsockname");

137 
	`SETSOCKOPT
(
_£nd_sock
, 
IPPROTO_IP
, 
IP_MULTICAST_IF
, 
_sourû
.
sš_addr
);

141 
_m»q
 
m»q
 = { 
_mÿ¡
.
sš_addr
, 
_sourû
.sin_addr };

142 
	`SETSOCKOPT
(
_»cv_sock
, 
IPPROTO_IP
, 
IP_ADD_MEMBERSHIP
, 
m»q
);

145 
loİ
 = 
_loİ
;

146 
	`SETSOCKOPT
(
_£nd_sock
, 
IPPROTO_IP
, 
IP_MULTICAST_LOOP
, 
loİ
);

149 
	`fú
(
_£nd_sock
, 
F_SETFL
, 
O_NONBLOCK
);

150 
	`fú
(
_£nd_sock
, 
F_SETFD
, 
FD_CLOEXEC
);

151 
	`fú
(
_»cv_sock
, 
F_SETFL
, 
O_NONBLOCK
);

152 
	`fú
(
_»cv_sock
, 
F_SETFD
, 
FD_CLOEXEC
);

154 ià(
	`nouuts
())

155 
	`add_£Ëù
(
_»cv_sock
, 
SELECT_READ
);

157 ià(
	`nšputs
(è&& 
	`šput_is_puÎ
(0)) {

158 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

159 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

160 
	`add_£Ëù
(
_£nd_sock
, 
SELECT_WRITE
);

164 #undeà
SETSOCKOPT


165 
	}
}

169 
	gMÿ¡Sock‘
::
	$ş—nup
(
CËªupSge
)

171 
	`ş—nup
();

172 
	}
}

176 
	gMÿ¡Sock‘
::
	$ş—nup
()

178 ià(
_»cv_sock
 >= 0) {

179 
	`»move_£Ëù
(
_»cv_sock
, 
SELECT_READ
);

180 
	`şo£
(
_»cv_sock
);

181 
_»cv_sock
 = -1;

184 ià(
_£nd_sock
 >= 0) {

185 
	`»move_£Ëù
(
_£nd_sock
, 
SELECT_WRITE
);

186 
	`şo£
(
_£nd_sock
);

187 
_£nd_sock
 = -1;

190 ià(
_rq
)

191 
_rq
->
	`kl
();

192 ià(
_wq
)

193 
_wq
->
	`kl
();

194 
	}
}

198 
	gMÿ¡Sock‘
::
	$£Ëùed
(, )

200 ià(
	`nouuts
()) {

202 ià(!
_rq
)

203 
_rq
 = 
Pack‘
::
	`make
(
_h—droom
, 0, 
_¢­Ën
, 0);

204 ià(
_rq
) {

205 
sockaddr_š
 
äom
;

206 
sockËn_t
 
äom_Ën
 =  
äom
;

207 
Ën
 = 
	`»cväom
(
_»cv_sock
, 
_rq
->
	`d©a
(), _rq->
	`Ëngth
(), 
MSG_TRUNC
,

208 (
sockaddr
 *)&
äom
, &
äom_Ën
);

209 
	`as£¹
(
äom_Ën
 =ğ 
äom
);

211 ià(
Ën
 < 0) {

212 ià(
”ºo
 !ğ
EAGAIN
) {

213 
	`şick_ch©‹r
("%s: %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

214 
	`ş—nup
();

216 } ià(
_sourû
.
sš_addr
.
s_addr
 &&

217 
_sourû
.
sš_addr
.
s_addr
 =ğ
äom
.sin_addr.s_addr &&

218 
_sourû
.
sš_pÜt
 =ğ
äom
.sin_port) {

220 
_rq
->
	`kl
();

221 
_rq
 = 
NULL
;

223 ià(
Ën
 > 
_¢­Ën
) {

225 
	`as£¹
(
_rq
->
	`Ëngth
(è=ğ(
ušt32_t
)
_¢­Ën
);

226 
	`SET_EXTRA_LENGTH_ANNO
(
_rq
, 
Ën
 - 
_¢­Ën
);

229 
_rq
->
	`ke
(
_¢­Ën
 - 
Ën
);

233 ià(
_time¡amp
)

234 
_rq
->
	`time¡amp_ªno
().
	`assign_now
();

237 
	`ouut
(0).
	`push
(
_rq
);

238 
_rq
 = 
NULL
;

243 ià(
	`nšputs
(è&& 
	`šput_is_puÎ
(0))

244 
	`run_sk
(0);

245 
	}
}

249 
	gMÿ¡Sock‘
::
	$wr™e_·ck‘
(
Pack‘
 *
p
)

251 
	`as£¹
(
_£nd_sock
 >= 0);

253 
Œue
) {

254 
Ën
 = 
	`£ndto
(
_£nd_sock
, 
p
->
	`d©a
(),…->
	`Ëngth
(), 0, (
sockaddr
 *)&
_mÿ¡
,  _mcast);

255 ià(
Ën
 =ğ(è
p
->
	`Ëngth
()) ;

258 ià(
”ºo
 =ğ
ENOBUFS
 ||ƒ¼nØ=ğ
EAGAIN
)

262 ià(
”ºo
 =ğ
EINTR
)

266 
	`şick_ch©‹r
("%s: %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

267 
	`ş—nup
();

271 
p
->
	`kl
();

273 
	}
}

277 
	gMÿ¡Sock‘
::
	$push
(, 
Pack‘
 *
p
)

279 
fd_£t
 
fds
;

280 
”r
;

282 ià(
_£nd_sock
 >= 0) {

285 
	`FD_ZERO
(&
fds
);

286 
	`FD_SET
(
_£nd_sock
, &
fds
);

287 
”r
 = 
	`£Ëù
(
_£nd_sock
 + 1, 
NULL
, &
fds
, NULL, NULL);

288 } 
”r
 < 0 && 
”ºo
 =ğ
EINTR
);

290 ià(
”r
 >= 0) {

293 
”r
 = 
	`wr™e_·ck‘
(
p
);

294 } 
”r
 < 0 && (
”ºo
 =ğ
ENOBUFS
 ||ƒ¼nØ=ğ
EAGAIN
));

297 ià(
”r
 < 0) {

298 
	`şick_ch©‹r
("%s: %s, drİpšg…ack‘", 
	`deş¬©iÚ
().
	`c_¡r
(), 
	`¡»¼Ü
(
”r
));

299 
p
->
	`kl
();

302 
p
->
	`kl
();

303 
	}
}

306 
boŞ


307 
	gMÿ¡Sock‘
::
	$run_sk
(
Task
 *)

309 
	`as£¹
(
	`nšputs
(è&& 
	`šput_is_puÎ
(0));

310 
boŞ
 
ªy
 = 
çl£
;

312 ià(
_£nd_sock
 >= 0) {

313 
Pack‘
 *
p
 = 
NULL
;

314 
”r
 = 0;

318 
p
 = 
_wq
 ? _wq : 
	`šput
(0).
	`puÎ
();

319 
_wq
 = 
NULL
;

320 ià(
p
) {

321 
ªy
 = 
Œue
;

322 
”r
 = 
	`wr™e_·ck‘
(
p
);

324 } 
p
 && 
”r
 >= 0);

326 ià(
”r
 < 0) {

328 
_wq
 = 
p
;

329 
p
 = 
NULL
;

330 
	`add_£Ëù
(
_£nd_sock
, 
SELECT_WRITE
);

331 } ià(
_sigÇl
)

334 
_sk
.
	`»scheduË
();

337 
	`»move_£Ëù
(
_£nd_sock
, 
SELECT_WRITE
);

341  
ªy
;

342 
	}
}

346 
	gMÿ¡Sock‘
::
	$add_hªdËrs
()

348 
	`add_sk_hªdËrs
(&
_sk
);

349 
	}
}

352 
CLICK_ENDDECLS


353 
EXPORT_ELEMENT
(
Mÿ¡Sock‘
)

	@userlevel/mcastsocket.hh

2 #iâdeà
CLICK_MCASTSOCKET_HH


3 
	#CLICK_MCASTSOCKET_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/¡ršg.hh
>

6 
	~<şick/sk.hh
>

7 
	~<şick/nÙif›r.hh
>

8 
	~<sys/un.h
>

9 
CLICK_DECLS


125 şas 
	cMÿ¡Sock‘
 : 
public
 
EËm’t
 {

126 
public
:

127 
	$Mÿ¡Sock‘
(è
CLICK_COLD
;

128 ~
	$Mÿ¡Sock‘
(è
CLICK_COLD
;

130 cÚ¡ *
	$şass_Çme
() const {  "McastSocket"; }

131 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "0-1/0-1"; 
	}
}

132 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "a/h"; 
	}
}

133 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

134 cÚ¡ *
	$æags
(ècÚ¡ {  "S3"; 
	}
}

136 
vœtu®
 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

137 
vœtu®
 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

138 
vœtu®
 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

140 
	$add_hªdËrs
(è
CLICK_COLD
;

141 
boŞ
 
	`run_sk
(
Task
 *);

142 
	`push
(
pÜt
, 
Pack‘
*);

144 
´iv©e
:

145 
Task
 
_sk
;

146 
_»cv_sock
;

147 
_£nd_sock
;

149 
NÙif›rSigÇl
 
_sigÇl
;

150 
Wr™abËPack‘
 *
_rq
;

151 
Pack‘
 *
_wq
;

153 
boŞ
 
_loİ
;

154 
boŞ
 
_time¡amp
;

155 
_rcvbuf
;

156 
_¢­Ën
;

157 
_¢dbuf
;

158 
_h—droom
;

160 
sockaddr_š
 
_mÿ¡
;

161 
sockaddr_š
 
_sourû
;

163 
	`ş—nup
();

164 
	`£Ëùed
(
fd
, 
mask
);

165 
	`wr™e_·ck‘
(
Pack‘
*);

166 
	`š™Ÿlize_sock‘_”rÜ
(
E¼ÜHªdËr
 *, const *);

167 
	}
};

170 
	gCLICK_ENDDECLS


	@userlevel/netmapinfo.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/glue.hh
>

21 #ià
HAVE_NET_NETMAP_H


22 
	#NETMAP_WITH_LIBS


	)

23 
	~"Ãtm­šfo.hh
"

24 
	~<sys/mmª.h
>

25 
	~<sys/ioùl.h
>

26 
	~<şick/sync.hh
>

27 
	~<uni¡d.h
>

28 
	~<fú.h
>

29 
CLICK_DECLS


35 
Spšlock
 
	gÃtm­_memÜy_lock
;

39 
	gN‘m­Info
::
	$İ’
(cÚ¡ 
SŒšg
 &
iâame
,

40 
boŞ
 
®ways_”rÜ
, 
E¼ÜHªdËr
 *
”rh
)

42 
	`şick_ch©‹r
("% iâam%s\n", 
__FUNCTION__
, 
iâame
.
	`c_¡r
());

43 
E¼ÜHªdËr
 *
š™Ÿl_”rh
 = 
®ways_”rÜ
 ? 
”rh
 : E¼ÜHªdËr::
	`s’t_hªdËr
();

45 
Ãtm­_memÜy_lock
.
	`acquœe
();

48 
desc
 = 
	`nm_İ’
(
iâame
.
	`c_¡r
(), 
NULL
, 0, NULL);

49 ià(
desc
 =ğ
NULL
) {

50 
š™Ÿl_”rh
->
	`”rÜ
("nm_İ’(%s): %s", 
iâame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

53 
	`şick_ch©‹r
("%s %s memsize %d mem %p buf_start %p buf_end %p",

54 
__FUNCTION__
, 
desc
->
»q
.
Ä_Çme
,

55 
desc
->
memsize
, desc->
mem
, desc->
buf_¡¬t
, desc->
buf_’d
);

56 
bufq
.
	`š™
(
desc
->
buf_¡¬t
, desc->
buf_’d
,

57 
desc
->
some_ršg
->
Ä_buf_size
);

59 
de¡ruùÜ_¬g
 = 
this
;

60 
	`şick_ch©‹r
("´iv©m­pšg fÜ %s\n", 
iâame
.
	`c_¡r
());

62 
Ãtm­_memÜy_lock
.
	`»Ëa£
();

63  
desc
 ? desc->
fd
 : -1;

64 
	}
}

67 
	gN‘m­Info
::
	$š™Ÿlize_ršgs_rx
(
time¡amp
)

69 
	`şick_ch©‹r
("% time¡am°%d\n", 
__FUNCTION__
, 
time¡amp
);

70 ià(
time¡amp
 >= 0) {

71 
æags
 = (
time¡amp
 > 0 ? 
NR_TIMESTAMP
 : 0);

72 
i
 = 
desc
->
fœ¡_rx_ršg
; i <ğdesc->
Ï¡_rx_ršg
; ++i)

73 
	`NETMAP_RXRING
(
desc
->
niå
, 
i
)->
æags
 = flags;

75 
	}
}

78 
	gN‘m­Info
::
	$š™Ÿlize_ršgs_tx
()

80 
	`şick_ch©‹r
("%s\n", 
__FUNCTION__
);

81 
	}
}

84 
	gN‘m­Info
::
	$di¥©ch
(
couÁ
, 
nm_cb_t
 
cb
, 
u_ch¬
 *
¬g
)

86  
	`nm_di¥©ch
(
desc
, 
couÁ
, 
cb
, 
¬g
);

87 
	}
}

89 
boŞ


90 
	gN‘m­Info
::
	$£nd_·ck‘
(
Pack‘
 *
p
, 
nouuts
)

92 
»t
 = 
	`nm_šjeù
(
desc
, 
p
->
	`d©a
(),…->
	`Ëngth
());

93 ià(0è
	`şick_ch©‹r
("%s buf %p size %d„eturns %d\n",

94 
__FUNCTION__
, 
p
->
	`d©a
(),…->
	`Ëngth
(), 
»t
);

95  
»t
 > 0 ? 0 : -1;

98 
ri
 = 
desc
->
fœ¡_tx_ršg
;„˜<ğdesc->
Ï¡_tx_ršg
; ++ri) {

99 
Ãtm­_ršg
 *
ršg
 = 
	`NETMAP_TXRING
(
desc
->
niå
, 
ri
);

100 ià(
	`nm_ršg_em±y
(
ršg
))

102 
cur
 = 
ršg
->cur;

103 
buf_idx
 = 
ršg
->
¦Ù
[
cur
].buf_idx;

104 ià(
buf_idx
 < 2)

106 *
buf
 = (*è
	`NETMAP_BUF
(
ršg
, 
buf_idx
);

107 
ušt32_t
 
p_Ëngth
 = 
p
->
	`Ëngth
();

108 ià(
N‘m­Info
::
	`is_Ãtm­_bufãr
(
p
)

109 && !
p
->
	`sh¬ed
()

110 && 
p
->
	`bufãr
(è=ğp->
	`d©a
()

111 && (*)
p
->
	`bufãr
(è>ğ
desc
->
buf_¡¬t


112 && (*)
p
->
	`bufãr
(è< 
desc
->
buf_’d


113 && 
nouuts
 == 0) {

115 
N‘m­Info
::
	`bufãr_de¡ruùÜ
(
buf
, 0, (*)
this
);

117 
ršg
->
¦Ù
[
cur
].
buf_idx
 = 
	`NETMAP_BUF_IDX
Ôšg, (*è
p
->
	`bufãr
());

118 
ršg
->
¦Ù
[
cur
].
æags
 |ğ
NS_BUF_CHANGED
;

120 
p
->
	`»£t_bufãr
();

122 
	`memıy
(
buf
, 
p
->
	`d©a
(), 
p_Ëngth
);

123 
ršg
->
¦Ù
[
cur
].
Ën
 = 
p_Ëngth
;

124 
__asm__
 volatile("" : : : "memory");

125 
ršg
->
h—d
 =„šg->
cur
 = 
	`nm_ršg_Ãxt
(ring, cur);

128 
”ºo
 = 
ENOBUFS
;

131 
	}
}

133 
	gN‘m­Info
::
	$şo£
(
fd
)

135 
	`şick_ch©‹r
("fd %d interface %s\n",

136 
fd
, 
desc
->
»q
.
Ä_Çme
);

137 
Ãtm­_memÜy_lock
.
	`acquœe
();

139 
	`nm_şo£
(
desc
);

140 
desc
 = 0;

141 
Ãtm­_memÜy_lock
.
	`»Ëa£
();

142 
	}
}

144 
	gCLICK_ENDDECLS


146 
ELEMENT_PROVIDES
(
N‘m­Info
)

	@userlevel/netmapinfo.hh

1 #iâdeà
CLICK_NETMAPINFO_HH


2 
	#CLICK_NETMAPINFO_HH
 1

	)

4 #ià
HAVE_NET_NETMAP_H


5 
	~<Ãt/if.h
>

6 
	~<Ãt/Ãtm­.h
>

7 
	~<Ãt/Ãtm­_u£r.h
>

11 #iâdeà
NETMAP_WITH_LIBS


12 (*
	tnm_cb_t
)(
	tu_ch¬
 *, cÚ¡ 
	tnm_pkthdr
 *, cÚ¡ u_ch¬ *
	td
);

15 
	~<şick/·ck‘.hh
>

16 
	~<şick/”rÜ.hh
>

17 
CLICK_DECLS


20 şas 
	cN‘m­BufQ
 {

21 *
buf_¡¬t
;

22 
buf_size
;

23 
max_šdex
;

24 *
buf_’d
;

26 
h—d
;

27 

;

28 
couÁ
;

30 
public
:

31 
šlše
 
	$š£¹
(
idx
) {

32 ià(
idx
 >ğ
max_šdex
) {

35 *
p
 = 
»š‹½»t_ÿ¡
<*>(
buf_¡¬t
 +

36 
idx
 * 
buf_size
);

38 *
p
 = 
h—d
;

39 ià(
h—d
 == 0) {

40 

 = 
idx
;

42 
h—d
 = 
idx
;

43 
couÁ
++;

46 
šlše
 
	$š£¹_p
(*
p
) {

47 ià(
p
 < 
buf_¡¬t
 ||… >ğ
buf_’d
)

49  
	`š£¹
((
p
 - 
buf_¡¬t
è/ 
buf_size
);

50 
	}
}

51 
šlše
 
	$exŒaù
() {

52 ià(
couÁ
 == 0)

54 
idx
 = 
h—d
;

55 *
p
 = 
»š‹½»t_ÿ¡
<*>(
buf_¡¬t
 +

56 
idx
 * 
buf_size
);

57 
h—d
 = *
p
;

58 
couÁ
--;

59  
idx
;

60 
	}
}

61 
šlše
 * 
	$exŒaù_p
() {

62 
idx
 = 
	`exŒaù
();

63  (
idx
 =ğ0è? 0 : 
buf_¡¬t
 + idx * 
buf_size
;

64 
	}
}

65 
šlše
 
	$š™
 (*
beg
, *
’d
, 
ušt32_t
 
_size
) {

66 
	`şick_ch©‹r
("Initializing NetmapBufQ %p size %d mem %p %p\n",

67 
this
, 
_size
, 
beg
, 
’d
);

68 
h—d
 = 

 = 
max_šdex
 = 0;

69 
couÁ
 = 0;

70 
buf_size
 = 0;

71 
buf_¡¬t
 = 
buf_’d
 = 0;

72 ià(
_size
 == 0 || _size > 0x10000 ||

73 
beg
 =ğ0 || 
’d
 == 0 ||ƒnd < beg) {

74 
	`şick_ch©‹r
("NetmapBufQ %p bad‡rgs: size %d mem %p %p\n",

75 
this
, 
_size
, 
beg
, 
’d
);

78 
buf_size
 = 
_size
;

79 
buf_¡¬t
 = 
»š‹½»t_ÿ¡
<*>(
beg
);

80 
buf_’d
 = 
»š‹½»t_ÿ¡
<*>(
’d
);

81 
max_šdex
 = (
buf_’d
 - 
buf_¡¬t
è/ 
buf_size
;

84 
	}
}

88 şas 
	cN‘m­Info
 { 
	mpublic
:

90 
nm_desc
 *
desc
;

91 
şass
 
N‘m­Info
 *
	m·»Á
;

92 
şass
 
N‘m­BufQ
 
	mbufq
;

97 
	maùive_u£rs
;

99 
N‘m­Info
 *
	mde¡ruùÜ_¬g
;

101 
İ’
(cÚ¡ 
SŒšg
 &
iâame
,

102 
boŞ
 
®ways_”rÜ
, 
E¼ÜHªdËr
 *
”rh
);

103 
š™Ÿlize_ršgs_rx
(
time¡amp
);

104 
š™Ÿlize_ršgs_tx
();

105 
şo£
(
fd
);

108 
boŞ
 
£nd_·ck‘
(
Pack‘
 *
p
, 
nouuts
);

110 
di¥©ch
(
bur¡
, 
nm_cb_t
 
cb
, 
u_ch¬
 *
¬g
);

114 
boŞ
 
	$»fl
(
Ãtm­_ršg
 *
ršg
) {

115 ià(
bufãrs
) {

116 *
buf
 = 
bufãrs
;

117 
bufãrs
 = *
»š‹½»t_ÿ¡
<**>(buffers);

118 
»s1idx
 = 
ršg
->
h—d
;

119 
ršg
->
¦Ù
[
»s1idx
].
buf_idx
 = 
	`NETMAP_BUF_IDX
Ôšg, (*è
buf
);

120 
ršg
->
¦Ù
[
»s1idx
].
æags
 |ğ
NS_BUF_CHANGED
;

121 
ršg
->
h—d
 = 
	`nm_ršg_Ãxt
Ôšg, 
»s1idx
);

122  
Œue
;

124  
çl£
;

128 
boŞ
 
	$is_Ãtm­_bufãr
(
Pack‘
 *
p
) {

129  
p
->
	`bufãr_de¡ruùÜ
(è=ğ
bufãr_de¡ruùÜ
;

130 
	}
}

136 
	$bufãr_de¡ruùÜ
(*
buf
, 
size_t
, *
¬g
) {

137 
N‘m­Info
 *
x
 = 
»š‹½»t_ÿ¡
<N‘m­InfØ*>(
¬g
);

138 
	`şick_ch©‹r
("% n˜%°buà%p\n", 
__FUNCTION__
,

139 
x
, 
buf
);

140 ià(
x
->
bufq
.
	`š£¹_p
(
buf
)) {

143 
	}
}

146 
	gCLICK_ENDDECLS


	@userlevel/printold.cc

20 
	~<şick/cÚfig.h
>

21 
	~"´štŞd.hh
"

22 
	~<şick/glue.hh
>

23 
	~<şick/cÚå¬£.hh
>

24 
	~<şick/”rÜ.hh
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/¬gs.hh
>

27 
CLICK_DECLS


29 
	gPrštOld
::
	$PrštOld
()

31 
	}
}

33 
PrštOld
::~
	$PrštOld
()

35 
	}
}

38 
PrštOld
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
* 
”rh
)

40 
	g_Ïb–
 = 
SŒšg
();

41 
	g_by‹s
 = 24;

42 
	g_th»sh
 = 5;

44 ià(
Args
(
cÚf
, 
this
, 
”rh
)

45 .
»ad_p
("LABEL", 
_Ïb–
)

46 .
»ad_p
("AGE", 
_th»sh
)

47 .
»ad_p
("MAXLENGTH", 
_by‹s
)

48 .
»ad
("LENGTH", 
Args
::
d•»ÿ‹d
, 
_by‹s
)

49 .
»ad
("NBYTES", 
Args
::
d•»ÿ‹d
, 
_by‹s
)

50 .
com¶‘e
() < 0)

56 
Pack‘
 *

57 
	gPrštOld
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

59 ià(
p
->
	`time¡amp_ªno
().
	`£c
() == 0) {

60 
	`şick_ch©‹r
("%s:…ack‘ime¡am°nÙ s‘", 
	`Çme
().
	`c_¡r
());

61  
p
;

64 
by‹s
 = 
_by‹s
;

65 ià(
by‹s
 < 0 || (è
p
->
	`Ëngth
() < bytes)

66 
by‹s
 = 
p
->
	`Ëngth
();

67 
SŒšgAccum
 
	`§
(3*
by‹s
 + 
_Ïb–
.
	`Ëngth
() + 55);

68 ià(
§
.
	`out_of_memÜy
()) {

69 
	`şick_ch©‹r
("no memory for PrintOld");

70  
p
;

73 
Time¡amp
 
now
 = Time¡amp::
	`now
();

75 
age_s
 = 
now
.
	`£c
(è- 
p
->
	`time¡amp_ªno
().sec();

76 
age_u
 = 
now
.
	`u£c
(è- 
p
->
	`time¡amp_ªno
().usec();

79 
age_ms
 = 
age_s
 * 1000 + 
age_u
 / 1000;

82 
	`as£¹
(() == ());

83 ià(
age_ms
 > 
_th»sh
)

84 
	`şick_ch©‹r
("%s Now-FromDevice‡ge is %d (FromDeviceime: %p{timestamp} dsec %ld dusec %ld)",

85 
	`Çme
().
	`c_¡r
(), 
age_ms
, &
p
->
	`time¡amp_ªno
(), 
age_s
, 
age_u
);

90 
timev®
 
pÿp_tv
;

91 
pÿp_tv
.
tv_£c
 = (è
p
->
	`u£r_ªno_i
(0);

92 
pÿp_tv
.
tv_u£c
 = (è
p
->
	`u£r_ªno_i
(1);

93 ià(
pÿp_tv
.
tv_£c
 == 0) {

97 
age2_s
 = 
p
->
	`time¡amp_ªno
().
	`£c
(è- 
pÿp_tv
.
tv_£c
;

98 
age2_u
 = 
p
->
	`time¡amp_ªno
().
	`u£c
(è- 
pÿp_tv
.
tv_u£c
;

99 
age2_ms
 = 
age2_s
 * 1000 + 
age2_u
 / 1000;

100 ià(
age2_ms
 > 
_th»sh
)

101 
	`şick_ch©‹r
("%s FromDevice-PCAP‡ge is %d (PCAPime: %ld.%06ld dsec %ld dusec %ld)",

102 
	`Çme
().
	`c_¡r
(), 
age2_ms
,

103 
pÿp_tv
.
tv_£c
,…ÿp_tv.
tv_u£c
,

104 
age2_s
, 
age2_u
);

108 ià(
age_ms
 < 
_th»sh
)

109  
p
;

113 
§
 << 
_Ïb–
;

116 
Ën
;

117 
	`¥rštf
(
§
.
	`»£rve
(9), "(%5ld m£csè%4d | %n", 
age_ms
, 
p
->
	`Ëngth
(), &
Ën
);

118 
§
.
	`adju¡_Ëngth
(
Ën
);

120 *
buf
 = 
§
.
	`d©a
(è+ sa.
	`Ëngth
();

121 
pos
 = 0;

122 
i
 = 0; i < 
by‹s
; i++) {

123 
	`¥rštf
(
buf
 + 
pos
, "%02x", 
p
->
	`d©a
()[
i
] & 0xff);

124 
pos
 += 2;

125 ià((
i
 % 4è=ğ3è
buf
[
pos
++] = ' ';

127 
§
.
	`adju¡_Ëngth
(
pos
);

129 
	`şick_ch©‹r
("%s", 
§
.
	`c_¡r
());

131  
p
;

132 
	}
}

134 
CLICK_ENDDECLS


135 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
çl£
)

136 
	`EXPORT_ELEMENT
(
PrštOld
)

	@userlevel/printold.hh

1 #iâdeà
CLICK_PRINTOLD_HH


2 
	#CLICK_PRINTOLD_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/¡ršg.hh
>

5 
CLICK_DECLS


31 şas 
	cPrštOld
 : 
public
 
EËm’t
 {…ublic:

33 
	$PrštOld
(è
CLICK_COLD
;

34 ~
	$PrštOld
(è
CLICK_COLD
;

36 cÚ¡ *
	$şass_Çme
() const {  "PrintOld"; }

37 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

39 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

41 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

43 
	g´iv©e
:

45 
SŒšg
 
_Ïb–
;

46 
	g_by‹s
;

47 
	g_th»sh
;

50 
	gCLICK_ENDDECLS


	@userlevel/progressbar.cc

19 
	~<şick/cÚfig.h
>

20 
	~"´og»ssb¬.hh
"

21 
	~<şick/¬gs.hh
>

22 
	~<şick/rou‹r.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/¡¿ccum.hh
>

25 
	~<şick/hªdËrÿÎ.hh
>

26 #ifdeà
HAVE_TERMIO_H


27 
	~<‹rmio.h
>

29 
	~<‹rmios.h
>

30 
	~<uni¡d.h
>

31 
	~<sys/ioùl.h
>

32 
CLICK_DECLS


34 
	gProg»ssB¬
::
	$Prog»ssB¬
()

35 : 
	`_¡©us
(
ST_FIRST
), 
	$_tim”
(
this
)

37 
	}
}

39 
	gProg»ssB¬
::~
	$Prog»ssB¬
()

41 
	}
}

44 
Prog»ssB¬
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *)

50 
	gProg»ssB¬
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

52 
_š‹rv®
 = 250;

53 
_d–ay_ms
 = 0;

54 
_aùive
 = 
Œue
;

55 
_size
 = -1;

56 
SŒšg
 
pos™iÚ_¡r
, 
size_¡r
;

57 
boŞ
 
check_¡dout
 = 
çl£
, 
have_size
 = false;

59 
VeùÜ
<
SŒšg
> 
cÚf
;

60 
	`ı_¬gvec
(
	`cÚfigu¿tiÚ
(), 
cÚf
);

61 ià(
	`Args
(
cÚf
, 
this
, 
”rh
)

62 .
	`»ad_mp
("POSHANDLER", 
	`AnyArg
(), 
pos™iÚ_¡r
)

63 .
	`»ad_p
("SIZEHANDLER", 
	`AnyArg
(), 
size_¡r
)

64 .
	`»ad
("UPDATE", 
	`SecÚdsArg
(3), 
_š‹rv®
)

65 .
	`»ad
("BANNER", 
_bªÃr
)

66 .
	`»ad
("ACTIVE", 
_aùive
)

67 .
	`»ad
("DELAY", 
	`SecÚdsArg
(3), 
_d–ay_ms
)

68 .
	`»ad
("CHECK_STDOUT", 
check_¡dout
)

69 .
	`»ad
("FIXED_SIZE", 
_size
).
	`»ad_¡©us
(
have_size
)

70 .
	`com¶‘e
() < 0)

73 
VeùÜ
<
SŒšg
> 
wÜds
;

74 
	`ı_¥aûvec
(
size_¡r
, 
wÜds
);

75 
_fœ¡_pos_h
 = 
wÜds
.
	`size
();

76 
	`ı_¥aûvec
(
pos™iÚ_¡r
, 
wÜds
);

77 
_es
.
	`assign
(
wÜds
.
	`size
(), 0);

78 
_hs
.
	`assign
(
wÜds
.
	`size
(), 0);

80 
i
 = 0; i < 
wÜds
.
	`size
(); i++)

81 ià(!
	`ı_hªdËr
(
wÜds
[
i
], 
HªdËr
::
OP_READ
, &
_es
[i], &
_hs
[i], 
this
, 
”rh
))

84 ià(!
	`i§‰y
(
STDERR_FILENO
è|| (
check_¡dout
 && i§‰y(
STDOUT_FILENO
)))

85 
_¡©us
 = 
ST_DEAD
;

87 
_¡©us
 = 
ST_FIRST
;

89 
_have_size
 = 
have_size
;

90 
_tim”
.
	`š™Ÿlize
(
this
);

91 ià(
_aùive
 && 
_¡©us
 !ğ
ST_DEAD
)

92 
_tim”
.
	`scheduË_now
();

94 
	}
}

97 
	gProg»ssB¬
::
	$ş—nup
(
CËªupSge
)

99 ià(
_¡©us
 =ğ
ST_MIDDLE
) {

100 
_¡©us
 = 
ST_DONE
;

101 
	`run_tim”
(&
_tim”
);

103 
	}
}

110 
boŞ


111 
	$fÜeground´oc
(
fd
)

113 
pid_t
 
pg½
 = -1;

114 
ùty_pg½
;

116 ià(
pg½
 == -1)

117 
pg½
 = 
	`g‘pg½
();

119 #ifdeà
HAVE_TCGETPGRP


120  ((
ùty_pg½
 = 
	`tcg‘pg½
(
fd
)) != -1 &&

121 
ùty_pg½
 =ğ
pg½
);

123  ((
	`ioùl
(
fd
, 
TIOCGPGRP
, &
ùty_pg½
) != -1 &&

124 
ùty_pg½
 =ğ
pg½
));

126 
	}
}

129 
	$g‘‰ywidth
()

132 
wšsize
 winsize;

133 ià(
	`ioùl
(
STDERR_FILENO
, 
TIOCGWINSZ
, &
wšsize
è!ğ-1 && wšsize.
ws_cŞ
)

134  (
wšsize
.
ws_cŞ
 ? winsize.ws_col : 80);

137 
	}
}

139 cÚ¡ 
	gb¬
[] =

144 cÚ¡ 
	gbad_b¬
[] =

149 cÚ¡ 
	gmax_b¬_Ëngth
 = 240;

150 cÚ¡ 
	g´efixes
[] = " KMGTP";

152 
	#STALLTIME
 5

	)

154 
boŞ


155 
	gProg»ssB¬
::
	$g‘_v®ue
(
fœ¡
, 
Ï¡
, *
v®ue
)

157 *
v®ue
 = 0;

158 
boŞ
 
®l_known
 = 
Œue
;

159 
i
 = 
fœ¡
; i < 
Ï¡
; i++) {

160 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
_hs
[
i
]->
	`ÿÎ_»ad
(
_es
[i]));

161 
this_v®ue
;

162 
boŞ
 
ok
 = 
	`DoubËArg
().
	`·r£
(
s
, 
this_v®ue
);

163 ià(
ok
)

164 *
v®ue
 +ğ
this_v®ue
;

166 
®l_known
 = 
çl£
;

168  (
fœ¡
 =ğ
Ï¡
 ? 
çl£
 : 
®l_known
);

169 
	}
}

172 
	gProg»ssB¬
::
	$run_tim”
(
Tim”
 *)

175 ià(!
_aùive
 || 
_¡©us
 =ğ
ST_DEAD
)

179 ià(
_¡©us
 =ğ
ST_FIRST
 || _¡©u =ğ
ST_FIRSTDONE
) {

180 ià(!
_have_size
)

181 
_have_size
 = 
	`g‘_v®ue
(0, 
_fœ¡_pos_h
, &
_size
);

182 
_Ï¡_pos
 = 0;

183 
_Ï¡_time
 = 
_¡¬t_time
 = 
Time¡amp
::
	`now
();

184 
_¡®l_time
 = 
	`Time¡amp
();

185 
_d–ay_time
 = 
_¡¬t_time
 + 
Time¡amp
::
	`make_m£c
(
_d–ay_ms
);

186 ià(
_¡©us
 =ğ
ST_FIRST
)

187 
_¡©us
 = 
ST_MIDDLE
;

191 ià(!
	`fÜeground´oc
(
STDERR_FILENO
)) {

192 
_tim”
.
	`»scheduË_aá”_m£c
(
_š‹rv®
);

197 
Time¡amp
 
now
 = Time¡amp::
	`now
();

200 ià(
now
 < 
_d–ay_time
) {

201 
_tim”
.
	`»scheduË_©
(
_d–ay_time
);

206 
pos
 = 0;

207 
boŞ
 
have_pos
 = 
	`g‘_v®ue
(
_fœ¡_pos_h
, 
_es
.
	`size
(), &
pos
);

210 
th”mpos
;

211 ià(!
have_pos
)

212 
th”mpos
 = -1;

213 ià(!
_have_size
) {

214 
th”mpos
 = (()(
pos
 / 100000)) % 200;

215 ià(
th”mpos
 > 100)hermpos = 200 -hermpos;

216 } ià(
_size
 > 0) {

217 
th”mpos
 = ()(100 * 
pos
 / 
_size
);

218 ià(
th”mpos
 < 0)hermpos = 0;

219 ià(
th”mpos
 > 100)hermpos = 100;

221 
th”mpos
 = 100;

224 
SŒšgAccum
 
§
;

225 
§
 << "\r";

226 ià(
_bªÃr
)

227 
§
 << 
_bªÃr
 << ' ';

228 ià(
have_pos
 && 
_have_size
)

229 
§
.
	`¢´štf
(6, "%3d%% ", ()
th”mpos
);

230 ià(
_have_size
)

231 
§
 << " -% ";

234 
b¬Ëngth
 = 
	`g‘‰ywidth
(è- (
§
.
	`Ëngth
() + 25);

235 ià(
_have_size
 && 
_fœ¡_pos_h
 == 0)

236 
b¬Ëngth
 += 8;

237 
b¬Ëngth
 = (b¬Ëngth <ğ
max_b¬_Ëngth
 ? barlength : max_bar_length);

238 ià(
b¬Ëngth
 > 0) {

239 ià(
th”mpos
 < 0 || (!
_have_size
 && 
_¡©us
 >ğ
ST_DONE
))

240 
§
.
	`¢´štf
(
b¬Ëngth
 + 10, "|%.*s|", b¬Ëngth, 
bad_b¬
);

241 ià(!
_have_size
 && 
b¬Ëngth
 > 3) {

242 
b¬ch¬
 = ()((
b¬Ëngth
 - 3è* 
th”mpos
 / 100);

243 
§
.
	`¢´štf
(
b¬Ëngth
 + 10, "|%*s***%*s|", 
b¬ch¬
, "", barlength - barchar - 3, "");

244 } ià(!
_have_size
) {

245 
b¬ch¬
 = ()((
b¬Ëngth
 - 1è* 
th”mpos
 / 100);

246 
§
.
	`¢´štf
(
b¬Ëngth
 + 10, "|%*s*%*s|", 
b¬ch¬
, "", barlength - barchar - 1, "");

248 
b¬ch¬
 = ()(
b¬Ëngth
 * 
th”mpos
 / 100);

249 
§
.
	`¢´štf
(
b¬Ëngth
 + 10, "|%.*s%*s|", 
b¬ch¬
, 
b¬
, barlength - barchar, "");

254 ià(
_have_size
 && 
_fœ¡_pos_h
 == 0)

256 
§
 << " ";

257 ià(
have_pos
) {

258 
which_pfx
 = 0;

259 
abb»vpos
 = 
pos
;

260 
abb»vpos
 >ğ100000 && 
which_pfx
 < ()((
´efixes
))) {

261 
which_pfx
++;

262 
abb»vpos
 /= 1024;

264 
§
.
	`¢´štf
(30, " %5lu%c%ø", ()
abb»vpos
, 
´efixes
[
which_pfx
], (prefixes[which_pfx] == ' ' ? ' ' : 'B'));

266 
§
 << " ----- ";

269 
Time¡amp
 
wa™
 = 
now
 - 
_Ï¡_time
;

270 ià(
pos
 > 
_Ï¡_pos
) {

271 
_Ï¡_time
 = 
now
;

272 
_Ï¡_pos
 = 
pos
;

273 ià(
wa™
.
	`£c
(è>ğ
STALLTIME
)

274 
_¡®l_time
 +ğ
wa™
;

275 
wa™
.
	`£t_£c
(0);

279 
–­£d
 = (
now
 - 
_¡¬t_time
 - 
_¡®l_time
).
	`doubËv®
();

282 ià(
_¡©us
 < 
ST_DONE


283 && (!
have_pos
 || !
_have_size
 || 
–­£d
 <ğ0.0 || 
pos
 > 
_size
))

284 
§
 << " --:-- ETA";

285 ià(
wa™
.
	`£c
(è>ğ
STALLTIME
)

286 
§
 << " - stalled -";

288 
time_»maššg
;

289 
boŞ
 
‘a
;

290 ià(
_¡©us
 >ğ
ST_DONE
 || !
have_pos
 || 
pos
 < 1e-6) {

291 
time_»maššg
 = ()
–­£d
;

292 
‘a
 = 
çl£
;

294 
time_»maššg
 = ()(
_size
 / (
pos
 / 
–­£d
) -ƒlapsed);

295 
‘a
 = 
Œue
;

298 
hr
 = 
time_»maššg
 / 3600;

299 ià(
hr
)

300 
§
.
	`¢´štf
(12, "%2d:", 
hr
);

302 
§
 << " ";

303 
£c
 = 
time_»maššg
 % 3600;

304 
§
.
	`¢´štf
(12, "%02d:%02d%s", 
£c
 / 60, sec % 60,

305 (
‘a
 ? " ETA" : " "));

309 ià(
_¡©us
 >ğ
ST_DONE
)

310 
§
 << '\n';

313 
fd
 = 
STDERR_FILENO
;

314 
buæ’
 = 
§
.
	`Ëngth
();

315 
buåos
 = 0;

316 cÚ¡ *
d©a
 = 
§
.
	`d©a
();

317 
buåos
 < 
buæ’
) {

318 
ssize_t
 
gÙ
 = 
	`wr™e
(
fd
, 
d©a
 + 
buåos
, 
buæ’
 - bufpos);

319 ià(
gÙ
 > 0)

320 
buåos
 +ğ
gÙ
;

321 ià(
”ºo
 !ğ
EINTR
 &&ƒ¼nØ!ğ
EAGAIN


322 #ifdeà
EWOULDBLOCK


323 && 
”ºo
 !ğ
EWOULDBLOCK


329 ià(
_¡©us
 < 
ST_DONE
)

330 
_tim”
.
	`»scheduË_aá”_m£c
(
_š‹rv®
);

332 
_aùive
 = 
çl£
;

333 
	}
}

336 
	gProg»ssB¬
::
	$com¶‘e
(
boŞ
 
is_fuÎ
)

338 ià(
_¡©us
 < 
ST_DONE
 && 
_aùive
) {

339 ià(
is_fuÎ
) {

340 
_have_size
 = 
Œue
;

341 (è
	`g‘_v®ue
(
_fœ¡_pos_h
, 
_es
.
	`size
(), &
_size
);

343 
_¡©us
 = (_¡©u =ğ
ST_FIRST
 ? 
ST_FIRSTDONE
 : 
ST_DONE
);

344 
_tim”
.
	`unscheduË
();

345 
	`run_tim”
(&
_tim”
);

347 
	}
}

350 ’um { 
	mH_MARK_STOPPED
, 
	mH_MARK_DONE
, 
	mH_ACTIVE
,

351 
	mH_POSHANDLER
, 
	mH_SIZEHANDLER
, 
	mH_RESET
 };

353 
SŒšg


354 
	gProg»ssB¬
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

356 
Prog»ssB¬
 *
pb
 = 
¡©ic_ÿ¡
<Prog»ssB¬ *>(
e
);

357 (
šŒ_t
)
thunk
) {

358 
H_POSHANDLER
:

359 
H_SIZEHANDLER
: {

360 
boŞ
 
is_pos
 = ((
šŒ_t
)
thunk
 =ğ
H_POSHANDLER
);

361 
SŒšgAccum
 
§
;

362 
i
 = (
is_pos
 ? 
pb
->
_fœ¡_pos_h
 : 0); i < (is_po ?…b->
_es
.
	`size
() :…b->_first_pos_h); i++) {

363 ià(
§
.
	`Ëngth
()) sa << ' ';

364 
§
 << 
pb
->
_hs
[
i
]->
	`uÅ¬£_Çme
Õb->
_es
[i]);

366  
§
.
	`ke_¡ršg
();

371 
	}
}

374 
	gProg»ssB¬
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
š_¡r
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

376 
Prog»ssB¬
 *
pb
 = 
¡©ic_ÿ¡
<Prog»ssB¬ *>(
e
);

377 
SŒšg
 
¡r
 = 
	`ı_uncomm’t
(
š_¡r
);

378 (
šŒ_t
)
thunk
) {

379 
H_MARK_STOPPED
:

380 
pb
->
	`com¶‘e
(
çl£
);

382 
H_MARK_DONE
:

383 
pb
->
	`com¶‘e
(
Œue
);

385 
H_POSHANDLER
:

386 
H_SIZEHANDLER
: {

387 
VeùÜ
<
SŒšg
> 
wÜds
;

388 
	`ı_¥aûvec
(
¡r
, 
wÜds
);

389 
boŞ
 
is_pos
 = ((
šŒ_t
)
thunk
 =ğ
H_POSHANDLER
);

390 
tÙ®
 = (
is_pos
 ? 
pb
->
_fœ¡_pos_h
 + 
wÜds
.
	`size
(è:…b->
_es
.size() -…b->_first_pos_h + words.size());

391 
off£t
 = (
is_pos
 ? 
pb
->
_fœ¡_pos_h
 : 0);

393 
VeùÜ
<
EËm’t
*> 
	`es
(
tÙ®
, 0);

394 
VeùÜ
<cÚ¡ 
HªdËr
*> 
	`hs
(
tÙ®
, 0);

396 
i
 = 0; i < 
wÜds
.
	`size
(); i++)

397 ià(!
	`ı_hªdËr
(
wÜds
[
i
], 
HªdËr
::
OP_READ
, &
es
[i+
off£t
], &
hs
[i+off£t], 
pb
, 
”rh
))

400 
off£t
 = (
is_pos
 ? 0 : 
wÜds
.
	`size
(è- 
pb
->
_fœ¡_pos_h
);

401 
i
 = (
is_pos
 ? 0 : 
pb
->
_fœ¡_pos_h
); i < (is_po ?…b->_fœ¡_pos_h :…b->
_es
.
	`size
()); i++)

402 
es
[
i
 + 
off£t
] = 
pb
->
_es
[i], 
hs
[˜+ off£t] =…b->
_hs
[i];

404 
es
.
	`sw­
(
pb
->
_es
);

405 
hs
.
	`sw­
(
pb
->
_hs
);

406 ià(!
is_pos
) {

407 
pb
->
_have_size
 = 
çl£
;

408 
pb
->
_fœ¡_pos_h
 = 
wÜds
.
	`size
();

412 
H_ACTIVE
:

413 ià(
	`BoŞArg
().
	`·r£
(
¡r
, 
pb
->
_aùive
)) {

414 ià(
pb
->
_aùive
 && !pb->
_tim”
.
	`scheduËd
())

415 
pb
->
_tim”
.
	`scheduË_now
();

418  
”rh
->
	`”rÜ
("type mismatch");

419 
H_RESET
:

420 
pb
->
_have_size
 = 
çl£
;

421 
pb
->
_¡©us
 = 
ST_FIRST
;

422 
pb
->
_aùive
 = 
Œue
;

423 
pb
->
_tim”
.
	`scheduË_now
();

426  
”rh
->
	`”rÜ
("internal");

428 
	}
}

431 
	gProg»ssB¬
::
	$add_hªdËrs
()

433 
	`add_wr™e_hªdËr
("m¬k_¡İ³d", 
wr™e_hªdËr
, 
H_MARK_STOPPED
);

434 
	`add_wr™e_hªdËr
("m¬k_dÚe", 
wr™e_hªdËr
, 
H_MARK_DONE
);

435 
	`add_d©a_hªdËrs
("aùive", 
HªdËr
::
OP_READ
 | HªdËr::
CHECKBOX
, &
_aùive
);

436 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 
H_ACTIVE
);

437 
	`add_d©a_hªdËrs
("bªÃr", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
 | HªdËr::
RAW
, &
_bªÃr
);

438 
	`add_»ad_hªdËr
("poshªdËr", 
»ad_hªdËr
, 
H_POSHANDLER
);

439 
	`add_wr™e_hªdËr
("poshªdËr", 
wr™e_hªdËr
, 
H_POSHANDLER
);

440 
	`add_»ad_hªdËr
("sizehªdËr", 
»ad_hªdËr
, 
H_SIZEHANDLER
);

441 
	`add_wr™e_hªdËr
("sizehªdËr", 
wr™e_hªdËr
, 
H_SIZEHANDLER
);

442 
	`add_d©a_hªdËrs
("pos", 
HªdËr
::
OP_READ
, &
_Ï¡_pos
);

443 
	`add_d©a_hªdËrs
("size", 
HªdËr
::
OP_READ
 | HªdËr::
OP_WRITE
, &
_size
);

444 
	`add_wr™e_hªdËr
("»£t", 
wr™e_hªdËr
, 
H_RESET
, 
HªdËr
::
BUTTON
);

445 
	}
}

447 
CLICK_ENDDECLS


448 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

449 
	`EXPORT_ELEMENT
(
Prog»ssB¬
)

	@userlevel/progressbar.hh

2 #iâdeà
CLICK_PROGRESSBAR_HH


3 
	#CLICK_PROGRESSBAR_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/tim”.hh
>

6 
CLICK_DECLS


7 
şass
 
	gHªdËr
;

138 şas 
	cProg»ssB¬
 : 
public
 
EËm’t
 {…ublic:

140 
	$Prog»ssB¬
(è
CLICK_COLD
;

141 ~
	$Prog»ssB¬
(è
CLICK_COLD
;

143 cÚ¡ *
	$şass_Çme
() const {  "ProgressBar"; }

145 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

146 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

147 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

148 
	$add_hªdËrs
(è
CLICK_COLD
;

150 
	`run_tim”
(
Tim”
 *);

152 
	`com¶‘e
(
boŞ
 
is_fuÎ
);

154 
´iv©e
:

156 ’um { 
ST_FIRST
, 
ST_MIDDLE
, 
ST_DONE
, 
ST_FIRSTDONE
, 
ST_DEAD
 
	}
};

158 
boŞ
 
	g_have_size
;

159 
	g_¡©us
;

160 
	g_size
;

161 
	g_Ï¡_pos
;

162 
Time¡amp
 
	g_¡¬t_time
;

163 
Time¡amp
 
	g_¡®l_time
;

164 
Time¡amp
 
	g_Ï¡_time
;

165 
Time¡amp
 
	g_d–ay_time
;

166 
SŒšg
 
	g_bªÃr
;

168 
Tim”
 
	g_tim”
;

169 
ušt32_t
 
	g_š‹rv®
;

170 
ušt32_t
 
	g_d–ay_ms
;

171 
boŞ
 
	g_aùive
;

173 
	gVeùÜ
<
	gEËm’t
*> 
	g_es
;

174 
	gVeùÜ
<cÚ¡ 
	gHªdËr
*> 
	g_hs
;

175 
	g_fœ¡_pos_h
;

177 
boŞ
 
g‘_v®ue
(
fœ¡
, 
Ï¡
, *);

179 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

180 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
*è
CLICK_COLD
;

182 
	}
};

184 
	gCLICK_ENDDECLS


	@userlevel/rawsocket.cc

23 
	~<şick/cÚfig.h
>

24 
	~"¿wsock‘.hh
"

25 
	~<şick/Çmešfo.hh
>

26 
	~<şick/”rÜ.hh
>

27 
	~<şick/¬gs.hh
>

28 
	~<şick/glue.hh
>

29 
	~<şick/rou‹r.hh
>

30 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

31 
	~<şick/·ck‘_ªno.hh
>

32 
	~<şick/·ck‘.hh
>

33 
	~<uni¡d.h
>

34 
	~<sys/sock‘.h
>

35 
	~<¬·/š‘.h
>

36 
	~<fú.h
>

38 #iâdeà
__sun


39 
	~<sys/ioùl.h
>

41 
	~<sys/ioccom.h
>

44 
	~"çk•ÿp.hh
"

46 
CLICK_DECLS


48 
	gRawSock‘
::
	$RawSock‘
()

49 : 
	`_sk
(
this
), 
	`_tim”
(this),

50 
	`_fd
(-1), 
	`_pÜt_»gi¡”_sock‘
(-1), 
	`_pÜt
(0), 
	`_¢­Ën
(2048),

51 
	`_h—droom
(
Pack‘
::
deçuÉ_h—droom
), 
	`_rq
(0), 
	$_wq
(0)

53 
	}
}

55 
	gRawSock‘
::~
	$RawSock‘
()

57 
	}
}

60 
RawSock‘
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

62 
Args
 
¬gs
(
cÚf
, 
this
, 
”rh
);

64 ià(
	g¬gs
.
»ad_mp
("TYPE", 
NamedIÁArg
(
NameInfo
::
T_IP_PROTO
), 
_´ÙocŞ
).
execu‹
() < 0)

66 ià(
	g_´ÙocŞ
 =ğ
IP_PROTO_TCP
 || 
_´ÙocŞ
 =ğ
IP_PROTO_UDP
)

67 
¬gs
.
»ad_p
("PORT", 
IPPÜtArg
(
_´ÙocŞ
), 
_pÜt
);

69 
	g¬gs
.
»ad_p
("PORT", 
_pÜt
);

70 ià(
	g¬gs
.
»ad
("SNAPLEN", 
_¢­Ën
)

71 .
»ad
("HEADROOM", 
_h—droom
)

72 .
com¶‘e
() < 0)

80 
	gRawSock‘
::
	$š™Ÿlize_sock‘_”rÜ
(
E¼ÜHªdËr
 *
”rh
, cÚ¡ *
sysÿÎ
)

82 
e
 = 
”ºo
;

84 ià(
_fd
 >= 0) {

85 
	`şo£
(
_fd
);

86 
_fd
 = -1;

89 if(
_pÜt_»gi¡”_sock‘
 >= 0) {

90 
	`şo£
(
_pÜt_»gi¡”_sock‘
);

91 
_pÜt_»gi¡”_sock‘
 = -1;

94  
”rh
->
	`”rÜ
("%s: %s", 
sysÿÎ
, 
	`¡»¼Ü
(
e
));

95 
	}
}

98 
	gRawSock‘
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

100 
sockaddr_š
 
sš»g
;

103 
_fd
 = 
	`sock‘
(
PF_INET
, 
SOCK_RAW
, 
_´ÙocŞ
);

104 ià(
_fd
 < 0)

105  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "socket");

107 ià(
_pÜt
) {

109 if((
_´ÙocŞ
 =ğ
IPPROTO_UDP
è|| (_´ÙocŞ =ğ
IPPROTO_TCP
)) {

111 if(
_´ÙocŞ
 =ğ
IPPROTO_UDP
)

112 
_pÜt_»gi¡”_sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_DGRAM
, 
_´ÙocŞ
);

114 
_pÜt_»gi¡”_sock‘
 = 
	`sock‘
(
AF_INET
, 
SOCK_STREAM
, 
_´ÙocŞ
);

116 if(
_pÜt_»gi¡”_sock‘
 < 0)

117  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "socket");

119 
	`mem£t
((*è&
sš»g
, 0, (sinreg));

120 
sš»g
.
sš_çmy
 = 
AF_INET
;

121 
sš»g
.
sš_pÜt
 = 
	`htÚs
(
_pÜt
);

122 
sš»g
.
sš_addr
.
s_addr
 = 
	`htÚl
(
INADDR_ANY
);

124 ià(
	`bšd
(
_pÜt_»gi¡”_sock‘
, (
sockaddr
 *)&
sš»g
, (sinreg)) < 0)

125  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "Bind for…lanetlab…ort„egistration failed");

131 
	`fú
(
_fd
, 
F_SETFL
, 
O_NONBLOCK
);

132 
	`fú
(
_fd
, 
F_SETFD
, 
FD_CLOEXEC
);

135 
Úe
 = 1;

136 ià(
	`£tsockİt
(
_fd
, 0, 
IP_HDRINCL
, &
Úe
, (one)) < 0)

137  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "IP_HDRINCL");

140 
Úe
 = 1;

141 ià(
	`£tsockİt
(
_fd
, 
SOL_SOCKET
, 
SO_BROADCAST
, &
Úe
, (one)) < 0)

142  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "SO_BROADCAST");

144 ià(
	`nouuts
())

145 
	`add_£Ëù
(
_fd
, 
SELECT_READ
);

147 ià(
	`nšputs
()) {

148 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

149 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

150 
	`add_£Ëù
(
_fd
, 
SELECT_WRITE
);

151 
_tim”
.
	`š™Ÿlize
(
this
);

154 
	}
}

157 
	gRawSock‘
::
	$ş—nup
(
CËªupSge
)

159 ià(
_rq
)

160 
_rq
->
	`kl
();

161 ià(
_wq
)

162 
_wq
->
	`kl
();

163 ià(
_fd
 >= 0) {

164 
	`şo£
(
_fd
);

165 
	`»move_£Ëù
(
_fd
, 
SELECT_READ
 | 
SELECT_WRITE
);

166 
_fd
 = -1;

168 
	}
}

171 
	gRawSock‘
::
	$£Ëùed
(
fd
, )

173 
E¼ÜHªdËr
 *
”rh
 = E¼ÜHªdËr::
	`deçuÉ_hªdËr
();

174 
Ën
;

176 ià(
	`nouuts
()) {

178 ià(!
_rq
)

179 
_rq
 = 
Pack‘
::
	`make
(
_h—droom
, (cÚ¡ *)0, 
_¢­Ën
, 0);

180 ià(
_rq
) {

181 
Ën
 = 
	`»cv
(
_fd
, 
_rq
->
	`d©a
(), _rq->
	`Ëngth
(), 
MSG_TRUNC
);

182 ià(
Ën
 > 0) {

183 ià(
Ën
 > 
_¢­Ën
) {

184 
	`as£¹
(
_rq
->
	`Ëngth
(è=ğ(
ušt32_t
)
_¢­Ën
);

185 
	`SET_EXTRA_LENGTH_ANNO
(
_rq
, 
Ën
 - 
_¢­Ën
);

187 
_rq
->
	`ke
(
_¢­Ën
 - 
Ën
);

189 (è
	`ioùl
(
fd
, 
SIOCGSTAMP
, &
_rq
->
	`time¡amp_ªno
());

191 ià(
	`çke_pÿp_fÜû_
(
_rq
, 
FAKE_DLT_RAW
))

192 
	`ouut
(0).
	`push
(
_rq
);

194 
_rq
->
	`kl
();

195 
_rq
 = 0;

197 ià(
Ën
 =ğ0 || 
”ºo
 !ğ
EAGAIN
) {

198 ià(
”ºo
 !ğ
EAGAIN
)

199 
”rh
->
	`”rÜ
("»cv: %s", 
	`¡»¼Ü
(
”ºo
));

205 ià(
	`nšputs
()) {

207 
Pack‘
 *
p
;

208 ià(
_wq
) {

209 
p
 = 
_wq
;

210 
_wq
 = 0;

212 
p
 = 
	`šput
(0).
	`puÎ
();

214 ià(
p
) {

216 ià(()
p
->
	`Ëngth
(è< ()(
şick_
)) {

217 
”rh
->
	`”rÜ
("ruÁ IP…ack‘ (%d by‹s)", 
p
->
	`Ëngth
());

218 
p
->
	`kl
();

220 cÚ¡ 
şick_
 *

 = (cÚ¡ click_ *è
p
->
	`d©a
();

221 
sockaddr_š
 
sš
;

224 
	`mem£t
(&
sš
, 0, (sin));

225 
sš
.
sš_çmy
 = 
PF_INET
;

226 
sš
.
sš_addr
 = 

->
_d¡
;

228 
p
->
	`Ëngth
()) {

230 
Ën
 = 
	`£ndto
(
_fd
, 
p
->
	`d©a
(),…->
	`Ëngth
(), 0,

231 (cÚ¡ 
sockaddr
*)&
sš
, (sin));

232 ià(
Ën
 < 0) {

233 ià(
”ºo
 =ğ
ENOBUFS
 ||ƒ¼nØ=ğ
EAGAIN
) {

235 
_wq
 = 
p
;

236 
	`»move_£Ëù
(
_fd
, 
SELECT_WRITE
);

237 
_ev’ts
 &ğ~
SELECT_WRITE
;

238 
_backoff
 = (!_backoff) ? 1 : _backoff*2;

239 
_tim”
.
	`scheduË_aá”
(
Time¡amp
::
	`make_u£c
(
_backoff
));

241 } ià(
”ºo
 =ğ
EINTR
) {

246 
”rh
->
	`”rÜ
("£ndto: %s", 
	`¡»¼Ü
(
”ºo
));

250 
p
->
	`puÎ
(
Ën
);

253 
_backoff
 = 0;

254 
p
->
	`kl
();

259 ià(!
p
 && !
_sigÇl
 && (
_ev’ts
 & 
SELECT_WRITE
)) {

260 
	`»move_£Ëù
(
_fd
, 
SELECT_WRITE
);

261 
_ev’ts
 &ğ~
SELECT_WRITE
;

264 
	}
}

267 
	gRawSock‘
::
	$run_tim”
(
Tim”
 *)

269 ià((
_wq
 || 
_sigÇl
è&& !(
_ev’ts
 & 
SELECT_WRITE
è&& 
_fd
 >= 0) {

270 
	`add_£Ëù
(
_fd
, 
SELECT_WRITE
);

271 
_ev’ts
 |ğ
SELECT_WRITE
;

272 
	`£Ëùed
(
_fd
, 0);

274 
	}
}

276 
boŞ


277 
	gRawSock‘
::
	$run_sk
(
Task
 *)

279 ià(!
_wq
 && !(
_ev’ts
 & 
SELECT_WRITE
è&& 
_fd
 >= 0) {

280 
	`add_£Ëù
(
_fd
, 
SELECT_WRITE
);

281 
_ev’ts
 |ğ
SELECT_WRITE
;

282 
	`£Ëùed
(
_fd
, 0);

283  
Œue
;

285  
çl£
;

286 
	}
}

289 
	gRawSock‘
::
	$add_hªdËrs
()

291 
	`add_sk_hªdËrs
(&
_sk
);

292 
	}
}

294 
CLICK_ENDDECLS


295 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
lšux
)

296 
	`EXPORT_ELEMENT
(
RawSock‘
)

	@userlevel/rawsocket.hh

2 #iâdeà
CLICK_RAWSOCKET_HH


3 
	#CLICK_RAWSOCKET_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şick/tim”.hh
>

7 
	~<şick/nÙif›r.hh
>

8 
CLICK_DECLS


58 şas 
	cRawSock‘
 : 
public
 
EËm’t
 {…ublic:

60 
	$RawSock‘
(è
CLICK_COLD
;

61 ~
	$RawSock‘
(è
CLICK_COLD
;

63 cÚ¡ *
	$şass_Çme
() const {  "RawSocket"; }

64 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "0-1/0-1"; 
	}
}

65 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "l/h"; 
	}
}

66 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

67 cÚ¡ *
	$æags
(ècÚ¡ {  "S3"; 
	}
}

69 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

70 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

71 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

72 
	$add_hªdËrs
(è
CLICK_COLD
;

74 
boŞ
 
	`run_sk
(
Task
 *);

75 
	`£Ëùed
(
fd
, 
mask
);

76 
	`run_tim”
(
Tim”
 *);

78 
´Ùeùed
:

79 
Task
 
_sk
;

80 
Tim”
 
_tim”
;

82 
´iv©e
:

83 
_fd
;

84 
_pÜt_»gi¡”_sock‘
;

85 
_´ÙocŞ
;

86 
ušt16_t
 
_pÜt
;

87 
_¢­Ën
;

88 
_h—droom
;

90 
NÙif›rSigÇl
 
_sigÇl
;

91 
Wr™abËPack‘
 *
_rq
;

92 
_backoff
;

93 
Pack‘
 *
_wq
;

94 
_ev’ts
;

96 
	`š™Ÿlize_sock‘_”rÜ
(
E¼ÜHªdËr
 *, const *);

98 
	}
};

100 
	gCLICK_ENDDECLS


	@userlevel/socket.cc

20 
	~<şick/cÚfig.h
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/¬gs.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

25 
	~<şick/·ck‘_ªno.hh
>

26 
	~<şick/·ck‘.hh
>

27 
	~<uni¡d.h
>

28 
	~<sys/ioùl.h
>

29 
	~<sys/sock‘.h
>

30 
	~<sys/un.h
>

31 
	~<¬·/š‘.h
>

32 
	~<Ãtš‘/tı.h
>

33 
	~<fú.h
>

34 
	~"sock‘.hh
"

36 #ifdeà
HAVE_PROPER


37 
	~<´İ”/´İ.h
>

40 
CLICK_DECLS


42 
	gSock‘
::
	$Sock‘
()

43 : 
	`_sk
(
this
),

44 
	`_fd
(-1), 
	`_aùive
(-1), 
	`_rq
(0), 
	`_wq
(0),

45 
	`_loÿl_pÜt
(0), 
	`_loÿl_·thÇme
(""),

46 
	`_time¡amp
(
Œue
), 
	`_¢dbuf
(-1), 
	`_rcvbuf
(-1),

47 
	`_¢­Ën
(2048), 
	`_h—droom
(
Pack‘
::
deçuÉ_h—droom
), 
	`_nod–ay
(1),

48 
	`_v”bo£
(
çl£
), 
	`_ş›Á
(çl£), 
	`_´İ”
(çl£), 
	`_®low
(0), 
	$_d’y
(0)

50 
	}
}

52 
	gSock‘
::~
	$Sock‘
()

54 
	}
}

57 
Sock‘
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

59 
SŒšg
 
	gsockty³
;

60 
	g_ş›Á
 = (
nouuts
() == 0);

61 
Args
 
	g¬gs
 = Args(
this
, 
”rh
).
bšd
(
cÚf
);

62 ià(
	g¬gs
.
»ad_mp
("TYPE", 
sockty³
).
execu‹
() < 0)

64 
	gsockty³
 = 
sockty³
.
uµ”
();

67 
EËm’t
 *
	g®low
 = 0, *
	gd’y
 = 0;

68 ià(
	g¬gs
.
»ad
("VERBOSE", 
_v”bo£
)

69 .
»ad
("SNAPLEN", 
_¢­Ën
)

70 .
»ad
("HEADROOM", 
_h—droom
)

71 .
»ad
("TIMESTAMP", 
_time¡amp
)

72 .
»ad
("RCVBUF", 
_rcvbuf
)

73 .
»ad
("SNDBUF", 
_¢dbuf
)

74 .
»ad
("NODELAY", 
_nod–ay
)

75 .
»ad
("CLIENT", 
_ş›Á
)

76 .
»ad
("PROPER", 
_´İ”
)

77 .
»ad
("ALLOW", 
®low
)

78 .
»ad
("DENY", 
d’y
)

79 .
cÚsume
() < 0)

82 ià(
	g®low
 && !(
	g_®low
 = (
IPRou‹TabË
 *)
®low
->
ÿ¡
("IPRouteTable")))

83  
”rh
->
”rÜ
("% i nÙ‡ÀIPRou‹TabË", 
®low
->
Çme
().
c_¡r
());

85 ià(
	gd’y
 && !(
	g_d’y
 = (
IPRou‹TabË
 *)
d’y
->
ÿ¡
("IPRouteTable")))

86  
”rh
->
”rÜ
("% i nÙ‡ÀIPRou‹TabË", 
d’y
->
Çme
().
c_¡r
());

88 ià(
	gsockty³
 =ğ"TCP" || 
sockty³
 == "UDP") {

89 
_çmy
 = 
AF_INET
;

90 
	g_sockty³
 = 
sockty³
 =ğ"TCP" ? 
SOCK_STREAM
 : 
SOCK_DGRAM
;

91 
	g_´ÙocŞ
 = 
sockty³
 =ğ"TCP" ? 
IPPROTO_TCP
 : 
IPPROTO_UDP
;

92 ià(
	g¬gs
.
»ad_mp
("ADDR", 
_»mÙe_
)

93 .
»ad_mp
("PORT", 
IPPÜtArg
(
_´ÙocŞ
), 
_»mÙe_pÜt
)

94 .
»ad_p
("LOCAL_ADDR", 
_loÿl_
)

95 .
»ad_p
("LOCAL_PORT", 
IPPÜtArg
(
_´ÙocŞ
), 
_loÿl_pÜt
)

96 .
com¶‘e
() < 0)

100 ià(
	gsockty³
 =ğ"UNIX" || 
sockty³
 == "UNIX_DGRAM") {

101 
_çmy
 = 
AF_UNIX
;

102 
	g_sockty³
 = 
sockty³
 =ğ"UNIX" ? 
SOCK_STREAM
 : 
SOCK_DGRAM
;

103 
	g_´ÙocŞ
 = 0;

104 ià(
	g¬gs
.
»ad_mp
("FILENAME", 
F’ameArg
(), 
_»mÙe_·thÇme
)

105 .
»ad_p
("LOCAL_FILENAME", 
F’ameArg
(), 
_loÿl_·thÇme
)

106 .
com¶‘e
() < 0)

108 
	gmax_·th
 = ()(((
sockaddr_un
 *)0)->
sun_·th
);

111 ià((
	g_»mÙe_·thÇme
[0] && _»mÙe_·thÇme.
Ëngth
(è>ğ
max_·th
) ||

112 (
_»mÙe_·thÇme
[0] =ğ0 && _»mÙe_·thÇme.
Ëngth
(è> 
max_·th
))

113  
”rh
->
”rÜ
("»mÙf’am'%s'oØlÚg", 
_»mÙe_·thÇme
.
´šbË
().
c_¡r
());

114 ià((
	g_loÿl_·thÇme
[0] && _loÿl_·thÇme.
Ëngth
(è>ğ
max_·th
) ||

115 (
_loÿl_·thÇme
[0] =ğ0 && _loÿl_·thÇme.
Ëngth
(è> 
max_·th
))

116  
”rh
->
”rÜ
("loÿÈf’am'%s'oØlÚg", 
_loÿl_·thÇme
.
´šbË
().
c_¡r
());

120  
	g”rh
->
”rÜ
("unknowÀsock‘y³ `%s'", 
sockty³
.
c_¡r
());

127 
	gSock‘
::
	$š™Ÿlize_sock‘_”rÜ
(
E¼ÜHªdËr
 *
”rh
, cÚ¡ *
sysÿÎ
)

129 
e
 = 
”ºo
;

131 ià(
_fd
 >= 0) {

132 
	`»move_£Ëù
(
_fd
, 
SELECT_READ
 | 
SELECT_WRITE
);

133 
	`şo£
(
_fd
);

134 
_fd
 = -1;

137  
”rh
->
	`”rÜ
("%s: %s", 
sysÿÎ
, 
	`¡»¼Ü
(
e
));

138 
	}
}

141 
	gSock‘
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

144 
_fd
 = 
	`sock‘
(
_çmy
, 
_sockty³
, 
_´ÙocŞ
);

145 ià(
_fd
 < 0)

146  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "socket");

148 ià(
_çmy
 =ğ
AF_INET
) {

149 
_»mÙe
.
š
.
sš_çmy
 = 
_çmy
;

150 
_»mÙe
.
š
.
sš_pÜt
 = 
	`htÚs
(
_»mÙe_pÜt
);

151 
_»mÙe
.
š
.
sš_addr
 = 
_»mÙe_
.
	`š_addr
();

152 
_»mÙe_Ën
 = (
_»mÙe
.
š
);

153 
_loÿl
.
š
.
sš_çmy
 = 
_çmy
;

154 
_loÿl
.
š
.
sš_pÜt
 = 
	`htÚs
(
_loÿl_pÜt
);

155 
_loÿl
.
š
.
sš_addr
 = 
_loÿl_
.
	`š_addr
();

156 
_loÿl_Ën
 = (
_loÿl
.
š
);

159 
_»mÙe
.
un
.
sun_çmy
 = 
_çmy
;

160 
_»mÙe_Ën
 = 
	`off£tof
(
sockaddr_un
, 
sun_·th
è+ 
_»mÙe_·thÇme
.
	`Ëngth
();

161 ià(
_»mÙe_·thÇme
[0]) {

162 
	`¡rıy
(
_»mÙe
.
un
.
sun_·th
, 
_»mÙe_·thÇme
.
	`c_¡r
());

163 
_»mÙe_Ën
++;

165 
	`memıy
(
_»mÙe
.
un
.
sun_·th
, 
_»mÙe_·thÇme
.
	`c_¡r
(), _»mÙe_·thÇme.
	`Ëngth
());

166 
_loÿl
.
un
.
sun_çmy
 = 
_çmy
;

167 
_loÿl_Ën
 = 
	`off£tof
(
sockaddr_un
, 
sun_·th
è+ 
_loÿl_·thÇme
.
	`Ëngth
();

168 ià(
_loÿl_·thÇme
[0]) {

169 
	`¡rıy
(
_loÿl
.
un
.
sun_·th
, 
_loÿl_·thÇme
.
	`c_¡r
());

170 
_loÿl_Ën
++;

172 
	`memıy
(
_loÿl
.
un
.
sun_·th
, 
_loÿl_·thÇme
.
	`c_¡r
(), _loÿl_·thÇme.
	`Ëngth
());

175 #ifdeà
TCP_NODELAY


177 ià(
_´ÙocŞ
 =ğ
IPPROTO_TCP
 && 
_nod–ay
)

178 ià(
	`£tsockİt
(
_fd
, 
IP_PROTO_TCP
, 
TCP_NODELAY
, &
_nod–ay
, (_nodelay)) < 0)

179  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "setsockopt(TCP_NODELAY)");

183 ià(
_¢dbuf
 >= 0)

184 ià(
	`£tsockİt
(
_fd
, 
SOL_SOCKET
, 
SO_SNDBUF
, &
_¢dbuf
, (_sndbuf)) < 0)

185  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "setsockopt(SO_SNDBUF)");

188 ià(
_rcvbuf
 >= 0)

189 ià(
	`£tsockİt
(
_fd
, 
SOL_SOCKET
, 
SO_RCVBUF
, &
_rcvbuf
, (_rcvbuf)) < 0)

190  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "setsockopt(SO_RCVBUF)");

194 ià(!
_ş›Á
) {

195 
	`memıy
(&
_loÿl
, &
_»mÙe
, 
_»mÙe_Ën
);

196 
_loÿl_Ën
 = 
_»mÙe_Ën
;

201 ià(!
_ş›Á
 || 
_loÿl_pÜt
 !ğ0 || 
_loÿl_·thÇme
 != "") {

202 #ifdeà
HAVE_PROPER


203 
»t
 = -1;

204 ià(
_´İ”
) {

205 
»t
 = 
	`´İ_bšd_sock‘
(
_fd
, (
sockaddr
 *)&
_loÿl
, 
_loÿl_Ën
);

206 ià(
»t
 < 0)

207 
”rh
->
	`w¬nšg
("´İ_bšd_sock‘: %s", 
	`¡»¼Ü
(
”ºo
));

209 ià(
»t
 < 0)

211 ià(
	`bšd
(
_fd
, (
sockaddr
 *)&
_loÿl
, 
_loÿl_Ën
) < 0)

212  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "bind");

215 ià(
_ş›Á
) {

217 ià(
_sockty³
 =ğ
SOCK_STREAM
) {

218 ià(
	`cÚÃù
(
_fd
, (
sockaddr
 *)&
_»mÙe
, 
_»mÙe_Ën
) < 0)

219  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "connect");

220 ià(
_v”bo£
)

221 
	`şick_ch©‹r
("%s: o³Ãd cÚÃùiÚ %dØ%s:%d", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_fd
, 
	`IPAdd»ss
(
_»mÙe
.
š
.
sš_addr
).
	`uÅ¬£
().c_¡r(), 
	`Áohs
(_»mÙe.š.
sš_pÜt
));

223 
_aùive
 = 
_fd
;

226 ià(
_sockty³
 =ğ
SOCK_STREAM
) {

227 ià(
	`li¡’
(
_fd
, 2) < 0)

228  
	`š™Ÿlize_sock‘_”rÜ
(
”rh
, "listen");

229 ià(
_v”bo£
) {

230 ià(
_çmy
 =ğ
AF_INET
)

231 
	`şick_ch©‹r
("%s:†i¡’šg fÜ cÚÃùiÚ Ú %s:%d (%d)", 
	`deş¬©iÚ
().
	`c_¡r
(), 
	`IPAdd»ss
(
_loÿl
.
š
.
sš_addr
).
	`uÅ¬£
().c_¡r(), 
	`Áohs
(_loÿl.š.
sš_pÜt
), 
_fd
);

233 
	`şick_ch©‹r
("%s:†i¡’šg fÜ cÚÃùiÚ Ú % (%d)", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_loÿl
.
un
.
sun_·th
, 
_fd
);

236 
_aùive
 = 
_fd
;

241 
	`fú
(
_fd
, 
F_SETFL
, 
O_NONBLOCK
);

242 
	`fú
(
_fd
, 
F_SETFD
, 
FD_CLOEXEC
);

244 ià(
	`nouuts
())

245 
	`add_£Ëù
(
_fd
, 
SELECT_READ
);

247 ià(
	`nšputs
(è&& 
	`šput_is_puÎ
(0)) {

248 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

249 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

250 
	`add_£Ëù
(
_fd
, 
SELECT_WRITE
);

254 
	}
}

257 
	gSock‘
::
	$ş—nup
(
CËªupSge
)

259 ià(
_aùive
 >ğ0 && _aùiv!ğ
_fd
) {

260 
	`şo£
(
_aùive
);

261 
_aùive
 = -1;

263 ià(
_rq
)

264 
_rq
->
	`kl
();

265 ià(
_wq
)

266 
_wq
->
	`kl
();

267 ià(
_fd
 >= 0) {

269 #ifdeà
SHUT_RDWR


270 
	`shutdown
(
_fd
, 
SHUT_RDWR
);

272 
	`shutdown
(
_fd
, 2);

274 
	`şo£
(
_fd
);

275 ià(
_çmy
 =ğ
AF_UNIX
)

276 
	`uÆšk
(
_loÿl_·thÇme
.
	`c_¡r
());

277 
_fd
 = -1;

279 
	}
}

281 
boŞ


282 
	gSock‘
::
	$®lowed
(
IPAdd»ss
 
addr
)

284 
IPAdd»ss
 
gw
;

286 ià(
_®low
 && _®low->
	`lookup_rou‹
(
addr
, 
gw
) >= 0)

287  
Œue
;

288 ià(
_d’y
 && _d’y->
	`lookup_rou‹
(
addr
, 
gw
) >= 0)

289  
çl£
;

291  
Œue
;

292 
	}
}

295 
	gSock‘
::
	$şo£_aùive
()

297 ià(
_aùive
 >= 0) {

298 
	`»move_£Ëù
(
_aùive
, 
SELECT_READ
 | 
SELECT_WRITE
);

299 
	`şo£
(
_aùive
);

300 ià(
_v”bo£
)

301 
	`şick_ch©‹r
("%s: clo£d cÚÃùiÚ %d", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_aùive
);

302 
_aùive
 = -1;

304 
	}
}

307 
	gSock‘
::
	$£Ëùed
(
fd
, )

309 
Ën
;

310 uniÚ { 
sockaddr_š
 
š
; 
sockaddr_un
 
un
; } 
äom
;

311 
sockËn_t
 
äom_Ën
 = (
äom
);

312 
boŞ
 
®low
;

314 ià(
	`nouuts
()) {

316 ià(
_sockty³
 =ğ
SOCK_STREAM
 && !
_ş›Á
 && 
_aùive
 < 0 && 
fd
 =ğ
_fd
) {

317 
_aùive
 = 
	`acû±
(
_fd
, (
sockaddr
 *)&
äom
, &
äom_Ën
);

319 ià(
_aùive
 < 0) {

320 ià(
”ºo
 !ğ
EAGAIN
)

321 
	`şick_ch©‹r
("%s:‡cû±: %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

325 ià(
_çmy
 =ğ
AF_INET
) {

326 
®low
 = 
	`®lowed
(
	`IPAdd»ss
(
äom
.
š
.
sš_addr
));

328 ià(
_v”bo£
)

329 
	`şick_ch©‹r
("%s: % cÚÃùiÚ %d from %s:%d", 
	`deş¬©iÚ
().
	`c_¡r
(),

330 
®low
 ? "opened" : "denied",

331 
_aùive
, 
	`IPAdd»ss
(
äom
.
š
.
sš_addr
).
	`uÅ¬£
().
	`c_¡r
(), 
	`Áohs
(äom.š.
sš_pÜt
));

333 ià(!
®low
) {

334 
	`şo£
(
_aùive
);

335 
_aùive
 = -1;

339 ià(
_v”bo£
)

340 
	`şick_ch©‹r
("%s: o³Ãd cÚÃùiÚ %d from %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
_aùive
, 
äom
.
un
.
sun_·th
);

343 
	`fú
(
_aùive
, 
F_SETFL
, 
O_NONBLOCK
);

344 
	`fú
(
_aùive
, 
F_SETFD
, 
FD_CLOEXEC
);

346 
	`add_£Ëù
(
_aùive
, 
SELECT_READ
);

350 ià(!
_rq
)

351 
_rq
 = 
Pack‘
::
	`make
(
_h—droom
, 0, 
_¢­Ën
, 0);

352 ià(
_rq
) {

353 ià(
_sockty³
 =ğ
SOCK_STREAM
)

354 
Ën
 = 
	`»ad
(
_aùive
, 
_rq
->
	`d©a
(), _rq->
	`Ëngth
());

355 ià(
_ş›Á
)

356 
Ën
 = 
	`»cv
(
_aùive
, 
_rq
->
	`d©a
(), _rq->
	`Ëngth
(), 
MSG_TRUNC
);

359 
Ën
 = 
	`»cväom
(
_aùive
, 
_rq
->
	`d©a
(), _rq->
	`Ëngth
(), 
MSG_TRUNC
, (
sockaddr
 *)&
äom
, &
äom_Ën
);

361 ià(
_çmy
 =ğ
AF_INET
 && !
	`®lowed
(
	`IPAdd»ss
(
äom
.
š
.
sš_addr
))) {

362 ià(
_v”bo£
)

363 
	`şick_ch©‹r
("%s: drİ³d d©ag¿m from %s:%d", 
	`deş¬©iÚ
().
	`c_¡r
(),

364 
	`IPAdd»ss
(
äom
.
š
.
sš_addr
).
	`uÅ¬£
().
	`c_¡r
(), 
	`Áohs
(äom.š.
sš_pÜt
));

365 
Ën
 = -1;

366 
”ºo
 = 
EAGAIN
;

367 } ià(
Ën
 > 0) {

368 
	`memıy
(&
_»mÙe
, &
äom
, 
äom_Ën
);

369 
_»mÙe_Ën
 = 
äom_Ën
;

374 ià(
Ën
 > 0) {

375 ià(
Ën
 > 
_¢­Ën
) {

377 
	`as£¹
(
_rq
->
	`Ëngth
(è=ğ(
ušt32_t
)
_¢­Ën
);

378 
	`SET_EXTRA_LENGTH_ANNO
(
_rq
, 
Ën
 - 
_¢­Ën
);

381 
_rq
->
	`ke
(
_¢­Ën
 - 
Ën
);

385 ià(
_time¡amp
)

386 
_rq
->
	`time¡amp_ªno
().
	`assign_now
();

389 
	`ouut
(0).
	`push
(
_rq
);

390 
_rq
 = 0;

394 ià(
Ën
 =ğ0 || 
”ºo
 !ğ
EAGAIN
) {

395 ià(
”ºo
 !ğ
EAGAIN
 && 
_v”bo£
)

396 
	`şick_ch©‹r
("%s: %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

397 
	`şo£_aùive
();

403 ià(
	`nšputs
(è&& 
	`šput_is_puÎ
(0))

404 
	`run_sk
(0);

405 
	}
}

408 
	gSock‘
::
	$wr™e_·ck‘
(
Pack‘
 *
p
)

410 
Ën
;

412 
	`as£¹
(
_aùive
 >= 0);

414 
p
->
	`Ëngth
()) {

415 ià(!
	`IPAdd»ss
(
_»mÙe_
è&& 
_ş›Á
 && 
_çmy
 =ğ
AF_INET
 && 
_sockty³
 !ğ
SOCK_STREAM
) {

418 
_»mÙe
.
š
.
sš_addr
 = 
p
->
	`d¡__ªno
();

422 ià(
_sockty³
 =ğ
SOCK_STREAM
)

423 
Ën
 = 
	`wr™e
(
_aùive
, 
p
->
	`d©a
(),…->
	`Ëngth
());

425 
Ën
 = 
	`£ndto
(
_aùive
, 
p
->
	`d©a
(),…->
	`Ëngth
(), 0,

426 (
sockaddr
 *)&
_»mÙe
, 
_»mÙe_Ën
);

429 ià(
Ën
 < 0) {

431 ià(
”ºo
 =ğ
ENOBUFS
 ||ƒ¼nØ=ğ
EAGAIN
)

435 ià(
”ºo
 =ğ
EINTR
)

440 ià(
_v”bo£
)

441 
	`şick_ch©‹r
("%s: %s", 
	`deş¬©iÚ
().
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

442 
	`şo£_aùive
();

447 
p
->
	`puÎ
(
Ën
);

450 
p
->
	`kl
();

452 
	}
}

455 
	gSock‘
::
	$push
(, 
Pack‘
 *
p
)

457 
fd_£t
 
fds
;

458 
”r
;

460 ià(
_aùive
 >= 0) {

463 
	`FD_ZERO
(&
fds
);

464 
	`FD_SET
(
_aùive
, &
fds
);

465 
”r
 = 
	`£Ëù
(
_aùive
 + 1, 
NULL
, &
fds
, NULL, NULL);

466 } 
”r
 < 0 && 
”ºo
 =ğ
EINTR
);

468 ià(
”r
 >= 0) {

471 
”r
 = 
	`wr™e_·ck‘
(
p
);

472 } 
”r
 < 0 && (
”ºo
 =ğ
ENOBUFS
 ||ƒ¼nØ=ğ
EAGAIN
));

475 ià(
”r
 < 0) {

476 ià(
_v”bo£
)

477 
	`şick_ch©‹r
("%s: %s, drİpšg…ack‘", 
	`deş¬©iÚ
().
	`c_¡r
(), 
	`¡»¼Ü
(
”r
));

478 
p
->
	`kl
();

481 
p
->
	`kl
();

482 
	}
}

484 
boŞ


485 
	gSock‘
::
	$run_sk
(
Task
 *)

487 
	`as£¹
(
	`nšputs
(è&& 
	`šput_is_puÎ
(0));

488 
boŞ
 
ªy
 = 
çl£
;

490 ià(
_aùive
 >= 0) {

491 
Pack‘
 *
p
 = 0;

492 
”r
 = 0;

496 
p
 = 
_wq
 ? _wq : 
	`šput
(0).
	`puÎ
();

497 
_wq
 = 0;

498 ià(
p
) {

499 
ªy
 = 
Œue
;

500 
”r
 = 
	`wr™e_·ck‘
(
p
);

502 } 
p
 && 
”r
 >= 0);

504 ià(
”r
 < 0) {

506 
_wq
 = 
p
;

507 
p
 = 0;

508 
	`add_£Ëù
(
_aùive
, 
SELECT_WRITE
);

509 } ià(
_sigÇl
)

512 
_sk
.
	`»scheduË
();

515 
	`»move_£Ëù
(
_aùive
, 
SELECT_WRITE
);

519  
ªy
;

520 
	}
}

523 
	gSock‘
::
	$add_hªdËrs
()

525 
	`add_sk_hªdËrs
(&
_sk
);

526 
	}
}

528 
CLICK_ENDDECLS


529 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
IPRou‹TabË
)

530 
	`EXPORT_ELEMENT
(
Sock‘
)

	@userlevel/socket.hh

2 #iâdeà
CLICK_SOCKET_HH


3 
	#CLICK_SOCKET_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/¡ršg.hh
>

6 
	~<şick/sk.hh
>

7 
	~<şick/nÙif›r.hh
>

8 
	~"..//rou‹bË.hh
"

9 
	~<sys/un.h
>

10 
CLICK_DECLS


171 şas 
	cSock‘
 : 
public
 
EËm’t
 {…ublic:

173 
	$Sock‘
(è
CLICK_COLD
;

174 ~
	$Sock‘
(è
CLICK_COLD
;

177 cÚ¡ *
	$şass_Çme
() const {  "Socket"; }

178 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "0-1/0-1"; 
	}
}

179 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "a/h"; 
	}
}

180 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

181 cÚ¡ *
	$æags
(ècÚ¡ {  "S3"; 
	}
}

183 
vœtu®
 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

184 
vœtu®
 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

185 
vœtu®
 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

187 
	$add_hªdËrs
(è
CLICK_COLD
;

188 
boŞ
 
	`run_sk
(
Task
 *);

189 
	`£Ëùed
(
fd
, 
mask
);

190 
	`push
(
pÜt
, 
Pack‘
*);

192 
boŞ
 
	`®lowed
(
IPAdd»ss
);

193 
	`şo£_aùive
();

194 
	`wr™e_·ck‘
(
Pack‘
*);

196 
´Ùeùed
:

197 
Task
 
_sk
;

199 
´iv©e
:

200 
_fd
;

201 
_aùive
;

204 uniÚ { 
sockaddr_š
 
š
; 
sockaddr_un
 
un
; 
	}
} 
	g_loÿl
;

205 
sockËn_t
 
	g_loÿl_Ën
;

209 uniÚ { 
sockaddr_š
 
	gš
; 
sockaddr_un
 
	gun
; } 
	g_»mÙe
;

210 
sockËn_t
 
	g_»mÙe_Ën
;

212 
NÙif›rSigÇl
 
	g_sigÇl
;

213 
Wr™abËPack‘
 *
	g_rq
;

214 
Pack‘
 *
	g_wq
;

216 
	g_çmy
;

217 
	g_sockty³
;

218 
	g_´ÙocŞ
;

219 
IPAdd»ss
 
	g_loÿl_
;

220 
ušt16_t
 
	g_loÿl_pÜt
;

221 
SŒšg
 
	g_loÿl_·thÇme
;

222 
IPAdd»ss
 
	g_»mÙe_
;

223 
ušt16_t
 
	g_»mÙe_pÜt
;

224 
SŒšg
 
	g_»mÙe_·thÇme
;

226 
boŞ
 
	g_time¡amp
;

227 
	g_¢dbuf
;

228 
	g_rcvbuf
;

229 
	g_¢­Ën
;

230 
	g_h—droom
;

231 
	g_nod–ay
;

232 
boŞ
 
	g_v”bo£
;

233 
boŞ
 
	g_ş›Á
;

234 
boŞ
 
	g_´İ”
;

235 
IPRou‹TabË
 *
	g_®low
;

236 
IPRou‹TabË
 *
	g_d’y
;

238 
š™Ÿlize_sock‘_”rÜ
(
E¼ÜHªdËr
 *, const *);

242 
	gCLICK_ENDDECLS


	@userlevel/todevice.cc

20 
	~<şick/cÚfig.h
>

21 #ià
HAVE_NET_BPF_H


22 
	~<sys/ty³s.h
>

23 
	~<sys/time.h
>

24 
	~<Ãt/bpf.h
>

25 
	#PCAP_DONT_INCLUDE_PCAP_BPF_H
 1

	)

27 
	~"todeviû.hh
"

28 
	~<şick/”rÜ.hh
>

29 
	~<şick/‘h”add»ss.hh
>

30 
	~<şick/¬gs.hh
>

31 
	~<şick/rou‹r.hh
>

32 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

33 
	~<şick/·ck‘_ªno.hh
>

34 
	~<şick/¡¿ccum.hh
>

35 
	~<¡dio.h
>

36 
	~<uni¡d.h
>

38 #ià
TODEVICE_ALLOW_DEVBPF


39 
	~<fú.h
>

40 
	~<sys/ty³s.h
>

41 
	~<sys/sock‘.h
>

42 
	~<sys/ioùl.h
>

43 
	~<Ãt/if.h
>

45 #ià
TODEVICE_ALLOW_LINUX


46 
	~<sys/sock‘.h
>

47 
	~<sys/ioùl.h
>

48 
	~<Ãt/if.h
>

49 
	~<Ãt/if_·ck‘.h
>

50 
	~<ã©u»s.h
>

51 #ià
__GLIBC__
 >ğ2 && 
__GLIBC_MINOR__
 >= 1

52 
	~<Ãack‘/·ck‘.h
>

54 
	~<lšux/if_·ck‘.h
>

57 #ià
TODEVICE_ALLOW_NETMAP


61 
CLICK_DECLS


63 
	gToDeviû
::
	$ToDeviû
()

64 : 
	`_sk
(
this
), 
	`_tim”
(&
_sk
), 
	`_q
(0), 
	$_puÎs
(0)

66 #ià
TODEVICE_ALLOW_PCAP


67 
_pÿp
 = 0;

68 
_my_pÿp
 = 
çl£
;

70 #ià
TODEVICE_ALLOW_LINUX
 || 
TODEVICE_ALLOW_DEVBPF
 || 
TODEVICE_ALLOW_PCAPFD
 || 
TODEVICE_ALLOW_NETMAP


71 
_fd
 = -1;

72 
_my_fd
 = 
çl£
;

74 
	}
}

76 
	gToDeviû
::~
	$ToDeviû
()

78 
	}
}

81 
ToDeviû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

83 
SŒšg
 
	gm‘hod
;

84 
	g_bur¡
 = 1;

85 ià(
Args
(
cÚf
, 
this
, 
”rh
)

86 .
»ad_mp
("DEVNAME", 
_iâame
)

87 .
»ad
("DEBUG", 
_debug
)

88 .
»ad
("METHOD", 
WÜdArg
(), 
m‘hod
)

89 .
»ad
("BURST", 
_bur¡
)

90 .
com¶‘e
() < 0)

92 ià(!
	g_iâame
)

93  
	g”rh
->
”rÜ
("interface‚ot set");

94 ià(
	g_bur¡
 <= 0)

95  
”rh
->
”rÜ
("bad BURST");

97 ià(
	gm‘hod
 == "") {

98 #ià
TODEVICE_ALLOW_PCAP
 || 
TODEVICE_ALLOW_PCAPFD
 || 
TODEVICE_ALLOW_LINUX
 || 
TODEVICE_ALLOW_DEVBPF
 || 
TODEVICE_ALLOW_NETMAP


99 
_m‘hod
 = 
m‘hod_deçuÉ
;

101  
	g”rh
->
”rÜ
("cannot send…ackets onhis…latform");

104 #ià
TODEVICE_ALLOW_PCAP


105 ià(
	gm‘hod
 == "PCAP")

106 
_m‘hod
 = 
m‘hod_pÿp
;

108 #ià
TODEVICE_ALLOW_LINUX


109 ià(
	gm‘hod
 == "LINUX")

110 
_m‘hod
 = 
m‘hod_lšux
;

112 #ià
TODEVICE_ALLOW_DEVBPF


113 ià(
	gm‘hod
 == "DEVBPF")

114 
_m‘hod
 = 
m‘hod_devbpf
;

116 #ià
TODEVICE_ALLOW_PCAPFD


117 ià(
	gm‘hod
 == "PCAPFD")

118 
_m‘hod
 = 
m‘hod_pÿpfd
;

120 #ià
TODEVICE_ALLOW_NETMAP


121 ià(
	gm‘hod
 == "NETMAP")

122 
_m‘hod
 = 
m‘hod_Ãtm­
;

125  
	g”rh
->
”rÜ
("bad METHOD");

130 
FromDeviû
 *

131 
	gToDeviû
::
	$fšd_äomdeviû
() const

133 
Rou‹r
 *
r
 = 
	`rou‹r
();

134 
ei
 = 0;ƒ˜< 
r
->
	`ÃËm’ts
(); ++ei) {

135 
FromDeviû
 *
fd
 = (FromDeviû *è
r
->
	`–em’t
(
ei
)->
	`ÿ¡
("FromDevice");

136 ià(
fd
 && fd->
	`iâame
(è=ğ
_iâame
 && fd->
	`fd
() >= 0)

137  
fd
;

140 
	}
}

143 
	gToDeviû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

145 
_tim”
.
	`š™Ÿlize
(
this
);

147 
FromDeviû
 *
fd
 = 
	`fšd_äomdeviû
();

148 ià(
fd
 && 
_m‘hod
 =ğ
m‘hod_deçuÉ
) {

149 #ià
FROMDEVICE_ALLOW_NETMAP
 && 
TODEVICE_ALLOW_NETMAP


150 ià(
fd
->
	`Ãtm­
())

151 
_m‘hod
 = 
m‘hod_Ãtm­
;

153 #ià
FROMDEVICE_ALLOW_PCAP
 && 
TODEVICE_ALLOW_PCAP


154 ià(
fd
->
	`pÿp
())

155 
_m‘hod
 = 
m‘hod_pÿp
;

157 #ià
FROMDEVICE_ALLOW_LINUX
 && 
TODEVICE_ALLOW_LINUX


158 ià(
fd
->
	`lšux_fd
() >= 0)

159 
_m‘hod
 = 
m‘hod_lšux
;

163 #ià
TODEVICE_ALLOW_NETMAP


165 ià(
_m‘hod
 =ğ
m‘hod_deçuÉ
 || _m‘hod =ğ
m‘hod_Ãtm­
) {

166 ià(
fd
 && fd->
	`Ãtm­
()) {

167 
_fd
 = 
fd
->
	`fd
();

168 
_Ãtm­
 = *
fd
->
	`Ãtm­
();

170 
_fd
 = 
_Ãtm­
.
	`İ’
(
_iâame
, 
_m‘hod
 =ğ
m‘hod_Ãtm­
, 
”rh
);

171 ià(
_fd
 >= 0) {

172 
_my_fd
 = 
Œue
;

173 
	`add_£Ëù
(
_fd
, 
SELECT_READ
);

174 } ià(
_m‘hod
 =ğ
m‘hod_Ãtm­
)

177 ià(
_fd
 >= 0) {

178 
_m‘hod
 = 
m‘hod_Ãtm­
;

179 
_Ãtm­
.
	`š™Ÿlize_ršgs_tx
();

184 #ià
TODEVICE_ALLOW_PCAP


185 ià(
_m‘hod
 =ğ
m‘hod_deçuÉ
 || _m‘hod =ğ
m‘hod_pÿp
) {

186 ià(
fd
 && fd->
	`pÿp
())

187 
_pÿp
 = 
fd
->
	`pÿp
();

189 
_pÿp
 = 
FromDeviû
::
	`İ’_pÿp
(
_iâame
, FromDeviû::
deçuÉ_¢­Ën
, 
çl£
, 
”rh
);

190 ià(!
_pÿp
)

192 
_my_pÿp
 = 
Œue
;

194 
_fd
 = 
	`pÿp_f’o
(
_pÿp
);

195 
_m‘hod
 = 
m‘hod_pÿp
;

199 #ià
TODEVICE_ALLOW_DEVBPF


200 ià(
_m‘hod
 =ğ
m‘hod_deçuÉ
 || _m‘hod =ğ
m‘hod_devbpf
) {

202 
i
 = 0; i < 16 && 
_fd
 < 0; i++) {

203 
tmp
[64];

204 
	`¥rštf
(
tmp
, "/dev/bpf%d", 
i
);

205 
_fd
 = 
	`İ’
(
tmp
, 1);

207 ià(
_fd
 < 0)

208 (
”rh
->
	`”rÜ
("İ’ /dev/bpf* fÜ wr™e: %s", 
	`¡»¼Ü
(
”ºo
)));

209 
_my_fd
 = 
Œue
;

211 
iäeq
 
iä
;

212 
	`¡ºıy
(
iä
.
iä_Çme
, 
_iâame
.
	`c_¡r
(), (ifr.ifr_name));

213 
iä
.
iä_Çme
[(ifr.ifr_name) - 1] = 0;

214 ià(
	`ioùl
(
_fd
, 
BIOCSETIF
, (
ÿddr_t
)&
iä
) < 0)

215  
”rh
->
	`”rÜ
("BIOCSETIF % çed", 
iä
.
iä_Çme
);

216 #ifdeà
BIOCSHDRCMPLT


217 
yes
 = 1;

218 ià(
	`ioùl
(
_fd
, 
BIOCSHDRCMPLT
, (
ÿddr_t
)&
yes
) < 0)

219 
”rh
->
	`w¬nšg
("BIOCSHDRCMPLT % çed", 
iä
.
iä_Çme
);

221 
_m‘hod
 = 
m‘hod_devbpf
;

225 #ià
TODEVICE_ALLOW_LINUX


226 ià(
_m‘hod
 =ğ
m‘hod_deçuÉ
 || _m‘hod =ğ
m‘hod_lšux
) {

227 ià(
fd
 && fd->
	`lšux_fd
() >= 0)

228 
_fd
 = 
fd
->
	`lšux_fd
();

230 
_fd
 = 
FromDeviû
::
	`İ’_·ck‘_sock‘
(
_iâame
, 
”rh
);

231 ià(
_fd
 < 0)

233 
_my_fd
 = 
Œue
;

235 
_m‘hod
 = 
m‘hod_lšux
;

239 #ià
TODEVICE_ALLOW_PCAPFD


240 ià(
_m‘hod
 =ğ
m‘hod_deçuÉ
 || _m‘hod =ğ
m‘hod_pÿpfd
) {

241 
FromDeviû
 *
fd
 = 
	`fšd_äomdeviû
();

242 ià(
fd
 && fd->
	`pÿp
())

243 
_fd
 = 
fd
->
	`fd
();

245  
”rh
->
	`”rÜ
("initialized FromDevice„equired onhis…latform");

246 
_m‘hod
 = 
m‘hod_pÿpfd
;

251 *&
u£d
 = 
	`rou‹r
()->
	`fÜû_©chm’t
("deviû_wr™”_" + 
_iâame
);

252 ià(
u£d
)

253  
”rh
->
	`”rÜ
("du¶iÿ‹ wr™” fÜ deviû %<%s%>", 
_iâame
.
	`c_¡r
());

254 
u£d
 = 
this
;

256 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

257 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

259 
	}
}

262 
	gToDeviû
::
	$ş—nup
(
CËªupSge
)

264 #ià
TODEVICE_ALLOW_PCAP


265 ià(
_pÿp
 && 
_my_pÿp
)

266 
	`pÿp_şo£
(
_pÿp
);

267 
_pÿp
 = 0;

269 #ià
TODEVICE_ALLOW_NETMAP


270 ià(
_fd
 >ğ0 && 
_my_fd
 && 
_m‘hod
 =ğ
m‘hod_Ãtm­
) {

271 
_Ãtm­
.
	`şo£
(
_fd
);

272 
_fd
 = -1;

275 #ià
TODEVICE_ALLOW_LINUX
 || 
TODEVICE_ALLOW_DEVBPF
 || 
TODEVICE_ALLOW_PCAPFD
 || 
TODEVICE_ALLOW_NETMAP


276 ià(
_fd
 >ğ0 && 
_my_fd
)

277 
	`şo£
(
_fd
);

278 
_fd
 = -1;

280 
	}
}

294 
	gToDeviû
::
	$£nd_·ck‘
(
Pack‘
 *
p
)

296 
r
 = 0;

297 
”ºo
 = 0;

299 #ià
TODEVICE_ALLOW_NETMAP


300 ià(
_m‘hod
 =ğ
m‘hod_Ãtm­
) {

301 ià(
_Ãtm­
.
	`£nd_·ck‘
(
p
, 
	`nouuts
())) {

302 
”ºo
 = 
ENOBUFS
;

303 
r
 = -1;

305 
r
 = 0;

309 #ià
TODEVICE_ALLOW_PCAP


310 ià(
_m‘hod
 =ğ
m‘hod_pÿp
) {

311 #ià
HAVE_PCAP_INJECT


312 
r
 = 
	`pÿp_šjeù
(
_pÿp
, 
p
->
	`d©a
(),…->
	`Ëngth
());

314 
r
 = 
	`pÿp_£nd·ck‘
(
_pÿp
, 
p
->
	`d©a
(),…->
	`Ëngth
());

319 #ià
TODEVICE_ALLOW_LINUX


320 ià(
_m‘hod
 =ğ
m‘hod_lšux
)

321 
r
 = 
	`£nd
(
_fd
, 
p
->
	`d©a
(),…->
	`Ëngth
(), 0);

324 #ià
TODEVICE_ALLOW_DEVBPF


325 ià(
_m‘hod
 =ğ
m‘hod_devbpf
)

326 ià(
	`wr™e
(
_fd
, 
p
->
	`d©a
(),…->
	`Ëngth
()è!ğ(
ssize_t
)…->length())

327 
r
 = -1;

330 #ià
TODEVICE_ALLOW_PCAPFD


331 ià(
_m‘hod
 =ğ
m‘hod_pÿpfd
)

332 ià(
	`wr™e
(
_fd
, 
p
->
	`d©a
(),…->
	`Ëngth
()è!ğ(
ssize_t
)…->length())

333 
r
 = -1;

336 ià(
r
 >= 0)

339  
”ºo
 ? -”ºØ: -
EINVAL
;

340 
	}
}

342 
boŞ


343 
	gToDeviû
::
	$run_sk
(
Task
 *)

345 
Pack‘
 *
p
 = 
_q
;

346 
_q
 = 0;

347 
couÁ
 = 0, 
r
 = 0;

350 ià(!
p
) {

351 ++
_puÎs
;

352 ià(!(
p
 = 
	`šput
(0).
	`puÎ
()))

355 ià((
r
 = 
	`£nd_·ck‘
(
p
)) >= 0) {

356 
_backoff
 = 0;

357 
	`checked_ouut_push
(0, 
p
);

358 ++
couÁ
;

359 
p
 = 0;

362 } 
couÁ
 < 
_bur¡
);

364 ià(
r
 =ğ-
ENOBUFS
 ||„ =ğ-
EAGAIN
) {

365 
	`as£¹
(!
_q
);

366 
_q
 = 
p
;

368 ià(!
_backoff
) {

369 
_backoff
 = 1;

370 
	`add_£Ëù
(
_fd
, 
SELECT_WRITE
);

372 
_tim”
.
	`scheduË_aá”
(
Time¡amp
::
	`make_u£c
(
_backoff
));

373 ià(
_backoff
 < 256)

374 
_backoff
 *= 2;

375 ià(
_debug
) {

376 
Time¡amp
 
now
 = Time¡amp::
	`now
();

377 
	`şick_ch©‹r
("%p{–em’t} backšg ofàfÜ %d‡ˆ%p{time¡amp}\n", 
this
, 
_backoff
, &
now
);

380  
couÁ
 > 0;

381 } ià(
r
 < 0) {

382 
	`şick_ch©‹r
("ToDeviû(%s): %s", 
_iâame
.
	`c_¡r
(), 
	`¡»¼Ü
(-
r
));

383 
	`checked_ouut_push
(1, 
p
);

386 ià(
p
 || 
_sigÇl
)

387 
_sk
.
	`ç¡_»scheduË
();

388  
couÁ
 > 0;

389 
	}
}

392 
	gToDeviû
::
	$£Ëùed
(, )

394 
_sk
.
	`»scheduË
();

395 
	`»move_£Ëù
(
_fd
, 
SELECT_WRITE
);

396 
	}
}

399 
SŒšg


400 
	gToDeviû
::
	$»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

402 
ToDeviû
 *
td
 = (ToDeviû *)
e
;

403 (
ušŒ_t
è
thunk
) {

404 
h_debug
:

405  
	`SŒšg
(
td
->
_debug
);

406 
h_sigÇl
:

407  
	`SŒšg
(
td
->
_sigÇl
);

408 
h_puÎs
:

409  
	`SŒšg
(
td
->
_puÎs
);

410 
h_q
:

411  
	`SŒšg
((
boŞ
è
td
->
_q
);

413  
	`SŒšg
();

415 
	}
}

418 
	gToDeviû
::
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

419 
E¼ÜHªdËr
 *
”rh
)

421 
ToDeviû
 *
td
 = (ToDeviû *)
e
;

422 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

423 (
šŒ_t
)
v·¿m
) {

424 
h_debug
: {

425 
boŞ
 
debug
;

426 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

427  
”rh
->
	`”rÜ
("type mismatch");

428 
td
->
_debug
 = 
debug
;

433 
	}
}

436 
	gToDeviû
::
	$add_hªdËrs
()

438 
	`add_sk_hªdËrs
(&
_sk
);

439 
	`add_»ad_hªdËr
("debug", 
»ad_·¿m
, 
h_debug
, 
HªdËr
::
CHECKBOX
);

440 
	`add_»ad_hªdËr
("puÎs", 
»ad_·¿m
, 
h_puÎs
);

441 
	`add_»ad_hªdËr
("sigÇl", 
»ad_·¿m
, 
h_sigÇl
);

442 
	`add_»ad_hªdËr
("q", 
»ad_·¿m
, 
h_q
);

443 
	`add_wr™e_hªdËr
("debug", 
wr™e_·¿m
, 
h_debug
);

444 
	}
}

446 
CLICK_ENDDECLS


447 
	$ELEMENT_REQUIRES
(
FromDeviû
 
u£¾ev–
)

448 
	`EXPORT_ELEMENT
(
ToDeviû
)

	@userlevel/todevice.hh

1 #iâdeà
CLICK_TODEVICE_USERLEVEL_HH


2 
	#CLICK_TODEVICE_USERLEVEL_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/¡ršg.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şick/tim”.hh
>

7 
	~<şick/nÙif›r.hh
>

8 
	~"–em’ts/u£¾ev–/äomdeviû.hh
"

9 
	gCLICK_DECLS


68 #ià
defšed
(
__lšux__
)

69 
	#TODEVICE_ALLOW_LINUX
 1

	)

71 #ià
HAVE_PCAP
 && (
HAVE_PCAP_INJECT
 || 
HAVE_PCAP_SENDPACKET
)

73 
	~<pÿp.h
>

75 
	#TODEVICE_ALLOW_PCAP
 1

	)

77 #ià
defšed
(
__F»eBSD__
è|| defšed(
__O³nBSD__
è|| defšed(
__APPLE__
è|| defšed(
__N‘BSD__
)

78 
	#TODEVICE_ALLOW_DEVBPF
 1

	)

79 #–ià
defšed
(
__sun
)

80 
	#TODEVICE_ALLOW_PCAPFD
 1

	)

82 #ià
FROMDEVICE_ALLOW_NETMAP


83 
	#TODEVICE_ALLOW_NETMAP
 1

	)

86 şas 
	cToDeviû
 : 
public
 
EËm’t
 {…ublic:

88 
	$ToDeviû
(è
CLICK_COLD
;

89 ~
	$ToDeviû
(è
CLICK_COLD
;

91 cÚ¡ *
	$şass_Çme
() const {  "ToDevice"; }

92 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/0-2"; 
	}
}

93 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "l/h"; 
	}
}

94 cÚ¡ *
	$æags
(ècÚ¡ {  "S2"; 
	}
}

96 
	$cÚfigu»_pha£
(ècÚ¡ {  
K”ÃlF‹r
::
CONFIGURE_PHASE_TODEVICE
; 
	}
}

97 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

98 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

99 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

100 
	$add_hªdËrs
(è
CLICK_COLD
;

102 
SŒšg
 
	$iâame
(ècÚ¡ {  
_iâame
; 
	}
}

103 
	$fd
(ècÚ¡ {  
_fd
; 
	}
}

105 
boŞ
 
run_sk
(
Task
 *);

106 
£Ëùed
(
fd
, 
mask
);

108 
´Ùeùed
:

110 
Task
 
_sk
;

111 
Tim”
 
_tim”
;

113 
SŒšg
 
_iâame
;

114 #ià
TODEVICE_ALLOW_PCAP


115 
pÿp_t
 *
_pÿp
;

117 #ià
TODEVICE_ALLOW_LINUX
 || 
TODEVICE_ALLOW_DEVBPF
 || 
TODEVICE_ALLOW_PCAPFD
 || 
TODEVICE_ALLOW_NETMAP


118 
_fd
;

120 #ià
TODEVICE_ALLOW_NETMAP


121 
N‘m­Info
 
_Ãtm­
;

123 ’um { 
m‘hod_deçuÉ
, 
m‘hod_Ãtm­
, 
m‘hod_lšux
, 
m‘hod_pÿp
, 
m‘hod_devbpf
, 
m‘hod_pÿpfd
 };

124 
_m‘hod
;

125 
NÙif›rSigÇl
 
_sigÇl
;

127 
Pack‘
 *
_q
;

128 
_bur¡
;

130 
boŞ
 
_debug
;

131 #ià
TODEVICE_ALLOW_PCAP


132 
boŞ
 
_my_pÿp
;

134 #ià
TODEVICE_ALLOW_LINUX
 || 
TODEVICE_ALLOW_DEVBPF
 || 
TODEVICE_ALLOW_PCAPFD
 || 
TODEVICE_ALLOW_NETMAP


135 
boŞ
 
_my_fd
;

137 
_backoff
;

138 
_puÎs
;

140 ’um { 
h_debug
, 
h_sigÇl
, 
h_puÎs
, 
h_q
 };

141 
FromDeviû
 *
	$fšd_äomdeviû
() const;

142 
	`£nd_·ck‘
(
Pack‘
 *
p
);

143 
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

144 
SŒšg
 
	$»ad_·¿m
(
EËm’t
 *
e
, *
thunk
è
CLICK_COLD
;

146 
	}
};

148 
	gCLICK_ENDDECLS


	@userlevel/todpdkdevice.cc

18 
	~<şick/cÚfig.h
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/®gÜ™hm.hh
>

24 
	~"todpdkdeviû.hh
"

26 
CLICK_DECLS


28 
	gToDPDKDeviû
::
	$ToDPDKDeviû
() :

29 
	`_iqueues
(), 
	`_dev
(0), 
	`_queue_id
(0), 
	`_blockšg
(
çl£
),

30 
	`_iqueue_size
(1024), 
	`_bur¡_size
(32), 
	`_timeout
(0), 
	`_n_£Á
(0),

31 
	`_n_drİ³d
(0), 
	$_cÚge¡iÚ_w¬nšg_´š‹d
(
çl£
)

33 
	}
}

35 
	gToDPDKDeviû
::~
	$ToDPDKDeviû
()

37 
	}
}

39 
ToDPDKDeviû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41 
	gn_desc
 = -1;

42 
SŒšg
 
	gdev
;

43 
boŞ
 
	g®low_nÚexi¡’t
 = 
çl£
;

45 ià(
Args
(
cÚf
, 
this
, 
”rh
)

46 .
»ad_mp
("PORT", 
dev
)

47 .
»ad_p
("QUEUE", 
_queue_id
)

48 .
»ad
("IQUEUE", 
_iqueue_size
)

49 .
»ad
("BLOCKING", 
_blockšg
)

50 .
»ad
("BURST", 
_bur¡_size
)

51 .
»ad
("TIMEOUT", 
_timeout
)

52 .
»ad
("NDESC",
n_desc
)

53 .
»ad
("ALLOW_NONEXISTENT", 
®low_nÚexi¡’t
)

54 .
com¶‘e
() < 0)

57 ià(
	g_iqueue_size
 < 
	g_bur¡_size
) {

58 
	g_iqueue_size
 = 
_bur¡_size
;

59 
şick_ch©‹r
(

61 "m©ch BURST,h© i %d", 
Çme
().
c_¡r
(), 
_iqueue_size
);

64 ià(!
	gDPDKDeviûArg
::
·r£
(
dev
, 
_dev
)) {

65 ià(
	g®low_nÚexi¡’t
)

68  
	g”rh
->
”rÜ
("% : UnknowÀÜ inv®id PORT", 
dev
.
c_¡r
());

71  
	g_dev
->
add_tx_queue
(
_queue_id
, (
n_desc
 > 0è?‚_desø: 1024, 
”rh
);

74 
	gToDPDKDeviû
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

76 ià(!
_dev
)

79 
_iqueues
.
	`»size
(
	`şick_max_ıu_ids
());

81 
i
 = 0; i < 
_iqueues
.
	`size
(); i++) {

82 
_iqueues
[
i
].
pkts
 = 
Ãw
 
¹e_mbuf
 *[
_iqueue_size
];

83 ià(
_timeout
 >= 0) {

84 
_iqueues
[
i
].
timeout
.
	`assign
(
this
);

85 
_iqueues
[
i
].
timeout
.
	`š™Ÿlize
(
this
);

89  
DPDKDeviû
::
	`š™Ÿlize
(
”rh
);

90 
	}
}

92 
	gToDPDKDeviû
::
	$ş—nup
(
CËªupSge
)

94 
i
 = 0; i < 
_iqueues
.
	`size
(); i++)

95 
d–‘e
[] 
_iqueues
[
i
].
pkts
;

96 
	}
}

98 
SŒšg
 
	gToDPDKDeviû
::
	$n_£Á_hªdËr
(
EËm’t
 *
e
, *)

100 
ToDPDKDeviû
 *
tdd
 = 
¡©ic_ÿ¡
<ToDPDKDeviû *>(
e
);

101  
	`SŒšg
(
tdd
->
_n_£Á
);

102 
	}
}

104 
SŒšg
 
	gToDPDKDeviû
::
	$n_drİ³d_hªdËr
(
EËm’t
 *
e
, *)

106 
ToDPDKDeviû
 *
tdd
 = 
¡©ic_ÿ¡
<ToDPDKDeviû *>(
e
);

107  
	`SŒšg
(
tdd
->
_n_drİ³d
);

108 
	}
}

110 
	gToDPDKDeviû
::
	$»£t_couÁs_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *,

111 
E¼ÜHªdËr
 *)

113 
ToDPDKDeviû
 *
tdd
 = 
¡©ic_ÿ¡
<ToDPDKDeviû *>(
e
);

114 
tdd
->
_n_£Á
 = 0;

115 
tdd
->
_n_drİ³d
 = 0;

117 
	}
}

119 
	gToDPDKDeviû
::
	$add_hªdËrs
()

121 
	`add_»ad_hªdËr
("n_£Á", 
n_£Á_hªdËr
, 0);

122 
	`add_»ad_hªdËr
("n_drİ³d", 
n_drİ³d_hªdËr
, 0);

123 
	`add_wr™e_hªdËr
("»£t_couÁs", 
»£t_couÁs_hªdËr
, 0,

124 
HªdËr
::
BUTTON
);

125 
	}
}

131 
šlše
 
¹e_mbuf
* 
	$g‘_mbuf
(
Pack‘
* 
p
, 
boŞ
 
ü—‹
=
Œue
) {

132 
¹e_mbuf
* 
mbuf
 = 0;

134 ià(
	`lik–y
(
DPDKDeviû
::
	`is_dpdk_·ck‘
(
p
))) {

135 
mbuf
 = (
¹e_mbuf
 *è
p
->
	`de¡ruùÜ_¬gum’t
();

136 
	`¹e_pktmbuf_pkt_Ën
(
mbuf
èğ
p
->
	`Ëngth
();

137 
	`¹e_pktmbuf_d©a_Ën
(
mbuf
èğ
p
->
	`Ëngth
();

138 
mbuf
->
d©a_off
 = 
p
->
	`h—droom
();

139 ià(
p
->
	`sh¬ed
()) {

142 
	`¹e_mbuf_»fút_upd©e
(
mbuf
, 1);

145 
p
->
	`»£t_bufãr
();

147 } ià(
ü—‹
) {

148 
mbuf
 = 
	`¹e_pktmbuf_®loc
(
DPDKDeviû
::
	`g‘_mpoŞ
(
	`¹e_sock‘_id
()));

149 
	`memıy
((*è
	`¹e_pktmbuf_mtod
(
mbuf
, *), 
p
->
	`d©a
(),

150 
p
->
	`Ëngth
());

151 
	`¹e_pktmbuf_pkt_Ën
(
mbuf
èğ
p
->
	`Ëngth
();

152 
	`¹e_pktmbuf_d©a_Ën
(
mbuf
èğ
p
->
	`Ëngth
();

155  
mbuf
;

156 
	}
}

158 
	gToDPDKDeviû
::
	$run_tim”
(
Tim”
 *)

160 
	`æush_š‹º®_queue
(
_iqueues
[
	`şick_cu¼’t_ıu_id
()]);

161 
	}
}

165 
	gToDPDKDeviû
::
	$æush_š‹º®_queue
(
IÁ”ÇlQueue
 &
iqueue
) {

166 
£Á
 = 0;

167 
r
;

175 
sub_bur¡
;

177 
_lock
.
	`acquœe
();

180 
sub_bur¡
 = 
iqueue
.
Ä_³ndšg
 > 32 ? 32 : iqueue.nr_pending;

181 ià(
iqueue
.
šdex
 + 
sub_bur¡
 >ğ
_iqueue_size
)

183 
sub_bur¡
 = 
_iqueue_size
 - 
iqueue
.
šdex
;

184 
r
 = 
	`¹e_‘h_tx_bur¡
(
_dev
->
pÜt_id
, 
_queue_id
, &
iqueue
.
pkts
[iqueue.
šdex
],

185 
sub_bur¡
);

187 
iqueue
.
Ä_³ndšg
 -ğ
r
;

188 
iqueue
.
šdex
 +ğ
r
;

190 ià(
iqueue
.
šdex
 >ğ
_iqueue_size
)

191 
iqueue
.
šdex
 = 0;

193 
£Á
 +ğ
r
;

194 } 
r
 =ğ
sub_bur¡
 && 
iqueue
.
Ä_³ndšg
 > 0);

196 
_n_£Á
 +ğ
£Á
;

198 
_lock
.
	`»Ëa£
();

201 ià(
iqueue
.
Ä_³ndšg
 == 0)

202 
iqueue
.
šdex
 = 0;

203 
	}
}

205 
	gToDPDKDeviû
::
	$push
(, 
Pack‘
 *
p
)

207 ià(!
_dev
)

211 
IÁ”ÇlQueue
 &
iqueue
 = 
_iqueues
[
	`şick_cu¼’t_ıu_id
()];

213 
boŞ
 
cÚge¡iÚed
;

215 
cÚge¡iÚed
 = 
çl£
;

217 ià(
iqueue
.
Ä_³ndšg
 =ğ
_iqueue_size
) {

220 
cÚge¡iÚed
 = 
Œue
;

221 ià(!
_blockšg
) {

222 ià(
_n_drİ³d
 < 5)

223 
	`şick_ch©‹r
("%s:…ack‘ drİ³d", 
	`Çme
().
	`c_¡r
());

224 
_n_drİ³d
++;

226 ià(!
_cÚge¡iÚ_w¬nšg_´š‹d
)

227 
	`şick_ch©‹r
("%s: cÚge¡iÚ w¬nšg", 
	`Çme
().
	`c_¡r
());

228 
_cÚge¡iÚ_w¬nšg_´š‹d
 = 
Œue
;

231 
iqueue
.
pkts
[(iqueue.
šdex
 + iqueue.
Ä_³ndšg
è% 
_iqueue_size
] =

232 
	`g‘_mbuf
(
p
);

233 
iqueue
.
Ä_³ndšg
++;

236 ià(
iqueue
.
Ä_³ndšg
 >ğ
_bur¡_size
 || 
cÚge¡iÚed
) {

237 
	`æush_š‹º®_queue
(
iqueue
);

238 ià(
_timeout
 && 
iqueue
.
Ä_³ndšg
 == 0)

239 
iqueue
.
timeout
.
	`unscheduË
();

240 } ià(
_timeout
 >ğ0 && !
iqueue
.
timeout
.
	`scheduËd
()) {

241 ià(
_timeout
 == 0)

242 
iqueue
.
timeout
.
	`scheduË_now
();

244 
iqueue
.
timeout
.
	`scheduË_aá”_m£c
(
_timeout
);

248 } 
	`uÆik–y
(
_blockšg
 && 
cÚge¡iÚed
));

250 
p
->
	`kl
();

251 
	}
}

253 
CLICK_ENDDECLS


254 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
dpdk
)

255 
	$EXPORT_ELEMENT
(
ToDPDKDeviû
)

256 
	`ELEMENT_MT_SAFE
(
ToDPDKDeviû
)

	@userlevel/todpdkdevice.hh

1 #iâdeà
CLICK_TODPDKDEVICE_USERLEVEL_HH


2 
	#CLICK_TODPDKDEVICE_USERLEVEL_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sync.hh
>

6 
	~<şick/tim”.hh
>

7 
	~<şick/dpdkdeviû.hh
>

9 
CLICK_DECLS


111 şas 
	cToDPDKDeviû
 : 
public
 
EËm’t
 {

112 
public
:

114 
	$ToDPDKDeviû
(è
CLICK_COLD
;

115 ~
	$ToDPDKDeviû
(è
CLICK_COLD
;

117 cÚ¡ *
	$şass_Çme
() const {  "ToDPDKDevice"; }

118 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_0
; 
	}
}

119 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

120 
	$cÚfigu»_pha£
() const {

121  
CONFIGURE_PHASE_PRIVILEGED
;

122 
	}
}

123 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
çl£
; 
	}
}

125 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

126 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

128 
	$ş—nup
(
CËªupSge
 
¡age
è
CLICK_COLD
;

130 
	$add_hªdËrs
(è
CLICK_COLD
;

132 
	`run_tim”
(
Tim”
 *);

133 
	`push
(
pÜt
, 
Pack‘
 *
p
);

135 
´iv©e
:

142 şas 
	cIÁ”ÇlQueue
 {

143 
public
:

144 
	`IÁ”ÇlQueue
(è: 
	`pkts
(0), 
	`šdex
(0), 
	`Ä_³ndšg
(0) { }

147 
¹e_mbuf
 ** 
pkts
;

149 
šdex
;

151 
Ä_³ndšg
;

154 
Tim”
 
timeout
;

155 
	}
} 
__©Œibu‹__
((
®igÃd
(64)));

157 
SŒšg
 
	$n_£Á_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

158 
SŒšg
 
	$n_drİ³d_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

159 
	$»£t_couÁs_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *,

160 
E¼ÜHªdËr
 *è
CLICK_COLD
;

162 
	`æush_š‹º®_queue
(
IÁ”ÇlQueue
 &);

164 
VeùÜ
<
IÁ”ÇlQueue
> 
_iqueues
;

166 
DPDKDeviû
* 
_dev
;

167 
_queue_id
;

168 
boŞ
 
_blockšg
;

169 
Spšlock
 
_lock
;

170 
_iqueue_size
;

171 
_bur¡_size
;

172 
_timeout
;

173 
_n_£Á
;

174 
_n_drİ³d
;

175 
boŞ
 
_cÚge¡iÚ_w¬nšg_´š‹d
;

176 
	}
};

178 
	gCLICK_ENDDECLS


	@userlevel/todump.cc

22 
	~<şick/cÚfig.h
>

23 
	~<şick/glue.hh
>

24 
	~"todump.hh
"

25 
	~<şick/¬gs.hh
>

26 
	~<şick/rou‹r.hh
>

27 #ià
CLICK_NS


28 
	~<şick/ma¡”.hh
>

30 
	~<şick/”rÜ.hh
>

31 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

32 
	~<şick/·ck‘_ªno.hh
>

33 
	~"çk•ÿp.hh
"

34 
	~<şick/u£ruts.hh
>

35 #ià
HAVE_PCAP


37 
	~<pÿp.h
>

40 
CLICK_DECLS


42 
ToDump
::
	$ToDump
()

43 : 
	`_å
(0), 
	`_couÁ
(0), 
	`_sk
(
this
), 
	$_u£_’ÿp_äom
(0)

45 
	}
}

47 
ToDump
::~
	$ToDump
()

49 
	}
}

52 
ToDump
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

54 
SŒšg
 
’ÿp_ty³
;

55 
SŒšg
 
u£_’ÿp_äom
;

56 
_¢­Ën
 = 2000;

57 
_exŒa_Ëngth
 = 
Œue
;

58 
_unbufã»d
 = 
çl£
;

59 
_Çno
 = 
Time¡amp
::
sub£c_³r_£c
 =ğTime¡amp::
n£c_³r_£c
;

60 #ià
HAVE_PCAP
 && !
defšed
(
PCAP_TSTAMP_PRECISION_NANO
)

61 
_Çno
 = 
çl£
;

63 #ià
CLICK_NS


64 
boŞ
 
³r_node
 = 
çl£
;

67 ià(
Args
(
cÚf
, 
this
, 
”rh
)

68 .
»ad_mp
("FILENAME", 
F’ameArg
(), 
_f’ame
)

69 .
»ad_p
("SNAPLEN", 
_¢­Ën
)

70 .
»ad_p
("ENCAP", 
WÜdArg
(), 
’ÿp_ty³
)

71 .
»ad
("USE_ENCAP_FROM", 
AnyArg
(), 
u£_’ÿp_äom
)

72 .
»ad
("EXTRA_LENGTH", 
_exŒa_Ëngth
)

73 .
»ad
("UNBUFFERED", 
_unbufã»d
)

74 .
»ad
("NANO", 
_Çno
)

75 #ià
CLICK_NS


76 .
»ad
("PER_NODE", 
³r_node
)

78 .
com¶‘e
() < 0)

81 ià(
_¢­Ën
 == 0)

82 
_¢­Ën
 = 0xFFFFFFFFU;

84 ià(
u£_’ÿp_äom
 && 
’ÿp_ty³
)

85  
”rh
->
”rÜ
("specify‡t most one of 'ENCAP'‡nd 'USE_ENCAP_FROM'");

86 ià(
u£_’ÿp_äom
) {

87 
VeùÜ
<
SŒšg
> 
wÜds
;

88 
ı_¥aûvec
(
u£_’ÿp_äom
, 
wÜds
);

89 
_u£_’ÿp_äom
 = 
Ãw
 
EËm’t
 *[
wÜds
.
size
() + 1];

90 
i
 = 0; i < 
wÜds
.
size
(); i++)

91 ià(!(
_u£_’ÿp_äom
[
i
] = 
rou‹r
()->
fšd
(
wÜds
[i], 
this
, 
”rh
)))

93 
_u£_’ÿp_äom
[
wÜds
.
size
()] = 0;

94 ià(
wÜds
.
size
() == 0)

95  
”rh
->
”rÜ
("element‚ames missing‡fter 'USE_ENCAP_FROM'");

96 } ià(!
’ÿp_ty³
)

97 
_lškty³
 = 
FAKE_DLT_EN10MB
;

98 ià((
_lškty³
 = 
çke_pÿp_·r£_dÉ
(
’ÿp_ty³
)) < 0)

99  
”rh
->
”rÜ
("badƒncapsulationype");

101 #ià
CLICK_NS


102 ià(
³r_node
) {

103 
tmp
[255];

104 
r
 = 
simşick_sim_commªd
(
rou‹r
()->
simnode
(), 
SIMCLICK_GET_NODE_NAME
,
tmp
,255);

105 ià(
r
 >= 0)

106 
_f’ame
 = 
SŒšg
(
tmp
) + String("_") + _filename;

113 
ToDump
 *

114 
ToDump
::
	$hÙsw­_–em’t
() const

116 ià(
EËm’t
 *
e
 = EËm’t::
	`hÙsw­_–em’t
())

117 ià(
ToDump
 *
td
 = (ToDum°*)
e
->
	`ÿ¡
("ToDump"))

118 ià(
td
->
_f’ame
 == _filename

119 && 
td
->
_lškty³
 == _linktype)

120  
td
;

122 
	}
}

125 
ToDump
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

128 ià(
_u£_’ÿp_äom
) {

129 
_lškty³
 = -1;

131 
VeùÜ
<
SŒšg
> 
’ÿp_ty³s
;

132 
i
 = 0; 
_u£_’ÿp_äom
[i]; i++) {

133 cÚ¡ 
HªdËr
 *
h
 = 
Rou‹r
::
	`hªdËr
(
_u£_’ÿp_äom
[
i
], "encap");

134 ià(!
h
 || !h->
	`»adabË
())

135  
”rh
->
	`”rÜ
("%<%p{–em’t}%> ha nØ%<’ÿp%>„—d hªdËr", 
_u£_’ÿp_äom
[
i
]);

136 
’ÿp_ty³s
.
	`push_back
(
	`ı_uncomm’t
(
h
->
	`ÿÎ_»ad
(
_u£_’ÿp_äom
[
i
])));

139 
i
 = 0; i < 
’ÿp_ty³s
.
	`size
(); i++) {

140 
‘
 = 
	`çke_pÿp_·r£_dÉ
(
’ÿp_ty³s
[
i
]);

141 ià(
‘
 < 0)

142  
”rh
->
	`”rÜ
("%<%p{–em’t}.’ÿp%> did‚Ù„‘uº‡ v®idƒnÿpsuÏtiÚy³", 
_u£_’ÿp_äom
[
i
]);

143 ià(
_lškty³
 >ğ0 && 
‘
 != _linktype) {

144 
”rh
->
	`”rÜ
("sourceƒncapsulationypes disagree:");

145 
j
 = 0; j < 
’ÿp_ty³s
.
	`size
(); j++)

146 
”rh
->
	`”rÜ
(" % ha %s\n", 
_u£_’ÿp_äom
[
j
]->
	`deş¬©iÚ
().
	`c_¡r
(), 
’ÿp_ty³s
[j].c_str());

147  -
EINVAL
;

149 
_lškty³
 = 
‘
;

154 ià(!
	`hÙsw­_–em’t
()) {

157 
	`as£¹
(!
_å
);

158 ià(
_f’ame
 != "-") {

159 ià(
	`com´es£d_f’ame
(
_f’ame
) > 0)

160 
_å
 = 
	`İ’_com´ess_pe
(
_f’ame
, 
”rh
);

162 
_å
 = 
	`fİ’
(
_f’ame
.
	`c_¡r
(), "wb");

163 ià(!
_å
)

164  
”rh
->
	`”rÜ
("%s: %s", 
_f’ame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

166 
_å
 = 
¡dout
;

167 
_f’ame
 = "<stdout>";

170 ià(
_unbufã»d
)

171 
	`£tvbuf
(
_å
, (*è0, 
_IONBF
, 0);

173 
çke_pÿp_fe_h—d”
 
h
;

175 
h
.
magic
 = 
_Çno
 ? 
FAKE_PCAP_MAGIC_NANO
 : 
FAKE_PCAP_MAGIC
;

176 
h
.
v”siÚ_majÜ
 = 
FAKE_PCAP_VERSION_MAJOR
;

177 
h
.
v”siÚ_mšÜ
 = 
FAKE_PCAP_VERSION_MINOR
;

179 
h
.
thiszÚe
 = 0;

180 
h
.
sigfigs
 = 0;

181 
h
.
¢­Ën
 = 
_¢­Ën
;

182 
h
.
lškty³
 = 
_lškty³
;

184 
size_t
 
wrÙe_h—d”
 = 
	`fwr™e
(&
h
, (h), 1, 
_å
);

185 ià(
wrÙe_h—d”
 != 1)

186  
”rh
->
	`”rÜ
("%s: uÇbËØwr™fh—d”", 
_f’ame
.
	`c_¡r
());

189 ià(
	`šput_is_puÎ
(0è&& 
	`nouuts
() == 0) {

190 
ScheduËInfo
::
	`još_scheduËr
(
this
, &
_sk
, 
”rh
);

191 
_sigÇl
 = 
NÙif›r
::
	`up¡»am_em±y_sigÇl
(
this
, 0, &
_sk
);

193 
_aùive
 = 
Œue
;

195 
	}
}

198 
ToDump
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *)

200 
ToDump
 *
td
 = 
¡©ic_ÿ¡
<ToDum°*>(
e
);

201 
_å
 = 
td
->_fp;

202 
td
->
_å
 = 0;

203 
	}
}

206 
ToDump
::
	$ş—nup
(
CËªupSge
)

208 ià(
_å
 && _å !ğ
¡dout
)

209 
	`fşo£
(
_å
);

210 
_å
 = 0;

211 
	}
}

214 
ToDump
::
	$wr™e_·ck‘
(
Pack‘
 *
p
)

216 
çke_pÿp_pkthdr
 
ph
;

218 
Time¡amp
 
ts
 = 
p
->
	`time¡amp_ªno
();

219 ià(!
ts
)

220 
ts
 = 
Time¡amp
::
	`now
();

221 
ph
.
ts
.
tv
.
tv_£c
 =s.
	`£c
();

222 
ph
.
ts
.
tv
.
tv_u£c
 = 
_Çno
 ?s.
	`n£c
(è:s.
	`u£c
();

224 
to_wr™e
 = 
p
->
	`Ëngth
();

225 
ph
.
Ën
 = 
to_wr™e
 + (
_exŒa_Ëngth
 ? 
	`EXTRA_LENGTH_ANNO
(
p
) : 0);

226 ià(
_¢­Ën
 && 
to_wr™e
 > _snaplen)

227 
to_wr™e
 = 
_¢­Ën
;

228 
ph
.
ÿ¶’
 = 
to_wr™e
;

231 ià(
	`fwr™e
(&
ph
, Õh), 1, 
_å
) == 0

232 || (
to_wr™e
 > 0 && 
	`fwr™e
(
p
->
	`d©a
(), 1,o_wr™e, 
_å
) == 0)) {

233 ià(
”ºo
 !ğ
EAGAIN
) {

234 
_aùive
 = 
çl£
;

235 
	`şick_ch©‹r
("ToDump(%s): %s", 
_f’ame
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

238 
_couÁ
++;

239 
	}
}

242 
ToDump
::
	$push
(, 
Pack‘
 *
p
)

244 ià(
_aùive
)

245 
	`wr™e_·ck‘
(
p
);

246 
	`checked_ouut_push
(0, 
p
);

247 
	}
}

249 
Pack‘
 *

250 
ToDump
::
	$puÎ
()

252 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

253 ià(
_aùive
 && 
p
)

254 
	`wr™e_·ck‘
(
p
);

255  
p
;

256 
	}
}

258 
boŞ


259 
ToDump
::
	$run_sk
(
Task
 *)

261 ià(!
_aùive
)

262  
çl£
;

263 
Pack‘
 *
p
 = 
	`šput
(0).
	`puÎ
();

264 ià(
p
) {

265 
	`wr™e_·ck‘
(
p
);

266 
p
->
	`kl
();

267 } ià(!
_sigÇl
)

268  
çl£
;

269 
_sk
.
	`ç¡_»scheduË
();

270  
p
 != 0;

271 
	}
}

273 ’um { 
H_FILENAME
 = 0, 
H_COUNT
 = 1, 
H_RESET_COUNTS
 = 2 };

275 
SŒšg


276 
	gToDump
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

278 
ToDump
 *
td
 = 
¡©ic_ÿ¡
<ToDum°*>(
e
);

279 (
ušŒ_t
è
thunk
) {

280 
H_FILENAME
:

281  
td
->
_f’ame
;

282 
H_COUNT
:

283  
	`SŒšg
(
td
->
_couÁ
);

287 
	}
}

290 
	gToDump
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *
e
, *, 
E¼ÜHªdËr
 *)

292 
ToDump
 *
td
 = 
¡©ic_ÿ¡
<ToDum°*>(
e
);

293 
td
->
_couÁ
 = 0;

295 
	}
}

298 
	gToDump
::
	$add_hªdËrs
()

300 
	`add_»ad_hªdËr
("f’ame", 
»ad_hªdËr
, 
H_FILENAME
);

301 
	`add_»ad_hªdËr
("couÁ", 
»ad_hªdËr
, 
H_COUNT
);

302 
	`add_wr™e_hªdËr
("»£t_couÁs", 
wr™e_hªdËr
, 
H_RESET_COUNTS
, 
HªdËr
::
BUTTON
);

303 ià(
	`šput_is_puÎ
(0è&& 
	`nouuts
() == 0)

304 
	`add_sk_hªdËrs
(&
_sk
);

305 
	}
}

307 
CLICK_ENDDECLS


308 
ELEMENT_REQUIRES
(
u£¾ev–
|
ns
 
FakePÿp
)

309 
EXPORT_ELEMENT
(
ToDump
)

	@userlevel/todump.hh

2 #iâdeà
CLICK_TODUMP_HH


3 
	#CLICK_TODUMP_HH


	)

4 
	~<şick/tim”.hh
>

5 
	~<şick/–em’t.hh
>

6 
	~<şick/sk.hh
>

7 
	~<şick/nÙif›r.hh
>

8 
	~<¡dio.h
>

9 
CLICK_DECLS


98 şas 
	cToDump
 : 
public
 
EËm’t
 {…ublic:

100 
	$ToDump
(è
CLICK_COLD
;

101 ~
	$ToDump
(è
CLICK_COLD
;

103 cÚ¡ *
	$şass_Çme
() const {  "ToDump"; }

104 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/0-1"; 
	}
}

105 cÚ¡ *
	$æags
(ècÚ¡ {  "S2"; 
	}
}

108 
	$cÚfigu»_pha£
(ècÚ¡ {  
CONFIGURE_PHASE_DEFAULT
+100; 
	}
}

109 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

110 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

111 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

112 
	$add_hªdËrs
(è
CLICK_COLD
;

113 
ToDump
 *
	$hÙsw­_–em’t
() const;

114 
	`ke_¡©e
(
EËm’t
 *, 
E¼ÜHªdËr
 *);

116 
	`push
(, 
Pack‘
 *);

117 
Pack‘
 *
	`puÎ
();

118 
boŞ
 
	`run_sk
(
Task
 *);

120 
´iv©e
:

122 
SŒšg
 
_f’ame
;

123 
FILE
 *
_å
;

124 
_¢­Ën
;

125 
_lškty³
;

126 
boŞ
 
_aùive
;

127 
boŞ
 
_exŒa_Ëngth
;

128 
boŞ
 
_unbufã»d
;

129 
boŞ
 
_Çno
;

131 #ià
HAVE_INT64_TYPES


132 
ušt64_t
 
	tcouÁ”_t
;

134 
ušt32_t
 
	tcouÁ”_t
;

136 
couÁ”_t
 
_couÁ
;

138 
Task
 
_sk
;

139 
NÙif›rSigÇl
 
_sigÇl
;

140 
EËm’t
 **
_u£_’ÿp_äom
;

142 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *, *è
CLICK_COLD
;

143 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

144 
	`wr™e_·ck‘
(
Pack‘
 *);

146 
	}
};

148 
	gCLICK_ENDDECLS


	@userlevel/tohost.cc

20 
	~<şick/cÚfig.h
>

21 
	~"toho¡.hh
"

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/b™veùÜ.hh
>

24 
	~<şick/¬gs.hh
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/glue.hh
>

27 
	~<şickÃt/‘h”.h
>

28 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

29 
	~<uni¡d.h
>

30 
	~<fú.h
>

31 
	~<sys/ioùl.h
>

32 
	~<¬·/š‘.h
>

34 
	~<Ãt/if.h
>

35 
	~<lšux/if_tun.h
>

36 
	~<şick/rou‹r.hh
>

37 
	~"äomho¡.hh
"

39 
CLICK_DECLS


41 
	gToHo¡
::
	$ToHo¡
()

42 : 
	`_fd
(-1), 
	$_drİs
(0)

44 
	}
}

46 
	gToHo¡
::~
	$ToHo¡
()

48 
	}
}

51 
ToHo¡
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

53  
Args
(
cÚf
, 
this
, 
”rh
)

54 .
»ad_mp
("DEVNAME", 
_dev_Çme
)

55 .
com¶‘e
();

59 
	gToHo¡
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

62 
ei
 = 0;ƒ˜< 
	`rou‹r
()->
	`ÃËm’ts
(è&& 
_fd
 < 0;ƒi++) {

63 
EËm’t
 *
e
 = 
	`rou‹r
()->
	`–em’t
(
ei
);

64 
FromHo¡
 *
s
 = (FromHo¡ *)
e
->
	`ÿ¡
("FromHost");

65 ià(
s
 &&

66 
s
->
	`dev_Çme
(è=ğ
_dev_Çme
 &&

67 
s
->
	`fd
() > 0) {

68 
_fd
 = 
s
->
	`fd
();

73  
”rh
->
	`”rÜ
("ToHost(%s)„equires‡n initialized FromHost withhe same dev_name",

74 
_dev_Çme
.
	`c_¡r
());

75 
	}
}

78 
	gToHo¡
::
	$push
(, 
Pack‘
 *
p
)

80 ià(
p
->
	`Ëngth
(è< (
şick_‘h”
)) {

81 
	`şick_ch©‹r
("ToHost:…acketoo small");

82 
p
->
	`kl
();

87 
Wr™abËPack‘
 *
q
 = 
p
->
	`push
(4);

88 ià(
q
) {

89 
şick_‘h”
 *
e
 = (şick_‘h” *è(
p
->
	`d©a
() + 4);

90 *(
ušt32_t
 *)(
q
->
	`d©a
()èğ
e
->
‘h”_ty³
;

92 
w
 = 
	`wr™e
(
_fd
, 
q
->
	`d©a
(), q->
	`Ëngth
());

93 
boŞ
 
_´š‹d_wr™e_”r
 = 
çl£
;

94 ià(
w
 !ğ(è
q
->
	`Ëngth
(è&& (
”ºo
 !ğ
ENOBUFS
 || !
_´š‹d_wr™e_”r
)) {

95 
_´š‹d_wr™e_”r
 = 
Œue
;

96 ++
_drİs
;

97 
	`şick_ch©‹r
("ToHo¡(%s): wr™çed: %s", 
_dev_Çme
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

99 
q
->
	`kl
();

101 
	`şick_ch©‹r
("%p{–em’t}: ouˆoàmemÜy", 
this
);

102 
	}
}

105 
	gToHo¡
::
	$add_hªdËrs
()

107 
	`add_d©a_hªdËrs
("dev_Çme", 
HªdËr
::
OP_READ
, &
_dev_Çme
);

108 
	`add_d©a_hªdËrs
("drİs", 
HªdËr
::
OP_READ
, &
_drİs
);

109 
	}
}

111 
CLICK_ENDDECLS


112 
	$ELEMENT_REQUIRES
(
u£¾ev–
 
FromHo¡
)

113 
	`EXPORT_ELEMENT
(
ToHo¡
)

	@userlevel/tohost.hh

2 #iâdeà
CLICK_TOHOST_USERLEVEL_HH


3 
	#CLICK_TOHOST_USERLEVEL_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/add»ss.hh
>

6 
	~<şick/‘h”add»ss.hh
>

7 
	~"äomho¡.hh
"

8 
CLICK_DECLS


47 şas 
	cToHo¡
 : 
public
 
EËm’t
 {…ublic:

49 
	$ToHo¡
(è
CLICK_COLD
;

50 ~
	$ToHo¡
(è
CLICK_COLD
;

52 cÚ¡ *
	$şass_Çme
() const {  "ToHost"; }

53 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_0
; 
	}
}

54 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

56 
	$cÚfigu»_pha£
(ècÚ¡ {  
FromHo¡
::
CONFIGURE_PHASE_TOHOST
; 
	}
}

57 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

58 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

59 
	$add_hªdËrs
(è
CLICK_COLD
;

61 
	`push
(
pÜt
, 
Pack‘
 *);

63 
´iv©e
:

65 
_fd
;

66 
_drİs
;

67 
SŒšg
 
_dev_Çme
;

69 
	}
};

71 
	gCLICK_ENDDECLS


	@userlevel/torawsocket.cc

19 
	~<şick/cÚfig.h
>

20 
	~"tÜawsock‘.hh
"

22 
CLICK_DECLS


24 
	gToRawSock‘
::
	$ToRawSock‘
()

26 
	`şick_ch©‹r
("warning: FromRawSocket is deprecated, use RawSocket instead");

27 
	}
}

29 
	gToRawSock‘
::~
	$ToRawSock‘
()

31 
	}
}

33 
CLICK_ENDDECLS


34 
	$ELEMENT_REQUIRES
(
RawSock‘
)

35 
	`EXPORT_ELEMENT
(
ToRawSock‘
)

	@userlevel/torawsocket.hh

2 #iâdeà
CLICK_TORAWSOCKET_HH


3 
	#CLICK_TORAWSOCKET_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~"¿wsock‘.hh
"

6 
CLICK_DECLS


39 şas 
	cToRawSock‘
 : 
public
 
RawSock‘
 {…ublic:

41 
	$ToRawSock‘
(è
CLICK_COLD
;

42 ~
	$ToRawSock‘
(è
CLICK_COLD
;

44 cÚ¡ *
	$şass_Çme
() const {  "ToRawSocket"; }

45 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

46 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

50 
	gCLICK_ENDDECLS


	@userlevel/tosocket.cc

19 
	~<şick/cÚfig.h
>

20 
	~"tosock‘.hh
"

22 
CLICK_DECLS


24 
	gToSock‘
::
	$ToSock‘
()

26 
	`şick_ch©‹r
("warning: ToSocket is deprecated, use Socket instead");

27 
	}
}

29 
	gToSock‘
::~
	$ToSock‘
()

31 
	}
}

33 
CLICK_ENDDECLS


34 
	$ELEMENT_REQUIRES
(
Sock‘
)

35 
	`EXPORT_ELEMENT
(
ToSock‘
)

	@userlevel/tosocket.hh

2 #iâdeà
CLICK_TOSOCKET_HH


3 
	#CLICK_TOSOCKET_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~"sock‘.hh
"

6 
CLICK_DECLS


36 şas 
	cToSock‘
 : 
public
 
Sock‘
 {…ublic:

38 
	$ToSock‘
(è
CLICK_COLD
;

39 ~
	$ToSock‘
(è
CLICK_COLD
;

41 cÚ¡ *
	$şass_Çme
() const {  "ToSocket"; }

42 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PULL
; 
	}
}

43 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

47 
	gCLICK_ENDDECLS


	@userlevel/umlswitch.cc

11 
	~<şick/cÚfig.h
>

12 
	~<şick/”rÜ.hh
>

13 
	~<şick/¬gs.hh
>

14 
	~<şick/¡¿ccum.hh
>

15 
	~<uni¡d.h
>

16 
	~<sys/sock‘.h
>

17 
	~<sys/un.h
>

18 
	~"umlsw™ch.hh
"

20 
CLICK_DECLS


23 
	gUMLSw™ch
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

25  
Args
(
cÚf
, 
this
, 
”rh
)

26 .
»ad_p
("PATH", 
F’ameArg
(), 
_ùl_·th
)

27 .
com¶‘e
();

31 
	gUMLSw™ch
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

33 
”r
 = 0, 
add¾’
;

34 
VeùÜ
<
SŒšg
> 
sock‘_cÚf
;

37 
_cÚŒŞ
 = 
	`sock‘
(
AF_UNIX
, 
SOCK_STREAM
, 0);

38 ià(
_cÚŒŞ
 < 0) {

39 
”r
 = 
”rh
->
	`”rÜ
("could‚ot create control socket");

40 
dÚe
;

43 
_ùl_addr
.
sun_çmy
 = 
AF_UNIX
;

44 ià(
_ùl_·th
.
	`Ëngth
(è>ğ()(((
sockaddr_un
 *)0)->
sun_·th
)) {

45 
”r
 = 
”rh
->
	`”rÜ
("patho uml_switch control socketoo†ong");

46 
dÚe
;

48 
	`¡rıy
(
_ùl_addr
.
sun_·th
, 
_ùl_·th
.
	`c_¡r
());

49 
add¾’
 = 
	`off£tof
(
sockaddr_un
, 
sun_·th
è+ 
_ùl_·th
.
	`Ëngth
() + 1;

50 ià(
	`cÚÃù
(
_cÚŒŞ
, (
sockaddr
 *)&
_ùl_addr
, 
add¾’
) < 0) {

51 
”r
 = 
”rh
->
	`”rÜ
("could‚Ù cÚÃùØcÚŒŞ sock‘ %s: %s", 
_ùl_·th
.
	`c_¡r
(), 
	`¡»¼Ü
(
”ºo
));

52 
dÚe
;

57 
z”o
;

58 
pid
;

59 
u£cs
;

60 } 
Çme
;

61 
Çme
.
z”o
 = 0;

62 
Çme
.
pid
 = 
	`g‘pid
();

63 
Çme
.
u£cs
 = 
Time¡amp
::
	`now
().
	`u£c
();

64 
_loÿl_addr
.
sun_çmy
 = 
AF_UNIX
;

65 
	`memıy
(
_loÿl_addr
.
sun_·th
, &
Çme
, (name));

68 
»que¡_v3
 
»q
;

69 
»q
.
magic
 = 
SWITCH_MAGIC
;

70 
»q
.
v”siÚ
 = 
SWITCH_VERSION
;

71 
»q
.
ty³
 = 
REQ_NEW_CONTROL
;

72 
»q
.
sock
 = 
_loÿl_addr
;

73 ià(
	`wr™e
(
_cÚŒŞ
, &
»q
, (req)) != (req)) {

74 
”r
 = 
”rh
->
	`”rÜ
("cÚŒŞ s‘u°»que¡ faed: %s", 
	`¡»¼Ü
(
”ºo
));

75 
dÚe
;

79 ià(
	`»ad
(
_cÚŒŞ
, &
_d©a_addr
, (_data_addr)) != (_data_addr)) {

80 
”r
 = 
”rh
->
	`”rÜ
("»ad oàd©¨sock‘ faed: %s", 
	`¡»¼Ü
(
”ºo
));

81 
dÚe
;

85 
add¾’
 = ()(((
sockaddr_un
 *)0)->
sun_·th
);

86 
sock‘_cÚf
.
	`push_back
(
	`SŒšg
("UNIX_DGRAM"));

87 
sock‘_cÚf
.
	`push_back
(
	`SŒšg
('"') +

88 
SŒšg
::
	`make_¡abË
(
_d©a_addr
.
sun_·th
, 
add¾’
).
	`quÙed_hex
() +

89 
	`SŒšg
('"'));

90 
sock‘_cÚf
.
	`push_back
(
	`SŒšg
('"') +

91 
SŒšg
::
	`make_¡abË
(
_loÿl_addr
.
sun_·th
, 
add¾’
).
	`quÙed_hex
() +

92 
	`SŒšg
('"'));

93 
sock‘_cÚf
.
	`push_back
(
	`SŒšg
("CLIENTrue"));

94 ià((
”r
 = 
Sock‘
::
	`cÚfigu»
(
sock‘_cÚf
, 
”rh
)) ||

95 (
”r
 = 
Sock‘
::
	`š™Ÿlize
(
”rh
)))

96 
dÚe
;

98 
dÚe
:

99  
”r
;

100 
	}
}

103 
	gUMLSw™ch
::
	$ş—nup
(
CËªupSge
 
¡age
)

105 
Sock‘
::
	`ş—nup
(
¡age
);

106 ià(
_cÚŒŞ
 >= 0)

107 
	`şo£
(
_cÚŒŞ
);

108 
	}
}

110 
CLICK_ENDDECLS


111 
	$ELEMENT_REQUIRES
(
Sock‘
)

112 
	`EXPORT_ELEMENT
(
UMLSw™ch
)

	@userlevel/umlswitch.hh

2 #iâdeà
CLICK_UMLSWITCH_HH


3 
	#CLICK_UMLSWITCH_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/¡ršg.hh
>

6 
	~<sys/un.h
>

7 
	~"sock‘.hh
"

8 
	gCLICK_DECLS


32 
	#SWITCH_VERSION
 3

	)

34 
	e»que¡_ty³
 { 
	mREQ_NEW_CONTROL
 };

36 
	#SWITCH_MAGIC
 0xãedçû

	)

38 
	s»que¡_v3
 {

39 
ušt32_t
 
	mmagic
;

40 
ušt32_t
 
	mv”siÚ
;

41 
»que¡_ty³
 
	mty³
;

42 
sockaddr_un
 
	msock
;

45 şas 
	cUMLSw™ch
 : 
public
 
Sock‘
 {…ublic:

47 
	$UMLSw™ch
(è: 
	`_ùl_·th
("/tmp/uml.ctl") {};

48 ~
	$UMLSw™ch
(è{
	}
};

50 cÚ¡ *
	$şass_Çme
(ècÚ¡ {  "UMLSw™ch"; 
	}
}

51 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "l/h"; 
	}
}

52 cÚ¡ *
	$æow_code
(ècÚ¡ {  "x/y"; 
	}
}

54 
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

55 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

56 
	$ş—nup
(
CËªupSge
è
CLICK_COLD
;

58 
´iv©e
:

59 
sockaddr_un
 
_ùl_addr
;

60 
sockaddr_un
 
_loÿl_addr
;

61 
sockaddr_un
 
_d©a_addr
;

63 
SŒšg
 
_ùl_·th
;

64 
_cÚŒŞ
;

65 
_¢­Ën
;

67 
	`š™Ÿlize_sock‘_”rÜ
(
E¼ÜHªdËr
 *, const *);

69 
	}
};

71 
	gCLICK_ENDDECLS


	@wifi/ap/associationresponder.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şickÃt/wifi.h
>

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/Îc.h
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/veùÜ.hh
>

27 
	~<şick/hashm­.hh
>

28 
	~<şick/·ck‘_ªno.hh
>

29 
	~<şick/”rÜ.hh
>

30 
	~"assocŸtiÚ»¥Úd”.hh
"

31 
	~<–em’ts/wifi/avaabË¿‹s.hh
>

32 
	~<–em’ts/wifi/wœ–essšfo.hh
>

33 
CLICK_DECLS


35 
	gAssocŸtiÚRe¥Úd”
::
	$AssocŸtiÚRe¥Úd”
()

36 : 
	`_associd
(0),

37 
	`_¹abË
(0),

38 
	$_wšfo
(0)

40 
	}
}

42 
	gAssocŸtiÚRe¥Úd”
::~
	$AssocŸtiÚRe¥Úd”
()

44 
	}
}

47 
AssocŸtiÚRe¥Úd”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

50 
	g_debug
 = 
çl£
;

51 ià(
Args
(
cÚf
, 
this
, 
”rh
)

52 .
»ad
("DEBUG", 
_debug
)

53 .
»ad
("WIRELESS_INFO", 
EËm’tCa¡Arg
("Wœ–essInfo"), 
_wšfo
)

54 .
»ad_m
("RT", 
EËm’tCa¡Arg
("AvaabËR©es"), 
_¹abË
)

55 .
com¶‘e
() < 0)

62 
	gAssocŸtiÚRe¥Úd”
::
	$»cv_assocŸtiÚ_»que¡
(
Pack‘
 *
p
)

64 
ušt8_t
 
ty³
;

65 
ušt8_t
 
subty³
;

67 ià(
p
->
	`Ëngth
(è< (
şick_wifi
)) {

68 
	`şick_ch©‹r
("%p{element}:…acketoo small: %d vs %d\n",

69 
this
,

70 
p
->
	`Ëngth
(),

71 (
şick_wifi
));

73 
p
->
	`kl
();

77 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

80 
ty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_TYPE_MASK
;

81 
subty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_SUBTYPE_MASK
;

83 ià(
ty³
 !ğ
WIFI_FC0_TYPE_MGT
) {

84 
	`şick_ch©‹r
("%p{element}:„eceived‚on-management…acket\n",

85 
this
);

86 
p
->
	`kl
();

90 ià(
subty³
 !ğ
WIFI_FC0_SUBTYPE_ASSOC_REQ
) {

91 
	`şick_ch©‹r
("%p{element}:„eceived‚on-association-req…acket\n",

92 
this
);

93 
p
->
	`kl
();

97 
ušt8_t
 *
±r
;

99 
±r
 = (
ušt8_t
 *è
p
->
	`d©a
(è+ (
şick_wifi
);

102 
ušt16_t
 
ÿ·b™y
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

103 
±r
 += 2;

106 
ušt16_t
 
lšt
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

107 
±r
 += 2;

109 
ušt8_t
 *
’d
 = (ušt8_ˆ*è
p
->
	`d©a
(è+…->
	`Ëngth
();

111 
ušt8_t
 *
ssid_l
 = 
NULL
;

112 
ušt8_t
 *
¿‹s_l
 = 
NULL
;

114 
±r
 < 
’d
) {

115 *
±r
) {

116 
WIFI_ELEMID_SSID
:

117 
ssid_l
 = 
±r
;

119 
WIFI_ELEMID_RATES
:

120 
¿‹s_l
 = 
±r
;

123 ià(
_debug
) {

124 
	`şick_ch©‹r
("%p{element}: ignoredƒlement id %u %u \n",

125 
this
,

126 *
±r
,

127 
±r
[1]);

130 
±r
 +=…tr[1] + 2;

135 
VeùÜ
<> 
basic_¿‹s
;

136 
VeùÜ
<> 
¿‹s
;

137 
VeùÜ
<> 
®l_¿‹s
;

138 ià(
¿‹s_l
) {

139 
x
 = 0; x < 
	`WIFI_MIN
(()
¿‹s_l
[1], 
WIFI_RATES_MAXSIZE
); x++) {

140 
ušt8_t
 
¿‹
 = 
¿‹s_l
[
x
 + 2];

142 ià(
¿‹
 & 
WIFI_RATE_BASIC
) {

143 
basic_¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

145 
¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

147 
®l_¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

152 
SŒšg
 
ssid
;

153 
SŒšg
 
my_ssid
 = 
_wšfo
 ? _wšfo->
_ssid
 : "";

154 ià(
ssid_l
 && ssid_l[1]) {

155 
ssid
 = 
	`SŒšg
((*è
ssid_l
 + 2, 
	`WIFI_MIN
(()ssid_l[1], 
WIFI_NWID_MAXSIZE
));

158 
ssid
 = "";

163 ià(
ssid
 !ğ"" && ssid !ğ
my_ssid
) {

164 ià(
_debug
) {

165 
	`şick_ch©‹r
("%p{element}: other ssid %s wanted %s\n",

166 
this
,

167 
ssid
.
	`c_¡r
(),

168 
my_ssid
.
	`c_¡r
());

170 
p
->
	`kl
();

174 
SŒšgAccum
 
§
;

177 
Eth”Add»ss
 
d¡
 = 
	`Eth”Add»ss
(
w
->
i_addr1
);

178 
Eth”Add»ss
 
¤c
 = 
	`Eth”Add»ss
(
w
->
i_addr2
);

179 
Eth”Add»ss
 
bssid
 = 
	`Eth”Add»ss
(
w
->
i_addr3
);

181 
§
 << "¤ø" << 
¤c
;

182 
§
 << " d¡ " << 
d¡
;

183 
§
 << " bssid " << 
bssid
;

184 
§
 << "[ ";

185 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_ESS
) {

186 
§
 << "ESS ";

188 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_IBSS
) {

189 
§
 << "IBSS ";

191 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_CF_POLLABLE
) {

192 
§
 << "CF_POLLABLE ";

194 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_CF_POLLREQ
) {

195 
§
 << "CF_POLLREQ ";

197 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_PRIVACY
) {

198 
§
 << "PRIVACY ";

200 
§
 << "] ";

202 
§
 << "†i¡’_šˆ" << 
lšt
 << " ";

204 
§
 << "( { ";

205 
x
 = 0; x < 
basic_¿‹s
.
	`size
(); x++) {

206 
§
 << 
basic_¿‹s
[
x
] << " ";

208 
§
 << "} ";

209 
x
 = 0; x < 
¿‹s
.
	`size
(); x++) {

210 
§
 << 
¿‹s
[
x
] << " ";

213 
§
 << ")\n";

215 
	`şick_ch©‹r
("%p{element}:„equest %s\n",

216 
this
,

217 
§
.
	`ke_¡ršg
().
	`c_¡r
());

221 
ušt16_t
 
associd
 = 0xc000 | 
_associd
++;

223 ià(
_debug
) {

224 
	`şick_ch©‹r
("%p{element}:‡ssociation %s‡ssocid %d\n",

225 
this
,

226 
¤c
.
	`uÅ¬£
().
	`c_¡r
(),

227 
associd
);

229 
	`£nd_assocŸtiÚ_»¥Ú£
(
¤c
, 
WIFI_STATUS_SUCCESS
, 
associd
);

230 
p
->
	`kl
();

232 
	}
}

236 
	gAssocŸtiÚRe¥Úd”
::
	$push
(, 
Pack‘
 *
p
)

239 
	`»cv_assocŸtiÚ_»que¡
(
p
);

240 
	}
}

242 
	gAssocŸtiÚRe¥Úd”
::
	$£nd_assocŸtiÚ_»¥Ú£
(
Eth”Add»ss
 
d¡
, 
ušt16_t
 
¡©us
, ušt16_ˆ
associd
)

244 
Eth”Add»ss
 
bssid
 = 
_wšfo
 ? _wšfo->
_bssid
 : 
	`Eth”Add»ss
();

245 
VeùÜ
<> 
¿‹s
 = 
_¹abË
->
	`lookup
(
bssid
);

246 
max_Ën
 =  (
şick_wifi
) +

250 2 + 
WIFI_RATES_MAXSIZE
 +

251 2 + 
WIFI_RATES_MAXSIZE
 +

254 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
max_Ën
);

256 ià(
p
 == 0)

259 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

261 
w
->
i_fc
[0] = 
WIFI_FC0_VERSION_0
 | 
WIFI_FC0_TYPE_MGT
 | 
WIFI_FC0_SUBTYPE_ASSOC_RESP
;

262 
w
->
i_fc
[1] = 
WIFI_FC1_DIR_NODS
;

264 
	`memıy
(
w
->
i_addr1
, 
d¡
.
	`d©a
(), 6);

265 
	`memıy
(
w
->
i_addr2
, 
bssid
.
	`d©a
(), 6);

266 
	`memıy
(
w
->
i_addr3
, 
bssid
.
	`d©a
(), 6);

269 
w
->
i_dur
 = 0;

270 
w
->
i_£q
 = 0;

272 
ušt8_t
 *
±r
 = (ušt8_ˆ*è
p
->
	`d©a
(è+ (
şick_wifi
);

273 
aùu®_Ëngth
 = (
şick_wifi
);

275 
ušt16_t
 
ÿp_šfo
 = 0;

276 
ÿp_šfo
 |ğ
WIFI_CAPINFO_ESS
;

277 *(
ušt16_t
 *)
±r
 = 
	`ıu_to_Ë16
(
ÿp_šfo
);

278 
±r
 += 2;

279 
aùu®_Ëngth
 += 2;

281 *(
ušt16_t
 *)
±r
 = 
	`ıu_to_Ë16
(
¡©us
);

282 
±r
 += 2;

283 
aùu®_Ëngth
 += 2;

285 *(
ušt16_t
 *)
±r
 = 
	`ıu_to_Ë16
(
associd
);

286 
±r
 += 2;

287 
aùu®_Ëngth
 += 2;

291 
±r
[0] = 
WIFI_ELEMID_RATES
;

292 
±r
[1] = 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
());

293 
x
 = 0; x < 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
()); x++) {

294 
±r
[2 + 
x
] = (
ušt8_t
è
¿‹s
[x];

296 ià(
¿‹s
[
x
] == 2) {

297 
±r
 [2 + 
x
] |ğ
WIFI_RATE_BASIC
;

301 
±r
 +ğ2 + 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
());

302 
aùu®_Ëngth
 +ğ2 + 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
());

305 
num_x¿‹s
 = 
¿‹s
.
	`size
(è- 
WIFI_RATE_SIZE
;

306 ià(
num_x¿‹s
 > 0) {

308 
±r
[0] = 
WIFI_ELEMID_XRATES
;

309 
±r
[1] = 
num_x¿‹s
;

310 
x
 = 0; x < 
num_x¿‹s
; x++) {

311 
±r
[2 + 
x
] = (
ušt8_t
è
¿‹s
[x + 
WIFI_RATE_SIZE
];

313 ià(
¿‹s
[
x
 + 
WIFI_RATE_SIZE
] == 2) {

314 
±r
 [2 + 
x
] |ğ
WIFI_RATE_BASIC
;

318 
±r
 +ğ2 + 
num_x¿‹s
;

319 
aùu®_Ëngth
 +ğ2 + 
num_x¿‹s
;

322 
p
->
	`ke
(
max_Ën
 - 
aùu®_Ëngth
);

324 
	`ouut
(0).
	`push
(
p
);

325 
	}
}

329 
	gAssocŸtiÚRe¥Úd”
::
	$£nd_di§ssocŸtiÚ
(
Eth”Add»ss
 
d¡
, 
ušt16_t
 
»asÚ
)

332 
Eth”Add»ss
 
bssid
 = 
_wšfo
 ? _wšfo->
_bssid
 : 
	`Eth”Add»ss
();

333 
Ën
 =  (
şick_wifi
) +

337 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
Ën
);

339 ià(
p
 == 0)

342 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

344 
w
->
i_fc
[0] = 
WIFI_FC0_VERSION_0
 | 
WIFI_FC0_TYPE_MGT
 | 
WIFI_FC0_SUBTYPE_ASSOC_RESP
;

345 
w
->
i_fc
[1] = 
WIFI_FC1_DIR_NODS
;

347 
	`memıy
(
w
->
i_addr1
, 
d¡
.
	`d©a
(), 6);

348 
	`memıy
(
w
->
i_addr2
, 
bssid
.
	`d©a
(), 6);

349 
	`memıy
(
w
->
i_addr3
, 
bssid
.
	`d©a
(), 6);

352 
w
->
i_dur
 = 0;

353 
w
->
i_£q
 = 0;

356 
ušt8_t
 *
±r
;

358 
±r
 = (
ušt8_t
 *è
p
->
	`d©a
(è+ (
şick_wifi
);

360 *(
ušt16_t
 *)
±r
 = 
	`ıu_to_Ë16
(
»asÚ
);

361 
±r
 += 2;

363 
	`ouut
(0).
	`push
(
p
);

364 
	}
}

367 ’um {
	mH_DEBUG
};

369 
SŒšg


370 
	$AssocŸtiÚRe¥Úd”_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

372 
AssocŸtiÚRe¥Úd”
 *
td
 = (AssocŸtiÚRe¥Úd” *)
e
;

373 (
ušŒ_t
è
thunk
) {

374 
H_DEBUG
:

375  
	`SŒšg
(
td
->
_debug
) + "\n";

377  
	`SŒšg
();

379 
	}
}

381 
	$AssocŸtiÚRe¥Úd”_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

382 
E¼ÜHªdËr
 *
”rh
)

384 
AssocŸtiÚRe¥Úd”
 *
f
 = (AssocŸtiÚRe¥Úd” *)
e
;

385 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

386 (
šŒ_t
)
v·¿m
) {

387 
H_DEBUG
: {

388 
boŞ
 
debug
;

389 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

390  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

391 
f
->
_debug
 = 
debug
;

396 
	}
}

399 
	gAssocŸtiÚRe¥Úd”
::
	$add_hªdËrs
()

401 
	`add_»ad_hªdËr
("debug", 
AssocŸtiÚRe¥Úd”_»ad_·¿m
, 
H_DEBUG
);

403 
	`add_wr™e_hªdËr
("debug", 
AssocŸtiÚRe¥Úd”_wr™e_·¿m
, 
H_DEBUG
);

404 
	}
}

406 
CLICK_ENDDECLS


407 
EXPORT_ELEMENT
(
AssocŸtiÚRe¥Úd”
)

	@wifi/ap/associationresponder.hh

1 #iâdeà
CLICK_ASSOCIATIONRESPONDER_HH


2 
	#CLICK_ASSOCIATIONRESPONDER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


40 şas 
	cAssocŸtiÚRe¥Úd”
 : 
public
 
EËm’t
 {…ublic:

42 
	$AssocŸtiÚRe¥Úd”
(è
CLICK_COLD
;

43 ~
	$AssocŸtiÚRe¥Úd”
(è
CLICK_COLD
;

45 cÚ¡ *
	$şass_Çme
() const {  "AssociationResponder"; }

46 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

47 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

49 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

50 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

51 
	$add_hªdËrs
(è
CLICK_COLD
;

53 
	`£nd_assocŸtiÚ_»¥Ú£
(
Eth”Add»ss
, 
ušt16_t
 
¡©us
, ušt16_ˆ
associd
);

54 
	`»cv_assocŸtiÚ_»que¡
(
Pack‘
 *
p
);

55 
	`£nd_di§ssocŸtiÚ
(
Eth”Add»ss
, 
ušt16_t
 
»asÚ
);

56 
	`push
(, 
Pack‘
 *);

59 
boŞ
 
_debug
;

61 
ušt16_t
 
_associd
;

63 
SŒšg
 
	`sÿn_¡ršg
();

64 
şass
 
AvaabËR©es
 *
_¹abË
;

65 
şass
 
Wœ–essInfo
 *
_wšfo
;

66 
´iv©e
:

69 
	}
};

71 
	gCLICK_ENDDECLS


	@wifi/ap/beaconsource.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şickÃt/wifi.h
>

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/Îc.h
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/veùÜ.hh
>

27 
	~<şick/hashm­.hh
>

28 
	~<şick/·ck‘_ªno.hh
>

29 
	~<şick/tim”.hh
>

30 
	~<şick/”rÜ.hh
>

31 
	~"b—cÚsourû.hh
"

32 
	~<–em’ts/wifi/avaabË¿‹s.hh
>

33 
	~<–em’ts/wifi/wœ–essšfo.hh
>

34 
CLICK_DECLS


36 
	gB—cÚSourû
::
	$B—cÚSourû
()

37 : 
	`_tim”
(
this
),

38 
	$_¹abË
(0)

40 
_bÿ¡
 = 
	`Eth”Add»ss
();

41 
	`mem£t
(
_bÿ¡
.
	`d©a
(), 0xff, 6);

42 
	}
}

44 
	gB—cÚSourû
::~
	$B—cÚSourû
()

46 
	}
}

49 
B—cÚSourû
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

52 
	g_debug
 = 
çl£
;

53 ià(
Args
(
cÚf
, 
this
, 
”rh
)

54 .
»ad
("DEBUG", 
_debug
)

55 .
»ad_m
("WIRELESS_INFO", 
EËm’tCa¡Arg
("Wœ–essInfo"), 
_wšfo
)

56 .
»ad_m
("RT", 
EËm’tCa¡Arg
("AvaabËR©es"), 
_¹abË
)

57 .
com¶‘e
() < 0)

60 ià(
	g_wšfo
->
	g_š‹rv®
 <= 0) {

61  
”rh
->
”rÜ
("INTERVAL must be >0\n");

68 
	gB—cÚSourû
::
	$š™Ÿlize
 (
E¼ÜHªdËr
 *)

70 
_tim”
.
	`š™Ÿlize
(
this
);

71 
_tim”
.
	`scheduË_aá”_m£c
(
_wšfo
->
_š‹rv®
);

73 
	}
}

76 
	gB—cÚSourû
::
	$run_tim”
(
Tim”
 *)

78 
	`£nd_b—cÚ
(
_bÿ¡
, 
çl£
);

79 
_tim”
.
	`scheduË_aá”_m£c
(
_wšfo
->
_š‹rv®
);

80 
	}
}

83 
	gB—cÚSourû
::
	$£nd_b—cÚ
(
Eth”Add»ss
 
d¡
, 
boŞ
 
´obe
)

85 
Eth”Add»ss
 
bssid
 = 
_wšfo
 ? _wšfo->
_bssid
 : 
	`Eth”Add»ss
();

86 
SŒšg
 
my_ssid
 = 
_wšfo
 ? _wšfo->
_ssid
 : "";

87 
VeùÜ
<> 
¿‹s
 = 
_¹abË
->
	`lookup
(
bssid
);

92 
max_Ën
 =  (
şick_wifi
) +

96 2 + 
my_ssid
.
	`Ëngth
() +

97 2 + 
WIFI_RATES_MAXSIZE
 +

101 2 + 
WIFI_RATES_MAXSIZE
 +

105 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
max_Ën
);

107 ià(
p
 == 0)

110 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

112 
w
->
i_fc
[0] = 
WIFI_FC0_VERSION_0
 | 
WIFI_FC0_TYPE_MGT
;

113 ià(
´obe
) {

114 
w
->
i_fc
[0] |ğ
WIFI_FC0_SUBTYPE_PROBE_RESP
;

116 
w
->
i_fc
[0] |ğ
WIFI_FC0_SUBTYPE_BEACON
;

119 
w
->
i_fc
[1] = 
WIFI_FC1_DIR_NODS
;

121 
	`memıy
(
w
->
i_addr1
, 
d¡
.
	`d©a
(), 6);

122 
	`memıy
(
w
->
i_addr2
, 
bssid
.
	`d©a
(), 6);

123 
	`memıy
(
w
->
i_addr3
, 
bssid
.
	`d©a
(), 6);

125 
w
->
i_dur
 = 0;

126 
w
->
i_£q
 = 0;

128 
ušt8_t
 *
±r
;

130 
±r
 = (
ušt8_t
 *è
p
->
	`d©a
(è+ (
şick_wifi
);

131 
aùu®_Ëngth
 =  (
şick_wifi
);

135 
	`mem£t
(
±r
, 0, 8);

136 
±r
 += 8;

137 
aùu®_Ëngth
 += 8;

139 
ušt16_t
 
b—cÚ_št
 = (ušt16_tè
_wšfo
->
_š‹rv®
;

140 *(
ušt16_t
 *)
±r
 = 
	`ıu_to_Ë16
(
b—cÚ_št
);

141 
±r
 += 2;

142 
aùu®_Ëngth
 += 2;

144 
ušt16_t
 
ÿp_šfo
 = 0;

145 
ÿp_šfo
 |ğ
WIFI_CAPINFO_ESS
;

146 *(
ušt16_t
 *)
±r
 = 
	`ıu_to_Ë16
(
ÿp_šfo
);

147 
±r
 += 2;

148 
aùu®_Ëngth
 += 2;

151 
±r
[0] = 
WIFI_ELEMID_SSID
;

152 
±r
[1] = 
my_ssid
.
	`Ëngth
();

153 
	`memıy
(
±r
 + 2, 
my_ssid
.
	`d©a
(), my_ssid.
	`Ëngth
());

154 
±r
 +ğ2 + 
my_ssid
.
	`Ëngth
();

155 
aùu®_Ëngth
 +ğ2 + 
my_ssid
.
	`Ëngth
();

158 
±r
[0] = 
WIFI_ELEMID_RATES
;

159 
±r
[1] = 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
());

160 
x
 = 0; x < 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
()); x++) {

161 
±r
[2 + 
x
] = (
ušt8_t
è
¿‹s
[x];

163 ià(
¿‹s
[
x
] == 2) {

164 
±r
 [2 + 
x
] |ğ
WIFI_RATE_BASIC
;

168 
±r
 +ğ2 + 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
());

169 
aùu®_Ëngth
 +ğ2 + 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
());

173 
±r
[0] = 
WIFI_ELEMID_DSPARMS
;

174 
±r
[1] = 1;

175 
±r
[2] = (
ušt8_t
è
_wšfo
->
_chªÃl
;

176 
±r
 += 2 + 1;

177 
aùu®_Ëngth
 += 2 + 1;

181 
±r
[0] = 
WIFI_ELEMID_TIM
;

182 
±r
[1] = 4;

184 
±r
[2] = 0;

185 
±r
[3] = 1;

186 
±r
[4] = 0;

187 
±r
[5] = 0;

188 
±r
 += 2 + 4;

189 
aùu®_Ëngth
 += 2 + 4;

193 
num_x¿‹s
 = 
¿‹s
.
	`size
(è- 
WIFI_RATE_SIZE
;

194 ià(
num_x¿‹s
 > 0) {

196 
±r
[0] = 
WIFI_ELEMID_XRATES
;

197 
±r
[1] = 
num_x¿‹s
;

198 
x
 = 0; x < 
num_x¿‹s
; x++) {

199 
±r
[2 + 
x
] = (
ušt8_t
è
¿‹s
[x + 
WIFI_RATE_SIZE
];

201 ià(
¿‹s
[
x
 + 
WIFI_RATE_SIZE
] == 2) {

202 
±r
 [2 + 
x
] |ğ
WIFI_RATE_BASIC
;

206 
±r
 +ğ2 + 
num_x¿‹s
;

207 
aùu®_Ëngth
 +ğ2 + 
num_x¿‹s
;

210 
p
->
	`ke
(
max_Ën
 - 
aùu®_Ëngth
);

211 
	`ouut
(0).
	`push
(
p
);

212 
	}
}

217 
	gB—cÚSourû
::
	$push
(, 
Pack‘
 *
p
)

220 
ušt8_t
 
dœ
;

221 
ušt8_t
 
ty³
;

222 
ušt8_t
 
subty³
;

224 ià(
p
->
	`Ëngth
(è< (
şick_wifi
)) {

225 
	`şick_ch©‹r
("%p{element}:…acketoo small: %d vs %d\n",

226 
this
,

227 
p
->
	`Ëngth
(),

228 (
şick_wifi
));

230 
p
->
	`kl
();

234 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

237 
dœ
 = 
w
->
i_fc
[1] & 
WIFI_FC1_DIR_MASK
;

238 
ty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_TYPE_MASK
;

239 
subty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_SUBTYPE_MASK
;

241 ià(
ty³
 !ğ
WIFI_FC0_TYPE_MGT
) {

242 
	`şick_ch©‹r
("%p{element}:„eceived‚on-management…acket\n",

243 
this
);

244 
p
->
	`kl
();

248 ià(
subty³
 !ğ
WIFI_FC0_SUBTYPE_PROBE_REQ
) {

249 
	`şick_ch©‹r
("%p{element}:„eceived‚on-probe-req…acket\n",

250 
this
);

251 
p
->
	`kl
();

255 
ušt8_t
 *
±r
;

257 
±r
 = (
ušt8_t
 *è
p
->
	`d©a
(è+ (
şick_wifi
);

259 
ušt8_t
 *
’d
 = (ušt8_ˆ*è
p
->
	`d©a
(è+…->
	`Ëngth
();

261 
ušt8_t
 *
ssid_l
 = 
NULL
;

262 
ušt8_t
 *
¿‹s_l
 = 
NULL
;

264 
±r
 < 
’d
) {

265 *
±r
) {

266 
WIFI_ELEMID_SSID
:

267 
ssid_l
 = 
±r
;

269 
WIFI_ELEMID_RATES
:

270 
¿‹s_l
 = 
±r
;

273 ià(
_debug
) {

274 
	`şick_ch©‹r
("%p{element}: ignoredƒlement id %u %u \n",

275 
this
,

276 *
±r
,

277 
±r
[1]);

280 
±r
 +=…tr[1] + 2;

284 
SŒšgAccum
 
§
;

285 
SŒšg
 
ssid
 = "";

286 ià(
ssid_l
 && ssid_l[1]) {

287 
ssid
 = 
	`SŒšg
((*è
ssid_l
 + 2, 
	`WIFI_MIN
(()ssid_l[1], 
WIFI_NWID_MAXSIZE
));

292 ià(
ssid
 !ğ"" && ssid !ğ
_wšfo
->
_ssid
) {

293 ià(
_debug
) {

294 
	`şick_ch©‹r
("%p{element}: other ssid %s wanted %s\n",

295 
this
,

296 
ssid
.
	`c_¡r
(),

297 
_wšfo
->
_ssid
.
	`c_¡r
());

299 
p
->
	`kl
();

303 
Eth”Add»ss
 
¤c
 = 
	`Eth”Add»ss
(
w
->
i_addr2
);

305 
§
 << "ProbeReq: " << 
¤c
 << " ssid " << 
ssid
 << " ";

307 
§
 << "rates {";

308 ià(
¿‹s_l
) {

309 
x
 = 0; x < 
	`WIFI_MIN
(()
¿‹s_l
[1], 
WIFI_RATES_MAXSIZE
); x++) {

310 
ušt8_t
 
¿‹
 = 
¿‹s_l
[
x
 + 2];

312 ià(
¿‹
 & 
WIFI_RATE_BASIC
) {

313 
§
 << " * " << (è(
¿‹
 ^ 
WIFI_RATE_BASIC
);

315 
§
 << " " << (è
¿‹
;

319 
§
 << " }";

321 ià(
_debug
) {

322 
	`şick_ch©‹r
("%p{element}: %s\n",

323 
this
,

324 
§
.
	`ke_¡ršg
().
	`c_¡r
());

326 
	`£nd_b—cÚ
(
¤c
, 
Œue
);

328 
p
->
	`kl
();

330 
	}
}

332 ’um {
	mH_DEBUG
};

334 
SŒšg


335 
	$B—cÚSourû_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

337 
B—cÚSourû
 *
td
 = (B—cÚSourû *)
e
;

338 (
ušŒ_t
è
thunk
) {

339 
H_DEBUG
:

340  
	`SŒšg
(
td
->
_debug
) + "\n";

342  
	`SŒšg
();

344 
	}
}

346 
	$B—cÚSourû_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

347 
E¼ÜHªdËr
 *
”rh
)

349 
B—cÚSourû
 *
f
 = (B—cÚSourû *)
e
;

350 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

351 (
šŒ_t
)
v·¿m
) {

352 
H_DEBUG
: {

353 
boŞ
 
debug
;

354 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

355  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

356 
f
->
_debug
 = 
debug
;

361 
	}
}

364 
	gB—cÚSourû
::
	$add_hªdËrs
()

366 
	`add_»ad_hªdËr
("debug", 
B—cÚSourû_»ad_·¿m
, 
H_DEBUG
);

368 
	`add_wr™e_hªdËr
("debug", 
B—cÚSourû_wr™e_·¿m
, 
H_DEBUG
);

369 
	}
}

371 
CLICK_ENDDECLS


372 
EXPORT_ELEMENT
(
B—cÚSourû
)

	@wifi/ap/beaconsource.hh

1 #iâdeà
CLICK_BEACONSOURCE_HH


2 
	#CLICK_BEACONSOURCE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


40 şas 
	cB—cÚSourû
 : 
public
 
EËm’t
 {…ublic:

42 
	$B—cÚSourû
(è
CLICK_COLD
;

43 ~
	$B—cÚSourû
(è
CLICK_COLD
;

45 cÚ¡ *
	$şass_Çme
() const {  "BeaconSource"; }

46 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

47 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

49 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

50 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

51 
	$add_hªdËrs
(è
CLICK_COLD
;

52 
	`run_tim”
(
Tim”
 *);

53 
	`š™Ÿlize
 (
E¼ÜHªdËr
 *);

55 
	`£nd_b—cÚ
(
Eth”Add»ss
, 
boŞ
);

56 
	`push
(, 
Pack‘
 *);

59 
Tim”
 
_tim”
;

60 
boŞ
 
_debug
;

63 
Eth”Add»ss
 
_bÿ¡
;

64 
SŒšg
 
	`sÿn_¡ršg
();

66 
şass
 
Wœ–essInfo
 *
_wšfo
;

67 
şass
 
AvaabËR©es
 *
_¹abË
;

69 
´iv©e
:

72 
	}
};

74 
	gCLICK_ENDDECLS


	@wifi/ap/openauthresponder.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şickÃt/wifi.h
>

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/Îc.h
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/veùÜ.hh
>

27 
	~<şick/hashm­.hh
>

28 
	~<şick/·ck‘_ªno.hh
>

29 
	~<şick/”rÜ.hh
>

30 
	~"İ’auth»¥Úd”.hh
"

31 
	~<–em’ts/wifi/wœ–essšfo.hh
>

33 
CLICK_DECLS


35 
	gO³nAuthRe¥Úd”
::
	$O³nAuthRe¥Úd”
()

37 
	}
}

39 
O³nAuthRe¥Úd”
::~
	$O³nAuthRe¥Úd”
()

41 
	}
}

44 
O³nAuthRe¥Úd”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

47 
	g_debug
 = 
çl£
;

48 ià(
Args
(
cÚf
, 
this
, 
”rh
)

49 .
»ad
("DEBUG", 
_debug
)

50 .
»ad_m
("WIRELESS_INFO", 
EËm’tCa¡Arg
("Wœ–essInfo"), 
_wšfo
)

51 .
com¶‘e
() < 0)

57 
	gO³nAuthRe¥Úd”
::
	$push
(, 
Pack‘
 *
p
)

60 
ušt8_t
 
dœ
;

61 
ušt8_t
 
ty³
;

62 
ušt8_t
 
subty³
;

64 ià(
p
->
	`Ëngth
(è< (
şick_wifi
)) {

65 
	`şick_ch©‹r
("%p{element}:…acketoo small: %d vs %d\n",

66 
this
,

67 
p
->
	`Ëngth
(),

68 (
şick_wifi
));

70 
p
->
	`kl
();

74 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

77 
dœ
 = 
w
->
i_fc
[1] & 
WIFI_FC1_DIR_MASK
;

78 
ty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_TYPE_MASK
;

79 
subty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_SUBTYPE_MASK
;

81 ià(
ty³
 !ğ
WIFI_FC0_TYPE_MGT
) {

82 
	`şick_ch©‹r
("%p{element}:„eceived‚on-management…acket\n",

83 
this
);

84 
p
->
	`kl
();

88 ià(
subty³
 !ğ
WIFI_FC0_SUBTYPE_AUTH
) {

89 
	`şick_ch©‹r
("%p{element}:„eceived‚on-probe-req…acket\n",

90 
this
);

91 
p
->
	`kl
();

95 
ušt8_t
 *
±r
;

97 
±r
 = (
ušt8_t
 *è
p
->
	`d©a
(è+ (
şick_wifi
);

101 
ušt16_t
 
®go
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

102 
±r
 += 2;

104 
ušt16_t
 
£q
 =
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

105 
±r
 += 2;

107 
ušt16_t
 
¡©us
 =
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

108 
±r
 += 2;

111 
Eth”Add»ss
 
¤c
 = 
	`Eth”Add»ss
(
w
->
i_addr2
);

112 ià(
®go
 !ğ
WIFI_AUTH_ALG_OPEN
) {

113 
	`şick_ch©‹r
("%p{element}:‡uth %d from %s‚ot supported\n",

114 
this
,

115 
®go
,

116 
¤c
.
	`uÅ¬£
().
	`c_¡r
());

117 
p
->
	`kl
();

121 ià(
£q
 != 1) {

122 
	`şick_ch©‹r
("%p{element}:‡uth %d weird sequence‚umber %d\n",

123 
this
,

124 
®go
,

125 
£q
);

126 
p
->
	`kl
();

130 ià(
_debug
) {

131 
	`şick_ch©‹r
("%p{element}:‡uth %d seq %d status %d\n",

132 
this
,

133 
®go
,

134 
£q
,

135 
¡©us
);

137 
	`£nd_auth_»¥Ú£
(
¤c
, 2, 
WIFI_STATUS_SUCCESS
);

139 
p
->
	`kl
();

141 
	}
}

143 
	gO³nAuthRe¥Úd”
::
	$£nd_auth_»¥Ú£
(
Eth”Add»ss
 
d¡
, 
ušt16_t
 
£q
, ušt16_ˆ
¡©us
)

146 
Ën
 =  (
şick_wifi
) +

152 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
Ën
);

154 ià(
p
 == 0)

157 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

159 
w
->
i_fc
[0] = 
WIFI_FC0_VERSION_0
 | 
WIFI_FC0_TYPE_MGT
 | 
WIFI_FC0_SUBTYPE_AUTH
;

160 
w
->
i_fc
[1] = 
WIFI_FC1_DIR_NODS
;

162 
	`memıy
(
w
->
i_addr1
, 
d¡
.
	`d©a
(), 6);

163 
	`memıy
(
w
->
i_addr2
, 
_wšfo
->
_bssid
.
	`d©a
(), 6);

164 
	`memıy
(
w
->
i_addr3
, 
_wšfo
->
_bssid
.
	`d©a
(), 6);

167 
w
->
i_dur
 = 0;

168 
w
->
i_£q
 = 0;

170 
ušt8_t
 *
±r
;

172 
±r
 = (
ušt8_t
 *è
p
->
	`d©a
(è+ (
şick_wifi
);

174 *(
ušt16_t
 *)
±r
 = 
	`ıu_to_Ë16
(
WIFI_AUTH_ALG_OPEN
);

175 
±r
 += 2;

177 *(
ušt16_t
 *)
±r
 = 
	`ıu_to_Ë16
(
£q
);

178 
±r
 += 2;

180 *(
ušt16_t
 *)
±r
 = 
	`ıu_to_Ë16
(
¡©us
);

181 
±r
 += 2;

183 
	`ouut
(0).
	`push
(
p
);

184 
	}
}

187 ’um {
	mH_DEBUG
};

189 
SŒšg


190 
	$O³nAuthRe¥Úd”_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

192 
O³nAuthRe¥Úd”
 *
td
 = (O³nAuthRe¥Úd” *)
e
;

193 (
ušŒ_t
è
thunk
) {

194 
H_DEBUG
:

195  
	`SŒšg
(
td
->
_debug
) + "\n";

197  
	`SŒšg
();

199 
	}
}

201 
	$O³nAuthRe¥Úd”_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

202 
E¼ÜHªdËr
 *
”rh
)

204 
O³nAuthRe¥Úd”
 *
f
 = (O³nAuthRe¥Úd” *)
e
;

205 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

206 (
šŒ_t
)
v·¿m
) {

207 
H_DEBUG
: {

208 
boŞ
 
debug
;

209 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

210  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

211 
f
->
_debug
 = 
debug
;

216 
	}
}

219 
	gO³nAuthRe¥Úd”
::
	$add_hªdËrs
()

221 
	`add_»ad_hªdËr
("debug", 
O³nAuthRe¥Úd”_»ad_·¿m
, 
H_DEBUG
);

223 
	`add_wr™e_hªdËr
("debug", 
O³nAuthRe¥Úd”_wr™e_·¿m
, 
H_DEBUG
);

224 
	}
}

226 
CLICK_ENDDECLS


227 
EXPORT_ELEMENT
(
O³nAuthRe¥Úd”
)

	@wifi/ap/openauthresponder.hh

1 #iâdeà
CLICK_OPENAUTHRESPONDER_HH


2 
	#CLICK_OPENAUTHRESPONDER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
	~<şick/‘h”add»ss.hh
>

6 
CLICK_DECLS


41 şas 
	cO³nAuthRe¥Úd”
 : 
public
 
EËm’t
 {…ublic:

43 
	$O³nAuthRe¥Úd”
(è
CLICK_COLD
;

44 ~
	$O³nAuthRe¥Úd”
(è
CLICK_COLD
;

46 cÚ¡ *
	$şass_Çme
() const {  "OpenAuthResponder"; }

47 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

48 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

50 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

51 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

52 
	$add_hªdËrs
(è
CLICK_COLD
;

54 
	`£nd_auth_»¥Ú£
(
Eth”Add»ss
, 
ušt16_t
, uint16_t);

55 
	`push
(, 
Pack‘
 *);

58 
boŞ
 
_debug
;

60 
şass
 
Wœ–essInfo
 *
_wšfo
;

61 
´iv©e
:

64 
	}
};

66 
	gCLICK_ENDDECLS


	@wifi/ap/proberesponder.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şickÃt/wifi.h
>

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/Îc.h
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/veùÜ.hh
>

27 
	~<şick/hashm­.hh
>

28 
	~<şick/·ck‘_ªno.hh
>

29 
	~<şick/”rÜ.hh
>

30 
	~"´ob”e¥Úd”.hh
"

31 
	~<–em’ts/wifi/avaabË¿‹s.hh
>

32 
CLICK_DECLS


34 
	gProbeRe¥Úd”
::
	$ProbeRe¥Úd”
()

35 : 
	$_¹abË
(0)

37 
	}
}

39 
ProbeRe¥Úd”
::~
	$ProbeRe¥Úd”
()

41 
	}
}

44 
ProbeRe¥Úd”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

47 
	g_debug
 = 
çl£
;

48 
	g_chªÃl
 = 0;

49 
	g_ssid
 = 
SŒšg
();

50 
	g_š‹rv®_ms
 = 0;

51 ià(
Args
(
cÚf
, 
this
, 
”rh
)

52 .
»ad
("DEBUG", 
_debug
)

53 .
»ad
("CHANNEL", 
_chªÃl
)

54 .
»ad
("SSID", 
_ssid
)

55 .
»ad
("BSSID", 
_bssid
)

56 .
»ad
("INTERVAL", 
_š‹rv®_ms
)

57 .
»ad_m
("RT", 
EËm’tCa¡Arg
("AvaabËR©es"), 
_¹abË
)

58 .
com¶‘e
() < 0)

61 ià(
	g_š‹rv®_ms
 <= 0) {

62  
”rh
->
”rÜ
("INTERVAL must be >0\n");

69 
	gProbeRe¥Úd”
::
	$push
(, 
Pack‘
 *
p
)

72 
ušt8_t
 
dœ
;

73 
ušt8_t
 
ty³
;

74 
ušt8_t
 
subty³
;

76 ià(
p
->
	`Ëngth
(è< (
şick_wifi
)) {

77 
	`şick_ch©‹r
("%p{element}:…acketoo small: %d vs %d\n",

78 
this
,

79 
p
->
	`Ëngth
(),

80 (
şick_wifi
));

82 
p
->
	`kl
();

86 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

89 
dœ
 = 
w
->
i_fc
[1] & 
WIFI_FC1_DIR_MASK
;

90 
ty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_TYPE_MASK
;

91 
subty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_SUBTYPE_MASK
;

93 ià(
ty³
 !ğ
WIFI_FC0_TYPE_MGT
) {

94 
	`şick_ch©‹r
("%p{element}:„eceived‚on-management…acket\n",

95 
this
);

96 
p
->
	`kl
();

100 ià(
subty³
 !ğ
WIFI_FC0_SUBTYPE_PROBE_REQ
) {

101 
	`şick_ch©‹r
("%p{element}:„eceived‚on-probe-req…acket\n",

102 
this
);

103 
p
->
	`kl
();

107 
ušt8_t
 *
±r
;

109 
±r
 = (
ušt8_t
 *è
p
->
	`d©a
(è+ (
şick_wifi
);

111 
ušt8_t
 *
’d
 = (ušt8_ˆ*è
p
->
	`d©a
(è+…->
	`Ëngth
();

113 
ušt8_t
 *
ssid_l
 = 
NULL
;

114 
ušt8_t
 *
¿‹s_l
 = 
NULL
;

116 
±r
 < 
’d
) {

117 *
±r
) {

118 
WIFI_ELEMID_SSID
:

119 
ssid_l
 = 
±r
;

121 
WIFI_ELEMID_RATES
:

122 
¿‹s_l
 = 
±r
;

125 ià(
_debug
) {

126 
	`şick_ch©‹r
("%p{element}: ignoredƒlement id %u %u \n",

127 
this
,

128 *
±r
,

129 
±r
[1]);

132 
±r
 +=…tr[1] + 2;

136 
SŒšgAccum
 
§
;

137 
SŒšg
 
ssid
 = "";

138 ià(
ssid_l
 && ssid_l[1]) {

139 
ssid
 = 
	`SŒšg
((*è
ssid_l
 + 2, 
	`WIFI_MIN
(()ssid_l[1], 
WIFI_NWID_MAXSIZE
));

144 ià(
ssid
 !ğ"" && ssid !ğ
_ssid
) {

145 ià(
_debug
) {

146 
	`şick_ch©‹r
("%p{element}: other ssid %s wanted %s\n",

147 
this
,

148 
ssid
.
	`c_¡r
(),

149 
_ssid
.
	`c_¡r
());

151 
p
->
	`kl
();

155 
Eth”Add»ss
 
¤c
 = 
	`Eth”Add»ss
(
w
->
i_addr2
);

157 
§
 << "ProbeReq: " << 
¤c
 << " ssid " << 
ssid
 << " ";

159 
§
 << "rates {";

160 ià(
¿‹s_l
) {

161 
x
 = 0; x < 
	`WIFI_MIN
(()
¿‹s_l
[1], 
WIFI_RATES_MAXSIZE
); x++) {

162 
ušt8_t
 
¿‹
 = 
¿‹s_l
[
x
 + 2];

164 ià(
¿‹
 & 
WIFI_RATE_BASIC
) {

165 
§
 << " * " << (è(
¿‹
 ^ 
WIFI_RATE_BASIC
);

167 
§
 << " " << (è
¿‹
;

171 
§
 << " }";

173 ià(
_debug
) {

174 
	`şick_ch©‹r
("%p{element}: %s\n",

175 
this
,

176 
§
.
	`ke_¡ršg
().
	`c_¡r
());

178 
	`£nd_´obe_»¥Ú£
(
¤c
);

180 
p
->
	`kl
();

182 
	}
}

184 
	gProbeRe¥Úd”
::
	$£nd_´obe_»¥Ú£
(
Eth”Add»ss
 
d¡
)

187 
VeùÜ
<> 
¿‹s
 = 
_¹abË
->
	`lookup
(
_bssid
);

188 
Ën
 =  (
şick_wifi
) +

192 2 + 
_ssid
.
	`Ëngth
() +

193 2 + 
	`WIFI_MIN
(
WIFI_RATES_MAXSIZE
, 
¿‹s
.
	`size
()) +

198 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
Ën
);

200 ià(
p
 == 0)

203 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

205 
w
->
i_fc
[0] = 
WIFI_FC0_VERSION_0
 | 
WIFI_FC0_TYPE_MGT
 | 
WIFI_FC0_SUBTYPE_PROBE_RESP
;

206 
w
->
i_fc
[1] = 
WIFI_FC1_DIR_NODS
;

208 
	`memıy
(
w
->
i_addr1
, 
d¡
.
	`d©a
(), 6);

209 
	`memıy
(
w
->
i_addr2
, 
_bssid
.
	`d©a
(), 6);

210 
	`memıy
(
w
->
i_addr3
, 
_bssid
.
	`d©a
(), 6);

213 
w
->
i_dur
 = 0;

214 
w
->
i_£q
 = 0;

216 
ušt8_t
 *
±r
;

218 
±r
 = (
ušt8_t
 *è
p
->
	`d©a
(è+ (
şick_wifi
);

221 
	`mem£t
(
±r
, 0, 8);

222 
±r
 += 8;

225 
ušt16_t
 
b—cÚ_št
 = (ušt16_tè
_š‹rv®_ms
;

226 *(
ušt16_t
 *)
±r
 = 
	`ıu_to_Ë16
(
b—cÚ_št
);

227 
±r
 += 2;

229 
ušt16_t
 
ÿp_šfo
 = 0;

230 
ÿp_šfo
 |ğ
WIFI_CAPINFO_ESS
;

231 *(
ušt16_t
 *)
±r
 = 
	`ıu_to_Ë16
(
ÿp_šfo
);

232 
±r
 += 2;

235 
±r
[0] = 
WIFI_ELEMID_SSID
;

236 
±r
[1] = 
_ssid
.
	`Ëngth
();

237 
	`memıy
(
±r
 + 2, 
_ssid
.
	`d©a
(), _ssid.
	`Ëngth
());

238 
±r
 +ğ2 + 
_ssid
.
	`Ëngth
();

241 
±r
[0] = 
WIFI_ELEMID_RATES
;

242 
±r
[1] = 
	`WIFI_MIN
(
WIFI_RATES_MAXSIZE
, 
¿‹s
.
	`size
());

243 
x
 = 0; x < 
	`WIFI_MIN
(
WIFI_RATES_MAXSIZE
, 
¿‹s
.
	`size
()); x++) {

244 
±r
[2 + 
x
] = (
ušt8_t
è
¿‹s
[x];

246 ià(
¿‹s
[
x
] == 2) {

247 
±r
 [2 + 
x
] |ğ
WIFI_RATE_BASIC
;

251 
±r
 +ğ2 + 
¿‹s
.
	`size
();

254 
±r
[0] = 
WIFI_ELEMID_DSPARMS
;

255 
±r
[1] = 1;

256 
±r
[2] = (
ušt8_t
è
_chªÃl
;

257 
±r
 += 2 + 1;

261 
±r
[0] = 
WIFI_ELEMID_TIM
;

262 
±r
[1] = 4;

264 
±r
[2] = 0;

265 
±r
[3] = 1;

266 
±r
[4] = 0;

267 
±r
[5] = 0;

268 
±r
 += 2 + 4;

270 
	`ouut
(0).
	`push
(
p
);

271 
	}
}

274 ’um {
	mH_DEBUG
, 
	mH_BSSID
, 
	mH_SSID
, 
	mH_CHANNEL
, 
	mH_INTERVAL
};

276 
SŒšg


277 
	$ProbeRe¥Úd”_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

279 
ProbeRe¥Úd”
 *
td
 = (ProbeRe¥Úd” *)
e
;

280 (
ušŒ_t
è
thunk
) {

281 
H_DEBUG
:

282  
	`SŒšg
(
td
->
_debug
) + "\n";

283 
H_BSSID
:

284  
td
->
_bssid
.
	`uÅ¬£
() + "\n";

285 
H_SSID
:

286  
td
->
_ssid
 + "\n";

287 
H_CHANNEL
:

288  
	`SŒšg
(
td
->
_chªÃl
) + "\n";

289 
H_INTERVAL
:

290  
	`SŒšg
(
td
->
_š‹rv®_ms
) + "\n";

292  
	`SŒšg
();

294 
	}
}

296 
	$ProbeRe¥Úd”_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

297 
E¼ÜHªdËr
 *
”rh
)

299 
ProbeRe¥Úd”
 *
f
 = (ProbeRe¥Úd” *)
e
;

300 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

301 (
šŒ_t
)
v·¿m
) {

302 
H_DEBUG
: {

303 
boŞ
 
debug
;

304 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

305  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

306 
f
->
_debug
 = 
debug
;

309 
H_BSSID
: {

310 
Eth”Add»ss
 
e
;

311 ià(!
	`ı_‘h”Ãt_add»ss
(
s
, &
e
))

312  
”rh
->
	`”rÜ
("bssid…arameter must beƒthernet‡ddress");

313 
f
->
_bssid
 = 
e
;

316 
H_SSID
: {

317 
f
->
_ssid
 = 
s
;

320 
H_CHANNEL
: {

321 
chªÃl
;

322 ià(!
	`IÁArg
().
	`·r£
(
s
, 
chªÃl
))

323  
”rh
->
	`”rÜ
("channel…arameter must be int");

324 
f
->
_chªÃl
 = 
chªÃl
;

327 
H_INTERVAL
: {

328 
m
;

329 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

330  
”rh
->
	`”rÜ
("interval…arameter must be int");

331 
f
->
_š‹rv®_ms
 = 
m
;

336 
	}
}

339 
	gProbeRe¥Úd”
::
	$add_hªdËrs
()

341 
	`add_»ad_hªdËr
("debug", 
ProbeRe¥Úd”_»ad_·¿m
, 
H_DEBUG
);

342 
	`add_»ad_hªdËr
("bssid", 
ProbeRe¥Úd”_»ad_·¿m
, 
H_BSSID
);

343 
	`add_»ad_hªdËr
("ssid", 
ProbeRe¥Úd”_»ad_·¿m
, 
H_SSID
);

344 
	`add_»ad_hªdËr
("chªÃl", 
ProbeRe¥Úd”_»ad_·¿m
, 
H_CHANNEL
);

345 
	`add_»ad_hªdËr
("š‹rv®", 
ProbeRe¥Úd”_»ad_·¿m
, 
H_INTERVAL
);

347 
	`add_wr™e_hªdËr
("debug", 
ProbeRe¥Úd”_wr™e_·¿m
, 
H_DEBUG
);

348 
	`add_wr™e_hªdËr
("bssid", 
ProbeRe¥Úd”_wr™e_·¿m
, 
H_BSSID
);

349 
	`add_wr™e_hªdËr
("ssid", 
ProbeRe¥Úd”_wr™e_·¿m
, 
H_SSID
);

350 
	`add_wr™e_hªdËr
("chªÃl", 
ProbeRe¥Úd”_wr™e_·¿m
, 
H_CHANNEL
);

351 
	`add_wr™e_hªdËr
("š‹rv®", 
ProbeRe¥Úd”_wr™e_·¿m
, 
H_INTERVAL
);

352 
	}
}

354 
CLICK_ENDDECLS


355 
EXPORT_ELEMENT
(
ProbeRe¥Úd”
)

	@wifi/ap/proberesponder.hh

1 #iâdeà
CLICK_PROBERESPONDER_HH


2 
	#CLICK_PROBERESPONDER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


39 şas 
	cProbeRe¥Úd”
 : 
public
 
EËm’t
 {…ublic:

41 
	$ProbeRe¥Úd”
(è
CLICK_COLD
;

42 ~
	$ProbeRe¥Úd”
(è
CLICK_COLD
;

44 cÚ¡ *
	$şass_Çme
() const {  "ProbeResponder"; }

45 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

46 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

48 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

49 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

50 
	$add_hªdËrs
(è
CLICK_COLD
;

52 
	`£nd_´obe_»¥Ú£
(
Eth”Add»ss
);

53 
	`push
(, 
Pack‘
 *);

56 
boŞ
 
_debug
;

57 
_chªÃl
;

58 
Eth”Add»ss
 
_bssid
;

59 
SŒšg
 
_ssid
;

60 
şass
 
AvaabËR©es
 *
_¹abË
;

61 
_š‹rv®_ms
;

64 
SŒšg
 
	`sÿn_¡ršg
();

65 
´iv©e
:

68 
	}
};

70 
	gCLICK_ENDDECLS


	@wifi/ap/stationtable.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şickÃt/‘h”.h
>

24 
	~"¡©iÚbË.hh
"

25 
CLICK_DECLS


27 
	gStiÚTabË
::
	$StiÚTabË
()

30 
	}
}

32 
StiÚTabË
::~
	$StiÚTabË
()

34 
	}
}

37 
StiÚTabË
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *)

39 
StiÚTabË
 *
q
 = (StiÚTabË *)
e
->
	`ÿ¡
("StationTable");

40 ià(!
q
) ;

42 
_bË
 = 
q
->_table;

43 
	}
}

46 ’um {
	mH_DEBUG
};

48 
SŒšg


49 
	$StiÚTabË_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

51 
StiÚTabË
 *
td
 = (StiÚTabË *)
e
;

52 (
ušŒ_t
è
thunk
) {

53 
H_DEBUG
:

54  
	`SŒšg
(
td
->
_debug
) + "\n";

56  
	`SŒšg
();

58 
	}
}

60 
	$StiÚTabË_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

61 
E¼ÜHªdËr
 *
”rh
)

63 
StiÚTabË
 *
f
 = (StiÚTabË *)
e
;

64 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

65 (
šŒ_t
)
v·¿m
) {

66 
H_DEBUG
: {

67 
boŞ
 
debug
;

68 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

69  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

70 
f
->
_debug
 = 
debug
;

76 
	}
}

78 
	gStiÚTabË
::
	$add_hªdËrs
()

80 
	`add_»ad_hªdËr
("debug", 
StiÚTabË_»ad_·¿m
, 
H_DEBUG
);

82 
	`add_wr™e_hªdËr
("debug", 
StiÚTabË_wr™e_·¿m
, 
H_DEBUG
);

84 
	}
}

86 
CLICK_ENDDECLS


87 
EXPORT_ELEMENT
(
StiÚTabË
)

	@wifi/ap/stationtable.hh

1 #iâdeà
CLICK_STATIONTABLE_HH


2 
	#CLICK_STATIONTABLE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/add»ss.hh
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<şick/bighashm­.hh
>

7 
	~<şick/glue.hh
>

8 
CLICK_DECLS


10 şas 
	cStiÚ
 {

11 
	mpublic
:

12 
Eth”Add»ss
 
_‘h
;

13 
Time¡amp
 
	m_wh’
;

14 
	$StiÚ
() {

15 
	`mem£t
(
this
, 0, (*this));

17 
	}
};

21 şas 
	cStiÚTabË
 : 
public
 
EËm’t
 {…ublic:

23 
	$StiÚTabË
(è
CLICK_COLD
;

24 ~
	$StiÚTabË
(è
CLICK_COLD
;

26 cÚ¡ *
	$şass_Çme
() const {  "StationTable"; }

27 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_0
; 
	}
}

29 
	$add_hªdËrs
(è
CLICK_COLD
;

30 
	`ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *);

33 
boŞ
 
_debug
;

35 
´iv©e
:

37 
HashM­
<
	tEth”Add»ss
, 
	tStiÚ
> 
	tSTabË
;

38 
STabË
::
	tcÚ¡_™”©Ü
 
	tSTI‹r
;

40 
STabË
 
_bË
;

42 
	}
};

44 
	gCLICK_ENDDECLS


	@wifi/athdesc.h

1 #iâdeà
_ATHDESC_H_


2 
	#_ATHDESC_H_


	)

4 
	#ATHDESC_HEADER_SIZE
 32

	)

5 
	s¬5212_rx_¡©us
 {

6 
u_št32_t
 
	md©a_Ën
:12;

7 
u_št32_t
 
	mmÜe
:1;

8 
u_št32_t
 
	mdecom³¼
:2;

9 
u_št32_t
 
	mrx_¿‹
:5;

10 
u_št32_t
 
	mrx_rssi
:8;

11 
u_št32_t
 
	mrx_ªt
:4;

14 
u_št32_t
 
	mdÚe
:1;

15 
u_št32_t
 
	mrx_ok
:1;

16 
u_št32_t
 
	müû¼
:1;

17 
u_št32_t
 
	mdeüy±üc
:1;

19 } 
	gCLICK_SIZE_PACKED_ATTRIBUTE
;

21 
	s¬5212_desc
 {

25 
u_št32_t
 
	mäame_Ën
:12;

26 
u_št32_t
 
	m»£rved_12_15
:4;

27 
u_št32_t
 
	mxm™_pow”
:6;

28 
u_št32_t
 
	m¹s_ùs_’abË
:1;

29 
u_št32_t
 
	mveŞ
:1;

30 
u_št32_t
 
	mş—r_de¡_mask
:1;

31 
u_št32_t
 
	mªt_mode_xm™
:4;

32 
u_št32_t
 
	mš‹r_»q
:1;

33 
u_št32_t
 
	m’üy±_key_v®id
:1;

34 
u_št32_t
 
	mùs_’abË
:1;

39 
u_št32_t
 
	mbuf_Ën
:12;

40 
u_št32_t
 
	mmÜe
:1;

41 
u_št32_t
 
	m’üy±_key_šdex
:7;

42 
u_št32_t
 
	mäame_ty³
:4;

43 
u_št32_t
 
	mno_ack
:1;

44 
u_št32_t
 
	mcomp_´oc
:2;

45 
u_št32_t
 
	mcomp_iv_Ën
:2;

46 
u_št32_t
 
	mcomp_icv_Ën
:2;

47 
u_št32_t
 
	m»£rved_31
:1;

52 
u_št32_t
 
	m¹s_du¿tiÚ
:15;

53 
u_št32_t
 
	mdu¿tiÚ_upd©e_’abË
:1;

54 
u_št32_t
 
	mxm™_Œ›s0
:4;

55 
u_št32_t
 
	mxm™_Œ›s1
:4;

56 
u_št32_t
 
	mxm™_Œ›s2
:4;

57 
u_št32_t
 
	mxm™_Œ›s3
:4;

62 
u_št32_t
 
	mxm™_¿‹0
:5;

63 
u_št32_t
 
	mxm™_¿‹1
:5;

64 
u_št32_t
 
	mxm™_¿‹2
:5;

65 
u_št32_t
 
	mxm™_¿‹3
:5;

66 
u_št32_t
 
	m¹s_ùs_¿‹
:5;

67 
u_št32_t
 
	m»£rved_25_31
:7;

72 
u_št32_t
 
	mäame_xm™_ok
:1;

73 
u_št32_t
 
	mexûssive_»Œ›s
:1;

74 
u_št32_t
 
	mfifo_und”run
:1;

75 
u_št32_t
 
	mf‹»d
:1;

76 
u_št32_t
 
	m¹s_ç_couÁ
:4;

77 
u_št32_t
 
	md©a_ç_couÁ
:4;

78 
u_št32_t
 
	mvœt_cŞl_couÁ
:4;

79 
u_št32_t
 
	m£nd_time¡amp
:16;

84 
u_št32_t
 
	mdÚe
:1;

85 
u_št32_t
 
	m£q_num
:12;

86 
u_št32_t
 
	mack_sig_¡»ngth
:8;

87 
u_št32_t
 
	mfš®_ts_šdex
:2;

88 
u_št32_t
 
	mcomp_sucûss
:1;

89 
u_št32_t
 
	mxm™_ª‹Âa
:1;

90 
u_št32_t
 
	m»£rved_25_31_x
:7;

91 } 
	gCLICK_SIZE_PACKED_ATTRIBUTE
;

99 
šlše
 

100 
	$¿‹code_to_dÙ11
(
¿‹code
) {

101 
¿‹code
) {

121 
	}
}

123 
šlše
 

124 
	$dÙ11_to_¿‹code
(
dÙ11
) {

125 
dÙ11
) {

141 
	}
}

	@wifi/athdescdecap.cc

18 
	~<şick/cÚfig.h
>

19 
	~"©hdescdeÿp.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/wifi.h
>

25 
	~<şick/·ck‘_ªno.hh
>

26 
	~<şickÃt/Îc.h
>

27 
	~"©hdesc.h
"

28 
CLICK_DECLS


30 
	gAthdescDeÿp
::
	$AthdescDeÿp
()

32 
	`¡©ic_as£¹
(
WIFI_EXTRA_ANNO_SIZE
 >ğ(
şick_wifi_exŒa
), "WIFI_EXTRA_ANNO_SIZE is‚ot bigƒnough.");

33 
	}
}

35 
	gAthdescDeÿp
::~
	$AthdescDeÿp
()

37 
	}
}

40 
AthdescDeÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

42 
	g_debug
 = 
çl£
;

43  
Args
(
cÚf
, 
this
, 
”rh
).
»ad
("DEBUG", 
_debug
).
com¶‘e
();

46 
Pack‘
 *

47 
	gAthdescDeÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

49 
Wr™abËPack‘
 *
q
 = 
p
->
	`uniqueify
();

50 ià(
q
) {

51 
¬5212_desc
 *
desc
 = (¬5212_desø*è(
q
->
	`d©a
() + 8);

52 
şick_wifi_exŒa
 *
eh
 = 
	`WIFI_EXTRA_ANNO
(
q
);

53 
	`mem£t
(
eh
, 0, (
şick_wifi_exŒa
));

54 
eh
->
magic
 = 
WIFI_EXTRA_MAGIC
;

55 ià(
desc
->
äame_Ën
 == 0) {

56 
¬5212_rx_¡©us
 *
rx_desc
 = (¬5212_rx_¡©u *è(
q
->
	`d©a
() + 16);

58 
eh
->
¿‹
 = 
	`¿‹code_to_dÙ11
(
rx_desc
->
rx_¿‹
);

59 
eh
->
rssi
 = 
rx_desc
->
rx_rssi
;

60 ià(!
rx_desc
->
rx_ok
) {

61 
eh
->
æags
 |ğ
WIFI_EXTRA_RX_ERR
;

64 
eh
->
æags
 |ğ
WIFI_EXTRA_TX
;

66 
eh
->
pow”
 = 
desc
->
xm™_pow”
;

67 
eh
->
rssi
 = 
desc
->
ack_sig_¡»ngth
;

68 
eh
->
¿‹
 = 
	`¿‹code_to_dÙ11
(
desc
->
xm™_¿‹0
);

69 
eh
->
»Œ›s
 = 
desc
->
d©a_ç_couÁ
;

70 ià(
desc
->
exûssive_»Œ›s
)

71 
eh
->
æags
 |ğ
WIFI_EXTRA_TX_FAIL
;

73 
q
->
	`puÎ
(
ATHDESC_HEADER_SIZE
);

76  
q
;

77 
	}
}

80 ’um {
	mH_DEBUG
};

82 
SŒšg


83 
	$AthdescDeÿp_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

85 
AthdescDeÿp
 *
td
 = (AthdescDeÿ°*)
e
;

86 (
ušŒ_t
è
thunk
) {

87 
H_DEBUG
:

88  
	`SŒšg
(
td
->
_debug
) + "\n";

90  
	`SŒšg
();

92 
	}
}

94 
	$AthdescDeÿp_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

95 
E¼ÜHªdËr
 *
”rh
)

97 
AthdescDeÿp
 *
f
 = (AthdescDeÿ°*)
e
;

98 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

99 (
šŒ_t
)
v·¿m
) {

100 
H_DEBUG
: {

101 
boŞ
 
debug
;

102 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

103  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

104 
f
->
_debug
 = 
debug
;

109 
	}
}

112 
	gAthdescDeÿp
::
	$add_hªdËrs
()

114 
	`add_»ad_hªdËr
("debug", 
AthdescDeÿp_»ad_·¿m
, 
H_DEBUG
);

115 
	`add_wr™e_hªdËr
("debug", 
AthdescDeÿp_wr™e_·¿m
, 
H_DEBUG
);

116 
	}
}

117 
CLICK_ENDDECLS


118 
EXPORT_ELEMENT
(
AthdescDeÿp
)

	@wifi/athdescdecap.hh

1 #iâdeà
CLICK_ATHDESCDECAP_HH


2 
	#CLICK_ATHDESCDECAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


22 şas 
	cAthdescDeÿp
 : 
public
 
EËm’t
 {…ublic:

24 
	$AthdescDeÿp
(è
CLICK_COLD
;

25 ~
	$AthdescDeÿp
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "AthdescDecap"; }

28 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

30 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

31 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

33 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

36 
	$add_hªdËrs
(è
CLICK_COLD
;

39 
boŞ
 
_debug
;

40 
´iv©e
:

42 
	}
};

44 
	gCLICK_ENDDECLS


	@wifi/athdescencap.cc

18 
	~<şick/cÚfig.h
>

19 
	~"©hdesûnÿp.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/wifi.h
>

25 
	~<şick/·ck‘_ªno.hh
>

26 
	~<şickÃt/Îc.h
>

27 
	~"©hdesc.h
"

28 
CLICK_DECLS


31 
	gAthdescEnÿp
::
	$AthdescEnÿp
()

33 
	}
}

35 
AthdescEnÿp
::~
	$AthdescEnÿp
()

37 
	}
}

40 
AthdescEnÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

42 
	g_debug
 = 
çl£
;

43  
Args
(
cÚf
, 
this
, 
”rh
).
»ad
("DEBUG", 
_debug
).
com¶‘e
();

46 
Pack‘
 *

47 
	gAthdescEnÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

50 
Wr™abËPack‘
 *
p_out
 = 
p
->
	`push
(
ATHDESC_HEADER_SIZE
);

51 ià(!
p_out
) {  0; }

53 
¬5212_desc
 *
desc
 = (¬5212_desø*è(
p_out
->
	`d©a
() + 8);

54 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p_out
);

56 
	`mem£t
((*)
p_out
->
	`d©a
(), 0, 
ATHDESC_HEADER_SIZE
);

58 
desc
->
xm™_pow”
 = 
ûh
->
pow”
;

59 
desc
->
xm™_¿‹0
 = 
	`dÙ11_to_¿‹code
(
ûh
->
¿‹
);

61 ià(
ûh
->
¿‹1
 > 0) {

62 
desc
->
xm™_¿‹1
 = 
	`dÙ11_to_¿‹code
(
ûh
->
¿‹1
);

64 ià(
ûh
->
¿‹2
 > 0) {

65 
desc
->
xm™_¿‹2
 = 
	`dÙ11_to_¿‹code
(
ûh
->
¿‹2
);

67 ià(
ûh
->
¿‹3
 > 0) {

68 
desc
->
xm™_¿‹3
 = 
	`dÙ11_to_¿‹code
(
ûh
->
¿‹3
);

71 ià(
ûh
->
max_Œ›s
 > 0) {

72 
desc
->
xm™_Œ›s0
 = 
ûh
->
max_Œ›s
;

74 ià(
ûh
->
max_Œ›s1
 > 0) {

75 
desc
->
xm™_Œ›s1
 = 
ûh
->
max_Œ›s1
;

77 ià(
ûh
->
max_Œ›s2
 > 0) {

78 
desc
->
xm™_Œ›s2
 = 
ûh
->
max_Œ›s2
;

80 ià(
ûh
->
max_Œ›s3
 > 0) {

81 
desc
->
xm™_Œ›s3
 = 
ûh
->
max_Œ›s3
;

84  
p_out
;

85 
	}
}

88 ’um {
	mH_DEBUG
};

90 
SŒšg


91 
	$AthdescEnÿp_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

93 
AthdescEnÿp
 *
td
 = (AthdescEnÿ°*)
e
;

94 (
ušŒ_t
è
thunk
) {

95 
H_DEBUG
:

96  
	`SŒšg
(
td
->
_debug
) + "\n";

98  
	`SŒšg
();

100 
	}
}

102 
	$AthdescEnÿp_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

103 
E¼ÜHªdËr
 *
”rh
)

105 
AthdescEnÿp
 *
f
 = (AthdescEnÿ°*)
e
;

106 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

107 (
šŒ_t
)
v·¿m
) {

108 
H_DEBUG
: {

109 
boŞ
 
debug
;

110 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

111  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

112 
f
->
_debug
 = 
debug
;

117 
	}
}

120 
	gAthdescEnÿp
::
	$add_hªdËrs
()

122 
	`add_»ad_hªdËr
("debug", 
AthdescEnÿp_»ad_·¿m
, 
H_DEBUG
);

123 
	`add_wr™e_hªdËr
("debug", 
AthdescEnÿp_wr™e_·¿m
, 
H_DEBUG
);

124 
	}
}

125 
CLICK_ENDDECLS


126 
EXPORT_ELEMENT
(
AthdescEnÿp
)

	@wifi/athdescencap.hh

1 #iâdeà
CLICK_ATHDESCENCAP_HH


2 
	#CLICK_ATHDESCENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


23 şas 
	cAthdescEnÿp
 : 
public
 
EËm’t
 {…ublic:

25 
	$AthdescEnÿp
(è
CLICK_COLD
;

26 ~
	$AthdescEnÿp
(è
CLICK_COLD
;

28 cÚ¡ *
	$şass_Çme
() const {  "AthdescEncap"; }

29 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

31 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

32 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

34 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

37 
	$add_hªdËrs
(è
CLICK_COLD
;

40 
boŞ
 
_debug
;

41 
´iv©e
:

43 
	}
};

45 
	gCLICK_ENDDECLS


	@wifi/autoratefallback.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şickÃt/‘h”.h
>

25 
	~<şickÃt/wifi.h
>

26 
	~<–em’ts/wifi/avaabË¿‹s.hh
>

27 
	~"autÜ©eçÎback.hh
"

29 
CLICK_DECLS


31 
	gAutoR©eF®lback
::
	$AutoR©eF®lback
()

32 : 
	`_¡•up
(10),

33 
	`_¡•down
(1),

34 
	`_off£t
(0),

35 
	$_·ck‘_size_th»shŞd
(0)

39 
bÿ¡_addr
[] = { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff };

40 
_bÿ¡
 = 
	`Eth”Add»ss
(
bÿ¡_addr
);

41 
	}
}

43 
	gAutoR©eF®lback
::~
	$AutoR©eF®lback
()

45 
	}
}

48 
AutoR©eF®lback
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

50 
	g_aùive
 = 
Œue
;

51 
	g_ad­tive_¡•up
 = 
Œue
;

52 
	g»t
 = 
Args
(
cÚf
, 
this
, 
”rh
)

53 .
»ad
("OFFSET", 
_off£t
)

54 .
»ad
("ADAPTIVE_STEPUP", 
_ad­tive_¡•up
)

55 .
»ad
("STEPUP", 
_¡•up
)

56 .
»ad
("STEPDOWN", 
_¡•down
)

57 .
»ad
("RT", 
EËm’tCa¡Arg
("AvaabËR©es"), 
_¹abË
)

58 .
»ad
("THRESHOLD", 
_·ck‘_size_th»shŞd
)

59 .
»ad
("ACTIVE", 
_aùive
)

60 .
com¶‘e
();

61  
	g»t
;

65 
	gAutoR©eF®lback
::
	$´oûss_ãedback
(
Pack‘
 *
p_š
)

67 ià(!
p_š
) {

70 
ušt8_t
 *
d¡_±r
 = (ušt8_ˆ*è
p_š
->
	`d©a
(è+ 
_off£t
;

71 
Eth”Add»ss
 
d¡
 = 
	`Eth”Add»ss
(
d¡_±r
);

72 
şick_wifi_exŒa
 *
eh
 = 
	`WIFI_EXTRA_ANNO
(
p_š
);

73 
boŞ
 
sucûss
 = !(
eh
->
æags
 & 
WIFI_EXTRA_TX_FAIL
);

74 
boŞ
 
u£d_®t_¿‹
 = (
eh
->
æags
 & 
WIFI_EXTRA_TX_USED_ALT_RATE
);

75 
¿‹
 = 
eh
->rate;

77 ià(
d¡
.
	`is_group
()) {

82 ià(0 =ğ
¿‹
) {

86 ià(
sucûss
 && 
p_š
->
	`Ëngth
(è< 
_·ck‘_size_th»shŞd
) {

94 
D¡Info
 *
nfo
 = 
_ÃighbÜs
.
	`fšdp
(
d¡
);

95 ià(!
nfo
) {

100 ià(
nfo
->
_¿‹s
[nfo->
_cu¼’t_šdex
] !ğ
¿‹
) {

105 ià(
u£d_®t_¿‹
 || !
sucûss
) {

107 
down
 = 
eh
->
»Œ›s
 / 2;

108 ià(
down
 > 0) {

109 
down
--;

111 
Ãxt_šdex
 = 
	`WIFI_MAX
(0, 
nfo
->
_cu¼’t_šdex
 - 
down
);

112 ià(
_debug
) {

113 
	`şick_ch©‹r
("%p{element} stepping down for %s from %do %d\n",

114 
this
,

115 
nfo
->
_‘h
.
	`uÅ¬£
().
	`c_¡r
(),

116 
nfo
->
_¿‹s
[nfo->
_cu¼’t_šdex
],

117 
nfo
->
_¿‹s
[
Ãxt_šdex
]);

120 ià(
nfo
->
_w’tup
 && 
_ad­tive_¡•up
) {

122 
nfo
->
_¡•up
 *= 2;

123 
nfo
->
_w’tup
 = 
çl£
;

125 
nfo
->
_¡•up
 = _stepup;

128 
nfo
->
_sucûs£s
 = 0;

129 
nfo
->
_cu¼’t_šdex
 = 
Ãxt_šdex
;

134 ià(
nfo
->
_w’tup
) {

136 
nfo
->
_¡•up
 = _stepup;

138 
nfo
->
_w’tup
 = 
çl£
;

140 ià(
eh
->
»Œ›s
 == 0) {

141 
nfo
->
_sucûs£s
++;

143 
nfo
->
_sucûs£s
 = 0;

146 ià(
nfo
->
_sucûs£s
 >‚fo->
_¡•up
 &&

148 
nfo
->
_cu¼’t_šdex
 !ğnfo->
_¿‹s
.
	`size
() - 1) {

149 ià(
_debug
) {

150 
	`şick_ch©‹r
("%p{element} steping up for %s from %do %d\n",

151 
this
,

152 
nfo
->
_‘h
.
	`uÅ¬£
().
	`c_¡r
(),

153 
nfo
->
_¿‹s
[nfo->
_cu¼’t_šdex
],

154 
nfo
->
_¿‹s
[
	`WIFI_MIN
Òfo->_¿‹s.
	`size
() - 1,

155 
nfo
->
_cu¼’t_šdex
 + 1)]);

157 
nfo
->
_cu¼’t_šdex
 = 
	`WIFI_MIN
Òfo->_cu¼’t_šdex + 1,‚fo->
_¿‹s
.
	`size
() - 1);

158 
nfo
->
_sucûs£s
 = 0;

159 
nfo
->
_w’tup
 = 
Œue
;

162 
	}
}

166 
	gAutoR©eF®lback
::
	$assign_¿‹
(
Pack‘
 *
p_š
)

168 ià(!
p_š
) {

169 
	`şick_ch©‹r
("%p{element}‡h, !p_in\n",

170 
this
);

174 
ušt8_t
 *
d¡_±r
 = (ušt8_ˆ*è
p_š
->
	`d©a
(è+ 
_off£t
;

175 
Eth”Add»ss
 
d¡
 = 
	`Eth”Add»ss
(
d¡_±r
);

177 
şick_wifi_exŒa
 *
eh
 = 
	`WIFI_EXTRA_ANNO
(
p_š
);

178 
eh
->
magic
 = 
WIFI_EXTRA_MAGIC
;

180 ià(
d¡
.
	`is_group
()) {

181 
VeùÜ
<> 
¿‹s
 = 
_¹abË
->
	`lookup
(
_bÿ¡
);

182 ià(
¿‹s
.
	`size
()) {

183 
eh
->
¿‹
 = 
¿‹s
[0];

185 
eh
->
¿‹
 = 2;

189 
D¡Info
 *
nfo
 = 
_ÃighbÜs
.
	`fšdp
(
d¡
);

190 ià(!
nfo
 || !nfo->
_¿‹s
.
	`size
()) {

191 
_ÃighbÜs
.
	`š£¹
(
d¡
, 
	`D¡Info
(dst));

192 
nfo
 = 
_ÃighbÜs
.
	`fšdp
(
d¡
);

193 
nfo
->
_¿‹s
 = 
_¹abË
->
	`lookup
(
d¡
);

194 
nfo
->
_sucûs£s
 = 0;

195 
nfo
->
_w’tup
 = 
çl£
;

196 
nfo
->
_¡•up
 = _stepup;

198 
nfo
->
_cu¼’t_šdex
 =‚fo->
_¿‹s
.
	`size
() - 1;

199 ià(
_debug
) {

200 
	`şick_ch©‹r
("%p{element} initial„ate for %s is %d\n",

201 
this
,

202 
nfo
->
_‘h
.
	`uÅ¬£
().
	`c_¡r
(),

203 
nfo
->
_¿‹s
[nfo->
_cu¼’t_šdex
]);

209 
ndx
 = 
nfo
->
_cu¼’t_šdex
;

210 
eh
->
¿‹
 = 
nfo
->
_¿‹s
[
ndx
];

211 
eh
->
¿‹1
 = (
ndx
 - 1 >ğ0è? 
nfo
->
_¿‹s
[
	`WIFI_MAX
(ndx - 1, 0)] : 0;

212 
eh
->
¿‹2
 = (
ndx
 - 2 >ğ0è? 
nfo
->
_¿‹s
[
	`WIFI_MAX
(ndx - 2, 0)] : 0;

213 
eh
->
¿‹3
 = (
ndx
 - 3 >ğ0è? 
nfo
->
_¿‹s
[
	`WIFI_MAX
(ndx - 3, 0)] : 0;

215 
eh
->
max_Œ›s
 = 4;

216 
eh
->
max_Œ›s1
 = (
ndx
 - 1 >= 0) ? 2 : 0;

217 
eh
->
max_Œ›s2
 = (
ndx
 - 2 >= 0) ? 2 : 0;

218 
eh
->
max_Œ›s3
 = (
ndx
 - 3 >= 0) ? 2 : 0;

221 
	}
}

224 
Pack‘
 *

225 
	gAutoR©eF®lback
::
	$puÎ
(
pÜt
)

227 
Pack‘
 *
p
 = 
	`šput
(
pÜt
).
	`puÎ
();

228 ià(
p
 && 
_aùive
) {

229 
	`assign_¿‹
(
p
);

231  
p
;

232 
	}
}

235 
	gAutoR©eF®lback
::
	$push
(
pÜt
, 
Pack‘
 *
p_š
)

237 ià(!
p_š
) {

240 ià(
_aùive
) {

241 ià(
pÜt
 != 0) {

242 
	`´oûss_ãedback
(
p_š
);

244 
	`assign_¿‹
(
p_š
);

247 
	`checked_ouut_push
(
pÜt
, 
p_š
);

248 
	}
}

251 
SŒšg


252 
	gAutoR©eF®lback
::
	$´št_¿‹s
()

254 
SŒšgAccum
 
§
;

255 
NI‹r
 
™”
 = 
_ÃighbÜs
.
	`begš
(); i‹r.
	`live
(); iter++) {

256 
D¡Info
 
nfo
 = 
™”
.
	`v®ue
();

257 
§
 << 
nfo
.
_‘h
 << " ";

258 
§
 << 
nfo
.
_¿‹s
[nfo.
_cu¼’t_šdex
] << " ";

259 
§
 << 
nfo
.
_sucûs£s
 << "\n";

261  
§
.
	`ke_¡ršg
();

262 
	}
}

265 ’um {
	mH_DEBUG
, 
	mH_STEPUP
, 
	mH_STEPDOWN
, 
	mH_THRESHOLD
, 
	mH_RATES
, 
	mH_RESET
,

266 
	mH_OFFSET
, 
	mH_ACTIVE
};

269 
SŒšg


270 
	$AutoR©eF®lback_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

272 
AutoR©eF®lback
 *
td
 = (AutoR©eF®lback *)
e
;

273 (
ušŒ_t
è
thunk
) {

274 
H_DEBUG
:

275  
	`SŒšg
(
td
->
_debug
) + "\n";

276 
H_STEPDOWN
:

277  
	`SŒšg
(
td
->
_¡•down
) + "\n";

278 
H_STEPUP
:

279  
	`SŒšg
(
td
->
_¡•up
) + "\n";

280 
H_THRESHOLD
:

281  
	`SŒšg
(
td
->
_·ck‘_size_th»shŞd
) + "\n";

282 
H_OFFSET
:

283  
	`SŒšg
(
td
->
_off£t
) + "\n";

284 
H_RATES
: {

285  
td
->
	`´št_¿‹s
();

287 
H_ACTIVE
:

288  
	`SŒšg
(
td
->
_aùive
) + "\n";

290  
	`SŒšg
();

292 
	}
}

294 
	$AutoR©eF®lback_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

295 
E¼ÜHªdËr
 *
”rh
)

297 
AutoR©eF®lback
 *
f
 = (AutoR©eF®lback *)
e
;

298 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

299 (
šŒ_t
)
v·¿m
) {

300 
H_DEBUG
: {

301 
boŞ
 
debug
;

302 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

303  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

304 
f
->
_debug
 = 
debug
;

307 
H_STEPUP
: {

308 
m
;

309 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

310  
”rh
->
	`”rÜ
("stepup…arameter must be unsigned");

311 
f
->
_¡•up
 = 
m
;

314 
H_STEPDOWN
: {

315 
m
;

316 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

317  
”rh
->
	`”rÜ
("stepdown…arameter must be unsigned");

318 
f
->
_¡•down
 = 
m
;

321 
H_THRESHOLD
: {

322 
m
;

323 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

324  
”rh
->
	`”rÜ
("threshold…arameter must be unsigned");

325 
f
->
_·ck‘_size_th»shŞd
 = 
m
;

328 
H_OFFSET
: {

329 
m
;

330 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

331  
”rh
->
	`”rÜ
("offset…arameter must be unsigned");

332 
f
->
_off£t
 = 
m
;

335 
H_RESET
:

336 
f
->
_ÃighbÜs
.
	`ş—r
();

338 
H_ACTIVE
: {

339 
boŞ
 
aùive
;

340 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
aùive
))

341  
”rh
->
	`”rÜ
("active must be boolean");

342 
f
->
_aùive
 = 
aùive
;

347 
	}
}

351 
	gAutoR©eF®lback
::
	$add_hªdËrs
()

353 
	`add_»ad_hªdËr
("debug", 
AutoR©eF®lback_»ad_·¿m
, 
H_DEBUG
);

354 
	`add_»ad_hªdËr
("¿‹s", 
AutoR©eF®lback_»ad_·¿m
, 
H_RATES
);

355 
	`add_»ad_hªdËr
("th»shŞd", 
AutoR©eF®lback_»ad_·¿m
, 
H_THRESHOLD
);

356 
	`add_»ad_hªdËr
("¡•up", 
AutoR©eF®lback_»ad_·¿m
, 
H_STEPUP
);

357 
	`add_»ad_hªdËr
("¡•down", 
AutoR©eF®lback_»ad_·¿m
, 
H_STEPDOWN
);

358 
	`add_»ad_hªdËr
("off£t", 
AutoR©eF®lback_»ad_·¿m
, 
H_OFFSET
);

359 
	`add_»ad_hªdËr
("aùive", 
AutoR©eF®lback_»ad_·¿m
, 
H_ACTIVE
);

361 
	`add_wr™e_hªdËr
("debug", 
AutoR©eF®lback_wr™e_·¿m
, 
H_DEBUG
);

362 
	`add_wr™e_hªdËr
("th»shŞd", 
AutoR©eF®lback_wr™e_·¿m
, 
H_THRESHOLD
);

363 
	`add_wr™e_hªdËr
("¡•up", 
AutoR©eF®lback_wr™e_·¿m
, 
H_STEPUP
);

364 
	`add_wr™e_hªdËr
("¡•down", 
AutoR©eF®lback_wr™e_·¿m
, 
H_STEPDOWN
);

365 
	`add_wr™e_hªdËr
("»£t", 
AutoR©eF®lback_wr™e_·¿m
, 
H_RESET
, 
HªdËr
::
BUTTON
);

366 
	`add_wr™e_hªdËr
("off£t", 
AutoR©eF®lback_wr™e_·¿m
, 
H_OFFSET
);

367 
	`add_wr™e_hªdËr
("aùive", 
AutoR©eF®lback_wr™e_·¿m
, 
H_ACTIVE
);

368 
	}
}

370 
CLICK_ENDDECLS


371 
EXPORT_ELEMENT
(
AutoR©eF®lback
)

	@wifi/autoratefallback.hh

1 #iâdeà
CLICK_AUTORATEFALLBACK_HH


2 
	#CLICK_AUTORATEFALLBACK_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/bighashm­.hh
>

6 
	~<şick/glue.hh
>

7 
CLICK_DECLS


28 şas 
	cAutoR©eF®lback
 : 
public
 
EËm’t
 {…ublic:

30 
	$AutoR©eF®lback
(è
CLICK_COLD
;

31 ~
	$AutoR©eF®lback
(è
CLICK_COLD
;

33 cÚ¡ *
	$şass_Çme
() const {  "AutoRateFallback"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/0-2"; 
	}
}

35 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "ah/a"; 
	}
}

36 cÚ¡ *
	$æow_code
(ècÚ¡ {  "#/#"; 
	}
}

38 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

39 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

42 
push
 (, 
Pack‘
 *);

44 
Pack‘
 *
puÎ
();

46 
	$add_hªdËrs
(è
CLICK_COLD
;

47 
SŒšg
 
	`¡©ic_´št_¡©s
(
EËm’t
 *
e
, *);

48 
SŒšg
 
	`´št_¿‹s
();

51 
Eth”Add»ss
 
_bÿ¡
;

52 
	`assign_¿‹
(
Pack‘
 *);

54 
	`´oûss_ãedback
(
Pack‘
 *);

56 
_¡•up
;

57 
_¡•down
;

58 
boŞ
 
_debug
;

59 
_off£t
;

60 
_·ck‘_size_th»shŞd
;

62 
	sD¡Info
 {

63 
public
:

65 
Eth”Add»ss
 
_‘h
;

66 
VeùÜ
<> 
_¿‹s
;

69 
_cu¼’t_šdex
;

70 
_sucûs£s
;

72 
_¡•up
;

73 
boŞ
 
_w’tup
;

75 
	`D¡Info
() {

78 
	`D¡Info
(
Eth”Add»ss
 
‘h
) {

79 
_‘h
 = 
‘h
;

82 
	`¿‹_šdex
(
¿‹
) {

83 
ndx
 = 0;

84 
x
 = 0; x < 
_¿‹s
.
	`size
(); x++) {

85 ià(
¿‹
 =ğ
_¿‹s
[
x
]) {

86 
ndx
 = 
x
;

90  (
ndx
 =ğ
_¿‹s
.
	`size
()) ? -1 :‚dx;

93 
	`pick_¿‹
() {

94 ià(
_¿‹s
.
	`size
() == 0) {

95 
	`şick_ch©‹r
("no„ateso…ick from for %s\n",

96 
_‘h
.
	`uÅ¬£
().
	`c_¡r
());

100 ià(
_cu¼’t_šdex
 > 0 && _cu¼’t_šdex < 
_¿‹s
.
	`size
()) {

101  
_¿‹s
[
_cu¼’t_šdex
];

103  
_¿‹s
[0];

106 
	`pick_®t_¿‹
() {

107 ià(
_¿‹s
.
	`size
() == 0) {

108 
	`şick_ch©‹r
("no„ateso…ick from for %s\n",

109 
_‘h
.
	`uÅ¬£
().
	`c_¡r
());

112  
_¿‹s
[
_cu¼’t_šdex
 <= 0 ? 0 : _current_index - 1];

114 
	}
};

117 
	gHashM­
<
	tEth”Add»ss
, 
	tD¡Info
> 
	tNeighbÜTabË
;

118 
	gNeighbÜTabË
::
	tcÚ¡_™”©Ü
 
	tNI‹r
;

120 
NeighbÜTabË
 
	g_ÃighbÜs
;

122 
AvaabËR©es
 *
	g_¹abË
;

123 
boŞ
 
	g_®t_¿‹
;

124 
boŞ
 
	g_aùive
;

125 
boŞ
 
	g_ad­tive_¡•up
;

128 
	gCLICK_ENDDECLS


	@wifi/availablerates.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şickÃt/‘h”.h
>

24 
	~"avaabË¿‹s.hh
"

25 
CLICK_DECLS


27 
	gAvaabËR©es
::
	$AvaabËR©es
()

31 
bÿ¡_addr
[] = { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff };

32 
_bÿ¡
 = 
	`Eth”Add»ss
(
bÿ¡_addr
);

34 
	}
}

36 
	gAvaabËR©es
::~
	$AvaabËR©es
()

38 
	}
}

41 
AvaabËR©es
::
	$ÿ¡
(cÚ¡ *
n
)

43 ià(
	`¡rcmp
(
n
, "AvailableRates") == 0)

44  (
AvaabËR©es
 *è
this
;

47 
	}
}

50 
	gAvaabËR©es
::
	$·r£_ªd_š£¹
(
SŒšg
 
s
, 
E¼ÜHªdËr
 *
”rh
)

52 
Eth”Add»ss
 
e
;

53 
VeùÜ
<> 
¿‹s
;

54 
VeùÜ
<
SŒšg
> 
¬gs
;

55 
	`ı_¥aûvec
(
s
, 
¬gs
);

56 ià(
¬gs
.
	`size
() < 2) {

57  
”rh
->
	`”rÜ
("”rÜ…¬am % mu¡ hav> 1‡rg", 
s
.
	`c_¡r
());

59 
boŞ
 
deçuÉ_¿‹s
 = 
çl£
;

60 ià(
¬gs
[0] == "DEFAULT") {

61 
deçuÉ_¿‹s
 = 
Œue
;

62 
_deçuÉ_¿‹s
.
	`ş—r
();

64 ià(!
	`Eth”Add»ssArg
().
	`·r£
(
¬gs
[0], 
e
))

65  
”rh
->
	`”rÜ
("”rÜ…¬am %s: mu¡ s¹ w™hƒth”Ãˆadd»ss", 
s
.
	`c_¡r
());

68 
x
 = 1; x< 
¬gs
.
	`size
(); x++) {

69 
r
;

70 
	`IÁArg
().
	`·r£
(
¬gs
[
x
], 
r
);

71 ià(
deçuÉ_¿‹s
) {

72 
_deçuÉ_¿‹s
.
	`push_back
(
r
);

74 
¿‹s
.
	`push_back
(
r
);

78 ià(
deçuÉ_¿‹s
) {

82 
D¡Info
 
d
 = 
	`D¡Info
(
e
);

83 
d
.
_¿‹s
 = 
¿‹s
;

84 
d
.
_‘h
 = 
e
;

85 
_¹abË
.
	`š£¹
(
e
, 
d
);

87 
	}
}

89 
	gAvaabËR©es
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

91 
	g»s
 = 0;

92 
	g_debug
 = 
çl£
;

93 
	gx
 = 0; x < 
	gcÚf
.
size
(); x++) {

94 
	g»s
 = 
·r£_ªd_š£¹
(
cÚf
[
x
], 
”rh
);

95 ià(
	g»s
 != 0) {

96  
»s
;

100  
	g»s
;

104 
	gAvaabËR©es
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *)

106 
AvaabËR©es
 *
q
 = (AvaabËR©e *)
e
->
	`ÿ¡
("AvailableRates");

107 ià(!
q
) ;

108 
_¹abË
 = 
q
->_rtable;

109 
_deçuÉ_¿‹s
 = _default_rates;

111 
	}
}

113 
	gVeùÜ
<>

114 
	gAvaabËR©es
::
	$lookup
(
Eth”Add»ss
 
‘h
)

116 ià(!
‘h
) {

117 
	`şick_ch©‹r
("%s:†ooku°ÿÎed w™h NULLƒth!\n", 
	`Çme
().
	`c_¡r
());

118  
VeùÜ
<>();

121 
D¡Info
 *
d¡
 = 
_¹abË
.
	`fšdp
(
‘h
);

122 ià(
d¡
) {

123  
d¡
->
_¿‹s
;

126 ià(
_deçuÉ_¿‹s
.
	`size
()) {

127  
_deçuÉ_¿‹s
;

130  
VeùÜ
<>();

131 
	}
}

134 
	gAvaabËR©es
::
š£¹
(
Eth”Add»ss
 
‘h
, 
VeùÜ
<> 
¿‹s
)

136 ià(!(
	g‘h
)) {

137 ià(
	g_debug
) {

138 
şick_ch©‹r
("AvailableRates %s: You fool, youriedo insert %s\n",

139 
Çme
().
c_¡r
(),

140 
‘h
.
uÅ¬£
().
c_¡r
());

144 
D¡Info
 *
	gd¡
 = 
_¹abË
.
fšdp
(
‘h
);

145 ià(!
	gd¡
) {

146 
	g_¹abË
.
š£¹
(
‘h
, 
D¡Info
(eth));

147 
	gd¡
 = 
_¹abË
.
fšdp
(
‘h
);

149 
	gd¡
->
	g_‘h
 = 
‘h
;

150 
	gd¡
->
	g_¿‹s
.
ş—r
();

151 ià(
	g_deçuÉ_¿‹s
.
size
()) {

153 
	gx
 = 0; x < 
	g¿‹s
.
size
(); x++) {

154 
	gy
 = 0; y < 
	g_deçuÉ_¿‹s
.
size
(); y++) {

155 ià(
	g¿‹s
[
x
] =ğ
_deçuÉ_¿‹s
[
y
]) {

156 
d¡
->
_¿‹s
.
push_back
(
¿‹s
[
x
]);

161 
	gd¡
->
	g_¿‹s
 = 
¿‹s
;

168 ’um {
	mH_DEBUG
, 
	mH_INSERT
, 
	mH_REMOVE
, 
	mH_RATES
};

171 
SŒšg


172 
	$AvaabËR©es_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

174 
AvaabËR©es
 *
td
 = (AvaabËR©e *)
e
;

175 (
ušŒ_t
è
thunk
) {

176 
H_DEBUG
:

177  
	`SŒšg
(
td
->
_debug
) + "\n";

178 
H_RATES
: {

179 
SŒšgAccum
 
§
;

180 ià(
td
->
_deçuÉ_¿‹s
.
	`size
()) {

181 
§
 << "DEFAULT ";

182 
x
 = 0; x < 
td
->
_deçuÉ_¿‹s
.
	`size
(); x++) {

183 
§
 << " " << 
td
->
_deçuÉ_¿‹s
[
x
];

185 
§
 << "\n";

187 
AvaabËR©es
::
RI‹r
 
™”
 = 
td
->
_¹abË
.
	`begš
(); i‹r.
	`live
(); iter++) {

188 
AvaabËR©es
::
D¡Info
 
n
 = 
™”
.
	`v®ue
();

189 
§
 << 
n
.
_‘h
.
	`uÅ¬£
() << " ";

190 
x
 = 0; x < 
n
.
_¿‹s
.
	`size
(); x++) {

191 
§
 << " " << 
n
.
_¿‹s
[
x
];

193 
§
 << "\n";

195  
§
.
	`ke_¡ršg
();

198  
	`SŒšg
();

200 
	}
}

202 
	$AvaabËR©es_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

203 
E¼ÜHªdËr
 *
”rh
)

205 
AvaabËR©es
 *
f
 = (AvaabËR©e *)
e
;

206 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

207 (
šŒ_t
)
v·¿m
) {

208 
H_DEBUG
: {

209 
boŞ
 
debug
;

210 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

211  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

212 
f
->
_debug
 = 
debug
;

215 
H_INSERT
:

216  
f
->
	`·r£_ªd_š£¹
(
š_s
, 
”rh
);

217 
H_REMOVE
: {

218 
Eth”Add»ss
 
e
;

219 ià(!
	`Eth”Add»ssArg
().
	`·r£
(
s
, 
e
))

220  
”rh
->
	`”rÜ
("remove…arameter must beƒthernet‡ddress");

221 
f
->
_¹abË
.
	`”a£
(
e
);

227 
	}
}

230 
	gAvaabËR©es
::
	$add_hªdËrs
()

232 
	`add_»ad_hªdËr
("debug", 
AvaabËR©es_»ad_·¿m
, 
H_DEBUG
);

233 
	`add_»ad_hªdËr
("¿‹s", 
AvaabËR©es_»ad_·¿m
, 
H_RATES
);

236 
	`add_wr™e_hªdËr
("debug", 
AvaabËR©es_wr™e_·¿m
, 
H_DEBUG
);

237 
	`add_wr™e_hªdËr
("š£¹", 
AvaabËR©es_wr™e_·¿m
, 
H_INSERT
);

238 
	`add_wr™e_hªdËr
("»move", 
AvaabËR©es_wr™e_·¿m
, 
H_REMOVE
);

241 
	}
}

243 
CLICK_ENDDECLS


244 
EXPORT_ELEMENT
(
AvaabËR©es
)

	@wifi/availablerates.hh

1 #iâdeà
CLICK_AVAILABLERATES_HH


2 
	#CLICK_AVAILABLERATES_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/add»ss.hh
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<şick/bighashm­.hh
>

7 
	~<şick/glue.hh
>

8 
CLICK_DECLS


36 şas 
	cAvaabËR©es
 : 
public
 
EËm’t
 {…ublic:

38 
	$AvaabËR©es
(è
CLICK_COLD
;

39 ~
	$AvaabËR©es
(è
CLICK_COLD
;

41 cÚ¡ *
	$şass_Çme
() const {  "AvailableRates"; }

42 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_0
; 
	}
}

44 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

45 *
ÿ¡
(cÚ¡ *
n
);

46 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

48 
	$add_hªdËrs
(è
CLICK_COLD
;

49 
	`ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *);

51 
VeùÜ
<> 
	`lookup
(
Eth”Add»ss
 
‘h
);

52 
	`š£¹
(
Eth”Add»ss
 
‘h
, 
VeùÜ
<>);

54 
Eth”Add»ss
 
_bÿ¡
;

55 
boŞ
 
_debug
;

57 
	`·r£_ªd_š£¹
(
SŒšg
 
s
, 
E¼ÜHªdËr
 *
”rh
);

59 şas 
	cD¡Info
 {

60 
public
:

61 
Eth”Add»ss
 
_‘h
;

62 
VeùÜ
<> 
_¿‹s
;

63 
	`D¡Info
() {

64 
	`mem£t
(
this
, 0, (*this));

67 
	`D¡Info
(
Eth”Add»ss
 
‘h
) {

68 
	`mem£t
(
this
, 0, (*this));

69 
_‘h
 = 
‘h
;

71 
	}
};

73 
	gHashM­
<
	tEth”Add»ss
, 
	tD¡Info
> 
	tRTabË
;

74 
	gRTabË
::
	tcÚ¡_™”©Ü
 
	tRI‹r
;

76 
RTabË
 
	g_¹abË
;

77 
	gVeùÜ
<> 
	g_deçuÉ_¿‹s
;

78 
	g´iv©e
:

81 
	gCLICK_ENDDECLS


	@wifi/bitrate.cc

1 
	~<şick/cÚfig.h
>

2 
	~"b™¿‹.hh
"

3 
	~<şickÃt/wifi.h
>

7 
	$ÿlc_Œªsm™_time
(
¿‹
, 
Ëngth
)

9 
t_¶ı_h—d”
 = 96;

10 ià(
¿‹
 == 2) {

11 
t_¶ı_h—d”
 = 192;

12 } ià(!
	`is_b_¿‹
(
¿‹
)) {

13 
t_¶ı_h—d”
 = 20;

15  (2 * (
t_¶ı_h—d”
 + ((
Ëngth
 * 8))))/ 
¿‹
;

16 
	}
}

19 
	$ÿlc_backoff
(
¿‹
, 
t
)

21 
t_¦Ù
 = 
	`is_b_¿‹
(
¿‹
è? 
WIFI_SLOT_B
 : 
WIFI_SLOT_A
;

22 
cw
 = 
WIFI_CW_MIN
;

25 
x
 = 0; x < 
t
; x++) {

26 
cw
 = 
	`WIFI_MIN
(
WIFI_CW_MAX
, (cw + 1) * 2);

28  
t_¦Ù
 * 
cw
 / 2;

29 
	}
}

32 
	$ÿlc_u£cs_wifi_·ck‘_Œ›s
(
Ëngth
, 
¿‹
, 
Œy0
, 
ŒyN
)

34 ià(!
¿‹
 || !
Ëngth
 || 
Œy0
 > 
ŒyN
) {

39 
t_¦Ù
 = 20;

40 
t_ack
 = 304;

41 
t_difs
 = 50;

42 
t_sifs
 = 10;

45 ià(!
	`is_b_¿‹
(
¿‹
)) {

47 
t_¦Ù
 = 9;

48 
t_sifs
 = 9;

49 
t_difs
 = 28;

50 
t_ack
 = 30;

53 
‰
 = 0;

54 
x
 = 
Œy0
; x <ğ
ŒyN
; x++) {

55 
‰
 +ğ
	`ÿlc_backoff
(
¿‹
, 
x
è+ 
	`ÿlc_Œªsm™_time
Ô©e, 
Ëngth
) +

56 
t_sifs
 + 
t_ack
;

58  
‰
;

59 
	}
}

62 
	$ÿlc_u£cs_wifi_·ck‘
(
Ëngth
, 
¿‹
, 
»Œ›s
)

64  
	`ÿlc_u£cs_wifi_·ck‘_Œ›s
(
Ëngth
, 
¿‹
, 0, 
»Œ›s
);

65 
	}
}

67 
ELEMENT_PROVIDES
(
b™¿‹
)

	@wifi/bitrate.hh

1 #iâdeà
_BITRATE_H


2 
	#_BITRATE_H


	)

4 
	~<şick/cÚfig.h
>

5 
ÿlc_u£cs_wifi_·ck‘_Œ›s
(
Ëngth
,

6 
¿‹
,

7 
Œy0
, 
ŒyN
);

9 
ÿlc_backoff
(
¿‹
, 
t
);

11 
ÿlc_u£cs_wifi_·ck‘
(
Ëngth
,

12 
¿‹
, 
»Œ›s
);

15 
ÿlc_Œªsm™_time
(
¿‹
, 
Ëngth
);

	@wifi/ethercount.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şickÃt/‘h”.h
>

25 
	~<şickÃt/wifi.h
>

26 
	~"‘h”couÁ.hh
"

27 
CLICK_DECLS


29 
	gEth”CouÁ
::
	$Eth”CouÁ
()

31 
	}
}

33 
Eth”CouÁ
::~
	$Eth”CouÁ
()

35 
	}
}

37 
Pack‘
 *

38 
Eth”CouÁ
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

40 
şick_‘h”
 *
eh
 = (şick_‘h” *è
p_š
->
	`d©a
();

41 
Eth”Add»ss
 
¤c
 = 
	`Eth”Add»ss
(
eh
->
‘h”_sho¡
);

42 
D¡Info
 *
nfo
 = 
_ÃighbÜs
.
	`fšdp
(
¤c
);

43 ià(!
nfo
) {

44 
D¡Info
 
foo
 = 
	`D¡Info
(
¤c
);

45 
_ÃighbÜs
.
	`š£¹
(
¤c
, 
foo
);

46 
nfo
 = 
_ÃighbÜs
.
	`fšdp
(
¤c
);

48 
nfo
->
couÁ
++;

49  
p_š
;

50 
	}
}

52 ’um {
	mH_STATS
, 
	mH_RESET
};

54 
SŒšg


55 
	$Eth”CouÁ_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

57 
Eth”CouÁ
 *
td
 = (Eth”CouÁ *)
e
;

58 (
ušŒ_t
è
thunk
) {

59 
H_STATS
: {

60 
SŒšgAccum
 
§
;

61 
Eth”CouÁ
::
NI‹r
 
™”
 = 
td
->
_ÃighbÜs
.
	`begš
(); i‹r.
	`live
(); iter++) {

62 
Eth”CouÁ
::
D¡Info
 
n
 = 
™”
.
	`v®ue
();

63 
§
 << 
n
.
_‘h
.
	`uÅ¬£
(è<< " " <<‚.
couÁ
 << "\n";

65  
§
.
	`ke_¡ršg
();

69  
	`SŒšg
();

72 
	}
}

75 
	$Eth”CouÁ_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

76 
E¼ÜHªdËr
 *)

78 
Eth”CouÁ
 *
f
 = (Eth”CouÁ *)
e
;

79 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

80 (
šŒ_t
)
v·¿m
) {

81 
H_RESET
: 
f
->
_ÃighbÜs
.
	`ş—r
();  0;

84 
	}
}

87 
	gEth”CouÁ
::
	$add_hªdËrs
()

89 
	`add_»ad_hªdËr
("¡©s", 
Eth”CouÁ_»ad_·¿m
, 
H_STATS
);

90 
	`add_wr™e_hªdËr
("»£t", 
Eth”CouÁ_wr™e_·¿m
, 
H_RESET
, 
HªdËr
::
BUTTON
);

91 
	}
}

93 
CLICK_ENDDECLS


94 
EXPORT_ELEMENT
(
Eth”CouÁ
)

	@wifi/ethercount.hh

1 #iâdeà
CLICK_ETHERCOUNT_HH


2 
	#CLICK_ETHERCOUNT_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/bighashm­.hh
>

6 
	~<şick/glue.hh
>

7 
CLICK_DECLS


33 şas 
	cEth”CouÁ
 : 
public
 
EËm’t
 {…ublic:

35 
	$Eth”CouÁ
(è
CLICK_COLD
;

36 ~
	$Eth”CouÁ
(è
CLICK_COLD
;

38 cÚ¡ *
	$şass_Çme
() const {  "EtherCount"; }

39 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

40 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

42 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

44 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

46 
	$add_hªdËrs
(è
CLICK_COLD
;

48 şas 
	cD¡Info
 {

49 
public
:

50 
Eth”Add»ss
 
_‘h
;

51 
couÁ
;

53 
	`D¡Info
() {

54 
	`mem£t
(
this
, 0, (*this));

57 
	`D¡Info
(
Eth”Add»ss
 
‘h
) {

58 
	`mem£t
(
this
, 0, (*this));

59 
_‘h
 = 
‘h
;

62 
	}
};

63 
	gHashM­
<
	tEth”Add»ss
, 
	tD¡Info
> 
	tNeighbÜTabË
;

64 
	gNeighbÜTabË
::
	tcÚ¡_™”©Ü
 
	tNI‹r
;

66 
NeighbÜTabË
 
	g_ÃighbÜs
;

70 
	gCLICK_ENDDECLS


	@wifi/extradecap.cc

18 
	~<şick/cÚfig.h
>

19 
	~"exŒadeÿp.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/wifi.h
>

25 
	~<şick/·ck‘_ªno.hh
>

26 
	~<şickÃt/Îc.h
>

27 
CLICK_DECLS


29 
	gExŒaDeÿp
::
	$ExŒaDeÿp
()

31 
	}
}

33 
ExŒaDeÿp
::~
	$ExŒaDeÿp
()

35 
	}
}

38 
ExŒaDeÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40 
	g_debug
 = 
çl£
;

41  
Args
(
cÚf
, 
this
, 
”rh
).
»ad
("DEBUG", 
_debug
).
com¶‘e
();

44 
Pack‘
 *

45 
	gExŒaDeÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

48 
şick_wifi_exŒa
 *
ûh
 = (şick_wifi_exŒ¨*è
p
->
	`d©a
();

50 ià(
ûh
->
magic
 =ğ
WIFI_EXTRA_MAGIC
) {

51 
	`memıy
(
	`WIFI_EXTRA_ANNO
(
p
),…->
	`d©a
(), (
şick_wifi_exŒa
));

52 
p
->
	`puÎ
((
şick_wifi_exŒa
));

55  
p
;

56 
	}
}

59 ’um {
	mH_DEBUG
};

61 
SŒšg


62 
	$ExŒaDeÿp_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

64 
ExŒaDeÿp
 *
td
 = (ExŒaDeÿ°*)
e
;

65 (
ušŒ_t
è
thunk
) {

66 
H_DEBUG
:

67  
	`SŒšg
(
td
->
_debug
) + "\n";

69  
	`SŒšg
();

71 
	}
}

73 
	$ExŒaDeÿp_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

74 
E¼ÜHªdËr
 *
”rh
)

76 
ExŒaDeÿp
 *
f
 = (ExŒaDeÿ°*)
e
;

77 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

78 (
šŒ_t
)
v·¿m
) {

79 
H_DEBUG
: {

80 
boŞ
 
debug
;

81 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

82  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

83 
f
->
_debug
 = 
debug
;

88 
	}
}

91 
	gExŒaDeÿp
::
	$add_hªdËrs
()

93 
	`add_»ad_hªdËr
("debug", 
ExŒaDeÿp_»ad_·¿m
, 
H_DEBUG
);

95 
	`add_wr™e_hªdËr
("debug", 
ExŒaDeÿp_wr™e_·¿m
, 
H_DEBUG
);

96 
	}
}

97 
CLICK_ENDDECLS


98 
EXPORT_ELEMENT
(
ExŒaDeÿp
)

	@wifi/extradecap.hh

1 #iâdeà
CLICK_EXTRADECAP_HH


2 
	#CLICK_EXTRADECAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


22 şas 
	cExŒaDeÿp
 : 
public
 
EËm’t
 {…ublic:

24 
	$ExŒaDeÿp
(è
CLICK_COLD
;

25 ~
	$ExŒaDeÿp
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "ExtraDecap"; }

28 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

29 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

31 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

32 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

34 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

37 
	$add_hªdËrs
(è
CLICK_COLD
;

40 
boŞ
 
_debug
;

41 
´iv©e
:

43 
	}
};

45 
	gCLICK_ENDDECLS


	@wifi/extraencap.cc

18 
	~<şick/cÚfig.h
>

19 
	~"exŒ«nÿp.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/wifi.h
>

25 
	~<şick/·ck‘_ªno.hh
>

26 
	~<şickÃt/Îc.h
>

27 
CLICK_DECLS


29 
	gExŒaEnÿp
::
	$ExŒaEnÿp
()

31 
	}
}

33 
ExŒaEnÿp
::~
	$ExŒaEnÿp
()

35 
	}
}

38 
ExŒaEnÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40 
	g_debug
 = 
çl£
;

41  
Args
(
cÚf
, 
this
, 
”rh
).
»ad
("DEBUG", 
_debug
).
com¶‘e
();

44 
Pack‘
 *

45 
	gExŒaEnÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

48 
Wr™abËPack‘
 *
p_out
 = 
p
->
	`uniqueify
();

49 ià(!
p_out
) {

50 
p
->
	`kl
();

54 
p_out
 =…_out->
	`push
((
şick_wifi_exŒa
));

55 ià(
p_out
) {

56 
şick_wifi_exŒa
 *
eh
 = (şick_wifi_exŒ¨*è
p_out
->
	`d©a
();

58 
	`mem£t
(
eh
, 0, (
şick_wifi_exŒa
));

59 
	`memıy
(
p_out
->
	`d©a
(), 
	`WIFI_EXTRA_ANNO
Õ_out), (
şick_wifi_exŒa
));

60 
eh
->
magic
 = 
WIFI_EXTRA_MAGIC
;

62  
p_out
;

63 
	}
}

66 ’um {
	mH_DEBUG
};

68 
SŒšg


69 
	$ExŒaEnÿp_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

71 
ExŒaEnÿp
 *
td
 = (ExŒaEnÿ°*)
e
;

72 (
ušŒ_t
è
thunk
) {

73 
H_DEBUG
:

74  
	`SŒšg
(
td
->
_debug
) + "\n";

76  
	`SŒšg
();

78 
	}
}

80 
	$ExŒaEnÿp_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

81 
E¼ÜHªdËr
 *
”rh
)

83 
ExŒaEnÿp
 *
f
 = (ExŒaEnÿ°*)
e
;

84 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

85 (
šŒ_t
)
v·¿m
) {

86 
H_DEBUG
: {

87 
boŞ
 
debug
;

88 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

89  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

90 
f
->
_debug
 = 
debug
;

95 
	}
}

98 
	gExŒaEnÿp
::
	$add_hªdËrs
()

100 
	`add_»ad_hªdËr
("debug", 
ExŒaEnÿp_»ad_·¿m
, 
H_DEBUG
);

102 
	`add_wr™e_hªdËr
("debug", 
ExŒaEnÿp_wr™e_·¿m
, 
H_DEBUG
);

103 
	}
}

104 
CLICK_ENDDECLS


105 
EXPORT_ELEMENT
(
ExŒaEnÿp
)

	@wifi/extraencap.hh

1 #iâdeà
CLICK_EXTRAENCAP_HH


2 
	#CLICK_EXTRAENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


22 şas 
	cExŒaEnÿp
 : 
public
 
EËm’t
 {…ublic:

24 
	$ExŒaEnÿp
(è
CLICK_COLD
;

25 ~
	$ExŒaEnÿp
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "ExtraEncap"; }

28 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

29 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

31 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

32 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

34 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

37 
	$add_hªdËrs
(è
CLICK_COLD
;

40 
boŞ
 
_debug
;

41 
´iv©e
:

43 
	}
};

45 
	gCLICK_ENDDECLS


	@wifi/filterfailures.cc

1 
	~<şick/cÚfig.h
>

2 
	~<şick/”rÜ.hh
>

3 
	~<şick/¬gs.hh
>

4 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

5 
	~<şick/·ck‘_ªno.hh
>

6 
	~<şick/¡¿ccum.hh
>

7 
	~<şickÃt/wifi.h
>

8 
	~"f‹rçu»s.hh
"

10 
CLICK_DECLS


13 
	gF‹rFau»s
::
	$F‹rFau»s
()

14 : 
	$_drİs
(0)

16 
	}
}

18 
F‹rFau»s
::~
	$F‹rFau»s
()

20 
	}
}

22 
Pack‘
 *

23 
F‹rFau»s
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

26 
şick_wifi_exŒa
 *
ûha
 = 
	`WIFI_EXTRA_ANNO
(
p
);

27 
şick_wifi_exŒa
 *
ûhp
 = (şick_wifi_exŒ¨*è
p
->
	`d©a
();

30 ià((
ûha
->
magic
 =ğ
WIFI_EXTRA_MAGIC
 && ceha->
æags
 & 
WIFI_EXTRA_TX_FAIL
) ||

31 (
ûhp
->
magic
 =ğ
WIFI_EXTRA_MAGIC
 && cehp->
æags
 & 
WIFI_EXTRA_TX_FAIL
)) {

32 ià(
	`nouuts
() == 2) {

33 
	`ouut
(1).
	`push
(
p
);

35 
p
->
	`kl
();

37 
_drİs
++;

40  
p
;

41 
	}
}

43 ’um {
	mH_DROPS
 };

45 
SŒšg


46 
	$F‹rFau»s_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

48 
F‹rFau»s
 *
td
 = (F‹rFau» *)
e
;

49 (
ušŒ_t
è
thunk
) {

50 
H_DROPS
:

51  
	`SŒšg
(
td
->
_drİs
) + "\n";

53  
	`SŒšg
();

56 
	}
}

59 
	gF‹rFau»s
::
	$add_hªdËrs
()

61 
	`add_»ad_hªdËr
("drİs", 
F‹rFau»s_»ad_·¿m
, 
H_DROPS
);

62 
	}
}

64 
CLICK_ENDDECLS


67 
EXPORT_ELEMENT
(
F‹rFau»s
)

	@wifi/filterfailures.hh

1 #iâdeà
CLICK_FILTERFAILURES_HH


2 
	#CLICK_FILTERFAILURES_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/bighashm­.hh
>

6 
	~<şick/glue.hh
>

7 
CLICK_DECLS


28 şas 
	cF‹rFau»s
 : 
public
 
EËm’t
 {…ublic:

30 
	$F‹rFau»s
(è
CLICK_COLD
;

31 ~
	$F‹rFau»s
(è
CLICK_COLD
;

33 cÚ¡ *
	$şass_Çme
() const {  "FilterFailures"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-2"; 
	}
}

35 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

37 
	$add_hªdËrs
(è
CLICK_COLD
;

38 
SŒšg
 
	`¡©ic_´št_drİs
(
EËm’t
 *, *);

39 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

40 
_drİs
;

41 
	}
};

43 
	gCLICK_ENDDECLS


	@wifi/filterphyerr.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/”rÜ.hh
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/·ck‘_ªno.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şickÃt/wifi.h
>

24 
	~"f‹½hy”r.hh
"

26 
CLICK_DECLS


29 
	gF‹rPhyE¼
::
	$F‹rPhyE¼
()

30 : 
	$_drİs
(0)

33 
	}
}

35 
F‹rPhyE¼
::~
	$F‹rPhyE¼
()

37 
	}
}

39 
Pack‘
 *

40 
F‹rPhyE¼
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

42 
şick_wifi_exŒa
 *
ûha
 = 
	`WIFI_EXTRA_ANNO
(
p
);

43 
şick_wifi_exŒa
 *
ûhp
 = (şick_wifi_exŒ¨*è
p
->
	`d©a
();

46 ià((
ûha
->
magic
 =ğ
WIFI_EXTRA_MAGIC
 && ceha->
æags
 & 
WIFI_EXTRA_RX_ERR
) ||

47 (
ûhp
->
magic
 =ğ
WIFI_EXTRA_MAGIC
 && cehp->
æags
 & 
WIFI_EXTRA_RX_ERR
)) {

48 ià(
	`nouuts
() == 2) {

49 
	`ouut
(1).
	`push
(
p
);

51 
p
->
	`kl
();

53 
_drİs
++;

56  
p
;

57 
	}
}

59 ’um {
	mH_DROPS
 };

61 
SŒšg


62 
	$F‹rPhyE¼_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

64 
F‹rPhyE¼
 *
td
 = (F‹rPhyE¼ *)
e
;

65 (
ušŒ_t
è
thunk
) {

66 
H_DROPS
:

67  
	`SŒšg
(
td
->
_drİs
) + "\n";

69  
	`SŒšg
();

72 
	}
}

74 
	gF‹rPhyE¼
::
	$add_hªdËrs
()

76 
	`add_»ad_hªdËr
("drİs", 
F‹rPhyE¼_»ad_·¿m
, 
H_DROPS
);

77 
	}
}

79 
CLICK_ENDDECLS


82 
EXPORT_ELEMENT
(
F‹rPhyE¼
)

	@wifi/filterphyerr.hh

1 #iâdeà
CLICK_FILTERPHYERR_HH


2 
	#CLICK_FILTERPHYERR_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/bighashm­.hh
>

6 
	~<şick/glue.hh
>

7 
CLICK_DECLS


26 şas 
	cF‹rPhyE¼
 : 
public
 
EËm’t
 {…ublic:

28 
	$F‹rPhyE¼
(è
CLICK_COLD
;

29 ~
	$F‹rPhyE¼
(è
CLICK_COLD
;

31 cÚ¡ *
	$şass_Çme
() const {  "FilterPhyErr"; }

32 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/1-3"; 
	}
}

33 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

35 
	$add_hªdËrs
(è
CLICK_COLD
;

36 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

39 
_drİs
;

42 
	}
};

44 
	gCLICK_ENDDECLS


	@wifi/filtertx.cc

1 
	~<şick/cÚfig.h
>

2 
	~<şick/”rÜ.hh
>

3 
	~<şick/¬gs.hh
>

4 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

5 
	~<şickÃt/wifi.h
>

6 
	~<şick/¡¿ccum.hh
>

7 
	~<şick/·ck‘_ªno.hh
>

8 
	~"f‹¹x.hh
"

10 
CLICK_DECLS


13 
	gF‹rTX
::
	$F‹rTX
()

14 : 
	$_drİs
(0)

16 
	}
}

18 
F‹rTX
::~
	$F‹rTX
()

20 
	}
}

22 
Pack‘
 *

23 
F‹rTX
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

25 
şick_wifi_exŒa
 *
ûha
 = 
	`WIFI_EXTRA_ANNO
(
p
);

26 
şick_wifi_exŒa
 *
ûhp
 = (şick_wifi_exŒ¨*è
p
->
	`d©a
();

29 ià((
ûha
->
magic
 =ğ
WIFI_EXTRA_MAGIC
 && ceha->
æags
 & 
WIFI_EXTRA_TX
) ||

30 (
ûhp
->
magic
 =ğ
WIFI_EXTRA_MAGIC
 && cehp->
æags
 & 
WIFI_EXTRA_TX
)) {

31 ià(
	`nouuts
() == 2) {

32 
	`ouut
(1).
	`push
(
p
);

34 
p
->
	`kl
();

39  
p
;

40 
	}
}

43 ’um {
	mH_DROPS
 };

45 
SŒšg


46 
	$F‹rTX_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

48 
F‹rTX
 *
td
 = (F‹rTX *)
e
;

49 (
ušŒ_t
è
thunk
) {

50 
H_DROPS
:

51  
	`SŒšg
(
td
->
_drİs
) + "\n";

53  
	`SŒšg
();

56 
	}
}

58 
	gF‹rTX
::
	$add_hªdËrs
()

60 
	`add_»ad_hªdËr
("drİs", 
F‹rTX_»ad_·¿m
, 
H_DROPS
);

61 
	}
}

63 
CLICK_ENDDECLS


66 
EXPORT_ELEMENT
(
F‹rTX
)

	@wifi/filtertx.hh

1 #iâdeà
CLICK_FILTERTX_HH


2 
	#CLICK_FILTERTX_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/bighashm­.hh
>

6 
	~<şick/glue.hh
>

7 
CLICK_DECLS


28 şas 
	cF‹rTX
 : 
public
 
EËm’t
 {…ublic:

30 
	$F‹rTX
(è
CLICK_COLD
;

31 ~
	$F‹rTX
(è
CLICK_COLD
;

33 cÚ¡ *
	$şass_Çme
() const {  "FilterTX"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1X2
; 
	}
}

35 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

37 
	$add_hªdËrs
(è
CLICK_COLD
;

38 
SŒšg
 
	`¡©ic_´št_drİs
(
EËm’t
 *, *);

39 
SŒšg
 
	`¡©ic_´št_max_çu»s
(
EËm’t
 *, *);

40 
	`¡©ic_wr™e_max_çu»s
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
e
,

41 *, 
E¼ÜHªdËr
 *
”rh
);

43 
SŒšg
 
	`¡©ic_´št_®low_sucûss
(
EËm’t
 *, *);

44 
	`¡©ic_wr™e_®low_sucûss
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
e
,

45 *, 
E¼ÜHªdËr
 *
”rh
);

46 
Pack‘
 *
	`sim¶e_aùiÚ
(Packet *);

48 
_drİs
;

49 
	}
};

51 
	gCLICK_ENDDECLS


	@wifi/fromhandler.cc

17 
	~<şick/cÚfig.h
>

18 
	~"äomhªdËr.hh
"

19 
	~<şick/¬gs.hh
>

20 
	~<şick/rou‹r.hh
>

21 
	~<şick/¡¿ccum.hh
>

22 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

23 
	~<şick/”rÜ.hh
>

24 
	~<şick/glue.hh
>

25 
	~<şick/hªdËrÿÎ.hh
>

26 
	~<şick/·ck‘_ªno.hh
>

27 
	~<şick/u£ruts.hh
>

28 
CLICK_DECLS


30 
	gFromHªdËr
::
	$FromHªdËr
()

31 : 
	$_sk
(
this
)

33 
	}
}

35 
FromHªdËr
::~
	$FromHªdËr
()

38 
	}
}

41 
FromHªdËr
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

43 ià(
Args
(
cÚf
, 
this
, 
”rh
)

44 .
»ad_mp
("HANDLER", 
_hªdËr
)

45 .
com¶‘e
() < 0)

48 
	g_aùive
 = 
çl£
;

53 
	gFromHªdËr
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

55 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
”rh
);

57 
	}
}

59 
u_št8_t


60 
	$ch¬_to_hex
(
c
)

62 
c
) {

81 
	}
}

82 
boŞ


83 
	gFromHªdËr
::
	$g‘_·ck‘
()

85 
SŒšg
 
s
 = 
HªdËrC®l
::
	`ÿÎ_»ad
(
_hªdËr
, 
this
, 
E¼ÜHªdËr
::
	`deçuÉ_hªdËr
());

86 ià(
s
.
	`Ëngth
() <= 1) {

87  
çl£
;

89 
Time¡amp
 
t
 = Time¡amp::
	`now
();

90 
n
 = 
s
.
	`fšd_Ëá
('|', 0);

91 ià(
n
 > 0) {

92 
SŒšg
 
ts
 = 
s
.
	`sub¡ršg
(0, 
n
-1);

93 ià(!
	`ı_time
(
ts
, &
t
)) {

94 
	`şick_ch©‹r
("parsingime failed\n");

96 
s
 = s.
	`sub¡ršg
(
n
+2, s.
	`Ëngth
() -‚ - 1);

98 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
s
.
	`Ëngth
()/2);

99 ià(!
p
) {

100  
çl£
;

102 
p
->
	`£t_time¡amp_ªno
(
t
);

103 
	`mem£t
(
p
->
	`d©a
(), 0,…->
	`Ëngth
());

104 
x
 = 0; x + 1 < 
s
.
	`Ëngth
(); x += 2) {

105 
p
->
	`d©a
()[
x
/2] = (
	`ch¬_to_hex
(
s
[x]) << 4) | char_to_hex(s[x + 1]);

107 
	`ouut
(0).
	`push
(
p
);

108  
Œue
;

109 
	}
}

111 
boŞ


112 
	gFromHªdËr
::
	$run_sk
(
Task
 *)

114 ià(!
_aùive
) {

115  
çl£
;

117 
boŞ
 
a
 = 
	`g‘_·ck‘
();

118 ià(
a
) {

119 
_sk
.
	`ç¡_»scheduË
();

120  
Œue
;

122 ià(
_aùive
) {

123 
_’d
 = 
Time¡amp
::
	`now
();

125 
_aùive
 = 
çl£
;

126  
çl£
;

127 
	}
}

131 
	gFromHªdËr
::
	$£t_aùive
(
boŞ
 
b
) {

132 
_aùive
 = 
b
;

133 ià(
_aùive
) {

134 
_¡¬t
 = 
Time¡amp
::
	`now
();

135 
_’d
 = 
_¡¬t
;

136 
_sk
.
	`»scheduË
();

138 
	}
}

139 ’um { 
	mH_ACTIVE
, 
	mH_TIME
};

141 
SŒšg


142 
	gFromHªdËr
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

144 
FromHªdËr
 *
fd
 = 
¡©ic_ÿ¡
<FromHªdË¸*>(
e
);

145 (
šŒ_t
)
thunk
) {

146 
H_ACTIVE
:

147  
BoŞArg
::
	`uÅ¬£
(
fd
->
_aùive
);

148 
H_TIME
: {

149 
SŒšgAccum
 
§
;

150 
§
 << 
fd
->
_’d
 - fd->
_¡¬t
 << "\n";

151  
§
.
	`ke_¡ršg
();

156 
	}
}

159 
	gFromHªdËr
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s_š
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
)

161 
FromHªdËr
 *
fd
 = 
¡©ic_ÿ¡
<FromHªdË¸*>(
e
);

162 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
s_š
);

163 (
šŒ_t
)
thunk
) {

164 
H_ACTIVE
: {

165 
boŞ
 
aùive
;

166 ià(
	`BoŞArg
().
	`·r£
(
s
, 
aùive
)) {

167 
fd
->
	`£t_aùive
(
aùive
);

170  
”rh
->
	`”rÜ
("'active' should be Boolean");

173  -
EINVAL
;

175 
	}
}

178 
	gFromHªdËr
::
	$add_hªdËrs
()

180 
	`add_»ad_hªdËr
("time", 
»ad_hªdËr
, 
H_TIME
);

181 
	`add_»ad_hªdËr
("aùive", 
»ad_hªdËr
, 
H_ACTIVE
);

182 
	`add_wr™e_hªdËr
("aùive", 
wr™e_hªdËr
, 
H_ACTIVE
);

183 
	}
}

185 
CLICK_ENDDECLS


186 
	$ELEMENT_REQUIRES
(
u£¾ev–
)

187 
	`EXPORT_ELEMENT
(
FromHªdËr
)

	@wifi/fromhandler.hh

2 #iâdeà
CLICK_FROMHANDLER_HH


3 
	#CLICK_FROMHANDLER_HH


	)

4 
	~<şick/–em’t.hh
>

5 
	~<şick/sk.hh
>

6 
	~<şick/nÙif›r.hh
>

7 
CLICK_DECLS


8 
şass
 
	gHªdËrC®l
;

10 şas 
	cFromHªdËr
 : 
public
 
EËm’t
 {…ublic:

12 
	$FromHªdËr
(è
CLICK_COLD
;

13 ~
	$FromHªdËr
(è
CLICK_COLD
;

15 cÚ¡ *
	$şass_Çme
() const {  "FromHandler"; }

16 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "0/1-2"; 
	}
}

17 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PROCESSING_A_AH
; 
	}
}

19 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

20 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

21 
	$add_hªdËrs
(è
CLICK_COLD
;

23 
	`£t_aùive
(
boŞ
);

24 
boŞ
 
	`run_sk
(
Task
 *);

25 
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
s_š
, 
EËm’t
 *
e
, *
thunk
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

26 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
è
CLICK_COLD
;

28 
´iv©e
:

29 
boŞ
 
	`g‘_·ck‘
();

30 
boŞ
 
_aùive
;

31 
Task
 
_sk
;

32 
SŒšg
 
_hªdËr
;

33 
Time¡amp
 
_¡¬t
;

34 
Time¡amp
 
_’d
;

35 
	}
};

37 
	gCLICK_ENDDECLS


	@wifi/linktable.cc

18 
	~<şick/cÚfig.h
>

19 
	~"lškbË.hh
"

20 
	~<şick/add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<–em’ts/wifi/·th.hh
>

25 
	~<şick/¡¿ccum.hh
>

26 
CLICK_DECLS


28 
	gLškTabË
::
	$LškTabË
()

29 : 
	$_tim”
(
this
)

31 
	}
}

35 
LškTabË
::~
	$LškTabË
()

37 
	}
}

41 
LškTabË
::
	$š™Ÿlize
 (
E¼ÜHªdËr
 *)

43 
_tim”
.
	`š™Ÿlize
(
this
);

44 
_tim”
.
	`scheduË_now
();

46 
	}
}

49 
	gLškTabË
::
	$run_tim”
(
Tim”
 *)

51 
	`ş—r_¡®e
();

52 
	`dijk¡¿
(
Œue
);

53 
	`dijk¡¿
(
çl£
);

54 
_tim”
.
	`scheduË_aá”_m£c
(5000);

55 
	}
}

57 
	gLškTabË
::
	$ÿ¡
(cÚ¡ *
n
)

59 ià(
	`¡rcmp
(
n
, "LinkTable") == 0)

60  (
LškTabË
 *è
this
;

63 
	}
}

65 
	gLškTabË
::
cÚfigu»
 (
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

67 
	g»t
;

68 
	g¡®e_³riod
 = 120;

69 
	g»t
 = 
Args
(
cÚf
, 
this
, 
”rh
)

70 .
»ad
("IP", 
_
)

71 .
»ad
("STALE", 
¡®e_³riod
)

72 .
com¶‘e
();

74 ià(!
	g_
)

75  
	g”rh
->
”rÜ
("IP‚ot specified");

77 
	g_¡®e_timeout
.
assign
(
¡®e_³riod
, 0);

79 
	g_ho¡s
.
š£¹
(
_
, 
Ho¡Info
(_ip));

80  
	g»t
;

85 
	gLškTabË
::
	$ke_¡©e
(
EËm’t
 *
e
, 
E¼ÜHªdËr
 *) {

86 
LškTabË
 *
q
 = (LškTabË *)
e
->
	`ÿ¡
("LinkTable");

87 ià(!
q
) ;

89 
_ho¡s
 = 
q
->_hosts;

90 
_lšks
 = 
q
->_links;

91 
	`dijk¡¿
(
Œue
);

92 
	`dijk¡¿
(
çl£
);

93 
	}
}

96 
	gLškTabË
::
	$¡©ic_upd©e_lšk
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
e
,

97 *, 
E¼ÜHªdËr
 *
”rh
)

99 
LškTabË
 *
n
 = (LškTabË *è
e
;

100 
VeùÜ
<
SŒšg
> 
¬gs
;

101 
IPAdd»ss
 
äom
;

102 
IPAdd»ss
 
to
;

103 
ušt32_t
 
£q
;

104 
ušt32_t
 
age
;

105 
ušt32_t
 
m‘ric
;

106 
	`ı_¥aûvec
(
¬g
, 
¬gs
);

108 ià(
¬gs
.
	`size
() != 5) {

109  
”rh
->
	`”rÜ
("Mu¡ havth»¬gum’ts: cu¼’y ha %d: %s", 
¬gs
.
	`size
(),‡rgs[0].
	`c_¡r
());

113 ià(!
	`IPAdd»ssArg
().
	`·r£
(
¬gs
[0], 
äom
)) {

114  
”rh
->
	`”rÜ
("Couldn't„ead IPAddress out of from");

116 ià(!
	`IPAdd»ssArg
().
	`·r£
(
¬gs
[1], 
to
)) {

117  
”rh
->
	`”rÜ
("Couldn't„ead IPAddress out ofo");

119 ià(!
	`IÁArg
().
	`·r£
(
¬gs
[2], 
m‘ric
)) {

120  
”rh
->
	`”rÜ
("Couldn't„ead metric");

123 ià(!
	`IÁArg
().
	`·r£
(
¬gs
[3], 
£q
)) {

124  
”rh
->
	`”rÜ
("Couldn't„ead seq");

127 ià(!
	`IÁArg
().
	`·r£
(
¬gs
[4], 
age
)) {

128  
”rh
->
	`”rÜ
("Couldn't„ead‡ge");

131 
n
->
	`upd©e_lšk
(
äom
, 
to
, 
£q
, 
age
, 
m‘ric
);

134 
	}
}

136 
	gLškTabË
::
	$ş—r
()

138 
_ho¡s
.
	`ş—r
();

139 
_lšks
.
	`ş—r
();

141 
	}
}

142 
boŞ


143 
	gLškTabË
::
	$upd©e_lšk
(
IPAdd»ss
 
äom
, IPAdd»s 
to
,

144 
ušt32_t
 
£q
, ušt32_ˆ
age
, ušt32_ˆ
m‘ric
)

146 ià(!
äom
 || !
to
 || !
m‘ric
) {

147  
çl£
;

149 ià(
_¡®e_timeout
.
	`£c
(è< (è
age
) {

150  
Œue
;

154 
Ho¡Info
 *
näom
 = 
_ho¡s
.
	`fšdp
(
äom
);

155 ià(!
näom
) {

156 
Ho¡Info
 
foo
 = 
	`Ho¡Info
(
äom
);

157 
_ho¡s
.
	`š£¹
(
äom
, 
foo
);

158 
näom
 = 
_ho¡s
.
	`fšdp
(
äom
);

160 
Ho¡Info
 *
Áo
 = 
_ho¡s
.
	`fšdp
(
to
);

161 ià(!
Áo
) {

162 
_ho¡s
.
	`š£¹
(
to
, 
	`Ho¡Info
(to));

163 
Áo
 = 
_ho¡s
.
	`fšdp
(
to
);

166 
	`as£¹
(
näom
);

167 
	`as£¹
(
Áo
);

169 
IPPaœ
 
p
 = 
	`IPPaœ
(
äom
, 
to
);

170 
LškInfo
 *
Êfo
 = 
_lšks
.
	`fšdp
(
p
);

171 ià(!
Êfo
) {

172 
_lšks
.
	`š£¹
(
p
, 
	`LškInfo
(
äom
, 
to
, 
£q
, 
age
, 
m‘ric
));

174 
Êfo
->
	`upd©e
(
£q
, 
age
, 
m‘ric
);

176  
Œue
;

177 
	}
}

180 
	gLškTabË
::
Lšk


181 
LškTabË
::
	$¿ndom_lšk
()

183 
ndx
 = 
	`şick_¿ndom
(0, 
_lšks
.
	`size
() - 1);

184 
cu¼’t_ndx
 = 0;

185 
LTI‹r
 
™”
 = 
_lšks
.
	`begš
(); i‹r.
	`live
(); i‹r++, 
cu¼’t_ndx
++) {

186 ià(
cu¼’t_ndx
 =ğ
ndx
) {

187 
LškInfo
 
n
 = 
™”
.
	`v®ue
();

188  
	`Lšk
(
n
.
_äom
,‚.
_to
,‚.
_£q
,‚.
_m‘ric
);

191 
	`şick_ch©‹r
("LinkTable %s:„andom_link overestimated‚umber ofƒlements\n",

192 
	`Çme
().
	`c_¡r
());

193  
	`Lšk
();

195 
	}
}

196 
	gVeùÜ
<
	gIPAdd»ss
>

197 
	gLškTabË
::
	$g‘_ho¡s
()

199 
VeùÜ
<
IPAdd»ss
> 
v
;

200 
HTI‹r
 
™”
 = 
_ho¡s
.
	`begš
(); i‹r.
	`live
(); iter++) {

201 
Ho¡Info
 
n
 = 
™”
.
	`v®ue
();

202 
v
.
	`push_back
(
n
.
_
);

204  
v
;

205 
	}
}

207 
ušt32_t


208 
	gLškTabË
::
	$g‘_ho¡_m‘ric_to_me
(
IPAdd»ss
 
s
)

210 ià(!
s
) {

213 
Ho¡Info
 *
nfo
 = 
_ho¡s
.
	`fšdp
(
s
);

214 ià(!
nfo
) {

217  
nfo
->
_m‘ric_to_me
;

218 
	}
}

220 
ušt32_t


221 
	gLškTabË
::
	$g‘_ho¡_m‘ric_äom_me
(
IPAdd»ss
 
s
)

223 ià(!
s
) {

226 
Ho¡Info
 *
nfo
 = 
_ho¡s
.
	`fšdp
(
s
);

227 ià(!
nfo
) {

230  
nfo
->
_m‘ric_äom_me
;

231 
	}
}

233 
ušt32_t


234 
	gLškTabË
::
	$g‘_lšk_m‘ric
(
IPAdd»ss
 
äom
, IPAdd»s 
to
)

236 ià(!
äom
 || !
to
) {

239 ià(
_bÏckli¡
.
	`fšdp
(
äom
è|| _bÏckli¡.fšdp(
to
)) {

242 
IPPaœ
 
p
 = 
	`IPPaœ
(
äom
, 
to
);

243 
LškInfo
 *
nfo
 = 
_lšks
.
	`fšdp
(
p
);

244 ià(!
nfo
) {

247  
nfo
->
_m‘ric
;

248 
	}
}

249 
ušt32_t


250 
	gLškTabË
::
	$g‘_lšk_£q
(
IPAdd»ss
 
äom
, IPAdd»s 
to
)

252 ià(!
äom
 || !
to
) {

255 ià(
_bÏckli¡
.
	`fšdp
(
äom
è|| _bÏckli¡.fšdp(
to
)) {

258 
IPPaœ
 
p
 = 
	`IPPaœ
(
äom
, 
to
);

259 
LškInfo
 *
nfo
 = 
_lšks
.
	`fšdp
(
p
);

260 ià(!
nfo
) {

263  
nfo
->
_£q
;

264 
	}
}

265 
ušt32_t


266 
	gLškTabË
::
	$g‘_lšk_age
(
IPAdd»ss
 
äom
, IPAdd»s 
to
)

268 ià(!
äom
 || !
to
) {

271 ià(
_bÏckli¡
.
	`fšdp
(
äom
è|| _bÏckli¡.fšdp(
to
)) {

274 
IPPaœ
 
p
 = 
	`IPPaœ
(
äom
, 
to
);

275 
LškInfo
 *
nfo
 = 
_lšks
.
	`fšdp
(
p
);

276 ià(!
nfo
) {

279  
nfo
->
	`age
();

280 
	}
}

285 
	gLškTabË
::
g‘_rou‹_m‘ric
(cÚ¡ 
VeùÜ
<
IPAdd»ss
> &
rou‹
)

287 
m‘ric
 = 0;

288 
	gi
 = 0; i < 
	grou‹
.
size
() - 1; i++) {

289 
	gm
 = 
g‘_lšk_m‘ric
(
rou‹
[
i
],„oute[i+1]);

290 ià(
	gm
 == 0) {

293 
	gm‘ric
 +ğ
m
;

295  
	gm‘ric
;

299 
SŒšg


300 
	gLškTabË
::
	$rou‹_to_¡ršg
(
P©h
 
p
) {

301 
SŒšgAccum
 
§
;

302 
hİs
 = 
p
.
	`size
()-1;

303 
m‘ric
 = 0;

304 
SŒšgAccum
 
§2
;

305 
i
 = 0; i < 
p
.
	`size
(); i++) {

306 
§2
 << 
p
[
i
];

307 ià(
i
 !ğ
p
.
	`size
()-1) {

308 
m
 = 
	`g‘_lšk_m‘ric
(
p
[
i
],…[i+1]);

309 
§2
 << " (" << 
m
 << ") ";

310 
m‘ric
 +ğ
m
;

313 
§
 << 
p
[p.
	`size
()-1] << " hİ " << 
hİs
 << " m‘riø" << 
m‘ric
 << " " << 
§2
;

314  
§
.
	`ke_¡ršg
();

315 
	}
}

316 
boŞ


317 
	gLškTabË
::
v®id_rou‹
(cÚ¡ 
VeùÜ
<
IPAdd»ss
> &
rou‹
)

319 ià(
rou‹
.
size
() < 1) {

320  
çl£
;

323 
	gm‘ric
 = 
g‘_rou‹_m‘ric
(
rou‹
);

324 ià(
	gm‘ric
 == 0 ||

325 
m‘ric
 >= 777777){

326  
çl£
;

330 
	gx
 = 0; x < 
	grou‹
.
size
(); x++) {

331 
	gy
 = 
x
 + 1; y < 
	grou‹
.
size
(); y++) {

332 ià(
	grou‹
[
x
] =ğ
rou‹
[
y
]) {

333  
çl£
;

338  
	gŒue
;

340 
	gVeùÜ
<
	gIPAdd»ss
>

341 
	gLškTabË
::
	$be¡_rou‹
(
IPAdd»ss
 
d¡
, 
boŞ
 
äom_me
)

343 
VeùÜ
<
IPAdd»ss
> 
»v”£_rou‹
;

344 ià(!
d¡
) {

345  
»v”£_rou‹
;

347 
Ho¡Info
 *
nfo
 = 
_ho¡s
.
	`fšdp
(
d¡
);

349 ià(
äom_me
) {

350 
nfo
 &&‚fo->
_m‘ric_äom_me
 != 0) {

351 
»v”£_rou‹
.
	`push_back
(
nfo
->
_
);

352 
nfo
 = 
_ho¡s
.
	`fšdp
Òfo->
_´ev_äom_me
);

354 ià(
nfo
 &&‚fo->
_m‘ric_äom_me
 == 0) {

355 
»v”£_rou‹
.
	`push_back
(
nfo
->
_
);

358 
nfo
 &&‚fo->
_m‘ric_to_me
 != 0) {

359 
»v”£_rou‹
.
	`push_back
(
nfo
->
_
);

360 
nfo
 = 
_ho¡s
.
	`fšdp
Òfo->
_´ev_to_me
);

362 ià(
nfo
 &&‚fo->
_m‘ric_to_me
 == 0) {

363 
»v”£_rou‹
.
	`push_back
(
nfo
->
_
);

368 ià(
äom_me
) {

369 
VeùÜ
<
IPAdd»ss
> 
rou‹
;

371 
i
=
»v”£_rou‹
.
	`size
() - 1; i >= 0; i--) {

372 
rou‹
.
	`push_back
(
»v”£_rou‹
[
i
]);

374  
rou‹
;

377  
»v”£_rou‹
;

378 
	}
}

380 
SŒšg


381 
	gLškTabË
::
	$´št_lšks
()

383 
SŒšgAccum
 
§
;

384 
LTI‹r
 
™”
 = 
_lšks
.
	`begš
(); i‹r.
	`live
(); iter++) {

385 
LškInfo
 
n
 = 
™”
.
	`v®ue
();

386 
§
 << 
n
.
_äom
.
	`uÅ¬£
(è<< " " <<‚.
_to
.unparse();

387 
§
 << " " << 
n
.
_m‘ric
;

388 
§
 << " " << 
n
.
_£q
 << " " <<‚.
	`age
() << "\n";

390  
§
.
	`ke_¡ršg
();

391 
	}
}

393 
	$addr_sÜ‹r
(cÚ¡ *
va
, cÚ¡ *
vb
, *) {

394 
IPAdd»ss
 *
a
 = (IPAdd»s *)
va
, *
b
 = (IPAdd»s *)
vb
;

395 ià(
a
->
	`addr
(è=ğ
b
->addr()) {

398  (
	`Áohl
(
a
->
	`addr
()è<‚tohl(
b
->addr())) ? -1 : 1;

399 
	}
}

402 
SŒšg


403 
	gLškTabË
::
	$´št_rou‹s
(
boŞ
 
äom_me
, boŞ 
´‘ty
)

405 
SŒšgAccum
 
§
;

407 
VeùÜ
<
IPAdd»ss
> 
_addrs
;

409 
HTI‹r
 
™”
 = 
_ho¡s
.
	`begš
(); i‹r.
	`live
(); iter++)

410 
_addrs
.
	`push_back
(
™”
.
	`key
());

412 
	`şick_qsÜt
(
_addrs
.
	`begš
(), ip_addrs.
	`size
(), (
IPAdd»ss
), 
addr_sÜ‹r
);

414 
x
 = 0; x < 
_addrs
.
	`size
(); x++) {

415 
IPAdd»ss
 

 = 
_addrs
[
x
];

416 
VeùÜ
 <
IPAdd»ss
> 
r
 = 
	`be¡_rou‹
(

, 
äom_me
);

417 ià(
	`v®id_rou‹
(
r
)) {

418 ià(
´‘ty
) {

419 
§
 << 
	`rou‹_to_¡ršg
(
r
) << "\n";

421 
§
 << 
r
[r.
	`size
()-1] << " ";

422 
a
 = 0;‡ < 
r
.
	`size
();‡++) {

423 
§
 << 
r
[
a
];

424 ià(
a
 < 
r
.
	`size
() - 1) {

425 
§
 << " " << 
	`g‘_lšk_m‘ric
(
r
[
a
],r[a+1]);

426 
§
 << " (" << 
	`g‘_lšk_£q
(
r
[
a
],r[a+1])

427 << "," << 
	`g‘_lšk_age
(
r
[
a
],r[a+1])

431 
§
 << "\n";

435  
§
.
	`ke_¡ršg
();

436 
	}
}

439 
SŒšg


440 
	gLškTabË
::
	$´št_ho¡s
()

442 
SŒšgAccum
 
§
;

443 
VeùÜ
<
IPAdd»ss
> 
_addrs
;

445 
HTI‹r
 
™”
 = 
_ho¡s
.
	`begš
(); i‹r.
	`live
(); iter++)

446 
_addrs
.
	`push_back
(
™”
.
	`key
());

448 
	`şick_qsÜt
(
_addrs
.
	`begš
(), ip_addrs.
	`size
(), (
IPAdd»ss
), 
addr_sÜ‹r
);

450 
x
 = 0; x < 
_addrs
.
	`size
(); x++)

451 
§
 << 
_addrs
[
x
] << "\n";

453  
§
.
	`ke_¡ršg
();

454 
	}
}

459 
	gLškTabË
::
	$ş—r_¡®e
() {

461 
LTabË
 
lšks
;

462 
LTI‹r
 
™”
 = 
_lšks
.
	`begš
(); i‹r.
	`live
(); iter++) {

463 
LškInfo
 
nfo
 = 
™”
.
	`v®ue
();

464 ià((è
_¡®e_timeout
.
	`£c
(è>ğ
nfo
.
	`age
()) {

465 
lšks
.
	`š£¹
(
	`IPPaœ
(
nfo
.
_äom
,‚fo.
_to
),‚fo);

468 
	`şick_ch©‹r
("%p{element} :: %s„emoving†ink %s -> %s metric %d seq %d‡ge %d\n",

469 
this
,

470 
__func__
,

471 
nfo
.
_äom
.
	`uÅ¬£
().
	`c_¡r
(),

472 
nfo
.
_to
.
	`uÅ¬£
().
	`c_¡r
(),

473 
nfo
.
_m‘ric
,

474 
nfo
.
_£q
,

475 
nfo
.
	`age
());

479 
_lšks
.
	`ş—r
();

481 
LTI‹r
 
™”
 = 
lšks
.
	`begš
(); i‹r.
	`live
(); iter++) {

482 
LškInfo
 
nfo
 = 
™”
.
	`v®ue
();

483 
_lšks
.
	`š£¹
(
	`IPPaœ
(
nfo
.
_äom
,‚fo.
_to
),‚fo);

486 
	}
}

488 
	gVeùÜ
<
	gIPAdd»ss
>

489 
	gLškTabË
::
	$g‘_ÃighbÜs
(
IPAdd»ss
 

)

491 
VeùÜ
<
IPAdd»ss
> 
ÃighbÜs
;

493 
HashM­
<
	tIPAdd»ss
, 
	tboŞ
> 
	tIPM­
;

494 
IPM­
 
_addrs
;

496 
HTI‹r
 
™”
 = 
_ho¡s
.
	`begš
(); i‹r.
	`live
(); iter++) {

497 
_addrs
.
	`š£¹
(
™”
.
	`v®ue
().
_
, 
Œue
);

500 
IPM­
::
cÚ¡_™”©Ü
 
i
 = 
_addrs
.
	`begš
(); i.
	`live
(); i++) {

501 
Ho¡Info
 *
ÃighbÜ
 = 
_ho¡s
.
	`fšdp
(
i
.
	`key
());

502 
	`as£¹
(
ÃighbÜ
);

503 ià(

 !ğ
ÃighbÜ
->
_
) {

504 
LškInfo
 *
Êfo
 = 
_lšks
.
	`fšdp
(
	`IPPaœ
(

, 
ÃighbÜ
->
_
));

505 ià(
Êfo
) {

506 
ÃighbÜs
.
	`push_back
(
ÃighbÜ
->
_
);

512  
ÃighbÜs
;

513 
	}
}

515 
	gLškTabË
::
	$dijk¡¿
(
boŞ
 
äom_me
)

517 
Time¡amp
 
¡¬t
 = Time¡amp::
	`now
();

518 
IPAdd»ss
 
¤c
 = 
_
;

520 
HashM­
<
	tIPAdd»ss
, 
	tboŞ
> 
	tIPM­
;

521 
IPM­
 
_addrs
;

523 
HTI‹r
 
™”
 = 
_ho¡s
.
	`begš
(); i‹r.
	`live
(); iter++) {

524 
_addrs
.
	`š£¹
(
™”
.
	`v®ue
().
_
, 
Œue
);

527 
IPM­
::
cÚ¡_™”©Ü
 
i
 = 
_addrs
.
	`begš
(); i.
	`live
(); i++) {

529 
Ho¡Info
 *
n
 = 
_ho¡s
.
	`fšdp
(
i
.
	`key
());

530 
n
->
	`ş—r
(
äom_me
);

532 
Ho¡Info
 *
roÙ_šfo
 = 
_ho¡s
.
	`fšdp
(
¤c
);

535 
	`as£¹
(
roÙ_šfo
);

537 ià(
äom_me
) {

538 
roÙ_šfo
->
_´ev_äom_me
 =„oÙ_šfo->
_
;

539 
roÙ_šfo
->
_m‘ric_äom_me
 = 0;

541 
roÙ_šfo
->
_´ev_to_me
 =„oÙ_šfo->
_
;

542 
roÙ_šfo
->
_m‘ric_to_me
 = 0;

545 
IPAdd»ss
 
cu¼’t_mš_
 = 
roÙ_šfo
->
_
;

547 
cu¼’t_mš_
) {

548 
Ho¡Info
 *
cu¼’t_mš
 = 
_ho¡s
.
	`fšdp
(
cu¼’t_mš_
);

549 
	`as£¹
(
cu¼’t_mš
);

550 ià(
äom_me
) {

551 
cu¼’t_mš
->
_m¬ked_äom_me
 = 
Œue
;

553 
cu¼’t_mš
->
_m¬ked_to_me
 = 
Œue
;

557 
IPM­
::
cÚ¡_™”©Ü
 
i
 = 
_addrs
.
	`begš
(); i.
	`live
(); i++) {

558 
Ho¡Info
 *
ÃighbÜ
 = 
_ho¡s
.
	`fšdp
(
i
.
	`key
());

559 
	`as£¹
(
ÃighbÜ
);

560 
boŞ
 
m¬ked
 = 
ÃighbÜ
->
_m¬ked_to_me
;

561 ià(
äom_me
) {

562 
m¬ked
 = 
ÃighbÜ
->
_m¬ked_äom_me
;

565 ià(
m¬ked
) {

569 
IPPaœ
 
·œ
 = 
	`IPPaœ
(
ÃighbÜ
->
_
, 
cu¼’t_mš_
);

570 ià(
äom_me
) {

571 
·œ
 = 
	`IPPaœ
(
cu¼’t_mš_
, 
ÃighbÜ
->
_
);

573 
LškInfo
 *
Êfo
 = 
_lšks
.
	`fšdp
(
·œ
);

574 ià(!
Êfo
 || !Êfo->
_m‘ric
) {

577 
ušt32_t
 
ÃighbÜ_m‘ric
 = 
ÃighbÜ
->
_m‘ric_to_me
;

578 
ušt32_t
 
cu¼’t_m‘ric
 = 
cu¼’t_mš
->
_m‘ric_to_me
;

580 ià(
äom_me
) {

581 
ÃighbÜ_m‘ric
 = 
ÃighbÜ
->
_m‘ric_äom_me
;

582 
cu¼’t_m‘ric
 = 
cu¼’t_mš
->
_m‘ric_äom_me
;

586 
ušt32_t
 
adju¡ed_m‘ric
 = 
cu¼’t_m‘ric
 + 
Êfo
->
_m‘ric
;

587 ià(!
ÃighbÜ_m‘ric
 ||

588 
adju¡ed_m‘ric
 < 
ÃighbÜ_m‘ric
) {

589 ià(
äom_me
) {

590 
ÃighbÜ
->
_m‘ric_äom_me
 = 
adju¡ed_m‘ric
;

591 
ÃighbÜ
->
_´ev_äom_me
 = 
cu¼’t_mš_
;

593 
ÃighbÜ
->
_m‘ric_to_me
 = 
adju¡ed_m‘ric
;

594 
ÃighbÜ
->
_´ev_to_me
 = 
cu¼’t_mš_
;

600 
cu¼’t_mš_
 = 
	`IPAdd»ss
();

601 
ušt32_t
 
mš_m‘ric
 = ~0;

602 
IPM­
::
cÚ¡_™”©Ü
 
i
 = 
_addrs
.
	`begš
(); i.
	`live
(); i++) {

603 
Ho¡Info
 *
nfo
 = 
_ho¡s
.
	`fšdp
(
i
.
	`key
());

604 
ušt32_t
 
m‘ric
 = 
nfo
->
_m‘ric_to_me
;

605 
boŞ
 
m¬ked
 = 
nfo
->
_m¬ked_to_me
;

606 ià(
äom_me
) {

607 
m‘ric
 = 
nfo
->
_m‘ric_äom_me
;

608 
m¬ked
 = 
nfo
->
_m¬ked_äom_me
;

610 ià(!
m¬ked
 && 
m‘ric
 &&

611 
m‘ric
 < 
mš_m‘ric
) {

612 
cu¼’t_mš_
 = 
nfo
->
_
;

613 
mš_m‘ric
 = 
m‘ric
;

620 
dijk¡¿_time
 = 
Time¡amp
::
	`now
(è- 
¡¬t
;

624 
	}
}

627 ’um {
	mH_BLACKLIST
,

628 
	mH_BLACKLIST_CLEAR
,

629 
	mH_BLACKLIST_ADD
,

630 
	mH_BLACKLIST_REMOVE
,

631 
	mH_LINKS
,

632 
	mH_ROUTES_OLD
,

633 
	mH_ROUTES_FROM
,

634 
	mH_ROUTES_TO
,

635 
	mH_HOSTS
,

636 
	mH_CLEAR
,

637 
	mH_DIJKSTRA
,

638 
	mH_DIJKSTRA_TIME
};

640 
SŒšg


641 
	$LškTabË_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

643 
LškTabË
 *
td
 = (LškTabË *)
e
;

644 (
ušŒ_t
è
thunk
) {

645 
H_BLACKLIST
: {

646 
SŒšgAccum
 
§
;

647 
HashM­
<
	tIPAdd»ss
, IPAdd»ss> 
	tIPTabË
;

648 
IPTabË
::
	tcÚ¡_™”©Ü
 
	tIPI‹r
;

651 
IPI‹r
 
™”
 = 
td
->
_bÏckli¡
.
	`begš
(); i‹r.
	`live
(); iter++) {

652 
§
 << 
™”
.
	`v®ue
() << " ";

654  
§
.
	`ke_¡ršg
() + "\n";

656 
H_LINKS
:  
td
->
	`´št_lšks
();

657 
H_ROUTES_TO
:  
td
->
	`´št_rou‹s
(
çl£
, 
Œue
);

658 
H_ROUTES_FROM
:  
td
->
	`´št_rou‹s
(
Œue
,rue);

659 
H_ROUTES_OLD
:  
td
->
	`´št_rou‹s
(
Œue
, 
çl£
);

660 
H_HOSTS
:  
td
->
	`´št_ho¡s
();

661 
H_DIJKSTRA_TIME
: {

662 
SŒšgAccum
 
§
;

663 
§
 << 
td
->
dijk¡¿_time
 << "\n";

664  
§
.
	`ke_¡ršg
();

667  
	`SŒšg
();

669 
	}
}

671 
	$LškTabË_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

672 
E¼ÜHªdËr
 *
”rh
)

674 
LškTabË
 *
f
 = (LškTabË *)
e
;

675 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

676 (
šŒ_t
)
v·¿m
) {

677 
H_BLACKLIST_CLEAR
: {

678 
f
->
_bÏckli¡
.
	`ş—r
();

681 
H_BLACKLIST_ADD
: {

682 
IPAdd»ss
 
m
;

683 ià(!
	`IPAdd»ssArg
().
	`·r£
(
s
, 
m
))

684  
”rh
->
	`”rÜ
("blacklist_add…arameter must be ipaddress");

685 
f
->
_bÏckli¡
.
	`š£¹
(
m
, m);

688 
H_BLACKLIST_REMOVE
: {

689 
IPAdd»ss
 
m
;

690 ià(!
	`IPAdd»ssArg
().
	`·r£
(
s
, 
m
))

691  
”rh
->
	`”rÜ
("blacklist_add…arameter must be ipaddress");

692 
f
->
_bÏckli¡
.
	`”a£
(
m
);

695 
H_CLEAR
: 
f
->
	`ş—r
(); ;

696 
H_DIJKSTRA
: 
f
->
	`dijk¡¿
(
Œue
); f->dijk¡¿(
çl£
); ;

699 
	}
}

703 
	gLškTabË
::
	$add_hªdËrs
() {

704 
	`add_»ad_hªdËr
("rou‹s", 
LškTabË_»ad_·¿m
, 
H_ROUTES_FROM
);

705 
	`add_»ad_hªdËr
("rou‹s_Şd", 
LškTabË_»ad_·¿m
, 
H_ROUTES_OLD
);

706 
	`add_»ad_hªdËr
("rou‹s_äom", 
LškTabË_»ad_·¿m
, 
H_ROUTES_FROM
);

707 
	`add_»ad_hªdËr
("rou‹s_to", 
LškTabË_»ad_·¿m
, 
H_ROUTES_TO
);

708 
	`add_»ad_hªdËr
("lšks", 
LškTabË_»ad_·¿m
, 
H_LINKS
);

709 
	`add_»ad_hªdËr
("ho¡s", 
LškTabË_»ad_·¿m
, 
H_HOSTS
);

710 
	`add_»ad_hªdËr
("bÏckli¡", 
LškTabË_»ad_·¿m
, 
H_BLACKLIST
);

711 
	`add_»ad_hªdËr
("dijk¡¿_time", 
LškTabË_»ad_·¿m
, 
H_DIJKSTRA_TIME
);

713 
	`add_wr™e_hªdËr
("ş—r", 
LškTabË_wr™e_·¿m
, 
H_CLEAR
);

714 
	`add_wr™e_hªdËr
("bÏckli¡_ş—r", 
LškTabË_wr™e_·¿m
, 
H_BLACKLIST_CLEAR
);

715 
	`add_wr™e_hªdËr
("bÏckli¡_add", 
LškTabË_wr™e_·¿m
, 
H_BLACKLIST_ADD
);

716 
	`add_wr™e_hªdËr
("bÏckli¡_»move", 
LškTabË_wr™e_·¿m
, 
H_BLACKLIST_REMOVE
);

717 
	`add_wr™e_hªdËr
("dijk¡¿", 
LškTabË_wr™e_·¿m
, 
H_DIJKSTRA
);

720 
	`add_wr™e_hªdËr
("upd©e_lšk", 
¡©ic_upd©e_lšk
, 0);

723 
	}
}

725 
	$EXPORT_ELEMENT
(
LškTabË
)

726 
CLICK_ENDDECLS


	@wifi/linktable.hh

1 #iâdeà
CLICK_LINKTABLE_HH


2 
	#CLICK_LINKTABLE_HH


	)

3 
	~<şick/add»ss.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/tim”.hh
>

6 
	~<şick/–em’t.hh
>

7 
	~<şick/bighashm­.hh
>

8 
	~<şick/hashm­.hh
>

9 
	~"·th.hh
"

10 
CLICK_DECLS


23 şas 
	cIPPaœ
 {

24 
	mpublic
:

26 
IPAdd»ss
 
_to
;

27 
IPAdd»ss
 
	m_äom
;

29 
	$IPPaœ
()

30 : 
	`_to
(), 
	$_äom
() {

33 
	$IPPaœ
(
IPAdd»ss
 
äom
, IPAdd»s 
to
)

34 : 
	`_to
(
to
), 
	$_äom
(
äom
) {

35 
	}
}

37 
boŞ
 
	$cÚšs
(
IPAdd»ss
 
foo
) const {

38  (
foo
 =ğ
_to
è|| (foØ=ğ
_äom
);

39 
	}
}

41 
boŞ
 
	$Ùh”
(
IPAdd»ss
 
foo
) const {

42  (
_to
 =ğ
foo
è? 
_äom
 : _to;

43 
	}
}

45 
šlše
 
hashcode_t
 
	$hashcode
() const {

46  
	`CLICK_NAME
(
hashcode
)(
_to
è+ CLICK_NAME(hashcode)(
_äom
);

47 
	}
}

49 
šlše
 
boŞ
 
	gİ”©Ü
==(
IPPaœ
 
Ùh”
) const {

50  (
Ùh”
.
_to
 =ğ_tØ&& oth”.
_äom
 == _from);

56 şas 
	cLškTabË
: 
public
 
EËm’t
{

57 
public
:

60 
	$LškTabË
(è
CLICK_COLD
;

61 ~
	$LškTabË
(è
CLICK_COLD
;

62 
	$add_hªdËrs
(è
CLICK_COLD
;

63 cÚ¡ * 
	$şass_Çme
() const {  "LinkTable"; }

64 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

65 
	`run_tim”
(
Tim”
 *);

66 
	`cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
è
CLICK_COLD
;

67 
	`ke_¡©e
(
EËm’t
 *, 
E¼ÜHªdËr
 *);

68 *
	`ÿ¡
(cÚ¡ *
n
);

70 
SŒšg
 
	`´št_rou‹s
(
boŞ
, bool);

71 
SŒšg
 
	`´št_lšks
();

72 
SŒšg
 
	`´št_ho¡s
();

74 
	`¡©ic_upd©e_lšk
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
e
,

75 *, 
E¼ÜHªdËr
 *
”rh
);

76 
	`ş—r
();

79 
SŒšg
 
	`rou‹_to_¡ršg
(
P©h
 
p
);

80 
boŞ
 
	`upd©e_lšk
(
IPAdd»ss
 
äom
, IPAdd»s 
to
,

81 
ušt32_t
 
£q
, ušt32_ˆ
age
, ušt32_ˆ
m‘ric
);

82 
boŞ
 
	$upd©e_bÙh_lšks
(
IPAdd»ss
 
a
, IPAdd»s 
b
,

83 
ušt32_t
 
£q
, ušt32_ˆ
age
, ušt32_ˆ
m‘ric
) {

84 ià(
	`upd©e_lšk
(
a
,
b
,
£q
,
age
, 
m‘ric
)) {

85  
	`upd©e_lšk
(
b
,
a
,
£q
,
age
, 
m‘ric
);

87  
çl£
;

88 
	}
}

90 
ušt32_t
 
g‘_lšk_m‘ric
(
IPAdd»ss
 
äom
, IPAdd»s 
to
);

91 
ušt32_t
 
g‘_lšk_£q
(
IPAdd»ss
 
äom
, IPAdd»s 
to
);

92 
ušt32_t
 
g‘_lšk_age
(
IPAdd»ss
 
äom
, IPAdd»s 
to
);

93 
boŞ
 
v®id_rou‹
(cÚ¡ 
VeùÜ
<
IPAdd»ss
> &
rou‹
);

94 
g‘_rou‹_m‘ric
(cÚ¡ 
VeùÜ
<
IPAdd»ss
> &
rou‹
);

95 
	gVeùÜ
<
	gIPAdd»ss
> 
g‘_ÃighbÜs
(
IPAdd»ss
 

);

96 
dijk¡¿
(
boŞ
);

97 
ş—r_¡®e
();

98 
	gVeùÜ
<
	gIPAdd»ss
> 
be¡_rou‹
(
IPAdd»ss
 
d¡
, 
boŞ
 
äom_me
);

100 
	gVeùÜ
< VeùÜ<
	gIPAdd»ss
> > 
tİ_n_rou‹s
(
IPAdd»ss
 
d¡
, 
n
);

101 
ušt32_t
 
g‘_ho¡_m‘ric_to_me
(
IPAdd»ss
 
s
);

102 
ušt32_t
 
g‘_ho¡_m‘ric_äom_me
(
IPAdd»ss
 
s
);

103 
	gVeùÜ
<
	gIPAdd»ss
> 
g‘_ho¡s
();

105 şas 
	cLšk
 {

106 
	gpublic
:

107 
IPAdd»ss
 
_äom
;

108 
IPAdd»ss
 
	g_to
;

109 
ušt32_t
 
	g_£q
;

110 
ušt32_t
 
	g_m‘ric
;

111 
Lšk
(è: 
_äom
(), 
_to
(), 
_£q
(0), 
_m‘ric
(0) { }

112 
Lšk
(
IPAdd»ss
 
äom
, IPAdd»s 
to
, 
ušt32_t
 
£q
, ušt32_ˆ
m‘ric
) {

113 
	g_äom
 = 
äom
;

114 
	g_to
 = 
to
;

115 
	g_£q
 = 
£q
;

116 
	g_m‘ric
 = 
m‘ric
;

120 
Lšk
 
¿ndom_lšk
();

123 
	gHashM­
<
	tIPAdd»ss
, IPAdd»ss> 
	tIPTabË
;

124 
	gIPTabË
::
	tcÚ¡_™”©Ü
 
	tIPI‹r
;

126 
IPTabË
 
	g_bÏckli¡
;

128 
Time¡amp
 
	gdijk¡¿_time
;

129 
	g´Ùeùed
:

130 şas 
	cLškInfo
 {

131 
public
:

132 
IPAdd»ss
 
_äom
;

133 
IPAdd»ss
 
	g_to
;

134 
	g_m‘ric
;

135 
ušt32_t
 
	g_£q
;

136 
ušt32_t
 
	g_age
;

137 
Time¡amp
 
	g_Ï¡_upd©ed
;

138 
LškInfo
() {

139 
	g_äom
 = 
IPAdd»ss
();

140 
	g_to
 = 
IPAdd»ss
();

141 
	g_m‘ric
 = 0;

142 
	g_£q
 = 0;

143 
	g_age
 = 0;

146 
LškInfo
(
IPAdd»ss
 
äom
, IPAdd»s 
to
,

147 
ušt32_t
 
£q
, ušt32_ˆ
age
, 
m‘ric
) {

148 
	g_äom
 = 
äom
;

149 
	g_to
 = 
to
;

150 
	g_m‘ric
 = 
m‘ric
;

151 
	g_£q
 = 
£q
;

152 
	g_age
 = 
age
;

153 
	g_Ï¡_upd©ed
.
assign_now
();

156 
LškInfo
(cÚ¡ LškInfØ&
p
) :

157 
_äom
(
p
._äom), 
_to
(p._to),

158 
_m‘ric
(
p
._m‘ric), 
_£q
(p._seq),

159 
_age
(
p
._age),

160 
_Ï¡_upd©ed
(
p
._last_updated)

163 
ušt32_t
 
age
() {

164 
Time¡amp
 
	gnow
 = Time¡amp::
now
();

165  
	g_age
 + (
	gnow
.
£c
(è- 
	g_Ï¡_upd©ed
.sec());

167 
upd©e
(
ušt32_t
 
£q
, ušt32_ˆ
age
, 
m‘ric
) {

168 ià(
	g£q
 <ğ
_£q
) {

171 
	g_m‘ric
 = 
m‘ric
;

172 
	g_£q
 = 
£q
;

173 
	g_age
 = 
age
;

174 
	g_Ï¡_upd©ed
.
assign_now
();

179 şas 
	cHo¡Info
 {

180 
	gpublic
:

181 
IPAdd»ss
 
_
;

182 
ušt32_t
 
	g_m‘ric_äom_me
;

183 
ušt32_t
 
	g_m‘ric_to_me
;

185 
IPAdd»ss
 
	g_´ev_äom_me
;

186 
IPAdd»ss
 
	g_´ev_to_me
;

188 
boŞ
 
	g_m¬ked_äom_me
;

189 
boŞ
 
	g_m¬ked_to_me
;

191 
Ho¡Info
(
IPAdd»ss
 
p
 = IPAddress()) {

192 
_
 = 
p
;

193 
	g_m‘ric_äom_me
 = 0;

194 
	g_m‘ric_to_me
 = 0;

195 
	g_´ev_äom_me
 = 
IPAdd»ss
();

196 
	g_´ev_to_me
 = 
IPAdd»ss
();

197 
	g_m¬ked_äom_me
 = 
çl£
;

198 
	g_m¬ked_to_me
 = 
çl£
;

201 
Ho¡Info
(cÚ¡ Ho¡InfØ&
p
) :

202 
_
(
p
._ip),

203 
_m‘ric_äom_me
(
p
._metric_from_me),

204 
_m‘ric_to_me
(
p
._metric_to_me),

205 
_´ev_äom_me
(
p
._prev_from_me),

206 
_´ev_to_me
(
p
._prev_to_me),

207 
_m¬ked_äom_me
(
p
._marked_from_me),

208 
_m¬ked_to_me
(
p
._marked_to_me)

211 
ş—r
(
boŞ
 
äom_me
) {

212 ià(
	gäom_me
 ) {

213 
	g_´ev_äom_me
 = 
IPAdd»ss
();

214 
	g_m‘ric_äom_me
 = 0;

215 
	g_m¬ked_äom_me
 = 
çl£
;

217 
	g_´ev_to_me
 = 
IPAdd»ss
();

218 
	g_m‘ric_to_me
 = 0;

219 
	g_m¬ked_to_me
 = 
çl£
;

225 
	gHashM­
<
	tIPAdd»ss
, 
	tHo¡Info
> 
	tHTabË
;

226 
	gHTabË
::
	tcÚ¡_™”©Ü
 
	tHTI‹r
;

229 
	gHashM­
<
	tIPPaœ
, 
	tLškInfo
> 
	tLTabË
;

230 
	gLTabË
::
	tcÚ¡_™”©Ü
 
	tLTI‹r
;

232 
HTabË
 
	g_ho¡s
;

233 
LTabË
 
	g_lšks
;

236 
IPAdd»ss
 
	g_
;

237 
Time¡amp
 
	g_¡®e_timeout
;

238 
Tim”
 
	g_tim”
;

243 
	gCLICK_ENDDECLS


	@wifi/madwifirate.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şickÃt/‘h”.h
>

25 
	~<şickÃt/wifi.h
>

26 
	~<–em’ts/wifi/avaabË¿‹s.hh
>

27 
	~"madwifœ©e.hh
"

28 
	gCLICK_DECLS


30 
	#CREDITS_FOR_RAISE
 10

	)

31 
	#STEPUP_RETRY_THRESHOLD
 10

	)

33 
	gMadwifiR©e
::
	$MadwifiR©e
()

34 : 
	`_¡•up
(0),

35 
	`_¡•down
(0),

36 
	`_off£t
(0),

37 
	`_tim”
(
this
),

38 
	$_·ck‘_size_th»shŞd
(0)

42 
bÿ¡_addr
[] = { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff };

43 
_bÿ¡
 = 
	`Eth”Add»ss
(
bÿ¡_addr
);

44 
	}
}

48 
	gMadwifiR©e
::
	$run_tim”
(
Tim”
 *)

50 
_tim”
.
	`scheduË_aá”_m£c
(
_³riod
);

51 
	`adju¡_®l
();

53 
	}
}

54 
	gMadwifiR©e
::~
	$MadwifiR©e
()

56 
	}
}

59 
MadwifiR©e
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *)

61 
_tim”
.
	`š™Ÿlize
(
this
);

62 
_tim”
.
	`scheduË_now
();

64 
	}
}

66 
	gMadwifiR©e
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

68 
	g_®t_¿‹
 = 
çl£
;

69 
	g_aùive
 = 
Œue
;

70 
	g_³riod
 = 1000;

71 
	g»t
 = 
Args
(
cÚf
, 
this
, 
”rh
)

72 .
»ad
("OFFSET", 
_off£t
)

73 .
»ad
("RT", 
EËm’tCa¡Arg
("AvaabËR©es"), 
_¹abË
)

74 .
»ad
("THRESHOLD", 
_·ck‘_size_th»shŞd
)

75 .
»ad
("ALT_RATE", 
_®t_¿‹
)

76 .
»ad
("ACTIVE", 
_aùive
)

77 .
»ad
("PERIOD", 
_³riod
)

78 .
com¶‘e
();

79  
	g»t
;

83 
	gMadwifiR©e
::
	$adju¡_®l
()

85 
VeùÜ
<
Eth”Add»ss
> 
n
;

86 
NI‹r
 
™”
 = 
_ÃighbÜs
.
	`begš
(); i‹r.
	`live
(); iter++) {

87 
D¡Info
 
nfo
 = 
™”
.
	`v®ue
();

88 
n
.
	`push_back
(
nfo
.
_‘h
);

91 
x
 =0; x < 
n
.
	`size
(); x++) {

92 
	`adju¡
(
n
[
x
]);

95 
	}
}

98 
	gMadwifiR©e
::
	$adju¡
(
Eth”Add»ss
 
d¡
)

100 
D¡Info
 *
nfo
 = 
_ÃighbÜs
.
	`fšdp
(
d¡
);

101 
boŞ
 
¡•up
 = 
çl£
;

102 
boŞ
 
¡•down
 = 
çl£
;

103 ià(
nfo
->
_çu»s
 > 0 &&‚fo->
_sucûs£s
 == 0) {

104 
¡•down
 = 
Œue
;

107 
boŞ
 
’ough
 = (
nfo
->
_sucûs£s
 +‚fo->
_çu»s
) > 10;

110 ià(
’ough
 && 
nfo
->
_sucûs£s
 <‚fo->
_»Œ›s
)

111 
¡•down
 = 
Œue
;

114 ià(
’ough
 && 
nfo
->
_çu»s
 == 0 &&

115 
nfo
->
_»Œ›s
 < (nfo->
_sucûs£s
 * 
STEPUP_RETRY_THRESHOLD
) / 100)

116 
¡•up
 = 
Œue
;

118 ià(
¡•down
) {

119 ià(
_debug
 && 
	`WIFI_MAX
(
nfo
->
_cu¼’t_šdex
 - 1, 0) !=‚fo->_current_index) {

120 
	`şick_ch©‹r
("%p{element} stepping down for %s from %do %d\n",

121 
this
,

122 
nfo
->
_‘h
.
	`uÅ¬£
().
	`c_¡r
(),

123 
nfo
->
_¿‹s
[nfo->
_cu¼’t_šdex
],

124 
nfo
->
_¿‹s
[
	`WIFI_MAX
(0,‚fo->
_cu¼’t_šdex
 - 1)]);

126 
nfo
->
_cu¼’t_šdex
 = 
	`WIFI_MAX
(nfo->_current_index - 1, 0);

127 
nfo
->
_üed™s
 = 0;

128 } ià(
¡•up
) {

129 
nfo
->
_üed™s
++;

130 ià(
nfo
->
_üed™s
 >ğ
CREDITS_FOR_RAISE
) {

131 ià(
_debug
) {

132 
	`şick_ch©‹r
("%p{element} steping up for %s from %do %d\n",

133 
this
,

134 
nfo
->
_‘h
.
	`uÅ¬£
().
	`c_¡r
(),

135 
nfo
->
_¿‹s
[nfo->
_cu¼’t_šdex
],

136 
nfo
->
_¿‹s
[
	`WIFI_MIN
Òfo->_¿‹s.
	`size
() - 1,

137 
nfo
->
_cu¼’t_šdex
 + 1)]);

139 
nfo
->
_cu¼’t_šdex
 = 
	`WIFI_MIN
Òfo->_cu¼’t_šdex + 1,‚fo->
_¿‹s
.
	`size
() - 1);

140 
nfo
->
_üed™s
 = 0;

143 ià(
’ough
 && 
nfo
->
_üed™s
 > 0) {

144 
nfo
->
_üed™s
--;

147 
nfo
->
_sucûs£s
 = 0;

148 
nfo
->
_çu»s
 = 0;

149 
nfo
->
_»Œ›s
 = 0;

154 
	}
}

157 
	gMadwifiR©e
::
	$´oûss_ãedback
(
Pack‘
 *
p_š
)

159 ià(!
p_š
) {

160 
	`şick_ch©‹r
("%p{element} bad…acket %s\n",

161 
this
,

162 
__func__
);

165 
ušt8_t
 *
d¡_±r
 = (ušt8_ˆ*è
p_š
->
	`d©a
(è+ 
_off£t
;

166 
Eth”Add»ss
 
d¡
 = 
	`Eth”Add»ss
(
d¡_±r
);

168 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p_š
);

169 
boŞ
 
sucûss
 = !(
ûh
->
æags
 & 
WIFI_EXTRA_TX_FAIL
);

170 
boŞ
 
u£d_®t_¿‹
 = 
ûh
->
æags
 & 
WIFI_EXTRA_TX_USED_ALT_RATE
;

172 ià(
d¡
.
	`is_group
(è|| !
ûh
->
¿‹
 ||

173 (
sucûss
 && 
p_š
->
	`Ëngth
(è< 
_·ck‘_size_th»shŞd
)) {

177 
D¡Info
 *
nfo
 = 
_ÃighbÜs
.
	`fšdp
(
d¡
);

178 ià(!
nfo
 ||‚fo->
	`pick_¿‹
(è!ğ
ûh
->
¿‹
) {

182 ià(!
sucûss
 && 
_debug
) {

183 
	`şick_ch©‹r
("%p{element}…acket failed %s success %d„ate %d‡lt %d\n",

184 
this
,

185 
d¡
.
	`uÅ¬£
().
	`c_¡r
(),

186 
sucûss
,

187 
ûh
->
¿‹
,

188 
ûh
->
¿‹1


193 ià(
sucûss
 && (!
_®t_¿‹
 || !
u£d_®t_¿‹
)) {

194 
nfo
->
_sucûs£s
++;

195 
nfo
->
_»Œ›s
 +ğ
ûh
->
»Œ›s
;

197 
nfo
->
_çu»s
++;

198 
nfo
->
_»Œ›s
 += 4;

202 
	}
}

206 
	gMadwifiR©e
::
	$assign_¿‹
(
Pack‘
 *
p_š
)

208 ià(!
p_š
) {

209 
	`şick_ch©‹r
("%p{element}‡h, !p_in\n",

210 
this
);

214 
ušt8_t
 *
d¡_±r
 = (ušt8_ˆ*è
p_š
->
	`d©a
(è+ 
_off£t
;

215 
Eth”Add»ss
 
d¡
 = 
	`Eth”Add»ss
(
d¡_±r
);

216 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p_š
);

219 ià(
d¡
.
	`is_group
()) {

220 
VeùÜ
<> 
¿‹s
 = 
_¹abË
->
	`lookup
(
_bÿ¡
);

221 ià(
¿‹s
.
	`size
()) {

222 
ûh
->
¿‹
 = 
¿‹s
[0];

224 
ûh
->
¿‹
 = 2;

228 
D¡Info
 *
nfo
 = 
_ÃighbÜs
.
	`fšdp
(
d¡
);

229 ià(!
nfo
 || !nfo->
_¿‹s
.
	`size
()) {

230 
VeùÜ
<> 
¿‹s
 = 
_¹abË
->
	`lookup
(
d¡
);

231 ià(!
¿‹s
.
	`size
()) {

234 
_ÃighbÜs
.
	`š£¹
(
d¡
, 
	`D¡Info
(dst));

235 
nfo
 = 
_ÃighbÜs
.
	`fšdp
(
d¡
);

236 
nfo
->
_¿‹s
 = 
¿‹s
;

237 
nfo
->
_sucûs£s
 = 0;

238 
nfo
->
_»Œ›s
 = 0;

239 
nfo
->
_çu»s
 = 0;

241 
ndx
 = 
nfo
->
	`¿‹_šdex
(48);

242 
ndx
 =‚dx > 0 ?‚dx : 
nfo
->
	`¿‹_šdex
(22);

243 
ndx
 = 
	`WIFI_MAX
(ndx, 0);

244 
nfo
->
_cu¼’t_šdex
 = 
ndx
;

245 
nfo
->
_üed™s
 = 0;

246 ià(
_debug
) {

247 
	`şick_ch©‹r
("%p{element} initial„ate for %s is %d\n",

248 
this
,

249 
nfo
->
_‘h
.
	`uÅ¬£
().
	`c_¡r
(),

250 
nfo
->
_¿‹s
[nfo->
_cu¼’t_šdex
]);

254 
ûh
->
magic
 = 
WIFI_EXTRA_MAGIC
;

255 
ndx
 = 
nfo
->
_cu¼’t_šdex
;

256 
ûh
->
¿‹
 = 
nfo
->
_¿‹s
[
ndx
];

257 
ûh
->
¿‹1
 = (
ndx
 - 1 >ğ0è? 
nfo
->
_¿‹s
[
	`WIFI_MAX
(ndx - 1, 0)] : 0;

258 
ûh
->
¿‹2
 = (
ndx
 - 2 >ğ0è? 
nfo
->
_¿‹s
[
	`WIFI_MAX
(ndx - 2, 0)] : 0;

259 
ûh
->
¿‹3
 = (
ndx
 - 3 >ğ0è? 
nfo
->
_¿‹s
[
	`WIFI_MAX
(ndx - 3, 0)] : 0;

261 
ûh
->
max_Œ›s
 = 4;

262 
ûh
->
max_Œ›s1
 = (
ndx
 - 1 >= 0) ? 2 : 0;

263 
ûh
->
max_Œ›s2
 = (
ndx
 - 2 >= 0) ? 2 : 0;

264 
ûh
->
max_Œ›s3
 = (
ndx
 - 3 >= 0) ? 2 : 0;

268 
	}
}

271 
Pack‘
 *

272 
	gMadwifiR©e
::
	$puÎ
(
pÜt
)

274 
Pack‘
 *
p
 = 
	`šput
(
pÜt
).
	`puÎ
();

275 ià(
p
 && 
_aùive
) {

276 
	`assign_¿‹
(
p
);

278  
p
;

279 
	}
}

282 
	gMadwifiR©e
::
	$push
(
pÜt
, 
Pack‘
 *
p_š
)

284 ià(!
p_š
) {

288 ià(
_aùive
) {

289 ià(
pÜt
 != 0) {

290 
	`´oûss_ãedback
(
p_š
);

292 
	`assign_¿‹
(
p_š
);

295 
	`checked_ouut_push
(
pÜt
, 
p_š
);

296 
	}
}

299 
SŒšg


300 
	gMadwifiR©e
::
	$´št_¿‹s
()

302 
SŒšgAccum
 
§
;

303 
NI‹r
 
™”
 = 
_ÃighbÜs
.
	`begš
(); i‹r.
	`live
(); iter++) {

304 
D¡Info
 
nfo
 = 
™”
.
	`v®ue
();

305 
§
 << 
nfo
.
_‘h
 << " ";

306 ià(
nfo
.
_¿‹s
.
	`size
()) {

307 
§
 << 
nfo
.
_¿‹s
[nfo.
_cu¼’t_šdex
];

308 
§
 << " sucûs£ " << 
nfo
.
_sucûs£s
;

309 
§
 << " fau» " << 
nfo
.
_çu»s
;

310 
§
 << "„‘r› " << 
nfo
.
_»Œ›s
;

311 
§
 << " c»d™ " << 
nfo
.
_üed™s
;

314 
§
 << "\n";

316  
§
.
	`ke_¡ršg
();

317 
	}
}

320 ’um {
	mH_DEBUG
, 
	mH_STEPUP
, 
	mH_STEPDOWN
, 
	mH_THRESHOLD
, 
	mH_RATES
, 
	mH_RESET
,

321 
	mH_OFFSET
, 
	mH_ACTIVE
, 
	mH_PERIOD
,

322 
	mH_ALT_RATE
};

325 
SŒšg


326 
	$MadwifiR©e_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

328 
MadwifiR©e
 *
td
 = (MadwifiR©*)
e
;

329 (
ušŒ_t
è
thunk
) {

330 
H_DEBUG
:

331  
	`SŒšg
(
td
->
_debug
) + "\n";

332 
H_STEPDOWN
:

333  
	`SŒšg
(
td
->
_¡•down
) + "\n";

334 
H_STEPUP
:

335  
	`SŒšg
(
td
->
_¡•up
) + "\n";

336 
H_THRESHOLD
:

337  
	`SŒšg
(
td
->
_·ck‘_size_th»shŞd
) + "\n";

338 
H_OFFSET
:

339  
	`SŒšg
(
td
->
_off£t
) + "\n";

340 
H_ALT_RATE
:

341  
	`SŒšg
(
td
->
_®t_¿‹
) + "\n";

342 
H_RATES
: {

343  
td
->
	`´št_¿‹s
();

345 
H_ACTIVE
:

346  
	`SŒšg
(
td
->
_aùive
) + "\n";

347 
H_PERIOD
:

348  
	`SŒšg
(
td
->
_³riod
) + "\n";

350  
	`SŒšg
();

352 
	}
}

354 
	$MadwifiR©e_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

355 
E¼ÜHªdËr
 *
”rh
)

357 
MadwifiR©e
 *
f
 = (MadwifiR©*)
e
;

358 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

359 (
šŒ_t
)
v·¿m
) {

360 
H_DEBUG
: {

361 
boŞ
 
debug
;

362 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

363  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

364 
f
->
_debug
 = 
debug
;

367 
H_ALT_RATE
: {

368 
boŞ
 
®t_¿‹
;

369 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
®t_¿‹
))

370  
”rh
->
	`”rÜ
("alt_rate…arameter must be boolean");

371 
f
->
_®t_¿‹
 = 
®t_¿‹
;

374 
H_STEPUP
: {

375 
m
;

376 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

377  
”rh
->
	`”rÜ
("stepup…arameter must be unsigned");

378 
f
->
_¡•up
 = 
m
;

381 
H_STEPDOWN
: {

382 
m
;

383 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

384  
”rh
->
	`”rÜ
("stepdown…arameter must be unsigned");

385 
f
->
_¡•down
 = 
m
;

388 
H_THRESHOLD
: {

389 
m
;

390 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

391  
”rh
->
	`”rÜ
("threshold…arameter must be unsigned");

392 
f
->
_·ck‘_size_th»shŞd
 = 
m
;

395 
H_OFFSET
: {

396 
m
;

397 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

398  
”rh
->
	`”rÜ
("offset…arameter must be unsigned");

399 
f
->
_off£t
 = 
m
;

402 
H_PERIOD
: {

403 
m
;

404 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

405  
”rh
->
	`”rÜ
("period…arameter must be unsigned");

406 
f
->
_³riod
 = 
m
;

409 
H_RESET
:

410 
f
->
_ÃighbÜs
.
	`ş—r
();

413 
H_ACTIVE
: {

414 
boŞ
 
aùive
;

415 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
aùive
))

416  
”rh
->
	`”rÜ
("active must be boolean");

417 
f
->
_aùive
 = 
aùive
;

422 
	}
}

426 
	gMadwifiR©e
::
	$add_hªdËrs
()

428 
	`add_»ad_hªdËr
("debug", 
MadwifiR©e_»ad_·¿m
, 
H_DEBUG
);

429 
	`add_»ad_hªdËr
("¿‹s", 
MadwifiR©e_»ad_·¿m
, 
H_RATES
);

430 
	`add_»ad_hªdËr
("th»shŞd", 
MadwifiR©e_»ad_·¿m
, 
H_THRESHOLD
);

431 
	`add_»ad_hªdËr
("¡•up", 
MadwifiR©e_»ad_·¿m
, 
H_STEPUP
);

432 
	`add_»ad_hªdËr
("¡•down", 
MadwifiR©e_»ad_·¿m
, 
H_STEPDOWN
);

433 
	`add_»ad_hªdËr
("off£t", 
MadwifiR©e_»ad_·¿m
, 
H_OFFSET
);

434 
	`add_»ad_hªdËr
("aùive", 
MadwifiR©e_»ad_·¿m
, 
H_ACTIVE
);

435 
	`add_»ad_hªdËr
("®t_¿‹", 
MadwifiR©e_»ad_·¿m
, 
H_ALT_RATE
);

437 
	`add_wr™e_hªdËr
("debug", 
MadwifiR©e_wr™e_·¿m
, 
H_DEBUG
);

438 
	`add_wr™e_hªdËr
("th»shŞd", 
MadwifiR©e_wr™e_·¿m
, 
H_THRESHOLD
);

439 
	`add_wr™e_hªdËr
("¡•up", 
MadwifiR©e_wr™e_·¿m
, 
H_STEPUP
);

440 
	`add_wr™e_hªdËr
("¡•down", 
MadwifiR©e_wr™e_·¿m
, 
H_STEPDOWN
);

441 
	`add_wr™e_hªdËr
("off£t", 
MadwifiR©e_wr™e_·¿m
, 
H_OFFSET
);

442 
	`add_wr™e_hªdËr
("»£t", 
MadwifiR©e_wr™e_·¿m
, 
H_RESET
, 
HªdËr
::
BUTTON
);

443 
	`add_wr™e_hªdËr
("aùive", 
MadwifiR©e_wr™e_·¿m
, 
H_ACTIVE
);

444 
	`add_wr™e_hªdËr
("®t_¿‹", 
MadwifiR©e_wr™e_·¿m
, 
H_ALT_RATE
);

446 
	}
}

448 
CLICK_ENDDECLS


449 
EXPORT_ELEMENT
(
MadwifiR©e
)

	@wifi/madwifirate.hh

1 #iâdeà
CLICK_MADWIFIRATE_HH


2 
	#CLICK_MADWIFIRATE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/bighashm­.hh
>

6 
	~<şick/glue.hh
>

7 
	~<şick/tim”.hh
>

8 
	~<–em’ts/wifi/avaabË¿‹s.hh
>

9 
CLICK_DECLS


29 şas 
	cMadwifiR©e
 : 
public
 
EËm’t
 {…ublic:

31 
	$MadwifiR©e
(è
CLICK_COLD
;

32 ~
	$MadwifiR©e
(è
CLICK_COLD
;

34 cÚ¡ *
	$şass_Çme
() const {  "MadwifiRate"; }

35 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/0-2"; 
	}
}

36 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "ah/a"; 
	}
}

37 cÚ¡ *
	$æow_code
(ècÚ¡ {  "#/#"; 
	}
}

39 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

40 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

41 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

42 
	`run_tim”
(
Tim”
 *);

43 
	`adju¡_®l
();

44 
	`adju¡
(
Eth”Add»ss
);

47 
	`push
 (, 
Pack‘
 *);

49 
Pack‘
 *
	`puÎ
();

51 
	$add_hªdËrs
(è
CLICK_COLD
;

52 
SŒšg
 
	`¡©ic_´št_¡©s
(
EËm’t
 *
e
, *);

53 
SŒšg
 
	`´št_¿‹s
();

56 
Eth”Add»ss
 
_bÿ¡
;

57 
	`assign_¿‹
(
Pack‘
 *);

59 
	`´oûss_ãedback
(
Pack‘
 *);

61 
_¡•up
;

62 
_¡•down
;

63 
boŞ
 
_debug
;

64 
_off£t
;

65 
Tim”
 
_tim”
;

67 
_·ck‘_size_th»shŞd
;

69 
	sD¡Info
 {

70 
public
:

72 
Eth”Add»ss
 
_‘h
;

73 
VeùÜ
<> 
_¿‹s
;

75 
_üed™s
;

77 
_cu¼’t_šdex
;

79 
_sucûs£s
;

80 
_çu»s
;

81 
_»Œ›s
;

83 
	`D¡Info
() {

86 
	`D¡Info
(
Eth”Add»ss
 
‘h
) {

87 
_‘h
 = 
‘h
;

90 
	`¿‹_šdex
(
¿‹
) {

91 
ndx
 = 0;

92 
x
 = 0; x < 
_¿‹s
.
	`size
(); x++) {

93 ià(
¿‹
 =ğ
_¿‹s
[
x
]) {

94 
ndx
 = 
x
;

98  (
ndx
 =ğ
_¿‹s
.
	`size
()) ? -1 :‚dx;

101 
	`pick_¿‹
() {

102 ià(
_¿‹s
.
	`size
() == 0) {

103 
	`şick_ch©‹r
("no„ateso…ick from for %s\n",

104 
_‘h
.
	`uÅ¬£
().
	`c_¡r
());

107 ià(
_cu¼’t_šdex
 > 0 && _cu¼’t_šdex < 
_¿‹s
.
	`size
()) {

108  
_¿‹s
[
_cu¼’t_šdex
];

110  
_¿‹s
[0];

113 
	`pick_®t_¿‹
() {

114 ià(
_¿‹s
.
	`size
() == 0) {

115 
	`şick_ch©‹r
("no„ateso…ick from for %s\n",

116 
_‘h
.
	`uÅ¬£
().
	`c_¡r
());

119  
_¿‹s
[0];

121 
	}
};

123 
	gHashM­
<
	tEth”Add»ss
, 
	tD¡Info
> 
	tNeighbÜTabË
;

124 
	gNeighbÜTabË
::
	tcÚ¡_™”©Ü
 
	tNI‹r
;

126 
NeighbÜTabË
 
	g_ÃighbÜs
;

128 
AvaabËR©es
 *
	g_¹abË
;

129 
boŞ
 
	g_®t_¿‹
;

130 
boŞ
 
	g_aùive
;

131 
	g_³riod
;

134 
	gCLICK_ENDDECLS


	@wifi/packetstore.cc

1 
	~<şick/cÚfig.h
>

2 
	~<şick/¬gs.hh
>

3 
	~<şick/”rÜ.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/·ck‘_ªno.hh
>

6 
	~<şick/¡¿ccum.hh
>

7 
	~<şickÃt/‘h”.h
>

8 
	~<şickÃt/wifi.h
>

9 
	~<şick/¡ªd¬d/scheduËšfo.hh
>

10 
	~"·ck‘¡Üe.hh
"

11 
	~<şick/rou‹r.hh
>

12 
CLICK_DECLS


14 
	gPack‘StÜe
::
	$Pack‘StÜe
(è: 
	`_dœty
(0), 
	$_sk
(
this
)

16 
	}
}

18 
	gPack‘StÜe
::~
	$Pack‘StÜe
()

20 
_·ck‘s
.
	`size
()) {

21 
_·ck‘s
.
	`pİ_äÚt
();

23 
	}
}

26 
	gPack‘StÜe
::
	$ÿ¡
(cÚ¡ *
n
)

28 ià(
	`¡rcmp
(
n
, "PacketStore") == 0)

29  (
Pack‘StÜe
 *)
this
;

32 
	}
}

35 
	gPack‘StÜe
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *)

41 
	gPack‘StÜe
::
	$š™Ÿlize
(
E¼ÜHªdËr
 *
”rh
)

43 
ScheduËInfo
::
	`š™Ÿlize_sk
(
this
, &
_sk
, 
”rh
);

45 
	}
}

47 
Pack‘
 *

48 
	gPack‘StÜe
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

50 
¡Üe
 
s
;

51 
s
.
time¡amp
 = 
p_š
->
	`time¡amp_ªno
();

52 
s
.
Ën
 = 
	`WIFI_MIN
(
p_š
->
	`Ëngth
(), 80);

53 
	`memıy
(
s
.
d©a
, 
p_š
->
	`d©a
(), s.
Ën
);

54 
_·ck‘s
.
	`push_back
(
s
);

55  
p_š
;

56 
	}
}

58 
boŞ


59 
	gPack‘StÜe
::
	$run_sk
(
Task
 *)

61  
çl£
;

62 
	}
}

63 ’um {
	mH_RESET
, 
	mH_LEN
, 
	mH_POP
, 
	mH_DIRTY
};

65 
SŒšg


66 
	$»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

68 
Pack‘StÜe
 *
td
 = (Pack‘StÜ*)
e
;

69 (
ušŒ_t
è
thunk
) {

70 
H_LEN
:  
	`SŒšg
(
td
->
_·ck‘s
.
	`size
());

71 
H_DIRTY
:  
	`SŒšg
(
td
->
_dœty
);

72 
H_POP
: {

73 ifĞ!
td
->
_·ck‘s
.
	`size
()) {

74  
	`SŒšg
();

76 
Pack‘StÜe
::
¡Üe
 
s
 = 
td
->
_·ck‘s
[0];

77 
SŒšgAccum
 
	`§p
(
s
.
Ën
*2 + 20);

79 
§p
 << 
s
.
time¡amp
 << " | ";

81 *
buf
 = 
§p
.
	`d©a
(è+ s­.
	`Ëngth
();

82 
x
 = 0; x < 
s
.
Ën
; x++) {

83 
	`¥rštf
(
buf
 + 2*
x
, "%02x", 
s
.
d©a
[x] & 0xff);

85 
§p
.
	`adju¡_Ëngth
(
s
.
Ën
 *2);

86 
§p
 << "\n";

87 
td
->
_·ck‘s
.
	`pİ_äÚt
();

88  
§p
.
	`ke_¡ršg
();

91  
	`SŒšg
();

93 
	}
}

96 
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

97 
E¼ÜHªdËr
 *
”rh
)

99 
Pack‘StÜe
 *
td
 = (Pack‘StÜ*)
e
;

100 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

101 (
šŒ_t
)
v·¿m
) {

102 
H_RESET
: {

103 
boŞ
 
aùive
;

104 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
aùive
))

105  
”rh
->
	`”rÜ
("reset…arameter must be boolean");

106 ià(
aùive
) {

107 
td
->
_·ck‘s
.
	`size
()) {

108 
td
->
_·ck‘s
.
	`pİ_äÚt
();

115 
	}
}

118 
	gPack‘StÜe
::
	$add_hªdËrs
()

120 
	`add_»ad_hªdËr
("Ëngth", 
»ad_·¿m
, 
H_LEN
);

121 
	`add_»ad_hªdËr
("pİ", 
»ad_·¿m
, 
H_POP
, 
HªdËr
::
RAW
);

122 
	`add_»ad_hªdËr
("dœty", 
»ad_·¿m
, 
H_DIRTY
);

123 
	`add_wr™e_hªdËr
("»£t", 
wr™e_·¿m
, 
H_RESET
);

124 
	`add_sk_hªdËrs
(&
_sk
);

125 
	}
}

127 
CLICK_ENDDECLS


128 
EXPORT_ELEMENT
(
Pack‘StÜe
)

	@wifi/packetstore.hh

1 #iâdeà
CLICK_PACKETSTORE_HH


2 
	#CLICK_PACKETSTORE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şick/deque.hh
>

6 
	~<şick/nÙif›r.hh
>

7 
	~<şickÃt/wifi.h
>

9 
CLICK_DECLS


34 şas 
	cPack‘StÜe
 : 
public
 
EËm’t
 {…ublic:

36 
	$Pack‘StÜe
(è
CLICK_COLD
;

37 ~
	$Pack‘StÜe
(è
CLICK_COLD
;

39 cÚ¡ *
	$şass_Çme
() const {  "PacketStore"; }

40 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

41 cÚ¡ * 
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

42 
	$š™Ÿlize
(
E¼ÜHªdËr
 *è
CLICK_COLD
;

43 cÚ¡ *
	$æow_code
(ècÚ¡ {  "#/#"; 
	}
}

44 *
ÿ¡
(const *);

46 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

48 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

49 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
çl£
; 
	}
}

51 
	$add_hªdËrs
(è
CLICK_COLD
;

53 şas 
	c¡Üe
 {

54 
public
:

55 
Time¡amp
 
time¡amp
;

56 
d©a
[80];

57 
Ën
;

58 
	}
};

59 
	gDeque
 <
	g¡Üe
> 
	g_·ck‘s
;

61 
	g_dœty
;

62 
boŞ
 
run_sk
(
Task
 *);

64 
Task
 
	g_sk
;

67 
	gCLICK_ENDDECLS


	@wifi/path.hh

1 #iâdeà
CLICK_PATH_HH


2 
	#CLICK_PATH_HH


	)

3 
	~<şick/¡¿ccum.hh
>

4 
	~<şick/hashcode.hh
>

5 
CLICK_DECLS


7 
	gVeùÜ
<
	tIPAdd»ss
> 
	tP©h
;

9 
	g‹m¶©e
 <>

10 
šlše
 
hashcode_t
 
	$hashcode
(cÚ¡ 
P©h
 &
p
)

12 
hashcode_t
 
h
 = 0;

13 
x
 = 0; x < 
p
.
	`size
(); x++)

14 
h
 ^ğ
	`CLICK_NAME
(
hashcode
)(
p
[
x
]);

15  
h
;

16 
	}
}

18 
šlše
 
boŞ


19 
	gİ”©Ü
==(cÚ¡ 
P©h
 &
p1
, cÚ¡ 
	gP©h
 &
	gp2
)

21 ià(
	gp1
.
size
(è!ğ
p2
.size()) {

22  
çl£
;

24 
	gx
 = 0; x < 
	gp1
.
size
(); x++) {

25 ià(
	gp1
[
x
] !ğ
p2
[x]) {

26  
çl£
;

29  
	gŒue
;

32 
šlše
 
boŞ


33 
	gİ”©Ü
!=(cÚ¡ 
P©h
 &
p1
, cÚ¡ 
	gP©h
 &
	gp2
)

35  (!(
	gp1
 =ğ
p2
));

38 
šlše
 
SŒšg
 
	$·th_to_¡ršg
(cÚ¡ 
P©h
 &
p
)

40 
SŒšgAccum
 
§
;

41 
x
 = 0; x < 
p
.
	`size
(); x++) {

42 
§
 << 
p
[
x
].
	`uÅ¬£
();

43 ià(
x
 !ğ
p
.
	`size
() - 1) {

44 
§
 << " ";

47  
§
.
	`ke_¡ršg
();

48 
	}
}

51 
šlše
 
P©h
 
	$»v”£_·th
 (cÚ¡ 
P©h
 &
p
)

53 
P©h
 
»v
;

54 
x
 = 
p
.
	`size
() - 1; x >= 0; x--) {

55 
»v
.
	`push_back
(
p
[
x
]);

57  
»v
;

58 
	}
}

61 
šlše
 
	$šdex_of
(
P©h
 
p
, 
IPAdd»ss
 

) {

62 
x
 = 0; x < 
p
.
	`size
(); x++) {

63 ià(
p
[
x
] =ğ

) {

64  
x
;

69 
	}
}

71 
	gCLICK_ENDDECLS


	@wifi/printtxfeedback.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/add»ss.hh
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
	~<şickÃt/wifi.h
>

26 
	~<şick/‘h”add»ss.hh
>

27 
	~"´š‰xãedback.hh
"

28 
CLICK_DECLS


30 
	gPrštTXF“dback
::
	$PrštTXF“dback
()

31 : 
	`_´št_ªno
(
çl£
),

32 
	$_´št_checksum
(
çl£
)

34 
_Ïb–
 = "";

35 
	}
}

37 
	gPrštTXF“dback
::~
	$PrštTXF“dback
()

39 
	}
}

42 
PrštTXF“dback
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
* 
”rh
)

44 
	g»t
;

45 
	g_off£t
 = 0;

46 
	g»t
 = 
Args
(
cÚf
, 
this
, 
”rh
)

47 .
»ad_p
("LABEL", 
_Ïb–
)

48 .
»ad
("OFFSET", 
_off£t
)

49 .
com¶‘e
();

50  
	g»t
;

53 
Pack‘
 *

54 
	gPrštTXF“dback
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

57 ià(!
p
) {

58  
p
;

60 
ušt8_t
 *
d¡_±r
 = (ušt8_ˆ*è
p
->
	`d©a
(è+ 
_off£t
;

61 
Eth”Add»ss
 
d¡
 = 
	`Eth”Add»ss
(
d¡_±r
);

64 
SŒšgAccum
 
§
;

65 ià(
_Ïb–
[0] != 0) {

66 
§
 << 
_Ïb–
.
	`c_¡r
() << ":";

68 
§
 << "PrintTXFeedback";

70 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p
);

71 
§
 << " " << 
p
->
	`time¡amp_ªno
();

72 
§
 << " " << 
d¡
;

73 
§
 << " fÏg " << (è
ûh
->
æags
;

74 
§
 << "„©" << (è
ûh
->
¿‹
;

75 
§
 << " max_»Œ› " << (è
ûh
->
max_Œ›s
;

76 
§
 << "‡É_¿‹ " << (è
ûh
->
¿‹1
;

77 
§
 << "‡É_»Œ› " << (è
ûh
->
max_Œ›s1
;

78 
§
 << "„‘r› " << (è
ûh
->
»Œ›s
;

79 
§
 << " vœt_cŞ " << (è
ûh
->
vœt_cŞ
;

81 
	`şick_ch©‹r
("%s\n", 
§
.
	`c_¡r
());

84  
p
;

85 
	}
}

87 
CLICK_ENDDECLS


88 
EXPORT_ELEMENT
(
PrštTXF“dback
)

	@wifi/printtxfeedback.hh

1 #iâdeà
CLICK_PRINTTXFEEDBACK_HH


2 
	#CLICK_PRINTTXFEEDBACK_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/¡ršg.hh
>

5 
CLICK_DECLS


23 şas 
	cPrštTXF“dback
 : 
public
 
EËm’t
 {

25 
SŒšg
 
_Ïb–
;

27 
	mpublic
:

29 
	$PrštTXF“dback
(è
CLICK_COLD
;

30 ~
	$PrštTXF“dback
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "PrintTXFeedback"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

36 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

38 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

40 
boŞ
 
	g_´št_ªno
;

41 
boŞ
 
	g_´št_checksum
;

42 
	g_off£t
;

45 
	gCLICK_ENDDECLS


	@wifi/printwifi.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/add»ss.hh
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
	~<şickÃt/wifi.h
>

26 
	~<şick/‘h”add»ss.hh
>

27 
	~"´štwifi.hh
"

28 
CLICK_DECLS


30 
	gPrštWifi
::
	$PrštWifi
()

31 : 
	`_´št_ªno
(
çl£
),

32 
	$_´št_checksum
(
çl£
)

34 
_Ïb–
 = "";

35 
	}
}

37 
	gPrštWifi
::~
	$PrštWifi
()

39 
	}
}

42 
PrštWifi
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
* 
”rh
)

44 
	g»t
;

45 
	g_time¡amp
 = 
çl£
;

46 
	g»t
 = 
Args
(
cÚf
, 
this
, 
”rh
)

47 .
»ad_p
("LABEL", 
_Ïb–
)

48 .
»ad
("TIMESTAMP", 
_time¡amp
)

49 .
com¶‘e
();

50  
	g»t
;

53 
SŒšg
 
	$uÅ¬£_b—cÚ
(
Pack‘
 *
p
) {

54 
ušt8_t
 *
±r
;

55 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

56 
SŒšgAccum
 
§
;

58 
±r
 = (
ušt8_t
 *è(
w
+1);

61 
±r
 += 8;

63 
ušt16_t
 
b—cÚ_št
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

64 
±r
 += 2;

66 
ušt16_t
 
ÿ·b™y
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

67 
±r
 += 2;

70 
ušt8_t
 *
’d
 = (ušt8_ˆ*è
p
->
	`d©a
(è+…->
	`Ëngth
();

72 
ušt8_t
 *
ssid_l
 = 
NULL
;

73 
ušt8_t
 *
¿‹s_l
 = 
NULL
;

74 
ušt8_t
 *
x¿‹s_l
 = 
NULL
;

75 
ušt8_t
 *
ds_l
 = 
NULL
;

76 
±r
 < 
’d
) {

77 *
±r
) {

78 
WIFI_ELEMID_SSID
:

79 
ssid_l
 = 
±r
;

81 
WIFI_ELEMID_RATES
:

82 
¿‹s_l
 = 
±r
;

84 
WIFI_ELEMID_XRATES
:

85 
x¿‹s_l
 = 
±r
;

87 
WIFI_ELEMID_FHPARMS
:

89 
WIFI_ELEMID_DSPARMS
:

90 
ds_l
 = 
±r
;

92 
WIFI_ELEMID_IBSSPARMS
:

94 
WIFI_ELEMID_TIM
:

96 
WIFI_ELEMID_ERP
:

98 
WIFI_ELEMID_VENDOR
:

105 
±r
 +=…tr[1] + 2;

109 
Eth”Add»ss
 
bssid
 = 
	`Eth”Add»ss
(
w
->
i_addr3
);

110 
§
 << 
bssid
 << " ";

112 
SŒšg
 
ssid
 = "";

113 ià(
ssid_l
 && ssid_l[1]) {

114 
ssid
 = 
	`SŒšg
((*è
ssid_l
 + 2, 
	`WIFI_MIN
(()ssid_l[1], 
WIFI_NWID_MAXSIZE
));

117 ià(
ssid
 == "") {

118 
§
 << "(none)";

120 
§
 << 
ssid
;

123 
chª
 = (
ds_l
) ? ds_l[2] : 0;

124 
§
 << " chª " << 
chª
;

125 
§
 << " b_šˆ" << 
b—cÚ_št
 << " ";

127 
VeùÜ
<> 
basic_¿‹s
;

128 
VeùÜ
<> 
¿‹s
;

129 ià(
¿‹s_l
) {

130 
x
 = 0; x < 
	`WIFI_MIN
(()
¿‹s_l
[1], 
WIFI_RATE_SIZE
); x++) {

131 
ušt8_t
 
¿‹
 = 
¿‹s_l
[
x
 + 2];

133 ià(
¿‹
 & 
WIFI_RATE_BASIC
) {

134 
basic_¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

136 
¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

142 ià(
x¿‹s_l
) {

143 
x
 = 0; x < 
	`WIFI_MIN
(()
x¿‹s_l
[1], 
WIFI_RATE_SIZE
); x++) {

144 
ušt8_t
 
¿‹
 = 
x¿‹s_l
[
x
 + 2];

146 ià(
¿‹
 & 
WIFI_RATE_BASIC
) {

147 
basic_¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

149 
¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

155 
§
 << "[ ";

156 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_ESS
) {

157 
§
 << "ESS ";

159 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_IBSS
) {

160 
§
 << "IBSS ";

162 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_CF_POLLABLE
) {

163 
§
 << "CF_POLLABLE ";

165 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_CF_POLLREQ
) {

166 
§
 << "CF_POLLREQ ";

168 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_PRIVACY
) {

169 
§
 << "PRIVACY ";

171 
§
 << "] ";

173 
§
 << "({";

174 
x
 = 0; x < 
basic_¿‹s
.
	`size
(); x++) {

175 
§
 << 
basic_¿‹s
[
x
];

176 ià(
x
 !ğ
basic_¿‹s
.
	`size
()-1) {

177 
§
 << " ";

180 
§
 << "} ";

181 
x
 = 0; x < 
¿‹s
.
	`size
(); x++) {

182 
§
 << 
¿‹s
[
x
];

183 ià(
x
 !ğ
¿‹s
.
	`size
()-1 ) {

184 
§
 << " ";

188 
§
 << ")";

190  
§
.
	`ke_¡ršg
();

191 
	}
}

193 
SŒšg
 
	$»asÚ_¡ršg
(
»asÚ
) {

194 
»asÚ
) {

195 
WIFI_REASON_UNSPECIFIED
:  "unspecified";

196 
WIFI_REASON_AUTH_EXPIRE
:  "auth_expire";

197 
WIFI_REASON_AUTH_LEAVE
:  "auth_leave";

198 
WIFI_REASON_ASSOC_EXPIRE
:  "assoc_expire/inactive";

199 
WIFI_REASON_ASSOC_TOOMANY
:  "assoc_toomany";

200 
WIFI_REASON_NOT_AUTHED
:  "not_authed";

201 
WIFI_REASON_NOT_ASSOCED
:  "not_assoced";

202 
WIFI_REASON_ASSOC_LEAVE
:  "assoc_leave";

203 
WIFI_REASON_ASSOC_NOT_AUTHED
:  "assoc_not_authed";

204 :  "unknowÀ»asÚ " + 
	`SŒšg
(
»asÚ
);

207 
	}
}

209 
SŒšg
 
	$¡©us_¡ršg
(
¡©us
) {

210 
¡©us
) {

212 
WIFI_STATUS_SUCCESS
:  "success";

213 
WIFI_STATUS_UNSPECIFIED
:  "unspecified";

214 
WIFI_STATUS_CAPINFO
:  "capinfo";

215 
WIFI_STATUS_NOT_ASSOCED
:  "not_assoced";

216 
WIFI_STATUS_OTHER
:  "other";

217 
WIFI_STATUS_ALG
:  "alg";

218 
WIFI_STATUS_SEQUENCE
:  "seq";

219 
WIFI_STATUS_CHALLENGE
:  "challenge";

220 
WIFI_STATUS_TIMEOUT
:  "timeout";

221 
WIFI_STATUS_BASIC_RATES
:  "basic_rates";

222 
WIFI_STATUS_TOO_MANY_STATIONS
:  "too_many_stations";

223 
WIFI_STATUS_RATES
:  "rates";

224 
WIFI_STATUS_SHORTSLOT_REQUIRED
:  "shortslot_required";

225 :  "unknowÀ¡©u " + 
	`SŒšg
(
¡©us
);

227 
	}
}

228 
SŒšg
 
	$ÿ·b™y_¡ršg
(
ÿ·b™y
) {

229 
SŒšgAccum
 
§
;

230 
§
 << "[";

231 
boŞ
 
ªy
 = 
çl£
;

232 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_ESS
) {

233 
§
 << "ESS";

234 
ªy
 = 
Œue
;

236 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_IBSS
) {

237 ià(
ªy
è{ 
§
 << " ";}

238 
§
 << "IBSS";

239 
ªy
 = 
Œue
;

241 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_CF_POLLABLE
) {

242 ià(
ªy
è{ 
§
 << " ";}

243 
§
 << "CF_POLLABLE";

244 
ªy
 = 
Œue
;

246 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_CF_POLLREQ
) {

247 ià(
ªy
è{ 
§
 << " ";}

248 
§
 << "CF_POLLREQ";

249 
ªy
 = 
Œue
;

251 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_PRIVACY
) {

252 ià(
ªy
è{ 
§
 << " ";}

253 
§
 << "PRIVACY";

254 
ªy
 = 
Œue
;

256 
§
 << "]";

257  
§
.
	`ke_¡ršg
();

258 
	}
}

260 
SŒšg
 
	$g‘_ssid
(
u_št8_t
 *
±r
) {

261 ià(
±r
[0] !ğ
WIFI_ELEMID_SSID
) {

264  
	`SŒšg
((*è
±r
 + 2, 
	`WIFI_MIN
((íŒ[1], 
WIFI_NWID_MAXSIZE
));

265 
	}
}

267 
	gVeùÜ
<> 
	$g‘_¿‹s
(
u_št8_t
 *
±r
) {

268 
VeùÜ
<> 
¿‹s
;

269 
x
 = 0; x < 
	`WIFI_MIN
(()
±r
[1], 
WIFI_RATES_MAXSIZE
); x++) {

270 
ušt8_t
 
¿‹
 = 
±r
[
x
 + 2];

271 
¿‹s
.
	`push_back
(
¿‹
);

273  
¿‹s
;

274 
	}
}

276 
SŒšg
 
¿‹s_¡ršg
(
VeùÜ
<> 
¿‹s
) {

277 
	gVeùÜ
<> 
	gbasic_¿‹s
;

278 
	gVeùÜ
<> 
	gÙh”_¿‹s
;

279 
SŒšgAccum
 
	g§
;

280 
	gx
 = 0; x < 
	g¿‹s
.
size
(); x++) {

281 ià(
	g¿‹s
[
x
] & 
	gWIFI_RATE_BASIC
) {

282 
	gbasic_¿‹s
.
push_back
(
¿‹s
[
x
]);

284 
	gÙh”_¿‹s
.
push_back
(
¿‹s
[
x
]);

287 
	g§
 << "({";

288 
	gx
 = 0; x < 
	gbasic_¿‹s
.
size
(); x++) {

289 
	g§
 << (
	gbasic_¿‹s
[
x
] & 
	gWIFI_RATE_VAL
);

290 ià(
	gx
 !ğ
basic_¿‹s
.
size
()-1) {

291 
§
 << " ";

294 
	g§
 << "} ";

295 
	gx
 = 0; x < 
	gÙh”_¿‹s
.
size
(); x++) {

296 
	g§
 << 
	gÙh”_¿‹s
[
x
];

297 ià(
	gx
 !ğ
Ùh”_¿‹s
.
size
()-1) {

298 
§
 << " ";

301 
	g§
 << ")";

302  
	g§
.
ke_¡ršg
();

304 
Pack‘
 *

305 
	gPrštWifi
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

307 
şick_wifi
 *
wh
 = (şick_wif˜*è
p
->
	`d©a
();

308 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p
);

309 
ty³
 = 
wh
->
i_fc
[0] & 
WIFI_FC0_TYPE_MASK
;

310 
subty³
 = 
wh
->
i_fc
[0] & 
WIFI_FC0_SUBTYPE_MASK
;

311 
du¿tiÚ
 = 
	`ıu_to_Ë16
(
wh
->
i_dur
);

312 
Eth”Add»ss
 
¤c
;

313 
Eth”Add»ss
 
d¡
;

314 
Eth”Add»ss
 
bssid
;

319 
SŒšgAccum
 
§
;

320 ià(
_Ïb–
[0] != 0) {

321 
§
 << 
_Ïb–
 << ": ";

323 ià(
_time¡amp
)

324 
§
 << 
p
->
	`time¡amp_ªno
() << ": ";

326 
Ën
;

327 
Ën
 = 
	`¥rštf
(
§
.
	`»£rve
(9), "%4d | ", 
p
->
	`Ëngth
());

328 
§
.
	`adju¡_Ëngth
(
Ën
);

330 ià(
ûh
->
¿‹
 == 11) {

331 
§
 << " 5.5";

333 
Ën
 = 
	`¥rštf
(
§
.
	`»£rve
(2), "%2d", 
ûh
->
¿‹
/2);

334 
§
.
	`adju¡_Ëngth
(
Ën
);

336 
§
 << "Mb ";

338 
Ën
 = 
	`¥rštf
(
§
.
	`»£rve
(9), "+%2d/", 
ûh
->
rssi
);

339 
§
.
	`adju¡_Ëngth
(
Ën
);

341 
Ën
 = 
	`¥rštf
(
§
.
	`»£rve
(9), "%2d | ", 
ûh
->
s’û
);

342 
§
.
	`adju¡_Ëngth
(
Ën
);

346 
wh
->
i_fc
[1] & 
WIFI_FC1_DIR_MASK
) {

347 
WIFI_FC1_DIR_NODS
:

348 
d¡
 = 
	`Eth”Add»ss
(
wh
->
i_addr1
);

349 
¤c
 = 
	`Eth”Add»ss
(
wh
->
i_addr2
);

350 
bssid
 = 
	`Eth”Add»ss
(
wh
->
i_addr3
);

352 
WIFI_FC1_DIR_TODS
:

353 
bssid
 = 
	`Eth”Add»ss
(
wh
->
i_addr1
);

354 
¤c
 = 
	`Eth”Add»ss
(
wh
->
i_addr2
);

355 
d¡
 = 
	`Eth”Add»ss
(
wh
->
i_addr3
);

357 
WIFI_FC1_DIR_FROMDS
:

358 
d¡
 = 
	`Eth”Add»ss
(
wh
->
i_addr1
);

359 
bssid
 = 
	`Eth”Add»ss
(
wh
->
i_addr2
);

360 
¤c
 = 
	`Eth”Add»ss
(
wh
->
i_addr3
);

362 
WIFI_FC1_DIR_DSTODS
:

363 
d¡
 = 
	`Eth”Add»ss
(
wh
->
i_addr1
);

364 
¤c
 = 
	`Eth”Add»ss
(
wh
->
i_addr2
);

365 
bssid
 = 
	`Eth”Add»ss
(
wh
->
i_addr3
);

368 
§
 << "??? ";

371 
ušt8_t
 *
±r
 = (ušt8_ˆ*è
p
->
	`d©a
(è+ (
şick_wifi
);

372 
ty³
) {

373 
WIFI_FC0_TYPE_MGT
:

374 
§
 << "mgmt ";

376 
subty³
) {

377 
WIFI_FC0_SUBTYPE_ASSOC_REQ
: {

378 
ušt16_t
 
ÿ·b™y
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

379 
±r
 += 2;

381 
ušt16_t
 
l_št
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

382 
±r
 += 2;

384 
SŒšg
 
ssid
 = 
	`g‘_ssid
(
±r
);

385 
±r
 +=…tr[1] + 2;

387 
VeùÜ
<> 
¿‹s
 = 
	`g‘_¿‹s
(
±r
);

388 
SŒšg
 
¿‹s_s
 = 
	`¿‹s_¡ršg
(
¿‹s
);

390 
§
 << "assoc_req ";

391 
§
 << "li¡’_šˆ" << 
l_št
 << " ";

392 
§
 << 
	`ÿ·b™y_¡ršg
(
ÿ·b™y
);

393 
§
 << " ssid " << 
ssid
;

394 
§
 << "„©e " << 
¿‹s_s
;

395 
§
 << " ";

399 
WIFI_FC0_SUBTYPE_ASSOC_RESP
: {

400 
ušt16_t
 
ÿ·b™y
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

401 
±r
 += 2;

403 
ušt16_t
 
¡©us
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

404 
±r
 += 2;

406 
ušt16_t
 
associd
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

407 
±r
 += 2;

408 
§
 << "assoc_resp ";

409 
§
 << 
	`ÿ·b™y_¡ršg
(
ÿ·b™y
);

410 
§
 << " stu " << (è
¡©us
 << " " << 
	`¡©us_¡ršg
(status);

411 
§
 << "‡ssocid " << 
associd
 << " ";

414 
WIFI_FC0_SUBTYPE_REASSOC_REQ
: 
§
 << "reassoc_req "; ;

415 
WIFI_FC0_SUBTYPE_REASSOC_RESP
: 
§
 << "reassoc_resp "; ;

416 
WIFI_FC0_SUBTYPE_PROBE_REQ
: {

417 
§
 << "probe_req ";

418 
SŒšg
 
ssid
 = 
	`g‘_ssid
(
±r
);

419 
±r
 +=…tr[1] + 2;

421 
VeùÜ
<> 
¿‹s
 = 
	`g‘_¿‹s
(
±r
);

422 
SŒšg
 
¿‹s_s
 = 
	`¿‹s_¡ršg
(
¿‹s
);

423 
§
 << "ssid " << 
ssid
;

424 
§
 << " " << 
¿‹s_s
 << " ";

428 
WIFI_FC0_SUBTYPE_PROBE_RESP
:

429 
§
 << "probe_resp ";

430 
§
 << 
	`uÅ¬£_b—cÚ
(
p
);

431 
dÚe
;

432 
WIFI_FC0_SUBTYPE_BEACON
:

433 
§
 << "beacon ";

434 
§
 << 
	`uÅ¬£_b—cÚ
(
p
);

435 
dÚe
;

436 
WIFI_FC0_SUBTYPE_ATIM
: 
§
 << "atim "; ;

437 
WIFI_FC0_SUBTYPE_DISASSOC
: {

438 
ušt16_t
 
»asÚ
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

439 
§
 << "di§ssoø" << 
	`»asÚ_¡ršg
(
»asÚ
) << " ";

442 
WIFI_FC0_SUBTYPE_AUTH
: {

443 
§
 << "auth ";

444 
ušt16_t
 
®go
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

445 
±r
 += 2;

447 
ušt16_t
 
£q
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

448 
±r
 += 2;

450 
ušt16_t
 
¡©us
 =
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

451 
±r
 += 2;

452 
§
 << "®g " << (è
®go
;

453 
§
 << "‡uth_£q " << (è
£q
;

454 
§
 << " stu " << 
	`¡©us_¡ršg
(
¡©us
) << " ";

458 
WIFI_FC0_SUBTYPE_DEAUTH
: 
§
 << "deauth "; ;

460 
§
 << "unknown-subty³-" << (è(
wh
->
i_fc
[0] & 
WIFI_FC0_SUBTYPE_MASK
) << " ";

464 
WIFI_FC0_TYPE_CTL
:

465 
§
 << "cntl ";

466 
wh
->
i_fc
[0] & 
WIFI_FC0_SUBTYPE_MASK
) {

467 
WIFI_FC0_SUBTYPE_PS_POLL
: 
§
 << "psp "; ;

468 
WIFI_FC0_SUBTYPE_RTS
: 
§
 << "rts "; ;

469 
WIFI_FC0_SUBTYPE_CTS
: 
§
 << "cts "; ;

470 
WIFI_FC0_SUBTYPE_ACK
: 
§
 << "ack " << 
du¿tiÚ
 << " "; ;

471 
WIFI_FC0_SUBTYPE_CF_END
: 
§
 << "cfe "; ;

472 
WIFI_FC0_SUBTYPE_CF_END_ACK
: 
§
 << "cfea "; ;

474 
§
 << "unknown-subty³-" << (è(
wh
->
i_fc
[0] & 
WIFI_FC0_SUBTYPE_MASK
) << " ";

477 
WIFI_FC0_TYPE_DATA
:

478 
§
 << "data ";

479 
wh
->
i_fc
[1] & 
WIFI_FC1_DIR_MASK
) {

480 
WIFI_FC1_DIR_NODS
: 
§
 << "nods "; ;

481 
WIFI_FC1_DIR_TODS
: 
§
 << "tods "; ;

482 
WIFI_FC1_DIR_FROMDS
: 
§
 << "frds "; ;

483 
WIFI_FC1_DIR_DSTODS
: 
§
 << "dsds "; ;

487 
§
 << "unknown-ty³-" << (è(
wh
->
i_fc
[0] & 
WIFI_FC0_TYPE_MASK
) << " ";

492 ià(
subty³
 =ğ
WIFI_FC0_SUBTYPE_BEACON
 || subty³ =ğ
WIFI_FC0_SUBTYPE_PROBE_RESP
) {

494 
	`şick_ch©‹r
("%s\n", 
§
.
	`c_¡r
());

495  
p
;

499 
§
 << 
	`Eth”Add»ss
(
wh
->
i_addr1
);

500 ià(
p
->
	`Ëngth
() >= 16) {

501 
§
 << " " << 
	`Eth”Add»ss
(
wh
->
i_addr2
);

503 ià(
p
->
	`Ëngth
() > 22) {

504 
§
 << " " << 
	`Eth”Add»ss
(
wh
->
i_addr3
);

506 
§
 << " ";

508 ià(
p
->
	`Ëngth
(è>ğ(
şick_wifi
)) {

509 
ušt16_t
 
£q
 = 
	`Ë16_to_ıu
(
wh
->
i_£q
è>> 
WIFI_SEQ_SEQ_SHIFT
;

510 
ušt8_t
 
äag
 = 
	`Ë16_to_ıu
(
wh
->
i_£q
è& 
WIFI_SEQ_FRAG_MASK
;

511 
§
 << "£q " << (è
£q
;

512 ià(
äag
 || 
wh
->
i_fc
[1] & 
WIFI_FC1_MORE_FRAG
) {

513 
§
 << " f¿g " << (è
äag
;

515 
§
 << " ";

518 
§
 << "[";

519 ià(
ûh
->
æags
 & 
WIFI_EXTRA_TX
) {

520 
§
 << "x";

522 ià(
ûh
->
æags
 & 
WIFI_EXTRA_TX_FAIL
) {

523 
§
 << " fail";

525 ià(
ûh
->
æags
 & 
WIFI_EXTRA_TX_USED_ALT_RATE
) {

526 
§
 << "‡lt_rate";

528 ià(
ûh
->
æags
 & 
WIFI_EXTRA_RX_ERR
) {

529 
§
 << "ƒrr";

531 ià(
ûh
->
æags
 & 
WIFI_EXTRA_RX_MORE
) {

532 
§
 << " more";

534 ià(
wh
->
i_fc
[1] & 
WIFI_FC1_RETRY
) {

535 
§
 << "„etry";

537 ià(
wh
->
i_fc
[1] & 
WIFI_FC1_WEP
) {

538 
§
 << " wep";

540 
§
 << " ] ";

542 ià(
ûh
->
æags
 & 
WIFI_EXTRA_TX
) {

543 
§
 << "„‘r› " << (è
ûh
->
»Œ›s
;

546 
dÚe
:

547 
	`şick_ch©‹r
("%s\n", 
§
.
	`c_¡r
());

548  
p
;

549 
	}
}

551 
CLICK_ENDDECLS


552 
EXPORT_ELEMENT
(
PrštWifi
)

	@wifi/printwifi.hh

1 #iâdeà
CLICK_PRINTWIFI_HH


2 
	#CLICK_PRINTWIFI_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/¡ršg.hh
>

5 
CLICK_DECLS


23 şas 
	cPrštWifi
 : 
public
 
EËm’t
 {

25 
SŒšg
 
_Ïb–
;

27 
	mpublic
:

29 
	$PrštWifi
(è
CLICK_COLD
;

30 ~
	$PrštWifi
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "PrintWifi"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

36 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

38 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

40 
boŞ
 
	g_´št_ªno
;

41 
boŞ
 
	g_´št_checksum
;

42 
boŞ
 
	g_time¡amp
;

45 
	gCLICK_ENDDECLS


	@wifi/prism2decap.cc

18 
	~<şick/cÚfig.h
>

19 
	~"´ism2deÿp.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/wifi.h
>

25 
	~<şick/·ck‘_ªno.hh
>

26 
	~<şickÃt/Îc.h
>

27 
CLICK_DECLS


29 
	gPrism2Deÿp
::
	$Prism2Deÿp
()

31 
	}
}

33 
Prism2Deÿp
::~
	$Prism2Deÿp
()

35 
	}
}

38 
Prism2Deÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40 
	g_debug
 = 
çl£
;

41  
Args
(
cÚf
, 
this
, 
”rh
).
»ad
("DEBUG", 
_debug
).
com¶‘e
();

44 
Pack‘
 *

45 
	gPrism2Deÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

48 
u_št32_t
 *
±r
 = (u_št32_ˆ*è
p
->
	`d©a
();

50 ià(
±r
[0] =ğ
DIDmsg_Êxšd_wÏn¢ifäm
) {

51 
wÏn_ng_´ism2_h—d”
 *
ph
 = (wÏn_ng_´ism2_h—d” *è
p
->
	`d©a
();

52 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p
);

53 
ûh
->
rssi
 = 
ph
->rssi.
d©a
;

54 
ûh
->
s’û
 = 
ph
->
noi£
.
d©a
;

55 
ûh
->
¿‹
 = 
ph
->¿‹.
d©a
;

56 ià(
ph
->
i¡x
.
d©a
) {

57 
ûh
->
æags
 |ğ
WIFI_EXTRA_TX
;

59 
ûh
->
æags
 &ğ~
WIFI_EXTRA_TX
;

61 
p
->
	`puÎ
((
wÏn_ng_´ism2_h—d”
));

64  
p
;

65 
	}
}

68 ’um {
	mH_DEBUG
};

70 
SŒšg


71 
	$Prism2Deÿp_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

73 
Prism2Deÿp
 *
td
 = (Prism2Deÿ°*)
e
;

74 (
ušŒ_t
è
thunk
) {

75 
H_DEBUG
:

76  
	`SŒšg
(
td
->
_debug
) + "\n";

78  
	`SŒšg
();

80 
	}
}

82 
	$Prism2Deÿp_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

83 
E¼ÜHªdËr
 *
”rh
)

85 
Prism2Deÿp
 *
f
 = (Prism2Deÿ°*)
e
;

86 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

87 (
šŒ_t
)
v·¿m
) {

88 
H_DEBUG
: {

89 
boŞ
 
debug
;

90 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

91  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

92 
f
->
_debug
 = 
debug
;

97 
	}
}

100 
	gPrism2Deÿp
::
	$add_hªdËrs
()

102 
	`add_»ad_hªdËr
("debug", 
Prism2Deÿp_»ad_·¿m
, 
H_DEBUG
);

104 
	`add_wr™e_hªdËr
("debug", 
Prism2Deÿp_wr™e_·¿m
, 
H_DEBUG
);

105 
	}
}

106 
CLICK_ENDDECLS


107 
EXPORT_ELEMENT
(
Prism2Deÿp
)

	@wifi/prism2decap.hh

1 #iâdeà
CLICK_PRISM2DECAP_HH


2 
	#CLICK_PRISM2DECAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


23 şas 
	cPrism2Deÿp
 : 
public
 
EËm’t
 {…ublic:

25 
Prism2Deÿp
();

26 ~
Prism2Deÿp
();

28 cÚ¡ *
	$şass_Çme
() const {  "Prism2Decap"; }

29 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

30 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

32 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

33 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

35 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

38 
	$add_hªdËrs
(è
CLICK_COLD
;

41 
boŞ
 
_debug
;

42 
´iv©e
:

44 
	}
};

46 
	gCLICK_ENDDECLS


	@wifi/prism2encap.cc

18 
	~<şick/cÚfig.h
>

19 
	~"´ism2’ÿp.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/wifi.h
>

25 
	~<şick/·ck‘_ªno.hh
>

26 
	~<şickÃt/Îc.h
>

27 
CLICK_DECLS


29 
	gPrism2Enÿp
::
	$Prism2Enÿp
()

31 
	}
}

33 
Prism2Enÿp
::~
	$Prism2Enÿp
()

35 
	}
}

38 
Prism2Enÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40 
	g_debug
 = 
çl£
;

41  
Args
(
cÚf
, 
this
, 
”rh
).
»ad
("DEBUG", 
_debug
).
com¶‘e
();

44 
Pack‘
 *

45 
	gPrism2Enÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

48 
Wr™abËPack‘
 *
p_out
 = 
p
->
	`uniqueify
();

49 ià(!
p_out
) {

50 
p
->
	`kl
();

54 
p_out
 =…_out->
	`push
((
wÏn_ng_´ism2_h—d”
));

55 ià(
p_out
) {

56 
wÏn_ng_´ism2_h—d”
 *
ph
 = (wÏn_ng_´ism2_h—d” *è
p_out
->
	`d©a
();

57 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p
);

59 
	`mem£t
(
ph
, 0, (
wÏn_ng_´ism2_h—d”
));

60 
ph
->
msgcode
 = 
DIDmsg_Êxšd_wÏn¢ifäm
;

61 
ph
->
msgËn
 = (
wÏn_ng_´ism2_h—d”
);

64 
ph
->
ho¡time
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_ho¡time
;

65 
ph
->
ho¡time
.
¡©us
 = 0;

66 
ph
->
ho¡time
.
Ën
 = 4;

67 
ph
->
ho¡time
.
d©a
 = 0;

70 
ph
->
maùime
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_maùime
;

71 
ph
->
maùime
.
¡©us
 = 0;

72 
ph
->
maùime
.
Ën
 = 4;

73 
ph
->
maùime
.
d©a
 = 0;

75 
ph
->
i¡x
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_i¡x
;

76 
ph
->
i¡x
.
¡©us
 = 0;

77 
ph
->
i¡x
.
Ën
 = 4;

78 
ph
->
i¡x
.
d©a
 = 1;

80 
ph
->
ämËn
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_ämËn
;

81 
ph
->
ämËn
.
¡©us
 = 0;

82 
ph
->
ämËn
.
Ën
 = 4;

83 
ph
->
ämËn
.
d©a
 = 
p_out
->
	`Ëngth
(è- (
wÏn_ng_´ism2_h—d”
);

85 
ph
->
chªÃl
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_chªÃl
;

86 
ph
->
chªÃl
.
¡©us
 = 0;

87 
ph
->
chªÃl
.
Ën
 = 4;

88 
ph
->
chªÃl
.
d©a
 = 0;

90 
ph
->
rssi
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_rssi
;

91 
ph
->
rssi
.
¡©us
 = 
P80211ENUM_msg™em_¡©us_no_v®ue
;

92 
ph
->
rssi
.
Ën
 = 4;

93 
ph
->
rssi
.
d©a
 = 0;

95 
ph
->
sigÇl
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_sigÇl
;

96 
ph
->
sigÇl
.
¡©us
 = 0;

97 
ph
->
sigÇl
.
Ën
 = 4;

98 
ph
->
sigÇl
.
d©a
 = 
ûh
->
rssi
;

100 
ph
->
¿‹
.
did
 = 
DIDmsg_Êxšd_wÏn¢ifäm_¿‹
;

101 
ph
->
¿‹
.
¡©us
 = 0;

102 
ph
->
¿‹
.
Ën
 = 4;

103 
ph
->
¿‹
.
d©a
 = 
ûh
->rate;

106  
p_out
;

107 
	}
}

110 ’um {
	mH_DEBUG
};

112 
SŒšg


113 
	$Prism2Enÿp_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

115 
Prism2Enÿp
 *
td
 = (Prism2Enÿ°*)
e
;

116 (
ušŒ_t
è
thunk
) {

117 
H_DEBUG
:

118  
	`SŒšg
(
td
->
_debug
) + "\n";

120  
	`SŒšg
();

122 
	}
}

124 
	$Prism2Enÿp_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

125 
E¼ÜHªdËr
 *
”rh
)

127 
Prism2Enÿp
 *
f
 = (Prism2Enÿ°*)
e
;

128 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

129 (
šŒ_t
)
v·¿m
) {

130 
H_DEBUG
: {

131 
boŞ
 
debug
;

132 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

133  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

134 
f
->
_debug
 = 
debug
;

139 
	}
}

142 
	gPrism2Enÿp
::
	$add_hªdËrs
()

144 
	`add_»ad_hªdËr
("debug", 
Prism2Enÿp_»ad_·¿m
, 
H_DEBUG
);

146 
	`add_wr™e_hªdËr
("debug", 
Prism2Enÿp_wr™e_·¿m
, 
H_DEBUG
);

147 
	}
}

148 
CLICK_ENDDECLS


149 
EXPORT_ELEMENT
(
Prism2Enÿp
)

	@wifi/prism2encap.hh

1 #iâdeà
CLICK_PRISM2ENCAP_HH


2 
	#CLICK_PRISM2ENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


22 şas 
	cPrism2Enÿp
 : 
public
 
EËm’t
 {…ublic:

24 
Prism2Enÿp
();

25 ~
Prism2Enÿp
();

27 cÚ¡ *
	$şass_Çme
() const {  "Prism2Encap"; }

28 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

29 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

31 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

32 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

34 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

37 
	$add_hªdËrs
(è
CLICK_COLD
;

40 
boŞ
 
_debug
;

41 
´iv©e
:

43 
	}
};

45 
	gCLICK_ENDDECLS


	@wifi/probetxrate.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şickÃt/‘h”.h
>

25 
	~"´ob‘x¿‹.hh
"

26 
	~<–em’ts/wifi/avaabË¿‹s.hh
>

27 
	gCLICK_DECLS


29 
	#PROBE_MAX_RETRIES
 6

	)

31 
	gProbeTXR©e
::
	$ProbeTXR©e
()

32 : 
	`_off£t
(0),

33 
	`_·ck‘_size_th»shŞd
(0),

34 
	`_¿‹_wšdow_ms
(0),

35 
	$_¹abË
(0)

38 
bÿ¡_addr
[] = { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff };

39 
_bÿ¡
 = 
	`Eth”Add»ss
(
bÿ¡_addr
);

40 
	}
}

42 
	gProbeTXR©e
::~
	$ProbeTXR©e
()

44 
	}
}

47 
ProbeTXR©e
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

49 
	g_debug
 = 
çl£
;

50 
	g_aùive
 = 
Œue
;

51 
	g_Üigš®_»Œ›s
 = 4;

52 
	g_mš_§m¶e
 = 20;

53 
	g»t
 = 
Args
(
cÚf
, 
this
, 
”rh
)

54 .
»ad
("OFFSET", 
_off£t
)

55 .
»ad
("WINDOW", 
_¿‹_wšdow_ms
)

56 .
»ad
("THRESHOLD", 
_·ck‘_size_th»shŞd
)

57 .
»ad
("DEBUG", 
_debug
)

58 .
»ad_m
("RT", 
EËm’tCa¡Arg
("AvaabËR©es"), 
_¹abË
)

59 .
»ad
("ACTIVE", 
_aùive
)

60 .
com¶‘e
();

61 ià(
	g»t
 < 0) {

62  
	g»t
;

64 ià(
	g_¿‹_wšdow_ms
 <= 0)

65  
”rh
->
”rÜ
("WINDOW must be > 0");

67 
	g_¿‹_wšdow
 = 
Time¡amp
::
make_m£c
(
_¿‹_wšdow_ms
);

69  
	g»t
;

76 
	gProbeTXR©e
::
	$assign_¿‹
(
Pack‘
 *
p_š
) {

78 ià(!
p_š
) {

79 
	`şick_ch©‹r
("%p{–em’t}‡h, !p_š\n", 
this
);

83 
ušt8_t
 *
d¡_±r
 = (ušt8_ˆ*è
p_š
->
	`d©a
(è+ 
_off£t
;

84 
Eth”Add»ss
 
d¡
 = 
	`Eth”Add»ss
(
d¡_±r
);

85 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p_š
);

87 ià(
d¡
.
	`is_group
() || !dst) {

88 
VeùÜ
<> 
¿‹s
 = 
_¹abË
->
	`lookup
(
_bÿ¡
);

89 ià(
¿‹s
.
	`size
()) {

90 
ûh
->
¿‹
 = 
¿‹s
[0];

92 
ûh
->
¿‹
 = 2;

97 
D¡Info
 *
nfo
 = 
_ÃighbÜs
.
	`fšdp
(
d¡
);

98 ià(!
nfo
 || !nfo->
_¿‹s
.
	`size
()) {

99 
_ÃighbÜs
.
	`š£¹
(
d¡
, 
	`D¡Info
(d¡, 
_¹abË
->
	`lookup
(dst)));

100 
nfo
 = 
_ÃighbÜs
.
	`fšdp
(
d¡
);

103 
nfo
->
	`Œim
(
Time¡amp
::
	`now
(è- 
_¿‹_wšdow
);

107 
be¡_ndx
 = 
nfo
->
	`be¡_¿‹_ndx
();

108 ià(
nfo
->
_couÁ
++ % 10) {

110 
ûh
->
¿‹
 = 
nfo
->
_¿‹s
[
be¡_ndx
];

111 
ûh
->
max_Œ›s
 = 4;

114 
VeùÜ
<> 
possibË
 = 
nfo
->
	`pick_¿‹
();

115 ià(
possibË
.
	`size
()) {

116 
ûh
->
¿‹
 = 
possibË
[
	`şick_¿ndom
(0,…ossibË.
	`size
() - 1)];

117 
ûh
->
max_Œ›s
 = 2;

120 
ûh
->
¿‹
 = 
nfo
->
_¿‹s
[
be¡_ndx
];

121 
ûh
->
max_Œ›s
 = 4;

126 
ûh
->
¿‹1
 = 
nfo
->
_¿‹s
[
be¡_ndx
];

127 
ûh
->
max_Œ›s1
 = 2;

129 
ûh
->
¿‹2
 = 0;

130 
ûh
->
max_Œ›s2
 = 0;

132 
ûh
->
¿‹3
 = 0;

133 
ûh
->
max_Œ›s3
 = 0;

136 
	}
}

140 
	gProbeTXR©e
::
	$´oûss_ãedback
(
Pack‘
 *
p_š
) {

142 ià(!
p_š
) {

145 
ušt8_t
 *
d¡_±r
 = (ušt8_ˆ*è
p_š
->
	`d©a
(è+ 
_off£t
;

146 
Eth”Add»ss
 
d¡
 = 
	`Eth”Add»ss
(
d¡_±r
);

147 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p_š
);

148 
boŞ
 
sucûss
 = !(
ûh
->
æags
 & 
WIFI_EXTRA_TX_FAIL
);

149 
»Œ›s
 = 
ûh
->retries;

151 
Time¡amp
 
now
 = Time¡amp::
	`now
();

153 ià(
d¡
 =ğ
_bÿ¡
) {

155 ià(
_debug
) {

156 
	`şick_ch©‹r
("%p{element}: discarding bcast %s\n",

157 
this
,

158 
d¡
.
	`uÅ¬£
().
	`c_¡r
());

163 ià(0 =ğ
ûh
->
¿‹
) {

165 ià(
_debug
) {

166 
	`şick_ch©‹r
("%p{element}‚o„ate set for %s\n",

167 
this
,

168 
d¡
.
	`uÅ¬£
().
	`c_¡r
());

173 ià(!
sucûss
 && 
p_š
->
	`Ëngth
(è< 
_·ck‘_size_th»shŞd
) {

179 ià(
_debug
) {

180 
	`şick_ch©‹r
("%p{element} short success for %s\n",

181 
this
,

182 
d¡
.
	`uÅ¬£
().
	`c_¡r
());

187 
D¡Info
 *
nfo
 = 
_ÃighbÜs
.
	`fšdp
(
d¡
);

188 ià(!
nfo
) {

189 ià(
_debug
) {

190 
	`şick_ch©‹r
("%p{element}‚o info for %s\n",

191 
this
,

192 
d¡
.
	`uÅ¬£
().
	`c_¡r
());

197 ià(!
sucûss
 && 
_debug
) {

198 
	`şick_ch©‹r
("%p{element}…acket failed %s„etries %d„ate %d‡lt %d\n",

199 
this
,

200 
d¡
.
	`uÅ¬£
().
	`c_¡r
(),

201 
»Œ›s
,

202 
ûh
->
¿‹
,

203 
ûh
->
¿‹1
);

207 
Œ›s
 = 
»Œ›s
+1;

208 
time
 = 
	`ÿlc_u£cs_wifi_·ck‘
(1500, 
ûh
->
¿‹
,

209 
»Œ›s
);

211 ià(
_debug
) {

212 
	`şick_ch©‹r
("%p{element}::%s()„ate %dries %d (retries %d)ime %d\n",

213 
this
, 
__func__
, 
ûh
->
¿‹
, 
Œ›s
, 
»Œ›s
, 
time
);

215 
nfo
->
	`add_»suÉ
(
now
, 
ûh
->
¿‹
, 
Œ›s
,

216 
sucûss
, 
time
);

219 
	}
}

221 
Pack‘
 *

222 
	gProbeTXR©e
::
	$puÎ
(
pÜt
)

224 
Pack‘
 *
p
 = 
	`šput
(
pÜt
).
	`puÎ
();

225 ià(
p
 && 
_aùive
) {

226 
	`assign_¿‹
(
p
);

228  
p
;

229 
	}
}

232 
	gProbeTXR©e
::
	$push
(
pÜt
, 
Pack‘
 *
p_š
)

234 ià(!
p_š
) {

237 ià(
_aùive
) {

238 ià(
pÜt
 != 0) {

239 
	`´oûss_ãedback
(
p_š
);

241 
	`assign_¿‹
(
p_š
);

244 
	`checked_ouut_push
(
pÜt
, 
p_š
);

245 
	}
}

249 
SŒšg


250 
	gProbeTXR©e
::
	$´št_¿‹s
()

252 
SŒšgAccum
 
§
;

253 
NI‹r
 
™”
 = 
_ÃighbÜs
.
	`begš
(); i‹r.
	`live
(); iter++) {

254 
D¡Info
 
nfo
 = 
™”
.
	`v®ue
();

255 
§
 << 
nfo
.
_‘h
 << "\n";

256 
x
 = 0; x < 
nfo
.
_¿‹s
.
	`size
(); x++) {

257 
§
 << " " << 
nfo
.
_¿‹s
[
x
];

258 
§
 << " sucûs " << 
nfo
.
_tÙ®_sucûss
[
x
];

259 
§
 << " fa " << 
nfo
.
_tÙ®_ç
[
x
];

260 
§
 << "r› " << 
nfo
.
_tÙ®_Œ›s
[
x
];

261 
§
 << "…”ãù_u£c " << 
nfo
.
_³rãù_time
[
x
];

262 
§
 << "Ù®_u£c " << 
nfo
.
_tÙ®_time
[
x
];

263 
§
 << "‡v”age_u£c " << 
nfo
.
	`av”age
(
x
);

265 
§
 << "‡verage_tries ";

267 ià(
nfo
.
_·ck‘s
[
x
]) {

268 
Time¡amp
 
av”age_Œ›s
 = Time¡amp::
	`make_m£c
(
nfo
.
_tÙ®_Œ›s
[
x
] * 1000 /‚fo.
_·ck‘s
[x]);

269 
§
 << 
av”age_Œ›s
;

271 
§
 << "0";

275 
§
 << "\n";

278  
§
.
	`ke_¡ršg
();

279 
	}
}

282 ’um {
	mH_DEBUG
,

283 
	mH_RATES
,

284 
	mH_THRESHOLD
,

285 
	mH_RESET
,

286 
	mH_OFFSET
,

287 
	mH_ACTIVE
,

291 
SŒšg


292 
	$ProbeTXR©e_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

294 
ProbeTXR©e
 *
td
 = (ProbeTXR©*)
e
;

295 (
ušŒ_t
è
thunk
) {

296 
H_DEBUG
:  
	`SŒšg
(
td
->
_debug
) + "\n";

297 
H_THRESHOLD
:  
	`SŒšg
(
td
->
_·ck‘_size_th»shŞd
) + "\n";

298 
H_OFFSET
:  
	`SŒšg
(
td
->
_off£t
) + "\n";

299 
H_RATES
:  
td
->
	`´št_¿‹s
();

300 
H_ACTIVE
:  
	`SŒšg
(
td
->
_aùive
) + "\n";

302  
	`SŒšg
();

304 
	}
}

306 
	$ProbeTXR©e_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

307 
E¼ÜHªdËr
 *
”rh
)

309 
ProbeTXR©e
 *
f
 = (ProbeTXR©*)
e
;

310 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

311 (
šŒ_t
)
v·¿m
) {

312 
H_DEBUG
: {

313 
boŞ
 
debug
;

314 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

315  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

316 
f
->
_debug
 = 
debug
;

319 
H_THRESHOLD
: {

320 
m
;

321 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

322  
”rh
->
	`”rÜ
("threshold…arameter must be unsigned");

323 
f
->
_·ck‘_size_th»shŞd
 = 
m
;

326 
H_OFFSET
: {

327 
m
;

328 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

329  
”rh
->
	`”rÜ
("offset…arameter must be unsigned");

330 
f
->
_off£t
 = 
m
;

333 
H_RESET
:

334 
f
->
_ÃighbÜs
.
	`ş—r
();

336 
H_ACTIVE
: {

337 
boŞ
 
aùive
;

338 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
aùive
))

339  
”rh
->
	`”rÜ
("active must be boolean");

340 
f
->
_aùive
 = 
aùive
;

345 
	}
}

350 
	gProbeTXR©e
::
	$add_hªdËrs
()

352 
	`add_»ad_hªdËr
("debug", 
ProbeTXR©e_»ad_·¿m
, 
H_DEBUG
);

353 
	`add_»ad_hªdËr
("¿‹s", 
ProbeTXR©e_»ad_·¿m
, 
H_RATES
);

354 
	`add_»ad_hªdËr
("th»shŞd", 
ProbeTXR©e_»ad_·¿m
, 
H_THRESHOLD
);

355 
	`add_»ad_hªdËr
("off£t", 
ProbeTXR©e_»ad_·¿m
, 
H_OFFSET
);

356 
	`add_»ad_hªdËr
("aùive", 
ProbeTXR©e_»ad_·¿m
, 
H_ACTIVE
);

358 
	`add_wr™e_hªdËr
("debug", 
ProbeTXR©e_wr™e_·¿m
, 
H_DEBUG
);

359 
	`add_wr™e_hªdËr
("th»shŞd", 
ProbeTXR©e_wr™e_·¿m
, 
H_THRESHOLD
);

360 
	`add_wr™e_hªdËr
("off£t", 
ProbeTXR©e_wr™e_·¿m
, 
H_OFFSET
);

361 
	`add_wr™e_hªdËr
("»£t", 
ProbeTXR©e_wr™e_·¿m
, 
H_RESET
, 
HªdËr
::
BUTTON
);

362 
	`add_wr™e_hªdËr
("aùive", 
ProbeTXR©e_wr™e_·¿m
, 
H_ACTIVE
);

364 
	}
}

366 
CLICK_ENDDECLS


367 
	$ELEMENT_REQUIRES
(
b™¿‹
)

368 
	`EXPORT_ELEMENT
(
ProbeTXR©e
)

	@wifi/probetxrate.hh

1 #iâdeà
CLICK_PROBETXRATE_HH


2 
	#CLICK_PROBETXRATE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/deque.hh
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<şick/bighashm­.hh
>

7 
	~<şick/glue.hh
>

8 
	~<şickÃt/wifi.h
>

9 
	~<–em’ts/wifi/b™¿‹.hh
>

11 
CLICK_DECLS


12 
şass
 
	gAvaabËR©es
;

56 şas 
	cProbeTXR©e
 : 
public
 
EËm’t
 {…ublic:

58 
	$ProbeTXR©e
(è
CLICK_COLD
;

59 ~
	$ProbeTXR©e
(è
CLICK_COLD
;

61 cÚ¡ *
	$şass_Çme
() const {  "ProbeTXRate"; }

62 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "2/0-2"; 
	}
}

63 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "ah/a"; 
	}
}

64 cÚ¡ *
	$æow_code
(ècÚ¡ {  "#/#"; 
	}
}

66 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

67 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

70 
push
 (, 
Pack‘
 *);

72 
Pack‘
 *
puÎ
();

73 
´oûss_ãedback
(
Pack‘
 *);

74 
assign_¿‹
(
Pack‘
 *);

75 
	$add_hªdËrs
(è
CLICK_COLD
;

79 
boŞ
 
_debug
;

80 
_off£t
;

81 
_·ck‘_size_th»shŞd
;

82 
SŒšg
 
	`´št_¿‹s
();

84 
	stx_»suÉ
 {

85 
Time¡amp
 
_wh’
;

86 
_¿‹
;

87 
boŞ
 
_sucûss
;

88 
_time
;

89 
_Œ›s
;

91 
	`tx_»suÉ
(cÚ¡ 
Time¡amp
 &
t
, 
¿‹
,

92 
boŞ
 
sucûss
, 
time
, 
Œ›s
) :

93 
	`_wh’
(
t
),

94 
	`_¿‹
(
¿‹
),

95 
	`_sucûss
(
sucûss
),

96 
	`_time
(
time
),

97 
	`_Œ›s
(
Œ›s
)

99 
	`tx_»suÉ
() {}

100 
	}
};

103 
	sD¡Info
 {

104 
	gpublic
:

106 
Eth”Add»ss
 
_‘h
;

107 
	gDeque
<
	gtx_»suÉ
> 
	g_»suÉs
;

109 
	gVeùÜ
<> 
	g_¿‹s
;

111 
	gVeùÜ
<> 
	g_·ck‘s
;

112 
	gVeùÜ
<> 
	g_tÙ®_time
;

113 
	gVeùÜ
<> 
	g_tÙ®_sucûss
;

114 
	gVeùÜ
<> 
	g_tÙ®_ç
;

115 
	gVeùÜ
<> 
	g_³rãù_time
;

116 
	gVeùÜ
<> 
	g_tÙ®_Œ›s
;

119 
	g_couÁ
;

120 
D¡Info
() {

123 
D¡Info
(
Eth”Add»ss
 
‘h
, 
VeùÜ
<> 
¿‹s
) {

124 
	g_‘h
 = 
‘h
;

125 
	g_¿‹s
 = 
¿‹s
;

126 
	g_·ck‘s
 = 
VeùÜ
<>(
_¿‹s
.
size
(), 0);

127 
	g_tÙ®_time
 = 
VeùÜ
<>(
_¿‹s
.
size
(), 0);

128 
	g_tÙ®_sucûss
 = 
VeùÜ
<>(
_¿‹s
.
size
(), 0);

129 
	g_tÙ®_ç
 = 
VeùÜ
<>(
_¿‹s
.
size
(), 0);

130 
	g_tÙ®_Œ›s
 = 
VeùÜ
<>(
_¿‹s
.
size
(), 0);

131 
	g_³rãù_time
 = 
VeùÜ
<>(
_¿‹s
.
size
(), 0);

134 
	g_couÁ
 = 0;

135 
	gx
 = 0; x < 
	g_¿‹s
.
size
(); x++) {

136 
	g_³rãù_time
[
x
] = 
ÿlc_u£cs_wifi_·ck‘
(1500, 
_¿‹s
[x], 0);

140 
¿‹_šdex
(
¿‹
) {

141 
	gndx
 = 0;

142 
	gx
 = 0; x < 
	g_¿‹s
.
size
(); x++) {

143 ià(
	g¿‹
 =ğ
_¿‹s
[
x
]) {

144 
ndx
 = 
x
;

148  (
	gndx
 =ğ
_¿‹s
.
size
()è? -1 : 
ndx
;

151 
check
 () {

152 
	gx
 = 0; x < 
	g_¿‹s
.
size
(); x++) {

153 
	gsum_sucûss
 = 0;

154 
	gsum_ç
 = 0;

155 
	gsum_time
 = 0;

156 
	gy
 = 0; y < 
	g_»suÉs
.
size
(); y++) {

157 ià(
	g_»suÉs
[
y
].
	g_¿‹
 !ğ
_¿‹s
[
x
]) {

160 ià(
	g_»suÉs
[
y
].
	g_sucûss
) {

161 
	gsum_sucûss
++;

163 
	gsum_ç
++;

165 
	gsum_time
 +ğ
_»suÉs
[
y
].
_time
;

168 ià(
	gsum_sucûss
 !ğ
_tÙ®_sucûss
[
x
]) {

169 
şick_ch©‹r
("rate %d mismatch success %d %d\n",

170 
_¿‹s
[
x
],

171 
sum_sucûss
, 
_tÙ®_sucûss
[
x
]);

173 ià(
	gsum_ç
 !ğ
_tÙ®_ç
[
x
]) {

174 
şick_ch©‹r
("rate %d mismatch fail %d %d\n",

175 
_¿‹s
[
x
],

176 
sum_ç
, 
_tÙ®_ç
[
x
]);

178 ià(
	gsum_time
 !ğ
_tÙ®_time
[
x
]) {

179 
şick_ch©‹r
("rate %d mismatchime %d %d\n",

180 
_¿‹s
[
x
],

181 
sum_time
, 
_tÙ®_time
[
x
]);

186 
add_»suÉ
(cÚ¡ 
Time¡amp
 &
now
, 
¿‹
, 
Œ›s
, 
sucûss
,

187 
time
) {

188 
	gndx
 = 
¿‹_šdex
(
¿‹
);

189 ià(!
	g¿‹
 || 
	gndx
 < 0 ||‚dx > 
	g_¿‹s
.
size
()){

192 
	g_tÙ®_time
[
ndx
] +ğ
time
;

193 
	g_tÙ®_Œ›s
[
ndx
] +ğ
Œ›s
;

194 
	g_·ck‘s
[
ndx
]++;

195 ià(
	gsucûss
) {

196 
	g_tÙ®_sucûss
[
ndx
]++;

198 
	g_tÙ®_ç
[
ndx
]++;

200 
	g_»suÉs
.
push_back
(
tx_»suÉ
(
now
, 
¿‹
,

201 
sucûss
, 
time
, 
Œ›s
));

206 
Œim
(cÚ¡ 
Time¡amp
 &
ts
) {

207 
	g_»suÉs
.
size
(è&& _»suÉs[0].
	g_wh’
 < 
	gts
) {

208 
tx_»suÉ
 
	gt
 = 
_»suÉs
[0];

209 
	g_»suÉs
.
pİ_äÚt
();

211 
	gndx
 = 
¿‹_šdex
(
t
.
_¿‹
);

213 ià(
	gndx
 < 0 ||‚dx >ğ
_¿‹s
.
size
()) {

214 
şick_ch©‹r
("%s: ???",

215 
__func__
);

218 ià(
	gt
.
	g_sucûss
) {

219 
	g_tÙ®_sucûss
[
ndx
]--;

221 
	g_tÙ®_ç
[
ndx
]--;

223 
	g_·ck‘s
[
ndx
]--;

224 
	g_tÙ®_time
[
ndx
] -ğ
t
.
_time
;

225 
	g_tÙ®_Œ›s
[
ndx
] -ğ
t
.
_Œ›s
;

230 
av”age
(
ndx
) {

231 ià(!
	g_tÙ®_sucûss
[
ndx
]) {

235  
	g_tÙ®_time
[
ndx
] / 
	g_tÙ®_sucûss
[ndx];

238 
be¡_¿‹_ndx
() {

239 
	gbe¡_ndx
 = -1;

240 
	gbe¡_time
 = 0;

241 
boŞ
 
	gfound
 = 
çl£
;

242 ià(!
	g_¿‹s
.
size
()) {

245 
	gx
 = 0; x < 
	g_¿‹s
.
size
(); x++) {

246 ià(
	g_tÙ®_sucûss
[
x
]) {

247 
	gtime
 = 
_tÙ®_time
[
x
] / 
_tÙ®_sucûss
[x];

248 ià(!
	gfound
 || 
	gtime
 < 
	gbe¡_time
) {

249 
	gbe¡_ndx
 = 
x
;

250 
	gbe¡_time
 = 
time
;

251 
	gfound
 = 
Œue
;

255 ià(
	gfound
) {

256  
	gbe¡_ndx
;

259 
	gx
 = 
_¿‹s
.
size
()-1; x > 0; x--) {

260 ià(
	g_tÙ®_ç
[
x
] < 3) {

261  
	gx
;

267 
	gVeùÜ
<> 
pick_¿‹
() {

268 
	gbe¡_ndx
 = 
be¡_¿‹_ndx
();

270 ià(
	g_¿‹s
.
size
() == 0) {

271 
şick_ch©‹r
("no„ateso…ick from for %s\n",

272 
_‘h
.
uÅ¬£
().
c_¡r
());

273  
	g_¿‹s
;

276 ià(
	gbe¡_ndx
 < 0) {

278  
	g_¿‹s
;

281 
	gbe¡_time
 = 
av”age
(
be¡_ndx
);

282 
	gVeùÜ
<> 
	gpossibË_¿‹s
;

283 
	gx
 = 0; x < 
	g_¿‹s
.
size
(); x++) {

284 ià(
	gbe¡_time
 < 
	g_³rãù_time
[
x
]) {

289 ià(
	g_tÙ®_ç
[
x
] > 3 && !
	g_tÙ®_sucûss
[x]) {

292 
	gpossibË_¿‹s
.
push_back
(
_¿‹s
[
x
]);

295  
	gpossibË_¿‹s
;

301 
	gHashM­
<
	tEth”Add»ss
, 
	tD¡Info
> 
	tNeighbÜTabË
;

302 
	gNeighbÜTabË
::
	tcÚ¡_™”©Ü
 
	tNI‹r
;

304 
NeighbÜTabË
 
	g_ÃighbÜs
;

305 
Eth”Add»ss
 
	g_bÿ¡
;

306 
	g_¿‹_wšdow_ms
;

307 
Time¡amp
 
	g_¿‹_wšdow
;

309 
AvaabËR©es
 *
	g_¹abË
;

312 
boŞ
 
	g_aùive
;

313 
	g_Üigš®_»Œ›s
;

314 
	g_mš_§m¶e
;

317 
	gCLICK_ENDDECLS


	@wifi/pushanno.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/”rÜ.hh
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/·ck‘_ªno.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~"pushªno.hh
"

25 
CLICK_DECLS


28 
	gPushAÂo
::
	$PushAÂo
()

30 
	}
}

32 
PushAÂo
::~
	$PushAÂo
()

34 
	}
}

36 
Pack‘
 *

37 
PushAÂo
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

40 ià(!
p_š
) {

44 
p_š
 =…_š->
	`push
(
Pack‘
::
ªno_size
);

45 ià(
p_š
) {

46 
	`memıy
((*)
p_š
->
	`d©a
(),…_š->
	`ªno
(), 
Pack‘
::
ªno_size
);

48  
p_š
;

49 
	}
}

51 
CLICK_ENDDECLS


54 
EXPORT_ELEMENT
(
PushAÂo
)

	@wifi/pushanno.hh

1 #iâdeà
CLICK_PUSHANNO_HH


2 
	#CLICK_PUSHANNO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/bighashm­.hh
>

6 
	~<şick/glue.hh
>

7 
CLICK_DECLS


26 şas 
	cPushAÂo
 : 
public
 
EËm’t
 {…ublic:

28 
	$PushAÂo
(è
CLICK_COLD
;

29 ~
	$PushAÂo
(è
CLICK_COLD
;

31 cÚ¡ *
	$şass_Çme
() const {  "PushAnno"; }

32 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

33 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "a/a"; 
	}
}

35 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

39 
	gCLICK_ENDDECLS


	@wifi/radiotapdecap.cc

18 
	~<şick/cÚfig.h
>

19 
	~"¿diÙ­deÿp.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/wifi.h
>

25 
	~<şickÃt/¿diÙ­.h
>

26 
	~<şick/·ck‘_ªno.hh
>

27 
	~<şickÃt/Îc.h
>

28 
	gCLICK_DECLS


30 
	#NUM_RADIOTAP_ELEMENTS
 22

	)

32 cÚ¡ 
	g¿diÙ­_–em_to_by‹s
[
NUM_RADIOTAP_ELEMENTS
] =

57 
	$¹_–_´e£Á
(
›“80211_¿diÙ­_h—d”
 *
th
, 
u_št32_t
 
–em’t
)

59 ià(
–em’t
 > 
NUM_RADIOTAP_ELEMENTS
)

61  
	`Ë32_to_ıu
(
th
->
™_´e£Á
è& (1 << 
–em’t
);

62 
	}
}

64 
	$¹_check_h—d”
(
›“80211_¿diÙ­_h—d”
 *
th
, 
Ën
, 
u_št8_t
 *
off£ts
[], u_št8_ˆ
add™iÚ®_™_´e£Á_æags
)

66 
by‹s
 = 
add™iÚ®_™_´e£Á_æags
 * (
u_št32_t
);

67 
by‹s
 += bytes % 8;

68 
x
 = 0;

69 
u_št8_t
 *
±r
 = (u_št8_ˆ*)(
th
 + 1);

71 ià(
th
->
™_v”siÚ
 != 0) {

75 ià(
	`Ë16_to_ıu
(
th
->
™_Ën
è< (
›“80211_¿diÙ­_h—d”
)) {

79 
x
 = 0; x < 
NUM_RADIOTAP_ELEMENTS
; x++) {

80 ià(
	`¹_–_´e£Á
(
th
, 
x
)) {

81 
¿diÙ­_·ddšg_size
 = 
¿diÙ­_–em_to_by‹s
[
x
];

82 if(
x
==
IEEE80211_RADIOTAP_CHANNEL
è
¿diÙ­_·ddšg_size
 = 2;

83 
·d
 = 
by‹s
 % 
¿diÙ­_·ddšg_size
;

85 ià(
·d
)

86 
by‹s
 +ğ
¿diÙ­_·ddšg_size
 - 
·d
;

87 
off£ts
[
x
] = 
±r
 + 
by‹s
;

88 
by‹s
 +ğ
¿diÙ­_–em_to_by‹s
[
x
];

92 ià(
	`Ë16_to_ıu
(
th
->
™_Ën
è< (
›“80211_¿diÙ­_h—d”
è+ 
by‹s
) {

96 ià(
	`Ë16_to_ıu
(
th
->
™_Ën
è> 
Ën
) {

101 
	}
}

103 
	gRadiÙ­Deÿp
::
	$RadiÙ­Deÿp
()

105 
	}
}

107 
RadiÙ­Deÿp
::~
	$RadiÙ­Deÿp
()

109 
	}
}

112 
RadiÙ­Deÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

114 
	g_debug
 = 
çl£
;

115  
Args
(
cÚf
, 
this
, 
”rh
).
»ad
("DEBUG", 
_debug
).
com¶‘e
();

118 
Pack‘
 *

119 
	gRadiÙ­Deÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

121 
u_št8_t
 *
off£ts
[
NUM_RADIOTAP_ELEMENTS
];

122 
›“80211_¿diÙ­_h—d”
 *
th
 = (›“80211_¿diÙ­_h—d” *è
p
->
	`d©a
();

124 
u_št8_t
 
add™iÚ®_™_´e£Á_æags
 = 0;

125 
u_št32_t
 *
™µ
 = (u_št32_t*è&
th
->
™_´e£Á
;

127 
	`Ë32_to_ıu
(*
™µ
è& (1 << 
IEEE80211_RADIOTAP_EXT
)){

128 
add™iÚ®_™_´e£Á_æags
++;

129 
™µ
 += 1;

132 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p
);

133 ià(
	`¹_check_h—d”
(
th
, 
p
->
	`Ëngth
(), 
off£ts
, 
add™iÚ®_™_´e£Á_æags
)) {

134 
	`mem£t
((*)
ûh
, 0, (
şick_wifi_exŒa
));

135 
ûh
->
magic
 = 
WIFI_EXTRA_MAGIC
;

137 ià(
	`¹_–_´e£Á
(
th
, 
IEEE80211_RADIOTAP_FLAGS
)) {

138 
u_št8_t
 
æags
 = *
off£ts
[
IEEE80211_RADIOTAP_FLAGS
];

139 ià(
æags
 & 
IEEE80211_RADIOTAP_F_DATAPAD
) {

140 
ûh
->
·d
 = 1;

142 ià(
æags
 & 
IEEE80211_RADIOTAP_F_FCS
) {

143 
p
->
	`ke
(4);

147 ià(
	`¹_–_´e£Á
(
th
, 
IEEE80211_RADIOTAP_RATE
)) {

148 
ûh
->
¿‹
 = *
off£ts
[
IEEE80211_RADIOTAP_RATE
];

151 ià(
	`¹_–_´e£Á
(
th
, 
IEEE80211_RADIOTAP_DBM_ANTSIGNAL
))

152 
ûh
->
rssi
 = *
off£ts
[
IEEE80211_RADIOTAP_DBM_ANTSIGNAL
];

154 ià(
	`¹_–_´e£Á
(
th
, 
IEEE80211_RADIOTAP_DBM_ANTNOISE
))

155 
ûh
->
s’û
 = *
off£ts
[
IEEE80211_RADIOTAP_DBM_ANTNOISE
];

157 ià(
	`¹_–_´e£Á
(
th
, 
IEEE80211_RADIOTAP_DB_ANTSIGNAL
))

158 
ûh
->
rssi
 = *
off£ts
[
IEEE80211_RADIOTAP_DB_ANTSIGNAL
];

160 ià(
	`¹_–_´e£Á
(
th
, 
IEEE80211_RADIOTAP_DB_ANTNOISE
))

161 
ûh
->
s’û
 = *
off£ts
[
IEEE80211_RADIOTAP_DB_ANTNOISE
];

163 ià(
	`¹_–_´e£Á
(
th
, 
IEEE80211_RADIOTAP_RX_FLAGS
)) {

164 
u_št16_t
 
æags
 = 
	`Ë16_to_ıu
(*((u_št16_ˆ*è
off£ts
[
IEEE80211_RADIOTAP_RX_FLAGS
]));

165 ià(
æags
 & 
IEEE80211_RADIOTAP_F_RX_BADFCS
)

166 
ûh
->
æags
 |ğ
WIFI_EXTRA_RX_ERR
;

169 ià(
	`¹_–_´e£Á
(
th
, 
IEEE80211_RADIOTAP_TX_FLAGS
)) {

170 
u_št16_t
 
æags
 = 
	`Ë16_to_ıu
(*((u_št16_ˆ*è
off£ts
[
IEEE80211_RADIOTAP_TX_FLAGS
]));

171 
ûh
->
æags
 |ğ
WIFI_EXTRA_TX
;

172 ià(
æags
 & 
IEEE80211_RADIOTAP_F_TX_FAIL
)

173 
ûh
->
æags
 |ğ
WIFI_EXTRA_TX_FAIL
;

176 ià(
	`¹_–_´e£Á
(
th
, 
IEEE80211_RADIOTAP_DATA_RETRIES
))

177 
ûh
->
»Œ›s
 = *
off£ts
[
IEEE80211_RADIOTAP_DATA_RETRIES
];

179 
p
->
	`puÎ
(
	`Ë16_to_ıu
(
th
->
™_Ën
));

180 
p
->
	`£t_mac_h—d”
Õ->
	`d©a
());

183  
p
;

184 
	}
}

187 ’um {
	mH_DEBUG
};

189 
SŒšg


190 
	$RadiÙ­Deÿp_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

192 
RadiÙ­Deÿp
 *
td
 = (RadiÙ­Deÿ°*)
e
;

193 (
ušŒ_t
è
thunk
) {

194 
H_DEBUG
:

195  
	`SŒšg
(
td
->
_debug
) + "\n";

197  
	`SŒšg
();

199 
	}
}

201 
	$RadiÙ­Deÿp_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

202 
E¼ÜHªdËr
 *
”rh
)

204 
RadiÙ­Deÿp
 *
f
 = (RadiÙ­Deÿ°*)
e
;

205 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

206 (
šŒ_t
)
v·¿m
) {

207 
H_DEBUG
: {

208 
boŞ
 
debug
;

209 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

210  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

211 
f
->
_debug
 = 
debug
;

216 
	}
}

219 
	gRadiÙ­Deÿp
::
	$add_hªdËrs
()

221 
	`add_»ad_hªdËr
("debug", 
RadiÙ­Deÿp_»ad_·¿m
, 
H_DEBUG
);

223 
	`add_wr™e_hªdËr
("debug", 
RadiÙ­Deÿp_wr™e_·¿m
, 
H_DEBUG
);

224 
	}
}

225 
CLICK_ENDDECLS


226 
EXPORT_ELEMENT
(
RadiÙ­Deÿp
)

	@wifi/radiotapdecap.hh

1 #iâdeà
CLICK_RADIOTAPDECAP_HH


2 
	#CLICK_RADIOTAPDECAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


22 şas 
	cRadiÙ­Deÿp
 : 
public
 
EËm’t
 {…ublic:

24 
	$RadiÙ­Deÿp
(è
CLICK_COLD
;

25 ~
	$RadiÙ­Deÿp
(è
CLICK_COLD
;

27 cÚ¡ *
	$şass_Çme
() const {  "RadiotapDecap"; }

28 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

29 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

31 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

32 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

34 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

37 
	$add_hªdËrs
(è
CLICK_COLD
;

40 
boŞ
 
_debug
;

41 
´iv©e
:

43 
	}
};

45 
	gCLICK_ENDDECLS


	@wifi/radiotapencap.cc

18 
	~<şick/cÚfig.h
>

19 
	~"¿diÙ­’ÿp.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/wifi.h
>

25 
	~<şick/·ck‘_ªno.hh
>

26 
	~<şickÃt/Îc.h
>

27 
	~<şickÃt/¿diÙ­.h
>

28 
	gCLICK_DECLS


32 
	#CLICK_RADIOTAP_PRESENT
 ( \

33 (1 << 
IEEE80211_RADIOTAP_RATE
) | \

34 (1 << 
IEEE80211_RADIOTAP_DBM_TX_POWER
) | \

35 (1 << 
IEEE80211_RADIOTAP_TX_FLAGS
) | \

36 (1 << 
IEEE80211_RADIOTAP_DATA_RETRIES
) | \

37 0)

	)

39 
	sşick_¿diÙ­_h—d”
 {

40 
›“80211_¿diÙ­_h—d”
 
	mwt_ihdr
;

41 
u_št8_t
 
	mwt_¿‹
;

42 
u_št8_t
 
	mwt_txpow”
;

43 
u_št16_t
 
	mwt_tx_æags
;

44 
u_št8_t
 
	mwt_d©a_»Œ›s
;

52 
	gRadiÙ­Enÿp
::
	$RadiÙ­Enÿp
()

54 
	}
}

56 
RadiÙ­Enÿp
::~
	$RadiÙ­Enÿp
()

58 
	}
}

61 
RadiÙ­Enÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

63 
	g_debug
 = 
çl£
;

64  
Args
(
cÚf
, 
this
, 
”rh
).
»ad
("DEBUG", 
_debug
).
com¶‘e
();

67 
Pack‘
 *

68 
	gRadiÙ­Enÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

71 
Wr™abËPack‘
 *
p_out
 = 
p
->
	`uniqueify
();

72 ià(!
p_out
) {

73 
p
->
	`kl
();

77 
p_out
 =…_out->
	`push
((
şick_¿diÙ­_h—d”
));

79 ià(
p_out
) {

80 
şick_¿diÙ­_h—d”
 *
üh
 = (şick_¿diÙ­_h—d” *è
p_out
->
	`d©a
();

81 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p
);

83 
	`mem£t
(
üh
, 0, (
şick_¿diÙ­_h—d”
));

85 
üh
->
wt_ihdr
.
™_v”siÚ
 = 0;

86 
üh
->
wt_ihdr
.
™_Ën
 = 
	`ıu_to_Ë16
((
şick_¿diÙ­_h—d”
));

87 
üh
->
wt_ihdr
.
™_´e£Á
 = 
	`ıu_to_Ë32
(
CLICK_RADIOTAP_PRESENT
);

89 
üh
->
wt_¿‹
 = 
ûh
->
¿‹
;

90 
üh
->
wt_txpow”
 = 
ûh
->
pow”
;

91 ià(
ûh
->
æags
 & 
WIFI_EXTRA_TX_NOACK
) {

92 
üh
->
wt_tx_æags
 |ğ
IEEE80211_RADIOTAP_F_TX_NOACK
;

94 ià(
ûh
->
max_Œ›s
 > 0) {

95 
üh
->
wt_d©a_»Œ›s
 = 
ûh
->
max_Œ›s
 - 1;

97 
üh
->
wt_d©a_»Œ›s
 = 
WIFI_MAX_RETRIES
 + 1;

101  
p_out
;

102 
	}
}

105 ’um {
	mH_DEBUG
};

107 
SŒšg


108 
	$RadiÙ­Enÿp_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

110 
RadiÙ­Enÿp
 *
td
 = (RadiÙ­Enÿ°*)
e
;

111 (
ušŒ_t
è
thunk
) {

112 
H_DEBUG
:

113  
	`SŒšg
(
td
->
_debug
) + "\n";

115  
	`SŒšg
();

117 
	}
}

119 
	$RadiÙ­Enÿp_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

120 
E¼ÜHªdËr
 *
”rh
)

122 
RadiÙ­Enÿp
 *
f
 = (RadiÙ­Enÿ°*)
e
;

123 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

124 (
šŒ_t
)
v·¿m
) {

125 
H_DEBUG
: {

126 
boŞ
 
debug
;

127 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

128  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

129 
f
->
_debug
 = 
debug
;

134 
	}
}

137 
	gRadiÙ­Enÿp
::
	$add_hªdËrs
()

139 
	`add_»ad_hªdËr
("debug", 
RadiÙ­Enÿp_»ad_·¿m
, 
H_DEBUG
);

141 
	`add_wr™e_hªdËr
("debug", 
RadiÙ­Enÿp_wr™e_·¿m
, 
H_DEBUG
);

142 
	}
}

143 
CLICK_ENDDECLS


144 
EXPORT_ELEMENT
(
RadiÙ­Enÿp
)

	@wifi/radiotapencap.hh

1 #iâdeà
CLICK_RADIOTAPENCAP_HH


2 
	#CLICK_RADIOTAPENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


23 şas 
	cRadiÙ­Enÿp
 : 
public
 
EËm’t
 {…ublic:

25 
	$RadiÙ­Enÿp
(è
CLICK_COLD
;

26 ~
	$RadiÙ­Enÿp
(è
CLICK_COLD
;

28 cÚ¡ *
	$şass_Çme
() const {  "RadiotapEncap"; }

29 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

30 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

32 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

33 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

35 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

38 
	$add_hªdËrs
(è
CLICK_COLD
;

41 
boŞ
 
_debug
;

42 
´iv©e
:

44 
	}
};

46 
	gCLICK_ENDDECLS


	@wifi/rc4.cc

2 
	~<şick/cÚfig.h
>

3 
	~"rc4.hh
"

42 
	$sw­_by‹s
(*
a
, *
b
)

44 
‹mp
;

46 
‹mp
 = *
a
;

47 *
a
 = *
b
;

48 *
b
 = 
‹mp
;

49 
	}
}

56 
	$rc4_š™
(
rc4_¡©e
 *cÚ¡ 
¡©e
, cÚ¡ *
key
, 
keyËn
)

58 
j
;

59 
i
;

62 
i
 = 0; i < 256; i++)

63 
¡©e
->
³rm
[
i
] = ()i;

64 
¡©e
->
šdex1
 = 0;

65 
¡©e
->
šdex2
 = 0;

68 
j
 = 
i
 = 0; i < 256; i++) {

69 
j
 +ğ
¡©e
->
³rm
[
i
] + 
key
[˜% 
keyËn
];

70 
	`sw­_by‹s
(&
¡©e
->
³rm
[
i
], &¡©e->³rm[
j
]);

72 
	}
}

82 
	$rc4_üy±_sk
(
rc4_¡©e
 *cÚ¡ 
¡©e
,

83 cÚ¡ *
šbuf
, *
outbuf
, 
buæ’
, 
sk
)

85 
i
;

86 
j
;

88 
i
 = 0; i < 
sk
; i++) {

91 
¡©e
->
šdex1
++;

92 
¡©e
->
šdex2
 +ğ¡©e->
³rm
[¡©e->
šdex1
];

95 
	`sw­_by‹s
(&
¡©e
->
³rm
[¡©e->
šdex1
],

96 &
¡©e
->
³rm
[¡©e->
šdex2
]);

99 
j
 = 
¡©e
->
³rm
[¡©e->
šdex1
] + s‹->³rm[¡©e->
šdex2
];

101 
i
 = 0; i < 
buæ’
; i++) {

104 
¡©e
->
šdex1
++;

105 
¡©e
->
šdex2
 +ğ¡©e->
³rm
[¡©e->
šdex1
];

108 
	`sw­_by‹s
(&
¡©e
->
³rm
[¡©e->
šdex1
],

109 &
¡©e
->
³rm
[¡©e->
šdex2
]);

112 
j
 = 
¡©e
->
³rm
[¡©e->
šdex1
] + s‹->³rm[¡©e->
šdex2
];

113 
outbuf
[
i
] = 
šbuf
[i] ^ 
¡©e
->
³rm
[
j
];

115 
	}
}

123 
u_št32_t
 
	güc_bË
[256];

127 
	$üc_š™
()

129 
u_št32_t
 
c
;

130 
n
, 
k
;

132 
n
 = 0;‚ < 256;‚++) {

133 
c
 = (
u_št32_t
)
n
;

134 
k
 = 0; k < 8; k++) {

135 ià(
c
 & 1)

136 
c
 = 0xedb88320UL ^ (c >> 1);

138 
c
 = c >> 1;

140 
üc_bË
[
n
] = 
c
;

142 
	}
}

144 
u_št32_t


145 
	$rfc_2083_üc_upd©e
(
u_št32_t
 
üc
, 
u_št8_t
 *
buf
, 
Ën
)

147 
u_št8_t
 *
’dbuf
;

148 
š™Ÿlized
 = 0;

150 ià(
š™Ÿlized
 == 0) {

151 
š™Ÿlized
 = 1;

152 
	`üc_š™
();

155 
’dbuf
 = 
buf
 + 
Ën
; buf <ƒndbuf; buf++)

156 
üc
 = 
üc_bË
[(üø^ *
buf
) & 0xff] ^ (crc >> 8);

157  
üc
;

158 
	}
}

161 
ELEMENT_PROVIDES
(
rc4
)

	@wifi/rc4.hh

41 #iâdeà
CLICK_RC4


42 
	#CLICK_RC4


	)

44 
	~<şick/cÚfig.h
>

45 
	src4_¡©e
 {

46 
	m³rm
[256];

47 
	mšdex1
;

48 
	mšdex2
;

51 
rc4_š™
(
rc4_¡©e
 *
¡©e
, cÚ¡ *
key
, 
keyËn
);

52 
rc4_üy±_sk
(
rc4_¡©e
 *
¡©e
,

53 cÚ¡ *
šbuf
, *
outbuf
, 
buæ’
, 
sk
);

56 
u_št32_t
 
rfc_2083_üc_upd©e
(u_št32_ˆ
üc
, 
u_št8_t
 *
buf
, 
Ën
);

	@wifi/readanno.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/”rÜ.hh
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/·ck‘_ªno.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~"»adªno.hh
"

25 
CLICK_DECLS


28 
	gR—dAÂo
::
	$R—dAÂo
()

30 
	}
}

32 
R—dAÂo
::~
	$R—dAÂo
()

34 
	}
}

36 
Pack‘
 *

37 
R—dAÂo
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

39 ià(
p_š
) {

40 
	`memıy
(
p_š
->
	`ªno
(),…_š->
	`d©a
(), 
Pack‘
::
ªno_size
);

42  
p_š
;

43 
	}
}

45 
CLICK_ENDDECLS


48 
EXPORT_ELEMENT
(
R—dAÂo
)

	@wifi/readanno.hh

1 #iâdeà
CLICK_READANNO_HH


2 
	#CLICK_READANNO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/bighashm­.hh
>

6 
	~<şick/glue.hh
>

7 
CLICK_DECLS


27 şas 
	cR—dAÂo
 : 
public
 
EËm’t
 {…ublic:

29 
	$R—dAÂo
(è
CLICK_COLD
;

30 ~
	$R—dAÂo
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "ReadAnno"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  "a/a"; 
	}
}

36 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

40 
	gCLICK_ENDDECLS


	@wifi/rxstats.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şickÃt/‘h”.h
>

25 
	~<şickÃt/wifi.h
>

26 
	~"rx¡©s.hh
"

27 
CLICK_DECLS


29 
	gRXSts
::
	$RXSts
()

31 
bÿ¡_addr
[] = { 0xff, 0xff, 0xff, 0xff, 0xff, 0xff };

32 
_bÿ¡
 = 
	`Eth”Add»ss
(
bÿ¡_addr
);

33 
	}
}

35 
	gRXSts
::~
	$RXSts
()

37 
	}
}

39 
Pack‘
 *

40 
RXSts
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

42 
şick_‘h”
 *
eh
 = (şick_‘h” *è
p_š
->
	`d©a
();

43 
Eth”Add»ss
 
¤c
 = 
	`Eth”Add»ss
(
eh
->
‘h”_sho¡
);

44 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p_š
);

46 
D¡Info
 *
nfo
 = 
_ÃighbÜs
.
	`fšdp
(
¤c
);

47 ià(!
nfo
) {

48 
D¡Info
 
foo
 = 
	`D¡Info
(
¤c
);

49 
_ÃighbÜs
.
	`š£¹
(
¤c
, 
foo
);

50 
nfo
 = 
_ÃighbÜs
.
	`fšdp
(
¤c
);

53 
nfo
->
_¿‹
 = 
ûh
->
¿‹
;

54 
nfo
->
_sigÇl
 = 
ûh
->
rssi
;

55 
nfo
->
_noi£
 = 
ûh
->
s’û
;

57 
nfo
->
_·ck‘s
++;

58 
nfo
->
_sum_sigÇl
 +ğ
ûh
->
rssi
;

59 
nfo
->
_sum_noi£
 +ğ
ûh
->
s’û
;

60 
nfo
->
_Ï¡_»ûived
.
	`assign_now
();

62  
p_š
;

63 
	}
}

65 ’um {
	mH_STATS
, 
	mH_RESET
};

67 
SŒšg


68 
	$RXSts_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

70 
RXSts
 *
td
 = (RXSt *)
e
;

71 (
ušŒ_t
è
thunk
) {

72 
H_STATS
: {

73 
Time¡amp
 
now
 = Time¡amp::
	`now
();

75 
SŒšgAccum
 
§
;

76 
RXSts
::
NI‹r
 
™”
 = 
td
->
_ÃighbÜs
.
	`begš
(); i‹r.
	`live
(); iter++) {

77 
RXSts
::
D¡Info
 
n
 = 
™”
.
	`v®ue
();

78 
Time¡amp
 
age
 = 
now
 - 
n
.
_Ï¡_»ûived
;

79 
Time¡amp
 
avg_sigÇl
;

80 
Time¡amp
 
avg_noi£
;

81 ià(
n
.
_·ck‘s
) {

82 
avg_sigÇl
 = 
Time¡amp
::
	`make_m£c
(1000*
n
.
_sum_sigÇl
 /‚.
_·ck‘s
);

83 
avg_noi£
 = 
Time¡amp
::
	`make_m£c
(1000*
n
.
_sum_noi£
 /‚.
_·ck‘s
);

85 
§
 << 
n
.
_‘h
.
	`uÅ¬£
();

86 
§
 << "„©" << 
n
.
_¿‹
;

87 
§
 << " sigÇÈ" << 
n
.
_sigÇl
;

88 
§
 << "‚oi£ " << 
n
.
_noi£
;

89 
§
 << "‡vg_sigÇÈ" << 
avg_sigÇl
;

90 
§
 << "‡vg_noi£ " << 
avg_noi£
;

91 
§
 << "Ù®_sigÇÈ" << 
n
.
_sum_sigÇl
;

92 
§
 << "Ù®_noi£ " << 
n
.
_sum_noi£
;

93 
§
 << "…ack‘ " << 
n
.
_·ck‘s
;

94 
§
 << "†a¡_»ûived " << 
age
 << "\n";

96  
§
.
	`ke_¡ršg
();

100  
	`SŒšg
();

103 
	}
}

106 
	$RXSts_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

107 
E¼ÜHªdËr
 *)

109 
RXSts
 *
f
 = (RXSt *)
e
;

110 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

111 (
šŒ_t
)
v·¿m
) {

112 
H_RESET
: 
f
->
_ÃighbÜs
.
	`ş—r
();  0;

115 
	}
}

118 
	gRXSts
::
	$add_hªdËrs
()

120 
	`add_»ad_hªdËr
("¡©s", 
RXSts_»ad_·¿m
, 
H_STATS
);

121 
	`add_wr™e_hªdËr
("»£t", 
RXSts_wr™e_·¿m
, 
H_RESET
, 
HªdËr
::
BUTTON
);

123 
	}
}

125 
CLICK_ENDDECLS


126 
EXPORT_ELEMENT
(
RXSts
)

	@wifi/rxstats.hh

1 #iâdeà
CLICK_RXSTATS_HH


2 
	#CLICK_RXSTATS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
	~<şick/bighashm­.hh
>

6 
	~<şick/glue.hh
>

7 
CLICK_DECLS


33 şas 
	cRXSts
 : 
public
 
EËm’t
 {…ublic:

35 
	$RXSts
(è
CLICK_COLD
;

36 ~
	$RXSts
(è
CLICK_COLD
;

38 cÚ¡ *
	$şass_Çme
() const {  "RXStats"; }

39 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

40 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

42 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

44 
	$add_hªdËrs
(è
CLICK_COLD
;

46 şas 
	cD¡Info
 {

47 
public
:

48 
Eth”Add»ss
 
_‘h
;

49 
_¿‹
;

50 
_noi£
;

51 
_sigÇl
;

53 
_·ck‘s
;

54 
_sum_sigÇl
;

55 
_sum_noi£
;

56 
Time¡amp
 
_Ï¡_»ûived
;

58 
	`D¡Info
() {

59 
	`mem£t
(
this
, 0, (*this));

62 
	`D¡Info
(
Eth”Add»ss
 
‘h
) {

63 
	`mem£t
(
this
, 0, (*this));

64 
_‘h
 = 
‘h
;

67 
	}
};

68 
	gHashM­
<
	tEth”Add»ss
, 
	tD¡Info
> 
	tNeighbÜTabË
;

69 
	gNeighbÜTabË
::
	tcÚ¡_™”©Ü
 
	tNI‹r
;

71 
NeighbÜTabË
 
	g_ÃighbÜs
;

72 
Eth”Add»ss
 
	g_bÿ¡
;

73 
	g_u
;

78 
	gCLICK_ENDDECLS


	@wifi/setnoack.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
	~<şickÃt/‘h”.h
>

24 
	~<şick/‘h”add»ss.hh
>

25 
	~<şickÃt/wifi.h
>

26 
	~"£Šßck.hh
"

27 
CLICK_DECLS


29 
	gS‘NoAck
::
	$S‘NoAck
()

31 
	}
}

33 
S‘NoAck
::~
	$S‘NoAck
()

35 
	}
}

37 
Pack‘
 *

38 
S‘NoAck
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

40 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p_š
);

41 
ûh
->
æags
 |ğ
WIFI_EXTRA_TX_NOACK
;

43  
p_š
;

44 
	}
}

46 
CLICK_ENDDECLS


47 
EXPORT_ELEMENT
(
S‘NoAck
)

	@wifi/setnoack.hh

1 #iâdeà
CLICK_SETNOACK_HH


2 
	#CLICK_SETNOACK_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


27 şas 
	cS‘NoAck
 : 
public
 
EËm’t
 {…ublic:

29 
	$S‘NoAck
(è
CLICK_COLD
;

30 ~
	$S‘NoAck
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "SetNoAck"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

36 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

38 
	g´iv©e
:

41 
	gCLICK_ENDDECLS


	@wifi/setrts.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
	~"£Œts.hh
"

24 
	~<şickÃt/‘h”.h
>

25 
	~<şick/‘h”add»ss.hh
>

26 
CLICK_DECLS


28 
	gS‘RTS
::
	$S‘RTS
()

30 
	}
}

32 
S‘RTS
::~
	$S‘RTS
()

34 
	}
}

37 
S‘RTS
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

39  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_mp
("RTS", 
_¹s
).
com¶‘e
();

42 
Pack‘
 *

43 
	gS‘RTS
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

46 ià(
p
) {

47 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p
);

48 
ûh
->
magic
 = 
WIFI_EXTRA_MAGIC
;

49 ià(
_¹s
) {

50 
ûh
->
æags
 |ğ
WIFI_EXTRA_DO_RTS_CTS
;

52 
ûh
->
æags
 &ğ~
WIFI_EXTRA_DO_RTS_CTS
;

55  
p
;

56 
	}
}

58 ’um {
	mH_RTS
};

59 
SŒšg


60 
	$S‘RTS_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

62 
S‘RTS
 *
td
 = (S‘RTS *)
e
;

63 (
ušŒ_t
è
thunk
) {

64 
H_RTS
:

65  
	`SŒšg
(
td
->
_¹s
) + "\n";

67  
	`SŒšg
();

70 
	}
}

73 
	$S‘RTS_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

74 
E¼ÜHªdËr
 *
”rh
)

76 
S‘RTS
 *
f
 = (S‘RTS *)
e
;

77 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

78 (
šŒ_t
)
v·¿m
) {

79 
H_RTS
: {

80 
m
;

81 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

82  
”rh
->
	`”rÜ
("stepup…arameter must be unsigned");

83 
f
->
_¹s
 = 
m
;

89 
	}
}

91 
	gS‘RTS
::
	$add_hªdËrs
()

93 
	`add_»ad_hªdËr
("¹s", 
S‘RTS_»ad_·¿m
, 
H_RTS
);

94 
	`add_wr™e_hªdËr
("¹s", 
S‘RTS_wr™e_·¿m
, 
H_RTS
);

95 
	}
}

97 
CLICK_ENDDECLS


98 
EXPORT_ELEMENT
(
S‘RTS
)

	@wifi/setrts.hh

1 #iâdeà
CLICK_SETRTS_HH


2 
	#CLICK_SETRTS_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
	~<şickÃt/wifi.h
>

6 
CLICK_DECLS


27 şas 
	cS‘RTS
 : 
public
 
EËm’t
 {…ublic:

29 
	$S‘RTS
(è
CLICK_COLD
;

30 ~
	$S‘RTS
(è
CLICK_COLD
;

32 cÚ¡ *
	$şass_Çme
() const {  "SetRTS"; }

33 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

34 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

36 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

37 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

39 
	$add_hªdËrs
(è
CLICK_COLD
;

40 
boŞ
 
_¹s
;

41 
	}
};

43 
	gCLICK_ENDDECLS


	@wifi/settxpower.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
	~"£‰xpow”.hh
"

24 
	~<şickÃt/‘h”.h
>

25 
	~<şickÃt/wifi.h
>

26 
	~<şick/‘h”add»ss.hh
>

27 
CLICK_DECLS


29 
	gS‘TXPow”
::
	$S‘TXPow”
()

31 
	}
}

33 
S‘TXPow”
::~
	$S‘TXPow”
()

35 
	}
}

38 
S‘TXPow”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40 
	g_pow”
 = 0;

41  
Args
(
cÚf
, 
this
, 
”rh
).
»ad_p
("POWER", 
_pow”
).
com¶‘e
();

44 
Pack‘
 *

45 
	gS‘TXPow”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

47 ià(
p_š
) {

48 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p_š
);

49 
ûh
->
magic
 = 
WIFI_EXTRA_MAGIC
;

50 
ûh
->
pow”
 = 
_pow”
;

51  
p_š
;

54 
	}
}

56 ’um {
	mH_POWER
,

59 
SŒšg


60 
	$S‘TXPow”_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

62 
S‘TXPow”
 *
td
 = (S‘TXPow” *)
e
;

63 (
ušŒ_t
è
thunk
) {

64 
H_POWER
:

65  
	`SŒšg
(
td
->
_pow”
) + "\n";

67  
	`SŒšg
();

69 
	}
}

71 
	$S‘TXPow”_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

72 
E¼ÜHªdËr
 *
”rh
)

74 
S‘TXPow”
 *
f
 = (S‘TXPow” *)
e
;

75 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

76 (
šŒ_t
)
v·¿m
) {

77 
H_POWER
: {

78 
m
;

79 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

80  
”rh
->
	`”rÜ
("power…arameter must be unsigned");

81 
f
->
_pow”
 = 
m
;

87 
	}
}

89 
	gS‘TXPow”
::
	$add_hªdËrs
()

91 
	`add_»ad_hªdËr
("pow”", 
S‘TXPow”_»ad_·¿m
, 
H_POWER
);

92 
	`add_wr™e_hªdËr
("pow”", 
S‘TXPow”_wr™e_·¿m
, 
H_POWER
);

93 
	}
}

95 
CLICK_ENDDECLS


96 
EXPORT_ELEMENT
(
S‘TXPow”
)

	@wifi/settxpower.hh

1 #iâdeà
CLICK_SETTXPOWER_HH


2 
	#CLICK_SETTXPOWER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


34 şas 
	cS‘TXPow”
 : 
public
 
EËm’t
 {…ublic:

36 
	$S‘TXPow”
(è
CLICK_COLD
;

37 ~
	$S‘TXPow”
(è
CLICK_COLD
;

39 cÚ¡ *
	$şass_Çme
() const {  "SetTXPower"; }

40 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

41 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

43 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

44 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

46 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

48 
	$add_hªdËrs
(è
CLICK_COLD
;

49 
_pow”
;

51 
	}
};

53 
	gCLICK_ENDDECLS


	@wifi/settxrate.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şick/·ck‘_ªno.hh
>

23 
	~"£‰x¿‹.hh
"

24 
	~<şickÃt/‘h”.h
>

25 
	~<şick/‘h”add»ss.hh
>

26 
	~<şickÃt/wifi.h
>

27 
CLICK_DECLS


29 
	gS‘TXR©e
::
	$S‘TXR©e
()

31 
	}
}

33 
S‘TXR©e
::~
	$S‘TXR©e
()

35 
	}
}

38 
S‘TXR©e
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

40 
	g_¿‹
 = 0;

41 
	g_‘
 = 0;

42 
	g_off£t
 = 0;

43 
	g_Œ›s
 = 
WIFI_MAX_RETRIES
+1;

44 ià(
Args
(
cÚf
, 
this
, 
”rh
)

45 .
»ad_p
("RATE", 
_¿‹
)

46 .
»ad
("TRIES", 
_Œ›s
)

47 .
»ad
("ETHTYPE", 
_‘
)

48 .
»ad
("OFFSET", 
_off£t
)

49 .
com¶‘e
() < 0) {

53 ià(
	g_¿‹
 < 0) {

54  
	g”rh
->
”rÜ
("RATE must be >= 0");

57 ià(
	g_Œ›s
 < 1) {

58  
	g”rh
->
”rÜ
("TRIES must be >= 0");

65 
Pack‘
 *

66 
	gS‘TXR©e
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

68 
ušt8_t
 *
d¡_±r
 = (ušt8_ˆ*è
p_š
->
	`d©a
(è+ 
_off£t
;

69 
şick_‘h”
 *
eh
 = (şick_‘h” *è
d¡_±r
;

71 ià(
_‘
 && 
eh
->
‘h”_ty³
 !ğ
	`htÚs
(_et)) {

72  
p_š
;

75 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p_š
);

76 
ûh
->
magic
 = 
WIFI_EXTRA_MAGIC
;

77 
ûh
->
¿‹
 = 
_¿‹
 ? _rate : 2;

78 
ûh
->
max_Œ›s
 = 
_Œ›s
;

80  
p_š
;

81 
	}
}

82 ’um {
	mH_RATE
, 
	mH_TRIES
};

84 
SŒšg


85 
	gS‘TXR©e
::
	$»ad_hªdËr
(
EËm’t
 *
e
, *
thunk
)

87 
S‘TXR©e
 *
foo
 = (S‘TXR©*)
e
;

88 (
ušŒ_t
è
thunk
) {

89 
H_RATE
:  
	`SŒšg
(
foo
->
_¿‹
) + "\n";

90 
H_TRIES
:  
	`SŒšg
(
foo
->
_Œ›s
) + "\n";

94 
	}
}

97 
	gS‘TXR©e
::
	$wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
e
,

98 *
v·¿m
, 
E¼ÜHªdËr
 *
”rh
)

100 
S‘TXR©e
 *
f
 = (S‘TXR©*è
e
;

101 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
¬g
);

102 (
šŒ_t
)
v·¿m
) {

103 
H_RATE
: {

104 
m
;

105 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

106  
”rh
->
	`”rÜ
("rate…arameter must be unsigned");

107 
f
->
_¿‹
 = 
m
;

110 
H_TRIES
: {

111 
m
;

112 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

113  
”rh
->
	`”rÜ
("tries…arameter must be unsigned");

114 
f
->
_Œ›s
 = 
m
;

119 
	}
}

122 
	gS‘TXR©e
::
	$add_hªdËrs
()

124 
	`add_»ad_hªdËr
("¿‹", 
»ad_hªdËr
, 
H_RATE
);

125 
	`add_»ad_hªdËr
("Œ›s", 
»ad_hªdËr
, 
H_TRIES
);

126 
	`add_wr™e_hªdËr
("¿‹", 
wr™e_hªdËr
, 
H_RATE
);

127 
	`add_wr™e_hªdËr
("Œ›s", 
wr™e_hªdËr
, 
H_TRIES
);

128 
	}
}

130 
CLICK_ENDDECLS


131 
EXPORT_ELEMENT
(
S‘TXR©e
)

	@wifi/settxrate.hh

1 #iâdeà
CLICK_SETTXRATE_HH


2 
	#CLICK_SETTXRATE_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/glue.hh
>

5 
CLICK_DECLS


34 şas 
	cS‘TXR©e
 : 
public
 
EËm’t
 {…ublic:

36 
	$S‘TXR©e
(è
CLICK_COLD
;

37 ~
	$S‘TXR©e
(è
CLICK_COLD
;

39 cÚ¡ *
	$şass_Çme
() const {  "SetTXRate"; }

40 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

41 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

43 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

44 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

46 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

48 
	$add_hªdËrs
(è
CLICK_COLD
;

49 
SŒšg
 
	$»ad_hªdËr
(
EËm’t
 *
e
, *è
CLICK_COLD
;

50 
	`wr™e_hªdËr
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
e
,

51 *, 
E¼ÜHªdËr
 *
”rh
);

52 
´iv©e
:

54 
_¿‹
;

55 
_Œ›s
;

56 
ušt16_t
 
_‘
;

57 
_off£t
;

58 
	}
};

60 
	gCLICK_ENDDECLS


	@wifi/station/associationrequester.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şickÃt/wifi.h
>

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/Îc.h
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/veùÜ.hh
>

27 
	~<şick/hashm­.hh
>

28 
	~<şick/·ck‘_ªno.hh
>

29 
	~<–em’ts/wifi/avaabË¿‹s.hh
>

30 
	~<–em’ts/wifi/wœ–essšfo.hh
>

31 
	~"assocŸtiÚ»que¡”.hh
"

33 
CLICK_DECLS


35 
	gAssocŸtiÚReque¡”
::
	$AssocŸtiÚReque¡”
()

36 : 
	`_¹abË
(0),

37 
	$_wšfo
(0)

39 
	}
}

41 
	gAssocŸtiÚReque¡”
::~
	$AssocŸtiÚReque¡”
()

43 
	}
}

46 
AssocŸtiÚReque¡”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

49 
	g_debug
 = 
çl£
;

50 
	g_assocŸ‹d
 = 
çl£
;

51 ià(
Args
(
cÚf
, 
this
, 
”rh
)

52 .
»ad
("DEBUG", 
_debug
)

53 .
»ad
("ETH", 
_‘h
)

54 .
»ad
("WIRELESS_INFO", 
EËm’tCa¡Arg
("Wœ–essInfo"), 
_wšfo
)

55 .
»ad_m
("RT", 
EËm’tCa¡Arg
("AvaabËR©es"), 
_¹abË
)

56 .
com¶‘e
() < 0)

62 
	gAssocŸtiÚReque¡”
::
	$£nd_assoc_»q
()

64 
Eth”Add»ss
 
bssid
 = 
_wšfo
 ? _wšfo->
_bssid
 : 
	`Eth”Add»ss
();

65 
SŒšg
 
ssid
 = 
_wšfo
 ? _wšfo->
_ssid
 : "";

66 
lš‹rv®
 = 
_wšfo
 ? _wšfo->
_š‹rv®
 : 1;

67 
VeùÜ
<> 
¿‹s
 = 
_¹abË
->
	`lookup
(
bssid
);

68 
max_Ën
 =  (
şick_wifi
) +

71 2 + 
ssid
.
	`Ëngth
() +

72 2 + 
WIFI_RATES_MAXSIZE
 +

73 2 + 
WIFI_RATES_MAXSIZE
 +

77 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
max_Ën
);

79 if(
p
 == 0)

83 ià(!
¿‹s
.
	`size
()) {

84 
	`şick_ch©‹r
("%p{element}: couldn't†ookup„ates for %s\n",

85 
this
,

86 
bssid
.
	`uÅ¬£
().
	`c_¡r
());

88 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

89 
w
->
i_fc
[0] = 
WIFI_FC0_VERSION_0
 | 
WIFI_FC0_TYPE_MGT
 | 
WIFI_FC0_SUBTYPE_ASSOC_REQ
;

90 
w
->
i_fc
[1] = 
WIFI_FC1_DIR_NODS
;

92 
w
->
i_dur
 = 0;

93 
w
->
i_£q
 = 0;

95 
	`memıy
(
w
->
i_addr1
, 
bssid
.
	`d©a
(), 6);

96 
	`memıy
(
w
->
i_addr2
, 
_‘h
.
	`d©a
(), 6);

97 
	`memıy
(
w
->
i_addr3
, 
bssid
.
	`d©a
(), 6);

99 
ušt8_t
 *
±r
 = (ušt8_ˆ*è
p
->
	`d©a
(è+ (
şick_wifi
);

100 
aùu®_Ëngth
 =  (
şick_wifi
);

102 
ušt16_t
 
ÿ·b™y
 = 0;

103 
ÿ·b™y
 |ğ
WIFI_CAPINFO_ESS
;

104 ià(
_wšfo
 && _wšfo->
_w•
) {

105 
ÿ·b™y
 |ğ
WIFI_CAPINFO_PRIVACY
;

109 *(
ušt16_t
 *è
±r
 = 
	`ıu_to_Ë16
(
ÿ·b™y
);

110 
±r
 += 2;

111 
aùu®_Ëngth
 += 2;

114 *(
ušt16_t
 *è
±r
 = 
	`ıu_to_Ë16
(
lš‹rv®
);

115 
±r
 += 2;

116 
aùu®_Ëngth
 += 2;

118 
±r
[0] = 
WIFI_ELEMID_SSID
;

119 
±r
[1] = 
ssid
.
	`Ëngth
();

120 
±r
 += 2;

121 
aùu®_Ëngth
 += 2;

123 
	`memıy
(
±r
, 
ssid
.
	`c_¡r
(), ssid.
	`Ëngth
());

124 
±r
 +ğ
ssid
.
	`Ëngth
();

125 
aùu®_Ëngth
 +ğ
ssid
.
	`Ëngth
();

128 
±r
[0] = 
WIFI_ELEMID_RATES
;

129 
±r
[1] = 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
());

130 
x
 = 0; x < 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
()); x++) {

131 
±r
[2 + 
x
] = (
ušt8_t
è
¿‹s
[x];

133 ià(
¿‹s
[
x
] == 2) {

134 
±r
 [2 + 
x
] |ğ
WIFI_RATE_BASIC
;

137 ià(
_wšfo
 && _wšfo->
_chªÃl
 > 15 && 
¿‹s
[
x
] == 12) {

138 
±r
 [2 + 
x
] |ğ
WIFI_RATE_BASIC
;

142 
±r
 +ğ2 + 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
());

143 
aùu®_Ëngth
 +ğ2 + 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
());

146 
num_x¿‹s
 = 
¿‹s
.
	`size
(è- 
WIFI_RATE_SIZE
;

147 ià(
num_x¿‹s
 > 0) {

149 
±r
[0] = 
WIFI_ELEMID_XRATES
;

150 
±r
[1] = 
num_x¿‹s
;

151 
x
 = 0; x < 
num_x¿‹s
; x++) {

152 
±r
[2 + 
x
] = (
ušt8_t
è
¿‹s
[x + 
WIFI_RATE_SIZE
];

154 ià(
¿‹s
[
x
 + 
WIFI_RATE_SIZE
] == 2) {

155 
±r
 [2 + 
x
] |ğ
WIFI_RATE_BASIC
;

157 ià(
_wšfo
 && _wšfo->
_chªÃl
 > 15 && 
¿‹s
[
x
] == 12) {

158 
±r
 [2 + 
x
] |ğ
WIFI_RATE_BASIC
;

162 
±r
 +ğ2 + 
num_x¿‹s
;

163 
aùu®_Ëngth
 +ğ2 + 
num_x¿‹s
;

166 
p
->
	`ke
(
max_Ën
 - 
aùu®_Ëngth
);

167 
_assocŸ‹d
 = 
çl£
;

168 
	`ouut
(0).
	`push
(
p
);

169 
	}
}

172 
	gAssocŸtiÚReque¡”
::
	$´oûss_»¥Ú£
(
Pack‘
 *
p
)

174 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

175 
Eth”Add»ss
 
bssid
 = 
	`Eth”Add»ss
(
w
->
i_addr3
);

176 
ušt8_t
 *
±r
;

178 
±r
 = (
ušt8_t
 *è
p
->
	`d©a
(è+ (
şick_wifi
);

180 
ušt16_t
 
ÿ·b™y
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

181 
±r
 += 2;

183 
ušt16_t
 
¡©us
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

184 
±r
 += 2;

186 
ušt16_t
 
associd
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

187 
±r
 += 2;

189 
ušt8_t
 *
¿‹s_l
 = 
±r
;

191 
VeùÜ
<> 
basic_¿‹s
;

192 
VeùÜ
<> 
¿‹s
;

193 
VeùÜ
<> 
®l_¿‹s
;

194 ià(
¿‹s_l
) {

195 
x
 = 0; x < 
	`WIFI_MIN
(()
¿‹s_l
[1], 
WIFI_RATES_MAXSIZE
); x++) {

196 
ušt8_t
 
¿‹
 = 
¿‹s_l
[
x
 + 2];

198 ià(
¿‹
 & 
WIFI_RATE_BASIC
) {

199 
basic_¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

201 
¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

203 
®l_¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

207 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p
);

208 
SŒšgAccum
 
§
;

209 
§
 << 
bssid
 << " ";

210 
rssi
 = 
ûh
->rssi;

211 
§
 << "+" << 
rssi
 << " ";

213 
§
 << "[ ";

214 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_ESS
) {

215 
§
 << "ESS ";

217 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_IBSS
) {

218 
§
 << "IBSS ";

220 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_CF_POLLABLE
) {

221 
§
 << "CF_POLLABLE ";

223 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_CF_POLLREQ
) {

224 
§
 << "CF_POLLREQ ";

226 ià(
ÿ·b™y
 & 
WIFI_CAPINFO_PRIVACY
) {

227 
§
 << "PRIVACY ";

229 
§
 << "] ";

231 
§
 << "¡©u " << 
¡©us
 << " ";

232 
§
 << "associd " << 
associd
 << " ";

234 
§
 << "( { ";

235 
x
 = 0; x < 
basic_¿‹s
.
	`size
(); x++) {

236 
§
 << 
basic_¿‹s
[
x
] << " ";

238 
§
 << "} ";

239 
x
 = 0; x < 
¿‹s
.
	`size
(); x++) {

240 
§
 << 
¿‹s
[
x
] << " ";

243 
§
 << ")";

244 ià(
_debug
) {

245 
	`şick_ch©‹r
("%p{element}:„esponse %s\n",

246 
this
,

247 
§
.
	`ke_¡ršg
().
	`c_¡r
());

250 ià(
_¹abË
) {

251 
_¹abË
->
	`š£¹
(
bssid
, 
®l_¿‹s
);

254 ià(
¡©us
 == 0) {

255 
_assocŸ‹d
 = 
Œue
;

258 
	}
}

261 
	gAssocŸtiÚReque¡”
::
	$´oûss_di§ssocŸtiÚ
(
Pack‘
 *
p
)

263 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

264 
ušt8_t
 *
±r
 = (ušt8_ˆ*è
p
->
	`d©a
(è+ (
şick_wifi
);

265 
Eth”Add»ss
 
bssid
 = 
	`Eth”Add»ss
(
w
->
i_addr3
);

266 
ušt16_t
 
»asÚ
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

268 
±r
 += 2;

270 ià(
_wšfo
 && _wšfo->
_bssid
 =ğ
bssid
) {

271 
	`şick_ch©‹r
("%p{element} disassociation from %s„eason %d\n",

272 
this
,

273 
bssid
.
	`uÅ¬£
().
	`c_¡r
(),

274 
»asÚ
);

275 
_assocŸ‹d
 = 
çl£
;

277 
	`şick_ch©‹r
("%p{element} BAD disassociation from %s„eason %d\n",

278 
this
,

279 
bssid
.
	`uÅ¬£
().
	`c_¡r
(),

280 
»asÚ
);

283 
	}
}

285 
	gAssocŸtiÚReque¡”
::
	$push
(, 
Pack‘
 *
p
)

288 
ušt8_t
 
dœ
;

289 
ušt8_t
 
ty³
;

290 
ušt8_t
 
subty³
;

293 ià(
p
->
	`Ëngth
(è< (
şick_wifi
)) {

294 
	`şick_ch©‹r
("%p{element}:…acketoo small: %d vs %d\n",

295 
this
,

296 
p
->
	`Ëngth
(),

297 (
şick_wifi
));

299 
p
->
	`kl
();

304 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

307 
dœ
 = 
w
->
i_fc
[1] & 
WIFI_FC1_DIR_MASK
;

308 
ty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_TYPE_MASK
;

309 
subty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_SUBTYPE_MASK
;

311 ià(
ty³
 !ğ
WIFI_FC0_TYPE_MGT
) {

312 
	`şick_ch©‹r
("%p{element}:„eceived‚on-management…acket\n",

313 
this
);

314 
p
->
	`kl
();

318 ià(
subty³
 =ğ
WIFI_FC0_SUBTYPE_ASSOC_RESP
) {

319 
	`´oûss_»¥Ú£
(
p
);

320 
p
->
	`kl
();

324 ià(
subty³
 =ğ
WIFI_FC0_SUBTYPE_DISASSOC
) {

325 
	`´oûss_di§ssocŸtiÚ
(
p
);

326 
p
->
	`kl
();

331 
	`şick_ch©‹r
("%p{element}:„eceived‚on-assoc„esponse…acket\n",

332 
this
);

333 
p
->
	`kl
();

336 
	}
}

338 ’um {
	mH_DEBUG
, 
	mH_ETH
,

339 
	mH_SEND_ASSOC_REQ
,

340 
	mH_ASSOCIATED
,

343 
SŒšg


344 
	$AssocŸtiÚReque¡”_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

346 
AssocŸtiÚReque¡”
 *
td
 = (AssocŸtiÚReque¡” *)
e
;

347 (
ušŒ_t
è
thunk
) {

348 
H_DEBUG
:

349  
	`SŒšg
(
td
->
_debug
) + "\n";

350 
H_ASSOCIATED
:

351  
	`SŒšg
(
td
->
_assocŸ‹d
) + "\n";

352 
H_ETH
:

353  
td
->
_‘h
.
	`uÅ¬£
() + "\n";

355  
	`SŒšg
();

357 
	}
}

359 
	$AssocŸtiÚReque¡”_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

360 
E¼ÜHªdËr
 *
”rh
)

362 
AssocŸtiÚReque¡”
 *
f
 = (AssocŸtiÚReque¡” *)
e
;

363 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

364 (
šŒ_t
)
v·¿m
) {

365 
H_DEBUG
: {

366 
boŞ
 
debug
;

367 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

368  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

369 
f
->
_debug
 = 
debug
;

372 
H_ETH
: {

373 
Eth”Add»ss
 
e
;

374 ià(!
	`ı_‘h”Ãt_add»ss
(
s
, &
e
))

375  
”rh
->
	`”rÜ
("eth…arameter must beƒthernet‡ddress");

376 
f
->
_‘h
 = 
e
;

379 
H_SEND_ASSOC_REQ
: {

380 
f
->
	`£nd_assoc_»q
();

384 
	}
}

387 
	gAssocŸtiÚReque¡”
::
	$add_hªdËrs
()

389 
	`add_»ad_hªdËr
("debug", 
AssocŸtiÚReque¡”_»ad_·¿m
, 
H_DEBUG
);

390 
	`add_»ad_hªdËr
("‘h", 
AssocŸtiÚReque¡”_»ad_·¿m
, 
H_ETH
);

391 
	`add_»ad_hªdËr
("assocŸ‹d", 
AssocŸtiÚReque¡”_»ad_·¿m
, 
H_ASSOCIATED
);

394 
	`add_wr™e_hªdËr
("debug", 
AssocŸtiÚReque¡”_wr™e_·¿m
, 
H_DEBUG
);

395 
	`add_wr™e_hªdËr
("‘h", 
AssocŸtiÚReque¡”_wr™e_·¿m
, 
H_ETH
);

396 
	`add_wr™e_hªdËr
("£nd_assoc_»q", 
AssocŸtiÚReque¡”_wr™e_·¿m
, 
H_SEND_ASSOC_REQ
);

398 
	}
}

400 
CLICK_ENDDECLS


401 
EXPORT_ELEMENT
(
AssocŸtiÚReque¡”
)

	@wifi/station/associationrequester.hh

1 #iâdeà
CLICK_ASSOCIATIONREQUESTER_HH


2 
	#CLICK_ASSOCIATIONREQUESTER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
CLICK_DECLS


40 şas 
	cAssocŸtiÚReque¡”
 : 
public
 
EËm’t
 {…ublic:

42 
	$AssocŸtiÚReque¡”
(è
CLICK_COLD
;

43 ~
	$AssocŸtiÚReque¡”
(è
CLICK_COLD
;

45 cÚ¡ *
	$şass_Çme
() const {  "AssociationRequester"; }

46 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

47 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

49 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

50 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

52 
push
(, 
Pack‘
 *);

53 
£nd_assoc_»q
();

55 
	$add_hªdËrs
(è
CLICK_COLD
;

56 
	`»£t
();

59 
	`´oûss_»¥Ú£
(
Pack‘
 *
p
);

60 
	`´oûss_di§ssocŸtiÚ
(
Pack‘
 *
p
);

61 
boŞ
 
_debug
;

64 
boŞ
 
_assocŸ‹d
;

65 
Eth”Add»ss
 
_‘h
;

66 
şass
 
AvaabËR©es
 *
_¹abË
;

67 
şass
 
Wœ–essInfo
 *
_wšfo
;

69 
SŒšg
 
	`sÿn_¡ršg
();

71 
´iv©e
:

75 
	}
};

77 
	gCLICK_ENDDECLS


	@wifi/station/beaconscanner.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şickÃt/wifi.h
>

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/Îc.h
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/veùÜ.hh
>

27 
	~<şick/hashm­.hh
>

28 
	~<şick/·ck‘_ªno.hh
>

29 
	~<–em’ts/wifi/avaabË¿‹s.hh
>

30 
	~<–em’ts/wifi/wœ–essšfo.hh
>

31 
	~"b—cÚsÿÂ”.hh
"

32 
CLICK_DECLS


34 
	gB—cÚSÿÂ”
::
	$B—cÚSÿÂ”
()

35 : 
	`_¹abË
(0),

36 
	$_wšfo
(0)

38 
	}
}

40 
	gB—cÚSÿÂ”
::~
	$B—cÚSÿÂ”
()

42 
	}
}

45 
B—cÚSÿÂ”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

48 
	g_debug
 = 
çl£
;

49 ià(
Args
(
cÚf
, 
this
, 
”rh
)

50 .
»ad
("DEBUG", 
_debug
)

51 .
»ad
("WIRELESS_INFO", 
EËm’tCa¡Arg
("Wœ–essInfo"), 
_wšfo
)

52 .
»ad_m
("RT", 
EËm’tCa¡Arg
("AvaabËR©es"), 
_¹abË
)

53 .
com¶‘e
() < 0)

59 
Pack‘
 *

60 
	gB—cÚSÿÂ”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

64 
ušt8_t
 
dœ
;

65 
ušt8_t
 
ty³
;

66 
ušt8_t
 
subty³
;

69 ià(
_wšfo
 && _wšfo->
_chªÃl
 < 0) {

70  
p
;

73 ià(
p
->
	`Ëngth
(è< (
şick_wifi
)) {

74  
p
;

76 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

79 
dœ
 = 
w
->
i_fc
[1] & 
WIFI_FC1_DIR_MASK
;

80 
ty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_TYPE_MASK
;

81 
subty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_SUBTYPE_MASK
;

83 ià(
ty³
 !ğ
WIFI_FC0_TYPE_MGT
) {

84  
p
;

87 ià(
subty³
 !ğ
WIFI_FC0_SUBTYPE_BEACON
 && subty³ !ğ
WIFI_FC0_SUBTYPE_PROBE_RESP
) {

88  
p
;

91 
ušt8_t
 *
±r
;

93 
±r
 = (
ušt8_t
 *è
p
->
	`d©a
(è+ (
şick_wifi
);

96 
±r
 += 8;

98 
ušt16_t
 
b—cÚ_št
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

99 
±r
 += 2;

101 
ušt16_t
 
ÿ·b™y
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

102 
±r
 += 2;

105 
ušt8_t
 *
’d
 = (ušt8_ˆ*è
p
->
	`d©a
(è+…->
	`Ëngth
();

107 
ušt8_t
 *
ssid_l
 = 
NULL
;

108 
ušt8_t
 *
¿‹s_l
 = 
NULL
;

109 
ušt8_t
 *
x¿‹s_l
 = 
NULL
;

110 
ušt8_t
 *
ds_l
 = 
NULL
;

111 
±r
 < 
’d
) {

112 *
±r
) {

113 
WIFI_ELEMID_SSID
:

114 
ssid_l
 = 
±r
;

116 
WIFI_ELEMID_RATES
:

117 
¿‹s_l
 = 
±r
;

119 
WIFI_ELEMID_XRATES
:

120 
x¿‹s_l
 = 
±r
;

122 
WIFI_ELEMID_FHPARMS
:

124 
WIFI_ELEMID_DSPARMS
:

125 
ds_l
 = 
±r
;

127 
WIFI_ELEMID_IBSSPARMS
:

129 
WIFI_ELEMID_TIM
:

131 
WIFI_ELEMID_ERP
:

133 
WIFI_ELEMID_VENDOR
:

140 ià(
_debug
) {

141 
	`şick_ch©‹r
("%p{element}: ignoredƒlement id %u %u \n",

142 
this
,

143 *
±r
,

144 
±r
[1]);

147 
±r
 +=…tr[1] + 2;

152 ià(
_wšfo
 && _wšfo->
_chªÃl
 > 0 && 
ds_l
 && ds_l[2] != _winfo->_channel) {

153  
p
;

155 
SŒšg
 
ssid
 = "";

156 ià(
ssid_l
 && ssid_l[1]) {

157 
ssid
 = 
	`SŒšg
((*è
ssid_l
 + 2, 
	`WIFI_MIN
(()ssid_l[1], 
WIFI_NWID_MAXSIZE
));

160 
Eth”Add»ss
 
bssid
 = 
	`Eth”Add»ss
(
w
->
i_addr3
);

162 
w­
 *
­
 = 
_w­s
.
	`fšdp
(
bssid
);

163 ià(!
­
) {

164 
_w­s
.
	`š£¹
(
bssid
, 
	`w­
());

165 
­
 = 
_w­s
.
	`fšdp
(
bssid
);

166 
­
->
_ssid
 = "";

169 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p
);

171 
­
->
_‘h
 = 
bssid
;

172 ià(
ssid
 != "") {

174 
­
->
_ssid
 = 
ssid
;

176 
­
->
_chªÃl
 = (
ds_l
) ? ds_l[2] : -1;

177 
­
->
_rssi
 = 
ûh
->
rssi
;

179 
­
->
_ÿ·b™y
 = 
ÿ·b™y
;

180 
­
->
_b—cÚ_št
 = 
b—cÚ_št
;

181 
­
->
_basic_¿‹s
.
	`ş—r
();

182 
­
->
_¿‹s
.
	`ş—r
();

183 
VeùÜ
<> 
®l_¿‹s
;

184 
­
->
_Ï¡_rx
.
	`assign_now
();

185 ià(
¿‹s_l
) {

186 
x
 = 0; x < 
	`WIFI_MIN
(()
¿‹s_l
[1], 
WIFI_RATE_SIZE
); x++) {

187 
ušt8_t
 
¿‹
 = 
¿‹s_l
[
x
 + 2];

189 ià(
¿‹
 & 
WIFI_RATE_BASIC
) {

190 
­
->
_basic_¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

192 
­
->
_¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

194 
®l_¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

199 ià(
x¿‹s_l
) {

200 
x
 = 0; x < 
	`WIFI_MIN
(()
x¿‹s_l
[1], 
WIFI_RATE_SIZE
); x++) {

201 
ušt8_t
 
¿‹
 = 
x¿‹s_l
[
x
 + 2];

203 ià(
¿‹
 & 
WIFI_RATE_BASIC
) {

204 
­
->
_basic_¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

206 
­
->
_¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

208 
®l_¿‹s
.
	`push_back
(()(
¿‹
 & 
WIFI_RATE_VAL
));

212 ià(
_¹abË
) {

213 
_¹abË
->
	`š£¹
(
bssid
, 
®l_¿‹s
);

216  
p
;

217 
	}
}

220 
SŒšg


221 
	gB—cÚSÿÂ”
::
	$sÿn_¡ršg
()

223 
SŒšgAccum
 
§
;

224 
Time¡amp
 
now
 = Time¡amp::
	`now
();

225 
API‹r
 
™”
 = 
_w­s
.
	`begš
(); i‹r.
	`live
(); iter++) {

226 
w­
 
­
 = 
™”
.
	`v®ue
();

227 
§
 << 
­
.
_‘h
 << " ";

228 
§
 << "chªÃÈ" << 
­
.
_chªÃl
 << " ";

229 
§
 << "rss˜" << 
­
.
_rssi
 << " ";

230 
§
 << "ssid ";

232 if(
­
.
_ssid
 == "") {

233 
§
 << "(none) ";

235 
§
 << 
­
.
_ssid
 << " ";

237 
§
 << "b—cÚ_š‹rv® " << 
­
.
_b—cÚ_št
 << " ";

238 
§
 << "Ï¡_rx " << 
now
 - 
­
.
_Ï¡_rx
 << " ";

240 
§
 << "[ ";

241 ià(
­
.
_ÿ·b™y
 & 
WIFI_CAPINFO_ESS
) {

242 
§
 << "ESS ";

244 ià(
­
.
_ÿ·b™y
 & 
WIFI_CAPINFO_IBSS
) {

245 
§
 << "IBSS ";

247 ià(
­
.
_ÿ·b™y
 & 
WIFI_CAPINFO_CF_POLLABLE
) {

248 
§
 << "CF_POLLABLE ";

250 ià(
­
.
_ÿ·b™y
 & 
WIFI_CAPINFO_CF_POLLREQ
) {

251 
§
 << "CF_POLLREQ ";

253 ià(
­
.
_ÿ·b™y
 & 
WIFI_CAPINFO_PRIVACY
) {

254 
§
 << "PRIVACY ";

256 
§
 << "] ";

258 
§
 << "( { ";

259 
x
 = 0; x < 
­
.
_basic_¿‹s
.
	`size
(); x++) {

260 
§
 << 
­
.
_basic_¿‹s
[
x
] << " ";

262 
§
 << "} ";

263 
x
 = 0; x < 
­
.
_¿‹s
.
	`size
(); x++) {

264 
§
 << 
­
.
_¿‹s
[
x
] << " ";

267 
§
 << ")\n";

269  
§
.
	`ke_¡ršg
();

270 
	}
}

274 
	gB—cÚSÿÂ”
::
	$»£t
()

276 
_w­s
.
	`ş—r
();

277 
	}
}

279 ’um {
	mH_DEBUG
, 
	mH_SCAN
, 
	mH_RESET
};

281 
SŒšg


282 
	$B—cÚSÿÂ”_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

284 
B—cÚSÿÂ”
 *
td
 = (B—cÚSÿÂ” *)
e
;

285 (
ušŒ_t
è
thunk
) {

286 
H_DEBUG
:

287  
	`SŒšg
(
td
->
_debug
) + "\n";

288 
H_SCAN
:

289  
td
->
	`sÿn_¡ršg
();

291  
	`SŒšg
();

293 
	}
}

295 
	$B—cÚSÿÂ”_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

296 
E¼ÜHªdËr
 *
”rh
)

298 
B—cÚSÿÂ”
 *
f
 = (B—cÚSÿÂ” *)
e
;

299 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

300 (
šŒ_t
)
v·¿m
) {

301 
H_DEBUG
: {

302 
boŞ
 
debug
;

303 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

304  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

305 
f
->
_debug
 = 
debug
;

308 
H_RESET
: {

309 
f
->
	`»£t
();

313 
	}
}

316 
	gB—cÚSÿÂ”
::
	$add_hªdËrs
()

318 
	`add_»ad_hªdËr
("debug", 
B—cÚSÿÂ”_»ad_·¿m
, 
H_DEBUG
);

319 
	`add_»ad_hªdËr
("sÿn", 
B—cÚSÿÂ”_»ad_·¿m
, 
H_SCAN
);

321 
	`add_wr™e_hªdËr
("debug", 
B—cÚSÿÂ”_wr™e_·¿m
, 
H_DEBUG
);

322 
	`add_wr™e_hªdËr
("»£t", 
B—cÚSÿÂ”_wr™e_·¿m
, 
H_RESET
, 
HªdËr
::
BUTTON
);

323 
	}
}

325 
CLICK_ENDDECLS


326 
EXPORT_ELEMENT
(
B—cÚSÿÂ”
)

	@wifi/station/beaconscanner.hh

1 #iâdeà
CLICK_BEACONSCANNER_HH


2 
	#CLICK_BEACONSCANNER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<–em’ts/wifi/avaabË¿‹s.hh
>

7 
	~<–em’ts/wifi/wœ–essšfo.hh
>

8 
CLICK_DECLS


47 şas 
	cB—cÚSÿÂ”
 : 
public
 
EËm’t
 {…ublic:

49 
	$B—cÚSÿÂ”
(è
CLICK_COLD
;

50 ~
	$B—cÚSÿÂ”
(è
CLICK_COLD
;

52 cÚ¡ *
	$şass_Çme
() const {  "BeaconScanner"; }

53 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

54 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

56 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

57 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

59 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

62 
	$add_hªdËrs
(è
CLICK_COLD
;

63 
	`»£t
();

65 
boŞ
 
_debug
;

67 
SŒšg
 
	`sÿn_¡ršg
();

68 
´iv©e
:

72 şas 
	cw­
 {

73 
public
:

74 
Eth”Add»ss
 
_‘h
;

75 
SŒšg
 
_ssid
;

76 
_chªÃl
;

77 
ušt16_t
 
_ÿ·b™y
;

78 
ušt16_t
 
_b—cÚ_št
;

79 
VeùÜ
<> 
_¿‹s
;

80 
VeùÜ
<> 
_basic_¿‹s
;

81 
_rssi
;

82 
Time¡amp
 
_Ï¡_rx
;

83 
	}
};

85 
	gHashM­
<
	tEth”Add»ss
, 
	tw­
> 
	tAPTabË
;

86 
	gAPTabË
::
	tcÚ¡_™”©Ü
 
	tAPI‹r
;

88 
APTabË
 
	g_w­s
;

89 
AvaabËR©es
 *
	g_¹abË
;

90 
Wœ–essInfo
 *
	g_wšfo
;

93 
	gCLICK_ENDDECLS


	@wifi/station/beacontracker.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şickÃt/wifi.h
>

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/Îc.h
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/veùÜ.hh
>

27 
	~<şick/hashm­.hh
>

28 
	~<şick/·ck‘_ªno.hh
>

29 
	~<–em’ts/wifi/avaabË¿‹s.hh
>

30 
	~<–em’ts/wifi/wœ–essšfo.hh
>

31 
	~"b—cÚŒack”.hh
"

32 
CLICK_DECLS


34 
	gB—cÚT¿ck”
::
	$B—cÚT¿ck”
()

35 : 
	$_wšfo
(0)

37 
	}
}

39 
B—cÚT¿ck”
::~
	$B—cÚT¿ck”
()

41 
	}
}

44 
B—cÚT¿ck”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

47 
	g_debug
 = 
çl£
;

48 ià(
Args
(
cÚf
, 
this
, 
”rh
)

49 .
»ad
("DEBUG", 
_debug
)

50 .
»ad
("WIRELESS_INFO", 
EËm’tCa¡Arg
("Wœ–essInfo"), 
_wšfo
)

51 .
»ad
("TRACK", 
_Œack
)

52 .
com¶‘e
() < 0)

56 
»£t
();

60 
Pack‘
 *

61 
	gB—cÚT¿ck”
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

63 
ušt8_t
 
dœ
;

64 
ušt8_t
 
ty³
;

65 
ušt8_t
 
subty³
;

68 ià(
p
->
	`Ëngth
(è< (
şick_wifi
)) {

69 
	`şick_ch©‹r
("%p{element}:…acketoo small: %d vs %d\n",

70 
this
,

71 
p
->
	`Ëngth
(),

72 (
şick_wifi
));

74 
p
->
	`kl
();

78 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

81 
dœ
 = 
w
->
i_fc
[1] & 
WIFI_FC1_DIR_MASK
;

82 
ty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_TYPE_MASK
;

83 
subty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_SUBTYPE_MASK
;

85 ià(
ty³
 !ğ
WIFI_FC0_TYPE_MGT
) {

86 
	`şick_ch©‹r
("%p{element}:„eceived‚on-management…acket\n",

87 
this
);

88 
p
->
	`kl
();

92 ià(
subty³
 !ğ
WIFI_FC0_SUBTYPE_BEACON
 && subty³ !ğ
WIFI_FC0_SUBTYPE_PROBE_RESP
) {

93 
	`şick_ch©‹r
("%p{element}:„eceived subtype %d…acket\n",

94 
this
,

95 
subty³
);

96 
p
->
	`kl
();

101 
Eth”Add»ss
 
bssid
 = 
	`Eth”Add»ss
(
w
->
i_addr3
);

103 ià(
_wšfo
->
_bssid
 !ğ
bssid
) {

104 
p
->
	`kl
();

108 
ušt8_t
 *
±r
;

110 
±r
 = (
ušt8_t
 *è
p
->
	`d©a
(è+ (
şick_wifi
);

113 
±r
 += 8;

115 
ušt16_t
 
b—cÚ_št
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

116 
±r
 += 2;

119 
b—cÚ_t
 
b
;

120 
ušt16_t
 
£q
 = 
	`Ë16_to_ıu
(
w
->
i_£q
è>> 
WIFI_SEQ_SEQ_SHIFT
;

123 
b
.
rx
 = 
p
->
	`time¡amp_ªno
();

124 
b
.
£q
 = seq;

126 
_b—cÚs
.
	`push_back
(
b
);

127 
_b—cÚ_št
 = 
b—cÚ_št
;

129 
	`Œim
();

130  
p
;

131 
	}
}

134 
	gB—cÚT¿ck”
::
	$Œim
()

136 
Time¡amp
 
—¾›¡
 = Time¡amp::
	`now
(è- Time¡amp::
	`make_m£c
(
_Œack
 * 
_b—cÚ_št
);

137 
_b—cÚs
.
	`size
(è&& _b—cÚs[0].
rx
 < 
—¾›¡
) {

138 
_b—cÚs
.
	`pİ_äÚt
();

141 
	}
}

144 
	gB—cÚT¿ck”
::
	$»£t
()

146 
_¡¬t
.
	`assign_now
();

147 
_b—cÚs
.
	`ş—r
();

148 
	}
}

150 ’um {
	mH_DEBUG
, 
	mH_SCAN
, 
	mH_RESET
, 
	mH_STATS
,

151 
	mH_TRACK
, 
	mH_BEACON_INTERVAL
};

153 
SŒšg


154 
	$»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

156 
B—cÚT¿ck”
 *
td
 = (B—cÚT¿ck” *)
e
;

157 (
ušŒ_t
è
thunk
) {

158 
H_DEBUG
:

159  
	`SŒšg
(
td
->
_debug
) + "\n";

160 
H_BEACON_INTERVAL
:

161  
	`SŒšg
(
td
->
_b—cÚ_št
) + "\n";

162 
H_TRACK
:

163  
	`SŒšg
(
td
->
_Œack
) + "\n";

164 
H_STATS
: {

165 
Time¡amp
 
now
 = Time¡amp::
	`now
();

166 
td
->
	`Œim
();

167 
Time¡amp
 
diff
 = 
now
 - 
td
->
_¡¬t
;

168 
ex³ùed
 = 
	`WIFI_MIN
(
diff
.
	`m£cv®
(), 
td
->
_Œack
);

169 
couÁ
 = 
td
->
_b—cÚs
.
	`size
();

170 
p
 = 
ex³ùed
 ? 
couÁ
*100/expected : 0;

171  
	`SŒšg
(
p
) + "\n";

175  
	`SŒšg
();

177 
	}
}

179 
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

180 
E¼ÜHªdËr
 *
”rh
)

182 
B—cÚT¿ck”
 *
f
 = (B—cÚT¿ck” *)
e
;

183 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

184 (
šŒ_t
)
v·¿m
) {

185 
H_DEBUG
: {

186 
boŞ
 
debug
;

187 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

188  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

189 
f
->
_debug
 = 
debug
;

192 
H_RESET
: {

193 
f
->
	`»£t
();

197 
	}
}

200 
	gB—cÚT¿ck”
::
	$add_hªdËrs
()

202 
	`add_»ad_hªdËr
("debug", 
»ad_·¿m
, 
H_DEBUG
);

203 
	`add_»ad_hªdËr
("sÿn", 
»ad_·¿m
, 
H_SCAN
);

204 
	`add_»ad_hªdËr
("¡©s", 
»ad_·¿m
, 
H_STATS
);

205 
	`add_»ad_hªdËr
("Œack", 
»ad_·¿m
, 
H_TRACK
);

206 
	`add_»ad_hªdËr
("b—cÚ_š‹rv®", 
»ad_·¿m
, 
H_BEACON_INTERVAL
);

208 
	`add_wr™e_hªdËr
("debug", 
wr™e_·¿m
, 
H_DEBUG
);

209 
	`add_wr™e_hªdËr
("»£t", 
wr™e_·¿m
, 
H_RESET
, 
HªdËr
::
BUTTON
);

210 
	}
}

212 
CLICK_ENDDECLS


213 
EXPORT_ELEMENT
(
B—cÚT¿ck”
)

	@wifi/station/beacontracker.hh

1 #iâdeà
CLICK_BEACONTRACKER_HH


2 
	#CLICK_BEACONTRACKER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<şick/deque.hh
>

7 
CLICK_DECLS


29 şas 
	cB—cÚT¿ck”
 : 
public
 
EËm’t
 {…ublic:

31 
	$B—cÚT¿ck”
(è
CLICK_COLD
;

32 ~
	$B—cÚT¿ck”
(è
CLICK_COLD
;

34 cÚ¡ *
	$şass_Çme
() const {  "BeaconTracker"; }

35 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

36 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

38 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

39 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

41 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

43 
	sb—cÚ_t
 {

44 
Time¡amp
 
	grx
;

45 
ušt16_t
 
	g£q
;

47 
	gDeque
<
	gb—cÚ_t
> 
	g_b—cÚs
;

49 
	g_b—cÚ_št
;

50 
Time¡amp
 
	g_¡¬t
;

52 
Œim
();

53 
	$add_hªdËrs
(è
CLICK_COLD
;

54 
	`»£t
();

56 
boŞ
 
_debug
;

58 
_Œack
;

60 
´iv©e
:

62 
şass
 
Wœ–essInfo
 *
_wšfo
;

63 
	}
};

65 
	gCLICK_ENDDECLS


	@wifi/station/openauthrequester.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şickÃt/wifi.h
>

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/Îc.h
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/veùÜ.hh
>

27 
	~<şick/hashm­.hh
>

28 
	~<şick/·ck‘_ªno.hh
>

29 
	~<şick/”rÜ.hh
>

30 
	~"İ’auth»que¡”.hh
"

31 
	~<–em’ts/wifi/wœ–essšfo.hh
>

33 
CLICK_DECLS


35 
	gO³nAuthReque¡”
::
	$O³nAuthReque¡”
()

37 
	}
}

39 
O³nAuthReque¡”
::~
	$O³nAuthReque¡”
()

41 
	}
}

44 
O³nAuthReque¡”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

47 
	g_debug
 = 
çl£
;

48 ià(
Args
(
cÚf
, 
this
, 
”rh
)

49 .
»ad
("DEBUG", 
_debug
)

50 .
»ad
("ETH", 
_‘h
)

51 .
»ad
("WIRELESS_INFO", 
EËm’tCa¡Arg
("Wœ–essInfo"), 
_wšfo
)

52 .
com¶‘e
() < 0)

59 
	gO³nAuthReque¡”
::
	$push
(, 
Pack‘
 *
p
)

62 
ušt8_t
 
dœ
;

63 
ušt8_t
 
ty³
;

64 
ušt8_t
 
subty³
;

66 ià(
p
->
	`Ëngth
(è< (
şick_wifi
)) {

67 
	`şick_ch©‹r
("%p{element}:…acketoo small: %d vs %d\n",

68 
this
,

69 
p
->
	`Ëngth
(),

70 (
şick_wifi
));

72 
p
->
	`kl
();

76 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

79 
dœ
 = 
w
->
i_fc
[1] & 
WIFI_FC1_DIR_MASK
;

80 
ty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_TYPE_MASK
;

81 
subty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_SUBTYPE_MASK
;

83 ià(
ty³
 !ğ
WIFI_FC0_TYPE_MGT
) {

84 
	`şick_ch©‹r
("%p{element}:„eceived‚on-management…acket\n",

85 
this
);

86 
p
->
	`kl
();

90 ià(
subty³
 !ğ
WIFI_FC0_SUBTYPE_AUTH
) {

91 
	`şick_ch©‹r
("%p{element}:„eceived‚on-probe-req…acket\n",

92 
this
);

93 
p
->
	`kl
();

97 
ušt8_t
 *
±r
;

99 
±r
 = (
ušt8_t
 *è
p
->
	`d©a
(è+ (
şick_wifi
);

103 
ušt16_t
 
®go
 = 
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

104 
±r
 += 2;

106 
ušt16_t
 
£q
 =
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

107 
±r
 += 2;

109 
ušt16_t
 
¡©us
 =
	`Ë16_to_ıu
(*(ušt16_ˆ*è
±r
);

110 
±r
 += 2;

113 
Eth”Add»ss
 
¤c
 = 
	`Eth”Add»ss
(
w
->
i_addr2
);

114 ià(
®go
 !ğ
WIFI_AUTH_ALG_OPEN
) {

115 
	`şick_ch©‹r
("%p{element}:‡uth %d from %s‚ot supported\n",

116 
this
,

117 
®go
,

118 
¤c
.
	`uÅ¬£
().
	`c_¡r
());

119 
p
->
	`kl
();

123 ià(
_debug
) {

124 
	`şick_ch©‹r
("%p{element}:‡uth %d seq %d status %d\n",

125 
this
,

126 
®go
,

127 
£q
,

128 
¡©us
);

132 
p
->
	`kl
();

134 
	}
}

136 
	gO³nAuthReque¡”
::
	$£nd_auth_»que¡
()

139 
Eth”Add»ss
 
bssid
 = 
_wšfo
 ? _wšfo->
_bssid
 : 
	`Eth”Add»ss
();

140 
Ën
 =  (
şick_wifi
) +

146 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
Ën
);

148 ià(
p
 == 0)

151 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

153 
w
->
i_fc
[0] = 
WIFI_FC0_VERSION_0
 | 
WIFI_FC0_TYPE_MGT
 | 
WIFI_FC0_SUBTYPE_AUTH
;

154 
w
->
i_fc
[1] = 
WIFI_FC1_DIR_NODS
;

156 
	`memıy
(
w
->
i_addr1
, 
bssid
.
	`d©a
(), 6);

157 
	`memıy
(
w
->
i_addr2
, 
_‘h
.
	`d©a
(), 6);

158 
	`memıy
(
w
->
i_addr3
, 
bssid
.
	`d©a
(), 6);

161 
w
->
i_dur
 = 0;

162 
w
->
i_£q
 = 0;

164 
ušt8_t
 *
±r
;

166 
±r
 = (
ušt8_t
 *è
p
->
	`d©a
(è+ (
şick_wifi
);

168 *(
ušt16_t
 *)
±r
 = 
	`ıu_to_Ë16
(
WIFI_AUTH_ALG_OPEN
);

169 
±r
 += 2;

171 *(
ušt16_t
 *)
±r
 = 
	`ıu_to_Ë16
(1);

172 
±r
 += 2;

174 *(
ušt16_t
 *)
±r
 = 
	`ıu_to_Ë16
(0);

175 
±r
 += 2;

177 
	`ouut
(0).
	`push
(
p
);

178 
	}
}

181 ’um {
	mH_DEBUG
, 
	mH_ETH
, 
	mH_SEND_AUTH_REQ
};

183 
SŒšg


184 
	$O³nAuthReque¡”_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

186 
O³nAuthReque¡”
 *
td
 = (O³nAuthReque¡” *)
e
;

187 (
ušŒ_t
è
thunk
) {

188 
H_DEBUG
:

189  
	`SŒšg
(
td
->
_debug
) + "\n";

190 
H_ETH
:

191  
td
->
_‘h
.
	`uÅ¬£
() + "\n";

193  
	`SŒšg
();

195 
	}
}

197 
	$O³nAuthReque¡”_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

198 
E¼ÜHªdËr
 *
”rh
)

200 
O³nAuthReque¡”
 *
f
 = (O³nAuthReque¡” *)
e
;

201 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

202 (
šŒ_t
)
v·¿m
) {

203 
H_DEBUG
: {

204 
boŞ
 
debug
;

205 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

206  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

207 
f
->
_debug
 = 
debug
;

210 
H_ETH
: {

211 
Eth”Add»ss
 
e
;

212 ià(!
	`ı_‘h”Ãt_add»ss
(
s
, &
e
))

213  
”rh
->
	`”rÜ
("eth…arameter must beƒthernet‡ddress");

214 
f
->
_‘h
 = 
e
;

217 
H_SEND_AUTH_REQ
: {

218 
f
->
	`£nd_auth_»que¡
();

223 
	}
}

226 
	gO³nAuthReque¡”
::
	$add_hªdËrs
()

228 
	`add_»ad_hªdËr
("debug", 
O³nAuthReque¡”_»ad_·¿m
, 
H_DEBUG
);

229 
	`add_»ad_hªdËr
("‘h", 
O³nAuthReque¡”_»ad_·¿m
, 
H_ETH
);

231 
	`add_wr™e_hªdËr
("debug", 
O³nAuthReque¡”_wr™e_·¿m
, 
H_DEBUG
);

232 
	`add_wr™e_hªdËr
("‘h", 
O³nAuthReque¡”_wr™e_·¿m
, 
H_ETH
);

233 
	`add_wr™e_hªdËr
("£nd_auth_»q", 
O³nAuthReque¡”_wr™e_·¿m
, 
H_SEND_AUTH_REQ
);

234 
	}
}

236 
CLICK_ENDDECLS


237 
EXPORT_ELEMENT
(
O³nAuthReque¡”
)

	@wifi/station/openauthrequester.hh

1 #iâdeà
CLICK_OPENAUTHREQUESTER_HH


2 
	#CLICK_OPENAUTHREQUESTER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


39 şas 
	cO³nAuthReque¡”
 : 
public
 
EËm’t
 {…ublic:

41 
	$O³nAuthReque¡”
(è
CLICK_COLD
;

42 ~
	$O³nAuthReque¡”
(è
CLICK_COLD
;

44 cÚ¡ *
	$şass_Çme
() const {  "OpenAuthRequester"; }

45 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

46 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

48 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

49 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

50 
	$add_hªdËrs
(è
CLICK_COLD
;

52 
	`£nd_auth_»que¡
();

53 
	`push
(, 
Pack‘
 *);

56 
boŞ
 
_debug
;

57 
Eth”Add»ss
 
_‘h
;

58 
şass
 
Wœ–essInfo
 *
_wšfo
;

59 
´iv©e
:

62 
	}
};

64 
	gCLICK_ENDDECLS


	@wifi/station/proberequester.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şickÃt/wifi.h
>

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/Îc.h
>

25 
	~<şick/¡¿ccum.hh
>

26 
	~<şick/veùÜ.hh
>

27 
	~<şick/hashm­.hh
>

28 
	~<şick/·ck‘_ªno.hh
>

29 
	~<şick/”rÜ.hh
>

30 
	~"´ob”eque¡”.hh
"

31 
	~<–em’ts/wifi/avaabË¿‹s.hh
>

32 
	~<–em’ts/wifi/wœ–essšfo.hh
>

33 
CLICK_DECLS


35 
	gProbeReque¡”
::
	$ProbeReque¡”
()

36 : 
	`_¹abË
(0),

37 
	$_wšfo
(0)

39 
	}
}

41 
	gProbeReque¡”
::~
	$ProbeReque¡”
()

43 
	}
}

46 
ProbeReque¡”
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

49 
	g_debug
 = 
çl£
;

50 ià(
Args
(
cÚf
, 
this
, 
”rh
)

51 .
»ad
("DEBUG", 
_debug
)

52 .
»ad
("WIRELESS_INFO", 
EËm’tCa¡Arg
("Wœ–essInfo"), 
_wšfo
)

53 .
»ad
("ETH", 
_‘h
)

54 .
»ad
("RT", 
EËm’tCa¡Arg
("AvaabËR©es"), 
_¹abË
)

55 .
com¶‘e
() < 0)

62 
	gProbeReque¡”
::
	$£nd_´obe_»que¡
()

64 
VeùÜ
<> 
¿‹s
 = 
_¹abË
->
	`lookup
(
_‘h
);

65 
max_Ën
 =  (
şick_wifi
) +

66 2 + (
_wšfo
 ? _wšfo->
_ssid
.
	`Ëngth
() : 0) +

67 2 + 
WIFI_RATE_SIZE
 +

68 2 + 
WIFI_RATE_SIZE
 +

71 
Wr™abËPack‘
 *
p
 = 
Pack‘
::
	`make
(
max_Ën
);

73 ià(
p
 == 0)

76 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

78 
w
->
i_fc
[0] = 
WIFI_FC0_VERSION_0
 | 
WIFI_FC0_TYPE_MGT
 | 
WIFI_FC0_SUBTYPE_PROBE_REQ
;

79 
w
->
i_fc
[1] = 
WIFI_FC1_DIR_NODS
;

81 
	`mem£t
(
w
->
i_addr1
, 0xff, 6);

82 
	`memıy
(
w
->
i_addr2
, 
_‘h
.
	`d©a
(), 6);

83 
	`mem£t
(
w
->
i_addr3
, 0xff, 6);

86 
w
->
i_dur
 = 0;

87 
w
->
i_£q
 = 0;

89 
ušt8_t
 *
±r
 = (ušt8_ˆ*è
p
->
	`d©a
(è+ (
şick_wifi
);

90 
aùu®_Ëngth
 =  (
şick_wifi
);

92 
SŒšg
 
ssid
 = 
_wšfo
 ? _wšfo->
_ssid
 : "";

94 
±r
[0] = 
WIFI_ELEMID_SSID
;

95 
±r
[1] = 
ssid
.
	`Ëngth
();

96 ià(
_wšfo
) {

97 
	`memıy
(
±r
 + 2, 
ssid
.
	`d©a
(), ssid.
	`Ëngth
());

99 
±r
 +ğ2 + 
ssid
.
	`Ëngth
();

100 
aùu®_Ëngth
 +ğ2 + 
ssid
.
	`Ëngth
();

103 
±r
[0] = 
WIFI_ELEMID_RATES
;

104 
±r
[1] = 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
());

105 
x
 = 0; x < 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
()); x++) {

106 
±r
[2 + 
x
] = (
ušt8_t
è
¿‹s
[x];

108 ià(
¿‹s
[
x
] == 2) {

109 
±r
 [2 + 
x
] |ğ
WIFI_RATE_BASIC
;

112 ià(
_wšfo
 && _wšfo->
_chªÃl
 > 15 && 
¿‹s
[
x
] == 12) {

113 
±r
 [2 + 
x
] |ğ
WIFI_RATE_BASIC
;

117 
±r
 +ğ2 + 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
());

118 
aùu®_Ëngth
 +ğ2 + 
	`WIFI_MIN
(
WIFI_RATE_SIZE
, 
¿‹s
.
	`size
());

121 
num_x¿‹s
 = 
¿‹s
.
	`size
(è- 
WIFI_RATE_SIZE
;

122 ià(
num_x¿‹s
 > 0) {

124 
±r
[0] = 
WIFI_ELEMID_XRATES
;

125 
±r
[1] = 
num_x¿‹s
;

126 
x
 = 0; x < 
num_x¿‹s
; x++) {

127 
±r
[2 + 
x
] = (
ušt8_t
è
¿‹s
[x + 
WIFI_RATE_SIZE
];

129 ià(
¿‹s
[
x
 + 
WIFI_RATE_SIZE
] == 2) {

130 
±r
 [2 + 
x
] |ğ
WIFI_RATE_BASIC
;

133 ià(
_wšfo
 && _wšfo->
_chªÃl
 > 15 && 
¿‹s
[
x
] == 12) {

134 
±r
 [2 + 
x
] |ğ
WIFI_RATE_BASIC
;

138 
±r
 +ğ2 + 
num_x¿‹s
;

139 
aùu®_Ëngth
 +ğ2 + 
num_x¿‹s
;

142 
p
->
	`ke
(
max_Ën
 - 
aùu®_Ëngth
);

143 
	`ouut
(0).
	`push
(
p
);

144 
	}
}

147 ’um {
	mH_DEBUG
, 
	mH_ETH
, 
	mH_SEND_PROBE
};

149 
SŒšg


150 
	$ProbeReque¡”_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

152 
ProbeReque¡”
 *
td
 = (ProbeReque¡” *)
e
;

153 (
ušŒ_t
è
thunk
) {

154 
H_DEBUG
:

155  
	`SŒšg
(
td
->
_debug
) + "\n";

156 
H_ETH
:

157  
td
->
_‘h
.
	`uÅ¬£
() + "\n";

159  
	`SŒšg
();

161 
	}
}

163 
	$ProbeReque¡”_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

164 
E¼ÜHªdËr
 *
”rh
)

166 
ProbeReque¡”
 *
f
 = (ProbeReque¡” *)
e
;

167 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

168 (
šŒ_t
)
v·¿m
) {

169 
H_DEBUG
: {

170 
boŞ
 
debug
;

171 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

172  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

173 
f
->
_debug
 = 
debug
;

176 
H_ETH
: {

177 
Eth”Add»ss
 
e
;

178 ià(!
	`ı_‘h”Ãt_add»ss
(
s
, &
e
))

179  
”rh
->
	`”rÜ
("bssid…arameter must beƒthernet‡ddress");

180 
f
->
_‘h
 = 
e
;

183 
H_SEND_PROBE
: {

184 
f
->
	`£nd_´obe_»que¡
();

188 
	}
}

191 
	gProbeReque¡”
::
	$add_hªdËrs
()

193 
	`add_»ad_hªdËr
("debug", 
ProbeReque¡”_»ad_·¿m
, 
H_DEBUG
);

194 
	`add_»ad_hªdËr
("‘h", 
ProbeReque¡”_»ad_·¿m
, 
H_ETH
);

196 
	`add_wr™e_hªdËr
("debug", 
ProbeReque¡”_wr™e_·¿m
, 
H_DEBUG
);

197 
	`add_wr™e_hªdËr
("‘h", 
ProbeReque¡”_wr™e_·¿m
, 
H_ETH
);

198 
	`add_wr™e_hªdËr
("£nd_´obe", 
ProbeReque¡”_wr™e_·¿m
, 
H_SEND_PROBE
);

199 
	}
}

201 
CLICK_ENDDECLS


202 
EXPORT_ELEMENT
(
ProbeReque¡”
)

	@wifi/station/proberequester.hh

1 #iâdeà
CLICK_PROBEREQUESTER_HH


2 
	#CLICK_PROBEREQUESTER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/‘h”add»ss.hh
>

5 
CLICK_DECLS


32 şas 
	cProbeReque¡”
 : 
public
 
EËm’t
 {…ublic:

34 
	$ProbeReque¡”
(è
CLICK_COLD
;

35 ~
	$ProbeReque¡”
(è
CLICK_COLD
;

37 cÚ¡ *
	$şass_Çme
() const {  "ProbeRequester"; }

38 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_1
; 
	}
}

39 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

41 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

42 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

43 
	$add_hªdËrs
(è
CLICK_COLD
;

45 
	`£nd_´obe_»que¡
();

48 
boŞ
 
_debug
;

49 
Eth”Add»ss
 
_‘h
;

50 
şass
 
AvaabËR©es
 *
_¹abË
;

51 
şass
 
Wœ–essInfo
 *
_wšfo
;

52 
´iv©e
:

55 
	}
};

57 
	gCLICK_ENDDECLS


	@wifi/wepdecap.cc

49 
	~<şick/cÚfig.h
>

50 
	~"w•deÿp.hh
"

51 
	~<şick/‘h”add»ss.hh
>

52 
	~<şick/¬gs.hh
>

53 
	~<şick/”rÜ.hh
>

54 
	~<şick/glue.hh
>

55 
	~<şickÃt/wifi.h
>

56 
	~<şickÃt/Îc.h
>

57 
	~<şick/üc32.h
>

58 
CLICK_DECLS


60 
	gW•Deÿp
::
	$W•Deÿp
()

62 
	}
}

64 
W•Deÿp
::~
	$W•Deÿp
()

66 
	}
}

69 
W•Deÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

72 
	g_debug
 = 
çl£
;

73 
	g_¡riù
 = 
çl£
;

74 
	g_keyid
 = 0;

75 ià(
Args
(
cÚf
, 
this
, 
”rh
)

76 .
»ad_p
("KEY", 
_key
)

77 .
»ad_p
("KEYID", 
_keyid
)

78 .
»ad
("DEBUG", 
_debug
)

79 .
»ad
("STRICT", 
_¡riù
)

80 .
com¶‘e
() < 0)

82 
mem£t
(&
_rc4
, 0,(_rc4));

89 
Pack‘
 *

90 
	gW•Deÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

92 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

93 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

95 ià(!(
w
->
i_fc
[1] & 
WIFI_FC1_WEP
)) {

97  
p
;

102 
u_št8_t
 
rc4key
[
WIFI_WEP_IVLEN
 + 
WIFI_KEYBUF_SIZE
];

103 
u_št8_t
 
ücbuf
[
WIFI_WEP_CRCLEN
];

104 
u_št8_t
 *
icv
;

105 
u_št8_t
 *
iı
 = 
p
->
	`d©a
(è+ (
şick_wifi
);

106 
u_št32_t
 
üc
;

107 
u_št32_t
 
iv
;

108 
u_št8_t
 
keyid
 = 
iı
[
WIFI_WEP_IVLEN
];

110 ià(
keyid
 !ğ
_keyid
) {

111  
p
;

113 
iv
 = 
iı
[0] | (icp[1] << 8) | (icp[2] << 16) | (icp[3] << 24);

115 
	`memıy
(
rc4key
, 
iı
, 
WIFI_WEP_IVLEN
);

116 
	`memıy
(
rc4key
 + 
WIFI_WEP_IVLEN
, 
_key
.
	`c_¡r
(), _key.
	`Ëngth
());

117 
	`rc4_š™
(&
_rc4
, 
rc4key
, 
WIFI_WEP_IVLEN
 + 
_key
.
	`Ëngth
());

119 
u_št8_t
 *
·ylßd
 = 
p
->
	`d©a
(è+ (
şick_wifi
è+ 
WIFI_WEP_HEADERSIZE
;

120 
·ylßd_Ën
 = 
p
->
	`Ëngth
(è- ((
şick_wifi
è+ 
WIFI_WEP_HEADERSIZE
 + 
WIFI_WEP_CRCLEN
);

122 
	`rc4_üy±_sk
(&
_rc4
, 
·ylßd
,…aylßd, 
·ylßd_Ën
, 0);

125 
üc
 = 
	`rfc_2083_üc_upd©e
(~0, 
·ylßd
, 
·ylßd_Ën
);

128 
icv
 = 
·ylßd
 + 
·ylßd_Ën
;

129 
	`rc4_üy±_sk
(&
_rc4
, 
icv
, 
ücbuf
, 
WIFI_WEP_CRCLEN
, 0);

130 
u_št32_t
 
üc_foo
;

131 
	`memıy
(&
üc_foo
, 
ücbuf
, 4);

133 ià(
üc
 !ğ~
	`Ë32_to_ıu
(
üc_foo
)) {

134 
	`şick_ch©‹r
("crc failed keyid %d iv %d %x wanted %x %x\n",

135 
keyid
,

136 
iv
,

137 
üc
,

138 ~
	`Ë32_to_ıu
(
üc_foo
),

139 
üc_foo
);

141  
p
;

144 
	`memmove
((*)(
p
->
	`d©a
(è+ 
WIFI_WEP_HEADERSIZE
),…->d©a(), (
şick_wifi
));

145 
p
->
	`puÎ
(
WIFI_WEP_HEADERSIZE
);

147 
p
->
	`ke
(
WIFI_WEP_CRCLEN
);

149 
w
 = (
şick_wifi
 *è
p
->
	`d©a
();

150 
w
->
i_fc
[1] &ğ~
WIFI_FC1_WEP
;

151  
p
;

152 
	}
}

155 ’um {
	mH_DEBUG
, 
	mH_KEY
, 
	mH_KEYID
};

157 
SŒšg


158 
	$»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

160 
W•Deÿp
 *
td
 = (W•Deÿ°*)
e
;

161 (
ušŒ_t
è
thunk
) {

162 
H_DEBUG
:  
	`SŒšg
(
td
->
_debug
) + "\n";

163 
H_KEY
:  
td
->
_key
.
	`quÙed_hex
() + "\n";

164 
H_KEYID
:  
	`SŒšg
(
td
->
_keyid
) + "\n";

166  
	`SŒšg
();

168 
	}
}

170 
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

171 
E¼ÜHªdËr
 *
”rh
)

173 
W•Deÿp
 *
f
 = (W•Deÿ°*)
e
;

174 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

175 (
šŒ_t
)
v·¿m
) {

176 
H_DEBUG
: {

177 
boŞ
 
debug
;

178 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

179  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

180 
f
->
_debug
 = 
debug
;

183 
H_KEYID
: {

184 
m
;

185 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

186  
”rh
->
	`”rÜ
("keyid…arameter must be unsigned");

187 
f
->
_keyid
 = 
m
;

190 
H_KEY
: {

191 
SŒšg
 
m
;

192 ià(!
	`ı_¡ršg
(
s
, &
m
))

193  
”rh
->
	`”rÜ
("key…arameter must be unsigned");

194 
f
->
_key
 = 
m
;

199 
	}
}

202 
	gW•Deÿp
::
	$add_hªdËrs
()

204 
	`add_»ad_hªdËr
("debug", 
»ad_·¿m
, 
H_DEBUG
);

205 
	`add_»ad_hªdËr
("key", 
»ad_·¿m
, 
H_KEY
);

206 
	`add_»ad_hªdËr
("keyid", 
»ad_·¿m
, 
H_KEYID
);

208 
	`add_wr™e_hªdËr
("debug", 
wr™e_·¿m
, 
H_DEBUG
);

209 
	`add_wr™e_hªdËr
("key", 
wr™e_·¿m
, 
H_KEY
);

210 
	`add_wr™e_hªdËr
("keyid", 
wr™e_·¿m
, 
H_KEYID
);

211 
	}
}

212 
CLICK_ENDDECLS


213 
	$ELEMENT_REQUIRES
(
rc4
)

214 
	`EXPORT_ELEMENT
(
W•Deÿp
)

	@wifi/wepdecap.hh

1 #iâdeà
CLICK_WEPDECAP_HH


2 
	#CLICK_WEPDECAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
	~<–em’ts/wifi/rc4.hh
>

6 
	~<şickÃt/wifi.h
>

7 
CLICK_DECLS


34 şas 
	cW•Deÿp
 : 
public
 
EËm’t
 {…ublic:

36 
	$W•Deÿp
(è
CLICK_COLD
;

37 ~
	$W•Deÿp
(è
CLICK_COLD
;

39 cÚ¡ *
	$şass_Çme
() const {  "WepDecap"; }

40 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

41 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

43 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

44 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

46 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

49 
	$add_hªdËrs
(è
CLICK_COLD
;

52 
boŞ
 
_debug
;

53 
boŞ
 
_¡riù
;

56 
u_št32_t
 
iv
;

57 
rc4_¡©e
 
_rc4
;

58 
SŒšg
 
_key
;

59 
_keyid
;

60 
´iv©e
:

62 
	}
};

64 
	gCLICK_ENDDECLS


	@wifi/wepencap.cc

49 
	~<şick/cÚfig.h
>

50 
	~"w•’ÿp.hh
"

51 
	~<şick/‘h”add»ss.hh
>

52 
	~<şick/¬gs.hh
>

53 
	~<şick/”rÜ.hh
>

54 
	~<şick/glue.hh
>

55 
	~<şickÃt/wifi.h
>

56 
	~<şickÃt/Îc.h
>

57 
	~<şick/üc32.h
>

58 
CLICK_DECLS


60 
	gW•Enÿp
::
	$W•Enÿp
()

62 
	}
}

64 
W•Enÿp
::~
	$W•Enÿp
()

66 
	}
}

69 
W•Enÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

72 
	g_debug
 = 
çl£
;

73 
	g_¡riù
 = 
çl£
;

74 
	g_aùive
 = 
çl£
;

75 
	g_keyid
 = 0;

76 ià(
Args
(
cÚf
, 
this
, 
”rh
)

77 .
»ad_p
("KEY", 
_key
)

78 .
»ad
("KEYID", 
_keyid
)

79 .
»ad
("DEBUG", 
_debug
)

80 .
»ad
("STRICT", 
_¡riù
)

81 .
»ad
("ACTIVE", 
_aùive
)

82 .
com¶‘e
() < 0)

84 
mem£t
(&
_rc4
, 0,(_rc4));

88 
Pack‘
 *

89 
	gW•Enÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

91 
Wr™abËPack‘
 *
p
 = 
p_š
->
	`uniqueify
();

92 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

93 
ty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_TYPE_MASK
;

94 
subty³
 = 
w
->
i_fc
[0] & 
WIFI_FC0_SUBTYPE_MASK
;

95 ià(!
_aùive
) {

96  
p
;

98 ià(
ty³
 !ğ
WIFI_FC0_TYPE_DATA
 &&

99 !(
ty³
 =ğ
WIFI_FC0_TYPE_MGT
 && 
subty³
 =ğ
WIFI_FC0_SUBTYPE_AUTH
)) {

101  
p
;

103 
w
->
i_fc
[1] |ğ
WIFI_FC1_WEP
;

105 ià(!(
p
 =…->
	`push
(
WIFI_WEP_HEADERSIZE
)))

107 
	`memmove
((*è
p
->
	`d©a
(),…->d©a(è+ 
WIFI_WEP_HEADERSIZE
, (
şick_wifi
));

108 
u_št8_t
 *
ivp
 = 
p
->
	`d©a
(è+ (
şick_wifi
);

109 
u_št32_t
 
iv
 = 
	`şick_¿ndom
() & 0xffffff;

110 ià((
iv
 & 0xff00) == 0xff00) {

111 
B
 = (
iv
 & 0xff0000) >> 16;

112 ià(3 <ğ
B
 && B < 16)

113 
iv
 += 0x0100;

116 
	`memıy
(
ivp
, &
iv
, 3);

117 
ivp
[3] = 
_keyid
;

120 
u_št8_t
 
rc4key
[
WIFI_WEP_IVLEN
 + 
WIFI_KEYBUF_SIZE
];

121 
u_št8_t
 
ücbuf
[
WIFI_WEP_CRCLEN
];

122 
u_št8_t
 *
icv
;

123 
u_št32_t
 
üc
;

126 
	`memıy
(
rc4key
, 
p
->
	`d©a
(è+ (
şick_wifi
), 
WIFI_WEP_IVLEN
);

127 
	`memıy
(
rc4key
 + 
WIFI_WEP_IVLEN
, 
_key
.
	`d©a
(), _key.
	`Ëngth
());

128 
	`rc4_š™
(&
_rc4
, 
rc4key
, 
WIFI_WEP_IVLEN
 + 
_key
.
	`Ëngth
());

131 
üc
 = 
	`rfc_2083_üc_upd©e
(~0,

132 (
p
->
	`d©a
(è+ (
şick_wifi
è+ 
WIFI_WEP_HEADERSIZE
),

133 
p
->
	`Ëngth
(è- ((
şick_wifi
è+ 
WIFI_WEP_HEADERSIZE
));

136 
	`rc4_üy±_sk
(&
_rc4
,

137 
p
->
	`d©a
(è+ (
şick_wifi
è+ 
WIFI_WEP_HEADERSIZE
,

138 
p
->
	`d©a
(è+ (
şick_wifi
è+ 
WIFI_WEP_HEADERSIZE
,

139 
p
->
	`Ëngth
(è- ((
şick_wifi
è+ 
WIFI_WEP_HEADERSIZE
),

142 
üc
 = 
	`ıu_to_Ë32
(~crc);

143 
	`memıy
(
ücbuf
, &
üc
, 4);

144 ià(!(
p
 =…->
	`put
(
WIFI_WEP_CRCLEN
)))

146 
icv
 = 
p
->
	`’d_d©a
(è- 
WIFI_WEP_CRCLEN
;

147 
	`rc4_üy±_sk
(&
_rc4
, 
ücbuf
, 
icv
, 
WIFI_WEP_CRCLEN
, 0);

149  
p
;

151 
	}
}

154 ’um {
	mH_DEBUG
, 
	mH_ACTIVE
, 
	mH_KEY
, 
	mH_KEYID
};

156 
SŒšg


157 
	$»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

159 
W•Enÿp
 *
td
 = (W•Enÿ°*)
e
;

160 (
ušŒ_t
è
thunk
) {

161 
H_DEBUG
:  
	`SŒšg
(
td
->
_debug
) + "\n";

162 
H_ACTIVE
:  
	`SŒšg
(
td
->
_aùive
) + "\n";

163 
H_KEY
:  
td
->
_key
.
	`quÙed_hex
() + "\n";

164 
H_KEYID
:  
	`SŒšg
(
td
->
_keyid
) + "\n";

166  
	`SŒšg
();

168 
	}
}

170 
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

171 
E¼ÜHªdËr
 *
”rh
)

173 
W•Enÿp
 *
f
 = (W•Enÿ°*)
e
;

174 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

175 (
šŒ_t
)
v·¿m
) {

176 
H_DEBUG
: {

177 
boŞ
 
debug
;

178 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

179  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

180 
f
->
_debug
 = 
debug
;

183 
H_ACTIVE
: {

184 
boŞ
 
aùive
;

185 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
aùive
))

186  
”rh
->
	`”rÜ
("active…arameter must be boolean");

187 
f
->
_aùive
 = 
aùive
;

190 
H_KEYID
: {

191 
m
;

192 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

193  
”rh
->
	`”rÜ
("keyid…arameter must be unsigned");

194 
f
->
_keyid
 = 
m
;

197 
H_KEY
: {

198 
SŒšg
 
m
;

199 ià(!
	`ı_¡ršg
(
s
, &
m
))

200  
”rh
->
	`”rÜ
("key…arameter must be unsigned");

201 
f
->
_key
 = 
m
;

206 
	}
}

209 
	gW•Enÿp
::
	$add_hªdËrs
()

211 
	`add_»ad_hªdËr
("debug", 
»ad_·¿m
, 
H_DEBUG
);

212 
	`add_»ad_hªdËr
("aùive", 
»ad_·¿m
, 
H_ACTIVE
);

213 
	`add_»ad_hªdËr
("key", 
»ad_·¿m
, 
H_KEY
);

214 
	`add_»ad_hªdËr
("keyid", 
»ad_·¿m
, 
H_KEYID
);

216 
	`add_wr™e_hªdËr
("debug", 
wr™e_·¿m
, 
H_ACTIVE
);

217 
	`add_wr™e_hªdËr
("aùive", 
wr™e_·¿m
, 
H_ACTIVE
);

218 
	`add_wr™e_hªdËr
("key", 
wr™e_·¿m
, 
H_KEY
);

219 
	`add_wr™e_hªdËr
("keyid", 
wr™e_·¿m
, 
H_KEYID
);

220 
	}
}

221 
CLICK_ENDDECLS


222 
	$ELEMENT_REQUIRES
(
rc4
)

223 
	`EXPORT_ELEMENT
(
W•Enÿp
)

	@wifi/wepencap.hh

1 #iâdeà
CLICK_WEPENCAP_HH


2 
	#CLICK_WEPENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
	~<–em’ts/wifi/rc4.hh
>

6 
CLICK_DECLS


33 şas 
	cW•Enÿp
 : 
public
 
EËm’t
 {…ublic:

35 
	$W•Enÿp
(è
CLICK_COLD
;

36 ~
	$W•Enÿp
(è
CLICK_COLD
;

38 cÚ¡ *
	$şass_Çme
() const {  "WepEncap"; }

39 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

40 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

42 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

43 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

45 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

48 
	$add_hªdËrs
(è
CLICK_COLD
;

51 
boŞ
 
_debug
;

52 
boŞ
 
_¡riù
;

55 
u_št32_t
 
iv
;

56 
rc4_¡©e
 
_rc4
;

57 
SŒšg
 
_key
;

58 
_keyid
;

59 
boŞ
 
_aùive
;

60 
´iv©e
:

62 
	}
};

64 
	gCLICK_ENDDECLS


	@wifi/wifidecap.cc

18 
	~<şick/cÚfig.h
>

19 
	~"wifideÿp.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
	~<şickÃt/wifi.h
>

26 
	~<şickÃt/Îc.h
>

27 
CLICK_DECLS


29 
	gWifiDeÿp
::
	$WifiDeÿp
()

31 
	}
}

33 
WifiDeÿp
::~
	$WifiDeÿp
()

35 
	}
}

38 
WifiDeÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41 
	g_debug
 = 
çl£
;

42 
	g_¡riù
 = 
çl£
;

43 
	g_push_‘h
 = 
Œue
;

44 ià(
Args
(
cÚf
, 
this
, 
”rh
)

45 .
»ad
("DEBUG", 
_debug
)

46 .
»ad
("STRICT", 
_¡riù
)

47 .
»ad
("ETHER", 
_push_‘h
)

48 .
com¶‘e
() < 0)

53 
Pack‘
 *

54 
	gWifiDeÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

58 
ušt8_t
 
dœ
;

59 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

60 
Eth”Add»ss
 
bssid
;

61 
Eth”Add»ss
 
¤c
;

62 
Eth”Add»ss
 
d¡
;

64 
wifi_h—d”_size
 = (
şick_wifi
);

65 ià((
w
->
i_fc
[1] & 
WIFI_FC1_DIR_MASK
è=ğ
WIFI_FC1_DIR_DSTODS
)

66 
wifi_h—d”_size
 +ğ
WIFI_ADDR_LEN
;

67 ià(
	`WIFI_QOS_HAS_SEQ
(
w
))

68 
wifi_h—d”_size
 +ğ(
ušt16_t
);

70 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p
);

71 ià((
ûh
->
magic
 =ğ
WIFI_EXTRA_MAGIC
è&& ceh->
·d
 && (
wifi_h—d”_size
 & 3))

72 
wifi_h—d”_size
 += 4 - (wifi_header_size & 3);

74 ià(
p
->
	`Ëngth
(è< 
wifi_h—d”_size
 + (
şick_Îc
)) {

75 
p
->
	`kl
();

79 ià(
w
->
i_fc
[1] & 
WIFI_FC1_WEP
) {

80 
p
->
	`kl
();

84 
dœ
 = 
w
->
i_fc
[1] & 
WIFI_FC1_DIR_MASK
;

86 
dœ
) {

87 
WIFI_FC1_DIR_NODS
:

88 
d¡
 = 
	`Eth”Add»ss
(
w
->
i_addr1
);

89 
¤c
 = 
	`Eth”Add»ss
(
w
->
i_addr2
);

90 
bssid
 = 
	`Eth”Add»ss
(
w
->
i_addr3
);

92 
WIFI_FC1_DIR_TODS
:

93 
bssid
 = 
	`Eth”Add»ss
(
w
->
i_addr1
);

94 
¤c
 = 
	`Eth”Add»ss
(
w
->
i_addr2
);

95 
d¡
 = 
	`Eth”Add»ss
(
w
->
i_addr3
);

97 
WIFI_FC1_DIR_FROMDS
:

98 
d¡
 = 
	`Eth”Add»ss
(
w
->
i_addr1
);

99 
bssid
 = 
	`Eth”Add»ss
(
w
->
i_addr2
);

100 
¤c
 = 
	`Eth”Add»ss
(
w
->
i_addr3
);

102 
WIFI_FC1_DIR_DSTODS
:

103 
d¡
 = 
	`Eth”Add»ss
(
w
->
i_addr1
);

104 
¤c
 = 
	`Eth”Add»ss
(
w
->
i_addr2
);

105 
bssid
 = 
	`Eth”Add»ss
(
w
->
i_addr3
);

108 
	`şick_ch©‹r
("%p{element}: invalid dir %d\n",

109 
this
,

110 
dœ
);

111 ià(
_¡riù
) {

112 
p
->
	`kl
();

115 
d¡
 = 
	`Eth”Add»ss
(
w
->
i_addr1
);

116 
¤c
 = 
	`Eth”Add»ss
(
w
->
i_addr2
);

117 
bssid
 = 
	`Eth”Add»ss
(
w
->
i_addr3
);

120 
Wr™abËPack‘
 *
p_out
 = 
p
->
	`uniqueify
();

121 ià(!
p_out
) {

125 
ušt16_t
 
‘h”_ty³
;

126 ià(!
_¡riù
 || !
	`memcmp
(
WIFI_LLC_HEADER
, 
p_out
->
	`d©a
(è+ 
wifi_h—d”_size
,

127 
WIFI_LLC_HEADER_LEN
)) {

128 
	`memıy
(&
‘h”_ty³
, 
p_out
->
	`d©a
(è+ 
wifi_h—d”_size
 + (
şick_Îc
) - 2, 2);

130 
p_out
->
	`kl
();

134 
p_out
->
	`puÎ
(
wifi_h—d”_size
 + (
şick_Îc
));

136 ià(
_push_‘h
) {

137 
p_out
 =…_out->
	`push_mac_h—d”
(14);

138 ià(!
p_out
) {

142 
	`memıy
(
p_out
->
	`d©a
(), 
d¡
.data(), 6);

143 
	`memıy
(
p_out
->
	`d©a
(è+ 6, 
¤c
.data(), 6);

144 
	`memıy
(
p_out
->
	`d©a
(è+ 12, &
‘h”_ty³
, 2);

146 ià(
_debug
) {

147 
	`şick_ch©‹r
("%p{element}: dir %d src %s dst %s bssid %sƒth 0x%02x\n",

148 
this
,

149 
dœ
,

150 
¤c
.
	`uÅ¬£
().
	`c_¡r
(),

151 
d¡
.
	`uÅ¬£
().
	`c_¡r
(),

152 
bssid
.
	`uÅ¬£
().
	`c_¡r
(),

153 
‘h”_ty³
);

157  
p_out
;

158 
	}
}

161 ’um {
	mH_DEBUG
};

163 
SŒšg


164 
	$WifiDeÿp_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

166 
WifiDeÿp
 *
td
 = (WifiDeÿ°*)
e
;

167 (
ušŒ_t
è
thunk
) {

168 
H_DEBUG
:

169  
	`SŒšg
(
td
->
_debug
) + "\n";

171  
	`SŒšg
();

173 
	}
}

175 
	$WifiDeÿp_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

176 
E¼ÜHªdËr
 *
”rh
)

178 
WifiDeÿp
 *
f
 = (WifiDeÿ°*)
e
;

179 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

180 (
šŒ_t
)
v·¿m
) {

181 
H_DEBUG
: {

182 
boŞ
 
debug
;

183 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

184  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

185 
f
->
_debug
 = 
debug
;

190 
	}
}

193 
	gWifiDeÿp
::
	$add_hªdËrs
()

195 
	`add_»ad_hªdËr
("debug", 
WifiDeÿp_»ad_·¿m
, 
H_DEBUG
);

197 
	`add_wr™e_hªdËr
("debug", 
WifiDeÿp_wr™e_·¿m
, 
H_DEBUG
);

198 
	}
}

199 
CLICK_ENDDECLS


200 
EXPORT_ELEMENT
(
WifiDeÿp
)

	@wifi/wifidecap.hh

1 #iâdeà
CLICK_WIFIDECAP_HH


2 
	#CLICK_WIFIDECAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
CLICK_DECLS


44 şas 
	cWifiDeÿp
 : 
public
 
EËm’t
 {…ublic:

46 
	$WifiDeÿp
(è
CLICK_COLD
;

47 ~
	$WifiDeÿp
(è
CLICK_COLD
;

49 cÚ¡ *
	$şass_Çme
() const {  "WifiDecap"; }

50 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

51 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

53 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

54 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

56 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

59 
	$add_hªdËrs
(è
CLICK_COLD
;

62 
boŞ
 
_debug
;

63 
boŞ
 
_¡riù
;

64 
boŞ
 
_push_‘h
;

65 
´iv©e
:

67 
	}
};

69 
	gCLICK_ENDDECLS


	@wifi/wifidefrag.cc

18 
	~<şick/cÚfig.h
>

19 
	~"wifideäag.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/wifi.h
>

25 
	~<şickÃt/Îc.h
>

26 
	~<şick/·ck‘_ªno.hh
>

27 
CLICK_DECLS


30 
	gWifiDeäag
::
	$WifiDeäag
()

32 
	}
}

34 
WifiDeäag
::~
	$WifiDeäag
()

36 
	}
}

39 
WifiDeäag
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

41 
	g_debug
 = 
çl£
;

42  
Args
(
cÚf
, 
this
, 
”rh
).
»ad
("DEBUG", 
_debug
).
com¶‘e
();

45 
Pack‘
 *

46 
	gWifiDeäag
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

49 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

50 
Eth”Add»ss
 
¤c
 = 
	`Eth”Add»ss
(
w
->
i_addr2
);

51 
ušt16_t
 
£q
 = 
	`Ë16_to_ıu
(
w
->
i_£q
è>> 
WIFI_SEQ_SEQ_SHIFT
;

52 
ušt8_t
 
äag
 = 
	`Ë16_to_ıu
(
w
->
i_£q
è& 
WIFI_SEQ_FRAG_MASK
;

53 
u_št8_t
 
mÜe_äag
 = 
w
->
i_fc
[1] & 
WIFI_FC1_MORE_FRAG
;

54 
Pack‘Info
 *
nfo
 = 
_·ck‘s
.
	`fšdp
(
¤c
);

57 ià(!
mÜe_äag
 && 
äag
 == 0) {

59 ià(
_debug
) {

60 
	`şick_ch©‹r
("%p{element}:‚o defrag %s seq %d frag %d\n",

61 
this
,

62 
¤c
.
	`uÅ¬£
().
	`c_¡r
(),

63 
£q
,

64 
äag
);

66 ià(
nfo
 &&‚fo->
Ãxt_äag
) {

67 
nfo
->
	`ş—r
();

69  
p
;

72 ià(
äag
 && (!
nfo
 ||‚fo->
Ãxt_äag
 != frag ||

73 (
nfo
->
£q
 &&‚fo->seq != seq))) {

75 ià(
_debug
) {

76 
	`şick_ch©‹r
("%p{element}: unrelated frag %s seq %d frag %d\n",

77 
this
,

78 
¤c
.
	`uÅ¬£
().
	`c_¡r
(),

79 
£q
,

80 
äag
);

81 ià(
nfo
) {

82 
	`şick_ch©‹r
("nfo seq %d‚ext_frag %d\n",

83 
nfo
->
£q
,

84 
nfo
->
Ãxt_äag
);

87 ià(
nfo
) {

88 
nfo
->
	`ş—r
();

90 
p
->
	`kl
();

94 ià(!
nfo
) {

95 
_·ck‘s
.
	`š£¹
(
¤c
, 
	`Pack‘Info
(src));

96 
nfo
 = 
_·ck‘s
.
	`fšdp
(
¤c
);

98 
	`as£¹
(
nfo
);

100 ià(
äag
 == 0) {

102 
nfo
->
p
 =…;

103 
nfo
->
£q
 = seq;

104 ià(
_debug
) {

105 
	`şick_ch©‹r
("%p{element}: first frag %s seq %d frag %d\n",

106 
this
,

107 
¤c
.
	`uÅ¬£
().
	`c_¡r
(),

108 
£q
,

109 
äag
);

114 
	`as£¹
(
nfo
->
p
);

115 
ušt32_t
 
Ën
 = 
nfo
->
p
->
	`Ëngth
();

117 
p
->
	`puÎ
((
şick_wifi
));

118 ià((
nfo
->
p
 =‚fo->p->
	`put
Õ->
	`Ëngth
())))

119 
	`memıy
((*è(
nfo
->
p
->
	`d©a
(è+ 
Ën
),…->d©a(),…->
	`Ëngth
());

120 
p
->
	`kl
();

123 ià(
mÜe_äag
) {

124 
nfo
->
Ãxt_äag
++;

128 ià(
_debug
) {

129 
	`şick_ch©‹r
("%p{element}:†ast frag %s seq %d frag %d\n",

130 
this
,

131 
¤c
.
	`uÅ¬£
().
	`c_¡r
(),

132 
£q
,

133 
äag
);

135 
p
 = 
nfo
->p;

136 
w
 = (
şick_wifi
 *è
p
->
	`d©a
();

137 
w
->
i_£q
 = 
	`ıu_to_Ë16
(((
u_št16_t
è
nfo
->
£q
è<< 
WIFI_SEQ_SEQ_SHIFT
);

138 
w
->
i_fc
[1] ^ğ
WIFI_FC1_MORE_FRAG
;

140 
nfo
->
p
 = 0;

141 
nfo
->
	`ş—r
();

146  
p
;

147 
	}
}

150 ’um {
	mH_DEBUG
, };

152 
SŒšg


153 
	gWifiDeäag
::
	$»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

155 
WifiDeäag
 *
td
 = (WifiDeäag *)
e
;

156 (
ušŒ_t
è
thunk
) {

157 
H_DEBUG
:

158  
	`SŒšg
(
td
->
_debug
) + "\n";

160  
	`SŒšg
();

162 
	}
}

164 
	gWifiDeäag
::
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

165 
E¼ÜHªdËr
 *
”rh
)

167 
WifiDeäag
 *
f
 = (WifiDeäag *)
e
;

168 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

169 (
šŒ_t
)
v·¿m
) {

170 
H_DEBUG
: {

171 
boŞ
 
debug
;

172 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

173  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

174 
f
->
_debug
 = 
debug
;

179 
	}
}

182 
	gWifiDeäag
::
	$add_hªdËrs
()

184 
	`add_»ad_hªdËr
("debug", 
»ad_·¿m
, 
H_DEBUG
);

186 
	`add_wr™e_hªdËr
("debug", 
wr™e_·¿m
, 
H_DEBUG
);

187 
	}
}

189 
	$EXPORT_ELEMENT
(
WifiDeäag
)

190 
CLICK_ENDDECLS


	@wifi/wifidefrag.hh

1 #iâdeà
CLICK_WIFIDEFRAG_HH


2 
	#CLICK_WIFIDEFRAG_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<şick/hashm­.hh
>

7 
CLICK_DECLS


28 şas 
	cWifiDeäag
 : 
public
 
EËm’t
 {…ublic:

30 
	$WifiDeäag
(è
CLICK_COLD
;

31 ~
	$WifiDeäag
(è
CLICK_COLD
;

33 cÚ¡ *
	$şass_Çme
() const {  "WifiDefrag"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

35 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

37 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

38 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

40 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

43 
	$add_hªdËrs
(è
CLICK_COLD
;

46 
	sPack‘Info
 {

47 
Eth”Add»ss
 
¤c
;

48 
ušt16_t
 
Ãxt_äag
;

49 
ušt16_t
 
£q
;

50 
Pack‘
 *
p
;

52 
	`Pack‘Info
() {

53 
p
 = 0;

54 
	`ş—r
();

56 
	`Pack‘Info
(
Eth”Add»ss
 
s
) {

57 
p
 = 0;

58 
	`ş—r
();

59 
¤c
 = 
s
;

62 
	`ş—r
() {

63 ià(
p
) {

64 
p
->
	`kl
();

66 
p
 = 0;

67 
Ãxt_äag
 = 0;

68 
£q
 = 0;

70 
	}
};

73 
	gHashM­
<
	tEth”Add»ss
, 
	tPack‘Info
> 
	tPack‘InfoTabË
;

74 
	gPack‘InfoTabË
::
	tcÚ¡_™”©Ü
 
	tPII‹r
;

76 
Pack‘InfoTabË
 
	g_·ck‘s
;

77 
boŞ
 
	g_debug
;

78 
SŒšg
 
	$»ad_·¿m
(
EËm’t
 *
e
, *
thunk
è
CLICK_COLD
;

79 
	`wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

80 
E¼ÜHªdËr
 *
”rh
);

81 
´iv©e
:

83 
	}
};

85 
	gCLICK_ENDDECLS


	@wifi/wifidupefilter.cc

19 
	~<şick/cÚfig.h
>

20 
	~<şick/¬gs.hh
>

21 
	~<şick/”rÜ.hh
>

22 
	~<şick/glue.hh
>

23 
	~<şick/¡¿ccum.hh
>

24 
	~<şick/·ck‘_ªno.hh
>

25 
	~<şick/¬gs.hh
>

26 
	~<şick/‘h”add»ss.hh
>

27 
	~<şickÃt/wifi.h
>

28 
	~"wifidu³f‹r.hh
"

30 
CLICK_DECLS


32 
	gWifiDu³F‹r
::
	$WifiDu³F‹r
()

33 : 
	`_debug
(
çl£
),

34 
	$_du³s
(0)

36 
	}
}

38 
	gWifiDu³F‹r
::~
	$WifiDu³F‹r
()

40 
	}
}

43 
WifiDu³F‹r
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
* 
”rh
)

45  
Args
(
cÚf
, 
this
, 
”rh
).
»ad
("DEBUG", 
_debug
).
com¶‘e
();

48 
Pack‘
 *

49 
	gWifiDu³F‹r
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
)

51 
şick_wifi
 *
w
 = (şick_wif˜*è
p_š
->
	`d©a
();

53 ià(
p_š
->
	`Ëngth
(è< (
şick_wifi
)) {

54  
p_š
;

57 
Eth”Add»ss
 
¤c
 = 
	`Eth”Add»ss
(
w
->
i_addr2
);

58 
Eth”Add»ss
 
d¡
 = 
	`Eth”Add»ss
(
w
->
i_addr1
);

59 
ušt16_t
 
£q
 = 
	`Ë16_to_ıu
(
w
->
i_£q
è>> 
WIFI_SEQ_SEQ_SHIFT
;

60 
ušt8_t
 
äag
 = 
	`Ë16_to_ıu
(
w
->
i_£q
è& 
WIFI_SEQ_FRAG_MASK
;

61 
u_št8_t
 
mÜe_äag
 = 
w
->
i_fc
[1] & 
WIFI_FC1_MORE_FRAG
;

63 
boŞ
 
is_äag
 = 
äag
 || 
mÜe_äag
;

65 
D¡Info
 *
nfo
 = 
_bË
.
	`fšdp
(
¤c
);

67 ià(
w
->
i_fc
[0] & 
WIFI_FC0_TYPE_CTL
 || 
d¡
.
	`is_group
()) {

68  
p_š
;

70 ià(!
nfo
) {

71 
_bË
.
	`š£¹
(
¤c
, 
	`D¡Info
(src));

72 
nfo
 = 
_bË
.
	`fšdp
(
¤c
);

73 
nfo
->
	`ş—r
();

76 ià(
w
->
i_fc
[1] & 
WIFI_FC1_RETRY
 && 
£q
 =ğ
nfo
->seq &&

77 (!
is_äag
 || 
äag
 <ğ
nfo
->frag)) {

79 ià(
_debug
) {

80 
	`şick_ch©‹r
("%p{element}: dup seq %d frag %d src %s\n",

81 
this
,

82 
£q
,

83 
äag
,

84 
¤c
.
	`uÅ¬£
().
	`c_¡r
());

86 
nfo
->
_du³s
++;

87 
_du³s
++;

88 
p_š
->
	`kl
();

92 
nfo
->
£q
 = seq;

93 
nfo
->
äag
 = frag;

94  
p_š
;

95 
	}
}

98 
SŒšg


99 
	gWifiDu³F‹r
::
	$¡©ic_»ad_¡©s
(
EËm’t
 *
xf
, *)

101 
WifiDu³F‹r
 *
e
 = (WifiDu³F‹¸*è
xf
;

102 
SŒšgAccum
 
§
;

104 
D¡TabË
::
cÚ¡_™”©Ü
 
i
 = 
e
->
_bË
.
	`begš
(); i.
	`live
(); i++) {

105 
D¡Info
 
nfo
 = 
i
.
	`v®ue
();

106 
§
 << 
nfo
.
_‘h
;

107 
§
 << "…ack‘ " << 
nfo
.
_·ck‘s
;

108 
§
 << " du³ " << 
nfo
.
_du³s
;

109 
§
 << " seq " << 
nfo
.
£q
;

110 
§
 << " f¿g " << 
nfo
.
äag
;

111 
§
 << "\n";

114  
§
.
	`ke_¡ršg
();

115 
	}
}

117 ’um {
	mH_DEBUG
, 
	mH_DUPES
, 
	mH_RESET
};

119 
SŒšg


120 
	$WifiDu³F‹r_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

122 
WifiDu³F‹r
 *
td
 = (WifiDu³F‹¸*)
e
;

123 (
ušŒ_t
è
thunk
) {

124 
H_DEBUG
:

125  
	`SŒšg
(
td
->
_debug
) + "\n";

126 
H_DUPES
:

127  
	`SŒšg
(
td
->
_du³s
) + "\n";

129  
	`SŒšg
();

131 
	}
}

133 
	$WifiDu³F‹r_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

134 
E¼ÜHªdËr
 *
”rh
)

136 
WifiDu³F‹r
 *
f
 = (WifiDu³F‹¸*)
e
;

137 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

138 (
šŒ_t
)
v·¿m
) {

139 
H_DEBUG
: {

140 
boŞ
 
debug
;

141 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

142  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

143 
f
->
_debug
 = 
debug
;

146 
H_RESET
: {

147 
f
->
_bË
.
	`ş—r
();

148 
f
->
_du³s
 = 0;

152 
	}
}

154 
	gWifiDu³F‹r
::
	$add_hªdËrs
()

156 
	`add_»ad_hªdËr
("debug", 
WifiDu³F‹r_»ad_·¿m
, 
H_DEBUG
);

157 
	`add_»ad_hªdËr
("du³s", 
WifiDu³F‹r_»ad_·¿m
, 
H_DUPES
);

158 
	`add_»ad_hªdËr
("drİs", 
WifiDu³F‹r_»ad_·¿m
, 
H_DUPES
);

160 
	`add_wr™e_hªdËr
("debug", 
WifiDu³F‹r_wr™e_·¿m
, 
H_DEBUG
);

161 
	`add_wr™e_hªdËr
("»£t", 
WifiDu³F‹r_wr™e_·¿m
, 
H_RESET
, 
HªdËr
::
BUTTON
);

163 
	`add_»ad_hªdËr
("¡©s", 
¡©ic_»ad_¡©s
, 0);

164 
	}
}

166 
	$EXPORT_ELEMENT
(
WifiDu³F‹r
)

167 
CLICK_ENDDECLS


	@wifi/wifidupefilter.hh

1 #iâdeà
CLICK_WIFIDUPEFILTER_HH


2 
	#CLICK_WIFIDUPEFILTER_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/¡ršg.hh
>

5 
	~<şick/hashm­.hh
>

6 
CLICK_DECLS


22 şas 
	cWifiDu³F‹r
 : 
public
 
EËm’t
 {

24 
public
:

26 
	$WifiDu³F‹r
(è
CLICK_COLD
;

27 ~
	$WifiDu³F‹r
(è
CLICK_COLD
;

29 cÚ¡ *
	$şass_Çme
() const {  "WifiDupeFilter"; }

30 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

31 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

33 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

35 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

37 
SŒšg
 
¡©ic_»ad_¡©s
(
EËm’t
 *
xf
, *);

38 
SŒšg
 
¡©ic_»ad_debug
(
EËm’t
 *
xf
, *);

39 
¡©ic_wr™e_debug
(cÚ¡ 
SŒšg
 &
¬g
, 
EËm’t
 *
e
,

40 *, 
E¼ÜHªdËr
 *
”rh
);

41 
	$add_hªdËrs
(è
CLICK_COLD
;

43 şas 
	cD¡Info
 {

44 
public
:

45 
Eth”Add»ss
 
_‘h
;

46 
_du³s
;

47 
_·ck‘s
;

49 
ušt16_t
 
£q
;

50 
ušt16_t
 
äag
;

52 
	`D¡Info
(
Eth”Add»ss
 
‘h
) {

53 
_‘h
 = 
‘h
;

55 
	`D¡Info
 () { }

56 
	`ş—r
() {

57 
_du³s
 = 0;

58 
_·ck‘s
 = 0;

59 
£q
 = 0;

60 
äag
 = 0;

63 
	}
};

65 
	gHashM­
 <
	tEth”Add»ss
, 
	tD¡Info
> 
	tD¡TabË
;

66 
	gD¡TabË
::
	tcÚ¡_™”©Ü
 
	tD¡I‹r
;

68 
D¡TabË
 
	g_bË
;

69 
boŞ
 
	g_debug
;

71 
	g_du³s
;

74 
	gCLICK_ENDDECLS


	@wifi/wifiencap.cc

18 
	~<şick/cÚfig.h
>

19 
	~"wif›nÿp.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/wifi.h
>

25 
	~<şickÃt/Îc.h
>

26 
	~<şick/·ck‘_ªno.hh
>

27 
	~<–em’ts/wifi/wœ–essšfo.hh
>

28 
CLICK_DECLS


30 
	gWifiEnÿp
::
	$WifiEnÿp
()

31 : 
	$_wšfo
(0)

33 
	}
}

35 
WifiEnÿp
::~
	$WifiEnÿp
()

37 
	}
}

40 
WifiEnÿp
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

43 
	g_debug
 = 
çl£
;

44 
	g_mode
 = 
WIFI_FC1_DIR_NODS
;

45 ià(
Args
(
cÚf
, 
this
, 
”rh
)

46 .
»ad_mp
("MODE", 
_mode
)

47 .
»ad_p
("BSSID", 
_bssid
)

48 .
»ad
("WIRELESS_INFO", 
EËm’tCa¡Arg
("Wœ–essInfo"), 
_wšfo
)

49 .
»ad
("DEBUG", 
_debug
)

50 .
com¶‘e
() < 0)

55 
Pack‘
 *

56 
	gWifiEnÿp
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p
)

60 
Eth”Add»ss
 
¤c
;

61 
Eth”Add»ss
 
d¡
;

62 
Eth”Add»ss
 
bssid
 = 
_wšfo
 ? _wšfo->
_bssid
 : _bssid;

64 
ušt16_t
 
‘hty³
;

65 
Wr™abËPack‘
 *
p_out
 = 0;

67 ià(
p
->
	`Ëngth
(è< (
şick_‘h”
)) {

68 
	`şick_ch©‹r
("%p{element}:…acketoo small: %d vs %d\n",

69 
this
,

70 
p
->
	`Ëngth
(),

71 (
şick_‘h”
));

73 
p
->
	`kl
();

78 
şick_‘h”
 *
eh
 = (şick_‘h” *è
p
->
	`d©a
();

79 
¤c
 = 
	`Eth”Add»ss
(
eh
->
‘h”_sho¡
);

80 
d¡
 = 
	`Eth”Add»ss
(
eh
->
‘h”_dho¡
);

81 
	`memıy
(&
‘hty³
, 
p
->
	`d©a
() + 12, 2);

83 
p_out
 = 
p
->
	`uniqueify
();

84 ià(!
p_out
) {

89 
p_out
->
	`puÎ
((
şick_‘h”
));

90 
p_out
 =…_out->
	`push
((
şick_Îc
));

92 ià(!
p_out
) {

96 
	`memıy
(
p_out
->
	`d©a
(), 
WIFI_LLC_HEADER
, 
WIFI_LLC_HEADER_LEN
);

97 
	`memıy
(
p_out
->
	`d©a
(è+ 6, &
‘hty³
, 2);

99 ià(!(
p_out
 =…_out->
	`push
((
şick_wifi
))))

101 
şick_wifi
 *
w
 = (şick_wif˜*è
p_out
->
	`d©a
();

103 
	`mem£t
(
p_out
->
	`d©a
(), 0, (
şick_wifi
));

104 
w
->
i_fc
[0] = (
ušt8_t
è(
WIFI_FC0_VERSION_0
 | 
WIFI_FC0_TYPE_DATA
);

105 
w
->
i_fc
[1] = 0;

106 
w
->
i_fc
[1] |ğ(
ušt8_t
è(
WIFI_FC1_DIR_MASK
 & 
_mode
);

110 
_mode
) {

111 
WIFI_FC1_DIR_NODS
:

112 
	`memıy
(
w
->
i_addr1
, 
d¡
.
	`d©a
(), 6);

113 
	`memıy
(
w
->
i_addr2
, 
¤c
.
	`d©a
(), 6);

114 
	`memıy
(
w
->
i_addr3
, 
bssid
.
	`d©a
(), 6);

116 
WIFI_FC1_DIR_TODS
:

117 
	`memıy
(
w
->
i_addr1
, 
bssid
.
	`d©a
(), 6);

118 
	`memıy
(
w
->
i_addr2
, 
¤c
.
	`d©a
(), 6);

119 
	`memıy
(
w
->
i_addr3
, 
d¡
.
	`d©a
(), 6);

121 
WIFI_FC1_DIR_FROMDS
:

122 
	`memıy
(
w
->
i_addr1
, 
d¡
.
	`d©a
(), 6);

123 
	`memıy
(
w
->
i_addr2
, 
bssid
.
	`d©a
(), 6);

124 
	`memıy
(
w
->
i_addr3
, 
¤c
.
	`d©a
(), 6);

126 
WIFI_FC1_DIR_DSTODS
:

128 
	`memıy
(
w
->
i_addr1
, 
d¡
.
	`d©a
(), 6);

129 
	`memıy
(
w
->
i_addr2
, 
¤c
.
	`d©a
(), 6);

130 
	`memıy
(
w
->
i_addr3
, 
bssid
.
	`d©a
(), 6);

133 
	`şick_ch©‹r
("%p{element}: invalid mode %d\n",

134 
this
,

135 
_mode
);

136 
p_out
->
	`kl
();

139  
p_out
;

140 
	}
}

143 ’um {
	mH_DEBUG
, 
	mH_MODE
, 
	mH_BSSID
};

145 
SŒšg


146 
	$WifiEnÿp_»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

148 
WifiEnÿp
 *
td
 = (WifiEnÿ°*)
e
;

149 (
ušŒ_t
è
thunk
) {

150 
H_DEBUG
:

151  
	`SŒšg
(
td
->
_debug
) + "\n";

152 
H_MODE
:

153  
	`SŒšg
(
td
->
_mode
) + "\n";

154 
H_BSSID
:

155  
td
->
_bssid
.
	`uÅ¬£
() + "\n";

157  
	`SŒšg
();

159 
	}
}

161 
	$WifiEnÿp_wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

162 
E¼ÜHªdËr
 *
”rh
)

164 
WifiEnÿp
 *
f
 = (WifiEnÿ°*)
e
;

165 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

166 (
šŒ_t
)
v·¿m
) {

167 
H_DEBUG
: {

168 
boŞ
 
debug
;

169 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

170  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

171 
f
->
_debug
 = 
debug
;

175 
H_MODE
: {

176 
m
;

177 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

178  
”rh
->
	`”rÜ
("mode…arameter must be int");

179 
f
->
_mode
 = 
m
;

182 
H_BSSID
: {

183 
Eth”Add»ss
 
e
;

184 ià(!
	`Eth”Add»ssArg
().
	`·r£
(
s
, 
e
))

185  
”rh
->
	`”rÜ
("bssid…arameter must beƒthernet‡ddress");

186 
f
->
_bssid
 = 
e
;

191 
	}
}

194 
	gWifiEnÿp
::
	$add_hªdËrs
()

196 
	`add_»ad_hªdËr
("debug", 
WifiEnÿp_»ad_·¿m
, 
H_DEBUG
);

197 
	`add_»ad_hªdËr
("mode", 
WifiEnÿp_»ad_·¿m
, 
H_MODE
);

198 
	`add_»ad_hªdËr
("bssid", 
WifiEnÿp_»ad_·¿m
, 
H_BSSID
);

200 
	`add_wr™e_hªdËr
("debug", 
WifiEnÿp_wr™e_·¿m
, 
H_DEBUG
);

201 
	`add_wr™e_hªdËr
("mode", 
WifiEnÿp_wr™e_·¿m
, 
H_MODE
);

202 
	`add_wr™e_hªdËr
("bssid", 
WifiEnÿp_wr™e_·¿m
, 
H_BSSID
);

203 
	}
}

204 
CLICK_ENDDECLS


205 
EXPORT_ELEMENT
(
WifiEnÿp
)

	@wifi/wifiencap.hh

1 #iâdeà
CLICK_WIFIENCAP_HH


2 
	#CLICK_WIFIENCAP_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
	~<şick/‘h”add»ss.hh
>

6 
CLICK_DECLS


63 şas 
	cWifiEnÿp
 : 
public
 
EËm’t
 {…ublic:

65 
	$WifiEnÿp
(è
CLICK_COLD
;

66 ~
	$WifiEnÿp
(è
CLICK_COLD
;

68 cÚ¡ *
	$şass_Çme
() const {  "WifiEncap"; }

69 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

70 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

72 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

73 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

75 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

78 
	$add_hªdËrs
(è
CLICK_COLD
;

81 
boŞ
 
_debug
;

83 
_mode
;

84 
Eth”Add»ss
 
_bssid
;

85 
şass
 
Wœ–essInfo
 *
_wšfo
;

86 
´iv©e
:

88 
	}
};

90 
	gCLICK_ENDDECLS


	@wifi/wififragment.cc

18 
	~<şick/cÚfig.h
>

19 
	~"wifiäagm’t.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/wifi.h
>

25 
	~<şickÃt/Îc.h
>

26 
	~<şick/·ck‘_ªno.hh
>

27 
CLICK_DECLS


30 
	gWifiF¿gm’t
::
	$WifiF¿gm’t
()

32 
	}
}

34 
WifiF¿gm’t
::~
	$WifiF¿gm’t
()

36 
	}
}

39 
WifiF¿gm’t
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

42 
	g_debug
 = 
çl£
;

43 
	g_max_Ëngth
 = 0;

44 ià(
Args
(
cÚf
, 
this
, 
”rh
)

45 .
»ad_p
("MTU", 
_max_Ëngth
)

46 .
»ad
("DEBUG", 
_debug
)

47 .
com¶‘e
() < 0)

54 
	gWifiF¿gm’t
::
	$push
(
pÜt
, 
Pack‘
 *
p
)

57 
şick_wifi
 *
w
 = (şick_wif˜*è
p
->
	`d©a
();

58 
ušt16_t
 
£q
 = 
	`Ë16_to_ıu
(
w
->
i_£q
è>> 
WIFI_SEQ_SEQ_SHIFT
;

59 ià(!
_max_Ëngth
 ||

60 
p
->
	`Ëngth
(è<ğ(
şick_wifi
è+ 
_max_Ëngth
) {

61 ià(
_debug
) {

62 
	`şick_ch©‹r
("%p{element}:‚o modificatoin\n",

63 
this
);

65 
	`ouut
(
pÜt
).
	`push
(
p
);

69 
num_äags
 = (
p
->
	`Ëngth
(è- (
şick_wifi
)è/ 
_max_Ëngth
;

70 
Ï¡_Ën
 = (
p
->
	`Ëngth
(è- (
şick_wifi
)è% 
_max_Ëngth
;

71 ià(
Ï¡_Ën
) {

72 
num_äags
++;

74 
Ï¡_Ën
 = 
_max_Ëngth
;

76 ià(
_debug
) {

77 
	`şick_ch©‹r
("%p{element} click_wifi %d, seq %d frags %d†ast_len %d\n",

78 
this
, (
şick_wifi
), 
£q
, 
num_äags
, 
Ï¡_Ën
);

80 
äag
 = 0; f¿g < 
num_äags
; frag++) {

81 
ušt32_t
 
äag_Ën
 = (
äag
 =ğ
num_äags
 - 1è? 
Ï¡_Ën
 : 
_max_Ëngth
;

82 ià(
_debug
) {

83 
	`şick_ch©‹r
("%p{element}: %s: on frag %d/%d†en %d\n",

84 
this
,

85 
__func__
,

86 
äag
, 
num_äags
,

87 (
şick_wifi
è+ 
äag_Ën
);

90 
Pack‘
 *
p_out
 = Pack‘::
	`make
((
şick_wifi
è+ 
äag_Ën
);

91 
	`memıy
((*è
p_out
->
	`d©a
(), 
p
->d©a(), (
şick_wifi
));

93 
	`memıy
((*è(
p_out
->
	`d©a
(è+ (
şick_wifi
)),

94 
p
->
	`d©a
(è+ (
şick_wifi
è+ 
äag
*
_max_Ëngth
,

95 
äag_Ën
);

96 
şick_wifi
 *
w_o
 = (şick_wif˜*è
p_out
->
	`d©a
();

97 
ušt16_t
 
£q_o
 = (
£q
 << 
WIFI_SEQ_SEQ_SHIFT
è| (((
u_št8_t
è
äag
è& 
WIFI_SEQ_FRAG_MASK
);

98 
w_o
->
i_£q
 = 
	`ıu_to_Ë16
(
£q_o
);

99 ià(
äag
 !ğ
num_äags
 - 1) {

100 
w_o
->
i_fc
[1] |ğ
WIFI_FC1_MORE_FRAG
;

103 
	`ouut
(
pÜt
).
	`push
(
p_out
);

105 
p
->
	`kl
();

108 
	}
}

111 ’um {
	mH_DEBUG
, };

113 
SŒšg


114 
	gWifiF¿gm’t
::
	$»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

116 
WifiF¿gm’t
 *
td
 = (WifiF¿gm’ˆ*)
e
;

117 (
ušŒ_t
è
thunk
) {

118 
H_DEBUG
:

119  
	`SŒšg
(
td
->
_debug
) + "\n";

121  
	`SŒšg
();

123 
	}
}

125 
	gWifiF¿gm’t
::
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

126 
E¼ÜHªdËr
 *
”rh
)

128 
WifiF¿gm’t
 *
f
 = (WifiF¿gm’ˆ*)
e
;

129 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

130 (
šŒ_t
)
v·¿m
) {

131 
H_DEBUG
: {

132 
boŞ
 
debug
;

133 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

134  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

135 
f
->
_debug
 = 
debug
;

140 
	}
}

143 
	gWifiF¿gm’t
::
	$add_hªdËrs
()

145 
	`add_»ad_hªdËr
("debug", 
»ad_·¿m
, 
H_DEBUG
);

147 
	`add_wr™e_hªdËr
("debug", 
wr™e_·¿m
, 
H_DEBUG
);

148 
	}
}

150 
	$EXPORT_ELEMENT
(
WifiF¿gm’t
)

151 
CLICK_ENDDECLS


	@wifi/wififragment.hh

1 #iâdeà
CLICK_WIFIFRAGMENT_HH


2 
	#CLICK_WIFIFRAGMENT_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<şick/hashm­.hh
>

7 
CLICK_DECLS


28 şas 
	cWifiF¿gm’t
 : 
public
 
EËm’t
 {…ublic:

30 
	$WifiF¿gm’t
(è
CLICK_COLD
;

31 ~
	$WifiF¿gm’t
(è
CLICK_COLD
;

33 cÚ¡ *
	$şass_Çme
() const {  "WifiFragment"; }

34 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_1_1
; 
	}
}

35 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
PUSH
; 
	}
}

37 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

38 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

40 
push
(, 
Pack‘
 *);

43 
	$add_hªdËrs
(è
CLICK_COLD
;

46 
boŞ
 
_debug
;

47 
ušt32_t
 
_max_Ëngth
;

48 
SŒšg
 
	$»ad_·¿m
(
EËm’t
 *
e
, *
thunk
è
CLICK_COLD
;

49 
	`wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

50 
E¼ÜHªdËr
 *
”rh
);

51 
´iv©e
:

53 
	}
};

55 
	gCLICK_ENDDECLS


	@wifi/wifiseq.cc

18 
	~<şick/cÚfig.h
>

19 
	~"wifi£q.hh
"

20 
	~<şick/‘h”add»ss.hh
>

21 
	~<şick/¬gs.hh
>

22 
	~<şick/”rÜ.hh
>

23 
	~<şick/glue.hh
>

24 
	~<şickÃt/wifi.h
>

25 
	~<şickÃt/Îc.h
>

26 
	~<şick/·ck‘_ªno.hh
>

27 
	~<–em’ts/wifi/wœ–essšfo.hh
>

28 
CLICK_DECLS


31 
	gWifiSeq
::
	$WifiSeq
()

33 
	}
}

35 
WifiSeq
::~
	$WifiSeq
()

37 
	}
}

40 
WifiSeq
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

43 
	g_debug
 = 
çl£
;

44 
	g_£q
 = 0;

45 
	g_off£t
 = 22;

46 
	g_by‹s
 = 2;

47 
	g_shiá
 = 4;

49 ià(
Args
(
cÚf
, 
this
, 
”rh
)

50 .
»ad
("DEBUG", 
_debug
)

51 .
»ad
("OFFSET", 
_off£t
)

52 .
»ad
("BYTES", 
_by‹s
)

53 .
»ad
("SHIFT", 
_shiá
)

54 .
com¶‘e
() < 0)

57 ià(
	g_by‹s
 !ğ2 && 
_by‹s
 != 4) {

58  
”rh
->
”rÜ
("BYTES must beƒither 2 or 4");

60 
»£t
();

67 
	gWifiSeq
::
	$»£t
()

69 
_£q
 = 0;

70 
	}
}

72 
Pack‘
 *

73 
	gWifiSeq
::
	$sim¶e_aùiÚ
(
Pack‘
 *
p_š
) {

74 
Wr™abËPack‘
 *
p
 = 
p_š
 ?…_š->
	`uniqueify
() : 0;

76 ià(
p
 &&…->
	`Ëngth
(è> 
_off£t
 + 
_by‹s
) {

77 
şick_wifi_exŒa
 *
ûh
 = 
	`WIFI_EXTRA_ANNO
(
p_š
);

78 
ûh
->
æags
 |ğ
WIFI_EXTRA_NO_SEQ
;

79 *
d©a
 = (*)(
p
->
	`d©a
(è+ 
_off£t
);

80 ià(
_by‹s
 == 2) {

81 *(
u_št16_t
 *)
d©a
 = (
	`ıu_to_Ë16
(
_£q
 << 
_shiá
));

83 *(
u_št32_t
 *)
d©a
 = (
	`ıu_to_Ë32
(
_£q
 << 
_shiá
));

85 
_£q
++;

87  
p
;

89 
	}
}

91 ’um {
	mH_DEBUG
, 
	mH_SEQ
, 
	mH_OFFSET
, 
	mH_BYTES
, 
	mH_SHIFT
, 
	mH_RESET
};

93 
SŒšg


94 
	gWifiSeq
::
	$»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

96 
WifiSeq
 *
td
 = (WifiSeq *)
e
;

97 (
ušŒ_t
è
thunk
) {

98 
H_DEBUG
:

99  
	`SŒšg
(
td
->
_debug
) + "\n";

100 
H_SEQ
:

101  
	`SŒšg
(
td
->
_£q
) + "\n";

102 
H_OFFSET
:

103  
	`SŒšg
(
td
->
_off£t
) + "\n";

104 
H_BYTES
:

105  
	`SŒšg
(
td
->
_by‹s
) + "\n";

106 
H_SHIFT
:

107  
	`SŒšg
(
td
->
_shiá
) + "\n";

109  
	`SŒšg
();

111 
	}
}

114 
	gWifiSeq
::
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

115 
E¼ÜHªdËr
 *
”rh
)

117 
WifiSeq
 *
f
 = (WifiSeq *)
e
;

118 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

119 (
šŒ_t
)
v·¿m
) {

120 
H_DEBUG
: {

121 
boŞ
 
debug
;

122 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
debug
))

123  
”rh
->
	`”rÜ
("debug…arameter must be boolean");

124 
f
->
_debug
 = 
debug
;

128 
H_SEQ
: {

129 
ušt32_t
 
£q
;

130 ià(!
	`IÁArg
().
	`·r£
(
s
, 
£q
))

131  
”rh
->
	`”rÜ
("seq…arameter must be unsigned");

132 
f
->
_£q
 = 
£q
;

135 
H_RESET
: 
f
->
	`»£t
(); ;

138 
	}
}

141 
	gWifiSeq
::
	$add_hªdËrs
()

143 
	`add_»ad_hªdËr
("debug", 
»ad_·¿m
, 
H_DEBUG
);

144 
	`add_»ad_hªdËr
("£q", 
»ad_·¿m
, 
H_SEQ
);

145 
	`add_»ad_hªdËr
("off£t", 
»ad_·¿m
, 
H_OFFSET
);

146 
	`add_»ad_hªdËr
("by‹s", 
»ad_·¿m
, 
H_BYTES
);

147 
	`add_»ad_hªdËr
("shiá", 
»ad_·¿m
, 
H_SHIFT
);

149 
	`add_wr™e_hªdËr
("debug", 
wr™e_·¿m
, 
H_DEBUG
);

150 
	`add_wr™e_hªdËr
("£q", 
wr™e_·¿m
, 
H_SEQ
);

151 
	`add_wr™e_hªdËr
("»£t", 
wr™e_·¿m
, 
H_RESET
, 
HªdËr
::
BUTTON
);

152 
	}
}

153 
CLICK_ENDDECLS


154 
EXPORT_ELEMENT
(
WifiSeq
)

	@wifi/wifiseq.hh

1 #iâdeà
CLICK_WIFISEQ_HH


2 
	#CLICK_WIFISEQ_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şickÃt/‘h”.h
>

5 
	~<şick/‘h”add»ss.hh
>

6 
CLICK_DECLS


41 şas 
	cWifiSeq
 : 
public
 
EËm’t
 {…ublic:

43 
	$WifiSeq
(è
CLICK_COLD
;

44 ~
	$WifiSeq
(è
CLICK_COLD
;

46 cÚ¡ *
	$şass_Çme
() const {  "WifiSeq"; }

47 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  "1/-"; 
	}
}

48 cÚ¡ *
	$´oûssšg
(ècÚ¡ {  
AGNOSTIC
; 
	}
}

50 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

51 
boŞ
 
	$ÿn_live_»cÚfigu»
(ècÚ¡ {  
Œue
; 
	}
}

53 
Pack‘
 *
sim¶e_aùiÚ
(Packet *);

55 
	$add_hªdËrs
(è
CLICK_COLD
;

56 
SŒšg
 
	$»ad_·¿m
(
EËm’t
 *, *è
CLICK_COLD
;

57 
	`wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

58 
E¼ÜHªdËr
 *
”rh
);

60 
Pack‘
 *
	`­¶y_£q
(Packet *);

62 
	`»£t
();

63 
boŞ
 
_debug
;

65 
u_št32_t
 
_£q
;

66 
u_št32_t
 
_off£t
;

67 
u_št32_t
 
_shiá
;

68 
u_št32_t
 
_by‹s
;

70 
	}
};

72 
	gCLICK_ENDDECLS


	@wifi/wirelessinfo.cc

18 
	~<şick/cÚfig.h
>

19 
	~<şick/¬gs.hh
>

20 
	~<şick/”rÜ.hh
>

21 
	~<şick/glue.hh
>

22 
	~<şick/¡¿ccum.hh
>

23 
	~<şickÃt/‘h”.h
>

24 
	~"wœ–essšfo.hh
"

25 
	~<şick/rou‹r.hh
>

26 
CLICK_DECLS


28 
	gWœ–essInfo
::
	$Wœ–essInfo
()

29 : 
	`_ssid
(""),

30 
	`_bssid
((const *) "\000\000\000\000\000\000"),

31 
	`_chªÃl
(-1),

32 
	`_š‹rv®
(100),

33 
	$_w•
(
çl£
)

36 
	}
}

38 
	gWœ–essInfo
::~
	$Wœ–essInfo
()

40 
	}
}

43 
Wœ–essInfo
::
cÚfigu»
(
VeùÜ
<
SŒšg
> &
cÚf
, 
E¼ÜHªdËr
 *
”rh
)

45 
	g»s
;

46 
»£t
();

47 
	g»s
 = 
Args
(
cÚf
, 
this
, 
”rh
)

48 .
»ad
("SSID", 
_ssid
)

49 .
»ad
("BSSID", 
_bssid
)

50 .
»ad
("CHANNEL", 
_chªÃl
)

51 .
»ad
("INTERVAL", 
_š‹rv®
)

52 .
»ad
("WEP", 
_w•
)

53 #ià
CLICK_NS


54 .
»ad
("IFID", 
_ifid
)

56 .
com¶‘e
();

58 #ià
CLICK_NS


61 ià(
	g_ifid
 >= 0)

62 
simşick_sim_commªd
(
rou‹r
()->
simnode
(), 
SIMCLICK_CHANGE_CHANNEL
, 
_ifid
, 
_chªÃl
);

65  
	g»s
;

69 ’um {
	mH_SSID
, 
	mH_BSSID
, 
	mH_CHANNEL
, 
	mH_INTERVAL
, 
	mH_WEP
, 
	mH_RESET
};

73 
	gWœ–essInfo
::
	$»£t
()

75 
_ssid
 = "";

76 
_chªÃl
 = -1;

77 
_bssid
 = 
	`Eth”Add»ss
();

78 
_š‹rv®
 = 100;

79 
_w•
 = 
çl£
;

80 #ià
CLICK_NS


81 
_ifid
 = -1;

83 
	}
}

85 
	gWœ–essInfo
::
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *
e
, *
v·¿m
,

86 
E¼ÜHªdËr
 *
”rh
)

88 
Wœ–essInfo
 *
f
 = (Wœ–essInfØ*)
e
;

89 
SŒšg
 
s
 = 
	`ı_uncomm’t
(
š_s
);

90 (
šŒ_t
)
v·¿m
) {

91 
H_SSID
: {

92 
f
->
_ssid
 = 
s
;

95 
H_BSSID
: {

96 
Eth”Add»ss
 
e
;

97 ià(!
	`Eth”Add»ssArg
().
	`·r£
(
s
, 
e
))

98  
”rh
->
	`”rÜ
("bssid…arameter must beƒthernet‡ddress");

99 
f
->
_bssid
 = 
e
;

103 
H_CHANNEL
: {

104 
m
;

105 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

106  
”rh
->
	`”rÜ
("channel…arameter must be int");

107 
f
->
_chªÃl
 = 
m
;

108 #ià
CLICK_NS


109 ià(
f
->
_ifid
 >= 0)

110 
	`simşick_sim_commªd
(
f
->
	`rou‹r
()->
	`simnode
(), 
SIMCLICK_CHANGE_CHANNEL
, f->
_ifid
, f->
_chªÃl
);

114 
H_INTERVAL
: {

115 
m
;

116 ià(!
	`IÁArg
().
	`·r£
(
s
, 
m
))

117  
”rh
->
	`”rÜ
("interval…arameter must be int");

118 
f
->
_š‹rv®
 = 
m
;

121 
H_WEP
: {

122 
boŞ
 
w•
;

123 ià(!
	`BoŞArg
().
	`·r£
(
s
, 
w•
))

124  
”rh
->
	`”rÜ
("wep…arameter must be boolean");

125 
f
->
_w•
 = 
w•
;

128 
H_RESET
: 
f
->
	`»£t
(); ;

131 
	}
}

133 
SŒšg


134 
	gWœ–essInfo
::
	$»ad_·¿m
(
EËm’t
 *
e
, *
thunk
)

136 
Wœ–essInfo
 *
td
 = (Wœ–essInfØ*)
e
;

137 (
ušŒ_t
è
thunk
) {

138 
H_SSID
:  
td
->
_ssid
 + "\n";

139 
H_BSSID
:  
td
->
_bssid
.
	`uÅ¬£
() + "\n";

140 
H_CHANNEL
:  
	`SŒšg
(
td
->
_chªÃl
) + "\n";

141 
H_INTERVAL
:  
	`SŒšg
(
td
->
_š‹rv®
) + "\n";

142 
H_WEP
:  
	`SŒšg
(
td
->
_w•
) + "\n";

146 
	}
}

149 
	gWœ–essInfo
::
	$add_hªdËrs
()

151 
	`add_»ad_hªdËr
("ssid", 
»ad_·¿m
, 
H_SSID
);

152 
	`add_»ad_hªdËr
("bssid", 
»ad_·¿m
, 
H_BSSID
);

153 
	`add_»ad_hªdËr
("chªÃl", 
»ad_·¿m
, 
H_CHANNEL
);

154 
	`add_»ad_hªdËr
("š‹rv®", 
»ad_·¿m
, 
H_INTERVAL
);

155 
	`add_»ad_hªdËr
("w•", 
»ad_·¿m
, 
H_WEP
);

158 
	`add_wr™e_hªdËr
("ssid", 
wr™e_·¿m
, 
H_SSID
);

159 
	`add_wr™e_hªdËr
("bssid", 
wr™e_·¿m
, 
H_BSSID
);

160 
	`add_wr™e_hªdËr
("chªÃl", 
wr™e_·¿m
, 
H_CHANNEL
);

161 
	`add_wr™e_hªdËr
("š‹rv®", 
wr™e_·¿m
, 
H_INTERVAL
);

162 
	`add_wr™e_hªdËr
("w•", 
wr™e_·¿m
, 
H_WEP
);

163 
	`add_wr™e_hªdËr
("»£t", 
wr™e_·¿m
, 
H_RESET
, 
HªdËr
::
BUTTON
);

165 
	}
}

167 
CLICK_ENDDECLS


168 
EXPORT_ELEMENT
(
Wœ–essInfo
)

	@wifi/wirelessinfo.hh

1 #iâdeà
CLICK_WIRELESSINFO_HH


2 
	#CLICK_WIRELESSINFO_HH


	)

3 
	~<şick/–em’t.hh
>

4 
	~<şick/add»ss.hh
>

5 
	~<şick/‘h”add»ss.hh
>

6 
	~<şick/bighashm­.hh
>

7 
	~<şick/glue.hh
>

8 
CLICK_DECLS


63 şas 
	cWœ–essInfo
 : 
public
 
EËm’t
 {…ublic:

65 
	$Wœ–essInfo
(è
CLICK_COLD
;

66 ~
	$Wœ–essInfo
(è
CLICK_COLD
;

68 cÚ¡ *
	$şass_Çme
() const {  "WirelessInfo"; }

69 cÚ¡ *
	$pÜt_couÁ
(ècÚ¡ {  
PORTS_0_0
; 
	}
}

71 
cÚfigu»
(
VeùÜ
<
SŒšg
> &, 
E¼ÜHªdËr
 *è
	gCLICK_COLD
;

72 
	$add_hªdËrs
(è
CLICK_COLD
;

74 
SŒšg
 
	$»ad_·¿m
(
EËm’t
 *, *è
CLICK_COLD
;

75 
	$wr™e_·¿m
(cÚ¡ 
SŒšg
 &
š_s
, 
EËm’t
 *, *, 
E¼ÜHªdËr
 *è
CLICK_COLD
;

77 
	`»£t
();

78 
SŒšg
 
_ssid
;

79 
Eth”Add»ss
 
_bssid
;

80 
_chªÃl
;

81 
_š‹rv®
;

82 
boŞ
 
_w•
;

83 #ià
CLICK_NS


86 
_ifid
;

88 
	}
};

90 
	gCLICK_ENDDECLS


	@/usr/include/arpa/inet.h

18 #iâdeà
_ARPA_INET_H


19 
	#_ARPA_INET_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<Ãtš‘/š.h
>

25 #iâdeà
__sockËn_t_defšed


26 
__sockËn_t
 
	tsockËn_t
;

27 
	#__sockËn_t_defšed


	)

30 
__BEGIN_DECLS


34 
š_addr_t
 
	$š‘_addr
 (cÚ¡ *
__ı
è
__THROW
;

37 
š_addr_t
 
	$š‘_Êaof
 (
š_addr
 
__š
è
__THROW
;

41 
š_addr
 
	$š‘_mak—ddr
 (
š_addr_t
 
__Ãt
, in_addr_ˆ
__ho¡
)

42 
__THROW
;

45 
š_addr_t
 
	$š‘_Ãtof
 (
š_addr
 
__š
è
__THROW
;

49 
š_addr_t
 
	$š‘_ÃtwÜk
 (cÚ¡ *
__ı
è
__THROW
;

53 *
	$š‘_Áß
 (
š_addr
 
__š
è
__THROW
;

58 
	$š‘_±Ú
 (
__af
, cÚ¡ *
__»¡riù
 
__ı
,

59 *
__»¡riù
 
__buf
è
__THROW
;

64 cÚ¡ *
	$š‘_Áİ
 (
__af
, cÚ¡ *
__»¡riù
 
__ı
,

65 *
__»¡riù
 
__buf
, 
sockËn_t
 
__Ën
)

66 
__THROW
;

70 #ifdeà
__USE_MISC


73 
	$š‘_©Ú
 (cÚ¡ *
__ı
, 
š_addr
 *
__šp
è
__THROW
;

77 *
	$š‘_Ã
 (
š_addr_t
 
__Ãt
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

82 *
	$š‘_Ãt_Áİ
 (
__af
, cÚ¡ *
__ı
, 
__b™s
,

83 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

88 
	$š‘_Ãt_±Ú
 (
__af
, cÚ¡ *
__ı
,

89 *
__buf
, 
size_t
 
__Ën
è
__THROW
;

94 
	$š‘_n§p_addr
 (cÚ¡ *
__ı
,

95 *
__buf
, 
__Ën
è
__THROW
;

99 *
	$š‘_n§p_Áß
 (
__Ën
, cÚ¡ *
__ı
,

100 *
__buf
è
__THROW
;

103 
__END_DECLS


	@/usr/include/asm/types.h

1 #iâdeà
_ASM_X86_TYPES_H


2 
	#_ASM_X86_TYPES_H


	)

4 
	~<asm-g’”ic/ty³s.h
>

	@/usr/include/assert.h

22 #ifdef 
_ASSERT_H


24 #undeà
_ASSERT_H


25 #undeà
as£¹


26 #undeà
__ASSERT_VOID_CAST


28 #ifdef 
__USE_GNU


29 #undeà
as£¹_³¼Ü


34 
	#_ASSERT_H
 1

	)

35 
	~<ã©u»s.h
>

37 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,95)

38 
	#__ASSERT_VOID_CAST
 
¡©ic_ÿ¡
<>

	)

40 
	#__ASSERT_VOID_CAST
 ()

	)

48 #ifdef 
NDEBUG


50 
	#as£¹
(
ex´
è(
	`__ASSERT_VOID_CAST
 (0))

	)

58 #ifdef 
__USE_GNU


59 
	#as£¹_³¼Ü
(
”ºum
è(
	`__ASSERT_VOID_CAST
 (0))

	)

64 #iâdeà
_ASSERT_H_DECLS


65 
	#_ASSERT_H_DECLS


	)

66 
__BEGIN_DECLS


69 
	$__as£¹_ç
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
,

70 
__lše
, cÚ¡ *
__funùiÚ
)

71 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

74 
	$__as£¹_³¼Ü_ç
 (
__”ºum
, cÚ¡ *
__fe
,

75 
__lše
, cÚ¡ *
__funùiÚ
)

76 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

81 
	$__as£¹
 (cÚ¡ *
__as£¹iÚ
, cÚ¡ *
__fe
, 
__lše
)

82 
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

85 
__END_DECLS


88 
	#as£¹
(
ex´
) \

89 ((
ex´
) \

90 ? 
	`__ASSERT_VOID_CAST
 (0) \

91 : 
	`__as£¹_ç
 (#ex´, 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

93 #ifdef 
__USE_GNU


94 
	#as£¹_³¼Ü
(
”ºum
) \

95 (!(
”ºum
) \

96 ? 
	`__ASSERT_VOID_CAST
 (0) \

97 : 
	`__as£¹_³¼Ü_ç
 ((
”ºum
), 
__FILE__
, 
__LINE__
, 
__ASSERT_FUNCTION
))

	)

105 #ià
defšed
 
__ılu¥lus
 ? 
	`__GNUC_PREREQ
 (2, 6) : __GNUC_PREREQ (2, 4)

106 
	#__ASSERT_FUNCTION
 
__PRETTY_FUNCTION__


	)

108 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

109 
	#__ASSERT_FUNCTION
 
__func__


	)

111 
	#__ASSERT_FUNCTION
 ((cÚ¡ *è0)

	)

118 #ià
defšed
 
__USE_ISOC11
 && !defšed 
__ılu¥lus


119 #undeà
¡©ic_as£¹


120 
	#¡©ic_as£¹
 
_Stic_as£¹


	)

	@/usr/include/fcntl.h

22 #iâdef 
_FCNTL_H


23 
	#_FCNTL_H
 1

	)

25 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


31 
	~<b™s/ty³s.h
>

35 
	~<b™s/fú.h
>

39 #ifdeà
__O_TMPFILE


40 
	#__OPEN_NEEDS_MODE
(
oæag
) \

41 (((
oæag
è& 
O_CREAT
è!ğ0 || ((oæagè& 
__O_TMPFILE
è=ğ__O_TMPFILE)

	)

43 
	#__OPEN_NEEDS_MODE
(
oæag
è(((oæagè& 
O_CREAT
è!ğ0)

	)

49 #iâdeà
__mode_t_defšed


50 
__mode_t
 
	tmode_t
;

51 
	#__mode_t_defšed


	)

54 #iâdeà
__off_t_defšed


55 #iâdeà
__USE_FILE_OFFSET64


56 
__off_t
 
	toff_t
;

58 
__off64_t
 
	toff_t
;

60 
	#__off_t_defšed


	)

63 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


64 
__off64_t
 
	toff64_t
;

65 
	#__off64_t_defšed


	)

68 #iâdeà
__pid_t_defšed


69 
__pid_t
 
	tpid_t
;

70 
	#__pid_t_defšed


	)

74 #ifdeà
__USE_XOPEN2K8


75 
	#__Ãed_time¥ec


	)

76 
	~<time.h
>

78 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


79 
	~<b™s/¡©.h
>

81 
	#S_IFMT
 
__S_IFMT


	)

82 
	#S_IFDIR
 
__S_IFDIR


	)

83 
	#S_IFCHR
 
__S_IFCHR


	)

84 
	#S_IFBLK
 
__S_IFBLK


	)

85 
	#S_IFREG
 
__S_IFREG


	)

86 #ifdeà
__S_IFIFO


87 
	#S_IFIFO
 
__S_IFIFO


	)

89 #ifdeà
__S_IFLNK


90 
	#S_IFLNK
 
__S_IFLNK


	)

92 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
è&& defšed 
__S_IFSOCK


93 
	#S_IFSOCK
 
__S_IFSOCK


	)

98 
	#S_ISUID
 
__S_ISUID


	)

99 
	#S_ISGID
 
__S_ISGID


	)

101 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


103 
	#S_ISVTX
 
__S_ISVTX


	)

106 
	#S_IRUSR
 
__S_IREAD


	)

107 
	#S_IWUSR
 
__S_IWRITE


	)

108 
	#S_IXUSR
 
__S_IEXEC


	)

110 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

112 
	#S_IRGRP
 (
S_IRUSR
 >> 3è

	)

113 
	#S_IWGRP
 (
S_IWUSR
 >> 3è

	)

114 
	#S_IXGRP
 (
S_IXUSR
 >> 3è

	)

116 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

118 
	#S_IROTH
 (
S_IRGRP
 >> 3è

	)

119 
	#S_IWOTH
 (
S_IWGRP
 >> 3è

	)

120 
	#S_IXOTH
 (
S_IXGRP
 >> 3è

	)

122 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

125 #ifdef 
__USE_MISC


126 #iâdeà
R_OK


129 
	#R_OK
 4

	)

130 
	#W_OK
 2

	)

131 
	#X_OK
 1

	)

132 
	#F_OK
 0

	)

137 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


138 
	#SEEK_SET
 0

	)

139 
	#SEEK_CUR
 1

	)

140 
	#SEEK_END
 2

	)

148 
fú
 (
__fd
, 
__cmd
, ...);

157 #iâdeà
__USE_FILE_OFFSET64


158 
	$İ’
 (cÚ¡ *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

160 #ifdeà
__REDIRECT


161 
	`__REDIRECT
 (
İ’
, (cÚ¡ *
__fe
, 
__oæag
, ...), 
İ’64
)

162 
	`__nÚnuÎ
 ((1));

164 
	#İ’
 
İ’64


	)

167 #ifdeà
__USE_LARGEFILE64


168 
	$İ’64
 (cÚ¡ *
__fe
, 
__oæag
, ...è
	`__nÚnuÎ
 ((1));

171 #ifdeà
__USE_ATFILE


181 #iâdeà
__USE_FILE_OFFSET64


182 
	$İ’©
 (
__fd
, cÚ¡ *
__fe
, 
__oæag
, ...)

183 
	`__nÚnuÎ
 ((2));

185 #ifdeà
__REDIRECT


186 
	`__REDIRECT
 (
İ’©
, (
__fd
, cÚ¡ *
__fe
, 
__oæag
,

187 ...), 
İ’©64
è
	`__nÚnuÎ
 ((2));

189 
	#İ’©
 
İ’©64


	)

192 #ifdeà
__USE_LARGEFILE64


193 
	$İ’©64
 (
__fd
, cÚ¡ *
__fe
, 
__oæag
, ...)

194 
	`__nÚnuÎ
 ((2));

203 #iâdeà
__USE_FILE_OFFSET64


204 
	$ü—t
 (cÚ¡ *
__fe
, 
mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

206 #ifdeà
__REDIRECT


207 
	`__REDIRECT
 (
ü—t
, (cÚ¡ *
__fe
, 
mode_t
 
__mode
),

208 
ü—t64
è
	`__nÚnuÎ
 ((1));

210 
	#ü—t
 
ü—t64


	)

213 #ifdeà
__USE_LARGEFILE64


214 
	$ü—t64
 (cÚ¡ *
__fe
, 
mode_t
 
__mode
è
	`__nÚnuÎ
 ((1));

217 #ià!
defšed
 
F_LOCK
 && (defšed 
__USE_MISC
 || (defšed 
__USE_XOPEN_EXTENDED
 \

218 && !
defšed
 
__USE_POSIX
))

227 
	#F_ULOCK
 0

	)

228 
	#F_LOCK
 1

	)

229 
	#F_TLOCK
 2

	)

230 
	#F_TEST
 3

	)

232 #iâdeà
__USE_FILE_OFFSET64


233 
	`lockf
 (
__fd
, 
__cmd
, 
off_t
 
__Ën
);

235 #ifdeà
__REDIRECT


236 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
), 
lockf64
);

238 
	#lockf
 
lockf64


	)

241 #ifdeà
__USE_LARGEFILE64


242 
	`lockf64
 (
__fd
, 
__cmd
, 
off64_t
 
__Ën
);

246 #ifdeà
__USE_XOPEN2K


249 #iâdeà
__USE_FILE_OFFSET64


250 
	$posix_çdvi£
 (
__fd
, 
off_t
 
__off£t
, off_ˆ
__Ën
,

251 
__advi£
è
__THROW
;

253 #ifdeà
__REDIRECT_NTH


254 
	`__REDIRECT_NTH
 (
posix_çdvi£
, (
__fd
, 
__off64_t
 
__off£t
,

255 
__off64_t
 
__Ën
, 
__advi£
),

256 
posix_çdvi£64
);

258 
	#posix_çdvi£
 
posix_çdvi£64


	)

261 #ifdeà
__USE_LARGEFILE64


262 
	$posix_çdvi£64
 (
__fd
, 
off64_t
 
__off£t
, off64_ˆ
__Ën
,

263 
__advi£
è
__THROW
;

271 #iâdeà
__USE_FILE_OFFSET64


272 
	`posix_çÎoÿ‹
 (
__fd
, 
off_t
 
__off£t
, off_ˆ
__Ën
);

274 #ifdeà
__REDIRECT


275 
	`__REDIRECT
 (
posix_çÎoÿ‹
, (
__fd
, 
__off64_t
 
__off£t
,

276 
__off64_t
 
__Ën
),

277 
posix_çÎoÿ‹64
);

279 
	#posix_çÎoÿ‹
 
posix_çÎoÿ‹64


	)

282 #ifdeà
__USE_LARGEFILE64


283 
	`posix_çÎoÿ‹64
 (
__fd
, 
off64_t
 
__off£t
, off64_ˆ
__Ën
);

289 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ
 \

290 && 
defšed
 
__va_¬g_·ck_Ën


291 
	~<b™s/fú2.h
>

294 
__END_DECLS


	@/usr/include/features.h

18 #iâdef 
_FEATURES_H


19 
	#_FEATURES_H
 1

	)

97 #undeà
__USE_ISOC11


98 #undeà
__USE_ISOC99


99 #undeà
__USE_ISOC95


100 #undeà
__USE_ISOCXX11


101 #undeà
__USE_POSIX


102 #undeà
__USE_POSIX2


103 #undeà
__USE_POSIX199309


104 #undeà
__USE_POSIX199506


105 #undeà
__USE_XOPEN


106 #undeà
__USE_XOPEN_EXTENDED


107 #undeà
__USE_UNIX98


108 #undeà
__USE_XOPEN2K


109 #undeà
__USE_XOPEN2KXSI


110 #undeà
__USE_XOPEN2K8


111 #undeà
__USE_XOPEN2K8XSI


112 #undeà
__USE_LARGEFILE


113 #undeà
__USE_LARGEFILE64


114 #undeà
__USE_FILE_OFFSET64


115 #undeà
__USE_MISC


116 #undeà
__USE_ATFILE


117 #undeà
__USE_GNU


118 #undeà
__USE_REENTRANT


119 #undeà
__USE_FORTIFY_LEVEL


120 #undeà
__KERNEL_STRICT_NAMES


124 #iâdeà
_LOOSE_KERNEL_NAMES


125 
	#__KERNEL_STRICT_NAMES


	)

135 #ià
defšed
 
__GNUC__
 && defšed 
__GNUC_MINOR__


136 
	#__GNUC_PREREQ
(
maj
, 
mš
) \

137 ((
__GNUC__
 << 16è+ 
__GNUC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

139 
	#__GNUC_PREREQ
(
maj
, 
mš
è0

	)

146 #ià(
defšed
 
_BSD_SOURCE
 || defšed 
_SVID_SOURCE
) \

147 && !
defšed
 
	g_DEFAULT_SOURCE


149 #undeà
_DEFAULT_SOURCE


150 
	#_DEFAULT_SOURCE
 1

	)

154 #ifdeà
_GNU_SOURCE


155 #undeà
_ISOC95_SOURCE


156 
	#_ISOC95_SOURCE
 1

	)

157 #undeà
_ISOC99_SOURCE


158 
	#_ISOC99_SOURCE
 1

	)

159 #undeà
_ISOC11_SOURCE


160 
	#_ISOC11_SOURCE
 1

	)

161 #undeà
_POSIX_SOURCE


162 
	#_POSIX_SOURCE
 1

	)

163 #undeà
_POSIX_C_SOURCE


164 
	#_POSIX_C_SOURCE
 200809L

	)

165 #undeà
_XOPEN_SOURCE


166 
	#_XOPEN_SOURCE
 700

	)

167 #undeà
_XOPEN_SOURCE_EXTENDED


168 
	#_XOPEN_SOURCE_EXTENDED
 1

	)

169 #undeà
_LARGEFILE64_SOURCE


170 
	#_LARGEFILE64_SOURCE
 1

	)

171 #undeà
_DEFAULT_SOURCE


172 
	#_DEFAULT_SOURCE
 1

	)

173 #undeà
_ATFILE_SOURCE


174 
	#_ATFILE_SOURCE
 1

	)

179 #ià(
defšed
 
_DEFAULT_SOURCE
 \

180 || (!
defšed
 
	g__STRICT_ANSI__
 \

181 && !
defšed
 
	g_ISOC99_SOURCE
 \

182 && !
defšed
 
	g_POSIX_SOURCE
 && !defšed 
	g_POSIX_C_SOURCE
 \

183 && !
defšed
 
	g_XOPEN_SOURCE
))

184 #undeà
_DEFAULT_SOURCE


185 
	#_DEFAULT_SOURCE
 1

	)

189 #ià(
defšed
 
_ISOC11_SOURCE
 \

190 || (
defšed
 
	g__STDC_VERSION__
 && __STDC_VERSION__ >= 201112L))

191 
	#__USE_ISOC11
 1

	)

195 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

196 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L))

197 
	#__USE_ISOC99
 1

	)

201 #ià(
defšed
 
_ISOC99_SOURCE
 || defšed 
_ISOC11_SOURCE
 \

202 || (
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199409L))

203 
	#__USE_ISOC95
 1

	)

210 #ià((
defšed
 
__ılu¥lus
 && __cplusplus >= 201103L) \

211 || 
defšed
 
__GXX_EXPERIMENTAL_CXX0X__
)

212 
	#__USE_ISOCXX11
 1

	)

218 #ifdeà
_DEFAULT_SOURCE


219 #ià!
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE


220 
	#__USE_POSIX_IMPLICITLY
 1

	)

222 #undeà
_POSIX_SOURCE


223 
	#_POSIX_SOURCE
 1

	)

224 #undeà
_POSIX_C_SOURCE


225 
	#_POSIX_C_SOURCE
 200809L

	)

227 #ià((!
defšed
 
__STRICT_ANSI__
 \

228 || (
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) >= 500)) \

229 && !
defšed
 
_POSIX_SOURCE
 && !defšed 
_POSIX_C_SOURCE
)

230 
	#_POSIX_SOURCE
 1

	)

231 #ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 500

232 
	#_POSIX_C_SOURCE
 2

	)

233 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 600

234 
	#_POSIX_C_SOURCE
 199506L

	)

235 #–ià
defšed
 
_XOPEN_SOURCE
 && (_XOPEN_SOURCE - 0) < 700

236 
	#_POSIX_C_SOURCE
 200112L

	)

238 
	#_POSIX_C_SOURCE
 200809L

	)

240 
	#__USE_POSIX_IMPLICITLY
 1

	)

243 #ià(
defšed
 
_POSIX_SOURCE
 \

244 || (
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >= 1) \

245 || 
defšed
 
_XOPEN_SOURCE
)

246 
	#__USE_POSIX
 1

	)

249 #ià
defšed
 
_POSIX_C_SOURCE
 && _POSIX_C_SOURCE >ğ2 || defšed 
_XOPEN_SOURCE


250 
	#__USE_POSIX2
 1

	)

253 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199309L

254 
	#__USE_POSIX199309
 1

	)

257 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 199506L

258 
	#__USE_POSIX199506
 1

	)

261 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200112L

262 
	#__USE_XOPEN2K
 1

	)

263 #undeà
__USE_ISOC95


264 
	#__USE_ISOC95
 1

	)

265 #undeà
__USE_ISOC99


266 
	#__USE_ISOC99
 1

	)

269 #ià
defšed
 
_POSIX_C_SOURCE
 && (_POSIX_C_SOURCE - 0) >= 200809L

270 
	#__USE_XOPEN2K8
 1

	)

271 #undeà
_ATFILE_SOURCE


272 
	#_ATFILE_SOURCE
 1

	)

275 #ifdef 
_XOPEN_SOURCE


276 
	#__USE_XOPEN
 1

	)

277 #ià(
_XOPEN_SOURCE
 - 0) >= 500

278 
	#__USE_XOPEN_EXTENDED
 1

	)

279 
	#__USE_UNIX98
 1

	)

280 #undeà
_LARGEFILE_SOURCE


281 
	#_LARGEFILE_SOURCE
 1

	)

282 #ià(
_XOPEN_SOURCE
 - 0) >= 600

283 #ià(
_XOPEN_SOURCE
 - 0) >= 700

284 
	#__USE_XOPEN2K8
 1

	)

285 
	#__USE_XOPEN2K8XSI
 1

	)

287 
	#__USE_XOPEN2K
 1

	)

288 
	#__USE_XOPEN2KXSI
 1

	)

289 #undeà
__USE_ISOC95


290 
	#__USE_ISOC95
 1

	)

291 #undeà
__USE_ISOC99


292 
	#__USE_ISOC99
 1

	)

295 #ifdeà
_XOPEN_SOURCE_EXTENDED


296 
	#__USE_XOPEN_EXTENDED
 1

	)

301 #ifdeà
_LARGEFILE_SOURCE


302 
	#__USE_LARGEFILE
 1

	)

305 #ifdeà
_LARGEFILE64_SOURCE


306 
	#__USE_LARGEFILE64
 1

	)

309 #ià
defšed
 
_FILE_OFFSET_BITS
 && _FILE_OFFSET_BITS == 64

310 
	#__USE_FILE_OFFSET64
 1

	)

313 #ià
defšed
 
_DEFAULT_SOURCE


314 
	#__USE_MISC
 1

	)

317 #ifdef 
_ATFILE_SOURCE


318 
	#__USE_ATFILE
 1

	)

321 #ifdef 
_GNU_SOURCE


322 
	#__USE_GNU
 1

	)

325 #ià
defšed
 
_REENTRANT
 || defšed 
_THREAD_SAFE


326 
	#__USE_REENTRANT
 1

	)

329 #ià
defšed
 
_FORTIFY_SOURCE
 && _FORTIFY_SOURCE > 0 \

330 && 
__GNUC_PREREQ
 (4, 1è&& 
defšed
 
	g__OPTIMIZE__
 && __OPTIMIZE__ > 0

331 #ià
_FORTIFY_SOURCE
 > 1

332 
	#__USE_FORTIFY_LEVEL
 2

	)

334 
	#__USE_FORTIFY_LEVEL
 1

	)

337 
	#__USE_FORTIFY_LEVEL
 0

	)

342 
	~<¡dc-´edef.h
>

350 #undeà
__GNU_LIBRARY__


351 
	#__GNU_LIBRARY__
 6

	)

355 
	#__GLIBC__
 2

	)

356 
	#__GLIBC_MINOR__
 24

	)

358 
	#__GLIBC_PREREQ
(
maj
, 
mš
) \

359 ((
__GLIBC__
 << 16è+ 
__GLIBC_MINOR__
 >ğ((
maj
è<< 16è+ (
mš
))

	)

362 #iâdeà
__ASSEMBLER__


363 #iâdeà
_SYS_CDEFS_H


364 
	~<sys/cdefs.h
>

369 #ià
defšed
 
__USE_FILE_OFFSET64
 && !defšed 
__REDIRECT


370 
	#__USE_LARGEFILE
 1

	)

371 
	#__USE_LARGEFILE64
 1

	)

377 #ià
__GNUC_PREREQ
 (2, 7è&& 
defšed
 
__OPTIMIZE__
 \

378 && !
defšed
 
	g__OPTIMIZE_SIZE__
 && !defšed 
	g__NO_INLINE__
 \

379 && 
defšed
 
	g__ex‹º_šlše


380 
	#__USE_EXTERN_INLINES
 1

	)

388 
	~<gnu/¡ubs.h
>

	@/usr/include/ifaddrs.h

19 #iâdeà
_IFADDRS_H


20 
	#_IFADDRS_H
 1

	)

22 
	~<ã©u»s.h
>

23 
	~<sys/sock‘.h
>

25 
__BEGIN_DECLS


29 
	siçddrs


31 
içddrs
 *
	miç_Ãxt
;

33 *
	miç_Çme
;

34 
	miç_æags
;

36 
sockaddr
 *
	miç_addr
;

37 
sockaddr
 *
	miç_Ãtmask
;

44 
sockaddr
 *
	mifu_brßdaddr
;

45 
sockaddr
 *
	mifu_d¡addr
;

46 } 
	miç_ifu
;

49 #iâdeà
iç_brßdaddr


50 
	#iç_brßdaddr
 
iç_ifu
.
ifu_brßdaddr


	)

52 #iâdeà
iç_d¡addr


53 
	#iç_d¡addr
 
iç_ifu
.
ifu_d¡addr


	)

56 *
	miç_d©a
;

66 
	$g‘içddrs
 (
içddrs
 **
__içp
è
__THROW
;

69 
	$ä“içddrs
 (
içddrs
 *
__iç
è
__THROW
;

71 
__END_DECLS


	@/usr/include/linux/fs.h

1 #iâdeà
_LINUX_FS_H


2 
	#_LINUX_FS_H


	)

12 
	~<lšux/lim™s.h
>

13 
	~<lšux/ioùl.h
>

14 
	~<lšux/ty³s.h
>

27 #undeà
NR_OPEN


28 
	#INR_OPEN_CUR
 1024

	)

29 
	#INR_OPEN_MAX
 4096

	)

31 
	#BLOCK_SIZE_BITS
 10

	)

32 
	#BLOCK_SIZE
 (1<<
BLOCK_SIZE_BITS
)

	)

34 
	#SEEK_SET
 0

	)

35 
	#SEEK_CUR
 1

	)

36 
	#SEEK_END
 2

	)

37 
	#SEEK_DATA
 3

	)

38 
	#SEEK_HOLE
 4

	)

39 
	#SEEK_MAX
 
SEEK_HOLE


	)

41 
	#RENAME_NOREPLACE
 (1 << 0è

	)

42 
	#RENAME_EXCHANGE
 (1 << 1è

	)

43 
	#RENAME_WHITEOUT
 (1 << 2è

	)

45 
	sfe_şÚe_¿nge
 {

46 
__s64
 
	m¤c_fd
;

47 
__u64
 
	m¤c_off£t
;

48 
__u64
 
	m¤c_Ëngth
;

49 
__u64
 
	mde¡_off£t
;

52 
	sf¡rim_¿nge
 {

53 
__u64
 
	m¡¬t
;

54 
__u64
 
	mËn
;

55 
__u64
 
	mmšËn
;

59 
	#FILE_DEDUPE_RANGE_SAME
 0

	)

60 
	#FILE_DEDUPE_RANGE_DIFFERS
 1

	)

63 
	sfe_dedu³_¿nge_šfo
 {

64 
__s64
 
	mde¡_fd
;

65 
__u64
 
	mde¡_off£t
;

66 
__u64
 
	mby‹s_dedu³d
;

73 
__s32
 
	m¡©us
;

74 
__u32
 
	m»£rved
;

78 
	sfe_dedu³_¿nge
 {

79 
__u64
 
	m¤c_off£t
;

80 
__u64
 
	m¤c_Ëngth
;

81 
__u16
 
	mde¡_couÁ
;

82 
__u16
 
	m»£rved1
;

83 
__u32
 
	m»£rved2
;

84 
fe_dedu³_¿nge_šfo
 
	mšfo
[0];

88 
	sfes_¡©_¡ruù
 {

89 
	mÄ_fes
;

90 
	mÄ_ä“_fes
;

91 
	mmax_fes
;

94 
	sšodes_¡©_t
 {

95 
	mÄ_šodes
;

96 
	mÄ_unu£d
;

97 
	mdummy
[5];

101 
	#NR_FILE
 8192

	)

107 
	#MS_RDONLY
 1

	)

108 
	#MS_NOSUID
 2

	)

109 
	#MS_NODEV
 4

	)

110 
	#MS_NOEXEC
 8

	)

111 
	#MS_SYNCHRONOUS
 16

	)

112 
	#MS_REMOUNT
 32

	)

113 
	#MS_MANDLOCK
 64

	)

114 
	#MS_DIRSYNC
 128

	)

115 
	#MS_NOATIME
 1024

	)

116 
	#MS_NODIRATIME
 2048

	)

117 
	#MS_BIND
 4096

	)

118 
	#MS_MOVE
 8192

	)

119 
	#MS_REC
 16384

	)

120 
	#MS_VERBOSE
 32768

	)

122 
	#MS_SILENT
 32768

	)

123 
	#MS_POSIXACL
 (1<<16è

	)

124 
	#MS_UNBINDABLE
 (1<<17è

	)

125 
	#MS_PRIVATE
 (1<<18è

	)

126 
	#MS_SLAVE
 (1<<19è

	)

127 
	#MS_SHARED
 (1<<20è

	)

128 
	#MS_RELATIME
 (1<<21è

	)

129 
	#MS_KERNMOUNT
 (1<<22è

	)

130 
	#MS_I_VERSION
 (1<<23è

	)

131 
	#MS_STRICTATIME
 (1<<24è

	)

132 
	#MS_LAZYTIME
 (1<<25è

	)

135 
	#MS_SUBMOUNT
 (1<<26)

	)

136 
	#MS_NOREMOTELOCK
 (1<<27)

	)

137 
	#MS_NOSEC
 (1<<28)

	)

138 
	#MS_BORN
 (1<<29)

	)

139 
	#MS_ACTIVE
 (1<<30)

	)

140 
	#MS_NOUSER
 (1<<31)

	)

145 
	#MS_RMT_MASK
 (
MS_RDONLY
|
MS_SYNCHRONOUS
|
MS_MANDLOCK
|
MS_I_VERSION
|\

146 
MS_LAZYTIME
)

	)

151 
	#MS_MGC_VAL
 0xC0ED0000

	)

152 
	#MS_MGC_MSK
 0xffff0000

	)

157 
	sfsx©Œ
 {

158 
__u32
 
	mfsx_xæags
;

159 
__u32
 
	mfsx_extsize
;

160 
__u32
 
	mfsx_Ãx‹Ás
;

161 
__u32
 
	mfsx_´ojid
;

162 
__u32
 
	mfsx_cowextsize
;

163 
	mfsx_·d
[8];

169 
	#FS_XFLAG_REALTIME
 0x00000001

	)

170 
	#FS_XFLAG_PREALLOC
 0x00000002

	)

171 
	#FS_XFLAG_IMMUTABLE
 0x00000008

	)

172 
	#FS_XFLAG_APPEND
 0x00000010

	)

173 
	#FS_XFLAG_SYNC
 0x00000020

	)

174 
	#FS_XFLAG_NOATIME
 0x00000040

	)

175 
	#FS_XFLAG_NODUMP
 0x00000080

	)

176 
	#FS_XFLAG_RTINHERIT
 0x00000100

	)

177 
	#FS_XFLAG_PROJINHERIT
 0x00000200

	)

178 
	#FS_XFLAG_NOSYMLINKS
 0x00000400

	)

179 
	#FS_XFLAG_EXTSIZE
 0x00000800

	)

180 
	#FS_XFLAG_EXTSZINHERIT
 0x00001000

	)

181 
	#FS_XFLAG_NODEFRAG
 0x00002000

	)

182 
	#FS_XFLAG_FILESTREAM
 0x00004000

	)

183 
	#FS_XFLAG_DAX
 0x00008000

	)

184 
	#FS_XFLAG_COWEXTSIZE
 0x00010000

	)

185 
	#FS_XFLAG_HASATTR
 0x80000000

	)

190 
	#BLKROSET
 
	`_IO
(0x12,93è

	)

191 
	#BLKROGET
 
	`_IO
(0x12,94è

	)

192 
	#BLKRRPART
 
	`_IO
(0x12,95è

	)

193 
	#BLKGETSIZE
 
	`_IO
(0x12,96è

	)

194 
	#BLKFLSBUF
 
	`_IO
(0x12,97è

	)

195 
	#BLKRASET
 
	`_IO
(0x12,98è

	)

196 
	#BLKRAGET
 
	`_IO
(0x12,99è

	)

197 
	#BLKFRASET
 
	`_IO
(0x12,100)

	)

198 
	#BLKFRAGET
 
	`_IO
(0x12,101)

	)

199 
	#BLKSECTSET
 
	`_IO
(0x12,102)

	)

200 
	#BLKSECTGET
 
	`_IO
(0x12,103)

	)

201 
	#BLKSSZGET
 
	`_IO
(0x12,104)

	)

203 
	#BLKPG
 
	`_IO
(0x12,105)

	)

207 
	#BLKELVGET
 
	`_IOR
(0x12,106,
size_t
)

	)

208 
	#BLKELVSET
 
	`_IOW
(0x12,107,
size_t
)

	)

213 
	#BLKBSZGET
 
	`_IOR
(0x12,112,
size_t
)

	)

214 
	#BLKBSZSET
 
	`_IOW
(0x12,113,
size_t
)

	)

215 
	#BLKGETSIZE64
 
	`_IOR
(0x12,114,
size_t
è

	)

216 
	#BLKTRACESETUP
 
	`_IOWR
(0x12,115,
blk_u£r_Œaû_£tup
)

	)

217 
	#BLKTRACESTART
 
	`_IO
(0x12,116)

	)

218 
	#BLKTRACESTOP
 
	`_IO
(0x12,117)

	)

219 
	#BLKTRACETEARDOWN
 
	`_IO
(0x12,118)

	)

220 
	#BLKDISCARD
 
	`_IO
(0x12,119)

	)

221 
	#BLKIOMIN
 
	`_IO
(0x12,120)

	)

222 
	#BLKIOOPT
 
	`_IO
(0x12,121)

	)

223 
	#BLKALIGNOFF
 
	`_IO
(0x12,122)

	)

224 
	#BLKPBSZGET
 
	`_IO
(0x12,123)

	)

225 
	#BLKDISCARDZEROES
 
	`_IO
(0x12,124)

	)

226 
	#BLKSECDISCARD
 
	`_IO
(0x12,125)

	)

227 
	#BLKROTATIONAL
 
	`_IO
(0x12,126)

	)

228 
	#BLKZEROOUT
 
	`_IO
(0x12,127)

	)

230 
	#BMAP_IOCTL
 1

	)

231 
	#FIBMAP
 
	`_IO
(0x00,1è

	)

232 
	#FIGETBSZ
 
	`_IO
(0x00,2è

	)

233 
	#FIFREEZE
 
	`_IOWR
('X', 119, è

	)

234 
	#FITHAW
 
	`_IOWR
('X', 120, è

	)

235 
	#FITRIM
 
	`_IOWR
('X', 121, 
f¡rim_¿nge
è

	)

236 
	#FICLONE
 
	`_IOW
(0x94, 9, )

	)

237 
	#FICLONERANGE
 
	`_IOW
(0x94, 13, 
fe_şÚe_¿nge
)

	)

238 
	#FIDEDUPERANGE
 
	`_IOWR
(0x94, 54, 
fe_dedu³_¿nge
)

	)

240 
	#FS_IOC_GETFLAGS
 
	`_IOR
('f', 1, )

	)

241 
	#FS_IOC_SETFLAGS
 
	`_IOW
('f', 2, )

	)

242 
	#FS_IOC_GETVERSION
 
	`_IOR
('v', 1, )

	)

243 
	#FS_IOC_SETVERSION
 
	`_IOW
('v', 2, )

	)

244 
	#FS_IOC_FIEMAP
 
	`_IOWR
('f', 11, 
f›m­
)

	)

245 
	#FS_IOC32_GETFLAGS
 
	`_IOR
('f', 1, )

	)

246 
	#FS_IOC32_SETFLAGS
 
	`_IOW
('f', 2, )

	)

247 
	#FS_IOC32_GETVERSION
 
	`_IOR
('v', 1, )

	)

248 
	#FS_IOC32_SETVERSION
 
	`_IOW
('v', 2, )

	)

249 
	#FS_IOC_FSGETXATTR
 
	`_IOR
 ('X', 31, 
fsx©Œ
)

	)

250 
	#FS_IOC_FSSETXATTR
 
	`_IOW
 ('X', 32, 
fsx©Œ
)

	)

256 
	#FS_KEY_DESCRIPTOR_SIZE
 8

	)

258 
	sfsüy±_pŞicy
 {

259 
__u8
 
	mv”siÚ
;

260 
__u8
 
	mcÚ‹Ás_’üy±iÚ_mode
;

261 
__u8
 
	mf’ames_’üy±iÚ_mode
;

262 
__u8
 
	mæags
;

263 
__u8
 
	mma¡”_key_desütÜ
[
FS_KEY_DESCRIPTOR_SIZE
];

264 } 
__©Œibu‹__
((
·cked
));

266 
	#FS_IOC_SET_ENCRYPTION_POLICY
 
	`_IOR
('f', 19, 
fsüy±_pŞicy
)

	)

267 
	#FS_IOC_GET_ENCRYPTION_PWSALT
 
	`_IOW
('f', 20, 
__u8
[16])

	)

268 
	#FS_IOC_GET_ENCRYPTION_POLICY
 
	`_IOW
('f', 21, 
fsüy±_pŞicy
)

	)

290 
	#FS_SECRM_FL
 0x00000001

	)

291 
	#FS_UNRM_FL
 0x00000002

	)

292 
	#FS_COMPR_FL
 0x00000004

	)

293 
	#FS_SYNC_FL
 0x00000008

	)

294 
	#FS_IMMUTABLE_FL
 0x00000010

	)

295 
	#FS_APPEND_FL
 0x00000020

	)

296 
	#FS_NODUMP_FL
 0x00000040

	)

297 
	#FS_NOATIME_FL
 0x00000080

	)

299 
	#FS_DIRTY_FL
 0x00000100

	)

300 
	#FS_COMPRBLK_FL
 0x00000200

	)

301 
	#FS_NOCOMP_FL
 0x00000400

	)

303 
	#FS_ENCRYPT_FL
 0x00000800

	)

304 
	#FS_BTREE_FL
 0x00001000

	)

305 
	#FS_INDEX_FL
 0x00001000

	)

306 
	#FS_IMAGIC_FL
 0x00002000

	)

307 
	#FS_JOURNAL_DATA_FL
 0x00004000

	)

308 
	#FS_NOTAIL_FL
 0x00008000

	)

309 
	#FS_DIRSYNC_FL
 0x00010000

	)

310 
	#FS_TOPDIR_FL
 0x00020000

	)

311 
	#FS_HUGE_FILE_FL
 0x00040000

	)

312 
	#FS_EXTENT_FL
 0x00080000

	)

313 
	#FS_EA_INODE_FL
 0x00200000

	)

314 
	#FS_EOFBLOCKS_FL
 0x00400000

	)

315 
	#FS_NOCOW_FL
 0x00800000

	)

316 
	#FS_INLINE_DATA_FL
 0x10000000

	)

317 
	#FS_PROJINHERIT_FL
 0x20000000

	)

318 
	#FS_RESERVED_FL
 0x80000000

	)

320 
	#FS_FL_USER_VISIBLE
 0x0003DFFF

	)

321 
	#FS_FL_USER_MODIFIABLE
 0x000380FF

	)

324 
	#SYNC_FILE_RANGE_WAIT_BEFORE
 1

	)

325 
	#SYNC_FILE_RANGE_WRITE
 2

	)

326 
	#SYNC_FILE_RANGE_WAIT_AFTER
 4

	)

329 
	#RWF_HIPRI
 0x00000001

	)

330 
	#RWF_DSYNC
 0x00000002

	)

331 
	#RWF_SYNC
 0x00000004

	)

	@/usr/include/linux/if.h

19 #iâdeà
_LINUX_IF_H


20 
	#_LINUX_IF_H


	)

22 
	~<lšux/libc-com·t.h
>

23 
	~<lšux/ty³s.h
>

24 
	~<lšux/sock‘.h
>

27 #ià
__UAPI_DEF_IF_IFNAMSIZ


28 
	#IFNAMSIZ
 16

	)

30 
	#IFALIASZ
 256

	)

31 
	~<lšux/hdlc/ioùl.h
>

34 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 != 0 || \

35 
	g__UAPI_DEF_IF_NET_DEVICE_FLAGS
 != 0

76 
	eÃt_deviû_æags
 {

78 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS


79 
IFF_UP
 = 1<<0,

80 
	mIFF_BROADCAST
 = 1<<1,

81 
	mIFF_DEBUG
 = 1<<2,

82 
	mIFF_LOOPBACK
 = 1<<3,

83 
	mIFF_POINTOPOINT
 = 1<<4,

84 
	mIFF_NOTRAILERS
 = 1<<5,

85 
	mIFF_RUNNING
 = 1<<6,

86 
	mIFF_NOARP
 = 1<<7,

87 
	mIFF_PROMISC
 = 1<<8,

88 
	mIFF_ALLMULTI
 = 1<<9,

89 
	mIFF_MASTER
 = 1<<10,

90 
	mIFF_SLAVE
 = 1<<11,

91 
	mIFF_MULTICAST
 = 1<<12,

92 
	mIFF_PORTSEL
 = 1<<13,

93 
	mIFF_AUTOMEDIA
 = 1<<14,

94 
	mIFF_DYNAMIC
 = 1<<15,

96 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


97 
	mIFF_LOWER_UP
 = 1<<16,

98 
	mIFF_DORMANT
 = 1<<17,

99 
	mIFF_ECHO
 = 1<<18,

105 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS


106 
	#IFF_UP
 
IFF_UP


	)

107 
	#IFF_BROADCAST
 
IFF_BROADCAST


	)

108 
	#IFF_DEBUG
 
IFF_DEBUG


	)

109 
	#IFF_LOOPBACK
 
IFF_LOOPBACK


	)

110 
	#IFF_POINTOPOINT
 
IFF_POINTOPOINT


	)

111 
	#IFF_NOTRAILERS
 
IFF_NOTRAILERS


	)

112 
	#IFF_RUNNING
 
IFF_RUNNING


	)

113 
	#IFF_NOARP
 
IFF_NOARP


	)

114 
	#IFF_PROMISC
 
IFF_PROMISC


	)

115 
	#IFF_ALLMULTI
 
IFF_ALLMULTI


	)

116 
	#IFF_MASTER
 
IFF_MASTER


	)

117 
	#IFF_SLAVE
 
IFF_SLAVE


	)

118 
	#IFF_MULTICAST
 
IFF_MULTICAST


	)

119 
	#IFF_PORTSEL
 
IFF_PORTSEL


	)

120 
	#IFF_AUTOMEDIA
 
IFF_AUTOMEDIA


	)

121 
	#IFF_DYNAMIC
 
IFF_DYNAMIC


	)

124 #ià
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


125 
	#IFF_LOWER_UP
 
IFF_LOWER_UP


	)

126 
	#IFF_DORMANT
 
IFF_DORMANT


	)

127 
	#IFF_ECHO
 
IFF_ECHO


	)

130 
	#IFF_VOLATILE
 (
IFF_LOOPBACK
|
IFF_POINTOPOINT
|
IFF_BROADCAST
|
IFF_ECHO
|\

131 
IFF_MASTER
|
IFF_SLAVE
|
IFF_RUNNING
|
IFF_LOWER_UP
|
IFF_DORMANT
)

	)

133 
	#IF_GET_IFACE
 0x0001

	)

134 
	#IF_GET_PROTO
 0x0002

	)

137 
	#IF_IFACE_V35
 0x1000

	)

138 
	#IF_IFACE_V24
 0x1001

	)

139 
	#IF_IFACE_X21
 0x1002

	)

140 
	#IF_IFACE_T1
 0x1003

	)

141 
	#IF_IFACE_E1
 0x1004

	)

142 
	#IF_IFACE_SYNC_SERIAL
 0x1005

	)

143 
	#IF_IFACE_X21D
 0x1006

	)

146 
	#IF_PROTO_HDLC
 0x2000

	)

147 
	#IF_PROTO_PPP
 0x2001

	)

148 
	#IF_PROTO_CISCO
 0x2002

	)

149 
	#IF_PROTO_FR
 0x2003

	)

150 
	#IF_PROTO_FR_ADD_PVC
 0x2004

	)

151 
	#IF_PROTO_FR_DEL_PVC
 0x2005

	)

152 
	#IF_PROTO_X25
 0x2006

	)

153 
	#IF_PROTO_HDLC_ETH
 0x2007

	)

154 
	#IF_PROTO_FR_ADD_ETH_PVC
 0x2008

	)

155 
	#IF_PROTO_FR_DEL_ETH_PVC
 0x2009

	)

156 
	#IF_PROTO_FR_PVC
 0x200A

	)

157 
	#IF_PROTO_FR_ETH_PVC
 0x200B

	)

158 
	#IF_PROTO_RAW
 0x200C

	)

162 
	mIF_OPER_UNKNOWN
,

163 
	mIF_OPER_NOTPRESENT
,

164 
	mIF_OPER_DOWN
,

165 
	mIF_OPER_LOWERLAYERDOWN
,

166 
	mIF_OPER_TESTING
,

167 
	mIF_OPER_DORMANT
,

168 
	mIF_OPER_UP
,

173 
	mIF_LINK_MODE_DEFAULT
,

174 
	mIF_LINK_MODE_DORMANT
,

188 #ià
__UAPI_DEF_IF_IFMAP


189 
	sifm­
 {

190 
	mmem_¡¬t
;

191 
	mmem_’d
;

192 
	mba£_addr
;

193 
	mœq
;

194 
	mdma
;

195 
	mpÜt
;

200 
	sif_£‰šgs
 {

201 
	mty³
;

202 
	msize
;

205 
¿w_hdlc_´Ùo
 *
	m¿w_hdlc
;

206 
cisco_´Ùo
 *
	mcisco
;

207 
ä_´Ùo
 *
	mä
;

208 
ä_´Ùo_pvc
 *
	mä_pvc
;

209 
ä_´Ùo_pvc_šfo
 *
	mä_pvc_šfo
;

212 
sync_£rŸl_£‰šgs
 *
	msync
;

213 
‹1_£‰šgs
 *
	m‹1
;

214 } 
	mifs_ifsu
;

225 #ià
__UAPI_DEF_IF_IFREQ


226 
	siäeq
 {

227 
	#IFHWADDRLEN
 6

	)

230 
	miän_Çme
[
IFNAMSIZ
];

231 } 
	miä_iän
;

234 
sockaddr
 
	miäu_addr
;

235 
sockaddr
 
	miäu_d¡addr
;

236 
sockaddr
 
	miäu_brßdaddr
;

237 
sockaddr
 
	miäu_Ãtmask
;

238 
sockaddr
 
	miäu_hwaddr
;

239 
	miäu_æags
;

240 
	miäu_iv®ue
;

241 
	miäu_mtu
;

242 
ifm­
 
	miäu_m­
;

243 
	miäu_¦ave
[
IFNAMSIZ
];

244 
	miäu_ÃwÇme
[
IFNAMSIZ
];

245 * 
	miäu_d©a
;

246 
if_£‰šgs
 
	miäu_£‰šgs
;

247 } 
	miä_iäu
;

251 
	#iä_Çme
 
iä_iän
.
iän_Çme


	)

252 
	#iä_hwaddr
 
iä_iäu
.
iäu_hwaddr


	)

253 
	#iä_addr
 
iä_iäu
.
iäu_addr


	)

254 
	#iä_d¡addr
 
iä_iäu
.
iäu_d¡addr


	)

255 
	#iä_brßdaddr
 
iä_iäu
.
iäu_brßdaddr


	)

256 
	#iä_Ãtmask
 
iä_iäu
.
iäu_Ãtmask


	)

257 
	#iä_æags
 
iä_iäu
.
iäu_æags


	)

258 
	#iä_m‘ric
 
iä_iäu
.
iäu_iv®ue


	)

259 
	#iä_mtu
 
iä_iäu
.
iäu_mtu


	)

260 
	#iä_m­
 
iä_iäu
.
iäu_m­


	)

261 
	#iä_¦ave
 
iä_iäu
.
iäu_¦ave


	)

262 
	#iä_d©a
 
iä_iäu
.
iäu_d©a


	)

263 
	#iä_ifšdex
 
iä_iäu
.
iäu_iv®ue


	)

264 
	#iä_bªdwidth
 
iä_iäu
.
iäu_iv®ue


	)

265 
	#iä_qËn
 
iä_iäu
.
iäu_iv®ue


	)

266 
	#iä_ÃwÇme
 
iä_iäu
.
iäu_ÃwÇme


	)

267 
	#iä_£‰šgs
 
iä_iäu
.
iäu_£‰šgs


	)

277 #ià
__UAPI_DEF_IF_IFCONF


278 
	sifcÚf
 {

279 
	mifc_Ën
;

281 *
	mifcu_buf
;

282 
iäeq
 *
	mifcu_»q
;

283 } 
	mifc_ifcu
;

287 
	#ifc_buf
 
ifc_ifcu
.
ifcu_buf


	)

288 
	#ifc_»q
 
ifc_ifcu
.
ifcu_»q


	)

	@/usr/include/linux/if_arp.h

23 #iâdeà
_LINUX_IF_ARP_H


24 
	#_LINUX_IF_ARP_H


	)

26 
	~<lšux/Ãtdeviû.h
>

29 
	#ARPHRD_NETROM
 0

	)

30 
	#ARPHRD_ETHER
 1

	)

31 
	#ARPHRD_EETHER
 2

	)

32 
	#ARPHRD_AX25
 3

	)

33 
	#ARPHRD_PRONET
 4

	)

34 
	#ARPHRD_CHAOS
 5

	)

35 
	#ARPHRD_IEEE802
 6

	)

36 
	#ARPHRD_ARCNET
 7

	)

37 
	#ARPHRD_APPLETLK
 8

	)

38 
	#ARPHRD_DLCI
 15

	)

39 
	#ARPHRD_ATM
 19

	)

40 
	#ARPHRD_METRICOM
 23

	)

41 
	#ARPHRD_IEEE1394
 24

	)

42 
	#ARPHRD_EUI64
 27

	)

43 
	#ARPHRD_INFINIBAND
 32

	)

46 
	#ARPHRD_SLIP
 256

	)

47 
	#ARPHRD_CSLIP
 257

	)

48 
	#ARPHRD_SLIP6
 258

	)

49 
	#ARPHRD_CSLIP6
 259

	)

50 
	#ARPHRD_RSRVD
 260

	)

51 
	#ARPHRD_ADAPT
 264

	)

52 
	#ARPHRD_ROSE
 270

	)

53 
	#ARPHRD_X25
 271

	)

54 
	#ARPHRD_HWX25
 272

	)

55 
	#ARPHRD_CAN
 280

	)

56 
	#ARPHRD_PPP
 512

	)

57 
	#ARPHRD_CISCO
 513

	)

58 
	#ARPHRD_HDLC
 
ARPHRD_CISCO


	)

59 
	#ARPHRD_LAPB
 516

	)

60 
	#ARPHRD_DDCMP
 517

	)

61 
	#ARPHRD_RAWHDLC
 518

	)

63 
	#ARPHRD_TUNNEL
 768

	)

64 
	#ARPHRD_TUNNEL6
 769

	)

65 
	#ARPHRD_FRAD
 770

	)

66 
	#ARPHRD_SKIP
 771

	)

67 
	#ARPHRD_LOOPBACK
 772

	)

68 
	#ARPHRD_LOCALTLK
 773

	)

69 
	#ARPHRD_FDDI
 774

	)

70 
	#ARPHRD_BIF
 775

	)

71 
	#ARPHRD_SIT
 776

	)

72 
	#ARPHRD_IPDDP
 777

	)

73 
	#ARPHRD_IPGRE
 778

	)

74 
	#ARPHRD_PIMREG
 779

	)

75 
	#ARPHRD_HIPPI
 780

	)

76 
	#ARPHRD_ASH
 781

	)

77 
	#ARPHRD_ECONET
 782

	)

78 
	#ARPHRD_IRDA
 783

	)

80 
	#ARPHRD_FCPP
 784

	)

81 
	#ARPHRD_FCAL
 785

	)

82 
	#ARPHRD_FCPL
 786

	)

83 
	#ARPHRD_FCFABRIC
 787

	)

85 
	#ARPHRD_IEEE802_TR
 800

	)

86 
	#ARPHRD_IEEE80211
 801

	)

87 
	#ARPHRD_IEEE80211_PRISM
 802

	)

88 
	#ARPHRD_IEEE80211_RADIOTAP
 803

	)

89 
	#ARPHRD_IEEE802154
 804

	)

90 
	#ARPHRD_IEEE802154_MONITOR
 805

	)

92 
	#ARPHRD_PHONET
 820

	)

93 
	#ARPHRD_PHONET_PIPE
 821

	)

94 
	#ARPHRD_CAIF
 822

	)

95 
	#ARPHRD_IP6GRE
 823

	)

96 
	#ARPHRD_NETLINK
 824

	)

97 
	#ARPHRD_6LOWPAN
 825

	)

99 
	#ARPHRD_VOID
 0xFFFF

	)

100 
	#ARPHRD_NONE
 0xFFFE

	)

103 
	#ARPOP_REQUEST
 1

	)

104 
	#ARPOP_REPLY
 2

	)

105 
	#ARPOP_RREQUEST
 3

	)

106 
	#ARPOP_RREPLY
 4

	)

107 
	#ARPOP_InREQUEST
 8

	)

108 
	#ARPOP_InREPLY
 9

	)

109 
	#ARPOP_NAK
 10

	)

113 
	s¬´eq
 {

114 
sockaddr
 
	m¬p_·
;

115 
sockaddr
 
	m¬p_ha
;

116 
	m¬p_æags
;

117 
sockaddr
 
	m¬p_Ãtmask
;

118 
	m¬p_dev
[16];

121 
	s¬´eq_Şd
 {

122 
sockaddr
 
	m¬p_·
;

123 
sockaddr
 
	m¬p_ha
;

124 
	m¬p_æags
;

125 
sockaddr
 
	m¬p_Ãtmask
;

129 
	#ATF_COM
 0x02

	)

130 
	#ATF_PERM
 0x04

	)

131 
	#ATF_PUBL
 0x08

	)

132 
	#ATF_USETRAILERS
 0x10

	)

133 
	#ATF_NETMASK
 0x20

	)

135 
	#ATF_DONTPUB
 0x40

	)

141 
	s¬phdr
 {

142 
__be16
 
	m¬_hrd
;

143 
__be16
 
	m¬_´o
;

144 
	m¬_hÊ
;

145 
	m¬_¶n
;

146 
__be16
 
	m¬_İ
;

152 
	m¬_sha
[
ETH_ALEN
];

153 
	m¬_s
[4];

154 
	m¬_tha
[
ETH_ALEN
];

155 
	m¬_t
[4];

	@/usr/include/linux/if_bridge.h

13 #iâdeà
_LINUX_IF_BRIDGE_H


14 
	#_LINUX_IF_BRIDGE_H


	)

16 
	~<lšux/ty³s.h
>

17 
	~<lšux/if_‘h”.h
>

18 
	~<lšux/š6.h
>

20 
	#SYSFS_BRIDGE_ATTR
 "bridge"

	)

21 
	#SYSFS_BRIDGE_FDB
 "brfÜw¬d"

	)

22 
	#SYSFS_BRIDGE_PORT_SUBDIR
 "brif"

	)

23 
	#SYSFS_BRIDGE_PORT_ATTR
 "b½Üt"

	)

24 
	#SYSFS_BRIDGE_PORT_LINK
 "bridge"

	)

26 
	#BRCTL_VERSION
 1

	)

28 
	#BRCTL_GET_VERSION
 0

	)

29 
	#BRCTL_GET_BRIDGES
 1

	)

30 
	#BRCTL_ADD_BRIDGE
 2

	)

31 
	#BRCTL_DEL_BRIDGE
 3

	)

32 
	#BRCTL_ADD_IF
 4

	)

33 
	#BRCTL_DEL_IF
 5

	)

34 
	#BRCTL_GET_BRIDGE_INFO
 6

	)

35 
	#BRCTL_GET_PORT_LIST
 7

	)

36 
	#BRCTL_SET_BRIDGE_FORWARD_DELAY
 8

	)

37 
	#BRCTL_SET_BRIDGE_HELLO_TIME
 9

	)

38 
	#BRCTL_SET_BRIDGE_MAX_AGE
 10

	)

39 
	#BRCTL_SET_AGEING_TIME
 11

	)

40 
	#BRCTL_SET_GC_INTERVAL
 12

	)

41 
	#BRCTL_GET_PORT_INFO
 13

	)

42 
	#BRCTL_SET_BRIDGE_STP_STATE
 14

	)

43 
	#BRCTL_SET_BRIDGE_PRIORITY
 15

	)

44 
	#BRCTL_SET_PORT_PRIORITY
 16

	)

45 
	#BRCTL_SET_PATH_COST
 17

	)

46 
	#BRCTL_GET_FDB_ENTRIES
 18

	)

48 
	#BR_STATE_DISABLED
 0

	)

49 
	#BR_STATE_LISTENING
 1

	)

50 
	#BR_STATE_LEARNING
 2

	)

51 
	#BR_STATE_FORWARDING
 3

	)

52 
	#BR_STATE_BLOCKING
 4

	)

54 
	s__bridge_šfo
 {

55 
__u64
 
	mdesigÇ‹d_roÙ
;

56 
__u64
 
	mbridge_id
;

57 
__u32
 
	mroÙ_·th_co¡
;

58 
__u32
 
	mmax_age
;

59 
__u32
 
	mh–lo_time
;

60 
__u32
 
	mfÜw¬d_d–ay
;

61 
__u32
 
	mbridge_max_age
;

62 
__u32
 
	mbridge_h–lo_time
;

63 
__u32
 
	mbridge_fÜw¬d_d–ay
;

64 
__u8
 
	mtİŞogy_chªge
;

65 
__u8
 
	mtİŞogy_chªge_d‘eùed
;

66 
__u8
 
	mroÙ_pÜt
;

67 
__u8
 
	m¡p_’abËd
;

68 
__u32
 
	magešg_time
;

69 
__u32
 
	mgc_š‹rv®
;

70 
__u32
 
	mh–lo_tim”_v®ue
;

71 
__u32
 
	mtú_tim”_v®ue
;

72 
__u32
 
	mtİŞogy_chªge_tim”_v®ue
;

73 
__u32
 
	mgc_tim”_v®ue
;

76 
	s__pÜt_šfo
 {

77 
__u64
 
	mdesigÇ‹d_roÙ
;

78 
__u64
 
	mdesigÇ‹d_bridge
;

79 
__u16
 
	mpÜt_id
;

80 
__u16
 
	mdesigÇ‹d_pÜt
;

81 
__u32
 
	m·th_co¡
;

82 
__u32
 
	mdesigÇ‹d_co¡
;

83 
__u8
 
	m¡©e
;

84 
__u8
 
	mtİ_chªge_ack
;

85 
__u8
 
	mcÚfig_³ndšg
;

86 
__u8
 
	munu£d0
;

87 
__u32
 
	mmes§ge_age_tim”_v®ue
;

88 
__u32
 
	mfÜw¬d_d–ay_tim”_v®ue
;

89 
__u32
 
	mhŞd_tim”_v®ue
;

92 
	s__fdb_’Œy
 {

93 
__u8
 
	mmac_addr
[
ETH_ALEN
];

94 
__u8
 
	mpÜt_no
;

95 
__u8
 
	mis_loÿl
;

96 
__u32
 
	magešg_tim”_v®ue
;

97 
__u8
 
	mpÜt_hi
;

98 
__u8
 
	m·d0
;

99 
__u16
 
	munu£d
;

103 
	#BRIDGE_FLAGS_MASTER
 1

	)

104 
	#BRIDGE_FLAGS_SELF
 2

	)

106 
	#BRIDGE_MODE_VEB
 0

	)

107 
	#BRIDGE_MODE_VEPA
 1

	)

108 
	#BRIDGE_MODE_UNDEF
 0xFFFF

	)

118 
	mIFLA_BRIDGE_FLAGS
,

119 
	mIFLA_BRIDGE_MODE
,

120 
	mIFLA_BRIDGE_VLAN_INFO
,

121 
	m__IFLA_BRIDGE_MAX
,

123 
	#IFLA_BRIDGE_MAX
 (
__IFLA_BRIDGE_MAX
 - 1)

	)

125 
	#BRIDGE_VLAN_INFO_MASTER
 (1<<0è

	)

126 
	#BRIDGE_VLAN_INFO_PVID
 (1<<1è

	)

127 
	#BRIDGE_VLAN_INFO_UNTAGGED
 (1<<2è

	)

128 
	#BRIDGE_VLAN_INFO_RANGE_BEGIN
 (1<<3è

	)

129 
	#BRIDGE_VLAN_INFO_RANGE_END
 (1<<4è

	)

130 
	#BRIDGE_VLAN_INFO_BRENTRY
 (1<<5è

	)

132 
	sbridge_vÏn_šfo
 {

133 
__u16
 
	mæags
;

134 
__u16
 
	mvid
;

137 
	sbridge_vÏn_x¡©s
 {

138 
__u64
 
	mrx_by‹s
;

139 
__u64
 
	mrx_·ck‘s
;

140 
__u64
 
	mtx_by‹s
;

141 
__u64
 
	mtx_·ck‘s
;

142 
__u16
 
	mvid
;

143 
__u16
 
	mæags
;

144 
__u32
 
	m·d2
;

164 
	mMDBA_UNSPEC
,

165 
	mMDBA_MDB
,

166 
	mMDBA_ROUTER
,

167 
	m__MDBA_MAX
,

169 
	#MDBA_MAX
 (
__MDBA_MAX
 - 1)

	)

172 
	mMDBA_MDB_UNSPEC
,

173 
	mMDBA_MDB_ENTRY
,

174 
	m__MDBA_MDB_MAX
,

176 
	#MDBA_MDB_MAX
 (
__MDBA_MDB_MAX
 - 1)

	)

179 
	mMDBA_MDB_ENTRY_UNSPEC
,

180 
	mMDBA_MDB_ENTRY_INFO
,

181 
	m__MDBA_MDB_ENTRY_MAX
,

183 
	#MDBA_MDB_ENTRY_MAX
 (
__MDBA_MDB_ENTRY_MAX
 - 1)

	)

187 
	mMDBA_MDB_EATTR_UNSPEC
,

188 
	mMDBA_MDB_EATTR_TIMER
,

189 
	m__MDBA_MDB_EATTR_MAX


191 
	#MDBA_MDB_EATTR_MAX
 (
__MDBA_MDB_EATTR_MAX
 - 1)

	)

195 
	mMDB_RTR_TYPE_DISABLED
,

196 
	mMDB_RTR_TYPE_TEMP_QUERY
,

197 
	mMDB_RTR_TYPE_PERM
,

198 
	mMDB_RTR_TYPE_TEMP


202 
	mMDBA_ROUTER_UNSPEC
,

203 
	mMDBA_ROUTER_PORT
,

204 
	m__MDBA_ROUTER_MAX
,

206 
	#MDBA_ROUTER_MAX
 (
__MDBA_ROUTER_MAX
 - 1)

	)

210 
	mMDBA_ROUTER_PATTR_UNSPEC
,

211 
	mMDBA_ROUTER_PATTR_TIMER
,

212 
	mMDBA_ROUTER_PATTR_TYPE
,

213 
	m__MDBA_ROUTER_PATTR_MAX


215 
	#MDBA_ROUTER_PATTR_MAX
 (
__MDBA_ROUTER_PATTR_MAX
 - 1)

	)

217 
	sbr_pÜt_msg
 {

218 
__u8
 
	mçmy
;

219 
__u32
 
	mifšdex
;

222 
	sbr_mdb_’Œy
 {

223 
__u32
 
	mifšdex
;

224 
	#MDB_TEMPORARY
 0

	)

225 
	#MDB_PERMANENT
 1

	)

226 
__u8
 
	m¡©e
;

227 
	#MDB_FLAGS_OFFLOAD
 (1 << 0)

	)

228 
__u8
 
	mæags
;

229 
__u16
 
	mvid
;

232 
__be32
 
	m4
;

233 
š6_addr
 
	m6
;

234 } 
	mu
;

235 
__be16
 
	m´Ùo
;

236 } 
	maddr
;

240 
	mMDBA_SET_ENTRY_UNSPEC
,

241 
	mMDBA_SET_ENTRY
,

242 
	m__MDBA_SET_ENTRY_MAX
,

244 
	#MDBA_SET_ENTRY_MAX
 (
__MDBA_SET_ENTRY_MAX
 - 1)

	)

248 
	mBRIDGE_XSTATS_UNSPEC
,

249 
	mBRIDGE_XSTATS_VLAN
,

250 
	mBRIDGE_XSTATS_MCAST
,

251 
	mBRIDGE_XSTATS_PAD
,

252 
	m__BRIDGE_XSTATS_MAX


254 
	#BRIDGE_XSTATS_MAX
 (
__BRIDGE_XSTATS_MAX
 - 1)

	)

257 
	mBR_MCAST_DIR_RX
,

258 
	mBR_MCAST_DIR_TX
,

259 
	mBR_MCAST_DIR_SIZE


263 
	sbr_mÿ¡_¡©s
 {

264 
__u64
 
	migmp_v1qu”›s
[
BR_MCAST_DIR_SIZE
];

265 
__u64
 
	migmp_v2qu”›s
[
BR_MCAST_DIR_SIZE
];

266 
__u64
 
	migmp_v3qu”›s
[
BR_MCAST_DIR_SIZE
];

267 
__u64
 
	migmp_Ëaves
[
BR_MCAST_DIR_SIZE
];

268 
__u64
 
	migmp_v1»pÜts
[
BR_MCAST_DIR_SIZE
];

269 
__u64
 
	migmp_v2»pÜts
[
BR_MCAST_DIR_SIZE
];

270 
__u64
 
	migmp_v3»pÜts
[
BR_MCAST_DIR_SIZE
];

271 
__u64
 
	migmp_·r£_”rÜs
;

273 
__u64
 
	mmld_v1qu”›s
[
BR_MCAST_DIR_SIZE
];

274 
__u64
 
	mmld_v2qu”›s
[
BR_MCAST_DIR_SIZE
];

275 
__u64
 
	mmld_Ëaves
[
BR_MCAST_DIR_SIZE
];

276 
__u64
 
	mmld_v1»pÜts
[
BR_MCAST_DIR_SIZE
];

277 
__u64
 
	mmld_v2»pÜts
[
BR_MCAST_DIR_SIZE
];

278 
__u64
 
	mmld_·r£_”rÜs
;

280 
__u64
 
	mmÿ¡_by‹s
[
BR_MCAST_DIR_SIZE
];

281 
__u64
 
	mmÿ¡_·ck‘s
[
BR_MCAST_DIR_SIZE
];

	@/usr/include/linux/if_ether.h

21 #iâdeà
_LINUX_IF_ETHER_H


22 
	#_LINUX_IF_ETHER_H


	)

24 
	~<lšux/ty³s.h
>

31 
	#ETH_ALEN
 6

	)

32 
	#ETH_HLEN
 14

	)

33 
	#ETH_ZLEN
 60

	)

34 
	#ETH_DATA_LEN
 1500

	)

35 
	#ETH_FRAME_LEN
 1514

	)

36 
	#ETH_FCS_LEN
 4

	)

42 
	#ETH_P_LOOP
 0x0060

	)

43 
	#ETH_P_PUP
 0x0200

	)

44 
	#ETH_P_PUPAT
 0x0201

	)

45 
	#ETH_P_TSN
 0x22F0

	)

46 
	#ETH_P_IP
 0x0800

	)

47 
	#ETH_P_X25
 0x0805

	)

48 
	#ETH_P_ARP
 0x0806

	)

49 
	#ETH_P_BPQ
 0x08FF

	)

50 
	#ETH_P_IEEEPUP
 0x0a00

	)

51 
	#ETH_P_IEEEPUPAT
 0x0a01

	)

52 
	#ETH_P_BATMAN
 0x4305

	)

53 
	#ETH_P_DEC
 0x6000

	)

54 
	#ETH_P_DNA_DL
 0x6001

	)

55 
	#ETH_P_DNA_RC
 0x6002

	)

56 
	#ETH_P_DNA_RT
 0x6003

	)

57 
	#ETH_P_LAT
 0x6004

	)

58 
	#ETH_P_DIAG
 0x6005

	)

59 
	#ETH_P_CUST
 0x6006

	)

60 
	#ETH_P_SCA
 0x6007

	)

61 
	#ETH_P_TEB
 0x6558

	)

62 
	#ETH_P_RARP
 0x8035

	)

63 
	#ETH_P_ATALK
 0x809B

	)

64 
	#ETH_P_AARP
 0x80F3

	)

65 
	#ETH_P_8021Q
 0x8100

	)

66 
	#ETH_P_IPX
 0x8137

	)

67 
	#ETH_P_IPV6
 0x86DD

	)

68 
	#ETH_P_PAUSE
 0x8808

	)

69 
	#ETH_P_SLOW
 0x8809

	)

70 
	#ETH_P_WCCP
 0x883E

	)

72 
	#ETH_P_MPLS_UC
 0x8847

	)

73 
	#ETH_P_MPLS_MC
 0x8848

	)

74 
	#ETH_P_ATMMPOA
 0x884ø

	)

75 
	#ETH_P_PPP_DISC
 0x8863

	)

76 
	#ETH_P_PPP_SES
 0x8864

	)

77 
	#ETH_P_LINK_CTL
 0x886ø

	)

78 
	#ETH_P_ATMFATE
 0x8884

	)

81 
	#ETH_P_PAE
 0x888E

	)

82 
	#ETH_P_AOE
 0x88A2

	)

83 
	#ETH_P_8021AD
 0x88A8

	)

84 
	#ETH_P_802_EX1
 0x88B5

	)

85 
	#ETH_P_TIPC
 0x88CA

	)

86 
	#ETH_P_MACSEC
 0x88E5

	)

87 
	#ETH_P_8021AH
 0x88E7

	)

88 
	#ETH_P_MVRP
 0x88F5

	)

89 
	#ETH_P_1588
 0x88F7

	)

90 
	#ETH_P_NCSI
 0x88F8

	)

91 
	#ETH_P_PRP
 0x88FB

	)

92 
	#ETH_P_FCOE
 0x8906

	)

93 
	#ETH_P_TDLS
 0x890D

	)

94 
	#ETH_P_FIP
 0x8914

	)

95 
	#ETH_P_80221
 0x8917

	)

96 
	#ETH_P_HSR
 0x892F

	)

97 
	#ETH_P_LOOPBACK
 0x9000

	)

98 
	#ETH_P_QINQ1
 0x9100

	)

99 
	#ETH_P_QINQ2
 0x9200

	)

100 
	#ETH_P_QINQ3
 0x9300

	)

101 
	#ETH_P_EDSA
 0xDADA

	)

102 
	#ETH_P_AF_IUCV
 0xFBFB

	)

104 
	#ETH_P_802_3_MIN
 0x0600

	)

111 
	#ETH_P_802_3
 0x0001

	)

112 
	#ETH_P_AX25
 0x0002

	)

113 
	#ETH_P_ALL
 0x0003

	)

114 
	#ETH_P_802_2
 0x0004

	)

115 
	#ETH_P_SNAP
 0x0005

	)

116 
	#ETH_P_DDCMP
 0x0006

	)

117 
	#ETH_P_WAN_PPP
 0x0007

	)

118 
	#ETH_P_PPP_MP
 0x0008

	)

119 
	#ETH_P_LOCALTALK
 0x0009

	)

120 
	#ETH_P_CAN
 0x000C

	)

121 
	#ETH_P_CANFD
 0x000D

	)

122 
	#ETH_P_PPPTALK
 0x0010

	)

123 
	#ETH_P_TR_802_2
 0x0011

	)

124 
	#ETH_P_MOBITEX
 0x0015

	)

125 
	#ETH_P_CONTROL
 0x0016

	)

126 
	#ETH_P_IRDA
 0x0017

	)

127 
	#ETH_P_ECONET
 0x0018

	)

128 
	#ETH_P_HDLC
 0x0019

	)

129 
	#ETH_P_ARCNET
 0x001A

	)

130 
	#ETH_P_DSA
 0x001B

	)

131 
	#ETH_P_TRAILER
 0x001C

	)

132 
	#ETH_P_PHONET
 0x00F5

	)

133 
	#ETH_P_IEEE802154
 0x00F6

	)

134 
	#ETH_P_CAIF
 0x00F7

	)

135 
	#ETH_P_XDSA
 0x00F8

	)

141 
	s‘hhdr
 {

142 
	mh_de¡
[
ETH_ALEN
];

143 
	mh_sourû
[
ETH_ALEN
];

144 
__be16
 
	mh_´Ùo
;

145 } 
__©Œibu‹__
((
·cked
));

	@/usr/include/linux/if_packet.h

1 #iâdeà
__LINUX_IF_PACKET_H


2 
	#__LINUX_IF_PACKET_H


	)

4 
	~<lšux/ty³s.h
>

6 
	ssockaddr_pkt
 {

7 
	m¥kt_çmy
;

8 
	m¥kt_deviû
[14];

9 
__be16
 
	m¥kt_´ÙocŞ
;

12 
	ssockaddr_Î
 {

13 
	m¦l_çmy
;

14 
__be16
 
	m¦l_´ÙocŞ
;

15 
	m¦l_ifšdex
;

16 
	m¦l_h©y³
;

17 
	m¦l_pk‰y³
;

18 
	m¦l_h®’
;

19 
	m¦l_addr
[8];

24 
	#PACKET_HOST
 0

	)

25 
	#PACKET_BROADCAST
 1

	)

26 
	#PACKET_MULTICAST
 2

	)

27 
	#PACKET_OTHERHOST
 3

	)

28 
	#PACKET_OUTGOING
 4

	)

29 
	#PACKET_LOOPBACK
 5

	)

30 
	#PACKET_USER
 6

	)

31 
	#PACKET_KERNEL
 7

	)

33 
	#PACKET_FASTROUTE
 6

	)

37 
	#PACKET_ADD_MEMBERSHIP
 1

	)

38 
	#PACKET_DROP_MEMBERSHIP
 2

	)

39 
	#PACKET_RECV_OUTPUT
 3

	)

41 
	#PACKET_RX_RING
 5

	)

42 
	#PACKET_STATISTICS
 6

	)

43 
	#PACKET_COPY_THRESH
 7

	)

44 
	#PACKET_AUXDATA
 8

	)

45 
	#PACKET_ORIGDEV
 9

	)

46 
	#PACKET_VERSION
 10

	)

47 
	#PACKET_HDRLEN
 11

	)

48 
	#PACKET_RESERVE
 12

	)

49 
	#PACKET_TX_RING
 13

	)

50 
	#PACKET_LOSS
 14

	)

51 
	#PACKET_VNET_HDR
 15

	)

52 
	#PACKET_TX_TIMESTAMP
 16

	)

53 
	#PACKET_TIMESTAMP
 17

	)

54 
	#PACKET_FANOUT
 18

	)

55 
	#PACKET_TX_HAS_OFF
 19

	)

56 
	#PACKET_QDISC_BYPASS
 20

	)

57 
	#PACKET_ROLLOVER_STATS
 21

	)

58 
	#PACKET_FANOUT_DATA
 22

	)

60 
	#PACKET_FANOUT_HASH
 0

	)

61 
	#PACKET_FANOUT_LB
 1

	)

62 
	#PACKET_FANOUT_CPU
 2

	)

63 
	#PACKET_FANOUT_ROLLOVER
 3

	)

64 
	#PACKET_FANOUT_RND
 4

	)

65 
	#PACKET_FANOUT_QM
 5

	)

66 
	#PACKET_FANOUT_CBPF
 6

	)

67 
	#PACKET_FANOUT_EBPF
 7

	)

68 
	#PACKET_FANOUT_FLAG_ROLLOVER
 0x1000

	)

69 
	#PACKET_FANOUT_FLAG_DEFRAG
 0x8000

	)

71 
	sack‘_¡©s
 {

72 
	m_·ck‘s
;

73 
	m_drİs
;

76 
	sack‘_¡©s_v3
 {

77 
	m_·ck‘s
;

78 
	m_drİs
;

79 
	m_ä“ze_q_út
;

82 
	sack‘_rŞlov”_¡©s
 {

83 
__®igÃd_u64
 
	m_®l
;

84 
__®igÃd_u64
 
	m_huge
;

85 
__®igÃd_u64
 
	m_çed
;

88 
	uack‘_¡©s_u
 {

89 
ack‘_¡©s
 
	m¡©s1
;

90 
ack‘_¡©s_v3
 
	m¡©s3
;

93 
	sack‘_auxd©a
 {

94 
__u32
 
	m_¡©us
;

95 
__u32
 
	m_Ën
;

96 
__u32
 
	m_¢­Ën
;

97 
__u16
 
	m_mac
;

98 
__u16
 
	m_Ãt
;

99 
__u16
 
	m_vÏn_tci
;

100 
__u16
 
	m_vÏn_id
;

104 
	#TP_STATUS_KERNEL
 0

	)

105 
	#TP_STATUS_USER
 (1 << 0)

	)

106 
	#TP_STATUS_COPY
 (1 << 1)

	)

107 
	#TP_STATUS_LOSING
 (1 << 2)

	)

108 
	#TP_STATUS_CSUMNOTREADY
 (1 << 3)

	)

109 
	#TP_STATUS_VLAN_VALID
 (1 << 4è

	)

110 
	#TP_STATUS_BLK_TMO
 (1 << 5)

	)

111 
	#TP_STATUS_VLAN_TPID_VALID
 (1 << 6è

	)

112 
	#TP_STATUS_CSUM_VALID
 (1 << 7)

	)

115 
	#TP_STATUS_AVAILABLE
 0

	)

116 
	#TP_STATUS_SEND_REQUEST
 (1 << 0)

	)

117 
	#TP_STATUS_SENDING
 (1 << 1)

	)

118 
	#TP_STATUS_WRONG_FORMAT
 (1 << 2)

	)

121 
	#TP_STATUS_TS_SOFTWARE
 (1 << 29)

	)

122 
	#TP_STATUS_TS_SYS_HARDWARE
 (1 << 30è

	)

123 
	#TP_STATUS_TS_RAW_HARDWARE
 (1 << 31)

	)

126 
	#TP_FT_REQ_FILL_RXHASH
 0x1

	)

128 
	sack‘_hdr
 {

129 
	m_¡©us
;

130 
	m_Ën
;

131 
	m_¢­Ën
;

132 
	m_mac
;

133 
	m_Ãt
;

134 
	m_£c
;

135 
	m_u£c
;

138 
	#TPACKET_ALIGNMENT
 16

	)

139 
	#TPACKET_ALIGN
(
x
è(((x)+
TPACKET_ALIGNMENT
-1)&~(TPACKET_ALIGNMENT-1))

	)

140 
	#TPACKET_HDRLEN
 (
	`TPACKET_ALIGN
((
ack‘_hdr
)è+ (
sockaddr_Î
))

	)

142 
	sack‘2_hdr
 {

143 
__u32
 
	m_¡©us
;

144 
__u32
 
	m_Ën
;

145 
__u32
 
	m_¢­Ën
;

146 
__u16
 
	m_mac
;

147 
__u16
 
	m_Ãt
;

148 
__u32
 
	m_£c
;

149 
__u32
 
	m_n£c
;

150 
__u16
 
	m_vÏn_tci
;

151 
__u16
 
	m_vÏn_id
;

152 
__u8
 
	m_·ddšg
[4];

155 
	sack‘_hdr_v¬ŸÁ1
 {

156 
__u32
 
	m_rxhash
;

157 
__u32
 
	m_vÏn_tci
;

158 
__u16
 
	m_vÏn_id
;

159 
__u16
 
	m_·ddšg
;

162 
	sack‘3_hdr
 {

163 
__u32
 
	m_Ãxt_off£t
;

164 
__u32
 
	m_£c
;

165 
__u32
 
	m_n£c
;

166 
__u32
 
	m_¢­Ën
;

167 
__u32
 
	m_Ën
;

168 
__u32
 
	m_¡©us
;

169 
__u16
 
	m_mac
;

170 
__u16
 
	m_Ãt
;

173 
ack‘_hdr_v¬ŸÁ1
 
	mhv1
;

175 
__u8
 
	m_·ddšg
[8];

178 
	sack‘_bd_ts
 {

179 
	mts_£c
;

181 
	mts_u£c
;

182 
	mts_n£c
;

186 
	sack‘_hdr_v1
 {

187 
__u32
 
	mblock_¡©us
;

188 
__u32
 
	mnum_pkts
;

189 
__u32
 
	moff£t_to_fœ¡_pkt
;

194 
__u32
 
	mblk_Ën
;

205 
__®igÃd_u64
 
	m£q_num
;

232 
ack‘_bd_ts
 
	mts_fœ¡_pkt
, 
	mts_Ï¡_pkt
;

235 
	uack‘_bd_h—d”_u
 {

236 
ack‘_hdr_v1
 
	mbh1
;

239 
	sack‘_block_desc
 {

240 
__u32
 
	mv”siÚ
;

241 
__u32
 
	moff£t_to_´iv
;

242 
ack‘_bd_h—d”_u
 
	mhdr
;

245 
	#TPACKET2_HDRLEN
 (
	`TPACKET_ALIGN
((
ack‘2_hdr
)è+ (
sockaddr_Î
))

	)

246 
	#TPACKET3_HDRLEN
 (
	`TPACKET_ALIGN
((
ack‘3_hdr
)è+ (
sockaddr_Î
))

	)

248 
	eack‘_v”siÚs
 {

249 
	mTPACKET_V1
,

250 
	mTPACKET_V2
,

251 
	mTPACKET_V3


267 
	sack‘_»q
 {

268 
	m_block_size
;

269 
	m_block_Ä
;

270 
	m_äame_size
;

271 
	m_äame_Ä
;

274 
	sack‘_»q3
 {

275 
	m_block_size
;

276 
	m_block_Ä
;

277 
	m_äame_size
;

278 
	m_äame_Ä
;

279 
	m_»tœe_blk_tov
;

280 
	m_sizeof_´iv
;

281 
	m_ã©u»_»q_wÜd
;

284 
	uack‘_»q_u
 {

285 
ack‘_»q
 
	m»q
;

286 
ack‘_»q3
 
	m»q3
;

289 
	s·ck‘_m»q
 {

290 
	mmr_ifšdex
;

291 
	mmr_ty³
;

292 
	mmr_®’
;

293 
	mmr_add»ss
[8];

296 
	#PACKET_MR_MULTICAST
 0

	)

297 
	#PACKET_MR_PROMISC
 1

	)

298 
	#PACKET_MR_ALLMULTI
 2

	)

299 
	#PACKET_MR_UNICAST
 3

	)

	@/usr/include/linux/if_tun.h

16 #iâdeà
__IF_TUN_H


17 
	#__IF_TUN_H


	)

19 
	~<lšux/ty³s.h
>

20 
	~<lšux/if_‘h”.h
>

21 
	~<lšux/f‹r.h
>

24 
	#TUN_READQ_SIZE
 500

	)

26 
	#TUN_TUN_DEV
 
IFF_TUN


	)

27 
	#TUN_TAP_DEV
 
IFF_TAP


	)

28 
	#TUN_TYPE_MASK
 0x000f

	)

31 
	#TUNSETNOCSUM
 
	`_IOW
('T', 200, )

	)

32 
	#TUNSETDEBUG
 
	`_IOW
('T', 201, )

	)

33 
	#TUNSETIFF
 
	`_IOW
('T', 202, )

	)

34 
	#TUNSETPERSIST
 
	`_IOW
('T', 203, )

	)

35 
	#TUNSETOWNER
 
	`_IOW
('T', 204, )

	)

36 
	#TUNSETLINK
 
	`_IOW
('T', 205, )

	)

37 
	#TUNSETGROUP
 
	`_IOW
('T', 206, )

	)

38 
	#TUNGETFEATURES
 
	`_IOR
('T', 207, )

	)

39 
	#TUNSETOFFLOAD
 
	`_IOW
('T', 208, )

	)

40 
	#TUNSETTXFILTER
 
	`_IOW
('T', 209, )

	)

41 
	#TUNGETIFF
 
	`_IOR
('T', 210, )

	)

42 
	#TUNGETSNDBUF
 
	`_IOR
('T', 211, )

	)

43 
	#TUNSETSNDBUF
 
	`_IOW
('T', 212, )

	)

44 
	#TUNATTACHFILTER
 
	`_IOW
('T', 213, 
sock_årog
)

	)

45 
	#TUNDETACHFILTER
 
	`_IOW
('T', 214, 
sock_årog
)

	)

46 
	#TUNGETVNETHDRSZ
 
	`_IOR
('T', 215, )

	)

47 
	#TUNSETVNETHDRSZ
 
	`_IOW
('T', 216, )

	)

48 
	#TUNSETQUEUE
 
	`_IOW
('T', 217, )

	)

49 
	#TUNSETIFINDEX
 
	`_IOW
('T', 218, )

	)

50 
	#TUNGETFILTER
 
	`_IOR
('T', 219, 
sock_årog
)

	)

51 
	#TUNSETVNETLE
 
	`_IOW
('T', 220, )

	)

52 
	#TUNGETVNETLE
 
	`_IOR
('T', 221, )

	)

57 
	#TUNSETVNETBE
 
	`_IOW
('T', 222, )

	)

58 
	#TUNGETVNETBE
 
	`_IOR
('T', 223, )

	)

61 
	#IFF_TUN
 0x0001

	)

62 
	#IFF_TAP
 0x0002

	)

63 
	#IFF_NO_PI
 0x1000

	)

65 
	#IFF_ONE_QUEUE
 0x2000

	)

66 
	#IFF_VNET_HDR
 0x4000

	)

67 
	#IFF_TUN_EXCL
 0x8000

	)

68 
	#IFF_MULTI_QUEUE
 0x0100

	)

69 
	#IFF_ATTACH_QUEUE
 0x0200

	)

70 
	#IFF_DETACH_QUEUE
 0x0400

	)

72 
	#IFF_PERSIST
 0x0800

	)

73 
	#IFF_NOFILTER
 0x1000

	)

76 
	#TUN_TX_TIMESTAMP
 1

	)

79 
	#TUN_F_CSUM
 0x01

	)

80 
	#TUN_F_TSO4
 0x02

	)

81 
	#TUN_F_TSO6
 0x04

	)

82 
	#TUN_F_TSO_ECN
 0x08

	)

83 
	#TUN_F_UFO
 0x10

	)

86 
	#TUN_PKT_STRIP
 0x0001

	)

87 
	stun_pi
 {

88 
__u16
 
	mæags
;

89 
__be16
 
	m´Ùo
;

100 
	#TUN_FLT_ALLMULTI
 0x0001

	)

101 
	stun_f‹r
 {

102 
__u16
 
	mæags
;

103 
__u16
 
	mcouÁ
;

104 
__u8
 
	maddr
[0][
ETH_ALEN
];

	@/usr/include/linux/ip.h

17 #iâdeà
_LINUX_IP_H


18 
	#_LINUX_IP_H


	)

19 
	~<lšux/ty³s.h
>

20 
	~<asm/by‹Üd”.h
>

22 
	#IPTOS_TOS_MASK
 0x1E

	)

23 
	#IPTOS_TOS
(
tos
è(Ños)&
IPTOS_TOS_MASK
)

	)

24 
	#IPTOS_LOWDELAY
 0x10

	)

25 
	#IPTOS_THROUGHPUT
 0x08

	)

26 
	#IPTOS_RELIABILITY
 0x04

	)

27 
	#IPTOS_MINCOST
 0x02

	)

29 
	#IPTOS_PREC_MASK
 0xE0

	)

30 
	#IPTOS_PREC
(
tos
è(Ños)&
IPTOS_PREC_MASK
)

	)

31 
	#IPTOS_PREC_NETCONTROL
 0xe0

	)

32 
	#IPTOS_PREC_INTERNETCONTROL
 0xc0

	)

33 
	#IPTOS_PREC_CRITIC_ECP
 0xa0

	)

34 
	#IPTOS_PREC_FLASHOVERRIDE
 0x80

	)

35 
	#IPTOS_PREC_FLASH
 0x60

	)

36 
	#IPTOS_PREC_IMMEDIATE
 0x40

	)

37 
	#IPTOS_PREC_PRIORITY
 0x20

	)

38 
	#IPTOS_PREC_ROUTINE
 0x00

	)

42 
	#IPOPT_COPY
 0x80

	)

43 
	#IPOPT_CLASS_MASK
 0x60

	)

44 
	#IPOPT_NUMBER_MASK
 0x1f

	)

46 
	#IPOPT_COPIED
(
o
è((o)&
IPOPT_COPY
)

	)

47 
	#IPOPT_CLASS
(
o
è((o)&
IPOPT_CLASS_MASK
)

	)

48 
	#IPOPT_NUMBER
(
o
è((o)&
IPOPT_NUMBER_MASK
)

	)

50 
	#IPOPT_CONTROL
 0x00

	)

51 
	#IPOPT_RESERVED1
 0x20

	)

52 
	#IPOPT_MEASUREMENT
 0x40

	)

53 
	#IPOPT_RESERVED2
 0x60

	)

55 
	#IPOPT_END
 (0 |
IPOPT_CONTROL
)

	)

56 
	#IPOPT_NOOP
 (1 |
IPOPT_CONTROL
)

	)

57 
	#IPOPT_SEC
 (2 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

58 
	#IPOPT_LSRR
 (3 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

59 
	#IPOPT_TIMESTAMP
 (4 |
IPOPT_MEASUREMENT
)

	)

60 
	#IPOPT_CIPSO
 (6 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

61 
	#IPOPT_RR
 (7 |
IPOPT_CONTROL
)

	)

62 
	#IPOPT_SID
 (8 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

63 
	#IPOPT_SSRR
 (9 |
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

64 
	#IPOPT_RA
 (20|
IPOPT_CONTROL
|
IPOPT_COPY
)

	)

66 
	#IPVERSION
 4

	)

67 
	#MAXTTL
 255

	)

68 
	#IPDEFTTL
 64

	)

70 
	#IPOPT_OPTVAL
 0

	)

71 
	#IPOPT_OLEN
 1

	)

72 
	#IPOPT_OFFSET
 2

	)

73 
	#IPOPT_MINOFF
 4

	)

74 
	#MAX_IPOPTLEN
 40

	)

75 
	#IPOPT_NOP
 
IPOPT_NOOP


	)

76 
	#IPOPT_EOL
 
IPOPT_END


	)

77 
	#IPOPT_TS
 
IPOPT_TIMESTAMP


	)

79 
	#IPOPT_TS_TSONLY
 0

	)

80 
	#IPOPT_TS_TSANDADDR
 1

	)

81 
	#IPOPT_TS_PRESPEC
 3

	)

83 
	#IPV4_BEET_PHMAXLEN
 8

	)

85 
	shdr
 {

86 #ià
defšed
(
__LITTLE_ENDIAN_BITFIELD
)

87 
__u8
 
	mihl
:4,

88 
	mv”siÚ
:4;

89 #–ià
defšed
 (
__BIG_ENDIAN_BITFIELD
)

90 
__u8
 
	mv”siÚ
:4,

91 
	mihl
:4;

95 
__u8
 
	mtos
;

96 
__be16
 
	mtÙ_Ën
;

97 
__be16
 
	mid
;

98 
__be16
 
	mäag_off
;

99 
__u8
 
	m‰l
;

100 
__u8
 
	m´ÙocŞ
;

101 
__sum16
 
	mcheck
;

102 
__be32
 
	m§ddr
;

103 
__be32
 
	mdaddr
;

108 
	s_auth_hdr
 {

109 
__u8
 
	mÃxthdr
;

110 
__u8
 
	mhd¾’
;

111 
__be16
 
	m»£rved
;

112 
__be32
 
	m¥i
;

113 
__be32
 
	m£q_no
;

114 
__u8
 
	mauth_d©a
[0];

117 
	s_e¥_hdr
 {

118 
__be32
 
	m¥i
;

119 
__be32
 
	m£q_no
;

120 
__u8
 
	m’c_d©a
[0];

123 
	s_comp_hdr
 {

124 
__u8
 
	mÃxthdr
;

125 
__u8
 
	mæags
;

126 
__be16
 
	mıi
;

129 
	s_b“t_phdr
 {

130 
__u8
 
	mÃxthdr
;

131 
__u8
 
	mhd¾’
;

132 
__u8
 
	m·dËn
;

133 
__u8
 
	m»£rved
;

139 
	mIPV4_DEVCONF_FORWARDING
=1,

140 
	mIPV4_DEVCONF_MC_FORWARDING
,

141 
	mIPV4_DEVCONF_PROXY_ARP
,

142 
	mIPV4_DEVCONF_ACCEPT_REDIRECTS
,

143 
	mIPV4_DEVCONF_SECURE_REDIRECTS
,

144 
	mIPV4_DEVCONF_SEND_REDIRECTS
,

145 
	mIPV4_DEVCONF_SHARED_MEDIA
,

146 
	mIPV4_DEVCONF_RP_FILTER
,

147 
	mIPV4_DEVCONF_ACCEPT_SOURCE_ROUTE
,

148 
	mIPV4_DEVCONF_BOOTP_RELAY
,

149 
	mIPV4_DEVCONF_LOG_MARTIANS
,

150 
	mIPV4_DEVCONF_TAG
,

151 
	mIPV4_DEVCONF_ARPFILTER
,

152 
	mIPV4_DEVCONF_MEDIUM_ID
,

153 
	mIPV4_DEVCONF_NOXFRM
,

154 
	mIPV4_DEVCONF_NOPOLICY
,

155 
	mIPV4_DEVCONF_FORCE_IGMP_VERSION
,

156 
	mIPV4_DEVCONF_ARP_ANNOUNCE
,

157 
	mIPV4_DEVCONF_ARP_IGNORE
,

158 
	mIPV4_DEVCONF_PROMOTE_SECONDARIES
,

159 
	mIPV4_DEVCONF_ARP_ACCEPT
,

160 
	mIPV4_DEVCONF_ARP_NOTIFY
,

161 
	mIPV4_DEVCONF_ACCEPT_LOCAL
,

162 
	mIPV4_DEVCONF_SRC_VMARK
,

163 
	mIPV4_DEVCONF_PROXY_ARP_PVLAN
,

164 
	mIPV4_DEVCONF_ROUTE_LOCALNET
,

165 
	mIPV4_DEVCONF_IGMPV2_UNSOLICITED_REPORT_INTERVAL
,

166 
	mIPV4_DEVCONF_IGMPV3_UNSOLICITED_REPORT_INTERVAL
,

167 
	mIPV4_DEVCONF_IGNORE_ROUTES_WITH_LINKDOWN
,

168 
	mIPV4_DEVCONF_DROP_UNICAST_IN_L2_MULTICAST
,

169 
	mIPV4_DEVCONF_DROP_GRATUITOUS_ARP
,

170 
	m__IPV4_DEVCONF_MAX


173 
	#IPV4_DEVCONF_MAX
 (
__IPV4_DEVCONF_MAX
 - 1)

	)

	@/usr/include/linux/netdevice.h

25 #iâdeà
_LINUX_NETDEVICE_H


26 
	#_LINUX_NETDEVICE_H


	)

28 
	~<lšux/if.h
>

29 
	~<lšux/if_‘h”.h
>

30 
	~<lšux/if_·ck‘.h
>

31 
	~<lšux/if_lšk.h
>

34 
	#MAX_ADDR_LEN
 32

	)

37 
	#INIT_NETDEV_GROUP
 0

	)

41 
	#NET_NAME_UNKNOWN
 0

	)

42 
	#NET_NAME_ENUM
 1

	)

43 
	#NET_NAME_PREDICTABLE
 2

	)

44 
	#NET_NAME_USER
 3

	)

45 
	#NET_NAME_RENAMED
 4

	)

49 
	mIF_PORT_UNKNOWN
 = 0,

50 
	mIF_PORT_10BASE2
,

51 
	mIF_PORT_10BASET
,

52 
	mIF_PORT_AUI
,

53 
	mIF_PORT_100BASET
,

54 
	mIF_PORT_100BASETX
,

55 
	mIF_PORT_100BASEFX


59 
	#NET_ADDR_PERM
 0

	)

60 
	#NET_ADDR_RANDOM
 1

	)

61 
	#NET_ADDR_STOLEN
 2

	)

62 
	#NET_ADDR_SET
 3

	)

	@/usr/include/linux/poll.h

1 
	~<asm/pŞl.h
>

	@/usr/include/linux/route.h

23 #iâdeà
_LINUX_ROUTE_H


24 
	#_LINUX_ROUTE_H


	)

26 
	~<lšux/if.h
>

30 
	s¹’Œy
 {

31 
	m¹_·d1
;

32 
sockaddr
 
	m¹_d¡
;

33 
sockaddr
 
	m¹_g©eway
;

34 
sockaddr
 
	m¹_g’mask
;

35 
	m¹_æags
;

36 
	m¹_·d2
;

37 
	m¹_·d3
;

38 *
	m¹_·d4
;

39 
	m¹_m‘ric
;

40 *
	m¹_dev
;

41 
	m¹_mtu
;

42 
	#¹_mss
 
¹_mtu


	)

43 
	m¹_wšdow
;

44 
	m¹_œ‰
;

48 
	#RTF_UP
 0x0001

	)

49 
	#RTF_GATEWAY
 0x0002

	)

50 
	#RTF_HOST
 0x0004

	)

51 
	#RTF_REINSTATE
 0x0008

	)

52 
	#RTF_DYNAMIC
 0x0010

	)

53 
	#RTF_MODIFIED
 0x0020

	)

54 
	#RTF_MTU
 0x0040

	)

55 
	#RTF_MSS
 
RTF_MTU


	)

56 
	#RTF_WINDOW
 0x0080

	)

57 
	#RTF_IRTT
 0x0100

	)

58 
	#RTF_REJECT
 0x0200

	)

	@/usr/include/linux/rtnetlink.h

1 #iâdeà
__LINUX_RTNETLINK_H


2 
	#__LINUX_RTNETLINK_H


	)

4 
	~<lšux/ty³s.h
>

5 
	~<lšux/Ãšk.h
>

6 
	~<lšux/if_lšk.h
>

7 
	~<lšux/if_addr.h
>

8 
	~<lšux/Ãighbour.h
>

13 
	#RTNL_FAMILY_IPMR
 128

	)

14 
	#RTNL_FAMILY_IP6MR
 129

	)

15 
	#RTNL_FAMILY_MAX
 129

	)

24 
	mRTM_BASE
 = 16,

25 
	#RTM_BASE
 
RTM_BASE


	)

27 
	mRTM_NEWLINK
 = 16,

28 
	#RTM_NEWLINK
 
RTM_NEWLINK


	)

29 
	mRTM_DELLINK
,

30 
	#RTM_DELLINK
 
RTM_DELLINK


	)

31 
	mRTM_GETLINK
,

32 
	#RTM_GETLINK
 
RTM_GETLINK


	)

33 
	mRTM_SETLINK
,

34 
	#RTM_SETLINK
 
RTM_SETLINK


	)

36 
	mRTM_NEWADDR
 = 20,

37 
	#RTM_NEWADDR
 
RTM_NEWADDR


	)

38 
	mRTM_DELADDR
,

39 
	#RTM_DELADDR
 
RTM_DELADDR


	)

40 
	mRTM_GETADDR
,

41 
	#RTM_GETADDR
 
RTM_GETADDR


	)

43 
	mRTM_NEWROUTE
 = 24,

44 
	#RTM_NEWROUTE
 
RTM_NEWROUTE


	)

45 
	mRTM_DELROUTE
,

46 
	#RTM_DELROUTE
 
RTM_DELROUTE


	)

47 
	mRTM_GETROUTE
,

48 
	#RTM_GETROUTE
 
RTM_GETROUTE


	)

50 
	mRTM_NEWNEIGH
 = 28,

51 
	#RTM_NEWNEIGH
 
RTM_NEWNEIGH


	)

52 
	mRTM_DELNEIGH
,

53 
	#RTM_DELNEIGH
 
RTM_DELNEIGH


	)

54 
	mRTM_GETNEIGH
,

55 
	#RTM_GETNEIGH
 
RTM_GETNEIGH


	)

57 
	mRTM_NEWRULE
 = 32,

58 
	#RTM_NEWRULE
 
RTM_NEWRULE


	)

59 
	mRTM_DELRULE
,

60 
	#RTM_DELRULE
 
RTM_DELRULE


	)

61 
	mRTM_GETRULE
,

62 
	#RTM_GETRULE
 
RTM_GETRULE


	)

64 
	mRTM_NEWQDISC
 = 36,

65 
	#RTM_NEWQDISC
 
RTM_NEWQDISC


	)

66 
	mRTM_DELQDISC
,

67 
	#RTM_DELQDISC
 
RTM_DELQDISC


	)

68 
	mRTM_GETQDISC
,

69 
	#RTM_GETQDISC
 
RTM_GETQDISC


	)

71 
	mRTM_NEWTCLASS
 = 40,

72 
	#RTM_NEWTCLASS
 
RTM_NEWTCLASS


	)

73 
	mRTM_DELTCLASS
,

74 
	#RTM_DELTCLASS
 
RTM_DELTCLASS


	)

75 
	mRTM_GETTCLASS
,

76 
	#RTM_GETTCLASS
 
RTM_GETTCLASS


	)

78 
	mRTM_NEWTFILTER
 = 44,

79 
	#RTM_NEWTFILTER
 
RTM_NEWTFILTER


	)

80 
	mRTM_DELTFILTER
,

81 
	#RTM_DELTFILTER
 
RTM_DELTFILTER


	)

82 
	mRTM_GETTFILTER
,

83 
	#RTM_GETTFILTER
 
RTM_GETTFILTER


	)

85 
	mRTM_NEWACTION
 = 48,

86 
	#RTM_NEWACTION
 
RTM_NEWACTION


	)

87 
	mRTM_DELACTION
,

88 
	#RTM_DELACTION
 
RTM_DELACTION


	)

89 
	mRTM_GETACTION
,

90 
	#RTM_GETACTION
 
RTM_GETACTION


	)

92 
	mRTM_NEWPREFIX
 = 52,

93 
	#RTM_NEWPREFIX
 
RTM_NEWPREFIX


	)

95 
	mRTM_GETMULTICAST
 = 58,

96 
	#RTM_GETMULTICAST
 
RTM_GETMULTICAST


	)

98 
	mRTM_GETANYCAST
 = 62,

99 
	#RTM_GETANYCAST
 
RTM_GETANYCAST


	)

101 
	mRTM_NEWNEIGHTBL
 = 64,

102 
	#RTM_NEWNEIGHTBL
 
RTM_NEWNEIGHTBL


	)

103 
	mRTM_GETNEIGHTBL
 = 66,

104 
	#RTM_GETNEIGHTBL
 
RTM_GETNEIGHTBL


	)

105 
	mRTM_SETNEIGHTBL
,

106 
	#RTM_SETNEIGHTBL
 
RTM_SETNEIGHTBL


	)

108 
	mRTM_NEWNDUSEROPT
 = 68,

109 
	#RTM_NEWNDUSEROPT
 
RTM_NEWNDUSEROPT


	)

111 
	mRTM_NEWADDRLABEL
 = 72,

112 
	#RTM_NEWADDRLABEL
 
RTM_NEWADDRLABEL


	)

113 
	mRTM_DELADDRLABEL
,

114 
	#RTM_DELADDRLABEL
 
RTM_DELADDRLABEL


	)

115 
	mRTM_GETADDRLABEL
,

116 
	#RTM_GETADDRLABEL
 
RTM_GETADDRLABEL


	)

118 
	mRTM_GETDCB
 = 78,

119 
	#RTM_GETDCB
 
RTM_GETDCB


	)

120 
	mRTM_SETDCB
,

121 
	#RTM_SETDCB
 
RTM_SETDCB


	)

123 
	mRTM_NEWNETCONF
 = 80,

124 
	#RTM_NEWNETCONF
 
RTM_NEWNETCONF


	)

125 
	mRTM_GETNETCONF
 = 82,

126 
	#RTM_GETNETCONF
 
RTM_GETNETCONF


	)

128 
	mRTM_NEWMDB
 = 84,

129 
	#RTM_NEWMDB
 
RTM_NEWMDB


	)

130 
	mRTM_DELMDB
 = 85,

131 
	#RTM_DELMDB
 
RTM_DELMDB


	)

132 
	mRTM_GETMDB
 = 86,

133 
	#RTM_GETMDB
 
RTM_GETMDB


	)

135 
	mRTM_NEWNSID
 = 88,

136 
	#RTM_NEWNSID
 
RTM_NEWNSID


	)

137 
	mRTM_DELNSID
 = 89,

138 
	#RTM_DELNSID
 
RTM_DELNSID


	)

139 
	mRTM_GETNSID
 = 90,

140 
	#RTM_GETNSID
 
RTM_GETNSID


	)

142 
	mRTM_NEWSTATS
 = 92,

143 
	#RTM_NEWSTATS
 
RTM_NEWSTATS


	)

144 
	mRTM_GETSTATS
 = 94,

145 
	#RTM_GETSTATS
 
RTM_GETSTATS


	)

147 
	m__RTM_MAX
,

148 
	#RTM_MAX
 (((
__RTM_MAX
 + 3è& ~3è- 1)

	)

151 
	#RTM_NR_MSGTYPES
 (
RTM_MAX
 + 1 - 
RTM_BASE
)

	)

152 
	#RTM_NR_FAMILIES
 (
RTM_NR_MSGTYPES
 >> 2)

	)

153 
	#RTM_FAM
(
cmd
è(((cmdè- 
RTM_BASE
è>> 2)

	)

161 
	s¹©Œ
 {

162 
	m¹a_Ën
;

163 
	m¹a_ty³
;

168 
	#RTA_ALIGNTO
 4U

	)

169 
	#RTA_ALIGN
(
Ën
èĞ(Ö’)+
RTA_ALIGNTO
-1è& ~(RTA_ALIGNTO-1è)

	)

170 
	#RTA_OK
(
¹a
,
Ën
è(Ö’è>ğ()(
¹©Œ
) && \

171 (
¹a
)->
¹a_Ën
 >ğ(
¹©Œ
) && \

172 (
¹a
)->
¹a_Ën
 <ğ(
Ën
))

	)

173 
	#RTA_NEXT
(
¹a
,
©ŒËn
è(×‰¾’è-ğ
	`RTA_ALIGN
(Ô)->
¹a_Ën
), \

174 (
¹©Œ
*)(((*)(
¹a
)è+ 
	`RTA_ALIGN
(Ô)->
¹a_Ën
)))

	)

175 
	#RTA_LENGTH
(
Ën
è(
	`RTA_ALIGN
((
¹©Œ
)è+ (Ën))

	)

176 
	#RTA_SPACE
(
Ën
è
	`RTA_ALIGN
(
	`RTA_LENGTH
Ö’))

	)

177 
	#RTA_DATA
(
¹a
è((*)(((*)Ô)è+ 
	`RTA_LENGTH
(0)))

	)

178 
	#RTA_PAYLOAD
(
¹a
è(()(Ô)->
¹a_Ën
è- 
	`RTA_LENGTH
(0))

	)

187 
	s¹msg
 {

188 
	m¹m_çmy
;

189 
	m¹m_d¡_Ën
;

190 
	m¹m_¤c_Ën
;

191 
	m¹m_tos
;

193 
	m¹m_bË
;

194 
	m¹m_´ÙocŞ
;

195 
	m¹m_scİe
;

196 
	m¹m_ty³
;

198 
	m¹m_æags
;

204 
	mRTN_UNSPEC
,

205 
	mRTN_UNICAST
,

206 
	mRTN_LOCAL
,

207 
	mRTN_BROADCAST
,

209 
	mRTN_ANYCAST
,

211 
	mRTN_MULTICAST
,

212 
	mRTN_BLACKHOLE
,

213 
	mRTN_UNREACHABLE
,

214 
	mRTN_PROHIBIT
,

215 
	mRTN_THROW
,

216 
	mRTN_NAT
,

217 
	mRTN_XRESOLVE
,

218 
	m__RTN_MAX


221 
	#RTN_MAX
 (
__RTN_MAX
 - 1)

	)

226 
	#RTPROT_UNSPEC
 0

	)

227 
	#RTPROT_REDIRECT
 1

	)

229 
	#RTPROT_KERNEL
 2

	)

230 
	#RTPROT_BOOT
 3

	)

231 
	#RTPROT_STATIC
 4

	)

240 
	#RTPROT_GATED
 8

	)

241 
	#RTPROT_RA
 9

	)

242 
	#RTPROT_MRT
 10

	)

243 
	#RTPROT_ZEBRA
 11

	)

244 
	#RTPROT_BIRD
 12

	)

245 
	#RTPROT_DNROUTED
 13

	)

246 
	#RTPROT_XORP
 14

	)

247 
	#RTPROT_NTK
 15

	)

248 
	#RTPROT_DHCP
 16

	)

249 
	#RTPROT_MROUTED
 17

	)

250 
	#RTPROT_BABEL
 42

	)

263 
	e¹_scİe_t
 {

264 
	mRT_SCOPE_UNIVERSE
=0,

266 
	mRT_SCOPE_SITE
=200,

267 
	mRT_SCOPE_LINK
=253,

268 
	mRT_SCOPE_HOST
=254,

269 
	mRT_SCOPE_NOWHERE
=255

274 
	#RTM_F_NOTIFY
 0x100

	)

275 
	#RTM_F_CLONED
 0x200

	)

276 
	#RTM_F_EQUALIZE
 0x400

	)

277 
	#RTM_F_PREFIX
 0x800

	)

278 
	#RTM_F_LOOKUP_TABLE
 0x1000

	)

282 
	e¹_şass_t
 {

283 
	mRT_TABLE_UNSPEC
=0,

285 
	mRT_TABLE_COMPAT
=252,

286 
	mRT_TABLE_DEFAULT
=253,

287 
	mRT_TABLE_MAIN
=254,

288 
	mRT_TABLE_LOCAL
=255,

289 
	mRT_TABLE_MAX
=0xFFFFFFFF

295 
	e¹©Œ_ty³_t
 {

296 
	mRTA_UNSPEC
,

297 
	mRTA_DST
,

298 
	mRTA_SRC
,

299 
	mRTA_IIF
,

300 
	mRTA_OIF
,

301 
	mRTA_GATEWAY
,

302 
	mRTA_PRIORITY
,

303 
	mRTA_PREFSRC
,

304 
	mRTA_METRICS
,

305 
	mRTA_MULTIPATH
,

306 
	mRTA_PROTOINFO
,

307 
	mRTA_FLOW
,

308 
	mRTA_CACHEINFO
,

309 
	mRTA_SESSION
,

310 
	mRTA_MP_ALGO
,

311 
	mRTA_TABLE
,

312 
	mRTA_MARK
,

313 
	mRTA_MFC_STATS
,

314 
	mRTA_VIA
,

315 
	mRTA_NEWDST
,

316 
	mRTA_PREF
,

317 
	mRTA_ENCAP_TYPE
,

318 
	mRTA_ENCAP
,

319 
	mRTA_EXPIRES
,

320 
	mRTA_PAD
,

321 
	m__RTA_MAX


324 
	#RTA_MAX
 (
__RTA_MAX
 - 1)

	)

326 
	#RTM_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
¹msg
))))

	)

327 
	#RTM_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
¹msg
))

	)

338 
	s¹Ãxthİ
 {

339 
	m¹nh_Ën
;

340 
	m¹nh_æags
;

341 
	m¹nh_hİs
;

342 
	m¹nh_ifšdex
;

347 
	#RTNH_F_DEAD
 1

	)

348 
	#RTNH_F_PERVASIVE
 2

	)

349 
	#RTNH_F_ONLINK
 4

	)

350 
	#RTNH_F_OFFLOAD
 8

	)

351 
	#RTNH_F_LINKDOWN
 16

	)

353 
	#RTNH_COMPARE_MASK
 (
RTNH_F_DEAD
 | 
RTNH_F_LINKDOWN
 | 
RTNH_F_OFFLOAD
)

	)

357 
	#RTNH_ALIGNTO
 4

	)

358 
	#RTNH_ALIGN
(
Ën
èĞ(Ö’)+
RTNH_ALIGNTO
-1è& ~(RTNH_ALIGNTO-1è)

	)

359 
	#RTNH_OK
(
¹nh
,
Ën
è(ÔŠh)->
¹nh_Ën
 >ğ(
¹Ãxthİ
) && \

360 (()(
¹nh
)->
¹nh_Ën
è<ğ(
Ën
))

	)

361 
	#RTNH_NEXT
(
¹nh
è((
¹Ãxthİ
*)(((*)ÔŠh)è+ 
	`RTNH_ALIGN
(ÔŠh)->
¹nh_Ën
)))

	)

362 
	#RTNH_LENGTH
(
Ën
è(
	`RTNH_ALIGN
((
¹Ãxthİ
)è+ (Ën))

	)

363 
	#RTNH_SPACE
(
Ën
è
	`RTNH_ALIGN
(
	`RTNH_LENGTH
Ö’))

	)

364 
	#RTNH_DATA
(
¹nh
è((
¹©Œ
*)(((*)ÔŠh)è+ 
	`RTNH_LENGTH
(0)))

	)

367 
	s¹vŸ
 {

368 
__k”Ãl_§_çmy_t
 
	m¹vŸ_çmy
;

369 
__u8
 
	m¹vŸ_addr
[0];

374 
	s¹a_ÿchešfo
 {

375 
__u32
 
	m¹a_şÁ»f
;

376 
__u32
 
	m¹a_Ï¡u£
;

377 
__s32
 
	m¹a_expœes
;

378 
__u32
 
	m¹a_”rÜ
;

379 
__u32
 
	m¹a_u£d
;

381 
	#RTNETLINK_HAVE_PEERINFO
 1

	)

382 
__u32
 
	m¹a_id
;

383 
__u32
 
	m¹a_ts
;

384 
__u32
 
	m¹a_t§ge
;

390 
	mRTAX_UNSPEC
,

391 
	#RTAX_UNSPEC
 
RTAX_UNSPEC


	)

392 
	mRTAX_LOCK
,

393 
	#RTAX_LOCK
 
RTAX_LOCK


	)

394 
	mRTAX_MTU
,

395 
	#RTAX_MTU
 
RTAX_MTU


	)

396 
	mRTAX_WINDOW
,

397 
	#RTAX_WINDOW
 
RTAX_WINDOW


	)

398 
	mRTAX_RTT
,

399 
	#RTAX_RTT
 
RTAX_RTT


	)

400 
	mRTAX_RTTVAR
,

401 
	#RTAX_RTTVAR
 
RTAX_RTTVAR


	)

402 
	mRTAX_SSTHRESH
,

403 
	#RTAX_SSTHRESH
 
RTAX_SSTHRESH


	)

404 
	mRTAX_CWND
,

405 
	#RTAX_CWND
 
RTAX_CWND


	)

406 
	mRTAX_ADVMSS
,

407 
	#RTAX_ADVMSS
 
RTAX_ADVMSS


	)

408 
	mRTAX_REORDERING
,

409 
	#RTAX_REORDERING
 
RTAX_REORDERING


	)

410 
	mRTAX_HOPLIMIT
,

411 
	#RTAX_HOPLIMIT
 
RTAX_HOPLIMIT


	)

412 
	mRTAX_INITCWND
,

413 
	#RTAX_INITCWND
 
RTAX_INITCWND


	)

414 
	mRTAX_FEATURES
,

415 
	#RTAX_FEATURES
 
RTAX_FEATURES


	)

416 
	mRTAX_RTO_MIN
,

417 
	#RTAX_RTO_MIN
 
RTAX_RTO_MIN


	)

418 
	mRTAX_INITRWND
,

419 
	#RTAX_INITRWND
 
RTAX_INITRWND


	)

420 
	mRTAX_QUICKACK
,

421 
	#RTAX_QUICKACK
 
RTAX_QUICKACK


	)

422 
	mRTAX_CC_ALGO
,

423 
	#RTAX_CC_ALGO
 
RTAX_CC_ALGO


	)

424 
	m__RTAX_MAX


427 
	#RTAX_MAX
 (
__RTAX_MAX
 - 1)

	)

429 
	#RTAX_FEATURE_ECN
 (1 << 0)

	)

430 
	#RTAX_FEATURE_SACK
 (1 << 1)

	)

431 
	#RTAX_FEATURE_TIMESTAMP
 (1 << 2)

	)

432 
	#RTAX_FEATURE_ALLFRAG
 (1 << 3)

	)

434 
	#RTAX_FEATURE_MASK
 (
RTAX_FEATURE_ECN
 | 
RTAX_FEATURE_SACK
 | \

435 
RTAX_FEATURE_TIMESTAMP
 | 
RTAX_FEATURE_ALLFRAG
)

	)

437 
	s¹a_£ssiÚ
 {

438 
__u8
 
	m´Ùo
;

439 
__u8
 
	m·d1
;

440 
__u16
 
	m·d2
;

444 
__u16
 
	m¥Üt
;

445 
__u16
 
	mdpÜt
;

446 } 
	mpÜts
;

449 
__u8
 
	mty³
;

450 
__u8
 
	mcode
;

451 
__u16
 
	mid’t
;

452 } 
	micm±
;

454 
__u32
 
	m¥i
;

455 } 
	mu
;

458 
	s¹a_mfc_¡©s
 {

459 
__u64
 
	mmfcs_·ck‘s
;

460 
__u64
 
	mmfcs_by‹s
;

461 
__u64
 
	mmfcs_wrÚg_if
;

468 
	s¹g’msg
 {

469 
	m¹g’_çmy
;

481 
	sifšfomsg
 {

482 
	mifi_çmy
;

483 
	m__ifi_·d
;

484 
	mifi_ty³
;

485 
	mifi_šdex
;

486 
	mifi_æags
;

487 
	mifi_chªge
;

494 
	s´efixmsg
 {

495 
	m´efix_çmy
;

496 
	m´efix_·d1
;

497 
	m´efix_·d2
;

498 
	m´efix_ifšdex
;

499 
	m´efix_ty³
;

500 
	m´efix_Ën
;

501 
	m´efix_æags
;

502 
	m´efix_·d3
;

507 
	mPREFIX_UNSPEC
,

508 
	mPREFIX_ADDRESS
,

509 
	mPREFIX_CACHEINFO
,

510 
	m__PREFIX_MAX


513 
	#PREFIX_MAX
 (
__PREFIX_MAX
 - 1)

	)

515 
	s´efix_ÿchešfo
 {

516 
__u32
 
	m´eã¼ed_time
;

517 
__u32
 
	mv®id_time
;

525 
	stcmsg
 {

526 
	mtcm_çmy
;

527 
	mtcm__·d1
;

528 
	mtcm__·d2
;

529 
	mtcm_ifšdex
;

530 
__u32
 
	mtcm_hªdË
;

531 
__u32
 
	mtcm_·»Á
;

532 
__u32
 
	mtcm_šfo
;

536 
	mTCA_UNSPEC
,

537 
	mTCA_KIND
,

538 
	mTCA_OPTIONS
,

539 
	mTCA_STATS
,

540 
	mTCA_XSTATS
,

541 
	mTCA_RATE
,

542 
	mTCA_FCNT
,

543 
	mTCA_STATS2
,

544 
	mTCA_STAB
,

545 
	mTCA_PAD
,

546 
	m__TCA_MAX


549 
	#TCA_MAX
 (
__TCA_MAX
 - 1)

	)

551 
	#TCA_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
tcmsg
))))

	)

552 
	#TCA_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
tcmsg
))

	)

558 
	sndu£rİtmsg
 {

559 
	mndu£rİt_çmy
;

560 
	mndu£rİt_·d1
;

561 
	mndu£rİt_İts_Ën
;

562 
	mndu£rİt_ifšdex
;

563 
__u8
 
	mndu£rİt_icmp_ty³
;

564 
__u8
 
	mndu£rİt_icmp_code
;

565 
	mndu£rİt_·d2
;

566 
	mndu£rİt_·d3
;

571 
	mNDUSEROPT_UNSPEC
,

572 
	mNDUSEROPT_SRCADDR
,

573 
	m__NDUSEROPT_MAX


576 
	#NDUSEROPT_MAX
 (
__NDUSEROPT_MAX
 - 1)

	)

579 
	#RTMGRP_LINK
 1

	)

580 
	#RTMGRP_NOTIFY
 2

	)

581 
	#RTMGRP_NEIGH
 4

	)

582 
	#RTMGRP_TC
 8

	)

584 
	#RTMGRP_IPV4_IFADDR
 0x10

	)

585 
	#RTMGRP_IPV4_MROUTE
 0x20

	)

586 
	#RTMGRP_IPV4_ROUTE
 0x40

	)

587 
	#RTMGRP_IPV4_RULE
 0x80

	)

589 
	#RTMGRP_IPV6_IFADDR
 0x100

	)

590 
	#RTMGRP_IPV6_MROUTE
 0x200

	)

591 
	#RTMGRP_IPV6_ROUTE
 0x400

	)

592 
	#RTMGRP_IPV6_IFINFO
 0x800

	)

594 
	#RTMGRP_DECÃt_IFADDR
 0x1000

	)

595 
	#RTMGRP_DECÃt_ROUTE
 0x4000

	)

597 
	#RTMGRP_IPV6_PREFIX
 0x20000

	)

600 
	e¹Ãšk_groups
 {

601 
	mRTNLGRP_NONE
,

602 
	#RTNLGRP_NONE
 
RTNLGRP_NONE


	)

603 
	mRTNLGRP_LINK
,

604 
	#RTNLGRP_LINK
 
RTNLGRP_LINK


	)

605 
	mRTNLGRP_NOTIFY
,

606 
	#RTNLGRP_NOTIFY
 
RTNLGRP_NOTIFY


	)

607 
	mRTNLGRP_NEIGH
,

608 
	#RTNLGRP_NEIGH
 
RTNLGRP_NEIGH


	)

609 
	mRTNLGRP_TC
,

610 
	#RTNLGRP_TC
 
RTNLGRP_TC


	)

611 
	mRTNLGRP_IPV4_IFADDR
,

612 
	#RTNLGRP_IPV4_IFADDR
 
RTNLGRP_IPV4_IFADDR


	)

613 
	mRTNLGRP_IPV4_MROUTE
,

614 
	#RTNLGRP_IPV4_MROUTE
 
RTNLGRP_IPV4_MROUTE


	)

615 
	mRTNLGRP_IPV4_ROUTE
,

616 
	#RTNLGRP_IPV4_ROUTE
 
RTNLGRP_IPV4_ROUTE


	)

617 
	mRTNLGRP_IPV4_RULE
,

618 
	#RTNLGRP_IPV4_RULE
 
RTNLGRP_IPV4_RULE


	)

619 
	mRTNLGRP_IPV6_IFADDR
,

620 
	#RTNLGRP_IPV6_IFADDR
 
RTNLGRP_IPV6_IFADDR


	)

621 
	mRTNLGRP_IPV6_MROUTE
,

622 
	#RTNLGRP_IPV6_MROUTE
 
RTNLGRP_IPV6_MROUTE


	)

623 
	mRTNLGRP_IPV6_ROUTE
,

624 
	#RTNLGRP_IPV6_ROUTE
 
RTNLGRP_IPV6_ROUTE


	)

625 
	mRTNLGRP_IPV6_IFINFO
,

626 
	#RTNLGRP_IPV6_IFINFO
 
RTNLGRP_IPV6_IFINFO


	)

627 
	mRTNLGRP_DECÃt_IFADDR
,

628 
	#RTNLGRP_DECÃt_IFADDR
 
RTNLGRP_DECÃt_IFADDR


	)

629 
	mRTNLGRP_NOP2
,

630 
	mRTNLGRP_DECÃt_ROUTE
,

631 
	#RTNLGRP_DECÃt_ROUTE
 
RTNLGRP_DECÃt_ROUTE


	)

632 
	mRTNLGRP_DECÃt_RULE
,

633 
	#RTNLGRP_DECÃt_RULE
 
RTNLGRP_DECÃt_RULE


	)

634 
	mRTNLGRP_NOP4
,

635 
	mRTNLGRP_IPV6_PREFIX
,

636 
	#RTNLGRP_IPV6_PREFIX
 
RTNLGRP_IPV6_PREFIX


	)

637 
	mRTNLGRP_IPV6_RULE
,

638 
	#RTNLGRP_IPV6_RULE
 
RTNLGRP_IPV6_RULE


	)

639 
	mRTNLGRP_ND_USEROPT
,

640 
	#RTNLGRP_ND_USEROPT
 
RTNLGRP_ND_USEROPT


	)

641 
	mRTNLGRP_PHONET_IFADDR
,

642 
	#RTNLGRP_PHONET_IFADDR
 
RTNLGRP_PHONET_IFADDR


	)

643 
	mRTNLGRP_PHONET_ROUTE
,

644 
	#RTNLGRP_PHONET_ROUTE
 
RTNLGRP_PHONET_ROUTE


	)

645 
	mRTNLGRP_DCB
,

646 
	#RTNLGRP_DCB
 
RTNLGRP_DCB


	)

647 
	mRTNLGRP_IPV4_NETCONF
,

648 
	#RTNLGRP_IPV4_NETCONF
 
RTNLGRP_IPV4_NETCONF


	)

649 
	mRTNLGRP_IPV6_NETCONF
,

650 
	#RTNLGRP_IPV6_NETCONF
 
RTNLGRP_IPV6_NETCONF


	)

651 
	mRTNLGRP_MDB
,

652 
	#RTNLGRP_MDB
 
RTNLGRP_MDB


	)

653 
	mRTNLGRP_MPLS_ROUTE
,

654 
	#RTNLGRP_MPLS_ROUTE
 
RTNLGRP_MPLS_ROUTE


	)

655 
	mRTNLGRP_NSID
,

656 
	#RTNLGRP_NSID
 
RTNLGRP_NSID


	)

657 
	m__RTNLGRP_MAX


659 
	#RTNLGRP_MAX
 (
__RTNLGRP_MAX
 - 1)

	)

662 
	stÿmsg
 {

663 
	mtÿ_çmy
;

664 
	mtÿ__·d1
;

665 
	mtÿ__·d2
;

667 
	#TA_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
tÿmsg
))))

	)

668 
	#TA_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
tÿmsg
))

	)

669 
	#TCA_ACT_TAB
 1

	)

670 
	#TCAA_MAX
 1

	)

673 
	#RTEXT_FILTER_VF
 (1 << 0)

	)

674 
	#RTEXT_FILTER_BRVLAN
 (1 << 1)

	)

675 
	#RTEXT_FILTER_BRVLAN_COMPRESSED
 (1 << 2)

	)

676 
	#RTEXT_FILTER_SKIP_STATS
 (1 << 3)

	)

	@/usr/include/linux/sched.h

1 #iâdeà
_LINUX_SCHED_H


2 
	#_LINUX_SCHED_H


	)

7 
	#CSIGNAL
 0x000000fà

	)

8 
	#CLONE_VM
 0x00000100

	)

9 
	#CLONE_FS
 0x00000200

	)

10 
	#CLONE_FILES
 0x00000400

	)

11 
	#CLONE_SIGHAND
 0x00000800

	)

12 
	#CLONE_PTRACE
 0x00002000

	)

13 
	#CLONE_VFORK
 0x00004000

	)

14 
	#CLONE_PARENT
 0x00008000

	)

15 
	#CLONE_THREAD
 0x00010000

	)

16 
	#CLONE_NEWNS
 0x00020000

	)

17 
	#CLONE_SYSVSEM
 0x00040000

	)

18 
	#CLONE_SETTLS
 0x00080000

	)

19 
	#CLONE_PARENT_SETTID
 0x00100000

	)

20 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

21 
	#CLONE_DETACHED
 0x00400000

	)

22 
	#CLONE_UNTRACED
 0x00800000

	)

23 
	#CLONE_CHILD_SETTID
 0x01000000

	)

24 
	#CLONE_NEWCGROUP
 0x02000000

	)

25 
	#CLONE_NEWUTS
 0x04000000

	)

26 
	#CLONE_NEWIPC
 0x08000000

	)

27 
	#CLONE_NEWUSER
 0x10000000

	)

28 
	#CLONE_NEWPID
 0x20000000

	)

29 
	#CLONE_NEWNET
 0x40000000

	)

30 
	#CLONE_IO
 0x80000000

	)

35 
	#SCHED_NORMAL
 0

	)

36 
	#SCHED_FIFO
 1

	)

37 
	#SCHED_RR
 2

	)

38 
	#SCHED_BATCH
 3

	)

40 
	#SCHED_IDLE
 5

	)

41 
	#SCHED_DEADLINE
 6

	)

44 
	#SCHED_RESET_ON_FORK
 0x40000000

	)

49 
	#SCHED_FLAG_RESET_ON_FORK
 0x01

	)

	@/usr/include/linux/types.h

1 #iâdeà
_LINUX_TYPES_H


2 
	#_LINUX_TYPES_H


	)

4 
	~<asm/ty³s.h
>

6 #iâdeà
__ASSEMBLY__


8 
	~<lšux/posix_ty³s.h
>

16 #ifdeà
__CHECKER__


17 
	#__b™wi£__
 
	`__©Œibu‹__
((
b™wi£
))

	)

19 
	#__b™wi£__


	)

21 #ifdeà
__CHECK_ENDIAN__


22 
	#__b™wi£
 
__b™wi£__


	)

24 
	#__b™wi£


	)

27 
__u16
 
	t__b™wi£
 
	t__Ë16
;

28 
__u16
 
	t__b™wi£
 
	t__be16
;

29 
__u32
 
	t__b™wi£
 
	t__Ë32
;

30 
__u32
 
	t__b™wi£
 
	t__be32
;

31 
__u64
 
	t__b™wi£
 
	t__Ë64
;

32 
__u64
 
	t__b™wi£
 
	t__be64
;

34 
__u16
 
	t__b™wi£
 
	t__sum16
;

35 
__u32
 
	t__b™wi£
 
	t__wsum
;

46 
	#__®igÃd_u64
 
__u64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

47 
	#__®igÃd_be64
 
__be64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

48 
	#__®igÃd_Ë64
 
__Ë64
 
	`__©Œibu‹__
((
	`®igÃd
(8)))

	)

	@/usr/include/linux/wait.h

1 #iâdeà
_LINUX_WAIT_H


2 
	#_LINUX_WAIT_H


	)

4 
	#WNOHANG
 0x00000001

	)

5 
	#WUNTRACED
 0x00000002

	)

6 
	#WSTOPPED
 
WUNTRACED


	)

7 
	#WEXITED
 0x00000004

	)

8 
	#WCONTINUED
 0x00000008

	)

9 
	#WNOWAIT
 0x01000000

	)

11 
	#__WNOTHREAD
 0x20000000

	)

12 
	#__WALL
 0x40000000

	)

13 
	#__WCLONE
 0x80000000

	)

16 
	#P_ALL
 0

	)

17 
	#P_PID
 1

	)

18 
	#P_PGID
 2

	)

	@/usr/include/linux/wireless.h

10 #iâdeà
_LINUX_WIRELESS_H


11 
	#_LINUX_WIRELESS_H


	)

72 
	~<lšux/ty³s.h
>

73 
	~<lšux/sock‘.h
>

74 
	~<lšux/if.h
>

83 
	#WIRELESS_EXT
 22

	)

230 
	#SIOCSIWCOMMIT
 0x8B00

	)

231 
	#SIOCGIWNAME
 0x8B01

	)

237 
	#SIOCSIWNWID
 0x8B02

	)

238 
	#SIOCGIWNWID
 0x8B03

	)

239 
	#SIOCSIWFREQ
 0x8B04

	)

240 
	#SIOCGIWFREQ
 0x8B05

	)

241 
	#SIOCSIWMODE
 0x8B06

	)

242 
	#SIOCGIWMODE
 0x8B07

	)

243 
	#SIOCSIWSENS
 0x8B08

	)

244 
	#SIOCGIWSENS
 0x8B09

	)

247 
	#SIOCSIWRANGE
 0x8B0A

	)

248 
	#SIOCGIWRANGE
 0x8B0B

	)

249 
	#SIOCSIWPRIV
 0x8B0C

	)

250 
	#SIOCGIWPRIV
 0x8B0D

	)

251 
	#SIOCSIWSTATS
 0x8B0E

	)

252 
	#SIOCGIWSTATS
 0x8B0F

	)

257 
	#SIOCSIWSPY
 0x8B10

	)

258 
	#SIOCGIWSPY
 0x8B11

	)

259 
	#SIOCSIWTHRSPY
 0x8B12

	)

260 
	#SIOCGIWTHRSPY
 0x8B13

	)

263 
	#SIOCSIWAP
 0x8B14

	)

264 
	#SIOCGIWAP
 0x8B15

	)

265 
	#SIOCGIWAPLIST
 0x8B17

	)

266 
	#SIOCSIWSCAN
 0x8B18

	)

267 
	#SIOCGIWSCAN
 0x8B19

	)

270 
	#SIOCSIWESSID
 0x8B1A

	)

271 
	#SIOCGIWESSID
 0x8B1B

	)

272 
	#SIOCSIWNICKN
 0x8B1C

	)

273 
	#SIOCGIWNICKN
 0x8B1D

	)

279 
	#SIOCSIWRATE
 0x8B20

	)

280 
	#SIOCGIWRATE
 0x8B21

	)

281 
	#SIOCSIWRTS
 0x8B22

	)

282 
	#SIOCGIWRTS
 0x8B23

	)

283 
	#SIOCSIWFRAG
 0x8B24

	)

284 
	#SIOCGIWFRAG
 0x8B25

	)

285 
	#SIOCSIWTXPOW
 0x8B26

	)

286 
	#SIOCGIWTXPOW
 0x8B27

	)

287 
	#SIOCSIWRETRY
 0x8B28

	)

288 
	#SIOCGIWRETRY
 0x8B29

	)

291 
	#SIOCSIWENCODE
 0x8B2A

	)

292 
	#SIOCGIWENCODE
 0x8B2B

	)

294 
	#SIOCSIWPOWER
 0x8B2C

	)

295 
	#SIOCGIWPOWER
 0x8B2D

	)

304 
	#SIOCSIWGENIE
 0x8B30

	)

305 
	#SIOCGIWGENIE
 0x8B31

	)

308 
	#SIOCSIWMLME
 0x8B16

	)

311 
	#SIOCSIWAUTH
 0x8B32

	)

312 
	#SIOCGIWAUTH
 0x8B33

	)

315 
	#SIOCSIWENCODEEXT
 0x8B34

	)

316 
	#SIOCGIWENCODEEXT
 0x8B35

	)

319 
	#SIOCSIWPMKSA
 0x8B36

	)

330 
	#SIOCIWFIRSTPRIV
 0x8BE0

	)

331 
	#SIOCIWLASTPRIV
 0x8BFF

	)

346 
	#SIOCIWFIRST
 0x8B00

	)

347 
	#SIOCIWLAST
 
SIOCIWLASTPRIV


	)

348 
	#IW_IOCTL_IDX
(
cmd
è((cmdè- 
SIOCIWFIRST
)

	)

349 
	#IW_HANDLER
(
id
, 
func
) \

350 [
	`IW_IOCTL_IDX
(
id
)] = 
func


	)

353 
	#IW_IS_SET
(
cmd
è(!((cmdè& 0x1))

	)

354 
	#IW_IS_GET
(
cmd
è((cmdè& 0x1)

	)

360 
	#IWEVTXDROP
 0x8C00

	)

361 
	#IWEVQUAL
 0x8C01

	)

362 
	#IWEVCUSTOM
 0x8C02

	)

363 
	#IWEVREGISTERED
 0x8C03

	)

364 
	#IWEVEXPIRED
 0x8C04

	)

365 
	#IWEVGENIE
 0x8C05

	)

371 
	#IWEVMICHAELMICFAILURE
 0x8C06

	)

374 
	#IWEVASSOCREQIE
 0x8C07

	)

383 
	#IWEVASSOCRESPIE
 0x8C08

	)

390 
	#IWEVPMKIDCAND
 0x8C09

	)

394 
	#IWEVFIRST
 0x8C00

	)

395 
	#IW_EVENT_IDX
(
cmd
è((cmdè- 
IWEVFIRST
)

	)

404 
	#IW_PRIV_TYPE_MASK
 0x7000

	)

405 
	#IW_PRIV_TYPE_NONE
 0x0000

	)

406 
	#IW_PRIV_TYPE_BYTE
 0x1000

	)

407 
	#IW_PRIV_TYPE_CHAR
 0x2000

	)

408 
	#IW_PRIV_TYPE_INT
 0x4000

	)

409 
	#IW_PRIV_TYPE_FLOAT
 0x5000

	)

410 
	#IW_PRIV_TYPE_ADDR
 0x6000

	)

412 
	#IW_PRIV_SIZE_FIXED
 0x0800

	)

414 
	#IW_PRIV_SIZE_MASK
 0x07FF

	)

424 
	#IW_MAX_FREQUENCIES
 32

	)

430 
	#IW_MAX_BITRATES
 32

	)

433 
	#IW_MAX_TXPOWER
 8

	)

438 
	#IW_MAX_SPY
 8

	)

442 
	#IW_MAX_AP
 64

	)

445 
	#IW_ESSID_MAX_SIZE
 32

	)

448 
	#IW_MODE_AUTO
 0

	)

449 
	#IW_MODE_ADHOC
 1

	)

450 
	#IW_MODE_INFRA
 2

	)

451 
	#IW_MODE_MASTER
 3

	)

452 
	#IW_MODE_REPEAT
 4

	)

453 
	#IW_MODE_SECOND
 5

	)

454 
	#IW_MODE_MONITOR
 6

	)

455 
	#IW_MODE_MESH
 7

	)

458 
	#IW_QUAL_QUAL_UPDATED
 0x01

	)

459 
	#IW_QUAL_LEVEL_UPDATED
 0x02

	)

460 
	#IW_QUAL_NOISE_UPDATED
 0x04

	)

461 
	#IW_QUAL_ALL_UPDATED
 0x07

	)

462 
	#IW_QUAL_DBM
 0x08

	)

463 
	#IW_QUAL_QUAL_INVALID
 0x10

	)

464 
	#IW_QUAL_LEVEL_INVALID
 0x20

	)

465 
	#IW_QUAL_NOISE_INVALID
 0x40

	)

466 
	#IW_QUAL_RCPI
 0x80

	)

467 
	#IW_QUAL_ALL_INVALID
 0x70

	)

470 
	#IW_FREQ_AUTO
 0x00

	)

471 
	#IW_FREQ_FIXED
 0x01

	)

475 
	#IW_MAX_ENCODING_SIZES
 8

	)

478 
	#IW_ENCODING_TOKEN_MAX
 64

	)

481 
	#IW_ENCODE_INDEX
 0x00FF

	)

482 
	#IW_ENCODE_FLAGS
 0xFF00

	)

483 
	#IW_ENCODE_MODE
 0xF000

	)

484 
	#IW_ENCODE_DISABLED
 0x8000

	)

485 
	#IW_ENCODE_ENABLED
 0x0000

	)

486 
	#IW_ENCODE_RESTRICTED
 0x4000

	)

487 
	#IW_ENCODE_OPEN
 0x2000

	)

488 
	#IW_ENCODE_NOKEY
 0x0800

	)

489 
	#IW_ENCODE_TEMP
 0x0400

	)

492 
	#IW_POWER_ON
 0x0000

	)

493 
	#IW_POWER_TYPE
 0xF000

	)

494 
	#IW_POWER_PERIOD
 0x1000

	)

495 
	#IW_POWER_TIMEOUT
 0x2000

	)

496 
	#IW_POWER_MODE
 0x0F00

	)

497 
	#IW_POWER_UNICAST_R
 0x0100

	)

498 
	#IW_POWER_MULTICAST_R
 0x0200

	)

499 
	#IW_POWER_ALL_R
 0x0300

	)

500 
	#IW_POWER_FORCE_S
 0x0400

	)

501 
	#IW_POWER_REPEATER
 0x0800

	)

502 
	#IW_POWER_MODIFIER
 0x000F

	)

503 
	#IW_POWER_MIN
 0x0001

	)

504 
	#IW_POWER_MAX
 0x0002

	)

505 
	#IW_POWER_RELATIVE
 0x0004

	)

508 
	#IW_TXPOW_TYPE
 0x00FF

	)

509 
	#IW_TXPOW_DBM
 0x0000

	)

510 
	#IW_TXPOW_MWATT
 0x0001

	)

511 
	#IW_TXPOW_RELATIVE
 0x0002

	)

512 
	#IW_TXPOW_RANGE
 0x1000

	)

515 
	#IW_RETRY_ON
 0x0000

	)

516 
	#IW_RETRY_TYPE
 0xF000

	)

517 
	#IW_RETRY_LIMIT
 0x1000

	)

518 
	#IW_RETRY_LIFETIME
 0x2000

	)

519 
	#IW_RETRY_MODIFIER
 0x00FF

	)

520 
	#IW_RETRY_MIN
 0x0001

	)

521 
	#IW_RETRY_MAX
 0x0002

	)

522 
	#IW_RETRY_RELATIVE
 0x0004

	)

523 
	#IW_RETRY_SHORT
 0x0010

	)

524 
	#IW_RETRY_LONG
 0x0020

	)

527 
	#IW_SCAN_DEFAULT
 0x0000

	)

528 
	#IW_SCAN_ALL_ESSID
 0x0001

	)

529 
	#IW_SCAN_THIS_ESSID
 0x0002

	)

530 
	#IW_SCAN_ALL_FREQ
 0x0004

	)

531 
	#IW_SCAN_THIS_FREQ
 0x0008

	)

532 
	#IW_SCAN_ALL_MODE
 0x0010

	)

533 
	#IW_SCAN_THIS_MODE
 0x0020

	)

534 
	#IW_SCAN_ALL_RATE
 0x0040

	)

535 
	#IW_SCAN_THIS_RATE
 0x0080

	)

537 
	#IW_SCAN_TYPE_ACTIVE
 0

	)

538 
	#IW_SCAN_TYPE_PASSIVE
 1

	)

540 
	#IW_SCAN_MAX_DATA
 4096

	)

543 
	#IW_SCAN_CAPA_NONE
 0x00

	)

544 
	#IW_SCAN_CAPA_ESSID
 0x01

	)

545 
	#IW_SCAN_CAPA_BSSID
 0x02

	)

546 
	#IW_SCAN_CAPA_CHANNEL
 0x04

	)

547 
	#IW_SCAN_CAPA_MODE
 0x08

	)

548 
	#IW_SCAN_CAPA_RATE
 0x10

	)

549 
	#IW_SCAN_CAPA_TYPE
 0x20

	)

550 
	#IW_SCAN_CAPA_TIME
 0x40

	)

553 
	#IW_CUSTOM_MAX
 256

	)

556 
	#IW_GENERIC_IE_MAX
 1024

	)

559 
	#IW_MLME_DEAUTH
 0

	)

560 
	#IW_MLME_DISASSOC
 1

	)

561 
	#IW_MLME_AUTH
 2

	)

562 
	#IW_MLME_ASSOC
 3

	)

565 
	#IW_AUTH_INDEX
 0x0FFF

	)

566 
	#IW_AUTH_FLAGS
 0xF000

	)

571 
	#IW_AUTH_WPA_VERSION
 0

	)

572 
	#IW_AUTH_CIPHER_PAIRWISE
 1

	)

573 
	#IW_AUTH_CIPHER_GROUP
 2

	)

574 
	#IW_AUTH_KEY_MGMT
 3

	)

575 
	#IW_AUTH_TKIP_COUNTERMEASURES
 4

	)

576 
	#IW_AUTH_DROP_UNENCRYPTED
 5

	)

577 
	#IW_AUTH_80211_AUTH_ALG
 6

	)

578 
	#IW_AUTH_WPA_ENABLED
 7

	)

579 
	#IW_AUTH_RX_UNENCRYPTED_EAPOL
 8

	)

580 
	#IW_AUTH_ROAMING_CONTROL
 9

	)

581 
	#IW_AUTH_PRIVACY_INVOKED
 10

	)

582 
	#IW_AUTH_CIPHER_GROUP_MGMT
 11

	)

583 
	#IW_AUTH_MFP
 12

	)

586 
	#IW_AUTH_WPA_VERSION_DISABLED
 0x00000001

	)

587 
	#IW_AUTH_WPA_VERSION_WPA
 0x00000002

	)

588 
	#IW_AUTH_WPA_VERSION_WPA2
 0x00000004

	)

592 
	#IW_AUTH_CIPHER_NONE
 0x00000001

	)

593 
	#IW_AUTH_CIPHER_WEP40
 0x00000002

	)

594 
	#IW_AUTH_CIPHER_TKIP
 0x00000004

	)

595 
	#IW_AUTH_CIPHER_CCMP
 0x00000008

	)

596 
	#IW_AUTH_CIPHER_WEP104
 0x00000010

	)

597 
	#IW_AUTH_CIPHER_AES_CMAC
 0x00000020

	)

600 
	#IW_AUTH_KEY_MGMT_802_1X
 1

	)

601 
	#IW_AUTH_KEY_MGMT_PSK
 2

	)

604 
	#IW_AUTH_ALG_OPEN_SYSTEM
 0x00000001

	)

605 
	#IW_AUTH_ALG_SHARED_KEY
 0x00000002

	)

606 
	#IW_AUTH_ALG_LEAP
 0x00000004

	)

609 
	#IW_AUTH_ROAMING_ENABLE
 0

	)

610 
	#IW_AUTH_ROAMING_DISABLE
 1

	)

614 
	#IW_AUTH_MFP_DISABLED
 0

	)

615 
	#IW_AUTH_MFP_OPTIONAL
 1

	)

616 
	#IW_AUTH_MFP_REQUIRED
 2

	)

619 
	#IW_ENCODE_SEQ_MAX_SIZE
 8

	)

621 
	#IW_ENCODE_ALG_NONE
 0

	)

622 
	#IW_ENCODE_ALG_WEP
 1

	)

623 
	#IW_ENCODE_ALG_TKIP
 2

	)

624 
	#IW_ENCODE_ALG_CCMP
 3

	)

625 
	#IW_ENCODE_ALG_PMK
 4

	)

626 
	#IW_ENCODE_ALG_AES_CMAC
 5

	)

628 
	#IW_ENCODE_EXT_TX_SEQ_VALID
 0x00000001

	)

629 
	#IW_ENCODE_EXT_RX_SEQ_VALID
 0x00000002

	)

630 
	#IW_ENCODE_EXT_GROUP_KEY
 0x00000004

	)

631 
	#IW_ENCODE_EXT_SET_TX_KEY
 0x00000008

	)

634 
	#IW_MICFAILURE_KEY_ID
 0x00000003

	)

635 
	#IW_MICFAILURE_GROUP
 0x00000004

	)

636 
	#IW_MICFAILURE_PAIRWISE
 0x00000008

	)

637 
	#IW_MICFAILURE_STAKEY
 0x00000010

	)

638 
	#IW_MICFAILURE_COUNT
 0x00000060

	)

642 
	#IW_ENC_CAPA_WPA
 0x00000001

	)

643 
	#IW_ENC_CAPA_WPA2
 0x00000002

	)

644 
	#IW_ENC_CAPA_CIPHER_TKIP
 0x00000004

	)

645 
	#IW_ENC_CAPA_CIPHER_CCMP
 0x00000008

	)

646 
	#IW_ENC_CAPA_4WAY_HANDSHAKE
 0x00000010

	)

651 
	#IW_EVENT_CAPA_BASE
(
cmd
è((cmd >ğ
SIOCIWFIRSTPRIV
) ? \

652 (
cmd
 - 
SIOCIWFIRSTPRIV
 + 0x60) : \

653 (
cmd
 - 
SIOCIWFIRST
))

	)

654 
	#IW_EVENT_CAPA_INDEX
(
cmd
è(
	`IW_EVENT_CAPA_BASE
(cmdè>> 5)

	)

655 
	#IW_EVENT_CAPA_MASK
(
cmd
è(1 << (
	`IW_EVENT_CAPA_BASE
(cmdè& 0x1F))

	)

658 
	#IW_EVENT_CAPA_K_0
 (
	`IW_EVENT_CAPA_MASK
(0x8B04) | \

659 
	`IW_EVENT_CAPA_MASK
(0x8B06) | \

660 
	`IW_EVENT_CAPA_MASK
(0x8B1A))

	)

661 
	#IW_EVENT_CAPA_K_1
 (
	`IW_EVENT_CAPA_MASK
(0x8B2A))

	)

663 
	#IW_EVENT_CAPA_SET
(
ev’t_ÿ·
, 
cmd
èÓv’t_ÿ·[
	`IW_EVENT_CAPA_INDEX
(cmd)] |ğ
	`IW_EVENT_CAPA_MASK
(cmd))

	)

664 
	#IW_EVENT_CAPA_SET_KERNEL
(
ev’t_ÿ·
è{ev’t_ÿ·[0] |ğ
IW_EVENT_CAPA_K_0
;ƒv’t_ÿ·[1] |ğ
IW_EVENT_CAPA_K_1
; }

	)

673 
	siw_·¿m
 {

674 
__s32
 
	mv®ue
;

675 
__u8
 
	mfixed
;

676 
__u8
 
	mdi§bËd
;

677 
__u16
 
	mæags
;

684 
	siw_pošt
 {

685 *
	mpoš‹r
;

686 
__u16
 
	mËngth
;

687 
__u16
 
	mæags
;

699 
	siw_äeq
 {

700 
__s32
 
	mm
;

701 
__s16
 
	me
;

702 
__u8
 
	mi
;

703 
__u8
 
	mæags
;

709 
	siw_qu®™y
 {

710 
__u8
 
	mqu®
;

712 
__u8
 
	mËv–
;

713 
__u8
 
	mnoi£
;

714 
__u8
 
	mupd©ed
;

724 
	siw_disÿrded
 {

725 
__u32
 
	mnwid
;

726 
__u32
 
	mcode
;

727 
__u32
 
	mäagm’t
;

728 
__u32
 
	m»Œ›s
;

729 
__u32
 
	mmisc
;

736 
	siw_mis£d
 {

737 
__u32
 
	mb—cÚ
;

743 
	siw_thr¥y
 {

744 
sockaddr
 
	maddr
;

745 
iw_qu®™y
 
	mqu®
;

746 
iw_qu®™y
 
	mlow
;

747 
iw_qu®™y
 
	mhigh
;

761 
	siw_sÿn_»q
 {

762 
__u8
 
	msÿn_ty³
;

763 
__u8
 
	messid_Ën
;

764 
__u8
 
	mnum_chªÃls
;

766 
__u8
 
	mæags
;

769 
sockaddr
 
	mbssid
;

778 
__u8
 
	messid
[
IW_ESSID_MAX_SIZE
];

790 
__u32
 
	mmš_chªÃl_time
;

791 
__u32
 
	mmax_chªÃl_time
;

793 
iw_äeq
 
	mchªÃl_li¡
[
IW_MAX_FREQUENCIES
];

822 
	siw_’code_ext
 {

823 
__u32
 
	mext_æags
;

824 
__u8
 
	mtx_£q
[
IW_ENCODE_SEQ_MAX_SIZE
];

825 
__u8
 
	mrx_£q
[
IW_ENCODE_SEQ_MAX_SIZE
];

826 
sockaddr
 
	maddr
;

829 
__u16
 
	m®g
;

830 
__u16
 
	mkey_Ën
;

831 
__u8
 
	mkey
[0];

835 
	siw_mlme
 {

836 
__u16
 
	mcmd
;

837 
__u16
 
	m»asÚ_code
;

838 
sockaddr
 
	maddr
;

842 
	#IW_PMKSA_ADD
 1

	)

843 
	#IW_PMKSA_REMOVE
 2

	)

844 
	#IW_PMKSA_FLUSH
 3

	)

846 
	#IW_PMKID_LEN
 16

	)

848 
	siw_pmk§
 {

849 
__u32
 
	mcmd
;

850 
sockaddr
 
	mbssid
;

851 
__u8
 
	mpmkid
[
IW_PMKID_LEN
];

855 
	siw_mich«lmicçu»
 {

856 
__u32
 
	mæags
;

857 
sockaddr
 
	m¤c_addr
;

858 
__u8
 
	mtsc
[
IW_ENCODE_SEQ_MAX_SIZE
];

862 
	#IW_PMKID_CAND_PREAUTH
 0x00000001

	)

863 
	siw_pmkid_ÿnd
 {

864 
__u32
 
	mæags
;

865 
__u32
 
	mšdex
;

867 
sockaddr
 
	mbssid
;

874 
	siw_¡©i¡ics
 {

875 
__u16
 
	m¡©us
;

878 
iw_qu®™y
 
	mqu®
;

880 
iw_disÿrded
 
	mdisÿrd
;

881 
iw_mis£d
 
	mmiss
;

895 
	uiw»q_d©a
 {

897 
	mÇme
[
IFNAMSIZ
];

901 
iw_pošt
 
	messid
;

902 
iw_·¿m
 
	mnwid
;

903 
iw_äeq
 
	mäeq
;

907 
iw_·¿m
 
	m£ns
;

908 
iw_·¿m
 
	mb™¿‹
;

909 
iw_·¿m
 
	mtxpow”
;

910 
iw_·¿m
 
	m¹s
;

911 
iw_·¿m
 
	mäag
;

912 
__u32
 
	mmode
;

913 
iw_·¿m
 
	m»Œy
;

915 
iw_pošt
 
	m’codšg
;

916 
iw_·¿m
 
	mpow”
;

917 
iw_qu®™y
 
	mqu®
;

919 
sockaddr
 
	m­_addr
;

920 
sockaddr
 
	maddr
;

922 
iw_·¿m
 
	m·¿m
;

923 
iw_pošt
 
	md©a
;

932 
	siw»q
 {

935 
	miän_Çme
[
IFNAMSIZ
];

936 } 
	miä_iän
;

939 
iw»q_d©a
 
	mu
;

952 
	siw_¿nge
 {

954 
__u32
 
	mthroughput
;

963 
__u32
 
	mmš_nwid
;

964 
__u32
 
	mmax_nwid
;

967 
__u16
 
	mŞd_num_chªÃls
;

968 
__u8
 
	mŞd_num_äequ’cy
;

971 
__u8
 
	msÿn_ÿ·
;

974 
__u32
 
	mev’t_ÿ·
[6];

977 
__s32
 
	m£ns™iv™y
;

984 
iw_qu®™y
 
	mmax_qu®
;

994 
iw_qu®™y
 
	mavg_qu®
;

997 
__u8
 
	mnum_b™¿‹s
;

998 
__s32
 
	mb™¿‹
[
IW_MAX_BITRATES
];

1001 
__s32
 
	mmš_¹s
;

1002 
__s32
 
	mmax_¹s
;

1005 
__s32
 
	mmš_äag
;

1006 
__s32
 
	mmax_äag
;

1009 
__s32
 
	mmš_pmp
;

1010 
__s32
 
	mmax_pmp
;

1011 
__s32
 
	mmš_pmt
;

1012 
__s32
 
	mmax_pmt
;

1013 
__u16
 
	mpmp_æags
;

1014 
__u16
 
	mpmt_æags
;

1015 
__u16
 
	mpm_ÿ·
;

1018 
__u16
 
	m’codšg_size
[
IW_MAX_ENCODING_SIZES
];

1019 
__u8
 
	mnum_’codšg_sizes
;

1020 
__u8
 
	mmax_’codšg_tok’s
;

1022 
__u8
 
	m’codšg_logš_šdex
;

1025 
__u16
 
	mtxpow”_ÿ·
;

1026 
__u8
 
	mnum_txpow”
;

1027 
__s32
 
	mtxpow”
[
IW_MAX_TXPOWER
];

1030 
__u8
 
	mwe_v”siÚ_comped
;

1031 
__u8
 
	mwe_v”siÚ_sourû
;

1034 
__u16
 
	m»Œy_ÿ·
;

1035 
__u16
 
	m»Œy_æags
;

1036 
__u16
 
	mr_time_æags
;

1037 
__s32
 
	mmš_»Œy
;

1038 
__s32
 
	mmax_»Œy
;

1039 
__s32
 
	mmš_r_time
;

1040 
__s32
 
	mmax_r_time
;

1043 
__u16
 
	mnum_chªÃls
;

1044 
__u8
 
	mnum_äequ’cy
;

1045 
iw_äeq
 
	mäeq
[
IW_MAX_FREQUENCIES
];

1049 
__u32
 
	m’c_ÿ·
;

1056 
	siw_´iv_¬gs
 {

1057 
__u32
 
	mcmd
;

1058 
__u16
 
	m£t_¬gs
;

1059 
__u16
 
	mg‘_¬gs
;

1060 
	mÇme
[
IFNAMSIZ
];

1073 
	siw_ev’t
 {

1074 
__u16
 
	mËn
;

1075 
__u16
 
	mcmd
;

1076 
iw»q_d©a
 
	mu
;

1080 
	#IW_EV_LCP_LEN
 ((
iw_ev’t
è- (
iw»q_d©a
))

	)

1082 
	#IW_EV_CHAR_LEN
 (
IW_EV_LCP_LEN
 + 
IFNAMSIZ
)

	)

1083 
	#IW_EV_UINT_LEN
 (
IW_EV_LCP_LEN
 + (
__u32
))

	)

1084 
	#IW_EV_FREQ_LEN
 (
IW_EV_LCP_LEN
 + (
iw_äeq
))

	)

1085 
	#IW_EV_PARAM_LEN
 (
IW_EV_LCP_LEN
 + (
iw_·¿m
))

	)

1086 
	#IW_EV_ADDR_LEN
 (
IW_EV_LCP_LEN
 + (
sockaddr
))

	)

1087 
	#IW_EV_QUAL_LEN
 (
IW_EV_LCP_LEN
 + (
iw_qu®™y
))

	)

1092 
	#IW_EV_POINT_OFF
 (((*è&(((
iw_pošt
 *è
NULL
)->
Ëngth
)) - \

1093 (*è
NULL
)

	)

1094 
	#IW_EV_POINT_LEN
 (
IW_EV_LCP_LEN
 + (
iw_pošt
) - \

1095 
IW_EV_POINT_OFF
)

	)

1099 
	#IW_EV_LCP_PK_LEN
 (4)

	)

1101 
	#IW_EV_CHAR_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + 
IFNAMSIZ
)

	)

1102 
	#IW_EV_UINT_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
__u32
))

	)

1103 
	#IW_EV_FREQ_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
iw_äeq
))

	)

1104 
	#IW_EV_PARAM_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
iw_·¿m
))

	)

1105 
	#IW_EV_ADDR_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
sockaddr
))

	)

1106 
	#IW_EV_QUAL_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + (
iw_qu®™y
))

	)

1107 
	#IW_EV_POINT_PK_LEN
 (
IW_EV_LCP_PK_LEN
 + 4)

	)

	@/usr/include/math.h

23 #iâdef 
_MATH_H


24 
	#_MATH_H
 1

	)

26 
	~<ã©u»s.h
>

28 
	g__BEGIN_DECLS


31 
	~<b™s/m©h-veùÜ.h
>

35 
	~<b™s/huge_v®.h
>

36 #ifdeà
__USE_ISOC99


37 
	~<b™s/huge_v®f.h
>

38 
	~<b™s/huge_v®l.h
>

41 
	~<b™s/šf.h
>

44 
	~<b™s/Çn.h
>

48 
	~<b™s/m©hdef.h
>

55 
	#__SIMD_DECL
(
funùiÚ
è
	`__CONCAT
 (
__DECL_SIMD_
, funùiÚ)

	)

57 
	#__MATHCALL_VEC
(
funùiÚ
, 
suffix
, 
¬gs
) \

58 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
funùiÚ
, 
suffix
)) \

59 
	`__MATHCALL
 (
funùiÚ
, 
suffix
, 
¬gs
)

	)

61 
	#__MATHDECL_VEC
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

62 
	`__SIMD_DECL
 (
	`__MATH_PRECNAME
 (
funùiÚ
, 
suffix
)) \

63 
	`__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
)

	)

65 
	#__MATHCALL
(
funùiÚ
,
suffix
, 
¬gs
) \

66 
	`__MATHDECL
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
)

	)

67 
	#__MATHDECL
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

68 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
); \

69 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
)

	)

70 
	#__MATHCALLX
(
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

71 
	`__MATHDECLX
 (
_MdoubË_
,
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
)

	)

72 
	#__MATHDECLX
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
©Œib
) \

73 
	`__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
); \

74 
	`__MATHDECL_1
(
ty³
, 
	`__CONCAT
(
__
,
funùiÚ
),
suffix
, 
¬gs
è
	`__©Œibu‹__
 (
©Œib
)

	)

75 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

76 
ty³
 
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
è
¬gs
 
__THROW


	)

78 
	#_MdoubË_
 

	)

79 
	#__MATH_PRECNAME
(
Çme
,
r
è
	`__CONCAT
Òame,r)

	)

80 
	#__MATH_DECLARING_DOUBLE
 1

	)

81 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_STD


	)

82 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_STD


	)

83 
	~<b™s/m©hÿÎs.h
>

84 #undeà
_MdoubË_


85 #undeà
_MdoubË_BEGIN_NAMESPACE


86 #undeà
_MdoubË_END_NAMESPACE


87 #undeà
__MATH_PRECNAME


88 #undeà
__MATH_DECLARING_DOUBLE


90 #ifdeà
__USE_ISOC99


96 #iâdeà
_Mæßt_


97 
	#_Mæßt_
 

	)

99 
	#_MdoubË_
 
_Mæßt_


	)

100 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
f
##
	)
r

101 
	#__MATH_DECLARING_DOUBLE
 0

	)

102 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

103 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

104 
	~<b™s/m©hÿÎs.h
>

105 #undeà
_MdoubË_


106 #undeà
_MdoubË_BEGIN_NAMESPACE


107 #undeà
_MdoubË_END_NAMESPACE


108 #undeà
__MATH_PRECNAME


109 #undeà
__MATH_DECLARING_DOUBLE


111 #ià!(
defšed
 
__NO_LONG_DOUBLE_MATH
 && defšed 
_LIBC
) \

112 || 
defšed
 
__LDBL_COMPAT
 \

113 || 
defšed
 
_LIBC_TEST


114 #ifdeà
__LDBL_COMPAT


116 #ifdeà
__USE_ISOC99


117 
	$__Ædbl_Ãx‰ow¬df
 (
__x
, 
__y
)

118 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

119 #ifdeà
__REDIRECT_NTH


120 
	`__REDIRECT_NTH
 (
Ãx‰ow¬df
, (
__x
, 
__y
),

121 
__Ædbl_Ãx‰ow¬df
)

122 
	`__©Œibu‹__
 ((
__cÚ¡__
));

123 
	`__REDIRECT_NTH
 (
Ãx‰ow¬d
, (
__x
, 
__y
),

124 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

125 
	`__REDIRECT_NTH
 (
Ãx‰ow¬dl
,

126 (
__x
, 
__y
),

127 
Ãxá”
è
	`__©Œibu‹__
 ((
__cÚ¡__
));

131 #undeà
__MATHDECL_1


132 
	#__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
®Ÿs
) \

133 
ty³
 
	`__REDIRECT_NTH
(
	`__MATH_PRECNAME
(
funùiÚ
,
suffix
), \

134 
¬gs
, 
®Ÿs
)

	)

135 
	#__MATHDECL_1
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
) \

136 
	`__MATHDECL_2
(
ty³
, 
funùiÚ
,
suffix
, 
¬gs
, 
	`__CONCAT
(funùiÚ,suffix))

	)

142 #iâdeà
_MlÚg_doubË_


143 
	#_MlÚg_doubË_
 

	)

145 
	#_MdoubË_
 
_MlÚg_doubË_


	)

146 
	#__MATH_PRECNAME
(
Çme
,
r
èÇme##
l
##
	)
r

147 
	#__MATH_DECLARING_DOUBLE
 0

	)

148 
	#_MdoubË_BEGIN_NAMESPACE
 
__BEGIN_NAMESPACE_C99


	)

149 
	#_MdoubË_END_NAMESPACE
 
__END_NAMESPACE_C99


	)

150 
	#__MATH_DECLARE_LDOUBLE
 1

	)

151 
	~<b™s/m©hÿÎs.h
>

152 #undeà
_MdoubË_


153 #undeà
_MdoubË_BEGIN_NAMESPACE


154 #undeà
_MdoubË_END_NAMESPACE


155 #undeà
__MATH_PRECNAME


156 #undeà
__MATH_DECLARING_DOUBLE


161 #undeà
__MATHDECL_1


162 #undeà
__MATHDECL


163 #undeà
__MATHCALL


166 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


168 
signgam
;

173 #ifdeà
__USE_ISOC99


211 
FP_NAN
 =

212 
	#FP_NAN
 0

	)

213 
FP_NAN
,

214 
FP_INFINITE
 =

215 
	#FP_INFINITE
 1

	)

216 
FP_INFINITE
,

217 
FP_ZERO
 =

218 
	#FP_ZERO
 2

	)

219 
FP_ZERO
,

220 
FP_SUBNORMAL
 =

221 
	#FP_SUBNORMAL
 3

	)

222 
FP_SUBNORMAL
,

223 
FP_NORMAL
 =

224 
	#FP_NORMAL
 4

	)

225 
FP_NORMAL


233 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__
 \

234 && !
defšed
 
__OPTIMIZE_SIZE__


235 
	#åşassify
(
x
è
	`__butš_åşassify
 (
FP_NAN
, 
FP_INFINITE
, \

236 
FP_NORMAL
, 
FP_SUBNORMAL
, 
FP_ZERO
, 
x
)

	)

237 #–ià
defšed
 
__NO_LONG_DOUBLE_MATH


238 
	#åşassify
(
x
) \

239 ( (
x
è=ğ (è? 
	`__åşassifyf
 (xè: 
	`__åşassify
 (x))

	)

241 
	#åşassify
(
x
) \

242 ( (
x
) ==  () \

243 ? 
	`__åşassifyf
 (
x
) \

244 :  (
x
) ==  () \

245 ? 
	`__åşassify
 (
x
è: 
	`__åşassifyl
 (x))

	)

249 #ià
	`__GNUC_PREREQ
 (4,0)

250 
	#signb™
(
x
) \

251 ( (
x
) ==  () \

252 ? 
	`__butš_signb™f
 (
x
) \

253 :  (
x
) ==  () \

254 ? 
	`__butš_signb™
 (
x
è: 
	`__butš_signb™l
 (x))

	)

256 #ifdeà
__NO_LONG_DOUBLE_MATH


257 
	#signb™
(
x
) \

258 ( (
x
è=ğ (è? 
	`__signb™f
 (xè: 
	`__signb™
 (x))

	)

260 
	#signb™
(
x
) \

261 ( (
x
) ==  () \

262 ? 
	`__signb™f
 (
x
) \

263 :  (
x
) ==  () \

264 ? 
	`__signb™
 (
x
è: 
	`__signb™l
 (x))

	)

269 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


270 
	#isfš™e
(
x
è
	`__butš_isfš™e
 (x)

	)

271 #–ià
defšed
 
__NO_LONG_DOUBLE_MATH


272 
	#isfš™e
(
x
) \

273 ( (
x
è=ğ (è? 
	`__fš™ef
 (xè: 
	`__fš™e
 (x))

	)

275 
	#isfš™e
(
x
) \

276 ( (
x
) ==  () \

277 ? 
	`__fš™ef
 (
x
) \

278 :  (
x
) ==  () \

279 ? 
	`__fš™e
 (
x
è: 
	`__fš™–
 (x))

	)

283 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


284 
	#i¢Üm®
(
x
è
	`__butš_i¢Üm®
 (x)

	)

286 
	#i¢Üm®
(
x
è(
	`åşassify
 (xè=ğ
FP_NORMAL
)

	)

291 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


292 
	#i¢ª
(
x
è
	`__butš_i¢ª
 (x)

	)

293 #–ià
defšed
 
__NO_LONG_DOUBLE_MATH


294 
	#i¢ª
(
x
) \

295 ( (
x
è=ğ (è? 
	`__i¢ªf
 (xè: 
	`__i¢ª
 (x))

	)

297 
	#i¢ª
(
x
) \

298 ( (
x
) ==  () \

299 ? 
	`__i¢ªf
 (
x
) \

300 :  (
x
) ==  () \

301 ? 
	`__i¢ª
 (
x
è: 
	`__i¢ªl
 (x))

	)

305 #ià
	`__GNUC_PREREQ
 (4,4è&& !
defšed
 
__SUPPORT_SNAN__


306 
	#isšf
(
x
è
	`__butš_isšf_sign
 (x)

	)

307 #–ià
defšed
 
__NO_LONG_DOUBLE_MATH


308 
	#isšf
(
x
) \

309 ( (
x
è=ğ (è? 
	`__isšff
 (xè: 
	`__isšf
 (x))

	)

311 
	#isšf
(
x
) \

312 ( (
x
) ==  () \

313 ? 
	`__isšff
 (
x
) \

314 :  (
x
) ==  () \

315 ? 
	`__isšf
 (
x
è: 
	`__isšæ
 (x))

	)

319 
	#MATH_ERRNO
 1

	)

320 
	#MATH_ERREXCEPT
 2

	)

325 #iâdeà
__FAST_MATH__


326 
	#m©h_”rhªdlšg
 (
MATH_ERRNO
 | 
MATH_ERREXCEPT
)

	)

331 #ifdeà
__USE_GNU


333 #ifdeà
__NO_LONG_DOUBLE_MATH


334 
	#issigÇlšg
(
x
) \

335 ( (
x
è=ğ (è? 
	`__issigÇlšgf
 (xè: 
	`__issigÇlšg
 (x))

	)

337 
	#issigÇlšg
(
x
) \

338 ( (
x
) ==  () \

339 ? 
	`__issigÇlšgf
 (
x
) \

340 :  (
x
) ==  () \

341 ? 
	`__issigÇlšg
 (
x
è: 
	`__issigÇlšgl
 (x))

	)

345 #ifdef 
__USE_MISC


349 
_IEEE_
 = -1,

350 
_SVID_
,

351 
_XOPEN_
,

352 
_POSIX_
,

353 
_ISOC_


354 } 
	t_LIB_VERSION_TYPE
;

359 
_LIB_VERSION_TYPE
 
_LIB_VERSION
;

363 #ifdeà
__USE_MISC


369 #ifdeà
__ılu¥lus


370 
__exû±iÚ


372 
exû±iÚ


375 
ty³
;

376 *
Çme
;

377 
¬g1
;

378 
¬g2
;

379 
»tv®
;

380 
	}
};

382 #ifdeà
__ılu¥lus


383 
	$m©h”r
 (
__exû±iÚ
 *
__exc
è
	`throw
 ();

385 
	`m©h”r
 (
exû±iÚ
 *
__exc
);

388 
	#X_TLOSS
 1.41484755040568800000e+16

	)

391 
	#DOMAIN
 1

	)

392 
	#SING
 2

	)

393 
	#OVERFLOW
 3

	)

394 
	#UNDERFLOW
 4

	)

395 
	#TLOSS
 5

	)

396 
	#PLOSS
 6

	)

399 
	#HUGE
 3.40282347e+38F

	)

403 #ifdeà
__USE_XOPEN


405 
	#MAXFLOAT
 3.40282347e+38F

	)

412 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


413 
	#M_E
 2.7182818284590452354

	)

414 
	#M_LOG2E
 1.4426950408889634074

	)

415 
	#M_LOG10E
 0.43429448190325182765

	)

416 
	#M_LN2
 0.69314718055994530942

	)

417 
	#M_LN10
 2.30258509299404568402

	)

418 
	#M_PI
 3.14159265358979323846

	)

419 
	#M_PI_2
 1.57079632679489661923

	)

420 
	#M_PI_4
 0.78539816339744830962

	)

421 
	#M_1_PI
 0.31830988618379067154

	)

422 
	#M_2_PI
 0.63661977236758134308

	)

423 
	#M_2_SQRTPI
 1.12837916709551257390

	)

424 
	#M_SQRT2
 1.41421356237309504880

	)

425 
	#M_SQRT1_2
 0.70710678118654752440

	)

431 #ifdeà
__USE_GNU


432 
	#M_El
 2.718281828459045235360287471352662498L

	)

433 
	#M_LOG2El
 1.442695040888963407359924681001892137L

	)

434 
	#M_LOG10El
 0.434294481903251827651128918916605082L

	)

435 
	#M_LN2l
 0.693147180559945309417232121458176568L

	)

436 
	#M_LN10l
 2.302585092994045684017991454684364208L

	)

437 
	#M_PIl
 3.141592653589793238462643383279502884L

	)

438 
	#M_PI_2l
 1.570796326794896619231321691639751442L

	)

439 
	#M_PI_4l
 0.785398163397448309615660845819875721L

	)

440 
	#M_1_PIl
 0.318309886183790671537767526745028724L

	)

441 
	#M_2_PIl
 0.636619772367581343075535053490057448L

	)

442 
	#M_2_SQRTPIl
 1.128379167095512573896158903121545172L

	)

443 
	#M_SQRT2l
 1.414213562373095048801688724209698079L

	)

444 
	#M_SQRT1_2l
 0.707106781186547524400844362104849039L

	)

451 #ià
defšed
 
__STRICT_ANSI__
 && !defšed 
__NO_MATH_INLINES


452 
	#__NO_MATH_INLINES
 1

	)

455 #ià
defšed
 
__USE_ISOC99
 && 
	`__GNUC_PREREQ
(2,97)

462 
	#isg»©”
(
x
, 
y
è
	`__butš_isg»©”
(x, y)

	)

463 
	#isg»©”equ®
(
x
, 
y
è
	`__butš_isg»©”equ®
(x, y)

	)

464 
	#i¦ess
(
x
, 
y
è
	`__butš_i¦ess
(x, y)

	)

465 
	#i¦es£qu®
(
x
, 
y
è
	`__butš_i¦es£qu®
(x, y)

	)

466 
	#i¦essg»©”
(
x
, 
y
è
	`__butš_i¦essg»©”
(x, y)

	)

467 
	#isunÜd”ed
(
u
, 
v
è
	`__butš_isunÜd”ed
(u, v)

	)

471 #ifdeà
__USE_EXTERN_INLINES


472 
	~<b™s/m©hšlše.h
>

477 #ià
defšed
 
__FINITE_MATH_ONLY__
 && __FINITE_MATH_ONLY__ > 0

478 
	~<b™s/m©h-fš™e.h
>

481 #ifdeà
__USE_ISOC99


485 #iâdeà
isg»©”


486 
	#isg»©”
(
x
, 
y
) \

487 (
__ex‹nsiÚ__
 \

488 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

489 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x > __y; 
	}
}))

	)

493 #iâdeà
isg»©”equ®


494 
	#isg»©”equ®
(
x
, 
y
) \

495 (
__ex‹nsiÚ__
 \

496 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

497 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x >ğ__y; }))

	)

501 #iâdeà
i¦ess


502 
	#i¦ess
(
x
, 
y
) \

503 (
__ex‹nsiÚ__
 \

504 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

505 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x < __y; }))

	)

509 #iâdeà
i¦es£qu®


510 
	#i¦es£qu®
(
x
, 
y
) \

511 (
__ex‹nsiÚ__
 \

512 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

513 !
	`isunÜd”ed
 (
__x
, 
__y
è&& __x <ğ__y; }))

	)

517 #iâdeà
i¦essg»©”


518 
	#i¦essg»©”
(
x
, 
y
) \

519 (
__ex‹nsiÚ__
 \

520 ({ 
	`__ty³of__
(
x
è
__x
 = (x); __ty³of__(
y
è
__y
 = (y); \

521 !
	`isunÜd”ed
 (
__x
, 
__y
è&& (__x < __y || __y < __x); }))

	)

525 #iâdeà
isunÜd”ed


526 
	#isunÜd”ed
(
u
, 
v
) \

527 (
__ex‹nsiÚ__
 \

528 ({ 
	`__ty³of__
(
u
è
__u
 = (u); __ty³of__(
v
è
__v
 = (v); \

529 
	`åşassify
 (
__u
è=ğ
FP_NAN
 || fpşassify (
__v
è=ğFP_NAN; }))

	)

534 
	g__END_DECLS


	@/usr/include/net/ethernet.h

21 #iâdeà
__NET_ETHERNET_H


22 
	#__NET_ETHERNET_H
 1

	)

24 
	~<sys/cdefs.h
>

25 
	~<sys/ty³s.h
>

26 
	~<lšux/if_‘h”.h
>

28 
__BEGIN_DECLS


32 
	s‘h”_addr


34 
u_št8_t
 
	m‘h”_addr_où‘
[
ETH_ALEN
];

35 } 
__©Œibu‹__
 ((
__·cked__
));

38 
	s‘h”_h—d”


40 
u_št8_t
 
	m‘h”_dho¡
[
ETH_ALEN
];

41 
u_št8_t
 
	m‘h”_sho¡
[
ETH_ALEN
];

42 
u_št16_t
 
	m‘h”_ty³
;

43 } 
__©Œibu‹__
 ((
__·cked__
));

46 
	#ETHERTYPE_PUP
 0x0200

	)

47 
	#ETHERTYPE_SPRITE
 0x0500

	)

48 
	#ETHERTYPE_IP
 0x0800

	)

49 
	#ETHERTYPE_ARP
 0x0806

	)

50 
	#ETHERTYPE_REVARP
 0x8035

	)

51 
	#ETHERTYPE_AT
 0x809B

	)

52 
	#ETHERTYPE_AARP
 0x80F3

	)

53 
	#ETHERTYPE_VLAN
 0x8100

	)

54 
	#ETHERTYPE_IPX
 0x8137

	)

55 
	#ETHERTYPE_IPV6
 0x86dd

	)

56 
	#ETHERTYPE_LOOPBACK
 0x9000

	)

59 
	#ETHER_ADDR_LEN
 
ETH_ALEN


	)

60 
	#ETHER_TYPE_LEN
 2

	)

61 
	#ETHER_CRC_LEN
 4

	)

62 
	#ETHER_HDR_LEN
 
ETH_HLEN


	)

63 
	#ETHER_MIN_LEN
 (
ETH_ZLEN
 + 
ETHER_CRC_LEN
è

	)

64 
	#ETHER_MAX_LEN
 (
ETH_FRAME_LEN
 + 
ETHER_CRC_LEN
è

	)

67 
	#ETHER_IS_VALID_LEN
(
foo
) \

68 ((
foo
è>ğ
ETHER_MIN_LEN
 && (fooè<ğ
ETHER_MAX_LEN
)

	)

75 
	#ETHERTYPE_TRAIL
 0x1000

	)

76 
	#ETHERTYPE_NTRAILER
 16

	)

78 
	#ETHERMTU
 
ETH_DATA_LEN


	)

79 
	#ETHERMIN
 (
ETHER_MIN_LEN
 - 
ETHER_HDR_LEN
 - 
ETHER_CRC_LEN
)

	)

81 
	g__END_DECLS


	@/usr/include/net/if.h

19 #iâdeà
_NET_IF_H


20 
	#_NET_IF_H
 1

	)

22 
	~<ã©u»s.h
>

24 #ifdeà
__USE_MISC


25 
	~<sys/ty³s.h
>

26 
	~<sys/sock‘.h
>

31 
	#IF_NAMESIZE
 16

	)

33 
	sif_Çmešdex


35 
	mif_šdex
;

36 *
	mif_Çme
;

40 #ifdeà
__USE_MISC


44 
	mIFF_UP
 = 0x1,

45 
	#IFF_UP
 
IFF_UP


	)

46 
	mIFF_BROADCAST
 = 0x2,

47 
	#IFF_BROADCAST
 
IFF_BROADCAST


	)

48 
	mIFF_DEBUG
 = 0x4,

49 
	#IFF_DEBUG
 
IFF_DEBUG


	)

50 
	mIFF_LOOPBACK
 = 0x8,

51 
	#IFF_LOOPBACK
 
IFF_LOOPBACK


	)

52 
	mIFF_POINTOPOINT
 = 0x10,

53 
	#IFF_POINTOPOINT
 
IFF_POINTOPOINT


	)

54 
	mIFF_NOTRAILERS
 = 0x20,

55 
	#IFF_NOTRAILERS
 
IFF_NOTRAILERS


	)

56 
	mIFF_RUNNING
 = 0x40,

57 
	#IFF_RUNNING
 
IFF_RUNNING


	)

58 
	mIFF_NOARP
 = 0x80,

59 
	#IFF_NOARP
 
IFF_NOARP


	)

60 
	mIFF_PROMISC
 = 0x100,

61 
	#IFF_PROMISC
 
IFF_PROMISC


	)

64 
	mIFF_ALLMULTI
 = 0x200,

65 
	#IFF_ALLMULTI
 
IFF_ALLMULTI


	)

67 
	mIFF_MASTER
 = 0x400,

68 
	#IFF_MASTER
 
IFF_MASTER


	)

69 
	mIFF_SLAVE
 = 0x800,

70 
	#IFF_SLAVE
 
IFF_SLAVE


	)

72 
	mIFF_MULTICAST
 = 0x1000,

73 
	#IFF_MULTICAST
 
IFF_MULTICAST


	)

75 
	mIFF_PORTSEL
 = 0x2000,

76 
	#IFF_PORTSEL
 
IFF_PORTSEL


	)

77 
	mIFF_AUTOMEDIA
 = 0x4000,

78 
	#IFF_AUTOMEDIA
 
IFF_AUTOMEDIA


	)

79 
	mIFF_DYNAMIC
 = 0x8000

80 
	#IFF_DYNAMIC
 
IFF_DYNAMIC


	)

88 
	siçddr


90 
sockaddr
 
	miç_addr
;

93 
sockaddr
 
	mifu_brßdaddr
;

94 
sockaddr
 
	mifu_d¡addr
;

95 } 
	miç_ifu
;

96 
içû
 *
	miç_iå
;

97 
içddr
 *
	miç_Ãxt
;

100 
	#iç_brßdaddr
 
iç_ifu
.
ifu_brßdaddr


	)

101 
	#iç_d¡addr
 
iç_ifu
.
ifu_d¡addr


	)

111 
	sifm­


113 
	mmem_¡¬t
;

114 
	mmem_’d
;

115 
	mba£_addr
;

116 
	mœq
;

117 
	mdma
;

118 
	mpÜt
;

126 
	siäeq


128 
	#IFHWADDRLEN
 6

	)

129 
	#IFNAMSIZ
 
IF_NAMESIZE


	)

132 
	miän_Çme
[
IFNAMSIZ
];

133 } 
	miä_iän
;

137 
sockaddr
 
	miäu_addr
;

138 
sockaddr
 
	miäu_d¡addr
;

139 
sockaddr
 
	miäu_brßdaddr
;

140 
sockaddr
 
	miäu_Ãtmask
;

141 
sockaddr
 
	miäu_hwaddr
;

142 
	miäu_æags
;

143 
	miäu_iv®ue
;

144 
	miäu_mtu
;

145 
ifm­
 
	miäu_m­
;

146 
	miäu_¦ave
[
IFNAMSIZ
];

147 
	miäu_ÃwÇme
[
IFNAMSIZ
];

148 
__ÿddr_t
 
	miäu_d©a
;

149 } 
	miä_iäu
;

151 
	#iä_Çme
 
iä_iän
.
iän_Çme


	)

152 
	#iä_hwaddr
 
iä_iäu
.
iäu_hwaddr


	)

153 
	#iä_addr
 
iä_iäu
.
iäu_addr


	)

154 
	#iä_d¡addr
 
iä_iäu
.
iäu_d¡addr


	)

155 
	#iä_brßdaddr
 
iä_iäu
.
iäu_brßdaddr


	)

156 
	#iä_Ãtmask
 
iä_iäu
.
iäu_Ãtmask


	)

157 
	#iä_æags
 
iä_iäu
.
iäu_æags


	)

158 
	#iä_m‘ric
 
iä_iäu
.
iäu_iv®ue


	)

159 
	#iä_mtu
 
iä_iäu
.
iäu_mtu


	)

160 
	#iä_m­
 
iä_iäu
.
iäu_m­


	)

161 
	#iä_¦ave
 
iä_iäu
.
iäu_¦ave


	)

162 
	#iä_d©a
 
iä_iäu
.
iäu_d©a


	)

163 
	#iä_ifšdex
 
iä_iäu
.
iäu_iv®ue


	)

164 
	#iä_bªdwidth
 
iä_iäu
.
iäu_iv®ue


	)

165 
	#iä_qËn
 
iä_iäu
.
iäu_iv®ue


	)

166 
	#iä_ÃwÇme
 
iä_iäu
.
iäu_ÃwÇme


	)

167 
	#_IOT_iäeq
 
	`_IOT
(
	`_IOTS
(),
IFNAMSIZ
,_IOTS(),16,0,0)

	)

168 
	#_IOT_iäeq_shÜt
 
	`_IOT
(
	`_IOTS
(),
IFNAMSIZ
,_IOTS(),1,0,0)

	)

169 
	#_IOT_iäeq_št
 
	`_IOT
(
	`_IOTS
(),
IFNAMSIZ
,_IOTS(),1,0,0)

	)

176 
	sifcÚf


178 
	mifc_Ën
;

181 
__ÿddr_t
 
	mifcu_buf
;

182 
iäeq
 *
	mifcu_»q
;

183 } 
	mifc_ifcu
;

185 
	#ifc_buf
 
ifc_ifcu
.
ifcu_buf


	)

186 
	#ifc_»q
 
ifc_ifcu
.
ifcu_»q


	)

187 
	#_IOT_ifcÚf
 
	`_IOT
(
	`_IOTS
(
ifcÚf
),1,0,0,0,0è

	)

190 
__BEGIN_DECLS


193 
	$if_Çm‘ošdex
 (cÚ¡ *
__iâame
è
__THROW
;

194 *
	$if_šdextÚame
 (
__ifšdex
, *
__iâame
è
__THROW
;

197 
if_Çmešdex
 *
	$if_Çmešdex
 (è
__THROW
;

200 
	$if_ä“Çmešdex
 (
if_Çmešdex
 *
__±r
è
__THROW
;

202 
__END_DECLS


	@/usr/include/net/if_arp.h

22 #iâdeà
_NET_IF_ARP_H


24 
	#_NET_IF_ARP_H
 1

	)

25 
	~<sys/cdefs.h
>

27 
	~<sys/ty³s.h
>

28 
	~<sys/sock‘.h
>

30 
	g__BEGIN_DECLS


33 
	#MAX_ADDR_LEN
 7

	)

39 
	#ARPOP_REQUEST
 1

	)

40 
	#ARPOP_REPLY
 2

	)

41 
	#ARPOP_RREQUEST
 3

	)

42 
	#ARPOP_RREPLY
 4

	)

43 
	#ARPOP_InREQUEST
 8

	)

44 
	#ARPOP_InREPLY
 9

	)

45 
	#ARPOP_NAK
 10

	)

54 
	s¬phdr


56 
	m¬_hrd
;

57 
	m¬_´o
;

58 
	m¬_hÊ
;

59 
	m¬_¶n
;

60 
	m¬_İ
;

64 
	m__¬_sha
[
ETH_ALEN
];

65 
	m__¬_s
[4];

66 
	m__¬_tha
[
ETH_ALEN
];

67 
	m__¬_t
[4];

73 
	#ARPHRD_NETROM
 0

	)

74 
	#ARPHRD_ETHER
 1

	)

75 
	#ARPHRD_EETHER
 2

	)

76 
	#ARPHRD_AX25
 3

	)

77 
	#ARPHRD_PRONET
 4

	)

78 
	#ARPHRD_CHAOS
 5

	)

79 
	#ARPHRD_IEEE802
 6

	)

80 
	#ARPHRD_ARCNET
 7

	)

81 
	#ARPHRD_APPLETLK
 8

	)

82 
	#ARPHRD_DLCI
 15

	)

83 
	#ARPHRD_ATM
 19

	)

84 
	#ARPHRD_METRICOM
 23

	)

85 
	#ARPHRD_IEEE1394
 24

	)

86 
	#ARPHRD_EUI64
 27

	)

87 
	#ARPHRD_INFINIBAND
 32

	)

90 
	#ARPHRD_SLIP
 256

	)

91 
	#ARPHRD_CSLIP
 257

	)

92 
	#ARPHRD_SLIP6
 258

	)

93 
	#ARPHRD_CSLIP6
 259

	)

94 
	#ARPHRD_RSRVD
 260

	)

95 
	#ARPHRD_ADAPT
 264

	)

96 
	#ARPHRD_ROSE
 270

	)

97 
	#ARPHRD_X25
 271

	)

98 
	#ARPHRD_HWX25
 272

	)

99 
	#ARPHRD_PPP
 512

	)

100 
	#ARPHRD_CISCO
 513

	)

101 
	#ARPHRD_HDLC
 
ARPHRD_CISCO


	)

102 
	#ARPHRD_LAPB
 516

	)

103 
	#ARPHRD_DDCMP
 517

	)

104 
	#ARPHRD_RAWHDLC
 518

	)

106 
	#ARPHRD_TUNNEL
 768

	)

107 
	#ARPHRD_TUNNEL6
 769

	)

108 
	#ARPHRD_FRAD
 770

	)

109 
	#ARPHRD_SKIP
 771

	)

110 
	#ARPHRD_LOOPBACK
 772

	)

111 
	#ARPHRD_LOCALTLK
 773

	)

112 
	#ARPHRD_FDDI
 774

	)

113 
	#ARPHRD_BIF
 775

	)

114 
	#ARPHRD_SIT
 776

	)

115 
	#ARPHRD_IPDDP
 777

	)

116 
	#ARPHRD_IPGRE
 778

	)

117 
	#ARPHRD_PIMREG
 779

	)

118 
	#ARPHRD_HIPPI
 780

	)

119 
	#ARPHRD_ASH
 781

	)

120 
	#ARPHRD_ECONET
 782

	)

121 
	#ARPHRD_IRDA
 783

	)

122 
	#ARPHRD_FCPP
 784

	)

123 
	#ARPHRD_FCAL
 785

	)

124 
	#ARPHRD_FCPL
 786

	)

125 
	#ARPHRD_FCFABRIC
 787

	)

126 
	#ARPHRD_IEEE802_TR
 800

	)

127 
	#ARPHRD_IEEE80211
 801

	)

128 
	#ARPHRD_IEEE80211_PRISM
 802

	)

129 
	#ARPHRD_IEEE80211_RADIOTAP
 803

	)

130 
	#ARPHRD_IEEE802154
 804

	)

131 
	#ARPHRD_IEEE802154_PHY
 805

	)

133 
	#ARPHRD_VOID
 0xFFFF

	)

134 
	#ARPHRD_NONE
 0xFFFE

	)

138 
	s¬´eq


140 
sockaddr
 
	m¬p_·
;

141 
sockaddr
 
	m¬p_ha
;

142 
	m¬p_æags
;

143 
sockaddr
 
	m¬p_Ãtmask
;

144 
	m¬p_dev
[16];

147 
	s¬´eq_Şd


149 
sockaddr
 
	m¬p_·
;

150 
sockaddr
 
	m¬p_ha
;

151 
	m¬p_æags
;

152 
sockaddr
 
	m¬p_Ãtmask
;

156 
	#ATF_COM
 0x02

	)

157 
	#ATF_PERM
 0x04

	)

158 
	#ATF_PUBL
 0x08

	)

159 
	#ATF_USETRAILERS
 0x10

	)

160 
	#ATF_NETMASK
 0x20

	)

162 
	#ATF_DONTPUB
 0x40

	)

163 
	#ATF_MAGIC
 0x80

	)

167 
	#ARPD_UPDATE
 0x01

	)

168 
	#ARPD_LOOKUP
 0x02

	)

169 
	#ARPD_FLUSH
 0x03

	)

171 
	s¬pd_»que¡


173 
	m»q
;

174 
u_št32_t
 
	m
;

175 
	mdev
;

176 
	m¡amp
;

177 
	mupd©ed
;

178 
	mha
[
MAX_ADDR_LEN
];

181 
	g__END_DECLS


	@/usr/include/net/if_packet.h

19 #iâdeà
__IF_PACKET_H


20 
	#__IF_PACKET_H


	)

22 
	~<ã©u»s.h
>

23 
	~<b™s/sockaddr.h
>

29 
	ssockaddr_pkt


31 
__SOCKADDR_COMMON
 (
¥kt_
);

32 
	m¥kt_deviû
[14];

33 
	m¥kt_´ÙocŞ
;

	@/usr/include/net/route.h

20 #iâdeà
_NET_ROUTE_H


21 
	#_NET_ROUTE_H
 1

	)

23 
	~<ã©u»s.h
>

24 
	~<sys/sock‘.h
>

25 
	~<sys/ty³s.h
>

26 
	~<Ãtš‘/š.h
>

27 
	~<b™s/wÜdsize.h
>

31 
	s¹’Œy


33 
	m¹_·d1
;

34 
sockaddr
 
	m¹_d¡
;

35 
sockaddr
 
	m¹_g©eway
;

36 
sockaddr
 
	m¹_g’mask
;

37 
	m¹_æags
;

38 
	m¹_·d2
;

39 
	m¹_·d3
;

40 
	m¹_tos
;

41 
	m¹_şass
;

42 #ià
__WORDSIZE
 == 64

43 
	m¹_·d4
[3];

45 
	m¹_·d4
;

47 
	m¹_m‘ric
;

48 *
	m¹_dev
;

49 
	m¹_mtu
;

50 
	m¹_wšdow
;

51 
	m¹_œ‰
;

54 
	#¹_mss
 
¹_mtu


	)

57 
	sš6_¹msg


59 
š6_addr
 
	m¹msg_d¡
;

60 
š6_addr
 
	m¹msg_¤c
;

61 
š6_addr
 
	m¹msg_g©eway
;

62 
u_št32_t
 
	m¹msg_ty³
;

63 
u_št16_t
 
	m¹msg_d¡_Ën
;

64 
u_št16_t
 
	m¹msg_¤c_Ën
;

65 
u_št32_t
 
	m¹msg_m‘ric
;

66 
	m¹msg_šfo
;

67 
u_št32_t
 
	m¹msg_æags
;

68 
	m¹msg_ifšdex
;

72 
	#RTF_UP
 0x0001

	)

73 
	#RTF_GATEWAY
 0x0002

	)

75 
	#RTF_HOST
 0x0004

	)

76 
	#RTF_REINSTATE
 0x0008

	)

77 
	#RTF_DYNAMIC
 0x0010

	)

78 
	#RTF_MODIFIED
 0x0020

	)

79 
	#RTF_MTU
 0x0040

	)

80 
	#RTF_MSS
 
RTF_MTU


	)

81 
	#RTF_WINDOW
 0x0080

	)

82 
	#RTF_IRTT
 0x0100

	)

83 
	#RTF_REJECT
 0x0200

	)

84 
	#RTF_STATIC
 0x0400

	)

85 
	#RTF_XRESOLVE
 0x0800

	)

86 
	#RTF_NOFORWARD
 0x1000

	)

87 
	#RTF_THROW
 0x2000

	)

88 
	#RTF_NOPMTUDISC
 0x4000

	)

91 
	#RTF_DEFAULT
 0x00010000

	)

92 
	#RTF_ALLONLINK
 0x00020000

	)

93 
	#RTF_ADDRCONF
 0x00040000

	)

95 
	#RTF_LINKRT
 0x00100000

	)

96 
	#RTF_NONEXTHOP
 0x00200000

	)

98 
	#RTF_CACHE
 0x01000000

	)

99 
	#RTF_FLOW
 0x02000000

	)

100 
	#RTF_POLICY
 0x04000000

	)

102 
	#RTCF_VALVE
 0x00200000

	)

103 
	#RTCF_MASQ
 0x00400000

	)

104 
	#RTCF_NAT
 0x00800000

	)

105 
	#RTCF_DOREDIRECT
 0x01000000

	)

106 
	#RTCF_LOG
 0x02000000

	)

107 
	#RTCF_DIRECTSRC
 0x04000000

	)

109 
	#RTF_LOCAL
 0x80000000

	)

110 
	#RTF_INTERFACE
 0x40000000

	)

111 
	#RTF_MULTICAST
 0x20000000

	)

112 
	#RTF_BROADCAST
 0x10000000

	)

113 
	#RTF_NAT
 0x08000000

	)

115 
	#RTF_ADDRCLASSMASK
 0xF8000000

	)

116 
	#RT_ADDRCLASS
(
æags
è((
__u_št32_t
èæag >> 23)

	)

118 
	#RT_TOS
(
tos
è(Ñosè& 
IPTOS_TOS_MASK
)

	)

120 
	#RT_LOCALADDR
(
æags
è((æag & 
RTF_ADDRCLASSMASK
) \

121 =ğ(
RTF_LOCAL
|
RTF_INTERFACE
))

	)

123 
	#RT_CLASS_UNSPEC
 0

	)

124 
	#RT_CLASS_DEFAULT
 253

	)

126 
	#RT_CLASS_MAIN
 254

	)

127 
	#RT_CLASS_LOCAL
 255

	)

128 
	#RT_CLASS_MAX
 255

	)

131 
	#RTMSG_ACK
 
NLMSG_ACK


	)

132 
	#RTMSG_OVERRUN
 
NLMSG_OVERRUN


	)

134 
	#RTMSG_NEWDEVICE
 0x11

	)

135 
	#RTMSG_DELDEVICE
 0x12

	)

136 
	#RTMSG_NEWROUTE
 0x21

	)

137 
	#RTMSG_DELROUTE
 0x22

	)

138 
	#RTMSG_NEWRULE
 0x31

	)

139 
	#RTMSG_DELRULE
 0x32

	)

140 
	#RTMSG_CONTROL
 0x40

	)

142 
	#RTMSG_AR_FAILED
 0x51

	)

	@/usr/include/netdb.h

22 #iâdef 
_NETDB_H


23 
	#_NETDB_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	~<Ãtš‘/š.h
>

28 
	~<¡dšt.h
>

29 #ifdeà
__USE_MISC


32 
	~<½c/Ãtdb.h
>

35 #ifdeà
__USE_GNU


36 
	#__Ãed_sigev’t_t


	)

37 
	~<b™s/sigšfo.h
>

38 
	#__Ãed_time¥ec


	)

39 
	~<time.h
>

42 
	~<b™s/Ãtdb.h
>

45 
	#_PATH_HEQUIV
 "/‘c/ho¡s.equiv"

	)

46 
	#_PATH_HOSTS
 "/‘c/ho¡s"

	)

47 
	#_PATH_NETWORKS
 "/‘c/ÃtwÜks"

	)

48 
	#_PATH_NSSWITCH_CONF
 "/‘c/nssw™ch.cÚf"

	)

49 
	#_PATH_PROTOCOLS
 "/‘c/´ÙocŞs"

	)

50 
	#_PATH_SERVICES
 "/‘c/£rviûs"

	)

53 
	g__BEGIN_DECLS


55 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K8


58 
	#h_”ºo
 (*
	`__h_”ºo_loÿtiÚ
 ())

	)

61 *
	$__h_”ºo_loÿtiÚ
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

65 
	#HOST_NOT_FOUND
 1

	)

66 
	#TRY_AGAIN
 2

	)

68 
	#NO_RECOVERY
 3

	)

70 
	#NO_DATA
 4

	)

73 #ifdeà
__USE_MISC


74 
	#NETDB_INTERNAL
 -1

	)

75 
	#NETDB_SUCCESS
 0

	)

76 
	#NO_ADDRESS
 
NO_DATA


	)

79 #ià
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_XOPEN_EXTENDED


81 
	#IPPORT_RESERVED
 1024

	)

84 #ifdeà
__USE_GNU


86 
	#SCOPE_DELIMITER
 '%'

	)

89 #ifdeà
__USE_MISC


92 
	$h”rÜ
 (cÚ¡ *
__¡r
è
__THROW
;

95 cÚ¡ *
	$h¡»¼Ü
 (
__”r_num
è
__THROW
;

100 
	sho¡’t


102 *
h_Çme
;

103 **
h_®Ÿ£s
;

104 
h_add¹y³
;

105 
h_Ëngth
;

106 **
h_addr_li¡
;

107 #ifdeà
__USE_MISC


108 
	#h_addr
 
h_addr_li¡
[0]

	)

117 
	`£tho¡’t
 (
__¡ay_İ’
);

123 
	`’dho¡’t
 ();

130 
ho¡’t
 *
	`g‘ho¡’t
 ();

137 
ho¡’t
 *
	`g‘ho¡byaddr
 (cÚ¡ *
__addr
, 
__sockËn_t
 
__Ën
,

138 
__ty³
);

144 
ho¡’t
 *
	`g‘ho¡byÇme
 (cÚ¡ *
__Çme
);

146 #ifdeà
__USE_MISC


155 
ho¡’t
 *
	`g‘ho¡byÇme2
 (cÚ¡ *
__Çme
, 
__af
);

167 
	`g‘ho¡’t_r
 (
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

168 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

169 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

170 *
__»¡riù
 
__h_”ºİ
);

172 
	`g‘ho¡byaddr_r
 (cÚ¡ *
__»¡riù
 
__addr
, 
__sockËn_t
 
__Ën
,

173 
__ty³
,

174 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

175 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

176 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

177 *
__»¡riù
 
__h_”ºİ
);

179 
	`g‘ho¡byÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

180 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

181 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

182 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

183 *
__»¡riù
 
__h_”ºİ
);

185 
	`g‘ho¡byÇme2_r
 (cÚ¡ *
__»¡riù
 
__Çme
, 
__af
,

186 
ho¡’t
 *
__»¡riù
 
__»suÉ_buf
,

187 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

188 
ho¡’t
 **
__»¡riù
 
__»suÉ
,

189 *
__»¡riù
 
__h_”ºİ
);

198 
	`£Š‘’t
 (
__¡ay_İ’
);

204 
	`’dÃ‹Á
 ();

211 
Ã‹Á
 *
	`g‘Ã‹Á
 ();

218 
Ã‹Á
 *
	`g‘Ãtbyaddr
 (
ušt32_t
 
__Ãt
, 
__ty³
);

224 
Ã‹Á
 *
	`g‘ÃtbyÇme
 (cÚ¡ *
__Çme
);

226 #ifdef 
__USE_MISC


237 
	`g‘Ã‹Á_r
 (
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

238 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

239 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

240 *
__»¡riù
 
__h_”ºİ
);

242 
	`g‘Ãtbyaddr_r
 (
ušt32_t
 
__Ãt
, 
__ty³
,

243 
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

244 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

245 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

246 *
__»¡riù
 
__h_”ºİ
);

248 
	`g‘ÃtbyÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

249 
Ã‹Á
 *
__»¡riù
 
__»suÉ_buf
,

250 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

251 
Ã‹Á
 **
__»¡riù
 
__»suÉ
,

252 *
__»¡riù
 
__h_”ºİ
);

257 
	s£rv’t


259 *
s_Çme
;

260 **
s_®Ÿ£s
;

261 
s_pÜt
;

262 *
s_´Ùo
;

270 
	`£t£rv’t
 (
__¡ay_İ’
);

276 
	`’d£rv’t
 ();

283 
£rv’t
 *
	`g‘£rv’t
 ();

290 
£rv’t
 *
	`g‘£rvbyÇme
 (cÚ¡ *
__Çme
, cÚ¡ *
__´Ùo
);

297 
£rv’t
 *
	`g‘£rvbypÜt
 (
__pÜt
, cÚ¡ *
__´Ùo
);

300 #ifdef 
__USE_MISC


308 
	`g‘£rv’t_r
 (
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

309 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

310 
£rv’t
 **
__»¡riù
 
__»suÉ
);

312 
	`g‘£rvbyÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

313 cÚ¡ *
__»¡riù
 
__´Ùo
,

314 
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

315 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

316 
£rv’t
 **
__»¡riù
 
__»suÉ
);

318 
	`g‘£rvbypÜt_r
 (
__pÜt
, cÚ¡ *
__»¡riù
 
__´Ùo
,

319 
£rv’t
 *
__»¡riù
 
__»suÉ_buf
,

320 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

321 
£rv’t
 **
__»¡riù
 
__»suÉ
);

326 
	s´ÙÛÁ


328 *
p_Çme
;

329 **
p_®Ÿ£s
;

330 
p_´Ùo
;

338 
	`£rÙÛÁ
 (
__¡ay_İ’
);

344 
	`’d´ÙÛÁ
 ();

351 
´ÙÛÁ
 *
	`g‘´ÙÛÁ
 ();

357 
´ÙÛÁ
 *
	`g‘´ÙobyÇme
 (cÚ¡ *
__Çme
);

363 
´ÙÛÁ
 *
	`g‘´Ùobynumb”
 (
__´Ùo
);

366 #ifdef 
__USE_MISC


374 
	`g‘´ÙÛÁ_r
 (
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

375 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

376 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

378 
	`g‘´ÙobyÇme_r
 (cÚ¡ *
__»¡riù
 
__Çme
,

379 
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

380 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

381 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

383 
	`g‘´Ùobynumb”_r
 (
__´Ùo
,

384 
´ÙÛÁ
 *
__»¡riù
 
__»suÉ_buf
,

385 *
__»¡riù
 
__buf
, 
size_t
 
__buæ’
,

386 
´ÙÛÁ
 **
__»¡riù
 
__»suÉ
);

395 
	`£Š‘g»Á
 (cÚ¡ *
__Ãtgroup
);

403 
	`’dÃtg»Á
 ();

412 
	`g‘Ãtg»Á
 (**
__»¡riù
 
__ho¡p
,

413 **
__»¡riù
 
__u£½
,

414 **
__»¡riù
 
__domašp
);

423 
	`šÃtgr
 (cÚ¡ *
__Ãtgroup
, cÚ¡ *
__ho¡
,

424 cÚ¡ *
__u£r
, cÚ¡ *
__domaš
);

432 
	`g‘Ãtg»Á_r
 (**
__»¡riù
 
__ho¡p
,

433 **
__»¡riù
 
__u£½
,

434 **
__»¡riù
 
__domašp
,

435 *
__»¡riù
 
__bufãr
, 
size_t
 
__buæ’
);

439 #ifdeà
__USE_MISC


451 
	`rcmd
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

452 cÚ¡ *
__»¡riù
 
__locu£r
,

453 cÚ¡ *
__»¡riù
 
__»mu£r
,

454 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
);

463 
	`rcmd_af
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

464 cÚ¡ *
__»¡riù
 
__locu£r
,

465 cÚ¡ *
__»¡riù
 
__»mu£r
,

466 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
,

467 
§_çmy_t
 
__af
);

479 
	`»xec
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

480 cÚ¡ *
__»¡riù
 
__Çme
,

481 cÚ¡ *
__»¡riù
 
__·ss
,

482 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
);

491 
	`»xec_af
 (**
__»¡riù
 
__aho¡
, 
__½Üt
,

492 cÚ¡ *
__»¡riù
 
__Çme
,

493 cÚ¡ *
__»¡riù
 
__·ss
,

494 cÚ¡ *
__»¡riù
 
__cmd
, *__»¡riù 
__fd2p
,

495 
§_çmy_t
 
__af
);

505 
	`ru£rok
 (cÚ¡ *
__rho¡
, 
__su£r
,

506 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
);

515 
	`ru£rok_af
 (cÚ¡ *
__rho¡
, 
__su£r
,

516 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
,

517 
§_çmy_t
 
__af
);

528 
	`œu£rok
 (
ušt32_t
 
__¿ddr
, 
__su£r
,

529 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
);

539 
	`œu£rok_af
 (cÚ¡ *
__¿ddr
, 
__su£r
,

540 cÚ¡ *
__»mu£r
, cÚ¡ *
__locu£r
,

541 
§_çmy_t
 
__af
);

551 
	`¼esvpÜt
 (*
__®pÜt
);

560 
	`¼esvpÜt_af
 (*
__®pÜt
, 
§_çmy_t
 
__af
);

565 #ifdeà
__USE_XOPEN2K


567 
	saddršfo


569 
ai_æags
;

570 
ai_çmy
;

571 
ai_sockty³
;

572 
ai_´ÙocŞ
;

573 
sockËn_t
 
ai_add¾’
;

574 
sockaddr
 *
ai_addr
;

575 *
ai_ÿnÚÇme
;

576 
addršfo
 *
ai_Ãxt
;

579 #ifdeà
__USE_GNU


581 
	sgaicb


583 cÚ¡ *
¬_Çme
;

584 cÚ¡ *
¬_£rviû
;

585 cÚ¡ 
addršfo
 *
¬_»que¡
;

586 
addršfo
 *
¬_»suÉ
;

588 
__»tuº
;

589 
__glibc_»£rved
[5];

593 
	#GAI_WAIT
 0

	)

594 
	#GAI_NOWAIT
 1

	)

598 
	#AI_PASSIVE
 0x0001

	)

599 
	#AI_CANONNAME
 0x0002

	)

600 
	#AI_NUMERICHOST
 0x0004

	)

601 
	#AI_V4MAPPED
 0x0008

	)

602 
	#AI_ALL
 0x0010

	)

603 
	#AI_ADDRCONFIG
 0x0020

	)

605 #ifdeà
__USE_GNU


606 
	#AI_IDN
 0x0040

	)

609 
	#AI_CANONIDN
 0x0080

	)

610 
	#AI_IDN_ALLOW_UNASSIGNED
 0x0100

	)

612 
	#AI_IDN_USE_STD3_ASCII_RULES
 0x0200

	)

615 
	#AI_NUMERICSERV
 0x0400

	)

618 
	#EAI_BADFLAGS
 -1

	)

619 
	#EAI_NONAME
 -2

	)

620 
	#EAI_AGAIN
 -3

	)

621 
	#EAI_FAIL
 -4

	)

622 
	#EAI_FAMILY
 -6

	)

623 
	#EAI_SOCKTYPE
 -7

	)

624 
	#EAI_SERVICE
 -8

	)

625 
	#EAI_MEMORY
 -10

	)

626 
	#EAI_SYSTEM
 -11

	)

627 
	#EAI_OVERFLOW
 -12

	)

628 #ifdeà
__USE_GNU


629 
	#EAI_NODATA
 -5

	)

630 
	#EAI_ADDRFAMILY
 -9

	)

631 
	#EAI_INPROGRESS
 -100

	)

632 
	#EAI_CANCELED
 -101

	)

633 
	#EAI_NOTCANCELED
 -102

	)

634 
	#EAI_ALLDONE
 -103

	)

635 
	#EAI_INTR
 -104

	)

636 
	#EAI_IDN_ENCODE
 -105

	)

639 #ifdeà
__USE_MISC


640 
	#NI_MAXHOST
 1025

	)

641 
	#NI_MAXSERV
 32

	)

644 
	#NI_NUMERICHOST
 1

	)

645 
	#NI_NUMERICSERV
 2

	)

646 
	#NI_NOFQDN
 4

	)

647 
	#NI_NAMEREQD
 8

	)

648 
	#NI_DGRAM
 16

	)

649 #ifdeà
__USE_GNU


650 
	#NI_IDN
 32

	)

651 
	#NI_IDN_ALLOW_UNASSIGNED
 64

	)

653 
	#NI_IDN_USE_STD3_ASCII_RULES
 128

	)

662 
	`g‘addršfo
 (cÚ¡ *
__»¡riù
 
__Çme
,

663 cÚ¡ *
__»¡riù
 
__£rviû
,

664 cÚ¡ 
addršfo
 *
__»¡riù
 
__»q
,

665 
addršfo
 **
__»¡riù
 
__·i
);

668 
	$ä“addršfo
 (
addršfo
 *
__ai
è
__THROW
;

671 cÚ¡ *
	$gai_¡»¼Ü
 (
__ecode
è
__THROW
;

677 
	`g‘Çmešfo
 (cÚ¡ 
sockaddr
 *
__»¡riù
 
__§
,

678 
sockËn_t
 
__§Ën
, *
__»¡riù
 
__ho¡
,

679 
sockËn_t
 
__ho¡Ën
, *
__»¡riù
 
__£rv
,

680 
sockËn_t
 
__£rvËn
, 
__æags
);

683 #ifdeà
__USE_GNU


692 
	`g‘addršfo_a
 (
__mode
, 
gaicb
 *
__li¡
[
__»¡riù_¬r
],

693 
__’t
, 
sigev’t
 *
__»¡riù
 
__sig
);

703 
	`gai_su¥’d
 (cÚ¡ 
gaicb
 *cÚ¡ 
__li¡
[], 
__’t
,

704 cÚ¡ 
time¥ec
 *
__timeout
);

707 
	$gai_”rÜ
 (
gaicb
 *
__»q
è
__THROW
;

710 
	$gai_ÿnûl
 (
gaicb
 *
__gaicbp
è
__THROW
;

713 
__END_DECLS


	@/usr/include/netinet/in.h

18 #iâdef 
_NETINET_IN_H


19 
	#_NETINET_IN_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<¡dšt.h
>

23 
	~<sys/sock‘.h
>

24 
	~<b™s/ty³s.h
>

27 
__BEGIN_DECLS


30 
ušt32_t
 
	tš_addr_t
;

31 
	sš_addr


33 
š_addr_t
 
	ms_addr
;

37 
	~<b™s/š.h
>

42 
	mIPPROTO_IP
 = 0,

43 
	#IPPROTO_IP
 
IPPROTO_IP


	)

44 
	mIPPROTO_ICMP
 = 1,

45 
	#IPPROTO_ICMP
 
IPPROTO_ICMP


	)

46 
	mIPPROTO_IGMP
 = 2,

47 
	#IPPROTO_IGMP
 
IPPROTO_IGMP


	)

48 
	mIPPROTO_IPIP
 = 4,

49 
	#IPPROTO_IPIP
 
IPPROTO_IPIP


	)

50 
	mIPPROTO_TCP
 = 6,

51 
	#IPPROTO_TCP
 
IPPROTO_TCP


	)

52 
	mIPPROTO_EGP
 = 8,

53 
	#IPPROTO_EGP
 
IPPROTO_EGP


	)

54 
	mIPPROTO_PUP
 = 12,

55 
	#IPPROTO_PUP
 
IPPROTO_PUP


	)

56 
	mIPPROTO_UDP
 = 17,

57 
	#IPPROTO_UDP
 
IPPROTO_UDP


	)

58 
	mIPPROTO_IDP
 = 22,

59 
	#IPPROTO_IDP
 
IPPROTO_IDP


	)

60 
	mIPPROTO_TP
 = 29,

61 
	#IPPROTO_TP
 
IPPROTO_TP


	)

62 
	mIPPROTO_DCCP
 = 33,

63 
	#IPPROTO_DCCP
 
IPPROTO_DCCP


	)

64 
	mIPPROTO_IPV6
 = 41,

65 
	#IPPROTO_IPV6
 
IPPROTO_IPV6


	)

66 
	mIPPROTO_RSVP
 = 46,

67 
	#IPPROTO_RSVP
 
IPPROTO_RSVP


	)

68 
	mIPPROTO_GRE
 = 47,

69 
	#IPPROTO_GRE
 
IPPROTO_GRE


	)

70 
	mIPPROTO_ESP
 = 50,

71 
	#IPPROTO_ESP
 
IPPROTO_ESP


	)

72 
	mIPPROTO_AH
 = 51,

73 
	#IPPROTO_AH
 
IPPROTO_AH


	)

74 
	mIPPROTO_MTP
 = 92,

75 
	#IPPROTO_MTP
 
IPPROTO_MTP


	)

76 
	mIPPROTO_BEETPH
 = 94,

77 
	#IPPROTO_BEETPH
 
IPPROTO_BEETPH


	)

78 
	mIPPROTO_ENCAP
 = 98,

79 
	#IPPROTO_ENCAP
 
IPPROTO_ENCAP


	)

80 
	mIPPROTO_PIM
 = 103,

81 
	#IPPROTO_PIM
 
IPPROTO_PIM


	)

82 
	mIPPROTO_COMP
 = 108,

83 
	#IPPROTO_COMP
 
IPPROTO_COMP


	)

84 
	mIPPROTO_SCTP
 = 132,

85 
	#IPPROTO_SCTP
 
IPPROTO_SCTP


	)

86 
	mIPPROTO_UDPLITE
 = 136,

87 
	#IPPROTO_UDPLITE
 
IPPROTO_UDPLITE


	)

88 
	mIPPROTO_MPLS
 = 137,

89 
	#IPPROTO_MPLS
 
IPPROTO_MPLS


	)

90 
	mIPPROTO_RAW
 = 255,

91 
	#IPPROTO_RAW
 
IPPROTO_RAW


	)

92 
	mIPPROTO_MAX


98 #ià!
__USE_KERNEL_IPV6_DEFS


101 
	mIPPROTO_HOPOPTS
 = 0,

102 
	#IPPROTO_HOPOPTS
 
IPPROTO_HOPOPTS


	)

103 
	mIPPROTO_ROUTING
 = 43,

104 
	#IPPROTO_ROUTING
 
IPPROTO_ROUTING


	)

105 
	mIPPROTO_FRAGMENT
 = 44,

106 
	#IPPROTO_FRAGMENT
 
IPPROTO_FRAGMENT


	)

107 
	mIPPROTO_ICMPV6
 = 58,

108 
	#IPPROTO_ICMPV6
 
IPPROTO_ICMPV6


	)

109 
	mIPPROTO_NONE
 = 59,

110 
	#IPPROTO_NONE
 
IPPROTO_NONE


	)

111 
	mIPPROTO_DSTOPTS
 = 60,

112 
	#IPPROTO_DSTOPTS
 
IPPROTO_DSTOPTS


	)

113 
	mIPPROTO_MH
 = 135

114 
	#IPPROTO_MH
 
IPPROTO_MH


	)

119 
ušt16_t
 
	tš_pÜt_t
;

124 
	mIPPORT_ECHO
 = 7,

125 
	mIPPORT_DISCARD
 = 9,

126 
	mIPPORT_SYSTAT
 = 11,

127 
	mIPPORT_DAYTIME
 = 13,

128 
	mIPPORT_NETSTAT
 = 15,

129 
	mIPPORT_FTP
 = 21,

130 
	mIPPORT_TELNET
 = 23,

131 
	mIPPORT_SMTP
 = 25,

132 
	mIPPORT_TIMESERVER
 = 37,

133 
	mIPPORT_NAMESERVER
 = 42,

134 
	mIPPORT_WHOIS
 = 43,

135 
	mIPPORT_MTP
 = 57,

137 
	mIPPORT_TFTP
 = 69,

138 
	mIPPORT_RJE
 = 77,

139 
	mIPPORT_FINGER
 = 79,

140 
	mIPPORT_TTYLINK
 = 87,

141 
	mIPPORT_SUPDUP
 = 95,

144 
	mIPPORT_EXECSERVER
 = 512,

145 
	mIPPORT_LOGINSERVER
 = 513,

146 
	mIPPORT_CMDSERVER
 = 514,

147 
	mIPPORT_EFSSERVER
 = 520,

150 
	mIPPORT_BIFFUDP
 = 512,

151 
	mIPPORT_WHOSERVER
 = 513,

152 
	mIPPORT_ROUTESERVER
 = 520,

155 
	mIPPORT_RESERVED
 = 1024,

158 
	mIPPORT_USERRESERVED
 = 5000

166 
	#IN_CLASSA
(
a
è((((
š_addr_t
)×)è& 0x80000000è=ğ0)

	)

167 
	#IN_CLASSA_NET
 0xff000000

	)

168 
	#IN_CLASSA_NSHIFT
 24

	)

169 
	#IN_CLASSA_HOST
 (0xfffffffà& ~
IN_CLASSA_NET
)

	)

170 
	#IN_CLASSA_MAX
 128

	)

172 
	#IN_CLASSB
(
a
è((((
š_addr_t
)×)è& 0xc0000000è=ğ0x80000000)

	)

173 
	#IN_CLASSB_NET
 0xffff0000

	)

174 
	#IN_CLASSB_NSHIFT
 16

	)

175 
	#IN_CLASSB_HOST
 (0xfffffffà& ~
IN_CLASSB_NET
)

	)

176 
	#IN_CLASSB_MAX
 65536

	)

178 
	#IN_CLASSC
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xc0000000)

	)

179 
	#IN_CLASSC_NET
 0xffffff00

	)

180 
	#IN_CLASSC_NSHIFT
 8

	)

181 
	#IN_CLASSC_HOST
 (0xfffffffà& ~
IN_CLASSC_NET
)

	)

183 
	#IN_CLASSD
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xe0000000)

	)

184 
	#IN_MULTICAST
(
a
è
	`IN_CLASSD
×)

	)

186 
	#IN_EXPERIMENTAL
(
a
è((((
š_addr_t
)×)è& 0xe0000000è=ğ0xe0000000)

	)

187 
	#IN_BADCLASS
(
a
è((((
š_addr_t
)×)è& 0xf0000000è=ğ0xf0000000)

	)

190 
	#INADDR_ANY
 ((
š_addr_t
è0x00000000)

	)

192 
	#INADDR_BROADCAST
 ((
š_addr_t
è0xffffffff)

	)

194 
	#INADDR_NONE
 ((
š_addr_t
è0xffffffff)

	)

197 
	#IN_LOOPBACKNET
 127

	)

199 #iâdeà
INADDR_LOOPBACK


200 
	#INADDR_LOOPBACK
 ((
š_addr_t
è0x7f000001è

	)

204 
	#INADDR_UNSPEC_GROUP
 ((
š_addr_t
è0xe0000000è

	)

205 
	#INADDR_ALLHOSTS_GROUP
 ((
š_addr_t
è0xe0000001è

	)

206 
	#INADDR_ALLRTRS_GROUP
 ((
š_addr_t
è0xe0000002è

	)

207 
	#INADDR_MAX_LOCAL_GROUP
 ((
š_addr_t
è0xe00000ffè

	)

209 #ià!
__USE_KERNEL_IPV6_DEFS


211 
	sš6_addr


215 
ušt8_t
 
	m__u6_addr8
[16];

216 #ifdeà
__USE_MISC


217 
ušt16_t
 
	m__u6_addr16
[8];

218 
ušt32_t
 
	m__u6_addr32
[4];

220 } 
	m__š6_u
;

221 
	#s6_addr
 
__š6_u
.
__u6_addr8


	)

222 #ifdeà
__USE_MISC


223 
	#s6_addr16
 
__š6_u
.
__u6_addr16


	)

224 
	#s6_addr32
 
__š6_u
.
__u6_addr32


	)

229 cÚ¡ 
š6_addr
 
š6addr_ªy
;

230 cÚ¡ 
š6_addr
 
š6addr_loİback
;

231 
	#IN6ADDR_ANY_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 } } }

	)

232 
	#IN6ADDR_LOOPBACK_INIT
 { { { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 } } }

	)

234 
	#INET_ADDRSTRLEN
 16

	)

235 
	#INET6_ADDRSTRLEN
 46

	)

239 
	ssockaddr_š


241 
__SOCKADDR_COMMON
 (
sš_
);

242 
š_pÜt_t
 
	msš_pÜt
;

243 
š_addr
 
	msš_addr
;

246 
	msš_z”o
[ (
sockaddr
) -

247 
__SOCKADDR_COMMON_SIZE
 -

248  (
š_pÜt_t
) -

249  (
š_addr
)];

252 #ià!
__USE_KERNEL_IPV6_DEFS


254 
	ssockaddr_š6


256 
__SOCKADDR_COMMON
 (
sš6_
);

257 
š_pÜt_t
 
	msš6_pÜt
;

258 
ušt32_t
 
	msš6_æowšfo
;

259 
š6_addr
 
	msš6_addr
;

260 
ušt32_t
 
	msš6_scİe_id
;

264 #ifdeà
__USE_MISC


266 
	s_m»q


269 
š_addr
 
	mimr_muÉŸddr
;

272 
š_addr
 
	mimr_š‹rçû
;

275 
	s_m»q_sourû


278 
š_addr
 
	mimr_muÉŸddr
;

281 
š_addr
 
	mimr_š‹rçû
;

284 
š_addr
 
	mimr_sourûaddr
;

288 #ià!
__USE_KERNEL_IPV6_DEFS


290 
	sv6_m»q


293 
š6_addr
 
	mv6mr_muÉŸddr
;

296 
	mv6mr_š‹rçû
;

300 #ifdeà
__USE_MISC


302 
	sgroup_»q


305 
ušt32_t
 
	mgr_š‹rçû
;

308 
sockaddr_¡Üage
 
	mgr_group
;

311 
	sgroup_sourû_»q


314 
ušt32_t
 
	mg¤_š‹rçû
;

317 
sockaddr_¡Üage
 
	mg¤_group
;

320 
sockaddr_¡Üage
 
	mg¤_sourû
;

325 
	s_msf‹r


328 
š_addr
 
	mimsf_muÉŸddr
;

331 
š_addr
 
	mimsf_š‹rçû
;

334 
ušt32_t
 
	mimsf_fmode
;

337 
ušt32_t
 
	mimsf_num¤c
;

339 
š_addr
 
	mimsf_¦i¡
[1];

342 
	#IP_MSFILTER_SIZE
(
num¤c
è( (
_msf‹r
) \

343 -  (
š_addr
) \

344 + (
num¤c
è*  (
š_addr
))

	)

346 
	sgroup_f‹r


349 
ušt32_t
 
	mgf_š‹rçû
;

352 
sockaddr_¡Üage
 
	mgf_group
;

355 
ušt32_t
 
	mgf_fmode
;

358 
ušt32_t
 
	mgf_num¤c
;

360 
sockaddr_¡Üage
 
	mgf_¦i¡
[1];

363 
	#GROUP_FILTER_SIZE
(
num¤c
è( (
group_f‹r
) \

364 -  (
sockaddr_¡Üage
) \

365 + ((
num¤c
) \

366 *  (
sockaddr_¡Üage
)))

	)

376 
ušt32_t
 
	$Áohl
 (
ušt32_t
 
__ÃÚg
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

377 
ušt16_t
 
	$Áohs
 (
ušt16_t
 
__ÃtshÜt
)

378 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

379 
ušt32_t
 
	$htÚl
 (
ušt32_t
 
__ho¡lÚg
)

380 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

381 
ušt16_t
 
	$htÚs
 (
ušt16_t
 
__ho¡shÜt
)

382 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

384 
	~<’dŸn.h
>

387 
	~<b™s/by‹sw­.h
>

389 #ifdeà
__OPTIMIZE__


393 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


396 
	#Áohl
(
x
è(x)

	)

397 
	#Áohs
(
x
è(x)

	)

398 
	#htÚl
(
x
è(x)

	)

399 
	#htÚs
(
x
è(x)

	)

401 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


402 
	#Áohl
(
x
è
	`__bsw­_32
 (x)

	)

403 
	#Áohs
(
x
è
	`__bsw­_16
 (x)

	)

404 
	#htÚl
(
x
è
	`__bsw­_32
 (x)

	)

405 
	#htÚs
(
x
è
	`__bsw­_16
 (x)

	)

410 #ifdeà
__GNUC__


411 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

412 (
__ex‹nsiÚ__
 \

413 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

414 
__a
->
s6_addr32
[0] == 0 \

415 && 
__a
->
s6_addr32
[1] == 0 \

416 && 
__a
->
s6_addr32
[2] == 0 \

417 && 
__a
->
s6_addr32
[3] =ğ0; 
	}
}))

	)

419 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

420 (
__ex‹nsiÚ__
 \

421 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

422 
__a
->
s6_addr32
[0] == 0 \

423 && 
__a
->
s6_addr32
[1] == 0 \

424 && 
__a
->
s6_addr32
[2] == 0 \

425 && 
__a
->
s6_addr32
[3] =ğ
	`htÚl
 (1); }))

	)

427 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

428 (
__ex‹nsiÚ__
 \

429 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

430 (
__a
->
s6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xã800000); }))

	)

432 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

433 (
__ex‹nsiÚ__
 \

434 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

435 (
__a
->
s6_addr32
[0] & 
	`htÚl
 (0xffc00000)è=ğhtÚÈ(0xãc00000); }))

	)

437 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

438 (
__ex‹nsiÚ__
 \

439 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

440 
__a
->
s6_addr32
[0] == 0 \

441 && 
__a
->
s6_addr32
[1] == 0 \

442 && 
__a
->
s6_addr32
[2] =ğ
	`htÚl
 (0xffff); }))

	)

444 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

445 (
__ex‹nsiÚ__
 \

446 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

447 
__a
->
s6_addr32
[0] == 0 \

448 && 
__a
->
s6_addr32
[1] == 0 \

449 && 
__a
->
s6_addr32
[2] == 0 \

450 && 
	`Áohl
 (
__a
->
s6_addr32
[3]è> 1; }))

	)

452 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

453 (
__ex‹nsiÚ__
 \

454 ({ cÚ¡ 
š6_addr
 *
__a
 = (cÚ¡ š6_add¸*è(
a
); \

455 cÚ¡ 
š6_addr
 *
__b
 = (cÚ¡ š6_add¸*è(
b
); \

456 
__a
->
s6_addr32
[0] =ğ
__b
->s6_addr32[0] \

457 && 
__a
->
s6_addr32
[1] =ğ
__b
->s6_addr32[1] \

458 && 
__a
->
s6_addr32
[2] =ğ
__b
->s6_addr32[2] \

459 && 
__a
->
s6_addr32
[3] =ğ
__b
->s6_addr32[3]; }))

	)

461 
	#IN6_IS_ADDR_UNSPECIFIED
(
a
) \

462 (((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0 \

463 && ((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0 \

464 && ((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0 \

465 && ((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ0)

	)

467 
	#IN6_IS_ADDR_LOOPBACK
(
a
) \

468 (((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0 \

469 && ((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0 \

470 && ((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0 \

471 && ((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ
	`htÚl
 (1))

	)

473 
	#IN6_IS_ADDR_LINKLOCAL
(
a
) \

474 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

475 =ğ
	`htÚl
 (0xã800000))

	)

477 
	#IN6_IS_ADDR_SITELOCAL
(
a
) \

478 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] & 
	`htÚl
 (0xffc00000)) \

479 =ğ
	`htÚl
 (0xãc00000))

	)

481 
	#IN6_IS_ADDR_V4MAPPED
(
a
) \

482 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0) \

483 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0) \

484 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] =ğ
	`htÚl
 (0xffff)))

	)

486 
	#IN6_IS_ADDR_V4COMPAT
(
a
) \

487 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] == 0) \

488 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] == 0) \

489 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] == 0) \

490 && (
	`Áohl
 (((cÚ¡ 
ušt32_t
 *è(
a
))[3]è> 1))

	)

492 
	#IN6_ARE_ADDR_EQUAL
(
a
,
b
) \

493 ((((cÚ¡ 
ušt32_t
 *è(
a
))[0] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[0]) \

494 && (((cÚ¡ 
ušt32_t
 *è(
a
))[1] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[1]) \

495 && (((cÚ¡ 
ušt32_t
 *è(
a
))[2] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[2]) \

496 && (((cÚ¡ 
ušt32_t
 *è(
a
))[3] =ğ((cÚ¡ ušt32_ˆ*è(
b
))[3]))

	)

499 
	#IN6_IS_ADDR_MULTICAST
(
a
è(((cÚ¡ 
ušt8_t
 *è×))[0] =ğ0xff)

	)

501 #ifdeà
__USE_MISC


503 
	$bšd»svpÜt
 (
__sockfd
, 
sockaddr_š
 *
__sock_š
è
__THROW
;

506 
	$bšd»svpÜt6
 (
__sockfd
, 
sockaddr_š6
 *
__sock_š
)

507 
__THROW
;

511 
	#IN6_IS_ADDR_MC_NODELOCAL
(
a
) \

512 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

513 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x1))

	)

515 
	#IN6_IS_ADDR_MC_LINKLOCAL
(
a
) \

516 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

517 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x2))

	)

519 
	#IN6_IS_ADDR_MC_SITELOCAL
(
a
) \

520 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

521 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x5))

	)

523 
	#IN6_IS_ADDR_MC_ORGLOCAL
(
a
) \

524 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

525 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0x8))

	)

527 
	#IN6_IS_ADDR_MC_GLOBAL
(
a
) \

528 (
	`IN6_IS_ADDR_MULTICAST
(
a
) \

529 && ((((cÚ¡ 
ušt8_t
 *è(
a
))[1] & 0xfè=ğ0xe))

	)

532 #ifdeà
__USE_GNU


533 
cmsghdr
;

535 #ià!
__USE_KERNEL_IPV6_DEFS


537 
	sš6_pktšfo


539 
š6_addr
 
i6_addr
;

540 
i6_ifšdex
;

544 
	s6_mtušfo


546 
sockaddr_š6
 
6m_addr
;

547 
ušt32_t
 
6m_mtu
;

552 
	$š‘6_İtiÚ_¥aû
 (
__nby‹s
)

553 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

554 
	$š‘6_İtiÚ_š™
 (*
__bp
, 
cmsghdr
 **
__cmsgp
,

555 
__ty³
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

556 
	$š‘6_İtiÚ_­³nd
 (
cmsghdr
 *
__cmsg
,

557 cÚ¡ 
ušt8_t
 *
__ty³p
, 
__muÉx
,

558 
__¶usy
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

559 
ušt8_t
 *
	$š‘6_İtiÚ_®loc
 (
cmsghdr
 *
__cmsg
, 
__d©®’
,

560 
__muÉx
, 
__¶usy
)

561 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

562 
	$š‘6_İtiÚ_Ãxt
 (cÚ¡ 
cmsghdr
 *
__cmsg
,

563 
ušt8_t
 **
__Œp
)

564 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

565 
	$š‘6_İtiÚ_fšd
 (cÚ¡ 
cmsghdr
 *
__cmsg
,

566 
ušt8_t
 **
__Œp
, 
__ty³
)

567 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

571 
	$š‘6_İt_š™
 (*
__extbuf
, 
sockËn_t
 
__ex’
è
__THROW
;

572 
	$š‘6_İt_­³nd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

573 
ušt8_t
 
__ty³
, 
sockËn_t
 
__Ën
, ušt8_ˆ
__®ign
,

574 **
__d©abuå
è
__THROW
;

575 
	$š‘6_İt_fšish
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
)

576 
__THROW
;

577 
	$š‘6_İt_£t_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

578 
sockËn_t
 
__v®Ën
è
__THROW
;

579 
	$š‘6_İt_Ãxt
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

580 
ušt8_t
 *
__ty³p
, 
sockËn_t
 *
__ËÅ
,

581 **
__d©abuå
è
__THROW
;

582 
	$š‘6_İt_fšd
 (*
__extbuf
, 
sockËn_t
 
__ex’
, 
__off£t
,

583 
ušt8_t
 
__ty³
, 
sockËn_t
 *
__ËÅ
,

584 **
__d©abuå
è
__THROW
;

585 
	$š‘6_İt_g‘_v®
 (*
__d©abuf
, 
__off£t
, *
__v®
,

586 
sockËn_t
 
__v®Ën
è
__THROW
;

590 
sockËn_t
 
	$š‘6_¹h_¥aû
 (
__ty³
, 
__£gm’ts
è
__THROW
;

591 *
	$š‘6_¹h_š™
 (*
__bp
, 
sockËn_t
 
__bp_Ën
, 
__ty³
,

592 
__£gm’ts
è
__THROW
;

593 
	$š‘6_¹h_add
 (*
__bp
, cÚ¡ 
š6_addr
 *
__addr
è
__THROW
;

594 
	$š‘6_¹h_»v”£
 (cÚ¡ *
__š
, *
__out
è
__THROW
;

595 
	$š‘6_¹h_£gm’ts
 (cÚ¡ *
__bp
è
__THROW
;

596 
š6_addr
 *
	$š‘6_¹h_g‘addr
 (cÚ¡ *
__bp
, 
__šdex
)

597 
__THROW
;

603 
	$g‘v4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

604 
š_addr
 
__group
, 
ušt32_t
 *
__fmode
,

605 
ušt32_t
 *
__num¤c
, 
š_addr
 *
__¦i¡
)

606 
__THROW
;

609 
	$£tv4sourûf‹r
 (
__s
, 
š_addr
 
__š‹rçû_addr
,

610 
š_addr
 
__group
, 
ušt32_t
 
__fmode
,

611 
ušt32_t
 
__num¤c
,

612 cÚ¡ 
š_addr
 *
__¦i¡
)

613 
__THROW
;

617 
	$g‘sourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

618 cÚ¡ 
sockaddr
 *
__group
,

619 
sockËn_t
 
__grou¶’
, 
ušt32_t
 *
__fmode
,

620 
ušt32_t
 *
__num¤c
,

621 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

624 
	$£tsourûf‹r
 (
__s
, 
ušt32_t
 
__š‹rçû_addr
,

625 cÚ¡ 
sockaddr
 *
__group
,

626 
sockËn_t
 
__grou¶’
, 
ušt32_t
 
__fmode
,

627 
ušt32_t
 
__num¤c
,

628 cÚ¡ 
sockaddr_¡Üage
 *
__¦i¡
è
__THROW
;

631 
__END_DECLS


	@/usr/include/netinet/tcp.h

32 #iâdeà
_NETINET_TCP_H


33 
	#_NETINET_TCP_H
 1

	)

35 
	~<ã©u»s.h
>

40 
	#TCP_NODELAY
 1

	)

41 
	#TCP_MAXSEG
 2

	)

42 
	#TCP_CORK
 3

	)

43 
	#TCP_KEEPIDLE
 4

	)

44 
	#TCP_KEEPINTVL
 5

	)

45 
	#TCP_KEEPCNT
 6

	)

46 
	#TCP_SYNCNT
 7

	)

47 
	#TCP_LINGER2
 8

	)

48 
	#TCP_DEFER_ACCEPT
 9

	)

49 
	#TCP_WINDOW_CLAMP
 10

	)

50 
	#TCP_INFO
 11

	)

51 
	#TCP_QUICKACK
 12

	)

52 
	#TCP_CONGESTION
 13

	)

53 
	#TCP_MD5SIG
 14

	)

54 
	#TCP_COOKIE_TRANSACTIONS
 15

	)

55 
	#TCP_THIN_LINEAR_TIMEOUTS
 16

	)

56 
	#TCP_THIN_DUPACK
 17

	)

57 
	#TCP_USER_TIMEOUT
 18

	)

58 
	#TCP_REPAIR
 19

	)

59 
	#TCP_REPAIR_QUEUE
 20

	)

60 
	#TCP_QUEUE_SEQ
 21

	)

61 
	#TCP_REPAIR_OPTIONS
 22

	)

62 
	#TCP_FASTOPEN
 23

	)

63 
	#TCP_TIMESTAMP
 24

	)

64 
	#TCP_NOTSENT_LOWAT
 25

	)

66 
	#TCP_CC_INFO
 26

	)

68 
	#TCP_SAVE_SYN
 27

	)

70 
	#TCP_SAVED_SYN
 28

	)

73 #ifdeà
__USE_MISC


74 
	~<sys/ty³s.h
>

75 
	~<sys/sock‘.h
>

77 
u_št32_t
 
	ttı_£q
;

82 
	stıhdr


84 
__ex‹nsiÚ__
 union

88 
u_št16_t
 
	mth_¥Üt
;

89 
u_št16_t
 
	mth_dpÜt
;

90 
tı_£q
 
	mth_£q
;

91 
tı_£q
 
	mth_ack
;

92 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


93 
u_št8_t
 
	mth_x2
:4;

94 
u_št8_t
 
	mth_off
:4;

96 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


97 
u_št8_t
 
	mth_off
:4;

98 
u_št8_t
 
	mth_x2
:4;

100 
u_št8_t
 
	mth_æags
;

101 
	#TH_FIN
 0x01

	)

102 
	#TH_SYN
 0x02

	)

103 
	#TH_RST
 0x04

	)

104 
	#TH_PUSH
 0x08

	)

105 
	#TH_ACK
 0x10

	)

106 
	#TH_URG
 0x20

	)

107 
u_št16_t
 
	mth_wš
;

108 
u_št16_t
 
	mth_sum
;

109 
u_št16_t
 
	mth_u½
;

113 
u_št16_t
 
	msourû
;

114 
u_št16_t
 
	mde¡
;

115 
u_št32_t
 
	m£q
;

116 
u_št32_t
 
	mack_£q
;

117 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


118 
u_št16_t
 
	m»s1
:4;

119 
u_št16_t
 
	mdoff
:4;

120 
u_št16_t
 
	mfš
:1;

121 
u_št16_t
 
	msyn
:1;

122 
u_št16_t
 
	mr¡
:1;

123 
u_št16_t
 
	mpsh
:1;

124 
u_št16_t
 
	mack
:1;

125 
u_št16_t
 
	murg
:1;

126 
u_št16_t
 
	m»s2
:2;

127 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


128 
u_št16_t
 
	mdoff
:4;

129 
u_št16_t
 
	m»s1
:4;

130 
u_št16_t
 
	m»s2
:2;

131 
u_št16_t
 
	murg
:1;

132 
u_št16_t
 
	mack
:1;

133 
u_št16_t
 
	mpsh
:1;

134 
u_št16_t
 
	mr¡
:1;

135 
u_št16_t
 
	msyn
:1;

136 
u_št16_t
 
	mfš
:1;

140 
u_št16_t
 
	mwšdow
;

141 
u_št16_t
 
	mcheck
;

142 
u_št16_t
 
	murg_±r
;

149 
	mTCP_ESTABLISHED
 = 1,

150 
	mTCP_SYN_SENT
,

151 
	mTCP_SYN_RECV
,

152 
	mTCP_FIN_WAIT1
,

153 
	mTCP_FIN_WAIT2
,

154 
	mTCP_TIME_WAIT
,

155 
	mTCP_CLOSE
,

156 
	mTCP_CLOSE_WAIT
,

157 
	mTCP_LAST_ACK
,

158 
	mTCP_LISTEN
,

159 
	mTCP_CLOSING


162 
	#TCPOPT_EOL
 0

	)

163 
	#TCPOPT_NOP
 1

	)

164 
	#TCPOPT_MAXSEG
 2

	)

165 
	#TCPOLEN_MAXSEG
 4

	)

166 
	#TCPOPT_WINDOW
 3

	)

167 
	#TCPOLEN_WINDOW
 3

	)

168 
	#TCPOPT_SACK_PERMITTED
 4

	)

169 
	#TCPOLEN_SACK_PERMITTED
 2

	)

170 
	#TCPOPT_SACK
 5

	)

171 
	#TCPOPT_TIMESTAMP
 8

	)

172 
	#TCPOLEN_TIMESTAMP
 10

	)

173 
	#TCPOLEN_TSTAMP_APPA
 (
TCPOLEN_TIMESTAMP
+2è

	)

175 
	#TCPOPT_TSTAMP_HDR
 \

176 (
TCPOPT_NOP
<<24|TCPOPT_NOP<<16|
TCPOPT_TIMESTAMP
<<8|
TCPOLEN_TIMESTAMP
)

	)

184 
	#TCP_MSS
 512

	)

186 
	#TCP_MAXWIN
 65535

	)

188 
	#TCP_MAX_WINSHIFT
 14

	)

190 
	#SOL_TCP
 6

	)

193 
	#TCPI_OPT_TIMESTAMPS
 1

	)

194 
	#TCPI_OPT_SACK
 2

	)

195 
	#TCPI_OPT_WSCALE
 4

	)

196 
	#TCPI_OPT_ECN
 8

	)

197 
	#TCPI_OPT_ECN_SEEN
 16

	)

198 
	#TCPI_OPT_SYN_DATA
 32

	)

201 
	etı_ÿ_¡©e


203 
	mTCP_CA_O³n
 = 0,

204 
	mTCP_CA_DisÜd”
 = 1,

205 
	mTCP_CA_CWR
 = 2,

206 
	mTCP_CA_Recov”y
 = 3,

207 
	mTCP_CA_Loss
 = 4

210 
	stı_šfo


212 
u_št8_t
 
	mtıi_¡©e
;

213 
u_št8_t
 
	mtıi_ÿ_¡©e
;

214 
u_št8_t
 
	mtıi_»Œªsm™s
;

215 
u_št8_t
 
	mtıi_´obes
;

216 
u_št8_t
 
	mtıi_backoff
;

217 
u_št8_t
 
	mtıi_İtiÚs
;

218 
u_št8_t
 
	mtıi_¢d_wsÿË
 : 4, 
	mtıi_rcv_wsÿË
 : 4;

220 
u_št32_t
 
	mtıi_¹o
;

221 
u_št32_t
 
	mtıi_©o
;

222 
u_št32_t
 
	mtıi_¢d_mss
;

223 
u_št32_t
 
	mtıi_rcv_mss
;

225 
u_št32_t
 
	mtıi_uÇcked
;

226 
u_št32_t
 
	mtıi_§cked
;

227 
u_št32_t
 
	mtıi_lo¡
;

228 
u_št32_t
 
	mtıi_»Œªs
;

229 
u_št32_t
 
	mtıi_çck‘s
;

232 
u_št32_t
 
	mtıi_Ï¡_d©a_£Á
;

233 
u_št32_t
 
	mtıi_Ï¡_ack_£Á
;

234 
u_št32_t
 
	mtıi_Ï¡_d©a_»cv
;

235 
u_št32_t
 
	mtıi_Ï¡_ack_»cv
;

238 
u_št32_t
 
	mtıi_pmtu
;

239 
u_št32_t
 
	mtıi_rcv_s¡h»sh
;

240 
u_št32_t
 
	mtıi_¹t
;

241 
u_št32_t
 
	mtıi_¹tv¬
;

242 
u_št32_t
 
	mtıi_¢d_s¡h»sh
;

243 
u_št32_t
 
	mtıi_¢d_cwnd
;

244 
u_št32_t
 
	mtıi_advmss
;

245 
u_št32_t
 
	mtıi_»Üd”šg
;

247 
u_št32_t
 
	mtıi_rcv_¹t
;

248 
u_št32_t
 
	mtıi_rcv_¥aû
;

250 
u_št32_t
 
	mtıi_tÙ®_»Œªs
;

255 
	#TCP_MD5SIG_MAXKEYLEN
 80

	)

257 
	stı_md5sig


259 
sockaddr_¡Üage
 
	mtım_addr
;

260 
u_št16_t
 
	m__tım_·d1
;

261 
u_št16_t
 
	mtım_keyËn
;

262 
u_št32_t
 
	m__tım_·d2
;

263 
u_št8_t
 
	mtım_key
[
TCP_MD5SIG_MAXKEYLEN
];

267 
	stı_»·œ_İt


269 
u_št32_t
 
	mİt_code
;

270 
u_št32_t
 
	mİt_v®
;

276 
	mTCP_NO_QUEUE
,

277 
	mTCP_RECV_QUEUE
,

278 
	mTCP_SEND_QUEUE
,

279 
	mTCP_QUEUES_NR
,

283 
	#TCP_COOKIE_MIN
 8

	)

284 
	#TCP_COOKIE_MAX
 16

	)

285 
	#TCP_COOKIE_PAIR_SIZE
 (2*
TCP_COOKIE_MAX
)

	)

288 
	#TCP_COOKIE_IN_ALWAYS
 (1 << 0è

	)

289 
	#TCP_COOKIE_OUT_NEVER
 (1 << 1è

	)

293 
	#TCP_S_DATA_IN
 (1 << 2è

	)

294 
	#TCP_S_DATA_OUT
 (1 << 3è

	)

296 
	#TCP_MSS_DEFAULT
 536U

	)

297 
	#TCP_MSS_DESIRED
 1220U

	)

299 
	stı_cook›_Œª§ùiÚs


301 
u_št16_t
 
	mtıù_æags
;

302 
u_št8_t
 
	m__tıù_·d1
;

303 
u_št8_t
 
	mtıù_cook›_desœed
;

304 
u_št16_t
 
	mtıù_s_d©a_desœed
;

305 
u_št16_t
 
	mtıù_u£d
;

306 
u_št8_t
 
	mtıù_v®ue
[
TCP_MSS_DEFAULT
];

	@/usr/include/netpacket/packet.h

19 #iâdeà
__NETPACKET_PACKET_H


20 
	#__NETPACKET_PACKET_H
 1

	)

22 
	ssockaddr_Î


24 
	m¦l_çmy
;

25 
	m¦l_´ÙocŞ
;

26 
	m¦l_ifšdex
;

27 
	m¦l_h©y³
;

28 
	m¦l_pk‰y³
;

29 
	m¦l_h®’
;

30 
	m¦l_addr
[8];

35 
	#PACKET_HOST
 0

	)

36 
	#PACKET_BROADCAST
 1

	)

37 
	#PACKET_MULTICAST
 2

	)

38 
	#PACKET_OTHERHOST
 3

	)

39 
	#PACKET_OUTGOING
 4

	)

40 
	#PACKET_LOOPBACK
 5

	)

41 
	#PACKET_FASTROUTE
 6

	)

45 
	#PACKET_ADD_MEMBERSHIP
 1

	)

46 
	#PACKET_DROP_MEMBERSHIP
 2

	)

47 
	#PACKET_RECV_OUTPUT
 3

	)

48 
	#PACKET_RX_RING
 5

	)

49 
	#PACKET_STATISTICS
 6

	)

50 
	#PACKET_COPY_THRESH
 7

	)

51 
	#PACKET_AUXDATA
 8

	)

52 
	#PACKET_ORIGDEV
 9

	)

53 
	#PACKET_VERSION
 10

	)

54 
	#PACKET_HDRLEN
 11

	)

55 
	#PACKET_RESERVE
 12

	)

56 
	#PACKET_TX_RING
 13

	)

57 
	#PACKET_LOSS
 14

	)

58 
	#PACKET_VNET_HDR
 15

	)

59 
	#PACKET_TX_TIMESTAMP
 16

	)

60 
	#PACKET_TIMESTAMP
 17

	)

61 
	#PACKET_FANOUT
 18

	)

62 
	#PACKET_TX_HAS_OFF
 19

	)

63 
	#PACKET_QDISC_BYPASS
 20

	)

64 
	#PACKET_ROLLOVER_STATS
 21

	)

65 
	#PACKET_FANOUT_DATA
 22

	)

67 
	s·ck‘_m»q


69 
	mmr_ifšdex
;

70 
	mmr_ty³
;

71 
	mmr_®’
;

72 
	mmr_add»ss
[8];

75 
	#PACKET_MR_MULTICAST
 0

	)

76 
	#PACKET_MR_PROMISC
 1

	)

77 
	#PACKET_MR_ALLMULTI
 2

	)

78 
	#PACKET_MR_UNICAST
 3

	)

	@/usr/include/pthread.h

18 #iâdeà
_PTHREAD_H


19 
	#_PTHREAD_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<’dŸn.h
>

23 
	~<sched.h
>

24 
	~<time.h
>

26 
	~<b™s/±h»adty³s.h
>

27 
	~<b™s/£tjmp.h
>

28 
	~<b™s/wÜdsize.h
>

34 
	mPTHREAD_CREATE_JOINABLE
,

35 
	#PTHREAD_CREATE_JOINABLE
 
PTHREAD_CREATE_JOINABLE


	)

36 
	mPTHREAD_CREATE_DETACHED


37 
	#PTHREAD_CREATE_DETACHED
 
PTHREAD_CREATE_DETACHED


	)

44 
	mPTHREAD_MUTEX_TIMED_NP
,

45 
	mPTHREAD_MUTEX_RECURSIVE_NP
,

46 
	mPTHREAD_MUTEX_ERRORCHECK_NP
,

47 
	mPTHREAD_MUTEX_ADAPTIVE_NP


48 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


50 
	mPTHREAD_MUTEX_NORMAL
 = 
PTHREAD_MUTEX_TIMED_NP
,

51 
	mPTHREAD_MUTEX_RECURSIVE
 = 
PTHREAD_MUTEX_RECURSIVE_NP
,

52 
	mPTHREAD_MUTEX_ERRORCHECK
 = 
PTHREAD_MUTEX_ERRORCHECK_NP
,

53 
	mPTHREAD_MUTEX_DEFAULT
 = 
PTHREAD_MUTEX_NORMAL


55 #ifdeà
__USE_GNU


57 , 
	mPTHREAD_MUTEX_FAST_NP
 = 
PTHREAD_MUTEX_TIMED_NP


62 #ifdeà
__USE_XOPEN2K


66 
	mPTHREAD_MUTEX_STALLED
,

67 
	mPTHREAD_MUTEX_STALLED_NP
 = 
PTHREAD_MUTEX_STALLED
,

68 
	mPTHREAD_MUTEX_ROBUST
,

69 
	mPTHREAD_MUTEX_ROBUST_NP
 = 
PTHREAD_MUTEX_ROBUST


74 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


78 
	mPTHREAD_PRIO_NONE
,

79 
	mPTHREAD_PRIO_INHERIT
,

80 
	mPTHREAD_PRIO_PROTECT


85 #ifdeà
__PTHREAD_MUTEX_HAVE_PREV


86 
	#PTHREAD_MUTEX_INITIALIZER
 \

87 { { 0, 0, 0, 0, 0, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

88 #ifdeà
__USE_GNU


89 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

90 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

91 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

92 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

93 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

94 { { 0, 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 
__PTHREAD_SPINS
, { 0, 0 } } }

	)

98 
	#PTHREAD_MUTEX_INITIALIZER
 \

99 { { 0, 0, 0, 0, 0, { 
__PTHREAD_SPINS
 } } }

	)

100 #ifdeà
__USE_GNU


101 
	#PTHREAD_RECURSIVE_MUTEX_INITIALIZER_NP
 \

102 { { 0, 0, 0, 
PTHREAD_MUTEX_RECURSIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

103 
	#PTHREAD_ERRORCHECK_MUTEX_INITIALIZER_NP
 \

104 { { 0, 0, 0, 
PTHREAD_MUTEX_ERRORCHECK_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

105 
	#PTHREAD_ADAPTIVE_MUTEX_INITIALIZER_NP
 \

106 { { 0, 0, 0, 
PTHREAD_MUTEX_ADAPTIVE_NP
, 0, { 
__PTHREAD_SPINS
 } } }

	)

113 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


116 
	mPTHREAD_RWLOCK_PREFER_READER_NP
,

117 
	mPTHREAD_RWLOCK_PREFER_WRITER_NP
,

118 
	mPTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,

119 
	mPTHREAD_RWLOCK_DEFAULT_NP
 = 
PTHREAD_RWLOCK_PREFER_READER_NP


125 #iâdeà
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


126 #ià
__WORDSIZE
 == 64

127 
	#__PTHREAD_RWLOCK_INT_FLAGS_SHARED
 1

	)

132 
	#PTHREAD_RWLOCK_INITIALIZER
 \

133 { { 0, 0, 0, 0, 0, 0, 0, 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, 0 } }

	)

134 #ifdeà
__USE_GNU


135 #ifdeà
__PTHREAD_RWLOCK_INT_FLAGS_SHARED


136 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

137 { { 0, 0, 0, 0, 0, 0, 0, 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, \

138 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
 } }

	)

140 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


141 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

142 { { 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
, \

143 0, 
__PTHREAD_RWLOCK_ELISION_EXTRA
, 0, 0 } }

	)

145 
	#PTHREAD_RWLOCK_WRITER_NONRECURSIVE_INITIALIZER_NP
 \

146 { { 0, 0, 0, 0, 0, 0, 0, 0, 0, 
PTHREAD_RWLOCK_PREFER_WRITER_NONRECURSIVE_NP
,\

147 0 } }

	)

157 
	mPTHREAD_INHERIT_SCHED
,

158 
	#PTHREAD_INHERIT_SCHED
 
PTHREAD_INHERIT_SCHED


	)

159 
	mPTHREAD_EXPLICIT_SCHED


160 
	#PTHREAD_EXPLICIT_SCHED
 
PTHREAD_EXPLICIT_SCHED


	)

167 
	mPTHREAD_SCOPE_SYSTEM
,

168 
	#PTHREAD_SCOPE_SYSTEM
 
PTHREAD_SCOPE_SYSTEM


	)

169 
	mPTHREAD_SCOPE_PROCESS


170 
	#PTHREAD_SCOPE_PROCESS
 
PTHREAD_SCOPE_PROCESS


	)

177 
	mPTHREAD_PROCESS_PRIVATE
,

178 
	#PTHREAD_PROCESS_PRIVATE
 
PTHREAD_PROCESS_PRIVATE


	)

179 
	mPTHREAD_PROCESS_SHARED


180 
	#PTHREAD_PROCESS_SHARED
 
PTHREAD_PROCESS_SHARED


	)

186 
	#PTHREAD_COND_INITIALIZER
 { { 0, 0, 0, 0, 0, (*è0, 0, 0 } }

	)

190 
	s_±h»ad_ş—nup_bufãr


192 (*
	m__routše
) (*);

193 *
	m__¬g
;

194 
	m__ÿnûÉy³
;

195 
_±h»ad_ş—nup_bufãr
 *
	m__´ev
;

201 
	mPTHREAD_CANCEL_ENABLE
,

202 
	#PTHREAD_CANCEL_ENABLE
 
PTHREAD_CANCEL_ENABLE


	)

203 
	mPTHREAD_CANCEL_DISABLE


204 
	#PTHREAD_CANCEL_DISABLE
 
PTHREAD_CANCEL_DISABLE


	)

208 
	mPTHREAD_CANCEL_DEFERRED
,

209 
	#PTHREAD_CANCEL_DEFERRED
 
PTHREAD_CANCEL_DEFERRED


	)

210 
	mPTHREAD_CANCEL_ASYNCHRONOUS


211 
	#PTHREAD_CANCEL_ASYNCHRONOUS
 
PTHREAD_CANCEL_ASYNCHRONOUS


	)

213 
	#PTHREAD_CANCELED
 ((*è-1)

	)

217 
	#PTHREAD_ONCE_INIT
 0

	)

220 #ifdeà
__USE_XOPEN2K


224 
	#PTHREAD_BARRIER_SERIAL_THREAD
 -1

	)

228 
__BEGIN_DECLS


233 
±h»ad_ü—‹
 (
±h»ad_t
 *
__»¡riù
 
__Ãwth»ad
,

234 cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

235 *(*
__¡¬t_routše
) (*),

236 *
__»¡riù
 
__¬g
è
__THROWNL
 
__nÚnuÎ
 ((1, 3));

242 
	$±h»ad_ex™
 (*
__»tv®
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

250 
	`±h»ad_još
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
);

252 #ifdeà
__USE_GNU


255 
	$±h»ad_Œyjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
è
__THROW
;

263 
	`±h»ad_timedjoš_Å
 (
±h»ad_t
 
__th
, **
__th»ad_»tuº
,

264 cÚ¡ 
time¥ec
 *
__ab¡ime
);

271 
	$±h»ad_d‘ach
 (
±h»ad_t
 
__th
è
__THROW
;

275 
±h»ad_t
 
	$±h»ad_£lf
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

278 
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
)

279 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

287 
	$±h»ad_©Œ_š™
 (
±h»ad_©Œ_t
 *
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

290 
	$±h»ad_©Œ_de¡roy
 (
±h»ad_©Œ_t
 *
__©Œ
)

291 
__THROW
 
	`__nÚnuÎ
 ((1));

294 
	$±h»ad_©Œ_g‘d‘ach¡©e
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

295 *
__d‘ach¡©e
)

296 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

299 
	$±h»ad_©Œ_£td‘ach¡©e
 (
±h»ad_©Œ_t
 *
__©Œ
,

300 
__d‘ach¡©e
)

301 
__THROW
 
	`__nÚnuÎ
 ((1));

305 
	$±h»ad_©Œ_g‘gu¬dsize
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

306 
size_t
 *
__gu¬dsize
)

307 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

310 
	$±h»ad_©Œ_£tgu¬dsize
 (
±h»ad_©Œ_t
 *
__©Œ
,

311 
size_t
 
__gu¬dsize
)

312 
__THROW
 
	`__nÚnuÎ
 ((1));

316 
	$±h»ad_©Œ_g‘sched·¿m
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

317 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

318 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

321 
	$±h»ad_©Œ_£tsched·¿m
 (
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

322 cÚ¡ 
sched_·¿m
 *
__»¡riù


323 
__·¿m
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

326 
	$±h»ad_©Œ_g‘schedpŞicy
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


327 
__©Œ
, *
__»¡riù
 
__pŞicy
)

328 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

331 
	$±h»ad_©Œ_£tschedpŞicy
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__pŞicy
)

332 
__THROW
 
	`__nÚnuÎ
 ((1));

335 
	$±h»ad_©Œ_g‘šh”™sched
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


336 
__©Œ
, *
__»¡riù
 
__šh”™
)

337 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

340 
	$±h»ad_©Œ_£tšh”™sched
 (
±h»ad_©Œ_t
 *
__©Œ
,

341 
__šh”™
)

342 
__THROW
 
	`__nÚnuÎ
 ((1));

346 
	$±h»ad_©Œ_g‘scİe
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

347 *
__»¡riù
 
__scİe
)

348 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

351 
	$±h»ad_©Œ_£tscİe
 (
±h»ad_©Œ_t
 *
__©Œ
, 
__scİe
)

352 
__THROW
 
	`__nÚnuÎ
 ((1));

355 
	$±h»ad_©Œ_g‘¡ackaddr
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


356 
__©Œ
, **
__»¡riù
 
__¡ackaddr
)

357 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__©Œibu‹_d•»ÿ‹d__
;

363 
	$±h»ad_©Œ_£t¡ackaddr
 (
±h»ad_©Œ_t
 *
__©Œ
,

364 *
__¡ackaddr
)

365 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
;

368 
	$±h»ad_©Œ_g‘¡acksize
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù


369 
__©Œ
, 
size_t
 *
__»¡riù
 
__¡acksize
)

370 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

375 
	$±h»ad_©Œ_£t¡acksize
 (
±h»ad_©Œ_t
 *
__©Œ
,

376 
size_t
 
__¡acksize
)

377 
__THROW
 
	`__nÚnuÎ
 ((1));

379 #ifdeà
__USE_XOPEN2K


381 
	$±h»ad_©Œ_g‘¡ack
 (cÚ¡ 
±h»ad_©Œ_t
 *
__»¡riù
 
__©Œ
,

382 **
__»¡riù
 
__¡ackaddr
,

383 
size_t
 *
__»¡riù
 
__¡acksize
)

384 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

389 
	$±h»ad_©Œ_£t¡ack
 (
±h»ad_©Œ_t
 *
__©Œ
, *
__¡ackaddr
,

390 
size_t
 
__¡acksize
è
__THROW
 
	`__nÚnuÎ
 ((1));

393 #ifdeà
__USE_GNU


396 
	$±h»ad_©Œ_£ffš™y_Å
 (
±h»ad_©Œ_t
 *
__©Œ
,

397 
size_t
 
__ıu£tsize
,

398 cÚ¡ 
ıu_£t_t
 *
__ıu£t
)

399 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

403 
	$±h»ad_©Œ_g‘affš™y_Å
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
,

404 
size_t
 
__ıu£tsize
,

405 
ıu_£t_t
 *
__ıu£t
)

406 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

409 
	$±h»ad_g‘©Œ_deçuÉ_Å
 (
±h»ad_©Œ_t
 *
__©Œ
)

410 
__THROW
 
	`__nÚnuÎ
 ((1));

414 
	$±h»ad_£‰r_deçuÉ_Å
 (cÚ¡ 
±h»ad_©Œ_t
 *
__©Œ
)

415 
__THROW
 
	`__nÚnuÎ
 ((1));

420 
	$±h»ad_g‘©Œ_Å
 (
±h»ad_t
 
__th
, 
±h»ad_©Œ_t
 *
__©Œ
)

421 
__THROW
 
	`__nÚnuÎ
 ((2));

429 
	$±h»ad_£tsched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
, 
__pŞicy
,

430 cÚ¡ 
sched_·¿m
 *
__·¿m
)

431 
__THROW
 
	`__nÚnuÎ
 ((3));

434 
	$±h»ad_g‘sched·¿m
 (
±h»ad_t
 
__rg‘_th»ad
,

435 *
__»¡riù
 
__pŞicy
,

436 
sched_·¿m
 *
__»¡riù
 
__·¿m
)

437 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

440 
	$±h»ad_£tsched´io
 (
±h»ad_t
 
__rg‘_th»ad
, 
__´io
)

441 
__THROW
;

444 #ifdeà
__USE_GNU


446 
	$±h»ad_g‘Çme_Å
 (
±h»ad_t
 
__rg‘_th»ad
, *
__buf
,

447 
size_t
 
__buæ’
)

448 
__THROW
 
	`__nÚnuÎ
 ((2));

451 
	$±h»ad_£Šame_Å
 (
±h»ad_t
 
__rg‘_th»ad
, cÚ¡ *
__Çme
)

452 
__THROW
 
	`__nÚnuÎ
 ((2));

456 #ifdeà
__USE_UNIX98


458 
	$±h»ad_g‘cÚcu¼’cy
 (è
__THROW
;

461 
	$±h»ad_£tcÚcu¼’cy
 (
__Ëv–
è
__THROW
;

464 #ifdeà
__USE_GNU


469 
	$±h»ad_y›ld
 (è
__THROW
;

474 
	$±h»ad_£ffš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

475 cÚ¡ 
ıu_£t_t
 *
__ıu£t
)

476 
__THROW
 
	`__nÚnuÎ
 ((3));

479 
	$±h»ad_g‘affš™y_Å
 (
±h»ad_t
 
__th
, 
size_t
 
__ıu£tsize
,

480 
ıu_£t_t
 *
__ıu£t
)

481 
__THROW
 
	`__nÚnuÎ
 ((3));

494 
	`±h»ad_Úû
 (
±h»ad_Úû_t
 *
__Úû_cÚŒŞ
,

495 (*
__š™_routše
è()è
	`__nÚnuÎ
 ((1, 2));

506 
	`±h»ad_£tÿnûl¡©e
 (
__¡©e
, *
__Şd¡©e
);

510 
	`±h»ad_£tÿnûÉy³
 (
__ty³
, *
__Şdty³
);

513 
	`±h»ad_ÿnûl
 (
±h»ad_t
 
__th
);

518 
	`±h»ad_‹¡ÿnûl
 ();

527 
__jmp_buf
 
__ÿnûl_jmp_buf
;

528 
__mask_was_§ved
;

529 } 
__ÿnûl_jmp_buf
[1];

530 *
__·d
[4];

531 } 
	t__±h»ad_unwšd_buf_t
 
	t__©Œibu‹__
 ((
	t__®igÃd__
));

534 #iâdeà
__ş—nup_fù_©Œibu‹


535 
	#__ş—nup_fù_©Œibu‹


	)

540 
	s__±h»ad_ş—nup_äame


542 (*
__ÿnûl_routše
) (*);

543 *
__ÿnûl_¬g
;

544 
__do_™
;

545 
__ÿnûl_ty³
;

548 #ià
defšed
 
__GNUC__
 && defšed 
__EXCEPTIONS


549 #ifdeà
__ılu¥lus


551 şas 
	c__±h»ad_ş—nup_şass


553 (*
__ÿnûl_routše
) (*);

554 *
__ÿnûl_¬g
;

555 
__do_™
;

556 
__ÿnûl_ty³
;

558 
public
:

559 
	`__±h»ad_ş—nup_şass
 ((*
__fù
è(*), *
__¬g
)

560 : 
	`__ÿnûl_routše
 (
__fù
), 
	`__ÿnûl_¬g
 (
__¬g
), 
	$__do_™
 (1) { }

561 ~
	$__±h»ad_ş—nup_şass
 (è{ ià(
__do_™
è
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); 
	}
}

562 
	$__£tdo™
 (
__Ãwv®
è{ 
__do_™
 = __Ãwv®; 
	}
}

563 
	$__deãr
 (è{ 
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
,

564 &
__ÿnûl_ty³
); 
	}
}

565 
	$__»¡Üe
 (ècÚ¡ { 
	`±h»ad_£tÿnûÉy³
 (
__ÿnûl_ty³
, 0); 
	}
}

575 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

577 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
)

	)

581 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

582 
__şäame
.
	`__£tdo™
 (
execu‹
); \

583 } 0)

	)

585 #ifdeà
__USE_GNU


589 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

591 
__±h»ad_ş—nup_şass
 
	`__şäame
 (
routše
, 
¬g
); \

592 
__şäame
.
	`__deãr
 ()

	)

597 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

598 
__şäame
.
	`__»¡Üe
 (); \

599 
__şäame
.
	`__£tdo™
 (
execu‹
); \

600 } 0)

	)

607 
__ex‹º_šlše
 

608 
	$__±h»ad_ş—nup_routše
 (
__±h»ad_ş—nup_äame
 *
__äame
)

610 ià(
__äame
->
__do_™
)

611 
__äame
->
	`__ÿnûl_routše
 (__äame->
__ÿnûl_¬g
);

612 
	}
}

621 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

623 
__±h»ad_ş—nup_äame
 
__şäame
 \

624 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

625 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

626 .
__do_™
 = 1 };

	)

630 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

631 
__şäame
.
__do_™
 = (
execu‹
); \

632 } 0)

	)

634 #ifdeà
__USE_GNU


638 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

640 
__±h»ad_ş—nup_äame
 
__şäame
 \

641 
	`__©Œibu‹__
 ((
	`__ş—nup__
 (
__±h»ad_ş—nup_routše
))) \

642 ğ{ .
__ÿnûl_routše
 = (
routše
), .
__ÿnûl_¬g
 = (
¬g
), \

643 .
__do_™
 = 1 }; \

644 (è
	`±h»ad_£tÿnûÉy³
 (
PTHREAD_CANCEL_DEFERRED
, \

645 &
__şäame
.
__ÿnûl_ty³
)

	)

650 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

651 (è
	`±h»ad_£tÿnûÉy³
 (
__şäame
.
__ÿnûl_ty³
, 
NULL
); \

652 
__şäame
.
__do_™
 = (
execu‹
); \

653 } 0)

	)

664 
	#±h»ad_ş—nup_push
(
routše
, 
¬g
) \

666 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

667 (*
__ÿnûl_routše
è(*èğ(
routše
); \

668 *
__ÿnûl_¬g
 = (
¬g
); \

669 
__nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

670 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

671 ià(
	`__glibc_uÆik–y
 (
__nÙ_fœ¡_ÿÎ
)) \

673 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

674 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

678 
	`__±h»ad_»gi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

679 dØ{

	)

680 
__±h»ad_»gi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

681 
__ş—nup_fù_©Œibu‹
;

685 
	#±h»ad_ş—nup_pİ
(
execu‹
) \

688 
	`__±h»ad_uÄegi¡”_ÿnûl
 (&
__ÿnûl_buf
); \

689 ià(
execu‹
) \

690 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

691 } 0)

	)

692 
	$__±h»ad_uÄegi¡”_ÿnûl
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

693 
__ş—nup_fù_©Œibu‹
;

695 #ifdeà
__USE_GNU


699 
	#±h»ad_ş—nup_push_deãr_Å
(
routše
, 
¬g
) \

701 
__±h»ad_unwšd_buf_t
 
__ÿnûl_buf
; \

702 (*
__ÿnûl_routše
è(*èğ(
routše
); \

703 *
__ÿnûl_¬g
 = (
¬g
); \

704 
__nÙ_fœ¡_ÿÎ
 = 
	`__sig£tjmp
 ((
__jmp_buf_g
 *) (*) \

705 
__ÿnûl_buf
.
__ÿnûl_jmp_buf
, 0); \

706 ià(
	`__glibc_uÆik–y
 (
__nÙ_fœ¡_ÿÎ
)) \

708 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

709 
	`__±h»ad_unwšd_Ãxt
 (&
__ÿnûl_buf
); \

713 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (&
__ÿnûl_buf
); \

714 dØ{

	)

715 
	`__±h»ad_»gi¡”_ÿnûl_deãr
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

716 
__ş—nup_fù_©Œibu‹
;

721 
	#±h»ad_ş—nup_pİ_»¡Üe_Å
(
execu‹
) \

724 
	`__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (&
__ÿnûl_buf
); \

725 ià(
execu‹
) \

726 
	`__ÿnûl_routše
 (
__ÿnûl_¬g
); \

727 
	}
} 0)

	)

728 
	$__±h»ad_uÄegi¡”_ÿnûl_»¡Üe
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

729 
__ş—nup_fù_©Œibu‹
;

733 
	$__±h»ad_unwšd_Ãxt
 (
__±h»ad_unwšd_buf_t
 *
__buf
)

734 
__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
))

735 #iâdeà
SHARED


736 
	`__©Œibu‹__
 ((
__w—k__
))

742 
__jmp_buf_g
;

743 
	$__sig£tjmp
 (
__jmp_buf_g
 *
__’v
, 
__§vemask
è
__THROWNL
;

749 
	$±h»ad_mu‹x_š™
 (
±h»ad_mu‹x_t
 *
__mu‹x
,

750 cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__mu‹x©Œ
)

751 
__THROW
 
	`__nÚnuÎ
 ((1));

754 
	$±h»ad_mu‹x_de¡roy
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

755 
__THROW
 
	`__nÚnuÎ
 ((1));

758 
	$±h»ad_mu‹x_Œylock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

759 
__THROWNL
 
	`__nÚnuÎ
 ((1));

762 
	$±h»ad_mu‹x_lock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

763 
__THROWNL
 
	`__nÚnuÎ
 ((1));

765 #ifdeà
__USE_XOPEN2K


767 
	$±h»ad_mu‹x_timedlock
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

768 cÚ¡ 
time¥ec
 *
__»¡riù


769 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

773 
	$±h»ad_mu‹x_uÆock
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

774 
__THROWNL
 
	`__nÚnuÎ
 ((1));

778 
	$±h»ad_mu‹x_g‘´ioûšg
 (cÚ¡ 
±h»ad_mu‹x_t
 *

779 
__»¡riù
 
__mu‹x
,

780 *
__»¡riù
 
__´ioûšg
)

781 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

785 
	$±h»ad_mu‹x_£rioûšg
 (
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

786 
__´ioûšg
,

787 *
__»¡riù
 
__Şd_ûšg
)

788 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

791 #ifdeà
__USE_XOPEN2K8


793 
	$±h»ad_mu‹x_cÚsi¡’t
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

794 
__THROW
 
	`__nÚnuÎ
 ((1));

795 #ifdeà
__USE_GNU


796 
	$±h»ad_mu‹x_cÚsi¡’t_Å
 (
±h»ad_mu‹x_t
 *
__mu‹x
)

797 
__THROW
 
	`__nÚnuÎ
 ((1));

806 
	$±h»ad_mu‹x©Œ_š™
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

807 
__THROW
 
	`__nÚnuÎ
 ((1));

810 
	$±h»ad_mu‹x©Œ_de¡roy
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
)

811 
__THROW
 
	`__nÚnuÎ
 ((1));

814 
	$±h»ad_mu‹x©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

815 
__»¡riù
 
__©Œ
,

816 *
__»¡riù
 
__psh¬ed
)

817 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

820 
	$±h»ad_mu‹x©Œ_£sh¬ed
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

821 
__psh¬ed
)

822 
__THROW
 
	`__nÚnuÎ
 ((1));

824 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


826 
	$±h»ad_mu‹x©Œ_g‘ty³
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__»¡riù


827 
__©Œ
, *
__»¡riù
 
__kšd
)

828 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

833 
	$±h»ad_mu‹x©Œ_£‰y³
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
, 
__kšd
)

834 
__THROW
 
	`__nÚnuÎ
 ((1));

838 
	$±h»ad_mu‹x©Œ_g‘´ÙocŞ
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

839 
__»¡riù
 
__©Œ
,

840 *
__»¡riù
 
__´ÙocŞ
)

841 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

845 
	$±h»ad_mu‹x©Œ_£rÙocŞ
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

846 
__´ÙocŞ
)

847 
__THROW
 
	`__nÚnuÎ
 ((1));

850 
	$±h»ad_mu‹x©Œ_g‘´ioûšg
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *

851 
__»¡riù
 
__©Œ
,

852 *
__»¡riù
 
__´ioûšg
)

853 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

856 
	$±h»ad_mu‹x©Œ_£rioûšg
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

857 
__´ioûšg
)

858 
__THROW
 
	`__nÚnuÎ
 ((1));

860 #ifdeà
__USE_XOPEN2K


862 
	$±h»ad_mu‹x©Œ_g‘robu¡
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

863 *
__robu¡Ãss
)

864 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

865 #ifdeà
__USE_GNU


866 
	$±h»ad_mu‹x©Œ_g‘robu¡_Å
 (cÚ¡ 
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

867 *
__robu¡Ãss
)

868 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

872 
	$±h»ad_mu‹x©Œ_£Œobu¡
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

873 
__robu¡Ãss
)

874 
__THROW
 
	`__nÚnuÎ
 ((1));

875 #ifdeà
__USE_GNU


876 
	$±h»ad_mu‹x©Œ_£Œobu¡_Å
 (
±h»ad_mu‹x©Œ_t
 *
__©Œ
,

877 
__robu¡Ãss
)

878 
__THROW
 
	`__nÚnuÎ
 ((1));

883 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


888 
	$±h»ad_rwlock_š™
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

889 cÚ¡ 
±h»ad_rwlock©Œ_t
 *
__»¡riù


890 
__©Œ
è
__THROW
 
	`__nÚnuÎ
 ((1));

893 
	$±h»ad_rwlock_de¡roy
 (
±h»ad_rwlock_t
 *
__rwlock
)

894 
__THROW
 
	`__nÚnuÎ
 ((1));

897 
	$±h»ad_rwlock_rdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

898 
__THROWNL
 
	`__nÚnuÎ
 ((1));

901 
	$±h»ad_rwlock_Œyrdlock
 (
±h»ad_rwlock_t
 *
__rwlock
)

902 
__THROWNL
 
	`__nÚnuÎ
 ((1));

904 #ifdeà
__USE_XOPEN2K


906 
	$±h»ad_rwlock_timedrdlock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

907 cÚ¡ 
time¥ec
 *
__»¡riù


908 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

912 
	$±h»ad_rwlock_w¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

913 
__THROWNL
 
	`__nÚnuÎ
 ((1));

916 
	$±h»ad_rwlock_Œyw¾ock
 (
±h»ad_rwlock_t
 *
__rwlock
)

917 
__THROWNL
 
	`__nÚnuÎ
 ((1));

919 #ifdeà
__USE_XOPEN2K


921 
	$±h»ad_rwlock_timedw¾ock
 (
±h»ad_rwlock_t
 *
__»¡riù
 
__rwlock
,

922 cÚ¡ 
time¥ec
 *
__»¡riù


923 
__ab¡ime
è
__THROWNL
 
	`__nÚnuÎ
 ((1, 2));

927 
	$±h»ad_rwlock_uÆock
 (
±h»ad_rwlock_t
 *
__rwlock
)

928 
__THROWNL
 
	`__nÚnuÎ
 ((1));

934 
	$±h»ad_rwlock©Œ_š™
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

935 
__THROW
 
	`__nÚnuÎ
 ((1));

938 
	$±h»ad_rwlock©Œ_de¡roy
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
)

939 
__THROW
 
	`__nÚnuÎ
 ((1));

942 
	$±h»ad_rwlock©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_rwlock©Œ_t
 *

943 
__»¡riù
 
__©Œ
,

944 *
__»¡riù
 
__psh¬ed
)

945 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

948 
	$±h»ad_rwlock©Œ_£sh¬ed
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

949 
__psh¬ed
)

950 
__THROW
 
	`__nÚnuÎ
 ((1));

953 
	$±h»ad_rwlock©Œ_g‘kšd_Å
 (cÚ¡ 
±h»ad_rwlock©Œ_t
 *

954 
__»¡riù
 
__©Œ
,

955 *
__»¡riù
 
__´ef
)

956 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

959 
	$±h»ad_rwlock©Œ_£tkšd_Å
 (
±h»ad_rwlock©Œ_t
 *
__©Œ
,

960 
__´ef
è
__THROW
 
	`__nÚnuÎ
 ((1));

968 
	$±h»ad_cÚd_š™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

969 cÚ¡ 
±h»ad_cÚd©Œ_t
 *
__»¡riù
 
__cÚd_©Œ
)

970 
__THROW
 
	`__nÚnuÎ
 ((1));

973 
	$±h»ad_cÚd_de¡roy
 (
±h»ad_cÚd_t
 *
__cÚd
)

974 
__THROW
 
	`__nÚnuÎ
 ((1));

977 
	$±h»ad_cÚd_sigÇl
 (
±h»ad_cÚd_t
 *
__cÚd
)

978 
__THROWNL
 
	`__nÚnuÎ
 ((1));

981 
	$±h»ad_cÚd_brßdÿ¡
 (
±h»ad_cÚd_t
 *
__cÚd
)

982 
__THROWNL
 
	`__nÚnuÎ
 ((1));

989 
	$±h»ad_cÚd_wa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

990 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
)

991 
	`__nÚnuÎ
 ((1, 2));

1000 
	$±h»ad_cÚd_timedwa™
 (
±h»ad_cÚd_t
 *
__»¡riù
 
__cÚd
,

1001 
±h»ad_mu‹x_t
 *
__»¡riù
 
__mu‹x
,

1002 cÚ¡ 
time¥ec
 *
__»¡riù
 
__ab¡ime
)

1003 
	`__nÚnuÎ
 ((1, 2, 3));

1008 
	$±h»ad_cÚd©Œ_š™
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

1009 
__THROW
 
	`__nÚnuÎ
 ((1));

1012 
	$±h»ad_cÚd©Œ_de¡roy
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
)

1013 
__THROW
 
	`__nÚnuÎ
 ((1));

1016 
	$±h»ad_cÚd©Œ_g‘psh¬ed
 (cÚ¡ 
±h»ad_cÚd©Œ_t
 *

1017 
__»¡riù
 
__©Œ
,

1018 *
__»¡riù
 
__psh¬ed
)

1019 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1022 
	$±h»ad_cÚd©Œ_£sh¬ed
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1023 
__psh¬ed
è
__THROW
 
	`__nÚnuÎ
 ((1));

1025 #ifdeà
__USE_XOPEN2K


1027 
	$±h»ad_cÚd©Œ_g‘şock
 (cÚ¡ 
±h»ad_cÚd©Œ_t
 *

1028 
__»¡riù
 
__©Œ
,

1029 
__şockid_t
 *
__»¡riù
 
__şock_id
)

1030 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1033 
	$±h»ad_cÚd©Œ_£tşock
 (
±h»ad_cÚd©Œ_t
 *
__©Œ
,

1034 
__şockid_t
 
__şock_id
)

1035 
__THROW
 
	`__nÚnuÎ
 ((1));

1039 #ifdeà
__USE_XOPEN2K


1044 
	$±h»ad_¥š_š™
 (
±h»ad_¥šlock_t
 *
__lock
, 
__psh¬ed
)

1045 
__THROW
 
	`__nÚnuÎ
 ((1));

1048 
	$±h»ad_¥š_de¡roy
 (
±h»ad_¥šlock_t
 *
__lock
)

1049 
__THROW
 
	`__nÚnuÎ
 ((1));

1052 
	$±h»ad_¥š_lock
 (
±h»ad_¥šlock_t
 *
__lock
)

1053 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1056 
	$±h»ad_¥š_Œylock
 (
±h»ad_¥šlock_t
 *
__lock
)

1057 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1060 
	$±h»ad_¥š_uÆock
 (
±h»ad_¥šlock_t
 *
__lock
)

1061 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1068 
	$±h»ad_b¬r›r_š™
 (
±h»ad_b¬r›r_t
 *
__»¡riù
 
__b¬r›r
,

1069 cÚ¡ 
±h»ad_b¬r›¿‰r_t
 *
__»¡riù


1070 
__©Œ
, 
__couÁ
)

1071 
__THROW
 
	`__nÚnuÎ
 ((1));

1074 
	$±h»ad_b¬r›r_de¡roy
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1075 
__THROW
 
	`__nÚnuÎ
 ((1));

1078 
	$±h»ad_b¬r›r_wa™
 (
±h»ad_b¬r›r_t
 *
__b¬r›r
)

1079 
__THROWNL
 
	`__nÚnuÎ
 ((1));

1083 
	$±h»ad_b¬r›¿‰r_š™
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1084 
__THROW
 
	`__nÚnuÎ
 ((1));

1087 
	$±h»ad_b¬r›¿‰r_de¡roy
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
)

1088 
__THROW
 
	`__nÚnuÎ
 ((1));

1091 
	$±h»ad_b¬r›¿‰r_g‘psh¬ed
 (cÚ¡ 
±h»ad_b¬r›¿‰r_t
 *

1092 
__»¡riù
 
__©Œ
,

1093 *
__»¡riù
 
__psh¬ed
)

1094 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1097 
	$±h»ad_b¬r›¿‰r_£sh¬ed
 (
±h»ad_b¬r›¿‰r_t
 *
__©Œ
,

1098 
__psh¬ed
)

1099 
__THROW
 
	`__nÚnuÎ
 ((1));

1111 
	`±h»ad_key_ü—‹
 (
±h»ad_key_t
 *
__key
,

1112 (*
__de¡r_funùiÚ
) (*))

1113 
__THROW
 
	`__nÚnuÎ
 ((1));

1116 
	$±h»ad_key_d–‘e
 (
±h»ad_key_t
 
__key
è
__THROW
;

1119 *
	$±h»ad_g‘¥ecific
 (
±h»ad_key_t
 
__key
è
__THROW
;

1122 
	$±h»ad_£t¥ecific
 (
±h»ad_key_t
 
__key
,

1123 cÚ¡ *
__poš‹r
è
__THROW
 ;

1126 #ifdeà
__USE_XOPEN2K


1128 
	$±h»ad_g‘ıuşockid
 (
±h»ad_t
 
__th»ad_id
,

1129 
__şockid_t
 *
__şock_id
)

1130 
__THROW
 
	`__nÚnuÎ
 ((2));

1145 
	`±h»ad_©fÜk
 ((*
__´•¬e
) (),

1146 (*
__·»Á
) (),

1147 (*
__chd
è()è
__THROW
;

1150 #ifdeà
__USE_EXTERN_INLINES


1152 
__ex‹º_šlše
 

1153 
	`__NTH
 (
	$±h»ad_equ®
 (
±h»ad_t
 
__th»ad1
,…th»ad_ˆ
__th»ad2
))

1155  
__th»ad1
 =ğ
__th»ad2
;

1156 
	}
}

1159 
	g__END_DECLS


	@/usr/include/signal.h

22 #iâdef 
_SIGNAL_H


24 #ià!
defšed
 
__Ãed_sig_©omic_t
 && !defšed 
__Ãed_sig£t_t


25 
	#_SIGNAL_H


	)

28 
	~<ã©u»s.h
>

30 
	g__BEGIN_DECLS


32 
	~<b™s/sig£t.h
>

36 #ià
defšed
 
__Ãed_sig_©omic_t
 || defšed 
_SIGNAL_H


37 #iâdeà
__sig_©omic_t_defšed


38 
	#__sig_©omic_t_defšed


	)

39 
__BEGIN_NAMESPACE_STD


40 
__sig_©omic_t
 
	tsig_©omic_t
;

41 
	g__END_NAMESPACE_STD


43 #undeà
__Ãed_sig_©omic_t


46 #ià
defšed
 
__Ãed_sig£t_t
 || (defšed 
_SIGNAL_H
 && defšed 
__USE_POSIX
)

47 #iâdeà
__sig£t_t_defšed


48 
	#__sig£t_t_defšed


	)

49 
__sig£t_t
 
	tsig£t_t
;

51 #undeà
__Ãed_sig£t_t


54 #ifdeà
_SIGNAL_H


56 
	~<b™s/ty³s.h
>

57 
	~<b™s/signum.h
>

59 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


60 #iâdeà
__pid_t_defšed


61 
__pid_t
 
	tpid_t
;

62 
	#__pid_t_defšed


	)

64 #ifdeà
__USE_XOPEN


66 #iâdeà
__uid_t_defšed


67 
__uid_t
 
	tuid_t
;

68 
	#__uid_t_defšed


	)

72 #ifdeà
__USE_POSIX199309


74 
	#__Ãed_time¥ec


	)

75 
	~<time.h
>

78 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_XOPEN_EXTENDED


80 
	~<b™s/sigšfo.h
>

85 (*
	t__sighªdËr_t
) ();

90 
__sighªdËr_t
 
	$__sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

91 
__THROW
;

92 #ifdeà
__USE_GNU


93 
__sighªdËr_t
 
	$sysv_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

94 
__THROW
;

100 
__BEGIN_NAMESPACE_STD


101 #ifdeà
__USE_MISC


102 
__sighªdËr_t
 
	$sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

103 
__THROW
;

106 #ifdeà
__REDIRECT_NTH


107 
__sighªdËr_t
 
	`__REDIRECT_NTH
 (
sigÇl
,

108 (
__sig
, 
__sighªdËr_t
 
__hªdËr
),

109 
__sysv_sigÇl
);

111 
	#sigÇl
 
__sysv_sigÇl


	)

114 
__END_NAMESPACE_STD


116 #ifdeà
__USE_XOPEN


119 
__sighªdËr_t
 
	$bsd_sigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

120 
__THROW
;

126 #ifdeà
__USE_POSIX


127 
	$kl
 (
__pid_t
 
__pid
, 
__sig
è
__THROW
;

130 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


134 
	$kÍg
 (
__pid_t
 
__pg½
, 
__sig
è
__THROW
;

137 
__BEGIN_NAMESPACE_STD


139 
	$¿i£
 (
__sig
è
__THROW
;

140 
__END_NAMESPACE_STD


142 #ifdeà
__USE_MISC


144 
__sighªdËr_t
 
	$ssigÇl
 (
__sig
, 
__sighªdËr_t
 
__hªdËr
)

145 
__THROW
;

146 
	$gsigÇl
 (
__sig
è
__THROW
;

149 #ifdeà
__USE_XOPEN2K8


151 
	`psigÇl
 (
__sig
, cÚ¡ *
__s
);

154 
	`psigšfo
 (cÚ¡ 
sigšfo_t
 *
__pšfo
, cÚ¡ *
__s
);

166 #ifdeà
__USE_XOPEN


167 #ifdeà
__GNUC__


168 
	$sig·u£
 (
__sig
è
	`__asm__
 ("__xpg_sigpause");

170 
	`__sig·u£
 (
__sig_Ü_mask
, 
__is_sig
);

172 
	#sig·u£
(
sig
è
	`__sig·u£
 ((sig), 1)

	)

177 #ifdeà
__USE_MISC


184 
	#sigmask
(
sig
è
	`__sigmask
(sig)

	)

187 
	$sigblock
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

190 
	$sig£tmask
 (
__mask
è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

193 
	$sigg‘mask
 (è
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

197 #ifdeà
__USE_MISC


198 
	#NSIG
 
_NSIG


	)

201 #ifdeà
__USE_GNU


202 
__sighªdËr_t
 
	tsighªdËr_t
;

206 #ifdeà
__USE_MISC


207 
__sighªdËr_t
 
	tsig_t
;

210 #ifdeà
__USE_POSIX


213 
	$sigem±y£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

216 
	$sigfl£t
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

219 
	$sigadd£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

222 
	$sigd–£t
 (
sig£t_t
 *
__£t
, 
__signo
è
__THROW
 
	`__nÚnuÎ
 ((1));

225 
	$sigismemb”
 (cÚ¡ 
sig£t_t
 *
__£t
, 
__signo
)

226 
__THROW
 
	`__nÚnuÎ
 ((1));

228 #ifdeà
__USE_GNU


230 
	$sigi£m±y£t
 (cÚ¡ 
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

233 
	$sigªd£t
 (
sig£t_t
 *
__£t
, cÚ¡ sig£t_ˆ*
__Ëá
,

234 cÚ¡ 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

237 
	$sigÜ£t
 (
sig£t_t
 *
__£t
, cÚ¡ sig£t_ˆ*
__Ëá
,

238 cÚ¡ 
sig£t_t
 *
__right
è
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3));

243 
	~<b™s/sigaùiÚ.h
>

246 
	$sig´ocmask
 (
__how
, cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

247 
sig£t_t
 *
__»¡riù
 
__o£t
è
__THROW
;

254 
	$sigsu¥’d
 (cÚ¡ 
sig£t_t
 *
__£t
è
	`__nÚnuÎ
 ((1));

257 
	$sigaùiÚ
 (
__sig
, cÚ¡ 
sigaùiÚ
 *
__»¡riù
 
__aù
,

258 
sigaùiÚ
 *
__»¡riù
 
__ßù
è
__THROW
;

261 
	$sig³ndšg
 (
sig£t_t
 *
__£t
è
__THROW
 
	`__nÚnuÎ
 ((1));

268 
	$sigwa™
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
, *__»¡riù 
__sig
)

269 
	`__nÚnuÎ
 ((1, 2));

271 #ifdeà
__USE_POSIX199309


276 
	$sigwa™šfo
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

277 
sigšfo_t
 *
__»¡riù
 
__šfo
è
	`__nÚnuÎ
 ((1));

284 
	$sigtimedwa™
 (cÚ¡ 
sig£t_t
 *
__»¡riù
 
__£t
,

285 
sigšfo_t
 *
__»¡riù
 
__šfo
,

286 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
)

287 
	`__nÚnuÎ
 ((1));

291 
	$sigqueue
 (
__pid_t
 
__pid
, 
__sig
, cÚ¡ 
sigv®
 
__v®
)

292 
__THROW
;

297 #ifdeà
__USE_MISC


301 cÚ¡ *cÚ¡ 
_sys_sigli¡
[
_NSIG
];

302 cÚ¡ *cÚ¡ 
sys_sigli¡
[
_NSIG
];

306 
	~<b™s/sigcÚ‹xt.h
>

309 
	$sig»tuº
 (
sigcÚ‹xt
 *
__sı
è
__THROW
;

314 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


315 
	#__Ãed_size_t


	)

316 
	~<¡ddef.h
>

321 
	$sigš‹¼u±
 (
__sig
, 
__š‹¼u±
è
__THROW
;

323 
	~<b™s/sig¡ack.h
>

324 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


326 
	~<sys/ucÚ‹xt.h
>

332 
	$sig¡ack
 (
sig¡ack
 *
__ss
, sig¡ack *
__oss
)

333 
__THROW
 
__©Œibu‹_d•»ÿ‹d__
;

337 
	$sig®t¡ack
 (cÚ¡ 
sig®t¡ack
 *
__»¡riù
 
__ss
,

338 
sig®t¡ack
 *
__»¡riù
 
__oss
è
__THROW
;

342 #ifdeà
__USE_XOPEN_EXTENDED


346 
	$sighŞd
 (
__sig
è
__THROW
;

349 
	$sig»l£
 (
__sig
è
__THROW
;

352 
	$sigignÜe
 (
__sig
è
__THROW
;

355 
__sighªdËr_t
 
	$sig£t
 (
__sig
, 
__sighªdËr_t
 
__di¥
è
__THROW
;

358 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


361 
	~<b™s/±h»adty³s.h
>

362 
	~<b™s/sigth»ad.h
>

369 
	$__libc_cu¼’t_sig¹mš
 (è
__THROW
;

371 
	$__libc_cu¼’t_sig¹max
 (è
__THROW
;

375 
__END_DECLS


	@/usr/include/stdio.h

23 #iâdeà
_STDIO_H


25 #ià!
defšed
 
__Ãed_FILE
 && !defšed 
__Ãed___FILE


26 
	#_STDIO_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


31 
	#__Ãed_size_t


	)

32 
	#__Ãed_NULL


	)

33 
	~<¡ddef.h
>

35 
	~<b™s/ty³s.h
>

36 
	#__Ãed_FILE


	)

37 
	#__Ãed___FILE


	)

41 #ià!
defšed
 
__FILE_defšed
 && defšed 
__Ãed_FILE


44 
	g_IO_FILE
;

46 
__BEGIN_NAMESPACE_STD


48 
_IO_FILE
 
	tFILE
;

49 
	g__END_NAMESPACE_STD


50 #ià
defšed
 
__USE_LARGEFILE64
 || defšed 
__USE_POSIX
 \

51 || 
defšed
 
	g__USE_ISOC99
 || defšed 
	g__USE_XOPEN
 \

52 || 
defšed
 
__USE_POSIX2


53 
	$__USING_NAMESPACE_STD
(
FILE
)

56 
	#__FILE_defšed
 1

	)

58 #undeà
__Ãed_FILE


61 #ià!
defšed
 
____FILE_defšed
 && defšed 
__Ãed___FILE


64 
_IO_FILE
 
	t__FILE
;

66 
	#____FILE_defšed
 1

	)

68 #undeà
__Ãed___FILE


71 #ifdef 
_STDIO_H


72 
	#_STDIO_USES_IOSTREAM


	)

74 
	~<libio.h
>

76 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


77 #ifdeà
__GNUC__


78 #iâdeà
_VA_LIST_DEFINED


79 
_G_va_li¡
 
	tva_li¡
;

80 
	#_VA_LIST_DEFINED


	)

83 
	~<¡d¬g.h
>

87 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


88 #iâdeà
__off_t_defšed


89 #iâdeà
__USE_FILE_OFFSET64


90 
__off_t
 
	toff_t
;

92 
__off64_t
 
	toff_t
;

94 
	#__off_t_defšed


	)

96 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


97 
__off64_t
 
	toff64_t
;

98 
	#__off64_t_defšed


	)

102 #ifdeà
__USE_XOPEN2K8


103 #iâdeà
__ssize_t_defšed


104 
__ssize_t
 
	tssize_t
;

105 
	#__ssize_t_defšed


	)

110 
__BEGIN_NAMESPACE_STD


111 #iâdeà
__USE_FILE_OFFSET64


112 
_G_åos_t
 
	tåos_t
;

114 
_G_åos64_t
 
	tåos_t
;

116 
__END_NAMESPACE_STD


117 #ifdeà
__USE_LARGEFILE64


118 
_G_åos64_t
 
	tåos64_t
;

122 
	#_IOFBF
 0

	)

123 
	#_IOLBF
 1

	)

124 
	#_IONBF
 2

	)

128 #iâdeà
BUFSIZ


129 
	#BUFSIZ
 
_IO_BUFSIZ


	)

135 #iâdeà
EOF


136 
	#EOF
 (-1)

	)

142 
	#SEEK_SET
 0

	)

143 
	#SEEK_CUR
 1

	)

144 
	#SEEK_END
 2

	)

145 #ifdeà
__USE_GNU


146 
	#SEEK_DATA
 3

	)

147 
	#SEEK_HOLE
 4

	)

151 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


153 
	#P_tmpdœ
 "/tmp"

	)

166 
	~<b™s/¡dio_lim.h
>

170 
_IO_FILE
 *
¡dš
;

171 
_IO_FILE
 *
¡dout
;

172 
_IO_FILE
 *
¡d”r
;

174 
	#¡dš
 
¡dš


	)

175 
	#¡dout
 
¡dout


	)

176 
	#¡d”r
 
¡d”r


	)

178 
__BEGIN_NAMESPACE_STD


180 
	$»move
 (cÚ¡ *
__f’ame
è
__THROW
;

182 
	$»Çme
 (cÚ¡ *
__Şd
, cÚ¡ *
__Ãw
è
__THROW
;

183 
__END_NAMESPACE_STD


185 #ifdeà
__USE_ATFILE


187 
	$»Çm—t
 (
__Şdfd
, cÚ¡ *
__Şd
, 
__Ãwfd
,

188 cÚ¡ *
__Ãw
è
__THROW
;

191 
__BEGIN_NAMESPACE_STD


196 #iâdeà
__USE_FILE_OFFSET64


197 
FILE
 *
	$tmpfe
 (è
__wur
;

199 #ifdeà
__REDIRECT


200 
FILE
 *
	`__REDIRECT
 (
tmpfe
, (), 
tmpfe64
è
__wur
;

202 
	#tmpfe
 
tmpfe64


	)

206 #ifdeà
__USE_LARGEFILE64


207 
FILE
 *
	$tmpfe64
 (è
__wur
;

211 *
	$tm²am
 (*
__s
è
__THROW
 
__wur
;

212 
__END_NAMESPACE_STD


214 #ifdeà
__USE_MISC


217 *
	$tm²am_r
 (*
__s
è
__THROW
 
__wur
;

221 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


229 *
	$‹m²am
 (cÚ¡ *
__dœ
, cÚ¡ *
__pfx
)

230 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

234 
__BEGIN_NAMESPACE_STD


239 
	`fşo£
 (
FILE
 *
__¡»am
);

244 
	`fæush
 (
FILE
 *
__¡»am
);

245 
__END_NAMESPACE_STD


247 #ifdeà
__USE_MISC


254 
	`fæush_uÆocked
 (
FILE
 *
__¡»am
);

257 #ifdeà
__USE_GNU


264 
	`fşo£®l
 ();

268 
__BEGIN_NAMESPACE_STD


269 #iâdeà
__USE_FILE_OFFSET64


274 
FILE
 *
	$fİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

275 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

280 
FILE
 *
	$äeİ’
 (cÚ¡ *
__»¡riù
 
__f’ame
,

281 cÚ¡ *
__»¡riù
 
__modes
,

282 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

284 #ifdeà
__REDIRECT


285 
FILE
 *
	`__REDIRECT
 (
fİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

286 cÚ¡ *
__»¡riù
 
__modes
), 
fİ’64
)

287 
__wur
;

288 
FILE
 *
	`__REDIRECT
 (
äeİ’
, (cÚ¡ *
__»¡riù
 
__f’ame
,

289 cÚ¡ *
__»¡riù
 
__modes
,

290 
FILE
 *
__»¡riù
 
__¡»am
), 
äeİ’64
)

291 
__wur
;

293 
	#fİ’
 
fİ’64


	)

294 
	#äeİ’
 
äeİ’64


	)

297 
__END_NAMESPACE_STD


298 #ifdeà
__USE_LARGEFILE64


299 
FILE
 *
	$fİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

300 cÚ¡ *
__»¡riù
 
__modes
è
__wur
;

301 
FILE
 *
	$äeİ’64
 (cÚ¡ *
__»¡riù
 
__f’ame
,

302 cÚ¡ *
__»¡riù
 
__modes
,

303 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

306 #ifdef 
__USE_POSIX


308 
FILE
 *
	$fdİ’
 (
__fd
, cÚ¡ *
__modes
è
__THROW
 
__wur
;

311 #ifdef 
__USE_GNU


314 
FILE
 *
	$fİ’cook›
 (*
__»¡riù
 
__magic_cook›
,

315 cÚ¡ *
__»¡riù
 
__modes
,

316 
_IO_cook›_io_funùiÚs_t
 
__io_funcs
è
__THROW
 
__wur
;

319 #ifdeà
__USE_XOPEN2K8


321 
FILE
 *
	$fmemİ’
 (*
__s
, 
size_t
 
__Ën
, cÚ¡ *
__modes
)

322 
__THROW
 
__wur
;

327 
FILE
 *
	$İ’_mem¡»am
 (**
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
 
__wur
;

331 
__BEGIN_NAMESPACE_STD


334 
	$£tbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
è
__THROW
;

338 
	$£tvbuf
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

339 
__modes
, 
size_t
 
__n
è
__THROW
;

340 
__END_NAMESPACE_STD


342 #ifdef 
__USE_MISC


345 
	$£tbufãr
 (
FILE
 *
__»¡riù
 
__¡»am
, *__»¡riù 
__buf
,

346 
size_t
 
__size
è
__THROW
;

349 
	$£šebuf
 (
FILE
 *
__¡»am
è
__THROW
;

353 
__BEGIN_NAMESPACE_STD


358 
	`årštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

359 cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

364 
	`´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

366 
	$¥rštf
 (*
__»¡riù
 
__s
,

367 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROWNL
;

373 
	`vårštf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

374 
_G_va_li¡
 
__¬g
);

379 
	`v´štf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
);

381 
	$v¥rštf
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

382 
_G_va_li¡
 
__¬g
è
__THROWNL
;

383 
__END_NAMESPACE_STD


385 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_UNIX98


386 
__BEGIN_NAMESPACE_C99


388 
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

389 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

390 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

392 
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__maxËn
,

393 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

394 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

395 
__END_NAMESPACE_C99


398 #ifdeà
__USE_GNU


401 
	$va¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__f
,

402 
_G_va_li¡
 
__¬g
)

403 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 0))è
__wur
;

404 
	$__a¥rštf
 (**
__»¡riù
 
__±r
,

405 cÚ¡ *
__»¡riù
 
__fmt
, ...)

406 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

407 
	$a¥rštf
 (**
__»¡riù
 
__±r
,

408 cÚ¡ *
__»¡riù
 
__fmt
, ...)

409 
__THROWNL
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 2, 3))è
__wur
;

412 #ifdeà
__USE_XOPEN2K8


414 
	$vd´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
,

415 
_G_va_li¡
 
__¬g
)

416 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

417 
	$d´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
, ...)

418 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

422 
__BEGIN_NAMESPACE_STD


427 
	$fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

428 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

433 
	$sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

435 
	$ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

436 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

438 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

439 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

440 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

441 #ifdeà
__REDIRECT


445 
	`__REDIRECT
 (
fsÿnf
, (
FILE
 *
__»¡riù
 
__¡»am
,

446 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

447 
__isoc99_fsÿnf
è
__wur
;

448 
	`__REDIRECT
 (
sÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

449 
__isoc99_sÿnf
è
__wur
;

450 
	`__REDIRECT_NTH
 (
ssÿnf
, (cÚ¡ *
__»¡riù
 
__s
,

451 cÚ¡ *
__»¡riù
 
__fÜm©
, ...),

452 
__isoc99_ssÿnf
);

454 
	$__isoc99_fsÿnf
 (
FILE
 *
__»¡riù
 
__¡»am
,

455 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

456 
	$__isoc99_sÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__wur
;

457 
	$__isoc99_ssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

458 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

459 
	#fsÿnf
 
__isoc99_fsÿnf


	)

460 
	#sÿnf
 
__isoc99_sÿnf


	)

461 
	#ssÿnf
 
__isoc99_ssÿnf


	)

465 
__END_NAMESPACE_STD


467 #ifdef 
__USE_ISOC99


468 
__BEGIN_NAMESPACE_C99


473 
	$vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fÜm©
,

474 
_G_va_li¡
 
__¬g
)

475 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

481 
	$vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

482 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

485 
	$vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

486 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
)

487 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

489 #ià!
defšed
 
__USE_GNU
 \

490 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

491 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

492 #ifdeà
__REDIRECT


496 
	`__REDIRECT
 (
vfsÿnf
,

497 (
FILE
 *
__»¡riù
 
__s
,

498 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__¬g
),

499 
__isoc99_vfsÿnf
)

500 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 2, 0))è
__wur
;

501 
	`__REDIRECT
 (
vsÿnf
, (cÚ¡ *
__»¡riù
 
__fÜm©
,

502 
_G_va_li¡
 
__¬g
), 
__isoc99_vsÿnf
)

503 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__sÿnf__
, 1, 0))è
__wur
;

504 
	`__REDIRECT_NTH
 (
vssÿnf
,

505 (cÚ¡ *
__»¡riù
 
__s
,

506 cÚ¡ *
__»¡riù
 
__fÜm©
,

507 
_G_va_li¡
 
__¬g
), 
__isoc99_vssÿnf
)

508 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__sÿnf__
, 2, 0)));

510 
	$__isoc99_vfsÿnf
 (
FILE
 *
__»¡riù
 
__s
,

511 cÚ¡ *
__»¡riù
 
__fÜm©
,

512 
_G_va_li¡
 
__¬g
è
__wur
;

513 
	$__isoc99_vsÿnf
 (cÚ¡ *
__»¡riù
 
__fÜm©
,

514 
_G_va_li¡
 
__¬g
è
__wur
;

515 
	$__isoc99_vssÿnf
 (cÚ¡ *
__»¡riù
 
__s
,

516 cÚ¡ *
__»¡riù
 
__fÜm©
,

517 
_G_va_li¡
 
__¬g
è
__THROW
;

518 
	#vfsÿnf
 
__isoc99_vfsÿnf


	)

519 
	#vsÿnf
 
__isoc99_vsÿnf


	)

520 
	#vssÿnf
 
__isoc99_vssÿnf


	)

524 
__END_NAMESPACE_C99


528 
__BEGIN_NAMESPACE_STD


533 
	`fg‘c
 (
FILE
 *
__¡»am
);

534 
	`g‘c
 (
FILE
 *
__¡»am
);

540 
	`g‘ch¬
 ();

541 
__END_NAMESPACE_STD


545 
	#g‘c
(
_å
è
	`_IO_g‘c
 (_å)

	)

547 #ifdeà
__USE_POSIX199506


552 
	`g‘c_uÆocked
 (
FILE
 *
__¡»am
);

553 
	`g‘ch¬_uÆocked
 ();

556 #ifdeà
__USE_MISC


563 
	`fg‘c_uÆocked
 (
FILE
 *
__¡»am
);

567 
__BEGIN_NAMESPACE_STD


575 
	`åutc
 (
__c
, 
FILE
 *
__¡»am
);

576 
	`putc
 (
__c
, 
FILE
 *
__¡»am
);

582 
	`putch¬
 (
__c
);

583 
__END_NAMESPACE_STD


587 
	#putc
(
_ch
, 
_å
è
	`_IO_putc
 (_ch, _å)

	)

589 #ifdeà
__USE_MISC


596 
	`åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

599 #ifdeà
__USE_POSIX199506


604 
	`putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
);

605 
	`putch¬_uÆocked
 (
__c
);

609 #ià
defšed
 
__USE_MISC
 \

610 || (
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

612 
	`g‘w
 (
FILE
 *
__¡»am
);

615 
	`putw
 (
__w
, 
FILE
 *
__¡»am
);

619 
__BEGIN_NAMESPACE_STD


624 *
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

625 
__wur
;

627 #ià!
defšed
 
__USE_ISOC11
 \

628 || (
defšed
 
__ılu¥lus
 && __cplusplus <= 201103L)

640 *
	$g‘s
 (*
__s
è
__wur
 
__©Œibu‹_d•»ÿ‹d__
;

642 
__END_NAMESPACE_STD


644 #ifdeà
__USE_GNU


651 *
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
,

652 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

656 #ifdef 
__USE_XOPEN2K8


667 
_IO_ssize_t
 
	$__g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

668 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

669 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

670 
_IO_ssize_t
 
	$g‘d–im
 (**
__»¡riù
 
__lš•Œ
,

671 
size_t
 *
__»¡riù
 
__n
, 
__d–im™”
,

672 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

680 
_IO_ssize_t
 
	$g‘lše
 (**
__»¡riù
 
__lš•Œ
,

681 
size_t
 *
__»¡riù
 
__n
,

682 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

686 
__BEGIN_NAMESPACE_STD


691 
	`åuts
 (cÚ¡ *
__»¡riù
 
__s
, 
FILE
 *__»¡riù 
__¡»am
);

697 
	`puts
 (cÚ¡ *
__s
);

704 
	`ung‘c
 (
__c
, 
FILE
 *
__¡»am
);

711 
size_t
 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

712 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

717 
size_t
 
	`fwr™e
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

718 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__s
);

719 
__END_NAMESPACE_STD


721 #ifdeà
__USE_GNU


728 
	`åuts_uÆocked
 (cÚ¡ *
__»¡riù
 
__s
,

729 
FILE
 *
__»¡riù
 
__¡»am
);

732 #ifdeà
__USE_MISC


739 
size_t
 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

740 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

741 
size_t
 
	`fwr™e_uÆocked
 (cÚ¡ *
__»¡riù
 
__±r
, size_ˆ
__size
,

742 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
);

746 
__BEGIN_NAMESPACE_STD


751 
	`f£ek
 (
FILE
 *
__¡»am
, 
__off
, 
__wh’û
);

756 
	$á–l
 (
FILE
 *
__¡»am
è
__wur
;

761 
	`»wšd
 (
FILE
 *
__¡»am
);

762 
__END_NAMESPACE_STD


769 #ià
defšed
 
__USE_LARGEFILE
 || defšed 
__USE_XOPEN2K


770 #iâdeà
__USE_FILE_OFFSET64


775 
	`f£eko
 (
FILE
 *
__¡»am
, 
__off_t
 
__off
, 
__wh’û
);

780 
__off_t
 
	$á–lo
 (
FILE
 *
__¡»am
è
__wur
;

782 #ifdeà
__REDIRECT


783 
	`__REDIRECT
 (
f£eko
,

784 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
),

785 
f£eko64
);

786 
__off64_t
 
	`__REDIRECT
 (
á–lo
, (
FILE
 *
__¡»am
), 
á–lo64
);

788 
	#f£eko
 
f£eko64


	)

789 
	#á–lo
 
á–lo64


	)

794 
__BEGIN_NAMESPACE_STD


795 #iâdeà
__USE_FILE_OFFSET64


800 
	`fg‘pos
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos_t
 *__»¡riù 
__pos
);

805 
	`f£os
 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
);

807 #ifdeà
__REDIRECT


808 
	`__REDIRECT
 (
fg‘pos
, (
FILE
 *
__»¡riù
 
__¡»am
,

809 
åos_t
 *
__»¡riù
 
__pos
), 
fg‘pos64
);

810 
	`__REDIRECT
 (
f£os
,

811 (
FILE
 *
__¡»am
, cÚ¡ 
åos_t
 *
__pos
), 
f£os64
);

813 
	#fg‘pos
 
fg‘pos64


	)

814 
	#f£os
 
f£os64


	)

817 
__END_NAMESPACE_STD


819 #ifdeà
__USE_LARGEFILE64


820 
	`f£eko64
 (
FILE
 *
__¡»am
, 
__off64_t
 
__off
, 
__wh’û
);

821 
__off64_t
 
	$á–lo64
 (
FILE
 *
__¡»am
è
__wur
;

822 
	`fg‘pos64
 (
FILE
 *
__»¡riù
 
__¡»am
, 
åos64_t
 *__»¡riù 
__pos
);

823 
	`f£os64
 (
FILE
 *
__¡»am
, cÚ¡ 
åos64_t
 *
__pos
);

826 
__BEGIN_NAMESPACE_STD


828 
	$ş—»¼
 (
FILE
 *
__¡»am
è
__THROW
;

830 
	$ãof
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

832 
	$ã¼Ü
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

833 
__END_NAMESPACE_STD


835 #ifdeà
__USE_MISC


837 
	$ş—»¼_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
;

838 
	$ãof_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

839 
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

843 
__BEGIN_NAMESPACE_STD


848 
	`³¼Ü
 (cÚ¡ *
__s
);

849 
__END_NAMESPACE_STD


855 
	~<b™s/sys_”¾i¡.h
>

858 #ifdef 
__USE_POSIX


860 
	$f’o
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

863 #ifdeà
__USE_MISC


865 
	$f’o_uÆocked
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

869 #ifdeà
__USE_POSIX2


874 
FILE
 *
	$pİ’
 (cÚ¡ *
__commªd
, cÚ¡ *
__modes
è
__wur
;

880 
	`pşo£
 (
FILE
 *
__¡»am
);

884 #ifdef 
__USE_POSIX


886 *
	$ù”mid
 (*
__s
è
__THROW
;

890 #ià(
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
è|| defšed 
__USE_GNU


892 *
	`cu£rid
 (*
__s
);

896 #ifdef 
__USE_GNU


897 
ob¡ack
;

900 
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

901 cÚ¡ *
__»¡riù
 
__fÜm©
, ...)

902 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 3)));

903 
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

904 cÚ¡ *
__»¡riù
 
__fÜm©
,

905 
_G_va_li¡
 
__¬gs
)

906 
__THROWNL
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 2, 0)));

910 #ifdeà
__USE_POSIX199506


914 
	$æockfe
 (
FILE
 *
__¡»am
è
__THROW
;

918 
	$árylockfe
 (
FILE
 *
__¡»am
è
__THROW
 
__wur
;

921 
	$fuÆockfe
 (
FILE
 *
__¡»am
è
__THROW
;

924 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


928 
	#__Ãed_g‘İt


	)

929 
	~<g‘İt.h
>

934 #ifdeà
__USE_EXTERN_INLINES


935 
	~<b™s/¡dio.h
>

937 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


938 
	~<b™s/¡dio2.h
>

940 #ifdeà
__LDBL_COMPAT


941 
	~<b™s/¡dio-ldbl.h
>

944 
__END_DECLS


	@/usr/include/stdlib.h

22 #iâdef 
_STDLIB_H


24 
	~<ã©u»s.h
>

27 
	#__Ãed_size_t


	)

28 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


29 
	#__Ãed_wch¬_t


	)

30 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

34 
	g__BEGIN_DECLS


36 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


37 
	#_STDLIB_H
 1

	)

39 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
è&& !defšed 
_SYS_WAIT_H


41 
	~<b™s/wa™æags.h
>

42 
	~<b™s/wa™¡©us.h
>

45 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (¡©us)

	)

46 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (¡©us)

	)

47 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (¡©us)

	)

48 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (¡©us)

	)

49 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (¡©us)

	)

50 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (¡©us)

	)

51 #ifdeà
__WIFCONTINUED


52 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (¡©us)

	)

56 
__BEGIN_NAMESPACE_STD


60 
	mquÙ
;

61 
	m»m
;

62 } 
	tdiv_t
;

65 #iâdeà
__ldiv_t_defšed


68 
	mquÙ
;

69 
	m»m
;

70 } 
	tldiv_t
;

71 
	#__ldiv_t_defšed
 1

	)

73 
	g__END_NAMESPACE_STD


75 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__Îdiv_t_defšed


76 
__BEGIN_NAMESPACE_C99


78 
__ex‹nsiÚ__
 struct

80 
	mquÙ
;

81 
	m»m
;

82 } 
	tÎdiv_t
;

83 
	#__Îdiv_t_defšed
 1

	)

84 
	g__END_NAMESPACE_C99


89 
	#RAND_MAX
 2147483647

	)

94 
	#EXIT_FAILURE
 1

	)

95 
	#EXIT_SUCCESS
 0

	)

99 
	#MB_CUR_MAX
 (
	`__ùy³_g‘_mb_cur_max
 ())

	)

100 
size_t
 
	$__ùy³_g‘_mb_cur_max
 (è
__THROW
 
__wur
;

103 
__BEGIN_NAMESPACE_STD


105 
	$©of
 (cÚ¡ *
__ÅŒ
)

106 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

108 
	$©oi
 (cÚ¡ *
__ÅŒ
)

109 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

111 
	$©Ş
 (cÚ¡ *
__ÅŒ
)

112 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

113 
__END_NAMESPACE_STD


115 #ifdeà
__USE_ISOC99


116 
__BEGIN_NAMESPACE_C99


118 
__ex‹nsiÚ__
 
	$©Şl
 (cÚ¡ *
__ÅŒ
)

119 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

120 
__END_NAMESPACE_C99


123 
__BEGIN_NAMESPACE_STD


125 
	$¡¹od
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

126 **
__»¡riù
 
__’d±r
)

127 
__THROW
 
	`__nÚnuÎ
 ((1));

128 
__END_NAMESPACE_STD


130 #ifdef 
__USE_ISOC99


131 
__BEGIN_NAMESPACE_C99


133 
	$¡¹of
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

134 **
__»¡riù
 
__’d±r
è
__THROW
 
	`__nÚnuÎ
 ((1));

136 
	$¡¹Şd
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

137 **
__»¡riù
 
__’d±r
)

138 
__THROW
 
	`__nÚnuÎ
 ((1));

139 
__END_NAMESPACE_C99


142 
__BEGIN_NAMESPACE_STD


144 
	$¡¹Ş
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

145 **
__»¡riù
 
__’d±r
, 
__ba£
)

146 
__THROW
 
	`__nÚnuÎ
 ((1));

148 
	$¡¹oul
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

149 **
__»¡riù
 
__’d±r
, 
__ba£
)

150 
__THROW
 
	`__nÚnuÎ
 ((1));

151 
__END_NAMESPACE_STD


153 #ifdeà
__USE_MISC


155 
__ex‹nsiÚ__


156 
	$¡¹oq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

157 **
__»¡riù
 
__’d±r
, 
__ba£
)

158 
__THROW
 
	`__nÚnuÎ
 ((1));

160 
__ex‹nsiÚ__


161 
	$¡¹ouq
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

162 **
__»¡riù
 
__’d±r
, 
__ba£
)

163 
__THROW
 
	`__nÚnuÎ
 ((1));

166 #ifdeà
__USE_ISOC99


167 
__BEGIN_NAMESPACE_C99


169 
__ex‹nsiÚ__


170 
	$¡¹Şl
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

171 **
__»¡riù
 
__’d±r
, 
__ba£
)

172 
__THROW
 
	`__nÚnuÎ
 ((1));

174 
__ex‹nsiÚ__


175 
	$¡¹ouÎ
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

176 **
__»¡riù
 
__’d±r
, 
__ba£
)

177 
__THROW
 
	`__nÚnuÎ
 ((1));

178 
__END_NAMESPACE_C99


182 #ifdeà
__USE_GNU


196 
	~<xloÿË.h
>

200 
	$¡¹Ş_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

201 **
__»¡riù
 
__’d±r
, 
__ba£
,

202 
__loÿË_t
 
__loc
è
__THROW
 
	`__nÚnuÎ
 ((1, 4));

204 
	$¡¹oul_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

205 **
__»¡riù
 
__’d±r
,

206 
__ba£
, 
__loÿË_t
 
__loc
)

207 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

209 
__ex‹nsiÚ__


210 
	$¡¹Şl_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

211 **
__»¡riù
 
__’d±r
, 
__ba£
,

212 
__loÿË_t
 
__loc
)

213 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

215 
__ex‹nsiÚ__


216 
	$¡¹ouÎ_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

217 **
__»¡riù
 
__’d±r
,

218 
__ba£
, 
__loÿË_t
 
__loc
)

219 
__THROW
 
	`__nÚnuÎ
 ((1, 4));

221 
	$¡¹od_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

222 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

223 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

225 
	$¡¹of_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

226 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

227 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

229 
	$¡¹Şd_l
 (cÚ¡ *
__»¡riù
 
__ÅŒ
,

230 **
__»¡riù
 
__’d±r
,

231 
__loÿË_t
 
__loc
)

232 
__THROW
 
	`__nÚnuÎ
 ((1, 3));

236 #ifdeà
__USE_EXTERN_INLINES


237 
__BEGIN_NAMESPACE_STD


238 
__ex‹º_šlše
 

239 
	`__NTH
 (
	$©oi
 (cÚ¡ *
__ÅŒ
))

241  (è
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

242 
	}
}

243 
__ex‹º_šlše
 

244 
__NTH
 (
	$©Ş
 (cÚ¡ *
__ÅŒ
))

246  
	`¡¹Ş
 (
__ÅŒ
, (**è
NULL
, 10);

247 
	}
}

248 
	g__END_NAMESPACE_STD


250 #ifdeà
__USE_ISOC99


251 
__BEGIN_NAMESPACE_C99


252 
__ex‹nsiÚ__
 
__ex‹º_šlše
 

253 
__NTH
 (
	$©Şl
 (cÚ¡ *
__ÅŒ
))

255  
	`¡¹Şl
 (
__ÅŒ
, (**è
NULL
, 10);

256 
	}
}

257 
	g__END_NAMESPACE_C99


262 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


266 *
	$l64a
 (
__n
è
__THROW
 
__wur
;

269 
	$a64l
 (cÚ¡ *
__s
)

270 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1)è
__wur
;

274 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


275 
	~<sys/ty³s.h
>

282 
	$¿ndom
 (è
__THROW
;

285 
	$¤ªdom
 (
__£ed
è
__THROW
;

291 *
	$š™¡©e
 (
__£ed
, *
__¡©ebuf
,

292 
size_t
 
__¡©–’
è
__THROW
 
	`__nÚnuÎ
 ((2));

296 *
	$£t¡©e
 (*
__¡©ebuf
è
__THROW
 
	`__nÚnuÎ
 ((1));

299 #ifdeà
__USE_MISC


304 
	s¿ndom_d©a


306 
št32_t
 *
åŒ
;

307 
št32_t
 *
½Œ
;

308 
št32_t
 *
¡©e
;

309 
¿nd_ty³
;

310 
¿nd_deg
;

311 
¿nd_£p
;

312 
št32_t
 *
’d_±r
;

315 
	$¿ndom_r
 (
¿ndom_d©a
 *
__»¡riù
 
__buf
,

316 
št32_t
 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

318 
	$¤ªdom_r
 (
__£ed
, 
¿ndom_d©a
 *
__buf
)

319 
__THROW
 
	`__nÚnuÎ
 ((2));

321 
	$š™¡©e_r
 (
__£ed
, *
__»¡riù
 
__¡©ebuf
,

322 
size_t
 
__¡©–’
,

323 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

324 
__THROW
 
	`__nÚnuÎ
 ((2, 4));

326 
	$£t¡©e_r
 (*
__»¡riù
 
__¡©ebuf
,

327 
¿ndom_d©a
 *
__»¡riù
 
__buf
)

328 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

333 
__BEGIN_NAMESPACE_STD


335 
	$¿nd
 (è
__THROW
;

337 
	$¤ªd
 (
__£ed
è
__THROW
;

338 
__END_NAMESPACE_STD


340 #ifdeà
__USE_POSIX199506


342 
	$¿nd_r
 (*
__£ed
è
__THROW
;

346 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


350 
	$d¿nd48
 (è
__THROW
;

351 
	$”ªd48
 (
__xsubi
[3]è
__THROW
 
	`__nÚnuÎ
 ((1));

354 
	$Ìªd48
 (è
__THROW
;

355 
	$Äªd48
 (
__xsubi
[3])

356 
__THROW
 
	`__nÚnuÎ
 ((1));

359 
	$m¿nd48
 (è
__THROW
;

360 
	$j¿nd48
 (
__xsubi
[3])

361 
__THROW
 
	`__nÚnuÎ
 ((1));

364 
	$¤ªd48
 (
__£edv®
è
__THROW
;

365 *
	$£ed48
 (
__£ed16v
[3])

366 
__THROW
 
	`__nÚnuÎ
 ((1));

367 
	$lcÚg48
 (
__·¿m
[7]è
__THROW
 
	`__nÚnuÎ
 ((1));

369 #ifdeà
__USE_MISC


373 
	sd¿nd48_d©a


375 
__x
[3];

376 
__Şd_x
[3];

377 
__c
;

378 
__š™
;

379 
__ex‹nsiÚ__
 
__a
;

384 
	$d¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

385 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

386 
	$”ªd48_r
 (
__xsubi
[3],

387 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

388 *
__»¡riù
 
__»suÉ
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

391 
	$Ìªd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

392 *
__»¡riù
 
__»suÉ
)

393 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

394 
	$Äªd48_r
 (
__xsubi
[3],

395 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

396 *
__»¡riù
 
__»suÉ
)

397 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

400 
	$m¿nd48_r
 (
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

401 *
__»¡riù
 
__»suÉ
)

402 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

403 
	$j¿nd48_r
 (
__xsubi
[3],

404 
d¿nd48_d©a
 *
__»¡riù
 
__bufãr
,

405 *
__»¡riù
 
__»suÉ
)

406 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

409 
	$¤ªd48_r
 (
__£edv®
, 
d¿nd48_d©a
 *
__bufãr
)

410 
__THROW
 
	`__nÚnuÎ
 ((2));

412 
	$£ed48_r
 (
__£ed16v
[3],

413 
d¿nd48_d©a
 *
__bufãr
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

415 
	$lcÚg48_r
 (
__·¿m
[7],

416 
d¿nd48_d©a
 *
__bufãr
)

417 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

423 #iâdeà
__m®loc_ªd_ÿÎoc_defšed


424 
	#__m®loc_ªd_ÿÎoc_defšed


	)

425 
__BEGIN_NAMESPACE_STD


427 *
	$m®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

429 *
	$ÿÎoc
 (
size_t
 
__nmemb
, size_ˆ
__size
)

430 
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

431 
__END_NAMESPACE_STD


434 #iâdeà
__Ãed_m®loc_ªd_ÿÎoc


435 
__BEGIN_NAMESPACE_STD


441 *
	$»®loc
 (*
__±r
, 
size_t
 
__size
)

442 
__THROW
 
__©Œibu‹_w¬n_unu£d_»suÉ__
;

444 
	$ä“
 (*
__±r
è
__THROW
;

445 
__END_NAMESPACE_STD


447 #ifdef 
__USE_MISC


449 
	$cä“
 (*
__±r
è
__THROW
;

452 #ifdeà
__USE_MISC


453 
	~<®loÿ.h
>

456 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

457 || 
defšed
 
__USE_MISC


459 *
	$v®loc
 (
size_t
 
__size
è
__THROW
 
__©Œibu‹_m®loc__
 
__wur
;

462 #ifdeà
__USE_XOPEN2K


464 
	$posix_mem®ign
 (**
__mem±r
, 
size_t
 
__®ignm’t
, size_ˆ
__size
)

465 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

468 #ifdeà
__USE_ISOC11


470 *
	$®igÃd_®loc
 (
size_t
 
__®ignm’t
, size_ˆ
__size
)

471 
__THROW
 
__©Œibu‹_m®loc__
 
	`__©Œibu‹_®loc_size__
 ((2)è
__wur
;

474 
__BEGIN_NAMESPACE_STD


476 
	$abÜt
 (è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

480 
	`©ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

482 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


484 #ifdeà
__ılu¥lus


485 "C++" 
	`©_quick_ex™
 ((*
__func
) ())

486 
__THROW
 
	`__asm
 ("©_quick_ex™"è
	`__nÚnuÎ
 ((1));

488 
	`©_quick_ex™
 ((*
__func
è()è
__THROW
 
	`__nÚnuÎ
 ((1));

491 
__END_NAMESPACE_STD


493 #ifdef 
__USE_MISC


496 
	`Ú_ex™
 ((*
__func
è(
__¡©us
, *
__¬g
), *__arg)

497 
__THROW
 
	`__nÚnuÎ
 ((1));

500 
__BEGIN_NAMESPACE_STD


504 
	$ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

506 #ià
defšed
 
__USE_ISOC11
 || defšed 
__USE_ISOCXX11


510 
	$quick_ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

512 
__END_NAMESPACE_STD


514 #ifdeà
__USE_ISOC99


515 
__BEGIN_NAMESPACE_C99


518 
	$_Ex™
 (
__¡©us
è
__THROW
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

519 
__END_NAMESPACE_C99


523 
__BEGIN_NAMESPACE_STD


525 *
	$g‘’v
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

526 
__END_NAMESPACE_STD


528 #ifdeà
__USE_GNU


531 *
	$£cu»_g‘’v
 (cÚ¡ *
__Çme
)

532 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

535 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


539 
	$pu‹nv
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

542 #ifdeà
__USE_XOPEN2K


545 
	$£‹nv
 (cÚ¡ *
__Çme
, cÚ¡ *
__v®ue
, 
__»¶aû
)

546 
__THROW
 
	`__nÚnuÎ
 ((2));

549 
	$un£‹nv
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

552 #ifdef 
__USE_MISC


556 
	$ş—»nv
 (è
__THROW
;

560 #ià
defšed
 
__USE_MISC
 \

561 || (
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
)

567 *
	$mk‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1));

570 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


579 #iâdeà
__USE_FILE_OFFSET64


580 
	$mk¡emp
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

582 #ifdeà
__REDIRECT


583 
	`__REDIRECT
 (
mk¡emp
, (*
__‹m¶©e
), 
mk¡emp64
)

584 
	`__nÚnuÎ
 ((1)è
__wur
;

586 
	#mk¡emp
 
mk¡emp64


	)

589 #ifdeà
__USE_LARGEFILE64


590 
	$mk¡emp64
 (*
__‹m¶©e
è
	`__nÚnuÎ
 ((1)è
__wur
;

594 #ifdeà
__USE_MISC


601 #iâdeà
__USE_FILE_OFFSET64


602 
	$mk¡emps
 (*
__‹m¶©e
, 
__suffixËn
è
	`__nÚnuÎ
 ((1)è
__wur
;

604 #ifdeà
__REDIRECT


605 
	`__REDIRECT
 (
mk¡emps
, (*
__‹m¶©e
, 
__suffixËn
),

606 
mk¡emps64
è
	`__nÚnuÎ
 ((1)è
__wur
;

608 
	#mk¡emps
 
mk¡emps64


	)

611 #ifdeà
__USE_LARGEFILE64


612 
	$mk¡emps64
 (*
__‹m¶©e
, 
__suffixËn
)

613 
	`__nÚnuÎ
 ((1)è
__wur
;

617 #ifdeà
__USE_XOPEN2K8


623 *
	$mkd‹mp
 (*
__‹m¶©e
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

626 #ifdeà
__USE_GNU


633 #iâdeà
__USE_FILE_OFFSET64


634 
	$mko¡emp
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

636 #ifdeà
__REDIRECT


637 
	`__REDIRECT
 (
mko¡emp
, (*
__‹m¶©e
, 
__æags
), 
mko¡emp64
)

638 
	`__nÚnuÎ
 ((1)è
__wur
;

640 
	#mko¡emp
 
mko¡emp64


	)

643 #ifdeà
__USE_LARGEFILE64


644 
	$mko¡emp64
 (*
__‹m¶©e
, 
__æags
è
	`__nÚnuÎ
 ((1)è
__wur
;

653 #iâdeà
__USE_FILE_OFFSET64


654 
	$mko¡emps
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

655 
	`__nÚnuÎ
 ((1)è
__wur
;

657 #ifdeà
__REDIRECT


658 
	`__REDIRECT
 (
mko¡emps
, (*
__‹m¶©e
, 
__suffixËn
,

659 
__æags
), 
mko¡emps64
)

660 
	`__nÚnuÎ
 ((1)è
__wur
;

662 
	#mko¡emps
 
mko¡emps64


	)

665 #ifdeà
__USE_LARGEFILE64


666 
	$mko¡emps64
 (*
__‹m¶©e
, 
__suffixËn
, 
__æags
)

667 
	`__nÚnuÎ
 ((1)è
__wur
;

672 
__BEGIN_NAMESPACE_STD


677 
	$sy¡em
 (cÚ¡ *
__commªd
è
__wur
;

678 
__END_NAMESPACE_STD


681 #ifdef 
__USE_GNU


684 *
	$ÿnÚiÿlize_fe_Çme
 (cÚ¡ *
__Çme
)

685 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

688 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


694 *
	$»®·th
 (cÚ¡ *
__»¡riù
 
__Çme
,

695 *
__»¡riù
 
__»sŞved
è
__THROW
 
__wur
;

700 #iâdeà
__COMPAR_FN_T


701 
	#__COMPAR_FN_T


	)

702 (*
	t__com·r_â_t
) (const *, const *);

704 #ifdef 
__USE_GNU


705 
__com·r_â_t
 
	tcom·risÚ_â_t
;

708 #ifdeà
__USE_GNU


709 (*
	t__com·r_d_â_t
) (const *, const *, *);

712 
__BEGIN_NAMESPACE_STD


715 *
	$b£¬ch
 (cÚ¡ *
__key
, cÚ¡ *
__ba£
,

716 
size_t
 
__nmemb
, size_ˆ
__size
, 
__com·r_â_t
 
__com·r
)

717 
	`__nÚnuÎ
 ((1, 2, 5)è
__wur
;

719 #ifdeà
__USE_EXTERN_INLINES


720 
	~<b™s/¡dlib-b£¬ch.h
>

725 
	$qsÜt
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

726 
__com·r_â_t
 
__com·r
è
	`__nÚnuÎ
 ((1, 4));

727 #ifdeà
__USE_GNU


728 
	$qsÜt_r
 (*
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

729 
__com·r_d_â_t
 
__com·r
, *
__¬g
)

730 
	`__nÚnuÎ
 ((1, 4));

735 
	$abs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

736 
	$Ïbs
 (
__x
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

737 
__END_NAMESPACE_STD


739 #ifdeà
__USE_ISOC99


740 
__ex‹nsiÚ__
 
	$Îabs
 (
__x
)

741 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

745 
__BEGIN_NAMESPACE_STD


749 
div_t
 
	$div
 (
__num”
, 
__d’om
)

750 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

751 
ldiv_t
 
	$ldiv
 (
__num”
, 
__d’om
)

752 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

753 
__END_NAMESPACE_STD


755 #ifdeà
__USE_ISOC99


756 
__BEGIN_NAMESPACE_C99


757 
__ex‹nsiÚ__
 
Îdiv_t
 
	$Îdiv
 (
__num”
,

758 
__d’om
)

759 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
)è
__wur
;

760 
__END_NAMESPACE_C99


764 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

765 || 
defšed
 
__USE_MISC


772 *
	$ecvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

773 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

778 *
	$fcvt
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

779 *
__»¡riù
 
__sign
è
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

784 *
	$gcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

785 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

788 #ifdeà
__USE_MISC


790 *
	$qecvt
 (
__v®ue
, 
__ndig™
,

791 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

792 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

793 *
	$qfcvt
 (
__v®ue
, 
__ndig™
,

794 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
)

795 
__THROW
 
	`__nÚnuÎ
 ((3, 4)è
__wur
;

796 *
	$qgcvt
 (
__v®ue
, 
__ndig™
, *
__buf
)

797 
__THROW
 
	`__nÚnuÎ
 ((3)è
__wur
;

802 
	$ecvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

803 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

804 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

805 
	$fcvt_r
 (
__v®ue
, 
__ndig™
, *
__»¡riù
 
__deıt
,

806 *
__»¡riù
 
__sign
, *__»¡riù 
__buf
,

807 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

809 
	$qecvt_r
 (
__v®ue
, 
__ndig™
,

810 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

811 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

812 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

813 
	$qfcvt_r
 (
__v®ue
, 
__ndig™
,

814 *
__»¡riù
 
__deıt
, *__»¡riù 
__sign
,

815 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

816 
__THROW
 
	`__nÚnuÎ
 ((3, 4, 5));

820 
__BEGIN_NAMESPACE_STD


823 
	$mbËn
 (cÚ¡ *
__s
, 
size_t
 
__n
è
__THROW
;

826 
	$mbtowc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

827 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

830 
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
è
__THROW
;

834 
size_t
 
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__pwcs
,

835 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
è
__THROW
;

837 
size_t
 
	$wc¡ombs
 (*
__»¡riù
 
__s
,

838 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__pwcs
, 
size_t
 
__n
)

839 
__THROW
;

840 
__END_NAMESPACE_STD


843 #ifdeà
__USE_MISC


848 
	$½m©ch
 (cÚ¡ *
__»¥Ú£
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

852 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


859 
	$g‘subİt
 (**
__»¡riù
 
__İtiÚp
,

860 *cÚ¡ *
__»¡riù
 
__tok’s
,

861 **
__»¡riù
 
__v®u•
)

862 
__THROW
 
	`__nÚnuÎ
 ((1, 2, 3)è
__wur
;

866 #ifdeà
__USE_XOPEN


868 
	$£tkey
 (cÚ¡ *
__key
è
__THROW
 
	`__nÚnuÎ
 ((1));

874 #ifdeà
__USE_XOPEN2KXSI


876 
	$posix_İ’±
 (
__oæag
è
__wur
;

879 #ifdeà
__USE_XOPEN_EXTENDED


884 
	$g¿Á±
 (
__fd
è
__THROW
;

888 
	$uÆock±
 (
__fd
è
__THROW
;

893 *
	$±¢ame
 (
__fd
è
__THROW
 
__wur
;

896 #ifdeà
__USE_GNU


900 
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

901 
__THROW
 
	`__nÚnuÎ
 ((2));

904 
	`g‘±
 ();

907 #ifdeà
__USE_MISC


911 
	$g‘lßdavg
 (
__lßdavg
[], 
__ÃËm
)

912 
__THROW
 
	`__nÚnuÎ
 ((1));

915 #ià
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K


918 
	$‰y¦Ù
 (è
__THROW
;

921 
	~<b™s/¡dlib-æßt.h
>

924 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


925 
	~<b™s/¡dlib.h
>

927 #ifdeà
__LDBL_COMPAT


928 
	~<b™s/¡dlib-ldbl.h
>

932 #undeà
__Ãed_m®loc_ªd_ÿÎoc


934 
__END_DECLS


	@/usr/include/sys/ioctl.h

18 #iâdef 
_SYS_IOCTL_H


19 
	#_SYS_IOCTL_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	g__BEGIN_DECLS


26 
	~<b™s/ioùls.h
>

29 
	~<b™s/ioùl-ty³s.h
>

36 
	~<sys/‰ydeçuÉs.h
>

41 
	$ioùl
 (
__fd
, 
__»que¡
, ...è
__THROW
;

43 
__END_DECLS


	@/usr/include/sys/mman.h

19 #iâdef 
_SYS_MMAN_H


20 
	#_SYS_MMAN_H
 1

	)

22 
	~<ã©u»s.h
>

23 
	~<b™s/ty³s.h
>

24 
	#__Ãed_size_t


	)

25 
	~<¡ddef.h
>

27 #iâdeà
__off_t_defšed


28 #iâdeà
__USE_FILE_OFFSET64


29 
__off_t
 
	toff_t
;

31 
__off64_t
 
	toff_t
;

33 
	#__off_t_defšed


	)

36 #iâdeà
__mode_t_defšed


37 
__mode_t
 
	tmode_t
;

38 
	#__mode_t_defšed


	)

41 
	~<b™s/mmª.h
>

44 
	#MAP_FAILED
 ((*è-1)

	)

46 
	g__BEGIN_DECLS


56 #iâdeà
__USE_FILE_OFFSET64


57 *
	$mm­
 (*
__addr
, 
size_t
 
__Ën
, 
__´Ù
,

58 
__æags
, 
__fd
, 
__off_t
 
__off£t
è
__THROW
;

60 #ifdeà
__REDIRECT_NTH


61 * 
	`__REDIRECT_NTH
 (
mm­
,

62 (*
__addr
, 
size_t
 
__Ën
, 
__´Ù
,

63 
__æags
, 
__fd
, 
__off64_t
 
__off£t
),

64 
mm­64
);

66 
	#mm­
 
mm­64


	)

69 #ifdeà
__USE_LARGEFILE64


70 *
	$mm­64
 (*
__addr
, 
size_t
 
__Ën
, 
__´Ù
,

71 
__æags
, 
__fd
, 
__off64_t
 
__off£t
è
__THROW
;

76 
	$munm­
 (*
__addr
, 
size_t
 
__Ën
è
__THROW
;

81 
	$m´Ùeù
 (*
__addr
, 
size_t
 
__Ën
, 
__´Ù
è
__THROW
;

89 
	`msync
 (*
__addr
, 
size_t
 
__Ën
, 
__æags
);

91 #ifdeà
__USE_MISC


94 
	$madvi£
 (*
__addr
, 
size_t
 
__Ën
, 
__adviû
è
__THROW
;

96 #ifdeà
__USE_XOPEN2K


98 
	$posix_madvi£
 (*
__addr
, 
size_t
 
__Ën
, 
__adviû
è
__THROW
;

103 
	$mlock
 (cÚ¡ *
__addr
, 
size_t
 
__Ën
è
__THROW
;

106 
	$muÆock
 (cÚ¡ *
__addr
, 
size_t
 
__Ën
è
__THROW
;

111 
	$mlock®l
 (
__æags
è
__THROW
;

115 
	$muÆock®l
 (è
__THROW
;

117 #ifdeà
__USE_MISC


123 
	$mšcÜe
 (*
__¡¬t
, 
size_t
 
__Ën
, *
__vec
)

124 
__THROW
;

127 #ifdeà
__USE_GNU


133 *
	$m»m­
 (*
__addr
, 
size_t
 
__Şd_Ën
, size_ˆ
__Ãw_Ën
,

134 
__æags
, ...è
__THROW
;

138 
	$»m­_fe_·ges
 (*
__¡¬t
, 
size_t
 
__size
, 
__´Ù
,

139 
size_t
 
__pgoff
, 
__æags
è
__THROW
;

144 
	`shm_İ’
 (cÚ¡ *
__Çme
, 
__oæag
, 
mode_t
 
__mode
);

147 
	`shm_uÆšk
 (cÚ¡ *
__Çme
);

149 
__END_DECLS


	@/usr/include/sys/param.h

19 #iâdeà
_SYS_PARAM_H


20 
	#_SYS_PARAM_H
 1

	)

22 
	#__Ãed_NULL


	)

23 
	~<¡ddef.h
>

25 
	~<sys/ty³s.h
>

26 
	~<lim™s.h
>

27 
	~<’dŸn.h
>

28 
	~<sigÇl.h
>

31 
	~<b™s/·¿m.h
>

36 
	#NBBY
 
CHAR_BIT


	)

38 #ià!
defšed
 
NGROUPS
 && defšed 
NGROUPS_MAX


39 
	#NGROUPS
 
NGROUPS_MAX


	)

41 #ià!
defšed
 
MAXSYMLINKS
 && defšed 
SYMLOOP_MAX


42 
	#MAXSYMLINKS
 
SYMLOOP_MAX


	)

44 #ià!
defšed
 
CANBSIZ
 && defšed 
MAX_CANON


45 
	#CANBSIZ
 
MAX_CANON


	)

47 #ià!
defšed
 
MAXPATHLEN
 && defšed 
PATH_MAX


48 
	#MAXPATHLEN
 
PATH_MAX


	)

50 #ià!
defšed
 
NOFILE
 && defšed 
OPEN_MAX


51 
	#NOFILE
 
OPEN_MAX


	)

53 #ià!
defšed
 
MAXHOSTNAMELEN
 && defšed 
HOST_NAME_MAX


54 
	#MAXHOSTNAMELEN
 
HOST_NAME_MAX


	)

56 #iâdeà
NCARGS


57 #ifdeà
ARG_MAX


58 
	#NCARGS
 
ARG_MAX


	)

62 
	#NCARGS
 
INT_MAX


	)

68 #iâdeà
NOGROUP


69 
	#NOGROUP
 65535

	)

71 #iâdeà
NODEV


72 
	#NODEV
 ((
dev_t
è-1è

	)

77 #iâdeà
DEV_BSIZE


78 
	#DEV_BSIZE
 512

	)

83 
	#£tb™
(
a
,
i
è(×)[(i)/
NBBY
] |ğ1<<((i)%NBBY))

	)

84 
	#şrb™
(
a
,
i
è(×)[(i)/
NBBY
] &ğ~(1<<((i)%NBBY)))

	)

85 
	#is£t
(
a
,
i
è(×)[(i)/
NBBY
] & (1<<((i)%NBBY)))

	)

86 
	#isşr
(
a
,
i
è((×)[(i)/
NBBY
] & (1<<((i)%NBBY))è=ğ0)

	)

89 #iâdeà
howmªy


90 
	#howmªy
(
x
, 
y
è(((xè+ ((yè- 1)è/ (y))

	)

92 #ifdeà
__GNUC__


93 
	#roundup
(
x
, 
y
è(
	`__butš_cÚ¡ªt_p
 (yè&& 
	`pow”of2
 (y) \

94 ? (((
x
è+ (
y
) - 1) & ~((y) - 1)) \

95 : ((((
x
è+ ((
y
è- 1)è/ (y)è* (y)))

	)

97 
	#roundup
(
x
, 
y
è((((xè+ ((yè- 1)è/ (y)è* (y))

	)

99 
	#pow”of2
(
x
è((((xè- 1è& (x)è=ğ0)

	)

102 
	#MIN
(
a
,
b
è((×)<(b))?×):(b))

	)

103 
	#MAX
(
a
,
b
è((×)>(b))?×):(b))

	)

	@/usr/include/sys/resource.h

18 #iâdef 
_SYS_RESOURCE_H


19 
	#_SYS_RESOURCE_H
 1

	)

21 
	~<ã©u»s.h
>

24 
	~<b™s/»sourû.h
>

26 #iâdeà
__id_t_defšed


27 
__id_t
 
	tid_t
;

28 
	#__id_t_defšed


	)

31 
	g__BEGIN_DECLS


37 #ià
defšed
 
__USE_GNU
 && !defšed 
__ılu¥lus


38 
__¾im™_»sourû
 
	t__¾im™_»sourû_t
;

39 
__ru§ge_who
 
	t__ru§ge_who_t
;

40 
__´iÜ™y_which
 
	t__´iÜ™y_which_t
;

42 
	t__¾im™_»sourû_t
;

43 
	t__ru§ge_who_t
;

44 
	t__´iÜ™y_which_t
;

49 #iâdeà
__USE_FILE_OFFSET64


50 
	$g‘¾im™
 (
__¾im™_»sourû_t
 
__»sourû
,

51 
¾im™
 *
__¾im™s
è
__THROW
;

53 #ifdeà
__REDIRECT_NTH


54 
	`__REDIRECT_NTH
 (
g‘¾im™
, (
__¾im™_»sourû_t
 
__»sourû
,

55 
¾im™
 *
__¾im™s
), 
g‘¾im™64
);

57 
	#g‘¾im™
 
g‘¾im™64


	)

60 #ifdeà
__USE_LARGEFILE64


61 
	$g‘¾im™64
 (
__¾im™_»sourû_t
 
__»sourû
,

62 
¾im™64
 *
__¾im™s
è
__THROW
;

68 #iâdeà
__USE_FILE_OFFSET64


69 
	$£Œlim™
 (
__¾im™_»sourû_t
 
__»sourû
,

70 cÚ¡ 
¾im™
 *
__¾im™s
è
__THROW
;

72 #ifdeà
__REDIRECT_NTH


73 
	`__REDIRECT_NTH
 (
£Œlim™
, (
__¾im™_»sourû_t
 
__»sourû
,

74 cÚ¡ 
¾im™
 *
__¾im™s
),

75 
£Œlim™64
);

77 
	#£Œlim™
 
£Œlim™64


	)

80 #ifdeà
__USE_LARGEFILE64


81 
	$£Œlim™64
 (
__¾im™_»sourû_t
 
__»sourû
,

82 cÚ¡ 
¾im™64
 *
__¾im™s
è
__THROW
;

87 
	$g‘ru§ge
 (
__ru§ge_who_t
 
__who
, 
ru§ge
 *
__u§ge
è
__THROW
;

93 
	$g‘´iÜ™y
 (
__´iÜ™y_which_t
 
__which
, 
id_t
 
__who
è
__THROW
;

97 
	$£riÜ™y
 (
__´iÜ™y_which_t
 
__which
, 
id_t
 
__who
, 
__´io
)

98 
__THROW
;

100 
__END_DECLS


	@/usr/include/sys/select.h

21 #iâdeà
_SYS_SELECT_H


22 
	#_SYS_SELECT_H
 1

	)

24 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

30 
	~<b™s/£Ëù.h
>

33 
	~<b™s/sig£t.h
>

35 #iâdeà
__sig£t_t_defšed


36 
	#__sig£t_t_defšed


	)

37 
__sig£t_t
 
	tsig£t_t
;

41 
	#__Ãed_time_t


	)

42 #ifdeà
__USE_XOPEN2K


43 
	#__Ãed_time¥ec


	)

45 
	~<time.h
>

46 
	#__Ãed_timev®


	)

47 
	~<b™s/time.h
>

49 #iâdeà
__su£cÚds_t_defšed


50 
__su£cÚds_t
 
	tsu£cÚds_t
;

51 
	#__su£cÚds_t_defšed


	)

56 
	t__fd_mask
;

59 #undeà
__NFDBITS


61 
	#__NFDBITS
 (8 * (è (
__fd_mask
))

	)

62 
	#__FD_ELT
(
d
è((dè/ 
__NFDBITS
)

	)

63 
	#__FD_MASK
(
d
è((
__fd_mask
è(1UL << ((dè% 
__NFDBITS
)))

	)

70 #ifdeà
__USE_XOPEN


71 
__fd_mask
 
	mfds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

72 
	#__FDS_BITS
(
£t
è((£t)->
fds_b™s
)

	)

74 
__fd_mask
 
	m__fds_b™s
[
__FD_SETSIZE
 / 
__NFDBITS
];

75 
	#__FDS_BITS
(
£t
è((£t)->
__fds_b™s
)

	)

77 } 
	tfd_£t
;

80 
	#FD_SETSIZE
 
__FD_SETSIZE


	)

82 #ifdeà
__USE_MISC


84 
__fd_mask
 
	tfd_mask
;

87 
	#NFDBITS
 
__NFDBITS


	)

92 
	#FD_SET
(
fd
, 
fd£
è
	`__FD_SET
 (fd, fd£)

	)

93 
	#FD_CLR
(
fd
, 
fd£
è
	`__FD_CLR
 (fd, fd£)

	)

94 
	#FD_ISSET
(
fd
, 
fd£
è
	`__FD_ISSET
 (fd, fd£)

	)

95 
	#FD_ZERO
(
fd£
è
	`__FD_ZERO
 (fd£)

	)

98 
__BEGIN_DECLS


108 
£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

109 
fd_£t
 *
__»¡riù
 
__wr™efds
,

110 
fd_£t
 *
__»¡riù
 
__exû±fds
,

111 
timev®
 *
__»¡riù
 
__timeout
);

113 #ifdeà
__USE_XOPEN2K


120 
p£Ëù
 (
__nfds
, 
fd_£t
 *
__»¡riù
 
__»adfds
,

121 
fd_£t
 *
__»¡riù
 
__wr™efds
,

122 
fd_£t
 *
__»¡riù
 
__exû±fds
,

123 cÚ¡ 
time¥ec
 *
__»¡riù
 
__timeout
,

124 cÚ¡ 
__sig£t_t
 *
__»¡riù
 
__sigmask
);

129 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__GNUC__


130 
	~<b™s/£Ëù2.h
>

133 
	g__END_DECLS


	@/usr/include/sys/socket.h

19 #iâdef 
_SYS_SOCKET_H


20 
	#_SYS_SOCKET_H
 1

	)

22 
	~<ã©u»s.h
>

24 
	g__BEGIN_DECLS


26 
	~<sys/uio.h
>

27 
	#__Ãed_size_t


	)

28 
	~<¡ddef.h
>

29 #ifdeà
__USE_GNU


31 
	~<b™s/sig£t.h
>

38 
	~<b™s/sock‘.h
>

40 #ifdeà
__USE_MISC


43 
	sosockaddr


45 
	m§_çmy
;

46 
	m§_d©a
[14];

54 
	mSHUT_RD
 = 0,

55 
	#SHUT_RD
 
SHUT_RD


	)

56 
	mSHUT_WR
,

57 
	#SHUT_WR
 
SHUT_WR


	)

58 
	mSHUT_RDWR


59 
	#SHUT_RDWR
 
SHUT_RDWR


	)

68 #ià
defšed
 
__ılu¥lus
 || !
__GNUC_PREREQ
 (2, 7è|| !defšed 
__USE_GNU


69 
	#__SOCKADDR_ARG
 
sockaddr
 *
__»¡riù


	)

70 
	#__CONST_SOCKADDR_ARG
 cÚ¡ 
sockaddr
 *

	)

74 
	#__SOCKADDR_ALLTYPES
 \

75 
	`__SOCKADDR_ONETYPE
 (
sockaddr
) \

76 
	`__SOCKADDR_ONETYPE
 (
sockaddr_©
) \

77 
	`__SOCKADDR_ONETYPE
 (
sockaddr_ax25
) \

78 
	`__SOCKADDR_ONETYPE
 (
sockaddr_dl
) \

79 
	`__SOCKADDR_ONETYPE
 (
sockaddr_eÚ
) \

80 
	`__SOCKADDR_ONETYPE
 (
sockaddr_š
) \

81 
	`__SOCKADDR_ONETYPE
 (
sockaddr_š6
) \

82 
	`__SOCKADDR_ONETYPE
 (
sockaddr_š¬p
) \

83 
	`__SOCKADDR_ONETYPE
 (
sockaddr_x
) \

84 
	`__SOCKADDR_ONETYPE
 (
sockaddr_iso
) \

85 
	`__SOCKADDR_ONETYPE
 (
sockaddr_ns
) \

86 
	`__SOCKADDR_ONETYPE
 (
sockaddr_un
) \

87 
	`__SOCKADDR_ONETYPE
 (
sockaddr_x25
)

	)

89 
	#__SOCKADDR_ONETYPE
(
ty³
èty³ *
__»¡riù
 
__
##ty³##__;

	)

90 uniÚ { 
	m__SOCKADDR_ALLTYPES


91 } 
	t__SOCKADDR_ARG
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

92 #undeà
__SOCKADDR_ONETYPE


93 
	#__SOCKADDR_ONETYPE
(
ty³
ècÚ¡ ty³ *
__»¡riù
 
__
##ty³##__;

	)

94 uniÚ { 
	m__SOCKADDR_ALLTYPES


95 } 
	t__CONST_SOCKADDR_ARG
 
	t__©Œibu‹__
 ((
	t__Œª¥¬’t_uniÚ__
));

96 #undeà
__SOCKADDR_ONETYPE


99 #ifdeà
__USE_GNU


101 
	smmsghdr


103 
msghdr
 
	mmsg_hdr
;

104 
	mmsg_Ën
;

113 
	$sock‘
 (
__domaš
, 
__ty³
, 
__´ÙocŞ
è
__THROW
;

119 
	$sock‘·œ
 (
__domaš
, 
__ty³
, 
__´ÙocŞ
,

120 
__fds
[2]è
__THROW
;

123 
	$bšd
 (
__fd
, 
__CONST_SOCKADDR_ARG
 
__addr
, 
sockËn_t
 
__Ën
)

124 
__THROW
;

127 
	$g‘sockÇme
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

128 
sockËn_t
 *
__»¡riù
 
__Ën
è
__THROW
;

137 
	`cÚÃù
 (
__fd
, 
__CONST_SOCKADDR_ARG
 
__addr
, 
sockËn_t
 
__Ën
);

141 
	$g‘³”Çme
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

142 
sockËn_t
 *
__»¡riù
 
__Ën
è
__THROW
;

149 
ssize_t
 
	`£nd
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
, 
__æags
);

156 
ssize_t
 
	`»cv
 (
__fd
, *
__buf
, 
size_t
 
__n
, 
__æags
);

163 
ssize_t
 
	`£ndto
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

164 
__æags
, 
__CONST_SOCKADDR_ARG
 
__addr
,

165 
sockËn_t
 
__addr_Ën
);

174 
ssize_t
 
	`»cväom
 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

175 
__æags
, 
__SOCKADDR_ARG
 
__addr
,

176 
sockËn_t
 *
__»¡riù
 
__addr_Ën
);

184 
ssize_t
 
	`£ndmsg
 (
__fd
, cÚ¡ 
msghdr
 *
__mes§ge
,

185 
__æags
);

187 #ifdeà
__USE_GNU


193 
	`£ndmmsg
 (
__fd
, 
mmsghdr
 *
__vmes§ges
,

194 
__vËn
, 
__æags
);

202 
ssize_t
 
	`»cvmsg
 (
__fd
, 
msghdr
 *
__mes§ge
, 
__æags
);

204 #ifdeà
__USE_GNU


210 
	`»cvmmsg
 (
__fd
, 
mmsghdr
 *
__vmes§ges
,

211 
__vËn
, 
__æags
,

212 
time¥ec
 *
__tmo
);

219 
	$g‘sockİt
 (
__fd
, 
__Ëv–
, 
__İŠame
,

220 *
__»¡riù
 
__İtv®
,

221 
sockËn_t
 *
__»¡riù
 
__İ’
è
__THROW
;

226 
	$£tsockİt
 (
__fd
, 
__Ëv–
, 
__İŠame
,

227 cÚ¡ *
__İtv®
, 
sockËn_t
 
__İ’
è
__THROW
;

233 
	$li¡’
 (
__fd
, 
__n
è
__THROW
;

243 
	`acû±
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

244 
sockËn_t
 *
__»¡riù
 
__addr_Ën
);

246 #ifdeà
__USE_GNU


251 
	`acû±4
 (
__fd
, 
__SOCKADDR_ARG
 
__addr
,

252 
sockËn_t
 *
__»¡riù
 
__addr_Ën
, 
__æags
);

261 
	$shutdown
 (
__fd
, 
__how
è
__THROW
;

264 #ifdeà
__USE_XOPEN2K


266 
	$sock©m¬k
 (
__fd
è
__THROW
;

270 #ifdeà
__USE_MISC


274 
	$isfdty³
 (
__fd
, 
__fdty³
è
__THROW
;

279 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


280 
	~<b™s/sock‘2.h
>

283 
__END_DECLS


	@/usr/include/sys/stat.h

22 #iâdef 
_SYS_STAT_H


23 
	#_SYS_STAT_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

29 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K
 || defšed 
__USE_ATFILE


30 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


31 
	#__Ãed_time_t


	)

33 #ifdeà
__USE_ATFILE


34 
	#__Ãed_time¥ec


	)

36 
	~<time.h
>

39 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


42 #iâdeà
__dev_t_defšed


43 
__dev_t
 
	tdev_t
;

44 
	#__dev_t_defšed


	)

47 #iâdeà
__gid_t_defšed


48 
__gid_t
 
	tgid_t
;

49 
	#__gid_t_defšed


	)

52 #iâdeà
__šo_t_defšed


53 #iâdeà
__USE_FILE_OFFSET64


54 
__šo_t
 
	tšo_t
;

56 
__šo64_t
 
	tšo_t
;

58 
	#__šo_t_defšed


	)

61 #iâdeà
__mode_t_defšed


62 
__mode_t
 
	tmode_t
;

63 
	#__mode_t_defšed


	)

66 #iâdeà
__Æšk_t_defšed


67 
__Æšk_t
 
	tÆšk_t
;

68 
	#__Æšk_t_defšed


	)

71 #iâdeà
__off_t_defšed


72 #iâdeà
__USE_FILE_OFFSET64


73 
__off_t
 
	toff_t
;

75 
__off64_t
 
	toff_t
;

77 
	#__off_t_defšed


	)

80 #iâdeà
__uid_t_defšed


81 
__uid_t
 
	tuid_t
;

82 
	#__uid_t_defšed


	)

86 #ifdeà
__USE_UNIX98


87 #iâdeà
__blkút_t_defšed


88 #iâdeà
__USE_FILE_OFFSET64


89 
__blkút_t
 
	tblkút_t
;

91 
__blkút64_t
 
	tblkút_t
;

93 
	#__blkút_t_defšed


	)

96 #iâdeà
__blksize_t_defšed


97 
__blksize_t
 
	tblksize_t
;

98 
	#__blksize_t_defšed


	)

102 
	g__BEGIN_DECLS


104 
	~<b™s/¡©.h
>

106 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


107 
	#S_IFMT
 
__S_IFMT


	)

108 
	#S_IFDIR
 
__S_IFDIR


	)

109 
	#S_IFCHR
 
__S_IFCHR


	)

110 
	#S_IFBLK
 
__S_IFBLK


	)

111 
	#S_IFREG
 
__S_IFREG


	)

112 #ifdeà
__S_IFIFO


113 
	#S_IFIFO
 
__S_IFIFO


	)

115 #ifdeà
__S_IFLNK


116 
	#S_IFLNK
 
__S_IFLNK


	)

118 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
) \

119 && 
defšed
 
	g__S_IFSOCK


120 
	#S_IFSOCK
 
__S_IFSOCK


	)

126 
	#__S_ISTYPE
(
mode
, 
mask
è(((modeè& 
__S_IFMT
è=ğ(mask))

	)

128 
	#S_ISDIR
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFDIR
)

	)

129 
	#S_ISCHR
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFCHR
)

	)

130 
	#S_ISBLK
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFBLK
)

	)

131 
	#S_ISREG
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFREG
)

	)

132 #ifdeà
__S_IFIFO


133 
	#S_ISFIFO
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFIFO
)

	)

135 #ifdeà
__S_IFLNK


136 
	#S_ISLNK
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFLNK
)

	)

139 #ià
defšed
 
__USE_MISC
 && !defšed 
__S_IFLNK


140 
	#S_ISLNK
(
mode
è0

	)

143 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K
) \

144 && 
defšed
 
	g__S_IFSOCK


145 
	#S_ISSOCK
(
mode
è
	`__S_ISTYPE
((mode), 
__S_IFSOCK
)

	)

146 #–ià
defšed
 
__USE_XOPEN2K


147 
	#S_ISSOCK
(
mode
è0

	)

154 #ifdef 
__USE_POSIX199309


155 
	#S_TYPEISMQ
(
buf
è
	`__S_TYPEISMQ
(buf)

	)

156 
	#S_TYPEISSEM
(
buf
è
	`__S_TYPEISSEM
(buf)

	)

157 
	#S_TYPEISSHM
(
buf
è
	`__S_TYPEISSHM
(buf)

	)

163 
	#S_ISUID
 
__S_ISUID


	)

164 
	#S_ISGID
 
__S_ISGID


	)

166 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


168 
	#S_ISVTX
 
__S_ISVTX


	)

171 
	#S_IRUSR
 
__S_IREAD


	)

172 
	#S_IWUSR
 
__S_IWRITE


	)

173 
	#S_IXUSR
 
__S_IEXEC


	)

175 
	#S_IRWXU
 (
__S_IREAD
|
__S_IWRITE
|
__S_IEXEC
)

	)

177 #ifdeà
__USE_MISC


178 
	#S_IREAD
 
S_IRUSR


	)

179 
	#S_IWRITE
 
S_IWUSR


	)

180 
	#S_IEXEC
 
S_IXUSR


	)

183 
	#S_IRGRP
 (
S_IRUSR
 >> 3è

	)

184 
	#S_IWGRP
 (
S_IWUSR
 >> 3è

	)

185 
	#S_IXGRP
 (
S_IXUSR
 >> 3è

	)

187 
	#S_IRWXG
 (
S_IRWXU
 >> 3)

	)

189 
	#S_IROTH
 (
S_IRGRP
 >> 3è

	)

190 
	#S_IWOTH
 (
S_IWGRP
 >> 3è

	)

191 
	#S_IXOTH
 (
S_IXGRP
 >> 3è

	)

193 
	#S_IRWXO
 (
S_IRWXG
 >> 3)

	)

196 #ifdef 
__USE_MISC


198 
	#ACCESSPERMS
 (
S_IRWXU
|
S_IRWXG
|
S_IRWXO
è

	)

199 
	#ALLPERMS
 (
S_ISUID
|
S_ISGID
|
S_ISVTX
|
S_IRWXU
|
S_IRWXG
|
S_IRWXO
)

	)

200 
	#DEFFILEMODE
 (
S_IRUSR
|
S_IWUSR
|
S_IRGRP
|
S_IWGRP
|
S_IROTH
|
S_IWOTH
)

	)

202 
	#S_BLKSIZE
 512

	)

206 #iâdeà
__USE_FILE_OFFSET64


208 
	$¡©
 (cÚ¡ *
__»¡riù
 
__fe
,

209 
¡©
 *
__»¡riù
 
__buf
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

213 
	$f¡©
 (
__fd
, 
¡©
 *
__buf
è
__THROW
 
	`__nÚnuÎ
 ((2));

215 #ifdeà
__REDIRECT_NTH


216 
	`__REDIRECT_NTH
 (
¡©
, (cÚ¡ *
__»¡riù
 
__fe
,

217 
¡©
 *
__»¡riù
 
__buf
), 
¡©64
)

218 
	`__nÚnuÎ
 ((1, 2));

219 
	`__REDIRECT_NTH
 (
f¡©
, (
__fd
, 
¡©
 *
__buf
), 
f¡©64
)

220 
	`__nÚnuÎ
 ((2));

222 
	#¡©
 
¡©64


	)

223 
	#f¡©
 
f¡©64


	)

226 #ifdeà
__USE_LARGEFILE64


227 
	$¡©64
 (cÚ¡ *
__»¡riù
 
__fe
,

228 
¡©64
 *
__»¡riù
 
__buf
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

229 
	$f¡©64
 (
__fd
, 
¡©64
 *
__buf
è
__THROW
 
	`__nÚnuÎ
 ((2));

232 #ifdeà
__USE_ATFILE


236 #iâdeà
__USE_FILE_OFFSET64


237 
	$f¡©©
 (
__fd
, cÚ¡ *
__»¡riù
 
__fe
,

238 
¡©
 *
__»¡riù
 
__buf
, 
__æag
)

239 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

241 #ifdeà
__REDIRECT_NTH


242 
	`__REDIRECT_NTH
 (
f¡©©
, (
__fd
, cÚ¡ *
__»¡riù
 
__fe
,

243 
¡©
 *
__»¡riù
 
__buf
,

244 
__æag
),

245 
f¡©©64
è
	`__nÚnuÎ
 ((2, 3));

247 
	#f¡©©
 
f¡©©64


	)

251 #ifdeà
__USE_LARGEFILE64


252 
	$f¡©©64
 (
__fd
, cÚ¡ *
__»¡riù
 
__fe
,

253 
¡©64
 *
__»¡riù
 
__buf
, 
__æag
)

254 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

258 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


259 #iâdeà
__USE_FILE_OFFSET64


262 
	$l¡©
 (cÚ¡ *
__»¡riù
 
__fe
,

263 
¡©
 *
__»¡riù
 
__buf
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

265 #ifdeà
__REDIRECT_NTH


266 
	`__REDIRECT_NTH
 (
l¡©
,

267 (cÚ¡ *
__»¡riù
 
__fe
,

268 
¡©
 *
__»¡riù
 
__buf
), 
l¡©64
)

269 
	`__nÚnuÎ
 ((1, 2));

271 
	#l¡©
 
l¡©64


	)

274 #ifdeà
__USE_LARGEFILE64


275 
	$l¡©64
 (cÚ¡ *
__»¡riù
 
__fe
,

276 
¡©64
 *
__»¡riù
 
__buf
)

277 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

283 
	$chmod
 (cÚ¡ *
__fe
, 
__mode_t
 
__mode
)

284 
__THROW
 
	`__nÚnuÎ
 ((1));

286 #ifdeà
__USE_MISC


290 
	$lchmod
 (cÚ¡ *
__fe
, 
__mode_t
 
__mode
)

291 
__THROW
 
	`__nÚnuÎ
 ((1));

295 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_XOPEN_EXTENDED


296 
	$fchmod
 (
__fd
, 
__mode_t
 
__mode
è
__THROW
;

299 #ifdeà
__USE_ATFILE


302 
	$fchmod©
 (
__fd
, cÚ¡ *
__fe
, 
__mode_t
 
__mode
,

303 
__æag
)

304 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

311 
__mode_t
 
	$umask
 (
__mode_t
 
__mask
è
__THROW
;

313 #ifdef 
__USE_GNU


316 
__mode_t
 
	$g‘umask
 (è
__THROW
;

320 
	$mkdœ
 (cÚ¡ *
__·th
, 
__mode_t
 
__mode
)

321 
__THROW
 
	`__nÚnuÎ
 ((1));

323 #ifdeà
__USE_ATFILE


327 
	$mkdœ©
 (
__fd
, cÚ¡ *
__·th
, 
__mode_t
 
__mode
)

328 
__THROW
 
	`__nÚnuÎ
 ((2));

334 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


335 
	$mknod
 (cÚ¡ *
__·th
, 
__mode_t
 
__mode
, 
__dev_t
 
__dev
)

336 
__THROW
 
	`__nÚnuÎ
 ((1));

338 #ifdeà
__USE_ATFILE


342 
	$mknod©
 (
__fd
, cÚ¡ *
__·th
, 
__mode_t
 
__mode
,

343 
__dev_t
 
__dev
è
__THROW
 
	`__nÚnuÎ
 ((2));

349 
	$mkfifo
 (cÚ¡ *
__·th
, 
__mode_t
 
__mode
)

350 
__THROW
 
	`__nÚnuÎ
 ((1));

352 #ifdeà
__USE_ATFILE


356 
	$mkfifßt
 (
__fd
, cÚ¡ *
__·th
, 
__mode_t
 
__mode
)

357 
__THROW
 
	`__nÚnuÎ
 ((2));

360 #ifdeà
__USE_ATFILE


363 
	$utim’§t
 (
__fd
, cÚ¡ *
__·th
,

364 cÚ¡ 
time¥ec
 
__times
[2],

365 
__æags
)

366 
__THROW
 
	`__nÚnuÎ
 ((2));

369 #ifdeà
__USE_XOPEN2K8


371 
	$futim’s
 (
__fd
, cÚ¡ 
time¥ec
 
__times
[2]è
__THROW
;

389 #iâdeà
_STAT_VER


390 
	#_STAT_VER
 0

	)

392 #iâdeà
_MKNOD_VER


393 
	#_MKNOD_VER
 0

	)

397 #iâdeà
__USE_FILE_OFFSET64


398 
	$__fx¡©
 (
__v”
, 
__fdes
, 
¡©
 *
__¡©_buf
)

399 
__THROW
 
	`__nÚnuÎ
 ((3));

400 
	$__x¡©
 (
__v”
, cÚ¡ *
__f’ame
,

401 
¡©
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

402 
	$__lx¡©
 (
__v”
, cÚ¡ *
__f’ame
,

403 
¡©
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

404 
	$__fx¡©©
 (
__v”
, 
__fdes
, cÚ¡ *
__f’ame
,

405 
¡©
 *
__¡©_buf
, 
__æag
)

406 
__THROW
 
	`__nÚnuÎ
 ((3, 4));

408 #ifdeà
__REDIRECT_NTH


409 
	`__REDIRECT_NTH
 (
__fx¡©
, (
__v”
, 
__fdes
,

410 
¡©
 *
__¡©_buf
), 
__fx¡©64
)

411 
	`__nÚnuÎ
 ((3));

412 
	`__REDIRECT_NTH
 (
__x¡©
, (
__v”
, cÚ¡ *
__f’ame
,

413 
¡©
 *
__¡©_buf
), 
__x¡©64
)

414 
	`__nÚnuÎ
 ((2, 3));

415 
	`__REDIRECT_NTH
 (
__lx¡©
, (
__v”
, cÚ¡ *
__f’ame
,

416 
¡©
 *
__¡©_buf
), 
__lx¡©64
)

417 
	`__nÚnuÎ
 ((2, 3));

418 
	`__REDIRECT_NTH
 (
__fx¡©©
, (
__v”
, 
__fdes
,

419 cÚ¡ *
__f’ame
,

420 
¡©
 *
__¡©_buf
, 
__æag
),

421 
__fx¡©©64
è
	`__nÚnuÎ
 ((3, 4));

424 
	#__fx¡©
 
__fx¡©64


	)

425 
	#__x¡©
 
__x¡©64


	)

426 
	#__lx¡©
 
__lx¡©64


	)

430 #ifdeà
__USE_LARGEFILE64


431 
	$__fx¡©64
 (
__v”
, 
__fdes
, 
¡©64
 *
__¡©_buf
)

432 
__THROW
 
	`__nÚnuÎ
 ((3));

433 
	$__x¡©64
 (
__v”
, cÚ¡ *
__f’ame
,

434 
¡©64
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

435 
	$__lx¡©64
 (
__v”
, cÚ¡ *
__f’ame
,

436 
¡©64
 *
__¡©_buf
è
__THROW
 
	`__nÚnuÎ
 ((2, 3));

437 
	$__fx¡©©64
 (
__v”
, 
__fdes
, cÚ¡ *
__f’ame
,

438 
¡©64
 *
__¡©_buf
, 
__æag
)

439 
__THROW
 
	`__nÚnuÎ
 ((3, 4));

441 
	$__xmknod
 (
__v”
, cÚ¡ *
__·th
, 
__mode_t
 
__mode
,

442 
__dev_t
 *
__dev
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

444 
	$__xmknod©
 (
__v”
, 
__fd
, cÚ¡ *
__·th
,

445 
__mode_t
 
__mode
, 
__dev_t
 *
__dev
)

446 
__THROW
 
	`__nÚnuÎ
 ((3, 5));

448 #ifdeà
__USE_EXTERN_INLINES


451 
__ex‹º_šlše
 

452 
	`__NTH
 (
	$¡©
 (cÚ¡ *
__·th
, 
¡©
 *
__¡©buf
))

454  
	`__x¡©
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

455 
	}
}

457 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


458 
__ex‹º_šlše
 

459 
__NTH
 (
	$l¡©
 (cÚ¡ *
__·th
, 
¡©
 *
__¡©buf
))

461  
	`__lx¡©
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

462 
	}
}

465 
__ex‹º_šlše
 

466 
__NTH
 (
	$f¡©
 (
__fd
, 
¡©
 *
__¡©buf
))

468  
	`__fx¡©
 (
_STAT_VER
, 
__fd
, 
__¡©buf
);

469 
	}
}

471 #ifdeà
__USE_ATFILE


472 
__ex‹º_šlše
 

473 
__NTH
 (
	$f¡©©
 (
__fd
, cÚ¡ *
__f’ame
, 
¡©
 *
__¡©buf
,

474 
__æag
))

476  
	`__fx¡©©
 (
_STAT_VER
, 
__fd
, 
__f’ame
, 
__¡©buf
, 
__æag
);

477 
	}
}

480 #ifdeà
__USE_MISC


481 
__ex‹º_šlše
 

482 
__NTH
 (
	$mknod
 (cÚ¡ *
__·th
, 
__mode_t
 
__mode
, 
__dev_t
 
__dev
))

484  
	`__xmknod
 (
_MKNOD_VER
, 
__·th
, 
__mode
, &
__dev
);

485 
	}
}

488 #ifdeà
__USE_ATFILE


489 
__ex‹º_šlše
 

490 
__NTH
 (
	$mknod©
 (
__fd
, cÚ¡ *
__·th
, 
__mode_t
 
__mode
,

491 
__dev_t
 
__dev
))

493  
	`__xmknod©
 (
_MKNOD_VER
, 
__fd
, 
__·th
, 
__mode
, &
__dev
);

494 
	}
}

497 #ià
defšed
 
__USE_LARGEFILE64
 \

498 && (! 
defšed
 
	g__USE_FILE_OFFSET64
 \

499 || (
defšed
 
	g__REDIRECT_NTH
 && defšed 
	g__OPTIMIZE__
))

500 
__ex‹º_šlše
 

501 
__NTH
 (
	$¡©64
 (cÚ¡ *
__·th
, 
¡©64
 *
__¡©buf
))

503  
	`__x¡©64
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

504 
	}
}

506 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


507 
__ex‹º_šlše
 

508 
__NTH
 (
	$l¡©64
 (cÚ¡ *
__·th
, 
¡©64
 *
__¡©buf
))

510  
	`__lx¡©64
 (
_STAT_VER
, 
__·th
, 
__¡©buf
);

511 
	}
}

514 
__ex‹º_šlše
 

515 
__NTH
 (
	$f¡©64
 (
__fd
, 
¡©64
 *
__¡©buf
))

517  
	`__fx¡©64
 (
_STAT_VER
, 
__fd
, 
__¡©buf
);

518 
	}
}

520 #ifdeà
__USE_ATFILE


521 
__ex‹º_šlše
 

522 
__NTH
 (
	$f¡©©64
 (
__fd
, cÚ¡ *
__f’ame
, 
¡©64
 *
__¡©buf
,

523 
__æag
))

525  
	`__fx¡©©64
 (
_STAT_VER
, 
__fd
, 
__f’ame
, 
__¡©buf
, 
__æag
);

526 
	}
}

533 
	g__END_DECLS


	@/usr/include/sys/sysctl.h

18 #iâdef 
_SYS_SYSCTL_H


19 
	#_SYS_SYSCTL_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	#__Ãed_size_t


	)

23 
	~<¡ddef.h
>

25 #iâdeà
_LINUX_KERNEL_H


26 
	#_LINUX_KERNEL_H
 1

	)

27 
	#__undef_LINUX_KERNEL_H


	)

29 #iâdeà
_LINUX_TYPES_H


30 
	#_LINUX_TYPES_H
 1

	)

31 
	#__undef_LINUX_TYPES_H


	)

33 #iâdeà
_LINUX_LIST_H


34 
	#_LINUX_LIST_H
 1

	)

35 
	#__undef_LINUX_LIST_H


	)

37 #iâdeà
__LINUX_COMPILER_H


38 
	#__LINUX_COMPILER_H
 1

	)

39 
	#__u£r


	)

40 
	#__undef__LINUX_COMPILER_H


	)

43 
	~<lšux/sysùl.h
>

45 #ifdeà
__undef_LINUX_KERNEL_H


46 #undeà
_LINUX_KERNEL_H


47 #undeà
__undef_LINUX_KERNEL_H


49 #ifdeà
__undef_LINUX_TYPES_H


50 #undeà
_LINUX_TYPES_H


51 #undeà
__undef_LINUX_TYPES_H


53 #ifdeà
__undef_LINUX_LIST_H


54 #undeà
_LINUX_LIST_H


55 #undeà
__undef_LINUX_LIST_H


57 #ifdeà
__undef__LINUX_COMPILER_H


58 #undeà
__LINUX_COMPILER_H


59 #undeà
__u£r


60 #undeà
__undef__LINUX_COMPILER_H


63 
	~<b™s/sysùl.h
>

65 
__BEGIN_DECLS


68 
	$sysùl
 (*
__Çme
, 
__Æ’
, *
__Şdv®
,

69 
size_t
 *
__ŞdËÅ
, *
__Ãwv®
, size_ˆ
__ÃwËn
è
__THROW
;

71 
__END_DECLS


	@/usr/include/sys/time.h

18 #iâdeà
_SYS_TIME_H


19 
	#_SYS_TIME_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	~<b™s/ty³s.h
>

24 
	#__Ãed_time_t


	)

25 
	~<time.h
>

26 
	#__Ãed_timev®


	)

27 
	~<b™s/time.h
>

29 
	~<sys/£Ëù.h
>

31 #iâdeà
__su£cÚds_t_defšed


32 
__su£cÚds_t
 
	tsu£cÚds_t
;

33 
	#__su£cÚds_t_defšed


	)

37 
	g__BEGIN_DECLS


39 #ifdeà
__USE_GNU


41 
	#TIMEVAL_TO_TIMESPEC
(
tv
, 
ts
) { \

42 (
ts
)->
tv_£c
 = (
tv
)->tv_sec; \

43 (
ts
)->
tv_n£c
 = (
tv
)->
tv_u£c
 * 1000; \

44 }

	)

45 
	#TIMESPEC_TO_TIMEVAL
(
tv
, 
ts
) { \

46 (
tv
)->
tv_£c
 = (
ts
)->tv_sec; \

47 (
tv
)->
tv_u£c
 = (
ts
)->
tv_n£c
 / 1000; \

48 }

	)

52 #ifdeà
__USE_MISC


55 
	stimezÚe


57 
	mtz_mšu‹swe¡
;

58 
	mtz_d¡time
;

61 
timezÚe
 *
	t__»¡riù
 
	t__timezÚe_±r_t
;

63 *
	t__»¡riù
 
	t__timezÚe_±r_t
;

71 
	$g‘timeofday
 (
timev®
 *
__»¡riù
 
__tv
,

72 
__timezÚe_±r_t
 
__tz
è
__THROW
 
	`__nÚnuÎ
 ((1));

74 #ifdeà
__USE_MISC


77 
	$£‰imeofday
 (cÚ¡ 
timev®
 *
__tv
,

78 cÚ¡ 
timezÚe
 *
__tz
)

79 
__THROW
;

85 
	$adjtime
 (cÚ¡ 
timev®
 *
__d–
,

86 
timev®
 *
__Şdd–
è
__THROW
;

91 
	e__™im”_which


94 
ITIMER_REAL
 = 0,

95 
	#ITIMER_REAL
 
ITIMER_REAL


	)

97 
ITIMER_VIRTUAL
 = 1,

98 
	#ITIMER_VIRTUAL
 
ITIMER_VIRTUAL


	)

101 
ITIMER_PROF
 = 2

102 
	#ITIMER_PROF
 
ITIMER_PROF


	)

107 
	s™im”v®


110 
timev®
 
™_š‹rv®
;

112 
timev®
 
™_v®ue
;

115 #ià
defšed
 
__USE_GNU
 && !defšed 
__ılu¥lus


118 
__™im”_which
 
	t__™im”_which_t
;

120 
	t__™im”_which_t
;

125 
	$g‘™im”
 (
__™im”_which_t
 
__which
,

126 
™im”v®
 *
__v®ue
è
__THROW
;

131 
	$£t™im”
 (
__™im”_which_t
 
__which
,

132 cÚ¡ 
™im”v®
 *
__»¡riù
 
__Ãw
,

133 
™im”v®
 *
__»¡riù
 
__Şd
è
__THROW
;

138 
	$utimes
 (cÚ¡ *
__fe
, cÚ¡ 
timev®
 
__tvp
[2])

139 
__THROW
 
	`__nÚnuÎ
 ((1));

141 #ifdeà
__USE_MISC


143 
	$lutimes
 (cÚ¡ *
__fe
, cÚ¡ 
timev®
 
__tvp
[2])

144 
__THROW
 
	`__nÚnuÎ
 ((1));

147 
	$futimes
 (
__fd
, cÚ¡ 
timev®
 
__tvp
[2]è
__THROW
;

150 #ifdeà
__USE_GNU


154 
	$futime§t
 (
__fd
, cÚ¡ *
__fe
,

155 cÚ¡ 
timev®
 
__tvp
[2]è
__THROW
;

159 #ifdeà
__USE_MISC


162 
	#tim”is£t
(
tvp
è(Ñvp)->
tv_£c
 || (tvp)->
tv_u£c
)

	)

163 
	#tim”ş—r
(
tvp
è(Ñvp)->
tv_£c
 = (tvp)->
tv_u£c
 = 0)

	)

164 
	#tim”cmp
(
a
, 
b
, 
CMP
) \

165 (((
a
)->
tv_£c
 =ğ(
b
)->tv_sec) ? \

166 ((
a
)->
tv_u£c
 
	`CMP
 (
b
)->tv_usec) : \

167 ((
a
)->
tv_£c
 
	`CMP
 (
b
)->tv_£c))

	)

168 
	#tim”add
(
a
, 
b
, 
»suÉ
) \

170 (
»suÉ
)->
tv_£c
 = (
a
)->tv_£ø+ (
b
)->tv_sec; \

171 (
»suÉ
)->
tv_u£c
 = (
a
)->tv_u£ø+ (
b
)->tv_usec; \

172 ià((
»suÉ
)->
tv_u£c
 >= 1000000) \

174 ++(
»suÉ
)->
tv_£c
; \

175 (
»suÉ
)->
tv_u£c
 -= 1000000; \

177 
	}
} 0)

	)

178 
	#tim”sub
(
a
, 
b
, 
»suÉ
) \

180 (
»suÉ
)->
tv_£c
 = (
a
)->tv_£ø- (
b
)->tv_sec; \

181 (
»suÉ
)->
tv_u£c
 = (
a
)->tv_u£ø- (
b
)->tv_usec; \

182 ià((
»suÉ
)->
tv_u£c
 < 0) { \

183 --(
»suÉ
)->
tv_£c
; \

184 (
»suÉ
)->
tv_u£c
 += 1000000; \

186 } 0)

	)

189 
	g__END_DECLS


	@/usr/include/sys/types.h

22 #iâdef 
_SYS_TYPES_H


23 
	#_SYS_TYPES_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


29 
	~<b™s/ty³s.h
>

31 #ifdef 
__USE_MISC


32 #iâdeà
__u_ch¬_defšed


33 
__u_ch¬
 
	tu_ch¬
;

34 
__u_shÜt
 
	tu_shÜt
;

35 
__u_št
 
	tu_št
;

36 
__u_lÚg
 
	tu_lÚg
;

37 
__quad_t
 
	tquad_t
;

38 
__u_quad_t
 
	tu_quad_t
;

39 
__fsid_t
 
	tfsid_t
;

40 
	#__u_ch¬_defšed


	)

44 
__loff_t
 
	tloff_t
;

46 #iâdeà
__šo_t_defšed


47 #iâdeà
__USE_FILE_OFFSET64


48 
__šo_t
 
	tšo_t
;

50 
__šo64_t
 
	tšo_t
;

52 
	#__šo_t_defšed


	)

54 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__šo64_t_defšed


55 
__šo64_t
 
	tšo64_t
;

56 
	#__šo64_t_defšed


	)

59 #iâdeà
__dev_t_defšed


60 
__dev_t
 
	tdev_t
;

61 
	#__dev_t_defšed


	)

64 #iâdeà
__gid_t_defšed


65 
__gid_t
 
	tgid_t
;

66 
	#__gid_t_defšed


	)

69 #iâdeà
__mode_t_defšed


70 
__mode_t
 
	tmode_t
;

71 
	#__mode_t_defšed


	)

74 #iâdeà
__Æšk_t_defšed


75 
__Æšk_t
 
	tÆšk_t
;

76 
	#__Æšk_t_defšed


	)

79 #iâdeà
__uid_t_defšed


80 
__uid_t
 
	tuid_t
;

81 
	#__uid_t_defšed


	)

84 #iâdeà
__off_t_defšed


85 #iâdeà
__USE_FILE_OFFSET64


86 
__off_t
 
	toff_t
;

88 
__off64_t
 
	toff_t
;

90 
	#__off_t_defšed


	)

92 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


93 
__off64_t
 
	toff64_t
;

94 
	#__off64_t_defšed


	)

97 #iâdeà
__pid_t_defšed


98 
__pid_t
 
	tpid_t
;

99 
	#__pid_t_defšed


	)

102 #ià(
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8
) \

103 && !
defšed
 
__id_t_defšed


104 
__id_t
 
	tid_t
;

105 
	#__id_t_defšed


	)

108 #iâdeà
__ssize_t_defšed


109 
__ssize_t
 
	tssize_t
;

110 
	#__ssize_t_defšed


	)

113 #ifdef 
__USE_MISC


114 #iâdeà
__daddr_t_defšed


115 
__daddr_t
 
	tdaddr_t
;

116 
__ÿddr_t
 
	tÿddr_t
;

117 
	#__daddr_t_defšed


	)

121 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN
è&& !defšed 
__key_t_defšed


122 
__key_t
 
	tkey_t
;

123 
	#__key_t_defšed


	)

126 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


127 
	#__Ãed_şock_t


	)

129 
	#__Ãed_time_t


	)

130 
	#__Ãed_tim”_t


	)

131 
	#__Ãed_şockid_t


	)

132 
	~<time.h
>

134 #ifdeà
__USE_XOPEN


135 #iâdeà
__u£cÚds_t_defšed


136 
__u£cÚds_t
 
	tu£cÚds_t
;

137 
	#__u£cÚds_t_defšed


	)

139 #iâdeà
__su£cÚds_t_defšed


140 
__su£cÚds_t
 
	tsu£cÚds_t
;

141 
	#__su£cÚds_t_defšed


	)

145 
	#__Ãed_size_t


	)

146 
	~<¡ddef.h
>

148 #ifdeà
__USE_MISC


150 
	tulÚg
;

151 
	tushÜt
;

152 
	tušt
;

157 #ià!
__GNUC_PREREQ
 (2, 7)

160 #iâdeà
__št8_t_defšed


161 
	#__št8_t_defšed


	)

162 
	tšt8_t
;

163 
	tšt16_t
;

164 
	tšt32_t
;

165 #ià
__WORDSIZE
 == 64

166 
	tšt64_t
;

168 
__ex‹nsiÚ__
 
	tšt64_t
;

173 
	tu_št8_t
;

174 
	tu_št16_t
;

175 
	tu_št32_t
;

176 #ià
__WORDSIZE
 == 64

177 
	tu_št64_t
;

179 
__ex‹nsiÚ__
 
	tu_št64_t
;

182 
	t»gi¡”_t
;

187 
	#__štN_t
(
N
, 
MODE
) \

188 ##
	tN
##
	t_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	tMODE
)))

	)

189 
	t__u_štN_t
(
	tN
, 
	tMODE
) \

190 
	tu_št
##
	tN
##
	t_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	tMODE
)))

	)

192 #iâdeà
	t__št8_t_defšed


193 
	t__št8_t_defšed


	)

194 
	t__štN_t
 (8, 
	t__QI__
);

195 
__štN_t
 (16, 
__HI__
);

196 
__štN_t
 (32, 
__SI__
);

197 
__štN_t
 (64, 
__DI__
);

200 
__u_štN_t
 (8, 
__QI__
);

201 
__u_štN_t
 (16, 
__HI__
);

202 
__u_štN_t
 (32, 
__SI__
);

203 
__u_štN_t
 (64, 
__DI__
);

205 
	t»gi¡”_t
 
	t__©Œibu‹__
 ((
	t__mode__
 (
	t__wÜd__
)));

211 
	#__BIT_TYPES_DEFINED__
 1

	)

214 #ifdef 
__USE_MISC


216 
	~<’dŸn.h
>

219 
	~<sys/£Ëù.h
>

222 
	~<sys/sysmaüos.h
>

226 #ià(
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8
) \

227 && !
defšed
 
__blksize_t_defšed


228 
__blksize_t
 
	tblksize_t
;

229 
	#__blksize_t_defšed


	)

233 #iâdeà
__USE_FILE_OFFSET64


234 #iâdeà
__blkút_t_defšed


235 
__blkút_t
 
	tblkút_t
;

236 
	#__blkút_t_defšed


	)

238 #iâdeà
__fsblkút_t_defšed


239 
__fsblkút_t
 
	tfsblkút_t
;

240 
	#__fsblkút_t_defšed


	)

242 #iâdeà
__fsfút_t_defšed


243 
__fsfút_t
 
	tfsfút_t
;

244 
	#__fsfút_t_defšed


	)

247 #iâdeà
__blkút_t_defšed


248 
__blkút64_t
 
	tblkút_t
;

249 
	#__blkút_t_defšed


	)

251 #iâdeà
__fsblkút_t_defšed


252 
__fsblkút64_t
 
	tfsblkút_t
;

253 
	#__fsblkút_t_defšed


	)

255 #iâdeà
__fsfút_t_defšed


256 
__fsfút64_t
 
	tfsfút_t
;

257 
	#__fsfút_t_defšed


	)

261 #ifdeà
__USE_LARGEFILE64


262 
__blkút64_t
 
	tblkút64_t
;

263 
__fsblkút64_t
 
	tfsblkút64_t
;

264 
__fsfút64_t
 
	tfsfút64_t
;

269 #ià
defšed
 
__USE_POSIX199506
 || defšed 
__USE_UNIX98


270 
	~<b™s/±h»adty³s.h
>

273 
	g__END_DECLS


	@/usr/include/sys/uio.h

18 #iâdeà
_SYS_UIO_H


19 
	#_SYS_UIO_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	~<sys/ty³s.h
>

25 
	g__BEGIN_DECLS


28 
	~<b™s/uio.h
>

39 
ssize_t
 
	$»adv
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
)

40 
__wur
;

50 
ssize_t
 
	$wr™ev
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
)

51 
__wur
;

54 #ifdeà
__USE_MISC


55 #iâdeà
__USE_FILE_OFFSET64


65 
ssize_t
 
	$´—dv
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
,

66 
__off_t
 
__off£t
è
__wur
;

77 
ssize_t
 
	$pwr™ev
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
,

78 
__off_t
 
__off£t
è
__wur
;

80 #ifdeà
__REDIRECT


81 
ssize_t
 
	`__REDIRECT
 (
´—dv
, (
__fd
, cÚ¡ 
iovec
 *
__iovec
,

82 
__couÁ
, 
__off64_t
 
__off£t
),

83 
´—dv64
è
__wur
;

84 
ssize_t
 
	`__REDIRECT
 (
pwr™ev
, (
__fd
, cÚ¡ 
iovec
 *
__iovec
,

85 
__couÁ
, 
__off64_t
 
__off£t
),

86 
pwr™ev64
è
__wur
;

88 
	#´—dv
 
´—dv64


	)

89 
	#pwr™ev
 
pwr™ev64


	)

93 #ifdeà
__USE_LARGEFILE64


103 
ssize_t
 
	$´—dv64
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
,

104 
__off64_t
 
__off£t
è
__wur
;

115 
ssize_t
 
	$pwr™ev64
 (
__fd
, cÚ¡ 
iovec
 *
__iovec
, 
__couÁ
,

116 
__off64_t
 
__off£t
è
__wur
;

120 
__END_DECLS


	@/usr/include/sys/un.h

18 #iâdef 
_SYS_UN_H


19 
	#_SYS_UN_H
 1

	)

21 
	~<sys/cdefs.h
>

24 
	~<b™s/sockaddr.h
>

26 
__BEGIN_DECLS


29 
	ssockaddr_un


31 
__SOCKADDR_COMMON
 (
sun_
);

32 
	msun_·th
[108];

36 #ifdeà
__USE_MISC


37 
	~<¡ršg.h
>

40 
	#SUN_LEN
(
±r
è((
size_t
è(((
sockaddr_un
 *è0)->
sun_·th
) \

41 + 
	`¡¾’
 ((
±r
)->
sun_·th
))

	)

44 
	g__END_DECLS


	@/usr/include/sys/wait.h

22 #iâdef 
_SYS_WAIT_H


23 
	#_SYS_WAIT_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


29 
	~<sigÇl.h
>

32 #ià!
defšed
 
_STDLIB_H
 || (!defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K8
)

35 
	~<b™s/wa™æags.h
>

38 
	~<b™s/wa™¡©us.h
>

40 
	#WEXITSTATUS
(
¡©us
è
	`__WEXITSTATUS
 (¡©us)

	)

41 
	#WTERMSIG
(
¡©us
è
	`__WTERMSIG
 (¡©us)

	)

42 
	#WSTOPSIG
(
¡©us
è
	`__WSTOPSIG
 (¡©us)

	)

43 
	#WIFEXITED
(
¡©us
è
	`__WIFEXITED
 (¡©us)

	)

44 
	#WIFSIGNALED
(
¡©us
è
	`__WIFSIGNALED
 (¡©us)

	)

45 
	#WIFSTOPPED
(
¡©us
è
	`__WIFSTOPPED
 (¡©us)

	)

46 #ifdeà
__WIFCONTINUED


47 
	#WIFCONTINUED
(
¡©us
è
	`__WIFCONTINUED
 (¡©us)

	)

51 #ifdef 
__USE_MISC


52 
	#WCOREFLAG
 
__WCOREFLAG


	)

53 
	#WCOREDUMP
(
¡©us
è
	`__WCOREDUMP
 (¡©us)

	)

54 
	#W_EXITCODE
(
»t
, 
sig
è
	`__W_EXITCODE
 (»t, sig)

	)

55 
	#W_STOPCODE
(
sig
è
	`__W_STOPCODE
 (sig)

	)

63 
__pid_t
 
wa™
 (*
__¡©_loc
);

65 #ifdef 
__USE_MISC


67 
	#WAIT_ANY
 (-1è

	)

68 
	#WAIT_MYPGRP
 0

	)

86 
__pid_t
 
wa™pid
 (__pid_ˆ
__pid
, *
__¡©_loc
, 
__İtiÚs
);

88 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


89 #iâdeà
__id_t_defšed


90 
	~<b™s/ty³s.h
>

91 
__id_t
 
	tid_t
;

92 
	#__id_t_defšed


	)

95 
	#__Ãed_sigšfo_t


	)

96 
	~<b™s/sigšfo.h
>

109 
wa™id
 (
idty³_t
 
__idty³
, 
__id_t
 
__id
, 
sigšfo_t
 *
__šfİ
,

110 
__İtiÚs
);

113 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


116 
	gru§ge
;

123 
__pid_t
 
	$wa™3
 (*
__¡©_loc
, 
__İtiÚs
,

124 
ru§ge
 * 
__u§ge
è
__THROWNL
;

127 #ifdeà
__USE_MISC


129 
__pid_t
 
	$wa™4
 (
__pid_t
 
__pid
, *
__¡©_loc
, 
__İtiÚs
,

130 
ru§ge
 *
__u§ge
è
__THROWNL
;

134 
__END_DECLS


	@/usr/include/termio.h

5 
	~<‹rmios.h
>

6 
	~<sys/ioùl.h
>

	@/usr/include/termios.h

22 #iâdef 
_TERMIOS_H


23 
	#_TERMIOS_H
 1

	)

25 
	~<ã©u»s.h
>

26 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


28 
	~<b™s/ty³s.h
>

29 #iâdeà
__pid_t_defšed


30 
__pid_t
 
	tpid_t
;

31 
	#__pid_t_defšed


	)

35 
	g__BEGIN_DECLS


39 
	~<b™s/‹rmios.h
>

41 #ifdeà
__USE_MISC


44 
	#CCEQ
(
v®
, 
c
è((cè=ğ(v®è&& (v®è!ğ
_POSIX_VDISABLE
)

	)

48 
¥“d_t
 
	$cfg‘o¥“d
 (cÚ¡ 
‹rmios
 *
__‹rmios_p
è
__THROW
;

51 
¥“d_t
 
	$cfg‘i¥“d
 (cÚ¡ 
‹rmios
 *
__‹rmios_p
è
__THROW
;

54 
	$cf£to¥“d
 (
‹rmios
 *
__‹rmios_p
, 
¥“d_t
 
__¥“d
è
__THROW
;

57 
	$cf£ti¥“d
 (
‹rmios
 *
__‹rmios_p
, 
¥“d_t
 
__¥“d
è
__THROW
;

59 #ifdef 
__USE_MISC


61 
	$cf£t¥“d
 (
‹rmios
 *
__‹rmios_p
, 
¥“d_t
 
__¥“d
è
__THROW
;

66 
	$tcg‘©Œ
 (
__fd
, 
‹rmios
 *
__‹rmios_p
è
__THROW
;

70 
	$tc£‰r
 (
__fd
, 
__İtiÚ®_aùiÚs
,

71 cÚ¡ 
‹rmios
 *
__‹rmios_p
è
__THROW
;

74 #ifdef 
__USE_MISC


76 
	$cfmak”aw
 (
‹rmios
 *
__‹rmios_p
è
__THROW
;

80 
	$tc£ndb»ak
 (
__fd
, 
__du¿tiÚ
è
__THROW
;

86 
	`tcd¿š
 (
__fd
);

90 
	$tcæush
 (
__fd
, 
__queue_£ËùÜ
è
__THROW
;

94 
	$tcæow
 (
__fd
, 
__aùiÚ
è
__THROW
;

97 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


99 
__pid_t
 
	$tcg‘sid
 (
__fd
è
__THROW
;

103 #ifdeà
__USE_MISC


104 
	~<sys/‰ydeçuÉs.h
>

107 
__END_DECLS


	@/usr/include/time.h

22 #iâdef 
_TIME_H


24 #ià(! 
defšed
 
__Ãed_time_t
 && !defšed 
__Ãed_şock_t
 && \

25 ! 
defšed
 
	g__Ãed_time¥ec
)

26 
	#_TIME_H
 1

	)

27 
	~<ã©u»s.h
>

29 
	g__BEGIN_DECLS


33 #ifdef 
_TIME_H


35 
	#__Ãed_size_t


	)

36 
	#__Ãed_NULL


	)

37 
	~<¡ddef.h
>

41 
	~<b™s/time.h
>

44 #ià!
defšed
 
__STRICT_ANSI__
 && !defšed 
__USE_XOPEN2K


45 #iâdeà
CLK_TCK


46 
	#CLK_TCK
 
CLOCKS_PER_SEC


	)

52 #ià!
defšed
 
__şock_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_şock_t
)

53 
	#__şock_t_defšed
 1

	)

55 
	~<b™s/ty³s.h
>

57 
__BEGIN_NAMESPACE_STD


59 
__şock_t
 
	tşock_t
;

60 
	g__END_NAMESPACE_STD


61 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX


62 
	$__USING_NAMESPACE_STD
(
şock_t
)

66 #undeà
__Ãed_şock_t


68 #ià!
defšed
 
__time_t_defšed
 && (defšed 
_TIME_H
 || defšed 
__Ãed_time_t
)

69 
	#__time_t_defšed
 1

	)

71 
	~<b™s/ty³s.h
>

73 
__BEGIN_NAMESPACE_STD


75 
__time_t
 
	ttime_t
;

76 
__END_NAMESPACE_STD


77 #ifdeà
__USE_POSIX


78 
	$__USING_NAMESPACE_STD
(
time_t
)

82 #undeà
__Ãed_time_t


84 #ià!
defšed
 
__şockid_t_defšed
 && \

85 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_şockid_t
)

86 
	#__şockid_t_defšed
 1

	)

88 
	~<b™s/ty³s.h
>

91 
__şockid_t
 
	tşockid_t
;

94 #undeà
__şockid_time_t


96 #ià!
defšed
 
__tim”_t_defšed
 && \

97 ((
defšed
 
_TIME_H
 && defšed 
__USE_POSIX199309
è|| defšed 
__Ãed_tim”_t
)

98 
	#__tim”_t_defšed
 1

	)

100 
	~<b™s/ty³s.h
>

103 
__tim”_t
 
	ttim”_t
;

106 #undeà
__Ãed_tim”_t


109 #ià(!
defšed
 
__time¥ec_defšed
 \

110 && ((
defšed
 
_TIME_H
 \

111 && (
defšed
 
__USE_POSIX199309
 \

112 || 
defšed
 
__USE_ISOC11
)) \

113 || 
defšed
 
__Ãed_time¥ec
))

114 
	#__time¥ec_defšed
 1

	)

116 
	~<b™s/ty³s.h
>

120 
	stime¥ec


122 
__time_t
 
tv_£c
;

123 
__sysÿÎ_¦Úg_t
 
tv_n£c
;

127 #undeà
__Ãed_time¥ec


130 #ifdef 
_TIME_H


131 
__BEGIN_NAMESPACE_STD


133 
	stm


135 
tm_£c
;

136 
tm_mš
;

137 
tm_hour
;

138 
tm_mday
;

139 
tm_mÚ
;

140 
tm_y—r
;

141 
tm_wday
;

142 
tm_yday
;

143 
tm_isd¡
;

145 #ifdef 
__USE_MISC


146 
tm_gmtoff
;

147 cÚ¡ *
tm_zÚe
;

149 
__tm_gmtoff
;

150 cÚ¡ *
__tm_zÚe
;

153 
__END_NAMESPACE_STD


154 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_POSIX


155 
	$__USING_NAMESPACE_STD
(
tm
)

159 #ifdeà
__USE_POSIX199309


161 
	s™im”¥ec


163 
time¥ec
 
™_š‹rv®
;

164 
time¥ec
 
™_v®ue
;

168 
sigev’t
;

172 #ifdeà
__USE_XOPEN2K


173 #iâdeà
__pid_t_defšed


174 
__pid_t
 
	tpid_t
;

175 
	#__pid_t_defšed


	)

180 #ifdeà
__USE_ISOC11


182 
	#TIME_UTC
 1

	)

186 
__BEGIN_NAMESPACE_STD


189 
şock_t
 
	$şock
 (è
__THROW
;

192 
time_t
 
	$time
 (
time_t
 *
__tim”
è
__THROW
;

195 
	$difáime
 (
time_t
 
__time1
,ime_ˆ
__time0
)

196 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

199 
time_t
 
	$mktime
 (
tm
 *
__
è
__THROW
;

205 
size_t
 
	$¡ráime
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

206 cÚ¡ *
__»¡riù
 
__fÜm©
,

207 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

208 
__END_NAMESPACE_STD


210 #ifdeà
__USE_XOPEN


213 *
	$¡½time
 (cÚ¡ *
__»¡riù
 
__s
,

214 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
)

215 
__THROW
;

218 #ifdeà
__USE_XOPEN2K8


221 
	~<xloÿË.h
>

223 
size_t
 
	$¡ráime_l
 (*
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

224 cÚ¡ *
__»¡riù
 
__fÜm©
,

225 cÚ¡ 
tm
 *
__»¡riù
 
__
,

226 
__loÿË_t
 
__loc
è
__THROW
;

229 #ifdeà
__USE_GNU


230 *
	$¡½time_l
 (cÚ¡ *
__»¡riù
 
__s
,

231 cÚ¡ *
__»¡riù
 
__fmt
, 
tm
 *
__
,

232 
__loÿË_t
 
__loc
è
__THROW
;

236 
__BEGIN_NAMESPACE_STD


239 
tm
 *
	$gmtime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

243 
tm
 *
	$loÿÉime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

244 
__END_NAMESPACE_STD


246 #ifdeà
__USE_POSIX


249 
tm
 *
	$gmtime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

250 
tm
 *
__»¡riù
 
__
è
__THROW
;

254 
tm
 *
	$loÿÉime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

255 
tm
 *
__»¡riù
 
__
è
__THROW
;

258 
__BEGIN_NAMESPACE_STD


261 *
	$asùime
 (cÚ¡ 
tm
 *
__
è
__THROW
;

264 *
	$ùime
 (cÚ¡ 
time_t
 *
__tim”
è
__THROW
;

265 
__END_NAMESPACE_STD


267 #ifdeà
__USE_POSIX


272 *
	$asùime_r
 (cÚ¡ 
tm
 *
__»¡riù
 
__
,

273 *
__»¡riù
 
__buf
è
__THROW
;

276 *
	$ùime_r
 (cÚ¡ 
time_t
 *
__»¡riù
 
__tim”
,

277 *
__»¡riù
 
__buf
è
__THROW
;

282 *
__tzÇme
[2];

283 
__daylight
;

284 
__timezÚe
;

287 #ifdef 
__USE_POSIX


289 *
tzÇme
[2];

293 
	$tz£t
 (è
__THROW
;

296 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


297 
daylight
;

298 
timezÚe
;

301 #ifdeà
__USE_MISC


304 
	$¡ime
 (cÚ¡ 
time_t
 *
__wh’
è
__THROW
;

310 
	#__i¦—p
(
y—r
) \

311 ((
y—r
è% 4 =ğ0 && ((y—rè% 100 !ğ0 || (y—rè% 400 =ğ0))

	)

314 #ifdeà
__USE_MISC


319 
time_t
 
	$timegm
 (
tm
 *
__
è
__THROW
;

322 
time_t
 
	$tim–oÿl
 (
tm
 *
__
è
__THROW
;

325 
	$dysize
 (
__y—r
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

329 #ifdeà
__USE_POSIX199309


334 
	`Çno¦“p
 (cÚ¡ 
time¥ec
 *
__»que¡ed_time
,

335 
time¥ec
 *
__»maššg
);

339 
	$şock_g‘»s
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__»s
è
__THROW
;

342 
	$şock_g‘time
 (
şockid_t
 
__şock_id
, 
time¥ec
 *
__
è
__THROW
;

345 
	$şock_£‰ime
 (
şockid_t
 
__şock_id
, cÚ¡ 
time¥ec
 *
__
)

346 
__THROW
;

348 #ifdeà
__USE_XOPEN2K


353 
	`şock_Çno¦“p
 (
şockid_t
 
__şock_id
, 
__æags
,

354 cÚ¡ 
time¥ec
 *
__»q
,

355 
time¥ec
 *
__»m
);

358 
	$şock_g‘ıuşockid
 (
pid_t
 
__pid
, 
şockid_t
 *
__şock_id
è
__THROW
;

363 
	$tim”_ü—‹
 (
şockid_t
 
__şock_id
,

364 
sigev’t
 *
__»¡riù
 
__evp
,

365 
tim”_t
 *
__»¡riù
 
__tim”id
è
__THROW
;

368 
	$tim”_d–‘e
 (
tim”_t
 
__tim”id
è
__THROW
;

371 
	$tim”_£‰ime
 (
tim”_t
 
__tim”id
, 
__æags
,

372 cÚ¡ 
™im”¥ec
 *
__»¡riù
 
__v®ue
,

373 
™im”¥ec
 *
__»¡riù
 
__ov®ue
è
__THROW
;

376 
	$tim”_g‘time
 (
tim”_t
 
__tim”id
, 
™im”¥ec
 *
__v®ue
)

377 
__THROW
;

380 
	$tim”_g‘ov”run
 (
tim”_t
 
__tim”id
è
__THROW
;

384 #ifdeà
__USE_ISOC11


386 
	$time¥ec_g‘
 (
time¥ec
 *
__ts
, 
__ba£
)

387 
__THROW
 
	`__nÚnuÎ
 ((1));

391 #ifdeà
__USE_XOPEN_EXTENDED


403 
g‘d©e_”r
;

412 
tm
 *
	`g‘d©e
 (cÚ¡ *
__¡ršg
);

415 #ifdeà
__USE_GNU


426 
	`g‘d©e_r
 (cÚ¡ *
__»¡riù
 
__¡ršg
,

427 
tm
 *
__»¡riù
 
__»sbuå
);

430 
__END_DECLS


	@/usr/include/unistd.h

22 #iâdef 
_UNISTD_H


23 
	#_UNISTD_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


32 #ifdeà
__USE_XOPEN2K8


34 
	#_POSIX_VERSION
 200809L

	)

35 #–ià
defšed
 
__USE_XOPEN2K


37 
	#_POSIX_VERSION
 200112L

	)

38 #–ià
defšed
 
__USE_POSIX199506


40 
	#_POSIX_VERSION
 199506L

	)

41 #–ià
defšed
 
__USE_POSIX199309


43 
	#_POSIX_VERSION
 199309L

	)

46 
	#_POSIX_VERSION
 199009L

	)

52 #ifdeà
__USE_XOPEN2K8


53 
	#__POSIX2_THIS_VERSION
 200809L

	)

55 #–ià
defšed
 
__USE_XOPEN2K


57 
	#__POSIX2_THIS_VERSION
 200112L

	)

58 #–ià
defšed
 
__USE_POSIX199506


60 
	#__POSIX2_THIS_VERSION
 199506L

	)

63 
	#__POSIX2_THIS_VERSION
 199209L

	)

67 
	#_POSIX2_VERSION
 
__POSIX2_THIS_VERSION


	)

70 
	#_POSIX2_C_VERSION
 
__POSIX2_THIS_VERSION


	)

74 
	#_POSIX2_C_BIND
 
__POSIX2_THIS_VERSION


	)

78 
	#_POSIX2_C_DEV
 
__POSIX2_THIS_VERSION


	)

82 
	#_POSIX2_SW_DEV
 
__POSIX2_THIS_VERSION


	)

86 
	#_POSIX2_LOCALEDEF
 
__POSIX2_THIS_VERSION


	)

89 #ifdeà
__USE_XOPEN2K8


90 
	#_XOPEN_VERSION
 700

	)

91 #–ià
defšed
 
__USE_XOPEN2K


92 
	#_XOPEN_VERSION
 600

	)

93 #–ià
defšed
 
__USE_UNIX98


94 
	#_XOPEN_VERSION
 500

	)

96 
	#_XOPEN_VERSION
 4

	)

100 
	#_XOPEN_XCU_VERSION
 4

	)

103 
	#_XOPEN_XPG2
 1

	)

104 
	#_XOPEN_XPG3
 1

	)

105 
	#_XOPEN_XPG4
 1

	)

108 
	#_XOPEN_UNIX
 1

	)

111 
	#_XOPEN_CRYPT
 1

	)

115 
	#_XOPEN_ENH_I18N
 1

	)

118 
	#_XOPEN_LEGACY
 1

	)

205 
	~<b™s/posix_İt.h
>

208 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


209 
	~<b™s/’vœÚm’ts.h
>

213 
	#STDIN_FILENO
 0

	)

214 
	#STDOUT_FILENO
 1

	)

215 
	#STDERR_FILENO
 2

	)

220 
	~<b™s/ty³s.h
>

222 #iâdef 
__ssize_t_defšed


223 
__ssize_t
 
	tssize_t
;

224 
	#__ssize_t_defšed


	)

227 
	#__Ãed_size_t


	)

228 
	#__Ãed_NULL


	)

229 
	~<¡ddef.h
>

231 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K


234 #iâdeà
__gid_t_defšed


235 
__gid_t
 
	tgid_t
;

236 
	#__gid_t_defšed


	)

239 #iâdeà
__uid_t_defšed


240 
__uid_t
 
	tuid_t
;

241 
	#__uid_t_defšed


	)

244 #iâdeà
__off_t_defšed


245 #iâdeà
__USE_FILE_OFFSET64


246 
__off_t
 
	toff_t
;

248 
__off64_t
 
	toff_t
;

250 
	#__off_t_defšed


	)

252 #ià
defšed
 
__USE_LARGEFILE64
 && !defšed 
__off64_t_defšed


253 
__off64_t
 
	toff64_t
;

254 
	#__off64_t_defšed


	)

257 #iâdeà
__u£cÚds_t_defšed


258 
__u£cÚds_t
 
	tu£cÚds_t
;

259 
	#__u£cÚds_t_defšed


	)

262 #iâdeà
__pid_t_defšed


263 
__pid_t
 
	tpid_t
;

264 
	#__pid_t_defšed


	)

268 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


269 #iâdeà
__šŒ_t_defšed


270 
__šŒ_t
 
	tšŒ_t
;

271 
	#__šŒ_t_defšed


	)

275 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


276 #iâdeà
__sockËn_t_defšed


277 
__sockËn_t
 
	tsockËn_t
;

278 
	#__sockËn_t_defšed


	)

284 
	#R_OK
 4

	)

285 
	#W_OK
 2

	)

286 
	#X_OK
 1

	)

287 
	#F_OK
 0

	)

290 
	$acûss
 (cÚ¡ *
__Çme
, 
__ty³
è
__THROW
 
	`__nÚnuÎ
 ((1));

292 #ifdeà
__USE_GNU


295 
	$euidacûss
 (cÚ¡ *
__Çme
, 
__ty³
)

296 
__THROW
 
	`__nÚnuÎ
 ((1));

299 
	$—cûss
 (cÚ¡ *
__Çme
, 
__ty³
)

300 
__THROW
 
	`__nÚnuÎ
 ((1));

303 #ifdeà
__USE_ATFILE


307 
	$çcûs§t
 (
__fd
, cÚ¡ *
__fe
, 
__ty³
, 
__æag
)

308 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

313 #iâdef 
_STDIO_H


314 
	#SEEK_SET
 0

	)

315 
	#SEEK_CUR
 1

	)

316 
	#SEEK_END
 2

	)

317 #ifdeà
__USE_GNU


318 
	#SEEK_DATA
 3

	)

319 
	#SEEK_HOLE
 4

	)

323 #ià
defšed
 
__USE_MISC
 && !defšed 
L_SET


325 
	#L_SET
 
SEEK_SET


	)

326 
	#L_INCR
 
SEEK_CUR


	)

327 
	#L_XTND
 
SEEK_END


	)

336 #iâdeà
__USE_FILE_OFFSET64


337 
__off_t
 
	$l£ek
 (
__fd
, 
__off_t
 
__off£t
, 
__wh’û
è
__THROW
;

339 #ifdeà
__REDIRECT_NTH


340 
__off64_t
 
	`__REDIRECT_NTH
 (
l£ek
,

341 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
),

342 
l£ek64
);

344 
	#l£ek
 
l£ek64


	)

347 #ifdeà
__USE_LARGEFILE64


348 
__off64_t
 
	$l£ek64
 (
__fd
, 
__off64_t
 
__off£t
, 
__wh’û
)

349 
__THROW
;

356 
	`şo£
 (
__fd
);

363 
ssize_t
 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
è
__wur
;

369 
ssize_t
 
	$wr™e
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
è
__wur
;

371 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


372 #iâdeà
__USE_FILE_OFFSET64


379 
ssize_t
 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

380 
__off_t
 
__off£t
è
__wur
;

387 
ssize_t
 
	$pwr™e
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

388 
__off_t
 
__off£t
è
__wur
;

390 #ifdeà
__REDIRECT


391 
ssize_t
 
	`__REDIRECT
 (
´—d
, (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

392 
__off64_t
 
__off£t
),

393 
´—d64
è
__wur
;

394 
ssize_t
 
	`__REDIRECT
 (
pwr™e
, (
__fd
, cÚ¡ *
__buf
,

395 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
),

396 
pwr™e64
è
__wur
;

398 
	#´—d
 
´—d64


	)

399 
	#pwr™e
 
pwr™e64


	)

403 #ifdeà
__USE_LARGEFILE64


407 
ssize_t
 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

408 
__off64_t
 
__off£t
è
__wur
;

411 
ssize_t
 
	$pwr™e64
 (
__fd
, cÚ¡ *
__buf
, 
size_t
 
__n
,

412 
__off64_t
 
__off£t
è
__wur
;

420 
	$pe
 (
__pedes
[2]è
__THROW
 
__wur
;

422 #ifdeà
__USE_GNU


425 
	$pe2
 (
__pedes
[2], 
__æags
è
__THROW
 
__wur
;

435 
	$®¬m
 (
__£cÚds
è
__THROW
;

447 
	`¦“p
 (
__£cÚds
);

449 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

450 || 
defšed
 
__USE_MISC


455 
__u£cÚds_t
 
	$u®¬m
 (
__u£cÚds_t
 
__v®ue
, __u£cÚds_ˆ
__š‹rv®
)

456 
__THROW
;

463 
	`u¦“p
 (
__u£cÚds_t
 
__u£cÚds
);

472 
	`·u£
 ();

476 
	$chown
 (cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

477 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

479 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


481 
	$fchown
 (
__fd
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
è
__THROW
 
__wur
;

486 
	$lchown
 (cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
, 
__gid_t
 
__group
)

487 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

491 #ifdeà
__USE_ATFILE


494 
	$fchowÇt
 (
__fd
, cÚ¡ *
__fe
, 
__uid_t
 
__owÃr
,

495 
__gid_t
 
__group
, 
__æag
)

496 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

500 
	$chdœ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

502 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


504 
	$fchdœ
 (
__fd
è
__THROW
 
__wur
;

514 *
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
è
__THROW
 
__wur
;

516 #ifdef 
__USE_GNU


520 *
	$g‘_cu¼’t_dœ_Çme
 (è
__THROW
;

523 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

524 || 
defšed
 
__USE_MISC


528 *
	$g‘wd
 (*
__buf
)

529 
__THROW
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
;

534 
	$dup
 (
__fd
è
__THROW
 
__wur
;

537 
	$dup2
 (
__fd
, 
__fd2
è
__THROW
;

539 #ifdeà
__USE_GNU


542 
	$dup3
 (
__fd
, 
__fd2
, 
__æags
è
__THROW
;

546 **
__’vœÚ
;

547 #ifdeà
__USE_GNU


548 **
’vœÚ
;

554 
	$execve
 (cÚ¡ *
__·th
, *cÚ¡ 
__¬gv
[],

555 *cÚ¡ 
__’vp
[]è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

557 #ifdeà
__USE_XOPEN2K8


560 
	$ãxecve
 (
__fd
, *cÚ¡ 
__¬gv
[], *cÚ¡ 
__’vp
[])

561 
__THROW
 
	`__nÚnuÎ
 ((2));

566 
	$execv
 (cÚ¡ *
__·th
, *cÚ¡ 
__¬gv
[])

567 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

571 
	$exeşe
 (cÚ¡ *
__·th
, cÚ¡ *
__¬g
, ...)

572 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

576 
	$exeş
 (cÚ¡ *
__·th
, cÚ¡ *
__¬g
, ...)

577 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

581 
	$execvp
 (cÚ¡ *
__fe
, *cÚ¡ 
__¬gv
[])

582 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

587 
	$exeşp
 (cÚ¡ *
__fe
, cÚ¡ *
__¬g
, ...)

588 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

590 #ifdeà
__USE_GNU


593 
	$execv³
 (cÚ¡ *
__fe
, *cÚ¡ 
__¬gv
[],

594 *cÚ¡ 
__’vp
[])

595 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

599 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


601 
	$niû
 (
__šc
è
__THROW
 
__wur
;

606 
	$_ex™
 (
__¡©us
è
	`__©Œibu‹__
 ((
__nÜ‘uº__
));

612 
	~<b™s/cÚâame.h
>

615 
	$·thcÚf
 (cÚ¡ *
__·th
, 
__Çme
)

616 
__THROW
 
	`__nÚnuÎ
 ((1));

619 
	$å©hcÚf
 (
__fd
, 
__Çme
è
__THROW
;

622 
	$syscÚf
 (
__Çme
è
__THROW
;

624 #ifdef 
__USE_POSIX2


626 
size_t
 
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
è
__THROW
;

631 
__pid_t
 
	$g‘pid
 (è
__THROW
;

634 
__pid_t
 
	$g‘µid
 (è
__THROW
;

637 
__pid_t
 
	$g‘pg½
 (è
__THROW
;

640 
__pid_t
 
	$__g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

641 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


642 
__pid_t
 
	$g‘pgid
 (
__pid_t
 
__pid
è
__THROW
;

649 
	$£gid
 (
__pid_t
 
__pid
, __pid_ˆ
__pgid
è
__THROW
;

651 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


663 
	$£g½
 (è
__THROW
;

670 
__pid_t
 
	$£tsid
 (è
__THROW
;

672 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


674 
__pid_t
 
	$g‘sid
 (
__pid_t
 
__pid
è
__THROW
;

678 
__uid_t
 
	$g‘uid
 (è
__THROW
;

681 
__uid_t
 
	$g‘euid
 (è
__THROW
;

684 
__gid_t
 
	$g‘gid
 (è
__THROW
;

687 
__gid_t
 
	$g‘egid
 (è
__THROW
;

692 
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]è
__THROW
 
__wur
;

694 #ifdef 
__USE_GNU


696 
	$group_memb”
 (
__gid_t
 
__gid
è
__THROW
;

703 
	$£tuid
 (
__uid_t
 
__uid
è
__THROW
 
__wur
;

705 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


708 
	$£Œeuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
è
__THROW
 
__wur
;

711 #ifdeà
__USE_XOPEN2K


713 
	$£‹uid
 (
__uid_t
 
__uid
è
__THROW
 
__wur
;

720 
	$£tgid
 (
__gid_t
 
__gid
è
__THROW
 
__wur
;

722 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


725 
	$£Œegid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
è
__THROW
 
__wur
;

728 #ifdeà
__USE_XOPEN2K


730 
	$£‹gid
 (
__gid_t
 
__gid
è
__THROW
 
__wur
;

733 #ifdeà
__USE_GNU


736 
	$g‘»suid
 (
__uid_t
 *
__ruid
, __uid_ˆ*
__euid
, __uid_ˆ*
__suid
)

737 
__THROW
;

741 
	$g‘»sgid
 (
__gid_t
 *
__rgid
, __gid_ˆ*
__egid
, __gid_ˆ*
__sgid
)

742 
__THROW
;

746 
	$£Œesuid
 (
__uid_t
 
__ruid
, __uid_ˆ
__euid
, __uid_ˆ
__suid
)

747 
__THROW
 
__wur
;

751 
	$£Œesgid
 (
__gid_t
 
__rgid
, __gid_ˆ
__egid
, __gid_ˆ
__sgid
)

752 
__THROW
 
__wur
;

759 
__pid_t
 
	$fÜk
 (è
__THROWNL
;

761 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K8
) \

762 || 
defšed
 
__USE_MISC


767 
__pid_t
 
	$vfÜk
 (è
__THROW
;

773 *
	$‰yÇme
 (
__fd
è
__THROW
;

777 
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
)

778 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

782 
	$i§‰y
 (
__fd
è
__THROW
;

784 #ifdeà
__USE_MISC


787 
	$‰y¦Ù
 (è
__THROW
;

792 
	$lšk
 (cÚ¡ *
__äom
, cÚ¡ *
__to
)

793 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

795 #ifdeà
__USE_ATFILE


798 
	$lšk©
 (
__äomfd
, cÚ¡ *
__äom
, 
__tofd
,

799 cÚ¡ *
__to
, 
__æags
)

800 
__THROW
 
	`__nÚnuÎ
 ((2, 4)è
__wur
;

803 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


805 
	$symlšk
 (cÚ¡ *
__äom
, cÚ¡ *
__to
)

806 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

811 
ssize_t
 
	$»adlšk
 (cÚ¡ *
__»¡riù
 
__·th
,

812 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

813 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

816 #ifdeà
__USE_ATFILE


818 
	$symlšk©
 (cÚ¡ *
__äom
, 
__tofd
,

819 cÚ¡ *
__to
è
__THROW
 
	`__nÚnuÎ
 ((1, 3)è
__wur
;

822 
ssize_t
 
	$»adlšk©
 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

823 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
)

824 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

828 
	$uÆšk
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

830 #ifdeà
__USE_ATFILE


832 
	$uÆšk©
 (
__fd
, cÚ¡ *
__Çme
, 
__æag
)

833 
__THROW
 
	`__nÚnuÎ
 ((2));

837 
	$rmdœ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1));

841 
__pid_t
 
	$tcg‘pg½
 (
__fd
è
__THROW
;

844 
	$tc£g½
 (
__fd
, 
__pid_t
 
__pg½_id
è
__THROW
;

851 *
	`g‘logš
 ();

852 #ià
defšed
 
__USE_REENTRANT
 || defšed 
__USE_POSIX199506


859 
	$g‘logš_r
 (*
__Çme
, 
size_t
 
__Çme_Ën
è
	`__nÚnuÎ
 ((1));

862 #ifdef 
__USE_MISC


864 
	$£ogš
 (cÚ¡ *
__Çme
è
__THROW
 
	`__nÚnuÎ
 ((1));

868 #ifdef 
__USE_POSIX2


872 
	#__Ãed_g‘İt


	)

873 
	~<g‘İt.h
>

877 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


881 
	$g‘ho¡Çme
 (*
__Çme
, 
size_t
 
__Ën
è
__THROW
 
	`__nÚnuÎ
 ((1));

885 #ià
defšed
 
__USE_MISC


888 
	$£tho¡Çme
 (cÚ¡ *
__Çme
, 
size_t
 
__Ën
)

889 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

893 
	$£tho¡id
 (
__id
è
__THROW
 
__wur
;

899 
	$g‘domašÇme
 (*
__Çme
, 
size_t
 
__Ën
)

900 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

901 
	$£tdomašÇme
 (cÚ¡ *
__Çme
, 
size_t
 
__Ën
)

902 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

908 
	$vhªgup
 (è
__THROW
;

911 
	$»voke
 (cÚ¡ *
__fe
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

919 
	$´of
 (*
__§m¶e_bufãr
, 
size_t
 
__size
,

920 
size_t
 
__off£t
, 
__sÿË
)

921 
__THROW
 
	`__nÚnuÎ
 ((1));

927 
	$acù
 (cÚ¡ *
__Çme
è
__THROW
;

931 *
	$g‘u£rsh–l
 (è
__THROW
;

932 
	$’du£rsh–l
 (è
__THROW
;

933 
	$£tu£rsh–l
 (è
__THROW
;

939 
	$d«mÚ
 (
__nochdœ
, 
__noşo£
è
__THROW
 
__wur
;

943 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

946 
	$chroÙ
 (cÚ¡ *
__·th
è
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

950 *
	$g‘·ss
 (cÚ¡ *
__´om±
è
	`__nÚnuÎ
 ((1));

958 
	`fsync
 (
__fd
);

961 #ifdeà
__USE_GNU


964 
	$syncfs
 (
__fd
è
__THROW
;

968 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


971 
	`g‘ho¡id
 ();

974 
	$sync
 (è
__THROW
;

977 #ià
defšed
 
__USE_MISC
 || !defšed 
__USE_XOPEN2K


980 
	$g‘·gesize
 (è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

985 
	$g‘dbËsize
 (è
__THROW
;

991 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


994 #iâdeà
__USE_FILE_OFFSET64


995 
	$Œunÿ‹
 (cÚ¡ *
__fe
, 
__off_t
 
__Ëngth
)

996 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

998 #ifdeà
__REDIRECT_NTH


999 
	`__REDIRECT_NTH
 (
Œunÿ‹
,

1000 (cÚ¡ *
__fe
, 
__off64_t
 
__Ëngth
),

1001 
Œunÿ‹64
è
	`__nÚnuÎ
 ((1)è
__wur
;

1003 
	#Œunÿ‹
 
Œunÿ‹64


	)

1006 #ifdeà
__USE_LARGEFILE64


1007 
	$Œunÿ‹64
 (cÚ¡ *
__fe
, 
__off64_t
 
__Ëngth
)

1008 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

1013 #ià
defšed
 
__USE_POSIX199309
 \

1014 || 
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


1017 #iâdeà
__USE_FILE_OFFSET64


1018 
	$árunÿ‹
 (
__fd
, 
__off_t
 
__Ëngth
è
__THROW
 
__wur
;

1020 #ifdeà
__REDIRECT_NTH


1021 
	`__REDIRECT_NTH
 (
árunÿ‹
, (
__fd
, 
__off64_t
 
__Ëngth
),

1022 
árunÿ‹64
è
__wur
;

1024 
	#árunÿ‹
 
árunÿ‹64


	)

1027 #ifdeà
__USE_LARGEFILE64


1028 
	$árunÿ‹64
 (
__fd
, 
__off64_t
 
__Ëngth
è
__THROW
 
__wur
;

1034 #ià(
defšed
 
__USE_XOPEN_EXTENDED
 && !defšed 
__USE_XOPEN2K
) \

1035 || 
defšed
 
__USE_MISC


1039 
	$brk
 (*
__addr
è
__THROW
 
__wur
;

1045 *
	$sbrk
 (
šŒ_t
 
__d–
è
__THROW
;

1049 #ifdeà
__USE_MISC


1060 
	$sysÿÎ
 (
__sy¢o
, ...è
__THROW
;

1065 #ià(
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED
è&& !defšed 
F_LOCK


1077 
	#F_ULOCK
 0

	)

1078 
	#F_LOCK
 1

	)

1079 
	#F_TLOCK
 2

	)

1080 
	#F_TEST
 3

	)

1082 #iâdeà
__USE_FILE_OFFSET64


1083 
	$lockf
 (
__fd
, 
__cmd
, 
__off_t
 
__Ën
è
__wur
;

1085 #ifdeà
__REDIRECT


1086 
	`__REDIRECT
 (
lockf
, (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
),

1087 
lockf64
è
__wur
;

1089 
	#lockf
 
lockf64


	)

1092 #ifdeà
__USE_LARGEFILE64


1093 
	$lockf64
 (
__fd
, 
__cmd
, 
__off64_t
 
__Ën
è
__wur
;

1098 #ifdeà
__USE_GNU


1103 
	#TEMP_FAILURE_RETRY
(
ex´essiÚ
) \

1104 (
__ex‹nsiÚ__
 \

1105 ({ 
__»suÉ
; \

1106 dØ
__»suÉ
 = (è(
ex´essiÚ
); \

1107 
__»suÉ
 =ğ-1L && 
”ºo
 =ğ
EINTR
); \

1108 
__»suÉ
; 
	}
}))

	)

1111 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


1114 
fd©async
 (
__fdes
);

1120 #ifdef 
__USE_XOPEN


1122 *
	$üy±
 (cÚ¡ *
__key
, cÚ¡ *
__§É
)

1123 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1127 
	$’üy±
 (*
__glibc_block
, 
__edæag
)

1128 
__THROW
 
	`__nÚnuÎ
 ((1));

1135 
	$swab
 (cÚ¡ *
__»¡riù
 
__äom
, *__»¡riù 
__to
,

1136 
ssize_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

1143 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K


1145 *
	$ù”mid
 (*
__s
è
__THROW
;

1148 *
	`cu£rid
 (*
__s
);

1154 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__USE_XOPEN2K


1155 
	`±h»ad_©fÜk
 ((*
__´•¬e
) (),

1156 (*
__·»Á
) (),

1157 (*
__chd
è()è
__THROW
;

1162 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


1163 
	~<b™s/uni¡d.h
>

1166 
__END_DECLS


	@/usr/include/alloca.h

18 #iâdef 
_ALLOCA_H


19 
	#_ALLOCA_H
 1

	)

21 
	~<ã©u»s.h
>

23 
	#__Ãed_size_t


	)

24 
	~<¡ddef.h
>

26 
	g__BEGIN_DECLS


29 #undeà
®loÿ


32 *
	$®loÿ
 (
size_t
 
__size
è
__THROW
;

34 #ifdef 
__GNUC__


35 
	#®loÿ
(
size
è
	`__butš_®loÿ
 (size)

	)

38 
__END_DECLS


	@/usr/include/asm-generic/types.h

1 #iâdeà
_ASM_GENERIC_TYPES_H


2 
	#_ASM_GENERIC_TYPES_H


	)

6 
	~<asm-g’”ic/št-Î64.h
>

	@/usr/include/asm/byteorder.h

1 #iâdeà
_ASM_X86_BYTEORDER_H


2 
	#_ASM_X86_BYTEORDER_H


	)

4 
	~<lšux/by‹Üd”/l™e_’dŸn.h
>

	@/usr/include/asm/poll.h

1 
	~<asm-g’”ic/pŞl.h
>

	@/usr/include/bits/byteswap.h

19 #ià!
defšed
 
_BYTESWAP_H
 && !defšed 
_NETINET_IN_H
 && !defšed 
_ENDIAN_H


23 #iâdeà
_BITS_BYTESWAP_H


24 
	#_BITS_BYTESWAP_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/ty³s.h
>

28 
	~<b™s/wÜdsize.h
>

31 
	#__bsw­_cÚ¡ªt_16
(
x
) \

32 ((è((((
x
è>> 8è& 0xffè| (((xè& 0xffè<< 8)))

	)

35 
	~<b™s/by‹sw­-16.h
>

38 
	#__bsw­_cÚ¡ªt_32
(
x
) \

39 ((((
x
) & 0xff000000) >> 24) | (((x) & 0x00ff0000) >> 8) | \

40 (((
x
è& 0x0000ff00è<< 8è| (((xè& 0x000000ffè<< 24))

	)

42 #ifdeà
__GNUC__


43 #ià
__GNUC_PREREQ
 (4, 3)

44 
__šlše
 

45 
	$__bsw­_32
 (
__bsx
)

47  
	`__butš_bsw­32
 (
__bsx
);

48 
	}
}

49 #–ià
__GNUC__
 >= 2

50 #ià
__WORDSIZE
 =ğ64 || (
defšed
 
__i486__
 || defšed 
__³Áium__
 \

51 || 
defšed
 
	g__³Áium´o__
 || defšed 
	g__³Áium4__
 \

52 || 
defšed
 
	g__k8__
 || defšed 
	g__©hlÚ__
 \

53 || 
defšed
 
	g__k6__
 || defšed 
	g__nocÚa__
 \

54 || 
defšed
 
	g__cÜe2__
 || defšed 
	g__geode__
 \

55 || 
defšed
 
	g__amdçm10__
)

58 
	#__bsw­_32
(
x
) \

59 (
__ex‹nsiÚ__
 \

60 ({ 
__v
, 
__x
 = (
x
); \

61 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

62 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

64 
	`__asm__
 ("bsw­ %0" : "ô" (
__v
è: "0" (
__x
)); \

65 
__v
; }))

	)

67 
	#__bsw­_32
(
x
) \

68 (
__ex‹nsiÚ__
 \

69 ({ 
__v
, 
__x
 = (
x
); \

70 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

71 
__v
 = 
	`__bsw­_cÚ¡ªt_32
 (
__x
); \

73 
	`__asm__
 ("rorw $8, %w0;" \

76 : "ô" (
__v
) \

77 : "0" (
__x
) \

79 
__v
; }))

	)

82 
	#__bsw­_32
(
x
) \

83 (
__ex‹nsiÚ__
 \

84 ({ 
__x
 = (
x
); 
	`__bsw­_cÚ¡ªt_32
 (__x); }))

	)

87 
__šlše
 

88 
	$__bsw­_32
 (
__bsx
)

90  
	`__bsw­_cÚ¡ªt_32
 (
__bsx
);

91 
	}
}

95 #ià
__GNUC_PREREQ
 (2, 0)

97 
	#__bsw­_cÚ¡ªt_64
(
x
) \

98 (
	`__ex‹nsiÚ__
 ((((
x
) & 0xff00000000000000ull) >> 56) \

99 | (((
x
) & 0x00ff000000000000ull) >> 40) \

100 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

101 | (((
x
) & 0x000000ff00000000ull) >> 8) \

102 | (((
x
) & 0x00000000ff000000ull) << 8) \

103 | (((
x
) & 0x0000000000ff0000ull) << 24) \

104 | (((
x
) & 0x000000000000ff00ull) << 40) \

105 | (((
x
è& 0x00000000000000ffuÎè<< 56)))

	)

107 #ià
__GNUC_PREREQ
 (4, 3)

108 
__šlše
 
__ušt64_t


109 
	$__bsw­_64
 (
__ušt64_t
 
__bsx
)

111  
	`__butš_bsw­64
 (
__bsx
);

112 
	}
}

113 #–ià
__WORDSIZE
 == 64

114 
	#__bsw­_64
(
x
) \

115 (
__ex‹nsiÚ__
 \

116 ({ 
__ušt64_t
 
__v
, 
__x
 = (
x
); \

117 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

118 
__v
 = 
	`__bsw­_cÚ¡ªt_64
 (
__x
); \

120 
	`__asm__
 ("bsw­ %q0" : "ô" (
__v
è: "0" (
__x
)); \

121 
__v
; }))

	)

123 
	#__bsw­_64
(
x
) \

124 (
__ex‹nsiÚ__
 \

125 ({ uniÚ { 
__ex‹nsiÚ__
 
__ušt64_t
 
__Î
; \

126 
__l
[2]; } 
__w
, 
__r
; \

127 ià(
	`__butš_cÚ¡ªt_p
 (
x
)) \

128 
__r
.
__Î
 = 
	`__bsw­_cÚ¡ªt_64
 (
x
); \

131 
__w
.
__Î
 = (
x
); \

132 
__r
.
__l
[0] = 
	`__bsw­_32
 (
__w
.__l[1]); \

133 
__r
.
__l
[1] = 
	`__bsw­_32
 (
__w
.__l[0]); \

135 
__r
.
__Î
; }))

	)

138 
	#__bsw­_cÚ¡ªt_64
(
x
) \

139 ((((
x
) & 0xff00000000000000ull) >> 56) \

140 | (((
x
) & 0x00ff000000000000ull) >> 40) \

141 | (((
x
) & 0x0000ff0000000000ull) >> 24) \

142 | (((
x
) & 0x000000ff00000000ull) >> 8) \

143 | (((
x
) & 0x00000000ff000000ull) << 8) \

144 | (((
x
) & 0x0000000000ff0000ull) << 24) \

145 | (((
x
) & 0x000000000000ff00ull) << 40) \

146 | (((
x
è& 0x00000000000000ffuÎè<< 56))

	)

148 
__šlše
 
__ušt64_t


149 
	$__bsw­_64
 (
__ušt64_t
 
__bsx
)

151  
	`__bsw­_cÚ¡ªt_64
 (
__bsx
);

152 
	}
}

	@/usr/include/bits/confname.h

19 #iâdeà
_UNISTD_H


26 
	m_PC_LINK_MAX
,

27 
	#_PC_LINK_MAX
 
_PC_LINK_MAX


	)

28 
	m_PC_MAX_CANON
,

29 
	#_PC_MAX_CANON
 
_PC_MAX_CANON


	)

30 
	m_PC_MAX_INPUT
,

31 
	#_PC_MAX_INPUT
 
_PC_MAX_INPUT


	)

32 
	m_PC_NAME_MAX
,

33 
	#_PC_NAME_MAX
 
_PC_NAME_MAX


	)

34 
	m_PC_PATH_MAX
,

35 
	#_PC_PATH_MAX
 
_PC_PATH_MAX


	)

36 
	m_PC_PIPE_BUF
,

37 
	#_PC_PIPE_BUF
 
_PC_PIPE_BUF


	)

38 
	m_PC_CHOWN_RESTRICTED
,

39 
	#_PC_CHOWN_RESTRICTED
 
_PC_CHOWN_RESTRICTED


	)

40 
	m_PC_NO_TRUNC
,

41 
	#_PC_NO_TRUNC
 
_PC_NO_TRUNC


	)

42 
	m_PC_VDISABLE
,

43 
	#_PC_VDISABLE
 
_PC_VDISABLE


	)

44 
	m_PC_SYNC_IO
,

45 
	#_PC_SYNC_IO
 
_PC_SYNC_IO


	)

46 
	m_PC_ASYNC_IO
,

47 
	#_PC_ASYNC_IO
 
_PC_ASYNC_IO


	)

48 
	m_PC_PRIO_IO
,

49 
	#_PC_PRIO_IO
 
_PC_PRIO_IO


	)

50 
	m_PC_SOCK_MAXBUF
,

51 
	#_PC_SOCK_MAXBUF
 
_PC_SOCK_MAXBUF


	)

52 
	m_PC_FILESIZEBITS
,

53 
	#_PC_FILESIZEBITS
 
_PC_FILESIZEBITS


	)

54 
	m_PC_REC_INCR_XFER_SIZE
,

55 
	#_PC_REC_INCR_XFER_SIZE
 
_PC_REC_INCR_XFER_SIZE


	)

56 
	m_PC_REC_MAX_XFER_SIZE
,

57 
	#_PC_REC_MAX_XFER_SIZE
 
_PC_REC_MAX_XFER_SIZE


	)

58 
	m_PC_REC_MIN_XFER_SIZE
,

59 
	#_PC_REC_MIN_XFER_SIZE
 
_PC_REC_MIN_XFER_SIZE


	)

60 
	m_PC_REC_XFER_ALIGN
,

61 
	#_PC_REC_XFER_ALIGN
 
_PC_REC_XFER_ALIGN


	)

62 
	m_PC_ALLOC_SIZE_MIN
,

63 
	#_PC_ALLOC_SIZE_MIN
 
_PC_ALLOC_SIZE_MIN


	)

64 
	m_PC_SYMLINK_MAX
,

65 
	#_PC_SYMLINK_MAX
 
_PC_SYMLINK_MAX


	)

66 
	m_PC_2_SYMLINKS


67 
	#_PC_2_SYMLINKS
 
_PC_2_SYMLINKS


	)

73 
	m_SC_ARG_MAX
,

74 
	#_SC_ARG_MAX
 
_SC_ARG_MAX


	)

75 
	m_SC_CHILD_MAX
,

76 
	#_SC_CHILD_MAX
 
_SC_CHILD_MAX


	)

77 
	m_SC_CLK_TCK
,

78 
	#_SC_CLK_TCK
 
_SC_CLK_TCK


	)

79 
	m_SC_NGROUPS_MAX
,

80 
	#_SC_NGROUPS_MAX
 
_SC_NGROUPS_MAX


	)

81 
	m_SC_OPEN_MAX
,

82 
	#_SC_OPEN_MAX
 
_SC_OPEN_MAX


	)

83 
	m_SC_STREAM_MAX
,

84 
	#_SC_STREAM_MAX
 
_SC_STREAM_MAX


	)

85 
	m_SC_TZNAME_MAX
,

86 
	#_SC_TZNAME_MAX
 
_SC_TZNAME_MAX


	)

87 
	m_SC_JOB_CONTROL
,

88 
	#_SC_JOB_CONTROL
 
_SC_JOB_CONTROL


	)

89 
	m_SC_SAVED_IDS
,

90 
	#_SC_SAVED_IDS
 
_SC_SAVED_IDS


	)

91 
	m_SC_REALTIME_SIGNALS
,

92 
	#_SC_REALTIME_SIGNALS
 
_SC_REALTIME_SIGNALS


	)

93 
	m_SC_PRIORITY_SCHEDULING
,

94 
	#_SC_PRIORITY_SCHEDULING
 
_SC_PRIORITY_SCHEDULING


	)

95 
	m_SC_TIMERS
,

96 
	#_SC_TIMERS
 
_SC_TIMERS


	)

97 
	m_SC_ASYNCHRONOUS_IO
,

98 
	#_SC_ASYNCHRONOUS_IO
 
_SC_ASYNCHRONOUS_IO


	)

99 
	m_SC_PRIORITIZED_IO
,

100 
	#_SC_PRIORITIZED_IO
 
_SC_PRIORITIZED_IO


	)

101 
	m_SC_SYNCHRONIZED_IO
,

102 
	#_SC_SYNCHRONIZED_IO
 
_SC_SYNCHRONIZED_IO


	)

103 
	m_SC_FSYNC
,

104 
	#_SC_FSYNC
 
_SC_FSYNC


	)

105 
	m_SC_MAPPED_FILES
,

106 
	#_SC_MAPPED_FILES
 
_SC_MAPPED_FILES


	)

107 
	m_SC_MEMLOCK
,

108 
	#_SC_MEMLOCK
 
_SC_MEMLOCK


	)

109 
	m_SC_MEMLOCK_RANGE
,

110 
	#_SC_MEMLOCK_RANGE
 
_SC_MEMLOCK_RANGE


	)

111 
	m_SC_MEMORY_PROTECTION
,

112 
	#_SC_MEMORY_PROTECTION
 
_SC_MEMORY_PROTECTION


	)

113 
	m_SC_MESSAGE_PASSING
,

114 
	#_SC_MESSAGE_PASSING
 
_SC_MESSAGE_PASSING


	)

115 
	m_SC_SEMAPHORES
,

116 
	#_SC_SEMAPHORES
 
_SC_SEMAPHORES


	)

117 
	m_SC_SHARED_MEMORY_OBJECTS
,

118 
	#_SC_SHARED_MEMORY_OBJECTS
 
_SC_SHARED_MEMORY_OBJECTS


	)

119 
	m_SC_AIO_LISTIO_MAX
,

120 
	#_SC_AIO_LISTIO_MAX
 
_SC_AIO_LISTIO_MAX


	)

121 
	m_SC_AIO_MAX
,

122 
	#_SC_AIO_MAX
 
_SC_AIO_MAX


	)

123 
	m_SC_AIO_PRIO_DELTA_MAX
,

124 
	#_SC_AIO_PRIO_DELTA_MAX
 
_SC_AIO_PRIO_DELTA_MAX


	)

125 
	m_SC_DELAYTIMER_MAX
,

126 
	#_SC_DELAYTIMER_MAX
 
_SC_DELAYTIMER_MAX


	)

127 
	m_SC_MQ_OPEN_MAX
,

128 
	#_SC_MQ_OPEN_MAX
 
_SC_MQ_OPEN_MAX


	)

129 
	m_SC_MQ_PRIO_MAX
,

130 
	#_SC_MQ_PRIO_MAX
 
_SC_MQ_PRIO_MAX


	)

131 
	m_SC_VERSION
,

132 
	#_SC_VERSION
 
_SC_VERSION


	)

133 
	m_SC_PAGESIZE
,

134 
	#_SC_PAGESIZE
 
_SC_PAGESIZE


	)

135 
	#_SC_PAGE_SIZE
 
_SC_PAGESIZE


	)

136 
	m_SC_RTSIG_MAX
,

137 
	#_SC_RTSIG_MAX
 
_SC_RTSIG_MAX


	)

138 
	m_SC_SEM_NSEMS_MAX
,

139 
	#_SC_SEM_NSEMS_MAX
 
_SC_SEM_NSEMS_MAX


	)

140 
	m_SC_SEM_VALUE_MAX
,

141 
	#_SC_SEM_VALUE_MAX
 
_SC_SEM_VALUE_MAX


	)

142 
	m_SC_SIGQUEUE_MAX
,

143 
	#_SC_SIGQUEUE_MAX
 
_SC_SIGQUEUE_MAX


	)

144 
	m_SC_TIMER_MAX
,

145 
	#_SC_TIMER_MAX
 
_SC_TIMER_MAX


	)

149 
	m_SC_BC_BASE_MAX
,

150 
	#_SC_BC_BASE_MAX
 
_SC_BC_BASE_MAX


	)

151 
	m_SC_BC_DIM_MAX
,

152 
	#_SC_BC_DIM_MAX
 
_SC_BC_DIM_MAX


	)

153 
	m_SC_BC_SCALE_MAX
,

154 
	#_SC_BC_SCALE_MAX
 
_SC_BC_SCALE_MAX


	)

155 
	m_SC_BC_STRING_MAX
,

156 
	#_SC_BC_STRING_MAX
 
_SC_BC_STRING_MAX


	)

157 
	m_SC_COLL_WEIGHTS_MAX
,

158 
	#_SC_COLL_WEIGHTS_MAX
 
_SC_COLL_WEIGHTS_MAX


	)

159 
	m_SC_EQUIV_CLASS_MAX
,

160 
	#_SC_EQUIV_CLASS_MAX
 
_SC_EQUIV_CLASS_MAX


	)

161 
	m_SC_EXPR_NEST_MAX
,

162 
	#_SC_EXPR_NEST_MAX
 
_SC_EXPR_NEST_MAX


	)

163 
	m_SC_LINE_MAX
,

164 
	#_SC_LINE_MAX
 
_SC_LINE_MAX


	)

165 
	m_SC_RE_DUP_MAX
,

166 
	#_SC_RE_DUP_MAX
 
_SC_RE_DUP_MAX


	)

167 
	m_SC_CHARCLASS_NAME_MAX
,

168 
	#_SC_CHARCLASS_NAME_MAX
 
_SC_CHARCLASS_NAME_MAX


	)

170 
	m_SC_2_VERSION
,

171 
	#_SC_2_VERSION
 
_SC_2_VERSION


	)

172 
	m_SC_2_C_BIND
,

173 
	#_SC_2_C_BIND
 
_SC_2_C_BIND


	)

174 
	m_SC_2_C_DEV
,

175 
	#_SC_2_C_DEV
 
_SC_2_C_DEV


	)

176 
	m_SC_2_FORT_DEV
,

177 
	#_SC_2_FORT_DEV
 
_SC_2_FORT_DEV


	)

178 
	m_SC_2_FORT_RUN
,

179 
	#_SC_2_FORT_RUN
 
_SC_2_FORT_RUN


	)

180 
	m_SC_2_SW_DEV
,

181 
	#_SC_2_SW_DEV
 
_SC_2_SW_DEV


	)

182 
	m_SC_2_LOCALEDEF
,

183 
	#_SC_2_LOCALEDEF
 
_SC_2_LOCALEDEF


	)

185 
	m_SC_PII
,

186 
	#_SC_PII
 
_SC_PII


	)

187 
	m_SC_PII_XTI
,

188 
	#_SC_PII_XTI
 
_SC_PII_XTI


	)

189 
	m_SC_PII_SOCKET
,

190 
	#_SC_PII_SOCKET
 
_SC_PII_SOCKET


	)

191 
	m_SC_PII_INTERNET
,

192 
	#_SC_PII_INTERNET
 
_SC_PII_INTERNET


	)

193 
	m_SC_PII_OSI
,

194 
	#_SC_PII_OSI
 
_SC_PII_OSI


	)

195 
	m_SC_POLL
,

196 
	#_SC_POLL
 
_SC_POLL


	)

197 
	m_SC_SELECT
,

198 
	#_SC_SELECT
 
_SC_SELECT


	)

199 
	m_SC_UIO_MAXIOV
,

200 
	#_SC_UIO_MAXIOV
 
_SC_UIO_MAXIOV


	)

201 
	m_SC_IOV_MAX
 = 
_SC_UIO_MAXIOV
,

202 
	#_SC_IOV_MAX
 
_SC_IOV_MAX


	)

203 
	m_SC_PII_INTERNET_STREAM
,

204 
	#_SC_PII_INTERNET_STREAM
 
_SC_PII_INTERNET_STREAM


	)

205 
	m_SC_PII_INTERNET_DGRAM
,

206 
	#_SC_PII_INTERNET_DGRAM
 
_SC_PII_INTERNET_DGRAM


	)

207 
	m_SC_PII_OSI_COTS
,

208 
	#_SC_PII_OSI_COTS
 
_SC_PII_OSI_COTS


	)

209 
	m_SC_PII_OSI_CLTS
,

210 
	#_SC_PII_OSI_CLTS
 
_SC_PII_OSI_CLTS


	)

211 
	m_SC_PII_OSI_M
,

212 
	#_SC_PII_OSI_M
 
_SC_PII_OSI_M


	)

213 
	m_SC_T_IOV_MAX
,

214 
	#_SC_T_IOV_MAX
 
_SC_T_IOV_MAX


	)

217 
	m_SC_THREADS
,

218 
	#_SC_THREADS
 
_SC_THREADS


	)

219 
	m_SC_THREAD_SAFE_FUNCTIONS
,

220 
	#_SC_THREAD_SAFE_FUNCTIONS
 
_SC_THREAD_SAFE_FUNCTIONS


	)

221 
	m_SC_GETGR_R_SIZE_MAX
,

222 
	#_SC_GETGR_R_SIZE_MAX
 
_SC_GETGR_R_SIZE_MAX


	)

223 
	m_SC_GETPW_R_SIZE_MAX
,

224 
	#_SC_GETPW_R_SIZE_MAX
 
_SC_GETPW_R_SIZE_MAX


	)

225 
	m_SC_LOGIN_NAME_MAX
,

226 
	#_SC_LOGIN_NAME_MAX
 
_SC_LOGIN_NAME_MAX


	)

227 
	m_SC_TTY_NAME_MAX
,

228 
	#_SC_TTY_NAME_MAX
 
_SC_TTY_NAME_MAX


	)

229 
	m_SC_THREAD_DESTRUCTOR_ITERATIONS
,

230 
	#_SC_THREAD_DESTRUCTOR_ITERATIONS
 
_SC_THREAD_DESTRUCTOR_ITERATIONS


	)

231 
	m_SC_THREAD_KEYS_MAX
,

232 
	#_SC_THREAD_KEYS_MAX
 
_SC_THREAD_KEYS_MAX


	)

233 
	m_SC_THREAD_STACK_MIN
,

234 
	#_SC_THREAD_STACK_MIN
 
_SC_THREAD_STACK_MIN


	)

235 
	m_SC_THREAD_THREADS_MAX
,

236 
	#_SC_THREAD_THREADS_MAX
 
_SC_THREAD_THREADS_MAX


	)

237 
	m_SC_THREAD_ATTR_STACKADDR
,

238 
	#_SC_THREAD_ATTR_STACKADDR
 
_SC_THREAD_ATTR_STACKADDR


	)

239 
	m_SC_THREAD_ATTR_STACKSIZE
,

240 
	#_SC_THREAD_ATTR_STACKSIZE
 
_SC_THREAD_ATTR_STACKSIZE


	)

241 
	m_SC_THREAD_PRIORITY_SCHEDULING
,

242 
	#_SC_THREAD_PRIORITY_SCHEDULING
 
_SC_THREAD_PRIORITY_SCHEDULING


	)

243 
	m_SC_THREAD_PRIO_INHERIT
,

244 
	#_SC_THREAD_PRIO_INHERIT
 
_SC_THREAD_PRIO_INHERIT


	)

245 
	m_SC_THREAD_PRIO_PROTECT
,

246 
	#_SC_THREAD_PRIO_PROTECT
 
_SC_THREAD_PRIO_PROTECT


	)

247 
	m_SC_THREAD_PROCESS_SHARED
,

248 
	#_SC_THREAD_PROCESS_SHARED
 
_SC_THREAD_PROCESS_SHARED


	)

250 
	m_SC_NPROCESSORS_CONF
,

251 
	#_SC_NPROCESSORS_CONF
 
_SC_NPROCESSORS_CONF


	)

252 
	m_SC_NPROCESSORS_ONLN
,

253 
	#_SC_NPROCESSORS_ONLN
 
_SC_NPROCESSORS_ONLN


	)

254 
	m_SC_PHYS_PAGES
,

255 
	#_SC_PHYS_PAGES
 
_SC_PHYS_PAGES


	)

256 
	m_SC_AVPHYS_PAGES
,

257 
	#_SC_AVPHYS_PAGES
 
_SC_AVPHYS_PAGES


	)

258 
	m_SC_ATEXIT_MAX
,

259 
	#_SC_ATEXIT_MAX
 
_SC_ATEXIT_MAX


	)

260 
	m_SC_PASS_MAX
,

261 
	#_SC_PASS_MAX
 
_SC_PASS_MAX


	)

263 
	m_SC_XOPEN_VERSION
,

264 
	#_SC_XOPEN_VERSION
 
_SC_XOPEN_VERSION


	)

265 
	m_SC_XOPEN_XCU_VERSION
,

266 
	#_SC_XOPEN_XCU_VERSION
 
_SC_XOPEN_XCU_VERSION


	)

267 
	m_SC_XOPEN_UNIX
,

268 
	#_SC_XOPEN_UNIX
 
_SC_XOPEN_UNIX


	)

269 
	m_SC_XOPEN_CRYPT
,

270 
	#_SC_XOPEN_CRYPT
 
_SC_XOPEN_CRYPT


	)

271 
	m_SC_XOPEN_ENH_I18N
,

272 
	#_SC_XOPEN_ENH_I18N
 
_SC_XOPEN_ENH_I18N


	)

273 
	m_SC_XOPEN_SHM
,

274 
	#_SC_XOPEN_SHM
 
_SC_XOPEN_SHM


	)

276 
	m_SC_2_CHAR_TERM
,

277 
	#_SC_2_CHAR_TERM
 
_SC_2_CHAR_TERM


	)

278 
	m_SC_2_C_VERSION
,

279 
	#_SC_2_C_VERSION
 
_SC_2_C_VERSION


	)

280 
	m_SC_2_UPE
,

281 
	#_SC_2_UPE
 
_SC_2_UPE


	)

283 
	m_SC_XOPEN_XPG2
,

284 
	#_SC_XOPEN_XPG2
 
_SC_XOPEN_XPG2


	)

285 
	m_SC_XOPEN_XPG3
,

286 
	#_SC_XOPEN_XPG3
 
_SC_XOPEN_XPG3


	)

287 
	m_SC_XOPEN_XPG4
,

288 
	#_SC_XOPEN_XPG4
 
_SC_XOPEN_XPG4


	)

290 
	m_SC_CHAR_BIT
,

291 
	#_SC_CHAR_BIT
 
_SC_CHAR_BIT


	)

292 
	m_SC_CHAR_MAX
,

293 
	#_SC_CHAR_MAX
 
_SC_CHAR_MAX


	)

294 
	m_SC_CHAR_MIN
,

295 
	#_SC_CHAR_MIN
 
_SC_CHAR_MIN


	)

296 
	m_SC_INT_MAX
,

297 
	#_SC_INT_MAX
 
_SC_INT_MAX


	)

298 
	m_SC_INT_MIN
,

299 
	#_SC_INT_MIN
 
_SC_INT_MIN


	)

300 
	m_SC_LONG_BIT
,

301 
	#_SC_LONG_BIT
 
_SC_LONG_BIT


	)

302 
	m_SC_WORD_BIT
,

303 
	#_SC_WORD_BIT
 
_SC_WORD_BIT


	)

304 
	m_SC_MB_LEN_MAX
,

305 
	#_SC_MB_LEN_MAX
 
_SC_MB_LEN_MAX


	)

306 
	m_SC_NZERO
,

307 
	#_SC_NZERO
 
_SC_NZERO


	)

308 
	m_SC_SSIZE_MAX
,

309 
	#_SC_SSIZE_MAX
 
_SC_SSIZE_MAX


	)

310 
	m_SC_SCHAR_MAX
,

311 
	#_SC_SCHAR_MAX
 
_SC_SCHAR_MAX


	)

312 
	m_SC_SCHAR_MIN
,

313 
	#_SC_SCHAR_MIN
 
_SC_SCHAR_MIN


	)

314 
	m_SC_SHRT_MAX
,

315 
	#_SC_SHRT_MAX
 
_SC_SHRT_MAX


	)

316 
	m_SC_SHRT_MIN
,

317 
	#_SC_SHRT_MIN
 
_SC_SHRT_MIN


	)

318 
	m_SC_UCHAR_MAX
,

319 
	#_SC_UCHAR_MAX
 
_SC_UCHAR_MAX


	)

320 
	m_SC_UINT_MAX
,

321 
	#_SC_UINT_MAX
 
_SC_UINT_MAX


	)

322 
	m_SC_ULONG_MAX
,

323 
	#_SC_ULONG_MAX
 
_SC_ULONG_MAX


	)

324 
	m_SC_USHRT_MAX
,

325 
	#_SC_USHRT_MAX
 
_SC_USHRT_MAX


	)

327 
	m_SC_NL_ARGMAX
,

328 
	#_SC_NL_ARGMAX
 
_SC_NL_ARGMAX


	)

329 
	m_SC_NL_LANGMAX
,

330 
	#_SC_NL_LANGMAX
 
_SC_NL_LANGMAX


	)

331 
	m_SC_NL_MSGMAX
,

332 
	#_SC_NL_MSGMAX
 
_SC_NL_MSGMAX


	)

333 
	m_SC_NL_NMAX
,

334 
	#_SC_NL_NMAX
 
_SC_NL_NMAX


	)

335 
	m_SC_NL_SETMAX
,

336 
	#_SC_NL_SETMAX
 
_SC_NL_SETMAX


	)

337 
	m_SC_NL_TEXTMAX
,

338 
	#_SC_NL_TEXTMAX
 
_SC_NL_TEXTMAX


	)

340 
	m_SC_XBS5_ILP32_OFF32
,

341 
	#_SC_XBS5_ILP32_OFF32
 
_SC_XBS5_ILP32_OFF32


	)

342 
	m_SC_XBS5_ILP32_OFFBIG
,

343 
	#_SC_XBS5_ILP32_OFFBIG
 
_SC_XBS5_ILP32_OFFBIG


	)

344 
	m_SC_XBS5_LP64_OFF64
,

345 
	#_SC_XBS5_LP64_OFF64
 
_SC_XBS5_LP64_OFF64


	)

346 
	m_SC_XBS5_LPBIG_OFFBIG
,

347 
	#_SC_XBS5_LPBIG_OFFBIG
 
_SC_XBS5_LPBIG_OFFBIG


	)

349 
	m_SC_XOPEN_LEGACY
,

350 
	#_SC_XOPEN_LEGACY
 
_SC_XOPEN_LEGACY


	)

351 
	m_SC_XOPEN_REALTIME
,

352 
	#_SC_XOPEN_REALTIME
 
_SC_XOPEN_REALTIME


	)

353 
	m_SC_XOPEN_REALTIME_THREADS
,

354 
	#_SC_XOPEN_REALTIME_THREADS
 
_SC_XOPEN_REALTIME_THREADS


	)

356 
	m_SC_ADVISORY_INFO
,

357 
	#_SC_ADVISORY_INFO
 
_SC_ADVISORY_INFO


	)

358 
	m_SC_BARRIERS
,

359 
	#_SC_BARRIERS
 
_SC_BARRIERS


	)

360 
	m_SC_BASE
,

361 
	#_SC_BASE
 
_SC_BASE


	)

362 
	m_SC_C_LANG_SUPPORT
,

363 
	#_SC_C_LANG_SUPPORT
 
_SC_C_LANG_SUPPORT


	)

364 
	m_SC_C_LANG_SUPPORT_R
,

365 
	#_SC_C_LANG_SUPPORT_R
 
_SC_C_LANG_SUPPORT_R


	)

366 
	m_SC_CLOCK_SELECTION
,

367 
	#_SC_CLOCK_SELECTION
 
_SC_CLOCK_SELECTION


	)

368 
	m_SC_CPUTIME
,

369 
	#_SC_CPUTIME
 
_SC_CPUTIME


	)

370 
	m_SC_THREAD_CPUTIME
,

371 
	#_SC_THREAD_CPUTIME
 
_SC_THREAD_CPUTIME


	)

372 
	m_SC_DEVICE_IO
,

373 
	#_SC_DEVICE_IO
 
_SC_DEVICE_IO


	)

374 
	m_SC_DEVICE_SPECIFIC
,

375 
	#_SC_DEVICE_SPECIFIC
 
_SC_DEVICE_SPECIFIC


	)

376 
	m_SC_DEVICE_SPECIFIC_R
,

377 
	#_SC_DEVICE_SPECIFIC_R
 
_SC_DEVICE_SPECIFIC_R


	)

378 
	m_SC_FD_MGMT
,

379 
	#_SC_FD_MGMT
 
_SC_FD_MGMT


	)

380 
	m_SC_FIFO
,

381 
	#_SC_FIFO
 
_SC_FIFO


	)

382 
	m_SC_PIPE
,

383 
	#_SC_PIPE
 
_SC_PIPE


	)

384 
	m_SC_FILE_ATTRIBUTES
,

385 
	#_SC_FILE_ATTRIBUTES
 
_SC_FILE_ATTRIBUTES


	)

386 
	m_SC_FILE_LOCKING
,

387 
	#_SC_FILE_LOCKING
 
_SC_FILE_LOCKING


	)

388 
	m_SC_FILE_SYSTEM
,

389 
	#_SC_FILE_SYSTEM
 
_SC_FILE_SYSTEM


	)

390 
	m_SC_MONOTONIC_CLOCK
,

391 
	#_SC_MONOTONIC_CLOCK
 
_SC_MONOTONIC_CLOCK


	)

392 
	m_SC_MULTI_PROCESS
,

393 
	#_SC_MULTI_PROCESS
 
_SC_MULTI_PROCESS


	)

394 
	m_SC_SINGLE_PROCESS
,

395 
	#_SC_SINGLE_PROCESS
 
_SC_SINGLE_PROCESS


	)

396 
	m_SC_NETWORKING
,

397 
	#_SC_NETWORKING
 
_SC_NETWORKING


	)

398 
	m_SC_READER_WRITER_LOCKS
,

399 
	#_SC_READER_WRITER_LOCKS
 
_SC_READER_WRITER_LOCKS


	)

400 
	m_SC_SPIN_LOCKS
,

401 
	#_SC_SPIN_LOCKS
 
_SC_SPIN_LOCKS


	)

402 
	m_SC_REGEXP
,

403 
	#_SC_REGEXP
 
_SC_REGEXP


	)

404 
	m_SC_REGEX_VERSION
,

405 
	#_SC_REGEX_VERSION
 
_SC_REGEX_VERSION


	)

406 
	m_SC_SHELL
,

407 
	#_SC_SHELL
 
_SC_SHELL


	)

408 
	m_SC_SIGNALS
,

409 
	#_SC_SIGNALS
 
_SC_SIGNALS


	)

410 
	m_SC_SPAWN
,

411 
	#_SC_SPAWN
 
_SC_SPAWN


	)

412 
	m_SC_SPORADIC_SERVER
,

413 
	#_SC_SPORADIC_SERVER
 
_SC_SPORADIC_SERVER


	)

414 
	m_SC_THREAD_SPORADIC_SERVER
,

415 
	#_SC_THREAD_SPORADIC_SERVER
 
_SC_THREAD_SPORADIC_SERVER


	)

416 
	m_SC_SYSTEM_DATABASE
,

417 
	#_SC_SYSTEM_DATABASE
 
_SC_SYSTEM_DATABASE


	)

418 
	m_SC_SYSTEM_DATABASE_R
,

419 
	#_SC_SYSTEM_DATABASE_R
 
_SC_SYSTEM_DATABASE_R


	)

420 
	m_SC_TIMEOUTS
,

421 
	#_SC_TIMEOUTS
 
_SC_TIMEOUTS


	)

422 
	m_SC_TYPED_MEMORY_OBJECTS
,

423 
	#_SC_TYPED_MEMORY_OBJECTS
 
_SC_TYPED_MEMORY_OBJECTS


	)

424 
	m_SC_USER_GROUPS
,

425 
	#_SC_USER_GROUPS
 
_SC_USER_GROUPS


	)

426 
	m_SC_USER_GROUPS_R
,

427 
	#_SC_USER_GROUPS_R
 
_SC_USER_GROUPS_R


	)

428 
	m_SC_2_PBS
,

429 
	#_SC_2_PBS
 
_SC_2_PBS


	)

430 
	m_SC_2_PBS_ACCOUNTING
,

431 
	#_SC_2_PBS_ACCOUNTING
 
_SC_2_PBS_ACCOUNTING


	)

432 
	m_SC_2_PBS_LOCATE
,

433 
	#_SC_2_PBS_LOCATE
 
_SC_2_PBS_LOCATE


	)

434 
	m_SC_2_PBS_MESSAGE
,

435 
	#_SC_2_PBS_MESSAGE
 
_SC_2_PBS_MESSAGE


	)

436 
	m_SC_2_PBS_TRACK
,

437 
	#_SC_2_PBS_TRACK
 
_SC_2_PBS_TRACK


	)

438 
	m_SC_SYMLOOP_MAX
,

439 
	#_SC_SYMLOOP_MAX
 
_SC_SYMLOOP_MAX


	)

440 
	m_SC_STREAMS
,

441 
	#_SC_STREAMS
 
_SC_STREAMS


	)

442 
	m_SC_2_PBS_CHECKPOINT
,

443 
	#_SC_2_PBS_CHECKPOINT
 
_SC_2_PBS_CHECKPOINT


	)

445 
	m_SC_V6_ILP32_OFF32
,

446 
	#_SC_V6_ILP32_OFF32
 
_SC_V6_ILP32_OFF32


	)

447 
	m_SC_V6_ILP32_OFFBIG
,

448 
	#_SC_V6_ILP32_OFFBIG
 
_SC_V6_ILP32_OFFBIG


	)

449 
	m_SC_V6_LP64_OFF64
,

450 
	#_SC_V6_LP64_OFF64
 
_SC_V6_LP64_OFF64


	)

451 
	m_SC_V6_LPBIG_OFFBIG
,

452 
	#_SC_V6_LPBIG_OFFBIG
 
_SC_V6_LPBIG_OFFBIG


	)

454 
	m_SC_HOST_NAME_MAX
,

455 
	#_SC_HOST_NAME_MAX
 
_SC_HOST_NAME_MAX


	)

456 
	m_SC_TRACE
,

457 
	#_SC_TRACE
 
_SC_TRACE


	)

458 
	m_SC_TRACE_EVENT_FILTER
,

459 
	#_SC_TRACE_EVENT_FILTER
 
_SC_TRACE_EVENT_FILTER


	)

460 
	m_SC_TRACE_INHERIT
,

461 
	#_SC_TRACE_INHERIT
 
_SC_TRACE_INHERIT


	)

462 
	m_SC_TRACE_LOG
,

463 
	#_SC_TRACE_LOG
 
_SC_TRACE_LOG


	)

465 
	m_SC_LEVEL1_ICACHE_SIZE
,

466 
	#_SC_LEVEL1_ICACHE_SIZE
 
_SC_LEVEL1_ICACHE_SIZE


	)

467 
	m_SC_LEVEL1_ICACHE_ASSOC
,

468 
	#_SC_LEVEL1_ICACHE_ASSOC
 
_SC_LEVEL1_ICACHE_ASSOC


	)

469 
	m_SC_LEVEL1_ICACHE_LINESIZE
,

470 
	#_SC_LEVEL1_ICACHE_LINESIZE
 
_SC_LEVEL1_ICACHE_LINESIZE


	)

471 
	m_SC_LEVEL1_DCACHE_SIZE
,

472 
	#_SC_LEVEL1_DCACHE_SIZE
 
_SC_LEVEL1_DCACHE_SIZE


	)

473 
	m_SC_LEVEL1_DCACHE_ASSOC
,

474 
	#_SC_LEVEL1_DCACHE_ASSOC
 
_SC_LEVEL1_DCACHE_ASSOC


	)

475 
	m_SC_LEVEL1_DCACHE_LINESIZE
,

476 
	#_SC_LEVEL1_DCACHE_LINESIZE
 
_SC_LEVEL1_DCACHE_LINESIZE


	)

477 
	m_SC_LEVEL2_CACHE_SIZE
,

478 
	#_SC_LEVEL2_CACHE_SIZE
 
_SC_LEVEL2_CACHE_SIZE


	)

479 
	m_SC_LEVEL2_CACHE_ASSOC
,

480 
	#_SC_LEVEL2_CACHE_ASSOC
 
_SC_LEVEL2_CACHE_ASSOC


	)

481 
	m_SC_LEVEL2_CACHE_LINESIZE
,

482 
	#_SC_LEVEL2_CACHE_LINESIZE
 
_SC_LEVEL2_CACHE_LINESIZE


	)

483 
	m_SC_LEVEL3_CACHE_SIZE
,

484 
	#_SC_LEVEL3_CACHE_SIZE
 
_SC_LEVEL3_CACHE_SIZE


	)

485 
	m_SC_LEVEL3_CACHE_ASSOC
,

486 
	#_SC_LEVEL3_CACHE_ASSOC
 
_SC_LEVEL3_CACHE_ASSOC


	)

487 
	m_SC_LEVEL3_CACHE_LINESIZE
,

488 
	#_SC_LEVEL3_CACHE_LINESIZE
 
_SC_LEVEL3_CACHE_LINESIZE


	)

489 
	m_SC_LEVEL4_CACHE_SIZE
,

490 
	#_SC_LEVEL4_CACHE_SIZE
 
_SC_LEVEL4_CACHE_SIZE


	)

491 
	m_SC_LEVEL4_CACHE_ASSOC
,

492 
	#_SC_LEVEL4_CACHE_ASSOC
 
_SC_LEVEL4_CACHE_ASSOC


	)

493 
	m_SC_LEVEL4_CACHE_LINESIZE
,

494 
	#_SC_LEVEL4_CACHE_LINESIZE
 
_SC_LEVEL4_CACHE_LINESIZE


	)

497 
	m_SC_IPV6
 = 
_SC_LEVEL1_ICACHE_SIZE
 + 50,

498 
	#_SC_IPV6
 
_SC_IPV6


	)

499 
	m_SC_RAW_SOCKETS
,

500 
	#_SC_RAW_SOCKETS
 
_SC_RAW_SOCKETS


	)

502 
	m_SC_V7_ILP32_OFF32
,

503 
	#_SC_V7_ILP32_OFF32
 
_SC_V7_ILP32_OFF32


	)

504 
	m_SC_V7_ILP32_OFFBIG
,

505 
	#_SC_V7_ILP32_OFFBIG
 
_SC_V7_ILP32_OFFBIG


	)

506 
	m_SC_V7_LP64_OFF64
,

507 
	#_SC_V7_LP64_OFF64
 
_SC_V7_LP64_OFF64


	)

508 
	m_SC_V7_LPBIG_OFFBIG
,

509 
	#_SC_V7_LPBIG_OFFBIG
 
_SC_V7_LPBIG_OFFBIG


	)

511 
	m_SC_SS_REPL_MAX
,

512 
	#_SC_SS_REPL_MAX
 
_SC_SS_REPL_MAX


	)

514 
	m_SC_TRACE_EVENT_NAME_MAX
,

515 
	#_SC_TRACE_EVENT_NAME_MAX
 
_SC_TRACE_EVENT_NAME_MAX


	)

516 
	m_SC_TRACE_NAME_MAX
,

517 
	#_SC_TRACE_NAME_MAX
 
_SC_TRACE_NAME_MAX


	)

518 
	m_SC_TRACE_SYS_MAX
,

519 
	#_SC_TRACE_SYS_MAX
 
_SC_TRACE_SYS_MAX


	)

520 
	m_SC_TRACE_USER_EVENT_MAX
,

521 
	#_SC_TRACE_USER_EVENT_MAX
 
_SC_TRACE_USER_EVENT_MAX


	)

523 
	m_SC_XOPEN_STREAMS
,

524 
	#_SC_XOPEN_STREAMS
 
_SC_XOPEN_STREAMS


	)

526 
	m_SC_THREAD_ROBUST_PRIO_INHERIT
,

527 
	#_SC_THREAD_ROBUST_PRIO_INHERIT
 
_SC_THREAD_ROBUST_PRIO_INHERIT


	)

528 
	m_SC_THREAD_ROBUST_PRIO_PROTECT


529 
	#_SC_THREAD_ROBUST_PRIO_PROTECT
 
_SC_THREAD_ROBUST_PRIO_PROTECT


	)

535 
	m_CS_PATH
,

536 
	#_CS_PATH
 
_CS_PATH


	)

538 
	m_CS_V6_WIDTH_RESTRICTED_ENVS
,

539 
	#_CS_V6_WIDTH_RESTRICTED_ENVS
 
_CS_V6_WIDTH_RESTRICTED_ENVS


	)

540 
	#_CS_POSIX_V6_WIDTH_RESTRICTED_ENVS
 
_CS_V6_WIDTH_RESTRICTED_ENVS


	)

542 
	m_CS_GNU_LIBC_VERSION
,

543 
	#_CS_GNU_LIBC_VERSION
 
_CS_GNU_LIBC_VERSION


	)

544 
	m_CS_GNU_LIBPTHREAD_VERSION
,

545 
	#_CS_GNU_LIBPTHREAD_VERSION
 
_CS_GNU_LIBPTHREAD_VERSION


	)

547 
	m_CS_V5_WIDTH_RESTRICTED_ENVS
,

548 
	#_CS_V5_WIDTH_RESTRICTED_ENVS
 
_CS_V5_WIDTH_RESTRICTED_ENVS


	)

549 
	#_CS_POSIX_V5_WIDTH_RESTRICTED_ENVS
 
_CS_V5_WIDTH_RESTRICTED_ENVS


	)

551 
	m_CS_V7_WIDTH_RESTRICTED_ENVS
,

552 
	#_CS_V7_WIDTH_RESTRICTED_ENVS
 
_CS_V7_WIDTH_RESTRICTED_ENVS


	)

553 
	#_CS_POSIX_V7_WIDTH_RESTRICTED_ENVS
 
_CS_V7_WIDTH_RESTRICTED_ENVS


	)

555 
	m_CS_LFS_CFLAGS
 = 1000,

556 
	#_CS_LFS_CFLAGS
 
_CS_LFS_CFLAGS


	)

557 
	m_CS_LFS_LDFLAGS
,

558 
	#_CS_LFS_LDFLAGS
 
_CS_LFS_LDFLAGS


	)

559 
	m_CS_LFS_LIBS
,

560 
	#_CS_LFS_LIBS
 
_CS_LFS_LIBS


	)

561 
	m_CS_LFS_LINTFLAGS
,

562 
	#_CS_LFS_LINTFLAGS
 
_CS_LFS_LINTFLAGS


	)

563 
	m_CS_LFS64_CFLAGS
,

564 
	#_CS_LFS64_CFLAGS
 
_CS_LFS64_CFLAGS


	)

565 
	m_CS_LFS64_LDFLAGS
,

566 
	#_CS_LFS64_LDFLAGS
 
_CS_LFS64_LDFLAGS


	)

567 
	m_CS_LFS64_LIBS
,

568 
	#_CS_LFS64_LIBS
 
_CS_LFS64_LIBS


	)

569 
	m_CS_LFS64_LINTFLAGS
,

570 
	#_CS_LFS64_LINTFLAGS
 
_CS_LFS64_LINTFLAGS


	)

572 
	m_CS_XBS5_ILP32_OFF32_CFLAGS
 = 1100,

573 
	#_CS_XBS5_ILP32_OFF32_CFLAGS
 
_CS_XBS5_ILP32_OFF32_CFLAGS


	)

574 
	m_CS_XBS5_ILP32_OFF32_LDFLAGS
,

575 
	#_CS_XBS5_ILP32_OFF32_LDFLAGS
 
_CS_XBS5_ILP32_OFF32_LDFLAGS


	)

576 
	m_CS_XBS5_ILP32_OFF32_LIBS
,

577 
	#_CS_XBS5_ILP32_OFF32_LIBS
 
_CS_XBS5_ILP32_OFF32_LIBS


	)

578 
	m_CS_XBS5_ILP32_OFF32_LINTFLAGS
,

579 
	#_CS_XBS5_ILP32_OFF32_LINTFLAGS
 
_CS_XBS5_ILP32_OFF32_LINTFLAGS


	)

580 
	m_CS_XBS5_ILP32_OFFBIG_CFLAGS
,

581 
	#_CS_XBS5_ILP32_OFFBIG_CFLAGS
 
_CS_XBS5_ILP32_OFFBIG_CFLAGS


	)

582 
	m_CS_XBS5_ILP32_OFFBIG_LDFLAGS
,

583 
	#_CS_XBS5_ILP32_OFFBIG_LDFLAGS
 
_CS_XBS5_ILP32_OFFBIG_LDFLAGS


	)

584 
	m_CS_XBS5_ILP32_OFFBIG_LIBS
,

585 
	#_CS_XBS5_ILP32_OFFBIG_LIBS
 
_CS_XBS5_ILP32_OFFBIG_LIBS


	)

586 
	m_CS_XBS5_ILP32_OFFBIG_LINTFLAGS
,

587 
	#_CS_XBS5_ILP32_OFFBIG_LINTFLAGS
 
_CS_XBS5_ILP32_OFFBIG_LINTFLAGS


	)

588 
	m_CS_XBS5_LP64_OFF64_CFLAGS
,

589 
	#_CS_XBS5_LP64_OFF64_CFLAGS
 
_CS_XBS5_LP64_OFF64_CFLAGS


	)

590 
	m_CS_XBS5_LP64_OFF64_LDFLAGS
,

591 
	#_CS_XBS5_LP64_OFF64_LDFLAGS
 
_CS_XBS5_LP64_OFF64_LDFLAGS


	)

592 
	m_CS_XBS5_LP64_OFF64_LIBS
,

593 
	#_CS_XBS5_LP64_OFF64_LIBS
 
_CS_XBS5_LP64_OFF64_LIBS


	)

594 
	m_CS_XBS5_LP64_OFF64_LINTFLAGS
,

595 
	#_CS_XBS5_LP64_OFF64_LINTFLAGS
 
_CS_XBS5_LP64_OFF64_LINTFLAGS


	)

596 
	m_CS_XBS5_LPBIG_OFFBIG_CFLAGS
,

597 
	#_CS_XBS5_LPBIG_OFFBIG_CFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_CFLAGS


	)

598 
	m_CS_XBS5_LPBIG_OFFBIG_LDFLAGS
,

599 
	#_CS_XBS5_LPBIG_OFFBIG_LDFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_LDFLAGS


	)

600 
	m_CS_XBS5_LPBIG_OFFBIG_LIBS
,

601 
	#_CS_XBS5_LPBIG_OFFBIG_LIBS
 
_CS_XBS5_LPBIG_OFFBIG_LIBS


	)

602 
	m_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS
,

603 
	#_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS
 
_CS_XBS5_LPBIG_OFFBIG_LINTFLAGS


	)

605 
	m_CS_POSIX_V6_ILP32_OFF32_CFLAGS
,

606 
	#_CS_POSIX_V6_ILP32_OFF32_CFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_CFLAGS


	)

607 
	m_CS_POSIX_V6_ILP32_OFF32_LDFLAGS
,

608 
	#_CS_POSIX_V6_ILP32_OFF32_LDFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_LDFLAGS


	)

609 
	m_CS_POSIX_V6_ILP32_OFF32_LIBS
,

610 
	#_CS_POSIX_V6_ILP32_OFF32_LIBS
 
_CS_POSIX_V6_ILP32_OFF32_LIBS


	)

611 
	m_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS
,

612 
	#_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS
 
_CS_POSIX_V6_ILP32_OFF32_LINTFLAGS


	)

613 
	m_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS
,

614 
	#_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_CFLAGS


	)

615 
	m_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS
,

616 
	#_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_LDFLAGS


	)

617 
	m_CS_POSIX_V6_ILP32_OFFBIG_LIBS
,

618 
	#_CS_POSIX_V6_ILP32_OFFBIG_LIBS
 
_CS_POSIX_V6_ILP32_OFFBIG_LIBS


	)

619 
	m_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS
,

620 
	#_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS
 
_CS_POSIX_V6_ILP32_OFFBIG_LINTFLAGS


	)

621 
	m_CS_POSIX_V6_LP64_OFF64_CFLAGS
,

622 
	#_CS_POSIX_V6_LP64_OFF64_CFLAGS
 
_CS_POSIX_V6_LP64_OFF64_CFLAGS


	)

623 
	m_CS_POSIX_V6_LP64_OFF64_LDFLAGS
,

624 
	#_CS_POSIX_V6_LP64_OFF64_LDFLAGS
 
_CS_POSIX_V6_LP64_OFF64_LDFLAGS


	)

625 
	m_CS_POSIX_V6_LP64_OFF64_LIBS
,

626 
	#_CS_POSIX_V6_LP64_OFF64_LIBS
 
_CS_POSIX_V6_LP64_OFF64_LIBS


	)

627 
	m_CS_POSIX_V6_LP64_OFF64_LINTFLAGS
,

628 
	#_CS_POSIX_V6_LP64_OFF64_LINTFLAGS
 
_CS_POSIX_V6_LP64_OFF64_LINTFLAGS


	)

629 
	m_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS
,

630 
	#_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_CFLAGS


	)

631 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS
,

632 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LDFLAGS


	)

633 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LIBS
,

634 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LIBS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LIBS


	)

635 
	m_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS
,

636 
	#_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS
 
_CS_POSIX_V6_LPBIG_OFFBIG_LINTFLAGS


	)

638 
	m_CS_POSIX_V7_ILP32_OFF32_CFLAGS
,

639 
	#_CS_POSIX_V7_ILP32_OFF32_CFLAGS
 
_CS_POSIX_V7_ILP32_OFF32_CFLAGS


	)

640 
	m_CS_POSIX_V7_ILP32_OFF32_LDFLAGS
,

641 
	#_CS_POSIX_V7_ILP32_OFF32_LDFLAGS
 
_CS_POSIX_V7_ILP32_OFF32_LDFLAGS


	)

642 
	m_CS_POSIX_V7_ILP32_OFF32_LIBS
,

643 
	#_CS_POSIX_V7_ILP32_OFF32_LIBS
 
_CS_POSIX_V7_ILP32_OFF32_LIBS


	)

644 
	m_CS_POSIX_V7_ILP32_OFF32_LINTFLAGS
,

645 
	#_CS_POSIX_V7_ILP32_OFF32_LINTFLAGS
 
_CS_POSIX_V7_ILP32_OFF32_LINTFLAGS


	)

646 
	m_CS_POSIX_V7_ILP32_OFFBIG_CFLAGS
,

647 
	#_CS_POSIX_V7_ILP32_OFFBIG_CFLAGS
 
_CS_POSIX_V7_ILP32_OFFBIG_CFLAGS


	)

648 
	m_CS_POSIX_V7_ILP32_OFFBIG_LDFLAGS
,

649 
	#_CS_POSIX_V7_ILP32_OFFBIG_LDFLAGS
 
_CS_POSIX_V7_ILP32_OFFBIG_LDFLAGS


	)

650 
	m_CS_POSIX_V7_ILP32_OFFBIG_LIBS
,

651 
	#_CS_POSIX_V7_ILP32_OFFBIG_LIBS
 
_CS_POSIX_V7_ILP32_OFFBIG_LIBS


	)

652 
	m_CS_POSIX_V7_ILP32_OFFBIG_LINTFLAGS
,

653 
	#_CS_POSIX_V7_ILP32_OFFBIG_LINTFLAGS
 
_CS_POSIX_V7_ILP32_OFFBIG_LINTFLAGS


	)

654 
	m_CS_POSIX_V7_LP64_OFF64_CFLAGS
,

655 
	#_CS_POSIX_V7_LP64_OFF64_CFLAGS
 
_CS_POSIX_V7_LP64_OFF64_CFLAGS


	)

656 
	m_CS_POSIX_V7_LP64_OFF64_LDFLAGS
,

657 
	#_CS_POSIX_V7_LP64_OFF64_LDFLAGS
 
_CS_POSIX_V7_LP64_OFF64_LDFLAGS


	)

658 
	m_CS_POSIX_V7_LP64_OFF64_LIBS
,

659 
	#_CS_POSIX_V7_LP64_OFF64_LIBS
 
_CS_POSIX_V7_LP64_OFF64_LIBS


	)

660 
	m_CS_POSIX_V7_LP64_OFF64_LINTFLAGS
,

661 
	#_CS_POSIX_V7_LP64_OFF64_LINTFLAGS
 
_CS_POSIX_V7_LP64_OFF64_LINTFLAGS


	)

662 
	m_CS_POSIX_V7_LPBIG_OFFBIG_CFLAGS
,

663 
	#_CS_POSIX_V7_LPBIG_OFFBIG_CFLAGS
 
_CS_POSIX_V7_LPBIG_OFFBIG_CFLAGS


	)

664 
	m_CS_POSIX_V7_LPBIG_OFFBIG_LDFLAGS
,

665 
	#_CS_POSIX_V7_LPBIG_OFFBIG_LDFLAGS
 
_CS_POSIX_V7_LPBIG_OFFBIG_LDFLAGS


	)

666 
	m_CS_POSIX_V7_LPBIG_OFFBIG_LIBS
,

667 
	#_CS_POSIX_V7_LPBIG_OFFBIG_LIBS
 
_CS_POSIX_V7_LPBIG_OFFBIG_LIBS


	)

668 
	m_CS_POSIX_V7_LPBIG_OFFBIG_LINTFLAGS
,

669 
	#_CS_POSIX_V7_LPBIG_OFFBIG_LINTFLAGS
 
_CS_POSIX_V7_LPBIG_OFFBIG_LINTFLAGS


	)

671 
	m_CS_V6_ENV
,

672 
	#_CS_V6_ENV
 
_CS_V6_ENV


	)

673 
	m_CS_V7_ENV


674 
	#_CS_V7_ENV
 
_CS_V7_ENV


	)

	@/usr/include/bits/environments.h

18 #iâdeà
_UNISTD_H


22 
	~<b™s/wÜdsize.h
>

42 #ià
__WORDSIZE
 == 64

56 
	#_POSIX_V7_LPBIG_OFFBIG
 -1

	)

57 
	#_POSIX_V6_LPBIG_OFFBIG
 -1

	)

58 
	#_XBS5_LPBIG_OFFBIG
 -1

	)

61 
	#_POSIX_V7_LP64_OFF64
 1

	)

62 
	#_POSIX_V6_LP64_OFF64
 1

	)

63 
	#_XBS5_LP64_OFF64
 1

	)

69 
	#_POSIX_V7_ILP32_OFFBIG
 1

	)

70 
	#_POSIX_V6_ILP32_OFFBIG
 1

	)

71 
	#_XBS5_ILP32_OFFBIG
 1

	)

73 #iâdeà
__x86_64__


75 
	#_POSIX_V7_ILP32_OFF32
 1

	)

76 
	#_POSIX_V6_ILP32_OFF32
 1

	)

77 
	#_XBS5_ILP32_OFF32
 1

	)

95 
	#__ILP32_OFF32_CFLAGS
 "-m32"

	)

96 
	#__ILP32_OFF32_LDFLAGS
 "-m32"

	)

97 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


98 
	#__ILP32_OFFBIG_CFLAGS
 "-mx32"

	)

99 
	#__ILP32_OFFBIG_LDFLAGS
 "-mx32"

	)

101 
	#__ILP32_OFFBIG_CFLAGS
 "-m32 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64"

	)

102 
	#__ILP32_OFFBIG_LDFLAGS
 "-m32"

	)

104 
	#__LP64_OFF64_CFLAGS
 "-m64"

	)

105 
	#__LP64_OFF64_LDFLAGS
 "-m64"

	)

	@/usr/include/bits/fcntl.h

19 #iâdeà
_FCNTL_H


23 #ifdeà
__x86_64__


24 
	#__O_LARGEFILE
 0

	)

27 #ifdeà
__x86_64__


29 
	#F_GETLK64
 5

	)

30 
	#F_SETLK64
 6

	)

31 
	#F_SETLKW64
 7

	)

35 
	sæock


37 
	ml_ty³
;

38 
	ml_wh’û
;

39 #iâdeà
__USE_FILE_OFFSET64


40 
__off_t
 
	ml_¡¬t
;

41 
__off_t
 
	ml_Ën
;

43 
__off64_t
 
	ml_¡¬t
;

44 
__off64_t
 
	ml_Ën
;

46 
__pid_t
 
	ml_pid
;

49 #ifdeà
__USE_LARGEFILE64


50 
	sæock64


52 
	ml_ty³
;

53 
	ml_wh’û
;

54 
__off64_t
 
	ml_¡¬t
;

55 
__off64_t
 
	ml_Ën
;

56 
__pid_t
 
	ml_pid
;

61 
	~<b™s/fú-lšux.h
>

	@/usr/include/bits/fcntl2.h

19 #iâdef 
_FCNTL_H


25 #iâdeà
__USE_FILE_OFFSET64


26 
	$__İ’_2
 (cÚ¡ *
__·th
, 
__oæag
è
	`__nÚnuÎ
 ((1));

27 
	`__REDIRECT
 (
__İ’_®Ÿs
, (cÚ¡ *
__·th
, 
__oæag
, ...),

28 
İ’
è
	`__nÚnuÎ
 ((1));

30 
	`__REDIRECT
 (
__İ’_2
, (cÚ¡ *
__·th
, 
__oæag
),

31 
__İ’64_2
è
	`__nÚnuÎ
 ((1));

32 
	`__REDIRECT
 (
__İ’_®Ÿs
, (cÚ¡ *
__·th
, 
__oæag
, ...),

33 
İ’64
è
	`__nÚnuÎ
 ((1));

35 
	`__”rÜdeş
 (
__İ’_too_mªy_¬gs
,

37 
	`__”rÜdeş
 (
__İ’_missšg_mode
,

40 
__fÜtify_funùiÚ
 

41 
	$İ’
 (cÚ¡ *
__·th
, 
__oæag
, ...)

43 ià(
	`__va_¬g_·ck_Ën
 () > 1)

44 
	`__İ’_too_mªy_¬gs
 ();

46 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

48 ià(
	`__OPEN_NEEDS_MODE
 (
__oæag
è&& 
	`__va_¬g_·ck_Ën
 () < 1)

50 
	`__İ’_missšg_mode
 ();

51  
	`__İ’_2
 (
__·th
, 
__oæag
);

53  
	`__İ’_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

56 ià(
	`__va_¬g_·ck_Ën
 () < 1)

57  
	`__İ’_2
 (
__·th
, 
__oæag
);

59  
	`__İ’_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

60 
	}
}

63 #ifdeà
__USE_LARGEFILE64


64 
	$__İ’64_2
 (cÚ¡ *
__·th
, 
__oæag
è
	`__nÚnuÎ
 ((1));

65 
	`__REDIRECT
 (
__İ’64_®Ÿs
, (cÚ¡ *
__·th
, 
__oæag
,

66 ...), 
İ’64
è
	`__nÚnuÎ
 ((1));

67 
	`__”rÜdeş
 (
__İ’64_too_mªy_¬gs
,

69 
	`__”rÜdeş
 (
__İ’64_missšg_mode
,

72 
__fÜtify_funùiÚ
 

73 
	$İ’64
 (cÚ¡ *
__·th
, 
__oæag
, ...)

75 ià(
	`__va_¬g_·ck_Ën
 () > 1)

76 
	`__İ’64_too_mªy_¬gs
 ();

78 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

80 ià(
	`__OPEN_NEEDS_MODE
 (
__oæag
è&& 
	`__va_¬g_·ck_Ën
 () < 1)

82 
	`__İ’64_missšg_mode
 ();

83  
	`__İ’64_2
 (
__·th
, 
__oæag
);

85  
	`__İ’64_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

88 ià(
	`__va_¬g_·ck_Ën
 () < 1)

89  
	`__İ’64_2
 (
__·th
, 
__oæag
);

91  
	`__İ’64_®Ÿs
 (
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

92 
	}
}

96 #ifdeà
__USE_ATFILE


97 #iâdeà
__USE_FILE_OFFSET64


98 
	$__İ’©_2
 (
__fd
, cÚ¡ *
__·th
, 
__oæag
)

99 
	`__nÚnuÎ
 ((2));

100 
	`__REDIRECT
 (
__İ’©_®Ÿs
, (
__fd
, cÚ¡ *
__·th
,

101 
__oæag
, ...), 
İ’©
)

102 
	`__nÚnuÎ
 ((2));

104 
	`__REDIRECT
 (
__İ’©_2
, (
__fd
, cÚ¡ *
__·th
,

105 
__oæag
), 
__İ’©64_2
)

106 
	`__nÚnuÎ
 ((2));

107 
	`__REDIRECT
 (
__İ’©_®Ÿs
, (
__fd
, cÚ¡ *
__·th
,

108 
__oæag
, ...), 
İ’©64
)

109 
	`__nÚnuÎ
 ((2));

111 
	`__”rÜdeş
 (
__İ’©_too_mªy_¬gs
,

113 
	`__”rÜdeş
 (
__İ’©_missšg_mode
,

116 
__fÜtify_funùiÚ
 

117 
	$İ’©
 (
__fd
, cÚ¡ *
__·th
, 
__oæag
, ...)

119 ià(
	`__va_¬g_·ck_Ën
 () > 1)

120 
	`__İ’©_too_mªy_¬gs
 ();

122 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

124 ià(
	`__OPEN_NEEDS_MODE
 (
__oæag
è&& 
	`__va_¬g_·ck_Ën
 () < 1)

126 
	`__İ’©_missšg_mode
 ();

127  
	`__İ’©_2
 (
__fd
, 
__·th
, 
__oæag
);

129  
	`__İ’©_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

132 ià(
	`__va_¬g_·ck_Ën
 () < 1)

133  
	`__İ’©_2
 (
__fd
, 
__·th
, 
__oæag
);

135  
	`__İ’©_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

136 
	}
}

139 #ifdeà
__USE_LARGEFILE64


140 
	$__İ’©64_2
 (
__fd
, cÚ¡ *
__·th
, 
__oæag
)

141 
	`__nÚnuÎ
 ((2));

142 
	`__REDIRECT
 (
__İ’©64_®Ÿs
, (
__fd
, cÚ¡ *
__·th
,

143 
__oæag
, ...), 
İ’©64
)

144 
	`__nÚnuÎ
 ((2));

145 
	`__”rÜdeş
 (
__İ’©64_too_mªy_¬gs
,

147 
	`__”rÜdeş
 (
__İ’©64_missšg_mode
,

150 
__fÜtify_funùiÚ
 

151 
	$İ’©64
 (
__fd
, cÚ¡ *
__·th
, 
__oæag
, ...)

153 ià(
	`__va_¬g_·ck_Ën
 () > 1)

154 
	`__İ’©64_too_mªy_¬gs
 ();

156 ià(
	`__butš_cÚ¡ªt_p
 (
__oæag
))

158 ià(
	`__OPEN_NEEDS_MODE
 (
__oæag
è&& 
	`__va_¬g_·ck_Ën
 () < 1)

160 
	`__İ’©64_missšg_mode
 ();

161  
	`__İ’©64_2
 (
__fd
, 
__·th
, 
__oæag
);

163  
	`__İ’©64_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

166 ià(
	`__va_¬g_·ck_Ën
 () < 1)

167  
	`__İ’©64_2
 (
__fd
, 
__·th
, 
__oæag
);

169  
	`__İ’©64_®Ÿs
 (
__fd
, 
__·th
, 
__oæag
, 
	`__va_¬g_·ck
 ());

170 
	}
}

	@/usr/include/bits/huge_val.h

20 #iâdeà
_MATH_H


26 #ià
__GNUC_PREREQ
(3,3)

27 
	#HUGE_VAL
 (
	`__butš_huge_v®
())

	)

28 #–ià
__GNUC_PREREQ
(2,96)

29 
	#HUGE_VAL
 (
__ex‹nsiÚ__
 0x1.0
p2047
)

	)

30 #–ià
defšed
 
__GNUC__


32 
	#HUGE_VAL
 \

33 (
__ex‹nsiÚ__
 \

34 ((uniÚ { 
__l
 
	`__©Œibu‹__
((
	`__mode__
(
__DI__
))); 
__d
; }) \

35 { 
__l
: 0x7ff0000000000000ULL }).
__d
)

	)

39 
	~<’dŸn.h
>

41 uniÚ { 
	m__c
[8]; 
	m__d
; } 
	t__huge_v®_t
;

43 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


44 
	#__HUGE_VAL_by‹s
 { 0x7f, 0xf0, 0, 0, 0, 0, 0, 0 }

	)

46 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


47 
	#__HUGE_VAL_by‹s
 { 0, 0, 0, 0, 0, 0, 0xf0, 0x7à}

	)

50 
__huge_v®_t
 
	g__huge_v®
 = { 
__HUGE_VAL_by‹s
 };

51 
	#HUGE_VAL
 (
__huge_v®
.
__d
)

	)

	@/usr/include/bits/huge_valf.h

20 #iâdeà
_MATH_H


26 #ià
__GNUC_PREREQ
(3,3)

27 
	#HUGE_VALF
 (
	`__butš_huge_v®f
())

	)

28 #–ià
__GNUC_PREREQ
(2,96)

29 
	#HUGE_VALF
 (
__ex‹nsiÚ__
 0x1.0
p255f
)

	)

30 #–ià
defšed
 
__GNUC__


32 
	#HUGE_VALF
 \

33 (
__ex‹nsiÚ__
 \

34 ((uniÚ { 
__l
 
	`__©Œibu‹__
((
	`__mode__
(
__SI__
))); 
__d
; }) \

35 { 
__l
: 0x7f800000UL }).
__d
)

	)

39 uniÚ { 
	m__c
[4]; 
	m__f
; } 
	t__huge_v®f_t
;

41 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


42 
	#__HUGE_VALF_by‹s
 { 0x7f, 0x80, 0, 0 }

	)

44 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


45 
	#__HUGE_VALF_by‹s
 { 0, 0, 0x80, 0x7à}

	)

48 
__huge_v®f_t
 
	g__huge_v®f
 = { 
__HUGE_VALF_by‹s
 };

49 
	#HUGE_VALF
 (
__huge_v®f
.
__f
)

	)

	@/usr/include/bits/huge_vall.h

20 #iâdeà
_MATH_H


24 #ià
__GNUC_PREREQ
(3,3)

25 
	#HUGE_VALL
 (
	`__butš_huge_v®l
())

	)

26 #–ià
__GNUC_PREREQ
(2,96)

27 
	#HUGE_VALL
 (
__ex‹nsiÚ__
 0x1.0
p32767L
)

	)

30 
	#__HUGE_VALL_by‹s
 { 0, 0, 0, 0, 0, 0, 0, 0x80, 0xff, 0x7f, 0, 0 }

	)

32 
	#__huge_v®l_t
 uniÚ { 
__c
[12]; 
__ld
; }

	)

33 #ifdeà
__GNUC__


34 
	#HUGE_VALL
 (
__ex‹nsiÚ__
 \

35 ((
__huge_v®l_t
è{ 
__c
: 
__HUGE_VALL_by‹s
 }).
__ld
)

	)

37 
__huge_v®l_t
 
	g__huge_v®l
 = { 
__HUGE_VALL_by‹s
 };

38 
	#HUGE_VALL
 (
__huge_v®l
.
__ld
)

	)

	@/usr/include/bits/in.h

20 #iâdeà
_NETINET_IN_H


32 #ià
defšed
 
_UAPI_LINUX_IN6_H
 \

33 || 
defšed
 
	g_UAPI_IPV6_H
 \

34 || 
defšed
 
	g_LINUX_IN6_H
 \

35 || 
defšed
 
	g_IPV6_H


39 
	#__USE_KERNEL_IPV6_DEFS
 1

	)

41 
	#__USE_KERNEL_IPV6_DEFS
 0

	)

47 
	#IP_OPTIONS
 4

	)

48 
	#IP_HDRINCL
 3

	)

49 
	#IP_TOS
 1

	)

50 
	#IP_TTL
 2

	)

51 
	#IP_RECVOPTS
 6

	)

53 
	#IP_RECVRETOPTS
 
IP_RETOPTS


	)

54 
	#IP_RETOPTS
 7

	)

55 
	#IP_MULTICAST_IF
 32

	)

56 
	#IP_MULTICAST_TTL
 33

	)

57 
	#IP_MULTICAST_LOOP
 34

	)

58 
	#IP_ADD_MEMBERSHIP
 35

	)

59 
	#IP_DROP_MEMBERSHIP
 36

	)

60 
	#IP_UNBLOCK_SOURCE
 37

	)

61 
	#IP_BLOCK_SOURCE
 38

	)

62 
	#IP_ADD_SOURCE_MEMBERSHIP
 39

	)

63 
	#IP_DROP_SOURCE_MEMBERSHIP
 40

	)

64 
	#IP_MSFILTER
 41

	)

65 #ifdeà
__USE_MISC


66 
	#MCAST_JOIN_GROUP
 42

	)

67 
	#MCAST_BLOCK_SOURCE
 43

	)

68 
	#MCAST_UNBLOCK_SOURCE
 44

	)

69 
	#MCAST_LEAVE_GROUP
 45

	)

70 
	#MCAST_JOIN_SOURCE_GROUP
 46

	)

71 
	#MCAST_LEAVE_SOURCE_GROUP
 47

	)

72 
	#MCAST_MSFILTER
 48

	)

73 
	#IP_MULTICAST_ALL
 49

	)

74 
	#IP_UNICAST_IF
 50

	)

76 
	#MCAST_EXCLUDE
 0

	)

77 
	#MCAST_INCLUDE
 1

	)

80 
	#IP_ROUTER_ALERT
 5

	)

81 
	#IP_PKTINFO
 8

	)

82 
	#IP_PKTOPTIONS
 9

	)

83 
	#IP_PMTUDISC
 10

	)

84 
	#IP_MTU_DISCOVER
 10

	)

85 
	#IP_RECVERR
 11

	)

86 
	#IP_RECVTTL
 12

	)

87 
	#IP_RECVTOS
 13

	)

88 
	#IP_MTU
 14

	)

89 
	#IP_FREEBIND
 15

	)

90 
	#IP_IPSEC_POLICY
 16

	)

91 
	#IP_XFRM_POLICY
 17

	)

92 
	#IP_PASSSEC
 18

	)

93 
	#IP_TRANSPARENT
 19

	)

94 
	#IP_MULTICAST_ALL
 49

	)

97 
	#IP_ORIGDSTADDR
 20

	)

98 
	#IP_RECVORIGDSTADDR
 
IP_ORIGDSTADDR


	)

100 
	#IP_MINTTL
 21

	)

101 
	#IP_NODEFRAG
 22

	)

102 
	#IP_CHECKSUM
 23

	)

103 
	#IP_BIND_ADDRESS_NO_PORT
 24

	)

106 
	#IP_PMTUDISC_DONT
 0

	)

107 
	#IP_PMTUDISC_WANT
 1

	)

108 
	#IP_PMTUDISC_DO
 2

	)

109 
	#IP_PMTUDISC_PROBE
 3

	)

113 
	#IP_PMTUDISC_INTERFACE
 4

	)

115 
	#IP_PMTUDISC_OMIT
 5

	)

117 
	#IP_MULTICAST_IF
 32

	)

118 
	#IP_MULTICAST_TTL
 33

	)

119 
	#IP_MULTICAST_LOOP
 34

	)

120 
	#IP_ADD_MEMBERSHIP
 35

	)

121 
	#IP_DROP_MEMBERSHIP
 36

	)

122 
	#IP_UNBLOCK_SOURCE
 37

	)

123 
	#IP_BLOCK_SOURCE
 38

	)

124 
	#IP_ADD_SOURCE_MEMBERSHIP
 39

	)

125 
	#IP_DROP_SOURCE_MEMBERSHIP
 40

	)

126 
	#IP_MSFILTER
 41

	)

127 
	#IP_MULTICAST_ALL
 49

	)

128 
	#IP_UNICAST_IF
 50

	)

131 
	#SOL_IP
 0

	)

133 
	#IP_DEFAULT_MULTICAST_TTL
 1

	)

134 
	#IP_DEFAULT_MULTICAST_LOOP
 1

	)

135 
	#IP_MAX_MEMBERSHIPS
 20

	)

137 #ifdeà
__USE_MISC


141 
	s_İts


143 
š_addr
 
	m_d¡
;

144 
	m_İts
[40];

148 
	s_m»qn


150 
š_addr
 
	mimr_muÉŸddr
;

151 
š_addr
 
	mimr_add»ss
;

152 
	mimr_ifšdex
;

156 
	sš_pktšfo


158 
	mi_ifšdex
;

159 
š_addr
 
	mi_¥ec_d¡
;

160 
š_addr
 
	mi_addr
;

167 
	#IPV6_ADDRFORM
 1

	)

168 
	#IPV6_2292PKTINFO
 2

	)

169 
	#IPV6_2292HOPOPTS
 3

	)

170 
	#IPV6_2292DSTOPTS
 4

	)

171 
	#IPV6_2292RTHDR
 5

	)

172 
	#IPV6_2292PKTOPTIONS
 6

	)

173 
	#IPV6_CHECKSUM
 7

	)

174 
	#IPV6_2292HOPLIMIT
 8

	)

176 
	#SCM_SRCRT
 
IPV6_RXSRCRT


	)

178 
	#IPV6_NEXTHOP
 9

	)

179 
	#IPV6_AUTHHDR
 10

	)

180 
	#IPV6_UNICAST_HOPS
 16

	)

181 
	#IPV6_MULTICAST_IF
 17

	)

182 
	#IPV6_MULTICAST_HOPS
 18

	)

183 
	#IPV6_MULTICAST_LOOP
 19

	)

184 
	#IPV6_JOIN_GROUP
 20

	)

185 
	#IPV6_LEAVE_GROUP
 21

	)

186 
	#IPV6_ROUTER_ALERT
 22

	)

187 
	#IPV6_MTU_DISCOVER
 23

	)

188 
	#IPV6_MTU
 24

	)

189 
	#IPV6_RECVERR
 25

	)

190 
	#IPV6_V6ONLY
 26

	)

191 
	#IPV6_JOIN_ANYCAST
 27

	)

192 
	#IPV6_LEAVE_ANYCAST
 28

	)

193 
	#IPV6_IPSEC_POLICY
 34

	)

194 
	#IPV6_XFRM_POLICY
 35

	)

195 
	#IPV6_HDRINCL
 36

	)

198 
	#IPV6_RECVPKTINFO
 49

	)

199 
	#IPV6_PKTINFO
 50

	)

200 
	#IPV6_RECVHOPLIMIT
 51

	)

201 
	#IPV6_HOPLIMIT
 52

	)

202 
	#IPV6_RECVHOPOPTS
 53

	)

203 
	#IPV6_HOPOPTS
 54

	)

204 
	#IPV6_RTHDRDSTOPTS
 55

	)

205 
	#IPV6_RECVRTHDR
 56

	)

206 
	#IPV6_RTHDR
 57

	)

207 
	#IPV6_RECVDSTOPTS
 58

	)

208 
	#IPV6_DSTOPTS
 59

	)

209 
	#IPV6_RECVPATHMTU
 60

	)

210 
	#IPV6_PATHMTU
 61

	)

211 
	#IPV6_DONTFRAG
 62

	)

214 
	#IPV6_RECVTCLASS
 66

	)

215 
	#IPV6_TCLASS
 67

	)

218 #ià!
__USE_KERNEL_IPV6_DEFS


219 
	#IPV6_ADD_MEMBERSHIP
 
IPV6_JOIN_GROUP


	)

220 
	#IPV6_DROP_MEMBERSHIP
 
IPV6_LEAVE_GROUP


	)

222 
	#IPV6_RXHOPOPTS
 
IPV6_HOPOPTS


	)

223 
	#IPV6_RXDSTOPTS
 
IPV6_DSTOPTS


	)

226 
	#IPV6_PMTUDISC_DONT
 0

	)

227 
	#IPV6_PMTUDISC_WANT
 1

	)

228 
	#IPV6_PMTUDISC_DO
 2

	)

229 
	#IPV6_PMTUDISC_PROBE
 3

	)

230 
	#IPV6_PMTUDISC_INTERFACE
 4

	)

231 
	#IPV6_PMTUDISC_OMIT
 5

	)

234 
	#SOL_IPV6
 41

	)

235 
	#SOL_ICMPV6
 58

	)

238 
	#IPV6_RTHDR_LOOSE
 0

	)

239 
	#IPV6_RTHDR_STRICT
 1

	)

241 
	#IPV6_RTHDR_TYPE_0
 0

	)

	@/usr/include/bits/inf.h

19 #iâdeà
_MATH_H


25 #ià
__GNUC_PREREQ
(3,3)

26 
	#INFINITY
 (
	`__butš_šff
())

	)

28 
	#INFINITY
 
HUGE_VALF


	)

	@/usr/include/bits/ioctl-types.h

19 #iâdeà
_SYS_IOCTL_H


24 
	~<asm/ioùls.h
>

27 
	swšsize


29 
	mws_row
;

30 
	mws_cŞ
;

31 
	mws_xpix–
;

32 
	mws_ypix–
;

35 
	#NCC
 8

	)

36 
	s‹rmio


38 
	mc_iæag
;

39 
	mc_oæag
;

40 
	mc_cæag
;

41 
	mc_læag
;

42 
	mc_lše
;

43 
	mc_cc
[
NCC
];

47 
	#TIOCM_LE
 0x001

	)

48 
	#TIOCM_DTR
 0x002

	)

49 
	#TIOCM_RTS
 0x004

	)

50 
	#TIOCM_ST
 0x008

	)

51 
	#TIOCM_SR
 0x010

	)

52 
	#TIOCM_CTS
 0x020

	)

53 
	#TIOCM_CAR
 0x040

	)

54 
	#TIOCM_RNG
 0x080

	)

55 
	#TIOCM_DSR
 0x100

	)

56 
	#TIOCM_CD
 
TIOCM_CAR


	)

57 
	#TIOCM_RI
 
TIOCM_RNG


	)

62 
	#N_TTY
 0

	)

63 
	#N_SLIP
 1

	)

64 
	#N_MOUSE
 2

	)

65 
	#N_PPP
 3

	)

66 
	#N_STRIP
 4

	)

67 
	#N_AX25
 5

	)

68 
	#N_X25
 6

	)

69 
	#N_6PACK
 7

	)

70 
	#N_MASC
 8

	)

71 
	#N_R3964
 9

	)

72 
	#N_PROFIBUS_FDL
 10

	)

73 
	#N_IRDA
 11

	)

74 
	#N_SMSBLOCK
 12

	)

75 
	#N_HDLC
 13

	)

76 
	#N_SYNC_PPP
 14

	)

77 
	#N_HCI
 15

	)

	@/usr/include/bits/ioctls.h

18 #iâdeà
_SYS_IOCTL_H


23 
	~<asm/ioùls.h
>

26 
	#SIOCADDRT
 0x890B

	)

27 
	#SIOCDELRT
 0x890C

	)

28 
	#SIOCRTMSG
 0x890D

	)

31 
	#SIOCGIFNAME
 0x8910

	)

32 
	#SIOCSIFLINK
 0x8911

	)

33 
	#SIOCGIFCONF
 0x8912

	)

34 
	#SIOCGIFFLAGS
 0x8913

	)

35 
	#SIOCSIFFLAGS
 0x8914

	)

36 
	#SIOCGIFADDR
 0x8915

	)

37 
	#SIOCSIFADDR
 0x8916

	)

38 
	#SIOCGIFDSTADDR
 0x8917

	)

39 
	#SIOCSIFDSTADDR
 0x8918

	)

40 
	#SIOCGIFBRDADDR
 0x8919

	)

41 
	#SIOCSIFBRDADDR
 0x891¨

	)

42 
	#SIOCGIFNETMASK
 0x891b

	)

43 
	#SIOCSIFNETMASK
 0x891ø

	)

44 
	#SIOCGIFMETRIC
 0x891d

	)

45 
	#SIOCSIFMETRIC
 0x891

	)

46 
	#SIOCGIFMEM
 0x891à

	)

47 
	#SIOCSIFMEM
 0x8920

	)

48 
	#SIOCGIFMTU
 0x8921

	)

49 
	#SIOCSIFMTU
 0x8922

	)

50 
	#SIOCSIFNAME
 0x8923

	)

51 
	#SIOCSIFHWADDR
 0x8924

	)

52 
	#SIOCGIFENCAP
 0x8925

	)

53 
	#SIOCSIFENCAP
 0x8926

	)

54 
	#SIOCGIFHWADDR
 0x8927

	)

55 
	#SIOCGIFSLAVE
 0x8929

	)

56 
	#SIOCSIFSLAVE
 0x8930

	)

57 
	#SIOCADDMULTI
 0x8931

	)

58 
	#SIOCDELMULTI
 0x8932

	)

59 
	#SIOCGIFINDEX
 0x8933

	)

60 
	#SIOGIFINDEX
 
SIOCGIFINDEX


	)

61 
	#SIOCSIFPFLAGS
 0x8934

	)

62 
	#SIOCGIFPFLAGS
 0x8935

	)

63 
	#SIOCDIFADDR
 0x8936

	)

64 
	#SIOCSIFHWBROADCAST
 0x8937

	)

65 
	#SIOCGIFCOUNT
 0x8938

	)

67 
	#SIOCGIFBR
 0x8940

	)

68 
	#SIOCSIFBR
 0x8941

	)

70 
	#SIOCGIFTXQLEN
 0x8942

	)

71 
	#SIOCSIFTXQLEN
 0x8943

	)

76 
	#SIOCDARP
 0x8953

	)

77 
	#SIOCGARP
 0x8954

	)

78 
	#SIOCSARP
 0x8955

	)

81 
	#SIOCDRARP
 0x8960

	)

82 
	#SIOCGRARP
 0x8961

	)

83 
	#SIOCSRARP
 0x8962

	)

87 
	#SIOCGIFMAP
 0x8970

	)

88 
	#SIOCSIFMAP
 0x8971

	)

92 
	#SIOCADDDLCI
 0x8980

	)

93 
	#SIOCDELDLCI
 0x8981

	)

102 
	#SIOCDEVPRIVATE
 0x89F0

	)

108 
	#SIOCPROTOPRIVATE
 0x89E0

	)

	@/usr/include/bits/math-finite.h

19 #iâdeà
_MATH_H


24 
__REDIRECT_NTH
 (
acos
, (), 
__acos_fš™e
);

25 #ifdeà
__USE_ISOC99


26 
__REDIRECT_NTH
 (
acosf
, (), 
__acosf_fš™e
);

27 #ifdeà
__MATH_DECLARE_LDOUBLE


28 #ifdeà
__NO_LONG_DOUBLE_MATH


29 
__REDIRECT_NTH
 (
aco¦
, (), 
__acos_fš™e
);

31 
__REDIRECT_NTH
 (
aco¦
, (), 
__aco¦_fš™e
);

36 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


38 
__REDIRECT_NTH
 (
acosh
, (), 
__acosh_fš™e
);

40 #ifdeà
__USE_ISOC99


41 
__REDIRECT_NTH
 (
acoshf
, (), 
__acoshf_fš™e
);

42 #ifdeà
__MATH_DECLARE_LDOUBLE


43 #ifdeà
__NO_LONG_DOUBLE_MATH


44 
__REDIRECT_NTH
 (
acoshl
, (), 
__acosh_fš™e
);

46 
__REDIRECT_NTH
 (
acoshl
, (), 
__acoshl_fš™e
);

52 
__REDIRECT_NTH
 (
asš
, (), 
__asš_fš™e
);

53 #ifdeà
__USE_ISOC99


54 
__REDIRECT_NTH
 (
asšf
, (), 
__asšf_fš™e
);

55 #ifdeà
__MATH_DECLARE_LDOUBLE


56 #ifdeà
__NO_LONG_DOUBLE_MATH


57 
__REDIRECT_NTH
 (
asšl
, (), 
__asš_fš™e
);

59 
__REDIRECT_NTH
 (
asšl
, (), 
__asšl_fš™e
);

65 
__REDIRECT_NTH
 (
©ª2
, (, ), 
__©ª2_fš™e
);

66 #ifdeà
__USE_ISOC99


67 
__REDIRECT_NTH
 (
©ª2f
, (, ), 
__©ª2f_fš™e
);

68 #ifdeà
__MATH_DECLARE_LDOUBLE


69 #ifdeà
__NO_LONG_DOUBLE_MATH


70 
__REDIRECT_NTH
 (
©ª2l
, (, ),

71 
__©ª2_fš™e
);

73 
__REDIRECT_NTH
 (
©ª2l
, (, ),

74 
__©ª2l_fš™e
);

79 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


81 
__REDIRECT_NTH
 (
©ªh
, (), 
__©ªh_fš™e
);

83 #ifdeà
__USE_ISOC99


84 
__REDIRECT_NTH
 (
©ªhf
, (), 
__©ªhf_fš™e
);

85 #ifdeà
__MATH_DECLARE_LDOUBLE


86 #ifdeà
__NO_LONG_DOUBLE_MATH


87 
__REDIRECT_NTH
 (
©ªhl
, (), 
__©ªh_fš™e
);

89 
__REDIRECT_NTH
 (
©ªhl
, (), 
__©ªhl_fš™e
);

95 
__REDIRECT_NTH
 (
cosh
, (), 
__cosh_fš™e
);

96 #ifdeà
__USE_ISOC99


97 
__REDIRECT_NTH
 (
coshf
, (), 
__coshf_fš™e
);

98 #ifdeà
__MATH_DECLARE_LDOUBLE


99 #ifdeà
__NO_LONG_DOUBLE_MATH


100 
__REDIRECT_NTH
 (
coshl
, (), 
__cosh_fš™e
);

102 
__REDIRECT_NTH
 (
coshl
, (), 
__coshl_fš™e
);

108 
__REDIRECT_NTH
 (
exp
, (), 
__exp_fš™e
);

109 #ifdeà
__USE_ISOC99


110 
__REDIRECT_NTH
 (
expf
, (), 
__expf_fš™e
);

111 #ifdeà
__MATH_DECLARE_LDOUBLE


112 #ifdeà
__NO_LONG_DOUBLE_MATH


113 
__REDIRECT_NTH
 (
ex¶
, (), 
__exp_fš™e
);

115 
__REDIRECT_NTH
 (
ex¶
, (), 
__ex¶_fš™e
);

120 #ifdeà
__USE_GNU


122 
__REDIRECT_NTH
 (
exp10
, (), 
__exp10_fš™e
);

123 
__REDIRECT_NTH
 (
exp10f
, (), 
__exp10f_fš™e
);

124 #ifdeà
__MATH_DECLARE_LDOUBLE


125 #ifdeà
__NO_LONG_DOUBLE_MATH


126 
__REDIRECT_NTH
 (
exp10l
, (), 
__exp10_fš™e
);

128 
__REDIRECT_NTH
 (
exp10l
, (), 
__exp10l_fš™e
);

133 
__REDIRECT_NTH
 (
pow10
, (), 
__exp10_fš™e
);

134 
__REDIRECT_NTH
 (
pow10f
, (), 
__exp10f_fš™e
);

135 #ifdeà
__MATH_DECLARE_LDOUBLE


136 #ifdeà
__NO_LONG_DOUBLE_MATH


137 
__REDIRECT_NTH
 (
pow10l
, (), 
__exp10_fš™e
);

139 
__REDIRECT_NTH
 (
pow10l
, (), 
__exp10l_fš™e
);

144 #ifdeà
__USE_ISOC99


146 
__REDIRECT_NTH
 (
exp2
, (), 
__exp2_fš™e
);

147 
__REDIRECT_NTH
 (
exp2f
, (), 
__exp2f_fš™e
);

148 #ifdeà
__MATH_DECLARE_LDOUBLE


149 #ifdeà
__NO_LONG_DOUBLE_MATH


150 
__REDIRECT_NTH
 (
exp2l
, (), 
__exp2_fš™e
);

152 
__REDIRECT_NTH
 (
exp2l
, (), 
__exp2l_fš™e
);

158 
__REDIRECT_NTH
 (
fmod
, (, ), 
__fmod_fš™e
);

159 #ifdeà
__USE_ISOC99


160 
__REDIRECT_NTH
 (
fmodf
, (, ), 
__fmodf_fš™e
);

161 #ifdeà
__MATH_DECLARE_LDOUBLE


162 #ifdeà
__NO_LONG_DOUBLE_MATH


163 
__REDIRECT_NTH
 (
fmodl
, (, ),

164 
__fmod_fš™e
);

166 
__REDIRECT_NTH
 (
fmodl
, (, ),

167 
__fmodl_fš™e
);

172 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_ISOC99


174 
__REDIRECT_NTH
 (
hypÙ
, (, ), 
__hypÙ_fš™e
);

176 #ifdeà
__USE_ISOC99


177 
__REDIRECT_NTH
 (
hypÙf
, (, ), 
__hypÙf_fš™e
);

178 #ifdeà
__MATH_DECLARE_LDOUBLE


179 #ifdeà
__NO_LONG_DOUBLE_MATH


180 
__REDIRECT_NTH
 (
hypÙl
, (, ),

181 
__hypÙ_fš™e
);

183 
__REDIRECT_NTH
 (
hypÙl
, (, ),

184 
__hypÙl_fš™e
);

189 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


191 
__REDIRECT_NTH
 (
j0
, (), 
__j0_fš™e
);

193 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_ISOC99


194 
__REDIRECT_NTH
 (
j0f
, (), 
__j0f_fš™e
);

195 #ifdeà
__MATH_DECLARE_LDOUBLE


196 #ifdeà
__NO_LONG_DOUBLE_MATH


197 
__REDIRECT_NTH
 (
j0l
, (), 
__j0_fš™e
);

199 
__REDIRECT_NTH
 (
j0l
, (), 
__j0l_fš™e
);

204 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


206 
__REDIRECT_NTH
 (
y0
, (), 
__y0_fš™e
);

208 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_ISOC99


209 
__REDIRECT_NTH
 (
y0f
, (), 
__y0f_fš™e
);

210 #ifdeà
__MATH_DECLARE_LDOUBLE


211 #ifdeà
__NO_LONG_DOUBLE_MATH


212 
__REDIRECT_NTH
 (
y0l
, (), 
__y0_fš™e
);

214 
__REDIRECT_NTH
 (
y0l
, (), 
__y0l_fš™e
);

219 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


221 
__REDIRECT_NTH
 (
j1
, (), 
__j1_fš™e
);

223 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_ISOC99


224 
__REDIRECT_NTH
 (
j1f
, (), 
__j1f_fš™e
);

225 #ifdeà
__MATH_DECLARE_LDOUBLE


226 #ifdeà
__NO_LONG_DOUBLE_MATH


227 
__REDIRECT_NTH
 (
j1l
, (), 
__j1_fš™e
);

229 
__REDIRECT_NTH
 (
j1l
, (), 
__j1l_fš™e
);

234 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


236 
__REDIRECT_NTH
 (
y1
, (), 
__y1_fš™e
);

238 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_ISOC99


239 
__REDIRECT_NTH
 (
y1f
, (), 
__y1f_fš™e
);

240 #ifdeà
__MATH_DECLARE_LDOUBLE


241 #ifdeà
__NO_LONG_DOUBLE_MATH


242 
__REDIRECT_NTH
 (
y1l
, (), 
__y1_fš™e
);

244 
__REDIRECT_NTH
 (
y1l
, (), 
__y1l_fš™e
);

249 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


251 
__REDIRECT_NTH
 (
jn
, (, ), 
__jn_fš™e
);

253 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_ISOC99


254 
__REDIRECT_NTH
 (
jnf
, (, ), 
__jnf_fš™e
);

255 #ifdeà
__MATH_DECLARE_LDOUBLE


256 #ifdeà
__NO_LONG_DOUBLE_MATH


257 
__REDIRECT_NTH
 (
jÆ
, (, ), 
__jn_fš™e
);

259 
__REDIRECT_NTH
 (
jÆ
, (, ), 
__jÆ_fš™e
);

264 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


266 
__REDIRECT_NTH
 (
yn
, (, ), 
__yn_fš™e
);

268 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_ISOC99


269 
__REDIRECT_NTH
 (
ynf
, (, ), 
__ynf_fš™e
);

270 #ifdeà
__MATH_DECLARE_LDOUBLE


271 #ifdeà
__NO_LONG_DOUBLE_MATH


272 
__REDIRECT_NTH
 (
yÆ
, (, ), 
__yn_fš™e
);

274 
__REDIRECT_NTH
 (
yÆ
, (, ), 
__yÆ_fš™e
);

279 #ifdeà
__USE_MISC


281 
__REDIRECT_NTH
 (
lgamma_r
, (, *), 
__lgamma_r_fš™e
);

282 #ifdeà
__USE_ISOC99


283 
__REDIRECT_NTH
 (
lgammaf_r
, (, *), 
__lgammaf_r_fš™e
);

284 #ifdeà
__MATH_DECLARE_LDOUBLE


285 #ifdeà
__NO_LONG_DOUBLE_MATH


286 
__REDIRECT_NTH
 (
lgamm®_r
, (, *),

287 
__lgamma_r_fš™e
);

289 
__REDIRECT_NTH
 (
lgamm®_r
, (, *),

290 
__lgamm®_r_fš™e
);

296 
__lgamma_r_fš™e
 (, *);

297 
__lgammaf_r_fš™e
 (, *);

298 #ifdeà
__NO_LONG_DOUBLE_MATH


299 
__REDIRECT_NTH
 (
__lgamm®_r_fš™e
, (, *),

300 
__lgamma_r_fš™e
);

302 
__lgamm®_r_fš™e
 (, *);

305 #ià((
defšed
 
__USE_XOPEN
 || defšed 
__USE_ISOC99
) \

306 && 
defšed
 
	g__ex‹º_®ways_šlše
)

308 
__ex‹º_®ways_šlše
 
__NTH
 (
	$lgamma
 (
__d
))

310 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


311  
	`__lgamma_r_fš™e
 (
__d
, &
signgam
);

313 
__loÿl_signgam
 = 0;

314  
	`__lgamma_r_fš™e
 (
__d
, &
__loÿl_signgam
);

316 
	}
}

318 #ià
defšed
 
__USE_ISOC99
 && defšed 
__ex‹º_®ways_šlše


319 
__ex‹º_®ways_šlše
 
__NTH
 (
	$lgammaf
 (
__d
))

321 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


322  
	`__lgammaf_r_fš™e
 (
__d
, &
signgam
);

324 
__loÿl_signgam
 = 0;

325  
	`__lgammaf_r_fš™e
 (
__d
, &
__loÿl_signgam
);

327 
	}
}

328 #ifdeà
__MATH_DECLARE_LDOUBLE


329 
__ex‹º_®ways_šlše
 
__NTH
 (
	$lgamm®
 (
__d
))

331 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


332  
	`__lgamm®_r_fš™e
 (
__d
, &
signgam
);

334 
__loÿl_signgam
 = 0;

335  
	`__lgamm®_r_fš™e
 (
__d
, &
__loÿl_signgam
);

337 
	}
}

341 #ià((
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)) \

342 && 
defšed
 
	g__ex‹º_®ways_šlše
)

344 
__ex‹º_®ways_šlše
 
__NTH
 (
	$gamma
 (
__d
))

346  
	`__lgamma_r_fš™e
 (
__d
, &
signgam
);

347 
	}
}

348 #ifdeà
__USE_ISOC99


349 
__ex‹º_®ways_šlše
 
__NTH
 (
	$gammaf
 (
__d
))

351  
	`__lgammaf_r_fš™e
 (
__d
, &
signgam
);

352 
	}
}

353 #ifdeà
__MATH_DECLARE_LDOUBLE


354 
__ex‹º_®ways_šlše
 
__NTH
 (
	$gamm®
 (
__d
))

356  
	`__lgamm®_r_fš™e
 (
__d
, &
signgam
);

357 
	}
}

363 
__REDIRECT_NTH
 (
log
, (), 
__log_fš™e
);

364 #ifdeà
__USE_ISOC99


365 
__REDIRECT_NTH
 (
logf
, (), 
__logf_fš™e
);

366 #ifdeà
__MATH_DECLARE_LDOUBLE


367 #ifdeà
__NO_LONG_DOUBLE_MATH


368 
__REDIRECT_NTH
 (
logl
, (), 
__log_fš™e
);

370 
__REDIRECT_NTH
 (
logl
, (), 
__logl_fš™e
);

376 
__REDIRECT_NTH
 (
log10
, (), 
__log10_fš™e
);

377 #ifdeà
__USE_ISOC99


378 
__REDIRECT_NTH
 (
log10f
, (), 
__log10f_fš™e
);

379 #ifdeà
__MATH_DECLARE_LDOUBLE


380 #ifdeà
__NO_LONG_DOUBLE_MATH


381 
__REDIRECT_NTH
 (
log10l
, (), 
__log10_fš™e
);

383 
__REDIRECT_NTH
 (
log10l
, (), 
__log10l_fš™e
);

388 #ifdeà
__USE_ISOC99


390 
__REDIRECT_NTH
 (
log2
, (), 
__log2_fš™e
);

391 
__REDIRECT_NTH
 (
log2f
, (), 
__log2f_fš™e
);

392 #ifdeà
__MATH_DECLARE_LDOUBLE


393 #ifdeà
__NO_LONG_DOUBLE_MATH


394 
__REDIRECT_NTH
 (
log2l
, (), 
__log2_fš™e
);

396 
__REDIRECT_NTH
 (
log2l
, (), 
__log2l_fš™e
);

402 
__REDIRECT_NTH
 (
pow
, (, ), 
__pow_fš™e
);

403 #ifdeà
__USE_ISOC99


404 
__REDIRECT_NTH
 (
powf
, (, ), 
__powf_fš™e
);

405 #ifdeà
__MATH_DECLARE_LDOUBLE


406 #ifdeà
__NO_LONG_DOUBLE_MATH


407 
__REDIRECT_NTH
 (
powl
, (, ),

408 
__pow_fš™e
);

410 
__REDIRECT_NTH
 (
powl
, (, ),

411 
__powl_fš™e
);

416 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


418 
__REDIRECT_NTH
 (
»mašd”
, (, ), 
__»mašd”_fš™e
);

420 #ifdeà
__USE_ISOC99


421 
__REDIRECT_NTH
 (
»mašd”f
, (, ), 
__»mašd”f_fš™e
);

422 #ifdeà
__MATH_DECLARE_LDOUBLE


423 #ifdeà
__NO_LONG_DOUBLE_MATH


424 
__REDIRECT_NTH
 (
»mašd”l
, (, ),

425 
__»mašd”_fš™e
);

427 
__REDIRECT_NTH
 (
»mašd”l
, (, ),

428 
__»mašd”l_fš™e
);

433 #ià(
defšed
 
__USE_MISC
 \

434 || (
defšed
 
	g__USE_XOPEN_EXTENDED
 && !defšed 
	g__USE_XOPEN2K8
))

436 
__REDIRECT_NTH
 (
sÿlb
, (, ), 
__sÿlb_fš™e
);

438 #ià
defšed
 
__USE_MISC
 && defšed 
__USE_ISOC99


439 
__REDIRECT_NTH
 (
sÿlbf
, (, ), 
__sÿlbf_fš™e
);

440 #ifdeà
__MATH_DECLARE_LDOUBLE


441 #ifdeà
__NO_LONG_DOUBLE_MATH


442 
__REDIRECT_NTH
 (
sÿlbl
, (, ),

443 
__sÿlb_fš™e
);

445 
__REDIRECT_NTH
 (
sÿlbl
, (, ),

446 
__sÿlbl_fš™e
);

452 
__REDIRECT_NTH
 (
sšh
, (), 
__sšh_fš™e
);

453 #ifdeà
__USE_ISOC99


454 
__REDIRECT_NTH
 (
sšhf
, (), 
__sšhf_fš™e
);

455 #ifdeà
__MATH_DECLARE_LDOUBLE


456 #ifdeà
__NO_LONG_DOUBLE_MATH


457 
__REDIRECT_NTH
 (
sšhl
, (), 
__sšh_fš™e
);

459 
__REDIRECT_NTH
 (
sšhl
, (), 
__sšhl_fš™e
);

465 
__REDIRECT_NTH
 (
sq¹
, (), 
__sq¹_fš™e
);

466 #ifdeà
__USE_ISOC99


467 
__REDIRECT_NTH
 (
sq¹f
, (), 
__sq¹f_fš™e
);

468 #ifdeà
__MATH_DECLARE_LDOUBLE


469 #ifdeà
__NO_LONG_DOUBLE_MATH


470 
__REDIRECT_NTH
 (
sq¹l
, (), 
__sq¹_fš™e
);

472 
__REDIRECT_NTH
 (
sq¹l
, (), 
__sq¹l_fš™e
);

477 #ià
defšed
 
__USE_ISOC99
 && defšed 
__ex‹º_®ways_šlše


479 
__gamma_r_fš™e
 (, *);

480 
__ex‹º_®ways_šlše
 
__NTH
 (
	$tgamma
 (
__d
))

482 
__loÿl_signgam
 = 0;

483 
__»s
 = 
	`__gamma_r_fš™e
 (
__d
, &
__loÿl_signgam
);

484  
__loÿl_signgam
 < 0 ? -
__»s
 : __res;

485 
	}
}

486 
__gammaf_r_fš™e
 (, *);

487 
__ex‹º_®ways_šlše
 
__NTH
 (
	$tgammaf
 (
__d
))

489 
__loÿl_signgam
 = 0;

490 
__»s
 = 
	`__gammaf_r_fš™e
 (
__d
, &
__loÿl_signgam
);

491  
__loÿl_signgam
 < 0 ? -
__»s
 : __res;

492 
	}
}

493 #ifdeà
__MATH_DECLARE_LDOUBLE


494 
__gamm®_r_fš™e
 (, *);

495 
__ex‹º_®ways_šlše
 
__NTH
 (
	$tgamm®
 (
__d
))

497 
__loÿl_signgam
 = 0;

498 #ifdeà
__NO_LONG_DOUBLE_MATH


499 
__»s
 = 
	`__gamma_r_fš™e
 (
__d
, &
__loÿl_signgam
);

501 
__»s
 = 
	`__gamm®_r_fš™e
 (
__d
, &
__loÿl_signgam
);

503  
__loÿl_signgam
 < 0 ? -
__»s
 : __res;

504 
	}
}

	@/usr/include/bits/math-vector.h

19 #iâdeà
_MATH_H


25 
	~<b™s/libm-simd-deş-¡ubs.h
>

27 #ià
defšed
 
__x86_64__
 && defšed 
__FAST_MATH__


28 #ià
defšed
 
_OPENMP
 && _OPENMP >= 201307

30 
	#__DECL_SIMD_x86_64
 
	`_P¿gma
 ("om°deş¬simd‚Ùšb¿nch")

	)

31 #–ià
__GNUC_PREREQ
 (6,0)

33 
	#__DECL_SIMD_x86_64
 
	`__©Œibu‹__
 ((
	`__simd__
 ("nÙšb¿nch")))

	)

36 #ifdeà
__DECL_SIMD_x86_64


37 #undeà
__DECL_SIMD_cos


38 
	#__DECL_SIMD_cos
 
__DECL_SIMD_x86_64


	)

39 #undeà
__DECL_SIMD_cosf


40 
	#__DECL_SIMD_cosf
 
__DECL_SIMD_x86_64


	)

41 #undeà
__DECL_SIMD_sš


42 
	#__DECL_SIMD_sš
 
__DECL_SIMD_x86_64


	)

43 #undeà
__DECL_SIMD_sšf


44 
	#__DECL_SIMD_sšf
 
__DECL_SIMD_x86_64


	)

45 #undeà
__DECL_SIMD_sšcos


46 
	#__DECL_SIMD_sšcos
 
__DECL_SIMD_x86_64


	)

47 #undeà
__DECL_SIMD_sšcosf


48 
	#__DECL_SIMD_sšcosf
 
__DECL_SIMD_x86_64


	)

49 #undeà
__DECL_SIMD_log


50 
	#__DECL_SIMD_log
 
__DECL_SIMD_x86_64


	)

51 #undeà
__DECL_SIMD_logf


52 
	#__DECL_SIMD_logf
 
__DECL_SIMD_x86_64


	)

53 #undeà
__DECL_SIMD_exp


54 
	#__DECL_SIMD_exp
 
__DECL_SIMD_x86_64


	)

55 #undeà
__DECL_SIMD_expf


56 
	#__DECL_SIMD_expf
 
__DECL_SIMD_x86_64


	)

57 #undeà
__DECL_SIMD_pow


58 
	#__DECL_SIMD_pow
 
__DECL_SIMD_x86_64


	)

59 #undeà
__DECL_SIMD_powf


60 
	#__DECL_SIMD_powf
 
__DECL_SIMD_x86_64


	)

	@/usr/include/bits/mathcalls.h

45 #iâdeà
_MATH_H


52 
_MdoubË_BEGIN_NAMESPACE


54 
__MATHCALL
 (
acos
,, (
_MdoubË_
 
__x
));

56 
__MATHCALL
 (
asš
,, (
_MdoubË_
 
__x
));

58 
__MATHCALL
 (
©ª
,, (
_MdoubË_
 
__x
));

60 
__MATHCALL
 (
©ª2
,, (
_MdoubË_
 
__y
, _MdoubË_ 
__x
));

63 
__MATHCALL_VEC
 (
cos
,, (
_MdoubË_
 
__x
));

65 
__MATHCALL_VEC
 (
sš
,, (
_MdoubË_
 
__x
));

67 
__MATHCALL
 (
n
,, (
_MdoubË_
 
__x
));

72 
__MATHCALL
 (
cosh
,, (
_MdoubË_
 
__x
));

74 
__MATHCALL
 (
sšh
,, (
_MdoubË_
 
__x
));

76 
__MATHCALL
 (
nh
,, (
_MdoubË_
 
__x
));

77 
	g_MdoubË_END_NAMESPACE


79 #ifdeà
__USE_GNU


81 
__MATHDECL_VEC
 (,
sšcos
,,

82 (
_MdoubË_
 
__x
, _MdoubË_ *
__sšx
, _MdoubË_ *
__cosx
));

85 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


86 
__BEGIN_NAMESPACE_C99


88 
__MATHCALL
 (
acosh
,, (
_MdoubË_
 
__x
));

90 
__MATHCALL
 (
asšh
,, (
_MdoubË_
 
__x
));

92 
__MATHCALL
 (
©ªh
,, (
_MdoubË_
 
__x
));

93 
	g__END_NAMESPACE_C99


98 
_MdoubË_BEGIN_NAMESPACE


100 
__MATHCALL_VEC
 (
exp
,, (
_MdoubË_
 
__x
));

103 
__MATHCALL
 (
äexp
,, (
_MdoubË_
 
__x
, *
__expÚ’t
));

106 
__MATHCALL
 (
ldexp
,, (
_MdoubË_
 
__x
, 
__expÚ’t
));

109 
__MATHCALL_VEC
 (
log
,, (
_MdoubË_
 
__x
));

112 
__MATHCALL
 (
log10
,, (
_MdoubË_
 
__x
));

115 
__MATHCALL
 (
modf
,, (
_MdoubË_
 
__x
, _MdoubË_ *
__Œ
)è
__nÚnuÎ
 ((2));

116 
	g_MdoubË_END_NAMESPACE


118 #ifdeà
__USE_GNU


120 
__MATHCALL
 (
exp10
,, (
_MdoubË_
 
__x
));

122 
__MATHCALL
 (
pow10
,, (
_MdoubË_
 
__x
));

125 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


126 
__BEGIN_NAMESPACE_C99


128 
__MATHCALL
 (
expm1
,, (
_MdoubË_
 
__x
));

131 
__MATHCALL
 (
log1p
,, (
_MdoubË_
 
__x
));

134 
__MATHCALL
 (
logb
,, (
_MdoubË_
 
__x
));

135 
	g__END_NAMESPACE_C99


138 #ifdeà
__USE_ISOC99


139 
__BEGIN_NAMESPACE_C99


141 
__MATHCALL
 (
exp2
,, (
_MdoubË_
 
__x
));

144 
__MATHCALL
 (
log2
,, (
_MdoubË_
 
__x
));

145 
	g__END_NAMESPACE_C99


151 
_MdoubË_BEGIN_NAMESPACE


153 
__MATHCALL_VEC
 (
pow
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
));

156 
__MATHCALL
 (
sq¹
,, (
_MdoubË_
 
__x
));

157 
	g_MdoubË_END_NAMESPACE


159 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_ISOC99


160 
__BEGIN_NAMESPACE_C99


162 
__MATHCALL
 (
hypÙ
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
));

163 
	g__END_NAMESPACE_C99


166 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


167 
__BEGIN_NAMESPACE_C99


169 
__MATHCALL
 (
cb¹
,, (
_MdoubË_
 
__x
));

170 
	g__END_NAMESPACE_C99


176 
_MdoubË_BEGIN_NAMESPACE


178 
__MATHCALLX
 (
û
,, (
_MdoubË_
 
__x
), (
__cÚ¡__
));

181 
__MATHCALLX
 (
çbs
,, (
_MdoubË_
 
__x
), (
__cÚ¡__
));

184 
__MATHCALLX
 (
æoÜ
,, (
_MdoubË_
 
__x
), (
__cÚ¡__
));

187 
__MATHCALL
 (
fmod
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
));

192 
__MATHDECL_1
 (,
__isšf
,, (
_MdoubË_
 
__v®ue
)è
__©Œibu‹__
 ((
__cÚ¡__
));

195 
__MATHDECL_1
 (,
__fš™e
,, (
_MdoubË_
 
__v®ue
)è
__©Œibu‹__
 ((
__cÚ¡__
));

196 
	g_MdoubË_END_NAMESPACE


198 #ifdeà
__USE_MISC


199 #ià(!
defšed
 
__ılu¥lus
 \

200 || 
	g__ılu¥lus
 < 201103L \

201 || 
	g__MATH_DECLARING_DOUBLE
 == 0)

204 
__MATHDECL_1
 (,
isšf
,, (
_MdoubË_
 
__v®ue
)è
__©Œibu‹__
 ((
__cÚ¡__
));

208 
__MATHDECL_1
 (,
fš™e
,, (
_MdoubË_
 
__v®ue
)è
__©Œibu‹__
 ((
__cÚ¡__
));

211 
__MATHCALL
 (
d»m
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
));

215 
__MATHCALL
 (
signifiÿnd
,, (
_MdoubË_
 
__x
));

218 #ifdeà
__USE_ISOC99


219 
__BEGIN_NAMESPACE_C99


221 
__MATHCALLX
 (
cİysign
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
), (
__cÚ¡__
));

222 
	g__END_NAMESPACE_C99


225 #ifdeà
__USE_ISOC99


226 
__BEGIN_NAMESPACE_C99


228 
__MATHCALLX
 (
Çn
,, (cÚ¡ *
__gb
), (
__cÚ¡__
));

229 
	g__END_NAMESPACE_C99


234 
__MATHDECL_1
 (,
__i¢ª
,, (
_MdoubË_
 
__v®ue
)è
__©Œibu‹__
 ((
__cÚ¡__
));

236 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

237 #ià(!
defšed
 
__ılu¥lus
 \

238 || 
	g__ılu¥lus
 < 201103L \

239 || 
	g__MATH_DECLARING_DOUBLE
 == 0)

241 
__MATHDECL_1
 (,
i¢ª
,, (
_MdoubË_
 
__v®ue
)è
__©Œibu‹__
 ((
__cÚ¡__
));

245 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && 
__MATH_DECLARING_DOUBLE
)

247 
__MATHCALL
 (
j0
,, (
_MdoubË_
));

248 
__MATHCALL
 (
j1
,, (
_MdoubË_
));

249 
__MATHCALL
 (
jn
,, (, 
_MdoubË_
));

250 
__MATHCALL
 (
y0
,, (
_MdoubË_
));

251 
__MATHCALL
 (
y1
,, (
_MdoubË_
));

252 
__MATHCALL
 (
yn
,, (, 
_MdoubË_
));

256 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_ISOC99


257 
__BEGIN_NAMESPACE_C99


259 
__MATHCALL
 (
”f
,, (
_MdoubË_
));

260 
__MATHCALL
 (
”fc
,, (
_MdoubË_
));

261 
__MATHCALL
 (
lgamma
,, (
_MdoubË_
));

262 
	g__END_NAMESPACE_C99


265 #ifdeà
__USE_ISOC99


266 
__BEGIN_NAMESPACE_C99


268 
__MATHCALL
 (
tgamma
,, (
_MdoubË_
));

269 
	g__END_NAMESPACE_C99


272 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

274 
__MATHCALL
 (
gamma
,, (
_MdoubË_
));

277 #ifdeà
__USE_MISC


281 
__MATHCALL
 (
lgamma
,
_r
, (
_MdoubË_
, *
__signgamp
));

285 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


286 
__BEGIN_NAMESPACE_C99


289 
__MATHCALL
 (
ršt
,, (
_MdoubË_
 
__x
));

292 
__MATHCALLX
 (
Ãxá”
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
), (
__cÚ¡__
));

293 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__LDBL_COMPAT


294 
__MATHCALLX
 (
Ãx‰ow¬d
,, (
_MdoubË_
 
__x
, 
__y
), (
__cÚ¡__
));

297 #ifdeà
__USE_GNU


299 
__MATHCALL
 (
Ãxtdown
,, (
_MdoubË_
 
__x
));

301 
__MATHCALL
 (
Ãxtup
,, (
_MdoubË_
 
__x
));

305 
__MATHCALL
 (
»mašd”
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
));

307 #ifdeà
__USE_ISOC99


309 
__MATHCALL
 (
sÿlbn
,, (
_MdoubË_
 
__x
, 
__n
));

313 
__MATHDECL
 (,
ogb
,, (
_MdoubË_
 
__x
));

316 #ifdeà
__USE_ISOC99


318 
__MATHCALL
 (
sÿlbÊ
,, (
_MdoubË_
 
__x
, 
__n
));

322 
__MATHCALL
 (
Ã¬byšt
,, (
_MdoubË_
 
__x
));

326 
__MATHCALLX
 (
round
,, (
_MdoubË_
 
__x
), (
__cÚ¡__
));

330 
__MATHCALLX
 (
Œunc
,, (
_MdoubË_
 
__x
), (
__cÚ¡__
));

335 
__MATHCALL
 (
»mquo
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
, *
__quo
));

342 
__MATHDECL
 (,
Ìšt
,, (
_MdoubË_
 
__x
));

343 
__ex‹nsiÚ__


344 
__MATHDECL
 (,
Îršt
,, (
_MdoubË_
 
__x
));

348 
__MATHDECL
 (,
Ìound
,, (
_MdoubË_
 
__x
));

349 
__ex‹nsiÚ__


350 
__MATHDECL
 (,
Îround
,, (
_MdoubË_
 
__x
));

354 
__MATHCALL
 (
fdim
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
));

357 
__MATHCALLX
 (
fmax
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
), (
__cÚ¡__
));

360 
__MATHCALLX
 (
fmš
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
), (
__cÚ¡__
));

364 
__MATHDECL_1
 (, 
__åşassify
,, (
_MdoubË_
 
__v®ue
))

365 
__©Œibu‹__
 ((
__cÚ¡__
));

368 
__MATHDECL_1
 (, 
__signb™
,, (
_MdoubË_
 
__v®ue
))

369 
__©Œibu‹__
 ((
__cÚ¡__
));

373 
__MATHCALL
 (
fma
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__y
, _MdoubË_ 
__z
));

376 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


377 
	g__END_NAMESPACE_C99


380 #ifdeà
__USE_GNU


382 
__MATHDECL_1
 (, 
__issigÇlšg
,, (
_MdoubË_
 
__v®ue
))

383 
__©Œibu‹__
 ((
__cÚ¡__
));

386 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN_EXTENDED
 \

387 && 
	g__MATH_DECLARING_DOUBLE
 \

388 && !
defšed
 
	g__USE_XOPEN2K8
)

390 
__MATHCALL
 (
sÿlb
,, (
_MdoubË_
 
__x
, _MdoubË_ 
__n
));

	@/usr/include/bits/mathdef.h

18 #ià!
defšed
 
_MATH_H
 && !defšed 
_COMPLEX_H


22 #ià
defšed
 
__USE_ISOC99
 && defšed 
_MATH_H
 && !defšed 
_MATH_H_MATHDEF


23 
	#_MATH_H_MATHDEF
 1

	)

25 #ià
defšed
 
__x86_64__
 || (defšed 
__FLT_EVAL_METHOD__
 && __FLT_EVAL_METHOD__ == 0)

28 
	tæßt_t
;

29 
	tdoubË_t
;

35 
	tæßt_t
;

37 
	tdoubË_t
;

42 
	#FP_ILOGB0
 (-2147483647 - 1)

	)

43 
	#FP_ILOGBNAN
 (-2147483647 - 1)

	)

47 #ifdeà
__FP_FAST_FMA


48 
	#FP_FAST_FMA
 1

	)

51 #ifdeà
__FP_FAST_FMAF


52 
	#FP_FAST_FMAF
 1

	)

55 #ifdeà
__FP_FAST_FMAL


56 
	#FP_FAST_FMAL
 1

	)

	@/usr/include/bits/mathinline.h

19 #iâdeà
_MATH_H


23 #iâdeà
__ex‹º_®ways_šlše


24 
	#__MATH_INLINE
 
__šlše


	)

26 
	#__MATH_INLINE
 
__ex‹º_®ways_šlše


	)

30 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__
 && __GNUC__ >= 2

32 #ià!
__GNUC_PREREQ
 (2,97)

37 #undeà
isg»©”


38 #undeà
isg»©”equ®


39 #undeà
i¦ess


40 #undeà
i¦es£qu®


41 #undeà
i¦essg»©”


42 #undeà
isunÜd”ed


43 #ifdeà
__i686__


46 
	#isg»©”
(
x
, 
y
) \

47 ({ 
__»suÉ
; \

48 
	`__asm__
 ("fucomip %%st(1), %%st; seta %%al" \

49 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st"); \

50 
__»suÉ
; })

	)

51 
	#isg»©”equ®
(
x
, 
y
) \

52 ({ 
__»suÉ
; \

53 
	`__asm__
 ("fucomip %%st(1), %%st; setae %%al" \

54 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st"); \

55 
__»suÉ
; })

	)

57 
	#i¦ess
(
x
, 
y
) \

58 ({ 
__»suÉ
; \

59 
	`__asm__
 ("fucomip %%st(1), %%st; seta %%al" \

60 : "÷" (
__»suÉ
è: "u" (
x
), "t" (
y
) : "cc", "st"); \

61 
__»suÉ
; })

	)

63 
	#i¦es£qu®
(
x
, 
y
) \

64 ({ 
__»suÉ
; \

65 
	`__asm__
 ("fucomip %%st(1), %%st; setae %%al" \

66 : "÷" (
__»suÉ
è: "u" (
x
), "t" (
y
) : "cc", "st"); \

67 
__»suÉ
; })

	)

69 
	#i¦essg»©”
(
x
, 
y
) \

70 ({ 
__»suÉ
; \

71 
	`__asm__
 ("fucomip %%st(1), %%st; setne %%al" \

72 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st"); \

73 
__»suÉ
; })

	)

75 
	#isunÜd”ed
(
x
, 
y
) \

76 ({ 
__»suÉ
; \

77 
	`__asm__
 ("fucomip %%st(1), %%st; setp %%al" \

78 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st"); \

79 
__»suÉ
; })

	)

82 
	#isg»©”
(
x
, 
y
) \

83 ({ 
__»suÉ
; \

84 
	`__asm__
 ("fucompp; fnstsw;estb $0x45, %%ah; setz %%al" \

85 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st", "st(1)"); \

86 
__»suÉ
; })

	)

88 
	#isg»©”equ®
(
x
, 
y
) \

89 ({ 
__»suÉ
; \

90 
	`__asm__
 ("fucompp; fnstsw;estb $0x05, %%ah; setz %%al" \

91 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st", "st(1)"); \

92 
__»suÉ
; })

	)

94 
	#i¦ess
(
x
, 
y
) \

95 ({ 
__»suÉ
; \

96 
	`__asm__
 ("fucompp; fnstsw;estb $0x45, %%ah; setz %%al" \

97 : "÷" (
__»suÉ
è: "u" (
x
), "t" (
y
) : "cc", "st", "st(1)"); \

98 
__»suÉ
; })

	)

100 
	#i¦es£qu®
(
x
, 
y
) \

101 ({ 
__»suÉ
; \

102 
	`__asm__
 ("fucompp; fnstsw;estb $0x05, %%ah; setz %%al" \

103 : "÷" (
__»suÉ
è: "u" (
x
), "t" (
y
) : "cc", "st", "st(1)"); \

104 
__»suÉ
; })

	)

106 
	#i¦essg»©”
(
x
, 
y
) \

107 ({ 
__»suÉ
; \

108 
	`__asm__
 ("fucompp; fnstsw;estb $0x44, %%ah; setz %%al" \

109 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st", "st(1)"); \

110 
__»suÉ
; })

	)

112 
	#isunÜd”ed
(
x
, 
y
) \

113 ({ 
__»suÉ
; \

114 
	`__asm__
 ("fucompp; fnstsw; sahf; setp %%al" \

115 : "÷" (
__»suÉ
è: "u" (
y
), "t" (
x
) : "cc", "st", "st(1)"); \

116 
__»suÉ
; })

	)

122 #ià
__GNUC_PREREQ
 (2, 8)

123 
__BEGIN_NAMESPACE_C99


126 
__MATH_INLINE
 

127 
__NTH
 (
	$__signb™f
 (
__x
))

129 #ifdeà
__SSE2_MATH__


130 
__m
;

131 
	`__asm
 ("pmovmskb %1, %0" : "ô" (
__m
è: "x" (
__x
));

132  (
__m
 & 0x8) != 0;

134 
__ex‹nsiÚ__
 uniÚ { 
__f
; 
__i
; } 
__u
 = { __f: 
__x
 };

135  
__u
.
__i
 < 0;

137 
	}
}

138 
__MATH_INLINE
 

139 
__NTH
 (
	$__signb™
 (
__x
))

141 #ifdeà
__SSE2_MATH__


142 
__m
;

143 
	`__asm
 ("pmovmskb %1, %0" : "ô" (
__m
è: "x" (
__x
));

144  (
__m
 & 0x80) != 0;

146 
__ex‹nsiÚ__
 uniÚ { 
__d
; 
__i
[2]; } 
__u
 = { __d: 
__x
 };

147  
__u
.
__i
[1] < 0;

149 
	}
}

150 
__MATH_INLINE
 

151 
__NTH
 (
	$__signb™l
 (
__x
))

153 
__ex‹nsiÚ__
 uniÚ { 
__l
; 
__i
[3]; } 
__u
 = { __l: 
__x
 };

154  (
__u
.
__i
[2] & 0x8000) != 0;

155 
	}
}

157 
	g__END_NAMESPACE_C99


164 #ià
__GNUC_PREREQ
 (2, 8)

165 #ià!
__GNUC_PREREQ
 (3, 4è&& !
defšed
 
__NO_MATH_INLINES
 \

166 && 
defšed
 
	g__OPTIMIZE__


170 #ifdeà
__USE_ISOC99


171 
	g__BEGIN_NAMESPACE_C99


174 #ifdeà
__SSE_MATH__


175 
__MATH_INLINE
 

176 
__NTH
 (
	$Ìštf
 (
__x
))

178 
__»s
;

183 
__asm
 
	`__vŞ©e__
 ("cvtss2s˜%1, %0" : "ô" (
__»s
è: "xm" (
__x
));

184  
__»s
;

185 
	}
}

187 #ifdeà
__SSE2_MATH__


188 
__MATH_INLINE
 

189 
__NTH
 (
	$Ìšt
 (
__x
))

191 
__»s
;

196 
__asm
 
	`__vŞ©e__
 ("cvtsd2s˜%1, %0" : "ô" (
__»s
è: "xm" (
__x
));

197  
__»s
;

198 
	}
}

200 #ifdeà
__x86_64__


201 
__ex‹nsiÚ__


202 
__MATH_INLINE
 

203 
__NTH
 (
	$Îrštf
 (
__x
))

205 
__»s
;

210 
__asm
 
	`__vŞ©e__
 ("cvtss2s˜%1, %0" : "ô" (
__»s
è: "xm" (
__x
));

211  
__»s
;

212 
	}
}

213 
__ex‹nsiÚ__


214 
__MATH_INLINE
 

215 
__NTH
 (
	$Îršt
 (
__x
))

217 
__»s
;

222 
__asm
 
	`__vŞ©e__
 ("cvtsd2s˜%1, %0" : "ô" (
__»s
è: "xm" (
__x
));

223  
__»s
;

224 
	}
}

227 #ià
defšed
 
__FINITE_MATH_ONLY__
 && __FINITE_MATH_ONLY__ > 0 \

228 && 
defšed
 
__SSE2_MATH__


230 
__MATH_INLINE
 

231 
__NTH
 (
	$fmaxf
 (
__x
, 
__y
))

233 #ifdeà
__AVX__


234 
__»s
;

235 
	`__asm
 ("vmaxs %2, %1, %0" : "=x" (
__»s
è: "x" (
x
), "xm" (
__y
));

236  
__»s
;

238 
	`__asm
 ("maxs %1, %0" : "+x" (
__x
è: "xm" (
__y
));

239  
__x
;

241 
	}
}

242 
__MATH_INLINE
 

243 
__NTH
 (
	$fmax
 (
__x
, 
__y
))

245 #ifdeà
__AVX__


246 
__»s
;

247 
	`__asm
 ("vmaxsd %2, %1, %0" : "=x" (
__»s
è: "x" (
x
), "xm" (
__y
));

248  
__»s
;

250 
	`__asm
 ("maxsd %1, %0" : "+x" (
__x
è: "xm" (
__y
));

251  
__x
;

253 
	}
}

256 
__MATH_INLINE
 

257 
__NTH
 (
	$fmšf
 (
__x
, 
__y
))

259 #ifdeà
__AVX__


260 
__»s
;

261 
	`__asm
 ("vmšs %2, %1, %0" : "=x" (
__»s
è: "x" (
x
), "xm" (
__y
));

262  
__»s
;

264 
	`__asm
 ("mšs %1, %0" : "+x" (
__x
è: "xm" (
__y
));

265  
__x
;

267 
	}
}

268 
__MATH_INLINE
 

269 
__NTH
 (
	$fmš
 (
__x
, 
__y
))

271 #ifdeà
__AVX__


272 
__»s
;

273 
	`__asm
 ("vmšsd %2, %1, %0" : "=x" (
__»s
è: "x" (
x
), "xm" (
__y
));

274  
__»s
;

276 
	`__asm
 ("mšsd %1, %0" : "+x" (
__x
è: "xm" (
__y
));

277  
__x
;

279 
	}
}

282 
	g__END_NAMESPACE_C99


285 #ià
defšed
 
__SSE4_1__
 && defšed 
__SSE2_MATH__


286 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_ISOC99


287 
__BEGIN_NAMESPACE_C99


290 
__MATH_INLINE
 

291 
__NTH
 (
	$ršt
 (
__x
))

293 
__»s
;

298 
__asm
 
	`__vŞ©e__
 ("roundsd $4, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

299  
__»s
;

300 
	}
}

301 
__MATH_INLINE
 

302 
__NTH
 (
	$rštf
 (
__x
))

304 
__»s
;

309 
__asm
 
	`__vŞ©e__
 ("rounds $4, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

310  
__»s
;

311 
	}
}

313 #ifdeà
__USE_ISOC99


315 
__MATH_INLINE
 

316 
__NTH
 (
	$Ã¬byšt
 (
__x
))

318 
__»s
;

323 
__asm
 
	`__vŞ©e__
 ("roundsd $0xc, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

324  
__»s
;

325 
	}
}

326 
__MATH_INLINE
 

327 
__NTH
 (
	$Ã¬byštf
 (
__x
))

329 
__»s
;

334 
__asm
 
	`__vŞ©e__
 ("rounds $0xc, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

335  
__»s
;

336 
	}
}

339 
	g__END_NAMESPACE_C99


342 
__BEGIN_NAMESPACE_STD


344 
__MATH_INLINE
 

345 
__NTH
 (
	$û
 (
__x
))

347 
__»s
;

348 
	`__asm
 ("roundsd $2, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

349  
__»s
;

350 
	}
}

351 
__END_NAMESPACE_STD


353 
__BEGIN_NAMESPACE_C99


354 
__MATH_INLINE
 

355 
__NTH
 (
	$ûf
 (
__x
))

357 
__»s
;

358 
	`__asm
 ("rounds $2, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

359  
__»s
;

360 
	}
}

361 
__END_NAMESPACE_C99


363 
__BEGIN_NAMESPACE_STD


365 
__MATH_INLINE
 

366 
__NTH
 (
	$æoÜ
 (
__x
))

368 
__»s
;

369 
	`__asm
 ("roundsd $1, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

370  
__»s
;

371 
	}
}

372 
__END_NAMESPACE_STD


374 
__BEGIN_NAMESPACE_C99


375 
__MATH_INLINE
 

376 
__NTH
 (
	$æoÜf
 (
__x
))

378 
__»s
;

379 
	`__asm
 ("rounds $1, %1, %0" : "=x" (
__»s
è: "xm" (
__x
));

380  
__»s
;

381 
	}
}

382 
	g__END_NAMESPACE_C99


390 #ià!
defšed
 
__SSE2_MATH__
 && !defšed 
__x86_64__


391 #ià((!
defšed
 
__NO_MATH_INLINES
 || defšed 
__LIBC_INTERNAL_MATH_INLINES
) \

392 && 
defšed
 
	g__OPTIMIZE__
)

396 #undeà
m©h_”rhªdlšg


405 #ifdeà
__USE_ISOC99


406 
	#__šlše_m©hİ
(
func
, 
İ
) \

407 
	`__šlše_m©hİ_
 (, 
func
, 
İ
) \

408 
	`__šlše_m©hİ_
 (, 
	`__CONCAT
(
func
,
f
), 
İ
) \

409 
	`__šlše_m©hİ_
 (, 
	`__CONCAT
(
func
,
l
), 
İ
)

	)

410 
	#__šlše_m©hİNP
(
func
, 
İ
) \

411 
	`__šlše_m©hİNP_
 (, 
func
, 
İ
) \

412 
	`__šlše_m©hİNP_
 (, 
	`__CONCAT
(
func
,
f
), 
İ
) \

413 
	`__šlše_m©hİNP_
 (, 
	`__CONCAT
(
func
,
l
), 
İ
)

	)

415 
	#__šlše_m©hİ
(
func
, 
İ
) \

416 
	`__šlše_m©hİ_
 (, 
func
, 
İ
)

	)

417 
	#__šlše_m©hİNP
(
func
, 
İ
) \

418 
	`__šlše_m©hİNP_
 (, 
func
, 
İ
)

	)

421 
	#__šlše_m©hİ_
(
æßt_ty³
, 
func
, 
İ
) \

422 
	`__šlše_m©hİ_deş_
 (
æßt_ty³
, 
func
, 
İ
, "0" (
__x
))

	)

423 
	#__šlše_m©hİNP_
(
æßt_ty³
, 
func
, 
İ
) \

424 
	`__šlše_m©hİ_deşNP_
 (
æßt_ty³
, 
func
, 
İ
, "0" (
__x
))

	)

427 #ifdeà
__USE_ISOC99


428 
	#__šlše_m©hİ_deş
(
func
, 
İ
, 
·¿ms
...) \

429 
	`__šlše_m©hİ_deş_
 (, 
func
, 
İ
, 
·¿ms
) \

430 
	`__šlše_m©hİ_deş_
 (, 
	`__CONCAT
(
func
,
f
), 
İ
, 
·¿ms
) \

431 
	`__šlše_m©hİ_deş_
 (, 
	`__CONCAT
(
func
,
l
), 
İ
, 
·¿ms
)

	)

432 
	#__šlše_m©hİ_deşNP
(
func
, 
İ
, 
·¿ms
...) \

433 
	`__šlše_m©hİ_deşNP_
 (, 
func
, 
İ
, 
·¿ms
) \

434 
	`__šlše_m©hİ_deşNP_
 (, 
	`__CONCAT
(
func
,
f
), 
İ
, 
·¿ms
) \

435 
	`__šlše_m©hİ_deşNP_
 (, 
	`__CONCAT
(
func
,
l
), 
İ
, 
·¿ms
)

	)

437 
	#__šlše_m©hİ_deş
(
func
, 
İ
, 
·¿ms
...) \

438 
	`__šlše_m©hİ_deş_
 (, 
func
, 
İ
, 
·¿ms
)

	)

439 
	#__šlše_m©hİ_deşNP
(
func
, 
İ
, 
·¿ms
...) \

440 
	`__šlše_m©hİ_deşNP_
 (, 
func
, 
İ
, 
·¿ms
)

	)

443 
	#__šlše_m©hİ_deş_
(
æßt_ty³
, 
func
, 
İ
, 
·¿ms
...) \

444 
__MATH_INLINE
 
æßt_ty³
 
	`func
 (æßt_ty³è
__THROW
; \

445 
	`__šlše_m©hİ_deşNP_
 (
æßt_ty³
, 
func
, 
İ
, 
·¿ms
)

	)

447 
	#__šlše_m©hİ_deşNP_
(
æßt_ty³
, 
func
, 
İ
, 
·¿ms
...) \

448 
__MATH_INLINE
 
æßt_ty³
 
	`__NTH
 (
	`func
 (æßt_ty³ 
__x
)) \

450 
æßt_ty³
 
__»suÉ
; \

451 
__asm
 
	`__vŞ©e__
 (
İ
 : "ñ" (
__»suÉ
è: 
·¿ms
); \

452  
__»suÉ
; \

453 }

	)

456 #ifdeà
__USE_ISOC99


457 
	#__šlše_m©hcode
(
func
, 
¬g
, 
code
) \

458 
	`__šlše_m©hcode_
 (, 
func
, 
¬g
, 
code
) \

459 
	`__šlše_m©hcode_
 (, 
	`__CONCAT
(
func
,
f
), 
¬g
, 
code
) \

460 
	`__šlše_m©hcode_
 (, 
	`__CONCAT
(
func
,
l
), 
¬g
, 
code
)

	)

461 
	#__šlše_m©hcodeNP
(
func
, 
¬g
, 
code
) \

462 
	`__šlše_m©hcodeNP_
 (, 
func
, 
¬g
, 
code
) \

463 
	`__šlše_m©hcodeNP_
 (, 
	`__CONCAT
(
func
,
f
), 
¬g
, 
code
) \

464 
	`__šlše_m©hcodeNP_
 (, 
	`__CONCAT
(
func
,
l
), 
¬g
, 
code
)

	)

465 
	#__šlše_m©hcode2
(
func
, 
¬g1
, 
¬g2
, 
code
) \

466 
	`__šlše_m©hcode2_
 (, 
func
, 
¬g1
, 
¬g2
, 
code
) \

467 
	`__šlše_m©hcode2_
 (, 
	`__CONCAT
(
func
,
f
), 
¬g1
, 
¬g2
, 
code
) \

468 
	`__šlše_m©hcode2_
 (, 
	`__CONCAT
(
func
,
l
), 
¬g1
, 
¬g2
, 
code
)

	)

469 
	#__šlše_m©hcodeNP2
(
func
, 
¬g1
, 
¬g2
, 
code
) \

470 
	`__šlše_m©hcodeNP2_
 (, 
func
, 
¬g1
, 
¬g2
, 
code
) \

471 
	`__šlše_m©hcodeNP2_
 (, 
	`__CONCAT
(
func
,
f
), 
¬g1
, 
¬g2
, 
code
) \

472 
	`__šlše_m©hcodeNP2_
 (, 
	`__CONCAT
(
func
,
l
), 
¬g1
, 
¬g2
, 
code
)

	)

473 
	#__šlše_m©hcode3
(
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

474 
	`__šlše_m©hcode3_
 (, 
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

475 
	`__šlše_m©hcode3_
 (, 
	`__CONCAT
(
func
,
f
), 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

476 
	`__šlše_m©hcode3_
 (, 
	`__CONCAT
(
func
,
l
), 
¬g1
, 
¬g2
, 
¬g3
, 
code
)

	)

477 
	#__šlše_m©hcodeNP3
(
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

478 
	`__šlše_m©hcodeNP3_
 (, 
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

479 
	`__šlše_m©hcodeNP3_
 (, 
	`__CONCAT
(
func
,
f
), 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

480 
	`__šlše_m©hcodeNP3_
 (, 
	`__CONCAT
(
func
,
l
), 
¬g1
, 
¬g2
, 
¬g3
, 
code
)

	)

482 
	#__šlše_m©hcode
(
func
, 
¬g
, 
code
) \

483 
	`__šlše_m©hcode_
 (, 
func
, (
¬g
), 
code
)

	)

484 
	#__šlše_m©hcodeNP
(
func
, 
¬g
, 
code
) \

485 
	`__šlše_m©hcodeNP_
 (, 
func
, (
¬g
), 
code
)

	)

486 
	#__šlše_m©hcode2
(
func
, 
¬g1
, 
¬g2
, 
code
) \

487 
	`__šlše_m©hcode2_
 (, 
func
, 
¬g1
, 
¬g2
, 
code
)

	)

488 
	#__šlše_m©hcodeNP2
(
func
, 
¬g1
, 
¬g2
, 
code
) \

489 
	`__šlše_m©hcodeNP2_
 (, 
func
, 
¬g1
, 
¬g2
, 
code
)

	)

490 
	#__šlše_m©hcode3
(
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

491 
	`__šlše_m©hcode3_
 (, 
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
)

	)

492 
	#__šlše_m©hcodeNP3
(
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

493 
	`__šlše_m©hcodeNP3_
 (, 
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
)

	)

496 
	#__šlše_m©hcode_
(
æßt_ty³
, 
func
, 
¬g
, 
code
) \

497 
__MATH_INLINE
 
æßt_ty³
 
	`func
 (æßt_ty³è
__THROW
; \

498 
	`__šlše_m©hcodeNP_
(
æßt_ty³
, 
func
, 
¬g
, 
code
)

	)

500 
	#__šlše_m©hcodeNP_
(
æßt_ty³
, 
func
, 
¬g
, 
code
) \

501 
__MATH_INLINE
 
æßt_ty³
 
	`__NTH
 (
	`func
 (æßt_ty³ 
¬g
)) \

503 
code
; \

504 }

	)

507 
	#__šlše_m©hcode2_
(
æßt_ty³
, 
func
, 
¬g1
, 
¬g2
, 
code
) \

508 
__MATH_INLINE
 
æßt_ty³
 
	`func
 (æßt_ty³, flßt_ty³è
__THROW
; \

509 
	`__šlše_m©hcodeNP2_
 (
æßt_ty³
, 
func
, 
¬g1
, 
¬g2
, 
code
)

	)

511 
	#__šlše_m©hcodeNP2_
(
æßt_ty³
, 
func
, 
¬g1
, 
¬g2
, 
code
) \

512 
__MATH_INLINE
 
æßt_ty³
 
	`__NTH
 (
	`func
 (æßt_ty³ 
¬g1
, flßt_ty³ 
¬g2
)) \

514 
code
; \

515 }

	)

517 
	#__šlše_m©hcode3_
(
æßt_ty³
, 
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

518 
__MATH_INLINE
 
æßt_ty³
 
	`func
 (æßt_ty³, flßt_ty³, flßt_ty³è
__THROW
; \

519 
	`__šlše_m©hcodeNP3_
(
æßt_ty³
, 
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
)

	)

521 
	#__šlše_m©hcodeNP3_
(
æßt_ty³
, 
func
, 
¬g1
, 
¬g2
, 
¬g3
, 
code
) \

522 
__MATH_INLINE
 
æßt_ty³
 
	`__NTH
 (
	`func
 (æßt_ty³ 
¬g1
, flßt_ty³ 
¬g2
, \

523 
æßt_ty³
 
¬g3
)) \

525 
code
; \

526 }

	)

530 #ià!
defšed
 
__NO_MATH_INLINES
 && defšed 
__OPTIMIZE__


534 #ifdeà
__FAST_MATH__


535 #ifdeà
__USE_GNU


536 
	#__sšcos_code
 \

537 
__co¤
; \

538 
__sšr
; \

539 
__swtmp
; \

540 
__asm
 
__vŞ©e__
 \

555 : "ñ" (
__co¤
), "=u" (
__sšr
), "÷" (
__swtmp
è: "0" (
__x
)); \

556 *
__sšx
 = 
__sšr
; \

557 *
__cosx
 = 
__co¤


	)

559 
__MATH_INLINE
 

560 
__NTH
 (
	$__sšcos
 (
__x
, *
__sšx
, *
__cosx
))

562 
__sšcos_code
;

563 
	}
}

565 
__MATH_INLINE
 

566 
__NTH
 (
	$__sšcosf
 (
__x
, *
__sšx
, *
__cosx
))

568 
__sšcos_code
;

569 
	}
}

571 
__MATH_INLINE
 

572 
__NTH
 (
	$__sšco¦
 (
__x
, *
__sšx
, *
__cosx
))

574 
__sšcos_code
;

575 
	}
}

582 #ià
__GNUC_PREREQ
 (3, 5)

583 
	#__expm1_code
 \

584 
__‹mp
; \

585 
__‹mp
 = 
	`__butš_expm1l
 (
__x
); \

586  
__‹mp
 ? __‹m°: 
__x


	)

588 
	#__expm1_code
 \

589 
__v®ue
; \

590 
__expÚ’t
; \

591 
__‹mp
; \

592 
__asm
 
__vŞ©e__
 \

601 : "ñ" (
__v®ue
), "=u" (
__expÚ’t
è: "0" (
__x
)); \

602 
__asm
 
__vŞ©e__
 \

604 : "ñ" (
__‹mp
è: "0" (1.0), "u" (
__expÚ’t
)); \

605 
__‹mp
 -= 1.0; \

606 
__‹mp
 +ğ
__v®ue
; \

607  
__‹mp
 ? __‹m°: 
__x


	)

609 
	$__šlše_m©hcodeNP_
 (, 
__expm1l
, 
__x
, 
__expm1_code
)

611 #ià
	`__GNUC_PREREQ
 (3, 4)

612 
	`__šlše_m©hcodeNP_
 (, 
__ex¶
, 
__x
,  
	$__butš_ex¶
 (
__x
))

614 
	#__exp_code
 \

615 
__v®ue
; \

616 
__expÚ’t
; \

617 
__asm
 
__vŞ©e__
 \

625 : "ñ" (
__v®ue
), "=u" (
__expÚ’t
è: "0" (
__x
)); \

626 
__v®ue
 += 1.0; \

627 
__asm
 
__vŞ©e__
 \

629 : "ñ" (
__v®ue
è: "0" (__v®ue), "u" (
__expÚ’t
)); \

630  
__v®ue


	)

631 
	$__šlše_m©hcodeNP
 (
exp
, 
__x
, 
__exp_code
)

632 
	$__šlše_m©hcodeNP_
 (, 
__ex¶
, 
__x
, 
__exp_code
)

636 #ià!
	`__GNUC_PREREQ
 (3, 5)

637 
	`__šlše_m©hcodeNP
 (
n
, 
__x
, \

638 
__v®ue
; \

639 
__v®ue2
 
	`__©Œibu‹__
 ((
__unu£d__
)); \

640 
__asm
 
__vŞ©e__
 \

642 : "ñ" (
__v®ue2
), "=u" (
__v®ue
è: "0" (
__x
)); \

643  
__v®ue
)

648 #ià
	`__GNUC_PREREQ
 (3, 4)

649 
	`__šlše_m©hcodeNP2_
 (, 
__©ª2l
, 
__y
, 
__x
,

650  
	$__butš_©ª2l
 (
__y
, 
__x
))

652 
	#__©ª2_code
 \

653 
__v®ue
; \

654 
__asm
 
__vŞ©e__
 \

656 : "ñ" (
__v®ue
è: "0" (
__x
), "u" (
__y
) : "st(1)"); \

657  
__v®ue


	)

658 #ifdeà
__FAST_MATH__


659 
	$__šlše_m©hcodeNP2
 (
©ª2
, 
__y
, 
__x
, 
__©ª2_code
)

661 
	$__šlše_m©hcodeNP2_
 (, 
__©ª2l
, 
__y
, 
__x
, 
__©ª2_code
)

665 #ià
defšed
 
__FAST_MATH__
 && !
	`__GNUC_PREREQ
 (3, 5)

666 
	`__šlše_m©hcodeNP2
 (
fmod
, 
__x
, 
__y
, \

667 
__v®ue
; \

668 
__asm
 
__vŞ©e__
 \

673 : "ñ" (
__v®ue
è: "0" (
__x
), "u" (
__y
) : "ax", "cc"); \

674  
__v®ue
)

678 #ifdeà
__FAST_MATH__


679 #ià!
	`__GNUC_PREREQ
 (3,3)

680 
	`__šlše_m©hİNP
 (
sq¹
, "fsqrt")

681 
	`__šlše_m©hİNP_
 (, 
__sq¹l
, "fsqrt")

682 
	#__libc_sq¹l
(
n
è
	`__sq¹l
 (n)

	)

684 
	#__libc_sq¹l
(
n
è
	`__butš_sq¹l
 (n)

	)

688 #ià
	`__GNUC_PREREQ
 (2, 8)

689 
	`__šlše_m©hcodeNP_
 (, 
çbs
, 
__x
,  
	$__butš_çbs
 (
__x
))

690 #ifdeà
__USE_ISOC99


691 
	`__šlše_m©hcodeNP_
 (, 
çbsf
, 
__x
,  
	$__butš_çbsf
 (
__x
))

692 
	`__šlše_m©hcodeNP_
 (, 
çb¦
, 
__x
,  
	$__butš_çb¦
 (
__x
))

694 
	`__šlše_m©hcodeNP_
 (, 
__çb¦
, 
__x
,  
	$__butš_çb¦
 (
__x
))

696 
	`__šlše_m©hİ
 (
çbs
, "fabs")

697 
	`__šlše_m©hİ_
 (, 
__çb¦
, "fabs")

700 #ifdeà
__FAST_MATH__


701 #ià!
	`__GNUC_PREREQ
 (3, 4)

703 
	`__šlše_m©hİNP
 (
sš
, "fsin")

705 
	`__šlše_m©hİNP
 (
cos
, "fcos")

707 
	`__šlše_m©hİ_deşNP
 (
log
, "ædÊ2; fxch; fyl2x", "0" (
__x
) : "st(1)")

710 #ià!
	`__GNUC_PREREQ
 (3, 5)

711 
	`__šlše_m©hİ_deşNP
 (
log10
, "ædlg2; fxch; fyl2x", "0" (
__x
) : "st(1)")

713 
	`__šlše_m©hcodeNP
 (
asš
, 
__x
,  
	`__©ª2l
 (__x, 
	`__libc_sq¹l
 (1.0 - __x * __x)))

714 
	`__šlše_m©hcodeNP
 (
acos
, 
__x
,  
	`__©ª2l
 (
	`__libc_sq¹l
 (1.0 - __x * __x), __x))

717 #ià!
	`__GNUC_PREREQ
 (3, 4)

718 
	`__šlše_m©hİ_deşNP
 (
©ª
, "æd1; f·n", "0" (
__x
) : "st(1)")

722 
	`__šlše_m©hcode_
 (, 
__sgn1l
, 
__x
, \

723 
__ex‹nsiÚ__
 uniÚ { 
__xld
; 
__xi
[3]; } 
__n
 = \

724 { 
__xld
: 
__x
 
	}
}; \

725 
	g__n
.
	g__xi
[2] = (
__n
.
__xi
[2] & 0x8000) | 0x3fff; \

726 
	g__n
.
	g__xi
[1] = 0x80000000; \

727 
	g__n
.
	g__xi
[0] = 0; \

728  
	g__n
.
	g__xld
)

731 #ifdeà
__FAST_MATH__


733 
__šlše_m©hcodeNP
 (
sšh
, 
__x
, \

734 
__exm1
 = 
__expm1l
 (
__çb¦
 (
__x
)); \

735  0.5 * (
__exm1
 / (__exm1 + 1.0è+ __exm1è* 
	$__sgn1l
 (
__x
))

737 
	`__šlše_m©hcodeNP
 (
cosh
, 
__x
, \

738 
__ex
 = 
	`__ex¶
 (
__x
); \

739  0.5 * (
__ex
 + 1.0 / __ex))

741 
	`__šlše_m©hcodeNP
 (
nh
, 
__x
, \

742 
__exm1
 = 
	`__expm1l
 (-
	`__çb¦
 (
__x
 + __x)); \

743  
__exm1
 / (__exm1 + 2.0è* 
	`__sgn1l
 (-
__x
))

746 
	`__šlše_m©hcodeNP
 (
æoÜ
, 
__x
, \

747 
__v®ue
; \

748 
__ignÜe
; \

749 
__cw
; \

750 
__cwtmp
; \

751 
__asm
 
	`__vŞ©e
 ("fnstcw %3\n\t" \

759 : "ñ" (
__v®ue
), "=&q" (
__ignÜe
), "=m" (
__cwtmp
), \

760 "=m" (
__cw
) \

761 : "0" (
__x
)); \

762  
__v®ue
)

764 
	`__šlše_m©hcodeNP
 (
û
, 
__x
, \

765 
__v®ue
; \

766 
__ignÜe
; \

767 
__cw
; \

768 
__cwtmp
; \

769 
__asm
 
	`__vŞ©e
 ("fnstcw %3\n\t" \

777 : "ñ" (
__v®ue
), "=&q" (
__ignÜe
), "=m" (
__cwtmp
), \

778 "=m" (
__cw
) \

779 : "0" (
__x
)); \

780  
__v®ue
)

782 #ifdeà
__FAST_MATH__


783 
	#__ldexp_code
 \

784 
__v®ue
; \

785 
__asm
 
__vŞ©e__
 \

787 : "ñ" (
__v®ue
è: "0" (
__x
), "u" ((è
__y
)); \

788  
__v®ue


	)

790 
__MATH_INLINE
 

791 
	`__NTH
 (
	$ldexp
 (
__x
, 
__y
))

793 
__ldexp_code
;

794 
	}
}

799 #ifdeà
__USE_ISOC99


801 #ifdeà
__FAST_MATH__


802 
	$__šlše_m©hcodeNP
 (
expm1
, 
__x
, 
__expm1_code
)

806 
	#__M_SQRT2
 1.41421356237309504880L

	)

808 #ià!
	`__GNUC_PREREQ
 (3, 5)

809 
	`__šlše_m©hcodeNP
 (
log1p
, 
__x
, \

810 
__v®ue
; \

811 ià(
	`__çb¦
 (
__x
è>ğ1.0 - 0.5 * 
__M_SQRT2
) \

812 
__v®ue
 = 
	`logl
 (1.0 + 
__x
); \

814 
__asm
 
__vŞ©e__
 \

818 : "ñ" (
__v®ue
è: "0" (
__x
) : "st(1)"); \

819  
__v®ue
)

824 
	`__šlše_m©hcodeNP
 (
asšh
, 
__x
, \

825 
__y
 = 
	`__çb¦
 (
__x
); \

826  (
	`log1¶
 (
__y
 * __y / (
	`__libc_sq¹l
 (__y * __y + 1.0) + 1.0) + __y) \

827 * 
	$__sgn1l
 (
__x
)))

829 
	`__šlše_m©hcodeNP
 (
acosh
, 
__x
, \

830  
	`logl
 (
__x
 + 
	`__libc_sq¹l
 (__x - 1.0) * __libc_sqrtl (__x + 1.0)))

832 
	`__šlše_m©hcodeNP
 (
©ªh
, 
__x
, \

833 
__y
 = 
	`__çb¦
 (
__x
); \

834  -0.5 * 
	`log1¶
 (-(
__y
 + __yè/ (1.0 + __y)è* 
	$__sgn1l
 (
__x
))

837 
	`__šlše_m©hcodeNP2
 (
hypÙ
, 
__x
, 
__y
,

838  
	`__libc_sq¹l
 (
__x
 * __x + 
__y
 * __y))

840 #ià!
	`__GNUC_PREREQ
 (3, 5)

841 
	`__šlše_m©hcodeNP
(
logb
, 
__x
, \

842 
__v®ue
; \

843 
__junk
; \

844 
__asm
 
__vŞ©e__
 \

846 : "ñ" (
__junk
), "=u" (
__v®ue
è: "0" (
__x
)); \

847  
__v®ue
)

853 #ifdeà
__USE_ISOC99


854 #ifdeà
__FAST_MATH__


856 #ià!
	`__GNUC_PREREQ
 (3, 5)

857 
	`__šlše_m©hİ_deşNP
 (
log2
, "æd1; fxch; fyl2x", "0" (
__x
) : "st(1)")

860 
__MATH_INLINE
 

861 
	`__NTH
 (
	$ldexpf
 (
__x
, 
__y
))

863 
__ldexp_code
;

864 
	}
}

866 
__MATH_INLINE
 

867 
__NTH
 (
	$ldex¶
 (
__x
, 
__y
))

869 
__ldexp_code
;

870 
	}
}

872 
__šlše_m©hİNP
 (
ršt
, "frndint")

875 
	#__Ìšt_code
 \

876 
__ÌšŒes
; \

877 
__asm__
 
__vŞ©e__
 \

879 : "=m" (
__ÌšŒes
è: "t" (
__x
) : "st"); \

880  
__ÌšŒes


	)

881 
__MATH_INLINE
 

882 
__NTH
 (
	$Ìštf
 (
__x
))

884 
__Ìšt_code
;

885 
	}
}

886 
__MATH_INLINE
 

887 
__NTH
 (
	$Ìšt
 (
__x
))

889 
__Ìšt_code
;

890 
	}
}

891 
__MATH_INLINE
 

892 
__NTH
 (
	$Ìš
 (
__x
))

894 
__Ìšt_code
;

895 
	}
}

896 #undeà
__Ìšt_code


898 
	#__Îršt_code
 \

899 
__ÎršŒes
; \

900 
__asm__
 
__vŞ©e__
 \

902 : "=m" (
__ÎršŒes
è: "t" (
__x
) : "st"); \

903  
__ÎršŒes


	)

904 
__ex‹nsiÚ__


905 
__MATH_INLINE
 

906 
__NTH
 (
	$Îrštf
 (
__x
))

908 
__Îršt_code
;

909 
	}
}

910 
__ex‹nsiÚ__


911 
__MATH_INLINE
 

912 
__NTH
 (
	$Îršt
 (
__x
))

914 
__Îršt_code
;

915 
	}
}

916 
__ex‹nsiÚ__


917 
__MATH_INLINE
 

918 
__NTH
 (
	$Îrš
 (
__x
))

920 
__Îršt_code
;

921 
	}
}

922 #undeà
__Îršt_code


927 #ifdeà
__USE_MISC


929 #ià
defšed
 
__FAST_MATH__
 && !
__GNUC_PREREQ
 (3, 5)

930 
__šlše_m©hcodeNP2
 (
d»m
, 
__x
, 
__y
, \

931 
__v®ue
; \

932 
__şobb”ed
; \

933 
__asm
 
__vŞ©e__
 \

938 : "ñ" (
__v®ue
), "=&a" (
__şobb”ed
è: "0" (
__x
), "u" (
__y
) : "cc"); \

939  
__v®ue
)

944 
__MATH_INLINE
 

945 
__NTH
 (
	$__fš™e
 (
__x
))

947  (
__ex‹nsiÚ__


948 (((((uniÚ { 
__d
; 
__i
[2]; }è{__d: 
__x
}).__i[1]

950 
	}
}

955 #undeà
__©ª2_code


956 #ifdeà
__FAST_MATH__


957 #undeà
__expm1_code


958 #undeà
__exp_code


959 #undeà
__sšcos_code


966 #ifdeà
__LIBC_INTERNAL_MATH_INLINES


967 
__šlše_m©hİ
 (
__›“754_sq¹
, "fsqrt")

968 
__šlše_m©hcode2_
 (, 
__›“754_©ª2l
, 
__y
, 
__x
,

969 
__v®ue
;

970 
__asm
 
__vŞ©e__
 ("fpatan\n\t"

971 : "ñ" (
__v®ue
)

972 : "0" (
__x
), "u" (
__y
) : "st(1)");

973  
__v®ue
;)

	@/usr/include/bits/mman.h

19 #iâdeà
_SYS_MMAN_H


27 #ifdeà
__USE_MISC


28 
	#MAP_32BIT
 0x40

	)

32 #ifdeà
__USE_MISC


33 
	#MAP_GROWSDOWN
 0x00100

	)

34 
	#MAP_DENYWRITE
 0x00800

	)

35 
	#MAP_EXECUTABLE
 0x01000

	)

36 
	#MAP_LOCKED
 0x02000

	)

37 
	#MAP_NORESERVE
 0x04000

	)

38 
	#MAP_POPULATE
 0x08000

	)

39 
	#MAP_NONBLOCK
 0x10000

	)

40 
	#MAP_STACK
 0x20000

	)

41 
	#MAP_HUGETLB
 0x40000

	)

45 
	~<b™s/mmª-lšux.h
>

	@/usr/include/bits/nan.h

19 #iâdeà
_MATH_H


26 #ià
__GNUC_PREREQ
(3,3)

28 
	#NAN
 (
	`__butš_Çnf
 (""))

	)

30 #–ià
defšed
 
__GNUC__


32 
	#NAN
 \

33 (
__ex‹nsiÚ__
 \

34 ((uniÚ { 
__l
 
	`__©Œibu‹__
 ((
	`__mode__
 (
__SI__
))); 
__d
; }) \

35 { 
__l
: 0x7fc00000UL }).
__d
)

	)

39 
	~<’dŸn.h
>

41 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


42 
	#__qÇn_by‹s
 { 0x7f, 0xc0, 0, 0 }

	)

44 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


45 
	#__qÇn_by‹s
 { 0, 0, 0xc0, 0x7à}

	)

48 uniÚ { 
	m__c
[4]; 
	m__d
; } 
__qÇn_uniÚ


49 
__©Œibu‹__
 ((
__unu£d__
)èğ{ 
__qÇn_by‹s
 };

50 
	#NAN
 (
__qÇn_uniÚ
.
__d
)

	)

	@/usr/include/bits/netdb.h

18 #iâdeà
_NETDB_H


26 
	sÃ‹Á


28 *
	mn_Çme
;

29 **
	mn_®Ÿ£s
;

30 
	mn_add¹y³
;

31 
ušt32_t
 
	mn_Ãt
;

	@/usr/include/bits/param.h

19 #iâdeà
_SYS_PARAM_H


23 #iâdeà
ARG_MAX


24 
	#__undef_ARG_MAX


	)

27 
	~<lšux/lim™s.h
>

28 
	~<lšux/·¿m.h
>

31 #ifdeà
__undef_ARG_MAX


32 #undeà
ARG_MAX


33 #undeà
__undef_ARG_MAX


36 
	#MAXSYMLINKS
 20

	)

41 
	#NOFILE
 256

	)

42 
	#NCARGS
 131072

	)

	@/usr/include/bits/posix_opt.h

19 #iâdef 
_BITS_POSIX_OPT_H


20 
	#_BITS_POSIX_OPT_H
 1

	)

23 
	#_POSIX_JOB_CONTROL
 1

	)

26 
	#_POSIX_SAVED_IDS
 1

	)

29 
	#_POSIX_PRIORITY_SCHEDULING
 200809L

	)

32 
	#_POSIX_SYNCHRONIZED_IO
 200809L

	)

35 
	#_POSIX_FSYNC
 200809L

	)

38 
	#_POSIX_MAPPED_FILES
 200809L

	)

41 
	#_POSIX_MEMLOCK
 200809L

	)

44 
	#_POSIX_MEMLOCK_RANGE
 200809L

	)

47 
	#_POSIX_MEMORY_PROTECTION
 200809L

	)

50 
	#_POSIX_CHOWN_RESTRICTED
 0

	)

54 
	#_POSIX_VDISABLE
 '\0'

	)

57 
	#_POSIX_NO_TRUNC
 1

	)

60 
	#_XOPEN_REALTIME
 1

	)

63 
	#_XOPEN_REALTIME_THREADS
 1

	)

66 
	#_XOPEN_SHM
 1

	)

69 
	#_POSIX_THREADS
 200809L

	)

72 
	#_POSIX_REENTRANT_FUNCTIONS
 1

	)

73 
	#_POSIX_THREAD_SAFE_FUNCTIONS
 200809L

	)

76 
	#_POSIX_THREAD_PRIORITY_SCHEDULING
 200809L

	)

79 
	#_POSIX_THREAD_ATTR_STACKSIZE
 200809L

	)

82 
	#_POSIX_THREAD_ATTR_STACKADDR
 200809L

	)

85 
	#_POSIX_THREAD_PRIO_INHERIT
 200809L

	)

89 
	#_POSIX_THREAD_PRIO_PROTECT
 200809L

	)

91 #ifdeà
__USE_XOPEN2K8


93 
	#_POSIX_THREAD_ROBUST_PRIO_INHERIT
 200809L

	)

96 
	#_POSIX_THREAD_ROBUST_PRIO_PROTECT
 -1

	)

100 
	#_POSIX_SEMAPHORES
 200809L

	)

103 
	#_POSIX_REALTIME_SIGNALS
 200809L

	)

106 
	#_POSIX_ASYNCHRONOUS_IO
 200809L

	)

107 
	#_POSIX_ASYNC_IO
 1

	)

109 
	#_LFS_ASYNCHRONOUS_IO
 1

	)

111 
	#_POSIX_PRIORITIZED_IO
 200809L

	)

114 
	#_LFS64_ASYNCHRONOUS_IO
 1

	)

117 
	#_LFS_LARGEFILE
 1

	)

118 
	#_LFS64_LARGEFILE
 1

	)

119 
	#_LFS64_STDIO
 1

	)

122 
	#_POSIX_SHARED_MEMORY_OBJECTS
 200809L

	)

125 
	#_POSIX_CPUTIME
 0

	)

128 
	#_POSIX_THREAD_CPUTIME
 0

	)

131 
	#_POSIX_REGEXP
 1

	)

134 
	#_POSIX_READER_WRITER_LOCKS
 200809L

	)

137 
	#_POSIX_SHELL
 1

	)

140 
	#_POSIX_TIMEOUTS
 200809L

	)

143 
	#_POSIX_SPIN_LOCKS
 200809L

	)

146 
	#_POSIX_SPAWN
 200809L

	)

149 
	#_POSIX_TIMERS
 200809L

	)

152 
	#_POSIX_BARRIERS
 200809L

	)

155 
	#_POSIX_MESSAGE_PASSING
 200809L

	)

158 
	#_POSIX_THREAD_PROCESS_SHARED
 200809L

	)

161 
	#_POSIX_MONOTONIC_CLOCK
 0

	)

164 
	#_POSIX_CLOCK_SELECTION
 200809L

	)

167 
	#_POSIX_ADVISORY_INFO
 200809L

	)

170 
	#_POSIX_IPV6
 200809L

	)

173 
	#_POSIX_RAW_SOCKETS
 200809L

	)

176 
	#_POSIX2_CHAR_TERM
 200809L

	)

179 
	#_POSIX_SPORADIC_SERVER
 -1

	)

180 
	#_POSIX_THREAD_SPORADIC_SERVER
 -1

	)

183 
	#_POSIX_TRACE
 -1

	)

184 
	#_POSIX_TRACE_EVENT_FILTER
 -1

	)

185 
	#_POSIX_TRACE_INHERIT
 -1

	)

186 
	#_POSIX_TRACE_LOG
 -1

	)

189 
	#_POSIX_TYPED_MEMORY_OBJECTS
 -1

	)

	@/usr/include/bits/pthreadtypes.h

18 #iâdeà
_BITS_PTHREADTYPES_H


19 
	#_BITS_PTHREADTYPES_H
 1

	)

21 
	~<b™s/wÜdsize.h
>

23 #ifdeà
__x86_64__


24 #ià
__WORDSIZE
 == 64

25 
	#__SIZEOF_PTHREAD_ATTR_T
 56

	)

26 
	#__SIZEOF_PTHREAD_MUTEX_T
 40

	)

27 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

28 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

29 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

30 
	#__SIZEOF_PTHREAD_RWLOCK_T
 56

	)

31 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

32 
	#__SIZEOF_PTHREAD_BARRIER_T
 32

	)

33 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

35 
	#__SIZEOF_PTHREAD_ATTR_T
 32

	)

36 
	#__SIZEOF_PTHREAD_MUTEX_T
 32

	)

37 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

38 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

39 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

40 
	#__SIZEOF_PTHREAD_RWLOCK_T
 44

	)

41 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

42 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

43 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

46 
	#__SIZEOF_PTHREAD_ATTR_T
 36

	)

47 
	#__SIZEOF_PTHREAD_MUTEX_T
 24

	)

48 
	#__SIZEOF_PTHREAD_MUTEXATTR_T
 4

	)

49 
	#__SIZEOF_PTHREAD_COND_T
 48

	)

50 
	#__SIZEOF_PTHREAD_CONDATTR_T
 4

	)

51 
	#__SIZEOF_PTHREAD_RWLOCK_T
 32

	)

52 
	#__SIZEOF_PTHREAD_RWLOCKATTR_T
 8

	)

53 
	#__SIZEOF_PTHREAD_BARRIER_T
 20

	)

54 
	#__SIZEOF_PTHREAD_BARRIERATTR_T
 4

	)

60 
	t±h»ad_t
;

63 
	u±h»ad_©Œ_t


65 
	m__size
[
__SIZEOF_PTHREAD_ATTR_T
];

66 
	m__®ign
;

68 #iâdeà
__have_±h»ad_©Œ_t


69 
±h»ad_©Œ_t
 
	t±h»ad_©Œ_t
;

70 
	#__have_±h»ad_©Œ_t
 1

	)

74 #ifdeà
__x86_64__


75 
	s__±h»ad_š‹º®_li¡


77 
__±h»ad_š‹º®_li¡
 *
	m__´ev
;

78 
__±h»ad_š‹º®_li¡
 *
	m__Ãxt
;

79 } 
	t__±h»ad_li¡_t
;

81 
	s__±h»ad_š‹º®_¦i¡


83 
__±h»ad_š‹º®_¦i¡
 *
	m__Ãxt
;

84 } 
	t__±h»ad_¦i¡_t
;

92 
	s__±h»ad_mu‹x_s


94 
	m__lock
;

95 
	m__couÁ
;

96 
	m__owÃr
;

97 #ifdeà
__x86_64__


98 
	m__nu£rs
;

102 
	m__kšd
;

103 #ifdeà
__x86_64__


104 
	m__¥šs
;

105 
	m__–isiÚ
;

106 
__±h»ad_li¡_t
 
	m__li¡
;

107 
	#__PTHREAD_MUTEX_HAVE_PREV
 1

	)

109 
	#__PTHREAD_SPINS
 0, 0

	)

111 
	m__nu£rs
;

112 
__ex‹nsiÚ__
 union

116 
	m__e¥šs
;

117 
	m__–isiÚ
;

118 
	#__¥šs
 
__–isiÚ_d©a
.
__e¥šs


	)

119 
	#__–isiÚ
 
__–isiÚ_d©a
.
__–isiÚ


	)

120 
	#__PTHREAD_SPINS
 { 0, 0 }

	)

121 } 
	m__–isiÚ_d©a
;

122 
__±h»ad_¦i¡_t
 
	m__li¡
;

125 } 
	m__d©a
;

126 
	m__size
[
__SIZEOF_PTHREAD_MUTEX_T
];

127 
	m__®ign
;

128 } 
	t±h»ad_mu‹x_t
;

132 
	m__size
[
__SIZEOF_PTHREAD_MUTEXATTR_T
];

133 
	m__®ign
;

134 } 
	t±h»ad_mu‹x©Œ_t
;

143 
	m__lock
;

144 
	m__fu‹x
;

145 
__ex‹nsiÚ__
 
	m__tÙ®_£q
;

146 
__ex‹nsiÚ__
 
	m__wakeup_£q
;

147 
__ex‹nsiÚ__
 
	m__wok’_£q
;

148 *
	m__mu‹x
;

149 
	m__nwa™”s
;

150 
	m__brßdÿ¡_£q
;

151 } 
	m__d©a
;

152 
	m__size
[
__SIZEOF_PTHREAD_COND_T
];

153 
__ex‹nsiÚ__
 
	m__®ign
;

154 } 
	t±h»ad_cÚd_t
;

158 
	m__size
[
__SIZEOF_PTHREAD_CONDATTR_T
];

159 
	m__®ign
;

160 } 
	t±h»ad_cÚd©Œ_t
;

164 
	t±h»ad_key_t
;

168 
	t±h»ad_Úû_t
;

171 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


176 #ifdeà
__x86_64__


179 
	m__lock
;

180 
	m__Ä_»ad”s
;

181 
	m__»ad”s_wakeup
;

182 
	m__wr™”_wakeup
;

183 
	m__Ä_»ad”s_queued
;

184 
	m__Ä_wr™”s_queued
;

185 
	m__wr™”
;

186 
	m__sh¬ed
;

187 sigÃd 
	m__rw–isiÚ
;

188 #ifdeà 
__ILP32__


189 
	m__·d1
[3];

190 
	#__PTHREAD_RWLOCK_ELISION_EXTRA
 0, { 0, 0, 0 }

	)

192 
	m__·d1
[7];

193 
	#__PTHREAD_RWLOCK_ELISION_EXTRA
 0, { 0, 0, 0, 0, 0, 0, 0 }

	)

195 
	m__·d2
;

198 
	m__æags
;

199 
	#__PTHREAD_RWLOCK_INT_FLAGS_SHARED
 1

	)

200 } 
	m__d©a
;

204 
	m__lock
;

205 
	m__Ä_»ad”s
;

206 
	m__»ad”s_wakeup
;

207 
	m__wr™”_wakeup
;

208 
	m__Ä_»ad”s_queued
;

209 
	m__Ä_wr™”s_queued
;

212 
	m__æags
;

213 
	m__sh¬ed
;

214 sigÃd 
	m__rw–isiÚ
;

215 
	#__PTHREAD_RWLOCK_ELISION_EXTRA
 0

	)

216 
	m__·d2
;

217 
	m__wr™”
;

218 } 
	m__d©a
;

220 
	m__size
[
__SIZEOF_PTHREAD_RWLOCK_T
];

221 
	m__®ign
;

222 } 
	t±h»ad_rwlock_t
;

226 
	m__size
[
__SIZEOF_PTHREAD_RWLOCKATTR_T
];

227 
	m__®ign
;

228 } 
	t±h»ad_rwlock©Œ_t
;

232 #ifdeà
__USE_XOPEN2K


234 vŞ©
	t±h»ad_¥šlock_t
;

241 
	m__size
[
__SIZEOF_PTHREAD_BARRIER_T
];

242 
	m__®ign
;

243 } 
	t±h»ad_b¬r›r_t
;

247 
	m__size
[
__SIZEOF_PTHREAD_BARRIERATTR_T
];

248 
	m__®ign
;

249 } 
	t±h»ad_b¬r›¿‰r_t
;

253 #iâdeà
__x86_64__


255 
	#__ş—nup_fù_©Œibu‹
 
	`__©Œibu‹__
 ((
	`__»g·rm__
 (1)))

	)

	@/usr/include/bits/resource.h

19 #iâdeà
_SYS_RESOURCE_H


23 
	~<b™s/ty³s.h
>

31 
	e__¾im™_»sourû


34 
	mRLIMIT_CPU
 = 0,

35 
	#RLIMIT_CPU
 
RLIMIT_CPU


	)

38 
	mRLIMIT_FSIZE
 = 1,

39 
	#RLIMIT_FSIZE
 
RLIMIT_FSIZE


	)

42 
	mRLIMIT_DATA
 = 2,

43 
	#RLIMIT_DATA
 
RLIMIT_DATA


	)

46 
	mRLIMIT_STACK
 = 3,

47 
	#RLIMIT_STACK
 
RLIMIT_STACK


	)

50 
	mRLIMIT_CORE
 = 4,

51 
	#RLIMIT_CORE
 
RLIMIT_CORE


	)

57 
	m__RLIMIT_RSS
 = 5,

58 
	#RLIMIT_RSS
 
__RLIMIT_RSS


	)

61 
	mRLIMIT_NOFILE
 = 7,

62 
	m__RLIMIT_OFILE
 = 
RLIMIT_NOFILE
,

63 
	#RLIMIT_NOFILE
 
RLIMIT_NOFILE


	)

64 
	#RLIMIT_OFILE
 
__RLIMIT_OFILE


	)

67 
	mRLIMIT_AS
 = 9,

68 
	#RLIMIT_AS
 
RLIMIT_AS


	)

71 
	m__RLIMIT_NPROC
 = 6,

72 
	#RLIMIT_NPROC
 
__RLIMIT_NPROC


	)

75 
	m__RLIMIT_MEMLOCK
 = 8,

76 
	#RLIMIT_MEMLOCK
 
__RLIMIT_MEMLOCK


	)

79 
	m__RLIMIT_LOCKS
 = 10,

80 
	#RLIMIT_LOCKS
 
__RLIMIT_LOCKS


	)

83 
	m__RLIMIT_SIGPENDING
 = 11,

84 
	#RLIMIT_SIGPENDING
 
__RLIMIT_SIGPENDING


	)

87 
	m__RLIMIT_MSGQUEUE
 = 12,

88 
	#RLIMIT_MSGQUEUE
 
__RLIMIT_MSGQUEUE


	)

93 
	m__RLIMIT_NICE
 = 13,

94 
	#RLIMIT_NICE
 
__RLIMIT_NICE


	)

98 
	m__RLIMIT_RTPRIO
 = 14,

99 
	#RLIMIT_RTPRIO
 
__RLIMIT_RTPRIO


	)

104 
	m__RLIMIT_RTTIME
 = 15,

105 
	#RLIMIT_RTTIME
 
__RLIMIT_RTTIME


	)

107 
	m__RLIMIT_NLIMITS
 = 16,

108 
	m__RLIM_NLIMITS
 = 
__RLIMIT_NLIMITS


109 
	#RLIMIT_NLIMITS
 
__RLIMIT_NLIMITS


	)

110 
	#RLIM_NLIMITS
 
__RLIM_NLIMITS


	)

114 #iâdeà
__USE_FILE_OFFSET64


115 
	#RLIM_INFINITY
 ((
__¾im_t
è-1)

	)

117 
	#RLIM_INFINITY
 0xffffffffffffffffuLL

	)

120 #ifdeà
__USE_LARGEFILE64


121 
	#RLIM64_INFINITY
 0xffffffffffffffffuLL

	)

125 
	#RLIM_SAVED_MAX
 
RLIM_INFINITY


	)

126 
	#RLIM_SAVED_CUR
 
RLIM_INFINITY


	)

130 #iâdeà
__USE_FILE_OFFSET64


131 
__¾im_t
 
	t¾im_t
;

133 
__¾im64_t
 
	t¾im_t
;

135 #ifdeà
__USE_LARGEFILE64


136 
__¾im64_t
 
	t¾im64_t
;

139 
	s¾im™


142 
¾im_t
 
	m¾im_cur
;

144 
¾im_t
 
	m¾im_max
;

147 #ifdeà
__USE_LARGEFILE64


148 
	s¾im™64


151 
¾im64_t
 
	m¾im_cur
;

153 
¾im64_t
 
	m¾im_max
;

158 
	e__ru§ge_who


161 
	mRUSAGE_SELF
 = 0,

162 
	#RUSAGE_SELF
 
RUSAGE_SELF


	)

165 
	mRUSAGE_CHILDREN
 = -1

166 
	#RUSAGE_CHILDREN
 
RUSAGE_CHILDREN


	)

168 #ifdeà
__USE_GNU


171 
	mRUSAGE_THREAD
 = 1

172 
	#RUSAGE_THREAD
 
RUSAGE_THREAD


	)

174 
	#RUSAGE_LWP
 
RUSAGE_THREAD


	)

178 
	#__Ãed_timev®


	)

179 
	~<b™s/time.h
>

187 
	sru§ge


190 
timev®
 
	mru_utime
;

192 
timev®
 
	mru_¡ime
;

194 
__ex‹nsiÚ__
 union

196 
	mru_maxrss
;

197 
__sysÿÎ_¦Úg_t
 
	m__ru_maxrss_wÜd
;

202 
__ex‹nsiÚ__
 union

204 
	mru_ixrss
;

205 
__sysÿÎ_¦Úg_t
 
	m__ru_ixrss_wÜd
;

208 
__ex‹nsiÚ__
 union

210 
	mru_idrss
;

211 
__sysÿÎ_¦Úg_t
 
	m__ru_idrss_wÜd
;

214 
__ex‹nsiÚ__
 union

216 
	mru_i¤ss
;

217 
__sysÿÎ_¦Úg_t
 
	m__ru_i¤ss_wÜd
;

221 
__ex‹nsiÚ__
 union

223 
	mru_mšæt
;

224 
__sysÿÎ_¦Úg_t
 
	m__ru_mšæt_wÜd
;

227 
__ex‹nsiÚ__
 union

229 
	mru_majæt
;

230 
__sysÿÎ_¦Úg_t
 
	m__ru_majæt_wÜd
;

233 
__ex‹nsiÚ__
 union

235 
	mru_nsw­
;

236 
__sysÿÎ_¦Úg_t
 
	m__ru_nsw­_wÜd
;

240 
__ex‹nsiÚ__
 union

242 
	mru_šblock
;

243 
__sysÿÎ_¦Úg_t
 
	m__ru_šblock_wÜd
;

246 
__ex‹nsiÚ__
 union

248 
	mru_oublock
;

249 
__sysÿÎ_¦Úg_t
 
	m__ru_oublock_wÜd
;

252 
__ex‹nsiÚ__
 union

254 
	mru_msg¢d
;

255 
__sysÿÎ_¦Úg_t
 
	m__ru_msg¢d_wÜd
;

258 
__ex‹nsiÚ__
 union

260 
	mru_msgrcv
;

261 
__sysÿÎ_¦Úg_t
 
	m__ru_msgrcv_wÜd
;

264 
__ex‹nsiÚ__
 union

266 
	mru_nsigÇls
;

267 
__sysÿÎ_¦Úg_t
 
	m__ru_nsigÇls_wÜd
;

272 
__ex‹nsiÚ__
 union

274 
	mru_nvcsw
;

275 
__sysÿÎ_¦Úg_t
 
	m__ru_nvcsw_wÜd
;

279 
__ex‹nsiÚ__
 union

281 
	mru_nivcsw
;

282 
__sysÿÎ_¦Úg_t
 
	m__ru_nivcsw_wÜd
;

287 
	#PRIO_MIN
 -20

	)

288 
	#PRIO_MAX
 20

	)

292 
	e__´iÜ™y_which


294 
	mPRIO_PROCESS
 = 0,

295 
	#PRIO_PROCESS
 
PRIO_PROCESS


	)

296 
	mPRIO_PGRP
 = 1,

297 
	#PRIO_PGRP
 
PRIO_PGRP


	)

298 
	mPRIO_USER
 = 2

299 
	#PRIO_USER
 
PRIO_USER


	)

303 
	g__BEGIN_DECLS


305 #ifdeà
__USE_GNU


307 #iâdeà
__USE_FILE_OFFSET64


308 
	$´lim™
 (
__pid_t
 
__pid
, 
__¾im™_»sourû
 
__»sourû
,

309 cÚ¡ 
¾im™
 *
__Ãw_lim™
,

310 
¾im™
 *
__Şd_lim™
è
__THROW
;

312 #ifdeà
__REDIRECT_NTH


313 
	`__REDIRECT_NTH
 (
´lim™
, (
__pid_t
 
__pid
,

314 
__¾im™_»sourû
 
__»sourû
,

315 cÚ¡ 
¾im™
 *
__Ãw_lim™
,

316 
¾im™
 *
__Şd_lim™
), 
´lim™64
);

318 
	#´lim™
 
´lim™64


	)

321 #ifdeà
__USE_LARGEFILE64


322 
	$´lim™64
 (
__pid_t
 
__pid
, 
__¾im™_»sourû
 
__»sourû
,

323 cÚ¡ 
¾im™64
 *
__Ãw_lim™
,

324 
¾im™64
 *
__Şd_lim™
è
__THROW
;

328 
__END_DECLS


	@/usr/include/bits/select.h

18 #iâdeà
_SYS_SELECT_H


22 
	~<b™s/wÜdsize.h
>

25 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

27 #ià
__WORDSIZE
 == 64

28 
	#__FD_ZERO_STOS
 "¡osq"

	)

30 
	#__FD_ZERO_STOS
 "¡o¦"

	)

33 
	#__FD_ZERO
(
fd¥
) \

35 
__d0
, 
__d1
; \

36 
__asm__
 
	`__vŞ©e__
 ("şd;„•; " 
__FD_ZERO_STOS
 \

37 : "=c" (
__d0
), "=D" (
__d1
) \

38 : "a" (0), "0" ( (
fd_£t
) \

39 /  (
__fd_mask
)), \

40 "1" (&
	`__FDS_BITS
 (
fd¥
)[0]) \

42 } 0)

	)

48 
	#__FD_ZERO
(
£t
) \

50 
__i
; \

51 
fd_£t
 *
__¬r
 = (
£t
); \

52 
__i
 = 0; __˜<  (
fd_£t
è/  (
__fd_mask
); ++__i) \

53 
	`__FDS_BITS
 (
__¬r
)[
__i
] = 0; \

54 } 0)

	)

58 
	#__FD_SET
(
d
, 
£t
) \

59 ((è(
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] |ğ
	`__FD_MASK
 (d)))

	)

60 
	#__FD_CLR
(
d
, 
£t
) \

61 ((è(
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] &ğ~
	`__FD_MASK
 (d)))

	)

62 
	#__FD_ISSET
(
d
, 
£t
) \

63 ((
	`__FDS_BITS
 (
£t
)[
	`__FD_ELT
 (
d
)] & 
	`__FD_MASK
 (d)è!ğ0)

	)

	@/usr/include/bits/select2.h

19 #iâdeà
_SYS_SELECT_H


24 
__fd–t_chk
 (
__d
);

25 
	$__fd–t_w¬n
 (
__d
)

26 
	`__w¬Ç‰r
 ("bit outside of fd_set selected");

27 #undeà
__FD_ELT


28 
	#__FD_ELT
(
d
) \

29 
__ex‹nsiÚ__
 \

30 ({ 
__d
 = (
d
); \

31 (
	`__butš_cÚ¡ªt_p
 (
__d
) \

32 ? (0 <ğ
__d
 && __d < 
__FD_SETSIZE
 \

33 ? (
__d
 / 
__NFDBITS
) \

34 : 
	`__fd–t_w¬n
 (
__d
)) \

35 : 
	`__fd–t_chk
 (
__d
)); 
	}
})

	)

	@/usr/include/bits/setjmp.h

19 #iâdeà
_BITS_SETJMP_H


20 
	#_BITS_SETJMP_H
 1

	)

22 #ià!
defšed
 
_SETJMP_H
 && !defšed 
_PTHREAD_H


26 
	~<b™s/wÜdsize.h
>

28 #iâdeà
_ASM


30 #ià
__WORDSIZE
 == 64

31 
	t__jmp_buf
[8];

32 #–ià
defšed
 
__x86_64__


33 
__ex‹nsiÚ__
 
	t__jmp_buf
[8];

35 
	t__jmp_buf
[6];

	@/usr/include/bits/sigaction.h

19 #iâdeà
_SIGNAL_H


24 
	ssigaùiÚ


27 #ifdeà
__USE_POSIX199309


31 
__sighªdËr_t
 
	m§_hªdËr
;

33 (*
	m§_sigaùiÚ
è(, 
	msigšfo_t
 *, *);

35 
	m__sigaùiÚ_hªdËr
;

36 
	#§_hªdËr
 
__sigaùiÚ_hªdËr
.
§_hªdËr


	)

37 
	#§_sigaùiÚ
 
__sigaùiÚ_hªdËr
.
§_sigaùiÚ


	)

39 
__sighªdËr_t
 
	m§_hªdËr
;

43 
__sig£t_t
 
	m§_mask
;

46 
	m§_æags
;

49 (*
	m§_»¡Ü”
) ();

53 
	#SA_NOCLDSTOP
 1

	)

54 
	#SA_NOCLDWAIT
 2

	)

55 
	#SA_SIGINFO
 4

	)

57 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_MISC


58 
	#SA_ONSTACK
 0x08000000

	)

60 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


61 
	#SA_RESTART
 0x10000000

	)

62 
	#SA_NODEFER
 0x40000000

	)

64 
	#SA_RESETHAND
 0x80000000

	)

66 #ifdeà
__USE_MISC


67 
	#SA_INTERRUPT
 0x20000000

	)

70 
	#SA_NOMASK
 
SA_NODEFER


	)

71 
	#SA_ONESHOT
 
SA_RESETHAND


	)

72 
	#SA_STACK
 
SA_ONSTACK


	)

76 
	#SIG_BLOCK
 0

	)

77 
	#SIG_UNBLOCK
 1

	)

78 
	#SIG_SETMASK
 2

	)

	@/usr/include/bits/sigcontext.h

18 #iâdeà
_BITS_SIGCONTEXT_H


19 
	#_BITS_SIGCONTEXT_H
 1

	)

21 #ià!
defšed
 
_SIGNAL_H
 && !defšed 
_SYS_UCONTEXT_H


25 
	#FP_XSTATE_MAGIC1
 0x46505853U

	)

26 
	#FP_XSTATE_MAGIC2
 0x46505845U

	)

27 
	#FP_XSTATE_MAGIC2_SIZE
 (
FP_XSTATE_MAGIC2
)

	)

29 
	s_åx_sw_by‹s


31 
__ušt32_t
 
	mmagic1
;

32 
__ušt32_t
 
	mex‹nded_size
;

33 
__ušt64_t
 
	mx¡©e_bv
;

34 
__ušt32_t
 
	mx¡©e_size
;

35 
__ušt32_t
 
	m·ddšg
[7];

38 
	s_å»g


40 
	msignifiÿnd
[4];

41 
	mexpÚ’t
;

44 
	s_åx»g


46 
	msignifiÿnd
[4];

47 
	mexpÚ’t
;

48 
	m·ddšg
[3];

51 
	s_xmm»g


53 
__ušt32_t
 
	m–em’t
[4];

58 #iâdeà
__x86_64__


60 
	s_å¡©e


63 
__ušt32_t
 
	mcw
;

64 
__ušt32_t
 
	msw
;

65 
__ušt32_t
 
	mg
;

66 
__ušt32_t
 
	moff
;

67 
__ušt32_t
 
	mcs£l
;

68 
__ušt32_t
 
	md©aoff
;

69 
__ušt32_t
 
	md©a£l
;

70 
_å»g
 
	m_¡
[8];

71 
	m¡©us
;

72 
	mmagic
;

75 
__ušt32_t
 
	m_fx¤_’v
[6];

76 
__ušt32_t
 
	mmxc¤
;

77 
__ušt32_t
 
	m»£rved
;

78 
_åx»g
 
	m_fx¤_¡
[8];

79 
_xmm»g
 
	m_xmm
[8];

80 
__ušt32_t
 
	m·ddšg
[56];

83 #iâdeà
sigcÚ‹xt_¡ruù


88 
	#sigcÚ‹xt_¡ruù
 
sigcÚ‹xt


	)

91 
	#X86_FXSR_MAGIC
 0x0000

	)

93 
	ssigcÚ‹xt


95 
	mgs
, 
	m__gsh
;

96 
	mfs
, 
	m__fsh
;

97 
	mes
, 
	m__esh
;

98 
	mds
, 
	m__dsh
;

99 
	medi
;

100 
	mesi
;

101 
	mebp
;

102 
	me¥
;

103 
	mebx
;

104 
	medx
;

105 
	mecx
;

106 
	m—x
;

107 
	mŒ­no
;

108 
	m”r
;

109 
	me
;

110 
	mcs
, 
	m__csh
;

111 
	meæags
;

112 
	me¥_©_sigÇl
;

113 
	mss
, 
	m__ssh
;

114 
_å¡©e
 * 
	må¡©e
;

115 
	mŞdmask
;

116 
	mü2
;

121 
	s_å¡©e


124 
__ušt16_t
 
	mcwd
;

125 
__ušt16_t
 
	mswd
;

126 
__ušt16_t
 
	máw
;

127 
__ušt16_t
 
	mfİ
;

128 
__ušt64_t
 
	mr
;

129 
__ušt64_t
 
	mrdp
;

130 
__ušt32_t
 
	mmxc¤
;

131 
__ušt32_t
 
	mmxü_mask
;

132 
_åx»g
 
	m_¡
[8];

133 
_xmm»g
 
	m_xmm
[16];

134 
__ušt32_t
 
	m·ddšg
[24];

137 
	ssigcÚ‹xt


139 
__ušt64_t
 
	mr8
;

140 
__ušt64_t
 
	mr9
;

141 
__ušt64_t
 
	mr10
;

142 
__ušt64_t
 
	mr11
;

143 
__ušt64_t
 
	mr12
;

144 
__ušt64_t
 
	mr13
;

145 
__ušt64_t
 
	mr14
;

146 
__ušt64_t
 
	mr15
;

147 
__ušt64_t
 
	mrdi
;

148 
__ušt64_t
 
	mrsi
;

149 
__ušt64_t
 
	mrbp
;

150 
__ušt64_t
 
	mrbx
;

151 
__ušt64_t
 
	mrdx
;

152 
__ušt64_t
 
	m¿x
;

153 
__ušt64_t
 
	mrcx
;

154 
__ušt64_t
 
	mr¥
;

155 
__ušt64_t
 
	mr
;

156 
__ušt64_t
 
	meæags
;

157 
	mcs
;

158 
	mgs
;

159 
	mfs
;

160 
	m__·d0
;

161 
__ušt64_t
 
	m”r
;

162 
__ušt64_t
 
	mŒ­no
;

163 
__ušt64_t
 
	mŞdmask
;

164 
__ušt64_t
 
	mü2
;

165 
__ex‹nsiÚ__
 union

167 
_å¡©e
 * 
	må¡©e
;

168 
__ušt64_t
 
	m__å¡©e_wÜd
;

170 
__ušt64_t
 
	m__»£rved1
 [8];

175 
	s_x§ve_hdr


177 
__ušt64_t
 
	mx¡©e_bv
;

178 
__ušt64_t
 
	m»£rved1
[2];

179 
__ušt64_t
 
	m»£rved2
[5];

182 
	s_ymmh_¡©e


184 
__ušt32_t
 
	mymmh_¥aû
[64];

187 
	s_x¡©e


189 
_å¡©e
 
	må¡©e
;

190 
_x§ve_hdr
 
	mx¡©e_hdr
;

191 
_ymmh_¡©e
 
	mymmh
;

	@/usr/include/bits/siginfo.h

19 #ià!
defšed
 
_SIGNAL_H
 && !defšed 
__Ãed_sigšfo_t
 \

20 && !
defšed
 
	g__Ãed_sigev’t_t


24 
	~<b™s/wÜdsize.h
>

26 #ià(!
defšed
 
__have_sigv®_t
 \

27 && (
defšed
 
	g_SIGNAL_H
 || defšed 
	g__Ãed_sigšfo_t
 \

28 || 
defšed
 
	g__Ãed_sigev’t_t
))

29 
	#__have_sigv®_t
 1

	)

32 
	usigv®


34 
	msiv®_št
;

35 *
	msiv®_±r
;

36 } 
	tsigv®_t
;

39 #ià(!
defšed
 
__have_sigšfo_t
 \

40 && (
defšed
 
	g_SIGNAL_H
 || defšed 
	g__Ãed_sigšfo_t
))

41 
	#__have_sigšfo_t
 1

	)

43 
	#__SI_MAX_SIZE
 128

	)

44 #ià
__WORDSIZE
 == 64

45 
	#__SI_PAD_SIZE
 ((
__SI_MAX_SIZE
 /  ()è- 4)

	)

47 
	#__SI_PAD_SIZE
 ((
__SI_MAX_SIZE
 /  ()è- 3)

	)

50 #ià
defšed
 
__x86_64__
 && 
__WORDSIZE
 == 32

55 
__şock_t
 
	t__©Œibu‹__
 ((
	t__®igÃd__
 (4))è
	t__sigchld_şock_t
;

56 
	#__SI_ALIGNMENT
 
	`__©Œibu‹__
 ((
	`__®igÃd__
 (8)))

	)

58 
__şock_t
 
	t__sigchld_şock_t
;

59 
	#__SI_ALIGNMENT


	)

64 
si_signo
;

65 
si_”ºo
;

67 
si_code
;

71 
_·d
[
__SI_PAD_SIZE
];

76 
__pid_t
 
si_pid
;

77 
__uid_t
 
si_uid
;

78 } 
_kl
;

83 
si_tid
;

84 
si_ov”run
;

85 
sigv®_t
 
si_sigv®
;

86 } 
_tim”
;

91 
__pid_t
 
si_pid
;

92 
__uid_t
 
si_uid
;

93 
sigv®_t
 
si_sigv®
;

94 } 
_¹
;

99 
__pid_t
 
si_pid
;

100 
__uid_t
 
si_uid
;

101 
si_¡©us
;

102 
__sigchld_şock_t
 
si_utime
;

103 
__sigchld_şock_t
 
si_¡ime
;

104 } 
_sigchld
;

109 *
si_addr
;

110 
si_addr_lsb
;

113 *
_low”
;

114 *
_uµ”
;

115 } 
si_addr_bnd
;

116 } 
_sigçuÉ
;

121 
si_bªd
;

122 
si_fd
;

123 } 
_sigpŞl
;

128 *
_ÿÎ_addr
;

129 
_sysÿÎ
;

130 
_¬ch
;

131 } 
_sigsys
;

132 } 
_sif›lds
;

133 } 
	tsigšfo_t
 
	t__SI_ALIGNMENT
;

137 
	#si_pid
 
_sif›lds
.
_kl
.
si_pid


	)

138 
	#si_uid
 
_sif›lds
.
_kl
.
si_uid


	)

139 
	#si_tim”id
 
_sif›lds
.
_tim”
.
si_tid


	)

140 
	#si_ov”run
 
_sif›lds
.
_tim”
.
si_ov”run


	)

141 
	#si_¡©us
 
_sif›lds
.
_sigchld
.
si_¡©us


	)

142 
	#si_utime
 
_sif›lds
.
_sigchld
.
si_utime


	)

143 
	#si_¡ime
 
_sif›lds
.
_sigchld
.
si_¡ime


	)

144 
	#si_v®ue
 
_sif›lds
.
_¹
.
si_sigv®


	)

145 
	#si_št
 
_sif›lds
.
_¹
.
si_sigv®
.
siv®_št


	)

146 
	#si_±r
 
_sif›lds
.
_¹
.
si_sigv®
.
siv®_±r


	)

147 
	#si_addr
 
_sif›lds
.
_sigçuÉ
.
si_addr


	)

148 
	#si_addr_lsb
 
_sif›lds
.
_sigçuÉ
.
si_addr_lsb


	)

149 
	#si_low”
 
_sif›lds
.
_sigçuÉ
.
si_addr_bnd
.
_low”


	)

150 
	#si_uµ”
 
_sif›lds
.
_sigçuÉ
.
si_addr_bnd
.
_uµ”


	)

151 
	#si_bªd
 
_sif›lds
.
_sigpŞl
.
si_bªd


	)

152 
	#si_fd
 
_sif›lds
.
_sigpŞl
.
si_fd


	)

153 
	#si_ÿÎ_addr
 
_sif›lds
.
_sigsys
.
_ÿÎ_addr


	)

154 
	#si_sysÿÎ
 
_sif›lds
.
_sigsys
.
_sysÿÎ


	)

155 
	#si_¬ch
 
_sif›lds
.
_sigsys
.
_¬ch


	)

162 
SI_ASYNCNL
 = -60,

163 
	#SI_ASYNCNL
 
SI_ASYNCNL


	)

164 
SI_TKILL
 = -6,

165 
	#SI_TKILL
 
SI_TKILL


	)

166 
SI_SIGIO
,

167 
	#SI_SIGIO
 
SI_SIGIO


	)

168 
SI_ASYNCIO
,

169 
	#SI_ASYNCIO
 
SI_ASYNCIO


	)

170 
SI_MESGQ
,

171 
	#SI_MESGQ
 
SI_MESGQ


	)

172 
SI_TIMER
,

173 
	#SI_TIMER
 
SI_TIMER


	)

174 
SI_QUEUE
,

175 
	#SI_QUEUE
 
SI_QUEUE


	)

176 
SI_USER
,

177 
	#SI_USER
 
SI_USER


	)

178 
SI_KERNEL
 = 0x80

179 
	#SI_KERNEL
 
SI_KERNEL


	)

183 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


187 
ILL_ILLOPC
 = 1,

188 
	#ILL_ILLOPC
 
ILL_ILLOPC


	)

189 
ILL_ILLOPN
,

190 
	#ILL_ILLOPN
 
ILL_ILLOPN


	)

191 
ILL_ILLADR
,

192 
	#ILL_ILLADR
 
ILL_ILLADR


	)

193 
ILL_ILLTRP
,

194 
	#ILL_ILLTRP
 
ILL_ILLTRP


	)

195 
ILL_PRVOPC
,

196 
	#ILL_PRVOPC
 
ILL_PRVOPC


	)

197 
ILL_PRVREG
,

198 
	#ILL_PRVREG
 
ILL_PRVREG


	)

199 
ILL_COPROC
,

200 
	#ILL_COPROC
 
ILL_COPROC


	)

201 
ILL_BADSTK


202 
	#ILL_BADSTK
 
ILL_BADSTK


	)

208 
FPE_INTDIV
 = 1,

209 
	#FPE_INTDIV
 
FPE_INTDIV


	)

210 
FPE_INTOVF
,

211 
	#FPE_INTOVF
 
FPE_INTOVF


	)

212 
FPE_FLTDIV
,

213 
	#FPE_FLTDIV
 
FPE_FLTDIV


	)

214 
FPE_FLTOVF
,

215 
	#FPE_FLTOVF
 
FPE_FLTOVF


	)

216 
FPE_FLTUND
,

217 
	#FPE_FLTUND
 
FPE_FLTUND


	)

218 
FPE_FLTRES
,

219 
	#FPE_FLTRES
 
FPE_FLTRES


	)

220 
FPE_FLTINV
,

221 
	#FPE_FLTINV
 
FPE_FLTINV


	)

222 
FPE_FLTSUB


223 
	#FPE_FLTSUB
 
FPE_FLTSUB


	)

229 
SEGV_MAPERR
 = 1,

230 
	#SEGV_MAPERR
 
SEGV_MAPERR


	)

231 
SEGV_ACCERR


232 
	#SEGV_ACCERR
 
SEGV_ACCERR


	)

238 
BUS_ADRALN
 = 1,

239 
	#BUS_ADRALN
 
BUS_ADRALN


	)

240 
BUS_ADRERR
,

241 
	#BUS_ADRERR
 
BUS_ADRERR


	)

242 
BUS_OBJERR
,

243 
	#BUS_OBJERR
 
BUS_OBJERR


	)

244 
BUS_MCEERR_AR
,

245 
	#BUS_MCEERR_AR
 
BUS_MCEERR_AR


	)

246 
BUS_MCEERR_AO


247 
	#BUS_MCEERR_AO
 
BUS_MCEERR_AO


	)

251 #ifdeà
__USE_XOPEN_EXTENDED


255 
TRAP_BRKPT
 = 1,

256 
	#TRAP_BRKPT
 
TRAP_BRKPT


	)

257 
TRAP_TRACE


258 
	#TRAP_TRACE
 
TRAP_TRACE


	)

262 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


266 
CLD_EXITED
 = 1,

267 
	#CLD_EXITED
 
CLD_EXITED


	)

268 
CLD_KILLED
,

269 
	#CLD_KILLED
 
CLD_KILLED


	)

270 
CLD_DUMPED
,

271 
	#CLD_DUMPED
 
CLD_DUMPED


	)

272 
CLD_TRAPPED
,

273 
	#CLD_TRAPPED
 
CLD_TRAPPED


	)

274 
CLD_STOPPED
,

275 
	#CLD_STOPPED
 
CLD_STOPPED


	)

276 
CLD_CONTINUED


277 
	#CLD_CONTINUED
 
CLD_CONTINUED


	)

283 
POLL_IN
 = 1,

284 
	#POLL_IN
 
POLL_IN


	)

285 
POLL_OUT
,

286 
	#POLL_OUT
 
POLL_OUT


	)

287 
POLL_MSG
,

288 
	#POLL_MSG
 
POLL_MSG


	)

289 
POLL_ERR
,

290 
	#POLL_ERR
 
POLL_ERR


	)

291 
POLL_PRI
,

292 
	#POLL_PRI
 
POLL_PRI


	)

293 
POLL_HUP


294 
	#POLL_HUP
 
POLL_HUP


	)

298 #undeà
__Ãed_sigšfo_t


302 #ià(
defšed
 
_SIGNAL_H
 || defšed 
__Ãed_sigev’t_t
) \

303 && !
defšed
 
__have_sigev’t_t


304 
	#__have_sigev’t_t
 1

	)

307 
	#__SIGEV_MAX_SIZE
 64

	)

308 #ià
__WORDSIZE
 == 64

309 
	#__SIGEV_PAD_SIZE
 ((
__SIGEV_MAX_SIZE
 /  ()è- 4)

	)

311 
	#__SIGEV_PAD_SIZE
 ((
__SIGEV_MAX_SIZE
 /  ()è- 3)

	)

315 #iâdeà
__have_±h»ad_©Œ_t


316 
±h»ad_©Œ_t
 
	t±h»ad_©Œ_t
;

317 
	#__have_±h»ad_©Œ_t
 1

	)

320 
	ssigev’t


322 
sigv®_t
 
sigev_v®ue
;

323 
sigev_signo
;

324 
sigev_nÙify
;

328 
_·d
[
__SIGEV_PAD_SIZE
];

332 
__pid_t
 
_tid
;

336 (*
_funùiÚ
è(
sigv®_t
);

337 
±h»ad_©Œ_t
 *
_©Œibu‹
;

338 } 
_sigev_th»ad
;

339 } 
_sigev_un
;

340 } 
	tsigev’t_t
;

343 
	#sigev_nÙify_funùiÚ
 
_sigev_un
.
_sigev_th»ad
.
_funùiÚ


	)

344 
	#sigev_nÙify_©Œibu‹s
 
_sigev_un
.
_sigev_th»ad
.
_©Œibu‹


	)

349 
SIGEV_SIGNAL
 = 0,

350 
	#SIGEV_SIGNAL
 
SIGEV_SIGNAL


	)

351 
SIGEV_NONE
,

352 
	#SIGEV_NONE
 
SIGEV_NONE


	)

353 
SIGEV_THREAD
,

354 
	#SIGEV_THREAD
 
SIGEV_THREAD


	)

356 
SIGEV_THREAD_ID
 = 4

357 
	#SIGEV_THREAD_ID
 
SIGEV_THREAD_ID


	)

	@/usr/include/bits/signum.h

19 #ifdef 
_SIGNAL_H


22 
	#SIG_ERR
 ((
__sighªdËr_t
è-1è

	)

23 
	#SIG_DFL
 ((
__sighªdËr_t
è0è

	)

24 
	#SIG_IGN
 ((
__sighªdËr_t
è1è

	)

26 #ifdeà
__USE_UNIX98


27 
	#SIG_HOLD
 ((
__sighªdËr_t
è2è

	)

32 
	#SIGHUP
 1

	)

33 
	#SIGINT
 2

	)

34 
	#SIGQUIT
 3

	)

35 
	#SIGILL
 4

	)

36 
	#SIGTRAP
 5

	)

37 
	#SIGABRT
 6

	)

38 
	#SIGIOT
 6

	)

39 
	#SIGBUS
 7

	)

40 
	#SIGFPE
 8

	)

41 
	#SIGKILL
 9

	)

42 
	#SIGUSR1
 10

	)

43 
	#SIGSEGV
 11

	)

44 
	#SIGUSR2
 12

	)

45 
	#SIGPIPE
 13

	)

46 
	#SIGALRM
 14

	)

47 
	#SIGTERM
 15

	)

48 
	#SIGSTKFLT
 16

	)

49 
	#SIGCLD
 
SIGCHLD


	)

50 
	#SIGCHLD
 17

	)

51 
	#SIGCONT
 18

	)

52 
	#SIGSTOP
 19

	)

53 
	#SIGTSTP
 20

	)

54 
	#SIGTTIN
 21

	)

55 
	#SIGTTOU
 22

	)

56 
	#SIGURG
 23

	)

57 
	#SIGXCPU
 24

	)

58 
	#SIGXFSZ
 25

	)

59 
	#SIGVTALRM
 26

	)

60 
	#SIGPROF
 27

	)

61 
	#SIGWINCH
 28

	)

62 
	#SIGPOLL
 
SIGIO


	)

63 
	#SIGIO
 29

	)

64 
	#SIGPWR
 30

	)

65 
	#SIGSYS
 31

	)

66 
	#SIGUNUSED
 31

	)

68 
	#_NSIG
 65

	)

71 
	#SIGRTMIN
 (
	`__libc_cu¼’t_sig¹mš
 ())

	)

72 
	#SIGRTMAX
 (
	`__libc_cu¼’t_sig¹max
 ())

	)

76 
	#__SIGRTMIN
 32

	)

77 
	#__SIGRTMAX
 (
_NSIG
 - 1)

	)

	@/usr/include/bits/sigset.h

19 #iâdef 
_SIGSET_H_ty³s


20 
	#_SIGSET_H_ty³s
 1

	)

22 
	t__sig_©omic_t
;

26 
	#_SIGSET_NWORDS
 (1024 / (8 *  ()))

	)

29 
	m__v®
[
_SIGSET_NWORDS
];

30 } 
	t__sig£t_t
;

41 #ià!
defšed
 
_SIGSET_H_âs
 && defšed 
_SIGNAL_H


42 
	#_SIGSET_H_âs
 1

	)

44 #iâdeà
_EXTERN_INLINE


45 
	#_EXTERN_INLINE
 
__ex‹º_šlše


	)

49 
	#__sigmask
(
sig
) \

50 (((è1è<< (((
sig
è- 1è% (8 *  ())))

	)

53 
	#__sigwÜd
(
sig
è(((sigè- 1è/ (8 *  ()))

	)

55 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

56 
	#__sigem±y£t
(
£t
) \

57 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

58 
sig£t_t
 *
__£t
 = (
£t
); \

59 --
__út
 >ğ0è
__£t
->
__v®
[__cnt] = 0; \

60 0; }))

	)

61 
	#__sigfl£t
(
£t
) \

62 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

63 
sig£t_t
 *
__£t
 = (
£t
); \

64 --
__út
 >ğ0è
__£t
->
__v®
[__cnt] = ~0UL; \

65 0; }))

	)

67 #ifdeà
__USE_GNU


71 
	#__sigi£m±y£t
(
£t
) \

72 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

73 cÚ¡ 
sig£t_t
 *
__£t
 = (
£t
); \

74 
__»t
 = 
__£t
->
__v®
[--
__út
]; \

75 !
__»t
 && --
__út
 >= 0) \

76 
__»t
 = 
__£t
->
__v®
[
__út
]; \

77 
__»t
 =ğ0; }))

	)

78 
	#__sigªd£t
(
de¡
, 
Ëá
, 
right
) \

79 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

80 
sig£t_t
 *
__de¡
 = (
de¡
); \

81 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

82 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

83 --
__út
 >= 0) \

84 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

85 & 
__right
->
__v®
[
__út
]); \

86 0; }))

	)

87 
	#__sigÜ£t
(
de¡
, 
Ëá
, 
right
) \

88 (
	`__ex‹nsiÚ__
 ({ 
__út
 = 
_SIGSET_NWORDS
; \

89 
sig£t_t
 *
__de¡
 = (
de¡
); \

90 cÚ¡ 
sig£t_t
 *
__Ëá
 = (
Ëá
); \

91 cÚ¡ 
sig£t_t
 *
__right
 = (
right
); \

92 --
__út
 >= 0) \

93 
__de¡
->
__v®
[
__út
] = (
__Ëá
->__val[__cnt] \

94 | 
__right
->
__v®
[
__út
]); \

95 0; }))

	)

102 
__sigismemb”
 (cÚ¡ 
__sig£t_t
 *, );

103 
__sigadd£t
 (
__sig£t_t
 *, );

104 
__sigd–£t
 (
__sig£t_t
 *, );

106 #ifdeà
__USE_EXTERN_INLINES


107 
	#__SIGSETFN
(
NAME
, 
BODY
, 
CONST
) \

108 
_EXTERN_INLINE
 \

109 
	`NAME
 (
CONST
 
__sig£t_t
 *
__£t
, 
__sig
) \

111 
__mask
 = 
	`__sigmask
 (
__sig
); \

112 
__wÜd
 = 
	`__sigwÜd
 (
__sig
); \

113  
BODY
; \

114 }

	)

116 
__SIGSETFN
 (
__sigismemb”
, (
__£t
->
__v®
[
__wÜd
] & 
__mask
) ? 1 : 0, const)

117 
__SIGSETFN
 (
__sigadd£t
, ((
__£t
->
__v®
[
__wÜd
] |ğ
__mask
), 0), )

118 
__SIGSETFN
 (
__sigd–£t
, ((
__£t
->
__v®
[
__wÜd
] &ğ~
__mask
), 0), )

120 #undeà
__SIGSETFN


	@/usr/include/bits/sigstack.h

19 #iâdeà
_SIGNAL_H


25 
	ssig¡ack


27 *
	mss_¥
;

28 
	mss_Ú¡ack
;

35 
	mSS_ONSTACK
 = 1,

36 
	#SS_ONSTACK
 
SS_ONSTACK


	)

37 
	mSS_DISABLE


38 
	#SS_DISABLE
 
SS_DISABLE


	)

42 
	#MINSIGSTKSZ
 2048

	)

45 
	#SIGSTKSZ
 8192

	)

49 
	ssig®t¡ack


51 *
	mss_¥
;

52 
	mss_æags
;

53 
size_t
 
	mss_size
;

54 } 
	t¡ack_t
;

	@/usr/include/bits/sigthread.h

19 #iâdeà
_BITS_SIGTHREAD_H


20 
	#_BITS_SIGTHREAD_H
 1

	)

22 #ià!
defšed
 
_SIGNAL_H
 && !defšed 
_PTHREAD_H


30 
	$±h»ad_sigmask
 (
__how
,

31 cÚ¡ 
__sig£t_t
 *
__»¡riù
 
__Ãwmask
,

32 
__sig£t_t
 *
__»¡riù
 
__Şdmask
)
__THROW
;

35 
	$±h»ad_kl
 (
±h»ad_t
 
__th»adid
, 
__signo
è
__THROW
;

37 #ifdeà
__USE_GNU


39 
	$±h»ad_sigqueue
 (
±h»ad_t
 
__th»adid
, 
__signo
,

40 cÚ¡ 
sigv®
 
__v®ue
è
__THROW
;

	@/usr/include/bits/sockaddr.h

23 #iâdeà
_BITS_SOCKADDR_H


24 
	#_BITS_SOCKADDR_H
 1

	)

28 
	t§_çmy_t
;

34 
	#__SOCKADDR_COMMON
(
§_´efix
) \

35 
§_çmy_t
 
§_´efix
##
çmy


	)

37 
	#__SOCKADDR_COMMON_SIZE
 ( ())

	)

40 
	#_SS_SIZE
 128

	)

	@/usr/include/bits/socket.h

19 #iâdeà
__BITS_SOCKET_H


20 
	#__BITS_SOCKET_H


	)

22 #iâdeà
_SYS_SOCKET_H


26 
	#__Ãed_size_t


	)

27 
	~<¡ddef.h
>

29 
	~<sys/ty³s.h
>

32 #iâdeà
__sockËn_t_defšed


33 
__sockËn_t
 
	tsockËn_t
;

34 
	#__sockËn_t_defšed


	)

38 
	~<b™s/sock‘_ty³.h
>

41 
	#PF_UNSPEC
 0

	)

42 
	#PF_LOCAL
 1

	)

43 
	#PF_UNIX
 
PF_LOCAL


	)

44 
	#PF_FILE
 
PF_LOCAL


	)

45 
	#PF_INET
 2

	)

46 
	#PF_AX25
 3

	)

47 
	#PF_IPX
 4

	)

48 
	#PF_APPLETALK
 5

	)

49 
	#PF_NETROM
 6

	)

50 
	#PF_BRIDGE
 7

	)

51 
	#PF_ATMPVC
 8

	)

52 
	#PF_X25
 9

	)

53 
	#PF_INET6
 10

	)

54 
	#PF_ROSE
 11

	)

55 
	#PF_DECÃt
 12

	)

56 
	#PF_NETBEUI
 13

	)

57 
	#PF_SECURITY
 14

	)

58 
	#PF_KEY
 15

	)

59 
	#PF_NETLINK
 16

	)

60 
	#PF_ROUTE
 
PF_NETLINK


	)

61 
	#PF_PACKET
 17

	)

62 
	#PF_ASH
 18

	)

63 
	#PF_ECONET
 19

	)

64 
	#PF_ATMSVC
 20

	)

65 
	#PF_RDS
 21

	)

66 
	#PF_SNA
 22

	)

67 
	#PF_IRDA
 23

	)

68 
	#PF_PPPOX
 24

	)

69 
	#PF_WANPIPE
 25

	)

70 
	#PF_LLC
 26

	)

71 
	#PF_IB
 27

	)

72 
	#PF_MPLS
 28

	)

73 
	#PF_CAN
 29

	)

74 
	#PF_TIPC
 30

	)

75 
	#PF_BLUETOOTH
 31

	)

76 
	#PF_IUCV
 32

	)

77 
	#PF_RXRPC
 33

	)

78 
	#PF_ISDN
 34

	)

79 
	#PF_PHONET
 35

	)

80 
	#PF_IEEE802154
 36

	)

81 
	#PF_CAIF
 37

	)

82 
	#PF_ALG
 38

	)

83 
	#PF_NFC
 39

	)

84 
	#PF_VSOCK
 40

	)

85 
	#PF_KCM
 41

	)

86 
	#PF_MAX
 42

	)

89 
	#AF_UNSPEC
 
PF_UNSPEC


	)

90 
	#AF_LOCAL
 
PF_LOCAL


	)

91 
	#AF_UNIX
 
PF_UNIX


	)

92 
	#AF_FILE
 
PF_FILE


	)

93 
	#AF_INET
 
PF_INET


	)

94 
	#AF_AX25
 
PF_AX25


	)

95 
	#AF_IPX
 
PF_IPX


	)

96 
	#AF_APPLETALK
 
PF_APPLETALK


	)

97 
	#AF_NETROM
 
PF_NETROM


	)

98 
	#AF_BRIDGE
 
PF_BRIDGE


	)

99 
	#AF_ATMPVC
 
PF_ATMPVC


	)

100 
	#AF_X25
 
PF_X25


	)

101 
	#AF_INET6
 
PF_INET6


	)

102 
	#AF_ROSE
 
PF_ROSE


	)

103 
	#AF_DECÃt
 
PF_DECÃt


	)

104 
	#AF_NETBEUI
 
PF_NETBEUI


	)

105 
	#AF_SECURITY
 
PF_SECURITY


	)

106 
	#AF_KEY
 
PF_KEY


	)

107 
	#AF_NETLINK
 
PF_NETLINK


	)

108 
	#AF_ROUTE
 
PF_ROUTE


	)

109 
	#AF_PACKET
 
PF_PACKET


	)

110 
	#AF_ASH
 
PF_ASH


	)

111 
	#AF_ECONET
 
PF_ECONET


	)

112 
	#AF_ATMSVC
 
PF_ATMSVC


	)

113 
	#AF_RDS
 
PF_RDS


	)

114 
	#AF_SNA
 
PF_SNA


	)

115 
	#AF_IRDA
 
PF_IRDA


	)

116 
	#AF_PPPOX
 
PF_PPPOX


	)

117 
	#AF_WANPIPE
 
PF_WANPIPE


	)

118 
	#AF_LLC
 
PF_LLC


	)

119 
	#AF_IB
 
PF_IB


	)

120 
	#AF_MPLS
 
PF_MPLS


	)

121 
	#AF_CAN
 
PF_CAN


	)

122 
	#AF_TIPC
 
PF_TIPC


	)

123 
	#AF_BLUETOOTH
 
PF_BLUETOOTH


	)

124 
	#AF_IUCV
 
PF_IUCV


	)

125 
	#AF_RXRPC
 
PF_RXRPC


	)

126 
	#AF_ISDN
 
PF_ISDN


	)

127 
	#AF_PHONET
 
PF_PHONET


	)

128 
	#AF_IEEE802154
 
PF_IEEE802154


	)

129 
	#AF_CAIF
 
PF_CAIF


	)

130 
	#AF_ALG
 
PF_ALG


	)

131 
	#AF_NFC
 
PF_NFC


	)

132 
	#AF_VSOCK
 
PF_VSOCK


	)

133 
	#AF_KCM
 
PF_KCM


	)

134 
	#AF_MAX
 
PF_MAX


	)

140 
	#SOL_RAW
 255

	)

141 
	#SOL_DECNET
 261

	)

142 
	#SOL_X25
 262

	)

143 
	#SOL_PACKET
 263

	)

144 
	#SOL_ATM
 264

	)

145 
	#SOL_AAL
 265

	)

146 
	#SOL_IRDA
 266

	)

147 
	#SOL_NETBEUI
 267

	)

148 
	#SOL_LLC
 268

	)

149 
	#SOL_DCCP
 269

	)

150 
	#SOL_NETLINK
 270

	)

151 
	#SOL_TIPC
 271

	)

152 
	#SOL_RXRPC
 272

	)

153 
	#SOL_PPPOL2TP
 273

	)

154 
	#SOL_BLUETOOTH
 274

	)

155 
	#SOL_PNPIPE
 275

	)

156 
	#SOL_RDS
 276

	)

157 
	#SOL_IUCV
 277

	)

158 
	#SOL_CAIF
 278

	)

159 
	#SOL_ALG
 279

	)

160 
	#SOL_NFC
 280

	)

161 
	#SOL_KCM
 281

	)

164 
	#SOMAXCONN
 128

	)

167 
	~<b™s/sockaddr.h
>

170 
	ssockaddr


172 
__SOCKADDR_COMMON
 (
§_
);

173 
	m§_d©a
[14];

179 
	#__ss_®igÁy³
 

	)

180 
	#_SS_PADSIZE
 \

181 (
_SS_SIZE
 - 
__SOCKADDR_COMMON_SIZE
 -  (
__ss_®igÁy³
))

	)

183 
	ssockaddr_¡Üage


185 
__SOCKADDR_COMMON
 (
ss_
);

186 
	m__ss_·ddšg
[
_SS_PADSIZE
];

187 
__ss_®igÁy³
 
	m__ss_®ign
;

194 
	mMSG_OOB
 = 0x01,

195 
	#MSG_OOB
 
MSG_OOB


	)

196 
	mMSG_PEEK
 = 0x02,

197 
	#MSG_PEEK
 
MSG_PEEK


	)

198 
	mMSG_DONTROUTE
 = 0x04,

199 
	#MSG_DONTROUTE
 
MSG_DONTROUTE


	)

200 #ifdeà
__USE_GNU


202 
	mMSG_TRYHARD
 = 
MSG_DONTROUTE
,

203 
	#MSG_TRYHARD
 
MSG_DONTROUTE


	)

205 
	mMSG_CTRUNC
 = 0x08,

206 
	#MSG_CTRUNC
 
MSG_CTRUNC


	)

207 
	mMSG_PROXY
 = 0x10,

208 
	#MSG_PROXY
 
MSG_PROXY


	)

209 
	mMSG_TRUNC
 = 0x20,

210 
	#MSG_TRUNC
 
MSG_TRUNC


	)

211 
	mMSG_DONTWAIT
 = 0x40,

212 
	#MSG_DONTWAIT
 
MSG_DONTWAIT


	)

213 
	mMSG_EOR
 = 0x80,

214 
	#MSG_EOR
 
MSG_EOR


	)

215 
	mMSG_WAITALL
 = 0x100,

216 
	#MSG_WAITALL
 
MSG_WAITALL


	)

217 
	mMSG_FIN
 = 0x200,

218 
	#MSG_FIN
 
MSG_FIN


	)

219 
	mMSG_SYN
 = 0x400,

220 
	#MSG_SYN
 
MSG_SYN


	)

221 
	mMSG_CONFIRM
 = 0x800,

222 
	#MSG_CONFIRM
 
MSG_CONFIRM


	)

223 
	mMSG_RST
 = 0x1000,

224 
	#MSG_RST
 
MSG_RST


	)

225 
	mMSG_ERRQUEUE
 = 0x2000,

226 
	#MSG_ERRQUEUE
 
MSG_ERRQUEUE


	)

227 
	mMSG_NOSIGNAL
 = 0x4000,

228 
	#MSG_NOSIGNAL
 
MSG_NOSIGNAL


	)

229 
	mMSG_MORE
 = 0x8000,

230 
	#MSG_MORE
 
MSG_MORE


	)

231 
	mMSG_WAITFORONE
 = 0x10000,

232 
	#MSG_WAITFORONE
 
MSG_WAITFORONE


	)

233 
	mMSG_BATCH
 = 0x40000,

234 
	#MSG_BATCH
 
MSG_BATCH


	)

235 
	mMSG_FASTOPEN
 = 0x20000000,

236 
	#MSG_FASTOPEN
 
MSG_FASTOPEN


	)

238 
	mMSG_CMSG_CLOEXEC
 = 0x40000000

241 
	#MSG_CMSG_CLOEXEC
 
MSG_CMSG_CLOEXEC


	)

247 
	smsghdr


249 *
	mmsg_Çme
;

250 
sockËn_t
 
	mmsg_Çm–’
;

252 
iovec
 *
	mmsg_iov
;

253 
size_t
 
	mmsg_iovËn
;

255 *
	mmsg_cÚŒŞ
;

256 
size_t
 
	mmsg_cÚŒŞËn
;

261 
	mmsg_æags
;

265 
	scmsghdr


267 
size_t
 
	mcmsg_Ën
;

272 
	mcmsg_Ëv–
;

273 
	mcmsg_ty³
;

274 #ià(!
defšed
 
__STRICT_ANSI__
 && 
__GNUC__
 >ğ2è|| 
__STDC_VERSION__
 >= 199901L

275 
__ex‹nsiÚ__
 
__cmsg_d©a
 
	m__æex¬r
;

280 #ià(!
defšed
 
__STRICT_ANSI__
 && 
__GNUC__
 >ğ2è|| 
__STDC_VERSION__
 >= 199901L

281 
	#CMSG_DATA
(
cmsg
è((cmsg)->
__cmsg_d©a
)

	)

283 
	#CMSG_DATA
(
cmsg
è((*è((
cmsghdr
 *è(cmsgè+ 1))

	)

285 
	#CMSG_NXTHDR
(
mhdr
, 
cmsg
è
	`__cmsg_nxthdr
 (mhdr, cmsg)

	)

286 
	#CMSG_FIRSTHDR
(
mhdr
) \

287 ((
size_t
è(
mhdr
)->
msg_cÚŒŞËn
 >ğ (
cmsghdr
) \

288 ? (
cmsghdr
 *è(
mhdr
)->
msg_cÚŒŞ
 : (cmsghd¸*è0)

	)

289 
	#CMSG_ALIGN
(
Ën
è((Ö’è+  (
size_t
) - 1) \

290 & (
size_t
è~( (size_tè- 1))

	)

291 
	#CMSG_SPACE
(
Ën
è(
	`CMSG_ALIGN
 (len) \

292 + 
	`CMSG_ALIGN
 ( (
cmsghdr
)))

	)

293 
	#CMSG_LEN
(
Ën
è(
	`CMSG_ALIGN
 ( (
cmsghdr
)è+ (Ën))

	)

295 
cmsghdr
 *
	$__cmsg_nxthdr
 (
msghdr
 *
__mhdr
,

296 
cmsghdr
 *
__cmsg
è
__THROW
;

297 #ifdeà
__USE_EXTERN_INLINES


298 #iâdeà
_EXTERN_INLINE


299 
	#_EXTERN_INLINE
 
__ex‹º_šlše


	)

301 
_EXTERN_INLINE
 
cmsghdr
 *

302 
	`__NTH
 (
	$__cmsg_nxthdr
 (
msghdr
 *
__mhdr
, 
cmsghdr
 *
__cmsg
))

304 ià((
size_t
è
__cmsg
->
cmsg_Ën
 <  (
cmsghdr
))

306  (
cmsghdr
 *) 0;

308 
__cmsg
 = (
cmsghdr
 *) ((*) __cmsg

309 + 
	`CMSG_ALIGN
 (
__cmsg
->
cmsg_Ën
));

310 ià((*è(
__cmsg
 + 1è> ((*è
__mhdr
->
msg_cÚŒŞ


311 + 
__mhdr
->
msg_cÚŒŞËn
)

312 || ((*è
__cmsg
 + 
	`CMSG_ALIGN
 (__cmsg->
cmsg_Ën
)

313 > ((*è
__mhdr
->
msg_cÚŒŞ
 + __mhdr->
msg_cÚŒŞËn
)))

315  (
cmsghdr
 *) 0;

316  
__cmsg
;

317 
	}
}

324 
	mSCM_RIGHTS
 = 0x01

325 
	#SCM_RIGHTS
 
SCM_RIGHTS


	)

326 #ifdeà
__USE_GNU


327 , 
	mSCM_CREDENTIALS
 = 0x02

328 
	#SCM_CREDENTIALS
 
SCM_CREDENTIALS


	)

332 #ifdeà
__USE_GNU


334 
	suüed


336 
pid_t
 
	mpid
;

337 
uid_t
 
	muid
;

338 
gid_t
 
	mgid
;

343 #iâdeà
__USE_MISC


344 #iâdeà
FIOGETOWN


345 
	#__SYS_SOCKET_H_undef_FIOGETOWN


	)

347 #iâdeà
FIOSETOWN


348 
	#__SYS_SOCKET_H_undef_FIOSETOWN


	)

350 #iâdeà
SIOCATMARK


351 
	#__SYS_SOCKET_H_undef_SIOCATMARK


	)

353 #iâdeà
SIOCGPGRP


354 
	#__SYS_SOCKET_H_undef_SIOCGPGRP


	)

356 #iâdeà
SIOCGSTAMP


357 
	#__SYS_SOCKET_H_undef_SIOCGSTAMP


	)

359 #iâdeà
SIOCGSTAMPNS


360 
	#__SYS_SOCKET_H_undef_SIOCGSTAMPNS


	)

362 #iâdeà
SIOCSPGRP


363 
	#__SYS_SOCKET_H_undef_SIOCSPGRP


	)

368 
	~<asm/sock‘.h
>

370 #iâdeà
__USE_MISC


371 #ifdeà
__SYS_SOCKET_H_undef_FIOGETOWN


372 #undeà
__SYS_SOCKET_H_undef_FIOGETOWN


373 #undeà
FIOGETOWN


375 #ifdeà
__SYS_SOCKET_H_undef_FIOSETOWN


376 #undeà
__SYS_SOCKET_H_undef_FIOSETOWN


377 #undeà
FIOSETOWN


379 #ifdeà
__SYS_SOCKET_H_undef_SIOCATMARK


380 #undeà
__SYS_SOCKET_H_undef_SIOCATMARK


381 #undeà
SIOCATMARK


383 #ifdeà
__SYS_SOCKET_H_undef_SIOCGPGRP


384 #undeà
__SYS_SOCKET_H_undef_SIOCGPGRP


385 #undeà
SIOCGPGRP


387 #ifdeà
__SYS_SOCKET_H_undef_SIOCGSTAMP


388 #undeà
__SYS_SOCKET_H_undef_SIOCGSTAMP


389 #undeà
SIOCGSTAMP


391 #ifdeà
__SYS_SOCKET_H_undef_SIOCGSTAMPNS


392 #undeà
__SYS_SOCKET_H_undef_SIOCGSTAMPNS


393 #undeà
SIOCGSTAMPNS


395 #ifdeà
__SYS_SOCKET_H_undef_SIOCSPGRP


396 #undeà
__SYS_SOCKET_H_undef_SIOCSPGRP


397 #undeà
SIOCSPGRP


402 
	slšg”


404 
	ml_Úoff
;

405 
	ml_lšg”
;

	@/usr/include/bits/socket2.h

19 #iâdeà
_SYS_SOCKET_H


23 
ssize_t
 
__»cv_chk
 (
__fd
, *
__buf
, 
size_t
 
__n
, size_ˆ
__buæ’
,

24 
__æags
);

25 
ssize_t
 
__REDIRECT
 (
__»cv_®Ÿs
, (
__fd
, *
__buf
, 
size_t
 
__n
,

26 
__æags
), 
»cv
);

27 
ssize_t
 
__REDIRECT
 (
__»cv_chk_w¬n
,

28 (
__fd
, *
__buf
, 
size_t
 
__n
, size_ˆ
__buæ’
,

29 
__æags
), 
__»cv_chk
)

30 
__w¬Ç‰r
 ("recv called with bigger†engthhan size of destination "

33 
__fÜtify_funùiÚ
 
ssize_t


34 
	$»cv
 (
__fd
, *
__buf
, 
size_t
 
__n
, 
__æags
)

36 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

38 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

39  
	`__»cv_chk
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
);

41 ià(
__n
 > 
	`__bos0
 (
__buf
))

42  
	`__»cv_chk_w¬n
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
);

44  
	`__»cv_®Ÿs
 (
__fd
, 
__buf
, 
__n
, 
__æags
);

45 
	}
}

47 
ssize_t
 
__»cväom_chk
 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

48 
size_t
 
__buæ’
, 
__æags
,

49 
__SOCKADDR_ARG
 
__addr
,

50 
sockËn_t
 *
__»¡riù
 
__addr_Ën
);

51 
ssize_t
 
__REDIRECT
 (
__»cväom_®Ÿs
,

52 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

53 
__æags
, 
__SOCKADDR_ARG
 
__addr
,

54 
sockËn_t
 *
__»¡riù
 
__addr_Ën
), 
»cväom
);

55 
ssize_t
 
__REDIRECT
 (
__»cväom_chk_w¬n
,

56 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
,

57 
size_t
 
__buæ’
, 
__æags
,

58 
__SOCKADDR_ARG
 
__addr
,

59 
sockËn_t
 *
__»¡riù
 
__addr_Ën
), 
__»cväom_chk
)

60 
__w¬Ç‰r
 ("recvfrom called with bigger†engthhan size of "

63 
__fÜtify_funùiÚ
 
ssize_t


64 
	$»cväom
 (
__fd
, *
__»¡riù
 
__buf
, 
size_t
 
__n
, 
__æags
,

65 
__SOCKADDR_ARG
 
__addr
, 
sockËn_t
 *
__»¡riù
 
__addr_Ën
)

67 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

69 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

70  
	`__»cväom_chk
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
,

71 
__addr
, 
__addr_Ën
);

72 ià(
__n
 > 
	`__bos0
 (
__buf
))

73  
	`__»cväom_chk_w¬n
 (
__fd
, 
__buf
, 
__n
, 
	`__bos0
 (__buf), 
__æags
,

74 
__addr
, 
__addr_Ën
);

76  
	`__»cväom_®Ÿs
 (
__fd
, 
__buf
, 
__n
, 
__æags
, 
__addr
, 
__addr_Ën
);

77 
	}
}

	@/usr/include/bits/stat.h

18 #ià!
defšed
 
_SYS_STAT_H
 && !defšed 
_FCNTL_H


22 #iâdeà
_BITS_STAT_H


23 
	#_BITS_STAT_H
 1

	)

26 #iâdeà
__x86_64__


27 
	#_STAT_VER_LINUX_OLD
 1

	)

28 
	#_STAT_VER_KERNEL
 1

	)

29 
	#_STAT_VER_SVR4
 2

	)

30 
	#_STAT_VER_LINUX
 3

	)

33 
	#_MKNOD_VER_LINUX
 1

	)

34 
	#_MKNOD_VER_SVR4
 2

	)

35 
	#_MKNOD_VER
 
_MKNOD_VER_LINUX


	)

37 
	#_STAT_VER_KERNEL
 0

	)

38 
	#_STAT_VER_LINUX
 1

	)

41 
	#_MKNOD_VER_LINUX
 0

	)

44 
	#_STAT_VER
 
_STAT_VER_LINUX


	)

46 
	s¡©


48 
__dev_t
 
	m¡_dev
;

49 #iâdeà
__x86_64__


50 
	m__·d1
;

52 #ià
defšed
 
__x86_64__
 || !defšed 
__USE_FILE_OFFSET64


53 
__šo_t
 
	m¡_šo
;

55 
__šo_t
 
	m__¡_šo
;

57 #iâdeà
__x86_64__


58 
__mode_t
 
	m¡_mode
;

59 
__Æšk_t
 
	m¡_Æšk
;

61 
__Æšk_t
 
	m¡_Æšk
;

62 
__mode_t
 
	m¡_mode
;

64 
__uid_t
 
	m¡_uid
;

65 
__gid_t
 
	m¡_gid
;

66 #ifdeà
__x86_64__


67 
	m__·d0
;

69 
__dev_t
 
	m¡_rdev
;

70 #iâdeà
__x86_64__


71 
	m__·d2
;

73 #ià
defšed
 
__x86_64__
 || !defšed 
__USE_FILE_OFFSET64


74 
__off_t
 
	m¡_size
;

76 
__off64_t
 
	m¡_size
;

78 
__blksize_t
 
	m¡_blksize
;

79 #ià
defšed
 
__x86_64__
 || !defšed 
__USE_FILE_OFFSET64


80 
__blkút_t
 
	m¡_blocks
;

82 
__blkút64_t
 
	m¡_blocks
;

84 #ifdeà
__USE_XOPEN2K8


91 
time¥ec
 
	m¡_©im
;

92 
time¥ec
 
	m¡_mtim
;

93 
time¥ec
 
	m¡_ùim
;

94 
	#¡_©ime
 
¡_©im
.
tv_£c


	)

95 
	#¡_mtime
 
¡_mtim
.
tv_£c


	)

96 
	#¡_ùime
 
¡_ùim
.
tv_£c


	)

98 
__time_t
 
	m¡_©ime
;

99 
__sysÿÎ_ulÚg_t
 
	m¡_©im’£c
;

100 
__time_t
 
	m¡_mtime
;

101 
__sysÿÎ_ulÚg_t
 
	m¡_mtim’£c
;

102 
__time_t
 
	m¡_ùime
;

103 
__sysÿÎ_ulÚg_t
 
	m¡_ùim’£c
;

105 #ifdeà
__x86_64__


106 
__sysÿÎ_¦Úg_t
 
	m__glibc_»£rved
[3];

108 #iâdeà
__USE_FILE_OFFSET64


109 
	m__glibc_»£rved4
;

110 
	m__glibc_»£rved5
;

112 
__šo64_t
 
	m¡_šo
;

117 #ifdeà
__USE_LARGEFILE64


119 
	s¡©64


121 
__dev_t
 
	m¡_dev
;

122 #ifdeà
__x86_64__


123 
__šo64_t
 
	m¡_šo
;

124 
__Æšk_t
 
	m¡_Æšk
;

125 
__mode_t
 
	m¡_mode
;

127 
	m__·d1
;

128 
__šo_t
 
	m__¡_šo
;

129 
__mode_t
 
	m¡_mode
;

130 
__Æšk_t
 
	m¡_Æšk
;

132 
__uid_t
 
	m¡_uid
;

133 
__gid_t
 
	m¡_gid
;

134 #ifdeà
__x86_64__


135 
	m__·d0
;

136 
__dev_t
 
	m¡_rdev
;

137 
__off_t
 
	m¡_size
;

139 
__dev_t
 
	m¡_rdev
;

140 
	m__·d2
;

141 
__off64_t
 
	m¡_size
;

143 
__blksize_t
 
	m¡_blksize
;

144 
__blkút64_t
 
	m¡_blocks
;

145 #ifdeà
__USE_XOPEN2K8


152 
time¥ec
 
	m¡_©im
;

153 
time¥ec
 
	m¡_mtim
;

154 
time¥ec
 
	m¡_ùim
;

156 
__time_t
 
	m¡_©ime
;

157 
__sysÿÎ_ulÚg_t
 
	m¡_©im’£c
;

158 
__time_t
 
	m¡_mtime
;

159 
__sysÿÎ_ulÚg_t
 
	m¡_mtim’£c
;

160 
__time_t
 
	m¡_ùime
;

161 
__sysÿÎ_ulÚg_t
 
	m¡_ùim’£c
;

163 #ifdeà
__x86_64__


164 
__sysÿÎ_¦Úg_t
 
	m__glibc_»£rved
[3];

166 
__šo64_t
 
	m¡_šo
;

172 
	#_STATBUF_ST_BLKSIZE


	)

173 
	#_STATBUF_ST_RDEV


	)

175 
	#_STATBUF_ST_NSEC


	)

179 
	#__S_IFMT
 0170000

	)

182 
	#__S_IFDIR
 0040000

	)

183 
	#__S_IFCHR
 0020000

	)

184 
	#__S_IFBLK
 0060000

	)

185 
	#__S_IFREG
 0100000

	)

186 
	#__S_IFIFO
 0010000

	)

187 
	#__S_IFLNK
 0120000

	)

188 
	#__S_IFSOCK
 0140000

	)

192 
	#__S_TYPEISMQ
(
buf
è((buf)->
¡_mode
 - (buf)->¡_mode)

	)

193 
	#__S_TYPEISSEM
(
buf
è((buf)->
¡_mode
 - (buf)->¡_mode)

	)

194 
	#__S_TYPEISSHM
(
buf
è((buf)->
¡_mode
 - (buf)->¡_mode)

	)

198 
	#__S_ISUID
 04000

	)

199 
	#__S_ISGID
 02000

	)

200 
	#__S_ISVTX
 01000

	)

201 
	#__S_IREAD
 0400

	)

202 
	#__S_IWRITE
 0200

	)

203 
	#__S_IEXEC
 0100

	)

205 #ifdeà
__USE_ATFILE


206 
	#UTIME_NOW
 ((1È<< 30è- 1l)

	)

207 
	#UTIME_OMIT
 ((1È<< 30è- 2l)

	)

	@/usr/include/bits/stdio-ldbl.h

19 #iâdeà
_STDIO_H


23 
__BEGIN_NAMESPACE_STD


24 
	$__LDBL_REDIR_DECL
 (
årštf
)

25 
	$__LDBL_REDIR_DECL
 (
´štf
)

26 
	$__LDBL_REDIR_DECL
 (
¥rštf
)

27 
	$__LDBL_REDIR_DECL
 (
vårštf
)

28 
	$__LDBL_REDIR_DECL
 (
v´štf
)

29 
	$__LDBL_REDIR_DECL
 (
v¥rštf
)

30 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

31 && !
defšed
 
__REDIRECT
 \

32 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

33 
	$__LDBL_REDIR1_DECL
 (
fsÿnf
, 
__Ædbl___isoc99_fsÿnf
)

34 
	$__LDBL_REDIR1_DECL
 (
sÿnf
, 
__Ædbl___isoc99_sÿnf
)

35 
	$__LDBL_REDIR1_DECL
 (
ssÿnf
, 
__Ædbl___isoc99_ssÿnf
)

37 
	$__LDBL_REDIR_DECL
 (
fsÿnf
)

38 
	$__LDBL_REDIR_DECL
 (
sÿnf
)

39 
	$__LDBL_REDIR_DECL
 (
ssÿnf
)

41 
__END_NAMESPACE_STD


43 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_UNIX98


44 
__BEGIN_NAMESPACE_C99


45 
	$__LDBL_REDIR_DECL
 (
¢´štf
)

46 
	$__LDBL_REDIR_DECL
 (
v¢´štf
)

47 
__END_NAMESPACE_C99


50 #ifdef 
__USE_ISOC99


51 
__BEGIN_NAMESPACE_C99


52 #ià!
defšed
 
__USE_GNU
 && !defšed 
__REDIRECT
 \

53 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

54 
	$__LDBL_REDIR1_DECL
 (
vfsÿnf
, 
__Ædbl___isoc99_vfsÿnf
)

55 
	$__LDBL_REDIR1_DECL
 (
vsÿnf
, 
__Ædbl___isoc99_vsÿnf
)

56 
	$__LDBL_REDIR1_DECL
 (
vssÿnf
, 
__Ædbl___isoc99_vssÿnf
)

58 
	$__LDBL_REDIR_DECL
 (
vfsÿnf
)

59 
	$__LDBL_REDIR_DECL
 (
vssÿnf
)

60 
	$__LDBL_REDIR_DECL
 (
vsÿnf
)

62 
__END_NAMESPACE_C99


65 #ifdeà
__USE_XOPEN2K8


66 
	$__LDBL_REDIR_DECL
 (
vd´štf
)

67 
	$__LDBL_REDIR_DECL
 (
d´štf
)

70 #ifdeà
__USE_GNU


71 
	$__LDBL_REDIR_DECL
 (
va¥rštf
)

72 
	$__LDBL_REDIR_DECL
 (
__a¥rštf
)

73 
	$__LDBL_REDIR_DECL
 (
a¥rštf
)

74 
	$__LDBL_REDIR_DECL
 (
ob¡ack_´štf
)

75 
	$__LDBL_REDIR_DECL
 (
ob¡ack_v´štf
)

78 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


79 
	$__LDBL_REDIR_DECL
 (
__¥rštf_chk
)

80 
	$__LDBL_REDIR_DECL
 (
__v¥rštf_chk
)

81 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_UNIX98


82 
	$__LDBL_REDIR_DECL
 (
__¢´štf_chk
)

83 
	$__LDBL_REDIR_DECL
 (
__v¢´štf_chk
)

85 #ià
__USE_FORTIFY_LEVEL
 > 1

86 
	$__LDBL_REDIR_DECL
 (
__årštf_chk
)

87 
	$__LDBL_REDIR_DECL
 (
__´štf_chk
)

88 
	$__LDBL_REDIR_DECL
 (
__vårštf_chk
)

89 
	$__LDBL_REDIR_DECL
 (
__v´štf_chk
)

90 #ifdeà
__USE_XOPEN2K8


91 
	$__LDBL_REDIR_DECL
 (
__d´štf_chk
)

92 
	$__LDBL_REDIR_DECL
 (
__vd´štf_chk
)

94 #ifdeà
__USE_GNU


95 
	$__LDBL_REDIR_DECL
 (
__a¥rštf_chk
)

96 
	$__LDBL_REDIR_DECL
 (
__va¥rštf_chk
)

97 
	$__LDBL_REDIR_DECL
 (
__ob¡ack_´štf_chk
)

98 
	$__LDBL_REDIR_DECL
 (
__ob¡ack_v´štf_chk
)

	@/usr/include/bits/stdio.h

19 #iâdeà
_STDIO_H


23 #iâdeà
__ex‹º_šlše


24 
	#__STDIO_INLINE
 
šlše


	)

26 
	#__STDIO_INLINE
 
__ex‹º_šlše


	)

30 #ifdeà
__USE_EXTERN_INLINES


33 #ià!(
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ
)

35 
__STDIO_INLINE
 

36 
	$v´štf
 (cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__¬g
)

38  
	`vårštf
 (
¡dout
, 
__fmt
, 
__¬g
);

39 
	}
}

43 
__STDIO_INLINE
 

44 
	$g‘ch¬
 ()

46  
	`_IO_g‘c
 (
¡dš
);

47 
	}
}

50 #ifdeà
__USE_MISC


52 
__STDIO_INLINE
 

53 
	$fg‘c_uÆocked
 (
FILE
 *
__å
)

55  
	`_IO_g‘c_uÆocked
 (
__å
);

56 
	}
}

60 #ifdeà
__USE_POSIX


62 
__STDIO_INLINE
 

63 
	$g‘c_uÆocked
 (
FILE
 *
__å
)

65  
	`_IO_g‘c_uÆocked
 (
__å
);

66 
	}
}

69 
__STDIO_INLINE
 

70 
	$g‘ch¬_uÆocked
 ()

72  
	`_IO_g‘c_uÆocked
 (
¡dš
);

73 
	}
}

78 
__STDIO_INLINE
 

79 
	$putch¬
 (
__c
)

81  
	`_IO_putc
 (
__c
, 
¡dout
);

82 
	}
}

85 #ifdeà
__USE_MISC


87 
__STDIO_INLINE
 

88 
	$åutc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
)

90  
	`_IO_putc_uÆocked
 (
__c
, 
__¡»am
);

91 
	}
}

95 #ifdeà
__USE_POSIX


97 
__STDIO_INLINE
 

98 
	$putc_uÆocked
 (
__c
, 
FILE
 *
__¡»am
)

100  
	`_IO_putc_uÆocked
 (
__c
, 
__¡»am
);

101 
	}
}

104 
__STDIO_INLINE
 

105 
	$putch¬_uÆocked
 (
__c
)

107  
	`_IO_putc_uÆocked
 (
__c
, 
¡dout
);

108 
	}
}

112 #ifdef 
__USE_GNU


114 
__STDIO_INLINE
 
_IO_ssize_t


115 
	$g‘lše
 (**
__lš•Œ
, 
size_t
 *
__n
, 
FILE
 *
__¡»am
)

117  
	`__g‘d–im
 (
__lš•Œ
, 
__n
, '\n', 
__¡»am
);

118 
	}
}

122 #ifdeà
__USE_MISC


124 
__STDIO_INLINE
 

125 
__NTH
 (
	$ãof_uÆocked
 (
FILE
 *
__¡»am
))

127  
	`_IO_ãof_uÆocked
 (
__¡»am
);

128 
	}
}

131 
__STDIO_INLINE
 

132 
__NTH
 (
	$ã¼Ü_uÆocked
 (
FILE
 *
__¡»am
))

134  
	`_IO_ã¼Ü_uÆocked
 (
__¡»am
);

135 
	}
}

141 #ià
defšed
 
__USE_MISC
 && defšed 
__GNUC__
 && defšed 
__OPTIMIZE__
 \

142 && !
defšed
 
	g__ılu¥lus


144 
	#ä—d_uÆocked
(
±r
, 
size
, 
n
, 
¡»am
) \

145 (
	`__ex‹nsiÚ__
 ((
	`__butš_cÚ¡ªt_p
 (
size
è&& __butš_cÚ¡ªt_°(
n
) \

146 && (
size_t
è(
size
è* (size_tè(
n
) <= 8 \

147 && (
size_t
è(
size
) != 0) \

148 ? ({ *
__±r
 = (*è(
±r
); \

149 
FILE
 *
__¡»am
 = (
¡»am
); \

150 
size_t
 
__út
; \

151 
__út
 = (
size_t
è(
size
è* (size_tè(
n
); \

152 
__út
 > 0; --__cnt) \

154 
__c
 = 
	`_IO_g‘c_uÆocked
 (
__¡»am
); \

155 ià(
__c
 =ğ
EOF
) \

157 *
__±r
++ = 
__c
; \

159 ((
size_t
è(
size
è* (size_tè(
n
è- 
__út
) \

160 / (
size_t
è(
size
); }) \

161 : (((
	`__butš_cÚ¡ªt_p
 (
size
è&& (
size_t
) (size) == 0) \

162 || (
	`__butš_cÚ¡ªt_p
 (
n
è&& (
size_t
) (n) == 0)) \

164 ? ((è(
±r
), (è(
¡»am
), (è(
size
), \

165 (è(
n
), (
size_t
) 0) \

166 : 
	`ä—d_uÆocked
 (
±r
, 
size
, 
n
, 
¡»am
))))

	)

168 
	#fwr™e_uÆocked
(
±r
, 
size
, 
n
, 
¡»am
) \

169 (
	`__ex‹nsiÚ__
 ((
	`__butš_cÚ¡ªt_p
 (
size
è&& __butš_cÚ¡ªt_°(
n
) \

170 && (
size_t
è(
size
è* (size_tè(
n
) <= 8 \

171 && (
size_t
è(
size
) != 0) \

172 ? ({ cÚ¡ *
__±r
 = (cÚ¡ *è(
±r
); \

173 
FILE
 *
__¡»am
 = (
¡»am
); \

174 
size_t
 
__út
; \

175 
__út
 = (
size_t
è(
size
è* (size_tè(
n
); \

176 
__út
 > 0; --__cnt) \

177 ià(
	`_IO_putc_uÆocked
 (*
__±r
++, 
__¡»am
è=ğ
EOF
) \

179 ((
size_t
è(
size
è* (size_tè(
n
è- 
__út
) \

180 / (
size_t
è(
size
); }) \

181 : (((
	`__butš_cÚ¡ªt_p
 (
size
è&& (
size_t
) (size) == 0) \

182 || (
	`__butš_cÚ¡ªt_p
 (
n
è&& (
size_t
) (n) == 0)) \

184 ? ((è(
±r
), (è(
¡»am
), (è(
size
), \

185 (è(
n
), (
size_t
) 0) \

186 : 
	`fwr™e_uÆocked
 (
±r
, 
size
, 
n
, 
¡»am
))))

	)

190 #undeà
__STDIO_INLINE


	@/usr/include/bits/stdio2.h

19 #iâdeà
_STDIO_H


23 
	$__¥rštf_chk
 (*
__»¡riù
 
__s
, 
__æag
, 
size_t
 
__¦’
,

24 cÚ¡ *
__»¡riù
 
__fÜm©
, ...è
__THROW
;

25 
	$__v¥rštf_chk
 (*
__»¡riù
 
__s
, 
__æag
, 
size_t
 
__¦’
,

26 cÚ¡ *
__»¡riù
 
__fÜm©
,

27 
_G_va_li¡
 
__­
è
__THROW
;

29 #ifdeà
__va_¬g_·ck


30 
__fÜtify_funùiÚ
 

31 
	`__NTH
 (
	$¥rštf
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fmt
, ...))

33  
	`__butš___¥rštf_chk
 (
__s
, 
__USE_FORTIFY_LEVEL
 - 1,

34 
	`__bos
 (
__s
), 
__fmt
, 
	`__va_¬g_·ck
 ());

35 
	}
}

36 #–ià!
defšed
 
__ılu¥lus


37 
	#¥rštf
(
¡r
, ...) \

38 
	`__butš___¥rštf_chk
 (
¡r
, 
__USE_FORTIFY_LEVEL
 - 1, 
	`__bos
 (str), \

39 
__VA_ARGS__
)

	)

42 
__fÜtify_funùiÚ
 

43 
__NTH
 (
	$v¥rštf
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__fmt
,

44 
_G_va_li¡
 
__­
))

46  
	`__butš___v¥rštf_chk
 (
__s
, 
__USE_FORTIFY_LEVEL
 - 1,

47 
	`__bos
 (
__s
), 
__fmt
, 
__­
);

48 
	}
}

50 #ià
defšed
 
__USE_ISOC99
 || defšed 
__USE_UNIX98


52 
	$__¢´štf_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__n
, 
__æag
,

53 
size_t
 
__¦’
, cÚ¡ *
__»¡riù
 
__fÜm©
,

54 ...è
__THROW
;

55 
	$__v¢´štf_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__n
, 
__æag
,

56 
size_t
 
__¦’
, cÚ¡ *
__»¡riù
 
__fÜm©
,

57 
_G_va_li¡
 
__­
è
__THROW
;

59 #ifdeà
__va_¬g_·ck


60 
__fÜtify_funùiÚ
 

61 
	`__NTH
 (
	$¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__n
,

62 cÚ¡ *
__»¡riù
 
__fmt
, ...))

64  
	`__butš___¢´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

65 
	`__bos
 (
__s
), 
__fmt
, 
	`__va_¬g_·ck
 ());

66 
	}
}

67 #–ià!
defšed
 
__ılu¥lus


68 
	#¢´štf
(
¡r
, 
Ën
, ...) \

69 
	`__butš___¢´štf_chk
 (
¡r
, 
Ën
, 
__USE_FORTIFY_LEVEL
 - 1, 
	`__bos
 (str), \

70 
__VA_ARGS__
)

	)

73 
__fÜtify_funùiÚ
 

74 
__NTH
 (
	$v¢´štf
 (*
__»¡riù
 
__s
, 
size_t
 
__n
,

75 cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
))

77  
	`__butš___v¢´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

78 
	`__bos
 (
__s
), 
__fmt
, 
__­
);

79 
	}
}

83 #ià
__USE_FORTIFY_LEVEL
 > 1

85 
__årštf_chk
 (
FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

86 cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

87 
__´štf_chk
 (
__æag
, cÚ¡ *
__»¡riù
 
__fÜm©
, ...);

88 
__vårštf_chk
 (
FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

89 cÚ¡ *
__»¡riù
 
__fÜm©
, 
_G_va_li¡
 
__­
);

90 
__v´štf_chk
 (
__æag
, cÚ¡ *
__»¡riù
 
__fÜm©
,

91 
_G_va_li¡
 
__­
);

93 #ifdeà
__va_¬g_·ck


94 
__fÜtify_funùiÚ
 

95 
	$årštf
 (
FILE
 *
__»¡riù
 
__¡»am
, cÚ¡ *__»¡riù 
__fmt
, ...)

97  
	`__årštf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

98 
	`__va_¬g_·ck
 ());

99 
	}
}

101 
__fÜtify_funùiÚ
 

102 
	$´štf
 (cÚ¡ *
__»¡riù
 
__fmt
, ...)

104  
	`__´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
	`__va_¬g_·ck
 ());

105 
	}
}

106 #–ià!
defšed
 
__ılu¥lus


107 
	#´štf
(...) \

108 
	`__´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

109 
	#årštf
(
¡»am
, ...) \

110 
	`__årštf_chk
 (
¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

113 
__fÜtify_funùiÚ
 

114 
	$v´štf
 (cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
)

116 #ifdeà
__USE_EXTERN_INLINES


117  
	`__vårštf_chk
 (
¡dout
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

119  
	`__v´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

121 
	}
}

123 
__fÜtify_funùiÚ
 

124 
	$vårštf
 (
FILE
 *
__»¡riù
 
__¡»am
,

125 cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
)

127  
	`__vårštf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

128 
	}
}

130 #ifdeà
__USE_XOPEN2K8


131 
	$__d´štf_chk
 (
__fd
, 
__æag
, cÚ¡ *
__»¡riù
 
__fmt
,

132 ...è
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

133 
	$__vd´štf_chk
 (
__fd
, 
__æag
,

134 cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__¬g
)

135 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

137 #ifdeà
__va_¬g_·ck


138 
__fÜtify_funùiÚ
 

139 
	$d´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
, ...)

141  
	`__d´štf_chk
 (
__fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

142 
	`__va_¬g_·ck
 ());

143 
	}
}

144 #–ià!
defšed
 
__ılu¥lus


145 
	#d´štf
(
fd
, ...) \

146 
	`__d´štf_chk
 (
fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

149 
__fÜtify_funùiÚ
 

150 
	$vd´štf
 (
__fd
, cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
)

152  
	`__vd´štf_chk
 (
__fd
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

153 
	}
}

156 #ifdeà
__USE_GNU


158 
	$__a¥rštf_chk
 (**
__»¡riù
 
__±r
, 
__æag
,

159 cÚ¡ *
__»¡riù
 
__fmt
, ...)

160 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 3, 4))è
__wur
;

161 
	$__va¥rštf_chk
 (**
__»¡riù
 
__±r
, 
__æag
,

162 cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__¬g
)

163 
__THROW
 
	`__©Œibu‹__
 ((
	$__fÜm©__
 (
__´štf__
, 3, 0))è
__wur
;

164 
	$__ob¡ack_´štf_chk
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

165 
__æag
, cÚ¡ *
__»¡riù
 
__fÜm©
,

167 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 4)));

168 
	$__ob¡ack_v´štf_chk
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

169 
__æag
,

170 cÚ¡ *
__»¡riù
 
__fÜm©
,

171 
_G_va_li¡
 
__¬gs
)

172 
__THROW
 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__´štf__
, 3, 0)));

174 #ifdeà
__va_¬g_·ck


175 
__fÜtify_funùiÚ
 

176 
	`__NTH
 (
	$a¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__fmt
, ...))

178  
	`__a¥rštf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

179 
	`__va_¬g_·ck
 ());

180 
	}
}

182 
__fÜtify_funùiÚ
 

183 
__NTH
 (
	$__a¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__fmt
,

186  
	`__a¥rštf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

187 
	`__va_¬g_·ck
 ());

188 
	}
}

190 
__fÜtify_funùiÚ
 

191 
__NTH
 (
	$ob¡ack_´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

192 cÚ¡ *
__»¡riù
 
__fmt
, ...))

194  
	`__ob¡ack_´štf_chk
 (
__ob¡ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

195 
	`__va_¬g_·ck
 ());

196 
	}
}

197 #–ià!
defšed
 
__ılu¥lus


198 
	#a¥rštf
(
±r
, ...) \

199 
	`__a¥rštf_chk
 (
±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

200 
	#__a¥rštf
(
±r
, ...) \

201 
	`__a¥rštf_chk
 (
±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

202 
	#ob¡ack_´štf
(
ob¡ack
, ...) \

203 
	`__ob¡ack_´štf_chk
 (
ob¡ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

206 
__fÜtify_funùiÚ
 

207 
__NTH
 (
	$va¥rštf
 (**
__»¡riù
 
__±r
, cÚ¡ *__»¡riù 
__fmt
,

208 
_G_va_li¡
 
__­
))

210  
	`__va¥rštf_chk
 (
__±r
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

211 
	}
}

213 
__fÜtify_funùiÚ
 

214 
__NTH
 (
	$ob¡ack_v´štf
 (
ob¡ack
 *
__»¡riù
 
__ob¡ack
,

215 cÚ¡ *
__»¡riù
 
__fmt
, 
_G_va_li¡
 
__­
))

217  
	`__ob¡ack_v´štf_chk
 (
__ob¡ack
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

218 
__­
);

219 
	}
}

225 #ià!
defšed
 
__USE_ISOC11
 \

226 || (
defšed
 
	g__ılu¥lus
 && __ılu¥lu <ğ201103L && !defšed 
__USE_GNU
)

227 *
	$__g‘s_chk
 (*
__¡r
, 
size_t
è
__wur
;

228 *
	`__REDIRECT
 (
__g‘s_w¬n
, (*
__¡r
), 
g‘s
)

229 
__wur
 
	`__w¬Ç‰r
 ("please use fgets or getline instead, gets can't "

232 
__fÜtify_funùiÚ
 
__wur
 *

233 
	$g‘s
 (*
__¡r
)

235 ià(
	`__bos
 (
__¡r
è!ğ(
size_t
) -1)

236  
	`__g‘s_chk
 (
__¡r
, 
	`__bos
 (__str));

237  
	`__g‘s_w¬n
 (
__¡r
);

238 
	}
}

241 *
	$__fg‘s_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

242 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

243 *
	`__REDIRECT
 (
__fg‘s_®Ÿs
,

244 (*
__»¡riù
 
__s
, 
__n
,

245 
FILE
 *
__»¡riù
 
__¡»am
), 
fg‘s
è
__wur
;

246 *
	`__REDIRECT
 (
__fg‘s_chk_w¬n
,

247 (*
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

248 
FILE
 *
__»¡riù
 
__¡»am
), 
__fg‘s_chk
)

249 
__wur
 
	`__w¬Ç‰r
 ("fgets called with bigger sizehan†ength "

252 
__fÜtify_funùiÚ
 
__wur
 *

253 
	$fg‘s
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

255 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

257 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

258  
	`__fg‘s_chk
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

260 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
))

261  
	`__fg‘s_chk_w¬n
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

263  
	`__fg‘s_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

264 
	}
}

266 
size_t
 
	$__ä—d_chk
 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

267 
size_t
 
__size
, size_ˆ
__n
,

268 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

269 
size_t
 
	`__REDIRECT
 (
__ä—d_®Ÿs
,

270 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

271 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
),

272 
ä—d
è
__wur
;

273 
size_t
 
	`__REDIRECT
 (
__ä—d_chk_w¬n
,

274 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

275 
size_t
 
__size
, size_ˆ
__n
,

276 
FILE
 *
__»¡riù
 
__¡»am
),

277 
__ä—d_chk
)

278 
__wur
 
	`__w¬Ç‰r
 ("fread called with bigger size *‚membhan†ength "

281 
__fÜtify_funùiÚ
 
__wur
 
size_t


282 
	$ä—d
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
, size_ˆ
__n
,

283 
FILE
 *
__»¡riù
 
__¡»am
)

285 ià(
	`__bos0
 (
__±r
è!ğ(
size_t
) -1)

287 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
)

288 || !
	`__butš_cÚ¡ªt_p
 (
__n
)

289 || (
__size
 | 
__n
è>ğ(((
size_t
) 1) << (8 *  (size_t) / 2)))

290  
	`__ä—d_chk
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
, 
__¡»am
);

292 ià(
__size
 * 
__n
 > 
	`__bos0
 (
__±r
))

293  
	`__ä—d_chk_w¬n
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
, 
__¡»am
);

295  
	`__ä—d_®Ÿs
 (
__±r
, 
__size
, 
__n
, 
__¡»am
);

296 
	}
}

298 #ifdeà
__USE_GNU


299 *
	$__fg‘s_uÆocked_chk
 (*
__»¡riù
 
__s
, 
size_t
 
__size
,

300 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

301 *
	`__REDIRECT
 (
__fg‘s_uÆocked_®Ÿs
,

302 (*
__»¡riù
 
__s
, 
__n
,

303 
FILE
 *
__»¡riù
 
__¡»am
), 
fg‘s_uÆocked
è
__wur
;

304 *
	`__REDIRECT
 (
__fg‘s_uÆocked_chk_w¬n
,

305 (*
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

306 
FILE
 *
__»¡riù
 
__¡»am
), 
__fg‘s_uÆocked_chk
)

307 
__wur
 
	`__w¬Ç‰r
 ("fgets_unlocked called with bigger sizehan†ength "

310 
__fÜtify_funùiÚ
 
__wur
 *

311 
	$fg‘s_uÆocked
 (*
__»¡riù
 
__s
, 
__n
, 
FILE
 *__»¡riù 
__¡»am
)

313 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

315 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

316  
	`__fg‘s_uÆocked_chk
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

318 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
))

319  
	`__fg‘s_uÆocked_chk_w¬n
 (
__s
, 
	`__bos
 (__s), 
__n
, 
__¡»am
);

321  
	`__fg‘s_uÆocked_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

322 
	}
}

325 #ifdeà
__USE_MISC


326 #undeà
ä—d_uÆocked


327 
size_t
 
	$__ä—d_uÆocked_chk
 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

328 
size_t
 
__size
, size_ˆ
__n
,

329 
FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

330 
size_t
 
	`__REDIRECT
 (
__ä—d_uÆocked_®Ÿs
,

331 (*
__»¡riù
 
__±r
, 
size_t
 
__size
,

332 
size_t
 
__n
, 
FILE
 *
__»¡riù
 
__¡»am
),

333 
ä—d_uÆocked
è
__wur
;

334 
size_t
 
	`__REDIRECT
 (
__ä—d_uÆocked_chk_w¬n
,

335 (*
__»¡riù
 
__±r
, 
size_t
 
__±¾’
,

336 
size_t
 
__size
, size_ˆ
__n
,

337 
FILE
 *
__»¡riù
 
__¡»am
),

338 
__ä—d_uÆocked_chk
)

339 
__wur
 
	`__w¬Ç‰r
 ("fread_unlocked called with bigger size *‚membhan "

342 
__fÜtify_funùiÚ
 
__wur
 
size_t


343 
	$ä—d_uÆocked
 (*
__»¡riù
 
__±r
, 
size_t
 
__size
, size_ˆ
__n
,

344 
FILE
 *
__»¡riù
 
__¡»am
)

346 ià(
	`__bos0
 (
__±r
è!ğ(
size_t
) -1)

348 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
)

349 || !
	`__butš_cÚ¡ªt_p
 (
__n
)

350 || (
__size
 | 
__n
è>ğ(((
size_t
) 1) << (8 *  (size_t) / 2)))

351  
	`__ä—d_uÆocked_chk
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
,

352 
__¡»am
);

354 ià(
__size
 * 
__n
 > 
	`__bos0
 (
__±r
))

355  
	`__ä—d_uÆocked_chk_w¬n
 (
__±r
, 
	`__bos0
 (__±r), 
__size
, 
__n
,

356 
__¡»am
);

359 #ifdeà
__USE_EXTERN_INLINES


360 ià(
	`__butš_cÚ¡ªt_p
 (
__size
)

361 && 
	`__butš_cÚ¡ªt_p
 (
__n
)

362 && (
__size
 | 
__n
è< (((
size_t
) 1) << (8 *  (size_t) / 2))

363 && 
__size
 * 
__n
 <= 8)

365 
size_t
 
__út
 = 
__size
 * 
__n
;

366 *
__ıŒ
 = (*è
__±r
;

367 ià(
__út
 == 0)

370 ; 
__út
 > 0; --__cnt)

372 
__c
 = 
	`_IO_g‘c_uÆocked
 (
__¡»am
);

373 ià(
__c
 =ğ
EOF
)

375 *
__ıŒ
++ = 
__c
;

377  (
__ıŒ
 - (*è
__±r
è/ 
__size
;

380  
	`__ä—d_uÆocked_®Ÿs
 (
__±r
, 
__size
, 
__n
, 
__¡»am
);

381 
	}
}

	@/usr/include/bits/stdio_lim.h

18 #ià!
defšed
 
_STDIO_H
 && !defšed 
__Ãed_FOPEN_MAX
 && !defšed 
__Ãed_IOV_MAX


22 #ifdeà
_STDIO_H


23 
	#L_tm²am
 20

	)

24 
	#TMP_MAX
 238328

	)

25 
	#FILENAME_MAX
 4096

	)

27 #ifdeà
__USE_POSIX


28 
	#L_ù”mid
 9

	)

29 #ià!
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_GNU


30 
	#L_cu£rid
 9

	)

35 #ià
defšed
 
__Ãed_FOPEN_MAX
 || defšed 
_STDIO_H


36 #undeà
FOPEN_MAX


37 
	#FOPEN_MAX
 16

	)

40 #ià
defšed
 
__Ãed_IOV_MAX
 && !defšed 
IOV_MAX


41 
	#IOV_MAX
 1024

	)

	@/usr/include/bits/stdlib-bsearch.h

19 
__ex‹º_šlše
 *

20 
	$b£¬ch
 (cÚ¡ *
__key
, cÚ¡ *
__ba£
, 
size_t
 
__nmemb
, size_ˆ
__size
,

21 
__com·r_â_t
 
__com·r
)

23 
size_t
 
__l
, 
__u
, 
__idx
;

24 cÚ¡ *
__p
;

25 
__com·risÚ
;

27 
__l
 = 0;

28 
__u
 = 
__nmemb
;

29 
__l
 < 
__u
)

31 
__idx
 = (
__l
 + 
__u
) / 2;

32 
__p
 = (*è(((cÚ¡ *è
__ba£
è+ (
__idx
 * 
__size
));

33 
__com·risÚ
 = (*
__com·r
è(
__key
, 
__p
);

34 ià(
__com·risÚ
 < 0)

35 
__u
 = 
__idx
;

36 ià(
__com·risÚ
 > 0)

37 
__l
 = 
__idx
 + 1;

39  (*è
__p
;

42  
NULL
;

43 
	}
}

	@/usr/include/bits/stdlib-float.h

19 #iâdeà
_STDLIB_H


23 #ifdeà
__USE_EXTERN_INLINES


24 
__BEGIN_NAMESPACE_STD


25 
__ex‹º_šlše
 

26 
__NTH
 (
	$©of
 (cÚ¡ *
__ÅŒ
))

28  
	`¡¹od
 (
__ÅŒ
, (**è
NULL
);

29 
	}
}

30 
	g__END_NAMESPACE_STD


	@/usr/include/bits/stdlib-ldbl.h

19 #iâdeà
_STDLIB_H


23 #ifdef 
__USE_ISOC99


24 
__BEGIN_NAMESPACE_C99


25 
	$__LDBL_REDIR1_DECL
 (
¡¹Şd
, 
¡¹od
)

26 
__END_NAMESPACE_C99


29 #ifdeà
__USE_GNU


30 
	$__LDBL_REDIR1_DECL
 (
¡¹Şd_l
, 
¡¹od_l
)

33 #ifdeà
__USE_MISC


34 
	$__LDBL_REDIR1_DECL
 (
qecvt
, 
ecvt
)

35 
	$__LDBL_REDIR1_DECL
 (
qfcvt
, 
fcvt
)

36 
	$__LDBL_REDIR1_DECL
 (
qgcvt
, 
gcvt
)

37 
	$__LDBL_REDIR1_DECL
 (
qecvt_r
, 
ecvt_r
)

38 
	$__LDBL_REDIR1_DECL
 (
qfcvt_r
, 
fcvt_r
)

	@/usr/include/bits/stdlib.h

19 #iâdeà
_STDLIB_H


23 *
	$__»®·th_chk
 (cÚ¡ *
__»¡riù
 
__Çme
,

24 *
__»¡riù
 
__»sŞved
,

25 
size_t
 
__»sŞvedËn
è
__THROW
 
__wur
;

26 *
	`__REDIRECT_NTH
 (
__»®·th_®Ÿs
,

27 (cÚ¡ *
__»¡riù
 
__Çme
,

28 *
__»¡riù
 
__»sŞved
), 
»®·th
è
__wur
;

29 *
	`__REDIRECT_NTH
 (
__»®·th_chk_w¬n
,

30 (cÚ¡ *
__»¡riù
 
__Çme
,

31 *
__»¡riù
 
__»sŞved
,

32 
size_t
 
__»sŞvedËn
), 
__»®·th_chk
è
__wur


33 
	`__w¬Ç‰r
 ("second‡rgument of„ealpath must beƒither NULL or‡t "

36 
__fÜtify_funùiÚ
 
__wur
 *

37 
	`__NTH
 (
	$»®·th
 (cÚ¡ *
__»¡riù
 
__Çme
, *__»¡riù 
__»sŞved
))

39 ià(
	`__bos
 (
__»sŞved
è!ğ(
size_t
) -1)

41 #ià
defšed
 
_LIBC_LIMITS_H_
 && defšed 
PATH_MAX


42 ià(
	`__bos
 (
__»sŞved
è< 
PATH_MAX
)

43  
	`__»®·th_chk_w¬n
 (
__Çme
, 
__»sŞved
, 
	`__bos
 (__resolved));

45  
	`__»®·th_chk
 (
__Çme
, 
__»sŞved
, 
	`__bos
 (__resolved));

48  
	`__»®·th_®Ÿs
 (
__Çme
, 
__»sŞved
);

49 
	}
}

52 
	$__±¢ame_r_chk
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

53 
size_t
 
__Ä—l
è
__THROW
 
	`__nÚnuÎ
 ((2));

54 
	`__REDIRECT_NTH
 (
__±¢ame_r_®Ÿs
, (
__fd
, *
__buf
,

55 
size_t
 
__buæ’
), 
±¢ame_r
)

56 
	`__nÚnuÎ
 ((2));

57 
	`__REDIRECT_NTH
 (
__±¢ame_r_chk_w¬n
,

58 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

59 
size_t
 
__Ä—l
), 
__±¢ame_r_chk
)

60 
	`__nÚnuÎ
 ((2)è
	`__w¬Ç‰r
 ("ptsname_r called with buflen biggerhan "

63 
__fÜtify_funùiÚ
 

64 
	`__NTH
 (
	$±¢ame_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
))

66 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

68 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

69  
	`__±¢ame_r_chk
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

70 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

71  
	`__±¢ame_r_chk_w¬n
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

73  
	`__±¢ame_r_®Ÿs
 (
__fd
, 
__buf
, 
__buæ’
);

74 
	}
}

77 
	$__wùomb_chk
 (*
__s
, 
wch¬_t
 
__wch¬
, 
size_t
 
__buæ’
)

78 
__THROW
 
__wur
;

79 
	`__REDIRECT_NTH
 (
__wùomb_®Ÿs
, (*
__s
, 
wch¬_t
 
__wch¬
),

80 
wùomb
è
__wur
;

82 
__fÜtify_funùiÚ
 
__wur
 

83 
	`__NTH
 (
	$wùomb
 (*
__s
, 
wch¬_t
 
__wch¬
))

88 
	#__STDLIB_MB_LEN_MAX
 16

	)

89 #ià
defšed
 
MB_LEN_MAX
 && MB_LEN_MAX !ğ
__STDLIB_MB_LEN_MAX


92 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 && 
__STDLIB_MB_LEN_MAX
 > __bos (__s))

93  
	`__wùomb_chk
 (
__s
, 
__wch¬
, 
	`__bos
 (__s));

94  
	`__wùomb_®Ÿs
 (
__s
, 
__wch¬
);

95 
	}
}

98 
size_t
 
	$__mb¡owcs_chk
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

99 cÚ¡ *
__»¡riù
 
__¤c
,

100 
size_t
 
__Ën
, size_ˆ
__d¡Ën
è
__THROW
;

101 
size_t
 
	`__REDIRECT_NTH
 (
__mb¡owcs_®Ÿs
,

102 (
wch¬_t
 *
__»¡riù
 
__d¡
,

103 cÚ¡ *
__»¡riù
 
__¤c
,

104 
size_t
 
__Ën
), 
mb¡owcs
);

105 
size_t
 
	`__REDIRECT_NTH
 (
__mb¡owcs_chk_w¬n
,

106 (
wch¬_t
 *
__»¡riù
 
__d¡
,

107 cÚ¡ *
__»¡riù
 
__¤c
,

108 
size_t
 
__Ën
, size_ˆ
__d¡Ën
), 
__mb¡owcs_chk
)

109 
	`__w¬Ç‰r
 ("mbstowcs called with dst buffer smallerhan†en "

112 
__fÜtify_funùiÚ
 
size_t


113 
	`__NTH
 (
	$mb¡owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
, cÚ¡ *__»¡riù 
__¤c
,

114 
size_t
 
__Ën
))

116 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

118 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

119  
	`__mb¡owcs_chk
 (
__d¡
, 
__¤c
, 
__Ën
,

120 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

122 ià(
__Ën
 > 
	`__bos
 (
__d¡
è/  (
wch¬_t
))

123  
	`__mb¡owcs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
,

124 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

126  
	`__mb¡owcs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
);

127 
	}
}

130 
size_t
 
	$__wc¡ombs_chk
 (*
__»¡riù
 
__d¡
,

131 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

132 
size_t
 
__Ën
, size_ˆ
__d¡Ën
è
__THROW
;

133 
size_t
 
	`__REDIRECT_NTH
 (
__wc¡ombs_®Ÿs
,

134 (*
__»¡riù
 
__d¡
,

135 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

136 
size_t
 
__Ën
), 
wc¡ombs
);

137 
size_t
 
	`__REDIRECT_NTH
 (
__wc¡ombs_chk_w¬n
,

138 (*
__»¡riù
 
__d¡
,

139 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

140 
size_t
 
__Ën
, size_ˆ
__d¡Ën
), 
__wc¡ombs_chk
)

141 
	`__w¬Ç‰r
 ("wcstombs called with dst buffer smallerhan†en");

143 
__fÜtify_funùiÚ
 
size_t


144 
	`__NTH
 (
	$wc¡ombs
 (*
__»¡riù
 
__d¡
, cÚ¡ 
wch¬_t
 *__»¡riù 
__¤c
,

145 
size_t
 
__Ën
))

147 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

149 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

150  
	`__wc¡ombs_chk
 (
__d¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dst));

151 ià(
__Ën
 > 
	`__bos
 (
__d¡
))

152  
	`__wc¡ombs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dst));

154  
	`__wc¡ombs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
);

155 
	}
}

	@/usr/include/bits/sys_errlist.h

19 #iâdeà
_STDIO_H


25 #ifdeà 
__USE_MISC


26 
sys_Ã¼
;

27 cÚ¡ *cÚ¡ 
sys_”¾i¡
[];

29 #ifdeà 
__USE_GNU


30 
_sys_Ã¼
;

31 cÚ¡ *cÚ¡ 
_sys_”¾i¡
[];

	@/usr/include/bits/sysctl.h

18 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


	@/usr/include/bits/termios.h

19 #iâdeà
_TERMIOS_H


23 
	tcc_t
;

24 
	t¥“d_t
;

25 
	ttcæag_t
;

27 
	#NCCS
 32

	)

28 
	s‹rmios


30 
tcæag_t
 
	mc_iæag
;

31 
tcæag_t
 
	mc_oæag
;

32 
tcæag_t
 
	mc_cæag
;

33 
tcæag_t
 
	mc_læag
;

34 
cc_t
 
	mc_lše
;

35 
cc_t
 
	mc_cc
[
NCCS
];

36 
¥“d_t
 
	mc_i¥“d
;

37 
¥“d_t
 
	mc_o¥“d
;

38 
	#_HAVE_STRUCT_TERMIOS_C_ISPEED
 1

	)

39 
	#_HAVE_STRUCT_TERMIOS_C_OSPEED
 1

	)

43 
	#VINTR
 0

	)

44 
	#VQUIT
 1

	)

45 
	#VERASE
 2

	)

46 
	#VKILL
 3

	)

47 
	#VEOF
 4

	)

48 
	#VTIME
 5

	)

49 
	#VMIN
 6

	)

50 
	#VSWTC
 7

	)

51 
	#VSTART
 8

	)

52 
	#VSTOP
 9

	)

53 
	#VSUSP
 10

	)

54 
	#VEOL
 11

	)

55 
	#VREPRINT
 12

	)

56 
	#VDISCARD
 13

	)

57 
	#VWERASE
 14

	)

58 
	#VLNEXT
 15

	)

59 
	#VEOL2
 16

	)

62 
	#IGNBRK
 0000001

	)

63 
	#BRKINT
 0000002

	)

64 
	#IGNPAR
 0000004

	)

65 
	#PARMRK
 0000010

	)

66 
	#INPCK
 0000020

	)

67 
	#ISTRIP
 0000040

	)

68 
	#INLCR
 0000100

	)

69 
	#IGNCR
 0000200

	)

70 
	#ICRNL
 0000400

	)

71 
	#IUCLC
 0001000

	)

72 
	#IXON
 0002000

	)

73 
	#IXANY
 0004000

	)

74 
	#IXOFF
 0010000

	)

75 
	#IMAXBEL
 0020000

	)

76 
	#IUTF8
 0040000

	)

79 
	#OPOST
 0000001

	)

80 
	#OLCUC
 0000002

	)

81 
	#ONLCR
 0000004

	)

82 
	#OCRNL
 0000010

	)

83 
	#ONOCR
 0000020

	)

84 
	#ONLRET
 0000040

	)

85 
	#OFILL
 0000100

	)

86 
	#OFDEL
 0000200

	)

87 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


88 
	#NLDLY
 0000400

	)

89 
	#NL0
 0000000

	)

90 
	#NL1
 0000400

	)

91 
	#CRDLY
 0003000

	)

92 
	#CR0
 0000000

	)

93 
	#CR1
 0001000

	)

94 
	#CR2
 0002000

	)

95 
	#CR3
 0003000

	)

96 
	#TABDLY
 0014000

	)

97 
	#TAB0
 0000000

	)

98 
	#TAB1
 0004000

	)

99 
	#TAB2
 0010000

	)

100 
	#TAB3
 0014000

	)

101 
	#BSDLY
 0020000

	)

102 
	#BS0
 0000000

	)

103 
	#BS1
 0020000

	)

104 
	#FFDLY
 0100000

	)

105 
	#FF0
 0000000

	)

106 
	#FF1
 0100000

	)

109 
	#VTDLY
 0040000

	)

110 
	#VT0
 0000000

	)

111 
	#VT1
 0040000

	)

113 #ifdeà
__USE_MISC


114 
	#XTABS
 0014000

	)

118 #ifdeà
__USE_MISC


119 
	#CBAUD
 0010017

	)

121 
	#B0
 0000000

	)

122 
	#B50
 0000001

	)

123 
	#B75
 0000002

	)

124 
	#B110
 0000003

	)

125 
	#B134
 0000004

	)

126 
	#B150
 0000005

	)

127 
	#B200
 0000006

	)

128 
	#B300
 0000007

	)

129 
	#B600
 0000010

	)

130 
	#B1200
 0000011

	)

131 
	#B1800
 0000012

	)

132 
	#B2400
 0000013

	)

133 
	#B4800
 0000014

	)

134 
	#B9600
 0000015

	)

135 
	#B19200
 0000016

	)

136 
	#B38400
 0000017

	)

137 #ifdeà
__USE_MISC


138 
	#EXTA
 
B19200


	)

139 
	#EXTB
 
B38400


	)

141 
	#CSIZE
 0000060

	)

142 
	#CS5
 0000000

	)

143 
	#CS6
 0000020

	)

144 
	#CS7
 0000040

	)

145 
	#CS8
 0000060

	)

146 
	#CSTOPB
 0000100

	)

147 
	#CREAD
 0000200

	)

148 
	#PARENB
 0000400

	)

149 
	#PARODD
 0001000

	)

150 
	#HUPCL
 0002000

	)

151 
	#CLOCAL
 0004000

	)

152 #ifdeà
__USE_MISC


153 
	#CBAUDEX
 0010000

	)

155 
	#B57600
 0010001

	)

156 
	#B115200
 0010002

	)

157 
	#B230400
 0010003

	)

158 
	#B460800
 0010004

	)

159 
	#B500000
 0010005

	)

160 
	#B576000
 0010006

	)

161 
	#B921600
 0010007

	)

162 
	#B1000000
 0010010

	)

163 
	#B1152000
 0010011

	)

164 
	#B1500000
 0010012

	)

165 
	#B2000000
 0010013

	)

166 
	#B2500000
 0010014

	)

167 
	#B3000000
 0010015

	)

168 
	#B3500000
 0010016

	)

169 
	#B4000000
 0010017

	)

170 
	#__MAX_BAUD
 
B4000000


	)

171 #ifdeà
__USE_MISC


172 
	#CIBAUD
 002003600000

	)

173 
	#CMSPAR
 010000000000

	)

174 
	#CRTSCTS
 020000000000

	)

178 
	#ISIG
 0000001

	)

179 
	#ICANON
 0000002

	)

180 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_XOPEN2K
)

181 
	#XCASE
 0000004

	)

183 
	#ECHO
 0000010

	)

184 
	#ECHOE
 0000020

	)

185 
	#ECHOK
 0000040

	)

186 
	#ECHONL
 0000100

	)

187 
	#NOFLSH
 0000200

	)

188 
	#TOSTOP
 0000400

	)

189 #ifdeà
__USE_MISC


190 
	#ECHOCTL
 0001000

	)

191 
	#ECHOPRT
 0002000

	)

192 
	#ECHOKE
 0004000

	)

193 
	#FLUSHO
 0010000

	)

194 
	#PENDIN
 0040000

	)

196 
	#IEXTEN
 0100000

	)

197 #ifdeà
__USE_MISC


198 
	#EXTPROC
 0200000

	)

202 
	#TCOOFF
 0

	)

203 
	#TCOON
 1

	)

204 
	#TCIOFF
 2

	)

205 
	#TCION
 3

	)

208 
	#TCIFLUSH
 0

	)

209 
	#TCOFLUSH
 1

	)

210 
	#TCIOFLUSH
 2

	)

213 
	#TCSANOW
 0

	)

214 
	#TCSADRAIN
 1

	)

215 
	#TCSAFLUSH
 2

	)

218 
	#_IOT_‹rmios
 \

219 
	`_IOT
 (
	`_IOTS
 (
cæag_t
), 4, _IOTS (
cc_t
), 
NCCS
, _IOTS (
¥“d_t
), 2)

	)

	@/usr/include/bits/time.h

23 #ià
defšed
 
__Ãed_timev®
 || defšed 
__USE_GNU


24 #iâdeà
_STRUCT_TIMEVAL


25 
	#_STRUCT_TIMEVAL
 1

	)

26 
	~<b™s/ty³s.h
>

30 
	stimev®


32 
__time_t
 
	mtv_£c
;

33 
__su£cÚds_t
 
	mtv_u£c
;

38 #iâdeà
__Ãed_timev®


39 #iâdeà
_BITS_TIME_H


40 
	#_BITS_TIME_H
 1

	)

48 
	#CLOCKS_PER_SEC
 ((
şock_t
è1000000)

	)

50 #ià(!
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_POSIX
) \

51 && !
defšed
 
	g__USE_XOPEN2K


54 
	~<b™s/ty³s.h
>

55 
__syscÚf
 ();

56 
	#CLK_TCK
 ((
__şock_t
è
	`__syscÚf
 (2)è

	)

59 #ifdeà
__USE_POSIX199309


61 
	#CLOCK_REALTIME
 0

	)

63 
	#CLOCK_MONOTONIC
 1

	)

65 
	#CLOCK_PROCESS_CPUTIME_ID
 2

	)

67 
	#CLOCK_THREAD_CPUTIME_ID
 3

	)

69 
	#CLOCK_MONOTONIC_RAW
 4

	)

71 
	#CLOCK_REALTIME_COARSE
 5

	)

73 
	#CLOCK_MONOTONIC_COARSE
 6

	)

75 
	#CLOCK_BOOTTIME
 7

	)

77 
	#CLOCK_REALTIME_ALARM
 8

	)

79 
	#CLOCK_BOOTTIME_ALARM
 9

	)

81 
	#CLOCK_TAI
 11

	)

84 
	#TIMER_ABSTIME
 1

	)

87 #ifdeà
__USE_GNU


88 
	~<b™s/timex.h
>

90 
__BEGIN_DECLS


93 
	$şock_adjtime
 (
__şockid_t
 
__şock_id
, 
timex
 *
__utx
è
__THROW
;

95 
__END_DECLS


101 #undeà
__Ãed_timev®


	@/usr/include/bits/types.h

23 #iâdef 
_BITS_TYPES_H


24 
	#_BITS_TYPES_H
 1

	)

26 
	~<ã©u»s.h
>

27 
	~<b™s/wÜdsize.h
>

30 
	t__u_ch¬
;

31 
	t__u_shÜt
;

32 
	t__u_št
;

33 
	t__u_lÚg
;

36 sigÃd 
	t__št8_t
;

37 
	t__ušt8_t
;

38 sigÃd 
	t__št16_t
;

39 
	t__ušt16_t
;

40 sigÃd 
	t__št32_t
;

41 
	t__ušt32_t
;

42 #ià
__WORDSIZE
 == 64

43 sigÃd 
	t__št64_t
;

44 
	t__ušt64_t
;

46 
__ex‹nsiÚ__
 sigÃd 
	t__št64_t
;

47 
__ex‹nsiÚ__
 
	t__ušt64_t
;

51 #ià
__WORDSIZE
 == 64

52 
	t__quad_t
;

53 
	t__u_quad_t
;

55 
__ex‹nsiÚ__
 
	t__quad_t
;

56 
__ex‹nsiÚ__
 
	t__u_quad_t
;

89 
	#__S16_TYPE
 

	)

90 
	#__U16_TYPE
 

	)

91 
	#__S32_TYPE
 

	)

92 
	#__U32_TYPE
 

	)

93 
	#__SLONGWORD_TYPE
 

	)

94 
	#__ULONGWORD_TYPE
 

	)

95 #ià
__WORDSIZE
 == 32

96 
	#__SQUAD_TYPE
 
__quad_t


	)

97 
	#__UQUAD_TYPE
 
__u_quad_t


	)

98 
	#__SWORD_TYPE
 

	)

99 
	#__UWORD_TYPE
 

	)

100 
	#__SLONG32_TYPE
 

	)

101 
	#__ULONG32_TYPE
 

	)

102 
	#__S64_TYPE
 
__quad_t


	)

103 
	#__U64_TYPE
 
__u_quad_t


	)

106 
	#__STD_TYPE
 
__ex‹nsiÚ__
 

	)

107 #–ià
__WORDSIZE
 == 64

108 
	t__SQUAD_TYPE
 

	)

109 
	t__UQUAD_TYPE
 

	)

110 
	t__SWORD_TYPE
 

	)

111 
	t__UWORD_TYPE
 

	)

112 
	t__SLONG32_TYPE
 

	)

113 
	t__ULONG32_TYPE
 

	)

114 
	t__S64_TYPE
 

	)

115 
	t__U64_TYPE
 

	)

117 
	t__STD_TYPE
 

	)

121 
	~<b™s/ty³sizes.h
>

124 
__STD_TYPE
 
	t__DEV_T_TYPE
 
	t__dev_t
;

125 
__STD_TYPE
 
__UID_T_TYPE
 
	g__uid_t
;

126 
__STD_TYPE
 
__GID_T_TYPE
 
	g__gid_t
;

127 
__STD_TYPE
 
__INO_T_TYPE
 
	g__šo_t
;

128 
__STD_TYPE
 
__INO64_T_TYPE
 
	g__šo64_t
;

129 
__STD_TYPE
 
__MODE_T_TYPE
 
	g__mode_t
;

130 
__STD_TYPE
 
__NLINK_T_TYPE
 
	g__Æšk_t
;

131 
__STD_TYPE
 
__OFF_T_TYPE
 
	g__off_t
;

132 
__STD_TYPE
 
__OFF64_T_TYPE
 
	g__off64_t
;

133 
__STD_TYPE
 
__PID_T_TYPE
 
	g__pid_t
;

134 
__STD_TYPE
 
__FSID_T_TYPE
 
	g__fsid_t
;

135 
__STD_TYPE
 
__CLOCK_T_TYPE
 
	g__şock_t
;

136 
__STD_TYPE
 
__RLIM_T_TYPE
 
	g__¾im_t
;

137 
__STD_TYPE
 
__RLIM64_T_TYPE
 
	g__¾im64_t
;

138 
__STD_TYPE
 
__ID_T_TYPE
 
	g__id_t
;

139 
__STD_TYPE
 
__TIME_T_TYPE
 
	g__time_t
;

140 
__STD_TYPE
 
__USECONDS_T_TYPE
 
	g__u£cÚds_t
;

141 
__STD_TYPE
 
__SUSECONDS_T_TYPE
 
	g__su£cÚds_t
;

143 
__STD_TYPE
 
__DADDR_T_TYPE
 
	g__daddr_t
;

144 
__STD_TYPE
 
__KEY_T_TYPE
 
	g__key_t
;

147 
__STD_TYPE
 
__CLOCKID_T_TYPE
 
	g__şockid_t
;

150 
__STD_TYPE
 
__TIMER_T_TYPE
 
	g__tim”_t
;

153 
__STD_TYPE
 
__BLKSIZE_T_TYPE
 
	g__blksize_t
;

158 
__STD_TYPE
 
__BLKCNT_T_TYPE
 
	g__blkút_t
;

159 
__STD_TYPE
 
__BLKCNT64_T_TYPE
 
	g__blkút64_t
;

162 
__STD_TYPE
 
__FSBLKCNT_T_TYPE
 
	g__fsblkút_t
;

163 
__STD_TYPE
 
__FSBLKCNT64_T_TYPE
 
	g__fsblkút64_t
;

166 
__STD_TYPE
 
__FSFILCNT_T_TYPE
 
	g__fsfút_t
;

167 
__STD_TYPE
 
__FSFILCNT64_T_TYPE
 
	g__fsfút64_t
;

170 
__STD_TYPE
 
__FSWORD_T_TYPE
 
	g__fswÜd_t
;

172 
__STD_TYPE
 
__SSIZE_T_TYPE
 
	g__ssize_t
;

175 
__STD_TYPE
 
__SYSCALL_SLONG_TYPE
 
	g__sysÿÎ_¦Úg_t
;

177 
__STD_TYPE
 
__SYSCALL_ULONG_TYPE
 
	g__sysÿÎ_ulÚg_t
;

181 
__off64_t
 
	t__loff_t
;

182 
__quad_t
 *
	t__qaddr_t
;

183 *
	t__ÿddr_t
;

186 
__STD_TYPE
 
__SWORD_TYPE
 
	g__šŒ_t
;

189 
__STD_TYPE
 
__U32_TYPE
 
	g__sockËn_t
;

192 #undeà
__STD_TYPE


	@/usr/include/bits/uio.h

18 #ià!
defšed
 
_SYS_UIO_H
 && !defšed 
_FCNTL_H


22 #iâdeà
_BITS_UIO_H


23 
	#_BITS_UIO_H
 1

	)

25 
	~<sys/ty³s.h
>

39 
	#UIO_MAXIOV
 1024

	)

43 
	siovec


45 *
	miov_ba£
;

46 
size_t
 
	miov_Ën
;

52 #ifdeà
__USE_GNU


53 #ià
defšed
 
_SYS_UIO_H
 && !defšed 
_BITS_UIO_H_FOR_SYS_UIO_H


54 
	#_BITS_UIO_H_FOR_SYS_UIO_H
 1

	)

56 
__BEGIN_DECLS


59 
ssize_t
 
	$´oûss_vm_»adv
 (
pid_t
 
__pid
, cÚ¡ 
iovec
 *
__lvec
,

60 
__liovút
,

61 cÚ¡ 
iovec
 *
__rvec
,

62 
__riovút
,

63 
__æags
)

64 
__THROW
;

67 
ssize_t
 
	$´oûss_vm_wr™ev
 (
pid_t
 
__pid
, cÚ¡ 
iovec
 *
__lvec
,

68 
__liovút
,

69 cÚ¡ 
iovec
 *
__rvec
,

70 
__riovút
,

71 
__æags
)

72 
__THROW
;

74 
__END_DECLS


	@/usr/include/bits/unistd.h

19 #iâdeà
_UNISTD_H


23 
ssize_t
 
	$__»ad_chk
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

24 
size_t
 
__buæ’
è
__wur
;

25 
ssize_t
 
	`__REDIRECT
 (
__»ad_®Ÿs
, (
__fd
, *
__buf
,

26 
size_t
 
__nby‹s
), 
»ad
è
__wur
;

27 
ssize_t
 
	`__REDIRECT
 (
__»ad_chk_w¬n
,

28 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

29 
size_t
 
__buæ’
), 
__»ad_chk
)

30 
__wur
 
	`__w¬Ç‰r
 ("read called with bigger†engthhan size of "

33 
__fÜtify_funùiÚ
 
__wur
 
ssize_t


34 
	$»ad
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
)

36 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

38 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

39  
	`__»ad_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
	`__bos0
 (__buf));

41 ià(
__nby‹s
 > 
	`__bos0
 (
__buf
))

42  
	`__»ad_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
	`__bos0
 (__buf));

44  
	`__»ad_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
);

45 
	}
}

47 #ifdeà
__USE_UNIX98


48 
ssize_t
 
	$__´—d_chk
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

49 
__off_t
 
__off£t
, 
size_t
 
__bufsize
è
__wur
;

50 
ssize_t
 
	$__´—d64_chk
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

51 
__off64_t
 
__off£t
, 
size_t
 
__bufsize
è
__wur
;

52 
ssize_t
 
	`__REDIRECT
 (
__´—d_®Ÿs
,

53 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

54 
__off_t
 
__off£t
), 
´—d
è
__wur
;

55 
ssize_t
 
	`__REDIRECT
 (
__´—d64_®Ÿs
,

56 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

57 
__off64_t
 
__off£t
), 
´—d64
è
__wur
;

58 
ssize_t
 
	`__REDIRECT
 (
__´—d_chk_w¬n
,

59 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

60 
__off_t
 
__off£t
, 
size_t
 
__bufsize
), 
__´—d_chk
)

61 
__wur
 
	`__w¬Ç‰r
 ("pread called with bigger†engthhan size of "

63 
ssize_t
 
	`__REDIRECT
 (
__´—d64_chk_w¬n
,

64 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
,

65 
__off64_t
 
__off£t
, 
size_t
 
__bufsize
),

66 
__´—d64_chk
)

67 
__wur
 
	`__w¬Ç‰r
 ("pread64 called with bigger†engthhan size of "

70 #iâdeà
__USE_FILE_OFFSET64


71 
__fÜtify_funùiÚ
 
__wur
 
ssize_t


72 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
, 
__off_t
 
__off£t
)

74 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

76 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

77  
	`__´—d_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
, 
	`__bos0
 (__buf));

79 iàĞ
__nby‹s
 > 
	`__bos0
 (
__buf
))

80  
	`__´—d_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
,

81 
	`__bos0
 (
__buf
));

83  
	`__´—d_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
);

84 
	}
}

86 
__fÜtify_funùiÚ
 
__wur
 
ssize_t


87 
	$´—d
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
)

89 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

91 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

92  
	`__´—d64_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
, 
	`__bos0
 (__buf));

94 iàĞ
__nby‹s
 > 
	`__bos0
 (
__buf
))

95  
	`__´—d64_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
,

96 
	`__bos0
 (
__buf
));

99  
	`__´—d64_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
);

100 
	}
}

103 #ifdeà
__USE_LARGEFILE64


104 
__fÜtify_funùiÚ
 
__wur
 
ssize_t


105 
	$´—d64
 (
__fd
, *
__buf
, 
size_t
 
__nby‹s
, 
__off64_t
 
__off£t
)

107 ià(
	`__bos0
 (
__buf
è!ğ(
size_t
) -1)

109 ià(!
	`__butš_cÚ¡ªt_p
 (
__nby‹s
))

110  
	`__´—d64_chk
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
, 
	`__bos0
 (__buf));

112 iàĞ
__nby‹s
 > 
	`__bos0
 (
__buf
))

113  
	`__´—d64_chk_w¬n
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
,

114 
	`__bos0
 (
__buf
));

117  
	`__´—d64_®Ÿs
 (
__fd
, 
__buf
, 
__nby‹s
, 
__off£t
);

118 
	}
}

122 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K


123 
ssize_t
 
	$__»adlšk_chk
 (cÚ¡ *
__»¡riù
 
__·th
,

124 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

125 
size_t
 
__buæ’
)

126 
__THROW
 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

127 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk_®Ÿs
,

128 (cÚ¡ *
__»¡riù
 
__·th
,

129 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
), 
»adlšk
)

130 
	`__nÚnuÎ
 ((1, 2)è
__wur
;

131 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk_chk_w¬n
,

132 (cÚ¡ *
__»¡riù
 
__·th
,

133 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

134 
size_t
 
__buæ’
), 
__»adlšk_chk
)

135 
	`__nÚnuÎ
 ((1, 2)è
__wur
 
	`__w¬Ç‰r
 ("readlink called with bigger†ength "

138 
__fÜtify_funùiÚ
 
	`__nÚnuÎ
 ((1, 2)è
__wur
 
ssize_t


139 
	`__NTH
 (
	$»adlšk
 (cÚ¡ *
__»¡riù
 
__·th
, *__»¡riù 
__buf
,

140 
size_t
 
__Ën
))

142 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

144 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

145  
	`__»adlšk_chk
 (
__·th
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

147 iàĞ
__Ën
 > 
	`__bos
 (
__buf
))

148  
	`__»adlšk_chk_w¬n
 (
__·th
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

150  
	`__»adlšk_®Ÿs
 (
__·th
, 
__buf
, 
__Ën
);

151 
	}
}

154 #ifdeà
__USE_ATFILE


155 
ssize_t
 
	$__»adlšk©_chk
 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

156 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

157 
size_t
 
__buæ’
)

158 
__THROW
 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

159 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk©_®Ÿs
,

160 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

161 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
),

162 
»adlšk©
)

163 
	`__nÚnuÎ
 ((2, 3)è
__wur
;

164 
ssize_t
 
	`__REDIRECT_NTH
 (
__»adlšk©_chk_w¬n
,

165 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

166 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
,

167 
size_t
 
__buæ’
), 
__»adlšk©_chk
)

168 
	`__nÚnuÎ
 ((2, 3)è
__wur
 
	`__w¬Ç‰r
 ("readlinkat called with bigger "

172 
__fÜtify_funùiÚ
 
	`__nÚnuÎ
 ((2, 3)è
__wur
 
ssize_t


173 
	`__NTH
 (
	$»adlšk©
 (
__fd
, cÚ¡ *
__»¡riù
 
__·th
,

174 *
__»¡riù
 
__buf
, 
size_t
 
__Ën
))

176 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

178 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

179  
	`__»adlšk©_chk
 (
__fd
, 
__·th
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

181 ià(
__Ën
 > 
	`__bos
 (
__buf
))

182  
	`__»adlšk©_chk_w¬n
 (
__fd
, 
__·th
, 
__buf
, 
__Ën
,

183 
	`__bos
 (
__buf
));

185  
	`__»adlšk©_®Ÿs
 (
__fd
, 
__·th
, 
__buf
, 
__Ën
);

186 
	}
}

189 *
	$__g‘cwd_chk
 (*
__buf
, 
size_t
 
__size
, size_ˆ
__buæ’
)

190 
__THROW
 
__wur
;

191 *
	`__REDIRECT_NTH
 (
__g‘cwd_®Ÿs
,

192 (*
__buf
, 
size_t
 
__size
), 
g‘cwd
è
__wur
;

193 *
	`__REDIRECT_NTH
 (
__g‘cwd_chk_w¬n
,

194 (*
__buf
, 
size_t
 
__size
, size_ˆ
__buæ’
),

195 
__g‘cwd_chk
)

196 
__wur
 
	`__w¬Ç‰r
 ("getcwd caller with bigger†engthhan size of "

199 
__fÜtify_funùiÚ
 
__wur
 *

200 
	`__NTH
 (
	$g‘cwd
 (*
__buf
, 
size_t
 
__size
))

202 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

204 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
))

205  
	`__g‘cwd_chk
 (
__buf
, 
__size
, 
	`__bos
 (__buf));

207 ià(
__size
 > 
	`__bos
 (
__buf
))

208  
	`__g‘cwd_chk_w¬n
 (
__buf
, 
__size
, 
	`__bos
 (__buf));

210  
	`__g‘cwd_®Ÿs
 (
__buf
, 
__size
);

211 
	}
}

213 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


214 *
	$__g‘wd_chk
 (*
__buf
, 
size_t
 
buæ’
)

215 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

216 *
	`__REDIRECT_NTH
 (
__g‘wd_w¬n
, (*
__buf
), 
g‘wd
)

217 
	`__nÚnuÎ
 ((1)è
__wur
 
	`__w¬Ç‰r
 ("please use getcwd instead,‡s getwd "

220 
__fÜtify_funùiÚ
 
	`__nÚnuÎ
 ((1)è
__©Œibu‹_d•»ÿ‹d__
 
__wur
 *

221 
	`__NTH
 (
	$g‘wd
 (*
__buf
))

223 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

224  
	`__g‘wd_chk
 (
__buf
, 
	`__bos
 (__buf));

225  
	`__g‘wd_w¬n
 (
__buf
);

226 
	}
}

229 
size_t
 
	$__cÚf¡r_chk
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
,

230 
size_t
 
__buæ’
è
__THROW
;

231 
size_t
 
	`__REDIRECT_NTH
 (
__cÚf¡r_®Ÿs
, (
__Çme
, *
__buf
,

232 
size_t
 
__Ën
), 
cÚf¡r
);

233 
size_t
 
	`__REDIRECT_NTH
 (
__cÚf¡r_chk_w¬n
,

234 (
__Çme
, *
__buf
, 
size_t
 
__Ën
,

235 
size_t
 
__buæ’
), 
__cÚf¡r_chk
)

236 
	`__w¬Ç‰r
 ("confstr called with bigger†engthhan size of destination "

239 
__fÜtify_funùiÚ
 
size_t


240 
	`__NTH
 (
	$cÚf¡r
 (
__Çme
, *
__buf
, 
size_t
 
__Ën
))

242 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

244 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

245  
	`__cÚf¡r_chk
 (
__Çme
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

247 ià(
	`__bos
 (
__buf
è< 
__Ën
)

248  
	`__cÚf¡r_chk_w¬n
 (
__Çme
, 
__buf
, 
__Ën
, 
	`__bos
 (__buf));

250  
	`__cÚf¡r_®Ÿs
 (
__Çme
, 
__buf
, 
__Ën
);

251 
	}
}

254 
	$__g‘groups_chk
 (
__size
, 
__gid_t
 
__li¡
[], 
size_t
 
__li¡Ën
)

255 
__THROW
 
__wur
;

256 
	`__REDIRECT_NTH
 (
__g‘groups_®Ÿs
, (
__size
, 
__gid_t
 
__li¡
[]),

257 
g‘groups
è
__wur
;

258 
	`__REDIRECT_NTH
 (
__g‘groups_chk_w¬n
,

259 (
__size
, 
__gid_t
 
__li¡
[], 
size_t
 
__li¡Ën
),

260 
__g‘groups_chk
)

261 
__wur
 
	`__w¬Ç‰r
 ("getgroups called with bigger group counthan what "

264 
__fÜtify_funùiÚ
 

265 
	`__NTH
 (
	$g‘groups
 (
__size
, 
__gid_t
 
__li¡
[]))

267 ià(
	`__bos
 (
__li¡
è!ğ(
size_t
) -1)

269 ià(!
	`__butš_cÚ¡ªt_p
 (
__size
) || __size < 0)

270  
	`__g‘groups_chk
 (
__size
, 
__li¡
, 
	`__bos
 (__list));

272 ià(
__size
 *  (
__gid_t
è> 
	`__bos
 (
__li¡
))

273  
	`__g‘groups_chk_w¬n
 (
__size
, 
__li¡
, 
	`__bos
 (__list));

275  
	`__g‘groups_®Ÿs
 (
__size
, 
__li¡
);

276 
	}
}

279 
	$__‰yÇme_r_chk
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

280 
size_t
 
__Ä—l
è
__THROW
 
	`__nÚnuÎ
 ((2));

281 
	`__REDIRECT_NTH
 (
__‰yÇme_r_®Ÿs
, (
__fd
, *
__buf
,

282 
size_t
 
__buæ’
), 
‰yÇme_r
)

283 
	`__nÚnuÎ
 ((2));

284 
	`__REDIRECT_NTH
 (
__‰yÇme_r_chk_w¬n
,

285 (
__fd
, *
__buf
, 
size_t
 
__buæ’
,

286 
size_t
 
__Ä—l
), 
__‰yÇme_r_chk
)

287 
	`__nÚnuÎ
 ((2)è
	`__w¬Ç‰r
 ("ttyname_r called with bigger buflenhan "

290 
__fÜtify_funùiÚ
 

291 
	`__NTH
 (
	$‰yÇme_r
 (
__fd
, *
__buf
, 
size_t
 
__buæ’
))

293 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

295 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

296  
	`__‰yÇme_r_chk
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

298 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

299  
	`__‰yÇme_r_chk_w¬n
 (
__fd
, 
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

301  
	`__‰yÇme_r_®Ÿs
 (
__fd
, 
__buf
, 
__buæ’
);

302 
	}
}

305 #ià
defšed
 
__USE_REENTRANT
 || defšed 
__USE_POSIX199506


306 
	$__g‘logš_r_chk
 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
)

307 
	`__nÚnuÎ
 ((1));

308 
	`__REDIRECT
 (
__g‘logš_r_®Ÿs
, (*
__buf
, 
size_t
 
__buæ’
),

309 
g‘logš_r
è
	`__nÚnuÎ
 ((1));

310 
	`__REDIRECT
 (
__g‘logš_r_chk_w¬n
,

311 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
),

312 
__g‘logš_r_chk
)

313 
	`__nÚnuÎ
 ((1)è
	`__w¬Ç‰r
 ("getlogin_r called with bigger buflenhan "

316 
__fÜtify_funùiÚ
 

317 
	$g‘logš_r
 (*
__buf
, 
size_t
 
__buæ’
)

319 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

321 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

322  
	`__g‘logš_r_chk
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

324 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

325  
	`__g‘logš_r_chk_w¬n
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

327  
	`__g‘logš_r_®Ÿs
 (
__buf
, 
__buæ’
);

328 
	}
}

332 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_UNIX98


333 
	$__g‘ho¡Çme_chk
 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
)

334 
__THROW
 
	`__nÚnuÎ
 ((1));

335 
	`__REDIRECT_NTH
 (
__g‘ho¡Çme_®Ÿs
, (*
__buf
, 
size_t
 
__buæ’
),

336 
g‘ho¡Çme
è
	`__nÚnuÎ
 ((1));

337 
	`__REDIRECT_NTH
 (
__g‘ho¡Çme_chk_w¬n
,

338 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
),

339 
__g‘ho¡Çme_chk
)

340 
	`__nÚnuÎ
 ((1)è
	`__w¬Ç‰r
 ("gethostname called with bigger buflenhan "

343 
__fÜtify_funùiÚ
 

344 
	`__NTH
 (
	$g‘ho¡Çme
 (*
__buf
, 
size_t
 
__buæ’
))

346 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

348 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

349  
	`__g‘ho¡Çme_chk
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

351 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

352  
	`__g‘ho¡Çme_chk_w¬n
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

354  
	`__g‘ho¡Çme_®Ÿs
 (
__buf
, 
__buæ’
);

355 
	}
}

359 #ià
defšed
 
__USE_MISC
 || (defšed 
__USE_XOPEN
 && !defšed 
__USE_UNIX98
)

360 
	$__g‘domašÇme_chk
 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
)

361 
__THROW
 
	`__nÚnuÎ
 ((1)è
__wur
;

362 
	`__REDIRECT_NTH
 (
__g‘domašÇme_®Ÿs
, (*
__buf
,

363 
size_t
 
__buæ’
),

364 
g‘domašÇme
è
	`__nÚnuÎ
 ((1)è
__wur
;

365 
	`__REDIRECT_NTH
 (
__g‘domašÇme_chk_w¬n
,

366 (*
__buf
, 
size_t
 
__buæ’
, size_ˆ
__Ä—l
),

367 
__g‘domašÇme_chk
)

368 
	`__nÚnuÎ
 ((1)è
__wur
 
	`__w¬Ç‰r
 ("getdomainname called with bigger "

372 
__fÜtify_funùiÚ
 

373 
	`__NTH
 (
	$g‘domašÇme
 (*
__buf
, 
size_t
 
__buæ’
))

375 ià(
	`__bos
 (
__buf
è!ğ(
size_t
) -1)

377 ià(!
	`__butš_cÚ¡ªt_p
 (
__buæ’
))

378  
	`__g‘domašÇme_chk
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

380 ià(
__buæ’
 > 
	`__bos
 (
__buf
))

381  
	`__g‘domašÇme_chk_w¬n
 (
__buf
, 
__buæ’
, 
	`__bos
 (__buf));

383  
	`__g‘domašÇme_®Ÿs
 (
__buf
, 
__buæ’
);

384 
	}
}

	@/usr/include/bits/waitflags.h

19 #ià!
defšed
 
_SYS_WAIT_H
 && !defšed 
_STDLIB_H


25 
	#WNOHANG
 1

	)

26 
	#WUNTRACED
 2

	)

29 
	#WSTOPPED
 2

	)

30 
	#WEXITED
 4

	)

31 
	#WCONTINUED
 8

	)

32 
	#WNOWAIT
 0x01000000

	)

34 
	#__WNOTHREAD
 0x20000000

	)

36 
	#__WALL
 0x40000000

	)

37 
	#__WCLONE
 0x80000000

	)

40 #ià
defšed
 
__USE_XOPEN
 || defšed 
__USE_XOPEN2K8


41 #iâdeà
__ENUM_IDTYPE_T


42 
	#__ENUM_IDTYPE_T
 1

	)

46 #undeà
P_ALL


47 #undeà
P_PID


48 #undeà
P_PGID


52 
	mP_ALL
,

53 
	mP_PID
,

54 
	mP_PGID


55 } 
	tidty³_t
;

	@/usr/include/bits/waitstatus.h

19 #ià!
defšed
 
_SYS_WAIT_H
 && !defšed 
_STDLIB_H


28 
	#__WEXITSTATUS
(
¡©us
è(((¡©usè& 0xff00è>> 8)

	)

31 
	#__WTERMSIG
(
¡©us
è((¡©usè& 0x7f)

	)

34 
	#__WSTOPSIG
(
¡©us
è
	`__WEXITSTATUS
(¡©us)

	)

37 
	#__WIFEXITED
(
¡©us
è(
	`__WTERMSIG
(¡©usè=ğ0)

	)

40 
	#__WIFSIGNALED
(
¡©us
) \

41 (((sigÃd è(((
¡©us
è& 0x7fè+ 1è>> 1è> 0)

	)

44 
	#__WIFSTOPPED
(
¡©us
è(((¡©usè& 0xffè=ğ0x7f)

	)

48 #ifdeà
WCONTINUED


49 
	#__WIFCONTINUED
(
¡©us
è((¡©usè=ğ
__W_CONTINUED
)

	)

53 
	#__WCOREDUMP
(
¡©us
è((¡©usè& 
__WCOREFLAG
)

	)

56 
	#__W_EXITCODE
(
»t
, 
sig
è(Ô‘è<< 8 | (sig))

	)

57 
	#__W_STOPCODE
(
sig
è((sigè<< 8 | 0x7f)

	)

58 
	#__W_CONTINUED
 0xffff

	)

59 
	#__WCOREFLAG
 0x80

	)

	@/usr/include/bits/wordsize.h

3 #ià
defšed
 
__x86_64__
 && !defšed 
__ILP32__


4 
	#__WORDSIZE
 64

	)

6 
	#__WORDSIZE
 32

	)

9 #ifdeà
__x86_64__


10 
	#__WORDSIZE_TIME64_COMPAT32
 1

	)

12 
	#__SYSCALL_WORDSIZE
 64

	)

	@/usr/include/endian.h

18 #iâdef 
_ENDIAN_H


19 
	#_ENDIAN_H
 1

	)

21 
	~<ã©u»s.h
>

31 
	#__LITTLE_ENDIAN
 1234

	)

32 
	#__BIG_ENDIAN
 4321

	)

33 
	#__PDP_ENDIAN
 3412

	)

36 
	~<b™s/’dŸn.h
>

40 #iâdeà
__FLOAT_WORD_ORDER


41 
	#__FLOAT_WORD_ORDER
 
__BYTE_ORDER


	)

44 #ifdef 
__USE_MISC


45 
	#LITTLE_ENDIAN
 
__LITTLE_ENDIAN


	)

46 
	#BIG_ENDIAN
 
__BIG_ENDIAN


	)

47 
	#PDP_ENDIAN
 
__PDP_ENDIAN


	)

48 
	#BYTE_ORDER
 
__BYTE_ORDER


	)

51 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


52 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èLO, 
	)
HI

53 #–ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


54 
	#__LONG_LONG_PAIR
(
HI
, 
LO
èHI, 
	)
LO

58 #ià
defšed
 
__USE_MISC
 && !defšed 
__ASSEMBLER__


60 
	~<b™s/by‹sw­.h
>

62 #ià
__BYTE_ORDER
 =ğ
__LITTLE_ENDIAN


63 
	#htobe16
(
x
è
	`__bsw­_16
 (x)

	)

64 
	#htŞe16
(
x
è(x)

	)

65 
	#be16toh
(
x
è
	`__bsw­_16
 (x)

	)

66 
	#Ë16toh
(
x
è(x)

	)

68 
	#htobe32
(
x
è
	`__bsw­_32
 (x)

	)

69 
	#htŞe32
(
x
è(x)

	)

70 
	#be32toh
(
x
è
	`__bsw­_32
 (x)

	)

71 
	#Ë32toh
(
x
è(x)

	)

73 
	#htobe64
(
x
è
	`__bsw­_64
 (x)

	)

74 
	#htŞe64
(
x
è(x)

	)

75 
	#be64toh
(
x
è
	`__bsw­_64
 (x)

	)

76 
	#Ë64toh
(
x
è(x)

	)

79 
	#htobe16
(
x
è(x)

	)

80 
	#htŞe16
(
x
è
	`__bsw­_16
 (x)

	)

81 
	#be16toh
(
x
è(x)

	)

82 
	#Ë16toh
(
x
è
	`__bsw­_16
 (x)

	)

84 
	#htobe32
(
x
è(x)

	)

85 
	#htŞe32
(
x
è
	`__bsw­_32
 (x)

	)

86 
	#be32toh
(
x
è(x)

	)

87 
	#Ë32toh
(
x
è
	`__bsw­_32
 (x)

	)

89 
	#htobe64
(
x
è(x)

	)

90 
	#htŞe64
(
x
è
	`__bsw­_64
 (x)

	)

91 
	#be64toh
(
x
è(x)

	)

92 
	#Ë64toh
(
x
è
	`__bsw­_64
 (x)

	)

	@/usr/include/getopt.h

19 #iâdeà
_GETOPT_H


21 #iâdeà
__Ãed_g‘İt


22 
	#_GETOPT_H
 1

	)

32 #ià!
defšed
 
__GNU_LIBRARY__


33 
	~<ùy³.h
>

36 #iâdeà
__THROW


37 #iâdeà
__GNUC_PREREQ


38 
	#__GNUC_PREREQ
(
maj
, 
mš
è(0)

	)

40 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

41 
	#__THROW
 
	`throw
 ()

	)

43 
	#__THROW


	)

47 #ifdef 
__ılu¥lus


57 *
İrg
;

71 
İtšd
;

76 
İ‹¼
;

80 
İtİt
;

82 #iâdeà
__Ãed_g‘İt


104 
	sİtiÚ


106 cÚ¡ *
	gÇme
;

109 
	ghas_¬g
;

110 *
	gæag
;

111 
	gv®
;

116 
	#no_¬gum’t
 0

	)

117 
	#»quœed_¬gum’t
 1

	)

118 
	#İtiÚ®_¬gum’t
 2

	)

146 #ifdeà
__GNU_LIBRARY__


150 
g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
, cÚ¡ *
__shÜtİts
)

151 
__THROW
;

153 #ià
defšed
 
__Ãed_g‘İt
 && defšed 
__USE_POSIX2
 \

154 && !
defšed
 
	g__USE_POSIX_IMPLICITLY
 && !defšed 
	g__USE_GNU


158 #ifdeà
__REDIRECT


159 
__REDIRECT_NTH
 (
g‘İt
, (
___¬gc
, *cÚ¡ *
___¬gv
,

160 cÚ¡ *
__shÜtİts
),

161 
__posix_g‘İt
);

163 
__posix_g‘İt
 (
___¬gc
, *cÚ¡ *
___¬gv
,

164 cÚ¡ *
__shÜtİts
è
__THROW
;

165 
	#g‘İt
 
__posix_g‘İt


	)

169 
g‘İt
 ();

172 #iâdeà
__Ãed_g‘İt


173 
g‘İt_lÚg
 (
___¬gc
, *cÚ¡ *
___¬gv
,

174 cÚ¡ *
__shÜtİts
,

175 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

176 
__THROW
;

177 
g‘İt_lÚg_Úly
 (
___¬gc
, *cÚ¡ *
___¬gv
,

178 cÚ¡ *
__shÜtİts
,

179 cÚ¡ 
İtiÚ
 *
__lÚgİts
, *
__lÚgšd
)

180 
__THROW
;

184 #ifdef 
__ılu¥lus


189 #undeà
__Ãed_g‘İt


	@/usr/include/gnu/stubs.h

6 #ià!
defšed
 
__x86_64__


7 
	~<gnu/¡ubs-32.h
>

9 #ià
defšed
 
__x86_64__
 && defšed 
__LP64__


10 
	~<gnu/¡ubs-64.h
>

12 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


13 
	~<gnu/¡ubs-x32.h
>

	@/usr/include/libio.h

28 #iâdeà
_IO_STDIO_H


29 
	#_IO_STDIO_H


	)

31 
	~<_G_cÚfig.h
>

33 
	#_IO_åos_t
 
_G_åos_t


	)

34 
	#_IO_åos64_t
 
_G_åos64_t


	)

35 
	#_IO_size_t
 
size_t


	)

36 
	#_IO_ssize_t
 
__ssize_t


	)

37 
	#_IO_off_t
 
__off_t


	)

38 
	#_IO_off64_t
 
__off64_t


	)

39 
	#_IO_pid_t
 
__pid_t


	)

40 
	#_IO_uid_t
 
__uid_t


	)

41 
	#_IO_icÚv_t
 
_G_icÚv_t


	)

42 
	#_IO_HAVE_ST_BLKSIZE
 
_G_HAVE_ST_BLKSIZE


	)

43 
	#_IO_BUFSIZ
 
_G_BUFSIZ


	)

44 
	#_IO_va_li¡
 
_G_va_li¡


	)

45 
	#_IO_wšt_t
 
wšt_t


	)

48 
	#__Ãed___va_li¡


	)

49 
	~<¡d¬g.h
>

50 #ifdeà
__GNUC_VA_LIST


51 #undeà
_IO_va_li¡


52 
	#_IO_va_li¡
 
__gnuc_va_li¡


	)

55 #iâdeà
__P


56 
	~<sys/cdefs.h
>

59 
	#_IO_UNIFIED_JUMPTABLES
 1

	)

61 #iâdeà
EOF


62 
	#EOF
 (-1)

	)

64 #iâdeà
NULL


65 #ià
defšed
 
__GNUG__
 && \

66 (
	g__GNUC__
 > 2 || (__GNUC__ =ğ2 && 
__GNUC_MINOR__
 >= 8))

67 
	#NULL
 (
__nuÎ
)

	)

69 #ià!
defšed
(
__ılu¥lus
)

70 
	#NULL
 ((*)0)

	)

72 
	#NULL
 (0)

	)

77 
	#_IOS_INPUT
 1

	)

78 
	#_IOS_OUTPUT
 2

	)

79 
	#_IOS_ATEND
 4

	)

80 
	#_IOS_APPEND
 8

	)

81 
	#_IOS_TRUNC
 16

	)

82 
	#_IOS_NOCREATE
 32

	)

83 
	#_IOS_NOREPLACE
 64

	)

84 
	#_IOS_BIN
 128

	)

92 
	#_IO_MAGIC
 0xFBAD0000

	)

93 
	#_OLD_STDIO_MAGIC
 0xFABC0000

	)

94 
	#_IO_MAGIC_MASK
 0xFFFF0000

	)

95 
	#_IO_USER_BUF
 1

	)

96 
	#_IO_UNBUFFERED
 2

	)

97 
	#_IO_NO_READS
 4

	)

98 
	#_IO_NO_WRITES
 8

	)

99 
	#_IO_EOF_SEEN
 0x10

	)

100 
	#_IO_ERR_SEEN
 0x20

	)

101 
	#_IO_DELETE_DONT_CLOSE
 0x40

	)

102 
	#_IO_LINKED
 0x80

	)

103 
	#_IO_IN_BACKUP
 0x100

	)

104 
	#_IO_LINE_BUF
 0x200

	)

105 
	#_IO_TIED_PUT_GET
 0x400

	)

106 
	#_IO_CURRENTLY_PUTTING
 0x800

	)

107 
	#_IO_IS_APPENDING
 0x1000

	)

108 
	#_IO_IS_FILEBUF
 0x2000

	)

109 
	#_IO_BAD_SEEN
 0x4000

	)

110 
	#_IO_USER_LOCK
 0x8000

	)

112 
	#_IO_FLAGS2_MMAP
 1

	)

113 
	#_IO_FLAGS2_NOTCANCEL
 2

	)

114 #ifdeà
_LIBC


115 
	#_IO_FLAGS2_FORTIFY
 4

	)

117 
	#_IO_FLAGS2_USER_WBUF
 8

	)

118 #ifdeà
_LIBC


119 
	#_IO_FLAGS2_SCANF_STD
 16

	)

120 
	#_IO_FLAGS2_NOCLOSE
 32

	)

121 
	#_IO_FLAGS2_CLOEXEC
 64

	)

125 
	#_IO_SKIPWS
 01

	)

126 
	#_IO_LEFT
 02

	)

127 
	#_IO_RIGHT
 04

	)

128 
	#_IO_INTERNAL
 010

	)

129 
	#_IO_DEC
 020

	)

130 
	#_IO_OCT
 040

	)

131 
	#_IO_HEX
 0100

	)

132 
	#_IO_SHOWBASE
 0200

	)

133 
	#_IO_SHOWPOINT
 0400

	)

134 
	#_IO_UPPERCASE
 01000

	)

135 
	#_IO_SHOWPOS
 02000

	)

136 
	#_IO_SCIENTIFIC
 04000

	)

137 
	#_IO_FIXED
 010000

	)

138 
	#_IO_UNITBUF
 020000

	)

139 
	#_IO_STDIO
 040000

	)

140 
	#_IO_DONT_CLOSE
 0100000

	)

141 
	#_IO_BOOLALPHA
 0200000

	)

144 
_IO_jump_t
; 
	g_IO_FILE
;

147 #ifdeà
_IO_MTSAFE_IO


150 
	t_IO_lock_t
;

156 
	s_IO_m¬k”
 {

157 
_IO_m¬k”
 *
	m_Ãxt
;

158 
_IO_FILE
 *
	m_sbuf
;

162 
	m_pos
;

164 
£t_¡»ampos
(
¡»ampos
 
¥
è{ 
	m_¥os
 = sp; }

165 
£t_off£t
(
off£t
è{ 
	m_pos
 = off£t; 
	m_¥os
 = (
¡»ampos
)(-2); }

166 
	mpublic
:

167 
¡»amm¬k”
(
¡»ambuf
 *
sb
);

168 ~
¡»amm¬k”
();

169 
§všg
(è{  
	m_¥os
 == -2; }

170 
d–
(
¡»amm¬k”
&);

171 
d–
();

176 
	e__codecvt_»suÉ


178 
	m__codecvt_ok
,

179 
	m__codecvt_·¹Ÿl
,

180 
	m__codecvt_”rÜ
,

181 
	m__codecvt_nocÚv


184 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


187 
	s_IO_codecvt


189 (*
	m__codecvt_de¡r
è(
	m_IO_codecvt
 *);

190 
__codecvt_»suÉ
 (*
__codecvt_do_out
è(
	m_IO_codecvt
 *,

191 
	m__mb¡©e_t
 *,

192 cÚ¡ 
	mwch¬_t
 *,

193 cÚ¡ 
	mwch¬_t
 *,

194 cÚ¡ 
	mwch¬_t
 **, *,

196 
__codecvt_»suÉ
 (*
__codecvt_do_unshiá
è(
	m_IO_codecvt
 *,

197 
	m__mb¡©e_t
 *, *,

199 
__codecvt_»suÉ
 (*
__codecvt_do_š
è(
	m_IO_codecvt
 *,

200 
	m__mb¡©e_t
 *,

202 cÚ¡ **, 
	mwch¬_t
 *,

203 
	mwch¬_t
 *, wchar_t **);

204 (*
	m__codecvt_do_’codšg
è(
	m_IO_codecvt
 *);

205 (*
	m__codecvt_do_®ways_nocÚv
è(
	m_IO_codecvt
 *);

206 (*
	m__codecvt_do_Ëngth
è(
	m_IO_codecvt
 *, 
	m__mb¡©e_t
 *,

207 cÚ¡ *, cÚ¡ *, 
	m_IO_size_t
);

208 (*
	m__codecvt_do_max_Ëngth
è(
	m_IO_codecvt
 *);

210 
_IO_icÚv_t
 
	m__cd_š
;

211 
_IO_icÚv_t
 
	m__cd_out
;

215 
	s_IO_wide_d©a


217 
wch¬_t
 *
	m_IO_»ad_±r
;

218 
wch¬_t
 *
	m_IO_»ad_’d
;

219 
wch¬_t
 *
	m_IO_»ad_ba£
;

220 
wch¬_t
 *
	m_IO_wr™e_ba£
;

221 
wch¬_t
 *
	m_IO_wr™e_±r
;

222 
wch¬_t
 *
	m_IO_wr™e_’d
;

223 
wch¬_t
 *
	m_IO_buf_ba£
;

224 
wch¬_t
 *
	m_IO_buf_’d
;

226 
wch¬_t
 *
	m_IO_§ve_ba£
;

227 
wch¬_t
 *
	m_IO_backup_ba£
;

229 
wch¬_t
 *
	m_IO_§ve_’d
;

231 
__mb¡©e_t
 
	m_IO_¡©e
;

232 
__mb¡©e_t
 
	m_IO_Ï¡_¡©e
;

233 
_IO_codecvt
 
	m_codecvt
;

235 
wch¬_t
 
	m_shÜtbuf
[1];

237 cÚ¡ 
_IO_jump_t
 *
	m_wide_vbË
;

241 
	s_IO_FILE
 {

242 
	m_æags
;

243 
	#_IO_fe_æags
 
_æags


	)

247 * 
	m_IO_»ad_±r
;

248 * 
	m_IO_»ad_’d
;

249 * 
	m_IO_»ad_ba£
;

250 * 
	m_IO_wr™e_ba£
;

251 * 
	m_IO_wr™e_±r
;

252 * 
	m_IO_wr™e_’d
;

253 * 
	m_IO_buf_ba£
;

254 * 
	m_IO_buf_’d
;

256 *
	m_IO_§ve_ba£
;

257 *
	m_IO_backup_ba£
;

258 *
	m_IO_§ve_’d
;

260 
_IO_m¬k”
 *
	m_m¬k”s
;

262 
_IO_FILE
 *
	m_chaš
;

264 
	m_f’o
;

266 
	m_blksize
;

268 
	m_æags2
;

270 
_IO_off_t
 
	m_Şd_off£t
;

272 
	#__HAVE_COLUMN


	)

274 
	m_cur_cŞumn
;

275 sigÃd 
	m_vbË_off£t
;

276 
	m_shÜtbuf
[1];

280 
_IO_lock_t
 *
	m_lock
;

281 #ifdeà
_IO_USE_OLD_IO_FILE


284 
	s_IO_FILE_com¶‘e


286 
_IO_FILE
 
	m_fe
;

288 #ià
defšed
 
_G_IO_IO_FILE_VERSION
 && _G_IO_IO_FILE_VERSION == 0x20001

289 
_IO_off64_t
 
	m_off£t
;

290 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


292 
_IO_codecvt
 *
	m_codecvt
;

293 
_IO_wide_d©a
 *
	m_wide_d©a
;

294 
_IO_FILE
 *
	m_ä“»s_li¡
;

295 *
	m_ä“»s_buf
;

297 *
	m__·d1
;

298 *
	m__·d2
;

299 *
	m__·d3
;

300 *
	m__·d4
;

302 
size_t
 
	m__·d5
;

303 
	m_mode
;

305 
	m_unu£d2
[15 *  (è- 4 *  (*è-  (
size_t
)];

309 #iâdeà
__ılu¥lus


310 
_IO_FILE
 
	t_IO_FILE
;

313 
	g_IO_FILE_¶us
;

315 
_IO_FILE_¶us
 
_IO_2_1_¡dš_
;

316 
_IO_FILE_¶us
 
_IO_2_1_¡dout_
;

317 
_IO_FILE_¶us
 
_IO_2_1_¡d”r_
;

318 #iâdeà
_LIBC


319 
	#_IO_¡dš
 ((
_IO_FILE
*)(&
_IO_2_1_¡dš_
))

	)

320 
	#_IO_¡dout
 ((
_IO_FILE
*)(&
_IO_2_1_¡dout_
))

	)

321 
	#_IO_¡d”r
 ((
_IO_FILE
*)(&
_IO_2_1_¡d”r_
))

	)

323 
_IO_FILE
 *
_IO_¡dš
 
©Œibu‹_hidd’
;

324 
_IO_FILE
 *
_IO_¡dout
 
©Œibu‹_hidd’
;

325 
_IO_FILE
 *
_IO_¡d”r
 
©Œibu‹_hidd’
;

333 
__ssize_t
 
	t__io_»ad_â
 (*
	t__cook›
, *
	t__buf
, 
	tsize_t
 
	t__nby‹s
);

341 
__ssize_t
 
	t__io_wr™e_â
 (*
	t__cook›
, cÚ¡ *
	t__buf
,

342 
	tsize_t
 
	t__n
);

350 
	t__io_£ek_â
 (*
	t__cook›
, 
	t_IO_off64_t
 *
	t__pos
, 
	t__w
);

353 
	t__io_şo£_â
 (*
	t__cook›
);

356 #ifdeà
_GNU_SOURCE


358 
__io_»ad_â
 
	tcook›_»ad_funùiÚ_t
;

359 
__io_wr™e_â
 
	tcook›_wr™e_funùiÚ_t
;

360 
__io_£ek_â
 
	tcook›_£ek_funùiÚ_t
;

361 
__io_şo£_â
 
	tcook›_şo£_funùiÚ_t
;

366 
__io_»ad_â
 *
	m»ad
;

367 
__io_wr™e_â
 *
	mwr™e
;

368 
__io_£ek_â
 *
	m£ek
;

369 
__io_şo£_â
 *
	mşo£
;

370 } 
	t_IO_cook›_io_funùiÚs_t
;

371 
_IO_cook›_io_funùiÚs_t
 
	tcook›_io_funùiÚs_t
;

373 
	g_IO_cook›_fe
;

376 
_IO_cook›_š™
 (
_IO_cook›_fe
 *
__cfe
, 
__»ad_wr™e
,

377 *
__cook›
, 
_IO_cook›_io_funùiÚs_t
 
__âs
);

381 #ifdeà
__ılu¥lus


385 
__und”æow
 (
_IO_FILE
 *);

386 
__uæow
 (
_IO_FILE
 *);

387 
__ov”æow
 (
_IO_FILE
 *, );

388 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


389 
_IO_wšt_t
 
__wund”æow
 (
_IO_FILE
 *);

390 
_IO_wšt_t
 
__wuæow
 (
_IO_FILE
 *);

391 
_IO_wšt_t
 
__wov”æow
 (
_IO_FILE
 *, _IO_wint_t);

394 #ià 
__GNUC__
 >= 3

395 
	#_IO_BE
(
ex´
, 
»s
è
	`__butš_ex³ù
 (Óx´),„es)

	)

397 
	#_IO_BE
(
ex´
, 
»s
èÓx´)

	)

400 
	#_IO_g‘c_uÆocked
(
_å
) \

401 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

402 ? 
	`__uæow
 (
_å
è: *(*è(_å)->
_IO_»ad_±r
++)

	)

403 
	#_IO_³ekc_uÆocked
(
_å
) \

404 (
	`_IO_BE
 ((
_å
)->
_IO_»ad_±r
 >ğ(_å)->
_IO_»ad_’d
, 0) \

405 && 
	`__und”æow
 (
_å
è=ğ
EOF
 ? EOF \

406 : *(*è(
_å
)->
_IO_»ad_±r
)

	)

407 
	#_IO_putc_uÆocked
(
_ch
, 
_å
) \

408 (
	`_IO_BE
 ((
_å
)->
_IO_wr™e_±r
 >ğ(_å)->
_IO_wr™e_’d
, 0) \

409 ? 
	`__ov”æow
 (
_å
, (è(
_ch
)) \

410 : (è(*(
_å
)->
_IO_wr™e_±r
++ = (
_ch
)))

	)

412 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


413 
	#_IO_g‘wc_uÆocked
(
_å
) \

414 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

415 || ((
_å
)->
_wide_d©a
->
_IO_»ad_±r
 \

416 >ğ(
_å
)->
_wide_d©a
->
_IO_»ad_’d
), 0) \

417 ? 
	`__wuæow
 (
_å
è: (
_IO_wšt_t
è*(_å)->
_wide_d©a
->
_IO_»ad_±r
++)

	)

418 
	#_IO_putwc_uÆocked
(
_wch
, 
_å
) \

419 (
	`_IO_BE
 ((
_å
)->
_wide_d©a
 =ğ
NULL
 \

420 || ((
_å
)->
_wide_d©a
->
_IO_wr™e_±r
 \

421 >ğ(
_å
)->
_wide_d©a
->
_IO_wr™e_’d
), 0) \

422 ? 
	`__wov”æow
 (
_å
, 
_wch
) \

423 : (
_IO_wšt_t
è(*(
_å
)->
_wide_d©a
->
_IO_wr™e_±r
++ = (
_wch
)))

	)

426 
	#_IO_ãof_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_EOF_SEEN
è!ğ0)

	)

427 
	#_IO_ã¼Ü_uÆocked
(
__å
è(((__å)->
_æags
 & 
_IO_ERR_SEEN
è!ğ0)

	)

429 
_IO_g‘c
 (
_IO_FILE
 *
__å
);

430 
_IO_putc
 (
__c
, 
_IO_FILE
 *
__å
);

431 
_IO_ãof
 (
_IO_FILE
 *
__å
è
__THROW
;

432 
_IO_ã¼Ü
 (
_IO_FILE
 *
__å
è
__THROW
;

434 
_IO_³ekc_locked
 (
_IO_FILE
 *
__å
);

437 
	#_IO_PENDING_OUTPUT_COUNT
(
_å
) \

438 ((
_å
)->
_IO_wr™e_±r
 - (_å)->
_IO_wr™e_ba£
)

	)

440 
_IO_æockfe
 (
_IO_FILE
 *è
__THROW
;

441 
_IO_fuÆockfe
 (
_IO_FILE
 *è
__THROW
;

442 
_IO_árylockfe
 (
_IO_FILE
 *è
__THROW
;

444 #ifdeà
_IO_MTSAFE_IO


445 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_locked
 (_å)

	)

446 
	#_IO_æockfe
(
_å
) \

447 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_æockfe
 (_å)

	)

448 
	#_IO_fuÆockfe
(
_å
) \

449 ià(((
_å
)->
_æags
 & 
_IO_USER_LOCK
è=ğ0è
	`_IO_fuÆockfe
 (_å)

	)

451 
	#_IO_³ekc
(
_å
è
	`_IO_³ekc_uÆocked
 (_å)

	)

452 
	#_IO_æockfe
(
_å
è

	)

453 
	#_IO_fuÆockfe
(
_å
è

	)

454 
	#_IO_árylockfe
(
_å
è

	)

455 
	#_IO_ş—nup_»giÚ_¡¬t
(
_fù
, 
_å
è

	)

456 
	#_IO_ş—nup_»giÚ_’d
(
_Do™
è

	)

459 
_IO_vfsÿnf
 (
_IO_FILE
 * 
__»¡riù
, const * __restrict,

460 
_IO_va_li¡
, *
__»¡riù
);

461 
_IO_vårštf
 (
_IO_FILE
 *
__»¡riù
, const *__restrict,

462 
_IO_va_li¡
);

463 
_IO_ssize_t
 
_IO_·dn
 (
_IO_FILE
 *, , _IO_ssize_t);

464 
_IO_size_t
 
_IO_sg‘n
 (
_IO_FILE
 *, *, _IO_size_t);

466 
_IO_off64_t
 
_IO_£ekoff
 (
_IO_FILE
 *, _IO_off64_t, , );

467 
_IO_off64_t
 
_IO_£ekpos
 (
_IO_FILE
 *, _IO_off64_t, );

469 
_IO_ä“_backup_¬—
 (
_IO_FILE
 *è
__THROW
;

471 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


472 
_IO_wšt_t
 
_IO_g‘wc
 (
_IO_FILE
 *
__å
);

473 
_IO_wšt_t
 
_IO_putwc
 (
wch¬_t
 
__wc
, 
_IO_FILE
 *
__å
);

474 
_IO_fwide
 (
_IO_FILE
 *
__å
, 
__mode
è
__THROW
;

475 #ià
__GNUC__
 >= 2

478 #ià
defšed
 
_LIBC
 && defšed 
SHARED


479 
	~<shlib-com·t.h
>

480 #ià
SHLIB_COMPAT
 (
libc
, 
GLIBC_2_0
, 
GLIBC_2_1
)

481 
	#_IO_fwide_maybe_šcom·tibË
 \

482 (
	`__butš_ex³ù
 (&
_IO_¡dš_u£d
 =ğ
NULL
, 0))

	)

483 cÚ¡ 
_IO_¡dš_u£d
;

484 
w—k_ex‹º
 (
_IO_¡dš_u£d
);

487 #iâdeà
_IO_fwide_maybe_šcom·tibË


488 
	#_IO_fwide_maybe_šcom·tibË
 (0)

	)

492 
	#_IO_fwide
(
__å
, 
__mode
) \

493 ({ 
__»suÉ
 = (
__mode
); \

494 ià(
__»suÉ
 < 0 && ! 
_IO_fwide_maybe_šcom·tibË
) \

496 ià((
__å
)->
_mode
 == 0) \

498 (
__å
)->
_mode
 = -1; \

499 
__»suÉ
 = (
__å
)->
_mode
; \

501 ià(
	`__butš_cÚ¡ªt_p
 (
__mode
) && (__mode) == 0) \

502 
__»suÉ
 = 
_IO_fwide_maybe_šcom·tibË
 ? -1 : (
__å
)->
_mode
; \

504 
__»suÉ
 = 
	`_IO_fwide
 (
__å
, __result); \

505 
__»suÉ
; })

	)

508 
_IO_vfwsÿnf
 (
_IO_FILE
 * 
__»¡riù
, cÚ¡ 
wch¬_t
 * __restrict,

509 
_IO_va_li¡
, *
__»¡riù
);

510 
_IO_vfw´štf
 (
_IO_FILE
 *
__»¡riù
, cÚ¡ 
wch¬_t
 *__restrict,

511 
_IO_va_li¡
);

512 
_IO_ssize_t
 
_IO_w·dn
 (
_IO_FILE
 *, 
wšt_t
, _IO_ssize_t);

513 
_IO_ä“_wbackup_¬—
 (
_IO_FILE
 *è
__THROW
;

516 #ifdeà
__LDBL_COMPAT


517 
	~<b™s/libio-ldbl.h
>

520 #ifdeà
__ılu¥lus


	@/usr/include/limits.h

22 #iâdeà
_LIBC_LIMITS_H_


23 
	#_LIBC_LIMITS_H_
 1

	)

25 
	~<ã©u»s.h
>

31 
	#MB_LEN_MAX
 16

	)

36 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

41 #iâdeà
_LIMITS_H


42 
	#_LIMITS_H
 1

	)

44 
	~<b™s/wÜdsize.h
>

53 
	#CHAR_BIT
 8

	)

56 
	#SCHAR_MIN
 (-128)

	)

57 
	#SCHAR_MAX
 127

	)

60 
	#UCHAR_MAX
 255

	)

63 #ifdeà
__CHAR_UNSIGNED__


64 
	#CHAR_MIN
 0

	)

65 
	#CHAR_MAX
 
UCHAR_MAX


	)

67 
	#CHAR_MIN
 
SCHAR_MIN


	)

68 
	#CHAR_MAX
 
SCHAR_MAX


	)

72 
	#SHRT_MIN
 (-32768)

	)

73 
	#SHRT_MAX
 32767

	)

76 
	#USHRT_MAX
 65535

	)

79 
	#INT_MIN
 (-
INT_MAX
 - 1)

	)

80 
	#INT_MAX
 2147483647

	)

83 
	#UINT_MAX
 4294967295U

	)

86 #ià
__WORDSIZE
 == 64

87 
	#LONG_MAX
 9223372036854775807L

	)

89 
	#LONG_MAX
 2147483647L

	)

91 
	#LONG_MIN
 (-
LONG_MAX
 - 1L)

	)

94 #ià
__WORDSIZE
 == 64

95 
	#ULONG_MAX
 18446744073709551615UL

	)

97 
	#ULONG_MAX
 4294967295UL

	)

100 #ifdeà
__USE_ISOC99


103 
	#LLONG_MAX
 9223372036854775807LL

	)

104 
	#LLONG_MIN
 (-
LLONG_MAX
 - 1LL)

	)

107 
	#ULLONG_MAX
 18446744073709551615ULL

	)

121 #ià
defšed
 
__GNUC__
 && !defšed 
_GCC_LIMITS_H_


123 #šşude_Ãxˆ<
lim™s
.
h
>

129 #ià
defšed
 
__USE_ISOC99
 && defšed 
__GNUC__


130 #iâdeà
LLONG_MIN


131 
	#LLONG_MIN
 (-
LLONG_MAX
-1)

	)

133 #iâdeà
LLONG_MAX


134 
	#LLONG_MAX
 
__LONG_LONG_MAX__


	)

136 #iâdeà
ULLONG_MAX


137 
	#ULLONG_MAX
 (
LLONG_MAX
 * 2ULL + 1)

	)

141 #ifdef 
__USE_POSIX


143 
	~<b™s/posix1_lim.h
>

146 #ifdef 
__USE_POSIX2


147 
	~<b™s/posix2_lim.h
>

150 #ifdef 
__USE_XOPEN


151 
	~<b™s/xİ’_lim.h
>

	@/usr/include/linux/filter.h

5 #iâdeà
__LINUX_FILTER_H__


6 
	#__LINUX_FILTER_H__


	)

9 
	~<lšux/ty³s.h
>

10 
	~<lšux/bpf_commÚ.h
>

15 
	#BPF_MAJOR_VERSION
 1

	)

16 
	#BPF_MINOR_VERSION
 1

	)

23 
	ssock_f‹r
 {

24 
__u16
 
	mcode
;

25 
__u8
 
	mjt
;

26 
__u8
 
	mjf
;

27 
__u32
 
	mk
;

30 
	ssock_årog
 {

31 
	mËn
;

32 
sock_f‹r
 *
	mf‹r
;

36 
	#BPF_RVAL
(
code
è((codeè& 0x18)

	)

37 
	#BPF_A
 0x10

	)

40 
	#BPF_MISCOP
(
code
è((codeè& 0xf8)

	)

41 
	#BPF_TAX
 0x00

	)

42 
	#BPF_TXA
 0x80

	)

47 #iâdeà
BPF_STMT


48 
	#BPF_STMT
(
code
, 
k
è{ ()(code), 0, 0, k }

	)

50 #iâdeà
BPF_JUMP


51 
	#BPF_JUMP
(
code
, 
k
, 
jt
, 
jf
è{ ()(code), jt, jf, k }

	)

57 
	#BPF_MEMWORDS
 16

	)

64 
	#SKF_AD_OFF
 (-0x1000)

	)

65 
	#SKF_AD_PROTOCOL
 0

	)

66 
	#SKF_AD_PKTTYPE
 4

	)

67 
	#SKF_AD_IFINDEX
 8

	)

68 
	#SKF_AD_NLATTR
 12

	)

69 
	#SKF_AD_NLATTR_NEST
 16

	)

70 
	#SKF_AD_MARK
 20

	)

71 
	#SKF_AD_QUEUE
 24

	)

72 
	#SKF_AD_HATYPE
 28

	)

73 
	#SKF_AD_RXHASH
 32

	)

74 
	#SKF_AD_CPU
 36

	)

75 
	#SKF_AD_ALU_XOR_X
 40

	)

76 
	#SKF_AD_VLAN_TAG
 44

	)

77 
	#SKF_AD_VLAN_TAG_PRESENT
 48

	)

78 
	#SKF_AD_PAY_OFFSET
 52

	)

79 
	#SKF_AD_RANDOM
 56

	)

80 
	#SKF_AD_VLAN_TPID
 60

	)

81 
	#SKF_AD_MAX
 64

	)

83 
	#SKF_NET_OFF
 (-0x100000)

	)

84 
	#SKF_LL_OFF
 (-0x200000)

	)

86 
	#BPF_NET_OFF
 
SKF_NET_OFF


	)

87 
	#BPF_LL_OFF
 
SKF_LL_OFF


	)

	@/usr/include/linux/hdlc/ioctl.h

1 #iâdeà
__HDLC_IOCTL_H__


2 
	#__HDLC_IOCTL_H__


	)

5 
	#GENERIC_HDLC_VERSION
 4

	)

7 
	#CLOCK_DEFAULT
 0

	)

8 
	#CLOCK_EXT
 1

	)

9 
	#CLOCK_INT
 2

	)

10 
	#CLOCK_TXINT
 3

	)

11 
	#CLOCK_TXFROMRX
 4

	)

14 
	#ENCODING_DEFAULT
 0

	)

15 
	#ENCODING_NRZ
 1

	)

16 
	#ENCODING_NRZI
 2

	)

17 
	#ENCODING_FM_MARK
 3

	)

18 
	#ENCODING_FM_SPACE
 4

	)

19 
	#ENCODING_MANCHESTER
 5

	)

22 
	#PARITY_DEFAULT
 0

	)

23 
	#PARITY_NONE
 1

	)

24 
	#PARITY_CRC16_PR0
 2

	)

25 
	#PARITY_CRC16_PR1
 3

	)

26 
	#PARITY_CRC16_PR0_CCITT
 4

	)

27 
	#PARITY_CRC16_PR1_CCITT
 5

	)

28 
	#PARITY_CRC32_PR0_CCITT
 6

	)

29 
	#PARITY_CRC32_PR1_CCITT
 7

	)

31 
	#LMI_DEFAULT
 0

	)

32 
	#LMI_NONE
 1

	)

33 
	#LMI_ANSI
 2

	)

34 
	#LMI_CCITT
 3

	)

35 
	#LMI_CISCO
 4

	)

37 #iâdeà
__ASSEMBLY__


40 
	mşock_¿‹
;

41 
	mşock_ty³
;

42 
	mloİback
;

43 } 
	tsync_£rŸl_£‰šgs
;

46 
	mşock_¿‹
;

47 
	mşock_ty³
;

48 
	mloİback
;

49 
	m¦Ù_m­
;

50 } 
	t‹1_£‰šgs
;

53 
	m’codšg
;

54 
	m·r™y
;

55 } 
	t¿w_hdlc_´Ùo
;

58 
	mt391
;

59 
	mt392
;

60 
	mn391
;

61 
	mn392
;

62 
	mn393
;

63 
	mlmi
;

64 
	mdû
;

65 } 
	tä_´Ùo
;

68 
	mdlci
;

69 } 
	tä_´Ùo_pvc
;

72 
	mdlci
;

73 
	mma¡”
[
IFNAMSIZ
];

74 }
	tä_´Ùo_pvc_šfo
;

77 
	mš‹rv®
;

78 
	mtimeout
;

79 } 
	tcisco_´Ùo
;

	@/usr/include/linux/if_addr.h

1 #iâdeà
__LINUX_IF_ADDR_H


2 
	#__LINUX_IF_ADDR_H


	)

4 
	~<lšux/ty³s.h
>

5 
	~<lšux/Ãšk.h
>

7 
	siçddrmsg
 {

8 
__u8
 
	miç_çmy
;

9 
__u8
 
	miç_´efixËn
;

10 
__u8
 
	miç_æags
;

11 
__u8
 
	miç_scİe
;

12 
__u32
 
	miç_šdex
;

26 
	mIFA_UNSPEC
,

27 
	mIFA_ADDRESS
,

28 
	mIFA_LOCAL
,

29 
	mIFA_LABEL
,

30 
	mIFA_BROADCAST
,

31 
	mIFA_ANYCAST
,

32 
	mIFA_CACHEINFO
,

33 
	mIFA_MULTICAST
,

34 
	mIFA_FLAGS
,

35 
	m__IFA_MAX
,

38 
	#IFA_MAX
 (
__IFA_MAX
 - 1)

	)

41 
	#IFA_F_SECONDARY
 0x01

	)

42 
	#IFA_F_TEMPORARY
 
IFA_F_SECONDARY


	)

44 
	#IFA_F_NODAD
 0x02

	)

45 
	#IFA_F_OPTIMISTIC
 0x04

	)

46 
	#IFA_F_DADFAILED
 0x08

	)

47 
	#IFA_F_HOMEADDRESS
 0x10

	)

48 
	#IFA_F_DEPRECATED
 0x20

	)

49 
	#IFA_F_TENTATIVE
 0x40

	)

50 
	#IFA_F_PERMANENT
 0x80

	)

51 
	#IFA_F_MANAGETEMPADDR
 0x100

	)

52 
	#IFA_F_NOPREFIXROUTE
 0x200

	)

53 
	#IFA_F_MCAUTOJOIN
 0x400

	)

54 
	#IFA_F_STABLE_PRIVACY
 0x800

	)

56 
	siç_ÿchešfo
 {

57 
__u32
 
	miç_´eã»d
;

58 
__u32
 
	miç_v®id
;

59 
__u32
 
	mc¡amp
;

60 
__u32
 
	mt¡amp
;

64 
	#IFA_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
içddrmsg
))))

	)

65 
	#IFA_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
içddrmsg
))

	)

	@/usr/include/linux/if_link.h

1 #iâdeà
_LINUX_IF_LINK_H


2 
	#_LINUX_IF_LINK_H


	)

4 
	~<lšux/ty³s.h
>

5 
	~<lšux/Ãšk.h
>

8 
	s¹Æ_lšk_¡©s
 {

9 
__u32
 
	mrx_·ck‘s
;

10 
__u32
 
	mtx_·ck‘s
;

11 
__u32
 
	mrx_by‹s
;

12 
__u32
 
	mtx_by‹s
;

13 
__u32
 
	mrx_”rÜs
;

14 
__u32
 
	mtx_”rÜs
;

15 
__u32
 
	mrx_drİ³d
;

16 
__u32
 
	mtx_drİ³d
;

17 
__u32
 
	mmuÉiÿ¡
;

18 
__u32
 
	mcŞlisiÚs
;

21 
__u32
 
	mrx_Ëngth_”rÜs
;

22 
__u32
 
	mrx_ov”_”rÜs
;

23 
__u32
 
	mrx_üc_”rÜs
;

24 
__u32
 
	mrx_äame_”rÜs
;

25 
__u32
 
	mrx_fifo_”rÜs
;

26 
__u32
 
	mrx_mis£d_”rÜs
;

29 
__u32
 
	mtx_abÜ‹d_”rÜs
;

30 
__u32
 
	mtx_ÿ¼›r_”rÜs
;

31 
__u32
 
	mtx_fifo_”rÜs
;

32 
__u32
 
	mtx_h—¹b—t_”rÜs
;

33 
__u32
 
	mtx_wšdow_”rÜs
;

36 
__u32
 
	mrx_com´es£d
;

37 
__u32
 
	mtx_com´es£d
;

39 
__u32
 
	mrx_nohªdËr
;

43 
	s¹Æ_lšk_¡©s64
 {

44 
__u64
 
	mrx_·ck‘s
;

45 
__u64
 
	mtx_·ck‘s
;

46 
__u64
 
	mrx_by‹s
;

47 
__u64
 
	mtx_by‹s
;

48 
__u64
 
	mrx_”rÜs
;

49 
__u64
 
	mtx_”rÜs
;

50 
__u64
 
	mrx_drİ³d
;

51 
__u64
 
	mtx_drİ³d
;

52 
__u64
 
	mmuÉiÿ¡
;

53 
__u64
 
	mcŞlisiÚs
;

56 
__u64
 
	mrx_Ëngth_”rÜs
;

57 
__u64
 
	mrx_ov”_”rÜs
;

58 
__u64
 
	mrx_üc_”rÜs
;

59 
__u64
 
	mrx_äame_”rÜs
;

60 
__u64
 
	mrx_fifo_”rÜs
;

61 
__u64
 
	mrx_mis£d_”rÜs
;

64 
__u64
 
	mtx_abÜ‹d_”rÜs
;

65 
__u64
 
	mtx_ÿ¼›r_”rÜs
;

66 
__u64
 
	mtx_fifo_”rÜs
;

67 
__u64
 
	mtx_h—¹b—t_”rÜs
;

68 
__u64
 
	mtx_wšdow_”rÜs
;

71 
__u64
 
	mrx_com´es£d
;

72 
__u64
 
	mtx_com´es£d
;

74 
__u64
 
	mrx_nohªdËr
;

78 
	s¹Æ_lšk_ifm­
 {

79 
__u64
 
	mmem_¡¬t
;

80 
__u64
 
	mmem_’d
;

81 
__u64
 
	mba£_addr
;

82 
__u16
 
	mœq
;

83 
__u8
 
	mdma
;

84 
__u8
 
	mpÜt
;

106 
	mIFLA_UNSPEC
,

107 
	mIFLA_ADDRESS
,

108 
	mIFLA_BROADCAST
,

109 
	mIFLA_IFNAME
,

110 
	mIFLA_MTU
,

111 
	mIFLA_LINK
,

112 
	mIFLA_QDISC
,

113 
	mIFLA_STATS
,

114 
	mIFLA_COST
,

115 
	#IFLA_COST
 
IFLA_COST


	)

116 
	mIFLA_PRIORITY
,

117 
	#IFLA_PRIORITY
 
IFLA_PRIORITY


	)

118 
	mIFLA_MASTER
,

119 
	#IFLA_MASTER
 
IFLA_MASTER


	)

120 
	mIFLA_WIRELESS
,

121 
	#IFLA_WIRELESS
 
IFLA_WIRELESS


	)

122 
	mIFLA_PROTINFO
,

123 
	#IFLA_PROTINFO
 
IFLA_PROTINFO


	)

124 
	mIFLA_TXQLEN
,

125 
	#IFLA_TXQLEN
 
IFLA_TXQLEN


	)

126 
	mIFLA_MAP
,

127 
	#IFLA_MAP
 
IFLA_MAP


	)

128 
	mIFLA_WEIGHT
,

129 
	#IFLA_WEIGHT
 
IFLA_WEIGHT


	)

130 
	mIFLA_OPERSTATE
,

131 
	mIFLA_LINKMODE
,

132 
	mIFLA_LINKINFO
,

133 
	#IFLA_LINKINFO
 
IFLA_LINKINFO


	)

134 
	mIFLA_NET_NS_PID
,

135 
	mIFLA_IFALIAS
,

136 
	mIFLA_NUM_VF
,

137 
	mIFLA_VFINFO_LIST
,

138 
	mIFLA_STATS64
,

139 
	mIFLA_VF_PORTS
,

140 
	mIFLA_PORT_SELF
,

141 
	mIFLA_AF_SPEC
,

142 
	mIFLA_GROUP
,

143 
	mIFLA_NET_NS_FD
,

144 
	mIFLA_EXT_MASK
,

145 
	mIFLA_PROMISCUITY
,

146 
	#IFLA_PROMISCUITY
 
IFLA_PROMISCUITY


	)

147 
	mIFLA_NUM_TX_QUEUES
,

148 
	mIFLA_NUM_RX_QUEUES
,

149 
	mIFLA_CARRIER
,

150 
	mIFLA_PHYS_PORT_ID
,

151 
	mIFLA_CARRIER_CHANGES
,

152 
	mIFLA_PHYS_SWITCH_ID
,

153 
	mIFLA_LINK_NETNSID
,

154 
	mIFLA_PHYS_PORT_NAME
,

155 
	mIFLA_PROTO_DOWN
,

156 
	mIFLA_GSO_MAX_SEGS
,

157 
	mIFLA_GSO_MAX_SIZE
,

158 
	mIFLA_PAD
,

159 
	mIFLA_XDP
,

160 
	m__IFLA_MAX


164 
	#IFLA_MAX
 (
__IFLA_MAX
 - 1)

	)

167 
	#IFLA_RTA
(
r
è((
¹©Œ
*)(((*)Ô)è+ 
	`NLMSG_ALIGN
((
ifšfomsg
))))

	)

168 
	#IFLA_PAYLOAD
(
n
è
	`NLMSG_PAYLOAD
Ò,(
ifšfomsg
))

	)

171 
	mIFLA_INET_UNSPEC
,

172 
	mIFLA_INET_CONF
,

173 
	m__IFLA_INET_MAX
,

176 
	#IFLA_INET_MAX
 (
__IFLA_INET_MAX
 - 1)

	)

209 
	mIFLA_INET6_UNSPEC
,

210 
	mIFLA_INET6_FLAGS
,

211 
	mIFLA_INET6_CONF
,

212 
	mIFLA_INET6_STATS
,

213 
	mIFLA_INET6_MCAST
,

214 
	mIFLA_INET6_CACHEINFO
,

215 
	mIFLA_INET6_ICMP6STATS
,

216 
	mIFLA_INET6_TOKEN
,

217 
	mIFLA_INET6_ADDR_GEN_MODE
,

218 
	m__IFLA_INET6_MAX


221 
	#IFLA_INET6_MAX
 (
__IFLA_INET6_MAX
 - 1)

	)

223 
	eš6_addr_g’_mode
 {

224 
	mIN6_ADDR_GEN_MODE_EUI64
,

225 
	mIN6_ADDR_GEN_MODE_NONE
,

226 
	mIN6_ADDR_GEN_MODE_STABLE_PRIVACY
,

227 
	mIN6_ADDR_GEN_MODE_RANDOM
,

233 
	mIFLA_BR_UNSPEC
,

234 
	mIFLA_BR_FORWARD_DELAY
,

235 
	mIFLA_BR_HELLO_TIME
,

236 
	mIFLA_BR_MAX_AGE
,

237 
	mIFLA_BR_AGEING_TIME
,

238 
	mIFLA_BR_STP_STATE
,

239 
	mIFLA_BR_PRIORITY
,

240 
	mIFLA_BR_VLAN_FILTERING
,

241 
	mIFLA_BR_VLAN_PROTOCOL
,

242 
	mIFLA_BR_GROUP_FWD_MASK
,

243 
	mIFLA_BR_ROOT_ID
,

244 
	mIFLA_BR_BRIDGE_ID
,

245 
	mIFLA_BR_ROOT_PORT
,

246 
	mIFLA_BR_ROOT_PATH_COST
,

247 
	mIFLA_BR_TOPOLOGY_CHANGE
,

248 
	mIFLA_BR_TOPOLOGY_CHANGE_DETECTED
,

249 
	mIFLA_BR_HELLO_TIMER
,

250 
	mIFLA_BR_TCN_TIMER
,

251 
	mIFLA_BR_TOPOLOGY_CHANGE_TIMER
,

252 
	mIFLA_BR_GC_TIMER
,

253 
	mIFLA_BR_GROUP_ADDR
,

254 
	mIFLA_BR_FDB_FLUSH
,

255 
	mIFLA_BR_MCAST_ROUTER
,

256 
	mIFLA_BR_MCAST_SNOOPING
,

257 
	mIFLA_BR_MCAST_QUERY_USE_IFADDR
,

258 
	mIFLA_BR_MCAST_QUERIER
,

259 
	mIFLA_BR_MCAST_HASH_ELASTICITY
,

260 
	mIFLA_BR_MCAST_HASH_MAX
,

261 
	mIFLA_BR_MCAST_LAST_MEMBER_CNT
,

262 
	mIFLA_BR_MCAST_STARTUP_QUERY_CNT
,

263 
	mIFLA_BR_MCAST_LAST_MEMBER_INTVL
,

264 
	mIFLA_BR_MCAST_MEMBERSHIP_INTVL
,

265 
	mIFLA_BR_MCAST_QUERIER_INTVL
,

266 
	mIFLA_BR_MCAST_QUERY_INTVL
,

267 
	mIFLA_BR_MCAST_QUERY_RESPONSE_INTVL
,

268 
	mIFLA_BR_MCAST_STARTUP_QUERY_INTVL
,

269 
	mIFLA_BR_NF_CALL_IPTABLES
,

270 
	mIFLA_BR_NF_CALL_IP6TABLES
,

271 
	mIFLA_BR_NF_CALL_ARPTABLES
,

272 
	mIFLA_BR_VLAN_DEFAULT_PVID
,

273 
	mIFLA_BR_PAD
,

274 
	mIFLA_BR_VLAN_STATS_ENABLED
,

275 
	mIFLA_BR_MCAST_STATS_ENABLED
,

276 
	m__IFLA_BR_MAX
,

279 
	#IFLA_BR_MAX
 (
__IFLA_BR_MAX
 - 1)

	)

281 
	siæa_bridge_id
 {

282 
__u8
 
	m´io
[2];

283 
__u8
 
	maddr
[6];

287 
	mBRIDGE_MODE_UNSPEC
,

288 
	mBRIDGE_MODE_HAIRPIN
,

292 
	mIFLA_BRPORT_UNSPEC
,

293 
	mIFLA_BRPORT_STATE
,

294 
	mIFLA_BRPORT_PRIORITY
,

295 
	mIFLA_BRPORT_COST
,

296 
	mIFLA_BRPORT_MODE
,

297 
	mIFLA_BRPORT_GUARD
,

298 
	mIFLA_BRPORT_PROTECT
,

299 
	mIFLA_BRPORT_FAST_LEAVE
,

300 
	mIFLA_BRPORT_LEARNING
,

301 
	mIFLA_BRPORT_UNICAST_FLOOD
,

302 
	mIFLA_BRPORT_PROXYARP
,

303 
	mIFLA_BRPORT_LEARNING_SYNC
,

304 
	mIFLA_BRPORT_PROXYARP_WIFI
,

305 
	mIFLA_BRPORT_ROOT_ID
,

306 
	mIFLA_BRPORT_BRIDGE_ID
,

307 
	mIFLA_BRPORT_DESIGNATED_PORT
,

308 
	mIFLA_BRPORT_DESIGNATED_COST
,

309 
	mIFLA_BRPORT_ID
,

310 
	mIFLA_BRPORT_NO
,

311 
	mIFLA_BRPORT_TOPOLOGY_CHANGE_ACK
,

312 
	mIFLA_BRPORT_CONFIG_PENDING
,

313 
	mIFLA_BRPORT_MESSAGE_AGE_TIMER
,

314 
	mIFLA_BRPORT_FORWARD_DELAY_TIMER
,

315 
	mIFLA_BRPORT_HOLD_TIMER
,

316 
	mIFLA_BRPORT_FLUSH
,

317 
	mIFLA_BRPORT_MULTICAST_ROUTER
,

318 
	mIFLA_BRPORT_PAD
,

319 
	mIFLA_BRPORT_MCAST_FLOOD
,

320 
	m__IFLA_BRPORT_MAX


322 
	#IFLA_BRPORT_MAX
 (
__IFLA_BRPORT_MAX
 - 1)

	)

324 
	siæa_ÿchešfo
 {

325 
__u32
 
	mmax_»asm_Ën
;

326 
__u32
 
	mt¡amp
;

327 
__u32
 
	m»achabË_time
;

328 
__u32
 
	m»Œªs_time
;

332 
	mIFLA_INFO_UNSPEC
,

333 
	mIFLA_INFO_KIND
,

334 
	mIFLA_INFO_DATA
,

335 
	mIFLA_INFO_XSTATS
,

336 
	mIFLA_INFO_SLAVE_KIND
,

337 
	mIFLA_INFO_SLAVE_DATA
,

338 
	m__IFLA_INFO_MAX
,

341 
	#IFLA_INFO_MAX
 (
__IFLA_INFO_MAX
 - 1)

	)

346 
	mIFLA_VLAN_UNSPEC
,

347 
	mIFLA_VLAN_ID
,

348 
	mIFLA_VLAN_FLAGS
,

349 
	mIFLA_VLAN_EGRESS_QOS
,

350 
	mIFLA_VLAN_INGRESS_QOS
,

351 
	mIFLA_VLAN_PROTOCOL
,

352 
	m__IFLA_VLAN_MAX
,

355 
	#IFLA_VLAN_MAX
 (
__IFLA_VLAN_MAX
 - 1)

	)

357 
	siæa_vÏn_æags
 {

358 
__u32
 
	mæags
;

359 
__u32
 
	mmask
;

363 
	mIFLA_VLAN_QOS_UNSPEC
,

364 
	mIFLA_VLAN_QOS_MAPPING
,

365 
	m__IFLA_VLAN_QOS_MAX


368 
	#IFLA_VLAN_QOS_MAX
 (
__IFLA_VLAN_QOS_MAX
 - 1)

	)

370 
	siæa_vÏn_qos_m­pšg
 {

371 
__u32
 
	mäom
;

372 
__u32
 
	mto
;

377 
	mIFLA_MACVLAN_UNSPEC
,

378 
	mIFLA_MACVLAN_MODE
,

379 
	mIFLA_MACVLAN_FLAGS
,

380 
	mIFLA_MACVLAN_MACADDR_MODE
,

381 
	mIFLA_MACVLAN_MACADDR
,

382 
	mIFLA_MACVLAN_MACADDR_DATA
,

383 
	mIFLA_MACVLAN_MACADDR_COUNT
,

384 
	m__IFLA_MACVLAN_MAX
,

387 
	#IFLA_MACVLAN_MAX
 (
__IFLA_MACVLAN_MAX
 - 1)

	)

389 
	emacvÏn_mode
 {

390 
	mMACVLAN_MODE_PRIVATE
 = 1,

391 
	mMACVLAN_MODE_VEPA
 = 2,

392 
	mMACVLAN_MODE_BRIDGE
 = 4,

393 
	mMACVLAN_MODE_PASSTHRU
 = 8,

394 
	mMACVLAN_MODE_SOURCE
 = 16,

397 
	emacvÏn_maÿddr_mode
 {

398 
	mMACVLAN_MACADDR_ADD
,

399 
	mMACVLAN_MACADDR_DEL
,

400 
	mMACVLAN_MACADDR_FLUSH
,

401 
	mMACVLAN_MACADDR_SET
,

404 
	#MACVLAN_FLAG_NOPROMISC
 1

	)

408 
	mIFLA_VRF_UNSPEC
,

409 
	mIFLA_VRF_TABLE
,

410 
	m__IFLA_VRF_MAX


413 
	#IFLA_VRF_MAX
 (
__IFLA_VRF_MAX
 - 1)

	)

416 
	mIFLA_VRF_PORT_UNSPEC
,

417 
	mIFLA_VRF_PORT_TABLE
,

418 
	m__IFLA_VRF_PORT_MAX


421 
	#IFLA_VRF_PORT_MAX
 (
__IFLA_VRF_PORT_MAX
 - 1)

	)

425 
	mIFLA_MACSEC_UNSPEC
,

426 
	mIFLA_MACSEC_SCI
,

427 
	mIFLA_MACSEC_PORT
,

428 
	mIFLA_MACSEC_ICV_LEN
,

429 
	mIFLA_MACSEC_CIPHER_SUITE
,

430 
	mIFLA_MACSEC_WINDOW
,

431 
	mIFLA_MACSEC_ENCODING_SA
,

432 
	mIFLA_MACSEC_ENCRYPT
,

433 
	mIFLA_MACSEC_PROTECT
,

434 
	mIFLA_MACSEC_INC_SCI
,

435 
	mIFLA_MACSEC_ES
,

436 
	mIFLA_MACSEC_SCB
,

437 
	mIFLA_MACSEC_REPLAY_PROTECT
,

438 
	mIFLA_MACSEC_VALIDATION
,

439 
	mIFLA_MACSEC_PAD
,

440 
	m__IFLA_MACSEC_MAX
,

443 
	#IFLA_MACSEC_MAX
 (
__IFLA_MACSEC_MAX
 - 1)

	)

445 
	emac£c_v®id©iÚ_ty³
 {

446 
	mMACSEC_VALIDATE_DISABLED
 = 0,

447 
	mMACSEC_VALIDATE_CHECK
 = 1,

448 
	mMACSEC_VALIDATE_STRICT
 = 2,

449 
	m__MACSEC_VALIDATE_END
,

450 
	mMACSEC_VALIDATE_MAX
 = 
__MACSEC_VALIDATE_END
 - 1,

455 
	mIFLA_IPVLAN_UNSPEC
,

456 
	mIFLA_IPVLAN_MODE
,

457 
	m__IFLA_IPVLAN_MAX


460 
	#IFLA_IPVLAN_MAX
 (
__IFLA_IPVLAN_MAX
 - 1)

	)

462 
	evÏn_mode
 {

463 
	mIPVLAN_MODE_L2
 = 0,

464 
	mIPVLAN_MODE_L3
,

465 
	mIPVLAN_MODE_L3S
,

466 
	mIPVLAN_MODE_MAX


471 
	mIFLA_VXLAN_UNSPEC
,

472 
	mIFLA_VXLAN_ID
,

473 
	mIFLA_VXLAN_GROUP
,

474 
	mIFLA_VXLAN_LINK
,

475 
	mIFLA_VXLAN_LOCAL
,

476 
	mIFLA_VXLAN_TTL
,

477 
	mIFLA_VXLAN_TOS
,

478 
	mIFLA_VXLAN_LEARNING
,

479 
	mIFLA_VXLAN_AGEING
,

480 
	mIFLA_VXLAN_LIMIT
,

481 
	mIFLA_VXLAN_PORT_RANGE
,

482 
	mIFLA_VXLAN_PROXY
,

483 
	mIFLA_VXLAN_RSC
,

484 
	mIFLA_VXLAN_L2MISS
,

485 
	mIFLA_VXLAN_L3MISS
,

486 
	mIFLA_VXLAN_PORT
,

487 
	mIFLA_VXLAN_GROUP6
,

488 
	mIFLA_VXLAN_LOCAL6
,

489 
	mIFLA_VXLAN_UDP_CSUM
,

490 
	mIFLA_VXLAN_UDP_ZERO_CSUM6_TX
,

491 
	mIFLA_VXLAN_UDP_ZERO_CSUM6_RX
,

492 
	mIFLA_VXLAN_REMCSUM_TX
,

493 
	mIFLA_VXLAN_REMCSUM_RX
,

494 
	mIFLA_VXLAN_GBP
,

495 
	mIFLA_VXLAN_REMCSUM_NOPARTIAL
,

496 
	mIFLA_VXLAN_COLLECT_METADATA
,

497 
	mIFLA_VXLAN_LABEL
,

498 
	mIFLA_VXLAN_GPE
,

499 
	m__IFLA_VXLAN_MAX


501 
	#IFLA_VXLAN_MAX
 (
__IFLA_VXLAN_MAX
 - 1)

	)

503 
	siæa_vxÏn_pÜt_¿nge
 {

504 
__be16
 
	mlow
;

505 
__be16
 
	mhigh
;

510 
	mIFLA_GENEVE_UNSPEC
,

511 
	mIFLA_GENEVE_ID
,

512 
	mIFLA_GENEVE_REMOTE
,

513 
	mIFLA_GENEVE_TTL
,

514 
	mIFLA_GENEVE_TOS
,

515 
	mIFLA_GENEVE_PORT
,

516 
	mIFLA_GENEVE_COLLECT_METADATA
,

517 
	mIFLA_GENEVE_REMOTE6
,

518 
	mIFLA_GENEVE_UDP_CSUM
,

519 
	mIFLA_GENEVE_UDP_ZERO_CSUM6_TX
,

520 
	mIFLA_GENEVE_UDP_ZERO_CSUM6_RX
,

521 
	mIFLA_GENEVE_LABEL
,

522 
	m__IFLA_GENEVE_MAX


524 
	#IFLA_GENEVE_MAX
 (
__IFLA_GENEVE_MAX
 - 1)

	)

528 
	mIFLA_PPP_UNSPEC
,

529 
	mIFLA_PPP_DEV_FD
,

530 
	m__IFLA_PPP_MAX


532 
	#IFLA_PPP_MAX
 (
__IFLA_PPP_MAX
 - 1)

	)

536 
	mIFLA_GTP_UNSPEC
,

537 
	mIFLA_GTP_FD0
,

538 
	mIFLA_GTP_FD1
,

539 
	mIFLA_GTP_PDP_HASHSIZE
,

540 
	m__IFLA_GTP_MAX
,

542 
	#IFLA_GTP_MAX
 (
__IFLA_GTP_MAX
 - 1)

	)

547 
	mIFLA_BOND_UNSPEC
,

548 
	mIFLA_BOND_MODE
,

549 
	mIFLA_BOND_ACTIVE_SLAVE
,

550 
	mIFLA_BOND_MIIMON
,

551 
	mIFLA_BOND_UPDELAY
,

552 
	mIFLA_BOND_DOWNDELAY
,

553 
	mIFLA_BOND_USE_CARRIER
,

554 
	mIFLA_BOND_ARP_INTERVAL
,

555 
	mIFLA_BOND_ARP_IP_TARGET
,

556 
	mIFLA_BOND_ARP_VALIDATE
,

557 
	mIFLA_BOND_ARP_ALL_TARGETS
,

558 
	mIFLA_BOND_PRIMARY
,

559 
	mIFLA_BOND_PRIMARY_RESELECT
,

560 
	mIFLA_BOND_FAIL_OVER_MAC
,

561 
	mIFLA_BOND_XMIT_HASH_POLICY
,

562 
	mIFLA_BOND_RESEND_IGMP
,

563 
	mIFLA_BOND_NUM_PEER_NOTIF
,

564 
	mIFLA_BOND_ALL_SLAVES_ACTIVE
,

565 
	mIFLA_BOND_MIN_LINKS
,

566 
	mIFLA_BOND_LP_INTERVAL
,

567 
	mIFLA_BOND_PACKETS_PER_SLAVE
,

568 
	mIFLA_BOND_AD_LACP_RATE
,

569 
	mIFLA_BOND_AD_SELECT
,

570 
	mIFLA_BOND_AD_INFO
,

571 
	mIFLA_BOND_AD_ACTOR_SYS_PRIO
,

572 
	mIFLA_BOND_AD_USER_PORT_KEY
,

573 
	mIFLA_BOND_AD_ACTOR_SYSTEM
,

574 
	mIFLA_BOND_TLB_DYNAMIC_LB
,

575 
	m__IFLA_BOND_MAX
,

578 
	#IFLA_BOND_MAX
 (
__IFLA_BOND_MAX
 - 1)

	)

581 
	mIFLA_BOND_AD_INFO_UNSPEC
,

582 
	mIFLA_BOND_AD_INFO_AGGREGATOR
,

583 
	mIFLA_BOND_AD_INFO_NUM_PORTS
,

584 
	mIFLA_BOND_AD_INFO_ACTOR_KEY
,

585 
	mIFLA_BOND_AD_INFO_PARTNER_KEY
,

586 
	mIFLA_BOND_AD_INFO_PARTNER_MAC
,

587 
	m__IFLA_BOND_AD_INFO_MAX
,

590 
	#IFLA_BOND_AD_INFO_MAX
 (
__IFLA_BOND_AD_INFO_MAX
 - 1)

	)

593 
	mIFLA_BOND_SLAVE_UNSPEC
,

594 
	mIFLA_BOND_SLAVE_STATE
,

595 
	mIFLA_BOND_SLAVE_MII_STATUS
,

596 
	mIFLA_BOND_SLAVE_LINK_FAILURE_COUNT
,

597 
	mIFLA_BOND_SLAVE_PERM_HWADDR
,

598 
	mIFLA_BOND_SLAVE_QUEUE_ID
,

599 
	mIFLA_BOND_SLAVE_AD_AGGREGATOR_ID
,

600 
	mIFLA_BOND_SLAVE_AD_ACTOR_OPER_PORT_STATE
,

601 
	mIFLA_BOND_SLAVE_AD_PARTNER_OPER_PORT_STATE
,

602 
	m__IFLA_BOND_SLAVE_MAX
,

605 
	#IFLA_BOND_SLAVE_MAX
 (
__IFLA_BOND_SLAVE_MAX
 - 1)

	)

610 
	mIFLA_VF_INFO_UNSPEC
,

611 
	mIFLA_VF_INFO
,

612 
	m__IFLA_VF_INFO_MAX
,

615 
	#IFLA_VF_INFO_MAX
 (
__IFLA_VF_INFO_MAX
 - 1)

	)

618 
	mIFLA_VF_UNSPEC
,

619 
	mIFLA_VF_MAC
,

620 
	mIFLA_VF_VLAN
,

621 
	mIFLA_VF_TX_RATE
,

622 
	mIFLA_VF_SPOOFCHK
,

623 
	mIFLA_VF_LINK_STATE
,

624 
	mIFLA_VF_RATE
,

625 
	mIFLA_VF_RSS_QUERY_EN
,

628 
	mIFLA_VF_STATS
,

629 
	mIFLA_VF_TRUST
,

630 
	mIFLA_VF_IB_NODE_GUID
,

631 
	mIFLA_VF_IB_PORT_GUID
,

632 
	mIFLA_VF_VLAN_LIST
,

633 
	m__IFLA_VF_MAX
,

636 
	#IFLA_VF_MAX
 (
__IFLA_VF_MAX
 - 1)

	)

638 
	siæa_vf_mac
 {

639 
__u32
 
	mvf
;

640 
__u8
 
	mmac
[32];

643 
	siæa_vf_vÏn
 {

644 
__u32
 
	mvf
;

645 
__u32
 
	mvÏn
;

646 
__u32
 
	mqos
;

650 
	mIFLA_VF_VLAN_INFO_UNSPEC
,

651 
	mIFLA_VF_VLAN_INFO
,

652 
	m__IFLA_VF_VLAN_INFO_MAX
,

655 
	#IFLA_VF_VLAN_INFO_MAX
 (
__IFLA_VF_VLAN_INFO_MAX
 - 1)

	)

656 
	#MAX_VLAN_LIST_LEN
 1

	)

658 
	siæa_vf_vÏn_šfo
 {

659 
__u32
 
	mvf
;

660 
__u32
 
	mvÏn
;

661 
__u32
 
	mqos
;

662 
__be16
 
	mvÏn_´Ùo
;

665 
	siæa_vf_tx_¿‹
 {

666 
__u32
 
	mvf
;

667 
__u32
 
	m¿‹
;

670 
	siæa_vf_¿‹
 {

671 
__u32
 
	mvf
;

672 
__u32
 
	mmš_tx_¿‹
;

673 
__u32
 
	mmax_tx_¿‹
;

676 
	siæa_vf_¥oofchk
 {

677 
__u32
 
	mvf
;

678 
__u32
 
	m£‰šg
;

681 
	siæa_vf_guid
 {

682 
__u32
 
	mvf
;

683 
__u64
 
	mguid
;

687 
	mIFLA_VF_LINK_STATE_AUTO
,

688 
	mIFLA_VF_LINK_STATE_ENABLE
,

689 
	mIFLA_VF_LINK_STATE_DISABLE
,

690 
	m__IFLA_VF_LINK_STATE_MAX
,

693 
	siæa_vf_lšk_¡©e
 {

694 
__u32
 
	mvf
;

695 
__u32
 
	mlšk_¡©e
;

698 
	siæa_vf_rss_qu”y_’
 {

699 
__u32
 
	mvf
;

700 
__u32
 
	m£‰šg
;

704 
	mIFLA_VF_STATS_RX_PACKETS
,

705 
	mIFLA_VF_STATS_TX_PACKETS
,

706 
	mIFLA_VF_STATS_RX_BYTES
,

707 
	mIFLA_VF_STATS_TX_BYTES
,

708 
	mIFLA_VF_STATS_BROADCAST
,

709 
	mIFLA_VF_STATS_MULTICAST
,

710 
	mIFLA_VF_STATS_PAD
,

711 
	m__IFLA_VF_STATS_MAX
,

714 
	#IFLA_VF_STATS_MAX
 (
__IFLA_VF_STATS_MAX
 - 1)

	)

716 
	siæa_vf_Œu¡
 {

717 
__u32
 
	mvf
;

718 
__u32
 
	m£‰šg
;

737 
	mIFLA_VF_PORT_UNSPEC
,

738 
	mIFLA_VF_PORT
,

739 
	m__IFLA_VF_PORT_MAX
,

742 
	#IFLA_VF_PORT_MAX
 (
__IFLA_VF_PORT_MAX
 - 1)

	)

745 
	mIFLA_PORT_UNSPEC
,

746 
	mIFLA_PORT_VF
,

747 
	mIFLA_PORT_PROFILE
,

748 
	mIFLA_PORT_VSI_TYPE
,

749 
	mIFLA_PORT_INSTANCE_UUID
,

750 
	mIFLA_PORT_HOST_UUID
,

751 
	mIFLA_PORT_REQUEST
,

752 
	mIFLA_PORT_RESPONSE
,

753 
	m__IFLA_PORT_MAX
,

756 
	#IFLA_PORT_MAX
 (
__IFLA_PORT_MAX
 - 1)

	)

758 
	#PORT_PROFILE_MAX
 40

	)

759 
	#PORT_UUID_MAX
 16

	)

760 
	#PORT_SELF_VF
 -1

	)

763 
	mPORT_REQUEST_PREASSOCIATE
 = 0,

764 
	mPORT_REQUEST_PREASSOCIATE_RR
,

765 
	mPORT_REQUEST_ASSOCIATE
,

766 
	mPORT_REQUEST_DISASSOCIATE
,

770 
	mPORT_VDP_RESPONSE_SUCCESS
 = 0,

771 
	mPORT_VDP_RESPONSE_INVALID_FORMAT
,

772 
	mPORT_VDP_RESPONSE_INSUFFICIENT_RESOURCES
,

773 
	mPORT_VDP_RESPONSE_UNUSED_VTID
,

774 
	mPORT_VDP_RESPONSE_VTID_VIOLATION
,

775 
	mPORT_VDP_RESPONSE_VTID_VERSION_VIOALTION
,

776 
	mPORT_VDP_RESPONSE_OUT_OF_SYNC
,

778 
	mPORT_PROFILE_RESPONSE_SUCCESS
 = 0x100,

779 
	mPORT_PROFILE_RESPONSE_INPROGRESS
,

780 
	mPORT_PROFILE_RESPONSE_INVALID
,

781 
	mPORT_PROFILE_RESPONSE_BADSTATE
,

782 
	mPORT_PROFILE_RESPONSE_INSUFFICIENT_RESOURCES
,

783 
	mPORT_PROFILE_RESPONSE_ERROR
,

786 
	siæa_pÜt_vsi
 {

787 
__u8
 
	mvsi_mgr_id
;

788 
__u8
 
	mvsi_ty³_id
[3];

789 
__u8
 
	mvsi_ty³_v”siÚ
;

790 
__u8
 
	m·d
[3];

797 
	mIFLA_IPOIB_UNSPEC
,

798 
	mIFLA_IPOIB_PKEY
,

799 
	mIFLA_IPOIB_MODE
,

800 
	mIFLA_IPOIB_UMCAST
,

801 
	m__IFLA_IPOIB_MAX


805 
	mIPOIB_MODE_DATAGRAM
 = 0,

806 
	mIPOIB_MODE_CONNECTED
 = 1,

809 
	#IFLA_IPOIB_MAX
 (
__IFLA_IPOIB_MAX
 - 1)

	)

815 
	mIFLA_HSR_UNSPEC
,

816 
	mIFLA_HSR_SLAVE1
,

817 
	mIFLA_HSR_SLAVE2
,

818 
	mIFLA_HSR_MULTICAST_SPEC
,

819 
	mIFLA_HSR_SUPERVISION_ADDR
,

820 
	mIFLA_HSR_SEQ_NR
,

821 
	mIFLA_HSR_VERSION
,

822 
	m__IFLA_HSR_MAX
,

825 
	#IFLA_HSR_MAX
 (
__IFLA_HSR_MAX
 - 1)

	)

829 
	sif_¡©s_msg
 {

830 
__u8
 
	mçmy
;

831 
__u8
 
	m·d1
;

832 
__u16
 
	m·d2
;

833 
__u32
 
	mifšdex
;

834 
__u32
 
	mf‹r_mask
;

841 
	mIFLA_STATS_UNSPEC
,

842 
	mIFLA_STATS_LINK_64
,

843 
	mIFLA_STATS_LINK_XSTATS
,

844 
	mIFLA_STATS_LINK_XSTATS_SLAVE
,

845 
	mIFLA_STATS_LINK_OFFLOAD_XSTATS
,

846 
	m__IFLA_STATS_MAX
,

849 
	#IFLA_STATS_MAX
 (
__IFLA_STATS_MAX
 - 1)

	)

851 
	#IFLA_STATS_FILTER_BIT
(
ATTR
è(1 << (ATTR - 1))

	)

859 
	mLINK_XSTATS_TYPE_UNSPEC
,

860 
	mLINK_XSTATS_TYPE_BRIDGE
,

861 
	m__LINK_XSTATS_TYPE_MAX


863 
	#LINK_XSTATS_TYPE_MAX
 (
__LINK_XSTATS_TYPE_MAX
 - 1)

	)

867 
	mIFLA_OFFLOAD_XSTATS_UNSPEC
,

868 
	mIFLA_OFFLOAD_XSTATS_CPU_HIT
,

869 
	m__IFLA_OFFLOAD_XSTATS_MAX


871 
	#IFLA_OFFLOAD_XSTATS_MAX
 (
__IFLA_OFFLOAD_XSTATS_MAX
 - 1)

	)

876 
	mIFLA_XDP_UNSPEC
,

877 
	mIFLA_XDP_FD
,

878 
	mIFLA_XDP_ATTACHED
,

879 
	m__IFLA_XDP_MAX
,

882 
	#IFLA_XDP_MAX
 (
__IFLA_XDP_MAX
 - 1)

	)

	@/usr/include/linux/in6.h

21 #iâdeà
_LINUX_IN6_H


22 
	#_LINUX_IN6_H


	)

24 
	~<lšux/ty³s.h
>

25 
	~<lšux/libc-com·t.h
>

31 #ià
__UAPI_DEF_IN6_ADDR


32 
	sš6_addr
 {

34 
__u8
 
	mu6_addr8
[16];

35 #ià
__UAPI_DEF_IN6_ADDR_ALT


36 
__be16
 
	mu6_addr16
[8];

37 
__be32
 
	mu6_addr32
[4];

39 } 
	mš6_u
;

40 
	#s6_addr
 
š6_u
.
u6_addr8


	)

41 #ià
__UAPI_DEF_IN6_ADDR_ALT


42 
	#s6_addr16
 
š6_u
.
u6_addr16


	)

43 
	#s6_addr32
 
š6_u
.
u6_addr32


	)

48 #ià
__UAPI_DEF_SOCKADDR_IN6


49 
	ssockaddr_š6
 {

50 
	msš6_çmy
;

51 
__be16
 
	msš6_pÜt
;

52 
__be32
 
	msš6_æowšfo
;

53 
š6_addr
 
	msš6_addr
;

54 
__u32
 
	msš6_scİe_id
;

58 #ià
__UAPI_DEF_IPV6_MREQ


59 
	sv6_m»q
 {

61 
š6_addr
 
	mv6mr_muÉŸddr
;

64 
	mv6mr_ifšdex
;

68 
	#v6mr_aÿddr
 
v6mr_muÉŸddr


	)

70 
	sš6_æowÏb–_»q
 {

71 
š6_addr
 
	mær_d¡
;

72 
__be32
 
	mær_Ïb–
;

73 
__u8
 
	mær_aùiÚ
;

74 
__u8
 
	mær_sh¬e
;

75 
__u16
 
	mær_æags
;

76 
__u16
 
	mær_expœes
;

77 
__u16
 
	mær_lšg”
;

78 
__u32
 
	m__ær_·d
;

82 
	#IPV6_FL_A_GET
 0

	)

83 
	#IPV6_FL_A_PUT
 1

	)

84 
	#IPV6_FL_A_RENEW
 2

	)

86 
	#IPV6_FL_F_CREATE
 1

	)

87 
	#IPV6_FL_F_EXCL
 2

	)

88 
	#IPV6_FL_F_REFLECT
 4

	)

89 
	#IPV6_FL_F_REMOTE
 8

	)

91 
	#IPV6_FL_S_NONE
 0

	)

92 
	#IPV6_FL_S_EXCL
 1

	)

93 
	#IPV6_FL_S_PROCESS
 2

	)

94 
	#IPV6_FL_S_USER
 3

	)

95 
	#IPV6_FL_S_ANY
 255

	)

106 
	#IPV6_FLOWINFO_FLOWLABEL
 0x000fffff

	)

107 
	#IPV6_FLOWINFO_PRIORITY
 0x0ff00000

	)

110 
	#IPV6_PRIORITY_UNCHARACTERIZED
 0x0000

	)

111 
	#IPV6_PRIORITY_FILLER
 0x0100

	)

112 
	#IPV6_PRIORITY_UNATTENDED
 0x0200

	)

113 
	#IPV6_PRIORITY_RESERVED1
 0x0300

	)

114 
	#IPV6_PRIORITY_BULK
 0x0400

	)

115 
	#IPV6_PRIORITY_RESERVED2
 0x0500

	)

116 
	#IPV6_PRIORITY_INTERACTIVE
 0x0600

	)

117 
	#IPV6_PRIORITY_CONTROL
 0x0700

	)

118 
	#IPV6_PRIORITY_8
 0x0800

	)

119 
	#IPV6_PRIORITY_9
 0x0900

	)

120 
	#IPV6_PRIORITY_10
 0x0a00

	)

121 
	#IPV6_PRIORITY_11
 0x0b00

	)

122 
	#IPV6_PRIORITY_12
 0x0c00

	)

123 
	#IPV6_PRIORITY_13
 0x0d00

	)

124 
	#IPV6_PRIORITY_14
 0x0e00

	)

125 
	#IPV6_PRIORITY_15
 0x0f00

	)

130 #ià
__UAPI_DEF_IPPROTO_V6


131 
	#IPPROTO_HOPOPTS
 0

	)

132 
	#IPPROTO_ROUTING
 43

	)

133 
	#IPPROTO_FRAGMENT
 44

	)

134 
	#IPPROTO_ICMPV6
 58

	)

135 
	#IPPROTO_NONE
 59

	)

136 
	#IPPROTO_DSTOPTS
 60

	)

137 
	#IPPROTO_MH
 135

	)

143 
	#IPV6_TLV_PAD1
 0

	)

144 
	#IPV6_TLV_PADN
 1

	)

145 
	#IPV6_TLV_ROUTERALERT
 5

	)

146 
	#IPV6_TLV_CALIPSO
 7

	)

147 
	#IPV6_TLV_JUMBO
 194

	)

148 
	#IPV6_TLV_HAO
 201

	)

153 #ià
__UAPI_DEF_IPV6_OPTIONS


154 
	#IPV6_ADDRFORM
 1

	)

155 
	#IPV6_2292PKTINFO
 2

	)

156 
	#IPV6_2292HOPOPTS
 3

	)

157 
	#IPV6_2292DSTOPTS
 4

	)

158 
	#IPV6_2292RTHDR
 5

	)

159 
	#IPV6_2292PKTOPTIONS
 6

	)

160 
	#IPV6_CHECKSUM
 7

	)

161 
	#IPV6_2292HOPLIMIT
 8

	)

162 
	#IPV6_NEXTHOP
 9

	)

163 
	#IPV6_AUTHHDR
 10

	)

164 
	#IPV6_FLOWINFO
 11

	)

166 
	#IPV6_UNICAST_HOPS
 16

	)

167 
	#IPV6_MULTICAST_IF
 17

	)

168 
	#IPV6_MULTICAST_HOPS
 18

	)

169 
	#IPV6_MULTICAST_LOOP
 19

	)

170 
	#IPV6_ADD_MEMBERSHIP
 20

	)

171 
	#IPV6_DROP_MEMBERSHIP
 21

	)

172 
	#IPV6_ROUTER_ALERT
 22

	)

173 
	#IPV6_MTU_DISCOVER
 23

	)

174 
	#IPV6_MTU
 24

	)

175 
	#IPV6_RECVERR
 25

	)

176 
	#IPV6_V6ONLY
 26

	)

177 
	#IPV6_JOIN_ANYCAST
 27

	)

178 
	#IPV6_LEAVE_ANYCAST
 28

	)

181 
	#IPV6_PMTUDISC_DONT
 0

	)

182 
	#IPV6_PMTUDISC_WANT
 1

	)

183 
	#IPV6_PMTUDISC_DO
 2

	)

184 
	#IPV6_PMTUDISC_PROBE
 3

	)

188 
	#IPV6_PMTUDISC_INTERFACE
 4

	)

192 
	#IPV6_PMTUDISC_OMIT
 5

	)

195 
	#IPV6_FLOWLABEL_MGR
 32

	)

196 
	#IPV6_FLOWINFO_SEND
 33

	)

198 
	#IPV6_IPSEC_POLICY
 34

	)

199 
	#IPV6_XFRM_POLICY
 35

	)

200 
	#IPV6_HDRINCL
 36

	)

222 
	#IPV6_RECVPKTINFO
 49

	)

223 
	#IPV6_PKTINFO
 50

	)

224 
	#IPV6_RECVHOPLIMIT
 51

	)

225 
	#IPV6_HOPLIMIT
 52

	)

226 
	#IPV6_RECVHOPOPTS
 53

	)

227 
	#IPV6_HOPOPTS
 54

	)

228 
	#IPV6_RTHDRDSTOPTS
 55

	)

229 
	#IPV6_RECVRTHDR
 56

	)

230 
	#IPV6_RTHDR
 57

	)

231 
	#IPV6_RECVDSTOPTS
 58

	)

232 
	#IPV6_DSTOPTS
 59

	)

233 
	#IPV6_RECVPATHMTU
 60

	)

234 
	#IPV6_PATHMTU
 61

	)

235 
	#IPV6_DONTFRAG
 62

	)

237 
	#IPV6_USE_MIN_MTU
 63

	)

253 
	#IPV6_RECVTCLASS
 66

	)

254 
	#IPV6_TCLASS
 67

	)

267 
	#IPV6_AUTOFLOWLABEL
 70

	)

269 
	#IPV6_ADDR_PREFERENCES
 72

	)

271 
	#IPV6_PREFER_SRC_TMP
 0x0001

	)

272 
	#IPV6_PREFER_SRC_PUBLIC
 0x0002

	)

273 
	#IPV6_PREFER_SRC_PUBTMP_DEFAULT
 0x0100

	)

274 
	#IPV6_PREFER_SRC_COA
 0x0004

	)

275 
	#IPV6_PREFER_SRC_HOME
 0x0400

	)

276 
	#IPV6_PREFER_SRC_CGA
 0x0008

	)

277 
	#IPV6_PREFER_SRC_NONCGA
 0x0800

	)

280 
	#IPV6_MINHOPCOUNT
 73

	)

282 
	#IPV6_ORIGDSTADDR
 74

	)

283 
	#IPV6_RECVORIGDSTADDR
 
IPV6_ORIGDSTADDR


	)

284 
	#IPV6_TRANSPARENT
 75

	)

285 
	#IPV6_UNICAST_IF
 76

	)

	@/usr/include/linux/ioctl.h

1 #iâdeà
_LINUX_IOCTL_H


2 
	#_LINUX_IOCTL_H


	)

4 
	~<asm/ioùl.h
>

	@/usr/include/linux/libc-compat.h

48 #iâdeà
_LIBC_COMPAT_H


49 
	#_LIBC_COMPAT_H


	)

52 #ià
defšed
(
__GLIBC__
)

55 #ià
defšed
(
_NET_IF_H
è&& defšed(
__USE_MISC
)

60 
	#__UAPI_DEF_IF_IFCONF
 0

	)

61 
	#__UAPI_DEF_IF_IFMAP
 0

	)

62 
	#__UAPI_DEF_IF_IFNAMSIZ
 0

	)

63 
	#__UAPI_DEF_IF_IFREQ
 0

	)

65 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 0

	)

67 #iâdeà
__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO


68 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

77 
	#__UAPI_DEF_IF_IFCONF
 1

	)

78 
	#__UAPI_DEF_IF_IFMAP
 1

	)

79 
	#__UAPI_DEF_IF_IFNAMSIZ
 1

	)

80 
	#__UAPI_DEF_IF_IFREQ
 1

	)

82 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 1

	)

84 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

89 #ià
defšed
(
_NETINET_IN_H
)

93 
	#__UAPI_DEF_IN_ADDR
 0

	)

94 
	#__UAPI_DEF_IN_IPPROTO
 0

	)

95 
	#__UAPI_DEF_IN_PKTINFO
 0

	)

96 
	#__UAPI_DEF_IP_MREQ
 0

	)

97 
	#__UAPI_DEF_SOCKADDR_IN
 0

	)

98 
	#__UAPI_DEF_IN_CLASS
 0

	)

100 
	#__UAPI_DEF_IN6_ADDR
 0

	)

105 #ià
defšed
(
__USE_MISC
è|| defšed (
__USE_GNU
)

106 
	#__UAPI_DEF_IN6_ADDR_ALT
 0

	)

108 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

110 
	#__UAPI_DEF_SOCKADDR_IN6
 0

	)

111 
	#__UAPI_DEF_IPV6_MREQ
 0

	)

112 
	#__UAPI_DEF_IPPROTO_V6
 0

	)

113 
	#__UAPI_DEF_IPV6_OPTIONS
 0

	)

114 
	#__UAPI_DEF_IN6_PKTINFO
 0

	)

115 
	#__UAPI_DEF_IP6_MTUINFO
 0

	)

122 
	#__UAPI_DEF_IN_ADDR
 1

	)

123 
	#__UAPI_DEF_IN_IPPROTO
 1

	)

124 
	#__UAPI_DEF_IN_PKTINFO
 1

	)

125 
	#__UAPI_DEF_IP_MREQ
 1

	)

126 
	#__UAPI_DEF_SOCKADDR_IN
 1

	)

127 
	#__UAPI_DEF_IN_CLASS
 1

	)

129 
	#__UAPI_DEF_IN6_ADDR
 1

	)

132 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

133 
	#__UAPI_DEF_SOCKADDR_IN6
 1

	)

134 
	#__UAPI_DEF_IPV6_MREQ
 1

	)

135 
	#__UAPI_DEF_IPPROTO_V6
 1

	)

136 
	#__UAPI_DEF_IPV6_OPTIONS
 1

	)

137 
	#__UAPI_DEF_IN6_PKTINFO
 1

	)

138 
	#__UAPI_DEF_IP6_MTUINFO
 1

	)

143 #ià
defšed
(
__NETIPX_IPX_H
)

145 
	#__UAPI_DEF_SOCKADDR_IPX
 0

	)

146 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 0

	)

147 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 0

	)

148 
	#__UAPI_DEF_IPX_CONFIG_DATA
 0

	)

149 
	#__UAPI_DEF_IPX_ROUTE_DEF
 0

	)

153 
	#__UAPI_DEF_SOCKADDR_IPX
 1

	)

154 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 1

	)

155 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 1

	)

156 
	#__UAPI_DEF_IPX_CONFIG_DATA
 1

	)

157 
	#__UAPI_DEF_IPX_ROUTE_DEF
 1

	)

162 #ià
defšed
(
_SYS_XATTR_H
)

163 
	#__UAPI_DEF_XATTR
 0

	)

165 
	#__UAPI_DEF_XATTR
 1

	)

174 
	#__UAPI_DEF_IF_IFCONF
 1

	)

175 
	#__UAPI_DEF_IF_IFMAP
 1

	)

176 
	#__UAPI_DEF_IF_IFNAMSIZ
 1

	)

177 
	#__UAPI_DEF_IF_IFREQ
 1

	)

179 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS
 1

	)

181 
	#__UAPI_DEF_IF_NET_DEVICE_FLAGS_LOWER_UP_DORMANT_ECHO
 1

	)

184 
	#__UAPI_DEF_IN_ADDR
 1

	)

185 
	#__UAPI_DEF_IN_IPPROTO
 1

	)

186 
	#__UAPI_DEF_IN_PKTINFO
 1

	)

187 
	#__UAPI_DEF_IP_MREQ
 1

	)

188 
	#__UAPI_DEF_SOCKADDR_IN
 1

	)

189 
	#__UAPI_DEF_IN_CLASS
 1

	)

192 
	#__UAPI_DEF_IN6_ADDR
 1

	)

193 
	#__UAPI_DEF_IN6_ADDR_ALT
 1

	)

194 
	#__UAPI_DEF_SOCKADDR_IN6
 1

	)

195 
	#__UAPI_DEF_IPV6_MREQ
 1

	)

196 
	#__UAPI_DEF_IPPROTO_V6
 1

	)

197 
	#__UAPI_DEF_IPV6_OPTIONS
 1

	)

198 
	#__UAPI_DEF_IN6_PKTINFO
 1

	)

199 
	#__UAPI_DEF_IP6_MTUINFO
 1

	)

202 
	#__UAPI_DEF_SOCKADDR_IPX
 1

	)

203 
	#__UAPI_DEF_IPX_ROUTE_DEFINITION
 1

	)

204 
	#__UAPI_DEF_IPX_INTERFACE_DEFINITION
 1

	)

205 
	#__UAPI_DEF_IPX_CONFIG_DATA
 1

	)

206 
	#__UAPI_DEF_IPX_ROUTE_DEF
 1

	)

209 
	#__UAPI_DEF_XATTR
 1

	)

	@/usr/include/linux/limits.h

1 #iâdeà
_LINUX_LIMITS_H


2 
	#_LINUX_LIMITS_H


	)

4 
	#NR_OPEN
 1024

	)

6 
	#NGROUPS_MAX
 65536

	)

7 
	#ARG_MAX
 131072

	)

8 
	#LINK_MAX
 127

	)

9 
	#MAX_CANON
 255

	)

10 
	#MAX_INPUT
 255

	)

11 
	#NAME_MAX
 255

	)

12 
	#PATH_MAX
 4096

	)

13 
	#PIPE_BUF
 4096

	)

14 
	#XATTR_NAME_MAX
 255

	)

15 
	#XATTR_SIZE_MAX
 65536

	)

16 
	#XATTR_LIST_MAX
 65536

	)

18 
	#RTSIG_MAX
 32

	)

	@/usr/include/linux/neighbour.h

1 #iâdeà
__LINUX_NEIGHBOUR_H


2 
	#__LINUX_NEIGHBOUR_H


	)

4 
	~<lšux/ty³s.h
>

5 
	~<lšux/Ãšk.h
>

7 
	sndmsg
 {

8 
__u8
 
	mndm_çmy
;

9 
__u8
 
	mndm_·d1
;

10 
__u16
 
	mndm_·d2
;

11 
__s32
 
	mndm_ifšdex
;

12 
__u16
 
	mndm_¡©e
;

13 
__u8
 
	mndm_æags
;

14 
__u8
 
	mndm_ty³
;

18 
	mNDA_UNSPEC
,

19 
	mNDA_DST
,

20 
	mNDA_LLADDR
,

21 
	mNDA_CACHEINFO
,

22 
	mNDA_PROBES
,

23 
	mNDA_VLAN
,

24 
	mNDA_PORT
,

25 
	mNDA_VNI
,

26 
	mNDA_IFINDEX
,

27 
	mNDA_MASTER
,

28 
	mNDA_LINK_NETNSID
,

29 
	m__NDA_MAX


32 
	#NDA_MAX
 (
__NDA_MAX
 - 1)

	)

38 
	#NTF_USE
 0x01

	)

39 
	#NTF_SELF
 0x02

	)

40 
	#NTF_MASTER
 0x04

	)

41 
	#NTF_PROXY
 0x08

	)

42 
	#NTF_EXT_LEARNED
 0x10

	)

43 
	#NTF_ROUTER
 0x80

	)

49 
	#NUD_INCOMPLETE
 0x01

	)

50 
	#NUD_REACHABLE
 0x02

	)

51 
	#NUD_STALE
 0x04

	)

52 
	#NUD_DELAY
 0x08

	)

53 
	#NUD_PROBE
 0x10

	)

54 
	#NUD_FAILED
 0x20

	)

57 
	#NUD_NOARP
 0x40

	)

58 
	#NUD_PERMANENT
 0x80

	)

59 
	#NUD_NONE
 0x00

	)

66 
	snda_ÿchešfo
 {

67 
__u32
 
	mndm_cÚfœmed
;

68 
__u32
 
	mndm_u£d
;

69 
__u32
 
	mndm_upd©ed
;

70 
__u32
 
	mndm_»fút
;

98 
	sndt_¡©s
 {

99 
__u64
 
	mndts_®locs
;

100 
__u64
 
	mndts_de¡roys
;

101 
__u64
 
	mndts_hash_grows
;

102 
__u64
 
	mndts_»s_çed
;

103 
__u64
 
	mndts_lookups
;

104 
__u64
 
	mndts_h™s
;

105 
__u64
 
	mndts_rcv_´obes_mÿ¡
;

106 
__u64
 
	mndts_rcv_´obes_uÿ¡
;

107 
__u64
 
	mndts_³riodic_gc_runs
;

108 
__u64
 
	mndts_fÜûd_gc_runs
;

109 
__u64
 
	mndts_bË_fuÎs
;

113 
	mNDTPA_UNSPEC
,

114 
	mNDTPA_IFINDEX
,

115 
	mNDTPA_REFCNT
,

116 
	mNDTPA_REACHABLE_TIME
,

117 
	mNDTPA_BASE_REACHABLE_TIME
,

118 
	mNDTPA_RETRANS_TIME
,

119 
	mNDTPA_GC_STALETIME
,

120 
	mNDTPA_DELAY_PROBE_TIME
,

121 
	mNDTPA_QUEUE_LEN
,

122 
	mNDTPA_APP_PROBES
,

123 
	mNDTPA_UCAST_PROBES
,

124 
	mNDTPA_MCAST_PROBES
,

125 
	mNDTPA_ANYCAST_DELAY
,

126 
	mNDTPA_PROXY_DELAY
,

127 
	mNDTPA_PROXY_QLEN
,

128 
	mNDTPA_LOCKTIME
,

129 
	mNDTPA_QUEUE_LENBYTES
,

130 
	mNDTPA_MCAST_REPROBES
,

131 
	mNDTPA_PAD
,

132 
	m__NDTPA_MAX


134 
	#NDTPA_MAX
 (
__NDTPA_MAX
 - 1)

	)

136 
	sndtmsg
 {

137 
__u8
 
	mndtm_çmy
;

138 
__u8
 
	mndtm_·d1
;

139 
__u16
 
	mndtm_·d2
;

142 
	sndt_cÚfig
 {

143 
__u16
 
	mndtc_key_Ën
;

144 
__u16
 
	mndtc_’Œy_size
;

145 
__u32
 
	mndtc_’Œ›s
;

146 
__u32
 
	mndtc_Ï¡_æush
;

147 
__u32
 
	mndtc_Ï¡_¿nd
;

148 
__u32
 
	mndtc_hash_ºd
;

149 
__u32
 
	mndtc_hash_mask
;

150 
__u32
 
	mndtc_hash_chaš_gc
;

151 
__u32
 
	mndtc_´oxy_qËn
;

155 
	mNDTA_UNSPEC
,

156 
	mNDTA_NAME
,

157 
	mNDTA_THRESH1
,

158 
	mNDTA_THRESH2
,

159 
	mNDTA_THRESH3
,

160 
	mNDTA_CONFIG
,

161 
	mNDTA_PARMS
,

162 
	mNDTA_STATS
,

163 
	mNDTA_GC_INTERVAL
,

164 
	mNDTA_PAD
,

165 
	m__NDTA_MAX


167 
	#NDTA_MAX
 (
__NDTA_MAX
 - 1)

	)

	@/usr/include/linux/netlink.h

1 #iâdeà
__LINUX_NETLINK_H


2 
	#__LINUX_NETLINK_H


	)

4 
	~<lšux/k”Ãl.h
>

5 
	~<lšux/sock‘.h
>

6 
	~<lšux/ty³s.h
>

8 
	#NETLINK_ROUTE
 0

	)

9 
	#NETLINK_UNUSED
 1

	)

10 
	#NETLINK_USERSOCK
 2

	)

11 
	#NETLINK_FIREWALL
 3

	)

12 
	#NETLINK_SOCK_DIAG
 4

	)

13 
	#NETLINK_NFLOG
 5

	)

14 
	#NETLINK_XFRM
 6

	)

15 
	#NETLINK_SELINUX
 7

	)

16 
	#NETLINK_ISCSI
 8

	)

17 
	#NETLINK_AUDIT
 9

	)

18 
	#NETLINK_FIB_LOOKUP
 10

	)

19 
	#NETLINK_CONNECTOR
 11

	)

20 
	#NETLINK_NETFILTER
 12

	)

21 
	#NETLINK_IP6_FW
 13

	)

22 
	#NETLINK_DNRTMSG
 14

	)

23 
	#NETLINK_KOBJECT_UEVENT
 15

	)

24 
	#NETLINK_GENERIC
 16

	)

26 
	#NETLINK_SCSITRANSPORT
 18

	)

27 
	#NETLINK_ECRYPTFS
 19

	)

28 
	#NETLINK_RDMA
 20

	)

29 
	#NETLINK_CRYPTO
 21

	)

31 
	#NETLINK_INET_DIAG
 
NETLINK_SOCK_DIAG


	)

33 
	#MAX_LINKS
 32

	)

35 
	ssockaddr_Æ
 {

36 
__k”Ãl_§_çmy_t
 
	mÆ_çmy
;

37 
	mÆ_·d
;

38 
__u32
 
	mÆ_pid
;

39 
__u32
 
	mÆ_groups
;

42 
	sÆmsghdr
 {

43 
__u32
 
	mÆmsg_Ën
;

44 
__u16
 
	mÆmsg_ty³
;

45 
__u16
 
	mÆmsg_æags
;

46 
__u32
 
	mÆmsg_£q
;

47 
__u32
 
	mÆmsg_pid
;

52 
	#NLM_F_REQUEST
 1

	)

53 
	#NLM_F_MULTI
 2

	)

54 
	#NLM_F_ACK
 4

	)

55 
	#NLM_F_ECHO
 8

	)

56 
	#NLM_F_DUMP_INTR
 16

	)

57 
	#NLM_F_DUMP_FILTERED
 32

	)

60 
	#NLM_F_ROOT
 0x100

	)

61 
	#NLM_F_MATCH
 0x200

	)

62 
	#NLM_F_ATOMIC
 0x400

	)

63 
	#NLM_F_DUMP
 (
NLM_F_ROOT
|
NLM_F_MATCH
)

	)

66 
	#NLM_F_REPLACE
 0x100

	)

67 
	#NLM_F_EXCL
 0x200

	)

68 
	#NLM_F_CREATE
 0x400

	)

69 
	#NLM_F_APPEND
 0x800

	)

80 
	#NLMSG_ALIGNTO
 4U

	)

81 
	#NLMSG_ALIGN
(
Ën
èĞ(Ö’)+
NLMSG_ALIGNTO
-1è& ~(NLMSG_ALIGNTO-1è)

	)

82 
	#NLMSG_HDRLEN
 ((è
	`NLMSG_ALIGN
((
Æmsghdr
)))

	)

83 
	#NLMSG_LENGTH
(
Ën
è(Ö’è+ 
NLMSG_HDRLEN
)

	)

84 
	#NLMSG_SPACE
(
Ën
è
	`NLMSG_ALIGN
(
	`NLMSG_LENGTH
Ö’))

	)

85 
	#NLMSG_DATA
(
Æh
è((*)(((*êlhè+ 
	`NLMSG_LENGTH
(0)))

	)

86 
	#NLMSG_NEXT
(
Æh
,
Ën
è(Ö’è-ğ
	`NLMSG_ALIGN
(Òlh)->
Æmsg_Ën
), \

87 (
Æmsghdr
*)(((*)(
Æh
)è+ 
	`NLMSG_ALIGN
(Òlh)->
Æmsg_Ën
)))

	)

88 
	#NLMSG_OK
(
Æh
,
Ën
è(Ö’è>ğ()(
Æmsghdr
) && \

89 (
Æh
)->
Æmsg_Ën
 >ğ(
Æmsghdr
) && \

90 (
Æh
)->
Æmsg_Ën
 <ğ(
Ën
))

	)

91 
	#NLMSG_PAYLOAD
(
Æh
,
Ën
è(Òlh)->
Æmsg_Ën
 - 
	`NLMSG_SPACE
(Ö’)))

	)

93 
	#NLMSG_NOOP
 0x1

	)

94 
	#NLMSG_ERROR
 0x2

	)

95 
	#NLMSG_DONE
 0x3

	)

96 
	#NLMSG_OVERRUN
 0x4

	)

98 
	#NLMSG_MIN_TYPE
 0x10

	)

100 
	sÆmsg”r
 {

101 
	m”rÜ
;

102 
Æmsghdr
 
	mmsg
;

105 
	#NETLINK_ADD_MEMBERSHIP
 1

	)

106 
	#NETLINK_DROP_MEMBERSHIP
 2

	)

107 
	#NETLINK_PKTINFO
 3

	)

108 
	#NETLINK_BROADCAST_ERROR
 4

	)

109 
	#NETLINK_NO_ENOBUFS
 5

	)

110 
	#NETLINK_RX_RING
 6

	)

111 
	#NETLINK_TX_RING
 7

	)

112 
	#NETLINK_LISTEN_ALL_NSID
 8

	)

113 
	#NETLINK_LIST_MEMBERSHIPS
 9

	)

114 
	#NETLINK_CAP_ACK
 10

	)

116 
	sÆ_pktšfo
 {

117 
__u32
 
	mgroup
;

120 
	sÆ_mm­_»q
 {

121 
	mnm_block_size
;

122 
	mnm_block_Ä
;

123 
	mnm_äame_size
;

124 
	mnm_äame_Ä
;

127 
	sÆ_mm­_hdr
 {

128 
	mnm_¡©us
;

129 
	mnm_Ën
;

130 
__u32
 
	mnm_group
;

132 
__u32
 
	mnm_pid
;

133 
__u32
 
	mnm_uid
;

134 
__u32
 
	mnm_gid
;

137 
	eÆ_mm­_¡©us
 {

138 
	mNL_MMAP_STATUS_UNUSED
,

139 
	mNL_MMAP_STATUS_RESERVED
,

140 
	mNL_MMAP_STATUS_VALID
,

141 
	mNL_MMAP_STATUS_COPY
,

142 
	mNL_MMAP_STATUS_SKIP
,

145 
	#NL_MMAP_MSG_ALIGNMENT
 
NLMSG_ALIGNTO


	)

146 
	#NL_MMAP_MSG_ALIGN
(
sz
è
	`__ALIGN_KERNEL
(sz, 
NL_MMAP_MSG_ALIGNMENT
)

	)

147 
	#NL_MMAP_HDRLEN
 
	`NL_MMAP_MSG_ALIGN
((
Æ_mm­_hdr
))

	)

149 
	#NET_MAJOR
 36

	)

152 
	mNETLINK_UNCONNECTED
 = 0,

153 
	mNETLINK_CONNECTED
,

165 
	sÆ©Œ
 {

166 
__u16
 
	mÆa_Ën
;

167 
__u16
 
	mÆa_ty³
;

180 
	#NLA_F_NESTED
 (1 << 15)

	)

181 
	#NLA_F_NET_BYTEORDER
 (1 << 14)

	)

182 
	#NLA_TYPE_MASK
 ~(
NLA_F_NESTED
 | 
NLA_F_NET_BYTEORDER
)

	)

184 
	#NLA_ALIGNTO
 4

	)

185 
	#NLA_ALIGN
(
Ën
è((Ö’è+ 
NLA_ALIGNTO
 - 1è& ~(NLA_ALIGNTO - 1))

	)

186 
	#NLA_HDRLEN
 ((è
	`NLA_ALIGN
((
Æ©Œ
)))

	)

	@/usr/include/linux/posix_types.h

1 #iâdeà
_LINUX_POSIX_TYPES_H


2 
	#_LINUX_POSIX_TYPES_H


	)

4 
	~<lšux/¡ddef.h
>

21 #undeà
__FD_SETSIZE


22 
	#__FD_SETSIZE
 1024

	)

25 
	mfds_b™s
[
__FD_SETSIZE
 / (8 * ())];

26 } 
	t__k”Ãl_fd_£t
;

29 (*
	t__k”Ãl_sighªdËr_t
)();

32 
	t__k”Ãl_key_t
;

33 
	t__k”Ãl_mqd_t
;

35 
	~<asm/posix_ty³s.h
>

	@/usr/include/linux/socket.h

1 #iâdeà
_LINUX_SOCKET_H


2 
	#_LINUX_SOCKET_H


	)

7 
	#_K_SS_MAXSIZE
 128

	)

8 
	#_K_SS_ALIGNSIZE
 (
	`__®ignof__
 (
sockaddr
 *))

	)

11 
	t__k”Ãl_§_çmy_t
;

13 
	s__k”Ãl_sockaddr_¡Üage
 {

14 
__k”Ãl_§_çmy_t
 
	mss_çmy
;

16 
	m__d©a
[
_K_SS_MAXSIZE
 - ()];

19 } 
__©Œibu‹__
 ((
®igÃd
(
_K_SS_ALIGNSIZE
)));

	@/usr/include/linux/sysctl.h

22 #iâdeà
_LINUX_SYSCTL_H


23 
	#_LINUX_SYSCTL_H


	)

25 
	~<lšux/k”Ãl.h
>

26 
	~<lšux/ty³s.h
>

29 
	#CTL_MAXNAME
 10

	)

34 
	s__sysùl_¬gs
 {

35 *
	mÇme
;

36 
	mÆ’
;

37 *
	mŞdv®
;

38 
size_t
 *
	mŞdËÅ
;

39 *
	mÃwv®
;

40 
size_t
 
	mÃwËn
;

41 
	m__unu£d
[4];

50 
	mCTL_KERN
=1,

51 
	mCTL_VM
=2,

52 
	mCTL_NET
=3,

53 
	mCTL_PROC
=4,

54 
	mCTL_FS
=5,

55 
	mCTL_DEBUG
=6,

56 
	mCTL_DEV
=7,

57 
	mCTL_BUS
=8,

58 
	mCTL_ABI
=9,

59 
	mCTL_CPU
=10,

60 
	mCTL_ARLAN
=254,

61 
	mCTL_S390DBF
=5677,

62 
	mCTL_SUNRPC
=7249,

63 
	mCTL_PM
=9899,

64 
	mCTL_FRV
=9898,

70 
	mCTL_BUS_ISA
=1

76 
	mINOTIFY_MAX_USER_INSTANCES
=1,

77 
	mINOTIFY_MAX_USER_WATCHES
=2,

78 
	mINOTIFY_MAX_QUEUED_EVENTS
=3

84 
	mKERN_OSTYPE
=1,

85 
	mKERN_OSRELEASE
=2,

86 
	mKERN_OSREV
=3,

87 
	mKERN_VERSION
=4,

88 
	mKERN_SECUREMASK
=5,

89 
	mKERN_PROF
=6,

90 
	mKERN_NODENAME
=7,

91 
	mKERN_DOMAINNAME
=8,

93 
	mKERN_PANIC
=15,

94 
	mKERN_REALROOTDEV
=16,

96 
	mKERN_SPARC_REBOOT
=21,

97 
	mKERN_CTLALTDEL
=22,

98 
	mKERN_PRINTK
=23,

99 
	mKERN_NAMETRANS
=24,

100 
	mKERN_PPC_HTABRECLAIM
=25,

101 
	mKERN_PPC_ZEROPAGED
=26,

102 
	mKERN_PPC_POWERSAVE_NAP
=27,

103 
	mKERN_MODPROBE
=28,

104 
	mKERN_SG_BIG_BUFF
=29,

105 
	mKERN_ACCT
=30,

106 
	mKERN_PPC_L2CR
=31,

108 
	mKERN_RTSIGNR
=32,

109 
	mKERN_RTSIGMAX
=33,

111 
	mKERN_SHMMAX
=34,

112 
	mKERN_MSGMAX
=35,

113 
	mKERN_MSGMNB
=36,

114 
	mKERN_MSGPOOL
=37,

115 
	mKERN_SYSRQ
=38,

116 
	mKERN_MAX_THREADS
=39,

117 
	mKERN_RANDOM
=40,

118 
	mKERN_SHMALL
=41,

119 
	mKERN_MSGMNI
=42,

120 
	mKERN_SEM
=43,

121 
	mKERN_SPARC_STOP_A
=44,

122 
	mKERN_SHMMNI
=45,

123 
	mKERN_OVERFLOWUID
=46,

124 
	mKERN_OVERFLOWGID
=47,

125 
	mKERN_SHMPATH
=48,

126 
	mKERN_HOTPLUG
=49,

127 
	mKERN_IEEE_EMULATION_WARNINGS
=50,

128 
	mKERN_S390_USER_DEBUG_LOGGING
=51,

129 
	mKERN_CORE_USES_PID
=52,

130 
	mKERN_TAINTED
=53,

131 
	mKERN_CADPID
=54,

132 
	mKERN_PIDMAX
=55,

133 
	mKERN_CORE_PATTERN
=56,

134 
	mKERN_PANIC_ON_OOPS
=57,

135 
	mKERN_HPPA_PWRSW
=58,

136 
	mKERN_HPPA_UNALIGNED
=59,

137 
	mKERN_PRINTK_RATELIMIT
=60,

138 
	mKERN_PRINTK_RATELIMIT_BURST
=61,

139 
	mKERN_PTY
=62,

140 
	mKERN_NGROUPS_MAX
=63,

141 
	mKERN_SPARC_SCONS_PWROFF
=64,

142 
	mKERN_HZ_TIMER
=65,

143 
	mKERN_UNKNOWN_NMI_PANIC
=66,

144 
	mKERN_BOOTLOADER_TYPE
=67,

145 
	mKERN_RANDOMIZE
=68,

146 
	mKERN_SETUID_DUMPABLE
=69,

147 
	mKERN_SPIN_RETRY
=70,

148 
	mKERN_ACPI_VIDEO_FLAGS
=71,

149 
	mKERN_IA64_UNALIGNED
=72,

150 
	mKERN_COMPAT_LOG
=73,

151 
	mKERN_MAX_LOCK_DEPTH
=74,

152 
	mKERN_NMI_WATCHDOG
=75,

153 
	mKERN_PANIC_ON_NMI
=76,

154 
	mKERN_PANIC_ON_WARN
=77,

162 
	mVM_UNUSED1
=1,

163 
	mVM_UNUSED2
=2,

164 
	mVM_UNUSED3
=3,

165 
	mVM_UNUSED4
=4,

166 
	mVM_OVERCOMMIT_MEMORY
=5,

167 
	mVM_UNUSED5
=6,

168 
	mVM_UNUSED7
=7,

169 
	mVM_UNUSED8
=8,

170 
	mVM_UNUSED9
=9,

171 
	mVM_PAGE_CLUSTER
=10,

172 
	mVM_DIRTY_BACKGROUND
=11,

173 
	mVM_DIRTY_RATIO
=12,

174 
	mVM_DIRTY_WB_CS
=13,

175 
	mVM_DIRTY_EXPIRE_CS
=14,

176 
	mVM_NR_PDFLUSH_THREADS
=15,

177 
	mVM_OVERCOMMIT_RATIO
=16,

178 
	mVM_PAGEBUF
=17,

179 
	mVM_HUGETLB_PAGES
=18,

180 
	mVM_SWAPPINESS
=19,

181 
	mVM_LOWMEM_RESERVE_RATIO
=20,

182 
	mVM_MIN_FREE_KBYTES
=21,

183 
	mVM_MAX_MAP_COUNT
=22,

184 
	mVM_LAPTOP_MODE
=23,

185 
	mVM_BLOCK_DUMP
=24,

186 
	mVM_HUGETLB_GROUP
=25,

187 
	mVM_VFS_CACHE_PRESSURE
=26,

188 
	mVM_LEGACY_VA_LAYOUT
=27,

189 
	mVM_SWAP_TOKEN_TIMEOUT
=28,

190 
	mVM_DROP_PAGECACHE
=29,

191 
	mVM_PERCPU_PAGELIST_FRACTION
=30,

192 
	mVM_ZONE_RECLAIM_MODE
=31,

193 
	mVM_MIN_UNMAPPED
=32,

194 
	mVM_PANIC_ON_OOM
=33,

195 
	mVM_VDSO_ENABLED
=34,

196 
	mVM_MIN_SLAB
=35,

203 
	mNET_CORE
=1,

204 
	mNET_ETHER
=2,

205 
	mNET_802
=3,

206 
	mNET_UNIX
=4,

207 
	mNET_IPV4
=5,

208 
	mNET_IPX
=6,

209 
	mNET_ATALK
=7,

210 
	mNET_NETROM
=8,

211 
	mNET_AX25
=9,

212 
	mNET_BRIDGE
=10,

213 
	mNET_ROSE
=11,

214 
	mNET_IPV6
=12,

215 
	mNET_X25
=13,

216 
	mNET_TR
=14,

217 
	mNET_DECNET
=15,

218 
	mNET_ECONET
=16,

219 
	mNET_SCTP
=17,

220 
	mNET_LLC
=18,

221 
	mNET_NETFILTER
=19,

222 
	mNET_DCCP
=20,

223 
	mNET_IRDA
=412,

229 
	mRANDOM_POOLSIZE
=1,

230 
	mRANDOM_ENTROPY_COUNT
=2,

231 
	mRANDOM_READ_THRESH
=3,

232 
	mRANDOM_WRITE_THRESH
=4,

233 
	mRANDOM_BOOT_ID
=5,

234 
	mRANDOM_UUID
=6

240 
	mPTY_MAX
=1,

241 
	mPTY_NR
=2

247 
	mBUS_ISA_MEM_BASE
=1,

248 
	mBUS_ISA_PORT_BASE
=2,

249 
	mBUS_ISA_PORT_SHIFT
=3

255 
	mNET_CORE_WMEM_MAX
=1,

256 
	mNET_CORE_RMEM_MAX
=2,

257 
	mNET_CORE_WMEM_DEFAULT
=3,

258 
	mNET_CORE_RMEM_DEFAULT
=4,

260 
	mNET_CORE_MAX_BACKLOG
=6,

261 
	mNET_CORE_FASTROUTE
=7,

262 
	mNET_CORE_MSG_COST
=8,

263 
	mNET_CORE_MSG_BURST
=9,

264 
	mNET_CORE_OPTMEM_MAX
=10,

265 
	mNET_CORE_HOT_LIST_LENGTH
=11,

266 
	mNET_CORE_DIVERT_VERSION
=12,

267 
	mNET_CORE_NO_CONG_THRESH
=13,

268 
	mNET_CORE_NO_CONG
=14,

269 
	mNET_CORE_LO_CONG
=15,

270 
	mNET_CORE_MOD_CONG
=16,

271 
	mNET_CORE_DEV_WEIGHT
=17,

272 
	mNET_CORE_SOMAXCONN
=18,

273 
	mNET_CORE_BUDGET
=19,

274 
	mNET_CORE_AEVENT_ETIME
=20,

275 
	mNET_CORE_AEVENT_RSEQTH
=21,

276 
	mNET_CORE_WARNINGS
=22,

287 
	mNET_UNIX_DESTROY_DELAY
=1,

288 
	mNET_UNIX_DELETE_DELAY
=2,

289 
	mNET_UNIX_MAX_DGRAM_QLEN
=3,

295 
	mNET_NF_CONNTRACK_MAX
=1,

296 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_SYN_SENT
=2,

297 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_SYN_RECV
=3,

298 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_ESTABLISHED
=4,

299 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_FIN_WAIT
=5,

300 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_CLOSE_WAIT
=6,

301 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_LAST_ACK
=7,

302 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_TIME_WAIT
=8,

303 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_CLOSE
=9,

304 
	mNET_NF_CONNTRACK_UDP_TIMEOUT
=10,

305 
	mNET_NF_CONNTRACK_UDP_TIMEOUT_STREAM
=11,

306 
	mNET_NF_CONNTRACK_ICMP_TIMEOUT
=12,

307 
	mNET_NF_CONNTRACK_GENERIC_TIMEOUT
=13,

308 
	mNET_NF_CONNTRACK_BUCKETS
=14,

309 
	mNET_NF_CONNTRACK_LOG_INVALID
=15,

310 
	mNET_NF_CONNTRACK_TCP_TIMEOUT_MAX_RETRANS
=16,

311 
	mNET_NF_CONNTRACK_TCP_LOOSE
=17,

312 
	mNET_NF_CONNTRACK_TCP_BE_LIBERAL
=18,

313 
	mNET_NF_CONNTRACK_TCP_MAX_RETRANS
=19,

314 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_CLOSED
=20,

315 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_WAIT
=21,

316 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_ECHOED
=22,

317 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_ESTABLISHED
=23,

318 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_SENT
=24,

319 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_RECD
=25,

320 
	mNET_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_ACK_SENT
=26,

321 
	mNET_NF_CONNTRACK_COUNT
=27,

322 
	mNET_NF_CONNTRACK_ICMPV6_TIMEOUT
=28,

323 
	mNET_NF_CONNTRACK_FRAG6_TIMEOUT
=29,

324 
	mNET_NF_CONNTRACK_FRAG6_LOW_THRESH
=30,

325 
	mNET_NF_CONNTRACK_FRAG6_HIGH_THRESH
=31,

326 
	mNET_NF_CONNTRACK_CHECKSUM
=32,

333 
	mNET_IPV4_FORWARD
=8,

334 
	mNET_IPV4_DYNADDR
=9,

336 
	mNET_IPV4_CONF
=16,

337 
	mNET_IPV4_NEIGH
=17,

338 
	mNET_IPV4_ROUTE
=18,

339 
	mNET_IPV4_FIB_HASH
=19,

340 
	mNET_IPV4_NETFILTER
=20,

342 
	mNET_IPV4_TCP_TIMESTAMPS
=33,

343 
	mNET_IPV4_TCP_WINDOW_SCALING
=34,

344 
	mNET_IPV4_TCP_SACK
=35,

345 
	mNET_IPV4_TCP_RETRANS_COLLAPSE
=36,

346 
	mNET_IPV4_DEFAULT_TTL
=37,

347 
	mNET_IPV4_AUTOCONFIG
=38,

348 
	mNET_IPV4_NO_PMTU_DISC
=39,

349 
	mNET_IPV4_TCP_SYN_RETRIES
=40,

350 
	mNET_IPV4_IPFRAG_HIGH_THRESH
=41,

351 
	mNET_IPV4_IPFRAG_LOW_THRESH
=42,

352 
	mNET_IPV4_IPFRAG_TIME
=43,

353 
	mNET_IPV4_TCP_MAX_KA_PROBES
=44,

354 
	mNET_IPV4_TCP_KEEPALIVE_TIME
=45,

355 
	mNET_IPV4_TCP_KEEPALIVE_PROBES
=46,

356 
	mNET_IPV4_TCP_RETRIES1
=47,

357 
	mNET_IPV4_TCP_RETRIES2
=48,

358 
	mNET_IPV4_TCP_FIN_TIMEOUT
=49,

359 
	mNET_IPV4_IP_MASQ_DEBUG
=50,

360 
	mNET_TCP_SYNCOOKIES
=51,

361 
	mNET_TCP_STDURG
=52,

362 
	mNET_TCP_RFC1337
=53,

363 
	mNET_TCP_SYN_TAILDROP
=54,

364 
	mNET_TCP_MAX_SYN_BACKLOG
=55,

365 
	mNET_IPV4_LOCAL_PORT_RANGE
=56,

366 
	mNET_IPV4_ICMP_ECHO_IGNORE_ALL
=57,

367 
	mNET_IPV4_ICMP_ECHO_IGNORE_BROADCASTS
=58,

368 
	mNET_IPV4_ICMP_SOURCEQUENCH_RATE
=59,

369 
	mNET_IPV4_ICMP_DESTUNREACH_RATE
=60,

370 
	mNET_IPV4_ICMP_TIMEEXCEED_RATE
=61,

371 
	mNET_IPV4_ICMP_PARAMPROB_RATE
=62,

372 
	mNET_IPV4_ICMP_ECHOREPLY_RATE
=63,

373 
	mNET_IPV4_ICMP_IGNORE_BOGUS_ERROR_RESPONSES
=64,

374 
	mNET_IPV4_IGMP_MAX_MEMBERSHIPS
=65,

375 
	mNET_TCP_TW_RECYCLE
=66,

376 
	mNET_IPV4_ALWAYS_DEFRAG
=67,

377 
	mNET_IPV4_TCP_KEEPALIVE_INTVL
=68,

378 
	mNET_IPV4_INET_PEER_THRESHOLD
=69,

379 
	mNET_IPV4_INET_PEER_MINTTL
=70,

380 
	mNET_IPV4_INET_PEER_MAXTTL
=71,

381 
	mNET_IPV4_INET_PEER_GC_MINTIME
=72,

382 
	mNET_IPV4_INET_PEER_GC_MAXTIME
=73,

383 
	mNET_TCP_ORPHAN_RETRIES
=74,

384 
	mNET_TCP_ABORT_ON_OVERFLOW
=75,

385 
	mNET_TCP_SYNACK_RETRIES
=76,

386 
	mNET_TCP_MAX_ORPHANS
=77,

387 
	mNET_TCP_MAX_TW_BUCKETS
=78,

388 
	mNET_TCP_FACK
=79,

389 
	mNET_TCP_REORDERING
=80,

390 
	mNET_TCP_ECN
=81,

391 
	mNET_TCP_DSACK
=82,

392 
	mNET_TCP_MEM
=83,

393 
	mNET_TCP_WMEM
=84,

394 
	mNET_TCP_RMEM
=85,

395 
	mNET_TCP_APP_WIN
=86,

396 
	mNET_TCP_ADV_WIN_SCALE
=87,

397 
	mNET_IPV4_NONLOCAL_BIND
=88,

398 
	mNET_IPV4_ICMP_RATELIMIT
=89,

399 
	mNET_IPV4_ICMP_RATEMASK
=90,

400 
	mNET_TCP_TW_REUSE
=91,

401 
	mNET_TCP_FRTO
=92,

402 
	mNET_TCP_LOW_LATENCY
=93,

403 
	mNET_IPV4_IPFRAG_SECRET_INTERVAL
=94,

404 
	mNET_IPV4_IGMP_MAX_MSF
=96,

405 
	mNET_TCP_NO_METRICS_SAVE
=97,

406 
	mNET_TCP_DEFAULT_WIN_SCALE
=105,

407 
	mNET_TCP_MODERATE_RCVBUF
=106,

408 
	mNET_TCP_TSO_WIN_DIVISOR
=107,

409 
	mNET_TCP_BIC_BETA
=108,

410 
	mNET_IPV4_ICMP_ERRORS_USE_INBOUND_IFADDR
=109,

411 
	mNET_TCP_CONG_CONTROL
=110,

412 
	mNET_TCP_ABC
=111,

413 
	mNET_IPV4_IPFRAG_MAX_DIST
=112,

414 
	mNET_TCP_MTU_PROBING
=113,

415 
	mNET_TCP_BASE_MSS
=114,

416 
	mNET_IPV4_TCP_WORKAROUND_SIGNED_WINDOWS
=115,

417 
	mNET_TCP_DMA_COPYBREAK
=116,

418 
	mNET_TCP_SLOW_START_AFTER_IDLE
=117,

419 
	mNET_CIPSOV4_CACHE_ENABLE
=118,

420 
	mNET_CIPSOV4_CACHE_BUCKET_SIZE
=119,

421 
	mNET_CIPSOV4_RBM_OPTFMT
=120,

422 
	mNET_CIPSOV4_RBM_STRICTVALID
=121,

423 
	mNET_TCP_AVAIL_CONG_CONTROL
=122,

424 
	mNET_TCP_ALLOWED_CONG_CONTROL
=123,

425 
	mNET_TCP_MAX_SSTHRESH
=124,

426 
	mNET_TCP_FRTO_RESPONSE
=125,

430 
	mNET_IPV4_ROUTE_FLUSH
=1,

431 
	mNET_IPV4_ROUTE_MIN_DELAY
=2,

432 
	mNET_IPV4_ROUTE_MAX_DELAY
=3,

433 
	mNET_IPV4_ROUTE_GC_THRESH
=4,

434 
	mNET_IPV4_ROUTE_MAX_SIZE
=5,

435 
	mNET_IPV4_ROUTE_GC_MIN_INTERVAL
=6,

436 
	mNET_IPV4_ROUTE_GC_TIMEOUT
=7,

437 
	mNET_IPV4_ROUTE_GC_INTERVAL
=8,

438 
	mNET_IPV4_ROUTE_REDIRECT_LOAD
=9,

439 
	mNET_IPV4_ROUTE_REDIRECT_NUMBER
=10,

440 
	mNET_IPV4_ROUTE_REDIRECT_SILENCE
=11,

441 
	mNET_IPV4_ROUTE_ERROR_COST
=12,

442 
	mNET_IPV4_ROUTE_ERROR_BURST
=13,

443 
	mNET_IPV4_ROUTE_GC_ELASTICITY
=14,

444 
	mNET_IPV4_ROUTE_MTU_EXPIRES
=15,

445 
	mNET_IPV4_ROUTE_MIN_PMTU
=16,

446 
	mNET_IPV4_ROUTE_MIN_ADVMSS
=17,

447 
	mNET_IPV4_ROUTE_SECRET_INTERVAL
=18,

448 
	mNET_IPV4_ROUTE_GC_MIN_INTERVAL_MS
=19,

453 
	mNET_PROTO_CONF_ALL
=-2,

454 
	mNET_PROTO_CONF_DEFAULT
=-3

461 
	mNET_IPV4_CONF_FORWARDING
=1,

462 
	mNET_IPV4_CONF_MC_FORWARDING
=2,

463 
	mNET_IPV4_CONF_PROXY_ARP
=3,

464 
	mNET_IPV4_CONF_ACCEPT_REDIRECTS
=4,

465 
	mNET_IPV4_CONF_SECURE_REDIRECTS
=5,

466 
	mNET_IPV4_CONF_SEND_REDIRECTS
=6,

467 
	mNET_IPV4_CONF_SHARED_MEDIA
=7,

468 
	mNET_IPV4_CONF_RP_FILTER
=8,

469 
	mNET_IPV4_CONF_ACCEPT_SOURCE_ROUTE
=9,

470 
	mNET_IPV4_CONF_BOOTP_RELAY
=10,

471 
	mNET_IPV4_CONF_LOG_MARTIANS
=11,

472 
	mNET_IPV4_CONF_TAG
=12,

473 
	mNET_IPV4_CONF_ARPFILTER
=13,

474 
	mNET_IPV4_CONF_MEDIUM_ID
=14,

475 
	mNET_IPV4_CONF_NOXFRM
=15,

476 
	mNET_IPV4_CONF_NOPOLICY
=16,

477 
	mNET_IPV4_CONF_FORCE_IGMP_VERSION
=17,

478 
	mNET_IPV4_CONF_ARP_ANNOUNCE
=18,

479 
	mNET_IPV4_CONF_ARP_IGNORE
=19,

480 
	mNET_IPV4_CONF_PROMOTE_SECONDARIES
=20,

481 
	mNET_IPV4_CONF_ARP_ACCEPT
=21,

482 
	mNET_IPV4_CONF_ARP_NOTIFY
=22,

488 
	mNET_IPV4_NF_CONNTRACK_MAX
=1,

489 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_SYN_SENT
=2,

490 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_SYN_RECV
=3,

491 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_ESTABLISHED
=4,

492 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_FIN_WAIT
=5,

493 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_CLOSE_WAIT
=6,

494 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_LAST_ACK
=7,

495 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_TIME_WAIT
=8,

496 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_CLOSE
=9,

497 
	mNET_IPV4_NF_CONNTRACK_UDP_TIMEOUT
=10,

498 
	mNET_IPV4_NF_CONNTRACK_UDP_TIMEOUT_STREAM
=11,

499 
	mNET_IPV4_NF_CONNTRACK_ICMP_TIMEOUT
=12,

500 
	mNET_IPV4_NF_CONNTRACK_GENERIC_TIMEOUT
=13,

501 
	mNET_IPV4_NF_CONNTRACK_BUCKETS
=14,

502 
	mNET_IPV4_NF_CONNTRACK_LOG_INVALID
=15,

503 
	mNET_IPV4_NF_CONNTRACK_TCP_TIMEOUT_MAX_RETRANS
=16,

504 
	mNET_IPV4_NF_CONNTRACK_TCP_LOOSE
=17,

505 
	mNET_IPV4_NF_CONNTRACK_TCP_BE_LIBERAL
=18,

506 
	mNET_IPV4_NF_CONNTRACK_TCP_MAX_RETRANS
=19,

507 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_CLOSED
=20,

508 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_WAIT
=21,

509 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_COOKIE_ECHOED
=22,

510 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_ESTABLISHED
=23,

511 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_SENT
=24,

512 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_RECD
=25,

513 
	mNET_IPV4_NF_CONNTRACK_SCTP_TIMEOUT_SHUTDOWN_ACK_SENT
=26,

514 
	mNET_IPV4_NF_CONNTRACK_COUNT
=27,

515 
	mNET_IPV4_NF_CONNTRACK_CHECKSUM
=28,

520 
	mNET_IPV6_CONF
=16,

521 
	mNET_IPV6_NEIGH
=17,

522 
	mNET_IPV6_ROUTE
=18,

523 
	mNET_IPV6_ICMP
=19,

524 
	mNET_IPV6_BINDV6ONLY
=20,

525 
	mNET_IPV6_IP6FRAG_HIGH_THRESH
=21,

526 
	mNET_IPV6_IP6FRAG_LOW_THRESH
=22,

527 
	mNET_IPV6_IP6FRAG_TIME
=23,

528 
	mNET_IPV6_IP6FRAG_SECRET_INTERVAL
=24,

529 
	mNET_IPV6_MLD_MAX_MSF
=25,

533 
	mNET_IPV6_ROUTE_FLUSH
=1,

534 
	mNET_IPV6_ROUTE_GC_THRESH
=2,

535 
	mNET_IPV6_ROUTE_MAX_SIZE
=3,

536 
	mNET_IPV6_ROUTE_GC_MIN_INTERVAL
=4,

537 
	mNET_IPV6_ROUTE_GC_TIMEOUT
=5,

538 
	mNET_IPV6_ROUTE_GC_INTERVAL
=6,

539 
	mNET_IPV6_ROUTE_GC_ELASTICITY
=7,

540 
	mNET_IPV6_ROUTE_MTU_EXPIRES
=8,

541 
	mNET_IPV6_ROUTE_MIN_ADVMSS
=9,

542 
	mNET_IPV6_ROUTE_GC_MIN_INTERVAL_MS
=10

546 
	mNET_IPV6_FORWARDING
=1,

547 
	mNET_IPV6_HOP_LIMIT
=2,

548 
	mNET_IPV6_MTU
=3,

549 
	mNET_IPV6_ACCEPT_RA
=4,

550 
	mNET_IPV6_ACCEPT_REDIRECTS
=5,

551 
	mNET_IPV6_AUTOCONF
=6,

552 
	mNET_IPV6_DAD_TRANSMITS
=7,

553 
	mNET_IPV6_RTR_SOLICITS
=8,

554 
	mNET_IPV6_RTR_SOLICIT_INTERVAL
=9,

555 
	mNET_IPV6_RTR_SOLICIT_DELAY
=10,

556 
	mNET_IPV6_USE_TEMPADDR
=11,

557 
	mNET_IPV6_TEMP_VALID_LFT
=12,

558 
	mNET_IPV6_TEMP_PREFERED_LFT
=13,

559 
	mNET_IPV6_REGEN_MAX_RETRY
=14,

560 
	mNET_IPV6_MAX_DESYNC_FACTOR
=15,

561 
	mNET_IPV6_MAX_ADDRESSES
=16,

562 
	mNET_IPV6_FORCE_MLD_VERSION
=17,

563 
	mNET_IPV6_ACCEPT_RA_DEFRTR
=18,

564 
	mNET_IPV6_ACCEPT_RA_PINFO
=19,

565 
	mNET_IPV6_ACCEPT_RA_RTR_PREF
=20,

566 
	mNET_IPV6_RTR_PROBE_INTERVAL
=21,

567 
	mNET_IPV6_ACCEPT_RA_RT_INFO_MAX_PLEN
=22,

568 
	mNET_IPV6_PROXY_NDP
=23,

569 
	mNET_IPV6_ACCEPT_SOURCE_ROUTE
=25,

570 
	mNET_IPV6_ACCEPT_RA_FROM_LOCAL
=26,

571 
	m__NET_IPV6_MAX


576 
	mNET_IPV6_ICMP_RATELIMIT
=1

581 
	mNET_NEIGH_MCAST_SOLICIT
=1,

582 
	mNET_NEIGH_UCAST_SOLICIT
=2,

583 
	mNET_NEIGH_APP_SOLICIT
=3,

584 
	mNET_NEIGH_RETRANS_TIME
=4,

585 
	mNET_NEIGH_REACHABLE_TIME
=5,

586 
	mNET_NEIGH_DELAY_PROBE_TIME
=6,

587 
	mNET_NEIGH_GC_STALE_TIME
=7,

588 
	mNET_NEIGH_UNRES_QLEN
=8,

589 
	mNET_NEIGH_PROXY_QLEN
=9,

590 
	mNET_NEIGH_ANYCAST_DELAY
=10,

591 
	mNET_NEIGH_PROXY_DELAY
=11,

592 
	mNET_NEIGH_LOCKTIME
=12,

593 
	mNET_NEIGH_GC_INTERVAL
=13,

594 
	mNET_NEIGH_GC_THRESH1
=14,

595 
	mNET_NEIGH_GC_THRESH2
=15,

596 
	mNET_NEIGH_GC_THRESH3
=16,

597 
	mNET_NEIGH_RETRANS_TIME_MS
=17,

598 
	mNET_NEIGH_REACHABLE_TIME_MS
=18,

603 
	mNET_DCCP_DEFAULT
=1,

608 
	mNET_IPX_PPROP_BROADCASTING
=1,

609 
	mNET_IPX_FORWARDING
=2

614 
	mNET_LLC2
=1,

615 
	mNET_LLC_STATION
=2,

620 
	mNET_LLC2_TIMEOUT
=1,

625 
	mNET_LLC_STATION_ACK_TIMEOUT
=1,

630 
	mNET_LLC2_ACK_TIMEOUT
=1,

631 
	mNET_LLC2_P_TIMEOUT
=2,

632 
	mNET_LLC2_REJ_TIMEOUT
=3,

633 
	mNET_LLC2_BUSY_TIMEOUT
=4,

638 
	mNET_ATALK_AARP_EXPIRY_TIME
=1,

639 
	mNET_ATALK_AARP_TICK_TIME
=2,

640 
	mNET_ATALK_AARP_RETRANSMIT_LIMIT
=3,

641 
	mNET_ATALK_AARP_RESOLVE_TIME
=4

647 
	mNET_NETROM_DEFAULT_PATH_QUALITY
=1,

648 
	mNET_NETROM_OBSOLESCENCE_COUNT_INITIALISER
=2,

649 
	mNET_NETROM_NETWORK_TTL_INITIALISER
=3,

650 
	mNET_NETROM_TRANSPORT_TIMEOUT
=4,

651 
	mNET_NETROM_TRANSPORT_MAXIMUM_TRIES
=5,

652 
	mNET_NETROM_TRANSPORT_ACKNOWLEDGE_DELAY
=6,

653 
	mNET_NETROM_TRANSPORT_BUSY_DELAY
=7,

654 
	mNET_NETROM_TRANSPORT_REQUESTED_WINDOW_SIZE
=8,

655 
	mNET_NETROM_TRANSPORT_NO_ACTIVITY_TIMEOUT
=9,

656 
	mNET_NETROM_ROUTING_CONTROL
=10,

657 
	mNET_NETROM_LINK_FAILS_COUNT
=11,

658 
	mNET_NETROM_RESET
=12

663 
	mNET_AX25_IP_DEFAULT_MODE
=1,

664 
	mNET_AX25_DEFAULT_MODE
=2,

665 
	mNET_AX25_BACKOFF_TYPE
=3,

666 
	mNET_AX25_CONNECT_MODE
=4,

667 
	mNET_AX25_STANDARD_WINDOW
=5,

668 
	mNET_AX25_EXTENDED_WINDOW
=6,

669 
	mNET_AX25_T1_TIMEOUT
=7,

670 
	mNET_AX25_T2_TIMEOUT
=8,

671 
	mNET_AX25_T3_TIMEOUT
=9,

672 
	mNET_AX25_IDLE_TIMEOUT
=10,

673 
	mNET_AX25_N2
=11,

674 
	mNET_AX25_PACLEN
=12,

675 
	mNET_AX25_PROTOCOL
=13,

676 
	mNET_AX25_DAMA_SLAVE_TIMEOUT
=14

681 
	mNET_ROSE_RESTART_REQUEST_TIMEOUT
=1,

682 
	mNET_ROSE_CALL_REQUEST_TIMEOUT
=2,

683 
	mNET_ROSE_RESET_REQUEST_TIMEOUT
=3,

684 
	mNET_ROSE_CLEAR_REQUEST_TIMEOUT
=4,

685 
	mNET_ROSE_ACK_HOLD_BACK_TIMEOUT
=5,

686 
	mNET_ROSE_ROUTING_CONTROL
=6,

687 
	mNET_ROSE_LINK_FAIL_TIMEOUT
=7,

688 
	mNET_ROSE_MAX_VCS
=8,

689 
	mNET_ROSE_WINDOW_SIZE
=9,

690 
	mNET_ROSE_NO_ACTIVITY_TIMEOUT
=10

695 
	mNET_X25_RESTART_REQUEST_TIMEOUT
=1,

696 
	mNET_X25_CALL_REQUEST_TIMEOUT
=2,

697 
	mNET_X25_RESET_REQUEST_TIMEOUT
=3,

698 
	mNET_X25_CLEAR_REQUEST_TIMEOUT
=4,

699 
	mNET_X25_ACK_HOLD_BACK_TIMEOUT
=5,

700 
	mNET_X25_FORWARD
=6

706 
	mNET_TR_RIF_TIMEOUT
=1

711 
	mNET_DECNET_NODE_TYPE
 = 1,

712 
	mNET_DECNET_NODE_ADDRESS
 = 2,

713 
	mNET_DECNET_NODE_NAME
 = 3,

714 
	mNET_DECNET_DEFAULT_DEVICE
 = 4,

715 
	mNET_DECNET_TIME_WAIT
 = 5,

716 
	mNET_DECNET_DN_COUNT
 = 6,

717 
	mNET_DECNET_DI_COUNT
 = 7,

718 
	mNET_DECNET_DR_COUNT
 = 8,

719 
	mNET_DECNET_DST_GC_INTERVAL
 = 9,

720 
	mNET_DECNET_CONF
 = 10,

721 
	mNET_DECNET_NO_FC_MAX_CWND
 = 11,

722 
	mNET_DECNET_MEM
 = 12,

723 
	mNET_DECNET_RMEM
 = 13,

724 
	mNET_DECNET_WMEM
 = 14,

725 
	mNET_DECNET_DEBUG_LEVEL
 = 255

730 
	mNET_DECNET_CONF_LOOPBACK
 = -2,

731 
	mNET_DECNET_CONF_DDCMP
 = -3,

732 
	mNET_DECNET_CONF_PPP
 = -4,

733 
	mNET_DECNET_CONF_X25
 = -5,

734 
	mNET_DECNET_CONF_GRE
 = -6,

735 
	mNET_DECNET_CONF_ETHER
 = -7

742 
	mNET_DECNET_CONF_DEV_PRIORITY
 = 1,

743 
	mNET_DECNET_CONF_DEV_T1
 = 2,

744 
	mNET_DECNET_CONF_DEV_T2
 = 3,

745 
	mNET_DECNET_CONF_DEV_T3
 = 4,

746 
	mNET_DECNET_CONF_DEV_FORWARDING
 = 5,

747 
	mNET_DECNET_CONF_DEV_BLKSIZE
 = 6,

748 
	mNET_DECNET_CONF_DEV_STATE
 = 7

753 
	mNET_SCTP_RTO_INITIAL
 = 1,

754 
	mNET_SCTP_RTO_MIN
 = 2,

755 
	mNET_SCTP_RTO_MAX
 = 3,

756 
	mNET_SCTP_RTO_ALPHA
 = 4,

757 
	mNET_SCTP_RTO_BETA
 = 5,

758 
	mNET_SCTP_VALID_COOKIE_LIFE
 = 6,

759 
	mNET_SCTP_ASSOCIATION_MAX_RETRANS
 = 7,

760 
	mNET_SCTP_PATH_MAX_RETRANS
 = 8,

761 
	mNET_SCTP_MAX_INIT_RETRANSMITS
 = 9,

762 
	mNET_SCTP_HB_INTERVAL
 = 10,

763 
	mNET_SCTP_PRESERVE_ENABLE
 = 11,

764 
	mNET_SCTP_MAX_BURST
 = 12,

765 
	mNET_SCTP_ADDIP_ENABLE
 = 13,

766 
	mNET_SCTP_PRSCTP_ENABLE
 = 14,

767 
	mNET_SCTP_SNDBUF_POLICY
 = 15,

768 
	mNET_SCTP_SACK_TIMEOUT
 = 16,

769 
	mNET_SCTP_RCVBUF_POLICY
 = 17,

774 
	mNET_BRIDGE_NF_CALL_ARPTABLES
 = 1,

775 
	mNET_BRIDGE_NF_CALL_IPTABLES
 = 2,

776 
	mNET_BRIDGE_NF_CALL_IP6TABLES
 = 3,

777 
	mNET_BRIDGE_NF_FILTER_VLAN_TAGGED
 = 4,

778 
	mNET_BRIDGE_NF_FILTER_PPPOE_TAGGED
 = 5,

783 
	mNET_IRDA_DISCOVERY
=1,

784 
	mNET_IRDA_DEVNAME
=2,

785 
	mNET_IRDA_DEBUG
=3,

786 
	mNET_IRDA_FAST_POLL
=4,

787 
	mNET_IRDA_DISCOVERY_SLOTS
=5,

788 
	mNET_IRDA_DISCOVERY_TIMEOUT
=6,

789 
	mNET_IRDA_SLOT_TIMEOUT
=7,

790 
	mNET_IRDA_MAX_BAUD_RATE
=8,

791 
	mNET_IRDA_MIN_TX_TURN_TIME
=9,

792 
	mNET_IRDA_MAX_TX_DATA_SIZE
=10,

793 
	mNET_IRDA_MAX_TX_WINDOW
=11,

794 
	mNET_IRDA_MAX_NOREPLY_TIME
=12,

795 
	mNET_IRDA_WARN_NOREPLY_TIME
=13,

796 
	mNET_IRDA_LAP_KEEPALIVE_TIME
=14,

803 
	mFS_NRINODE
=1,

804 
	mFS_STATINODE
=2,

805 
	mFS_MAXINODE
=3,

806 
	mFS_NRDQUOT
=4,

807 
	mFS_MAXDQUOT
=5,

808 
	mFS_NRFILE
=6,

809 
	mFS_MAXFILE
=7,

810 
	mFS_DENTRY
=8,

811 
	mFS_NRSUPER
=9,

812 
	mFS_MAXSUPER
=10,

813 
	mFS_OVERFLOWUID
=11,

814 
	mFS_OVERFLOWGID
=12,

815 
	mFS_LEASES
=13,

816 
	mFS_DIR_NOTIFY
=14,

817 
	mFS_LEASE_TIME
=15,

818 
	mFS_DQSTATS
=16,

819 
	mFS_XFS
=17,

820 
	mFS_AIO_NR
=18,

821 
	mFS_AIO_MAX_NR
=19,

822 
	mFS_INOTIFY
=20,

823 
	mFS_OCFS2
=988,

828 
	mFS_DQ_LOOKUPS
 = 1,

829 
	mFS_DQ_DROPS
 = 2,

830 
	mFS_DQ_READS
 = 3,

831 
	mFS_DQ_WRITES
 = 4,

832 
	mFS_DQ_CACHE_HITS
 = 5,

833 
	mFS_DQ_ALLOCATED
 = 6,

834 
	mFS_DQ_FREE
 = 7,

835 
	mFS_DQ_SYNCS
 = 8,

836 
	mFS_DQ_WARNINGS
 = 9,

843 
	mDEV_CDROM
=1,

844 
	mDEV_HWMON
=2,

845 
	mDEV_PARPORT
=3,

846 
	mDEV_RAID
=4,

847 
	mDEV_MAC_HID
=5,

848 
	mDEV_SCSI
=6,

849 
	mDEV_IPMI
=7,

854 
	mDEV_CDROM_INFO
=1,

855 
	mDEV_CDROM_AUTOCLOSE
=2,

856 
	mDEV_CDROM_AUTOEJECT
=3,

857 
	mDEV_CDROM_DEBUG
=4,

858 
	mDEV_CDROM_LOCK
=5,

859 
	mDEV_CDROM_CHECK_MEDIA
=6

864 
	mDEV_PARPORT_DEFAULT
=-3

869 
	mDEV_RAID_SPEED_LIMIT_MIN
=1,

870 
	mDEV_RAID_SPEED_LIMIT_MAX
=2

875 
	mDEV_PARPORT_DEFAULT_TIMESLICE
=1,

876 
	mDEV_PARPORT_DEFAULT_SPINTIME
=2

881 
	mDEV_PARPORT_SPINTIME
=1,

882 
	mDEV_PARPORT_BASE_ADDR
=2,

883 
	mDEV_PARPORT_IRQ
=3,

884 
	mDEV_PARPORT_DMA
=4,

885 
	mDEV_PARPORT_MODES
=5,

886 
	mDEV_PARPORT_DEVICES
=6,

887 
	mDEV_PARPORT_AUTOPROBE
=16

892 
	mDEV_PARPORT_DEVICES_ACTIVE
=-3,

897 
	mDEV_PARPORT_DEVICE_TIMESLICE
=1,

902 
	mDEV_MAC_HID_KEYBOARD_SENDS_LINUX_KEYCODES
=1,

903 
	mDEV_MAC_HID_KEYBOARD_LOCK_KEYCODES
=2,

904 
	mDEV_MAC_HID_MOUSE_BUTTON_EMULATION
=3,

905 
	mDEV_MAC_HID_MOUSE_BUTTON2_KEYCODE
=4,

906 
	mDEV_MAC_HID_MOUSE_BUTTON3_KEYCODE
=5,

907 
	mDEV_MAC_HID_ADB_MOUSE_SENDS_KEYCODES
=6

912 
	mDEV_SCSI_LOGGING_LEVEL
=1,

917 
	mDEV_IPMI_POWEROFF_POWERCYCLE
=1,

923 
	mABI_DEFHANDLER_COFF
=1,

924 
	mABI_DEFHANDLER_ELF
=2,

925 
	mABI_DEFHANDLER_LCALL7
=3,

926 
	mABI_DEFHANDLER_LIBCSO
=4,

927 
	mABI_TRACE
=5,

928 
	mABI_FAKE_UTSNAME
=6,

	@/usr/include/rpc/netdb.h

36 #iâdeà
_RPC_NETDB_H


37 
	#_RPC_NETDB_H
 1

	)

39 
	~<ã©u»s.h
>

41 
	#__Ãed_size_t


	)

42 
	~<¡ddef.h
>

44 
__BEGIN_DECLS


46 
	s½ûÁ


48 *
	mr_Çme
;

49 **
	mr_®Ÿ£s
;

50 
	mr_numb”
;

53 
	$£ŒpûÁ
 (
__¡ayİ’
è
__THROW
;

54 
	$’d½ûÁ
 (è
__THROW
;

55 
½ûÁ
 *
	$g‘½cbyÇme
 (cÚ¡ *
__Çme
è
__THROW
;

56 
½ûÁ
 *
	$g‘½cbynumb”
 (
__numb”
è
__THROW
;

57 
½ûÁ
 *
	$g‘½ûÁ
 (è
__THROW
;

59 #ifdeà
__USE_MISC


60 
	$g‘½cbyÇme_r
 (cÚ¡ *
__Çme
, 
½ûÁ
 *
__»suÉ_buf
,

61 *
__bufãr
, 
size_t
 
__buæ’
,

62 
½ûÁ
 **
__»suÉ
è
__THROW
;

64 
	$g‘½cbynumb”_r
 (
__numb”
, 
½ûÁ
 *
__»suÉ_buf
,

65 *
__bufãr
, 
size_t
 
__buæ’
,

66 
½ûÁ
 **
__»suÉ
è
__THROW
;

68 
	$g‘½ûÁ_r
 (
½ûÁ
 *
__»suÉ_buf
, *
__bufãr
,

69 
size_t
 
__buæ’
, 
½ûÁ
 **
__»suÉ
è
__THROW
;

72 
__END_DECLS


	@/usr/include/sched.h

19 #iâdef 
_SCHED_H


20 
	#_SCHED_H
 1

	)

22 
	~<ã©u»s.h
>

25 
	~<b™s/ty³s.h
>

27 
	#__Ãed_size_t


	)

28 
	~<¡ddef.h
>

30 #ifdeà
__USE_XOPEN2K


31 
	#__Ãed_time_t


	)

32 
	#__Ãed_time¥ec


	)

34 
	~<time.h
>

36 #iâdeà
__pid_t_defšed


37 
__pid_t
 
	tpid_t
;

38 
	#__pid_t_defšed


	)

43 
	~<b™s/sched.h
>

45 
	#sched_´iÜ™y
 
__sched_´iÜ™y


	)

48 
__BEGIN_DECLS


51 
	$sched_£¬am
 (
__pid_t
 
__pid
, cÚ¡ 
sched_·¿m
 *
__·¿m
)

52 
__THROW
;

55 
	$sched_g‘·¿m
 (
__pid_t
 
__pid
, 
sched_·¿m
 *
__·¿m
è
__THROW
;

58 
	$sched_£tscheduËr
 (
__pid_t
 
__pid
, 
__pŞicy
,

59 cÚ¡ 
sched_·¿m
 *
__·¿m
è
__THROW
;

62 
	$sched_g‘scheduËr
 (
__pid_t
 
__pid
è
__THROW
;

65 
	$sched_y›ld
 (è
__THROW
;

68 
	$sched_g‘_´iÜ™y_max
 (
__®gÜ™hm
è
__THROW
;

71 
	$sched_g‘_´iÜ™y_mš
 (
__®gÜ™hm
è
__THROW
;

74 
	$sched_¼_g‘_š‹rv®
 (
__pid_t
 
__pid
, 
time¥ec
 *
__t
è
__THROW
;

77 #ifdeà
__USE_GNU


79 
	#CPU_SETSIZE
 
__CPU_SETSIZE


	)

80 
	#CPU_SET
(
ıu
, 
ıu£
è
	`__CPU_SET_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

81 
	#CPU_CLR
(
ıu
, 
ıu£
è
	`__CPU_CLR_S
 (ıu,  (
ıu_£t_t
), cpu£)

	)

82 
	#CPU_ISSET
(
ıu
, 
ıu£
è
	`__CPU_ISSET_S
 (ıu,  (
ıu_£t_t
), \

83 
ıu£
)

	)

84 
	#CPU_ZERO
(
ıu£
è
	`__CPU_ZERO_S
 ( (
ıu_£t_t
), cpu£)

	)

85 
	#CPU_COUNT
(
ıu£
è
	`__CPU_COUNT_S
 ( (
ıu_£t_t
), cpu£)

	)

87 
	#CPU_SET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_SET_S
 (ıu, s‘size, cpu£)

	)

88 
	#CPU_CLR_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_CLR_S
 (ıu, s‘size, cpu£)

	)

89 
	#CPU_ISSET_S
(
ıu
, 
£tsize
, 
ıu£
è
	`__CPU_ISSET_S
 (cpu, setsize, \

90 
ıu£
)

	)

91 
	#CPU_ZERO_S
(
£tsize
, 
ıu£
è
	`__CPU_ZERO_S
 (£tsize, cpu£)

	)

92 
	#CPU_COUNT_S
(
£tsize
, 
ıu£
è
	`__CPU_COUNT_S
 (£tsize, cpu£)

	)

94 
	#CPU_EQUAL
(
ıu£1
, 
ıu£2
) \

95 
	`__CPU_EQUAL_S
 ( (
ıu_£t_t
), 
ıu£1
, 
ıu£2
)

	)

96 
	#CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

97 
	`__CPU_EQUAL_S
 (
£tsize
, 
ıu£1
, 
ıu£2
)

	)

99 
	#CPU_AND
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

100 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

101 
	#CPU_OR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

102 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

103 
	#CPU_XOR
(
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

104 
	`__CPU_OP_S
 ( (
ıu_£t_t
), 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

105 
	#CPU_AND_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

106 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, &)

	)

107 
	#CPU_OR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

108 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, |)

	)

109 
	#CPU_XOR_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
) \

110 
	`__CPU_OP_S
 (
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, ^)

	)

112 
	#CPU_ALLOC_SIZE
(
couÁ
è
	`__CPU_ALLOC_SIZE
 (couÁ)

	)

113 
	#CPU_ALLOC
(
couÁ
è
	`__CPU_ALLOC
 (couÁ)

	)

114 
	#CPU_FREE
(
ıu£t
è
	`__CPU_FREE
 (ıu£t)

	)

118 
	$sched_£ffš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

119 cÚ¡ 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

122 
	$sched_g‘affš™y
 (
__pid_t
 
__pid
, 
size_t
 
__ıu£tsize
,

123 
ıu_£t_t
 *
__ıu£t
è
__THROW
;

126 
__END_DECLS


	@/usr/include/stdc-predef.h

18 #iâdef 
_STDC_PREDEF_H


19 
	#_STDC_PREDEF_H
 1

	)

36 #ifdeà
__GCC_IEC_559


37 #ià
__GCC_IEC_559
 > 0

38 
	#__STDC_IEC_559__
 1

	)

41 
	#__STDC_IEC_559__
 1

	)

44 #ifdeà
__GCC_IEC_559_COMPLEX


45 #ià
__GCC_IEC_559_COMPLEX
 > 0

46 
	#__STDC_IEC_559_COMPLEX__
 1

	)

49 
	#__STDC_IEC_559_COMPLEX__
 1

	)

57 
	#__STDC_ISO_10646__
 201605L

	)

60 
	#__STDC_NO_THREADS__
 1

	)

	@/usr/include/stdint.h

22 #iâdeà
_STDINT_H


23 
	#_STDINT_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	~<b™s/wch¬.h
>

27 
	~<b™s/wÜdsize.h
>

34 #iâdeà
__št8_t_defšed


35 
	#__št8_t_defšed


	)

36 sigÃd 
	tšt8_t
;

37 
	tšt16_t
;

38 
	tšt32_t
;

39 #ià
__WORDSIZE
 == 64

40 
	tšt64_t
;

42 
__ex‹nsiÚ__


43 
	tšt64_t
;

48 
	tušt8_t
;

49 
	tušt16_t
;

50 #iâdeà
__ušt32_t_defšed


51 
	tušt32_t
;

52 
	#__ušt32_t_defšed


	)

54 #ià
__WORDSIZE
 == 64

55 
	tušt64_t
;

57 
__ex‹nsiÚ__


58 
	tušt64_t
;

65 sigÃd 
	tšt_Ëa¡8_t
;

66 
	tšt_Ëa¡16_t
;

67 
	tšt_Ëa¡32_t
;

68 #ià
__WORDSIZE
 == 64

69 
	tšt_Ëa¡64_t
;

71 
__ex‹nsiÚ__


72 
	tšt_Ëa¡64_t
;

76 
	tušt_Ëa¡8_t
;

77 
	tušt_Ëa¡16_t
;

78 
	tušt_Ëa¡32_t
;

79 #ià
__WORDSIZE
 == 64

80 
	tušt_Ëa¡64_t
;

82 
__ex‹nsiÚ__


83 
	tušt_Ëa¡64_t
;

90 sigÃd 
	tšt_ç¡8_t
;

91 #ià
__WORDSIZE
 == 64

92 
	tšt_ç¡16_t
;

93 
	tšt_ç¡32_t
;

94 
	tšt_ç¡64_t
;

96 
	tšt_ç¡16_t
;

97 
	tšt_ç¡32_t
;

98 
__ex‹nsiÚ__


99 
	tšt_ç¡64_t
;

103 
	tušt_ç¡8_t
;

104 #ià
__WORDSIZE
 == 64

105 
	tušt_ç¡16_t
;

106 
	tušt_ç¡32_t
;

107 
	tušt_ç¡64_t
;

109 
	tušt_ç¡16_t
;

110 
	tušt_ç¡32_t
;

111 
__ex‹nsiÚ__


112 
	tušt_ç¡64_t
;

117 #ià
__WORDSIZE
 == 64

118 #iâdeà
__šŒ_t_defšed


119 
	tšŒ_t
;

120 
	#__šŒ_t_defšed


	)

122 
	tušŒ_t
;

124 #iâdeà
__šŒ_t_defšed


125 
	tšŒ_t
;

126 
	#__šŒ_t_defšed


	)

128 
	tušŒ_t
;

133 #ià
__WORDSIZE
 == 64

134 
	tštmax_t
;

135 
	tuštmax_t
;

137 
__ex‹nsiÚ__


138 
	tštmax_t
;

139 
__ex‹nsiÚ__


140 
	tuštmax_t
;

144 #ià
__WORDSIZE
 == 64

145 
	#__INT64_C
(
c
èø## 
L


	)

146 
	#__UINT64_C
(
c
èø## 
UL


	)

148 
	#__INT64_C
(
c
èø## 
LL


	)

149 
	#__UINT64_C
(
c
èø## 
ULL


	)

155 
	#INT8_MIN
 (-128)

	)

156 
	#INT16_MIN
 (-32767-1)

	)

157 
	#INT32_MIN
 (-2147483647-1)

	)

158 
	#INT64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

160 
	#INT8_MAX
 (127)

	)

161 
	#INT16_MAX
 (32767)

	)

162 
	#INT32_MAX
 (2147483647)

	)

163 
	#INT64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

166 
	#UINT8_MAX
 (255)

	)

167 
	#UINT16_MAX
 (65535)

	)

168 
	#UINT32_MAX
 (4294967295U)

	)

169 
	#UINT64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

173 
	#INT_LEAST8_MIN
 (-128)

	)

174 
	#INT_LEAST16_MIN
 (-32767-1)

	)

175 
	#INT_LEAST32_MIN
 (-2147483647-1)

	)

176 
	#INT_LEAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

178 
	#INT_LEAST8_MAX
 (127)

	)

179 
	#INT_LEAST16_MAX
 (32767)

	)

180 
	#INT_LEAST32_MAX
 (2147483647)

	)

181 
	#INT_LEAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

184 
	#UINT_LEAST8_MAX
 (255)

	)

185 
	#UINT_LEAST16_MAX
 (65535)

	)

186 
	#UINT_LEAST32_MAX
 (4294967295U)

	)

187 
	#UINT_LEAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

191 
	#INT_FAST8_MIN
 (-128)

	)

192 #ià
__WORDSIZE
 == 64

193 
	#INT_FAST16_MIN
 (-9223372036854775807L-1)

	)

194 
	#INT_FAST32_MIN
 (-9223372036854775807L-1)

	)

196 
	#INT_FAST16_MIN
 (-2147483647-1)

	)

197 
	#INT_FAST32_MIN
 (-2147483647-1)

	)

199 
	#INT_FAST64_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

201 
	#INT_FAST8_MAX
 (127)

	)

202 #ià
__WORDSIZE
 == 64

203 
	#INT_FAST16_MAX
 (9223372036854775807L)

	)

204 
	#INT_FAST32_MAX
 (9223372036854775807L)

	)

206 
	#INT_FAST16_MAX
 (2147483647)

	)

207 
	#INT_FAST32_MAX
 (2147483647)

	)

209 
	#INT_FAST64_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

212 
	#UINT_FAST8_MAX
 (255)

	)

213 #ià
__WORDSIZE
 == 64

214 
	#UINT_FAST16_MAX
 (18446744073709551615UL)

	)

215 
	#UINT_FAST32_MAX
 (18446744073709551615UL)

	)

217 
	#UINT_FAST16_MAX
 (4294967295U)

	)

218 
	#UINT_FAST32_MAX
 (4294967295U)

	)

220 
	#UINT_FAST64_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

224 #ià
__WORDSIZE
 == 64

225 
	#INTPTR_MIN
 (-9223372036854775807L-1)

	)

226 
	#INTPTR_MAX
 (9223372036854775807L)

	)

227 
	#UINTPTR_MAX
 (18446744073709551615UL)

	)

229 
	#INTPTR_MIN
 (-2147483647-1)

	)

230 
	#INTPTR_MAX
 (2147483647)

	)

231 
	#UINTPTR_MAX
 (4294967295U)

	)

236 
	#INTMAX_MIN
 (-
	`__INT64_C
(9223372036854775807)-1)

	)

238 
	#INTMAX_MAX
 (
	`__INT64_C
(9223372036854775807))

	)

241 
	#UINTMAX_MAX
 (
	`__UINT64_C
(18446744073709551615))

	)

247 #ià
__WORDSIZE
 == 64

248 
	#PTRDIFF_MIN
 (-9223372036854775807L-1)

	)

249 
	#PTRDIFF_MAX
 (9223372036854775807L)

	)

251 
	#PTRDIFF_MIN
 (-2147483647-1)

	)

252 
	#PTRDIFF_MAX
 (2147483647)

	)

256 
	#SIG_ATOMIC_MIN
 (-2147483647-1)

	)

257 
	#SIG_ATOMIC_MAX
 (2147483647)

	)

260 #ià
__WORDSIZE
 == 64

261 
	#SIZE_MAX
 (18446744073709551615UL)

	)

263 #ifdeà
__WORDSIZE32_SIZE_ULONG


264 
	#SIZE_MAX
 (4294967295UL)

	)

266 
	#SIZE_MAX
 (4294967295U)

	)

271 #iâdeà
WCHAR_MIN


273 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

274 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

278 
	#WINT_MIN
 (0u)

	)

279 
	#WINT_MAX
 (4294967295u)

	)

282 
	#INT8_C
(
c
è
	)
c

283 
	#INT16_C
(
c
è
	)
c

284 
	#INT32_C
(
c
è
	)
c

285 #ià
__WORDSIZE
 == 64

286 
	#INT64_C
(
c
èø## 
L


	)

288 
	#INT64_C
(
c
èø## 
LL


	)

292 
	#UINT8_C
(
c
è
	)
c

293 
	#UINT16_C
(
c
è
	)
c

294 
	#UINT32_C
(
c
èø## 
U


	)

295 #ià
__WORDSIZE
 == 64

296 
	#UINT64_C
(
c
èø## 
UL


	)

298 
	#UINT64_C
(
c
èø## 
ULL


	)

302 #ià
__WORDSIZE
 == 64

303 
	#INTMAX_C
(
c
èø## 
L


	)

304 
	#UINTMAX_C
(
c
èø## 
UL


	)

306 
	#INTMAX_C
(
c
èø## 
LL


	)

307 
	#UINTMAX_C
(
c
èø## 
ULL


	)

	@/usr/include/string.h

22 #iâdef 
_STRING_H


23 
	#_STRING_H
 1

	)

25 
	~<ã©u»s.h
>

27 
	g__BEGIN_DECLS


30 
	#__Ãed_size_t


	)

31 
	#__Ãed_NULL


	)

32 
	~<¡ddef.h
>

35 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

36 
	#__CORRECT_ISO_CPP_STRING_H_PROTO


	)

40 
__BEGIN_NAMESPACE_STD


42 *
	$memıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

43 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

46 *
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

47 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

48 
__END_NAMESPACE_STD


53 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


54 *
	$memcıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

55 
__c
, 
size_t
 
__n
)

56 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

60 
__BEGIN_NAMESPACE_STD


62 *
	$mem£t
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

65 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

66 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

69 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


72 *
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

73 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

74 cÚ¡ *
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

75 
__THROW
 
	`__asm
 ("memchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

77 #ifdeà
__OPTIMIZE__


78 
__ex‹º_®ways_šlše
 *

79 
	`memchr
 (*
__s
, 
__c
, 
size_t
 
__n
è
__THROW


81  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

84 
__ex‹º_®ways_šlše
 const *

85 
	`memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
è
__THROW


87  
	`__butš_memchr
 (
__s
, 
__c
, 
__n
);

90 
	}
}

92 *
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

93 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

95 
__END_NAMESPACE_STD


97 #ifdeà
__USE_GNU


100 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


101 "C++" *
	$¿wmemchr
 (*
__s
, 
__c
)

102 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

103 "C++" cÚ¡ *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

104 
__THROW
 
	`__asm
 ("¿wmemchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

106 *
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

107 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

111 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


112 "C++" *
	$memrchr
 (*
__s
, 
__c
, 
size_t
 
__n
)

113 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

114 "C++" cÚ¡ *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

115 
__THROW
 
	`__asm
 ("memrchr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

117 *
	$memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

118 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

123 
__BEGIN_NAMESPACE_STD


125 *
	$¡rıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

126 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

128 *
	$¡ºıy
 (*
__»¡riù
 
__de¡
,

129 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

130 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

133 *
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

134 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

136 *
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

137 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1, 2));

140 
	$¡rcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

141 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

143 
	$¡ºcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

144 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

147 
	$¡rcŞl
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

148 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

150 
size_t
 
	$¡rxäm
 (*
__»¡riù
 
__de¡
,

151 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

152 
__THROW
 
	`__nÚnuÎ
 ((2));

153 
__END_NAMESPACE_STD


155 #ifdeà
__USE_XOPEN2K8


159 
	~<xloÿË.h
>

162 
	$¡rcŞl_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
__loÿË_t
 
__l
)

163 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

165 
size_t
 
	$¡rxäm_l
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

166 
__loÿË_t
 
__l
è
__THROW
 
	`__nÚnuÎ
 ((2, 4));

169 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


171 *
	$¡rdup
 (cÚ¡ *
__s
)

172 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

178 #ià
defšed
 
__USE_XOPEN2K8


179 *
	$¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

180 
__THROW
 
__©Œibu‹_m®loc__
 
	`__nÚnuÎ
 ((1));

183 #ià
defšed
 
__USE_GNU
 && defšed 
__GNUC__


185 
	#¡rdu·
(
s
) \

186 (
__ex‹nsiÚ__
 \

188 cÚ¡ *
__Şd
 = (
s
); \

189 
size_t
 
__Ën
 = 
	`¡¾’
 (
__Şd
) + 1; \

190 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
); \

191 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

192 
	}
}))

	)

195 
	#¡ºdu·
(
s
, 
n
) \

196 (
__ex‹nsiÚ__
 \

198 cÚ¡ *
__Şd
 = (
s
); \

199 
size_t
 
__Ën
 = 
	`¡ºËn
 (
__Şd
, (
n
)); \

200 *
__Ãw
 = (*è
	`__butš_®loÿ
 (
__Ën
 + 1); \

201 
__Ãw
[
__Ën
] = '\0'; \

202 (*è
	`memıy
 (
__Ãw
, 
__Şd
, 
__Ën
); \

203 }))

	)

206 
	g__BEGIN_NAMESPACE_STD


208 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


211 *
¡rchr
 (*
__s
, 
__c
)

212 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

213 cÚ¡ *
¡rchr
 (cÚ¡ *
__s
, 
__c
)

214 
__THROW
 
__asm
 ("¡rchr"è
__©Œibu‹_pu»__
 
__nÚnuÎ
 ((1));

216 #ifdeà
__OPTIMIZE__


217 
__ex‹º_®ways_šlše
 *

218 
¡rchr
 (*
__s
, 
__c
è
	g__THROW


220  
__butš_¡rchr
 (
__s
, 
__c
);

223 
__ex‹º_®ways_šlše
 const *

224 
¡rchr
 (cÚ¡ *
__s
, 
__c
è
	g__THROW


226  
__butš_¡rchr
 (
__s
, 
__c
);

231 *
	$¡rchr
 (cÚ¡ *
__s
, 
__c
)

232 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

235 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


238 *
	`¡¼chr
 (*
__s
, 
__c
)

239 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

240 cÚ¡ *
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
)

241 
__THROW
 
	`__asm
 ("¡¼chr"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

243 #ifdeà
__OPTIMIZE__


244 
__ex‹º_®ways_šlše
 *

245 
	`¡¼chr
 (*
__s
, 
__c
è
__THROW


247  
	`__butš_¡¼chr
 (
__s
, 
__c
);

250 
__ex‹º_®ways_šlše
 const *

251 
	`¡¼chr
 (cÚ¡ *
__s
, 
__c
è
__THROW


253  
	`__butš_¡¼chr
 (
__s
, 
__c
);

256 
	}
}

258 *
	$¡¼chr
 (cÚ¡ *
__s
, 
__c
)

259 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

261 
__END_NAMESPACE_STD


263 #ifdeà
__USE_GNU


266 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


267 "C++" *
	$¡rchºul
 (*
__s
, 
__c
)

268 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

269 "C++" cÚ¡ *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

270 
__THROW
 
	`__asm
 ("¡rchºul"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

272 *
	$¡rchºul
 (cÚ¡ *
__s
, 
__c
)

273 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

277 
__BEGIN_NAMESPACE_STD


280 
size_t
 
	$¡rc¥n
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

281 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

284 
size_t
 
	$¡r¥n
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

285 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

287 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


290 *
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
)

291 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

292 cÚ¡ *
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

293 
__THROW
 
	`__asm
 ("¡½brk"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

295 #ifdeà
__OPTIMIZE__


296 
__ex‹º_®ways_šlše
 *

297 
	`¡½brk
 (*
__s
, cÚ¡ *
__acû±
è
__THROW


299  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

302 
__ex‹º_®ways_šlše
 const *

303 
	`¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
è
__THROW


305  
	`__butš_¡½brk
 (
__s
, 
__acû±
);

308 
	}
}

310 *
	$¡½brk
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

311 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

314 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


317 *
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

318 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

319 cÚ¡ *
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

320 
__THROW
 
	`__asm
 ("¡r¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

322 #ifdeà
__OPTIMIZE__


323 
__ex‹º_®ways_šlše
 *

324 
	`¡r¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


326  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

329 
__ex‹º_®ways_šlše
 const *

330 
	`¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
è
__THROW


332  
	`__butš_¡r¡r
 (
__hay¡ack
, 
__ÃedË
);

335 
	}
}

337 *
	$¡r¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

338 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

343 *
	$¡¹ok
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
)

344 
__THROW
 
	`__nÚnuÎ
 ((2));

345 
__END_NAMESPACE_STD


349 *
	$__¡¹ok_r
 (*
__»¡riù
 
__s
,

350 cÚ¡ *
__»¡riù
 
__d–im
,

351 **
__»¡riù
 
__§ve_±r
)

352 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

353 #ifdeà
__USE_POSIX


354 *
	$¡¹ok_r
 (*
__»¡riù
 
__s
, cÚ¡ *__»¡riù 
__d–im
,

355 **
__»¡riù
 
__§ve_±r
)

356 
__THROW
 
	`__nÚnuÎ
 ((2, 3));

359 #ifdeà
__USE_GNU


361 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


362 "C++" *
	$¡rÿ£¡r
 (*
__hay¡ack
, cÚ¡ *
__ÃedË
)

363 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

364 "C++" cÚ¡ *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
,

365 cÚ¡ *
__ÃedË
)

366 
__THROW
 
	`__asm
 ("¡rÿ£¡r"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

368 *
	$¡rÿ£¡r
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

369 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

373 #ifdeà
__USE_GNU


377 *
	$memmem
 (cÚ¡ *
__hay¡ack
, 
size_t
 
__hay¡ackËn
,

378 cÚ¡ *
__ÃedË
, 
size_t
 
__ÃedËËn
)

379 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 3));

383 *
	$__mempıy
 (*
__»¡riù
 
__de¡
,

384 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

385 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

386 *
	$mempıy
 (*
__»¡riù
 
__de¡
,

387 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

388 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

392 
__BEGIN_NAMESPACE_STD


394 
size_t
 
	$¡¾’
 (cÚ¡ *
__s
)

395 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

396 
__END_NAMESPACE_STD


398 #ifdef 
__USE_XOPEN2K8


401 
size_t
 
	$¡ºËn
 (cÚ¡ *
__¡ršg
, 
size_t
 
__maxËn
)

402 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

406 
__BEGIN_NAMESPACE_STD


408 *
	$¡»¼Ü
 (
__”ºum
è
__THROW
;

409 
__END_NAMESPACE_STD


410 #ifdeà
__USE_XOPEN2K


418 #ià
defšed
 
__USE_XOPEN2K
 && !defšed 
__USE_GNU


421 #ifdeà
__REDIRECT_NTH


422 
	`__REDIRECT_NTH
 (
¡»¼Ü_r
,

423 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
),

424 
__xpg_¡»¼Ü_r
è
	`__nÚnuÎ
 ((2));

426 
	$__xpg_¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

427 
__THROW
 
	`__nÚnuÎ
 ((2));

428 
	#¡»¼Ü_r
 
__xpg_¡»¼Ü_r


	)

433 *
	$¡»¼Ü_r
 (
__”ºum
, *
__buf
, 
size_t
 
__buæ’
)

434 
__THROW
 
	`__nÚnuÎ
 ((2)è
__wur
;

438 #ifdeà
__USE_XOPEN2K8


440 *
	$¡»¼Ü_l
 (
__”ºum
, 
__loÿË_t
 
__l
è
__THROW
;

446 
	$__bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

448 #ifdeà
__USE_MISC


450 
	$bcİy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__n
)

451 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

454 
	$bz”o
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

457 
	$bcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

458 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

461 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


464 *
	`šdex
 (*
__s
, 
__c
)

465 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

466 cÚ¡ *
	`šdex
 (cÚ¡ *
__s
, 
__c
)

467 
__THROW
 
	`__asm
 ("šdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

469 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


470 
__ex‹º_®ways_šlše
 *

471 
	`šdex
 (*
__s
, 
__c
è
__THROW


473  
	`__butš_šdex
 (
__s
, 
__c
);

476 
__ex‹º_®ways_šlše
 const *

477 
	`šdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


479  
	`__butš_šdex
 (
__s
, 
__c
);

482 
	}
}

484 *
	$šdex
 (cÚ¡ *
__s
, 
__c
)

485 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

489 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


492 *
	`ršdex
 (*
__s
, 
__c
)

493 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

494 cÚ¡ *
	`ršdex
 (cÚ¡ *
__s
, 
__c
)

495 
__THROW
 
	`__asm
 ("ršdex"è
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

497 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__CORRECT_ISO_CPP_STRINGS_H_PROTO


498 
__ex‹º_®ways_šlše
 *

499 
	`ršdex
 (*
__s
, 
__c
è
__THROW


501  
	`__butš_ršdex
 (
__s
, 
__c
);

504 
__ex‹º_®ways_šlše
 const *

505 
	`ršdex
 (cÚ¡ *
__s
, 
__c
è
__THROW


507  
	`__butš_ršdex
 (
__s
, 
__c
);

510 
	}
}

512 *
	$ršdex
 (cÚ¡ *
__s
, 
__c
)

513 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1));

518 
	$ffs
 (
__i
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

522 #ifdef 
__USE_GNU


523 
	$ff¦
 (
__l
è
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

524 
__ex‹nsiÚ__
 
	$ff¦l
 (
__Î
)

525 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

529 
	$¡rÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

530 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

533 
	$¡ºÿ£cmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

534 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

537 #ifdef 
__USE_GNU


540 
	$¡rÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

541 
__loÿË_t
 
__loc
)

542 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 3));

544 
	$¡ºÿ£cmp_l
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

545 
size_t
 
__n
, 
__loÿË_t
 
__loc
)

546 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2, 4));

549 #ifdef 
__USE_MISC


552 *
	$¡r£p
 (**
__»¡riù
 
__¡ršgp
,

553 cÚ¡ *
__»¡riù
 
__d–im
)

554 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

557 #ifdef 
__USE_XOPEN2K8


559 *
	$¡rsigÇl
 (
__sig
è
__THROW
;

562 *
	$__¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

563 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

564 *
	$¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
)

565 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

569 *
	$__¡²ıy
 (*
__»¡riù
 
__de¡
,

570 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

571 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

572 *
	$¡²ıy
 (*
__»¡riù
 
__de¡
,

573 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

574 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

577 #ifdef 
__USE_GNU


579 
	$¡rv”scmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

580 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

583 *
	$¡räy
 (*
__¡ršg
è
__THROW
 
	`__nÚnuÎ
 ((1));

586 *
	$memäob
 (*
__s
, 
size_t
 
__n
è
__THROW
 
	`__nÚnuÎ
 ((1));

588 #iâdeà
ba£Çme


593 #ifdeà
__CORRECT_ISO_CPP_STRING_H_PROTO


594 "C++" *
	$ba£Çme
 (*
__f’ame
)

595 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

596 "C++" cÚ¡ *
	$ba£Çme
 (cÚ¡ *
__f’ame
)

597 
__THROW
 
	`__asm
 ("ba£Çme"è
	`__nÚnuÎ
 ((1));

599 *
	$ba£Çme
 (cÚ¡ *
__f’ame
è
__THROW
 
	`__nÚnuÎ
 ((1));

605 #ià
	`__GNUC_PREREQ
 (3,4)

606 #ià
defšed
 
__OPTIMIZE__
 && !defšed 
__OPTIMIZE_SIZE__
 \

607 && !
defšed
 
__NO_INLINE__
 && !defšed 
__ılu¥lus


627 
	~<b™s/¡ršg.h
>

630 
	~<b™s/¡ršg2.h
>

633 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


635 
	~<b™s/¡ršg3.h
>

639 #ià
defšed
 
__USE_GNU
 && defšed 
__OPTIMIZE__
 \

640 && 
defšed
 
__ex‹º_®ways_šlše
 && 
	$__GNUC_PREREQ
 (3,2)

641 #ià!
defšed
 
_FORCE_INLINES
 && !defšed 
_HAVE_STRING_ARCH_mempıy


643 
	#mempıy
(
de¡
, 
¤c
, 
n
è
	`__mempıy_šlše
 (de¡, src,‚)

	)

644 
	#__mempıy
(
de¡
, 
¤c
, 
n
è
	`__mempıy_šlše
 (de¡, src,‚)

	)

646 
__ex‹º_®ways_šlše
 *

647 
	$__mempıy_šlše
 (*
__»¡riù
 
__de¡
,

648 cÚ¡ *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

650  (*è
	`memıy
 (
__de¡
, 
__¤c
, 
__n
) + __n;

651 
	}
}

656 
	g__END_DECLS


	@/usr/include/sys/cdefs.h

18 #iâdef 
_SYS_CDEFS_H


19 
	#_SYS_CDEFS_H
 1

	)

22 #iâdeà
_FEATURES_H


23 
	~<ã©u»s.h
>

29 #ià
defšed
 
__GNUC__
 && !defšed 
__STDC__


34 #undeà
__P


35 #undeà
__PMT


37 #ifdeà
__GNUC__


41 #ià
__GNUC_PREREQ
 (4, 6è&& !
defšed
 
_LIBC


42 
	#__LEAF
 , 
__Ëaf__


	)

43 
	#__LEAF_ATTR
 
	`__©Œibu‹__
 ((
__Ëaf__
))

	)

45 
	#__LEAF


	)

46 
	#__LEAF_ATTR


	)

54 #ià!
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (3, 3)

55 
	#__THROW
 
	`__©Œibu‹__
 ((
__nÙhrow__
 
__LEAF
))

	)

56 
	#__THROWNL
 
	`__©Œibu‹__
 ((
__nÙhrow__
))

	)

57 
	#__NTH
(
fù
è
	`__©Œibu‹__
 ((
__nÙhrow__
 
__LEAF
)è
	)
fct

59 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (2,8)

60 
	#__THROW
 
	`throw
 ()

	)

61 
	#__THROWNL
 
	`throw
 ()

	)

62 
	#__NTH
(
fù
è
__LEAF_ATTR
 fù 
	`throw
 ()

	)

64 
	#__THROW


	)

65 
	#__THROWNL


	)

66 
	#__NTH
(
fù
è
	)
fct

72 
	#__šlše


	)

74 
	#__THROW


	)

75 
	#__THROWNL


	)

76 
	#__NTH
(
fù
è
	)
fct

82 
	#__P
(
¬gs
è
	)
args

83 
	#__PMT
(
¬gs
è
	)
args

88 
	#__CONCAT
(
x
,
y
èx ## 
	)
y

89 
	#__STRING
(
x
è#x

	)

92 
	#__±r_t
 *

	)

93 
	#__lÚg_doubË_t
 

	)

97 #ifdef 
__ılu¥lus


98 
	#__BEGIN_DECLS
 "C" {

	)

99 
	#__END_DECLS
 }

	)

101 
	#__BEGIN_DECLS


	)

102 
	#__END_DECLS


	)

111 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES


112 
	#__BEGIN_NAMESPACE_STD
 
Çme¥aû
 
¡d
 {

	)

113 
	#__END_NAMESPACE_STD
 }

	)

114 
	#__USING_NAMESPACE_STD
(
Çme
è
usšg
 
¡d
::Çme;

	)

115 
	#__BEGIN_NAMESPACE_C99
 
Çme¥aû
 
__c99
 {

	)

116 
	#__END_NAMESPACE_C99
 }

	)

117 
	#__USING_NAMESPACE_C99
(
Çme
è
usšg
 
__c99
::Çme;

	)

122 
	#__BEGIN_NAMESPACE_STD


	)

123 
	#__END_NAMESPACE_STD


	)

124 
	#__USING_NAMESPACE_STD
(
Çme
)

	)

125 
	#__BEGIN_NAMESPACE_C99


	)

126 
	#__END_NAMESPACE_C99


	)

127 
	#__USING_NAMESPACE_C99
(
Çme
)

	)

132 
	#__bos
(
±r
è
	`__butš_objeù_size
 (±r, 
__USE_FORTIFY_LEVEL
 > 1)

	)

133 
	#__bos0
(
±r
è
	`__butš_objeù_size
 (±r, 0)

	)

135 #ià
__GNUC_PREREQ
 (4,3)

136 
	#__w¬ndeş
(
Çme
, 
msg
) \

137 
	`Çme
 (è
	`__©Œibu‹__
((
	`__w¬nšg__
 (
msg
)))

	)

138 
	#__w¬Ç‰r
(
msg
è
	`__©Œibu‹__
((
	`__w¬nšg__
 (msg)))

	)

139 
	#__”rÜdeş
(
Çme
, 
msg
) \

140 
	`Çme
 (è
	`__©Œibu‹__
((
	`__”rÜ__
 (
msg
)))

	)

142 
	#__w¬ndeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

143 
	#__w¬Ç‰r
(
msg
)

	)

144 
	#__”rÜdeş
(
Çme
, 
msg
è
	`Çme
 ()

	)

148 #ià
__GNUC_PREREQ
 (2,97)

150 
	#__æex¬r
 []

	)

152 #ifdeà
__GNUC__


153 
	#__æex¬r
 [0]

	)

155 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

156 
	#__æex¬r
 []

	)

159 
	#__æex¬r
 [1]

	)

175 #ià
defšed
 
__GNUC__
 && __GNUC__ >= 2

177 
	#__REDIRECT
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

178 #ifdeà
__ılu¥lus


179 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

180 
Çme
 
´Ùo
 
__THROW
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

181 
	#__REDIRECT_NTHNL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

182 
Çme
 
´Ùo
 
__THROWNL
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs))

	)

184 
	#__REDIRECT_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
) \

185 
Çme
 
´Ùo
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs)è
__THROW


	)

186 
	#__REDIRECT_NTHNL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

187 
Çme
 
´Ùo
 
	`__asm__
 (
	`__ASMNAME
 (#®Ÿs)è
__THROWNL


	)

189 
	#__ASMNAME
(
úame
è
	`__ASMNAME2
 (
__USER_LABEL_PREFIX__
, cÇme)

	)

190 
	#__ASMNAME2
(
´efix
, 
úame
è
	`__STRING
 (´efixè
	)
cname

203 #ià!
defšed
 
__GNUC__
 || __GNUC__ < 2

204 
	#__©Œibu‹__
(
xyz
è

	)

210 #ià
__GNUC_PREREQ
 (2,96)

211 
	#__©Œibu‹_m®loc__
 
	`__©Œibu‹__
 ((
__m®loc__
))

	)

213 
	#__©Œibu‹_m®loc__


	)

218 #ià
__GNUC_PREREQ
 (4, 3)

219 
	#__©Œibu‹_®loc_size__
(
·¿ms
) \

220 
	`__©Œibu‹__
 ((
__®loc_size__
 
·¿ms
))

	)

222 
	#__©Œibu‹_®loc_size__
(
·¿ms
è

	)

228 #ià
__GNUC_PREREQ
 (2,96)

229 
	#__©Œibu‹_pu»__
 
	`__©Œibu‹__
 ((
__pu»__
))

	)

231 
	#__©Œibu‹_pu»__


	)

235 #ià
__GNUC_PREREQ
 (2,5)

236 
	#__©Œibu‹_cÚ¡__
 
	`__©Œibu‹__
 ((
__cÚ¡__
))

	)

238 
	#__©Œibu‹_cÚ¡__


	)

244 #ià
__GNUC_PREREQ
 (3,1)

245 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__u£d__
))

	)

246 
	#__©Œibu‹_nošlše__
 
	`__©Œibu‹__
 ((
__nošlše__
))

	)

248 
	#__©Œibu‹_u£d__
 
	`__©Œibu‹__
 ((
__unu£d__
))

	)

249 
	#__©Œibu‹_nošlše__


	)

253 #ià
__GNUC_PREREQ
 (3,2)

254 
	#__©Œibu‹_d•»ÿ‹d__
 
	`__©Œibu‹__
 ((
__d•»ÿ‹d__
))

	)

256 
	#__©Œibu‹_d•»ÿ‹d__


	)

265 #ià
__GNUC_PREREQ
 (2,8)

266 
	#__©Œibu‹_fÜm©_¬g__
(
x
è
	`__©Œibu‹__
 ((
	`__fÜm©_¬g__
 (x)))

	)

268 
	#__©Œibu‹_fÜm©_¬g__
(
x
è

	)

275 #ià
__GNUC_PREREQ
 (2,97)

276 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
) \

277 
	`__©Œibu‹__
 ((
	`__fÜm©__
 (
__¡rfmÚ__
, 
a
, 
b
)))

	)

279 
	#__©Œibu‹_fÜm©_¡rfmÚ__
(
a
,
b
è

	)

284 #ià
__GNUC_PREREQ
 (3,3)

285 
	#__nÚnuÎ
(
·¿ms
è
	`__©Œibu‹__
 ((
__nÚnuÎ__
…¬ams))

	)

287 
	#__nÚnuÎ
(
·¿ms
)

	)

292 #ià
__GNUC_PREREQ
 (3,4)

293 
	#__©Œibu‹_w¬n_unu£d_»suÉ__
 \

294 
	`__©Œibu‹__
 ((
__w¬n_unu£d_»suÉ__
))

	)

295 #ià
__USE_FORTIFY_LEVEL
 > 0

296 
	#__wur
 
__©Œibu‹_w¬n_unu£d_»suÉ__


	)

299 
	#__©Œibu‹_w¬n_unu£d_»suÉ__


	)

301 #iâdeà
__wur


302 
	#__wur


	)

306 #ià
__GNUC_PREREQ
 (3,2)

310 #undeà
__®ways_šlše


311 
	#__®ways_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__®ways_šlše__
))

	)

313 #undeà
__®ways_šlše


314 
	#__®ways_šlše
 
__šlše


	)

319 #ià
__GNUC_PREREQ
 (4,3)

320 
	#__©Œibu‹_¬tificŸl__
 
	`__©Œibu‹__
 ((
__¬tificŸl__
))

	)

322 
	#__©Œibu‹_¬tificŸl__


	)

334 #ià(!
defšed
 
__ılu¥lus
 || 
__GNUC_PREREQ
 (4,3) \

335 || (
defšed
 
__şªg__
 && (defšed 
__GNUC_STDC_INLINE__
 \

336 || 
defšed
 
__GNUC_GNU_INLINE__
)))

337 #ià
defšed
 
__GNUC_STDC_INLINE__
 || defšed 
__ılu¥lus


338 
	#__ex‹º_šlše
 
__šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

339 
	#__ex‹º_®ways_šlše
 \

340 
__®ways_šlše
 
	`__©Œibu‹__
 ((
__gnu_šlše__
))

	)

342 
	#__ex‹º_šlše
 
__šlše


	)

343 
	#__ex‹º_®ways_šlše
 
__®ways_šlše


	)

347 #ifdeà
__ex‹º_®ways_šlše


348 
	#__fÜtify_funùiÚ
 
__ex‹º_®ways_šlše
 
__©Œibu‹_¬tificŸl__


	)

353 #ià
__GNUC_PREREQ
 (4,3)

354 
	#__va_¬g_·ck
(è
	`__butš_va_¬g_·ck
 ()

	)

355 
	#__va_¬g_·ck_Ën
(è
	`__butš_va_¬g_·ck_Ën
 ()

	)

362 #ià!
__GNUC_PREREQ
 (2,8)

363 
	#__ex‹nsiÚ__


	)

367 #ià!
__GNUC_PREREQ
 (2,92)

368 
	#__»¡riù


	)

374 #ià
__GNUC_PREREQ
 (3,1è&& !
defšed
 
__GNUG__


375 
	#__»¡riù_¬r
 
__»¡riù


	)

377 #ifdeà
__GNUC__


378 
	#__»¡riù_¬r


	)

380 #ià
defšed
 
__STDC_VERSION__
 && __STDC_VERSION__ >= 199901L

381 
	#__»¡riù_¬r
 
»¡riù


	)

384 
	#__»¡riù_¬r


	)

389 #ià
__GNUC__
 >= 3

390 
	#__glibc_uÆik–y
(
cÚd
è
	`__butš_ex³ù
 ((cÚd), 0)

	)

391 
	#__glibc_lik–y
(
cÚd
è
	`__butš_ex³ù
 ((cÚd), 1)

	)

393 
	#__glibc_uÆik–y
(
cÚd
è(cÚd)

	)

394 
	#__glibc_lik–y
(
cÚd
è(cÚd)

	)

397 #ià(!
defšed
 
_NÜ‘uº
 \

398 && (
defšed
 
__STDC_VERSION__
 ? __STDC_VERSION__ : 0) < 201112 \

399 && !
	$__GNUC_PREREQ
 (4,7))

400 #ià
	`__GNUC_PREREQ
 (2,8)

401 
	#_NÜ‘uº
 
	`__©Œibu‹__
 ((
__nÜ‘uº__
))

	)

403 
	#_NÜ‘uº


	)

407 #ià(!
defšed
 
_Stic_as£¹
 && !defšed 
__ılu¥lus
 \

408 && (
defšed
 
__STDC_VERSION__
 ? __STDC_VERSION__ : 0) < 201112 \

409 && (!
	`__GNUC_PREREQ
 (4, 6è|| 
defšed
 
__STRICT_ANSI__
))

410 
	#_Stic_as£¹
(
ex´
, 
dŸgno¡ic
) \

411 (*
	`__Stic_as£¹_funùiÚ
 ()) \

412 [!! (¡ruù { 
__”rÜ_if_Ãg©ive
: (
ex´
è? 2 : -1; })]

	)

415 
	~<b™s/wÜdsize.h
>

417 #ià
defšed
 
__LONG_DOUBLE_MATH_OPTIONAL
 && defšed 
__NO_LONG_DOUBLE_MATH


418 
	#__LDBL_COMPAT
 1

	)

419 #ifdeà
__REDIRECT


420 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

421 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
) \

422 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

423 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT_NTH
 (Çme,…rÙo,‡lŸs)

	)

424 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
) \

425 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##Çme)

	)

426 
	#__LDBL_REDIR1_DECL
(
Çme
, 
®Ÿs
) \

427 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 (#®Ÿs));

	)

428 
	#__LDBL_REDIR_DECL
(
Çme
) \

429 
	`__ty³of
 (
Çme
èÇm
	`__asm
 (
	`__ASMNAME
 ("__Ædbl_" #Çme));

	)

430 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

431 
	`__LDBL_REDIR1
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

432 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

433 
	`__LDBL_REDIR1_NTH
 (
Çme
, 
´Ùo
, 
__Ædbl_
##
®Ÿs
)

	)

436 #ià!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT


437 
	#__LDBL_REDIR1
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm
	)
proto

438 
	#__LDBL_REDIR
(
Çme
, 
´Ùo
èÇm
	)
proto

439 
	#__LDBL_REDIR1_NTH
(
Çme
, 
´Ùo
, 
®Ÿs
èÇm´ÙØ
__THROW


	)

440 
	#__LDBL_REDIR_NTH
(
Çme
, 
´Ùo
èÇm´ÙØ
__THROW


	)

441 
	#__LDBL_REDIR_DECL
(
Çme
)

	)

442 #ifdeà
__REDIRECT


443 
	#__REDIRECT_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
è
	`__REDIRECT
 (Çme,…rÙo,‡lŸs)

	)

444 
	#__REDIRECT_NTH_LDBL
(
Çme
, 
´Ùo
, 
®Ÿs
) \

445 
	`__REDIRECT_NTH
 (
Çme
, 
´Ùo
, 
®Ÿs
)

	)

	@/usr/include/sys/sysmacros.h

19 #iâdeà
_SYS_SYSMACROS_H


20 
	#_SYS_SYSMACROS_H
 1

	)

22 
	~<ã©u»s.h
>

24 
__BEGIN_DECLS


26 
__ex‹nsiÚ__


27 
	$gnu_dev_majÜ
 (
__dev
)

28 
__THROW
 
__©Œibu‹_cÚ¡__
;

29 
__ex‹nsiÚ__


30 
	$gnu_dev_mšÜ
 (
__dev
)

31 
__THROW
 
__©Œibu‹_cÚ¡__
;

32 
__ex‹nsiÚ__


33 
	$gnu_dev_makedev
 (
__majÜ
,

34 
__mšÜ
)

35 
__THROW
 
__©Œibu‹_cÚ¡__
;

37 #ifdeà
__USE_EXTERN_INLINES


38 
__ex‹nsiÚ__
 
__ex‹º_šlše
 
__©Œibu‹_cÚ¡__
 

39 
	`__NTH
 (
	$gnu_dev_majÜ
 (
__dev
))

41  ((
__dev
 >> 8) & 0xfff) | (() (__dev >> 32) & ~0xfff);

42 
	}
}

44 
__ex‹nsiÚ__
 
__ex‹º_šlše
 
__©Œibu‹_cÚ¡__
 

45 
__NTH
 (
	$gnu_dev_mšÜ
 (
__dev
))

47  (
__dev
 & 0xff) | (() (__dev >> 12) & ~0xff);

48 
	}
}

50 
__ex‹nsiÚ__
 
__ex‹º_šlše
 
__©Œibu‹_cÚ¡__
 

51 
__NTH
 (
	$gnu_dev_makedev
 (
__majÜ
, 
__mšÜ
))

53  ((
__mšÜ
 & 0xffè| ((
__majÜ
 & 0xfff) << 8)

54 | (((è(
__mšÜ
 & ~0xff)) << 12)

55 | (((è(
__majÜ
 & ~0xfff)) << 32));

56 
	}
}

58 
	g__END_DECLS


61 
	#majÜ
(
dev
è
	`gnu_dev_majÜ
 (dev)

	)

62 
	#mšÜ
(
dev
è
	`gnu_dev_mšÜ
 (dev)

	)

63 
	#makedev
(
maj
, 
mš
è
	`gnu_dev_makedev
 (maj, mš)

	)

	@/usr/include/sys/ttydefaults.h

40 #iâdeà
_SYS_TTYDEFAULTS_H_


41 
	#_SYS_TTYDEFAULTS_H_


	)

46 
	#TTYDEF_IFLAG
 (
BRKINT
 | 
ISTRIP
 | 
ICRNL
 | 
IMAXBEL
 | 
IXON
 | 
IXANY
)

	)

47 
	#TTYDEF_OFLAG
 (
OPOST
 | 
ONLCR
 | 
XTABS
)

	)

48 
	#TTYDEF_LFLAG
 (
ECHO
 | 
ICANON
 | 
ISIG
 | 
IEXTEN
 | 
ECHOE
|
ECHOKE
|
ECHOCTL
)

	)

49 
	#TTYDEF_CFLAG
 (
CREAD
 | 
CS7
 | 
PARENB
 | 
HUPCL
)

	)

50 
	#TTYDEF_SPEED
 (
B9600
)

	)

55 
	#CTRL
(
x
è(x&037)

	)

56 
	#CEOF
 
	`CTRL
('d')

	)

57 #ifdeà
_POSIX_VDISABLE


58 
	#CEOL
 
_POSIX_VDISABLE


	)

60 
	#CEOL
 '\0'

	)

62 
	#CERASE
 0177

	)

63 
	#CINTR
 
	`CTRL
('c')

	)

64 #ifdeà
_POSIX_VDISABLE


65 
	#CSTATUS
 
_POSIX_VDISABLE


	)

67 
	#CSTATUS
 '\0'

	)

69 
	#CKILL
 
	`CTRL
('u')

	)

70 
	#CMIN
 1

	)

71 
	#CQUIT
 034

	)

72 
	#CSUSP
 
	`CTRL
('z')

	)

73 
	#CTIME
 0

	)

74 
	#CDSUSP
 
	`CTRL
('y')

	)

75 
	#CSTART
 
	`CTRL
('q')

	)

76 
	#CSTOP
 
	`CTRL
('s')

	)

77 
	#CLNEXT
 
	`CTRL
('v')

	)

78 
	#CDISCARD
 
	`CTRL
('o')

	)

79 
	#CWERASE
 
	`CTRL
('w')

	)

80 
	#CREPRINT
 
	`CTRL
('r')

	)

81 
	#CEOT
 
CEOF


	)

83 
	#CBRK
 
CEOL


	)

84 
	#CRPRNT
 
CREPRINT


	)

85 
	#CFLUSH
 
CDISCARD


	)

93 #ifdeà
TTYDEFCHARS


94 
cc_t
 
	g‰ydefch¬s
[
NCCS
] = {

95 
CEOF
, 
CEOL
, CEOL, 
CERASE
, 
CWERASE
, 
CKILL
, 
CREPRINT
,

96 
_POSIX_VDISABLE
, 
CINTR
, 
CQUIT
, 
CSUSP
, 
CDSUSP
, 
CSTART
, 
CSTOP
, 
CLNEXT
,

97 
CDISCARD
, 
CMIN
, 
CTIME
, 
CSTATUS
, 
_POSIX_VDISABLE


99 #undeà
TTYDEFCHARS


	@/usr/include/sys/ucontext.h

18 #iâdeà
_SYS_UCONTEXT_H


19 
	#_SYS_UCONTEXT_H
 1

	)

21 
	~<ã©u»s.h
>

22 
	~<sigÇl.h
>

26 
	~<b™s/sigcÚ‹xt.h
>

28 #ifdeà
__x86_64__


31 
__ex‹nsiÚ__
 
	tg»g_t
;

34 
	#NGREG
 23

	)

37 
g»g_t
 
	tg»g£t_t
[
NGREG
];

39 #ifdeà
__USE_GNU


43 
	mREG_R8
 = 0,

44 
	#REG_R8
 
REG_R8


	)

45 
	mREG_R9
,

46 
	#REG_R9
 
REG_R9


	)

47 
	mREG_R10
,

48 
	#REG_R10
 
REG_R10


	)

49 
	mREG_R11
,

50 
	#REG_R11
 
REG_R11


	)

51 
	mREG_R12
,

52 
	#REG_R12
 
REG_R12


	)

53 
	mREG_R13
,

54 
	#REG_R13
 
REG_R13


	)

55 
	mREG_R14
,

56 
	#REG_R14
 
REG_R14


	)

57 
	mREG_R15
,

58 
	#REG_R15
 
REG_R15


	)

59 
	mREG_RDI
,

60 
	#REG_RDI
 
REG_RDI


	)

61 
	mREG_RSI
,

62 
	#REG_RSI
 
REG_RSI


	)

63 
	mREG_RBP
,

64 
	#REG_RBP
 
REG_RBP


	)

65 
	mREG_RBX
,

66 
	#REG_RBX
 
REG_RBX


	)

67 
	mREG_RDX
,

68 
	#REG_RDX
 
REG_RDX


	)

69 
	mREG_RAX
,

70 
	#REG_RAX
 
REG_RAX


	)

71 
	mREG_RCX
,

72 
	#REG_RCX
 
REG_RCX


	)

73 
	mREG_RSP
,

74 
	#REG_RSP
 
REG_RSP


	)

75 
	mREG_RIP
,

76 
	#REG_RIP
 
REG_RIP


	)

77 
	mREG_EFL
,

78 
	#REG_EFL
 
REG_EFL


	)

79 
	mREG_CSGSFS
,

80 
	#REG_CSGSFS
 
REG_CSGSFS


	)

81 
	mREG_ERR
,

82 
	#REG_ERR
 
REG_ERR


	)

83 
	mREG_TRAPNO
,

84 
	#REG_TRAPNO
 
REG_TRAPNO


	)

85 
	mREG_OLDMASK
,

86 
	#REG_OLDMASK
 
REG_OLDMASK


	)

87 
	mREG_CR2


88 
	#REG_CR2
 
REG_CR2


	)

92 
	s_libc_åx»g


94 
	msignifiÿnd
[4];

95 
	mexpÚ’t
;

96 
	m·ddšg
[3];

99 
	s_libc_xmm»g


101 
__ušt32_t
 
	m–em’t
[4];

104 
	s_libc_å¡©e


107 
__ušt16_t
 
	mcwd
;

108 
__ušt16_t
 
	mswd
;

109 
__ušt16_t
 
	máw
;

110 
__ušt16_t
 
	mfİ
;

111 
__ušt64_t
 
	mr
;

112 
__ušt64_t
 
	mrdp
;

113 
__ušt32_t
 
	mmxc¤
;

114 
__ušt32_t
 
	mmxü_mask
;

115 
_libc_åx»g
 
	m_¡
[8];

116 
_libc_xmm»g
 
	m_xmm
[16];

117 
__ušt32_t
 
	m·ddšg
[24];

121 
_libc_å¡©e
 *
	tå»g£t_t
;

126 
g»g£t_t
 
	mg»gs
;

128 
å»g£t_t
 
	må»gs
;

129 
__ex‹nsiÚ__
 
	m__»£rved1
 [8];

130 } 
	tmcÚ‹xt_t
;

133 
	sucÚ‹xt


135 
	muc_æags
;

136 
ucÚ‹xt
 *
	muc_lšk
;

137 
¡ack_t
 
	muc_¡ack
;

138 
mcÚ‹xt_t
 
	muc_mcÚ‹xt
;

139 
__sig£t_t
 
	muc_sigmask
;

140 
_libc_å¡©e
 
	m__å»gs_mem
;

141 } 
	tucÚ‹xt_t
;

146 
	tg»g_t
;

149 
	#NGREG
 19

	)

152 
g»g_t
 
	tg»g£t_t
[
NGREG
];

154 #ifdeà
__USE_GNU


158 
	mREG_GS
 = 0,

159 
	#REG_GS
 
REG_GS


	)

160 
	mREG_FS
,

161 
	#REG_FS
 
REG_FS


	)

162 
	mREG_ES
,

163 
	#REG_ES
 
REG_ES


	)

164 
	mREG_DS
,

165 
	#REG_DS
 
REG_DS


	)

166 
	mREG_EDI
,

167 
	#REG_EDI
 
REG_EDI


	)

168 
	mREG_ESI
,

169 
	#REG_ESI
 
REG_ESI


	)

170 
	mREG_EBP
,

171 
	#REG_EBP
 
REG_EBP


	)

172 
	mREG_ESP
,

173 
	#REG_ESP
 
REG_ESP


	)

174 
	mREG_EBX
,

175 
	#REG_EBX
 
REG_EBX


	)

176 
	mREG_EDX
,

177 
	#REG_EDX
 
REG_EDX


	)

178 
	mREG_ECX
,

179 
	#REG_ECX
 
REG_ECX


	)

180 
	mREG_EAX
,

181 
	#REG_EAX
 
REG_EAX


	)

182 
	mREG_TRAPNO
,

183 
	#REG_TRAPNO
 
REG_TRAPNO


	)

184 
	mREG_ERR
,

185 
	#REG_ERR
 
REG_ERR


	)

186 
	mREG_EIP
,

187 
	#REG_EIP
 
REG_EIP


	)

188 
	mREG_CS
,

189 
	#REG_CS
 
REG_CS


	)

190 
	mREG_EFL
,

191 
	#REG_EFL
 
REG_EFL


	)

192 
	mREG_UESP
,

193 
	#REG_UESP
 
REG_UESP


	)

194 
	mREG_SS


195 
	#REG_SS
 
REG_SS


	)

200 
	s_libc_å»g


202 
	msignifiÿnd
[4];

203 
	mexpÚ’t
;

206 
	s_libc_å¡©e


208 
	mcw
;

209 
	msw
;

210 
	mg
;

211 
	moff
;

212 
	mcs£l
;

213 
	md©aoff
;

214 
	md©a£l
;

215 
_libc_å»g
 
	m_¡
[8];

216 
	m¡©us
;

220 
_libc_å¡©e
 *
	tå»g£t_t
;

225 
g»g£t_t
 
	mg»gs
;

228 
å»g£t_t
 
	må»gs
;

229 
	mŞdmask
;

230 
	mü2
;

231 } 
	tmcÚ‹xt_t
;

234 
	sucÚ‹xt


236 
	muc_æags
;

237 
ucÚ‹xt
 *
	muc_lšk
;

238 
¡ack_t
 
	muc_¡ack
;

239 
mcÚ‹xt_t
 
	muc_mcÚ‹xt
;

240 
__sig£t_t
 
	muc_sigmask
;

241 
_libc_å¡©e
 
	m__å»gs_mem
;

242 } 
	tucÚ‹xt_t
;

	@/usr/include/xlocale.h

20 #iâdeà
_XLOCALE_H


21 
	#_XLOCALE_H
 1

	)

27 
	s__loÿË_¡ruù


30 
__loÿË_d©a
 *
	m__loÿËs
[13];

33 cÚ¡ *
	m__ùy³_b
;

34 cÚ¡ *
	m__ùy³_tŞow”
;

35 cÚ¡ *
	m__ùy³_touµ”
;

38 cÚ¡ *
	m__Çmes
[13];

39 } *
	t__loÿË_t
;

42 
__loÿË_t
 
	tloÿË_t
;

	@/usr/include/_G_config.h

4 #iâdeà
_G_cÚfig_h


5 
	#_G_cÚfig_h
 1

	)

9 
	~<b™s/ty³s.h
>

10 
	#__Ãed_size_t


	)

11 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


12 
	#__Ãed_wch¬_t


	)

14 
	#__Ãed_NULL


	)

15 
	~<¡ddef.h
>

16 
	#__Ãed_mb¡©e_t


	)

17 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


18 
	#__Ãed_wšt_t


	)

20 
	~<wch¬.h
>

23 
__off_t
 
	m__pos
;

24 
__mb¡©e_t
 
	m__¡©e
;

25 } 
	t_G_åos_t
;

28 
__off64_t
 
	m__pos
;

29 
__mb¡©e_t
 
	m__¡©e
;

30 } 
	t_G_åos64_t
;

31 #ià
defšed
 
_LIBC
 || defšed 
_GLIBCPP_USE_WCHAR_T


32 
	~<gcÚv.h
>

35 
__gcÚv_šfo
 
	m__cd
;

38 
__gcÚv_šfo
 
	m__cd
;

39 
__gcÚv_¡•_d©a
 
	m__d©a
;

40 } 
	m__combšed
;

41 } 
	t_G_icÚv_t
;

46 
	#_G_va_li¡
 
__gnuc_va_li¡


	)

48 
	#_G_HAVE_MMAP
 1

	)

49 
	#_G_HAVE_MREMAP
 1

	)

51 
	#_G_IO_IO_FILE_VERSION
 0x20001

	)

54 
	#_G_HAVE_ST_BLKSIZE
 
	`defšed
 (
_STATBUF_ST_BLKSIZE
)

	)

56 
	#_G_BUFSIZ
 8192

	)

	@/usr/include/asm-generic/int-ll64.h

8 #iâdeà
_ASM_GENERIC_INT_LL64_H


9 
	#_ASM_GENERIC_INT_LL64_H


	)

11 
	~<asm/b™¥”lÚg.h
>

13 #iâdeà
__ASSEMBLY__


19 
__sigÃd__
 
	t__s8
;

20 
	t__u8
;

22 
__sigÃd__
 
	t__s16
;

23 
	t__u16
;

25 
__sigÃd__
 
	t__s32
;

26 
	t__u32
;

28 #ifdeà
__GNUC__


29 
__ex‹nsiÚ__
 
__sigÃd__
 
	t__s64
;

30 
__ex‹nsiÚ__
 
	t__u64
;

32 
__sigÃd__
 
	t__s64
;

33 
	t__u64
;

	@/usr/include/asm-generic/poll.h

1 #iâdeà
__ASM_GENERIC_POLL_H


2 
	#__ASM_GENERIC_POLL_H


	)

5 
	#POLLIN
 0x0001

	)

6 
	#POLLPRI
 0x0002

	)

7 
	#POLLOUT
 0x0004

	)

8 
	#POLLERR
 0x0008

	)

9 
	#POLLHUP
 0x0010

	)

10 
	#POLLNVAL
 0x0020

	)

13 
	#POLLRDNORM
 0x0040

	)

14 
	#POLLRDBAND
 0x0080

	)

15 #iâdeà
POLLWRNORM


16 
	#POLLWRNORM
 0x0100

	)

18 #iâdeà
POLLWRBAND


19 
	#POLLWRBAND
 0x0200

	)

21 #iâdeà
POLLMSG


22 
	#POLLMSG
 0x0400

	)

24 #iâdeà
POLLREMOVE


25 
	#POLLREMOVE
 0x1000

	)

27 #iâdeà
POLLRDHUP


28 
	#POLLRDHUP
 0x2000

	)

31 
	#POLLFREE
 0x4000

	)

33 
	#POLL_BUSY_LOOP
 0x8000

	)

35 
	spŞlfd
 {

36 
	mfd
;

37 
	mev’ts
;

38 
	m»v’ts
;

	@/usr/include/asm/ioctl.h

1 
	~<asm-g’”ic/ioùl.h
>

	@/usr/include/asm/ioctls.h

1 
	~<asm-g’”ic/ioùls.h
>

	@/usr/include/asm/posix_types.h

1 #ifdeà
__i386__


2 
	~<asm/posix_ty³s_32.h
>

3 #–ià
defšed
(
__ILP32__
)

4 
	~<asm/posix_ty³s_x32.h
>

6 
	~<asm/posix_ty³s_64.h
>

	@/usr/include/asm/socket.h

1 
	~<asm-g’”ic/sock‘.h
>

	@/usr/include/bits/byteswap-16.h

19 #iâdeà
_BITS_BYTESWAP_H


23 #ifdeà
__GNUC__


24 #ià
__GNUC__
 >= 2

25 
	#__bsw­_16
(
x
) \

26 (
__ex‹nsiÚ__
 \

27 ({ 
__v
, 
__x
 = (è(
x
); \

28 ià(
	`__butš_cÚ¡ªt_p
 (
__x
)) \

29 
__v
 = 
	`__bsw­_cÚ¡ªt_16
 (
__x
); \

31 
	`__asm__
 ("rorw $8, %w0" \

32 : "ô" (
__v
) \

33 : "0" (
__x
) \

35 
__v
; }))

	)

38 
	#__bsw­_16
(
x
) \

39 (
__ex‹nsiÚ__
 \

40 ({ 
__x
 = (è(
x
); \

41 
	`__bsw­_cÚ¡ªt_16
 (
__x
); }))

	)

44 
__šlše
 

45 
	$__bsw­_16
 (
__bsx
)

47  
	`__bsw­_cÚ¡ªt_16
 (
__bsx
);

48 
	}
}

	@/usr/include/bits/endian.h

3 #iâdeà
_ENDIAN_H


7 
	#__BYTE_ORDER
 
__LITTLE_ENDIAN


	)

	@/usr/include/bits/fcntl-linux.h

19 #iâdef 
_FCNTL_H


37 #ifdeà
__USE_GNU


38 
	~<b™s/uio.h
>

42 
	#O_ACCMODE
 0003

	)

43 
	#O_RDONLY
 00

	)

44 
	#O_WRONLY
 01

	)

45 
	#O_RDWR
 02

	)

46 #iâdeà
O_CREAT


47 
	#O_CREAT
 0100

	)

49 #iâdeà
O_EXCL


50 
	#O_EXCL
 0200

	)

52 #iâdeà
O_NOCTTY


53 
	#O_NOCTTY
 0400

	)

55 #iâdeà
O_TRUNC


56 
	#O_TRUNC
 01000

	)

58 #iâdeà
O_APPEND


59 
	#O_APPEND
 02000

	)

61 #iâdeà
O_NONBLOCK


62 
	#O_NONBLOCK
 04000

	)

64 #iâdeà
O_NDELAY


65 
	#O_NDELAY
 
O_NONBLOCK


	)

67 #iâdeà
O_SYNC


68 
	#O_SYNC
 04010000

	)

70 
	#O_FSYNC
 
O_SYNC


	)

71 #iâdeà
O_ASYNC


72 
	#O_ASYNC
 020000

	)

74 #iâdeà
__O_LARGEFILE


75 
	#__O_LARGEFILE
 0100000

	)

78 #iâdeà
__O_DIRECTORY


79 
	#__O_DIRECTORY
 0200000

	)

81 #iâdeà
__O_NOFOLLOW


82 
	#__O_NOFOLLOW
 0400000

	)

84 #iâdeà
__O_CLOEXEC


85 
	#__O_CLOEXEC
 02000000

	)

87 #iâdeà
__O_DIRECT


88 
	#__O_DIRECT
 040000

	)

90 #iâdeà
__O_NOATIME


91 
	#__O_NOATIME
 01000000

	)

93 #iâdeà
__O_PATH


94 
	#__O_PATH
 010000000

	)

96 #iâdeà
__O_DSYNC


97 
	#__O_DSYNC
 010000

	)

99 #iâdeà
__O_TMPFILE


100 
	#__O_TMPFILE
 (020000000 | 
__O_DIRECTORY
)

	)

103 #iâdeà
F_GETLK


104 #iâdeà
__USE_FILE_OFFSET64


105 
	#F_GETLK
 5

	)

106 
	#F_SETLK
 6

	)

107 
	#F_SETLKW
 7

	)

109 
	#F_GETLK
 
F_GETLK64


	)

110 
	#F_SETLK
 
F_SETLK64


	)

111 
	#F_SETLKW
 
F_SETLKW64


	)

114 #iâdeà
F_GETLK64


115 
	#F_GETLK64
 12

	)

116 
	#F_SETLK64
 13

	)

117 
	#F_SETLKW64
 14

	)

131 #ifdeà
__USE_GNU


132 
	#F_OFD_GETLK
 36

	)

133 
	#F_OFD_SETLK
 37

	)

134 
	#F_OFD_SETLKW
 38

	)

137 #ifdeà
__USE_LARGEFILE64


138 
	#O_LARGEFILE
 
__O_LARGEFILE


	)

141 #ifdeà
__USE_XOPEN2K8


142 
	#O_DIRECTORY
 
__O_DIRECTORY


	)

143 
	#O_NOFOLLOW
 
__O_NOFOLLOW


	)

144 
	#O_CLOEXEC
 
__O_CLOEXEC


	)

147 #ifdeà
__USE_GNU


148 
	#O_DIRECT
 
__O_DIRECT


	)

149 
	#O_NOATIME
 
__O_NOATIME


	)

150 
	#O_PATH
 
__O_PATH


	)

151 
	#O_TMPFILE
 
__O_TMPFILE


	)

157 #ià
defšed
 
__USE_POSIX199309
 || defšed 
__USE_UNIX98


158 
	#O_DSYNC
 
__O_DSYNC


	)

159 #ià
defšed
 
__O_RSYNC


160 
	#O_RSYNC
 
__O_RSYNC


	)

162 
	#O_RSYNC
 
O_SYNC


	)

167 
	#F_DUPFD
 0

	)

168 
	#F_GETFD
 1

	)

169 
	#F_SETFD
 2

	)

170 
	#F_GETFL
 3

	)

171 
	#F_SETFL
 4

	)

173 #iâdeà
__F_SETOWN


174 
	#__F_SETOWN
 8

	)

175 
	#__F_GETOWN
 9

	)

178 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K8


179 
	#F_SETOWN
 
__F_SETOWN


	)

180 
	#F_GETOWN
 
__F_GETOWN


	)

183 #iâdeà
__F_SETSIG


184 
	#__F_SETSIG
 10

	)

185 
	#__F_GETSIG
 11

	)

187 #iâdeà
__F_SETOWN_EX


188 
	#__F_SETOWN_EX
 15

	)

189 
	#__F_GETOWN_EX
 16

	)

192 #ifdeà
__USE_GNU


193 
	#F_SETSIG
 
__F_SETSIG


	)

194 
	#F_GETSIG
 
__F_GETSIG


	)

195 
	#F_SETOWN_EX
 
__F_SETOWN_EX


	)

196 
	#F_GETOWN_EX
 
__F_GETOWN_EX


	)

199 #ifdeà
__USE_GNU


200 
	#F_SETLEASE
 1024

	)

201 
	#F_GETLEASE
 1025

	)

202 
	#F_NOTIFY
 1026

	)

203 
	#F_SETPIPE_SZ
 1031

	)

204 
	#F_GETPIPE_SZ
 1032

	)

206 #ifdeà
__USE_XOPEN2K8


207 
	#F_DUPFD_CLOEXEC
 1030

	)

212 
	#FD_CLOEXEC
 1

	)

214 #iâdeà
F_RDLCK


216 
	#F_RDLCK
 0

	)

217 
	#F_WRLCK
 1

	)

218 
	#F_UNLCK
 2

	)

223 #iâdeà
F_EXLCK


224 
	#F_EXLCK
 4

	)

225 
	#F_SHLCK
 8

	)

228 #ifdeà
__USE_MISC


230 
	#LOCK_SH
 1

	)

231 
	#LOCK_EX
 2

	)

232 
	#LOCK_NB
 4

	)

234 
	#LOCK_UN
 8

	)

237 #ifdeà
__USE_GNU


238 
	#LOCK_MAND
 32

	)

239 
	#LOCK_READ
 64

	)

240 
	#LOCK_WRITE
 128

	)

241 
	#LOCK_RW
 192

	)

244 #ifdeà
__USE_GNU


246 
	#DN_ACCESS
 0x00000001

	)

247 
	#DN_MODIFY
 0x00000002

	)

248 
	#DN_CREATE
 0x00000004

	)

249 
	#DN_DELETE
 0x00000008

	)

250 
	#DN_RENAME
 0x00000010

	)

251 
	#DN_ATTRIB
 0x00000020

	)

252 
	#DN_MULTISHOT
 0x80000000

	)

256 #ifdeà
__USE_GNU


258 
	e__pid_ty³


260 
	mF_OWNER_TID
 = 0,

261 
	mF_OWNER_PID
,

262 
	mF_OWNER_PGRP
,

263 
	mF_OWNER_GID
 = 
F_OWNER_PGRP


267 
	sf_owÃr_ex


269 
__pid_ty³
 
	mty³
;

270 
__pid_t
 
	mpid
;

276 #ifdef 
__USE_MISC


277 
	#FAPPEND
 
O_APPEND


	)

278 
	#FFSYNC
 
O_FSYNC


	)

279 
	#FASYNC
 
O_ASYNC


	)

280 
	#FNONBLOCK
 
O_NONBLOCK


	)

281 
	#FNDELAY
 
O_NDELAY


	)

284 #iâdeà
__POSIX_FADV_DONTNEED


285 
	#__POSIX_FADV_DONTNEED
 4

	)

286 
	#__POSIX_FADV_NOREUSE
 5

	)

289 #ifdeà
__USE_XOPEN2K


290 
	#POSIX_FADV_NORMAL
 0

	)

291 
	#POSIX_FADV_RANDOM
 1

	)

292 
	#POSIX_FADV_SEQUENTIAL
 2

	)

293 
	#POSIX_FADV_WILLNEED
 3

	)

294 
	#POSIX_FADV_DONTNEED
 
__POSIX_FADV_DONTNEED


	)

295 
	#POSIX_FADV_NOREUSE
 
__POSIX_FADV_NOREUSE


	)

299 #ifdeà
__USE_GNU


301 
	#SYNC_FILE_RANGE_WAIT_BEFORE
 1

	)

304 
	#SYNC_FILE_RANGE_WRITE
 2

	)

307 
	#SYNC_FILE_RANGE_WAIT_AFTER
 4

	)

312 
	#SPLICE_F_MOVE
 1

	)

313 
	#SPLICE_F_NONBLOCK
 2

	)

316 
	#SPLICE_F_MORE
 4

	)

317 
	#SPLICE_F_GIFT
 8

	)

321 
	#FALLOC_FL_KEEP_SIZE
 1

	)

324 
	#FALLOC_FL_PUNCH_HOLE
 2

	)

325 
	#FALLOC_FL_COLLAPSE_RANGE
 8

	)

328 
	#FALLOC_FL_ZERO_RANGE
 16

	)

333 
	sfe_hªdË


335 
	mhªdË_by‹s
;

336 
	mhªdË_ty³
;

338 
	mf_hªdË
[0];

342 
	#MAX_HANDLE_SZ
 128

	)

346 #ifdeà
__USE_ATFILE


347 
	#AT_FDCWD
 -100

	)

350 
	#AT_SYMLINK_NOFOLLOW
 0x100

	)

351 
	#AT_REMOVEDIR
 0x200

	)

353 
	#AT_SYMLINK_FOLLOW
 0x400

	)

354 #ifdeà
__USE_GNU


355 
	#AT_NO_AUTOMOUNT
 0x800

	)

357 
	#AT_EMPTY_PATH
 0x1000

	)

359 
	#AT_EACCESS
 0x200

	)

363 
	g__BEGIN_DECLS


365 #ifdeà
__USE_GNU


368 
ssize_t
 
	$»adah—d
 (
__fd
, 
__off64_t
 
__off£t
, 
size_t
 
__couÁ
)

369 
__THROW
;

376 
	`sync_fe_¿nge
 (
__fd
, 
__off64_t
 
__off£t
, __off64_ˆ
__couÁ
,

377 
__æags
);

384 
ssize_t
 
	`vm¥liû
 (
__fdout
, cÚ¡ 
iovec
 *
__iov
,

385 
size_t
 
__couÁ
, 
__æags
);

391 
ssize_t
 
	`¥liû
 (
__fdš
, 
__off64_t
 *
__offš
, 
__fdout
,

392 
__off64_t
 *
__offout
, 
size_t
 
__Ën
,

393 
__æags
);

399 
ssize_t
 
	`‹e
 (
__fdš
, 
__fdout
, 
size_t
 
__Ën
,

400 
__æags
);

406 #iâdeà
__USE_FILE_OFFSET64


407 
	`çÎoÿ‹
 (
__fd
, 
__mode
, 
__off_t
 
__off£t
, __off_ˆ
__Ën
);

409 #ifdeà
__REDIRECT


410 
	`__REDIRECT
 (
çÎoÿ‹
, (
__fd
, 
__mode
, 
__off64_t
 
__off£t
,

411 
__off64_t
 
__Ën
),

412 
çÎoÿ‹64
);

414 
	#çÎoÿ‹
 
çÎoÿ‹64


	)

417 #ifdeà
__USE_LARGEFILE64


418 
	`çÎoÿ‹64
 (
__fd
, 
__mode
, 
__off64_t
 
__off£t
,

419 
__off64_t
 
__Ën
);

424 
	$Çme_to_hªdË_©
 (
__dfd
, cÚ¡ *
__Çme
,

425 
fe_hªdË
 *
__hªdË
, *
__mÁ_id
,

426 
__æags
è
__THROW
;

432 
	`İ’_by_hªdË_©
 (
__mouÁdœfd
, 
fe_hªdË
 *
__hªdË
,

433 
__æags
);

437 
__END_DECLS


	@/usr/include/bits/libio-ldbl.h

19 #iâdeà
_IO_STDIO_H


23 
	$__LDBL_REDIR_DECL
 (
_IO_vfsÿnf
)

24 
	`__LDBL_REDIR_DECL
 (
_IO_vårštf
)

	@/usr/include/bits/libm-simd-decl-stubs.h

19 #iâdeà
_MATH_H


33 #iâdeà
_BITS_LIBM_SIMD_DECL_STUBS_H


34 
	#_BITS_LIBM_SIMD_DECL_STUBS_H
 1

	)

36 
	#__DECL_SIMD_cos


	)

37 
	#__DECL_SIMD_cosf


	)

38 
	#__DECL_SIMD_co¦


	)

40 
	#__DECL_SIMD_sš


	)

41 
	#__DECL_SIMD_sšf


	)

42 
	#__DECL_SIMD_sšl


	)

44 
	#__DECL_SIMD_sšcos


	)

45 
	#__DECL_SIMD_sšcosf


	)

46 
	#__DECL_SIMD_sšco¦


	)

48 
	#__DECL_SIMD_log


	)

49 
	#__DECL_SIMD_logf


	)

50 
	#__DECL_SIMD_logl


	)

52 
	#__DECL_SIMD_exp


	)

53 
	#__DECL_SIMD_expf


	)

54 
	#__DECL_SIMD_ex¶


	)

56 
	#__DECL_SIMD_pow


	)

57 
	#__DECL_SIMD_powf


	)

58 
	#__DECL_SIMD_powl


	)

	@/usr/include/bits/mman-linux.h

19 #iâdeà
_SYS_MMAN_H


35 
	#PROT_READ
 0x1

	)

36 
	#PROT_WRITE
 0x2

	)

37 
	#PROT_EXEC
 0x4

	)

38 
	#PROT_NONE
 0x0

	)

39 
	#PROT_GROWSDOWN
 0x01000000

	)

41 
	#PROT_GROWSUP
 0x02000000

	)

45 
	#MAP_SHARED
 0x01

	)

46 
	#MAP_PRIVATE
 0x02

	)

47 #ifdeà
__USE_MISC


48 
	#MAP_TYPE
 0x0à

	)

52 
	#MAP_FIXED
 0x10

	)

53 #ifdeà
__USE_MISC


54 
	#MAP_FILE
 0

	)

55 #ifdeà
__MAP_ANONYMOUS


56 
	#MAP_ANONYMOUS
 
__MAP_ANONYMOUS


	)

58 
	#MAP_ANONYMOUS
 0x20

	)

60 
	#MAP_ANON
 
MAP_ANONYMOUS


	)

62 
	#MAP_HUGE_SHIFT
 26

	)

63 
	#MAP_HUGE_MASK
 0x3f

	)

67 
	#MS_ASYNC
 1

	)

68 
	#MS_SYNC
 4

	)

69 
	#MS_INVALIDATE
 2

	)

72 #ifdeà
__USE_GNU


73 
	#MREMAP_MAYMOVE
 1

	)

74 
	#MREMAP_FIXED
 2

	)

78 #ifdeà
__USE_MISC


79 
	#MADV_NORMAL
 0

	)

80 
	#MADV_RANDOM
 1

	)

81 
	#MADV_SEQUENTIAL
 2

	)

82 
	#MADV_WILLNEED
 3

	)

83 
	#MADV_DONTNEED
 4

	)

84 
	#MADV_FREE
 8

	)

85 
	#MADV_REMOVE
 9

	)

86 
	#MADV_DONTFORK
 10

	)

87 
	#MADV_DOFORK
 11

	)

88 
	#MADV_MERGEABLE
 12

	)

89 
	#MADV_UNMERGEABLE
 13

	)

90 
	#MADV_HUGEPAGE
 14

	)

91 
	#MADV_NOHUGEPAGE
 15

	)

92 
	#MADV_DONTDUMP
 16

	)

94 
	#MADV_DODUMP
 17

	)

95 
	#MADV_HWPOISON
 100

	)

99 #ifdeà
__USE_XOPEN2K


100 
	#POSIX_MADV_NORMAL
 0

	)

101 
	#POSIX_MADV_RANDOM
 1

	)

102 
	#POSIX_MADV_SEQUENTIAL
 2

	)

103 
	#POSIX_MADV_WILLNEED
 3

	)

104 
	#POSIX_MADV_DONTNEED
 4

	)

108 #iâdeà
MCL_CURRENT


109 
	#MCL_CURRENT
 1

	)

110 
	#MCL_FUTURE
 2

	)

112 
	#MCL_ONFAULT
 4

	)

	@/usr/include/bits/posix1_lim.h

24 #iâdef 
_BITS_POSIX1_LIM_H


25 
	#_BITS_POSIX1_LIM_H
 1

	)

31 
	#_POSIX_AIO_LISTIO_MAX
 2

	)

34 
	#_POSIX_AIO_MAX
 1

	)

37 
	#_POSIX_ARG_MAX
 4096

	)

40 #ifdeà
__USE_XOPEN2K


41 
	#_POSIX_CHILD_MAX
 25

	)

43 
	#_POSIX_CHILD_MAX
 6

	)

47 
	#_POSIX_DELAYTIMER_MAX
 32

	)

51 
	#_POSIX_HOST_NAME_MAX
 255

	)

54 
	#_POSIX_LINK_MAX
 8

	)

57 
	#_POSIX_LOGIN_NAME_MAX
 9

	)

60 
	#_POSIX_MAX_CANON
 255

	)

64 
	#_POSIX_MAX_INPUT
 255

	)

67 
	#_POSIX_MQ_OPEN_MAX
 8

	)

70 
	#_POSIX_MQ_PRIO_MAX
 32

	)

73 
	#_POSIX_NAME_MAX
 14

	)

76 #ifdeà
__USE_XOPEN2K


77 
	#_POSIX_NGROUPS_MAX
 8

	)

79 
	#_POSIX_NGROUPS_MAX
 0

	)

83 #ifdeà
__USE_XOPEN2K


84 
	#_POSIX_OPEN_MAX
 20

	)

86 
	#_POSIX_OPEN_MAX
 16

	)

89 #ià!
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_GNU


92 
	#_POSIX_FD_SETSIZE
 
_POSIX_OPEN_MAX


	)

96 
	#_POSIX_PATH_MAX
 256

	)

99 
	#_POSIX_PIPE_BUF
 512

	)

103 
	#_POSIX_RE_DUP_MAX
 255

	)

106 
	#_POSIX_RTSIG_MAX
 8

	)

109 
	#_POSIX_SEM_NSEMS_MAX
 256

	)

112 
	#_POSIX_SEM_VALUE_MAX
 32767

	)

115 
	#_POSIX_SIGQUEUE_MAX
 32

	)

118 
	#_POSIX_SSIZE_MAX
 32767

	)

121 
	#_POSIX_STREAM_MAX
 8

	)

124 
	#_POSIX_SYMLINK_MAX
 255

	)

128 
	#_POSIX_SYMLOOP_MAX
 8

	)

131 
	#_POSIX_TIMER_MAX
 32

	)

134 
	#_POSIX_TTY_NAME_MAX
 9

	)

137 #ifdeà
__USE_XOPEN2K


138 
	#_POSIX_TZNAME_MAX
 6

	)

140 
	#_POSIX_TZNAME_MAX
 3

	)

143 #ià!
defšed
 
__USE_XOPEN2K
 || defšed 
__USE_GNU


145 
	#_POSIX_QLIMIT
 1

	)

149 
	#_POSIX_HIWAT
 
_POSIX_PIPE_BUF


	)

152 
	#_POSIX_UIO_MAXIOV
 16

	)

156 
	#_POSIX_CLOCKRES_MIN
 20000000

	)

160 
	~<b™s/loÿl_lim.h
>

163 #iâdef 
SSIZE_MAX


164 
	#SSIZE_MAX
 
LONG_MAX


	)

171 #iâdef 
NGROUPS_MAX


172 
	#NGROUPS_MAX
 8

	)

	@/usr/include/bits/posix2_lim.h

22 #iâdef 
_BITS_POSIX2_LIM_H


23 
	#_BITS_POSIX2_LIM_H
 1

	)

27 
	#_POSIX2_BC_BASE_MAX
 99

	)

30 
	#_POSIX2_BC_DIM_MAX
 2048

	)

33 
	#_POSIX2_BC_SCALE_MAX
 99

	)

36 
	#_POSIX2_BC_STRING_MAX
 1000

	)

40 
	#_POSIX2_COLL_WEIGHTS_MAX
 2

	)

44 
	#_POSIX2_EXPR_NEST_MAX
 32

	)

47 
	#_POSIX2_LINE_MAX
 2048

	)

51 
	#_POSIX2_RE_DUP_MAX
 255

	)

55 
	#_POSIX2_CHARCLASS_NAME_MAX
 14

	)

62 #iâdef 
BC_BASE_MAX


63 
	#BC_BASE_MAX
 
_POSIX2_BC_BASE_MAX


	)

65 #iâdef 
BC_DIM_MAX


66 
	#BC_DIM_MAX
 
_POSIX2_BC_DIM_MAX


	)

68 #iâdef 
BC_SCALE_MAX


69 
	#BC_SCALE_MAX
 
_POSIX2_BC_SCALE_MAX


	)

71 #iâdef 
BC_STRING_MAX


72 
	#BC_STRING_MAX
 
_POSIX2_BC_STRING_MAX


	)

74 #iâdef 
COLL_WEIGHTS_MAX


75 
	#COLL_WEIGHTS_MAX
 255

	)

77 #iâdef 
EXPR_NEST_MAX


78 
	#EXPR_NEST_MAX
 
_POSIX2_EXPR_NEST_MAX


	)

80 #iâdef 
LINE_MAX


81 
	#LINE_MAX
 
_POSIX2_LINE_MAX


	)

83 #iâdef 
CHARCLASS_NAME_MAX


84 
	#CHARCLASS_NAME_MAX
 2048

	)

88 
	#RE_DUP_MAX
 (0x7fff)

	)

	@/usr/include/bits/sched.h

20 #iâdeà
__Ãed_sched·¿m


22 #iâdeà
_SCHED_H


28 
	#SCHED_OTHER
 0

	)

29 
	#SCHED_FIFO
 1

	)

30 
	#SCHED_RR
 2

	)

31 #ifdeà
__USE_GNU


32 
	#SCHED_BATCH
 3

	)

33 
	#SCHED_IDLE
 5

	)

35 
	#SCHED_RESET_ON_FORK
 0x40000000

	)

38 #ifdeà
__USE_GNU


40 
	#CSIGNAL
 0x000000fà

	)

41 
	#CLONE_VM
 0x00000100

	)

42 
	#CLONE_FS
 0x00000200

	)

43 
	#CLONE_FILES
 0x00000400

	)

44 
	#CLONE_SIGHAND
 0x00000800

	)

45 
	#CLONE_PTRACE
 0x00002000

	)

46 
	#CLONE_VFORK
 0x00004000

	)

48 
	#CLONE_PARENT
 0x00008000

	)

50 
	#CLONE_THREAD
 0x00010000

	)

51 
	#CLONE_NEWNS
 0x00020000

	)

52 
	#CLONE_SYSVSEM
 0x00040000

	)

53 
	#CLONE_SETTLS
 0x00080000

	)

54 
	#CLONE_PARENT_SETTID
 0x00100000

	)

56 
	#CLONE_CHILD_CLEARTID
 0x00200000

	)

58 
	#CLONE_DETACHED
 0x00400000

	)

59 
	#CLONE_UNTRACED
 0x00800000

	)

61 
	#CLONE_CHILD_SETTID
 0x01000000

	)

63 
	#CLONE_NEWCGROUP
 0x02000000

	)

64 
	#CLONE_NEWUTS
 0x04000000

	)

65 
	#CLONE_NEWIPC
 0x08000000

	)

66 
	#CLONE_NEWUSER
 0x10000000

	)

67 
	#CLONE_NEWPID
 0x20000000

	)

68 
	#CLONE_NEWNET
 0x40000000

	)

69 
	#CLONE_IO
 0x80000000

	)

73 
	ssched_·¿m


75 
	m__sched_´iÜ™y
;

78 
	g__BEGIN_DECLS


80 #ifdeà
__USE_GNU


82 
şÚe
 ((*
__â
è(*
__¬g
), *
__chd_¡ack
,

83 
__æags
, *
__¬g
, ...è
__THROW
;

86 
	$unsh¬e
 (
__æags
è
__THROW
;

89 
	$sched_g‘ıu
 (è
__THROW
;

92 
	$£Šs
 (
__fd
, 
__n¡y³
è
__THROW
;

96 
__END_DECLS


100 #ià!
defšed
 
__defšed_sched·¿m
 \

101 && (
defšed
 
__Ãed_sched·¿m
 || defšed 
_SCHED_H
)

102 
	#__defšed_sched·¿m
 1

	)

104 
	s__sched_·¿m


106 
__sched_´iÜ™y
;

108 #undeà
__Ãed_sched·¿m


112 #ià
defšed
 
_SCHED_H
 && !defšed 
__ıu_£t_t_defšed


113 
	#__ıu_£t_t_defšed


	)

115 
	#__CPU_SETSIZE
 1024

	)

116 
	#__NCPUBITS
 (8 *  (
__ıu_mask
))

	)

119 
__CPU_MASK_TYPE
 
	t__ıu_mask
;

122 
	#__CPUELT
(
ıu
è((ıuè/ 
__NCPUBITS
)

	)

123 
	#__CPUMASK
(
ıu
è((
__ıu_mask
è1 << ((ıuè% 
__NCPUBITS
))

	)

128 
__ıu_mask
 
__b™s
[
__CPU_SETSIZE
 / 
__NCPUBITS
];

129 } 
	tıu_£t_t
;

132 #ià
	`__GNUC_PREREQ
 (2, 91)

133 
	#__CPU_ZERO_S
(
£tsize
, 
ıu£
) \

134 dØ
	`__butš_mem£t
 (
ıu£
, '\0', 
£tsize
); 0)

	)

136 
	#__CPU_ZERO_S
(
£tsize
, 
ıu£
) \

138 
size_t
 
__i
; \

139 
size_t
 
__imax
 = (
£tsize
è/  (
__ıu_mask
); \

140 
__ıu_mask
 *
__b™s
 = (
ıu£
)->__bits; \

141 
__i
 = 0; __˜< 
__imax
; ++__i) \

142 
__b™s
[
__i
] = 0; \

143 
	}
} 0)

	)

145 
	#__CPU_SET_S
(
ıu
, 
£tsize
, 
ıu£
) \

146 (
__ex‹nsiÚ__
 \

147 ({ 
size_t
 
__ıu
 = (
ıu
); \

148 
__ıu
 / 8 < (
£tsize
) \

149 ? (((
__ıu_mask
 *è((
ıu£
)->
__b™s
))[
	`__CPUELT
 (
__ıu
)] \

150 |ğ
	`__CPUMASK
 (
__ıu
)) \

151 : 0; }))

	)

152 
	#__CPU_CLR_S
(
ıu
, 
£tsize
, 
ıu£
) \

153 (
__ex‹nsiÚ__
 \

154 ({ 
size_t
 
__ıu
 = (
ıu
); \

155 
__ıu
 / 8 < (
£tsize
) \

156 ? (((
__ıu_mask
 *è((
ıu£
)->
__b™s
))[
	`__CPUELT
 (
__ıu
)] \

157 &ğ~
	`__CPUMASK
 (
__ıu
)) \

158 : 0; }))

	)

159 
	#__CPU_ISSET_S
(
ıu
, 
£tsize
, 
ıu£
) \

160 (
__ex‹nsiÚ__
 \

161 ({ 
size_t
 
__ıu
 = (
ıu
); \

162 
__ıu
 / 8 < (
£tsize
) \

163 ? ((((cÚ¡ 
__ıu_mask
 *è((
ıu£
)->
__b™s
))[
	`__CPUELT
 (
__ıu
)] \

164 & 
	`__CPUMASK
 (
__ıu
))) != 0 \

165 : 0; }))

	)

167 
	#__CPU_COUNT_S
(
£tsize
, 
ıu£
) \

168 
	`__sched_ıucouÁ
 (
£tsize
, 
ıu£
)

	)

170 #ià
__GNUC_PREREQ
 (2, 91)

171 
	#__CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

172 (
	`__butš_memcmp
 (
ıu£1
, 
ıu£2
, 
£tsize
è=ğ0)

	)

174 
	#__CPU_EQUAL_S
(
£tsize
, 
ıu£1
, 
ıu£2
) \

175 (
__ex‹nsiÚ__
 \

176 ({ cÚ¡ 
__ıu_mask
 *
__¬r1
 = (
ıu£1
)->
__b™s
; \

177 cÚ¡ 
__ıu_mask
 *
__¬r2
 = (
ıu£2
)->
__b™s
; \

178 
size_t
 
__imax
 = (
£tsize
è/  (
__ıu_mask
); \

179 
size_t
 
__i
; \

180 
__i
 = 0; __˜< 
__imax
; ++__i) \

181 ià(
__¬r1
[
__i
] !ğ
__¬r2
[__i]) \

183 
__i
 =ğ
__imax
; }))

	)

186 
	#__CPU_OP_S
(
£tsize
, 
de¡£t
, 
¤c£t1
, 
¤c£t2
, 
İ
) \

187 (
__ex‹nsiÚ__
 \

188 ({ 
ıu_£t_t
 *
__de¡
 = (
de¡£t
); \

189 cÚ¡ 
__ıu_mask
 *
__¬r1
 = (
¤c£t1
)->
__b™s
; \

190 cÚ¡ 
__ıu_mask
 *
__¬r2
 = (
¤c£t2
)->
__b™s
; \

191 
size_t
 
__imax
 = (
£tsize
è/  (
__ıu_mask
); \

192 
size_t
 
__i
; \

193 
__i
 = 0; __˜< 
__imax
; ++__i) \

194 ((
__ıu_mask
 *è
__de¡
->
__b™s
)[
__i
] = 
__¬r1
[__i] 
İ
 
__¬r2
[__i]; \

195 
__de¡
; }))

	)

197 
	#__CPU_ALLOC_SIZE
(
couÁ
) \

198 ((((
couÁ
è+ 
__NCPUBITS
 - 1è/ __NCPUBITSè*  (
__ıu_mask
))

	)

199 
	#__CPU_ALLOC
(
couÁ
è
	`__sched_ıu®loc
 (couÁ)

	)

200 
	#__CPU_FREE
(
ıu£t
è
	`__sched_ıuä“
 (ıu£t)

	)

202 
__BEGIN_DECLS


204 
	$__sched_ıucouÁ
 (
size_t
 
__£tsize
, cÚ¡ 
ıu_£t_t
 *
__£
)

205 
__THROW
;

206 
ıu_£t_t
 *
	$__sched_ıu®loc
 (
size_t
 
__couÁ
è
__THROW
 
__wur
;

207 
	$__sched_ıuä“
 (
ıu_£t_t
 *
__£t
è
__THROW
;

209 
__END_DECLS


	@/usr/include/bits/socket_type.h

19 #iâdeà
_SYS_SOCKET_H


24 
	e__sock‘_ty³


26 
	mSOCK_STREAM
 = 1,

28 
	#SOCK_STREAM
 
SOCK_STREAM


	)

29 
	mSOCK_DGRAM
 = 2,

31 
	#SOCK_DGRAM
 
SOCK_DGRAM


	)

32 
	mSOCK_RAW
 = 3,

33 
	#SOCK_RAW
 
SOCK_RAW


	)

34 
	mSOCK_RDM
 = 4,

35 
	#SOCK_RDM
 
SOCK_RDM


	)

36 
	mSOCK_SEQPACKET
 = 5,

38 
	#SOCK_SEQPACKET
 
SOCK_SEQPACKET


	)

39 
	mSOCK_DCCP
 = 6,

40 
	#SOCK_DCCP
 
SOCK_DCCP


	)

41 
	mSOCK_PACKET
 = 10,

44 
	#SOCK_PACKET
 
SOCK_PACKET


	)

49 
	mSOCK_CLOEXEC
 = 02000000,

51 
	#SOCK_CLOEXEC
 
SOCK_CLOEXEC


	)

52 
	mSOCK_NONBLOCK
 = 00004000

54 
	#SOCK_NONBLOCK
 
SOCK_NONBLOCK


	)

	@/usr/include/bits/string.h

19 #iâdeà
_STRING_H


24 
	#_STRING_INLINE_uÇligÃd
 1

	)

27 
	#_HAVE_STRING_ARCH_mempıy
 1

	)

31 #ià!
defšed
 
__x86_64__
 && (defšed 
__i486__
 || defšed 
__³Áium__
 \

32 || 
defšed
 
	g__³Áium´o__
 || defšed 
	g__³Áium4__
 \

33 || 
defšed
 
	g__nocÚa__
 || defšed 
	g__©om__
 \

34 || 
defšed
 
	g__cÜe2__
 || defšed 
	g__cÜei7__
 \

35 || 
defšed
 
	g__§ndybridge__
 || defšed 
	g__hasw–l__
 \

36 || 
defšed
 
	g__bÚÃÎ__
 || defšed 
	g__sv”mÚt__
 \

37 || 
defšed
 
	g__k6__
 || defšed 
	g__geode__
 \

38 || 
defšed
 
	g__k8__
 || defšed 
	g__©hlÚ__
 \

39 || 
defšed
 
	g__amdçm10__
 || defšed 
	g__bdv”1__
 \

40 || 
defšed
 
	g__bdv”2__
 || defšed 
	g__bdv”3__
 \

41 || 
defšed
 
	g__bdv”4__
 || defšed 
	g__btv”1__
 \

42 || 
defšed
 
	g__btv”2__
)

46 #ià!
defšed
 
__NO_STRING_INLINES
 && defšed 
__USE_STRING_INLINES
 \

47 && 
defšed
 
	g__GNUC__
 && __GNUC__ >= 2

49 #iâdeà
__STRING_INLINE


50 #iâdeà
__ex‹º_šlše


51 
	#__STRING_INLINE
 
šlše


	)

53 
	#__STRING_INLINE
 
__ex‹º_šlše


	)

58 
	#__STRING_SMALL_GET16
(
¤c
, 
idx
) \

59 ((((cÚ¡ *è(
¤c
))[
idx
 + 1] << 8) \

60 | ((cÚ¡ *è(
¤c
))[
idx
])

	)

61 
	#__STRING_SMALL_GET32
(
¤c
, 
idx
) \

62 (((((cÚ¡ *è(
¤c
))[
idx
 + 3] << 8 \

63 | ((cÚ¡ *è(
¤c
))[
idx
 + 2]) << 8 \

64 | ((cÚ¡ *è(
¤c
))[
idx
 + 1]) << 8 \

65 | ((cÚ¡ *è(
¤c
))[
idx
])

	)

69 
	#_HAVE_STRING_ARCH_memıy
 1

	)

70 
	#memıy
(
de¡
, 
¤c
, 
n
) \

71 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) \

72 ? 
	`__memıy_c
 ((
de¡
), (
¤c
), (
n
)) \

73 : 
	`__memıy_g
 ((
de¡
), (
¤c
), (
n
))))

	)

74 
	#__memıy_c
(
de¡
, 
¤c
, 
n
) \

75 ((
n
) == 0 \

76 ? (
de¡
) \

77 : (((
n
) % 4 == 0) \

78 ? 
	`__memıy_by4
 (
de¡
, 
¤c
, 
n
) \

79 : (((
n
) % 2 == 0) \

80 ? 
	`__memıy_by2
 (
de¡
, 
¤c
, 
n
) \

81 : 
	`__memıy_g
 (
de¡
, 
¤c
, 
n
))))

	)

83 
__STRING_INLINE
 *
__memıy_by4
 (*
__de¡
, cÚ¡ *
__¤c
,

84 
size_t
 
__n
);

86 
__STRING_INLINE
 *

87 
	$__memıy_by4
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

89 
__d0
, 
__d1
;

90 *
__tmp
 = 
__de¡
;

91 
__asm__
 
__vŞ©e__


99 : "=&r" (
__d0
), "=&r" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
)

100 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__n
 / 4)

102  
__de¡
;

103 
	}
}

105 
__STRING_INLINE
 *
__memıy_by2
 (*
__de¡
, cÚ¡ *
__¤c
,

106 
size_t
 
__n
);

108 
__STRING_INLINE
 *

109 
	$__memıy_by2
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

111 
__d0
, 
__d1
;

112 *
__tmp
 = 
__de¡
;

113 
__asm__
 
__vŞ©e__


126 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
)

127 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__n
 / 2)

129  
__de¡
;

130 
	}
}

132 
__STRING_INLINE
 *
__memıy_g
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
);

134 
__STRING_INLINE
 *

135 
	$__memıy_g
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

137 
__d0
, 
__d1
, 
__d2
;

138 *
__tmp
 = 
__de¡
;

139 
__asm__
 
__vŞ©e__


150 : "=&c" (
__d0
), "=&D" (
__d1
), "=&S" (
__d2
),

151 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__de¡
)

152 : "0" (
__n
), "1" (
__tmp
), "2" (
__¤c
),

153 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__¤c
)

155  
__de¡
;

156 
	}
}

158 
	#_HAVE_STRING_ARCH_memmove
 1

	)

159 #iâdeà
_FORCE_INLINES


162 
	#memmove
(
de¡
, 
¤c
, 
n
è
	`__memmove_g
 (de¡, src,‚)

	)

164 
__STRING_INLINE
 *
	$__memmove_g
 (*, cÚ¡ *, 
size_t
)

165 
	`__asm__
 ("memmove");

167 
__STRING_INLINE
 *

168 
	$__memmove_g
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

170 
__d0
, 
__d1
, 
__d2
;

171 *
__tmp
 = 
__de¡
;

172 ià(
__de¡
 < 
__¤c
)

173 
__asm__
 
__vŞ©e__


176 : "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
),

177 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__de¡
)

178 : "0" (
__n
), "1" (
__¤c
), "2" (
__tmp
),

179 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__¤c
));

181 
__asm__
 
__vŞ©e__


187 : "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
),

188 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__de¡
)

189 : "0" (
__n
), "1" (__À+ (cÚ¡ *è
__¤c
),

190 "2" (
__n
 + (*è
__tmp
),

191 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__¤c
));

192  
__de¡
;

193 
	}
}

197 
	#_HAVE_STRING_ARCH_memcmp
 1

	)

198 #iâdeà
_FORCE_INLINES


199 #iâdeà
__PIC__


201 
__STRING_INLINE
 

202 
	$memcmp
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

204 
__d0
, 
__d1
, 
__d2
;

205 
__»s
;

206 
__asm__
 
__vŞ©e__


214 : "=&a" (
__»s
), "=&S" (
__d0
), "=&D" (
__d1
), "=&c" (
__d2
)

215 : "0" (0), "1" (
__s1
), "2" (
__s2
), "3" (
__n
),

216 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s1
),

217 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s2
)

219  
__»s
;

220 
	}
}

225 
	#_HAVE_STRING_ARCH_mem£t
 1

	)

226 
	#_USE_STRING_ARCH_mem£t
 1

	)

227 
	#mem£t
(
s
, 
c
, 
n
) \

228 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) && (n) <= 16 \

229 ? ((
n
) == 1 \

230 ? 
	`__mem£t_c1
 ((
s
), (
c
)) \

231 : 
	`__mem£t_gc
 ((
s
), (
c
), (
n
))) \

232 : (
	`__butš_cÚ¡ªt_p
 (
c
) \

233 ? (
	`__butš_cÚ¡ªt_p
 (
n
) \

234 ? 
	`__mem£t_cú
 ((
s
), (
c
), (
n
)) \

235 : 
	`mem£t
 ((
s
), (
c
), (
n
))) \

236 : (
	`__butš_cÚ¡ªt_p
 (
n
) \

237 ? 
	`__mem£t_gú
 ((
s
), (
c
), (
n
)) \

238 : 
	`mem£t
 ((
s
), (
c
), (
n
))))))

	)

240 
	#__mem£t_c1
(
s
, 
c
è({ *
__s
 = (s); \

241 *((*è
__s
èğ(è(
c
); \

242 
__s
; })

	)

244 
	#__mem£t_gc
(
s
, 
c
, 
n
) \

245 ({ *
__s
 = (
s
); \

247 
__ui
; \

248 
__usi
; \

249 
__uc
; \

250 } *
__u
 = 
__s
; \

251 
__c
 = ((è((è(
c
))) * 0x01010101; \

257 ià((
n
) == 3 || (n) >= 5) \

258 
__asm__
 
	`__vŞ©e__
 ("" : "ô" (
__c
) : "0" (__c)); \

261 
n
) \

264 
__u
->
__ui
 = 
__c
; \

265 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

267 
__u
->
__ui
 = 
__c
; \

268 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

270 
__u
->
__ui
 = 
__c
; \

271 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

273 
__u
->
__usi
 = (è
__c
; \

274 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

275 
__u
->
__uc
 = (è
__c
; \

279 
__u
->
__ui
 = 
__c
; \

280 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

282 
__u
->
__ui
 = 
__c
; \

283 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

285 
__u
->
__ui
 = 
__c
; \

286 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

288 
__u
->
__usi
 = (è
__c
; \

292 
__u
->
__ui
 = 
__c
; \

293 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

295 
__u
->
__ui
 = 
__c
; \

296 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

298 
__u
->
__ui
 = 
__c
; \

299 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

301 
__u
->
__uc
 = (è
__c
; \

305 
__u
->
__ui
 = 
__c
; \

306 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

308 
__u
->
__ui
 = 
__c
; \

309 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

311 
__u
->
__ui
 = 
__c
; \

312 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

314 
__u
->
__ui
 = 
__c
; \

319 
__s
; })

	)

321 
	#__mem£t_cú
(
s
, 
c
, 
n
) \

322 (((
n
) % 4 == 0) \

323 ? 
	`__mem£t_cú_by4
 (
s
, ((è((è(
c
))) * 0x01010101,\

324 
n
) \

325 : (((
n
) % 2 == 0) \

326 ? 
	`__mem£t_cú_by2
 (
s
, \

327 ((è((è(
c
))) * 0x01010101,\

328 
n
) \

329 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

331 
__STRING_INLINE
 *
__mem£t_cú_by4
 (*
__s
, 
__c
,

332 
size_t
 
__n
);

334 
__STRING_INLINE
 *

335 
	$__mem£t_cú_by4
 (*
__s
, 
__c
, 
size_t
 
__n
)

337 *
__tmp
 = 
__s
;

338 
__d0
;

339 #ifdeà
__i686__


340 
__asm__
 
__vŞ©e__


343 : "=&a" (
__c
), "=&D" (
__tmp
), "=&c" (
__d0
),

344 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

345 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

348 
__asm__
 
__vŞ©e__


354 : "=&r" (
__c
), "=&r" (
__tmp
), "=&r" (
__d0
),

355 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

356 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

359  
__s
;

360 
	}
}

362 
__STRING_INLINE
 *
__mem£t_cú_by2
 (*
__s
, 
__c
,

363 
size_t
 
__n
);

365 
__STRING_INLINE
 *

366 
	$__mem£t_cú_by2
 (*
__s
, 
__c
, 
size_t
 
__n
)

368 
__d0
, 
__d1
;

369 *
__tmp
 = 
__s
;

370 #ifdeà
__i686__


371 
__asm__
 
__vŞ©e__


375 : "=&a" (
__d0
), "=&D" (
__tmp
), "=&c" (
__d1
),

376 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

377 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

380 
__asm__
 
__vŞ©e__


386 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__d1
),

387 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

388 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

391  
__s
;

392 
	}
}

394 
	#__mem£t_gú
(
s
, 
c
, 
n
) \

395 (((
n
) % 4 == 0) \

396 ? 
	`__mem£t_gú_by4
 (
s
, 
c
, 
n
) \

397 : (((
n
) % 2 == 0) \

398 ? 
	`__mem£t_gú_by2
 (
s
, 
c
, 
n
) \

399 : 
	`mem£t
 (
s
, 
c
, 
n
)))

	)

401 
__STRING_INLINE
 *
__mem£t_gú_by4
 (*
__s
, 
__c
, 
size_t
 
__n
);

403 
__STRING_INLINE
 *

404 
	$__mem£t_gú_by4
 (*
__s
, 
__c
, 
size_t
 
__n
)

406 *
__tmp
 = 
__s
;

407 
__d0
;

408 
__asm__
 
__vŞ©e__


418 : "=&q" (
__c
), "=&r" (
__tmp
), "=&r" (
__d0
),

419 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

420 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

422  
__s
;

423 
	}
}

425 
__STRING_INLINE
 *
__mem£t_gú_by2
 (*
__s
, 
__c
, 
size_t
 
__n
);

427 
__STRING_INLINE
 *

428 
	$__mem£t_gú_by2
 (*
__s
, 
__c
, 
size_t
 
__n
)

430 
__d0
, 
__d1
;

431 *
__tmp
 = 
__s
;

432 
__asm__
 
__vŞ©e__


443 : "=&q" (
__d0
), "=&r" (
__tmp
), "=&r" (
__d1
),

444 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

445 : "0" ((è
__c
), "1" (
__tmp
), "2" (
__n
 / 4)

447  
__s
;

448 
	}
}

452 
	#_HAVE_STRING_ARCH_memchr
 1

	)

453 #iâdeà
_FORCE_INLINES


454 
__STRING_INLINE
 *

455 
	$memchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

457 
__d0
;

458 #ifdeà
__i686__


459 
__d1
;

461 *
__»s
;

462 ià(
__n
 == 0)

463  
NULL
;

464 #ifdeà
__i686__


465 
__asm__
 
__vŞ©e__


469 : "=D" (
__»s
), "=&c" (
__d0
), "=&r" (
__d1
)

470 : "a" (
__c
), "0" (
__s
), "1" (
__n
), "2" (1),

471 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

474 
__asm__
 
__vŞ©e__


480 : "=D" (
__»s
), "=&c" (
__d0
)

481 : "a" (
__c
), "0" (
__s
), "1" (
__n
),

482 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

485  
__»s
 - 1;

486 
	}
}

489 
	#_HAVE_STRING_ARCH_memrchr
 1

	)

490 #iâdeà
_FORCE_INLINES


491 
__STRING_INLINE
 *
__memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
);

493 
__STRING_INLINE
 *

494 
	$__memrchr
 (cÚ¡ *
__s
, 
__c
, 
size_t
 
__n
)

496 
__d0
;

497 #ifdeà
__i686__


498 
__d1
;

500 *
__»s
;

501 ià(
__n
 == 0)

502  
NULL
;

503 #ifdeà
__i686__


504 
__asm__
 
__vŞ©e__


510 : "=D" (
__»s
), "=&c" (
__d0
), "=&r" (
__d1
)

511 : "a" (
__c
), "0" (
__s
 + 
__n
 - 1), "1" (__n), "2" (-1),

512 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

515 
__asm__
 
__vŞ©e__


522 : "=D" (
__»s
), "=&c" (
__d0
)

523 : "a" (
__c
), "0" (
__s
 + 
__n
 - 1), "1" (__n),

524 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s
)

527  
__»s
;

528 
	}
}

529 #ifdeà
__USE_GNU


530 
	#memrchr
(
s
, 
c
, 
n
è
	`__memrchr
 ((s), (c), (n))

	)

535 
	#_HAVE_STRING_ARCH_¿wmemchr
 1

	)

536 
__STRING_INLINE
 *
__¿wmemchr
 (cÚ¡ *
__s
, 
__c
);

538 #iâdeà
_FORCE_INLINES


539 
__STRING_INLINE
 *

540 
	$__¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

542 
__d0
;

543 *
__»s
;

544 
__asm__
 
__vŞ©e__


547 : "=D" (
__»s
), "=&c" (
__d0
)

548 : "a" (
__c
), "0" (
__s
), "1" (0xffffffff),

549 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

551  
__»s
 - 1;

552 
	}
}

553 #ifdeà
__USE_GNU


554 
__STRING_INLINE
 *

555 
	$¿wmemchr
 (cÚ¡ *
__s
, 
__c
)

557  
	`__¿wmemchr
 (
__s
, 
__c
);

558 
	}
}

564 
	#_HAVE_STRING_ARCH_¡¾’
 1

	)

565 
	#¡¾’
(
¡r
) \

566 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¡r
) \

567 ? 
	`__butš_¡¾’
 (
¡r
) \

568 : 
	`__¡¾’_g
 (
¡r
)))

	)

569 
__STRING_INLINE
 
size_t
 
__¡¾’_g
 (cÚ¡ *
__¡r
);

571 
__STRING_INLINE
 
size_t


572 
	$__¡¾’_g
 (cÚ¡ *
__¡r
)

574 
__dummy
;

575 cÚ¡ *
__tmp
 = 
__¡r
;

576 
__asm__
 
__vŞ©e__


582 : "ô" (
__tmp
), "=&q" (
__dummy
)

583 : "0" (
__¡r
),

584 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¡r
)

586  
__tmp
 - 
__¡r
 - 1;

587 
	}
}

591 
	#_HAVE_STRING_ARCH_¡rıy
 1

	)

592 
	#¡rıy
(
de¡
, 
¤c
) \

593 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

594 ? ( ((
¤c
)[0]è=ğ1 && 
	`¡¾’
 (src) + 1 <= 8 \

595 ? 
	`__¡rıy_a_sm®l
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1) \

596 : (*è
	`memıy
 ((*è(
de¡
), \

597 (cÚ¡ *è(
¤c
), \

598 
	`¡¾’
 (
¤c
) + 1)) \

599 : 
	`__¡rıy_g
 ((
de¡
), (
¤c
))))

	)

601 
	#__¡rıy_a_sm®l
(
de¡
, 
¤c
, 
¤ş’
) \

602 (
	`__ex‹nsiÚ__
 ({ *
__de¡
 = (
de¡
); \

604 
__ui
; \

605 
__usi
; \

606 
__uc
; \

607 
__c
; \

608 } *
__u
 = (*è
__de¡
; \

609 
¤ş’
) \

612 
__u
->
__uc
 = '\0'; \

615 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

618 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

619 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

620 
__u
->
__uc
 = '\0'; \

623 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

626 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

627 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

628 
__u
->
__uc
 = '\0'; \

631 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

632 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

633 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

636 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

637 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

638 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

639 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

640 
__u
->
__uc
 = '\0'; \

643 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

644 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

645 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 4); \

648 (*è
__de¡
; }))

	)

650 
__STRING_INLINE
 *
__¡rıy_g
 (*
__de¡
, cÚ¡ *
__¤c
);

652 
__STRING_INLINE
 *

653 
	$__¡rıy_g
 (*
__de¡
, cÚ¡ *
__¤c
)

655 *
__tmp
 = 
__de¡
;

656 
__dummy
;

657 
__asm__
 
__vŞ©e__


666 : "=&r" (
__¤c
), "=&r" (
__tmp
), "=&q" (
__dummy
),

667 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

668 : "0" (
__¤c
), "1" (
__tmp
),

669 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¤c
)

671  
__de¡
;

672 
	}
}

675 #ifdeà
__USE_GNU


676 
	#_HAVE_STRING_ARCH_¡pıy
 1

	)

678 
	#__¡pıy
(
de¡
, 
¤c
) \

679 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

680 ? (
	`¡¾’
 (
¤c
) + 1 <= 8 \

681 ? 
	`__¡pıy_a_sm®l
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1) \

682 : 
	`__¡pıy_c
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1)) \

683 : 
	`__¡pıy_g
 ((
de¡
), (
¤c
))))

	)

684 
	#__¡pıy_c
(
de¡
, 
¤c
, 
¤ş’
) \

685 ((
¤ş’
) % 4 == 0 \

686 ? 
	`__mempıy_by4
 (
de¡
, 
¤c
, 
¤ş’
) - 1 \

687 : ((
¤ş’
) % 2 == 0 \

688 ? 
	`__mempıy_by2
 (
de¡
, 
¤c
, 
¤ş’
) - 1 \

689 : 
	`__mempıy_byn
 (
de¡
, 
¤c
, 
¤ş’
è- 1))

	)

692 
	#¡pıy
(
de¡
, 
¤c
è
	`__¡pıy
 ((de¡), (¤c))

	)

694 
	#__¡pıy_a_sm®l
(
de¡
, 
¤c
, 
¤ş’
) \

695 (
	`__ex‹nsiÚ__
 ({ union { \

696 
__ui
; \

697 
__usi
; \

698 
__uc
; \

699 
__c
; \

700 } *
__u
 = (*è(
de¡
); \

701 
¤ş’
) \

704 
__u
->
__uc
 = '\0'; \

707 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

708 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1); \

711 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 0); \

712 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

713 
__u
->
__uc
 = '\0'; \

716 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

717 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3); \

720 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

721 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

722 
__u
->
__uc
 = '\0'; \

725 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

726 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

727 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

728 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 1); \

731 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

732 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

733 
__u
->
__usi
 = 
	`__STRING_SMALL_GET16
 (
¤c
, 4); \

734 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 2); \

735 
__u
->
__uc
 = '\0'; \

738 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 0); \

739 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 4); \

740 
__u
->
__ui
 = 
	`__STRING_SMALL_GET32
 (
¤c
, 4); \

741 
__u
 = 
	`__ex‹nsiÚ__
 ((*) __u + 3); \

744 (*è
__u
; }))

	)

746 
__STRING_INLINE
 *
__mempıy_by4
 (*
__de¡
, cÚ¡ *
__¤c
,

747 
size_t
 
__¤ş’
);

749 
__STRING_INLINE
 *

750 
	$__mempıy_by4
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__¤ş’
)

752 *
__tmp
 = 
__de¡
;

753 
__d0
, 
__d1
;

754 
__asm__
 
__vŞ©e__


762 : "=&r" (
__d0
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
)

763 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤ş’
 / 4)

765  
__tmp
;

766 
	}
}

768 
__STRING_INLINE
 *
__mempıy_by2
 (*
__de¡
, cÚ¡ *
__¤c
,

769 
size_t
 
__¤ş’
);

771 
__STRING_INLINE
 *

772 
	$__mempıy_by2
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__¤ş’
)

774 *
__tmp
 = 
__de¡
;

775 
__d0
, 
__d1
;

776 
__asm__
 
__vŞ©e__


789 : "=&q" (
__d0
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__d1
),

790 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

791 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤ş’
 / 2),

792 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

794  
__tmp
 + 2;

795 
	}
}

797 
__STRING_INLINE
 *
__mempıy_byn
 (*
__de¡
, cÚ¡ *
__¤c
,

798 
size_t
 
__¤ş’
);

800 
__STRING_INLINE
 *

801 
	$__mempıy_byn
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__¤ş’
)

803 
__d0
, 
__d1
;

804 *
__tmp
 = 
__de¡
;

805 
__asm__
 
__vŞ©e__


816 : "=D" (
__tmp
), "=&c" (
__d0
), "=&S" (
__d1
),

817 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

818 : "0" (
__tmp
), "1" (
__¤ş’
), "2" (
__¤c
),

819 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

821  
__tmp
;

822 
	}
}

824 
__STRING_INLINE
 *
__¡pıy_g
 (*
__de¡
, cÚ¡ *
__¤c
);

826 
__STRING_INLINE
 *

827 
	$__¡pıy_g
 (*
__de¡
, cÚ¡ *
__¤c
)

829 *
__tmp
 = 
__de¡
;

830 
__dummy
;

831 
__asm__
 
__vŞ©e__


840 : "=&r" (
__¤c
), "ô" (
__tmp
), "=&q" (
__dummy
),

841 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

842 : "0" (
__¤c
), "1" (
__tmp
),

843 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¤c
)

845  
__tmp
 - 1;

846 
	}
}

851 
	#_HAVE_STRING_ARCH_¡ºıy
 1

	)

852 
	#¡ºıy
(
de¡
, 
¤c
, 
n
) \

853 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

854 ? ((
	`¡¾’
 (
¤c
è+ 1 >ğ((
size_t
è(
n
)) \

855 ? (*è
	`memıy
 ((*è(
de¡
), \

856 (cÚ¡ *è(
¤c
), 
n
) \

857 : 
	`__¡ºıy_cg
 ((
de¡
), (
¤c
), 
	`¡¾’
 (¤cè+ 1, 
n
))) \

858 : 
	`__¡ºıy_gg
 ((
de¡
), (
¤c
), 
n
)))

	)

859 
	#__¡ºıy_cg
(
de¡
, 
¤c
, 
¤ş’
, 
n
) \

860 (((
¤ş’
) % 4 == 0) \

861 ? 
	`__¡ºıy_by4
 (
de¡
, 
¤c
, 
¤ş’
, 
n
) \

862 : (((
¤ş’
) % 2 == 0) \

863 ? 
	`__¡ºıy_by2
 (
de¡
, 
¤c
, 
¤ş’
, 
n
) \

864 : 
	`__¡ºıy_byn
 (
de¡
, 
¤c
, 
¤ş’
, 
n
)))

	)

866 
__STRING_INLINE
 *
__¡ºıy_by4
 (*
__de¡
, cÚ¡ 
__¤c
[],

867 
size_t
 
__¤ş’
, size_ˆ
__n
);

869 
__STRING_INLINE
 *

870 
	$__¡ºıy_by4
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤ş’
, size_ˆ
__n
)

872 *
__tmp
 = 
__de¡
;

873 
__dummy1
, 
__dummy2
;

874 
__asm__
 
__vŞ©e__


882 : "=&r" (
__dummy1
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__dummy2
),

883 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

884 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤ş’
 / 4),

885 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

887 (è
	`mem£t
 (
__tmp
, '\0', 
__n
 - 
__¤ş’
);

888  
__de¡
;

889 
	}
}

891 
__STRING_INLINE
 *
__¡ºıy_by2
 (*
__de¡
, cÚ¡ 
__¤c
[],

892 
size_t
 
__¤ş’
, size_ˆ
__n
);

894 
__STRING_INLINE
 *

895 
	$__¡ºıy_by2
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤ş’
, size_ˆ
__n
)

897 *
__tmp
 = 
__de¡
;

898 
__dummy1
, 
__dummy2
;

899 
__asm__
 
__vŞ©e__


912 : "=&q" (
__dummy1
), "ô" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__dummy2
),

913 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

914 : "1" (
__tmp
), "2" (
__¤c
), "3" (
__¤ş’
 / 2),

915 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

917 (è
	`mem£t
 (
__tmp
 + 2, '\0', 
__n
 - 
__¤ş’
);

918  
__de¡
;

919 
	}
}

921 
__STRING_INLINE
 *
__¡ºıy_byn
 (*
__de¡
, cÚ¡ 
__¤c
[],

922 
size_t
 
__¤ş’
, size_ˆ
__n
);

924 
__STRING_INLINE
 *

925 
	$__¡ºıy_byn
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤ş’
, size_ˆ
__n
)

927 
__d0
, 
__d1
;

928 *
__tmp
 = 
__de¡
;

929 
__asm__
 
__vŞ©e__


940 : "=D" (
__tmp
), "=&c" (
__d0
), "=&S" (
__d1
),

941 "=m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__de¡
)

942 : "1" (
__¤ş’
), "0" (
__tmp
),"2" (
__¤c
),

943 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

945 (è
	`mem£t
 (
__tmp
, '\0', 
__n
 - 
__¤ş’
);

946  
__de¡
;

947 
	}
}

949 
__STRING_INLINE
 *
__¡ºıy_gg
 (*
__de¡
, cÚ¡ *
__¤c
,

950 
size_t
 
__n
);

952 
__STRING_INLINE
 *

953 
	$__¡ºıy_gg
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
)

955 *
__tmp
 = 
__de¡
;

956 
__dummy
;

957 ià(
__n
 > 0)

958 
__asm__
 
__vŞ©e__


974 : "=&r" (
__¤c
), "=&r" (
__tmp
), "=&q" (
__dummy
), "=&r" (
__n
)

975 : "0" (
__¤c
), "1" (
__tmp
), "3" (
__n
)

978  
__de¡
;

979 
	}
}

983 
	#_HAVE_STRING_ARCH_¡rÿt
 1

	)

984 
	#¡rÿt
(
de¡
, 
¤c
) \

985 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
¤c
) \

986 ? 
	`__¡rÿt_c
 ((
de¡
), (
¤c
), 
	`¡¾’
 (src) + 1) \

987 : 
	`__¡rÿt_g
 ((
de¡
), (
¤c
))))

	)

989 
__STRING_INLINE
 *
__¡rÿt_c
 (*
__de¡
, cÚ¡ 
__¤c
[],

990 
size_t
 
__¤ş’
);

992 
__STRING_INLINE
 *

993 
	$__¡rÿt_c
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__¤ş’
)

995 #ifdeà
__i686__


996 
__d0
;

997 *
__tmp
;

998 
__asm__
 
__vŞ©e__


1000 : "=D" (
__tmp
), "=&c" (
__d0
),

1001 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

1002 : "0" (
__de¡
), "1" (0xffffffff), "a" (0),

1003 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

1005 --
__tmp
;

1007 *
__tmp
 = 
__de¡
;

1008 
__asm__
 
__vŞ©e__


1014 : "ô" (
__tmp
),

1015 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

1016 : "0" (
__tmp
),

1017 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__¤ş’
]; } *)
__¤c
)

1020 (è
	`memıy
 (
__tmp
, 
__¤c
, 
__¤ş’
);

1021  
__de¡
;

1022 
	}
}

1024 
__STRING_INLINE
 *
__¡rÿt_g
 (*
__de¡
, cÚ¡ *
__¤c
);

1026 
__STRING_INLINE
 *

1027 
	$__¡rÿt_g
 (*
__de¡
, cÚ¡ *
__¤c
)

1029 *
__tmp
 = 
__de¡
;

1030 
__dummy
;

1031 
__asm__
 
__vŞ©e__


1044 : "=&q" (
__dummy
), "=&r" (
__tmp
), "=&r" (
__¤c
),

1045 "=m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__de¡
)

1046 : "1" (
__tmp
), "2" (
__¤c
),

1047 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__¤c
)

1049  
__de¡
;

1050 
	}
}

1054 
	#_HAVE_STRING_ARCH_¡ºÿt
 1

	)

1055 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

1056 (
	`__ex‹nsiÚ__
 ({ *
__de¡
 = (
de¡
); \

1057 
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

1058 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

1059 ? 
	`¡rÿt
 (
__de¡
, (
¤c
)) \

1060 : (*(*)
	`__mempıy
 (
	`¡rchr
 (
__de¡
, '\0'), \

1061 (cÚ¡ *è(
¤c
), \

1062 (
n
)èğ0, 
__de¡
)) \

1063 : 
	`__¡ºÿt_g
 (
__de¡
, (
¤c
), (
n
)); }))

	)

1065 
__STRING_INLINE
 *
__¡ºÿt_g
 (*
__de¡
, cÚ¡ 
__¤c
[],

1066 
size_t
 
__n
);

1068 
__STRING_INLINE
 *

1069 
	$__¡ºÿt_g
 (*
__de¡
, cÚ¡ 
__¤c
[], 
size_t
 
__n
)

1071 *
__tmp
 = 
__de¡
;

1072 
__dummy
;

1073 #ifdeà
__i686__


1074 
__asm__
 
__vŞ©e__


1088 : "=&a" (
__dummy
), "=&D" (
__tmp
), "=&S" (
__¤c
), "=&c" (
__n
)

1089 : "g" (
__n
), "0" (0), "1" (
__tmp
), "2" (
__¤c
), "3" (0xffffffff)

1092 
__asm__
 
__vŞ©e__


1109 : "=&q" (
__dummy
), "=&r" (
__tmp
), "=&r" (
__¤c
), "=&r" (
__n
)

1110 : "1" ((è
__tmp
 - 1), "2" (
__¤c
), "3" (
__n
)

1113  
__de¡
;

1114 
	}
}

1118 
	#_HAVE_STRING_ARCH_¡rcmp
 1

	)

1119 
	#¡rcmp
(
s1
, 
s2
) \

1120 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& __butš_cÚ¡ªt_°(
s2
) \

1121 && ( ((
s1
)[0]è!ğ1 || 
	`¡¾’
 (s1) >= 4) \

1122 && ( ((
s2
)[0]è!ğ1 || 
	`¡¾’
 (s2) >= 4) \

1123 ? 
	`memcmp
 ((cÚ¡ *è(
s1
), (cÚ¡ *è(
s2
), \

1124 (
	`¡¾’
 (
s1
è< sŒËÀ(
s2
) \

1125 ? 
	`¡¾’
 (
s1
è: sŒËÀ(
s2
)) + 1) \

1126 : (
	`__butš_cÚ¡ªt_p
 (
s1
) &&  ((s1)[0]) == 1 \

1127 &&  ((
s2
)[0]è=ğ1 && 
	`¡¾’
 (
s1
) < 4 \

1128 ? (
	`__butš_cÚ¡ªt_p
 (
s2
) &&  ((s2)[0]) == 1 \

1129 ? 
	`__¡rcmp_cc
 ((cÚ¡ *è(
s1
), \

1130 (cÚ¡ *è(
s2
), \

1131 
	`¡¾’
 (
s1
)) \

1132 : 
	`__¡rcmp_cg
 ((cÚ¡ *è(
s1
), \

1133 (cÚ¡ *è(
s2
), \

1134 
	`¡¾’
 (
s1
))) \

1135 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&&  ((
s1
)[0]) == 1 \

1136 &&  ((
s2
)[0]è=ğ1 && 
	`¡¾’
 (s2) < 4 \

1137 ? (
	`__butš_cÚ¡ªt_p
 (
s1
) \

1138 ? 
	`__¡rcmp_cc
 ((cÚ¡ *è(
s1
), \

1139 (cÚ¡ *è(
s2
), \

1140 
	`¡¾’
 (
s2
)) \

1141 : 
	`__¡rcmp_gc
 ((cÚ¡ *è(
s1
), \

1142 (cÚ¡ *è(
s2
), \

1143 
	`¡¾’
 (
s2
))) \

1144 : 
	`__¡rcmp_gg
 ((
s1
), (
s2
))))))

	)

1146 
	#__¡rcmp_cc
(
s1
, 
s2
, 
l
) \

1147 (
	`__ex‹nsiÚ__
 ({ 
__»suÉ
 = (
s1
)[0] - (
s2
)[0]; \

1148 ià(
l
 > 0 && 
__»suÉ
 == 0) \

1150 
__»suÉ
 = (
s1
)[1] - (
s2
)[1]; \

1151 ià(
l
 > 1 && 
__»suÉ
 == 0) \

1153 
__»suÉ
 = (
s1
)[2] - (
s2
)[2]; \

1154 ià(
l
 > 2 && 
__»suÉ
 == 0) \

1155 
__»suÉ
 = (
s1
)[3] - (
s2
)[3]; \

1158 
__»suÉ
; }))

	)

1160 
	#__¡rcmp_cg
(
s1
, 
s2
, 
l1
) \

1161 (
	`__ex‹nsiÚ__
 ({ cÚ¡ *
__s2
 = (
s2
); \

1162 
__»suÉ
 = (
s1
)[0] - 
__s2
[0]; \

1163 ià(
l1
 > 0 && 
__»suÉ
 == 0) \

1165 
__»suÉ
 = (
s1
)[1] - 
__s2
[1]; \

1166 ià(
l1
 > 1 && 
__»suÉ
 == 0) \

1168 
__»suÉ
 = (
s1
)[2] - 
__s2
[2]; \

1169 ià(
l1
 > 2 && 
__»suÉ
 == 0) \

1170 
__»suÉ
 = (
s1
)[3] - 
__s2
[3]; \

1173 
__»suÉ
; }))

	)

1175 
	#__¡rcmp_gc
(
s1
, 
s2
, 
l2
) \

1176 (
	`__ex‹nsiÚ__
 ({ cÚ¡ *
__s1
 = (
s1
); \

1177 
__»suÉ
 = 
__s1
[0] - (
s2
)[0]; \

1178 ià(
l2
 > 0 && 
__»suÉ
 == 0) \

1180 
__»suÉ
 = 
__s1
[1] - (
s2
)[1]; \

1181 ià(
l2
 > 1 && 
__»suÉ
 == 0) \

1183 
__»suÉ
 = 
__s1
[2] - (
s2
)[2]; \

1184 ià(
l2
 > 2 && 
__»suÉ
 == 0) \

1185 
__»suÉ
 = 
__s1
[3] - (
s2
)[3]; \

1188 
__»suÉ
; }))

	)

1190 
__STRING_INLINE
 
__¡rcmp_gg
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
);

1192 
__STRING_INLINE
 

1193 
	$__¡rcmp_gg
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
)

1195 
__»s
;

1196 
__asm__
 
__vŞ©e__


1212 : "=q" (
__»s
), "=&r" (
__s1
), "=&r" (
__s2
)

1213 : "1" (
__s1
), "2" (
__s2
),

1214 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s1
),

1215 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s2
)

1217  
__»s
;

1218 
	}
}

1222 
	#_HAVE_STRING_ARCH_¡ºcmp
 1

	)

1223 
	#¡ºcmp
(
s1
, 
s2
, 
n
) \

1224 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`¡¾’
 (s1è< ((
size_t
è(
n
)) \

1225 ? 
	`¡rcmp
 ((
s1
), (
s2
)) \

1226 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`¡¾’
 (s2è< ((
size_t
è(
n
))\

1227 ? 
	`¡rcmp
 ((
s1
), (
s2
)) \

1228 : 
	`__¡ºcmp_g
 ((
s1
), (
s2
), (
n
)))))

	)

1230 
__STRING_INLINE
 
__¡ºcmp_g
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
,

1231 
size_t
 
__n
);

1233 
__STRING_INLINE
 

1234 
	$__¡ºcmp_g
 (cÚ¡ *
__s1
, cÚ¡ *
__s2
, 
size_t
 
__n
)

1236 
__»s
;

1237 
__asm__
 
__vŞ©e__


1256 : "=q" (
__»s
), "=&r" (
__s1
), "=&r" (
__s2
), "=&r" (
__n
)

1257 : "1" (
__s1
), "2" (
__s2
), "3" (
__n
),

1258 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s1
),

1259 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__n
]; } *)
__s2
)

1261  
__»s
;

1262 
	}
}

1266 
	#_HAVE_STRING_ARCH_¡rchr
 1

	)

1267 
	#_USE_STRING_ARCH_¡rchr
 1

	)

1268 
	#¡rchr
(
s
, 
c
) \

1269 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1270 ? ((
c
) == '\0' \

1271 ? (*è
	`__¿wmemchr
 ((
s
), (
c
)) \

1272 : 
	`__¡rchr_c
 ((
s
), ((
c
) & 0xff) << 8)) \

1273 : 
	`__¡rchr_g
 ((
s
), (
c
))))

	)

1275 
__STRING_INLINE
 *
__¡rchr_c
 (cÚ¡ *
__s
, 
__c
);

1277 
__STRING_INLINE
 *

1278 
	$__¡rchr_c
 (cÚ¡ *
__s
, 
__c
)

1280 
__d0
;

1281 *
__»s
;

1282 
__asm__
 
__vŞ©e__


1292 : "ô" (
__»s
), "=&a" (
__d0
)

1293 : "0" (
__s
), "1" (
__c
),

1294 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1296  
__»s
;

1297 
	}
}

1299 
__STRING_INLINE
 *
__¡rchr_g
 (cÚ¡ *
__s
, 
__c
);

1301 
__STRING_INLINE
 *

1302 
	$__¡rchr_g
 (cÚ¡ *
__s
, 
__c
)

1304 
__d0
;

1305 *
__»s
;

1306 
__asm__
 
__vŞ©e__


1317 : "ô" (
__»s
), "=&a" (
__d0
)

1318 : "0" (
__s
), "1" (
__c
),

1319 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1321  
__»s
;

1322 
	}
}

1326 
	#_HAVE_STRING_ARCH_¡rchºul
 1

	)

1327 
	#__¡rchºul
(
s
, 
c
) \

1328 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1329 ? ((
c
) == '\0' \

1330 ? (*è
	`__¿wmemchr
 ((
s
), 
c
) \

1331 : 
	`__¡rchºul_c
 ((
s
), ((
c
) & 0xff) << 8)) \

1332 : 
	`__¡rchºul_g
 ((
s
), 
c
)))

	)

1334 
__STRING_INLINE
 *
__¡rchºul_c
 (cÚ¡ *
__s
, 
__c
);

1336 
__STRING_INLINE
 *

1337 
	$__¡rchºul_c
 (cÚ¡ *
__s
, 
__c
)

1339 
__d0
;

1340 *
__»s
;

1341 
__asm__
 
__vŞ©e__


1351 : "ô" (
__»s
), "=&a" (
__d0
)

1352 : "0" (
__s
), "1" (
__c
),

1353 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1355  
__»s
;

1356 
	}
}

1358 
__STRING_INLINE
 *
__¡rchºul_g
 (cÚ¡ *
__s
, 
__c
);

1360 
__STRING_INLINE
 *

1361 
	$__¡rchºul_g
 (cÚ¡ *
__s
, 
__c
)

1363 
__d0
;

1364 *
__»s
;

1365 
__asm__
 
__vŞ©e__


1376 : "ô" (
__»s
), "=&a" (
__d0
)

1377 : "0" (
__s
), "1" (
__c
),

1378 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1380  
__»s
;

1381 
	}
}

1382 #ifdeà
__USE_GNU


1383 
	#¡rchºul
(
s
, 
c
è
	`__¡rchºul
 ((s), (c))

	)

1387 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


1389 
	#_HAVE_STRING_ARCH_šdex
 1

	)

1390 
	#šdex
(
s
, 
c
) \

1391 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1392 ? 
	`__¡rchr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1393 : 
	`__¡rchr_g
 ((
s
), (
c
))))

	)

1398 
	#_HAVE_STRING_ARCH_¡¼chr
 1

	)

1399 
	#¡¼chr
(
s
, 
c
) \

1400 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1401 ? 
	`__¡¼chr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1402 : 
	`__¡¼chr_g
 ((
s
), (
c
))))

	)

1404 #ifdeà
__i686__


1405 
__STRING_INLINE
 *
__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
);

1407 
__STRING_INLINE
 *

1408 
	$__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
)

1410 
__d0
, 
__d1
;

1411 *
__»s
;

1412 
__asm__
 
__vŞ©e__


1420 : "=d" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1421 : "0" (1), "1" (
__s
), "2" (
__c
),

1422 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1424  
__»s
 - 1;

1425 
	}
}

1427 
__STRING_INLINE
 *
__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
);

1429 
__STRING_INLINE
 *

1430 
	$__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
)

1432 
__d0
, 
__d1
;

1433 *
__»s
;

1434 
__asm__
 
__vŞ©e__


1443 : "=d" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1444 : "0" (1), "1" (
__s
), "2" (
__c
),

1445 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1447  
__»s
 - 1;

1448 
	}
}

1450 
__STRING_INLINE
 *
__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
);

1452 
__STRING_INLINE
 *

1453 
	$__¡¼chr_c
 (cÚ¡ *
__s
, 
__c
)

1455 
__d0
, 
__d1
;

1456 *
__»s
;

1457 
__asm__
 
__vŞ©e__


1467 : "=d" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1468 : "0" (0), "1" (
__s
), "2" (
__c
),

1469 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1471  
__»s
;

1472 
	}
}

1474 
__STRING_INLINE
 *
__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
);

1476 
__STRING_INLINE
 *

1477 
	$__¡¼chr_g
 (cÚ¡ *
__s
, 
__c
)

1479 
__d0
, 
__d1
;

1480 *
__»s
;

1481 
__asm__
 
__vŞ©e__


1492 : "ô" (
__»s
), "=&S" (
__d0
), "=&a" (
__d1
)

1493 : "0" (0), "1" (
__s
), "2" (
__c
),

1494 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1496  
__»s
;

1497 
	}
}

1501 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


1503 
	#_HAVE_STRING_ARCH_ršdex
 1

	)

1504 
	#ršdex
(
s
, 
c
) \

1505 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
) \

1506 ? 
	`__¡¼chr_c
 ((
s
), ((
c
) & 0xff) << 8) \

1507 : 
	`__¡¼chr_g
 ((
s
), (
c
))))

	)

1513 
	#_HAVE_STRING_ARCH_¡rc¥n
 1

	)

1514 
	#¡rc¥n
(
s
, 
»jeù
) \

1515 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
»jeù
) &&  ((reject)[0]) == 1 \

1516 ? ((
»jeù
)[0] == '\0' \

1517 ? 
	`¡¾’
 (
s
) \

1518 : ((
»jeù
)[1] == '\0' \

1519 ? 
	`__¡rc¥n_c1
 ((
s
), (((
»jeù
)[0] << 8) & 0xff00)) \

1520 : 
	`__¡rc¥n_cg
 ((
s
), (
»jeù
), 
	`¡¾’
 (reject)))) \

1521 : 
	`__¡rc¥n_g
 ((
s
), (
»jeù
))))

	)

1523 
__STRING_INLINE
 
size_t
 
__¡rc¥n_c1
 (cÚ¡ *
__s
, 
__»jeù
);

1525 #iâdeà
_FORCE_INLINES


1526 
__STRING_INLINE
 
size_t


1527 
	$__¡rc¥n_c1
 (cÚ¡ *
__s
, 
__»jeù
)

1529 
__d0
;

1530 *
__»s
;

1531 
__asm__
 
__vŞ©e__


1540 : "ô" (
__»s
), "=&a" (
__d0
)

1541 : "0" (
__s
), "1" (
__»jeù
),

1542 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1544  (
__»s
 - 1è- 
__s
;

1545 
	}
}

1548 
__STRING_INLINE
 
size_t
 
__¡rc¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__»jeù
[],

1549 
size_t
 
__»jeù_Ën
);

1551 
__STRING_INLINE
 
size_t


1552 
	$__¡rc¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__»jeù
[], 
size_t
 
__»jeù_Ën
)

1554 
__d0
, 
__d1
, 
__d2
;

1555 cÚ¡ *
__»s
;

1556 
__asm__
 
__vŞ©e__


1567 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1568 : "0" (
__s
), "d" (
__»jeù
), "g" (
__»jeù_Ën
)

1570  (
__»s
 - 1è- 
__s
;

1571 
	}
}

1573 
__STRING_INLINE
 
size_t
 
__¡rc¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
);

1574 #ifdeà
__PIC__


1576 
__STRING_INLINE
 
size_t


1577 
	$__¡rc¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

1579 
__d0
, 
__d1
, 
__d2
;

1580 cÚ¡ *
__»s
;

1581 
__asm__
 
__vŞ©e__


1598 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1599 : "r" (
__»jeù
), "0" (
__s
), "1" (0), "2" (0xffffffff)

1601  (
__»s
 - 1è- 
__s
;

1602 
	}
}

1604 
__STRING_INLINE
 
size_t


1605 
	$__¡rc¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__»jeù
)

1607 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1608 cÚ¡ *
__»s
;

1609 
__asm__
 
__vŞ©e__


1623 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1624 : "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (
__»jeù
), "b" (__reject)

1627  (
__»s
 - 1è- 
__s
;

1628 
	}
}

1634 
	#_HAVE_STRING_ARCH_¡r¥n
 1

	)

1635 
	#¡r¥n
(
s
, 
acû±
) \

1636 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
acû±
) &&  ((accept)[0]) == 1 \

1637 ? ((
acû±
)[0] == '\0' \

1638 ? ((è(
s
), 0) \

1639 : ((
acû±
)[1] == '\0' \

1640 ? 
	`__¡r¥n_c1
 ((
s
), (((
acû±
)[0] << 8 ) & 0xff00)) \

1641 : 
	`__¡r¥n_cg
 ((
s
), (
acû±
), 
	`¡¾’
 (accept)))) \

1642 : 
	`__¡r¥n_g
 ((
s
), (
acû±
))))

	)

1644 #iâdeà
_FORCE_INLINES


1645 
__STRING_INLINE
 
size_t
 
__¡r¥n_c1
 (cÚ¡ *
__s
, 
__acû±
);

1647 
__STRING_INLINE
 
size_t


1648 
	$__¡r¥n_c1
 (cÚ¡ *
__s
, 
__acû±
)

1650 
__d0
;

1651 *
__»s
;

1653 
__asm__
 
__vŞ©e__


1659 : "ô" (
__»s
), "=&q" (
__d0
)

1660 : "0" (
__s
), "1" (
__acû±
),

1661 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
)

1663  (
__»s
 - 1è- 
__s
;

1664 
	}
}

1667 
__STRING_INLINE
 
size_t
 
__¡r¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[],

1668 
size_t
 
__acû±_Ën
);

1670 
__STRING_INLINE
 
size_t


1671 
	$__¡r¥n_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[], 
size_t
 
__acû±_Ën
)

1673 
__d0
, 
__d1
, 
__d2
;

1674 cÚ¡ *
__»s
;

1675 
__asm__
 
__vŞ©e__


1686 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1687 : "0" (
__s
), "g" (
__acû±
), "g" (
__acû±_Ën
),

1690 "m" ( *(¡ruù { 
__x
[0xfffffff]; } *)
__s
),

1691 "m" ( *(¡ruù { 
__ex‹nsiÚ__
 
__x
[
__acû±_Ën
]; } *)
__acû±
)

1693  (
__»s
 - 1è- 
__s
;

1694 
	}
}

1696 
__STRING_INLINE
 
size_t
 
__¡r¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
);

1697 #ifdeà
__PIC__


1699 
__STRING_INLINE
 
size_t


1700 
	$__¡r¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1702 
__d0
, 
__d1
, 
__d2
;

1703 cÚ¡ *
__»s
;

1704 
__asm__
 
__vŞ©e__


1720 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1721 : "d" (
__acû±
), "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (__accept)

1723  (
__»s
 - 1è- 
__s
;

1724 
	}
}

1726 
__STRING_INLINE
 
size_t


1727 
	$__¡r¥n_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1729 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1730 cÚ¡ *
__»s
;

1731 
__asm__
 
__vŞ©e__


1745 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1746 : "0" (
__s
), "1" (0), "2" (0xffffffff), "3" (
__acû±
), "b" (__accept)

1748  (
__»s
 - 1è- 
__s
;

1749 
	}
}

1754 
	#_HAVE_STRING_ARCH_¡½brk
 1

	)

1755 
	#¡½brk
(
s
, 
acû±
) \

1756 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
acû±
) &&  ((accept)[0]) == 1 \

1757 ? ((
acû±
)[0] == '\0' \

1758 ? ((è(
s
), (*) 0) \

1759 : ((
acû±
)[1] == '\0' \

1760 ? 
	`¡rchr
 ((
s
), (
acû±
)[0]) \

1761 : 
	`__¡½brk_cg
 ((
s
), (
acû±
), 
	`¡¾’
 (accept)))) \

1762 : 
	`__¡½brk_g
 ((
s
), (
acû±
))))

	)

1764 
__STRING_INLINE
 *
__¡½brk_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[],

1765 
size_t
 
__acû±_Ën
);

1767 
__STRING_INLINE
 *

1768 
	$__¡½brk_cg
 (cÚ¡ *
__s
, cÚ¡ 
__acû±
[], 
size_t
 
__acû±_Ën
)

1770 
__d0
, 
__d1
, 
__d2
;

1771 *
__»s
;

1772 
__asm__
 
__vŞ©e__


1787 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1788 : "0" (
__s
), "d" (
__acû±
), "g" (
__acû±_Ën
)

1790  
__»s
;

1791 
	}
}

1793 
__STRING_INLINE
 *
__¡½brk_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
);

1794 #ifdeà
__PIC__


1796 
__STRING_INLINE
 *

1797 
	$__¡½brk_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1799 
__d0
, 
__d1
, 
__d2
;

1800 *
__»s
;

1801 
__asm__
 
__vŞ©e__


1822 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&D" (
__d2
)

1823 : "d" (
__acû±
), "0" (
__s
), "1" (0), "2" (0xffffffff)

1825  
__»s
;

1826 
	}
}

1828 
__STRING_INLINE
 *

1829 
	$__¡½brk_g
 (cÚ¡ *
__s
, cÚ¡ *
__acû±
)

1831 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1832 *
__»s
;

1833 
__asm__
 
__vŞ©e__


1852 : "=S" (
__»s
), "=&a" (
__d0
), "=&c" (
__d1
), "=&d" (
__d2
), "=&D" (
__d3
)

1853 : "0" (
__s
), "1" (0), "2" (0xffffffff), "b" (
__acû±
)

1855  
__»s
;

1856 
	}
}

1861 
	#_HAVE_STRING_ARCH_¡r¡r
 1

	)

1862 
	#¡r¡r
(
hay¡ack
, 
ÃedË
) \

1863 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
ÃedË
) &&  ((needle)[0]) == 1 \

1864 ? ((
ÃedË
)[0] == '\0' \

1865 ? (
hay¡ack
) \

1866 : ((
ÃedË
)[1] == '\0' \

1867 ? 
	`¡rchr
 ((
hay¡ack
), (
ÃedË
)[0]) \

1868 : 
	`__¡r¡r_cg
 ((
hay¡ack
), (
ÃedË
), \

1869 
	`¡¾’
 (
ÃedË
)))) \

1870 : 
	`__¡r¡r_g
 ((
hay¡ack
), (
ÃedË
))))

	)

1874 
__STRING_INLINE
 *
__¡r¡r_cg
 (cÚ¡ *
__hay¡ack
,

1875 cÚ¡ 
__ÃedË
[],

1876 
size_t
 
__ÃedË_Ën
);

1878 
__STRING_INLINE
 *

1879 
	$__¡r¡r_cg
 (cÚ¡ *
__hay¡ack
, cÚ¡ 
__ÃedË
[],

1880 
size_t
 
__ÃedË_Ën
)

1882 
__d0
, 
__d1
, 
__d2
;

1883 *
__»s
;

1884 
__asm__
 
__vŞ©e__


1897 : "=&a" (
__»s
), "=&S" (
__d0
), "=&D" (
__d1
), "=&c" (
__d2
)

1898 : "g" (
__ÃedË_Ën
), "1" (
__hay¡ack
), "d" (
__ÃedË
)

1900  
__»s
;

1901 
	}
}

1903 
__STRING_INLINE
 *
__¡r¡r_g
 (cÚ¡ *
__hay¡ack
,

1904 cÚ¡ *
__ÃedË
);

1905 #ifdeà
__PIC__


1907 
__STRING_INLINE
 *

1908 
	$__¡r¡r_g
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

1910 
__d0
, 
__d1
, 
__d2
;

1911 *
__»s
;

1912 
__asm__
 
__vŞ©e__


1931 : "=&a" (
__»s
), "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
)

1932 : "0" (0), "1" (0xffffffff), "2" (
__hay¡ack
), "3" (
__ÃedË
),

1933 "d" (
__ÃedË
)

1935  
__»s
;

1936 
	}
}

1938 
__STRING_INLINE
 *

1939 
	$__¡r¡r_g
 (cÚ¡ *
__hay¡ack
, cÚ¡ *
__ÃedË
)

1941 
__d0
, 
__d1
, 
__d2
, 
__d3
;

1942 *
__»s
;

1943 
__asm__
 
__vŞ©e__


1960 : "=&a" (
__»s
), "=&c" (
__d0
), "=&S" (
__d1
), "=&D" (
__d2
), "=&d" (
__d3
)

1961 : "0" (0), "1" (0xffffffff), "2" (
__hay¡ack
), "3" (
__ÃedË
),

1962 "b" (
__ÃedË
)

1964  
__»s
;

1965 
	}
}

1971 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN_EXTENDED


1972 #ifdeà
__i686__


1973 
	#_HAVE_STRING_ARCH_ffs
 1

	)

1974 
	#ffs
(
wÜd
è(
	`__butš_cÚ¡ªt_p
 (word) \

1975 ? 
	`__butš_ffs
 (
wÜd
) \

1976 : ({ 
__út
, 
__tmp
; \

1977 
__asm__
 
__vŞ©e__
 \

1980 : "=&r" (
__út
), "ô" (
__tmp
) \

1981 : "rm" (
wÜd
), "1" (-1)); \

1982 
__út
 + 1; }))

	)

1984 #iâdeà
ff¦


1985 
	#ff¦
(
wÜd
è
	`ffs
(wÜd)

	)

1990 #iâdeà
_FORCE_INLINES


1991 #undeà
__STRING_INLINE


	@/usr/include/bits/string2.h

20 #iâdeà
_STRING_H


24 #iâdeà
__NO_STRING_INLINES


41 #iâdeà
__STRING_INLINE


42 #ifdeà
__ılu¥lus


43 
	#__STRING_INLINE
 
šlše


	)

45 
	#__STRING_INLINE
 
__ex‹º_šlše


	)

52 
	#__¡ršg2_1b±r_p
(
__x
) \

53 ((
size_t
)(cÚ¡ *)((
__x
è+ 1è- (size_t)(cÚ¡ *)(__xè=ğ1)

	)

56 #ià!
defšed
 
_HAVE_STRING_ARCH_mem£t


57 
	#__bz”o
(
s
, 
n
è
	`__butš_mem£t
 (s, '\0',‚)

	)

61 #iâdeà
_HAVE_STRING_ARCH_¡rchr


62 *
__¿wmemchr
 (cÚ¡ *
__s
, 
__c
);

63 
	#¡rchr
(
s
, 
c
) \

64 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
c
è&& !__butš_cÚ¡ªt_°(
s
) \

65 && (
c
) == '\0' \

66 ? (*è
	`__¿wmemchr
 (
s
, 
c
) \

67 : 
	`__butš_¡rchr
 (
s
, 
c
)))

	)

72 #ifdeà
__USE_GNU


73 #iâdeà
_HAVE_STRING_ARCH_¡pıy


74 
	#__¡pıy
(
de¡
, 
¤c
è
	`__butš_¡pıy
 (de¡, src)

	)

77 
	#¡pıy
(
de¡
, 
¤c
è
	`__¡pıy
 (de¡, src)

	)

83 #iâdeà
_HAVE_STRING_ARCH_¡ºıy


84 
	#¡ºıy
(
de¡
, 
¤c
, 
n
è
	`__butš_¡ºıy
 (de¡, src,‚)

	)

89 #iâdeà
_HAVE_STRING_ARCH_¡ºÿt


90 #ifdeà
_USE_STRING_ARCH_¡rchr


91 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
) \

92 (
	`__ex‹nsiÚ__
 ({ *
__de¡
 = (
de¡
); \

93 
	`__butš_cÚ¡ªt_p
 (
¤c
è&& __butš_cÚ¡ªt_°(
n
) \

94 ? (
	`¡¾’
 (
¤c
è< ((
size_t
è(
n
)) \

95 ? 
	`¡rÿt
 (
__de¡
, 
¤c
) \

96 : (*((*è
	`__mempıy
 (
	`¡rchr
 (
__de¡
, '\0'), \

97 
¤c
, 
n
)èğ'\0', 
__de¡
)) \

98 : 
	`¡ºÿt
 (
de¡
, 
¤c
, 
n
); }))

	)

100 
	#¡ºÿt
(
de¡
, 
¤c
, 
n
è
	`__butš_¡ºÿt
 (de¡, src,‚)

	)

106 #iâdeà
_HAVE_STRING_ARCH_¡rcmp


107 
	#¡rcmp
(
s1
, 
s2
) \

108 
__ex‹nsiÚ__
 \

109 ({ 
size_t
 
__s1_Ën
, 
__s2_Ën
; \

110 (
	`__butš_cÚ¡ªt_p
 (
s1
è&& __butš_cÚ¡ªt_°(
s2
) \

111 && (
__s1_Ën
 = 
	`__butš_¡¾’
 (
s1
), 
__s2_Ën
 = __butš_¡¾’ (
s2
), \

112 (!
	`__¡ršg2_1b±r_p
 (
s1
è|| 
__s1_Ën
 >= 4) \

113 && (!
	`__¡ršg2_1b±r_p
 (
s2
è|| 
__s2_Ën
 >= 4)) \

114 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

115 : (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

116 && (
__s1_Ën
 = 
	`__butš_¡¾’
 (
s1
), __s1_len < 4) \

117 ? (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

118 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

119 : 
	`__¡rcmp_cg
 (
s1
, 
s2
, 
__s1_Ën
)) \

120 : (
	`__butš_cÚ¡ªt_p
 (
s2
è&& 
	`__¡ršg2_1b±r_p
 (s2) \

121 && (
__s2_Ën
 = 
	`__butš_¡¾’
 (
s2
), __s2_len < 4) \

122 ? (
	`__butš_cÚ¡ªt_p
 (
s1
è&& 
	`__¡ršg2_1b±r_p
 (s1) \

123 ? 
	`__butš_¡rcmp
 (
s1
, 
s2
) \

124 : -
	`__¡rcmp_cg
 (
s2
, 
s1
, 
__s2_Ën
)) \

125 : 
	`__butš_¡rcmp
 (
s1
, 
s2
)))); })

	)

127 
	#__¡rcmp_cg
(
s1
, 
s2
, 
l1
) \

128 (
	`__ex‹nsiÚ__
 ({ cÚ¡ *
__s2
 = \

129 (cÚ¡ *è(cÚ¡ *è(
s2
); \

130 
__»suÉ
 = \

131 (((cÚ¡ *è(cÚ¡ *è(
s1
))[0] \

132 - 
__s2
[0]); \

133 ià(
l1
 > 0 && 
__»suÉ
 == 0) \

135 
__»suÉ
 = (((const *) \

136 (cÚ¡ *è(
s1
))[1] - 
__s2
[1]); \

137 ià(
l1
 > 1 && 
__»suÉ
 == 0) \

139 
__»suÉ
 = (((const *) \

140 (cÚ¡ *è(
s1
))[2] - 
__s2
[2]); \

141 ià(
l1
 > 2 && 
__»suÉ
 == 0) \

142 
__»suÉ
 = (((const *) \

143 (cÚ¡ *è(
s1
))[3] \

144 - 
__s2
[3]); \

147 
__»suÉ
; }))

	)

152 #iâdeà
_HAVE_STRING_ARCH_¡ºcmp


153 
	#¡ºcmp
(
s1
, 
s2
, 
n
) \

154 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
n
) \

155 && ((
	`__butš_cÚ¡ªt_p
 (
s1
) \

156 && 
	`¡¾’
 (
s1
è< ((
size_t
è(
n
))) \

157 || (
	`__butš_cÚ¡ªt_p
 (
s2
) \

158 && 
	`¡¾’
 (
s2
è< ((
size_t
è(
n
)))) \

159 ? 
	`¡rcmp
 (
s1
, 
s2
è: 
	`¡ºcmp
 (s1, s2, 
n
)))

	)

165 #iâdeà
_HAVE_STRING_ARCH_¡rc¥n


166 
	#¡rc¥n
(
s
, 
»jeù
è
	`__butš_¡rc¥n
 (s,„ejeù)

	)

172 #iâdeà
_HAVE_STRING_ARCH_¡r¥n


173 
	#¡r¥n
(
s
, 
acû±
è
	`__butš_¡r¥n
 (s,‡cû±)

	)

178 #iâdeà
_HAVE_STRING_ARCH_¡½brk


179 
	#¡½brk
(
s
, 
acû±
è
	`__butš_¡½brk
 (s,‡cû±)

	)

183 #ià!
defšed
 
_HAVE_STRING_ARCH_¡¹ok_r
 || defšed 
_FORCE_INLINES


184 #iâdeà
_HAVE_STRING_ARCH_¡¹ok_r


185 
	#__¡¹ok_r
(
s
, 
£p
, 
Ãx
) \

186 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
£p
è&& 
	`__¡ršg2_1b±r_p
 (sep) \

187 && ((cÚ¡ *è(
£p
))[0] != '\0' \

188 && ((cÚ¡ *è(
£p
))[1] == '\0' \

189 ? 
	`__¡¹ok_r_1c
 (
s
, ((cÚ¡ *è(
£p
))[0], 
Ãx
) \

190 : 
	`__¡¹ok_r
 (
s
, 
£p
, 
Ãx
)))

	)

193 
__STRING_INLINE
 *
__¡¹ok_r_1c
 (*
__s
, 
__£p
, **
__Ãx
);

194 
__STRING_INLINE
 *

195 
	$__¡¹ok_r_1c
 (*
__s
, 
__£p
, **
__Ãx
)

197 *
__»suÉ
;

198 ià(
__s
 =ğ
NULL
)

199 
__s
 = *
__Ãx
;

200 *
__s
 =ğ
__£p
)

201 ++
__s
;

202 
__»suÉ
 = 
NULL
;

203 ià(*
__s
 != '\0')

205 
__»suÉ
 = 
__s
++;

206 *
__s
 != '\0')

207 ià(*
__s
++ =ğ
__£p
)

209 
__s
[-1] = '\0';

213 *
__Ãx
 = 
__s
;

214  
__»suÉ
;

215 
	}
}

216 #ifdeà
__USE_POSIX


217 
	#¡¹ok_r
(
s
, 
£p
, 
Ãx
è
	`__¡¹ok_r
 (s, s•,‚ex)

	)

222 #ià!
defšed
 
_HAVE_STRING_ARCH_¡r£p
 || defšed 
_FORCE_INLINES


223 #iâdeà
_HAVE_STRING_ARCH_¡r£p


225 *
__¡r£p_g
 (**
__¡ršgp
, cÚ¡ *
__d–im
);

226 
	#__¡r£p
(
s
, 
»jeù
) \

227 
__ex‹nsiÚ__
 \

228 ({ 
__r0
, 
__r1
, 
__r2
; \

229 (
	`__butš_cÚ¡ªt_p
 (
»jeù
è&& 
	`__¡ršg2_1b±r_p
 (reject) \

230 && (
__r0
 = ((cÚ¡ *è(
»jeù
))[0], \

231 ((cÚ¡ *è(
»jeù
))[0] != '\0') \

232 ? ((
__r1
 = ((cÚ¡ *è(
»jeù
))[1], \

233 ((cÚ¡ *è(
»jeù
))[1] == '\0') \

234 ? 
	`__¡r£p_1c
 (
s
, 
__r0
) \

235 : ((
__r2
 = ((cÚ¡ *è(
»jeù
))[2], __r2 == '\0') \

236 ? 
	`__¡r£p_2c
 (
s
, 
__r0
, 
__r1
) \

237 : (((cÚ¡ *è(
»jeù
))[3] == '\0' \

238 ? 
	`__¡r£p_3c
 (
s
, 
__r0
, 
__r1
, 
__r2
) \

239 : 
	`__¡r£p_g
 (
s
, 
»jeù
)))) \

240 : 
	`__¡r£p_g
 (
s
, 
»jeù
)); })

	)

243 
__STRING_INLINE
 *
__¡r£p_1c
 (**
__s
, 
__»jeù
);

244 
__STRING_INLINE
 *

245 
	$__¡r£p_1c
 (**
__s
, 
__»jeù
)

247 *
__»tv®
 = *
__s
;

248 ià(
__»tv®
 !ğ
NULL
 && (*
__s
 = 
	`¡rchr
 (__»tv®, 
__»jeù
)) != NULL)

249 *(*
__s
)++ = '\0';

250  
__»tv®
;

251 
	}
}

253 
__STRING_INLINE
 *
__¡r£p_2c
 (**
__s
, 
__»jeù1
, 
__»jeù2
);

254 
__STRING_INLINE
 *

255 
	$__¡r£p_2c
 (**
__s
, 
__»jeù1
, 
__»jeù2
)

257 *
__»tv®
 = *
__s
;

258 ià(
__»tv®
 !ğ
NULL
)

260 *
__ı
 = 
__»tv®
;

263 ià(*
__ı
 == '\0')

265 
__ı
 = 
NULL
;

268 ià(*
__ı
 =ğ
__»jeù1
 || *__ı =ğ
__»jeù2
)

270 *
__ı
++ = '\0';

273 ++
__ı
;

275 *
__s
 = 
__ı
;

277  
__»tv®
;

278 
	}
}

280 
__STRING_INLINE
 *
__¡r£p_3c
 (**
__s
, 
__»jeù1
, 
__»jeù2
,

281 
__»jeù3
);

282 
__STRING_INLINE
 *

283 
	$__¡r£p_3c
 (**
__s
, 
__»jeù1
, 
__»jeù2
, 
__»jeù3
)

285 *
__»tv®
 = *
__s
;

286 ià(
__»tv®
 !ğ
NULL
)

288 *
__ı
 = 
__»tv®
;

291 ià(*
__ı
 == '\0')

293 
__ı
 = 
NULL
;

296 ià(*
__ı
 =ğ
__»jeù1
 || *__ı =ğ
__»jeù2
 || *__ı =ğ
__»jeù3
)

298 *
__ı
++ = '\0';

301 ++
__ı
;

303 *
__s
 = 
__ı
;

305  
__»tv®
;

306 
	}
}

307 #ifdeà
__USE_MISC


308 
	#¡r£p
(
s
, 
»jeù
è
	`__¡r£p
 (s,„ejeù)

	)

315 #ifdeà
__USE_MISC


317 #ià!
defšed
 
_HAVE_STRING_ARCH_¡rdup
 || !defšed 
_HAVE_STRING_ARCH_¡ºdup


318 
	#__Ãed_m®loc_ªd_ÿÎoc


	)

319 
	~<¡dlib.h
>

322 #iâdeà
_HAVE_STRING_ARCH_¡rdup


324 *
	$__¡rdup
 (cÚ¡ *
__¡ršg
è
__THROW
 
__©Œibu‹_m®loc__
;

325 
	#__¡rdup
(
s
) \

326 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s) \

327 ? (((cÚ¡ *è(
s
))[0] == '\0' \

328 ? (*è
	`ÿÎoc
 ((
size_t
) 1, (size_t) 1) \

329 : ({ 
size_t
 
__Ën
 = 
	`¡¾’
 (
s
) + 1; \

330 *
__»tv®
 = (*è
	`m®loc
 (
__Ën
); \

331 ià(
__»tv®
 !ğ
NULL
) \

332 
__»tv®
 = (*è
	`memıy
 (__»tv®, 
s
, 
__Ën
); \

333 
__»tv®
; 
	}
})) \

334 : 
	`__¡rdup
 (
s
)))

	)

336 #ià
defšed
 
__USE_XOPEN_EXTENDED
 || defšed 
__USE_XOPEN2K8


337 
	#¡rdup
(
s
è
	`__¡rdup
 (s)

	)

341 #iâdeà
_HAVE_STRING_ARCH_¡ºdup


343 *
	$__¡ºdup
 (cÚ¡ *
__¡ršg
, 
size_t
 
__n
)

344 
__THROW
 
__©Œibu‹_m®loc__
;

345 
	#__¡ºdup
(
s
, 
n
) \

346 (
	`__ex‹nsiÚ__
 (
	`__butš_cÚ¡ªt_p
 (
s
è&& 
	`__¡ršg2_1b±r_p
 (s) \

347 ? (((cÚ¡ *è(
s
))[0] == '\0' \

348 ? (*è
	`ÿÎoc
 ((
size_t
) 1, (size_t) 1) \

349 : ({ 
size_t
 
__Ën
 = 
	`¡¾’
 (
s
) + 1; \

350 
size_t
 
__n
 = (
n
); \

351 *
__»tv®
; \

352 ià(
__n
 < 
__Ën
) \

353 
__Ën
 = 
__n
 + 1; \

354 
__»tv®
 = (*è
	`m®loc
 (
__Ën
); \

355 ià(
__»tv®
 !ğ
NULL
) \

357 
__»tv®
[
__Ën
 - 1] = '\0'; \

358 
__»tv®
 = (*è
	`memıy
 (__»tv®, 
s
, \

359 
__Ën
 - 1); \

361 
__»tv®
; 
	}
})) \

362 : 
	`__¡ºdup
 (
s
, 
n
)))

	)

364 #ifdeà
__USE_XOPEN2K8


365 
	#¡ºdup
(
s
, 
n
è
	`__¡ºdup
 (s,‚)

	)

371 #iâdeà
_FORCE_INLINES


372 #undeà
__STRING_INLINE


	@/usr/include/bits/string3.h

18 #iâdeà
_STRING_H


22 #ià!
__GNUC_PREREQ
 (5,0)

23 
__w¬ndeş
 (
__w¬n_mem£t_z”o_Ën
,

27 #iâdeà
__ılu¥lus


31 #undeà
memıy


32 #undeà
memmove


33 #undeà
mem£t


34 #undeà
¡rÿt


35 #undeà
¡rıy


36 #undeà
¡ºÿt


37 #undeà
¡ºıy


38 #ifdeà
__USE_GNU


39 #undeà
mempıy


40 #undeà
¡pıy


42 #ifdeà
__USE_MISC


43 #undeà
bcİy


44 #undeà
bz”o


49 
__fÜtify_funùiÚ
 *

50 
__NTH
 (
	$memıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

51 
size_t
 
__Ën
))

53  
	`__butš___memıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

54 
	}
}

56 
__fÜtify_funùiÚ
 *

57 
__NTH
 (
	$memmove
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__Ën
))

59  
	`__butš___memmove_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

60 
	}
}

62 #ifdeà
__USE_GNU


63 
__fÜtify_funùiÚ
 *

64 
__NTH
 (
	$mempıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

65 
size_t
 
__Ën
))

67  
	`__butš___mempıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

68 
	}
}

77 
__fÜtify_funùiÚ
 *

78 
__NTH
 (
	$mem£t
 (*
__de¡
, 
__ch
, 
size_t
 
__Ën
))

82 #ià!
	`__GNUC_PREREQ
 (5,0)

83 ià(
	`__butš_cÚ¡ªt_p
 (
__Ën
) && __len == 0

84 && (!
	`__butš_cÚ¡ªt_p
 (
__ch
) || __ch != 0))

86 
	`__w¬n_mem£t_z”o_Ën
 ();

87  
__de¡
;

90  
	`__butš___mem£t_chk
 (
__de¡
, 
__ch
, 
__Ën
, 
	`__bos0
 (__dest));

91 
	}
}

93 #ifdeà
__USE_MISC


94 
__fÜtify_funùiÚ
 

95 
__NTH
 (
	$bcİy
 (cÚ¡ *
__¤c
, *
__de¡
, 
size_t
 
__Ën
))

97 (è
	`__butš___memmove_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos0
 (__dest));

98 
	}
}

100 
__fÜtify_funùiÚ
 

101 
__NTH
 (
	$bz”o
 (*
__de¡
, 
size_t
 
__Ën
))

103 (è
	`__butš___mem£t_chk
 (
__de¡
, '\0', 
__Ën
, 
	`__bos0
 (__dest));

104 
	}
}

107 
__fÜtify_funùiÚ
 *

108 
__NTH
 (
	$¡rıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
))

110  
	`__butš___¡rıy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

111 
	}
}

113 #ifdeà
__USE_GNU


114 
__fÜtify_funùiÚ
 *

115 
__NTH
 (
	$¡pıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
))

117  
	`__butš___¡pıy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

118 
	}
}

122 
__fÜtify_funùiÚ
 *

123 
__NTH
 (
	$¡ºıy
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

124 
size_t
 
__Ën
))

126  
	`__butš___¡ºıy_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dest));

127 
	}
}

130 *
	$__¡²ıy_chk
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
,

131 
size_t
 
__de¡Ën
è
__THROW
;

132 *
	`__REDIRECT_NTH
 (
__¡²ıy_®Ÿs
, (*
__de¡
, cÚ¡ *
__¤c
,

133 
size_t
 
__n
), 
¡²ıy
);

135 
__fÜtify_funùiÚ
 *

136 
	`__NTH
 (
	$¡²ıy
 (*
__de¡
, cÚ¡ *
__¤c
, 
size_t
 
__n
))

138 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1

139 && (!
	`__butš_cÚ¡ªt_p
 (
__n
è|| __À> 
	`__bos
 (
__de¡
)))

140  
	`__¡²ıy_chk
 (
__de¡
, 
__¤c
, 
__n
, 
	`__bos
 (__dest));

141  
	`__¡²ıy_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

142 
	}
}

145 
__fÜtify_funùiÚ
 *

146 
__NTH
 (
	$¡rÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
))

148  
	`__butš___¡rÿt_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__dest));

149 
	}
}

152 
__fÜtify_funùiÚ
 *

153 
__NTH
 (
	$¡ºÿt
 (*
__»¡riù
 
__de¡
, cÚ¡ *__»¡riù 
__¤c
,

154 
size_t
 
__Ën
))

156  
	`__butš___¡ºÿt_chk
 (
__de¡
, 
__¤c
, 
__Ën
, 
	`__bos
 (__dest));

157 
	}
}

	@/usr/include/bits/timex.h

18 #iâdef 
_BITS_TIMEX_H


19 
	#_BITS_TIMEX_H
 1

	)

21 
	~<b™s/ty³s.h
>

25 
	stimex


27 
	mmodes
;

28 
__sysÿÎ_¦Úg_t
 
	moff£t
;

29 
__sysÿÎ_¦Úg_t
 
	mäeq
;

30 
__sysÿÎ_¦Úg_t
 
	mmax”rÜ
;

31 
__sysÿÎ_¦Úg_t
 
	me¡”rÜ
;

32 
	m¡©us
;

33 
__sysÿÎ_¦Úg_t
 
	mcÚ¡ªt
;

34 
__sysÿÎ_¦Úg_t
 
	m´ecisiÚ
;

35 
__sysÿÎ_¦Úg_t
 
	mtŞ”ªû
;

36 
timev®
 
	mtime
;

37 
__sysÿÎ_¦Úg_t
 
	mtick
;

38 
__sysÿÎ_¦Úg_t
 
	mµsäeq
;

39 
__sysÿÎ_¦Úg_t
 
	mj™‹r
;

40 
	mshiá
;

41 
__sysÿÎ_¦Úg_t
 
	m¡ab
;

42 
__sysÿÎ_¦Úg_t
 
	mj™út
;

43 
__sysÿÎ_¦Úg_t
 
	mÿlút
;

44 
__sysÿÎ_¦Úg_t
 
	m”rút
;

45 
__sysÿÎ_¦Úg_t
 
	m¡bút
;

47 
	mi
;

56 
	#ADJ_OFFSET
 0x0001

	)

57 
	#ADJ_FREQUENCY
 0x0002

	)

58 
	#ADJ_MAXERROR
 0x0004

	)

59 
	#ADJ_ESTERROR
 0x0008

	)

60 
	#ADJ_STATUS
 0x0010

	)

61 
	#ADJ_TIMECONST
 0x0020

	)

62 
	#ADJ_TAI
 0x0080

	)

63 
	#ADJ_SETOFFSET
 0x0100

	)

64 
	#ADJ_MICRO
 0x1000

	)

65 
	#ADJ_NANO
 0x2000

	)

66 
	#ADJ_TICK
 0x4000

	)

67 
	#ADJ_OFFSET_SINGLESHOT
 0x8001

	)

68 
	#ADJ_OFFSET_SS_READ
 0xa001

	)

71 
	#MOD_OFFSET
 
ADJ_OFFSET


	)

72 
	#MOD_FREQUENCY
 
ADJ_FREQUENCY


	)

73 
	#MOD_MAXERROR
 
ADJ_MAXERROR


	)

74 
	#MOD_ESTERROR
 
ADJ_ESTERROR


	)

75 
	#MOD_STATUS
 
ADJ_STATUS


	)

76 
	#MOD_TIMECONST
 
ADJ_TIMECONST


	)

77 
	#MOD_CLKB
 
ADJ_TICK


	)

78 
	#MOD_CLKA
 
ADJ_OFFSET_SINGLESHOT


	)

79 
	#MOD_TAI
 
ADJ_TAI


	)

80 
	#MOD_MICRO
 
ADJ_MICRO


	)

81 
	#MOD_NANO
 
ADJ_NANO


	)

85 
	#STA_PLL
 0x0001

	)

86 
	#STA_PPSFREQ
 0x0002

	)

87 
	#STA_PPSTIME
 0x0004

	)

88 
	#STA_FLL
 0x0008

	)

90 
	#STA_INS
 0x0010

	)

91 
	#STA_DEL
 0x0020

	)

92 
	#STA_UNSYNC
 0x0040

	)

93 
	#STA_FREQHOLD
 0x0080

	)

95 
	#STA_PPSSIGNAL
 0x0100

	)

96 
	#STA_PPSJITTER
 0x0200

	)

97 
	#STA_PPSWANDER
 0x0400

	)

98 
	#STA_PPSERROR
 0x0800

	)

100 
	#STA_CLOCKERR
 0x1000

	)

101 
	#STA_NANO
 0x2000

	)

102 
	#STA_MODE
 0x4000

	)

103 
	#STA_CLK
 0x8000

	)

106 
	#STA_RONLY
 (
STA_PPSSIGNAL
 | 
STA_PPSJITTER
 | 
STA_PPSWANDER
 | \

107 
STA_PPSERROR
 | 
STA_CLOCKERR
 | 
STA_NANO
 | 
STA_MODE
 | 
STA_CLK
)

	)

	@/usr/include/bits/typesizes.h

19 #iâdeà
_BITS_TYPES_H


23 #iâdef 
_BITS_TYPESIZES_H


24 
	#_BITS_TYPESIZES_H
 1

	)

30 #ià
defšed
 
__x86_64__
 && defšed 
__ILP32__


31 
	#__SYSCALL_SLONG_TYPE
 
__SQUAD_TYPE


	)

32 
	#__SYSCALL_ULONG_TYPE
 
__UQUAD_TYPE


	)

34 
	#__SYSCALL_SLONG_TYPE
 
__SLONGWORD_TYPE


	)

35 
	#__SYSCALL_ULONG_TYPE
 
__ULONGWORD_TYPE


	)

38 
	#__DEV_T_TYPE
 
__UQUAD_TYPE


	)

39 
	#__UID_T_TYPE
 
__U32_TYPE


	)

40 
	#__GID_T_TYPE
 
__U32_TYPE


	)

41 
	#__INO_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

42 
	#__INO64_T_TYPE
 
__UQUAD_TYPE


	)

43 
	#__MODE_T_TYPE
 
__U32_TYPE


	)

44 #ifdeà
__x86_64__


45 
	#__NLINK_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

46 
	#__FSWORD_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

48 
	#__NLINK_T_TYPE
 
__UWORD_TYPE


	)

49 
	#__FSWORD_T_TYPE
 
__SWORD_TYPE


	)

51 
	#__OFF_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

52 
	#__OFF64_T_TYPE
 
__SQUAD_TYPE


	)

53 
	#__PID_T_TYPE
 
__S32_TYPE


	)

54 
	#__RLIM_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

55 
	#__RLIM64_T_TYPE
 
__UQUAD_TYPE


	)

56 
	#__BLKCNT_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

57 
	#__BLKCNT64_T_TYPE
 
__SQUAD_TYPE


	)

58 
	#__FSBLKCNT_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

59 
	#__FSBLKCNT64_T_TYPE
 
__UQUAD_TYPE


	)

60 
	#__FSFILCNT_T_TYPE
 
__SYSCALL_ULONG_TYPE


	)

61 
	#__FSFILCNT64_T_TYPE
 
__UQUAD_TYPE


	)

62 
	#__ID_T_TYPE
 
__U32_TYPE


	)

63 
	#__CLOCK_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

64 
	#__TIME_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

65 
	#__USECONDS_T_TYPE
 
__U32_TYPE


	)

66 
	#__SUSECONDS_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

67 
	#__DADDR_T_TYPE
 
__S32_TYPE


	)

68 
	#__KEY_T_TYPE
 
__S32_TYPE


	)

69 
	#__CLOCKID_T_TYPE
 
__S32_TYPE


	)

70 
	#__TIMER_T_TYPE
 *

	)

71 
	#__BLKSIZE_T_TYPE
 
__SYSCALL_SLONG_TYPE


	)

72 
	#__FSID_T_TYPE
 sŒuù { 
__v®
[2]; }

	)

73 
	#__SSIZE_T_TYPE
 
__SWORD_TYPE


	)

74 
	#__CPU_MASK_TYPE
 
__SYSCALL_ULONG_TYPE


	)

76 #ifdeà
__x86_64__


80 
	#__OFF_T_MATCHES_OFF64_T
 1

	)

83 
	#__INO_T_MATCHES_INO64_T
 1

	)

87 
	#__FD_SETSIZE
 1024

	)

	@/usr/include/bits/wchar.h

19 #iâdeà
_BITS_WCHAR_H


20 
	#_BITS_WCHAR_H
 1

	)

33 #ifdeà
__WCHAR_MAX__


34 
	#__WCHAR_MAX
 
__WCHAR_MAX__


	)

35 #–ià
L
'\0' - 1 > 0

36 
	#__WCHAR_MAX
 (0xffffffffu + 
L
'\0')

	)

38 
	#__WCHAR_MAX
 (0x7ffffffà+ 
L
'\0')

	)

41 #ifdeà
__WCHAR_MIN__


42 
	#__WCHAR_MIN
 
__WCHAR_MIN__


	)

43 #–ià
L
'\0' - 1 > 0

44 
	#__WCHAR_MIN
 (
L
'\0' + 0)

	)

46 
	#__WCHAR_MIN
 (-
__WCHAR_MAX
 - 1)

	)

	@/usr/include/bits/xopen_lim.h

29 #iâdeà
_XOPEN_LIM_H


30 
	#_XOPEN_LIM_H
 1

	)

32 
	#__Ãed_IOV_MAX


	)

33 
	~<b™s/¡dio_lim.h
>

65 
	#_XOPEN_IOV_MAX
 
_POSIX_UIO_MAXIOV


	)

70 
	#NL_ARGMAX
 
_POSIX_ARG_MAX


	)

73 
	#NL_LANGMAX
 
_POSIX2_LINE_MAX


	)

76 
	#NL_MSGMAX
 
INT_MAX


	)

80 #ià
defšed
 
__USE_GNU
 || !defšed 
__USE_XOPEN2K8


81 
	#NL_NMAX
 
INT_MAX


	)

85 
	#NL_SETMAX
 
INT_MAX


	)

88 
	#NL_TEXTMAX
 
INT_MAX


	)

91 
	#NZERO
 20

	)

95 #ifdeà
INT_MAX


96 #ià
INT_MAX
 == 32767

97 
	#WORD_BIT
 16

	)

99 #ià
INT_MAX
 == 2147483647

100 
	#WORD_BIT
 32

	)

103 
	#WORD_BIT
 64

	)

106 #–ià
defšed
 
__INT_MAX__


107 #ià
__INT_MAX__
 == 32767

108 
	#WORD_BIT
 16

	)

110 #ià
__INT_MAX__
 == 2147483647

111 
	#WORD_BIT
 32

	)

114 
	#WORD_BIT
 64

	)

118 
	#WORD_BIT
 32

	)

122 #ifdeà
LONG_MAX


123 #ià
LONG_MAX
 == 2147483647

124 
	#LONG_BIT
 32

	)

127 
	#LONG_BIT
 64

	)

129 #–ià
defšed
 
__LONG_MAX__


130 #ià
__LONG_MAX__
 == 2147483647

131 
	#LONG_BIT
 32

	)

134 
	#LONG_BIT
 64

	)

137 
	~<b™s/wÜdsize.h
>

138 #ià
__WORDSIZE
 == 64

139 
	#LONG_BIT
 64

	)

141 
	#LONG_BIT
 32

	)

	@/usr/include/ctype.h

22 #iâdef 
_CTYPE_H


23 
	#_CTYPE_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 
	g__BEGIN_DECLS


30 #iâdeà
_ISb™


39 
	~<’dŸn.h
>

40 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


41 
	#_ISb™
(
b™
è(1 << (b™))

	)

43 
	#_ISb™
(
b™
è((b™è< 8 ? ((1 << (b™)è<< 8è: ((1 << (b™)è>> 8))

	)

48 
	m_ISuµ”
 = 
_ISb™
 (0),

49 
	m_ISlow”
 = 
_ISb™
 (1),

50 
	m_IS®pha
 = 
_ISb™
 (2),

51 
	m_ISdig™
 = 
_ISb™
 (3),

52 
	m_ISxdig™
 = 
_ISb™
 (4),

53 
	m_IS¥aû
 = 
_ISb™
 (5),

54 
	m_IS´št
 = 
_ISb™
 (6),

55 
	m_ISg¿ph
 = 
_ISb™
 (7),

56 
	m_ISbÏnk
 = 
_ISb™
 (8),

57 
	m_ISúŒl
 = 
_ISb™
 (9),

58 
	m_ISpunù
 = 
_ISb™
 (10),

59 
	m_IS®num
 = 
_ISb™
 (11)

79 cÚ¡ **
	$__ùy³_b_loc
 ()

80 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

81 cÚ¡ 
__št32_t
 **
	$__ùy³_tŞow”_loc
 ()

82 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

83 cÚ¡ 
__št32_t
 **
	$__ùy³_touµ”_loc
 ()

84 
__THROW
 
	`__©Œibu‹__
 ((
__cÚ¡__
));

87 #iâdeà
__ılu¥lus


88 
	#__isùy³
(
c
, 
ty³
) \

89 ((*
	`__ùy³_b_loc
 ())[(è(
c
)] & (è
ty³
)

	)

90 #–ià
defšed
 
__USE_EXTERN_INLINES


91 
	#__isùy³_f
(
ty³
) \

92 
__ex‹º_šlše
 \

93 
is
##
	`ty³
 (
__c
è
__THROW
 \

95  (*
	`__ùy³_b_loc
 ())[(è(
__c
)] & (è
_IS
##
ty³
; \

96 
	}

	)
}

99 
	#__i§scii
(
c
è(((cè& ~0x7fè=ğ0è

	)

100 
	#__tßscii
(
c
è((cè& 0x7fè

	)

102 
	#__exùy³
(
Çme
è
	`Çme
 (è
__THROW


	)

104 
__BEGIN_NAMESPACE_STD


110 
__exùy³
 (
i§Êum
);

111 
__exùy³
 (
i§Íha
);

112 
__exùy³
 (
isúŒl
);

113 
__exùy³
 (
isdig™
);

114 
__exùy³
 (
i¦ow”
);

115 
__exùy³
 (
isg¿ph
);

116 
__exùy³
 (
i¥ršt
);

117 
__exùy³
 (
i¥unù
);

118 
__exùy³
 (
is¥aû
);

119 
__exùy³
 (
isuµ”
);

120 
__exùy³
 (
isxdig™
);

124 
	$tŞow”
 (
__c
è
__THROW
;

127 
	$touµ”
 (
__c
è
__THROW
;

129 
__END_NAMESPACE_STD


133 #ifdef 
__USE_ISOC99


134 
__BEGIN_NAMESPACE_C99


136 
	`__exùy³
 (
isbÏnk
);

138 
__END_NAMESPACE_C99


141 #ifdeà
__USE_GNU


143 
	$isùy³
 (
__c
, 
__mask
è
__THROW
;

146 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


150 
	$i§scii
 (
__c
è
__THROW
;

154 
	$tßscii
 (
__c
è
__THROW
;

158 
	`__exùy³
 (
_touµ”
);

159 
	`__exùy³
 (
_tŞow”
);

163 
	#__tobody
(
c
, 
f
, 
a
, 
¬gs
) \

164 (
__ex‹nsiÚ__
 \

165 ({ 
__»s
; \

166 ià( (
c
) > 1) \

168 ià(
	`__butš_cÚ¡ªt_p
 (
c
)) \

170 
__c
 = (
c
); \

171 
__»s
 = 
__c
 < -128 || __ø> 255 ? __ø: (
a
)[__c]; \

174 
__»s
 = 
f
 
¬gs
; \

177 
__»s
 = (
a
)[(è(
c
)]; \

178 
__»s
; 
	}
}))

	)

180 #ià!
defšed
 
__NO_CTYPE


181 #ifdeà
__isùy³_f


182 
	$__isùy³_f
 (
®num
)

183 
	$__isùy³_f
 (
®pha
)

184 
	$__isùy³_f
 (
úŒl
)

185 
	$__isùy³_f
 (
dig™
)

186 
	$__isùy³_f
 (
low”
)

187 
	$__isùy³_f
 (
g¿ph
)

188 
	$__isùy³_f
 (
´št
)

189 
	$__isùy³_f
 (
punù
)

190 
	$__isùy³_f
 (
¥aû
)

191 
	$__isùy³_f
 (
uµ”
)

192 
	$__isùy³_f
 (
xdig™
)

193 #ifdeà
__USE_ISOC99


194 
	$__isùy³_f
 (
bÏnk
)

196 #–ià
defšed
 
__isùy³


197 
	#i§Êum
(
c
è
	`__isùy³
((c), 
_IS®num
)

	)

198 
	#i§Íha
(
c
è
	`__isùy³
((c), 
_IS®pha
)

	)

199 
	#isúŒl
(
c
è
	`__isùy³
((c), 
_ISúŒl
)

	)

200 
	#isdig™
(
c
è
	`__isùy³
((c), 
_ISdig™
)

	)

201 
	#i¦ow”
(
c
è
	`__isùy³
((c), 
_ISlow”
)

	)

202 
	#isg¿ph
(
c
è
	`__isùy³
((c), 
_ISg¿ph
)

	)

203 
	#i¥ršt
(
c
è
	`__isùy³
((c), 
_IS´št
)

	)

204 
	#i¥unù
(
c
è
	`__isùy³
((c), 
_ISpunù
)

	)

205 
	#is¥aû
(
c
è
	`__isùy³
((c), 
_IS¥aû
)

	)

206 
	#isuµ”
(
c
è
	`__isùy³
((c), 
_ISuµ”
)

	)

207 
	#isxdig™
(
c
è
	`__isùy³
((c), 
_ISxdig™
)

	)

208 #ifdeà
__USE_ISOC99


209 
	#isbÏnk
(
c
è
	`__isùy³
((c), 
_ISbÏnk
)

	)

213 #ifdeà
__USE_EXTERN_INLINES


214 
__ex‹º_šlše
 

215 
	`__NTH
 (
	$tŞow”
 (
__c
))

217  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_tŞow”_loc
 ())[__c] : __c;

218 
	}
}

220 
__ex‹º_šlše
 

221 
__NTH
 (
	$touµ”
 (
__c
))

223  
__c
 >ğ-128 && __ø< 256 ? (*
	`__ùy³_touµ”_loc
 ())[__c] : __c;

224 
	}
}

227 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


228 
	#tŞow”
(
c
è
	`__tobody
 (c, 
tŞow”
, *
	`__ùy³_tŞow”_loc
 (), (c))

	)

229 
	#touµ”
(
c
è
	`__tobody
 (c, 
touµ”
, *
	`__ùy³_touµ”_loc
 (), (c))

	)

232 #ià
defšed
 
__USE_MISC
 || defšed 
__USE_XOPEN


233 
	#i§scii
(
c
è
	`__i§scii
 (c)

	)

234 
	#tßscii
(
c
è
	`__tßscii
 (c)

	)

236 
	#_tŞow”
(
c
è((è(*
	`__ùy³_tŞow”_loc
 ())[(è(c)])

	)

237 
	#_touµ”
(
c
è((è(*
	`__ùy³_touµ”_loc
 ())[(è(c)])

	)

243 #ifdeà
__USE_XOPEN2K8


257 
	~<xloÿË.h
>

261 
	#__isùy³_l
(
c
, 
ty³
, 
loÿË
) \

262 ((
loÿË
)->
__ùy³_b
[(è(
c
)] & (è
ty³
)

	)

264 
	#__exùy³_l
(
Çme
) \

265 
	`Çme
 (, 
__loÿË_t
è
__THROW


	)

271 
__exùy³_l
 (
i§Êum_l
);

272 
__exùy³_l
 (
i§Íha_l
);

273 
__exùy³_l
 (
isúŒl_l
);

274 
__exùy³_l
 (
isdig™_l
);

275 
__exùy³_l
 (
i¦ow”_l
);

276 
__exùy³_l
 (
isg¿ph_l
);

277 
__exùy³_l
 (
i¥ršt_l
);

278 
__exùy³_l
 (
i¥unù_l
);

279 
__exùy³_l
 (
is¥aû_l
);

280 
__exùy³_l
 (
isuµ”_l
);

281 
__exùy³_l
 (
isxdig™_l
);

283 
__exùy³_l
 (
isbÏnk_l
);

287 
	$__tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

288 
	$tŞow”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

291 
	$__touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

292 
	$touµ”_l
 (
__c
, 
__loÿË_t
 
__l
è
__THROW
;

294 #ià
__GNUC__
 >ğ2 && 
defšed
 
__OPTIMIZE__
 && !defšed 
__ılu¥lus


295 
	#__tŞow”_l
(
c
, 
loÿË
) \

296 
	`__tobody
 (
c
, 
__tŞow”_l
, (
loÿË
)->
__ùy³_tŞow”
, (c,†oÿË))

	)

297 
	#__touµ”_l
(
c
, 
loÿË
) \

298 
	`__tobody
 (
c
, 
__touµ”_l
, (
loÿË
)->
__ùy³_touµ”
, (c,†oÿË))

	)

299 
	#tŞow”_l
(
c
, 
loÿË
è
	`__tŞow”_l
 ((c), (loÿË))

	)

300 
	#touµ”_l
(
c
, 
loÿË
è
	`__touµ”_l
 ((c), (loÿË))

	)

304 #iâdeà
__NO_CTYPE


305 
	#__i§Êum_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®num
, (l))

	)

306 
	#__i§Íha_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS®pha
, (l))

	)

307 
	#__isúŒl_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISúŒl
, (l))

	)

308 
	#__isdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISdig™
, (l))

	)

309 
	#__i¦ow”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISlow”
, (l))

	)

310 
	#__isg¿ph_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISg¿ph
, (l))

	)

311 
	#__i¥ršt_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS´št
, (l))

	)

312 
	#__i¥unù_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISpunù
, (l))

	)

313 
	#__is¥aû_l
(
c
,
l
è
	`__isùy³_l
((c), 
_IS¥aû
, (l))

	)

314 
	#__isuµ”_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISuµ”
, (l))

	)

315 
	#__isxdig™_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISxdig™
, (l))

	)

317 
	#__isbÏnk_l
(
c
,
l
è
	`__isùy³_l
((c), 
_ISbÏnk
, (l))

	)

319 #ifdeà
__USE_MISC


320 
	#__i§scii_l
(
c
,
l
è(Ö), 
	`__i§scii
 (c))

	)

321 
	#__tßscii_l
(
c
,
l
è(Ö), 
	`__tßscii
 (c))

	)

324 
	#i§Êum_l
(
c
,
l
è
	`__i§Êum_l
 ((c), (l))

	)

325 
	#i§Íha_l
(
c
,
l
è
	`__i§Íha_l
 ((c), (l))

	)

326 
	#isúŒl_l
(
c
,
l
è
	`__isúŒl_l
 ((c), (l))

	)

327 
	#isdig™_l
(
c
,
l
è
	`__isdig™_l
 ((c), (l))

	)

328 
	#i¦ow”_l
(
c
,
l
è
	`__i¦ow”_l
 ((c), (l))

	)

329 
	#isg¿ph_l
(
c
,
l
è
	`__isg¿ph_l
 ((c), (l))

	)

330 
	#i¥ršt_l
(
c
,
l
è
	`__i¥ršt_l
 ((c), (l))

	)

331 
	#i¥unù_l
(
c
,
l
è
	`__i¥unù_l
 ((c), (l))

	)

332 
	#is¥aû_l
(
c
,
l
è
	`__is¥aû_l
 ((c), (l))

	)

333 
	#isuµ”_l
(
c
,
l
è
	`__isuµ”_l
 ((c), (l))

	)

334 
	#isxdig™_l
(
c
,
l
è
	`__isxdig™_l
 ((c), (l))

	)

336 
	#isbÏnk_l
(
c
,
l
è
	`__isbÏnk_l
 ((c), (l))

	)

338 #ifdeà
__USE_MISC


339 
	#i§scii_l
(
c
,
l
è
	`__i§scii_l
 ((c), (l))

	)

340 
	#tßscii_l
(
c
,
l
è
	`__tßscii_l
 ((c), (l))

	)

347 
__END_DECLS


	@/usr/include/gnu/stubs-32.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub_chæags


	)

11 
	#__¡ub_ç‰ach


	)

12 
	#__¡ub_fchæags


	)

13 
	#__¡ub_fd‘ach


	)

14 
	#__¡ub_g‰y


	)

15 
	#__¡ub_lchmod


	)

16 
	#__¡ub_»voke


	)

17 
	#__¡ub_£ogš


	)

18 
	#__¡ub_sig»tuº


	)

19 
	#__¡ub_s¡k


	)

20 
	#__¡ub_¡ty


	)

	@/usr/include/gnu/stubs-64.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub___com·t_bdæush


	)

11 
	#__¡ub_chæags


	)

12 
	#__¡ub_ç‰ach


	)

13 
	#__¡ub_fchæags


	)

14 
	#__¡ub_fd‘ach


	)

15 
	#__¡ub_g‘msg


	)

16 
	#__¡ub_g‰y


	)

17 
	#__¡ub_lchmod


	)

18 
	#__¡ub_putmsg


	)

19 
	#__¡ub_»voke


	)

20 
	#__¡ub_£ogš


	)

21 
	#__¡ub_sig»tuº


	)

22 
	#__¡ub_s¡k


	)

23 
	#__¡ub_¡ty


	)

	@/usr/include/gnu/stubs-x32.h

6 #ifdeà
_LIBC


7 #”rÜ 
AµliÿtiÚs
 
may
 
nÙ
 
defše
 
the
 
maüo
 
_LIBC


10 
	#__¡ub___com·t_bdæush


	)

11 
	#__¡ub___com·t_ü—‹_moduË


	)

12 
	#__¡ub___com·t_g‘_k”Ãl_syms


	)

13 
	#__¡ub___com·t_qu”y_moduË


	)

14 
	#__¡ub___com·t_u£lib


	)

15 
	#__¡ub_chæags


	)

16 
	#__¡ub_ç‰ach


	)

17 
	#__¡ub_fchæags


	)

18 
	#__¡ub_fd‘ach


	)

19 
	#__¡ub_g‘msg


	)

20 
	#__¡ub_g‰y


	)

21 
	#__¡ub_lchmod


	)

22 
	#__¡ub_nfs£rvùl


	)

23 
	#__¡ub_putmsg


	)

24 
	#__¡ub_»voke


	)

25 
	#__¡ub_£ogš


	)

26 
	#__¡ub_sig»tuº


	)

27 
	#__¡ub_s¡k


	)

28 
	#__¡ub_¡ty


	)

	@/usr/include/linux/bpf_common.h

1 #iâdeà
__LINUX_BPF_COMMON_H__


2 
	#__LINUX_BPF_COMMON_H__


	)

5 
	#BPF_CLASS
(
code
è((codeè& 0x07)

	)

6 
	#BPF_LD
 0x00

	)

7 
	#BPF_LDX
 0x01

	)

8 
	#BPF_ST
 0x02

	)

9 
	#BPF_STX
 0x03

	)

10 
	#BPF_ALU
 0x04

	)

11 
	#BPF_JMP
 0x05

	)

12 
	#BPF_RET
 0x06

	)

13 
	#BPF_MISC
 0x07

	)

16 
	#BPF_SIZE
(
code
è((codeè& 0x18)

	)

17 
	#BPF_W
 0x00

	)

18 
	#BPF_H
 0x08

	)

19 
	#BPF_B
 0x10

	)

20 
	#BPF_MODE
(
code
è((codeè& 0xe0)

	)

21 
	#BPF_IMM
 0x00

	)

22 
	#BPF_ABS
 0x20

	)

23 
	#BPF_IND
 0x40

	)

24 
	#BPF_MEM
 0x60

	)

25 
	#BPF_LEN
 0x80

	)

26 
	#BPF_MSH
 0xa0

	)

29 
	#BPF_OP
(
code
è((codeè& 0xf0)

	)

30 
	#BPF_ADD
 0x00

	)

31 
	#BPF_SUB
 0x10

	)

32 
	#BPF_MUL
 0x20

	)

33 
	#BPF_DIV
 0x30

	)

34 
	#BPF_OR
 0x40

	)

35 
	#BPF_AND
 0x50

	)

36 
	#BPF_LSH
 0x60

	)

37 
	#BPF_RSH
 0x70

	)

38 
	#BPF_NEG
 0x80

	)

39 
	#BPF_MOD
 0x90

	)

40 
	#BPF_XOR
 0xa0

	)

42 
	#BPF_JA
 0x00

	)

43 
	#BPF_JEQ
 0x10

	)

44 
	#BPF_JGT
 0x20

	)

45 
	#BPF_JGE
 0x30

	)

46 
	#BPF_JSET
 0x40

	)

47 
	#BPF_SRC
(
code
è((codeè& 0x08)

	)

48 
	#BPF_K
 0x00

	)

49 
	#BPF_X
 0x08

	)

51 #iâdeà
BPF_MAXINSNS


52 
	#BPF_MAXINSNS
 4096

	)

	@/usr/include/linux/byteorder/little_endian.h

1 #iâdeà
_LINUX_BYTEORDER_LITTLE_ENDIAN_H


2 
	#_LINUX_BYTEORDER_LITTLE_ENDIAN_H


	)

4 #iâdeà
__LITTLE_ENDIAN


5 
	#__LITTLE_ENDIAN
 1234

	)

7 #iâdeà
__LITTLE_ENDIAN_BITFIELD


8 
	#__LITTLE_ENDIAN_BITFIELD


	)

11 
	~<lšux/ty³s.h
>

12 
	~<lšux/swab.h
>

14 
	#__cÚ¡ªt_htÚl
(
x
è((
__be32
)
	`___cÚ¡ªt_swab32
((x)))

	)

15 
	#__cÚ¡ªt_Áohl
(
x
è
	`___cÚ¡ªt_swab32
((
__be32
)(x))

	)

16 
	#__cÚ¡ªt_htÚs
(
x
è((
__be16
)
	`___cÚ¡ªt_swab16
((x)))

	)

17 
	#__cÚ¡ªt_Áohs
(
x
è
	`___cÚ¡ªt_swab16
((
__be16
)(x))

	)

18 
	#__cÚ¡ªt_ıu_to_Ë64
(
x
è((
__Ë64
)(
__u64
)(x))

	)

19 
	#__cÚ¡ªt_Ë64_to_ıu
(
x
è((
__u64
)(
__Ë64
)(x))

	)

20 
	#__cÚ¡ªt_ıu_to_Ë32
(
x
è((
__Ë32
)(
__u32
)(x))

	)

21 
	#__cÚ¡ªt_Ë32_to_ıu
(
x
è((
__u32
)(
__Ë32
)(x))

	)

22 
	#__cÚ¡ªt_ıu_to_Ë16
(
x
è((
__Ë16
)(
__u16
)(x))

	)

23 
	#__cÚ¡ªt_Ë16_to_ıu
(
x
è((
__u16
)(
__Ë16
)(x))

	)

24 
	#__cÚ¡ªt_ıu_to_be64
(
x
è((
__be64
)
	`___cÚ¡ªt_swab64
((x)))

	)

25 
	#__cÚ¡ªt_be64_to_ıu
(
x
è
	`___cÚ¡ªt_swab64
((
__u64
)(
__be64
)(x))

	)

26 
	#__cÚ¡ªt_ıu_to_be32
(
x
è((
__be32
)
	`___cÚ¡ªt_swab32
((x)))

	)

27 
	#__cÚ¡ªt_be32_to_ıu
(
x
è
	`___cÚ¡ªt_swab32
((
__u32
)(
__be32
)(x))

	)

28 
	#__cÚ¡ªt_ıu_to_be16
(
x
è((
__be16
)
	`___cÚ¡ªt_swab16
((x)))

	)

29 
	#__cÚ¡ªt_be16_to_ıu
(
x
è
	`___cÚ¡ªt_swab16
((
__u16
)(
__be16
)(x))

	)

30 
	#__ıu_to_Ë64
(
x
è((
__Ë64
)(
__u64
)(x))

	)

31 
	#__Ë64_to_ıu
(
x
è((
__u64
)(
__Ë64
)(x))

	)

32 
	#__ıu_to_Ë32
(
x
è((
__Ë32
)(
__u32
)(x))

	)

33 
	#__Ë32_to_ıu
(
x
è((
__u32
)(
__Ë32
)(x))

	)

34 
	#__ıu_to_Ë16
(
x
è((
__Ë16
)(
__u16
)(x))

	)

35 
	#__Ë16_to_ıu
(
x
è((
__u16
)(
__Ë16
)(x))

	)

36 
	#__ıu_to_be64
(
x
è((
__be64
)
	`__swab64
((x)))

	)

37 
	#__be64_to_ıu
(
x
è
	`__swab64
((
__u64
)(
__be64
)(x))

	)

38 
	#__ıu_to_be32
(
x
è((
__be32
)
	`__swab32
((x)))

	)

39 
	#__be32_to_ıu
(
x
è
	`__swab32
((
__u32
)(
__be32
)(x))

	)

40 
	#__ıu_to_be16
(
x
è((
__be16
)
	`__swab16
((x)))

	)

41 
	#__be16_to_ıu
(
x
è
	`__swab16
((
__u16
)(
__be16
)(x))

	)

43 
__®ways_šlše
 
__Ë64
 
	$__ıu_to_Ë64p
(cÚ¡ 
__u64
 *
p
)

45  (
__Ë64
)*
p
;

46 
	}
}

47 
__®ways_šlše
 
__u64
 
	$__Ë64_to_ıup
(cÚ¡ 
__Ë64
 *
p
)

49  (
__u64
)*
p
;

50 
	}
}

51 
__®ways_šlše
 
__Ë32
 
	$__ıu_to_Ë32p
(cÚ¡ 
__u32
 *
p
)

53  (
__Ë32
)*
p
;

54 
	}
}

55 
__®ways_šlše
 
__u32
 
	$__Ë32_to_ıup
(cÚ¡ 
__Ë32
 *
p
)

57  (
__u32
)*
p
;

58 
	}
}

59 
__®ways_šlše
 
__Ë16
 
	$__ıu_to_Ë16p
(cÚ¡ 
__u16
 *
p
)

61  (
__Ë16
)*
p
;

62 
	}
}

63 
__®ways_šlše
 
__u16
 
	$__Ë16_to_ıup
(cÚ¡ 
__Ë16
 *
p
)

65  (
__u16
)*
p
;

66 
	}
}

67 
__®ways_šlše
 
__be64
 
	$__ıu_to_be64p
(cÚ¡ 
__u64
 *
p
)

69  (
__be64
)
	`__swab64p
(
p
);

70 
	}
}

71 
__®ways_šlše
 
__u64
 
	$__be64_to_ıup
(cÚ¡ 
__be64
 *
p
)

73  
	`__swab64p
((
__u64
 *)
p
);

74 
	}
}

75 
__®ways_šlše
 
__be32
 
	$__ıu_to_be32p
(cÚ¡ 
__u32
 *
p
)

77  (
__be32
)
	`__swab32p
(
p
);

78 
	}
}

79 
__®ways_šlše
 
__u32
 
	$__be32_to_ıup
(cÚ¡ 
__be32
 *
p
)

81  
	`__swab32p
((
__u32
 *)
p
);

82 
	}
}

83 
__®ways_šlše
 
__be16
 
	$__ıu_to_be16p
(cÚ¡ 
__u16
 *
p
)

85  (
__be16
)
	`__swab16p
(
p
);

86 
	}
}

87 
__®ways_šlše
 
__u16
 
	$__be16_to_ıup
(cÚ¡ 
__be16
 *
p
)

89  
	`__swab16p
((
__u16
 *)
p
);

90 
	}
}

91 
	#__ıu_to_Ë64s
(
x
èdØ{ ()(x); } 0)

	)

92 
	#__Ë64_to_ıus
(
x
èdØ{ ()(x); } 0)

	)

93 
	#__ıu_to_Ë32s
(
x
èdØ{ ()(x); } 0)

	)

94 
	#__Ë32_to_ıus
(
x
èdØ{ ()(x); } 0)

	)

95 
	#__ıu_to_Ë16s
(
x
èdØ{ ()(x); } 0)

	)

96 
	#__Ë16_to_ıus
(
x
èdØ{ ()(x); } 0)

	)

97 
	#__ıu_to_be64s
(
x
è
	`__swab64s
((x))

	)

98 
	#__be64_to_ıus
(
x
è
	`__swab64s
((x))

	)

99 
	#__ıu_to_be32s
(
x
è
	`__swab32s
((x))

	)

100 
	#__be32_to_ıus
(
x
è
	`__swab32s
((x))

	)

101 
	#__ıu_to_be16s
(
x
è
	`__swab16s
((x))

	)

102 
	#__be16_to_ıus
(
x
è
	`__swab16s
((x))

	)

	@/usr/include/linux/kernel.h

1 #iâdeà
_LINUX_KERNEL_H


2 
	#_LINUX_KERNEL_H


	)

4 
	~<lšux/sysšfo.h
>

9 
	#__ALIGN_KERNEL
(
x
, 
a
è
	`__ALIGN_KERNEL_MASK
(x, (
	`ty³of
(x))×è- 1)

	)

10 
	#__ALIGN_KERNEL_MASK
(
x
, 
mask
è(((xè+ (mask)è& ~(mask))

	)

12 
	#__KERNEL_DIV_ROUND_UP
(
n
, 
d
è((Òè+ (dè- 1è/ (d))

	)

	@/usr/include/linux/param.h

1 #iâdeà
_LINUX_PARAM_H


2 
	#_LINUX_PARAM_H


	)

4 
	~<asm/·¿m.h
>

	@/usr/include/linux/stddef.h

3 #iâdeà
__®ways_šlše


4 
	#__®ways_šlše
 
__šlše__


	)

	@/usr/include/asm-generic/ioctl.h

1 #iâdeà
_ASM_GENERIC_IOCTL_H


2 
	#_ASM_GENERIC_IOCTL_H


	)

22 
	#_IOC_NRBITS
 8

	)

23 
	#_IOC_TYPEBITS
 8

	)

30 #iâdeà
_IOC_SIZEBITS


31 
	#_IOC_SIZEBITS
 14

	)

34 #iâdeà
_IOC_DIRBITS


35 
	#_IOC_DIRBITS
 2

	)

38 
	#_IOC_NRMASK
 ((1 << 
_IOC_NRBITS
)-1)

	)

39 
	#_IOC_TYPEMASK
 ((1 << 
_IOC_TYPEBITS
)-1)

	)

40 
	#_IOC_SIZEMASK
 ((1 << 
_IOC_SIZEBITS
)-1)

	)

41 
	#_IOC_DIRMASK
 ((1 << 
_IOC_DIRBITS
)-1)

	)

43 
	#_IOC_NRSHIFT
 0

	)

44 
	#_IOC_TYPESHIFT
 (
_IOC_NRSHIFT
+
_IOC_NRBITS
)

	)

45 
	#_IOC_SIZESHIFT
 (
_IOC_TYPESHIFT
+
_IOC_TYPEBITS
)

	)

46 
	#_IOC_DIRSHIFT
 (
_IOC_SIZESHIFT
+
_IOC_SIZEBITS
)

	)

53 #iâdeà
_IOC_NONE


54 
	#_IOC_NONE
 0U

	)

57 #iâdeà
_IOC_WRITE


58 
	#_IOC_WRITE
 1U

	)

61 #iâdeà
_IOC_READ


62 
	#_IOC_READ
 2U

	)

65 
	#_IOC
(
dœ
,
ty³
,
Ä
,
size
) \

66 (((
dœ
è<< 
_IOC_DIRSHIFT
) | \

67 ((
ty³
è<< 
_IOC_TYPESHIFT
) | \

68 ((
Ä
è<< 
_IOC_NRSHIFT
) | \

69 ((
size
è<< 
_IOC_SIZESHIFT
))

	)

71 
	#_IOC_TYPECHECK
(
t
è(Ñ))

	)

74 
	#_IO
(
ty³
,
Ä
è
	`_IOC
(
_IOC_NONE
,Ñy³),Òr),0)

	)

75 
	#_IOR
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

76 
	#_IOW
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_WRITE
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

77 
	#_IOWR
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,Ñy³),Òr),(
	`_IOC_TYPECHECK
(size)))

	)

78 
	#_IOR_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
,Ñy³),Òr),(size))

	)

79 
	#_IOW_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_WRITE
,Ñy³),Òr),(size))

	)

80 
	#_IOWR_BAD
(
ty³
,
Ä
,
size
è
	`_IOC
(
_IOC_READ
|
_IOC_WRITE
,Ñy³),Òr),(size))

	)

83 
	#_IOC_DIR
(
Ä
è((Òrè>> 
_IOC_DIRSHIFT
è& 
_IOC_DIRMASK
)

	)

84 
	#_IOC_TYPE
(
Ä
è((Òrè>> 
_IOC_TYPESHIFT
è& 
_IOC_TYPEMASK
)

	)

85 
	#_IOC_NR
(
Ä
è((Òrè>> 
_IOC_NRSHIFT
è& 
_IOC_NRMASK
)

	)

86 
	#_IOC_SIZE
(
Ä
è((Òrè>> 
_IOC_SIZESHIFT
è& 
_IOC_SIZEMASK
)

	)

90 
	#IOC_IN
 (
_IOC_WRITE
 << 
_IOC_DIRSHIFT
)

	)

91 
	#IOC_OUT
 (
_IOC_READ
 << 
_IOC_DIRSHIFT
)

	)

92 
	#IOC_INOUT
 ((
_IOC_WRITE
|
_IOC_READ
è<< 
_IOC_DIRSHIFT
)

	)

93 
	#IOCSIZE_MASK
 (
_IOC_SIZEMASK
 << 
_IOC_SIZESHIFT
)

	)

94 
	#IOCSIZE_SHIFT
 (
_IOC_SIZESHIFT
)

	)

	@/usr/include/asm-generic/ioctls.h

1 #iâdeà
__ASM_GENERIC_IOCTLS_H


2 
	#__ASM_GENERIC_IOCTLS_H


	)

4 
	~<lšux/ioùl.h
>

19 
	#TCGETS
 0x5401

	)

20 
	#TCSETS
 0x5402

	)

21 
	#TCSETSW
 0x5403

	)

22 
	#TCSETSF
 0x5404

	)

23 
	#TCGETA
 0x5405

	)

24 
	#TCSETA
 0x5406

	)

25 
	#TCSETAW
 0x5407

	)

26 
	#TCSETAF
 0x5408

	)

27 
	#TCSBRK
 0x5409

	)

28 
	#TCXONC
 0x540A

	)

29 
	#TCFLSH
 0x540B

	)

30 
	#TIOCEXCL
 0x540C

	)

31 
	#TIOCNXCL
 0x540D

	)

32 
	#TIOCSCTTY
 0x540E

	)

33 
	#TIOCGPGRP
 0x540F

	)

34 
	#TIOCSPGRP
 0x5410

	)

35 
	#TIOCOUTQ
 0x5411

	)

36 
	#TIOCSTI
 0x5412

	)

37 
	#TIOCGWINSZ
 0x5413

	)

38 
	#TIOCSWINSZ
 0x5414

	)

39 
	#TIOCMGET
 0x5415

	)

40 
	#TIOCMBIS
 0x5416

	)

41 
	#TIOCMBIC
 0x5417

	)

42 
	#TIOCMSET
 0x5418

	)

43 
	#TIOCGSOFTCAR
 0x5419

	)

44 
	#TIOCSSOFTCAR
 0x541A

	)

45 
	#FIONREAD
 0x541B

	)

46 
	#TIOCINQ
 
FIONREAD


	)

47 
	#TIOCLINUX
 0x541C

	)

48 
	#TIOCCONS
 0x541D

	)

49 
	#TIOCGSERIAL
 0x541E

	)

50 
	#TIOCSSERIAL
 0x541F

	)

51 
	#TIOCPKT
 0x5420

	)

52 
	#FIONBIO
 0x5421

	)

53 
	#TIOCNOTTY
 0x5422

	)

54 
	#TIOCSETD
 0x5423

	)

55 
	#TIOCGETD
 0x5424

	)

56 
	#TCSBRKP
 0x5425

	)

57 
	#TIOCSBRK
 0x5427

	)

58 
	#TIOCCBRK
 0x5428

	)

59 
	#TIOCGSID
 0x5429

	)

60 
	#TCGETS2
 
	`_IOR
('T', 0x2A, 
‹rmios2
)

	)

61 
	#TCSETS2
 
	`_IOW
('T', 0x2B, 
‹rmios2
)

	)

62 
	#TCSETSW2
 
	`_IOW
('T', 0x2C, 
‹rmios2
)

	)

63 
	#TCSETSF2
 
	`_IOW
('T', 0x2D, 
‹rmios2
)

	)

64 
	#TIOCGRS485
 0x542E

	)

65 #iâdeà
TIOCSRS485


66 
	#TIOCSRS485
 0x542F

	)

68 
	#TIOCGPTN
 
	`_IOR
('T', 0x30, è

	)

69 
	#TIOCSPTLCK
 
	`_IOW
('T', 0x31, è

	)

70 
	#TIOCGDEV
 
	`_IOR
('T', 0x32, è

	)

71 
	#TCGETX
 0x5432

	)

72 
	#TCSETX
 0x5433

	)

73 
	#TCSETXF
 0x5434

	)

74 
	#TCSETXW
 0x5435

	)

75 
	#TIOCSIG
 
	`_IOW
('T', 0x36, è

	)

76 
	#TIOCVHANGUP
 0x5437

	)

77 
	#TIOCGPKT
 
	`_IOR
('T', 0x38, è

	)

78 
	#TIOCGPTLCK
 
	`_IOR
('T', 0x39, è

	)

79 
	#TIOCGEXCL
 
	`_IOR
('T', 0x40, è

	)

81 
	#FIONCLEX
 0x5450

	)

82 
	#FIOCLEX
 0x5451

	)

83 
	#FIOASYNC
 0x5452

	)

84 
	#TIOCSERCONFIG
 0x5453

	)

85 
	#TIOCSERGWILD
 0x5454

	)

86 
	#TIOCSERSWILD
 0x5455

	)

87 
	#TIOCGLCKTRMIOS
 0x5456

	)

88 
	#TIOCSLCKTRMIOS
 0x5457

	)

89 
	#TIOCSERGSTRUCT
 0x5458

	)

90 
	#TIOCSERGETLSR
 0x5459

	)

91 
	#TIOCSERGETMULTI
 0x545A

	)

92 
	#TIOCSERSETMULTI
 0x545B

	)

94 
	#TIOCMIWAIT
 0x545C

	)

95 
	#TIOCGICOUNT
 0x545D

	)

101 #iâdeà
FIOQSIZE


102 
	#FIOQSIZE
 0x5460

	)

106 
	#TIOCPKT_DATA
 0

	)

107 
	#TIOCPKT_FLUSHREAD
 1

	)

108 
	#TIOCPKT_FLUSHWRITE
 2

	)

109 
	#TIOCPKT_STOP
 4

	)

110 
	#TIOCPKT_START
 8

	)

111 
	#TIOCPKT_NOSTOP
 16

	)

112 
	#TIOCPKT_DOSTOP
 32

	)

113 
	#TIOCPKT_IOCTL
 64

	)

115 
	#TIOCSER_TEMT
 0x01

	)

	@/usr/include/asm-generic/socket.h

1 #iâdeà
__ASM_GENERIC_SOCKET_H


2 
	#__ASM_GENERIC_SOCKET_H


	)

4 
	~<asm/sockios.h
>

7 
	#SOL_SOCKET
 1

	)

9 
	#SO_DEBUG
 1

	)

10 
	#SO_REUSEADDR
 2

	)

11 
	#SO_TYPE
 3

	)

12 
	#SO_ERROR
 4

	)

13 
	#SO_DONTROUTE
 5

	)

14 
	#SO_BROADCAST
 6

	)

15 
	#SO_SNDBUF
 7

	)

16 
	#SO_RCVBUF
 8

	)

17 
	#SO_SNDBUFFORCE
 32

	)

18 
	#SO_RCVBUFFORCE
 33

	)

19 
	#SO_KEEPALIVE
 9

	)

20 
	#SO_OOBINLINE
 10

	)

21 
	#SO_NO_CHECK
 11

	)

22 
	#SO_PRIORITY
 12

	)

23 
	#SO_LINGER
 13

	)

24 
	#SO_BSDCOMPAT
 14

	)

25 
	#SO_REUSEPORT
 15

	)

26 #iâdeà
SO_PASSCRED


27 
	#SO_PASSCRED
 16

	)

28 
	#SO_PEERCRED
 17

	)

29 
	#SO_RCVLOWAT
 18

	)

30 
	#SO_SNDLOWAT
 19

	)

31 
	#SO_RCVTIMEO
 20

	)

32 
	#SO_SNDTIMEO
 21

	)

36 
	#SO_SECURITY_AUTHENTICATION
 22

	)

37 
	#SO_SECURITY_ENCRYPTION_TRANSPORT
 23

	)

38 
	#SO_SECURITY_ENCRYPTION_NETWORK
 24

	)

40 
	#SO_BINDTODEVICE
 25

	)

43 
	#SO_ATTACH_FILTER
 26

	)

44 
	#SO_DETACH_FILTER
 27

	)

45 
	#SO_GET_FILTER
 
SO_ATTACH_FILTER


	)

47 
	#SO_PEERNAME
 28

	)

48 
	#SO_TIMESTAMP
 29

	)

49 
	#SCM_TIMESTAMP
 
SO_TIMESTAMP


	)

51 
	#SO_ACCEPTCONN
 30

	)

53 
	#SO_PEERSEC
 31

	)

54 
	#SO_PASSSEC
 34

	)

55 
	#SO_TIMESTAMPNS
 35

	)

56 
	#SCM_TIMESTAMPNS
 
SO_TIMESTAMPNS


	)

58 
	#SO_MARK
 36

	)

60 
	#SO_TIMESTAMPING
 37

	)

61 
	#SCM_TIMESTAMPING
 
SO_TIMESTAMPING


	)

63 
	#SO_PROTOCOL
 38

	)

64 
	#SO_DOMAIN
 39

	)

66 
	#SO_RXQ_OVFL
 40

	)

68 
	#SO_WIFI_STATUS
 41

	)

69 
	#SCM_WIFI_STATUS
 
SO_WIFI_STATUS


	)

70 
	#SO_PEEK_OFF
 42

	)

73 
	#SO_NOFCS
 43

	)

75 
	#SO_LOCK_FILTER
 44

	)

77 
	#SO_SELECT_ERR_QUEUE
 45

	)

79 
	#SO_BUSY_POLL
 46

	)

81 
	#SO_MAX_PACING_RATE
 47

	)

83 
	#SO_BPF_EXTENSIONS
 48

	)

85 
	#SO_INCOMING_CPU
 49

	)

87 
	#SO_ATTACH_BPF
 50

	)

88 
	#SO_DETACH_BPF
 
SO_DETACH_FILTER


	)

90 
	#SO_ATTACH_REUSEPORT_CBPF
 51

	)

91 
	#SO_ATTACH_REUSEPORT_EBPF
 52

	)

93 
	#SO_CNX_ADVICE
 53

	)

	@/usr/include/asm/bitsperlong.h

1 #iâdeà
__ASM_X86_BITSPERLONG_H


2 
	#__ASM_X86_BITSPERLONG_H


	)

4 #ià
defšed
(
__x86_64__
è&& !defšed(
__ILP32__
)

5 
	#__BITS_PER_LONG
 64

	)

7 
	#__BITS_PER_LONG
 32

	)

10 
	~<asm-g’”ic/b™¥”lÚg.h
>

	@/usr/include/asm/param.h

1 
	~<asm-g’”ic/·¿m.h
>

	@/usr/include/asm/posix_types_32.h

1 #iâdeà
_ASM_X86_POSIX_TYPES_32_H


2 
	#_ASM_X86_POSIX_TYPES_32_H


	)

10 
	t__k”Ãl_mode_t
;

11 
	#__k”Ãl_mode_t
 
__k”Ãl_mode_t


	)

13 
	t__k”Ãl_c_pid_t
;

14 
	#__k”Ãl_c_pid_t
 
__k”Ãl_c_pid_t


	)

16 
	t__k”Ãl_uid_t
;

17 
	t__k”Ãl_gid_t
;

18 
	#__k”Ãl_uid_t
 
__k”Ãl_uid_t


	)

20 
	t__k”Ãl_Şd_dev_t
;

21 
	#__k”Ãl_Şd_dev_t
 
__k”Ãl_Şd_dev_t


	)

23 
	~<asm-g’”ic/posix_ty³s.h
>

	@/usr/include/asm/posix_types_64.h

1 #iâdeà
_ASM_X86_POSIX_TYPES_64_H


2 
	#_ASM_X86_POSIX_TYPES_64_H


	)

10 
	t__k”Ãl_Şd_uid_t
;

11 
	t__k”Ãl_Şd_gid_t
;

12 
	#__k”Ãl_Şd_uid_t
 
__k”Ãl_Şd_uid_t


	)

14 
	t__k”Ãl_Şd_dev_t
;

15 
	#__k”Ãl_Şd_dev_t
 
__k”Ãl_Şd_dev_t


	)

17 
	~<asm-g’”ic/posix_ty³s.h
>

	@/usr/include/asm/posix_types_x32.h

1 #iâdeà
_ASM_X86_POSIX_TYPES_X32_H


2 
	#_ASM_X86_POSIX_TYPES_X32_H


	)

13 
	t__k”Ãl_lÚg_t
;

14 
	t__k”Ãl_ulÚg_t
;

15 
	#__k”Ãl_lÚg_t
 
__k”Ãl_lÚg_t


	)

17 
	~<asm/posix_ty³s_64.h
>

	@/usr/include/bits/local_lim.h

24 #iâdeà
NR_OPEN


25 
	#__undef_NR_OPEN


	)

27 #iâdeà
LINK_MAX


28 
	#__undef_LINK_MAX


	)

30 #iâdeà
OPEN_MAX


31 
	#__undef_OPEN_MAX


	)

33 #iâdeà
ARG_MAX


34 
	#__undef_ARG_MAX


	)

38 
	~<lšux/lim™s.h
>

41 #ifdeà
__undef_NR_OPEN


42 #undeà
NR_OPEN


43 #undeà
__undef_NR_OPEN


46 #ifdeà
__undef_LINK_MAX


47 #undeà
LINK_MAX


48 #undeà
__undef_LINK_MAX


51 #ifdeà
__undef_OPEN_MAX


52 #undeà
OPEN_MAX


53 #undeà
__undef_OPEN_MAX


56 #ifdeà
__undef_ARG_MAX


57 #undeà
ARG_MAX


58 #undeà
__undef_ARG_MAX


62 
	#_POSIX_THREAD_KEYS_MAX
 128

	)

64 
	#PTHREAD_KEYS_MAX
 1024

	)

67 
	#_POSIX_THREAD_DESTRUCTOR_ITERATIONS
 4

	)

69 
	#PTHREAD_DESTRUCTOR_ITERATIONS
 
_POSIX_THREAD_DESTRUCTOR_ITERATIONS


	)

72 
	#_POSIX_THREAD_THREADS_MAX
 64

	)

74 #undeà
PTHREAD_THREADS_MAX


78 
	#AIO_PRIO_DELTA_MAX
 20

	)

81 
	#PTHREAD_STACK_MIN
 16384

	)

84 
	#DELAYTIMER_MAX
 2147483647

	)

87 
	#TTY_NAME_MAX
 32

	)

90 
	#LOGIN_NAME_MAX
 256

	)

93 
	#HOST_NAME_MAX
 64

	)

96 
	#MQ_PRIO_MAX
 32768

	)

99 
	#SEM_VALUE_MAX
 (2147483647)

	)

	@/usr/include/gconv.h

22 #iâdeà
_GCONV_H


23 
	#_GCONV_H
 1

	)

25 
	~<ã©u»s.h
>

26 
	#__Ãed_mb¡©e_t


	)

27 
	#__Ãed_wšt_t


	)

28 
	~<wch¬.h
>

29 
	#__Ãed_size_t


	)

30 
	#__Ãed_wch¬_t


	)

31 
	~<¡ddef.h
>

34 
	#__UNKNOWN_10646_CHAR
 ((
wch¬_t
è0xfffd)

	)

39 
	m__GCONV_OK
 = 0,

40 
	m__GCONV_NOCONV
,

41 
	m__GCONV_NODB
,

42 
	m__GCONV_NOMEM
,

44 
	m__GCONV_EMPTY_INPUT
,

45 
	m__GCONV_FULL_OUTPUT
,

46 
	m__GCONV_ILLEGAL_INPUT
,

47 
	m__GCONV_INCOMPLETE_INPUT
,

49 
	m__GCONV_ILLEGAL_DESCRIPTOR
,

50 
	m__GCONV_INTERNAL_ERROR


57 
	m__GCONV_IS_LAST
 = 0x0001,

58 
	m__GCONV_IGNORE_ERRORS
 = 0x0002,

59 
	m__GCONV_SWAP
 = 0x0004,

60 
	m__GCONV_TRANSLIT
 = 0x0008

65 
	g__gcÚv_¡•
;

66 
	g__gcÚv_¡•_d©a
;

67 
	g__gcÚv_lßded_objeù
;

71 (*
	t__gcÚv_fù
è(
	t__gcÚv_¡•
 *, 
	t__gcÚv_¡•_d©a
 *,

73 **, 
	tsize_t
 *, , );

76 
	$wšt_t
 (*
	t__gcÚv_btowc_fù
è(
	t__gcÚv_¡•
 *, );

79 (*
	t__gcÚv_š™_fù
è(
	t__gcÚv_¡•
 *);

80 (*
	t__gcÚv_’d_fù
è(
	t__gcÚv_¡•
 *);

84 
	s__gcÚv_¡•


86 
__gcÚv_lßded_objeù
 *
__shlib_hªdË
;

87 cÚ¡ *
__modÇme
;

89 
__couÁ”
;

91 *
__äom_Çme
;

92 *
__to_Çme
;

94 
__gcÚv_fù
 
__fù
;

95 
__gcÚv_btowc_fù
 
__btowc_fù
;

96 
__gcÚv_š™_fù
 
__š™_fù
;

97 
__gcÚv_’d_fù
 
__’d_fù
;

101 
__mš_Ãeded_äom
;

102 
__max_Ãeded_äom
;

103 
__mš_Ãeded_to
;

104 
__max_Ãeded_to
;

107 
__¡©eful
;

109 *
__d©a
;

114 
	s__gcÚv_¡•_d©a


116 *
__outbuf
;

117 *
__outbuãnd
;

121 
__æags
;

125 
__švoÿtiÚ_couÁ”
;

129 
__š‹º®_u£
;

131 
__mb¡©e_t
 *
__¡©•
;

132 
__mb¡©e_t
 
__¡©e
;

138 
	s__gcÚv_šfo


140 
size_t
 
__n¡•s
;

141 
__gcÚv_¡•
 *
__¡•s
;

142 
__ex‹nsiÚ__
 
__gcÚv_¡•_d©a
 
__d©a
[0];

143 } *
	t__gcÚv_t
;

146 
	`__gcÚv_Œª¦™”©e
 (
__gcÚv_¡•
 *
¡•
,

147 
__gcÚv_¡•_d©a
 *
¡•_d©a
,

148 cÚ¡ *
šbuf¡¬t
,

149 cÚ¡ **
šbuå
,

150 cÚ¡ *
šbuãnd
,

151 **
outbuf¡¬t
,

152 
size_t
 *
œ»v”sibË
);

	@/usr/include/linux/swab.h

1 #iâdeà
_LINUX_SWAB_H


2 
	#_LINUX_SWAB_H


	)

4 
	~<lšux/ty³s.h
>

6 
	~<asm/swab.h
>

12 
	#___cÚ¡ªt_swab16
(
x
è((
__u16
)( \

13 (((
__u16
)(
x
) & (__u16)0x00ffU) << 8) | \

14 (((
__u16
)(
x
è& (__u16)0xff00Uè>> 8)))

	)

16 
	#___cÚ¡ªt_swab32
(
x
è((
__u32
)( \

17 (((
__u32
)(
x
) & (__u32)0x000000ffUL) << 24) | \

18 (((
__u32
)(
x
) & (__u32)0x0000ff00UL) << 8) | \

19 (((
__u32
)(
x
) & (__u32)0x00ff0000UL) >> 8) | \

20 (((
__u32
)(
x
è& (__u32)0xff000000ULè>> 24)))

	)

22 
	#___cÚ¡ªt_swab64
(
x
è((
__u64
)( \

23 (((
__u64
)(
x
) & (__u64)0x00000000000000ffULL) << 56) | \

24 (((
__u64
)(
x
) & (__u64)0x000000000000ff00ULL) << 40) | \

25 (((
__u64
)(
x
) & (__u64)0x0000000000ff0000ULL) << 24) | \

26 (((
__u64
)(
x
) & (__u64)0x00000000ff000000ULL) << 8) | \

27 (((
__u64
)(
x
) & (__u64)0x000000ff00000000ULL) >> 8) | \

28 (((
__u64
)(
x
) & (__u64)0x0000ff0000000000ULL) >> 24) | \

29 (((
__u64
)(
x
) & (__u64)0x00ff000000000000ULL) >> 40) | \

30 (((
__u64
)(
x
è& (__u64)0xff00000000000000ULLè>> 56)))

	)

32 
	#___cÚ¡ªt_swahw32
(
x
è((
__u32
)( \

33 (((
__u32
)(
x
) & (__u32)0x0000ffffUL) << 16) | \

34 (((
__u32
)(
x
è& (__u32)0xffff0000ULè>> 16)))

	)

36 
	#___cÚ¡ªt_swahb32
(
x
è((
__u32
)( \

37 (((
__u32
)(
x
) & (__u32)0x00ff00ffUL) << 8) | \

38 (((
__u32
)(
x
è& (__u32)0xff00ff00ULè>> 8)))

	)

46 
__šlše__
 
__u16
 
	$__fswab16
(
__u16
 
v®
)

48 #ià
	`defšed
 (
__¬ch_swab16
)

49  
	`__¬ch_swab16
(
v®
);

51  
	`___cÚ¡ªt_swab16
(
v®
);

53 
	}
}

55 
__šlše__
 
__u32
 
	$__fswab32
(
__u32
 
v®
)

57 #ià
	`defšed
(
__¬ch_swab32
)

58  
	`__¬ch_swab32
(
v®
);

60  
	`___cÚ¡ªt_swab32
(
v®
);

62 
	}
}

64 
__šlše__
 
__u64
 
	$__fswab64
(
__u64
 
v®
)

66 #ià
	`defšed
 (
__¬ch_swab64
)

67  
	`__¬ch_swab64
(
v®
);

68 #–ià
	`defšed
(
__SWAB_64_THRU_32__
)

69 
__u32
 
h
 = 
v®
 >> 32;

70 
__u32
 
l
 = 
v®
 & ((1ULL << 32) - 1);

71  (((
__u64
)
	`__fswab32
(
l
)è<< 32è| ((__u64)(__fswab32(
h
)));

73  
	`___cÚ¡ªt_swab64
(
v®
);

75 
	}
}

77 
__šlše__
 
__u32
 
	$__fswahw32
(
__u32
 
v®
)

79 #ifdeà
__¬ch_swahw32


80  
	`__¬ch_swahw32
(
v®
);

82  
	`___cÚ¡ªt_swahw32
(
v®
);

84 
	}
}

86 
__šlše__
 
__u32
 
	$__fswahb32
(
__u32
 
v®
)

88 #ifdeà
__¬ch_swahb32


89  
	`__¬ch_swahb32
(
v®
);

91  
	`___cÚ¡ªt_swahb32
(
v®
);

93 
	}
}

99 #ifdeà
__HAVE_BUILTIN_BSWAP16__


100 
	#__swab16
(
x
è(
__u16
)
	`__butš_bsw­16
((__u16)(x))

	)

102 
	#__swab16
(
x
) \

103 (
	`__butš_cÚ¡ªt_p
((
__u16
)(
x
)) ? \

104 
	`___cÚ¡ªt_swab16
(
x
) : \

105 
	`__fswab16
(
x
))

	)

112 #ifdeà
__HAVE_BUILTIN_BSWAP32__


113 
	#__swab32
(
x
è(
__u32
)
	`__butš_bsw­32
((__u32)(x))

	)

115 
	#__swab32
(
x
) \

116 (
	`__butš_cÚ¡ªt_p
((
__u32
)(
x
)) ? \

117 
	`___cÚ¡ªt_swab32
(
x
) : \

118 
	`__fswab32
(
x
))

	)

125 #ifdeà
__HAVE_BUILTIN_BSWAP64__


126 
	#__swab64
(
x
è(
__u64
)
	`__butš_bsw­64
((__u64)(x))

	)

128 
	#__swab64
(
x
) \

129 (
	`__butš_cÚ¡ªt_p
((
__u64
)(
x
)) ? \

130 
	`___cÚ¡ªt_swab64
(
x
) : \

131 
	`__fswab64
(
x
))

	)

140 
	#__swahw32
(
x
) \

141 (
	`__butš_cÚ¡ªt_p
((
__u32
)(
x
)) ? \

142 
	`___cÚ¡ªt_swahw32
(
x
) : \

143 
	`__fswahw32
(
x
))

	)

151 
	#__swahb32
(
x
) \

152 (
	`__butš_cÚ¡ªt_p
((
__u32
)(
x
)) ? \

153 
	`___cÚ¡ªt_swahb32
(
x
) : \

154 
	`__fswahb32
(
x
))

	)

160 
__®ways_šlše
 
__u16
 
	$__swab16p
(cÚ¡ 
__u16
 *
p
)

162 #ifdeà
__¬ch_swab16p


163  
	`__¬ch_swab16p
(
p
);

165  
	`__swab16
(*
p
);

167 
	}
}

173 
__®ways_šlše
 
__u32
 
	$__swab32p
(cÚ¡ 
__u32
 *
p
)

175 #ifdeà
__¬ch_swab32p


176  
	`__¬ch_swab32p
(
p
);

178  
	`__swab32
(*
p
);

180 
	}
}

186 
__®ways_šlše
 
__u64
 
	$__swab64p
(cÚ¡ 
__u64
 *
p
)

188 #ifdeà
__¬ch_swab64p


189  
	`__¬ch_swab64p
(
p
);

191  
	`__swab64
(*
p
);

193 
	}
}

201 
__šlše__
 
__u32
 
	$__swahw32p
(cÚ¡ 
__u32
 *
p
)

203 #ifdeà
__¬ch_swahw32p


204  
	`__¬ch_swahw32p
(
p
);

206  
	`__swahw32
(*
p
);

208 
	}
}

216 
__šlše__
 
__u32
 
	$__swahb32p
(cÚ¡ 
__u32
 *
p
)

218 #ifdeà
__¬ch_swahb32p


219  
	`__¬ch_swahb32p
(
p
);

221  
	`__swahb32
(*
p
);

223 
	}
}

229 
__šlše__
 
	$__swab16s
(
__u16
 *
p
)

231 #ifdeà
__¬ch_swab16s


232 
	`__¬ch_swab16s
(
p
);

234 *
p
 = 
	`__swab16p
(p);

236 
	}
}

241 
__®ways_šlše
 
	$__swab32s
(
__u32
 *
p
)

243 #ifdeà
__¬ch_swab32s


244 
	`__¬ch_swab32s
(
p
);

246 *
p
 = 
	`__swab32p
(p);

248 
	}
}

254 
__®ways_šlše
 
	$__swab64s
(
__u64
 *
p
)

256 #ifdeà
__¬ch_swab64s


257 
	`__¬ch_swab64s
(
p
);

259 *
p
 = 
	`__swab64p
(p);

261 
	}
}

269 
__šlše__
 
	$__swahw32s
(
__u32
 *
p
)

271 #ifdeà
__¬ch_swahw32s


272 
	`__¬ch_swahw32s
(
p
);

274 *
p
 = 
	`__swahw32p
(p);

276 
	}
}

284 
__šlše__
 
	$__swahb32s
(
__u32
 *
p
)

286 #ifdeà
__¬ch_swahb32s


287 
	`__¬ch_swahb32s
(
p
);

289 *
p
 = 
	`__swahb32p
(p);

291 
	}
}

	@/usr/include/linux/sysinfo.h

1 #iâdeà
_LINUX_SYSINFO_H


2 
	#_LINUX_SYSINFO_H


	)

4 
	~<lšux/ty³s.h
>

6 
	#SI_LOAD_SHIFT
 16

	)

7 
	ssysšfo
 {

8 
__k”Ãl_lÚg_t
 
	mu±ime
;

9 
__k”Ãl_ulÚg_t
 
	mlßds
[3];

10 
__k”Ãl_ulÚg_t
 
	mtÙ®¿m
;

11 
__k”Ãl_ulÚg_t
 
	mä“¿m
;

12 
__k”Ãl_ulÚg_t
 
	msh¬ed¿m
;

13 
__k”Ãl_ulÚg_t
 
	mbufã¼am
;

14 
__k”Ãl_ulÚg_t
 
	mtÙ®sw­
;

15 
__k”Ãl_ulÚg_t
 
	mä“sw­
;

16 
__u16
 
	m´ocs
;

17 
__u16
 
	m·d
;

18 
__k”Ãl_ulÚg_t
 
	mtÙ®high
;

19 
__k”Ãl_ulÚg_t
 
	mä“high
;

20 
__u32
 
	mmem_un™
;

21 
	m_f
[20-2*(
__k”Ãl_ulÚg_t
)-(
__u32
)];

	@/usr/include/wchar.h

23 #iâdeà
_WCHAR_H


25 #ià!
defšed
 
__Ãed_mb¡©e_t
 && !defšed 
__Ãed_wšt_t


26 
	#_WCHAR_H
 1

	)

27 
	~<ã©u»s.h
>

30 #ifdeà
_WCHAR_H


32 
	#__Ãed___FILE


	)

33 #ià
defšed
 
__USE_UNIX98
 || defšed 
__USE_XOPEN2K


34 
	#__Ãed_FILE


	)

36 
	~<¡dio.h
>

38 
	#__Ãed___va_li¡


	)

39 
	~<¡d¬g.h
>

41 
	~<b™s/wch¬.h
>

44 
	#__Ãed_size_t


	)

45 
	#__Ãed_wch¬_t


	)

46 
	#__Ãed_NULL


	)

48 #ià
defšed
 
_WCHAR_H
 || defšed 
__Ãed_wšt_t
 || !defšed 
__WINT_TYPE__


49 #undeà
__Ãed_wšt_t


50 
	#__Ãed_wšt_t


	)

51 
	~<¡ddef.h
>

55 #iâdeà
_WINT_T


60 
	#_WINT_T


	)

61 
	twšt_t
;

65 #ià
defšed
 
__ılu¥lus
 && defšed 
_GLIBCPP_USE_NAMESPACES
 \

66 && 
defšed
 
__WINT_TYPE__


67 
__BEGIN_NAMESPACE_STD


68 
__WINT_TYPE__
 
	twšt_t
;

69 
	g__END_NAMESPACE_STD


74 #ià
defšed
 
__ılu¥lus
 && 
__GNUC_PREREQ
 (4, 4)

75 
	#__CORRECT_ISO_CPP_WCHAR_H_PROTO


	)

79 #ià(
defšed
 
_WCHAR_H
 || defšed 
__Ãed_mb¡©e_t
è&& !defšed 
____mb¡©e_t_defšed


80 
	#____mb¡©e_t_defšed
 1

	)

84 
	m__couÁ
;

87 #ifdeà
__WINT_TYPE__


88 
__WINT_TYPE__
 
	m__wch
;

90 
wšt_t
 
	m__wch
;

92 
	m__wchb
[4];

93 } 
	m__v®ue
;

94 } 
	t__mb¡©e_t
;

96 #undeà
__Ãed_mb¡©e_t


101 #ifdeà
_WCHAR_H


103 #iâdeà
__mb¡©e_t_defšed


104 
__BEGIN_NAMESPACE_C99


106 
__mb¡©e_t
 
	tmb¡©e_t
;

107 
	g__END_NAMESPACE_C99


108 
	#__mb¡©e_t_defšed
 1

	)

111 #ifdeà
__USE_GNU


112 
	$__USING_NAMESPACE_C99
(
mb¡©e_t
)

115 #iâdeà
WCHAR_MIN


117 
	#WCHAR_MIN
 
__WCHAR_MIN


	)

118 
	#WCHAR_MAX
 
__WCHAR_MAX


	)

121 #iâdeà
WEOF


122 
	#WEOF
 (0xffffffffu)

	)

127 #ià
defšed
 
__USE_XOPEN
 && !defšed 
__USE_UNIX98


128 
	~<wùy³.h
>

132 
__BEGIN_DECLS


134 
__BEGIN_NAMESPACE_STD


137 
tm
;

138 
__END_NAMESPACE_STD


142 
	$__USING_NAMESPACE_STD
(
tm
)

145 
__BEGIN_NAMESPACE_STD


147 
wch¬_t
 *
	$wcsıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

148 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
)

149 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

152 
wch¬_t
 *
	$wc¢ıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

153 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

154 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

157 
wch¬_t
 *
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

158 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
)

159 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

161 
wch¬_t
 *
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

162 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

163 
__THROW
 
	`__nÚnuÎ
 ((1, 2));

166 
	$wcscmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
)

167 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

169 
	$wc¢cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

170 
__THROW
 
__©Œibu‹_pu»__
 
	`__nÚnuÎ
 ((1, 2));

171 
__END_NAMESPACE_STD


173 #ifdeà
__USE_XOPEN2K8


175 
	$wcsÿ£cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

178 
	$wc¢ÿ£cmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

179 
size_t
 
__n
è
__THROW
;

183 
	~<xloÿË.h
>

185 
	$wcsÿ£cmp_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

186 
__loÿË_t
 
__loc
è
__THROW
;

188 
	$wc¢ÿ£cmp_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

189 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

192 
__BEGIN_NAMESPACE_STD


195 
	$wcscŞl
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
è
__THROW
;

199 
size_t
 
	$wcsxäm
 (
wch¬_t
 *
__»¡riù
 
__s1
,

200 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

201 
__END_NAMESPACE_STD


203 #ifdeà
__USE_XOPEN2K8


209 
	$wcscŞl_l
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

210 
__loÿË_t
 
__loc
è
__THROW
;

215 
size_t
 
	$wcsxäm_l
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

216 
size_t
 
__n
, 
__loÿË_t
 
__loc
è
__THROW
;

219 
wch¬_t
 *
	$wcsdup
 (cÚ¡ 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_m®loc__
;

222 
__BEGIN_NAMESPACE_STD


224 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


225 "C++" 
wch¬_t
 *
	$wcschr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

226 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

227 "C++" cÚ¡ 
wch¬_t
 *
	$wcschr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

228 
__THROW
 
	`__asm
 ("wcschr"è
__©Œibu‹_pu»__
;

230 
wch¬_t
 *
	$wcschr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

231 
__THROW
 
__©Œibu‹_pu»__
;

234 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


235 "C++" 
wch¬_t
 *
	$wc¤chr
 (
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

236 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

237 "C++" cÚ¡ 
wch¬_t
 *
	$wc¤chr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

238 
__THROW
 
	`__asm
 ("wc¤chr"è
__©Œibu‹_pu»__
;

240 
wch¬_t
 *
	$wc¤chr
 (cÚ¡ 
wch¬_t
 *
__wcs
, wch¬_ˆ
__wc
)

241 
__THROW
 
__©Œibu‹_pu»__
;

243 
__END_NAMESPACE_STD


245 #ifdeà
__USE_GNU


248 
wch¬_t
 *
	$wcschºul
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__wc
)

249 
__THROW
 
__©Œibu‹_pu»__
;

252 
__BEGIN_NAMESPACE_STD


255 
size_t
 
	$wcsc¥n
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__»jeù
)

256 
__THROW
 
__©Œibu‹_pu»__
;

259 
size_t
 
	$wcs¥n
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

260 
__THROW
 
__©Œibu‹_pu»__
;

262 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


263 "C++" 
wch¬_t
 *
	$wc¥brk
 (
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

264 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

265 "C++" cÚ¡ 
wch¬_t
 *
	$wc¥brk
 (cÚ¡ 
wch¬_t
 *
__wcs
,

266 cÚ¡ 
wch¬_t
 *
__acû±
)

267 
__THROW
 
	`__asm
 ("wc¥brk"è
__©Œibu‹_pu»__
;

269 
wch¬_t
 *
	$wc¥brk
 (cÚ¡ 
wch¬_t
 *
__wcs
, cÚ¡ wch¬_ˆ*
__acû±
)

270 
__THROW
 
__©Œibu‹_pu»__
;

273 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


274 "C++" 
wch¬_t
 *
	$wcs¡r
 (
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

275 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

276 "C++" cÚ¡ 
wch¬_t
 *
	$wcs¡r
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
,

277 cÚ¡ 
wch¬_t
 *
__ÃedË
)

278 
__THROW
 
	`__asm
 ("wcs¡r"è
__©Œibu‹_pu»__
;

280 
wch¬_t
 *
	$wcs¡r
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

281 
__THROW
 
__©Œibu‹_pu»__
;

285 
wch¬_t
 *
	$wc¡ok
 (
wch¬_t
 *
__»¡riù
 
__s
,

286 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__d–im
,

287 
wch¬_t
 **
__»¡riù
 
__±r
è
__THROW
;

290 
size_t
 
	$wc¦’
 (cÚ¡ 
wch¬_t
 *
__s
è
__THROW
 
__©Œibu‹_pu»__
;

291 
__END_NAMESPACE_STD


293 #ifdeà
__USE_XOPEN


295 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


296 "C++" 
wch¬_t
 *
	$wcswcs
 (
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

297 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

298 "C++" cÚ¡ 
wch¬_t
 *
	$wcswcs
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
,

299 cÚ¡ 
wch¬_t
 *
__ÃedË
)

300 
__THROW
 
	`__asm
 ("wcswcs"è
__©Œibu‹_pu»__
;

302 
wch¬_t
 *
	$wcswcs
 (cÚ¡ 
wch¬_t
 *
__hay¡ack
, cÚ¡ wch¬_ˆ*
__ÃedË
)

303 
__THROW
 
__©Œibu‹_pu»__
;

307 #ifdeà
__USE_XOPEN2K8


309 
size_t
 
	$wc¢Ën
 (cÚ¡ 
wch¬_t
 *
__s
, 
size_t
 
__maxËn
)

310 
__THROW
 
__©Œibu‹_pu»__
;

314 
__BEGIN_NAMESPACE_STD


316 #ifdeà
__CORRECT_ISO_CPP_WCHAR_H_PROTO


317 "C++" 
wch¬_t
 *
	$wmemchr
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

318 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

319 "C++" cÚ¡ 
wch¬_t
 *
	$wmemchr
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__c
,

320 
size_t
 
__n
)

321 
__THROW
 
	`__asm
 ("wmemchr"è
__©Œibu‹_pu»__
;

323 
wch¬_t
 *
	$wmemchr
 (cÚ¡ 
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
)

324 
__THROW
 
__©Œibu‹_pu»__
;

328 
	$wmemcmp
 (cÚ¡ 
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

329 
__THROW
 
__©Œibu‹_pu»__
;

332 
wch¬_t
 *
	$wmemıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

333 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
è
__THROW
;

337 
wch¬_t
 *
	$wmemmove
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
)

338 
__THROW
;

341 
wch¬_t
 *
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
è
__THROW
;

342 
__END_NAMESPACE_STD


344 #ifdeà
__USE_GNU


347 
wch¬_t
 *
	$wmempıy
 (
wch¬_t
 *
__»¡riù
 
__s1
,

348 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
)

349 
__THROW
;

353 
__BEGIN_NAMESPACE_STD


356 
wšt_t
 
	$btowc
 (
__c
è
__THROW
;

360 
	$wùob
 (
wšt_t
 
__c
è
__THROW
;

364 
	$mbsš™
 (cÚ¡ 
mb¡©e_t
 *
__ps
è
__THROW
 
__©Œibu‹_pu»__
;

368 
size_t
 
	$mb¹owc
 (
wch¬_t
 *
__»¡riù
 
__pwc
,

369 cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

370 
mb¡©e_t
 *
__»¡riù
 
__p
è
__THROW
;

373 
size_t
 
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wc
,

374 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

377 
size_t
 
	$__mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

378 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

379 
size_t
 
	$mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

380 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

381 
__END_NAMESPACE_STD


383 #ifdeà
__USE_EXTERN_INLINES


389 
wšt_t
 
	$__btowc_®Ÿs
 (
__c
è
	`__asm
 ("btowc");

390 
__ex‹º_šlše
 
wšt_t


391 
	`__NTH
 (
	$btowc
 (
__c
))

392 {  (
	`__butš_cÚ¡ªt_p
 (
__c
) && __c >= '\0' && __c <= '\x7f'

393 ? (
wšt_t
è
__c
 : 
	`__btowc_®Ÿs
 (__c)); 
	}
}

395 
	$__wùob_®Ÿs
 (
wšt_t
 
__c
è
	`__asm
 ("wctob");

396 
__ex‹º_šlše
 

397 
	`__NTH
 (
	$wùob
 (
wšt_t
 
__wc
))

398 {  (
	`__butš_cÚ¡ªt_p
 (
__wc
è&& __wø>ğ
L
'\0' && __wc <= L'\x7f'

399 ? (è
__wc
 : 
	`__wùob_®Ÿs
 (__wc)); 
	}
}

401 
__ex‹º_šlše
 
size_t


402 
__NTH
 (
	$mb¾’
 (cÚ¡ *
__»¡riù
 
__s
, 
size_t
 
__n
,

403 
mb¡©e_t
 *
__»¡riù
 
__ps
))

404 {  (
__ps
 !ğ
NULL


405 ? 
	`mb¹owc
 (
NULL
, 
__s
, 
__n
, 
__ps
è: 
	`__mb¾’
 (__s, __n, NULL)); 
	}
}

408 
__BEGIN_NAMESPACE_STD


411 
size_t
 
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

412 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

413 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

417 
size_t
 
	$wc¤tombs
 (*
__»¡riù
 
__d¡
,

418 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
, 
size_t
 
__Ën
,

419 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

420 
__END_NAMESPACE_STD


423 #ifdef 
__USE_XOPEN2K8


426 
size_t
 
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

427 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

428 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

432 
size_t
 
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
,

433 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

434 
size_t
 
__nwc
, size_ˆ
__Ën
,

435 
mb¡©e_t
 *
__»¡riù
 
__ps
è
__THROW
;

440 #ifdeà
__USE_XOPEN


442 
	$wcwidth
 (
wch¬_t
 
__c
è
__THROW
;

446 
	$wcswidth
 (cÚ¡ 
wch¬_t
 *
__s
, 
size_t
 
__n
è
__THROW
;

450 
__BEGIN_NAMESPACE_STD


453 
	$wc¡od
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

454 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

455 
__END_NAMESPACE_STD


457 #ifdeà
__USE_ISOC99


458 
__BEGIN_NAMESPACE_C99


460 
	$wc¡of
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

461 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

462 
	$wc¡Şd
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

463 
wch¬_t
 **
__»¡riù
 
__’d±r
è
__THROW
;

464 
__END_NAMESPACE_C99


468 
__BEGIN_NAMESPACE_STD


471 
	$wc¡Ş
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

472 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
è
__THROW
;

476 
	$wc¡oul
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

477 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

478 
__THROW
;

479 
__END_NAMESPACE_STD


481 #ifdeà
__USE_ISOC99


482 
__BEGIN_NAMESPACE_C99


485 
__ex‹nsiÚ__


486 
	$wc¡Şl
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

487 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

488 
__THROW
;

492 
__ex‹nsiÚ__


493 
	$wc¡ouÎ
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

494 
wch¬_t
 **
__»¡riù
 
__’d±r
,

495 
__ba£
è
__THROW
;

496 
__END_NAMESPACE_C99


499 #ifdeà
__USE_GNU


502 
__ex‹nsiÚ__


503 
	$wc¡oq
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

504 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
)

505 
__THROW
;

509 
__ex‹nsiÚ__


510 
	$wc¡ouq
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

511 
wch¬_t
 **
__»¡riù
 
__’d±r
,

512 
__ba£
è
__THROW
;

515 #ifdeà
__USE_GNU


529 
	~<xloÿË.h
>

533 
	$wc¡Ş_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

534 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__ba£
,

535 
__loÿË_t
 
__loc
è
__THROW
;

537 
	$wc¡oul_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

538 
wch¬_t
 **
__»¡riù
 
__’d±r
,

539 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

541 
__ex‹nsiÚ__


542 
	$wc¡Şl_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

543 
wch¬_t
 **
__»¡riù
 
__’d±r
,

544 
__ba£
, 
__loÿË_t
 
__loc
è
__THROW
;

546 
__ex‹nsiÚ__


547 
	$wc¡ouÎ_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

548 
wch¬_t
 **
__»¡riù
 
__’d±r
,

549 
__ba£
, 
__loÿË_t
 
__loc
)

550 
__THROW
;

552 
	$wc¡od_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

553 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

554 
__THROW
;

556 
	$wc¡of_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

557 
wch¬_t
 **
__»¡riù
 
__’d±r
, 
__loÿË_t
 
__loc
)

558 
__THROW
;

560 
	$wc¡Şd_l
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ÅŒ
,

561 
wch¬_t
 **
__»¡riù
 
__’d±r
,

562 
__loÿË_t
 
__loc
è
__THROW
;

566 #ifdeà
__USE_XOPEN2K8


569 
wch¬_t
 *
	$wııy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

570 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
è
__THROW
;

574 
wch¬_t
 *
	$wınıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

575 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
)

576 
__THROW
;

583 
__FILE
 *
	$İ’_wmem¡»am
 (
wch¬_t
 **
__buæoc
, 
size_t
 *
__siz–oc
è
__THROW
;

586 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


587 
__BEGIN_NAMESPACE_STD


590 
	$fwide
 (
__FILE
 *
__å
, 
__mode
è
__THROW
;

597 
	`fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

598 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

604 
	`w´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

607 
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

608 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

609 
__THROW
 ;

615 
	`vfw´štf
 (
__FILE
 *
__»¡riù
 
__s
,

616 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

617 
__gnuc_va_li¡
 
__¬g
)

623 
	`vw´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

624 
__gnuc_va_li¡
 
__¬g
)

628 
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

629 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

630 
__gnuc_va_li¡
 
__¬g
)

631 
__THROW
 ;

638 
	`fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

639 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

645 
	`wsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

648 
	$swsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

649 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

650 
__THROW
 ;

652 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

653 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

654 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

655 #ifdeà
__REDIRECT


659 
	`__REDIRECT
 (
fwsÿnf
, (
__FILE
 *
__»¡riù
 
__¡»am
,

660 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

661 
__isoc99_fwsÿnf
)

663 
	`__REDIRECT
 (
wsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...),

664 
__isoc99_wsÿnf
)

666 
	`__REDIRECT_NTH
 (
swsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

667 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

668 ...), 
__isoc99_swsÿnf
)

671 
	`__isoc99_fwsÿnf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

672 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

673 
	`__isoc99_wsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

674 
	$__isoc99_swsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

675 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

676 
__THROW
;

677 
	#fwsÿnf
 
__isoc99_fwsÿnf


	)

678 
	#wsÿnf
 
__isoc99_wsÿnf


	)

679 
	#swsÿnf
 
__isoc99_swsÿnf


	)

683 
__END_NAMESPACE_STD


686 #ifdeà
__USE_ISOC99


687 
__BEGIN_NAMESPACE_C99


692 
	`vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

693 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

694 
__gnuc_va_li¡
 
__¬g
)

700 
	`vwsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

701 
__gnuc_va_li¡
 
__¬g
)

704 
	$vswsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

705 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

706 
__gnuc_va_li¡
 
__¬g
)

707 
__THROW
 ;

709 #ià!
defšed
 
__USE_GNU
 \

710 && (!
defšed
 
__LDBL_COMPAT
 || !defšed 
__REDIRECT
) \

711 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

712 #ifdeà
__REDIRECT


713 
	`__REDIRECT
 (
vfwsÿnf
, (
__FILE
 *
__»¡riù
 
__s
,

714 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

715 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vfwsÿnf
)

717 
	`__REDIRECT
 (
vwsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

718 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vwsÿnf
)

720 
	`__REDIRECT_NTH
 (
vswsÿnf
, (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

721 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

722 
__gnuc_va_li¡
 
__¬g
), 
__isoc99_vswsÿnf
)

725 
	`__isoc99_vfwsÿnf
 (
__FILE
 *
__»¡riù
 
__s
,

726 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

727 
__gnuc_va_li¡
 
__¬g
);

728 
	`__isoc99_vwsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

729 
__gnuc_va_li¡
 
__¬g
);

730 
	$__isoc99_vswsÿnf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s
,

731 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

732 
__gnuc_va_li¡
 
__¬g
è
__THROW
;

733 
	#vfwsÿnf
 
__isoc99_vfwsÿnf


	)

734 
	#vwsÿnf
 
__isoc99_vwsÿnf


	)

735 
	#vswsÿnf
 
__isoc99_vswsÿnf


	)

739 
__END_NAMESPACE_C99


743 
__BEGIN_NAMESPACE_STD


748 
wšt_t
 
	`fg‘wc
 (
__FILE
 *
__¡»am
);

749 
wšt_t
 
	`g‘wc
 (
__FILE
 *
__¡»am
);

755 
wšt_t
 
	`g‘wch¬
 ();

762 
wšt_t
 
	`åutwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

763 
wšt_t
 
	`putwc
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

769 
wšt_t
 
	`putwch¬
 (
wch¬_t
 
__wc
);

777 
wch¬_t
 *
	`fg‘ws
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

778 
__FILE
 *
__»¡riù
 
__¡»am
);

784 
	`åutws
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ws
,

785 
__FILE
 *
__»¡riù
 
__¡»am
);

792 
wšt_t
 
	`ung‘wc
 (wšt_ˆ
__wc
, 
__FILE
 *
__¡»am
);

793 
__END_NAMESPACE_STD


796 #ifdeà
__USE_GNU


804 
wšt_t
 
	`g‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

805 
wšt_t
 
	`g‘wch¬_uÆocked
 ();

813 
wšt_t
 
	`fg‘wc_uÆocked
 (
__FILE
 *
__¡»am
);

821 
wšt_t
 
	`åutwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

830 
wšt_t
 
	`putwc_uÆocked
 (
wch¬_t
 
__wc
, 
__FILE
 *
__¡»am
);

831 
wšt_t
 
	`putwch¬_uÆocked
 (
wch¬_t
 
__wc
);

840 
wch¬_t
 *
	`fg‘ws_uÆocked
 (wch¬_ˆ*
__»¡riù
 
__ws
, 
__n
,

841 
__FILE
 *
__»¡riù
 
__¡»am
);

849 
	`åutws_uÆocked
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__ws
,

850 
__FILE
 *
__»¡riù
 
__¡»am
);

854 
__BEGIN_NAMESPACE_C99


858 
size_t
 
	$wcsáime
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

859 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

860 cÚ¡ 
tm
 *
__»¡riù
 
__
è
__THROW
;

861 
__END_NAMESPACE_C99


863 #ifdeà
__USE_GNU


864 
	~<xloÿË.h
>

868 
size_t
 
	$wcsáime_l
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__maxsize
,

869 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

870 cÚ¡ 
tm
 *
__»¡riù
 
__
,

871 
__loÿË_t
 
__loc
è
__THROW
;

880 #ià
defšed
 
__USE_UNIX98
 && !defšed 
__USE_GNU


881 
	#__Ãed_iswxxx


	)

882 
	~<wùy³.h
>

886 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


887 
	~<b™s/wch¬2.h
>

890 #ifdeà
__LDBL_COMPAT


891 
	~<b™s/wch¬-ldbl.h
>

894 
__END_DECLS


902 #undeà
__Ãed_mb¡©e_t


903 #undeà
__Ãed_wšt_t


	@/usr/include/asm-generic/bitsperlong.h

1 #iâdeà
__ASM_GENERIC_BITS_PER_LONG


2 
	#__ASM_GENERIC_BITS_PER_LONG


	)

11 #iâdeà
__BITS_PER_LONG


12 
	#__BITS_PER_LONG
 32

	)

	@/usr/include/asm-generic/param.h

1 #iâdeà
__ASM_GENERIC_PARAM_H


2 
	#__ASM_GENERIC_PARAM_H


	)

4 #iâdeà
HZ


5 
	#HZ
 100

	)

8 #iâdeà
EXEC_PAGESIZE


9 
	#EXEC_PAGESIZE
 4096

	)

12 #iâdeà
NOGROUP


13 
	#NOGROUP
 (-1)

	)

16 
	#MAXHOSTNAMELEN
 64

	)

	@/usr/include/asm-generic/posix_types.h

1 #iâdeà
__ASM_GENERIC_POSIX_TYPES_H


2 
	#__ASM_GENERIC_POSIX_TYPES_H


	)

4 
	~<asm/b™¥”lÚg.h
>

13 #iâdeà
__k”Ãl_lÚg_t


14 
	t__k”Ãl_lÚg_t
;

15 
	t__k”Ãl_ulÚg_t
;

18 #iâdeà
__k”Ãl_šo_t


19 
__k”Ãl_ulÚg_t
 
	t__k”Ãl_šo_t
;

22 #iâdeà
__k”Ãl_mode_t


23 
	t__k”Ãl_mode_t
;

26 #iâdeà
__k”Ãl_pid_t


27 
	t__k”Ãl_pid_t
;

30 #iâdeà
__k”Ãl_c_pid_t


31 
	t__k”Ãl_c_pid_t
;

34 #iâdeà
__k”Ãl_uid_t


35 
	t__k”Ãl_uid_t
;

36 
	t__k”Ãl_gid_t
;

39 #iâdeà
__k”Ãl_su£cÚds_t


40 
__k”Ãl_lÚg_t
 
	t__k”Ãl_su£cÚds_t
;

43 #iâdeà
__k”Ãl_daddr_t


44 
	t__k”Ãl_daddr_t
;

47 #iâdeà
__k”Ãl_uid32_t


48 
	t__k”Ãl_uid32_t
;

49 
	t__k”Ãl_gid32_t
;

52 #iâdeà
__k”Ãl_Şd_uid_t


53 
__k”Ãl_uid_t
 
	t__k”Ãl_Şd_uid_t
;

54 
__k”Ãl_gid_t
 
	t__k”Ãl_Şd_gid_t
;

57 #iâdeà
__k”Ãl_Şd_dev_t


58 
	t__k”Ãl_Şd_dev_t
;

65 #iâdeà
__k”Ãl_size_t


66 #ià
__BITS_PER_LONG
 != 64

67 
	t__k”Ãl_size_t
;

68 
	t__k”Ãl_ssize_t
;

69 
	t__k”Ãl_±rdiff_t
;

71 
__k”Ãl_ulÚg_t
 
	t__k”Ãl_size_t
;

72 
__k”Ãl_lÚg_t
 
	t__k”Ãl_ssize_t
;

73 
__k”Ãl_lÚg_t
 
	t__k”Ãl_±rdiff_t
;

77 #iâdeà
__k”Ãl_fsid_t


79 
	mv®
[2];

80 } 
	t__k”Ãl_fsid_t
;

86 
__k”Ãl_lÚg_t
 
	t__k”Ãl_off_t
;

87 
	t__k”Ãl_loff_t
;

88 
__k”Ãl_lÚg_t
 
	t__k”Ãl_time_t
;

89 
__k”Ãl_lÚg_t
 
	t__k”Ãl_şock_t
;

90 
	t__k”Ãl_tim”_t
;

91 
	t__k”Ãl_şockid_t
;

92 * 
	t__k”Ãl_ÿddr_t
;

93 
	t__k”Ãl_uid16_t
;

94 
	t__k”Ãl_gid16_t
;

	@/usr/include/asm/sockios.h

1 
	~<asm-g’”ic/sockios.h
>

	@/usr/include/asm/swab.h

1 #iâdeà
_ASM_X86_SWAB_H


2 
	#_ASM_X86_SWAB_H


	)

4 
	~<lšux/ty³s.h
>

7 
__šlše__
 
__u32
 
	$__¬ch_swab32
(
__u32
 
v®
)

9 
	`__asm__
("bsw­È%0" : "ô" (
v®
) : "0" (val));

10  
v®
;

11 
	}
}

12 
	#__¬ch_swab32
 
__¬ch_swab32


	)

14 
__šlše__
 
__u64
 
	$__¬ch_swab64
(
__u64
 
v®
)

16 #ifdeà
__i386__


19 
__u32
 
a
;

20 
__u32
 
b
;

21 } 
s
;

22 
__u64
 
u
;

23 } 
v
;

24 
v
.
u
 = 
v®
;

25 
	`__asm__
("bswapl %0 ; bswapl %1 ; xchgl %0,%1"

26 : "ô" (
v
.
s
.
a
), "ô" (v.s.
b
)

27 : "0" (
v
.
s
.
a
), "1" (v.s.
b
));

28  
v
.
u
;

30 
	`__asm__
("bsw­q %0" : "ô" (
v®
) : "0" (val));

31  
v®
;

33 
	}
}

34 
	#__¬ch_swab64
 
__¬ch_swab64


	)

	@/usr/include/bits/wchar-ldbl.h

19 #iâdeà
_WCHAR_H


23 #ià
defšed
 
__USE_ISOC95
 || defšed 
__USE_UNIX98


24 
__BEGIN_NAMESPACE_C99


25 
__LDBL_REDIR_DECL
 (
fw´štf
);

26 
__LDBL_REDIR_DECL
 (
w´štf
);

27 
__LDBL_REDIR_DECL
 (
sw´štf
);

28 
__LDBL_REDIR_DECL
 (
vfw´štf
);

29 
__LDBL_REDIR_DECL
 (
vw´štf
);

30 
__LDBL_REDIR_DECL
 (
vsw´štf
);

31 #ià
defšed
 
__USE_ISOC99
 && !defšed 
__USE_GNU
 \

32 && !
defšed
 
	g__REDIRECT
 \

33 && (
defšed
 
	g__STRICT_ANSI__
 || defšed 
	g__USE_XOPEN2K
)

34 
	$__LDBL_REDIR1_DECL
 (
fwsÿnf
, 
__Ædbl___isoc99_fwsÿnf
)

35 
	$__LDBL_REDIR1_DECL
 (
wsÿnf
, 
__Ædbl___isoc99_wsÿnf
)

36 
	$__LDBL_REDIR1_DECL
 (
swsÿnf
, 
__Ædbl___isoc99_swsÿnf
)

38 
	`__LDBL_REDIR_DECL
 (
fwsÿnf
);

39 
	`__LDBL_REDIR_DECL
 (
wsÿnf
);

40 
	`__LDBL_REDIR_DECL
 (
swsÿnf
);

42 
__END_NAMESPACE_C99


45 #ifdeà
__USE_ISOC99


46 
__BEGIN_NAMESPACE_C99


47 
	`__LDBL_REDIR1_DECL
 (
wc¡Şd
, 
wc¡od
);

48 #ià!
defšed
 
__USE_GNU
 && !defšed 
__REDIRECT
 \

49 && (
defšed
 
__STRICT_ANSI__
 || defšed 
__USE_XOPEN2K
)

50 
	$__LDBL_REDIR1_DECL
 (
vfwsÿnf
, 
__Ædbl___isoc99_vfwsÿnf
)

51 
	$__LDBL_REDIR1_DECL
 (
vwsÿnf
, 
__Ædbl___isoc99_vwsÿnf
)

52 
	$__LDBL_REDIR1_DECL
 (
vswsÿnf
, 
__Ædbl___isoc99_vswsÿnf
)

54 
	`__LDBL_REDIR_DECL
 (
vfwsÿnf
);

55 
	`__LDBL_REDIR_DECL
 (
vwsÿnf
);

56 
	`__LDBL_REDIR_DECL
 (
vswsÿnf
);

58 
__END_NAMESPACE_C99


61 #ifdeà
__USE_GNU


62 
	`__LDBL_REDIR1_DECL
 (
wc¡Şd_l
, 
wc¡od_l
);

65 #ià
__USE_FORTIFY_LEVEL
 > 0 && 
defšed
 
__fÜtify_funùiÚ


66 
	$__LDBL_REDIR_DECL
 (
__sw´štf_chk
)

67 
	$__LDBL_REDIR_DECL
 (
__vsw´štf_chk
)

68 #ià
__USE_FORTIFY_LEVEL
 > 1

69 
	$__LDBL_REDIR_DECL
 (
__fw´štf_chk
)

70 
	$__LDBL_REDIR_DECL
 (
__w´štf_chk
)

71 
	$__LDBL_REDIR_DECL
 (
__vfw´štf_chk
)

72 
	$__LDBL_REDIR_DECL
 (
__vw´štf_chk
)

	@/usr/include/bits/wchar2.h

19 #iâdeà
_WCHAR_H


24 
wch¬_t
 *
	$__wmemıy_chk
 (
wch¬_t
 *
__»¡riù
 
__s1
,

25 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

26 
size_t
 
__ns1
è
__THROW
;

27 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemıy_®Ÿs
,

28 (
wch¬_t
 *
__»¡riù
 
__s1
,

29 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
),

30 
wmemıy
);

31 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemıy_chk_w¬n
,

32 (
wch¬_t
 *
__»¡riù
 
__s1
,

33 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

34 
size_t
 
__ns1
), 
__wmemıy_chk
)

35 
	`__w¬Ç‰r
 ("wmemcpy called with†ength biggerhan size of destination "

38 
__fÜtify_funùiÚ
 
wch¬_t
 *

39 
	`__NTH
 (
	$wmemıy
 (
wch¬_t
 *
__»¡riù
 
__s1
, cÚ¡ wch¬_ˆ*__»¡riù 
__s2
,

40 
size_t
 
__n
))

42 ià(
	`__bos0
 (
__s1
è!ğ(
size_t
) -1)

44 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

45  
	`__wmemıy_chk
 (
__s1
, 
__s2
, 
__n
,

46 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

48 ià(
__n
 > 
	`__bos0
 (
__s1
è/  (
wch¬_t
))

49  
	`__wmemıy_chk_w¬n
 (
__s1
, 
__s2
, 
__n
,

50 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

52  
	`__wmemıy_®Ÿs
 (
__s1
, 
__s2
, 
__n
);

53 
	}
}

56 
wch¬_t
 *
	$__wmemmove_chk
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

57 
size_t
 
__n
, size_ˆ
__ns1
è
__THROW
;

58 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemmove_®Ÿs
, (wch¬_ˆ*
__s1
,

59 cÚ¡ 
wch¬_t
 *
__s2
,

60 
size_t
 
__n
), 
wmemmove
);

61 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmemmove_chk_w¬n
,

62 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
,

63 
size_t
 
__n
, size_ˆ
__ns1
), 
__wmemmove_chk
)

64 
	`__w¬Ç‰r
 ("wmemmove called with†ength biggerhan size of destination "

67 
__fÜtify_funùiÚ
 
wch¬_t
 *

68 
	`__NTH
 (
	$wmemmove
 (
wch¬_t
 *
__s1
, cÚ¡ wch¬_ˆ*
__s2
, 
size_t
 
__n
))

70 ià(
	`__bos0
 (
__s1
è!ğ(
size_t
) -1)

72 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

73  
	`__wmemmove_chk
 (
__s1
, 
__s2
, 
__n
,

74 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

76 ià(
__n
 > 
	`__bos0
 (
__s1
è/  (
wch¬_t
))

77  
	`__wmemmove_chk_w¬n
 (
__s1
, 
__s2
, 
__n
,

78 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

80  
	`__wmemmove_®Ÿs
 (
__s1
, 
__s2
, 
__n
);

81 
	}
}

84 #ifdeà
__USE_GNU


85 
wch¬_t
 *
	$__wmempıy_chk
 (
wch¬_t
 *
__»¡riù
 
__s1
,

86 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

87 
size_t
 
__ns1
è
__THROW
;

88 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmempıy_®Ÿs
,

89 (
wch¬_t
 *
__»¡riù
 
__s1
,

90 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
,

91 
size_t
 
__n
), 
wmempıy
);

92 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmempıy_chk_w¬n
,

93 (
wch¬_t
 *
__»¡riù
 
__s1
,

94 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__s2
, 
size_t
 
__n
,

95 
size_t
 
__ns1
), 
__wmempıy_chk
)

96 
	`__w¬Ç‰r
 ("wmempcpy called with†ength biggerhan size of destination "

99 
__fÜtify_funùiÚ
 
wch¬_t
 *

100 
	`__NTH
 (
	$wmempıy
 (
wch¬_t
 *
__»¡riù
 
__s1
, cÚ¡ wch¬_ˆ*__»¡riù 
__s2
,

101 
size_t
 
__n
))

103 ià(
	`__bos0
 (
__s1
è!ğ(
size_t
) -1)

105 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

106  
	`__wmempıy_chk
 (
__s1
, 
__s2
, 
__n
,

107 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

109 ià(
__n
 > 
	`__bos0
 (
__s1
è/  (
wch¬_t
))

110  
	`__wmempıy_chk_w¬n
 (
__s1
, 
__s2
, 
__n
,

111 
	`__bos0
 (
__s1
è/  (
wch¬_t
));

113  
	`__wmempıy_®Ÿs
 (
__s1
, 
__s2
, 
__n
);

114 
	}
}

118 
wch¬_t
 *
	$__wmem£t_chk
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
,

119 
size_t
 
__ns
è
__THROW
;

120 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmem£t_®Ÿs
, (wch¬_ˆ*
__s
, wch¬_ˆ
__c
,

121 
size_t
 
__n
), 
wmem£t
);

122 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wmem£t_chk_w¬n
,

123 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
,

124 
size_t
 
__ns
), 
__wmem£t_chk
)

125 
	`__w¬Ç‰r
 ("wmemset called with†ength biggerhan size of destination "

128 
__fÜtify_funùiÚ
 
wch¬_t
 *

129 
	`__NTH
 (
	$wmem£t
 (
wch¬_t
 *
__s
, wch¬_ˆ
__c
, 
size_t
 
__n
))

131 ià(
	`__bos0
 (
__s
è!ğ(
size_t
) -1)

133 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

134  
	`__wmem£t_chk
 (
__s
, 
__c
, 
__n
, 
	`__bos0
 (__sè/  (
wch¬_t
));

136 ià(
__n
 > 
	`__bos0
 (
__s
è/  (
wch¬_t
))

137  
	`__wmem£t_chk_w¬n
 (
__s
, 
__c
, 
__n
,

138 
	`__bos0
 (
__s
è/  (
wch¬_t
));

140  
	`__wmem£t_®Ÿs
 (
__s
, 
__c
, 
__n
);

141 
	}
}

144 
wch¬_t
 *
	$__wcsıy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

145 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

146 
size_t
 
__n
è
__THROW
;

147 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wcsıy_®Ÿs
,

148 (
wch¬_t
 *
__»¡riù
 
__de¡
,

149 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
), 
wcsıy
);

151 
__fÜtify_funùiÚ
 
wch¬_t
 *

152 
	`__NTH
 (
	$wcsıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, cÚ¡ wch¬_ˆ*__»¡riù 
__¤c
))

154 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

155  
	`__wcsıy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__de¡è/  (
wch¬_t
));

156  
	`__wcsıy_®Ÿs
 (
__de¡
, 
__¤c
);

157 
	}
}

160 
wch¬_t
 *
	$__wııy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

161 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

162 
size_t
 
__de¡Ën
è
__THROW
;

163 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wııy_®Ÿs
,

164 (
wch¬_t
 *
__»¡riù
 
__de¡
,

165 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
), 
wııy
);

167 
__fÜtify_funùiÚ
 
wch¬_t
 *

168 
	`__NTH
 (
	$wııy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, cÚ¡ wch¬_ˆ*__»¡riù 
__¤c
))

170 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

171  
	`__wııy_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__de¡è/  (
wch¬_t
));

172  
	`__wııy_®Ÿs
 (
__de¡
, 
__¤c
);

173 
	}
}

176 
wch¬_t
 *
	$__wc¢ıy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

177 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
,

178 
size_t
 
__de¡Ën
è
__THROW
;

179 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wc¢ıy_®Ÿs
,

180 (
wch¬_t
 *
__»¡riù
 
__de¡
,

181 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

182 
size_t
 
__n
), 
wc¢ıy
);

183 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wc¢ıy_chk_w¬n
,

184 (
wch¬_t
 *
__»¡riù
 
__de¡
,

185 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

186 
size_t
 
__n
, size_ˆ
__de¡Ën
), 
__wc¢ıy_chk
)

187 
	`__w¬Ç‰r
 ("wcsncpy called with†ength biggerhan size of destination "

190 
__fÜtify_funùiÚ
 
wch¬_t
 *

191 
	`__NTH
 (
	$wc¢ıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, cÚ¡ wch¬_ˆ*__»¡riù 
__¤c
,

192 
size_t
 
__n
))

194 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

196 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

197  
	`__wc¢ıy_chk
 (
__de¡
, 
__¤c
, 
__n
,

198 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

199 ià(
__n
 > 
	`__bos
 (
__de¡
è/  (
wch¬_t
))

200  
	`__wc¢ıy_chk_w¬n
 (
__de¡
, 
__¤c
, 
__n
,

201 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

203  
	`__wc¢ıy_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

204 
	}
}

207 
wch¬_t
 *
	$__wınıy_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

208 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
, 
size_t
 
__n
,

209 
size_t
 
__de¡Ën
è
__THROW
;

210 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wınıy_®Ÿs
,

211 (
wch¬_t
 *
__»¡riù
 
__de¡
,

212 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

213 
size_t
 
__n
), 
wınıy
);

214 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wınıy_chk_w¬n
,

215 (
wch¬_t
 *
__»¡riù
 
__de¡
,

216 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

217 
size_t
 
__n
, size_ˆ
__de¡Ën
), 
__wınıy_chk
)

218 
	`__w¬Ç‰r
 ("wcpncpy called with†ength biggerhan size of destination "

221 
__fÜtify_funùiÚ
 
wch¬_t
 *

222 
	`__NTH
 (
	$wınıy
 (
wch¬_t
 *
__»¡riù
 
__de¡
, cÚ¡ wch¬_ˆ*__»¡riù 
__¤c
,

223 
size_t
 
__n
))

225 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

227 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
))

228  
	`__wınıy_chk
 (
__de¡
, 
__¤c
, 
__n
,

229 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

230 ià(
__n
 > 
	`__bos
 (
__de¡
è/  (
wch¬_t
))

231  
	`__wınıy_chk_w¬n
 (
__de¡
, 
__¤c
, 
__n
,

232 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

234  
	`__wınıy_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

235 
	}
}

238 
wch¬_t
 *
	$__wcsÿt_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

239 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

240 
size_t
 
__de¡Ën
è
__THROW
;

241 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wcsÿt_®Ÿs
,

242 (
wch¬_t
 *
__»¡riù
 
__de¡
,

243 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
), 
wcsÿt
);

245 
__fÜtify_funùiÚ
 
wch¬_t
 *

246 
	`__NTH
 (
	$wcsÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
, cÚ¡ wch¬_ˆ*__»¡riù 
__¤c
))

248 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

249  
	`__wcsÿt_chk
 (
__de¡
, 
__¤c
, 
	`__bos
 (__de¡è/  (
wch¬_t
));

250  
	`__wcsÿt_®Ÿs
 (
__de¡
, 
__¤c
);

251 
	}
}

254 
wch¬_t
 *
	$__wc¢ÿt_chk
 (
wch¬_t
 *
__»¡riù
 
__de¡
,

255 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

256 
size_t
 
__n
, size_ˆ
__de¡Ën
è
__THROW
;

257 
wch¬_t
 *
	`__REDIRECT_NTH
 (
__wc¢ÿt_®Ÿs
,

258 (
wch¬_t
 *
__»¡riù
 
__de¡
,

259 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__¤c
,

260 
size_t
 
__n
), 
wc¢ÿt
);

262 
__fÜtify_funùiÚ
 
wch¬_t
 *

263 
	`__NTH
 (
	$wc¢ÿt
 (
wch¬_t
 *
__»¡riù
 
__de¡
, cÚ¡ wch¬_ˆ*__»¡riù 
__¤c
,

264 
size_t
 
__n
))

266 ià(
	`__bos
 (
__de¡
è!ğ(
size_t
) -1)

267  
	`__wc¢ÿt_chk
 (
__de¡
, 
__¤c
, 
__n
,

268 
	`__bos
 (
__de¡
è/  (
wch¬_t
));

269  
	`__wc¢ÿt_®Ÿs
 (
__de¡
, 
__¤c
, 
__n
);

270 
	}
}

273 
	$__sw´štf_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

274 
__æag
, 
size_t
 
__s_Ën
,

275 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...)

276 
__THROW
 ;

278 
	`__REDIRECT_NTH_LDBL
 (
__sw´štf_®Ÿs
,

279 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

280 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fmt
, ...),

281 
sw´štf
);

283 #ifdeà
__va_¬g_·ck


284 
__fÜtify_funùiÚ
 

285 
	`__NTH
 (
	$sw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

286 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fmt
, ...))

288 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 || 
__USE_FORTIFY_LEVEL
 > 1)

289  
	`__sw´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

290 
	`__bos
 (
__s
è/  (
wch¬_t
),

291 
__fmt
, 
	`__va_¬g_·ck
 ());

292  
	`__sw´štf_®Ÿs
 (
__s
, 
__n
, 
__fmt
, 
	`__va_¬g_·ck
 ());

293 
	}
}

294 #–ià!
defšed
 
__ılu¥lus


296 
	#sw´štf
(
s
, 
n
, ...) \

297 (
	`__bos
 (
s
è!ğ(
size_t
è-1 || 
__USE_FORTIFY_LEVEL
 > 1 \

298 ? 
	`__sw´štf_chk
 (
s
, 
n
, 
__USE_FORTIFY_LEVEL
 - 1, \

299 
	`__bos
 (
s
è/  (
wch¬_t
), 
__VA_ARGS__
) \

300 : 
	`sw´štf
 (
s
, 
n
, 
__VA_ARGS__
))

	)

303 
	$__vsw´štf_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

304 
__æag
, 
size_t
 
__s_Ën
,

305 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

306 
__gnuc_va_li¡
 
__¬g
)

307 
__THROW
 ;

309 
	`__REDIRECT_NTH_LDBL
 (
__vsw´štf_®Ÿs
,

310 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

311 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fmt
,

312 
__gnuc_va_li¡
 
__­
), 
vsw´štf
);

314 
__fÜtify_funùiÚ
 

315 
	`__NTH
 (
	$vsw´štf
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__n
,

316 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fmt
, 
__gnuc_va_li¡
 
__­
))

318 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 || 
__USE_FORTIFY_LEVEL
 > 1)

319  
	`__vsw´štf_chk
 (
__s
, 
__n
, 
__USE_FORTIFY_LEVEL
 - 1,

320 
	`__bos
 (
__s
è/  (
wch¬_t
), 
__fmt
, 
__­
);

321  
	`__vsw´štf_®Ÿs
 (
__s
, 
__n
, 
__fmt
, 
__­
);

322 
	}
}

325 #ià
__USE_FORTIFY_LEVEL
 > 1

327 
__fw´štf_chk
 (
__FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

328 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
, ...);

329 
__w´štf_chk
 (
__æag
, cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

331 
__vfw´štf_chk
 (
__FILE
 *
__»¡riù
 
__¡»am
, 
__æag
,

332 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

333 
__gnuc_va_li¡
 
__­
);

334 
__vw´štf_chk
 (
__æag
, cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fÜm©
,

335 
__gnuc_va_li¡
 
__­
);

337 #ifdeà
__va_¬g_·ck


338 
__fÜtify_funùiÚ
 

339 
	$w´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fmt
, ...)

341  
	`__w´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
	`__va_¬g_·ck
 ());

342 
	}
}

344 
__fÜtify_funùiÚ
 

345 
	$fw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
, cÚ¡ 
wch¬_t
 *__»¡riù 
__fmt
, ...)

347  
	`__fw´štf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
,

348 
	`__va_¬g_·ck
 ());

349 
	}
}

350 #–ià!
defšed
 
__ılu¥lus


351 
	#w´štf
(...) \

352 
	`__w´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

353 
	#fw´štf
(
¡»am
, ...) \

354 
	`__fw´štf_chk
 (
¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__VA_ARGS__
)

	)

357 
__fÜtify_funùiÚ
 

358 
	$vw´štf
 (cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fmt
, 
__gnuc_va_li¡
 
__­
)

360  
	`__vw´štf_chk
 (
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

361 
	}
}

363 
__fÜtify_funùiÚ
 

364 
	$vfw´štf
 (
__FILE
 *
__»¡riù
 
__¡»am
,

365 cÚ¡ 
wch¬_t
 *
__»¡riù
 
__fmt
, 
__gnuc_va_li¡
 
__­
)

367  
	`__vfw´štf_chk
 (
__¡»am
, 
__USE_FORTIFY_LEVEL
 - 1, 
__fmt
, 
__­
);

368 
	}
}

372 
wch¬_t
 *
	$__fg‘ws_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

373 
__FILE
 *
__»¡riù
 
__¡»am
è
__wur
;

374 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_®Ÿs
,

375 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
,

376 
__FILE
 *
__»¡riù
 
__¡»am
), 
fg‘ws
è
__wur
;

377 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_chk_w¬n
,

378 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

379 
__FILE
 *
__»¡riù
 
__¡»am
), 
__fg‘ws_chk
)

380 
__wur
 
	`__w¬Ç‰r
 ("fgetws called with bigger sizehan†ength "

383 
__fÜtify_funùiÚ
 
__wur
 
wch¬_t
 *

384 
	$fg‘ws
 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
, 
__FILE
 *__»¡riù 
__¡»am
)

386 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

388 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

389  
	`__fg‘ws_chk
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

390 
__n
, 
__¡»am
);

392 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
è/  (
wch¬_t
))

393  
	`__fg‘ws_chk_w¬n
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

394 
__n
, 
__¡»am
);

396  
	`__fg‘ws_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

397 
	}
}

399 #ifdeà
__USE_GNU


400 
wch¬_t
 *
	$__fg‘ws_uÆocked_chk
 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
,

401 
__n
, 
__FILE
 *
__»¡riù
 
__¡»am
)

402 
__wur
;

403 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_uÆocked_®Ÿs
,

404 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
,

405 
__FILE
 *
__»¡riù
 
__¡»am
), 
fg‘ws_uÆocked
)

406 
__wur
;

407 
wch¬_t
 *
	`__REDIRECT
 (
__fg‘ws_uÆocked_chk_w¬n
,

408 (
wch¬_t
 *
__»¡riù
 
__s
, 
size_t
 
__size
, 
__n
,

409 
__FILE
 *
__»¡riù
 
__¡»am
),

410 
__fg‘ws_uÆocked_chk
)

411 
__wur
 
	`__w¬Ç‰r
 ("fgetws_unlocked called with bigger sizehan†ength "

414 
__fÜtify_funùiÚ
 
__wur
 
wch¬_t
 *

415 
	$fg‘ws_uÆocked
 (
wch¬_t
 *
__»¡riù
 
__s
, 
__n
, 
__FILE
 *__»¡riù 
__¡»am
)

417 ià(
	`__bos
 (
__s
è!ğ(
size_t
) -1)

419 ià(!
	`__butš_cÚ¡ªt_p
 (
__n
) || __n <= 0)

420  
	`__fg‘ws_uÆocked_chk
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

421 
__n
, 
__¡»am
);

423 ià((
size_t
è
__n
 > 
	`__bos
 (
__s
è/  (
wch¬_t
))

424  
	`__fg‘ws_uÆocked_chk_w¬n
 (
__s
, 
	`__bos
 (__sè/  (
wch¬_t
),

425 
__n
, 
__¡»am
);

427  
	`__fg‘ws_uÆocked_®Ÿs
 (
__s
, 
__n
, 
__¡»am
);

428 
	}
}

432 
size_t
 
	$__wütomb_chk
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wch¬
,

433 
mb¡©e_t
 *
__»¡riù
 
__p
,

434 
size_t
 
__buæ’
è
__THROW
 
__wur
;

435 
size_t
 
	`__REDIRECT_NTH
 (
__wütomb_®Ÿs
,

436 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wch¬
,

437 
mb¡©e_t
 *
__»¡riù
 
__ps
), 
wütomb
è
__wur
;

439 
__fÜtify_funùiÚ
 
__wur
 
size_t


440 
	`__NTH
 (
	$wütomb
 (*
__»¡riù
 
__s
, 
wch¬_t
 
__wch¬
,

441 
mb¡©e_t
 *
__»¡riù
 
__ps
))

446 
	#__WCHAR_MB_LEN_MAX
 16

	)

447 #ià
defšed
 
MB_LEN_MAX
 && MB_LEN_MAX !ğ
__WCHAR_MB_LEN_MAX


450 ià(
	`__bos
 (
__s
è!ğ(
size_t
è-1 && 
__WCHAR_MB_LEN_MAX
 > __bos (__s))

451  
	`__wütomb_chk
 (
__s
, 
__wch¬
, 
__ps
, 
	`__bos
 (__s));

452  
	`__wütomb_®Ÿs
 (
__s
, 
__wch¬
, 
__ps
);

453 
	}
}

456 
size_t
 
	$__mb¤towcs_chk
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

457 cÚ¡ **
__»¡riù
 
__¤c
,

458 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

459 
size_t
 
__d¡Ën
è
__THROW
;

460 
size_t
 
	`__REDIRECT_NTH
 (
__mb¤towcs_®Ÿs
,

461 (
wch¬_t
 *
__»¡riù
 
__d¡
,

462 cÚ¡ **
__»¡riù
 
__¤c
,

463 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
),

464 
mb¤towcs
);

465 
size_t
 
	`__REDIRECT_NTH
 (
__mb¤towcs_chk_w¬n
,

466 (
wch¬_t
 *
__»¡riù
 
__d¡
,

467 cÚ¡ **
__»¡riù
 
__¤c
,

468 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

469 
size_t
 
__d¡Ën
), 
__mb¤towcs_chk
)

470 
	`__w¬Ç‰r
 ("mbsrtowcs called with dst buffer smallerhan†en "

473 
__fÜtify_funùiÚ
 
size_t


474 
	`__NTH
 (
	$mb¤towcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
, cÚ¡ **__»¡riù 
__¤c
,

475 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

477 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

479 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

480  
	`__mb¤towcs_chk
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
,

481 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

483 ià(
__Ën
 > 
	`__bos
 (
__d¡
è/  (
wch¬_t
))

484  
	`__mb¤towcs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
,

485 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

487  
	`__mb¤towcs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
);

488 
	}
}

491 
size_t
 
	$__wc¤tombs_chk
 (*
__»¡riù
 
__d¡
,

492 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

493 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

494 
size_t
 
__d¡Ën
è
__THROW
;

495 
size_t
 
	`__REDIRECT_NTH
 (
__wc¤tombs_®Ÿs
,

496 (*
__»¡riù
 
__d¡
,

497 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

498 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
),

499 
wc¤tombs
);

500 
size_t
 
	`__REDIRECT_NTH
 (
__wc¤tombs_chk_w¬n
,

501 (*
__»¡riù
 
__d¡
,

502 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

503 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

504 
size_t
 
__d¡Ën
), 
__wc¤tombs_chk
)

505 
	`__w¬Ç‰r
 ("wcsrtombs called with dst buffer smallerhan†en");

507 
__fÜtify_funùiÚ
 
size_t


508 
	`__NTH
 (
	$wc¤tombs
 (*
__»¡riù
 
__d¡
, cÚ¡ 
wch¬_t
 **__»¡riù 
__¤c
,

509 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

511 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

513 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

514  
	`__wc¤tombs_chk
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
, 
	`__bos
 (__dst));

516 ià(
__Ën
 > 
	`__bos
 (
__d¡
))

517  
	`__wc¤tombs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
, 
	`__bos
 (__dst));

519  
	`__wc¤tombs_®Ÿs
 (
__d¡
, 
__¤c
, 
__Ën
, 
__ps
);

520 
	}
}

523 #ifdeà
__USE_GNU


524 
size_t
 
	$__mb¢¹owcs_chk
 (
wch¬_t
 *
__»¡riù
 
__d¡
,

525 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

526 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

527 
size_t
 
__d¡Ën
è
__THROW
;

528 
size_t
 
	`__REDIRECT_NTH
 (
__mb¢¹owcs_®Ÿs
,

529 (
wch¬_t
 *
__»¡riù
 
__d¡
,

530 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

531 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
),

532 
mb¢¹owcs
);

533 
size_t
 
	`__REDIRECT_NTH
 (
__mb¢¹owcs_chk_w¬n
,

534 (
wch¬_t
 *
__»¡riù
 
__d¡
,

535 cÚ¡ **
__»¡riù
 
__¤c
, 
size_t
 
__nmc
,

536 
size_t
 
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
,

537 
size_t
 
__d¡Ën
), 
__mb¢¹owcs_chk
)

538 
	`__w¬Ç‰r
 ("mbsnrtowcs called with dst buffer smallerhan†en "

541 
__fÜtify_funùiÚ
 
size_t


542 
	`__NTH
 (
	$mb¢¹owcs
 (
wch¬_t
 *
__»¡riù
 
__d¡
, cÚ¡ **__»¡riù 
__¤c
,

543 
size_t
 
__nmc
, size_ˆ
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

545 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

547 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

548  
	`__mb¢¹owcs_chk
 (
__d¡
, 
__¤c
, 
__nmc
, 
__Ën
, 
__ps
,

549 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

551 ià(
__Ën
 > 
	`__bos
 (
__d¡
è/  (
wch¬_t
))

552  
	`__mb¢¹owcs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__nmc
, 
__Ën
, 
__ps
,

553 
	`__bos
 (
__d¡
è/  (
wch¬_t
));

555  
	`__mb¢¹owcs_®Ÿs
 (
__d¡
, 
__¤c
, 
__nmc
, 
__Ën
, 
__ps
);

556 
	}
}

559 
size_t
 
	$__wc¢¹ombs_chk
 (*
__»¡riù
 
__d¡
,

560 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

561 
size_t
 
__nwc
, size_ˆ
__Ën
,

562 
mb¡©e_t
 *
__»¡riù
 
__ps
, 
size_t
 
__d¡Ën
)

563 
__THROW
;

564 
size_t
 
	`__REDIRECT_NTH
 (
__wc¢¹ombs_®Ÿs
,

565 (*
__»¡riù
 
__d¡
,

566 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

567 
size_t
 
__nwc
, size_ˆ
__Ën
,

568 
mb¡©e_t
 *
__»¡riù
 
__ps
), 
wc¢¹ombs
);

569 
size_t
 
	`__REDIRECT_NTH
 (
__wc¢¹ombs_chk_w¬n
,

570 (*
__»¡riù
 
__d¡
,

571 cÚ¡ 
wch¬_t
 **
__»¡riù
 
__¤c
,

572 
size_t
 
__nwc
, size_ˆ
__Ën
,

573 
mb¡©e_t
 *
__»¡riù
 
__ps
,

574 
size_t
 
__d¡Ën
), 
__wc¢¹ombs_chk
)

575 
	`__w¬Ç‰r
 ("wcsnrtombs called with dst buffer smallerhan†en");

577 
__fÜtify_funùiÚ
 
size_t


578 
	`__NTH
 (
	$wc¢¹ombs
 (*
__»¡riù
 
__d¡
, cÚ¡ 
wch¬_t
 **__»¡riù 
__¤c
,

579 
size_t
 
__nwc
, size_ˆ
__Ën
, 
mb¡©e_t
 *
__»¡riù
 
__ps
))

581 ià(
	`__bos
 (
__d¡
è!ğ(
size_t
) -1)

583 ià(!
	`__butš_cÚ¡ªt_p
 (
__Ën
))

584  
	`__wc¢¹ombs_chk
 (
__d¡
, 
__¤c
, 
__nwc
, 
__Ën
, 
__ps
,

585 
	`__bos
 (
__d¡
));

587 ià(
__Ën
 > 
	`__bos
 (
__d¡
))

588  
	`__wc¢¹ombs_chk_w¬n
 (
__d¡
, 
__¤c
, 
__nwc
, 
__Ën
, 
__ps
,

589 
	`__bos
 (
__d¡
));

591  
	`__wc¢¹ombs_®Ÿs
 (
__d¡
, 
__¤c
, 
__nwc
, 
__Ën
, 
__ps
);

592 
	}
}

	@/usr/include/wctype.h

23 #iâdeà
_WCTYPE_H


25 
	~<ã©u»s.h
>

26 
	~<b™s/ty³s.h
>

28 #iâdeà
__Ãed_iswxxx


29 
	#_WCTYPE_H
 1

	)

32 
	#__Ãed_wšt_t


	)

33 
	~<wch¬.h
>

37 #iâdeà
WEOF


38 
	#WEOF
 (0xffffffffu)

	)

41 #undeà
__Ãed_iswxxx


46 #iâdeà
__iswxxx_defšed


47 
	#__iswxxx_defšed
 1

	)

49 
__BEGIN_NAMESPACE_C99


52 
	twùy³_t
;

53 
	g__END_NAMESPACE_C99


55 #iâdeà
_ISwb™


60 
	~<’dŸn.h
>

61 #ià
__BYTE_ORDER
 =ğ
__BIG_ENDIAN


62 
	#_ISwb™
(
b™
è(1 << (b™))

	)

64 
	#_ISwb™
(
b™
) \

65 ((
b™
) < 8 ? () ((1UL << (bit)) << 24) \

66 : ((
b™
) < 16 ? () ((1UL << (bit)) << 8) \

67 : ((
b™
) < 24 ? () ((1UL << (bit)) >> 8) \

68 : (è((1UL << (
b™
)è>> 24))))

	)

73 
	m__ISwuµ”
 = 0,

74 
	m__ISwlow”
 = 1,

75 
	m__ISw®pha
 = 2,

76 
	m__ISwdig™
 = 3,

77 
	m__ISwxdig™
 = 4,

78 
	m__ISw¥aû
 = 5,

79 
	m__ISw´št
 = 6,

80 
	m__ISwg¿ph
 = 7,

81 
	m__ISwbÏnk
 = 8,

82 
	m__ISwúŒl
 = 9,

83 
	m__ISwpunù
 = 10,

84 
	m__ISw®num
 = 11,

86 
	m_ISwuµ”
 = 
_ISwb™
 (
__ISwuµ”
),

87 
	m_ISwlow”
 = 
_ISwb™
 (
__ISwlow”
),

88 
	m_ISw®pha
 = 
_ISwb™
 (
__ISw®pha
),

89 
	m_ISwdig™
 = 
_ISwb™
 (
__ISwdig™
),

90 
	m_ISwxdig™
 = 
_ISwb™
 (
__ISwxdig™
),

91 
	m_ISw¥aû
 = 
_ISwb™
 (
__ISw¥aû
),

92 
	m_ISw´št
 = 
_ISwb™
 (
__ISw´št
),

93 
	m_ISwg¿ph
 = 
_ISwb™
 (
__ISwg¿ph
),

94 
	m_ISwbÏnk
 = 
_ISwb™
 (
__ISwbÏnk
),

95 
	m_ISwúŒl
 = 
_ISwb™
 (
__ISwúŒl
),

96 
	m_ISwpunù
 = 
_ISwb™
 (
__ISwpunù
),

97 
	m_ISw®num
 = 
_ISwb™
 (
__ISw®num
)

102 
__BEGIN_DECLS


104 
__BEGIN_NAMESPACE_C99


111 
	$isw®num
 (
wšt_t
 
__wc
è
__THROW
;

117 
	$isw®pha
 (
wšt_t
 
__wc
è
__THROW
;

120 
	$iswúŒl
 (
wšt_t
 
__wc
è
__THROW
;

124 
	$iswdig™
 (
wšt_t
 
__wc
è
__THROW
;

128 
	$iswg¿ph
 (
wšt_t
 
__wc
è
__THROW
;

133 
	$iswlow”
 (
wšt_t
 
__wc
è
__THROW
;

136 
	$isw´št
 (
wšt_t
 
__wc
è
__THROW
;

141 
	$iswpunù
 (
wšt_t
 
__wc
è
__THROW
;

146 
	$isw¥aû
 (
wšt_t
 
__wc
è
__THROW
;

151 
	$iswuµ”
 (
wšt_t
 
__wc
è
__THROW
;

156 
	$iswxdig™
 (
wšt_t
 
__wc
è
__THROW
;

161 #ifdeà
__USE_ISOC99


162 
	$iswbÏnk
 (
wšt_t
 
__wc
è
__THROW
;

171 
wùy³_t
 
	$wùy³
 (cÚ¡ *
__´İ”ty
è
__THROW
;

175 
	$iswùy³
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
è
__THROW
;

176 
__END_NAMESPACE_C99


183 
__BEGIN_NAMESPACE_C99


186 cÚ¡ 
	t__št32_t
 *
	twù¿ns_t
;

187 
__END_NAMESPACE_C99


188 #ifdeà
__USE_GNU


189 
	$__USING_NAMESPACE_C99
(
wù¿ns_t
)

192 
__BEGIN_NAMESPACE_C99


194 
wšt_t
 
	$towlow”
 (
wšt_t
 
__wc
è
__THROW
;

197 
wšt_t
 
	$towuµ”
 (
wšt_t
 
__wc
è
__THROW
;

198 
__END_NAMESPACE_C99


200 
__END_DECLS


207 #ifdeà
_WCTYPE_H


213 
__BEGIN_DECLS


215 
__BEGIN_NAMESPACE_C99


218 
wù¿ns_t
 
	$wù¿ns
 (cÚ¡ *
__´İ”ty
è
__THROW
;

221 
wšt_t
 
	$towù¿ns
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
è
__THROW
;

222 
__END_NAMESPACE_C99


224 #ifdeà
__USE_XOPEN2K8


226 
	~<xloÿË.h
>

230 
	$isw®num_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

236 
	$isw®pha_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

239 
	$iswúŒl_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

243 
	$iswdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

247 
	$iswg¿ph_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

252 
	$iswlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

255 
	$isw´št_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

260 
	$iswpunù_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

265 
	$isw¥aû_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

270 
	$iswuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

275 
	$iswxdig™_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

280 
	$iswbÏnk_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

284 
wùy³_t
 
	$wùy³_l
 (cÚ¡ *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

285 
__THROW
;

289 
	$iswùy³_l
 (
wšt_t
 
__wc
, 
wùy³_t
 
__desc
, 
__loÿË_t
 
__loÿË
)

290 
__THROW
;

298 
wšt_t
 
	$towlow”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

301 
wšt_t
 
	$towuµ”_l
 (
wšt_t
 
__wc
, 
__loÿË_t
 
__loÿË
è
__THROW
;

305 
wù¿ns_t
 
	$wù¿ns_l
 (cÚ¡ *
__´İ”ty
, 
__loÿË_t
 
__loÿË
)

306 
__THROW
;

309 
wšt_t
 
	$towù¿ns_l
 (
wšt_t
 
__wc
, 
wù¿ns_t
 
__desc
,

310 
__loÿË_t
 
__loÿË
è
__THROW
;

314 
__END_DECLS


	@/usr/include/asm-generic/sockios.h

1 #iâdeà
__ASM_GENERIC_SOCKIOS_H


2 
	#__ASM_GENERIC_SOCKIOS_H


	)

5 
	#FIOSETOWN
 0x8901

	)

6 
	#SIOCSPGRP
 0x8902

	)

7 
	#FIOGETOWN
 0x8903

	)

8 
	#SIOCGPGRP
 0x8904

	)

9 
	#SIOCATMARK
 0x8905

	)

10 
	#SIOCGSTAMP
 0x8906

	)

11 
	#SIOCGSTAMPNS
 0x8907

	)

	@
1
.
1
/usr/include
1197
27518
analysis/adjusttimestamp.cc
analysis/adjusttimestamp.hh
analysis/aggcounter.cc
analysis/aggcounter.hh
analysis/aggpktcounter.cc
analysis/aggpktcounter.hh
analysis/aggregatefilter.cc
analysis/aggregatefilter.hh
analysis/aggregatefirst.cc
analysis/aggregatefirst.hh
analysis/aggregateip.cc
analysis/aggregateip.hh
analysis/aggregateipaddrpair.cc
analysis/aggregateipaddrpair.hh
analysis/aggregateipflows.cc
analysis/aggregateipflows.hh
analysis/aggregatelast.cc
analysis/aggregatelast.hh
analysis/aggregatelen.cc
analysis/aggregatelen.hh
analysis/aggregatenotifier.cc
analysis/aggregatenotifier.hh
analysis/aggregatepaint.cc
analysis/aggregatepaint.hh
analysis/anonipaddr.cc
analysis/anonipaddr.hh
analysis/eraseippayload.cc
analysis/eraseippayload.hh
analysis/fromcapdump.cc
analysis/fromcapdump.hh
analysis/fromdagdump.cc
analysis/fromdagdump.hh
analysis/fromflandump.cc
analysis/fromflandump.hh
analysis/fromipsumdump.cc
analysis/fromipsumdump.hh
analysis/fromnetflowsumdump.cc
analysis/fromnetflowsumdump.hh
analysis/fromnlanrdump.cc
analysis/fromnlanrdump.hh
analysis/fromtcpdump.cc
analysis/fromtcpdump.hh
analysis/ipsumdump_anno.cc
analysis/ipsumdump_anno.hh
analysis/ipsumdump_icmp.cc
analysis/ipsumdump_icmp.hh
analysis/ipsumdump_ip.cc
analysis/ipsumdump_ip.hh
analysis/ipsumdump_link.cc
analysis/ipsumdump_link.hh
analysis/ipsumdump_payload.cc
analysis/ipsumdump_payload.hh
analysis/ipsumdump_tcp.cc
analysis/ipsumdump_tcp.hh
analysis/ipsumdump_udp.cc
analysis/ipsumdump_udp.hh
analysis/ipsumdumpinfo.cc
analysis/ipsumdumpinfo.hh
analysis/settimestampdelta.cc
analysis/settimestampdelta.hh
analysis/storetimestamp.cc
analysis/storetimestamp.hh
analysis/storeudptimeseqrecord.cc
analysis/storeudptimeseqrecord.hh
analysis/timefilter.cc
analysis/timefilter.hh
analysis/timerange.cc
analysis/timerange.hh
analysis/timesortedsched.cc
analysis/timesortedsched.hh
analysis/timestampaccum.cc
analysis/timestampaccum.hh
analysis/toipflowdumps.cc
analysis/toipflowdumps.hh
analysis/toipsumdump.cc
analysis/toipsumdump.hh
app/ftpportmapper.cc
app/ftpportmapper.hh
aqm/adaptivered.cc
aqm/adaptivered.hh
aqm/codel.cc
aqm/codel.hh
aqm/pi.cc
aqm/pi.hh
aqm/red.cc
aqm/red.hh
ethernet/arpfaker.cc
ethernet/arpfaker.hh
ethernet/arpprint.cc
ethernet/arpprint.hh
ethernet/arpquerier.cc
ethernet/arpquerier.hh
ethernet/arpresponder.cc
ethernet/arpresponder.hh
ethernet/arptable.cc
ethernet/arptable.hh
ethernet/checkarpheader.cc
ethernet/checkarpheader.hh
ethernet/ensureether.cc
ethernet/ensureether.hh
ethernet/etherencap.cc
ethernet/etherencap.hh
ethernet/ethermirror.cc
ethernet/ethermirror.hh
ethernet/etherpausesource.cc
ethernet/etherpausesource.hh
ethernet/etherrewrite.cc
ethernet/etherrewrite.hh
ethernet/ethervlanencap.cc
ethernet/ethervlanencap.hh
ethernet/getetheraddress.cc
ethernet/getetheraddress.hh
ethernet/hostetherfilter.cc
ethernet/hostetherfilter.hh
ethernet/ip6ndadvertiser.cc
ethernet/ip6ndadvertiser.hh
ethernet/ip6ndsolicitor.cc
ethernet/ip6ndsolicitor.hh
ethernet/setetheraddress.cc
ethernet/setetheraddress.hh
ethernet/setvlananno.cc
ethernet/setvlananno.hh
ethernet/storeetheraddress.cc
ethernet/storeetheraddress.hh
ethernet/stripethervlanheader.cc
ethernet/stripethervlanheader.hh
ethernet/vlandecap.cc
ethernet/vlandecap.hh
ethernet/vlanencap.cc
ethernet/vlanencap.hh
etherswitch/bridgemessage.cc
etherswitch/bridgemessage.hh
etherswitch/debugbridge.cc
etherswitch/debugbridge.hh
etherswitch/etherswitch.cc
etherswitch/etherswitch.hh
etherswitch/listenetherswitch.cc
etherswitch/listenetherswitch.hh
etherswitch/spantree.cc
etherswitch/spantree.hh
grid/ackresponder.cc
grid/ackresponder.hh
grid/ackresponder2.cc
grid/ackresponder2.hh
grid/ackretrysender.cc
grid/ackretrysender.hh
grid/ackretrysender2.cc
grid/ackretrysender2.hh
grid/airoinfo.cc
grid/airoinfo.hh
grid/amoeba.cc
grid/amoeba.hh
grid/bottleneckmetric.cc
grid/bottleneckmetric.hh
grid/checkgridheader.cc
grid/checkgridheader.hh
grid/delivery_rate_table.hh
grid/dsdvroutetable.cc
grid/dsdvroutetable.hh
grid/dsr.hh
grid/dsrarptable.cc
grid/dsrarptable.hh
grid/dsrroutetable.cc
grid/dsrroutetable.hh
grid/e2elossmetric.cc
grid/e2elossmetric.hh
grid/etx2metric.cc
grid/etx2metric.hh
grid/etxmetric.cc
grid/etxmetric.hh
grid/filterbyhops.cc
grid/filterbyhops.hh
grid/filterbyrange.cc
grid/filterbyrange.hh
grid/fixdstloc.cc
grid/fixdstloc.hh
grid/fixsrcloc.cc
grid/fixsrcloc.hh
grid/floodinglocquerier.cc
grid/floodinglocquerier.hh
grid/grid.hh
grid/gridencap.cc
grid/gridencap.hh
grid/gridgatewayinfo.cc
grid/gridgatewayinfo.hh
grid/gridgenericlocinfo.cc
grid/gridgenericlocinfo.hh
grid/gridgenericlogger.cc
grid/gridgenericlogger.hh
grid/gridgenericmetric.cc
grid/gridgenericmetric.hh
grid/gridgenericrt.hh
grid/gridheaderinfo.cc
grid/gridheaderinfo.hh
grid/gridlocationinfo.cc
grid/gridlocationinfo.hh
grid/gridlocationinfo2.cc
grid/gridlocationinfo2.hh
grid/gridlogger.cc
grid/gridlogger.hh
grid/gridprobehandler.cc
grid/gridprobehandler.hh
grid/gridprobereplyreceiver.cc
grid/gridprobereplyreceiver.hh
grid/gridprobesender.cc
grid/gridprobesender.hh
grid/gridproxy.cc
grid/gridproxy.hh
grid/gridroutecb.hh
grid/gridroutetable.cc
grid/gridroutetable.hh
grid/gridsrforwarder.cc
grid/gridsrforwarder.hh
grid/gridtxerror.cc
grid/gridtxerror.hh
grid/hello.cc
grid/hello.hh
grid/hopcountmetric.cc
grid/hopcountmetric.hh
grid/incseqno.cc
grid/incseqno.hh
grid/linkstat.cc
grid/linkstat.hh
grid/linktester.cc
grid/linktester.hh
grid/linktestreceiver.cc
grid/linktestreceiver.hh
grid/linktracker.cc
grid/linktracker.hh
grid/lirmetric.cc
grid/lirmetric.hh
grid/locfromfile.cc
grid/locfromfile.hh
grid/locqueryresponder.cc
grid/locqueryresponder.hh
grid/loctable.cc
grid/loctable.hh
grid/lookupgeogridroute.cc
grid/lookupgeogridroute.hh
grid/lookuplocalgridroute.cc
grid/lookuplocalgridroute.hh
grid/lookuplocalgridroute2.cc
grid/lookuplocalgridroute2.hh
grid/lrhello.cc
grid/lrhello.hh
grid/movesim.cc
grid/movesim.hh
grid/packetlogger.cc
grid/packetlogger.hh
grid/packetlogger2.cc
grid/packetlogger2.hh
grid/pep.cc
grid/pep.hh
grid/pep_proto.hh
grid/pingpong.cc
grid/pingpong.hh
grid/printgrid.cc
grid/printgrid.hh
grid/qvec.hh
grid/radiosim.cc
grid/radiosim.hh
grid/region.cc
grid/region.hh
grid/regionpep.cc
grid/regionpep.hh
grid/setgridchecksum.cc
grid/setgridchecksum.hh
grid/simplelocquerier.cc
grid/simplelocquerier.hh
grid/stripdsrheader.cc
grid/stripdsrheader.hh
grid/threshmetric.cc
grid/threshmetric.hh
grid/timeutils.hh
grid/unstripdsrheader.cc
grid/unstripdsrheader.hh
grid/updateroutes.cc
grid/updateroutes.hh
grid/yarvismetric.cc
grid/yarvismetric.hh
icmp/checkicmpheader.cc
icmp/checkicmpheader.hh
icmp/icmperror.cc
icmp/icmperror.hh
icmp/icmpipencap.cc
icmp/icmpipencap.hh
icmp/icmppingencap.cc
icmp/icmppingencap.hh
icmp/icmppingresponder.cc
icmp/icmppingresponder.hh
icmp/icmppingrewriter.cc
icmp/icmppingrewriter.hh
icmp/icmprewriter.cc
icmp/icmprewriter.hh
icmp/icmpsendpings.cc
icmp/icmpsendpings.hh
ip/checkipheader.cc
ip/checkipheader.hh
ip/checkipheader2.cc
ip/checkipheader2.hh
ip/decipttl.cc
ip/decipttl.hh
ip/directiplookup.cc
ip/directiplookup.hh
ip/fixipsrc.cc
ip/fixipsrc.hh
ip/getipaddress.cc
ip/getipaddress.hh
ip/ipaddrpairrewriter.cc
ip/ipaddrpairrewriter.hh
ip/ipaddrrewriter.cc
ip/ipaddrrewriter.hh
ip/ipclassifier.cc
ip/ipclassifier.hh
ip/ipencap.cc
ip/ipencap.hh
ip/ipfieldinfo.cc
ip/ipfieldinfo.hh
ip/ipfilter.cc
ip/ipfilter.hh
ip/ipfragmenter.cc
ip/ipfragmenter.hh
ip/ipgwoptions.cc
ip/ipgwoptions.hh
ip/ipinputcombo.cc
ip/ipinputcombo.hh
ip/ipmirror.cc
ip/ipmirror.hh
ip/ipnameinfo.cc
ip/ipnameinfo.hh
ip/ipoutputcombo.cc
ip/ipoutputcombo.hh
ip/ipprint.cc
ip/ipprint.hh
ip/ipratemon.cc
ip/ipratemon.hh
ip/ipreassembler.cc
ip/ipreassembler.hh
ip/iprewriterbase.cc
ip/iprewriterbase.hh
ip/iproutetable.cc
ip/iproutetable.hh
ip/iprwmapping.cc
ip/iprwmapping.hh
ip/iprwpattern.cc
ip/iprwpattern.hh
ip/iprwpatterns.cc
ip/iprwpatterns.hh
ip/lineariplookup.cc
ip/lineariplookup.hh
ip/lookupiproute.cc
ip/lookupiproute.hh
ip/lookupiproutelinux.cc
ip/lookupiproutelinux.hh
ip/lookupiproutemp.cc
ip/lookupiproutemp.hh
ip/markipce.cc
ip/markipce.hh
ip/markipheader.cc
ip/markipheader.hh
ip/radixiplookup.cc
ip/radixiplookup.hh
ip/rangeiplookup.cc
ip/rangeiplookup.hh
ip/rfc2507c.cc
ip/rfc2507c.hh
ip/rfc2507d.cc
ip/rfc2507d.hh
ip/ripsend.cc
ip/ripsend.hh
ip/rripmapper.cc
ip/rripmapper.hh
ip/setipaddress.cc
ip/setipaddress.hh
ip/setipchecksum.cc
ip/setipchecksum.hh
ip/setipdscp.cc
ip/setipdscp.hh
ip/setipecn.cc
ip/setipecn.hh
ip/setrandipaddress.cc
ip/setrandipaddress.hh
ip/siphmapper.cc
ip/siphmapper.hh
ip/sortediplookup.cc
ip/sortediplookup.hh
ip/storeipaddress.cc
ip/storeipaddress.hh
ip/stripipheader.cc
ip/stripipheader.hh
ip/truncateippayload.cc
ip/truncateippayload.hh
ip/unstripipheader.cc
ip/unstripipheader.hh
ip6/addresstranslator.cc
ip6/addresstranslator.hh
ip6/checkip6header.cc
ip6/checkip6header.hh
ip6/decip6hlim.cc
ip6/decip6hlim.hh
ip6/getip6address.cc
ip6/getip6address.hh
ip6/icmp6error.cc
ip6/icmp6error.hh
ip6/ip6encap.cc
ip6/ip6encap.hh
ip6/ip6fragmenter.cc
ip6/ip6fragmenter.hh
ip6/ip6mirror.cc
ip6/ip6mirror.hh
ip6/ip6print.cc
ip6/ip6print.hh
ip6/ip6routetable.cc
ip6/ip6routetable.hh
ip6/lookupip6route.cc
ip6/lookupip6route.hh
ip6/markip6header.cc
ip6/markip6header.hh
ip6/protocoltranslator46.cc
ip6/protocoltranslator46.hh
ip6/protocoltranslator64.cc
ip6/protocoltranslator64.hh
ip6/setip6address.cc
ip6/setip6address.hh
ip6/setip6dscp.cc
ip6/setip6dscp.hh
ipsec/aes.cc
ipsec/aes.hh
ipsec/des.cc
ipsec/des.hh
ipsec/desp.cc
ipsec/desp.hh
ipsec/esp.cc
ipsec/esp.hh
ipsec/hmac.cc
ipsec/hmac.hh
ipsec/hmacsha1.cc
ipsec/hmacsha1.hh
ipsec/ipsecencap.cc
ipsec/ipsecencap.hh
ipsec/ipsecroutetable.cc
ipsec/ipsecroutetable.hh
ipsec/radixipseclookup.cc
ipsec/radixipseclookup.hh
ipsec/sadatatuple.hh
ipsec/satable.cc
ipsec/satable.hh
ipsec/sha1.cc
ipsec/sha1.hh
ipsec/sha1_impl.cc
ipsec/sha1_impl.hh
json/json.cc
json/json.hh
linuxmodule/anydevice.cc
linuxmodule/anydevice.hh
linuxmodule/cyclecountaccum.cc
linuxmodule/cyclecountaccum.hh
linuxmodule/fastudpsrc.cc
linuxmodule/fastudpsrc.hh
linuxmodule/fromdevice.cc
linuxmodule/fromdevice.hh
linuxmodule/fromhost.cc
linuxmodule/fromhost.hh
linuxmodule/fromuserdevice.cc
linuxmodule/fromuserdevice.hh
linuxmodule/perfcountaccum.cc
linuxmodule/perfcountaccum.hh
linuxmodule/perfcountinfo.cc
linuxmodule/perfcountinfo.hh
linuxmodule/perfcountuser.cc
linuxmodule/perfcountuser.hh
linuxmodule/polldevice.cc
linuxmodule/polldevice.hh
linuxmodule/rtcycles.cc
linuxmodule/rtcycles.hh
linuxmodule/schedulelinux.cc
linuxmodule/schedulelinux.hh
linuxmodule/setcyclecount.cc
linuxmodule/setcyclecount.hh
linuxmodule/setperfcount.cc
linuxmodule/setperfcount.hh
linuxmodule/threadmonitor.cc
linuxmodule/threadmonitor.hh
linuxmodule/todevice.cc
linuxmodule/todevice.hh
linuxmodule/tohost.cc
linuxmodule/tohost.hh
linuxmodule/tohostsniffers.cc
linuxmodule/tohostsniffers.hh
linuxmodule/touserdevice.cc
linuxmodule/touserdevice.hh
local/bufconv.cc
local/bufconv.hh
local/chuckcheck.cc
local/chuckcheck.hh
local/copyflowid.cc
local/copyflowid.hh
local/copytcpseq.cc
local/copytcpseq.hh
local/duppath.cc
local/duppath.hh
local/forceicmp.cc
local/forceicmp.hh
local/forceip.cc
local/forceip.hh
local/forcetcp.cc
local/forcetcp.hh
local/forceudp.cc
local/forceudp.hh
local/indextreesiplookup.cc
local/indextreesiplookup.hh
local/print80211.cc
local/print80211.hh
local/printairo.cc
local/printairo.hh
local/reframe.cc
local/reframe.hh
local/rrunqueue.cc
local/rrunqueue.hh
local/tcpack.cc
local/tcpack.hh
local/tcpbuffer.cc
local/tcpbuffer.hh
local/tcpconn.cc
local/tcpconn.hh
local/tcpdemux.cc
local/tcpdemux.hh
local/tcpreflector.cc
local/tcpreflector.hh
local/toytcp.cc
local/toytcp.hh
local/webgen.cc
local/webgen.hh
radio/b8b10.cc
radio/b8b10.hh
radio/bim-proto.hh
radio/bim.cc
radio/bim.hh
radio/checkpattern.cc
radio/checkpattern.hh
radio/scramble.cc
radio/scramble.hh
radio/sendpattern.cc
radio/sendpattern.hh
simple/simpleidle.cc
simple/simpleidle.hh
simple/simplepriosched.cc
simple/simplepriosched.hh
simple/simplepullswitch.cc
simple/simplepullswitch.hh
simple/simplerrsched.cc
simple/simplerrsched.hh
standard/addressinfo.cc
standard/align.cc
standard/align.hh
standard/alignmentinfo.cc
standard/annotationinfo.cc
standard/annotationinfo.hh
standard/averagecounter.cc
standard/averagecounter.hh
standard/bandwidthmeter.cc
standard/bandwidthmeter.hh
standard/bandwidthshaper.cc
standard/bandwidthshaper.hh
standard/block.cc
standard/block.hh
standard/burster.cc
standard/burster.hh
standard/bwratedsplitter.cc
standard/bwratedsplitter.hh
standard/bwratedunqueue.cc
standard/bwratedunqueue.hh
standard/bypass.cc
standard/bypass.hh
standard/checkcrc32.cc
standard/checkcrc32.hh
standard/checklength.cc
standard/checklength.hh
standard/checkpaint.cc
standard/checkpaint.hh
standard/classification.cc
standard/classification.hh
standard/classifier.cc
standard/classifier.hh
standard/clickyinfo.cc
standard/clickyinfo.hh
standard/clipboard.cc
standard/clipboard.hh
standard/compblock.cc
standard/compblock.hh
standard/counter.cc
standard/counter.hh
standard/cpuqueue.cc
standard/cpuqueue.hh
standard/cpuswitch.cc
standard/cpuswitch.hh
standard/delayshaper.cc
standard/delayshaper.hh
standard/delayunqueue.cc
standard/delayunqueue.hh
standard/devirtualizeinfo.cc
standard/devirtualizeinfo.hh
standard/discard.cc
standard/discard.hh
standard/discardnofree.cc
standard/discardnofree.hh
standard/drivermanager.cc
standard/drivermanager.hh
standard/dropbroadcasts.cc
standard/dropbroadcasts.hh
standard/drr.cc
standard/drr.hh
standard/errorelement.cc
standard/flowinfo.cc
standard/flowinfo.hh
standard/frontdropqueue.cc
standard/frontdropqueue.hh
standard/fullnotequeue.cc
standard/fullnotequeue.hh
standard/hashswitch.cc
standard/hashswitch.hh
standard/hub.cc
standard/hub.hh
standard/idle.cc
standard/idle.hh
standard/infinitesource.cc
standard/infinitesource.hh
standard/inputswitch.cc
standard/inputswitch.hh
standard/linkunqueue.cc
standard/linkunqueue.hh
standard/markmacheader.cc
standard/markmacheader.hh
standard/messageelement.cc
standard/messageelement.hh
standard/meter.cc
standard/meter.hh
standard/mixedqueue.cc
standard/mixedqueue.hh
standard/msqueue.cc
standard/msqueue.hh
standard/notifierqueue.cc
standard/notifierqueue.hh
standard/nullelement.cc
standard/nullelement.hh
standard/nulls.cc
standard/nulls.hh
standard/pad.cc
standard/pad.hh
standard/paint.cc
standard/paint.hh
standard/paintswitch.cc
standard/paintswitch.hh
standard/painttee.cc
standard/painttee.hh
standard/portinfo.cc
standard/print.cc
standard/print.hh
standard/priosched.cc
standard/priosched.hh
standard/pullswitch.cc
standard/pullswitch.hh
standard/quicknotequeue.cc
standard/quicknotequeue.hh
standard/quitwatcher.cc
standard/quitwatcher.hh
standard/randomerror.cc
standard/randomerror.hh
standard/randomsample.cc
standard/randomsample.hh
standard/randomsource.cc
standard/randomsource.hh
standard/randomswitch.cc
standard/randomswitch.hh
standard/ratedsource.cc
standard/ratedsource.hh
standard/ratedsplitter.cc
standard/ratedsplitter.hh
standard/ratedunqueue.cc
standard/ratedunqueue.hh
standard/resize.cc
standard/resize.hh
standard/rrsched.cc
standard/rrsched.hh
standard/rrswitch.cc
standard/rrswitch.hh
standard/scheduleinfo.cc
standard/script.cc
standard/script.hh
standard/setannobyte.cc
standard/setannobyte.hh
standard/setcrc32.cc
standard/setcrc32.hh
standard/setpackettype.cc
standard/setpackettype.hh
standard/settimestamp.cc
standard/settimestamp.hh
standard/shaper.cc
standard/shaper.hh
standard/simplequeue.cc
standard/simplequeue.hh
standard/staticpullswitch.cc
standard/staticpullswitch.hh
standard/staticswitch.cc
standard/staticswitch.hh
standard/storedata.cc
standard/storedata.hh
standard/stridesched.cc
standard/stridesched.hh
standard/strideswitch.cc
standard/strideswitch.hh
standard/strip.cc
standard/strip.hh
standard/striptonet.cc
standard/striptonet.hh
standard/suppressor.cc
standard/suppressor.hh
standard/switch.cc
standard/switch.hh
standard/tee.cc
standard/tee.hh
standard/threadsafequeue.cc
standard/threadsafequeue.hh
standard/timedsink.cc
standard/timedsink.hh
standard/timedsource.cc
standard/timedsource.hh
standard/timedunqueue.cc
standard/timedunqueue.hh
standard/truncate.cc
standard/truncate.hh
standard/unqueue.cc
standard/unqueue.hh
standard/unqueue2.cc
standard/unqueue2.hh
standard/unstrip.cc
standard/unstrip.hh
tcpudp/checktcpheader.cc
tcpudp/checktcpheader.hh
tcpudp/checkudpheader.cc
tcpudp/checkudpheader.hh
tcpudp/dynudpipencap.cc
tcpudp/dynudpipencap.hh
tcpudp/fasttcpflows.cc
tcpudp/fasttcpflows.hh
tcpudp/fastudpflows.cc
tcpudp/fastudpflows.hh
tcpudp/fastudpsrcip6.cc
tcpudp/fastudpsrcip6.hh
tcpudp/iprewriter.cc
tcpudp/iprewriter.hh
tcpudp/settcpchecksum.cc
tcpudp/settcpchecksum.hh
tcpudp/setudpchecksum.cc
tcpudp/setudpchecksum.hh
tcpudp/snooptcp.cc
tcpudp/snooptcp.hh
tcpudp/statelesstcpresp.cc
tcpudp/statelesstcpresp.hh
tcpudp/tcpfragmenter.cc
tcpudp/tcpfragmenter.hh
tcpudp/tcpipsend.cc
tcpudp/tcpipsend.hh
tcpudp/tcprewriter.cc
tcpudp/tcprewriter.hh
tcpudp/udpip6encap.cc
tcpudp/udpip6encap.hh
tcpudp/udpipencap.cc
tcpudp/udpipencap.hh
tcpudp/udprewriter.cc
tcpudp/udprewriter.hh
test/bhmtest.cc
test/bhmtest.hh
test/biginttest.cc
test/biginttest.hh
test/bitvectortest.cc
test/bitvectortest.hh
test/blockthread.cc
test/blockthread.hh
test/checkpacket.cc
test/checkpacket.hh
test/clptest.cc
test/clptest.hh
test/comparepackets.cc
test/comparepackets.hh
test/confparsetest.cc
test/confparsetest.hh
test/cryptotest.cc
test/cryptotest.hh
test/dequetest.cc
test/dequetest.hh
test/errortest.cc
test/errortest.hh
test/functiontest.cc
test/functiontest.hh
test/handlertask.cc
test/handlertask.hh
test/hashtabletest.cc
test/hashtabletest.hh
test/heaptest.cc
test/heaptest.hh
test/jsontest.cc
test/jsontest.hh
test/listtest.cc
test/listtest.hh
test/mtdietest.cc
test/mtdietest.hh
test/neighborhoodtest.cc
test/neighborhoodtest.hh
test/notifierdebug.cc
test/notifierdebug.hh
test/notifiertest.cc
test/notifiertest.hh
test/nulltask.cc
test/nulltask.hh
test/packettest.cc
test/packettest.hh
test/queuethreadtest.cc
test/queuethreadtest.hh
test/queueyanktest.cc
test/queueyanktest.hh
test/randomseed.cc
test/randomseed.hh
test/schedordertest.cc
test/schedordertest.hh
test/sorttest.cc
test/sorttest.hh
test/taskthreadtest.cc
test/taskthreadtest.hh
test/timertest.cc
test/timertest.hh
test/tokenbuckettest.cc
test/tokenbuckettest.hh
test/upstreamnotifier.cc
test/upstreamnotifier.hh
test/vectortest.cc
test/vectortest.hh
userlevel/changeuid.cc
userlevel/changeuid.hh
userlevel/chattersocket.cc
userlevel/chattersocket.hh
userlevel/controlsocket.cc
userlevel/controlsocket.hh
userlevel/dpdkinfo.cc
userlevel/dpdkinfo.hh
userlevel/ensuredpdkbuffer.cc
userlevel/ensuredpdkbuffer.hh
userlevel/fakepcap.cc
userlevel/fakepcap.hh
userlevel/fastudpsrc.cc
userlevel/fastudpsrc.hh
userlevel/fromdevice.cc
userlevel/fromdevice.hh
userlevel/fromdpdkdevice.cc
userlevel/fromdpdkdevice.hh
userlevel/fromdump.cc
userlevel/fromdump.hh
userlevel/fromhost.cc
userlevel/fromhost.hh
userlevel/fromrawsocket.cc
userlevel/fromrawsocket.hh
userlevel/fromsocket.cc
userlevel/fromsocket.hh
userlevel/handlerproxy.cc
userlevel/handlerproxy.hh
userlevel/ipflowrawsockets.cc
userlevel/ipflowrawsockets.hh
userlevel/kernelfilter.cc
userlevel/kernelfilter.hh
userlevel/kerneltap.cc
userlevel/kerneltap.hh
userlevel/kerneltun.cc
userlevel/kerneltun.hh
userlevel/khandlerproxy.cc
userlevel/khandlerproxy.hh
userlevel/mcastsocket.cc
userlevel/mcastsocket.hh
userlevel/netmapinfo.cc
userlevel/netmapinfo.hh
userlevel/printold.cc
userlevel/printold.hh
userlevel/progressbar.cc
userlevel/progressbar.hh
userlevel/rawsocket.cc
userlevel/rawsocket.hh
userlevel/socket.cc
userlevel/socket.hh
userlevel/todevice.cc
userlevel/todevice.hh
userlevel/todpdkdevice.cc
userlevel/todpdkdevice.hh
userlevel/todump.cc
userlevel/todump.hh
userlevel/tohost.cc
userlevel/tohost.hh
userlevel/torawsocket.cc
userlevel/torawsocket.hh
userlevel/tosocket.cc
userlevel/tosocket.hh
userlevel/umlswitch.cc
userlevel/umlswitch.hh
wifi/ap/associationresponder.cc
wifi/ap/associationresponder.hh
wifi/ap/beaconsource.cc
wifi/ap/beaconsource.hh
wifi/ap/openauthresponder.cc
wifi/ap/openauthresponder.hh
wifi/ap/proberesponder.cc
wifi/ap/proberesponder.hh
wifi/ap/stationtable.cc
wifi/ap/stationtable.hh
wifi/athdesc.h
wifi/athdescdecap.cc
wifi/athdescdecap.hh
wifi/athdescencap.cc
wifi/athdescencap.hh
wifi/autoratefallback.cc
wifi/autoratefallback.hh
wifi/availablerates.cc
wifi/availablerates.hh
wifi/bitrate.cc
wifi/bitrate.hh
wifi/ethercount.cc
wifi/ethercount.hh
wifi/extradecap.cc
wifi/extradecap.hh
wifi/extraencap.cc
wifi/extraencap.hh
wifi/filterfailures.cc
wifi/filterfailures.hh
wifi/filterphyerr.cc
wifi/filterphyerr.hh
wifi/filtertx.cc
wifi/filtertx.hh
wifi/fromhandler.cc
wifi/fromhandler.hh
wifi/linktable.cc
wifi/linktable.hh
wifi/madwifirate.cc
wifi/madwifirate.hh
wifi/packetstore.cc
wifi/packetstore.hh
wifi/path.hh
wifi/printtxfeedback.cc
wifi/printtxfeedback.hh
wifi/printwifi.cc
wifi/printwifi.hh
wifi/prism2decap.cc
wifi/prism2decap.hh
wifi/prism2encap.cc
wifi/prism2encap.hh
wifi/probetxrate.cc
wifi/probetxrate.hh
wifi/pushanno.cc
wifi/pushanno.hh
wifi/radiotapdecap.cc
wifi/radiotapdecap.hh
wifi/radiotapencap.cc
wifi/radiotapencap.hh
wifi/rc4.cc
wifi/rc4.hh
wifi/readanno.cc
wifi/readanno.hh
wifi/rxstats.cc
wifi/rxstats.hh
wifi/setnoack.cc
wifi/setnoack.hh
wifi/setrts.cc
wifi/setrts.hh
wifi/settxpower.cc
wifi/settxpower.hh
wifi/settxrate.cc
wifi/settxrate.hh
wifi/station/associationrequester.cc
wifi/station/associationrequester.hh
wifi/station/beaconscanner.cc
wifi/station/beaconscanner.hh
wifi/station/beacontracker.cc
wifi/station/beacontracker.hh
wifi/station/openauthrequester.cc
wifi/station/openauthrequester.hh
wifi/station/proberequester.cc
wifi/station/proberequester.hh
wifi/wepdecap.cc
wifi/wepdecap.hh
wifi/wepencap.cc
wifi/wepencap.hh
wifi/wifidecap.cc
wifi/wifidecap.hh
wifi/wifidefrag.cc
wifi/wifidefrag.hh
wifi/wifidupefilter.cc
wifi/wifidupefilter.hh
wifi/wifiencap.cc
wifi/wifiencap.hh
wifi/wififragment.cc
wifi/wififragment.hh
wifi/wifiseq.cc
wifi/wifiseq.hh
wifi/wirelessinfo.cc
wifi/wirelessinfo.hh
/usr/include/arpa/inet.h
/usr/include/asm/types.h
/usr/include/assert.h
/usr/include/fcntl.h
/usr/include/features.h
/usr/include/ifaddrs.h
/usr/include/linux/fs.h
/usr/include/linux/if.h
/usr/include/linux/if_arp.h
/usr/include/linux/if_bridge.h
/usr/include/linux/if_ether.h
/usr/include/linux/if_packet.h
/usr/include/linux/if_tun.h
/usr/include/linux/ip.h
/usr/include/linux/netdevice.h
/usr/include/linux/poll.h
/usr/include/linux/route.h
/usr/include/linux/rtnetlink.h
/usr/include/linux/sched.h
/usr/include/linux/types.h
/usr/include/linux/wait.h
/usr/include/linux/wireless.h
/usr/include/math.h
/usr/include/net/ethernet.h
/usr/include/net/if.h
/usr/include/net/if_arp.h
/usr/include/net/if_packet.h
/usr/include/net/route.h
/usr/include/netdb.h
/usr/include/netinet/in.h
/usr/include/netinet/tcp.h
/usr/include/netpacket/packet.h
/usr/include/pthread.h
/usr/include/signal.h
/usr/include/stdio.h
/usr/include/stdlib.h
/usr/include/sys/ioctl.h
/usr/include/sys/mman.h
/usr/include/sys/param.h
/usr/include/sys/resource.h
/usr/include/sys/select.h
/usr/include/sys/socket.h
/usr/include/sys/stat.h
/usr/include/sys/sysctl.h
/usr/include/sys/time.h
/usr/include/sys/types.h
/usr/include/sys/uio.h
/usr/include/sys/un.h
/usr/include/sys/wait.h
/usr/include/termio.h
/usr/include/termios.h
/usr/include/time.h
/usr/include/unistd.h
/usr/include/alloca.h
/usr/include/asm-generic/types.h
/usr/include/asm/byteorder.h
/usr/include/asm/poll.h
/usr/include/bits/byteswap.h
/usr/include/bits/confname.h
/usr/include/bits/environments.h
/usr/include/bits/fcntl.h
/usr/include/bits/fcntl2.h
/usr/include/bits/huge_val.h
/usr/include/bits/huge_valf.h
/usr/include/bits/huge_vall.h
/usr/include/bits/in.h
/usr/include/bits/inf.h
/usr/include/bits/ioctl-types.h
/usr/include/bits/ioctls.h
/usr/include/bits/math-finite.h
/usr/include/bits/math-vector.h
/usr/include/bits/mathcalls.h
/usr/include/bits/mathdef.h
/usr/include/bits/mathinline.h
/usr/include/bits/mman.h
/usr/include/bits/nan.h
/usr/include/bits/netdb.h
/usr/include/bits/param.h
/usr/include/bits/posix_opt.h
/usr/include/bits/pthreadtypes.h
/usr/include/bits/resource.h
/usr/include/bits/select.h
/usr/include/bits/select2.h
/usr/include/bits/setjmp.h
/usr/include/bits/sigaction.h
/usr/include/bits/sigcontext.h
/usr/include/bits/siginfo.h
/usr/include/bits/signum.h
/usr/include/bits/sigset.h
/usr/include/bits/sigstack.h
/usr/include/bits/sigthread.h
/usr/include/bits/sockaddr.h
/usr/include/bits/socket.h
/usr/include/bits/socket2.h
/usr/include/bits/stat.h
/usr/include/bits/stdio-ldbl.h
/usr/include/bits/stdio.h
/usr/include/bits/stdio2.h
/usr/include/bits/stdio_lim.h
/usr/include/bits/stdlib-bsearch.h
/usr/include/bits/stdlib-float.h
/usr/include/bits/stdlib-ldbl.h
/usr/include/bits/stdlib.h
/usr/include/bits/sys_errlist.h
/usr/include/bits/sysctl.h
/usr/include/bits/termios.h
/usr/include/bits/time.h
/usr/include/bits/types.h
/usr/include/bits/uio.h
/usr/include/bits/unistd.h
/usr/include/bits/waitflags.h
/usr/include/bits/waitstatus.h
/usr/include/bits/wordsize.h
/usr/include/endian.h
/usr/include/getopt.h
/usr/include/gnu/stubs.h
/usr/include/libio.h
/usr/include/limits.h
/usr/include/linux/filter.h
/usr/include/linux/hdlc/ioctl.h
/usr/include/linux/if_addr.h
/usr/include/linux/if_link.h
/usr/include/linux/in6.h
/usr/include/linux/ioctl.h
/usr/include/linux/libc-compat.h
/usr/include/linux/limits.h
/usr/include/linux/neighbour.h
/usr/include/linux/netlink.h
/usr/include/linux/posix_types.h
/usr/include/linux/socket.h
/usr/include/linux/sysctl.h
/usr/include/rpc/netdb.h
/usr/include/sched.h
/usr/include/stdc-predef.h
/usr/include/stdint.h
/usr/include/string.h
/usr/include/sys/cdefs.h
/usr/include/sys/sysmacros.h
/usr/include/sys/ttydefaults.h
/usr/include/sys/ucontext.h
/usr/include/xlocale.h
/usr/include/_G_config.h
/usr/include/asm-generic/int-ll64.h
/usr/include/asm-generic/poll.h
/usr/include/asm/ioctl.h
/usr/include/asm/ioctls.h
/usr/include/asm/posix_types.h
/usr/include/asm/socket.h
/usr/include/bits/byteswap-16.h
/usr/include/bits/endian.h
/usr/include/bits/fcntl-linux.h
/usr/include/bits/libio-ldbl.h
/usr/include/bits/libm-simd-decl-stubs.h
/usr/include/bits/mman-linux.h
/usr/include/bits/posix1_lim.h
/usr/include/bits/posix2_lim.h
/usr/include/bits/sched.h
/usr/include/bits/socket_type.h
/usr/include/bits/string.h
/usr/include/bits/string2.h
/usr/include/bits/string3.h
/usr/include/bits/timex.h
/usr/include/bits/typesizes.h
/usr/include/bits/wchar.h
/usr/include/bits/xopen_lim.h
/usr/include/ctype.h
/usr/include/gnu/stubs-32.h
/usr/include/gnu/stubs-64.h
/usr/include/gnu/stubs-x32.h
/usr/include/linux/bpf_common.h
/usr/include/linux/byteorder/little_endian.h
/usr/include/linux/kernel.h
/usr/include/linux/param.h
/usr/include/linux/stddef.h
/usr/include/asm-generic/ioctl.h
/usr/include/asm-generic/ioctls.h
/usr/include/asm-generic/socket.h
/usr/include/asm/bitsperlong.h
/usr/include/asm/param.h
/usr/include/asm/posix_types_32.h
/usr/include/asm/posix_types_64.h
/usr/include/asm/posix_types_x32.h
/usr/include/bits/local_lim.h
/usr/include/gconv.h
/usr/include/linux/swab.h
/usr/include/linux/sysinfo.h
/usr/include/wchar.h
/usr/include/asm-generic/bitsperlong.h
/usr/include/asm-generic/param.h
/usr/include/asm-generic/posix_types.h
/usr/include/asm/sockios.h
/usr/include/asm/swab.h
/usr/include/bits/wchar-ldbl.h
/usr/include/bits/wchar2.h
/usr/include/wctype.h
/usr/include/asm-generic/sockios.h
